<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd"><html xmlns="http://www.w3.org/1999/xhtml"><head><link rel="stylesheet" type="text/css" href="style.css" /><script type="text/javascript" src="highlight.js"></script></head><body><pre><span class="hs-pragma">{-# LANGUAGE LambdaCase #-}</span><span>
</span><span id="line-2"></span><span class="hs-pragma">{-# LANGUAGE PatternGuards #-}</span><span>
</span><span id="line-3"></span><span class="hs-pragma">{-# LANGUAGE RecordWildCards #-}</span><span>
</span><span id="line-4"></span><span class="hs-pragma">{-# LANGUAGE TupleSections #-}</span><span>
</span><span id="line-5"></span><span>
</span><span id="line-6"></span><span class="hs-comment">-- | Intended for creating new backends.</span><span>
</span><span id="line-7"></span><span class="hs-keyword">module</span><span> </span><span class="hs-identifier">Database.Persist.Sql.Internal</span><span>
</span><span id="line-8"></span><span>    </span><span class="hs-special">(</span><span> </span><span class="annot"><a href="Database.Persist.Sql.Internal.html#mkColumns"><span class="hs-identifier">mkColumns</span></a></span><span>
</span><span id="line-9"></span><span>    </span><span class="hs-special">,</span><span> </span><span class="annot"><a href="Database.Persist.Sql.Internal.html#defaultAttribute"><span class="hs-identifier">defaultAttribute</span></a></span><span>
</span><span id="line-10"></span><span>    </span><span class="hs-special">,</span><span> </span><span class="annot"><a href="Database.Persist.Sql.Internal.html#BackendSpecificOverrides"><span class="hs-identifier">BackendSpecificOverrides</span></a></span><span class="hs-special">(</span><span class="hs-glyph">..</span><span class="hs-special">)</span><span>
</span><span id="line-11"></span><span>    </span><span class="hs-special">,</span><span> </span><span class="annot"><a href="Database.Persist.Sql.Internal.html#getBackendSpecificForeignKeyName"><span class="hs-identifier">getBackendSpecificForeignKeyName</span></a></span><span>
</span><span id="line-12"></span><span>    </span><span class="hs-special">,</span><span> </span><span class="annot"><a href="Database.Persist.Sql.Internal.html#setBackendSpecificForeignKeyName"><span class="hs-identifier">setBackendSpecificForeignKeyName</span></a></span><span>
</span><span id="line-13"></span><span>    </span><span class="hs-special">,</span><span> </span><span class="annot"><a href="Database.Persist.Sql.Internal.html#emptyBackendSpecificOverrides"><span class="hs-identifier">emptyBackendSpecificOverrides</span></a></span><span>
</span><span id="line-14"></span><span>    </span><span class="hs-special">)</span><span> </span><span class="hs-keyword">where</span><span>
</span><span id="line-15"></span><span>
</span><span id="line-16"></span><span class="hs-keyword">import</span><span> </span><span class="annot"><span class="hs-identifier">Control.Applicative</span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="hs-operator">(&lt;|&gt;)</span></span><span class="hs-special">)</span><span>
</span><span id="line-17"></span><span class="hs-keyword">import</span><span> </span><span class="annot"><span class="hs-identifier">Data.Monoid</span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="hs-identifier">mappend</span></span><span class="hs-special">,</span><span> </span><span class="annot"><span class="hs-identifier">mconcat</span></span><span class="hs-special">)</span><span>
</span><span id="line-18"></span><span class="hs-keyword">import</span><span> </span><span class="annot"><span class="hs-identifier">Data.Text</span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="hs-identifier">Text</span></span><span class="hs-special">)</span><span>
</span><span id="line-19"></span><span class="hs-keyword">import</span><span> </span><span class="hs-keyword">qualified</span><span> </span><span class="annot"><span class="hs-identifier">Data.Text</span></span><span> </span><span class="hs-keyword">as</span><span> </span><span class="annot"><span class="hs-identifier">T</span></span><span>
</span><span id="line-20"></span><span>
</span><span id="line-21"></span><span class="hs-keyword">import</span><span> </span><span class="annot"><span class="hs-identifier">Data.Maybe</span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="hs-identifier">fromMaybe</span></span><span class="hs-special">,</span><span> </span><span class="annot"><span class="hs-identifier">listToMaybe</span></span><span class="hs-special">,</span><span> </span><span class="annot"><span class="hs-identifier">mapMaybe</span></span><span class="hs-special">)</span><span>
</span><span id="line-22"></span><span class="hs-keyword">import</span><span> </span><span class="annot"><a href="Database.Persist.EntityDef.html"><span class="hs-identifier">Database.Persist.EntityDef</span></a></span><span>
</span><span id="line-23"></span><span class="hs-keyword">import</span><span> </span><span class="annot"><a href="Database.Persist.Sql.Types.html"><span class="hs-identifier">Database.Persist.Sql.Types</span></a></span><span>
</span><span id="line-24"></span><span class="hs-keyword">import</span><span> </span><span class="annot"><a href="Database.Persist.Types.html"><span class="hs-identifier">Database.Persist.Types</span></a></span><span>
</span><span id="line-25"></span><span>
</span><span id="line-26"></span><span class="hs-comment">-- | Record of functions to override the default behavior in 'mkColumns'.  It is</span><span>
</span><span id="line-27"></span><span class="hs-comment">-- recommended you initialize this with 'emptyBackendSpecificOverrides' and</span><span>
</span><span id="line-28"></span><span class="hs-comment">-- override the default values, so that as new fields are added, your code still</span><span>
</span><span id="line-29"></span><span class="hs-comment">-- compiles.</span><span>
</span><span id="line-30"></span><span class="hs-comment">--</span><span>
</span><span id="line-31"></span><span class="hs-comment">-- For added safety, use the @getBackendSpecific*@ and @setBackendSpecific*@</span><span>
</span><span id="line-32"></span><span class="hs-comment">-- functions, as a breaking change to the record field labels won't be reflected</span><span>
</span><span id="line-33"></span><span class="hs-comment">-- in a major version bump of the library.</span><span>
</span><span id="line-34"></span><span class="hs-comment">--</span><span>
</span><span id="line-35"></span><span class="hs-comment">-- @since 2.11</span><span>
</span><span id="line-36"></span><span class="hs-keyword">data</span><span> </span><span id="BackendSpecificOverrides"><span class="annot"><a href="Database.Persist.Sql.Internal.html#BackendSpecificOverrides"><span class="hs-identifier hs-var">BackendSpecificOverrides</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span id="BackendSpecificOverrides"><span class="annot"><a href="Database.Persist.Sql.Internal.html#BackendSpecificOverrides"><span class="hs-identifier hs-var">BackendSpecificOverrides</span></a></span></span><span>
</span><span id="line-37"></span><span>    </span><span class="hs-special">{</span><span> </span><span id="backendSpecificForeignKeyName"><span class="annot"><span class="annottext">BackendSpecificOverrides
-&gt; Maybe (EntityNameDB -&gt; FieldNameDB -&gt; ConstraintNameDB)
</span><a href="Database.Persist.Sql.Internal.html#backendSpecificForeignKeyName"><span class="hs-identifier hs-var hs-var">backendSpecificForeignKeyName</span></a></span></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><span class="hs-identifier hs-type">Maybe</span></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="Database.Persist.Names.html#EntityNameDB"><span class="hs-identifier hs-type">EntityNameDB</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="Database.Persist.Names.html#FieldNameDB"><span class="hs-identifier hs-type">FieldNameDB</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="Database.Persist.Names.html#ConstraintNameDB"><span class="hs-identifier hs-type">ConstraintNameDB</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-38"></span><span>    </span><span class="hs-special">}</span><span>
</span><span id="line-39"></span><span>
</span><span id="line-40"></span><span class="hs-comment">-- | If the override is defined, then this returns a function that accepts an</span><span>
</span><span id="line-41"></span><span class="hs-comment">-- entity name and field name and provides the 'ConstraintNameDB' for the</span><span>
</span><span id="line-42"></span><span class="hs-comment">-- foreign key constraint.</span><span>
</span><span id="line-43"></span><span class="hs-comment">--</span><span>
</span><span id="line-44"></span><span class="hs-comment">-- An abstract accessor for the 'BackendSpecificOverrides'</span><span>
</span><span id="line-45"></span><span class="hs-comment">--</span><span>
</span><span id="line-46"></span><span class="hs-comment">-- @since 2.13.0.0</span><span>
</span><span id="line-47"></span><span class="annot"><a href="Database.Persist.Sql.Internal.html#getBackendSpecificForeignKeyName"><span class="hs-identifier hs-type">getBackendSpecificForeignKeyName</span></a></span><span>
</span><span id="line-48"></span><span>    </span><span class="hs-glyph">::</span><span> </span><span class="annot"><a href="Database.Persist.Sql.Internal.html#BackendSpecificOverrides"><span class="hs-identifier hs-type">BackendSpecificOverrides</span></a></span><span>
</span><span id="line-49"></span><span>    </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="hs-identifier hs-type">Maybe</span></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="Database.Persist.Names.html#EntityNameDB"><span class="hs-identifier hs-type">EntityNameDB</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="Database.Persist.Names.html#FieldNameDB"><span class="hs-identifier hs-type">FieldNameDB</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="Database.Persist.Names.html#ConstraintNameDB"><span class="hs-identifier hs-type">ConstraintNameDB</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-50"></span><span id="getBackendSpecificForeignKeyName"><span class="annot"><span class="annottext">getBackendSpecificForeignKeyName :: BackendSpecificOverrides
-&gt; Maybe (EntityNameDB -&gt; FieldNameDB -&gt; ConstraintNameDB)
</span><a href="Database.Persist.Sql.Internal.html#getBackendSpecificForeignKeyName"><span class="hs-identifier hs-var hs-var">getBackendSpecificForeignKeyName</span></a></span></span><span> </span><span class="hs-glyph">=</span><span>
</span><span id="line-51"></span><span>    </span><span class="annot"><span class="annottext">BackendSpecificOverrides
-&gt; Maybe (EntityNameDB -&gt; FieldNameDB -&gt; ConstraintNameDB)
</span><a href="Database.Persist.Sql.Internal.html#backendSpecificForeignKeyName"><span class="hs-identifier hs-var">backendSpecificForeignKeyName</span></a></span><span>
</span><span id="line-52"></span><span>
</span><span id="line-53"></span><span class="hs-comment">-- | Set the backend's foreign key generation function to this value.</span><span>
</span><span id="line-54"></span><span class="hs-comment">--</span><span>
</span><span id="line-55"></span><span class="hs-comment">-- @since 2.13.0.0</span><span>
</span><span id="line-56"></span><span class="annot"><a href="Database.Persist.Sql.Internal.html#setBackendSpecificForeignKeyName"><span class="hs-identifier hs-type">setBackendSpecificForeignKeyName</span></a></span><span>
</span><span id="line-57"></span><span>    </span><span class="hs-glyph">::</span><span> </span><span class="hs-special">(</span><span class="annot"><a href="Database.Persist.Names.html#EntityNameDB"><span class="hs-identifier hs-type">EntityNameDB</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="Database.Persist.Names.html#FieldNameDB"><span class="hs-identifier hs-type">FieldNameDB</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="Database.Persist.Names.html#ConstraintNameDB"><span class="hs-identifier hs-type">ConstraintNameDB</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-58"></span><span>    </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="Database.Persist.Sql.Internal.html#BackendSpecificOverrides"><span class="hs-identifier hs-type">BackendSpecificOverrides</span></a></span><span>
</span><span id="line-59"></span><span>    </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="Database.Persist.Sql.Internal.html#BackendSpecificOverrides"><span class="hs-identifier hs-type">BackendSpecificOverrides</span></a></span><span>
</span><span id="line-60"></span><span id="setBackendSpecificForeignKeyName"><span class="annot"><span class="annottext">setBackendSpecificForeignKeyName :: (EntityNameDB -&gt; FieldNameDB -&gt; ConstraintNameDB)
-&gt; BackendSpecificOverrides -&gt; BackendSpecificOverrides
</span><a href="Database.Persist.Sql.Internal.html#setBackendSpecificForeignKeyName"><span class="hs-identifier hs-var hs-var">setBackendSpecificForeignKeyName</span></a></span></span><span> </span><span id="local-6989586621679933358"><span class="annot"><span class="annottext">EntityNameDB -&gt; FieldNameDB -&gt; ConstraintNameDB
</span><a href="#local-6989586621679933358"><span class="hs-identifier hs-var">func</span></a></span></span><span> </span><span id="local-6989586621679933357"><span class="annot"><span class="annottext">BackendSpecificOverrides
</span><a href="#local-6989586621679933357"><span class="hs-identifier hs-var">bso</span></a></span></span><span> </span><span class="hs-glyph">=</span><span>
</span><span id="line-61"></span><span>    </span><span class="annot"><span class="annottext">BackendSpecificOverrides
</span><a href="#local-6989586621679933357"><span class="hs-identifier hs-var">bso</span></a></span><span> </span><span class="hs-special">{</span><span> </span><span class="annot"><span class="annottext">backendSpecificForeignKeyName :: Maybe (EntityNameDB -&gt; FieldNameDB -&gt; ConstraintNameDB)
</span><a href="Database.Persist.Sql.Internal.html#backendSpecificForeignKeyName"><span class="hs-identifier hs-var">backendSpecificForeignKeyName</span></a></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">forall a. a -&gt; Maybe a
</span><span class="hs-identifier hs-var">Just</span></span><span> </span><span class="annot"><span class="annottext">EntityNameDB -&gt; FieldNameDB -&gt; ConstraintNameDB
</span><a href="#local-6989586621679933358"><span class="hs-identifier hs-var">func</span></a></span><span> </span><span class="hs-special">}</span><span>
</span><span id="line-62"></span><span>
</span><span id="line-63"></span><span id="local-6989586621679933433"><span id="local-6989586621679933434"><span class="annot"><a href="Database.Persist.Sql.Internal.html#findMaybe"><span class="hs-identifier hs-type">findMaybe</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="hs-special">(</span><span class="annot"><a href="#local-6989586621679933434"><span class="hs-identifier hs-type">a</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="hs-identifier hs-type">Maybe</span></span><span> </span><span class="annot"><a href="#local-6989586621679933433"><span class="hs-identifier hs-type">b</span></a></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-special">[</span><span class="annot"><a href="#local-6989586621679933434"><span class="hs-identifier hs-type">a</span></a></span><span class="hs-special">]</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="hs-identifier hs-type">Maybe</span></span><span> </span><span class="annot"><a href="#local-6989586621679933433"><span class="hs-identifier hs-type">b</span></a></span></span></span><span>
</span><span id="line-64"></span><span id="findMaybe"><span class="annot"><span class="annottext">findMaybe :: forall a b. (a -&gt; Maybe b) -&gt; [a] -&gt; Maybe b
</span><a href="Database.Persist.Sql.Internal.html#findMaybe"><span class="hs-identifier hs-var hs-var">findMaybe</span></a></span></span><span> </span><span id="local-6989586621679933355"><span class="annot"><span class="annottext">a -&gt; Maybe b
</span><a href="#local-6989586621679933355"><span class="hs-identifier hs-var">p</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">forall a. [a] -&gt; Maybe a
</span><span class="hs-identifier hs-var">listToMaybe</span></span><span> </span><span class="annot"><span class="annottext">forall b c a. (b -&gt; c) -&gt; (a -&gt; b) -&gt; a -&gt; c
</span><span class="hs-operator hs-var">.</span></span><span> </span><span class="annot"><span class="annottext">forall a b. (a -&gt; Maybe b) -&gt; [a] -&gt; [b]
</span><span class="hs-identifier hs-var">mapMaybe</span></span><span> </span><span class="annot"><span class="annottext">a -&gt; Maybe b
</span><a href="#local-6989586621679933355"><span class="hs-identifier hs-var">p</span></a></span><span>
</span><span id="line-65"></span><span>
</span><span id="line-66"></span><span class="hs-comment">-- | Creates an empty 'BackendSpecificOverrides' (i.e. use the default behavior; no overrides)</span><span>
</span><span id="line-67"></span><span class="hs-comment">--</span><span>
</span><span id="line-68"></span><span class="hs-comment">-- @since 2.11</span><span>
</span><span id="line-69"></span><span class="annot"><a href="Database.Persist.Sql.Internal.html#emptyBackendSpecificOverrides"><span class="hs-identifier hs-type">emptyBackendSpecificOverrides</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><a href="Database.Persist.Sql.Internal.html#BackendSpecificOverrides"><span class="hs-identifier hs-type">BackendSpecificOverrides</span></a></span><span>
</span><span id="line-70"></span><span id="emptyBackendSpecificOverrides"><span class="annot"><span class="annottext">emptyBackendSpecificOverrides :: BackendSpecificOverrides
</span><a href="Database.Persist.Sql.Internal.html#emptyBackendSpecificOverrides"><span class="hs-identifier hs-var hs-var">emptyBackendSpecificOverrides</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">Maybe (EntityNameDB -&gt; FieldNameDB -&gt; ConstraintNameDB)
-&gt; BackendSpecificOverrides
</span><a href="Database.Persist.Sql.Internal.html#BackendSpecificOverrides"><span class="hs-identifier hs-var">BackendSpecificOverrides</span></a></span><span> </span><span class="annot"><span class="annottext">forall a. Maybe a
</span><span class="hs-identifier hs-var">Nothing</span></span><span>
</span><span id="line-71"></span><span>
</span><span id="line-72"></span><span class="annot"><a href="Database.Persist.Sql.Internal.html#defaultAttribute"><span class="hs-identifier hs-type">defaultAttribute</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="hs-special">[</span><span class="annot"><a href="Database.Persist.Types.Base.html#FieldAttr"><span class="hs-identifier hs-type">FieldAttr</span></a></span><span class="hs-special">]</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="hs-identifier hs-type">Maybe</span></span><span> </span><span class="annot"><span class="hs-identifier hs-type">Text</span></span><span>
</span><span id="line-73"></span><span id="defaultAttribute"><span class="annot"><span class="annottext">defaultAttribute :: [FieldAttr] -&gt; Maybe Text
</span><a href="Database.Persist.Sql.Internal.html#defaultAttribute"><span class="hs-identifier hs-var hs-var">defaultAttribute</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">forall a b. (a -&gt; Maybe b) -&gt; [a] -&gt; Maybe b
</span><a href="Database.Persist.Sql.Internal.html#findMaybe"><span class="hs-identifier hs-var">findMaybe</span></a></span><span> </span><span class="annot"><span class="annottext">forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span> </span><span class="hs-glyph">\</span><span class="hs-glyph">case</span><span>
</span><span id="line-74"></span><span>    </span><span class="annot"><a href="Database.Persist.Types.Base.html#FieldAttrDefault"><span class="hs-identifier hs-type">FieldAttrDefault</span></a></span><span> </span><span id="local-6989586621679933352"><span class="annot"><span class="annottext">Text
</span><a href="#local-6989586621679933352"><span class="hs-identifier hs-var">x</span></a></span></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="annottext">forall a. a -&gt; Maybe a
</span><span class="hs-identifier hs-var">Just</span></span><span> </span><span class="annot"><span class="annottext">Text
</span><a href="#local-6989586621679933352"><span class="hs-identifier hs-var">x</span></a></span><span>
</span><span id="line-75"></span><span>    </span><span class="annot"><span class="annottext">FieldAttr
</span><span class="hs-identifier">_</span></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="annottext">forall a. Maybe a
</span><span class="hs-identifier hs-var">Nothing</span></span><span>
</span><span id="line-76"></span><span>
</span><span id="line-77"></span><span class="hs-comment">-- | Create the list of columns for the given entity.</span><span>
</span><span id="line-78"></span><span class="annot"><a href="Database.Persist.Sql.Internal.html#mkColumns"><span class="hs-identifier hs-type">mkColumns</span></a></span><span>
</span><span id="line-79"></span><span>    </span><span class="hs-glyph">::</span><span> </span><span class="hs-special">[</span><span class="annot"><a href="Database.Persist.Types.Base.html#EntityDef"><span class="hs-identifier hs-type">EntityDef</span></a></span><span class="hs-special">]</span><span>
</span><span id="line-80"></span><span>    </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="Database.Persist.Types.Base.html#EntityDef"><span class="hs-identifier hs-type">EntityDef</span></a></span><span>
</span><span id="line-81"></span><span>    </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="Database.Persist.Sql.Internal.html#BackendSpecificOverrides"><span class="hs-identifier hs-type">BackendSpecificOverrides</span></a></span><span>
</span><span id="line-82"></span><span>    </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-special">(</span><span class="hs-special">[</span><span class="annot"><a href="Database.Persist.Sql.Types.html#Column"><span class="hs-identifier hs-type">Column</span></a></span><span class="hs-special">]</span><span class="hs-special">,</span><span> </span><span class="hs-special">[</span><span class="annot"><a href="Database.Persist.Types.Base.html#UniqueDef"><span class="hs-identifier hs-type">UniqueDef</span></a></span><span class="hs-special">]</span><span class="hs-special">,</span><span> </span><span class="hs-special">[</span><span class="annot"><a href="Database.Persist.Types.Base.html#ForeignDef"><span class="hs-identifier hs-type">ForeignDef</span></a></span><span class="hs-special">]</span><span class="hs-special">)</span><span>
</span><span id="line-83"></span><span id="mkColumns"><span class="annot"><span class="annottext">mkColumns :: [EntityDef]
-&gt; EntityDef
-&gt; BackendSpecificOverrides
-&gt; ([Column], [UniqueDef], [ForeignDef])
</span><a href="Database.Persist.Sql.Internal.html#mkColumns"><span class="hs-identifier hs-var hs-var">mkColumns</span></a></span></span><span> </span><span id="local-6989586621679933351"><span class="annot"><span class="annottext">[EntityDef]
</span><a href="#local-6989586621679933351"><span class="hs-identifier hs-var">allDefs</span></a></span></span><span> </span><span id="local-6989586621679933350"><span class="annot"><span class="annottext">EntityDef
</span><a href="#local-6989586621679933350"><span class="hs-identifier hs-var">t</span></a></span></span><span> </span><span id="local-6989586621679933349"><span class="annot"><span class="annottext">BackendSpecificOverrides
</span><a href="#local-6989586621679933349"><span class="hs-identifier hs-var">overrides</span></a></span></span><span> </span><span class="hs-glyph">=</span><span>
</span><span id="line-84"></span><span>    </span><span class="hs-special">(</span><span class="annot"><span class="annottext">[Column]
</span><a href="#local-6989586621679933348"><span class="hs-identifier hs-var">cols</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">EntityDef -&gt; [UniqueDef]
</span><a href="Database.Persist.EntityDef.html#getEntityUniques"><span class="hs-identifier hs-var">getEntityUniques</span></a></span><span> </span><span class="annot"><span class="annottext">EntityDef
</span><a href="#local-6989586621679933350"><span class="hs-identifier hs-var">t</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">EntityDef -&gt; [ForeignDef]
</span><a href="Database.Persist.EntityDef.html#getEntityForeignDefs"><span class="hs-identifier hs-var">getEntityForeignDefs</span></a></span><span> </span><span class="annot"><span class="annottext">EntityDef
</span><a href="#local-6989586621679933350"><span class="hs-identifier hs-var">t</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-85"></span><span>  </span><span class="hs-keyword">where</span><span>
</span><span id="line-86"></span><span>    </span><span class="annot"><a href="#local-6989586621679933348"><span class="hs-identifier hs-type">cols</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="hs-special">[</span><span class="annot"><a href="Database.Persist.Sql.Types.html#Column"><span class="hs-identifier hs-type">Column</span></a></span><span class="hs-special">]</span><span>
</span><span id="line-87"></span><span>    </span><span id="local-6989586621679933348"><span class="annot"><span class="annottext">cols :: [Column]
</span><a href="#local-6989586621679933348"><span class="hs-identifier hs-var hs-var">cols</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">forall a b. (a -&gt; b) -&gt; [a] -&gt; [b]
</span><span class="hs-identifier hs-var">map</span></span><span> </span><span class="annot"><span class="annottext">FieldDef -&gt; Column
</span><a href="#local-6989586621679933345"><span class="hs-identifier hs-var">goId</span></a></span><span> </span><span class="annot"><span class="annottext">[FieldDef]
</span><a href="#local-6989586621679933344"><span class="hs-identifier hs-var">idCol</span></a></span><span> </span><span class="annot"><span class="annottext">forall a. Monoid a =&gt; a -&gt; a -&gt; a
</span><span class="hs-operator hs-var">`mappend`</span></span><span> </span><span class="annot"><span class="annottext">forall a b. (a -&gt; b) -&gt; [a] -&gt; [b]
</span><span class="hs-identifier hs-var">map</span></span><span> </span><span class="annot"><span class="annottext">FieldDef -&gt; Column
</span><a href="#local-6989586621679933343"><span class="hs-identifier hs-var">go</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">EntityDef -&gt; [FieldDef]
</span><a href="Database.Persist.EntityDef.html#getEntityFieldsDatabase"><span class="hs-identifier hs-var">getEntityFieldsDatabase</span></a></span><span> </span><span class="annot"><span class="annottext">EntityDef
</span><a href="#local-6989586621679933350"><span class="hs-identifier hs-var">t</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-88"></span><span>
</span><span id="line-89"></span><span>    </span><span class="annot"><a href="#local-6989586621679933344"><span class="hs-identifier hs-type">idCol</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="hs-special">[</span><span class="annot"><a href="Database.Persist.Types.Base.html#FieldDef"><span class="hs-identifier hs-type">FieldDef</span></a></span><span class="hs-special">]</span><span>
</span><span id="line-90"></span><span>    </span><span id="local-6989586621679933344"><span class="annot"><span class="annottext">idCol :: [FieldDef]
</span><a href="#local-6989586621679933344"><span class="hs-identifier hs-var hs-var">idCol</span></a></span></span><span> </span><span class="hs-glyph">=</span><span>
</span><span id="line-91"></span><span>        </span><span class="hs-keyword">case</span><span> </span><span class="annot"><span class="annottext">EntityDef -&gt; EntityIdDef
</span><a href="Database.Persist.EntityDef.html#getEntityId"><span class="hs-identifier hs-var">getEntityId</span></a></span><span> </span><span class="annot"><span class="annottext">EntityDef
</span><a href="#local-6989586621679933350"><span class="hs-identifier hs-var">t</span></a></span><span> </span><span class="hs-keyword">of</span><span>
</span><span id="line-92"></span><span>            </span><span class="annot"><a href="Database.Persist.Types.Base.html#EntityIdNaturalKey"><span class="hs-identifier hs-type">EntityIdNaturalKey</span></a></span><span> </span><span class="annot"><span class="annottext">CompositeDef
</span><span class="hs-identifier">_</span></span><span> </span><span class="hs-glyph">-&gt;</span><span>
</span><span id="line-93"></span><span>                </span><span class="hs-special">[</span><span class="hs-special">]</span><span>
</span><span id="line-94"></span><span>            </span><span class="annot"><a href="Database.Persist.Types.Base.html#EntityIdField"><span class="hs-identifier hs-type">EntityIdField</span></a></span><span> </span><span id="local-6989586621679933338"><span class="annot"><span class="annottext">FieldDef
</span><a href="#local-6989586621679933338"><span class="hs-identifier hs-var">fd</span></a></span></span><span> </span><span class="hs-glyph">-&gt;</span><span>
</span><span id="line-95"></span><span>                </span><span class="hs-special">[</span><span class="annot"><span class="annottext">FieldDef
</span><a href="#local-6989586621679933338"><span class="hs-identifier hs-var">fd</span></a></span><span class="hs-special">]</span><span>
</span><span id="line-96"></span><span>
</span><span id="line-97"></span><span>    </span><span class="annot"><a href="#local-6989586621679933345"><span class="hs-identifier hs-type">goId</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><a href="Database.Persist.Types.Base.html#FieldDef"><span class="hs-identifier hs-type">FieldDef</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="Database.Persist.Sql.Types.html#Column"><span class="hs-identifier hs-type">Column</span></a></span><span>
</span><span id="line-98"></span><span>    </span><span id="local-6989586621679933345"><span class="annot"><span class="annottext">goId :: FieldDef -&gt; Column
</span><a href="#local-6989586621679933345"><span class="hs-identifier hs-var hs-var">goId</span></a></span></span><span> </span><span id="local-6989586621679933337"><span class="annot"><span class="annottext">FieldDef
</span><a href="#local-6989586621679933337"><span class="hs-identifier hs-var">fd</span></a></span></span><span> </span><span class="hs-glyph">=</span><span>
</span><span id="line-99"></span><span>        </span><span class="annot"><a href="Database.Persist.Sql.Types.html#Column"><span class="hs-identifier hs-type">Column</span></a></span><span>
</span><span id="line-100"></span><span>            </span><span class="hs-special">{</span><span> </span><span class="annot"><span class="annottext">cName :: FieldNameDB
</span><a href="Database.Persist.Sql.Types.html#cName"><span class="hs-identifier hs-var">cName</span></a></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">FieldDef -&gt; FieldNameDB
</span><a href="Database.Persist.Types.Base.html#fieldDB"><span class="hs-identifier hs-var">fieldDB</span></a></span><span> </span><span class="annot"><span class="annottext">FieldDef
</span><a href="#local-6989586621679933337"><span class="hs-identifier hs-var">fd</span></a></span><span>
</span><span id="line-101"></span><span>            </span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">cNull :: Bool
</span><a href="Database.Persist.Sql.Types.html#cNull"><span class="hs-identifier hs-var">cNull</span></a></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">Bool
</span><span class="hs-identifier hs-var">False</span></span><span>
</span><span id="line-102"></span><span>            </span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">cSqlType :: SqlType
</span><a href="Database.Persist.Sql.Types.html#cSqlType"><span class="hs-identifier hs-var">cSqlType</span></a></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">FieldDef -&gt; SqlType
</span><a href="Database.Persist.Types.Base.html#fieldSqlType"><span class="hs-identifier hs-var">fieldSqlType</span></a></span><span> </span><span class="annot"><span class="annottext">FieldDef
</span><a href="#local-6989586621679933337"><span class="hs-identifier hs-var">fd</span></a></span><span>
</span><span id="line-103"></span><span>            </span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">cDefault :: Maybe Text
</span><a href="Database.Persist.Sql.Types.html#cDefault"><span class="hs-identifier hs-var">cDefault</span></a></span><span> </span><span class="hs-glyph">=</span><span>
</span><span id="line-104"></span><span>                </span><span class="hs-keyword">case</span><span> </span><span class="annot"><span class="annottext">[FieldAttr] -&gt; Maybe Text
</span><a href="Database.Persist.Sql.Internal.html#defaultAttribute"><span class="hs-identifier hs-var">defaultAttribute</span></a></span><span> </span><span class="annot"><span class="annottext">forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span> </span><span class="annot"><span class="annottext">FieldDef -&gt; [FieldAttr]
</span><a href="Database.Persist.Types.Base.html#fieldAttrs"><span class="hs-identifier hs-var">fieldAttrs</span></a></span><span> </span><span class="annot"><span class="annottext">FieldDef
</span><a href="#local-6989586621679933337"><span class="hs-identifier hs-var">fd</span></a></span><span> </span><span class="hs-keyword">of</span><span>
</span><span id="line-105"></span><span>                    </span><span class="annot"><span class="annottext">Maybe Text
</span><span class="hs-identifier hs-var">Nothing</span></span><span> </span><span class="hs-glyph">-&gt;</span><span>
</span><span id="line-106"></span><span>                        </span><span class="hs-comment">-- So this is not necessarily a problem...</span><span>
</span><span id="line-107"></span><span>                        </span><span class="hs-comment">-- because you can use eg `inserKey` to insert</span><span>
</span><span id="line-108"></span><span>                        </span><span class="hs-comment">-- a value into the database without ever asking</span><span>
</span><span id="line-109"></span><span>                        </span><span class="hs-comment">-- for a default attribute.</span><span>
</span><span id="line-110"></span><span>                        </span><span class="annot"><span class="annottext">forall a. Maybe a
</span><span class="hs-identifier hs-var">Nothing</span></span><span>
</span><span id="line-111"></span><span>                        </span><span class="hs-comment">-- But we need to be able to say &quot;Hey, if this is</span><span>
</span><span id="line-112"></span><span>                        </span><span class="hs-comment">-- an *auto generated ID column*, then I need to</span><span>
</span><span id="line-113"></span><span>                        </span><span class="hs-comment">-- specify that it has the default serial picking</span><span>
</span><span id="line-114"></span><span>                        </span><span class="hs-comment">-- behavior for whatever SQL backend this is using.</span><span>
</span><span id="line-115"></span><span>                        </span><span class="hs-comment">-- Because naturally MySQL, Postgres, MSSQL, etc</span><span>
</span><span id="line-116"></span><span>                        </span><span class="hs-comment">-- all do ths differently, sigh.</span><span>
</span><span id="line-117"></span><span>                        </span><span class="hs-comment">-- Really, this should be something like,</span><span>
</span><span id="line-118"></span><span>                        </span><span class="hs-comment">--</span><span>
</span><span id="line-119"></span><span>                        </span><span class="hs-comment">-- &gt; data ColumnDefault</span><span>
</span><span id="line-120"></span><span>                        </span><span class="hs-comment">-- &gt;     = Custom Text</span><span>
</span><span id="line-121"></span><span>                        </span><span class="hs-comment">-- &gt;     | AutogenerateId</span><span>
</span><span id="line-122"></span><span>                        </span><span class="hs-comment">-- &gt;     | NoDefault</span><span>
</span><span id="line-123"></span><span>                        </span><span class="hs-comment">--</span><span>
</span><span id="line-124"></span><span>                        </span><span class="hs-comment">-- where Autogenerated is determined by the</span><span>
</span><span id="line-125"></span><span>                        </span><span class="hs-comment">-- MkPersistSettings.</span><span>
</span><span id="line-126"></span><span>                    </span><span class="annot"><span class="hs-identifier hs-type">Just</span></span><span> </span><span id="local-6989586621679933328"><span class="annot"><span class="annottext">Text
</span><a href="#local-6989586621679933328"><span class="hs-identifier hs-var">def</span></a></span></span><span> </span><span class="hs-glyph">-&gt;</span><span>
</span><span id="line-127"></span><span>                        </span><span class="annot"><span class="annottext">forall a. a -&gt; Maybe a
</span><span class="hs-identifier hs-var">Just</span></span><span> </span><span class="annot"><span class="annottext">Text
</span><a href="#local-6989586621679933328"><span class="hs-identifier hs-var">def</span></a></span><span>
</span><span id="line-128"></span><span>
</span><span id="line-129"></span><span>            </span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">cGenerated :: Maybe Text
</span><a href="Database.Persist.Sql.Types.html#cGenerated"><span class="hs-identifier hs-var">cGenerated</span></a></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">FieldDef -&gt; Maybe Text
</span><a href="Database.Persist.Types.Base.html#fieldGenerated"><span class="hs-identifier hs-var">fieldGenerated</span></a></span><span> </span><span class="annot"><span class="annottext">FieldDef
</span><a href="#local-6989586621679933337"><span class="hs-identifier hs-var">fd</span></a></span><span>
</span><span id="line-130"></span><span>            </span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">cDefaultConstraintName :: Maybe ConstraintNameDB
</span><a href="Database.Persist.Sql.Types.html#cDefaultConstraintName"><span class="hs-identifier hs-var">cDefaultConstraintName</span></a></span><span> </span><span class="hs-glyph">=</span><span>  </span><span class="annot"><span class="annottext">forall a. Maybe a
</span><span class="hs-identifier hs-var">Nothing</span></span><span>
</span><span id="line-131"></span><span>            </span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">cMaxLen :: Maybe Integer
</span><a href="Database.Persist.Sql.Types.html#cMaxLen"><span class="hs-identifier hs-var">cMaxLen</span></a></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">[FieldAttr] -&gt; Maybe Integer
</span><a href="#local-6989586621679933323"><span class="hs-identifier hs-var">maxLen</span></a></span><span> </span><span class="annot"><span class="annottext">forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span> </span><span class="annot"><span class="annottext">FieldDef -&gt; [FieldAttr]
</span><a href="Database.Persist.Types.Base.html#fieldAttrs"><span class="hs-identifier hs-var">fieldAttrs</span></a></span><span> </span><span class="annot"><span class="annottext">FieldDef
</span><a href="#local-6989586621679933337"><span class="hs-identifier hs-var">fd</span></a></span><span>
</span><span id="line-132"></span><span>            </span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">cReference :: Maybe ColumnReference
</span><a href="Database.Persist.Sql.Types.html#cReference"><span class="hs-identifier hs-var">cReference</span></a></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">FieldDef -&gt; Maybe ColumnReference
</span><a href="#local-6989586621679933321"><span class="hs-identifier hs-var">mkColumnReference</span></a></span><span> </span><span class="annot"><span class="annottext">FieldDef
</span><a href="#local-6989586621679933337"><span class="hs-identifier hs-var">fd</span></a></span><span>
</span><span id="line-133"></span><span>            </span><span class="hs-special">}</span><span>
</span><span id="line-134"></span><span>
</span><span id="line-135"></span><span>    </span><span class="annot"><a href="#local-6989586621679933320"><span class="hs-identifier hs-type">tableName</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><a href="Database.Persist.Names.html#EntityNameDB"><span class="hs-identifier hs-type">EntityNameDB</span></a></span><span>
</span><span id="line-136"></span><span>    </span><span id="local-6989586621679933320"><span class="annot"><span class="annottext">tableName :: EntityNameDB
</span><a href="#local-6989586621679933320"><span class="hs-identifier hs-var hs-var">tableName</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">EntityDef -&gt; EntityNameDB
</span><a href="Database.Persist.EntityDef.html#getEntityDBName"><span class="hs-identifier hs-var">getEntityDBName</span></a></span><span> </span><span class="annot"><span class="annottext">EntityDef
</span><a href="#local-6989586621679933350"><span class="hs-identifier hs-var">t</span></a></span><span>
</span><span id="line-137"></span><span>
</span><span id="line-138"></span><span>    </span><span class="annot"><a href="#local-6989586621679933343"><span class="hs-identifier hs-type">go</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><a href="Database.Persist.Types.Base.html#FieldDef"><span class="hs-identifier hs-type">FieldDef</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="Database.Persist.Sql.Types.html#Column"><span class="hs-identifier hs-type">Column</span></a></span><span>
</span><span id="line-139"></span><span>    </span><span id="local-6989586621679933343"><span class="annot"><span class="annottext">go :: FieldDef -&gt; Column
</span><a href="#local-6989586621679933343"><span class="hs-identifier hs-var hs-var">go</span></a></span></span><span> </span><span id="local-6989586621679933318"><span class="annot"><span class="annottext">FieldDef
</span><a href="#local-6989586621679933318"><span class="hs-identifier hs-var">fd</span></a></span></span><span> </span><span class="hs-glyph">=</span><span>
</span><span id="line-140"></span><span>        </span><span class="annot"><a href="Database.Persist.Sql.Types.html#Column"><span class="hs-identifier hs-type">Column</span></a></span><span>
</span><span id="line-141"></span><span>            </span><span class="hs-special">{</span><span> </span><span class="annot"><span class="annottext">cName :: FieldNameDB
</span><a href="Database.Persist.Sql.Types.html#cName"><span class="hs-identifier hs-var">cName</span></a></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">FieldDef -&gt; FieldNameDB
</span><a href="Database.Persist.Types.Base.html#fieldDB"><span class="hs-identifier hs-var">fieldDB</span></a></span><span> </span><span class="annot"><span class="annottext">FieldDef
</span><a href="#local-6989586621679933318"><span class="hs-identifier hs-var">fd</span></a></span><span>
</span><span id="line-142"></span><span>            </span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">cNull :: Bool
</span><a href="Database.Persist.Sql.Types.html#cNull"><span class="hs-identifier hs-var">cNull</span></a></span><span> </span><span class="hs-glyph">=</span><span>
</span><span id="line-143"></span><span>                </span><span class="hs-keyword">case</span><span> </span><span class="annot"><span class="annottext">FieldDef -&gt; IsNullable
</span><a href="Database.Persist.FieldDef.html#isFieldNullable"><span class="hs-identifier hs-var">isFieldNullable</span></a></span><span> </span><span class="annot"><span class="annottext">FieldDef
</span><a href="#local-6989586621679933318"><span class="hs-identifier hs-var">fd</span></a></span><span> </span><span class="hs-keyword">of</span><span>
</span><span id="line-144"></span><span>                    </span><span class="annot"><a href="Database.Persist.Types.Base.html#Nullable"><span class="hs-identifier hs-type">Nullable</span></a></span><span> </span><span class="annot"><span class="annottext">WhyNullable
</span><span class="hs-identifier">_</span></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="annottext">Bool
</span><span class="hs-identifier hs-var">True</span></span><span>
</span><span id="line-145"></span><span>                    </span><span class="annot"><span class="annottext">IsNullable
</span><a href="Database.Persist.Types.Base.html#NotNullable"><span class="hs-identifier hs-var">NotNullable</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="annottext">FieldDef -&gt; Bool
</span><a href="Database.Persist.FieldDef.html#isFieldMaybe"><span class="hs-identifier hs-var">isFieldMaybe</span></a></span><span> </span><span class="annot"><span class="annottext">FieldDef
</span><a href="#local-6989586621679933318"><span class="hs-identifier hs-var">fd</span></a></span><span> </span><span class="annot"><span class="annottext">Bool -&gt; Bool -&gt; Bool
</span><span class="hs-operator hs-var">||</span></span><span> </span><span class="annot"><span class="annottext">EntityDef -&gt; Bool
</span><a href="Database.Persist.EntityDef.html#isEntitySum"><span class="hs-identifier hs-var">isEntitySum</span></a></span><span> </span><span class="annot"><span class="annottext">EntityDef
</span><a href="#local-6989586621679933350"><span class="hs-identifier hs-var">t</span></a></span><span>
</span><span id="line-146"></span><span>            </span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">cSqlType :: SqlType
</span><a href="Database.Persist.Sql.Types.html#cSqlType"><span class="hs-identifier hs-var">cSqlType</span></a></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">FieldDef -&gt; SqlType
</span><a href="Database.Persist.Types.Base.html#fieldSqlType"><span class="hs-identifier hs-var">fieldSqlType</span></a></span><span> </span><span class="annot"><span class="annottext">FieldDef
</span><a href="#local-6989586621679933318"><span class="hs-identifier hs-var">fd</span></a></span><span>
</span><span id="line-147"></span><span>            </span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">cDefault :: Maybe Text
</span><a href="Database.Persist.Sql.Types.html#cDefault"><span class="hs-identifier hs-var">cDefault</span></a></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">[FieldAttr] -&gt; Maybe Text
</span><a href="Database.Persist.Sql.Internal.html#defaultAttribute"><span class="hs-identifier hs-var">defaultAttribute</span></a></span><span> </span><span class="annot"><span class="annottext">forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span> </span><span class="annot"><span class="annottext">FieldDef -&gt; [FieldAttr]
</span><a href="Database.Persist.Types.Base.html#fieldAttrs"><span class="hs-identifier hs-var">fieldAttrs</span></a></span><span> </span><span class="annot"><span class="annottext">FieldDef
</span><a href="#local-6989586621679933318"><span class="hs-identifier hs-var">fd</span></a></span><span>
</span><span id="line-148"></span><span>            </span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">cGenerated :: Maybe Text
</span><a href="Database.Persist.Sql.Types.html#cGenerated"><span class="hs-identifier hs-var">cGenerated</span></a></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">FieldDef -&gt; Maybe Text
</span><a href="Database.Persist.Types.Base.html#fieldGenerated"><span class="hs-identifier hs-var">fieldGenerated</span></a></span><span> </span><span class="annot"><span class="annottext">FieldDef
</span><a href="#local-6989586621679933318"><span class="hs-identifier hs-var">fd</span></a></span><span>
</span><span id="line-149"></span><span>            </span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">cDefaultConstraintName :: Maybe ConstraintNameDB
</span><a href="Database.Persist.Sql.Types.html#cDefaultConstraintName"><span class="hs-identifier hs-var">cDefaultConstraintName</span></a></span><span> </span><span class="hs-glyph">=</span><span>  </span><span class="annot"><span class="annottext">forall a. Maybe a
</span><span class="hs-identifier hs-var">Nothing</span></span><span>
</span><span id="line-150"></span><span>            </span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">cMaxLen :: Maybe Integer
</span><a href="Database.Persist.Sql.Types.html#cMaxLen"><span class="hs-identifier hs-var">cMaxLen</span></a></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">[FieldAttr] -&gt; Maybe Integer
</span><a href="#local-6989586621679933323"><span class="hs-identifier hs-var">maxLen</span></a></span><span> </span><span class="annot"><span class="annottext">forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span> </span><span class="annot"><span class="annottext">FieldDef -&gt; [FieldAttr]
</span><a href="Database.Persist.Types.Base.html#fieldAttrs"><span class="hs-identifier hs-var">fieldAttrs</span></a></span><span> </span><span class="annot"><span class="annottext">FieldDef
</span><a href="#local-6989586621679933318"><span class="hs-identifier hs-var">fd</span></a></span><span>
</span><span id="line-151"></span><span>            </span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">cReference :: Maybe ColumnReference
</span><a href="Database.Persist.Sql.Types.html#cReference"><span class="hs-identifier hs-var">cReference</span></a></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">FieldDef -&gt; Maybe ColumnReference
</span><a href="#local-6989586621679933321"><span class="hs-identifier hs-var">mkColumnReference</span></a></span><span> </span><span class="annot"><span class="annottext">FieldDef
</span><a href="#local-6989586621679933318"><span class="hs-identifier hs-var">fd</span></a></span><span>
</span><span id="line-152"></span><span>            </span><span class="hs-special">}</span><span>
</span><span id="line-153"></span><span>
</span><span id="line-154"></span><span>    </span><span class="annot"><a href="#local-6989586621679933323"><span class="hs-identifier hs-type">maxLen</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="hs-special">[</span><span class="annot"><a href="Database.Persist.Types.Base.html#FieldAttr"><span class="hs-identifier hs-type">FieldAttr</span></a></span><span class="hs-special">]</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="hs-identifier hs-type">Maybe</span></span><span> </span><span class="annot"><span class="hs-identifier hs-type">Integer</span></span><span>
</span><span id="line-155"></span><span>    </span><span id="local-6989586621679933323"><span class="annot"><span class="annottext">maxLen :: [FieldAttr] -&gt; Maybe Integer
</span><a href="#local-6989586621679933323"><span class="hs-identifier hs-var hs-var">maxLen</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">forall a b. (a -&gt; Maybe b) -&gt; [a] -&gt; Maybe b
</span><a href="Database.Persist.Sql.Internal.html#findMaybe"><span class="hs-identifier hs-var">findMaybe</span></a></span><span> </span><span class="annot"><span class="annottext">forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span> </span><span class="hs-glyph">\</span><span class="hs-glyph">case</span><span>
</span><span id="line-156"></span><span>        </span><span class="annot"><a href="Database.Persist.Types.Base.html#FieldAttrMaxlen"><span class="hs-identifier hs-type">FieldAttrMaxlen</span></a></span><span> </span><span id="local-6989586621679933310"><span class="annot"><span class="annottext">Integer
</span><a href="#local-6989586621679933310"><span class="hs-identifier hs-var">n</span></a></span></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="annottext">forall a. a -&gt; Maybe a
</span><span class="hs-identifier hs-var">Just</span></span><span> </span><span class="annot"><span class="annottext">Integer
</span><a href="#local-6989586621679933310"><span class="hs-identifier hs-var">n</span></a></span><span>
</span><span id="line-157"></span><span>        </span><span class="annot"><span class="annottext">FieldAttr
</span><span class="hs-identifier">_</span></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="annottext">forall a. Maybe a
</span><span class="hs-identifier hs-var">Nothing</span></span><span>
</span><span id="line-158"></span><span>
</span><span id="line-159"></span><span>    </span><span id="local-6989586621679933309"><span class="annot"><span class="annottext">refNameFn :: EntityNameDB -&gt; FieldNameDB -&gt; ConstraintNameDB
</span><a href="#local-6989586621679933309"><span class="hs-identifier hs-var hs-var">refNameFn</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">forall a. a -&gt; Maybe a -&gt; a
</span><span class="hs-identifier hs-var">fromMaybe</span></span><span> </span><span class="annot"><span class="annottext">EntityNameDB -&gt; FieldNameDB -&gt; ConstraintNameDB
</span><a href="Database.Persist.Sql.Internal.html#refName"><span class="hs-identifier hs-var">refName</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">BackendSpecificOverrides
-&gt; Maybe (EntityNameDB -&gt; FieldNameDB -&gt; ConstraintNameDB)
</span><a href="Database.Persist.Sql.Internal.html#backendSpecificForeignKeyName"><span class="hs-identifier hs-var">backendSpecificForeignKeyName</span></a></span><span> </span><span class="annot"><span class="annottext">BackendSpecificOverrides
</span><a href="#local-6989586621679933349"><span class="hs-identifier hs-var">overrides</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-160"></span><span>
</span><span id="line-161"></span><span>    </span><span class="annot"><a href="#local-6989586621679933321"><span class="hs-identifier hs-type">mkColumnReference</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><a href="Database.Persist.Types.Base.html#FieldDef"><span class="hs-identifier hs-type">FieldDef</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="hs-identifier hs-type">Maybe</span></span><span> </span><span class="annot"><a href="Database.Persist.Sql.Types.html#ColumnReference"><span class="hs-identifier hs-type">ColumnReference</span></a></span><span>
</span><span id="line-162"></span><span>    </span><span id="local-6989586621679933321"><span class="annot"><span class="annottext">mkColumnReference :: FieldDef -&gt; Maybe ColumnReference
</span><a href="#local-6989586621679933321"><span class="hs-identifier hs-var hs-var">mkColumnReference</span></a></span></span><span> </span><span id="local-6989586621679933307"><span class="annot"><span class="annottext">FieldDef
</span><a href="#local-6989586621679933307"><span class="hs-identifier hs-var">fd</span></a></span></span><span> </span><span class="hs-glyph">=</span><span>
</span><span id="line-163"></span><span>        </span><span class="annot"><span class="annottext">forall (f :: * -&gt; *) a b. Functor f =&gt; (a -&gt; b) -&gt; f a -&gt; f b
</span><span class="hs-identifier hs-var">fmap</span></span><span>
</span><span id="line-164"></span><span>            </span><span class="hs-special">(</span><span class="hs-glyph">\</span><span class="hs-special">(</span><span id="local-6989586621679933306"><span class="annot"><span class="annottext">EntityNameDB
</span><a href="#local-6989586621679933306"><span class="hs-identifier hs-var">tName</span></a></span></span><span class="hs-special">,</span><span> </span><span id="local-6989586621679933305"><span class="annot"><span class="annottext">ConstraintNameDB
</span><a href="#local-6989586621679933305"><span class="hs-identifier hs-var">cName</span></a></span></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">-&gt;</span><span>
</span><span id="line-165"></span><span>                </span><span class="annot"><span class="annottext">EntityNameDB -&gt; ConstraintNameDB -&gt; FieldCascade -&gt; ColumnReference
</span><a href="Database.Persist.Sql.Types.html#ColumnReference"><span class="hs-identifier hs-var">ColumnReference</span></a></span><span> </span><span class="annot"><span class="annottext">EntityNameDB
</span><a href="#local-6989586621679933306"><span class="hs-identifier hs-var">tName</span></a></span><span> </span><span class="annot"><span class="annottext">ConstraintNameDB
</span><a href="#local-6989586621679933305"><span class="hs-identifier hs-var">cName</span></a></span><span> </span><span class="annot"><span class="annottext">forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span> </span><span class="annot"><span class="annottext">FieldCascade -&gt; FieldCascade
</span><a href="#local-6989586621679933303"><span class="hs-identifier hs-var">overrideNothings</span></a></span><span> </span><span class="annot"><span class="annottext">forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span> </span><span class="annot"><span class="annottext">FieldDef -&gt; FieldCascade
</span><a href="Database.Persist.Types.Base.html#fieldCascade"><span class="hs-identifier hs-var">fieldCascade</span></a></span><span> </span><span class="annot"><span class="annottext">FieldDef
</span><a href="#local-6989586621679933307"><span class="hs-identifier hs-var">fd</span></a></span><span>
</span><span id="line-166"></span><span>            </span><span class="hs-special">)</span><span>
</span><span id="line-167"></span><span>        </span><span class="annot"><span class="annottext">forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span> </span><span class="annot"><span class="annottext">FieldNameDB
-&gt; ReferenceDef
-&gt; [FieldAttr]
-&gt; Maybe (EntityNameDB, ConstraintNameDB)
</span><a href="#local-6989586621679933301"><span class="hs-identifier hs-var">ref</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">FieldDef -&gt; FieldNameDB
</span><a href="Database.Persist.Types.Base.html#fieldDB"><span class="hs-identifier hs-var">fieldDB</span></a></span><span> </span><span class="annot"><span class="annottext">FieldDef
</span><a href="#local-6989586621679933307"><span class="hs-identifier hs-var">fd</span></a></span><span class="hs-special">)</span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">FieldDef -&gt; ReferenceDef
</span><a href="Database.Persist.Types.Base.html#fieldReference"><span class="hs-identifier hs-var">fieldReference</span></a></span><span> </span><span class="annot"><span class="annottext">FieldDef
</span><a href="#local-6989586621679933307"><span class="hs-identifier hs-var">fd</span></a></span><span class="hs-special">)</span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">FieldDef -&gt; [FieldAttr]
</span><a href="Database.Persist.Types.Base.html#fieldAttrs"><span class="hs-identifier hs-var">fieldAttrs</span></a></span><span> </span><span class="annot"><span class="annottext">FieldDef
</span><a href="#local-6989586621679933307"><span class="hs-identifier hs-var">fd</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-168"></span><span>
</span><span id="line-169"></span><span>    </span><span class="hs-comment">-- a 'Nothing' in the definition means that the QQ migration doesn't</span><span>
</span><span id="line-170"></span><span>    </span><span class="hs-comment">-- specify behavior. the default is RESTRICT. setting this here</span><span>
</span><span id="line-171"></span><span>    </span><span class="hs-comment">-- explicitly makes migrations run smoother.</span><span>
</span><span id="line-172"></span><span>    </span><span id="local-6989586621679933303"><span class="annot"><span class="annottext">overrideNothings :: FieldCascade -&gt; FieldCascade
</span><a href="#local-6989586621679933303"><span class="hs-identifier hs-var hs-var">overrideNothings</span></a></span></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="Database.Persist.Types.Base.html#FieldCascade"><span class="hs-identifier hs-type">FieldCascade</span></a></span><span> </span><span class="hs-special">{</span><span> </span><span class="annot"><span class="annottext">fcOnUpdate :: FieldCascade -&gt; Maybe CascadeAction
</span><a href="Database.Persist.Types.Base.html#fcOnUpdate"><span class="hs-identifier hs-var">fcOnUpdate</span></a></span><span> </span><span class="hs-glyph">=</span><span> </span><span id="local-6989586621679933294"><span class="annot"><span class="annottext">Maybe CascadeAction
</span><a href="#local-6989586621679933294"><span class="hs-identifier hs-var">upd</span></a></span></span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">fcOnDelete :: FieldCascade -&gt; Maybe CascadeAction
</span><a href="Database.Persist.Types.Base.html#fcOnDelete"><span class="hs-identifier hs-var">fcOnDelete</span></a></span><span> </span><span class="hs-glyph">=</span><span> </span><span id="local-6989586621679933292"><span class="annot"><span class="annottext">Maybe CascadeAction
</span><a href="#local-6989586621679933292"><span class="hs-identifier hs-var">del</span></a></span></span><span> </span><span class="hs-special">}</span><span class="hs-special">)</span><span> </span><span class="hs-glyph">=</span><span>
</span><span id="line-173"></span><span>        </span><span class="annot"><a href="Database.Persist.Types.Base.html#FieldCascade"><span class="hs-identifier hs-type">FieldCascade</span></a></span><span>
</span><span id="line-174"></span><span>            </span><span class="hs-special">{</span><span> </span><span class="annot"><span class="annottext">fcOnUpdate :: Maybe CascadeAction
</span><a href="Database.Persist.Types.Base.html#fcOnUpdate"><span class="hs-identifier hs-var">fcOnUpdate</span></a></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">Maybe CascadeAction
</span><a href="#local-6989586621679933294"><span class="hs-identifier hs-var">upd</span></a></span><span> </span><span class="annot"><span class="annottext">forall (f :: * -&gt; *) a. Alternative f =&gt; f a -&gt; f a -&gt; f a
</span><span class="hs-operator hs-var">&lt;|&gt;</span></span><span> </span><span class="annot"><span class="annottext">forall a. a -&gt; Maybe a
</span><span class="hs-identifier hs-var">Just</span></span><span> </span><span class="annot"><span class="annottext">CascadeAction
</span><a href="Database.Persist.Types.Base.html#Restrict"><span class="hs-identifier hs-var">Restrict</span></a></span><span>
</span><span id="line-175"></span><span>            </span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">fcOnDelete :: Maybe CascadeAction
</span><a href="Database.Persist.Types.Base.html#fcOnDelete"><span class="hs-identifier hs-var">fcOnDelete</span></a></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">Maybe CascadeAction
</span><a href="#local-6989586621679933292"><span class="hs-identifier hs-var">del</span></a></span><span> </span><span class="annot"><span class="annottext">forall (f :: * -&gt; *) a. Alternative f =&gt; f a -&gt; f a -&gt; f a
</span><span class="hs-operator hs-var">&lt;|&gt;</span></span><span> </span><span class="annot"><span class="annottext">forall a. a -&gt; Maybe a
</span><span class="hs-identifier hs-var">Just</span></span><span> </span><span class="annot"><span class="annottext">CascadeAction
</span><a href="Database.Persist.Types.Base.html#Restrict"><span class="hs-identifier hs-var">Restrict</span></a></span><span>
</span><span id="line-176"></span><span>            </span><span class="hs-special">}</span><span>
</span><span id="line-177"></span><span>
</span><span id="line-178"></span><span>    </span><span class="annot"><a href="#local-6989586621679933301"><span class="hs-identifier hs-type">ref</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><a href="Database.Persist.Names.html#FieldNameDB"><span class="hs-identifier hs-type">FieldNameDB</span></a></span><span>
</span><span id="line-179"></span><span>        </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="Database.Persist.Types.Base.html#ReferenceDef"><span class="hs-identifier hs-type">ReferenceDef</span></a></span><span>
</span><span id="line-180"></span><span>        </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-special">[</span><span class="annot"><a href="Database.Persist.Types.Base.html#FieldAttr"><span class="hs-identifier hs-type">FieldAttr</span></a></span><span class="hs-special">]</span><span>
</span><span id="line-181"></span><span>        </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="hs-identifier hs-type">Maybe</span></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="Database.Persist.Names.html#EntityNameDB"><span class="hs-identifier hs-type">EntityNameDB</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><a href="Database.Persist.Names.html#ConstraintNameDB"><span class="hs-identifier hs-type">ConstraintNameDB</span></a></span><span class="hs-special">)</span><span> </span><span class="hs-comment">-- table name, constraint name</span><span>
</span><span id="line-182"></span><span>    </span><span id="local-6989586621679933301"><span class="annot"><span class="annottext">ref :: FieldNameDB
-&gt; ReferenceDef
-&gt; [FieldAttr]
-&gt; Maybe (EntityNameDB, ConstraintNameDB)
</span><a href="#local-6989586621679933301"><span class="hs-identifier hs-var hs-var">ref</span></a></span></span><span> </span><span id="local-6989586621679933290"><span class="annot"><span class="annottext">FieldNameDB
</span><a href="#local-6989586621679933290"><span class="hs-identifier hs-var">c</span></a></span></span><span> </span><span id="local-6989586621679933289"><span class="annot"><span class="annottext">ReferenceDef
</span><a href="#local-6989586621679933289"><span class="hs-identifier hs-var">fe</span></a></span></span><span> </span><span class="hs-special">[</span><span class="hs-special">]</span><span>
</span><span id="line-183"></span><span>        </span><span class="hs-glyph">|</span><span> </span><span class="annot"><a href="Database.Persist.Types.Base.html#ForeignRef"><span class="hs-identifier hs-type">ForeignRef</span></a></span><span> </span><span id="local-6989586621679933287"><span class="annot"><span class="annottext">EntityNameHS
</span><a href="#local-6989586621679933287"><span class="hs-identifier hs-var">f</span></a></span></span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">ReferenceDef
</span><a href="#local-6989586621679933289"><span class="hs-identifier hs-var">fe</span></a></span><span> </span><span class="hs-glyph">=</span><span>
</span><span id="line-184"></span><span>            </span><span class="annot"><span class="annottext">forall a. a -&gt; Maybe a
</span><span class="hs-identifier hs-var">Just</span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">[EntityDef] -&gt; EntityNameHS -&gt; EntityNameDB
</span><a href="Database.Persist.Sql.Internal.html#resolveTableName"><span class="hs-identifier hs-var">resolveTableName</span></a></span><span> </span><span class="annot"><span class="annottext">[EntityDef]
</span><a href="#local-6989586621679933351"><span class="hs-identifier hs-var">allDefs</span></a></span><span> </span><span class="annot"><span class="annottext">EntityNameHS
</span><a href="#local-6989586621679933287"><span class="hs-identifier hs-var">f</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">EntityNameDB -&gt; FieldNameDB -&gt; ConstraintNameDB
</span><a href="#local-6989586621679933309"><span class="hs-identifier hs-var">refNameFn</span></a></span><span> </span><span class="annot"><span class="annottext">EntityNameDB
</span><a href="#local-6989586621679933320"><span class="hs-identifier hs-var">tableName</span></a></span><span> </span><span class="annot"><span class="annottext">FieldNameDB
</span><a href="#local-6989586621679933290"><span class="hs-identifier hs-var">c</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-185"></span><span>        </span><span class="hs-glyph">|</span><span> </span><span class="annot"><span class="annottext">Bool
</span><span class="hs-identifier hs-var">otherwise</span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">forall a. Maybe a
</span><span class="hs-identifier hs-var">Nothing</span></span><span>
</span><span id="line-186"></span><span>    </span><span class="annot"><a href="#local-6989586621679933301"><span class="hs-identifier hs-var">ref</span></a></span><span> </span><span class="annot"><span class="annottext">FieldNameDB
</span><span class="hs-identifier">_</span></span><span> </span><span class="annot"><span class="annottext">ReferenceDef
</span><span class="hs-identifier">_</span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">FieldAttr
</span><a href="Database.Persist.Types.Base.html#FieldAttrNoreference"><span class="hs-identifier hs-var">FieldAttrNoreference</span></a></span><span class="annot"><span class="hs-glyph hs-type">:</span></span><span class="annot"><span class="annottext">[FieldAttr]
</span><span class="hs-identifier">_</span></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">forall a. Maybe a
</span><span class="hs-identifier hs-var">Nothing</span></span><span>
</span><span id="line-187"></span><span>    </span><span class="annot"><a href="#local-6989586621679933301"><span class="hs-identifier hs-var">ref</span></a></span><span> </span><span id="local-6989586621679933284"><span class="annot"><span class="annottext">FieldNameDB
</span><a href="#local-6989586621679933284"><span class="hs-identifier hs-var">c</span></a></span></span><span> </span><span id="local-6989586621679933283"><span class="annot"><span class="annottext">ReferenceDef
</span><a href="#local-6989586621679933283"><span class="hs-identifier hs-var">fe</span></a></span></span><span> </span><span class="hs-special">(</span><span id="local-6989586621679933282"><span class="annot"><span class="annottext">FieldAttr
</span><a href="#local-6989586621679933282"><span class="hs-identifier hs-var">a</span></a></span></span><span class="annot"><span class="hs-glyph hs-type">:</span></span><span id="local-6989586621679933281"><span class="annot"><span class="annottext">[FieldAttr]
</span><a href="#local-6989586621679933281"><span class="hs-keyword hs-var">as</span></a></span></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-keyword">case</span><span> </span><span class="annot"><span class="annottext">FieldAttr
</span><a href="#local-6989586621679933282"><span class="hs-identifier hs-var">a</span></a></span><span> </span><span class="hs-keyword">of</span><span>
</span><span id="line-188"></span><span>        </span><span class="annot"><a href="Database.Persist.Types.Base.html#FieldAttrReference"><span class="hs-identifier hs-type">FieldAttrReference</span></a></span><span> </span><span id="local-6989586621679933279"><span class="annot"><span class="annottext">Text
</span><a href="#local-6989586621679933279"><span class="hs-identifier hs-var">x</span></a></span></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-keyword">do</span><span>
</span><span id="line-189"></span><span>            </span><span class="hs-special">(</span><span class="annot"><span class="annottext">EntityNameDB
</span><span class="hs-identifier">_</span></span><span class="hs-special">,</span><span> </span><span id="local-6989586621679933278"><span class="annot"><span class="annottext">ConstraintNameDB
</span><a href="#local-6989586621679933278"><span class="hs-identifier hs-var">constraintName</span></a></span></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">FieldNameDB
-&gt; ReferenceDef
-&gt; [FieldAttr]
-&gt; Maybe (EntityNameDB, ConstraintNameDB)
</span><a href="#local-6989586621679933301"><span class="hs-identifier hs-var">ref</span></a></span><span> </span><span class="annot"><span class="annottext">FieldNameDB
</span><a href="#local-6989586621679933284"><span class="hs-identifier hs-var">c</span></a></span><span> </span><span class="annot"><span class="annottext">ReferenceDef
</span><a href="#local-6989586621679933283"><span class="hs-identifier hs-var">fe</span></a></span><span> </span><span class="annot"><span class="annottext">[FieldAttr]
</span><a href="#local-6989586621679933281"><span class="hs-keyword hs-var">as</span></a></span><span>
</span><span id="line-190"></span><span>            </span><span class="annot"><span class="annottext">forall (f :: * -&gt; *) a. Applicative f =&gt; a -&gt; f a
</span><span class="hs-identifier hs-var">pure</span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Text -&gt; EntityNameDB
</span><a href="Database.Persist.Names.html#EntityNameDB"><span class="hs-identifier hs-var">EntityNameDB</span></a></span><span>  </span><span class="annot"><span class="annottext">Text
</span><a href="#local-6989586621679933279"><span class="hs-identifier hs-var">x</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">ConstraintNameDB
</span><a href="#local-6989586621679933278"><span class="hs-identifier hs-var">constraintName</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-191"></span><span>        </span><span class="annot"><a href="Database.Persist.Types.Base.html#FieldAttrConstraint"><span class="hs-identifier hs-type">FieldAttrConstraint</span></a></span><span> </span><span id="local-6989586621679933275"><span class="annot"><span class="annottext">Text
</span><a href="#local-6989586621679933275"><span class="hs-identifier hs-var">x</span></a></span></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-keyword">do</span><span>
</span><span id="line-192"></span><span>            </span><span class="hs-special">(</span><span id="local-6989586621679933274"><span class="annot"><span class="annottext">EntityNameDB
</span><a href="#local-6989586621679933274"><span class="hs-identifier hs-var">tableName_</span></a></span></span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">ConstraintNameDB
</span><span class="hs-identifier">_</span></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">FieldNameDB
-&gt; ReferenceDef
-&gt; [FieldAttr]
-&gt; Maybe (EntityNameDB, ConstraintNameDB)
</span><a href="#local-6989586621679933301"><span class="hs-identifier hs-var">ref</span></a></span><span> </span><span class="annot"><span class="annottext">FieldNameDB
</span><a href="#local-6989586621679933284"><span class="hs-identifier hs-var">c</span></a></span><span> </span><span class="annot"><span class="annottext">ReferenceDef
</span><a href="#local-6989586621679933283"><span class="hs-identifier hs-var">fe</span></a></span><span> </span><span class="annot"><span class="annottext">[FieldAttr]
</span><a href="#local-6989586621679933281"><span class="hs-keyword hs-var">as</span></a></span><span>
</span><span id="line-193"></span><span>            </span><span class="annot"><span class="annottext">forall (f :: * -&gt; *) a. Applicative f =&gt; a -&gt; f a
</span><span class="hs-identifier hs-var">pure</span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">EntityNameDB
</span><a href="#local-6989586621679933274"><span class="hs-identifier hs-var">tableName_</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">Text -&gt; ConstraintNameDB
</span><a href="Database.Persist.Names.html#ConstraintNameDB"><span class="hs-identifier hs-var">ConstraintNameDB</span></a></span><span> </span><span class="annot"><span class="annottext">Text
</span><a href="#local-6989586621679933275"><span class="hs-identifier hs-var">x</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-194"></span><span>        </span><span class="annot"><span class="annottext">FieldAttr
</span><span class="hs-identifier">_</span></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="annottext">FieldNameDB
-&gt; ReferenceDef
-&gt; [FieldAttr]
-&gt; Maybe (EntityNameDB, ConstraintNameDB)
</span><a href="#local-6989586621679933301"><span class="hs-identifier hs-var">ref</span></a></span><span> </span><span class="annot"><span class="annottext">FieldNameDB
</span><a href="#local-6989586621679933284"><span class="hs-identifier hs-var">c</span></a></span><span> </span><span class="annot"><span class="annottext">ReferenceDef
</span><a href="#local-6989586621679933283"><span class="hs-identifier hs-var">fe</span></a></span><span> </span><span class="annot"><span class="annottext">[FieldAttr]
</span><a href="#local-6989586621679933281"><span class="hs-keyword hs-var">as</span></a></span><span>
</span><span id="line-195"></span><span>
</span><span id="line-196"></span><span class="annot"><a href="Database.Persist.Sql.Internal.html#refName"><span class="hs-identifier hs-type">refName</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><a href="Database.Persist.Names.html#EntityNameDB"><span class="hs-identifier hs-type">EntityNameDB</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="Database.Persist.Names.html#FieldNameDB"><span class="hs-identifier hs-type">FieldNameDB</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="Database.Persist.Names.html#ConstraintNameDB"><span class="hs-identifier hs-type">ConstraintNameDB</span></a></span><span>
</span><span id="line-197"></span><span id="refName"><span class="annot"><span class="annottext">refName :: EntityNameDB -&gt; FieldNameDB -&gt; ConstraintNameDB
</span><a href="Database.Persist.Sql.Internal.html#refName"><span class="hs-identifier hs-var hs-var">refName</span></a></span></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="Database.Persist.Names.html#EntityNameDB"><span class="hs-identifier hs-type">EntityNameDB</span></a></span><span> </span><span id="local-6989586621679933272"><span class="annot"><span class="annottext">Text
</span><a href="#local-6989586621679933272"><span class="hs-identifier hs-var">table</span></a></span></span><span class="hs-special">)</span><span> </span><span class="hs-special">(</span><span class="annot"><a href="Database.Persist.Names.html#FieldNameDB"><span class="hs-identifier hs-type">FieldNameDB</span></a></span><span> </span><span id="local-6989586621679933270"><span class="annot"><span class="annottext">Text
</span><a href="#local-6989586621679933270"><span class="hs-identifier hs-var">column</span></a></span></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">=</span><span>
</span><span id="line-198"></span><span>    </span><span class="annot"><span class="annottext">Text -&gt; ConstraintNameDB
</span><a href="Database.Persist.Names.html#ConstraintNameDB"><span class="hs-identifier hs-var">ConstraintNameDB</span></a></span><span> </span><span class="annot"><span class="annottext">forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span> </span><span class="annot"><span class="annottext">forall a. Monoid a =&gt; [a] -&gt; a
</span><span class="hs-identifier hs-var">Data.Monoid.mconcat</span></span><span> </span><span class="hs-special">[</span><span class="annot"><span class="annottext">Text
</span><a href="#local-6989586621679933272"><span class="hs-identifier hs-var">table</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">Text
</span><span class="hs-string">&quot;_&quot;</span></span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">Text
</span><a href="#local-6989586621679933270"><span class="hs-identifier hs-var">column</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">Text
</span><span class="hs-string">&quot;_fkey&quot;</span></span><span class="hs-special">]</span><span>
</span><span id="line-199"></span><span>
</span><span id="line-200"></span><span class="annot"><a href="Database.Persist.Sql.Internal.html#resolveTableName"><span class="hs-identifier hs-type">resolveTableName</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="hs-special">[</span><span class="annot"><a href="Database.Persist.Types.Base.html#EntityDef"><span class="hs-identifier hs-type">EntityDef</span></a></span><span class="hs-special">]</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="Database.Persist.Names.html#EntityNameHS"><span class="hs-identifier hs-type">EntityNameHS</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="Database.Persist.Names.html#EntityNameDB"><span class="hs-identifier hs-type">EntityNameDB</span></a></span><span>
</span><span id="line-201"></span><span id="resolveTableName"><span class="annot"><span class="annottext">resolveTableName :: [EntityDef] -&gt; EntityNameHS -&gt; EntityNameDB
</span><a href="Database.Persist.Sql.Internal.html#resolveTableName"><span class="hs-identifier hs-var hs-var">resolveTableName</span></a></span></span><span> </span><span class="hs-special">[</span><span class="hs-special">]</span><span> </span><span class="hs-special">(</span><span class="annot"><a href="Database.Persist.Names.html#EntityNameHS"><span class="hs-identifier hs-type">EntityNameHS</span></a></span><span> </span><span id="local-6989586621679933268"><span class="annot"><span class="annottext">Text
</span><a href="#local-6989586621679933268"><span class="hs-identifier hs-var">t</span></a></span></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">forall a. HasCallStack =&gt; [Char] -&gt; a
</span><span class="hs-identifier hs-var">error</span></span><span> </span><span class="annot"><span class="annottext">forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span> </span><span class="annot"><span class="annottext">[Char]
</span><span class="hs-string">&quot;Table not found: &quot;</span></span><span> </span><span class="annot"><span class="annottext">forall a. Monoid a =&gt; a -&gt; a -&gt; a
</span><span class="hs-operator hs-var">`Data.Monoid.mappend`</span></span><span> </span><span class="annot"><span class="annottext">Text -&gt; [Char]
</span><span class="hs-identifier hs-var">T.unpack</span></span><span> </span><span class="annot"><span class="annottext">Text
</span><a href="#local-6989586621679933268"><span class="hs-identifier hs-var">t</span></a></span><span>
</span><span id="line-202"></span><span class="annot"><a href="Database.Persist.Sql.Internal.html#resolveTableName"><span class="hs-identifier hs-var">resolveTableName</span></a></span><span> </span><span class="hs-special">(</span><span id="local-6989586621679933265"><span class="annot"><span class="annottext">EntityDef
</span><a href="#local-6989586621679933265"><span class="hs-identifier hs-var">e</span></a></span></span><span class="annot"><span class="hs-glyph hs-type">:</span></span><span id="local-6989586621679933264"><span class="annot"><span class="annottext">[EntityDef]
</span><a href="#local-6989586621679933264"><span class="hs-identifier hs-var">es</span></a></span></span><span class="hs-special">)</span><span> </span><span id="local-6989586621679933263"><span class="annot"><span class="annottext">EntityNameHS
</span><a href="#local-6989586621679933263"><span class="hs-identifier hs-var">hn</span></a></span></span><span>
</span><span id="line-203"></span><span>    </span><span class="hs-glyph">|</span><span> </span><span class="annot"><span class="annottext">EntityDef -&gt; EntityNameHS
</span><a href="Database.Persist.EntityDef.html#getEntityHaskellName"><span class="hs-identifier hs-var">getEntityHaskellName</span></a></span><span> </span><span class="annot"><span class="annottext">EntityDef
</span><a href="#local-6989586621679933265"><span class="hs-identifier hs-var">e</span></a></span><span> </span><span class="annot"><span class="annottext">forall a. Eq a =&gt; a -&gt; a -&gt; Bool
</span><span class="hs-operator hs-var">==</span></span><span> </span><span class="annot"><span class="annottext">EntityNameHS
</span><a href="#local-6989586621679933263"><span class="hs-identifier hs-var">hn</span></a></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">EntityDef -&gt; EntityNameDB
</span><a href="Database.Persist.EntityDef.html#getEntityDBName"><span class="hs-identifier hs-var">getEntityDBName</span></a></span><span> </span><span class="annot"><span class="annottext">EntityDef
</span><a href="#local-6989586621679933265"><span class="hs-identifier hs-var">e</span></a></span><span>
</span><span id="line-204"></span><span>    </span><span class="hs-glyph">|</span><span> </span><span class="annot"><span class="annottext">Bool
</span><span class="hs-identifier hs-var">otherwise</span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">[EntityDef] -&gt; EntityNameHS -&gt; EntityNameDB
</span><a href="Database.Persist.Sql.Internal.html#resolveTableName"><span class="hs-identifier hs-var">resolveTableName</span></a></span><span> </span><span class="annot"><span class="annottext">[EntityDef]
</span><a href="#local-6989586621679933264"><span class="hs-identifier hs-var">es</span></a></span><span> </span><span class="annot"><span class="annottext">EntityNameHS
</span><a href="#local-6989586621679933263"><span class="hs-identifier hs-var">hn</span></a></span><span>
</span><span id="line-205"></span></pre></body></html>