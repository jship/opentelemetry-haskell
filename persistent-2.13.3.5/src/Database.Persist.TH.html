<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd"><html xmlns="http://www.w3.org/1999/xhtml"><head><link rel="stylesheet" type="text/css" href="style.css" /><script type="text/javascript" src="highlight.js"></script></head><body><pre><span class="hs-pragma">{-# LANGUAGE AllowAmbiguousTypes #-}</span><span>
</span><span id="line-2"></span><span class="hs-pragma">{-# LANGUAGE CPP #-}</span><span>
</span><span id="line-3"></span><span class="hs-pragma">{-# LANGUAGE DataKinds #-}</span><span>
</span><span id="line-4"></span><span class="hs-pragma">{-# LANGUAGE DeriveLift #-}</span><span>
</span><span id="line-5"></span><span class="hs-pragma">{-# LANGUAGE DerivingStrategies #-}</span><span>
</span><span id="line-6"></span><span class="hs-pragma">{-# LANGUAGE FlexibleInstances #-}</span><span>
</span><span id="line-7"></span><span class="hs-pragma">{-# LANGUAGE GeneralizedNewtypeDeriving #-}</span><span>
</span><span id="line-8"></span><span class="hs-pragma">{-# LANGUAGE LambdaCase #-}</span><span>
</span><span id="line-9"></span><span class="hs-pragma">{-# LANGUAGE OverloadedStrings #-}</span><span>
</span><span id="line-10"></span><span class="hs-pragma">{-# LANGUAGE PolyKinds #-}</span><span>
</span><span id="line-11"></span><span class="hs-pragma">{-# LANGUAGE RankNTypes #-}</span><span>
</span><span id="line-12"></span><span class="hs-pragma">{-# LANGUAGE RecordWildCards #-}</span><span>
</span><span id="line-13"></span><span class="hs-pragma">{-# LANGUAGE ScopedTypeVariables #-}</span><span>
</span><span id="line-14"></span><span class="hs-pragma">{-# LANGUAGE StandaloneDeriving #-}</span><span>
</span><span id="line-15"></span><span class="hs-pragma">{-# LANGUAGE TemplateHaskell #-}</span><span>
</span><span id="line-16"></span><span class="hs-pragma">{-# LANGUAGE TupleSections #-}</span><span>
</span><span id="line-17"></span><span class="hs-pragma">{-# LANGUAGE TypeApplications #-}</span><span>
</span><span id="line-18"></span><span class="hs-pragma">{-# LANGUAGE UndecidableInstances #-}</span><span>
</span><span id="line-19"></span><span class="hs-pragma">{-# LANGUAGE ViewPatterns #-}</span><span>
</span><span id="line-20"></span><span>
</span><span id="line-21"></span><span class="hs-comment">-- | This module provides the tools for defining your database schema and using</span><span>
</span><span id="line-22"></span><span class="hs-comment">-- it to generate Haskell data types and migrations.</span><span>
</span><span id="line-23"></span><span class="hs-keyword">module</span><span> </span><span class="hs-identifier">Database.Persist.TH</span><span>
</span><span id="line-24"></span><span>    </span><span class="hs-special">(</span><span> </span><span class="annot"><span class="hs-comment">-- * Parse entity defs</span></span><span>
</span><span id="line-25"></span><span>      </span><span class="annot"><a href="Database.Persist.TH.html#persistWith"><span class="hs-identifier">persistWith</span></a></span><span>
</span><span id="line-26"></span><span>    </span><span class="hs-special">,</span><span> </span><span class="annot"><a href="Database.Persist.TH.html#persistUpperCase"><span class="hs-identifier">persistUpperCase</span></a></span><span>
</span><span id="line-27"></span><span>    </span><span class="hs-special">,</span><span> </span><span class="annot"><a href="Database.Persist.TH.html#persistLowerCase"><span class="hs-identifier">persistLowerCase</span></a></span><span>
</span><span id="line-28"></span><span>    </span><span class="hs-special">,</span><span> </span><span class="annot"><a href="Database.Persist.TH.html#persistFileWith"><span class="hs-identifier">persistFileWith</span></a></span><span>
</span><span id="line-29"></span><span>    </span><span class="hs-special">,</span><span> </span><span class="annot"><a href="Database.Persist.TH.html#persistManyFileWith"><span class="hs-identifier">persistManyFileWith</span></a></span><span>
</span><span id="line-30"></span><span>      </span><span class="annot"><span class="hs-comment">-- * Turn @EntityDef@s into types</span></span><span>
</span><span id="line-31"></span><span>    </span><span class="hs-special">,</span><span> </span><span class="annot"><a href="Database.Persist.TH.html#mkPersist"><span class="hs-identifier">mkPersist</span></a></span><span>
</span><span id="line-32"></span><span>    </span><span class="hs-special">,</span><span> </span><span class="annot"><a href="Database.Persist.TH.html#mkPersistWith"><span class="hs-identifier">mkPersistWith</span></a></span><span>
</span><span id="line-33"></span><span>    </span><span class="hs-special">,</span><span> </span><span class="annot"><a href="Database.Persist.TH.html#MkPersistSettings"><span class="hs-identifier">MkPersistSettings</span></a></span><span>
</span><span id="line-34"></span><span>    </span><span class="hs-special">,</span><span> </span><span class="annot"><a href="Database.Persist.TH.html#mpsBackend"><span class="hs-identifier">mpsBackend</span></a></span><span>
</span><span id="line-35"></span><span>    </span><span class="hs-special">,</span><span> </span><span class="annot"><a href="Database.Persist.TH.html#mpsGeneric"><span class="hs-identifier">mpsGeneric</span></a></span><span>
</span><span id="line-36"></span><span>    </span><span class="hs-special">,</span><span> </span><span class="annot"><a href="Database.Persist.TH.html#mpsPrefixFields"><span class="hs-identifier">mpsPrefixFields</span></a></span><span>
</span><span id="line-37"></span><span>    </span><span class="hs-special">,</span><span> </span><span class="annot"><a href="Database.Persist.TH.html#mpsFieldLabelModifier"><span class="hs-identifier">mpsFieldLabelModifier</span></a></span><span>
</span><span id="line-38"></span><span>    </span><span class="hs-special">,</span><span> </span><span class="annot"><a href="Database.Persist.TH.html#mpsConstraintLabelModifier"><span class="hs-identifier">mpsConstraintLabelModifier</span></a></span><span>
</span><span id="line-39"></span><span>    </span><span class="hs-special">,</span><span> </span><span class="annot"><a href="Database.Persist.TH.html#mpsEntityJSON"><span class="hs-identifier">mpsEntityJSON</span></a></span><span>
</span><span id="line-40"></span><span>    </span><span class="hs-special">,</span><span> </span><span class="annot"><a href="Database.Persist.TH.html#mpsGenerateLenses"><span class="hs-identifier">mpsGenerateLenses</span></a></span><span>
</span><span id="line-41"></span><span>    </span><span class="hs-special">,</span><span> </span><span class="annot"><a href="Database.Persist.TH.html#mpsDeriveInstances"><span class="hs-identifier">mpsDeriveInstances</span></a></span><span>
</span><span id="line-42"></span><span>    </span><span class="hs-special">,</span><span> </span><span class="annot"><a href="Database.Persist.TH.html#EntityJSON"><span class="hs-identifier">EntityJSON</span></a></span><span class="hs-special">(</span><span class="hs-glyph">..</span><span class="hs-special">)</span><span>
</span><span id="line-43"></span><span>    </span><span class="hs-special">,</span><span> </span><span class="annot"><a href="Database.Persist.TH.html#mkPersistSettings"><span class="hs-identifier">mkPersistSettings</span></a></span><span>
</span><span id="line-44"></span><span>    </span><span class="hs-special">,</span><span> </span><span class="annot"><a href="Database.Persist.TH.html#sqlSettings"><span class="hs-identifier">sqlSettings</span></a></span><span>
</span><span id="line-45"></span><span>    </span><span class="annot"><span class="hs-comment">-- ** Implicit ID Columns</span></span><span>
</span><span id="line-46"></span><span>    </span><span class="hs-special">,</span><span> </span><span class="annot"><a href="Database.Persist.ImplicitIdDef.Internal.html#ImplicitIdDef"><span class="hs-identifier">ImplicitIdDef</span></a></span><span>
</span><span id="line-47"></span><span>    </span><span class="hs-special">,</span><span> </span><span class="annot"><a href="Database.Persist.TH.html#setImplicitIdDef"><span class="hs-identifier">setImplicitIdDef</span></a></span><span>
</span><span id="line-48"></span><span>      </span><span class="annot"><span class="hs-comment">-- * Various other TH functions</span></span><span>
</span><span id="line-49"></span><span>    </span><span class="hs-special">,</span><span> </span><span class="annot"><a href="Database.Persist.TH.html#mkMigrate"><span class="hs-identifier">mkMigrate</span></a></span><span>
</span><span id="line-50"></span><span>    </span><span class="hs-special">,</span><span> </span><span class="annot"><a href="Database.Persist.TH.html#migrateModels"><span class="hs-identifier">migrateModels</span></a></span><span>
</span><span id="line-51"></span><span>    </span><span class="hs-special">,</span><span> </span><span class="annot"><a href="Database.Persist.TH.html#discoverEntities"><span class="hs-identifier">discoverEntities</span></a></span><span>
</span><span id="line-52"></span><span>    </span><span class="hs-special">,</span><span> </span><span class="annot"><a href="Database.Persist.TH.html#mkSave"><span class="hs-identifier">mkSave</span></a></span><span>
</span><span id="line-53"></span><span>    </span><span class="hs-special">,</span><span> </span><span class="annot"><a href="Database.Persist.TH.html#mkDeleteCascade"><span class="hs-identifier">mkDeleteCascade</span></a></span><span>
</span><span id="line-54"></span><span>    </span><span class="hs-special">,</span><span> </span><span class="annot"><a href="Database.Persist.TH.html#mkEntityDefList"><span class="hs-identifier">mkEntityDefList</span></a></span><span>
</span><span id="line-55"></span><span>    </span><span class="hs-special">,</span><span> </span><span class="annot"><a href="Database.Persist.TH.html#share"><span class="hs-identifier">share</span></a></span><span>
</span><span id="line-56"></span><span>    </span><span class="hs-special">,</span><span> </span><span class="annot"><a href="Database.Persist.TH.html#derivePersistField"><span class="hs-identifier">derivePersistField</span></a></span><span>
</span><span id="line-57"></span><span>    </span><span class="hs-special">,</span><span> </span><span class="annot"><a href="Database.Persist.TH.html#derivePersistFieldJSON"><span class="hs-identifier">derivePersistFieldJSON</span></a></span><span>
</span><span id="line-58"></span><span>    </span><span class="hs-special">,</span><span> </span><span class="annot"><a href="Database.Persist.TH.html#persistFieldFromEntity"><span class="hs-identifier">persistFieldFromEntity</span></a></span><span>
</span><span id="line-59"></span><span>      </span><span class="annot"><span class="hs-comment">-- * Internal</span></span><span>
</span><span id="line-60"></span><span>    </span><span class="hs-special">,</span><span> </span><span class="annot"><a href="Database.Persist.TH.html#lensPTH"><span class="hs-identifier">lensPTH</span></a></span><span>
</span><span id="line-61"></span><span>    </span><span class="hs-special">,</span><span> </span><span class="annot"><a href="Database.Persist.TH.html#parseReferences"><span class="hs-identifier">parseReferences</span></a></span><span>
</span><span id="line-62"></span><span>    </span><span class="hs-special">,</span><span> </span><span class="annot"><a href="Database.Persist.TH.html#embedEntityDefs"><span class="hs-identifier">embedEntityDefs</span></a></span><span>
</span><span id="line-63"></span><span>    </span><span class="hs-special">,</span><span> </span><span class="annot"><a href="Database.Persist.TH.html#fieldError"><span class="hs-identifier">fieldError</span></a></span><span>
</span><span id="line-64"></span><span>    </span><span class="hs-special">,</span><span> </span><span class="annot"><a href="Database.Persist.Class.PersistUnique.html#AtLeastOneUniqueKey"><span class="hs-identifier">AtLeastOneUniqueKey</span></a></span><span class="hs-special">(</span><span class="hs-glyph">..</span><span class="hs-special">)</span><span>
</span><span id="line-65"></span><span>    </span><span class="hs-special">,</span><span> </span><span class="annot"><a href="Database.Persist.Class.PersistUnique.html#OnlyOneUniqueKey"><span class="hs-identifier">OnlyOneUniqueKey</span></a></span><span class="hs-special">(</span><span class="hs-glyph">..</span><span class="hs-special">)</span><span>
</span><span id="line-66"></span><span>    </span><span class="hs-special">,</span><span> </span><span class="annot"><a href="Database.Persist.TH.html#pkNewtype"><span class="hs-identifier">pkNewtype</span></a></span><span>
</span><span id="line-67"></span><span>    </span><span class="hs-special">)</span><span> </span><span class="hs-keyword">where</span><span>
</span><span id="line-68"></span><span>
</span><span id="line-69"></span><span class="hs-comment">-- Development Tip: See persistent-template/README.md for advice on seeing generated Template Haskell code</span><span>
</span><span id="line-70"></span><span class="hs-comment">-- It's highly recommended to check the diff between master and your PR's generated code.</span><span>
</span><span id="line-71"></span><span>
</span><span id="line-72"></span><span class="hs-keyword">import</span><span> </span><span class="annot"><span class="hs-identifier">Prelude</span></span><span> </span><span class="hs-keyword">hiding</span><span> </span><span class="hs-special">(</span><span class="annot"><span class="hs-identifier">concat</span></span><span class="hs-special">,</span><span> </span><span class="annot"><span class="hs-identifier">exp</span></span><span class="hs-special">,</span><span> </span><span class="annot"><span class="hs-identifier">splitAt</span></span><span class="hs-special">,</span><span> </span><span class="annot"><span class="hs-identifier">take</span></span><span class="hs-special">,</span><span> </span><span class="annot"><span class="hs-operator">(++)</span></span><span class="hs-special">)</span><span>
</span><span id="line-73"></span><span>
</span><span id="line-74"></span><span class="hs-keyword">import</span><span> </span><span class="annot"><span class="hs-identifier">Control.Monad</span></span><span>
</span><span id="line-75"></span><span class="hs-keyword">import</span><span> </span><span class="annot"><span class="hs-identifier">Data.Aeson</span></span><span>
</span><span id="line-76"></span><span>       </span><span class="hs-special">(</span><span> </span><span class="annot"><span class="hs-identifier">FromJSON</span></span><span class="hs-special">(</span><span class="annot"><span class="hs-identifier">parseJSON</span></span><span class="hs-special">)</span><span>
</span><span id="line-77"></span><span>       </span><span class="hs-special">,</span><span> </span><span class="annot"><span class="hs-identifier">ToJSON</span></span><span class="hs-special">(</span><span class="annot"><span class="hs-identifier">toJSON</span></span><span class="hs-special">)</span><span>
</span><span id="line-78"></span><span>       </span><span class="hs-special">,</span><span> </span><span class="annot"><span class="hs-identifier">Value</span></span><span class="hs-special">(</span><span class="annot"><span class="hs-identifier">Object</span></span><span class="hs-special">)</span><span>
</span><span id="line-79"></span><span>       </span><span class="hs-special">,</span><span> </span><span class="annot"><span class="hs-identifier">eitherDecodeStrict'</span></span><span>
</span><span id="line-80"></span><span>       </span><span class="hs-special">,</span><span> </span><span class="annot"><span class="hs-identifier">object</span></span><span>
</span><span id="line-81"></span><span>       </span><span class="hs-special">,</span><span> </span><span class="annot"><span class="hs-identifier">withObject</span></span><span>
</span><span id="line-82"></span><span>       </span><span class="hs-special">,</span><span> </span><span class="annot"><span class="hs-operator">(.:)</span></span><span>
</span><span id="line-83"></span><span>       </span><span class="hs-special">,</span><span> </span><span class="annot"><span class="hs-operator">(.:?)</span></span><span>
</span><span id="line-84"></span><span>       </span><span class="hs-special">,</span><span> </span><span class="annot"><span class="hs-operator">(.=)</span></span><span>
</span><span id="line-85"></span><span>       </span><span class="hs-special">)</span><span class="hs-cpp">
#if MIN_VERSION_aeson(2,0,0)
</span><span class="hs-keyword">import</span><span> </span><span class="hs-keyword">qualified</span><span> </span><span class="annot"><span class="hs-identifier">Data.Aeson.Key</span></span><span> </span><span class="hs-keyword">as</span><span> </span><span class="annot"><span class="hs-identifier">Key</span></span><span class="hs-cpp">
#endif
</span><span class="hs-keyword">import</span><span> </span><span class="hs-keyword">qualified</span><span> </span><span class="annot"><span class="hs-identifier">Data.ByteString</span></span><span> </span><span class="hs-keyword">as</span><span> </span><span class="annot"><span class="hs-identifier">BS</span></span><span>
</span><span id="line-90"></span><span class="hs-keyword">import</span><span> </span><span class="annot"><span class="hs-identifier">Data.Char</span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="hs-identifier">toLower</span></span><span class="hs-special">,</span><span> </span><span class="annot"><span class="hs-identifier">toUpper</span></span><span class="hs-special">)</span><span>
</span><span id="line-91"></span><span class="hs-keyword">import</span><span> </span><span class="annot"><span class="hs-identifier">Data.Coerce</span></span><span>
</span><span id="line-92"></span><span class="hs-keyword">import</span><span> </span><span class="annot"><span class="hs-identifier">Data.Data</span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="hs-identifier">Data</span></span><span class="hs-special">)</span><span>
</span><span id="line-93"></span><span class="hs-keyword">import</span><span> </span><span class="annot"><span class="hs-identifier">Data.Either</span></span><span>
</span><span id="line-94"></span><span class="hs-keyword">import</span><span> </span><span class="hs-keyword">qualified</span><span> </span><span class="annot"><span class="hs-identifier">Data.HashMap.Strict</span></span><span> </span><span class="hs-keyword">as</span><span> </span><span class="annot"><span class="hs-identifier">HM</span></span><span>
</span><span id="line-95"></span><span class="hs-keyword">import</span><span> </span><span class="annot"><span class="hs-identifier">Data.Int</span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="hs-identifier">Int64</span></span><span class="hs-special">)</span><span>
</span><span id="line-96"></span><span class="hs-keyword">import</span><span> </span><span class="annot"><span class="hs-identifier">Data.Ix</span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="hs-identifier">Ix</span></span><span class="hs-special">)</span><span>
</span><span id="line-97"></span><span class="hs-keyword">import</span><span> </span><span class="annot"><span class="hs-identifier">Data.List</span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="hs-identifier">foldl'</span></span><span class="hs-special">)</span><span>
</span><span id="line-98"></span><span class="hs-keyword">import</span><span> </span><span class="hs-keyword">qualified</span><span> </span><span class="annot"><span class="hs-identifier">Data.List</span></span><span> </span><span class="hs-keyword">as</span><span> </span><span class="annot"><span class="hs-identifier">List</span></span><span>
</span><span id="line-99"></span><span class="hs-keyword">import</span><span> </span><span class="annot"><span class="hs-identifier">Data.List.NonEmpty</span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="hs-identifier">NonEmpty</span></span><span class="hs-special">(</span><span class="hs-glyph">..</span><span class="hs-special">)</span><span class="hs-special">)</span><span>
</span><span id="line-100"></span><span class="hs-keyword">import</span><span> </span><span class="hs-keyword">qualified</span><span> </span><span class="annot"><span class="hs-identifier">Data.List.NonEmpty</span></span><span> </span><span class="hs-keyword">as</span><span> </span><span class="annot"><span class="hs-identifier">NEL</span></span><span>
</span><span id="line-101"></span><span class="hs-keyword">import</span><span> </span><span class="hs-keyword">qualified</span><span> </span><span class="annot"><span class="hs-identifier">Data.Map</span></span><span> </span><span class="hs-keyword">as</span><span> </span><span class="annot"><span class="hs-identifier">M</span></span><span>
</span><span id="line-102"></span><span class="hs-keyword">import</span><span> </span><span class="annot"><span class="hs-identifier">Data.Maybe</span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="hs-identifier">fromMaybe</span></span><span class="hs-special">,</span><span> </span><span class="annot"><span class="hs-identifier">isJust</span></span><span class="hs-special">,</span><span> </span><span class="annot"><span class="hs-identifier">listToMaybe</span></span><span class="hs-special">,</span><span> </span><span class="annot"><span class="hs-identifier">mapMaybe</span></span><span class="hs-special">)</span><span>
</span><span id="line-103"></span><span class="hs-keyword">import</span><span> </span><span class="annot"><span class="hs-identifier">Data.Proxy</span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="hs-identifier">Proxy</span></span><span class="hs-special">(</span><span class="annot"><span class="hs-identifier">Proxy</span></span><span class="hs-special">)</span><span class="hs-special">)</span><span>
</span><span id="line-104"></span><span class="hs-keyword">import</span><span> </span><span class="annot"><span class="hs-identifier">Data.Text</span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="hs-identifier">Text</span></span><span class="hs-special">,</span><span> </span><span class="annot"><span class="hs-identifier">concat</span></span><span class="hs-special">,</span><span> </span><span class="annot"><span class="hs-identifier">cons</span></span><span class="hs-special">,</span><span> </span><span class="annot"><span class="hs-identifier">pack</span></span><span class="hs-special">,</span><span> </span><span class="annot"><span class="hs-identifier">stripSuffix</span></span><span class="hs-special">,</span><span> </span><span class="annot"><span class="hs-identifier">uncons</span></span><span class="hs-special">,</span><span> </span><span class="annot"><span class="hs-identifier">unpack</span></span><span class="hs-special">)</span><span>
</span><span id="line-105"></span><span class="hs-keyword">import</span><span> </span><span class="hs-keyword">qualified</span><span> </span><span class="annot"><span class="hs-identifier">Data.Text</span></span><span> </span><span class="hs-keyword">as</span><span> </span><span class="annot"><span class="hs-identifier">T</span></span><span>
</span><span id="line-106"></span><span class="hs-keyword">import</span><span> </span><span class="annot"><span class="hs-identifier">Data.Text.Encoding</span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="hs-identifier">decodeUtf8</span></span><span class="hs-special">)</span><span>
</span><span id="line-107"></span><span class="hs-keyword">import</span><span> </span><span class="hs-keyword">qualified</span><span> </span><span class="annot"><span class="hs-identifier">Data.Text.Encoding</span></span><span> </span><span class="hs-keyword">as</span><span> </span><span class="annot"><span class="hs-identifier">TE</span></span><span>
</span><span id="line-108"></span><span class="hs-keyword">import</span><span> </span><span class="annot"><span class="hs-identifier">Data.Typeable</span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="hs-identifier">Typeable</span></span><span class="hs-special">)</span><span>
</span><span id="line-109"></span><span class="hs-keyword">import</span><span> </span><span class="annot"><span class="hs-identifier">GHC.Generics</span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="hs-identifier">Generic</span></span><span class="hs-special">)</span><span>
</span><span id="line-110"></span><span class="hs-keyword">import</span><span> </span><span class="annot"><span class="hs-identifier">GHC.Stack</span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="hs-identifier">HasCallStack</span></span><span class="hs-special">)</span><span>
</span><span id="line-111"></span><span class="hs-keyword">import</span><span> </span><span class="annot"><span class="hs-identifier">GHC.TypeLits</span></span><span>
</span><span id="line-112"></span><span class="hs-keyword">import</span><span> </span><span class="annot"><span class="hs-identifier">Instances.TH.Lift</span></span><span> </span><span class="hs-special">(</span><span class="hs-special">)</span><span>
</span><span id="line-113"></span><span>    </span><span class="hs-comment">-- Bring `Lift (fmap k v)` instance into scope, as well as `Lift Text`</span><span>
</span><span id="line-114"></span><span>    </span><span class="hs-comment">-- instance on pre-1.2.4 versions of `text`</span><span>
</span><span id="line-115"></span><span class="hs-keyword">import</span><span> </span><span class="annot"><span class="hs-identifier">Data.Foldable</span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="hs-identifier">toList</span></span><span class="hs-special">)</span><span>
</span><span id="line-116"></span><span class="hs-keyword">import</span><span> </span><span class="hs-keyword">qualified</span><span> </span><span class="annot"><span class="hs-identifier">Data.Set</span></span><span> </span><span class="hs-keyword">as</span><span> </span><span class="annot"><span class="hs-identifier">Set</span></span><span>
</span><span id="line-117"></span><span class="hs-keyword">import</span><span> </span><span class="annot"><span class="hs-identifier">Language.Haskell.TH.Lib</span></span><span>
</span><span id="line-118"></span><span>       </span><span class="hs-special">(</span><span class="annot"><span class="hs-identifier">appT</span></span><span class="hs-special">,</span><span> </span><span class="annot"><span class="hs-identifier">conE</span></span><span class="hs-special">,</span><span> </span><span class="annot"><span class="hs-identifier">conK</span></span><span class="hs-special">,</span><span> </span><span class="annot"><span class="hs-identifier">conT</span></span><span class="hs-special">,</span><span> </span><span class="annot"><span class="hs-identifier">litT</span></span><span class="hs-special">,</span><span> </span><span class="annot"><span class="hs-identifier">strTyLit</span></span><span class="hs-special">,</span><span> </span><span class="annot"><span class="hs-identifier">varE</span></span><span class="hs-special">,</span><span> </span><span class="annot"><span class="hs-identifier">varP</span></span><span class="hs-special">,</span><span> </span><span class="annot"><span class="hs-identifier">varT</span></span><span class="hs-special">)</span><span>
</span><span id="line-119"></span><span class="hs-keyword">import</span><span> </span><span class="annot"><span class="hs-identifier">Language.Haskell.TH.Quote</span></span><span>
</span><span id="line-120"></span><span class="hs-keyword">import</span><span> </span><span class="annot"><span class="hs-identifier">Language.Haskell.TH.Syntax</span></span><span>
</span><span id="line-121"></span><span class="hs-keyword">import</span><span> </span><span class="annot"><span class="hs-identifier">Web.HttpApiData</span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="hs-identifier">FromHttpApiData</span></span><span class="hs-special">(</span><span class="hs-glyph">..</span><span class="hs-special">)</span><span class="hs-special">,</span><span> </span><span class="annot"><span class="hs-identifier">ToHttpApiData</span></span><span class="hs-special">(</span><span class="hs-glyph">..</span><span class="hs-special">)</span><span class="hs-special">)</span><span>
</span><span id="line-122"></span><span class="hs-keyword">import</span><span> </span><span class="annot"><span class="hs-identifier">Web.PathPieces</span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="hs-identifier">PathPiece</span></span><span class="hs-special">(</span><span class="hs-glyph">..</span><span class="hs-special">)</span><span class="hs-special">)</span><span>
</span><span id="line-123"></span><span>
</span><span id="line-124"></span><span class="hs-keyword">import</span><span> </span><span class="annot"><a href="Database.Persist.html"><span class="hs-identifier">Database.Persist</span></a></span><span>
</span><span id="line-125"></span><span class="hs-keyword">import</span><span> </span><span class="annot"><a href="Database.Persist.Quasi.html"><span class="hs-identifier">Database.Persist.Quasi</span></a></span><span>
</span><span id="line-126"></span><span class="hs-keyword">import</span><span> </span><span class="annot"><a href="Database.Persist.Quasi.Internal.html"><span class="hs-identifier">Database.Persist.Quasi.Internal</span></a></span><span>
</span><span id="line-127"></span><span class="hs-keyword">import</span><span> </span><span class="annot"><a href="Database.Persist.Sql.html"><span class="hs-identifier">Database.Persist.Sql</span></a></span><span>
</span><span id="line-128"></span><span>       </span><span class="hs-special">(</span><span class="annot"><a href="Database.Persist.Sql.Migration.html#Migration"><span class="hs-identifier">Migration</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><a href="Database.Persist.Sql.Class.html#PersistFieldSql"><span class="hs-identifier">PersistFieldSql</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><a href="Database.Persist.SqlBackend.Internal.html#SqlBackend"><span class="hs-identifier">SqlBackend</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><a href="Database.Persist.Sql.Migration.html#migrate"><span class="hs-identifier">migrate</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><a href="Database.Persist.Sql.Class.html#sqlType"><span class="hs-identifier">sqlType</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-129"></span><span>
</span><span id="line-130"></span><span class="hs-keyword">import</span><span> </span><span class="annot"><a href="Database.Persist.EntityDef.Internal.html"><span class="hs-identifier">Database.Persist.EntityDef.Internal</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="Database.Persist.Types.Base.html#EntityDef"><span class="hs-identifier">EntityDef</span></a></span><span class="hs-special">(</span><span class="hs-glyph">..</span><span class="hs-special">)</span><span class="hs-special">)</span><span>
</span><span id="line-131"></span><span class="hs-keyword">import</span><span> </span><span class="annot"><a href="Database.Persist.ImplicitIdDef.html"><span class="hs-identifier">Database.Persist.ImplicitIdDef</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="Database.Persist.ImplicitIdDef.html#autoIncrementingInteger"><span class="hs-identifier">autoIncrementingInteger</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-132"></span><span class="hs-keyword">import</span><span> </span><span class="annot"><a href="Database.Persist.ImplicitIdDef.Internal.html"><span class="hs-identifier">Database.Persist.ImplicitIdDef.Internal</span></a></span><span class="hs-cpp">

#if MIN_VERSION_template_haskell(2,18,0)
</span><span class="annot"><a href="Database.Persist.TH.html#conp"><span class="hs-identifier hs-type">conp</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><span class="hs-identifier hs-type">Name</span></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-special">[</span><span class="annot"><span class="hs-identifier hs-type">Pat</span></span><span class="hs-special">]</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="hs-identifier hs-type">Pat</span></span><span>
</span><span id="line-136"></span><span id="conp"><span class="annot"><span class="annottext">conp :: Name -&gt; [Pat] -&gt; Pat
</span><a href="Database.Persist.TH.html#conp"><span class="hs-identifier hs-var hs-var">conp</span></a></span></span><span> </span><span id="local-6989586621679965494"><span class="annot"><span class="annottext">Name
</span><a href="#local-6989586621679965494"><span class="hs-identifier hs-var">name</span></a></span></span><span> </span><span id="local-6989586621679965493"><span class="annot"><span class="annottext">[Pat]
</span><a href="#local-6989586621679965493"><span class="hs-identifier hs-var">pats</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">Name -&gt; [Type] -&gt; [Pat] -&gt; Pat
</span><span class="hs-identifier hs-var">ConP</span></span><span> </span><span class="annot"><span class="annottext">Name
</span><a href="#local-6989586621679965494"><span class="hs-identifier hs-var">name</span></a></span><span> </span><span class="hs-special">[</span><span class="hs-special">]</span><span> </span><span class="annot"><span class="annottext">[Pat]
</span><a href="#local-6989586621679965493"><span class="hs-identifier hs-var">pats</span></a></span><span class="hs-cpp">
#else
</span><span class="hs-identifier">conp</span><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-identifier">ConP</span><span class="hs-cpp">
#endif
</span><span>
</span><span id="line-141"></span><span class="hs-comment">-- | Converts a quasi-quoted syntax into a list of entity definitions, to be</span><span>
</span><span id="line-142"></span><span class="hs-comment">-- used as input to the template haskell generation code (mkPersist).</span><span>
</span><span id="line-143"></span><span class="annot"><a href="Database.Persist.TH.html#persistWith"><span class="hs-identifier hs-type">persistWith</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><a href="Database.Persist.Quasi.Internal.html#PersistSettings"><span class="hs-identifier hs-type">PersistSettings</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="hs-identifier hs-type">QuasiQuoter</span></span><span>
</span><span id="line-144"></span><span id="persistWith"><span class="annot"><span class="annottext">persistWith :: PersistSettings -&gt; QuasiQuoter
</span><a href="Database.Persist.TH.html#persistWith"><span class="hs-identifier hs-var hs-var">persistWith</span></a></span></span><span> </span><span id="local-6989586621679965491"><span class="annot"><span class="annottext">PersistSettings
</span><a href="#local-6989586621679965491"><span class="hs-identifier hs-var">ps</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="hs-identifier hs-type">QuasiQuoter</span></span><span>
</span><span id="line-145"></span><span>    </span><span class="hs-special">{</span><span> </span><span class="annot"><span class="annottext">quoteExp :: String -&gt; Q Exp
</span><span class="hs-identifier hs-var">quoteExp</span></span><span> </span><span class="hs-glyph">=</span><span>
</span><span id="line-146"></span><span>        </span><span class="annot"><span class="annottext">PersistSettings -&gt; Text -&gt; Q Exp
</span><a href="Database.Persist.TH.html#parseReferences"><span class="hs-identifier hs-var">parseReferences</span></a></span><span> </span><span class="annot"><span class="annottext">PersistSettings
</span><a href="#local-6989586621679965491"><span class="hs-identifier hs-var">ps</span></a></span><span> </span><span class="annot"><span class="annottext">forall b c a. (b -&gt; c) -&gt; (a -&gt; b) -&gt; a -&gt; c
</span><span class="hs-operator hs-var">.</span></span><span> </span><span class="annot"><span class="annottext">String -&gt; Text
</span><span class="hs-identifier hs-var">pack</span></span><span>
</span><span id="line-147"></span><span>    </span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">quotePat :: String -&gt; Q Pat
</span><span class="hs-identifier hs-var">quotePat</span></span><span> </span><span class="hs-glyph">=</span><span>
</span><span id="line-148"></span><span>        </span><span class="annot"><span class="annottext">forall a. HasCallStack =&gt; String -&gt; a
</span><span class="hs-identifier hs-var">error</span></span><span> </span><span class="annot"><span class="annottext">String
</span><span class="hs-string">&quot;persistWith can't be used as pattern&quot;</span></span><span>
</span><span id="line-149"></span><span>    </span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">quoteType :: String -&gt; Q Type
</span><span class="hs-identifier hs-var">quoteType</span></span><span> </span><span class="hs-glyph">=</span><span>
</span><span id="line-150"></span><span>        </span><span class="annot"><span class="annottext">forall a. HasCallStack =&gt; String -&gt; a
</span><span class="hs-identifier hs-var">error</span></span><span> </span><span class="annot"><span class="annottext">String
</span><span class="hs-string">&quot;persistWith can't be used as type&quot;</span></span><span>
</span><span id="line-151"></span><span>    </span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">quoteDec :: String -&gt; Q [Dec]
</span><span class="hs-identifier hs-var">quoteDec</span></span><span> </span><span class="hs-glyph">=</span><span>
</span><span id="line-152"></span><span>        </span><span class="annot"><span class="annottext">forall a. HasCallStack =&gt; String -&gt; a
</span><span class="hs-identifier hs-var">error</span></span><span> </span><span class="annot"><span class="annottext">String
</span><span class="hs-string">&quot;persistWith can't be used as declaration&quot;</span></span><span>
</span><span id="line-153"></span><span>    </span><span class="hs-special">}</span><span>
</span><span id="line-154"></span><span>
</span><span id="line-155"></span><span class="hs-comment">-- | Apply 'persistWith' to 'upperCaseSettings'.</span><span>
</span><span id="line-156"></span><span class="annot"><a href="Database.Persist.TH.html#persistUpperCase"><span class="hs-identifier hs-type">persistUpperCase</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><span class="hs-identifier hs-type">QuasiQuoter</span></span><span>
</span><span id="line-157"></span><span id="persistUpperCase"><span class="annot"><span class="annottext">persistUpperCase :: QuasiQuoter
</span><a href="Database.Persist.TH.html#persistUpperCase"><span class="hs-identifier hs-var hs-var">persistUpperCase</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">PersistSettings -&gt; QuasiQuoter
</span><a href="Database.Persist.TH.html#persistWith"><span class="hs-identifier hs-var">persistWith</span></a></span><span> </span><span class="annot"><span class="annottext">PersistSettings
</span><a href="Database.Persist.Quasi.Internal.html#upperCaseSettings"><span class="hs-identifier hs-var">upperCaseSettings</span></a></span><span>
</span><span id="line-158"></span><span>
</span><span id="line-159"></span><span class="hs-comment">-- | Apply 'persistWith' to 'lowerCaseSettings'.</span><span>
</span><span id="line-160"></span><span class="annot"><a href="Database.Persist.TH.html#persistLowerCase"><span class="hs-identifier hs-type">persistLowerCase</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><span class="hs-identifier hs-type">QuasiQuoter</span></span><span>
</span><span id="line-161"></span><span id="persistLowerCase"><span class="annot"><span class="annottext">persistLowerCase :: QuasiQuoter
</span><a href="Database.Persist.TH.html#persistLowerCase"><span class="hs-identifier hs-var hs-var">persistLowerCase</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">PersistSettings -&gt; QuasiQuoter
</span><a href="Database.Persist.TH.html#persistWith"><span class="hs-identifier hs-var">persistWith</span></a></span><span> </span><span class="annot"><span class="annottext">PersistSettings
</span><a href="Database.Persist.Quasi.Internal.html#lowerCaseSettings"><span class="hs-identifier hs-var">lowerCaseSettings</span></a></span><span>
</span><span id="line-162"></span><span>
</span><span id="line-163"></span><span class="hs-comment">-- | Same as 'persistWith', but uses an external file instead of a</span><span>
</span><span id="line-164"></span><span class="hs-comment">-- quasiquotation. The recommended file extension is @.persistentmodels@.</span><span>
</span><span id="line-165"></span><span class="annot"><a href="Database.Persist.TH.html#persistFileWith"><span class="hs-identifier hs-type">persistFileWith</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><a href="Database.Persist.Quasi.Internal.html#PersistSettings"><span class="hs-identifier hs-type">PersistSettings</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="hs-identifier hs-type">FilePath</span></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="hs-identifier hs-type">Q</span></span><span> </span><span class="annot"><span class="hs-identifier hs-type">Exp</span></span><span>
</span><span id="line-166"></span><span id="persistFileWith"><span class="annot"><span class="annottext">persistFileWith :: PersistSettings -&gt; String -&gt; Q Exp
</span><a href="Database.Persist.TH.html#persistFileWith"><span class="hs-identifier hs-var hs-var">persistFileWith</span></a></span></span><span> </span><span id="local-6989586621679965484"><span class="annot"><span class="annottext">PersistSettings
</span><a href="#local-6989586621679965484"><span class="hs-identifier hs-var">ps</span></a></span></span><span> </span><span id="local-6989586621679965483"><span class="annot"><span class="annottext">String
</span><a href="#local-6989586621679965483"><span class="hs-identifier hs-var">fp</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">PersistSettings -&gt; [String] -&gt; Q Exp
</span><a href="Database.Persist.TH.html#persistManyFileWith"><span class="hs-identifier hs-var">persistManyFileWith</span></a></span><span> </span><span class="annot"><span class="annottext">PersistSettings
</span><a href="#local-6989586621679965484"><span class="hs-identifier hs-var">ps</span></a></span><span> </span><span class="hs-special">[</span><span class="annot"><span class="annottext">String
</span><a href="#local-6989586621679965483"><span class="hs-identifier hs-var">fp</span></a></span><span class="hs-special">]</span><span>
</span><span id="line-167"></span><span>
</span><span id="line-168"></span><span class="hs-comment">-- | Same as 'persistFileWith', but uses several external files instead of</span><span>
</span><span id="line-169"></span><span class="hs-comment">-- one. Splitting your Persistent definitions into multiple modules can</span><span>
</span><span id="line-170"></span><span class="hs-comment">-- potentially dramatically speed up compile times.</span><span>
</span><span id="line-171"></span><span class="hs-comment">--</span><span>
</span><span id="line-172"></span><span class="hs-comment">-- The recommended file extension is @.persistentmodels@.</span><span>
</span><span id="line-173"></span><span class="hs-comment">--</span><span>
</span><span id="line-174"></span><span class="hs-comment">-- ==== __Examples__</span><span>
</span><span id="line-175"></span><span class="hs-comment">--</span><span>
</span><span id="line-176"></span><span class="hs-comment">-- Split your Persistent definitions into multiple files (@models1@, @models2@),</span><span>
</span><span id="line-177"></span><span class="hs-comment">-- then create a new module for each new file and run 'mkPersist' there:</span><span>
</span><span id="line-178"></span><span class="hs-comment">--</span><span>
</span><span id="line-179"></span><span class="hs-comment">-- @</span><span>
</span><span id="line-180"></span><span class="hs-comment">-- -- Model1.hs</span><span>
</span><span id="line-181"></span><span class="hs-comment">-- 'share'</span><span>
</span><span id="line-182"></span><span class="hs-comment">--     ['mkPersist' 'sqlSettings']</span><span>
</span><span id="line-183"></span><span class="hs-comment">--     $('persistFileWith' 'lowerCaseSettings' &quot;models1&quot;)</span><span>
</span><span id="line-184"></span><span class="hs-comment">-- @</span><span>
</span><span id="line-185"></span><span class="hs-comment">-- @</span><span>
</span><span id="line-186"></span><span class="hs-comment">-- -- Model2.hs</span><span>
</span><span id="line-187"></span><span class="hs-comment">-- 'share'</span><span>
</span><span id="line-188"></span><span class="hs-comment">--     ['mkPersist' 'sqlSettings']</span><span>
</span><span id="line-189"></span><span class="hs-comment">--     $('persistFileWith' 'lowerCaseSettings' &quot;models2&quot;)</span><span>
</span><span id="line-190"></span><span class="hs-comment">-- @</span><span>
</span><span id="line-191"></span><span class="hs-comment">--</span><span>
</span><span id="line-192"></span><span class="hs-comment">-- Use 'persistManyFileWith' to create your migrations:</span><span>
</span><span id="line-193"></span><span class="hs-comment">--</span><span>
</span><span id="line-194"></span><span class="hs-comment">-- @</span><span>
</span><span id="line-195"></span><span class="hs-comment">-- -- Migrate.hs</span><span>
</span><span id="line-196"></span><span class="hs-comment">-- 'share'</span><span>
</span><span id="line-197"></span><span class="hs-comment">--     ['mkMigrate' &quot;migrateAll&quot;]</span><span>
</span><span id="line-198"></span><span class="hs-comment">--     $('persistManyFileWith' 'lowerCaseSettings' [&quot;models1.persistentmodels&quot;,&quot;models2.persistentmodels&quot;])</span><span>
</span><span id="line-199"></span><span class="hs-comment">-- @</span><span>
</span><span id="line-200"></span><span class="hs-comment">--</span><span>
</span><span id="line-201"></span><span class="hs-comment">-- Tip: To get the same import behavior as if you were declaring all your models in</span><span>
</span><span id="line-202"></span><span class="hs-comment">-- one file, import your new files @as Name@ into another file, then export @module Name@.</span><span>
</span><span id="line-203"></span><span class="hs-comment">--</span><span>
</span><span id="line-204"></span><span class="hs-comment">-- This approach may be used in the future to reduce memory usage during compilation,</span><span>
</span><span id="line-205"></span><span class="hs-comment">-- but so far we've only seen mild reductions.</span><span>
</span><span id="line-206"></span><span class="hs-comment">--</span><span>
</span><span id="line-207"></span><span class="hs-comment">-- See &lt;https://github.com/yesodweb/persistent/issues/778 persistent#778&gt; and</span><span>
</span><span id="line-208"></span><span class="hs-comment">-- &lt;https://github.com/yesodweb/persistent/pull/791 persistent#791&gt; for more details.</span><span>
</span><span id="line-209"></span><span class="hs-comment">--</span><span>
</span><span id="line-210"></span><span class="hs-comment">-- @since 2.5.4</span><span>
</span><span id="line-211"></span><span class="annot"><a href="Database.Persist.TH.html#persistManyFileWith"><span class="hs-identifier hs-type">persistManyFileWith</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><a href="Database.Persist.Quasi.Internal.html#PersistSettings"><span class="hs-identifier hs-type">PersistSettings</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-special">[</span><span class="annot"><span class="hs-identifier hs-type">FilePath</span></span><span class="hs-special">]</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="hs-identifier hs-type">Q</span></span><span> </span><span class="annot"><span class="hs-identifier hs-type">Exp</span></span><span>
</span><span id="line-212"></span><span id="persistManyFileWith"><span class="annot"><span class="annottext">persistManyFileWith :: PersistSettings -&gt; [String] -&gt; Q Exp
</span><a href="Database.Persist.TH.html#persistManyFileWith"><span class="hs-identifier hs-var hs-var">persistManyFileWith</span></a></span></span><span> </span><span id="local-6989586621679965482"><span class="annot"><span class="annottext">PersistSettings
</span><a href="#local-6989586621679965482"><span class="hs-identifier hs-var">ps</span></a></span></span><span> </span><span id="local-6989586621679965481"><span class="annot"><span class="annottext">[String]
</span><a href="#local-6989586621679965481"><span class="hs-identifier hs-var">fps</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-keyword">do</span><span>
</span><span id="line-213"></span><span>    </span><span class="annot"><span class="annottext">forall (t :: * -&gt; *) (m :: * -&gt; *) a b.
(Foldable t, Monad m) =&gt;
(a -&gt; m b) -&gt; t a -&gt; m ()
</span><span class="hs-identifier hs-var">mapM_</span></span><span> </span><span class="annot"><span class="annottext">forall (m :: * -&gt; *). Quasi m =&gt; String -&gt; m ()
</span><span class="hs-identifier hs-var">qAddDependentFile</span></span><span> </span><span class="annot"><span class="annottext">[String]
</span><a href="#local-6989586621679965481"><span class="hs-identifier hs-var">fps</span></a></span><span>
</span><span id="line-214"></span><span>    </span><span id="local-6989586621679965478"><span class="annot"><span class="annottext">[Text]
</span><a href="#local-6989586621679965478"><span class="hs-identifier hs-var">ss</span></a></span></span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">forall (t :: * -&gt; *) (m :: * -&gt; *) a b.
(Traversable t, Monad m) =&gt;
(a -&gt; m b) -&gt; t a -&gt; m (t b)
</span><span class="hs-identifier hs-var">mapM</span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">forall (m :: * -&gt; *) a. Quasi m =&gt; IO a -&gt; m a
</span><span class="hs-identifier hs-var">qRunIO</span></span><span> </span><span class="annot"><span class="annottext">forall b c a. (b -&gt; c) -&gt; (a -&gt; b) -&gt; a -&gt; c
</span><span class="hs-operator hs-var">.</span></span><span> </span><span class="annot"><span class="annottext">String -&gt; IO Text
</span><a href="Database.Persist.TH.html#getFileContents"><span class="hs-identifier hs-var">getFileContents</span></a></span><span class="hs-special">)</span><span> </span><span class="annot"><span class="annottext">[String]
</span><a href="#local-6989586621679965481"><span class="hs-identifier hs-var">fps</span></a></span><span>
</span><span id="line-215"></span><span>    </span><span class="hs-keyword">let</span><span> </span><span id="local-6989586621679965474"><span class="annot"><span class="annottext">s :: Text
</span><a href="#local-6989586621679965474"><span class="hs-identifier hs-var hs-var">s</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">Text -&gt; [Text] -&gt; Text
</span><span class="hs-identifier hs-var">T.intercalate</span></span><span> </span><span class="annot"><span class="annottext">Text
</span><span class="hs-string">&quot;\n&quot;</span></span><span> </span><span class="annot"><span class="annottext">[Text]
</span><a href="#local-6989586621679965478"><span class="hs-identifier hs-var">ss</span></a></span><span> </span><span class="hs-comment">-- be tolerant of the user forgetting to put a line-break at EOF.</span><span>
</span><span id="line-216"></span><span>    </span><span class="annot"><span class="annottext">PersistSettings -&gt; Text -&gt; Q Exp
</span><a href="Database.Persist.TH.html#parseReferences"><span class="hs-identifier hs-var">parseReferences</span></a></span><span> </span><span class="annot"><span class="annottext">PersistSettings
</span><a href="#local-6989586621679965482"><span class="hs-identifier hs-var">ps</span></a></span><span> </span><span class="annot"><span class="annottext">Text
</span><a href="#local-6989586621679965474"><span class="hs-identifier hs-var">s</span></a></span><span>
</span><span id="line-217"></span><span>
</span><span id="line-218"></span><span class="annot"><a href="Database.Persist.TH.html#getFileContents"><span class="hs-identifier hs-type">getFileContents</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><span class="hs-identifier hs-type">FilePath</span></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="hs-identifier hs-type">IO</span></span><span> </span><span class="annot"><span class="hs-identifier hs-type">Text</span></span><span>
</span><span id="line-219"></span><span id="getFileContents"><span class="annot"><span class="annottext">getFileContents :: String -&gt; IO Text
</span><a href="Database.Persist.TH.html#getFileContents"><span class="hs-identifier hs-var hs-var">getFileContents</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">forall (f :: * -&gt; *) a b. Functor f =&gt; (a -&gt; b) -&gt; f a -&gt; f b
</span><span class="hs-identifier hs-var">fmap</span></span><span> </span><span class="annot"><span class="annottext">ByteString -&gt; Text
</span><span class="hs-identifier hs-var">decodeUtf8</span></span><span> </span><span class="annot"><span class="annottext">forall b c a. (b -&gt; c) -&gt; (a -&gt; b) -&gt; a -&gt; c
</span><span class="hs-operator hs-var">.</span></span><span> </span><span class="annot"><span class="annottext">String -&gt; IO ByteString
</span><span class="hs-identifier hs-var">BS.readFile</span></span><span>
</span><span id="line-220"></span><span>
</span><span id="line-221"></span><span class="hs-comment">-- | Takes a list of (potentially) independently defined entities and properly</span><span>
</span><span id="line-222"></span><span class="hs-comment">-- links all foreign keys to reference the right 'EntityDef', tying the knot</span><span>
</span><span id="line-223"></span><span class="hs-comment">-- between entities.</span><span>
</span><span id="line-224"></span><span class="hs-comment">--</span><span>
</span><span id="line-225"></span><span class="hs-comment">-- Allows users to define entities indepedently or in separate modules and then</span><span>
</span><span id="line-226"></span><span class="hs-comment">-- fix the cross-references between them at runtime to create a 'Migration'.</span><span>
</span><span id="line-227"></span><span class="hs-comment">--</span><span>
</span><span id="line-228"></span><span class="hs-comment">-- @since 2.7.2</span><span>
</span><span id="line-229"></span><span class="annot"><a href="Database.Persist.TH.html#embedEntityDefs"><span class="hs-identifier hs-type">embedEntityDefs</span></a></span><span>
</span><span id="line-230"></span><span>    </span><span class="hs-glyph">::</span><span> </span><span class="hs-special">[</span><span class="annot"><a href="Database.Persist.Types.Base.html#EntityDef"><span class="hs-identifier hs-type">EntityDef</span></a></span><span class="hs-special">]</span><span>
</span><span id="line-231"></span><span>    </span><span class="hs-comment">-- ^ A list of 'EntityDef' that have been defined in a previous 'mkPersist'</span><span>
</span><span id="line-232"></span><span>    </span><span class="hs-comment">-- call.</span><span>
</span><span id="line-233"></span><span>    </span><span class="hs-comment">--</span><span>
</span><span id="line-234"></span><span>    </span><span class="hs-comment">-- @since 2.13.0.0</span><span>
</span><span id="line-235"></span><span>    </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-special">[</span><span class="annot"><a href="Database.Persist.Quasi.Internal.html#UnboundEntityDef"><span class="hs-identifier hs-type">UnboundEntityDef</span></a></span><span class="hs-special">]</span><span>
</span><span id="line-236"></span><span>    </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-special">[</span><span class="annot"><a href="Database.Persist.Quasi.Internal.html#UnboundEntityDef"><span class="hs-identifier hs-type">UnboundEntityDef</span></a></span><span class="hs-special">]</span><span>
</span><span id="line-237"></span><span id="embedEntityDefs"><span class="annot"><span class="annottext">embedEntityDefs :: [EntityDef] -&gt; [UnboundEntityDef] -&gt; [UnboundEntityDef]
</span><a href="Database.Persist.TH.html#embedEntityDefs"><span class="hs-identifier hs-var hs-var">embedEntityDefs</span></a></span></span><span> </span><span id="local-6989586621679965471"><span class="annot"><span class="annottext">[EntityDef]
</span><a href="#local-6989586621679965471"><span class="hs-identifier hs-var">eds</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">forall a b. (a, b) -&gt; b
</span><span class="hs-identifier hs-var">snd</span></span><span> </span><span class="annot"><span class="annottext">forall b c a. (b -&gt; c) -&gt; (a -&gt; b) -&gt; a -&gt; c
</span><span class="hs-operator hs-var">.</span></span><span> </span><span class="annot"><span class="annottext">[EntityDef]
-&gt; [UnboundEntityDef] -&gt; (EmbedEntityMap, [UnboundEntityDef])
</span><a href="Database.Persist.TH.html#embedEntityDefsMap"><span class="hs-identifier hs-var">embedEntityDefsMap</span></a></span><span> </span><span class="annot"><span class="annottext">[EntityDef]
</span><a href="#local-6989586621679965471"><span class="hs-identifier hs-var">eds</span></a></span><span>
</span><span id="line-238"></span><span>
</span><span id="line-239"></span><span class="annot"><a href="Database.Persist.TH.html#embedEntityDefsMap"><span class="hs-identifier hs-type">embedEntityDefsMap</span></a></span><span>
</span><span id="line-240"></span><span>    </span><span class="hs-glyph">::</span><span> </span><span class="hs-special">[</span><span class="annot"><a href="Database.Persist.Types.Base.html#EntityDef"><span class="hs-identifier hs-type">EntityDef</span></a></span><span class="hs-special">]</span><span>
</span><span id="line-241"></span><span>    </span><span class="hs-comment">-- ^ A list of 'EntityDef' that have been defined in a previous 'mkPersist'</span><span>
</span><span id="line-242"></span><span>    </span><span class="hs-comment">-- call.</span><span>
</span><span id="line-243"></span><span>    </span><span class="hs-comment">--</span><span>
</span><span id="line-244"></span><span>    </span><span class="hs-comment">-- @since 2.13.0.0</span><span>
</span><span id="line-245"></span><span>    </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-special">[</span><span class="annot"><a href="Database.Persist.Quasi.Internal.html#UnboundEntityDef"><span class="hs-identifier hs-type">UnboundEntityDef</span></a></span><span class="hs-special">]</span><span>
</span><span id="line-246"></span><span>    </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-special">(</span><span class="annot"><a href="Database.Persist.TH.html#EmbedEntityMap"><span class="hs-identifier hs-type">EmbedEntityMap</span></a></span><span class="hs-special">,</span><span> </span><span class="hs-special">[</span><span class="annot"><a href="Database.Persist.Quasi.Internal.html#UnboundEntityDef"><span class="hs-identifier hs-type">UnboundEntityDef</span></a></span><span class="hs-special">]</span><span class="hs-special">)</span><span>
</span><span id="line-247"></span><span id="embedEntityDefsMap"><span class="annot"><span class="annottext">embedEntityDefsMap :: [EntityDef]
-&gt; [UnboundEntityDef] -&gt; (EmbedEntityMap, [UnboundEntityDef])
</span><a href="Database.Persist.TH.html#embedEntityDefsMap"><span class="hs-identifier hs-var hs-var">embedEntityDefsMap</span></a></span></span><span> </span><span id="local-6989586621679965469"><span class="annot"><span class="annottext">[EntityDef]
</span><a href="#local-6989586621679965469"><span class="hs-identifier hs-var">existingEnts</span></a></span></span><span> </span><span id="local-6989586621679965468"><span class="annot"><span class="annottext">[UnboundEntityDef]
</span><a href="#local-6989586621679965468"><span class="hs-identifier hs-var">rawEnts</span></a></span></span><span> </span><span class="hs-glyph">=</span><span>
</span><span id="line-248"></span><span>    </span><span class="hs-special">(</span><span class="annot"><span class="annottext">EmbedEntityMap
</span><a href="#local-6989586621679965467"><span class="hs-identifier hs-var">embedEntityMap</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">[UnboundEntityDef]
</span><a href="#local-6989586621679965466"><span class="hs-identifier hs-var">noCycleEnts</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-249"></span><span>  </span><span class="hs-keyword">where</span><span>
</span><span id="line-250"></span><span>    </span><span id="local-6989586621679965466"><span class="annot"><span class="annottext">noCycleEnts :: [UnboundEntityDef]
</span><a href="#local-6989586621679965466"><span class="hs-identifier hs-var hs-var">noCycleEnts</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">[UnboundEntityDef]
</span><a href="#local-6989586621679965465"><span class="hs-identifier hs-var">entsWithEmbeds</span></a></span><span>
</span><span id="line-251"></span><span>    </span><span id="local-6989586621679965467"><span class="annot"><span class="annottext">embedEntityMap :: EmbedEntityMap
</span><a href="#local-6989586621679965467"><span class="hs-identifier hs-var hs-var">embedEntityMap</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">[UnboundEntityDef] -&gt; EmbedEntityMap
</span><a href="Database.Persist.TH.html#constructEmbedEntityMap"><span class="hs-identifier hs-var">constructEmbedEntityMap</span></a></span><span> </span><span class="annot"><span class="annottext">[UnboundEntityDef]
</span><a href="#local-6989586621679965465"><span class="hs-identifier hs-var">entsWithEmbeds</span></a></span><span>
</span><span id="line-252"></span><span>    </span><span id="local-6989586621679965465"><span class="annot"><span class="annottext">entsWithEmbeds :: [UnboundEntityDef]
</span><a href="#local-6989586621679965465"><span class="hs-identifier hs-var hs-var">entsWithEmbeds</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">forall (f :: * -&gt; *) a b. Functor f =&gt; (a -&gt; b) -&gt; f a -&gt; f b
</span><span class="hs-identifier hs-var">fmap</span></span><span> </span><span class="annot"><span class="annottext">UnboundEntityDef -&gt; UnboundEntityDef
</span><a href="#local-6989586621679965463"><span class="hs-identifier hs-var">setEmbedEntity</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">[UnboundEntityDef]
</span><a href="#local-6989586621679965468"><span class="hs-identifier hs-var">rawEnts</span></a></span><span> </span><span class="annot"><span class="annottext">forall a. Semigroup a =&gt; a -&gt; a -&gt; a
</span><span class="hs-operator hs-var">&lt;&gt;</span></span><span> </span><span class="annot"><span class="annottext">forall a b. (a -&gt; b) -&gt; [a] -&gt; [b]
</span><span class="hs-identifier hs-var">map</span></span><span> </span><span class="annot"><span class="annottext">EntityDef -&gt; UnboundEntityDef
</span><a href="Database.Persist.Quasi.Internal.html#unbindEntityDef"><span class="hs-identifier hs-var">unbindEntityDef</span></a></span><span> </span><span class="annot"><span class="annottext">[EntityDef]
</span><a href="#local-6989586621679965469"><span class="hs-identifier hs-var">existingEnts</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-253"></span><span>    </span><span id="local-6989586621679965463"><span class="annot"><span class="annottext">setEmbedEntity :: UnboundEntityDef -&gt; UnboundEntityDef
</span><a href="#local-6989586621679965463"><span class="hs-identifier hs-var hs-var">setEmbedEntity</span></a></span></span><span> </span><span id="local-6989586621679965461"><span class="annot"><span class="annottext">UnboundEntityDef
</span><a href="#local-6989586621679965461"><span class="hs-identifier hs-var">ubEnt</span></a></span></span><span> </span><span class="hs-glyph">=</span><span>
</span><span id="line-254"></span><span>        </span><span class="hs-keyword">let</span><span>
</span><span id="line-255"></span><span>            </span><span id="local-6989586621679965460"><span class="annot"><span class="annottext">ent :: EntityDef
</span><a href="#local-6989586621679965460"><span class="hs-identifier hs-var hs-var">ent</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">UnboundEntityDef -&gt; EntityDef
</span><a href="Database.Persist.Quasi.Internal.html#unboundEntityDef"><span class="hs-identifier hs-var">unboundEntityDef</span></a></span><span> </span><span class="annot"><span class="annottext">UnboundEntityDef
</span><a href="#local-6989586621679965461"><span class="hs-identifier hs-var">ubEnt</span></a></span><span>
</span><span id="line-256"></span><span>        </span><span class="hs-keyword">in</span><span>
</span><span id="line-257"></span><span>            </span><span class="annot"><span class="annottext">UnboundEntityDef
</span><a href="#local-6989586621679965461"><span class="hs-identifier hs-var">ubEnt</span></a></span><span>
</span><span id="line-258"></span><span>                </span><span class="hs-special">{</span><span> </span><span class="annot"><span class="annottext">unboundEntityDef :: EntityDef
</span><a href="Database.Persist.Quasi.Internal.html#unboundEntityDef"><span class="hs-identifier hs-var">unboundEntityDef</span></a></span><span> </span><span class="hs-glyph">=</span><span>
</span><span id="line-259"></span><span>                    </span><span class="annot"><span class="annottext">([FieldDef] -&gt; [FieldDef]) -&gt; EntityDef -&gt; EntityDef
</span><a href="Database.Persist.EntityDef.html#overEntityFields"><span class="hs-identifier hs-var">overEntityFields</span></a></span><span>
</span><span id="line-260"></span><span>                        </span><span class="hs-special">(</span><span class="annot"><span class="annottext">forall (f :: * -&gt; *) a b. Functor f =&gt; (a -&gt; b) -&gt; f a -&gt; f b
</span><span class="hs-identifier hs-var">fmap</span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">forall a.
EntityNameHS -&gt; Map EntityNameHS a -&gt; FieldDef -&gt; FieldDef
</span><a href="Database.Persist.TH.html#setEmbedField"><span class="hs-identifier hs-var">setEmbedField</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">EntityDef -&gt; EntityNameHS
</span><a href="Database.Persist.Types.Base.html#entityHaskell"><span class="hs-identifier hs-var">entityHaskell</span></a></span><span> </span><span class="annot"><span class="annottext">EntityDef
</span><a href="#local-6989586621679965460"><span class="hs-identifier hs-var">ent</span></a></span><span class="hs-special">)</span><span> </span><span class="annot"><span class="annottext">EmbedEntityMap
</span><a href="#local-6989586621679965467"><span class="hs-identifier hs-var">embedEntityMap</span></a></span><span class="hs-special">)</span><span class="hs-special">)</span><span>
</span><span id="line-261"></span><span>                        </span><span class="annot"><span class="annottext">EntityDef
</span><a href="#local-6989586621679965460"><span class="hs-identifier hs-var">ent</span></a></span><span>
</span><span id="line-262"></span><span>                </span><span class="hs-special">}</span><span>
</span><span id="line-263"></span><span>
</span><span id="line-264"></span><span>
</span><span id="line-265"></span><span class="hs-comment">-- | Calls 'parse' to Quasi.parse individual entities in isolation</span><span>
</span><span id="line-266"></span><span class="hs-comment">-- afterwards, sets references to other entities</span><span>
</span><span id="line-267"></span><span class="hs-comment">--</span><span>
</span><span id="line-268"></span><span class="hs-comment">-- In 2.13.0.0, this was changed to splice in @['UnboundEntityDef']@</span><span>
</span><span id="line-269"></span><span class="hs-comment">-- instead of @['EntityDef']@.</span><span>
</span><span id="line-270"></span><span class="hs-comment">--</span><span>
</span><span id="line-271"></span><span class="hs-comment">-- @since 2.5.3</span><span>
</span><span id="line-272"></span><span class="annot"><a href="Database.Persist.TH.html#parseReferences"><span class="hs-identifier hs-type">parseReferences</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><a href="Database.Persist.Quasi.Internal.html#PersistSettings"><span class="hs-identifier hs-type">PersistSettings</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="hs-identifier hs-type">Text</span></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="hs-identifier hs-type">Q</span></span><span> </span><span class="annot"><span class="hs-identifier hs-type">Exp</span></span><span>
</span><span id="line-273"></span><span id="parseReferences"><span class="annot"><span class="annottext">parseReferences :: PersistSettings -&gt; Text -&gt; Q Exp
</span><a href="Database.Persist.TH.html#parseReferences"><span class="hs-identifier hs-var hs-var">parseReferences</span></a></span></span><span> </span><span id="local-6989586621679965455"><span class="annot"><span class="annottext">PersistSettings
</span><a href="#local-6989586621679965455"><span class="hs-identifier hs-var">ps</span></a></span></span><span> </span><span id="local-6989586621679965454"><span class="annot"><span class="annottext">Text
</span><a href="#local-6989586621679965454"><span class="hs-identifier hs-var">s</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">forall t (m :: * -&gt; *). (Lift t, Quote m) =&gt; t -&gt; m Exp
</span><span class="hs-identifier hs-var">lift</span></span><span> </span><span class="annot"><span class="annottext">forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span> </span><span class="annot"><span class="annottext">PersistSettings -&gt; Text -&gt; [UnboundEntityDef]
</span><a href="Database.Persist.Quasi.Internal.html#parse"><span class="hs-identifier hs-var">parse</span></a></span><span> </span><span class="annot"><span class="annottext">PersistSettings
</span><a href="#local-6989586621679965455"><span class="hs-identifier hs-var">ps</span></a></span><span> </span><span class="annot"><span class="annottext">Text
</span><a href="#local-6989586621679965454"><span class="hs-identifier hs-var">s</span></a></span><span>
</span><span id="line-274"></span><span>
</span><span id="line-275"></span><span class="annot"><a href="Database.Persist.TH.html#preprocessUnboundDefs"><span class="hs-identifier hs-type">preprocessUnboundDefs</span></a></span><span>
</span><span id="line-276"></span><span>    </span><span class="hs-glyph">::</span><span> </span><span class="hs-special">[</span><span class="annot"><a href="Database.Persist.Types.Base.html#EntityDef"><span class="hs-identifier hs-type">EntityDef</span></a></span><span class="hs-special">]</span><span>
</span><span id="line-277"></span><span>    </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-special">[</span><span class="annot"><a href="Database.Persist.Quasi.Internal.html#UnboundEntityDef"><span class="hs-identifier hs-type">UnboundEntityDef</span></a></span><span class="hs-special">]</span><span>
</span><span id="line-278"></span><span>    </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-special">(</span><span class="annot"><span class="hs-identifier hs-type">M.Map</span></span><span> </span><span class="annot"><a href="Database.Persist.Names.html#EntityNameHS"><span class="hs-identifier hs-type">EntityNameHS</span></a></span><span> </span><span class="hs-special">(</span><span class="hs-special">)</span><span class="hs-special">,</span><span> </span><span class="hs-special">[</span><span class="annot"><a href="Database.Persist.Quasi.Internal.html#UnboundEntityDef"><span class="hs-identifier hs-type">UnboundEntityDef</span></a></span><span class="hs-special">]</span><span class="hs-special">)</span><span>
</span><span id="line-279"></span><span id="preprocessUnboundDefs"><span class="annot"><span class="annottext">preprocessUnboundDefs :: [EntityDef]
-&gt; [UnboundEntityDef] -&gt; (EmbedEntityMap, [UnboundEntityDef])
</span><a href="Database.Persist.TH.html#preprocessUnboundDefs"><span class="hs-identifier hs-var hs-var">preprocessUnboundDefs</span></a></span></span><span> </span><span id="local-6989586621679965451"><span class="annot"><span class="annottext">[EntityDef]
</span><a href="#local-6989586621679965451"><span class="hs-identifier hs-var">preexistingEntities</span></a></span></span><span> </span><span id="local-6989586621679965450"><span class="annot"><span class="annottext">[UnboundEntityDef]
</span><a href="#local-6989586621679965450"><span class="hs-identifier hs-var">unboundDefs</span></a></span></span><span> </span><span class="hs-glyph">=</span><span>
</span><span id="line-280"></span><span>    </span><span class="hs-special">(</span><span class="annot"><span class="annottext">EmbedEntityMap
</span><a href="#local-6989586621679965449"><span class="hs-identifier hs-var">embedEntityMap</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">[UnboundEntityDef]
</span><a href="#local-6989586621679965448"><span class="hs-identifier hs-var">noCycleEnts</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-281"></span><span>  </span><span class="hs-keyword">where</span><span>
</span><span id="line-282"></span><span>    </span><span class="hs-special">(</span><span id="local-6989586621679965449"><span class="annot"><span class="annottext">EmbedEntityMap
</span><a href="#local-6989586621679965449"><span class="hs-identifier hs-var">embedEntityMap</span></a></span></span><span class="hs-special">,</span><span> </span><span id="local-6989586621679965448"><span class="annot"><span class="annottext">[UnboundEntityDef]
</span><a href="#local-6989586621679965448"><span class="hs-identifier hs-var">noCycleEnts</span></a></span></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">=</span><span>
</span><span id="line-283"></span><span>        </span><span class="annot"><span class="annottext">[EntityDef]
-&gt; [UnboundEntityDef] -&gt; (EmbedEntityMap, [UnboundEntityDef])
</span><a href="Database.Persist.TH.html#embedEntityDefsMap"><span class="hs-identifier hs-var">embedEntityDefsMap</span></a></span><span> </span><span class="annot"><span class="annottext">[EntityDef]
</span><a href="#local-6989586621679965451"><span class="hs-identifier hs-var">preexistingEntities</span></a></span><span> </span><span class="annot"><span class="annottext">[UnboundEntityDef]
</span><a href="#local-6989586621679965450"><span class="hs-identifier hs-var">unboundDefs</span></a></span><span>
</span><span id="line-284"></span><span>
</span><span id="line-285"></span><span class="annot"><a href="Database.Persist.TH.html#stripId"><span class="hs-identifier hs-type">stripId</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><a href="Database.Persist.Types.Base.html#FieldType"><span class="hs-identifier hs-type">FieldType</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="hs-identifier hs-type">Maybe</span></span><span> </span><span class="annot"><span class="hs-identifier hs-type">Text</span></span><span>
</span><span id="line-286"></span><span id="stripId"><span class="annot"><span class="annottext">stripId :: FieldType -&gt; Maybe Text
</span><a href="Database.Persist.TH.html#stripId"><span class="hs-identifier hs-var hs-var">stripId</span></a></span></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="Database.Persist.Types.Base.html#FTTypeCon"><span class="hs-identifier hs-type">FTTypeCon</span></a></span><span> </span><span class="annot"><span class="annottext">Maybe Text
</span><span class="hs-identifier hs-var">Nothing</span></span><span> </span><span id="local-6989586621679965445"><span class="annot"><span class="annottext">Text
</span><a href="#local-6989586621679965445"><span class="hs-identifier hs-var">t</span></a></span></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">Text -&gt; Text -&gt; Maybe Text
</span><span class="hs-identifier hs-var">stripSuffix</span></span><span> </span><span class="annot"><span class="annottext">Text
</span><span class="hs-string">&quot;Id&quot;</span></span><span> </span><span class="annot"><span class="annottext">Text
</span><a href="#local-6989586621679965445"><span class="hs-identifier hs-var">t</span></a></span><span>
</span><span id="line-287"></span><span class="annot"><a href="Database.Persist.TH.html#stripId"><span class="hs-identifier hs-var">stripId</span></a></span><span> </span><span class="annot"><span class="annottext">FieldType
</span><span class="hs-identifier">_</span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">forall a. Maybe a
</span><span class="hs-identifier hs-var">Nothing</span></span><span>
</span><span id="line-288"></span><span>
</span><span id="line-289"></span><span id="local-6989586621679966557"><span class="annot"><a href="Database.Persist.TH.html#liftAndFixKeys"><span class="hs-identifier hs-type">liftAndFixKeys</span></a></span><span>
</span><span id="line-290"></span><span>    </span><span class="hs-glyph">::</span><span> </span><span class="annot"><a href="Database.Persist.TH.html#MkPersistSettings"><span class="hs-identifier hs-type">MkPersistSettings</span></a></span><span>
</span><span id="line-291"></span><span>    </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="hs-identifier hs-type">M.Map</span></span><span> </span><span class="annot"><a href="Database.Persist.Names.html#EntityNameHS"><span class="hs-identifier hs-type">EntityNameHS</span></a></span><span> </span><span class="annot"><a href="#local-6989586621679966557"><span class="hs-identifier hs-type">a</span></a></span><span>
</span><span id="line-292"></span><span>    </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="Database.Persist.TH.html#EntityMap"><span class="hs-identifier hs-type">EntityMap</span></a></span><span>
</span><span id="line-293"></span><span>    </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="Database.Persist.Quasi.Internal.html#UnboundEntityDef"><span class="hs-identifier hs-type">UnboundEntityDef</span></a></span><span>
</span><span id="line-294"></span><span>    </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="hs-identifier hs-type">Q</span></span><span> </span><span class="annot"><span class="hs-identifier hs-type">Exp</span></span></span><span>
</span><span id="line-295"></span><span id="liftAndFixKeys"><span class="annot"><span class="annottext">liftAndFixKeys :: forall a.
MkPersistSettings
-&gt; Map EntityNameHS a -&gt; EntityMap -&gt; UnboundEntityDef -&gt; Q Exp
</span><a href="Database.Persist.TH.html#liftAndFixKeys"><span class="hs-identifier hs-var hs-var">liftAndFixKeys</span></a></span></span><span> </span><span id="local-6989586621679965354"><span class="annot"><span class="annottext">MkPersistSettings
</span><a href="#local-6989586621679965354"><span class="hs-identifier hs-var">mps</span></a></span></span><span> </span><span id="local-6989586621679965353"><span class="annot"><span class="annottext">Map EntityNameHS a
</span><a href="#local-6989586621679965353"><span class="hs-identifier hs-var">emEntities</span></a></span></span><span> </span><span id="local-6989586621679965352"><span class="annot"><span class="annottext">EntityMap
</span><a href="#local-6989586621679965352"><span class="hs-identifier hs-var">entityMap</span></a></span></span><span> </span><span id="local-6989586621679965351"><span class="annot"><span class="annottext">UnboundEntityDef
</span><a href="#local-6989586621679965351"><span class="hs-identifier hs-var">unboundEnt</span></a></span></span><span> </span><span class="hs-glyph">=</span><span>
</span><span id="line-296"></span><span>    </span><span class="hs-keyword">let</span><span>
</span><span id="line-297"></span><span>        </span><span id="local-6989586621679965350"><span class="annot"><span class="annottext">ent :: EntityDef
</span><a href="#local-6989586621679965350"><span class="hs-identifier hs-var hs-var">ent</span></a></span></span><span> </span><span class="hs-glyph">=</span><span>
</span><span id="line-298"></span><span>            </span><span class="annot"><span class="annottext">UnboundEntityDef -&gt; EntityDef
</span><a href="Database.Persist.Quasi.Internal.html#unboundEntityDef"><span class="hs-identifier hs-var">unboundEntityDef</span></a></span><span> </span><span class="annot"><span class="annottext">UnboundEntityDef
</span><a href="#local-6989586621679965351"><span class="hs-identifier hs-var">unboundEnt</span></a></span><span>
</span><span id="line-299"></span><span>        </span><span id="local-6989586621679965349"><span class="annot"><span class="annottext">fields :: [UnboundFieldDef]
</span><a href="#local-6989586621679965349"><span class="hs-identifier hs-var hs-var">fields</span></a></span></span><span> </span><span class="hs-glyph">=</span><span>
</span><span id="line-300"></span><span>            </span><span class="annot"><span class="annottext">UnboundEntityDef -&gt; [UnboundFieldDef]
</span><a href="Database.Persist.Quasi.Internal.html#getUnboundFieldDefs"><span class="hs-identifier hs-var">getUnboundFieldDefs</span></a></span><span> </span><span class="annot"><span class="annottext">UnboundEntityDef
</span><a href="#local-6989586621679965351"><span class="hs-identifier hs-var">unboundEnt</span></a></span><span>
</span><span id="line-301"></span><span>    </span><span class="hs-keyword">in</span><span>
</span><span id="line-302"></span><span>        </span><span class="hs-special">[|</span><span>
</span><span id="line-303"></span><span>    </span><span class="hs-identifier">ent</span><span>
</span><span id="line-304"></span><span>        </span><span class="hs-special">{</span><span> </span><span class="hs-identifier">entityFields</span><span> </span><span class="hs-glyph">=</span><span>
</span><span id="line-305"></span><span>            </span><span class="hs-special">$</span><span class="hs-special">(</span><span class="hs-identifier">ListE</span><span> </span><span class="hs-operator">&lt;$&gt;</span><span> </span><span class="hs-identifier">traverse</span><span> </span><span class="hs-identifier">combinedFixFieldDef</span><span> </span><span class="hs-identifier">fields</span><span class="hs-special">)</span><span>
</span><span id="line-306"></span><span>        </span><span class="hs-special">,</span><span> </span><span class="hs-identifier">entityId</span><span> </span><span class="hs-glyph">=</span><span>
</span><span id="line-307"></span><span>            </span><span class="hs-special">$</span><span class="hs-special">(</span><span class="hs-identifier">fixPrimarySpec</span><span> </span><span class="hs-identifier">mps</span><span> </span><span class="hs-identifier">unboundEnt</span><span class="hs-special">)</span><span>
</span><span id="line-308"></span><span>        </span><span class="hs-special">,</span><span> </span><span class="hs-identifier">entityForeigns</span><span> </span><span class="hs-glyph">=</span><span>
</span><span id="line-309"></span><span>            </span><span class="hs-special">$</span><span class="hs-special">(</span><span class="hs-identifier">fixUnboundForeignDefs</span><span> </span><span class="hs-special">(</span><span class="hs-identifier">unboundForeignDefs</span><span> </span><span class="hs-identifier">unboundEnt</span><span class="hs-special">)</span><span class="hs-special">)</span><span>
</span><span id="line-310"></span><span>        </span><span class="hs-special">}</span><span>
</span><span id="line-311"></span><span>    </span><span class="hs-special">|]</span><span>
</span><span id="line-312"></span><span>  </span><span class="hs-keyword">where</span><span>
</span><span id="line-313"></span><span>    </span><span class="annot"><a href="#local-6989586621679965347"><span class="hs-identifier hs-type">fixUnboundForeignDefs</span></a></span><span>
</span><span id="line-314"></span><span>        </span><span class="hs-glyph">::</span><span> </span><span class="hs-special">[</span><span class="annot"><a href="Database.Persist.Quasi.Internal.html#UnboundForeignDef"><span class="hs-identifier hs-type">UnboundForeignDef</span></a></span><span class="hs-special">]</span><span>
</span><span id="line-315"></span><span>        </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="hs-identifier hs-type">Q</span></span><span> </span><span class="annot"><span class="hs-identifier hs-type">Exp</span></span><span>
</span><span id="line-316"></span><span>    </span><span id="local-6989586621679965347"><span class="annot"><span class="annottext">fixUnboundForeignDefs :: [UnboundForeignDef] -&gt; Q Exp
</span><a href="#local-6989586621679965347"><span class="hs-identifier hs-var hs-var">fixUnboundForeignDefs</span></a></span></span><span> </span><span id="local-6989586621679965346"><span class="annot"><span class="annottext">[UnboundForeignDef]
</span><a href="#local-6989586621679965346"><span class="hs-identifier hs-var">fdefs</span></a></span></span><span> </span><span class="hs-glyph">=</span><span>
</span><span id="line-317"></span><span>        </span><span class="annot"><span class="annottext">forall (f :: * -&gt; *) a b. Functor f =&gt; (a -&gt; b) -&gt; f a -&gt; f b
</span><span class="hs-identifier hs-var">fmap</span></span><span> </span><span class="annot"><span class="annottext">[Exp] -&gt; Exp
</span><span class="hs-identifier hs-var">ListE</span></span><span> </span><span class="annot"><span class="annottext">forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span> </span><span class="annot"><span class="annottext">forall (t :: * -&gt; *) (m :: * -&gt; *) a b.
(Traversable t, Monad m) =&gt;
t a -&gt; (a -&gt; m b) -&gt; m (t b)
</span><span class="hs-identifier hs-var">forM</span></span><span> </span><span class="annot"><span class="annottext">[UnboundForeignDef]
</span><a href="#local-6989586621679965346"><span class="hs-identifier hs-var">fdefs</span></a></span><span> </span><span class="annot"><span class="annottext">UnboundForeignDef -&gt; Q Exp
</span><a href="#local-6989586621679965343"><span class="hs-identifier hs-var">fixUnboundForeignDef</span></a></span><span>
</span><span id="line-318"></span><span>      </span><span class="hs-keyword">where</span><span>
</span><span id="line-319"></span><span>        </span><span id="local-6989586621679965343"><span class="annot"><span class="annottext">fixUnboundForeignDef :: UnboundForeignDef -&gt; Q Exp
</span><a href="#local-6989586621679965343"><span class="hs-identifier hs-var hs-var">fixUnboundForeignDef</span></a></span></span><span> </span><span class="annot"><a href="Database.Persist.Quasi.Internal.html#UnboundForeignDef"><span class="hs-identifier hs-type">UnboundForeignDef</span></a></span><span class="hs-special">{</span><span id="local-6989586621679965340"><span id="local-6989586621679965341"><span class="annot"><span class="annottext">ForeignDef
UnboundForeignFieldList
unboundForeignDef :: UnboundForeignDef -&gt; ForeignDef
unboundForeignFields :: UnboundForeignDef -&gt; UnboundForeignFieldList
unboundForeignDef :: ForeignDef
unboundForeignFields :: UnboundForeignFieldList
</span><a href="Database.Persist.Quasi.Internal.html#unboundForeignDef"><span class="hs-glyph hs-var hs-var hs-var hs-var">..</span></a></span></span></span><span class="hs-special">}</span><span> </span><span class="hs-glyph">=</span><span>
</span><span id="line-320"></span><span>            </span><span class="hs-special">[|</span><span>
</span><span id="line-321"></span><span>            </span><span class="hs-identifier">unboundForeignDef</span><span>
</span><span id="line-322"></span><span>                </span><span class="hs-special">{</span><span> </span><span class="hs-identifier">foreignFields</span><span> </span><span class="hs-glyph">=</span><span>
</span><span id="line-323"></span><span>                    </span><span class="hs-special">$</span><span class="hs-special">(</span><span class="hs-identifier">lift</span><span> </span><span class="hs-identifier">fixForeignFields</span><span class="hs-special">)</span><span>
</span><span id="line-324"></span><span>                </span><span class="hs-special">,</span><span> </span><span class="hs-identifier">foreignNullable</span><span> </span><span class="hs-glyph">=</span><span>
</span><span id="line-325"></span><span>                    </span><span class="hs-special">$</span><span class="hs-special">(</span><span class="hs-identifier">lift</span><span> </span><span class="hs-identifier">fixForeignNullable</span><span class="hs-special">)</span><span>
</span><span id="line-326"></span><span>                </span><span class="hs-special">,</span><span> </span><span class="hs-identifier">foreignRefTableDBName</span><span> </span><span class="hs-glyph">=</span><span>
</span><span id="line-327"></span><span>                    </span><span class="hs-special">$</span><span class="hs-special">(</span><span class="hs-identifier">lift</span><span> </span><span class="hs-identifier">fixForeignRefTableDBName</span><span class="hs-special">)</span><span>
</span><span id="line-328"></span><span>                </span><span class="hs-special">}</span><span>
</span><span id="line-329"></span><span>            </span><span class="hs-special">|]</span><span>
</span><span id="line-330"></span><span>          </span><span class="hs-keyword">where</span><span>
</span><span id="line-331"></span><span>            </span><span id="local-6989586621679965337"><span class="annot"><span class="annottext">fixForeignRefTableDBName :: EntityNameDB
</span><a href="#local-6989586621679965337"><span class="hs-identifier hs-var hs-var">fixForeignRefTableDBName</span></a></span></span><span> </span><span class="hs-glyph">=</span><span>
</span><span id="line-332"></span><span>                </span><span class="annot"><span class="annottext">EntityDef -&gt; EntityNameDB
</span><a href="Database.Persist.Types.Base.html#entityDB"><span class="hs-identifier hs-var">entityDB</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">UnboundEntityDef -&gt; EntityDef
</span><a href="Database.Persist.Quasi.Internal.html#unboundEntityDef"><span class="hs-identifier hs-var">unboundEntityDef</span></a></span><span> </span><span class="annot"><span class="annottext">UnboundEntityDef
</span><a href="#local-6989586621679965335"><span class="hs-identifier hs-var">parentDef</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-333"></span><span>            </span><span id="local-6989586621679965334"><span class="annot"><span class="annottext">foreignFieldNames :: NonEmpty FieldNameHS
</span><a href="#local-6989586621679965334"><span class="hs-identifier hs-var hs-var">foreignFieldNames</span></a></span></span><span> </span><span class="hs-glyph">=</span><span>
</span><span id="line-334"></span><span>                </span><span class="hs-keyword">case</span><span> </span><span class="annot"><span class="annottext">UnboundForeignFieldList
</span><a href="#local-6989586621679965341"><span class="hs-identifier hs-var">unboundForeignFields</span></a></span><span> </span><span class="hs-keyword">of</span><span>
</span><span id="line-335"></span><span>                    </span><span class="annot"><a href="Database.Persist.Quasi.Internal.html#FieldListImpliedId"><span class="hs-identifier hs-type">FieldListImpliedId</span></a></span><span> </span><span id="local-6989586621679965332"><span class="annot"><span class="annottext">NonEmpty FieldNameHS
</span><a href="#local-6989586621679965332"><span class="hs-identifier hs-var">ffns</span></a></span></span><span> </span><span class="hs-glyph">-&gt;</span><span>
</span><span id="line-336"></span><span>                        </span><span class="annot"><span class="annottext">NonEmpty FieldNameHS
</span><a href="#local-6989586621679965332"><span class="hs-identifier hs-var">ffns</span></a></span><span>
</span><span id="line-337"></span><span>                    </span><span class="annot"><a href="Database.Persist.Quasi.Internal.html#FieldListHasReferences"><span class="hs-identifier hs-type">FieldListHasReferences</span></a></span><span> </span><span id="local-6989586621679965330"><span class="annot"><span class="annottext">NonEmpty ForeignFieldReference
</span><a href="#local-6989586621679965330"><span class="hs-identifier hs-var">references</span></a></span></span><span> </span><span class="hs-glyph">-&gt;</span><span>
</span><span id="line-338"></span><span>                        </span><span class="annot"><span class="annottext">forall (f :: * -&gt; *) a b. Functor f =&gt; (a -&gt; b) -&gt; f a -&gt; f b
</span><span class="hs-identifier hs-var">fmap</span></span><span> </span><span class="annot"><span class="annottext">ForeignFieldReference -&gt; FieldNameHS
</span><a href="Database.Persist.Quasi.Internal.html#ffrSourceField"><span class="hs-identifier hs-var">ffrSourceField</span></a></span><span> </span><span class="annot"><span class="annottext">NonEmpty ForeignFieldReference
</span><a href="#local-6989586621679965330"><span class="hs-identifier hs-var">references</span></a></span><span>
</span><span id="line-339"></span><span>            </span><span id="local-6989586621679965335"><span class="annot"><span class="annottext">parentDef :: UnboundEntityDef
</span><a href="#local-6989586621679965335"><span class="hs-identifier hs-var hs-var">parentDef</span></a></span></span><span> </span><span class="hs-glyph">=</span><span>
</span><span id="line-340"></span><span>                </span><span class="hs-keyword">case</span><span> </span><span class="annot"><span class="annottext">forall k a. Ord k =&gt; k -&gt; Map k a -&gt; Maybe a
</span><span class="hs-identifier hs-var">M.lookup</span></span><span> </span><span class="annot"><span class="annottext">EntityNameHS
</span><a href="#local-6989586621679965327"><span class="hs-identifier hs-var">parentTableName</span></a></span><span> </span><span class="annot"><span class="annottext">EntityMap
</span><a href="#local-6989586621679965352"><span class="hs-identifier hs-var">entityMap</span></a></span><span> </span><span class="hs-keyword">of</span><span>
</span><span id="line-341"></span><span>                    </span><span class="annot"><span class="annottext">Maybe UnboundEntityDef
</span><span class="hs-identifier hs-var">Nothing</span></span><span> </span><span class="hs-glyph">-&gt;</span><span>
</span><span id="line-342"></span><span>                        </span><span class="annot"><span class="annottext">forall a. HasCallStack =&gt; String -&gt; a
</span><span class="hs-identifier hs-var">error</span></span><span> </span><span class="annot"><span class="annottext">forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span> </span><span class="annot"><span class="annottext">forall a. Monoid a =&gt; [a] -&gt; a
</span><span class="hs-identifier hs-var">mconcat</span></span><span>
</span><span id="line-343"></span><span>                        </span><span class="hs-special">[</span><span> </span><span class="annot"><span class="annottext">String
</span><span class="hs-string">&quot;Foreign table not defined: &quot;</span></span><span>
</span><span id="line-344"></span><span>                        </span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">forall a. Show a =&gt; a -&gt; String
</span><span class="hs-identifier hs-var">show</span></span><span> </span><span class="annot"><span class="annottext">EntityNameHS
</span><a href="#local-6989586621679965327"><span class="hs-identifier hs-var">parentTableName</span></a></span><span>
</span><span id="line-345"></span><span>                        </span><span class="hs-special">]</span><span>
</span><span id="line-346"></span><span>                    </span><span class="annot"><span class="hs-identifier hs-type">Just</span></span><span> </span><span id="local-6989586621679965325"><span class="annot"><span class="annottext">UnboundEntityDef
</span><a href="#local-6989586621679965325"><span class="hs-identifier hs-var">a</span></a></span></span><span> </span><span class="hs-glyph">-&gt;</span><span>
</span><span id="line-347"></span><span>                        </span><span class="annot"><span class="annottext">UnboundEntityDef
</span><a href="#local-6989586621679965325"><span class="hs-identifier hs-var">a</span></a></span><span>
</span><span id="line-348"></span><span>            </span><span id="local-6989586621679965327"><span class="annot"><span class="annottext">parentTableName :: EntityNameHS
</span><a href="#local-6989586621679965327"><span class="hs-identifier hs-var hs-var">parentTableName</span></a></span></span><span> </span><span class="hs-glyph">=</span><span>
</span><span id="line-349"></span><span>                </span><span class="annot"><span class="annottext">ForeignDef -&gt; EntityNameHS
</span><a href="Database.Persist.Types.Base.html#foreignRefTableHaskell"><span class="hs-identifier hs-var">foreignRefTableHaskell</span></a></span><span> </span><span class="annot"><span class="annottext">ForeignDef
</span><a href="#local-6989586621679965340"><span class="hs-identifier hs-var">unboundForeignDef</span></a></span><span>
</span><span id="line-350"></span><span>            </span><span class="annot"><a href="#local-6989586621679965323"><span class="hs-identifier hs-type">fixForeignFields</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="hs-special">[</span><span class="hs-special">(</span><span class="annot"><a href="Database.Persist.Types.Base.html#ForeignFieldDef"><span class="hs-identifier hs-type">ForeignFieldDef</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><a href="Database.Persist.Types.Base.html#ForeignFieldDef"><span class="hs-identifier hs-type">ForeignFieldDef</span></a></span><span class="hs-special">)</span><span class="hs-special">]</span><span>
</span><span id="line-351"></span><span>            </span><span id="local-6989586621679965323"><span class="annot"><span class="annottext">fixForeignFields :: [(ForeignFieldDef, ForeignFieldDef)]
</span><a href="#local-6989586621679965323"><span class="hs-identifier hs-var hs-var">fixForeignFields</span></a></span></span><span> </span><span class="hs-glyph">=</span><span>
</span><span id="line-352"></span><span>                </span><span class="hs-keyword">case</span><span> </span><span class="annot"><span class="annottext">UnboundForeignFieldList
</span><a href="#local-6989586621679965341"><span class="hs-identifier hs-var">unboundForeignFields</span></a></span><span> </span><span class="hs-keyword">of</span><span>
</span><span id="line-353"></span><span>                    </span><span class="annot"><a href="Database.Persist.Quasi.Internal.html#FieldListImpliedId"><span class="hs-identifier hs-type">FieldListImpliedId</span></a></span><span> </span><span id="local-6989586621679965322"><span class="annot"><span class="annottext">NonEmpty FieldNameHS
</span><a href="#local-6989586621679965322"><span class="hs-identifier hs-var">ffns</span></a></span></span><span> </span><span class="hs-glyph">-&gt;</span><span>
</span><span id="line-354"></span><span>                        </span><span class="annot"><span class="annottext">[FieldNameHS] -&gt; [(ForeignFieldDef, ForeignFieldDef)]
</span><a href="#local-6989586621679965321"><span class="hs-identifier hs-var">mkReferences</span></a></span><span> </span><span class="annot"><span class="annottext">forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span> </span><span class="annot"><span class="annottext">forall (t :: * -&gt; *) a. Foldable t =&gt; t a -&gt; [a]
</span><span class="hs-identifier hs-var">toList</span></span><span> </span><span class="annot"><span class="annottext">NonEmpty FieldNameHS
</span><a href="#local-6989586621679965322"><span class="hs-identifier hs-var">ffns</span></a></span><span>
</span><span id="line-355"></span><span>                    </span><span class="annot"><a href="Database.Persist.Quasi.Internal.html#FieldListHasReferences"><span class="hs-identifier hs-type">FieldListHasReferences</span></a></span><span> </span><span id="local-6989586621679965320"><span class="annot"><span class="annottext">NonEmpty ForeignFieldReference
</span><a href="#local-6989586621679965320"><span class="hs-identifier hs-var">references</span></a></span></span><span> </span><span class="hs-glyph">-&gt;</span><span>
</span><span id="line-356"></span><span>                        </span><span class="annot"><span class="annottext">forall (t :: * -&gt; *) a. Foldable t =&gt; t a -&gt; [a]
</span><span class="hs-identifier hs-var">toList</span></span><span> </span><span class="annot"><span class="annottext">forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span> </span><span class="annot"><span class="annottext">forall (f :: * -&gt; *) a b. Functor f =&gt; (a -&gt; b) -&gt; f a -&gt; f b
</span><span class="hs-identifier hs-var">fmap</span></span><span> </span><span class="annot"><span class="annottext">ForeignFieldReference -&gt; (ForeignFieldDef, ForeignFieldDef)
</span><a href="#local-6989586621679965319"><span class="hs-identifier hs-var">convReferences</span></a></span><span> </span><span class="annot"><span class="annottext">NonEmpty ForeignFieldReference
</span><a href="#local-6989586621679965320"><span class="hs-identifier hs-var">references</span></a></span><span>
</span><span id="line-357"></span><span>              </span><span class="hs-keyword">where</span><span>
</span><span id="line-358"></span><span>                </span><span class="hs-comment">-- in this case, we're up against the implied ID of the parent</span><span>
</span><span id="line-359"></span><span>                </span><span class="hs-comment">-- dodgy assumption: columns are listed in the right order. we</span><span>
</span><span id="line-360"></span><span>                </span><span class="hs-comment">-- can't check this any more clearly right now.</span><span>
</span><span id="line-361"></span><span>                </span><span id="local-6989586621679965321"><span class="annot"><span class="annottext">mkReferences :: [FieldNameHS] -&gt; [(ForeignFieldDef, ForeignFieldDef)]
</span><a href="#local-6989586621679965321"><span class="hs-identifier hs-var hs-var">mkReferences</span></a></span></span><span> </span><span id="local-6989586621679965318"><span class="annot"><span class="annottext">[FieldNameHS]
</span><a href="#local-6989586621679965318"><span class="hs-identifier hs-var">fieldNames</span></a></span></span><span>
</span><span id="line-362"></span><span>                    </span><span class="hs-glyph">|</span><span> </span><span class="annot"><span class="annottext">forall (t :: * -&gt; *) a. Foldable t =&gt; t a -&gt; Int
</span><span class="hs-identifier hs-var">length</span></span><span> </span><span class="annot"><span class="annottext">[FieldNameHS]
</span><a href="#local-6989586621679965318"><span class="hs-identifier hs-var">fieldNames</span></a></span><span> </span><span class="annot"><span class="annottext">forall a. Eq a =&gt; a -&gt; a -&gt; Bool
</span><span class="hs-operator hs-var">/=</span></span><span> </span><span class="annot"><span class="annottext">forall (t :: * -&gt; *) a. Foldable t =&gt; t a -&gt; Int
</span><span class="hs-identifier hs-var">length</span></span><span> </span><span class="annot"><span class="annottext">[ForeignFieldDef]
</span><a href="#local-6989586621679965315"><span class="hs-identifier hs-var">parentKeyFieldNames</span></a></span><span> </span><span class="hs-glyph">=</span><span>
</span><span id="line-363"></span><span>                        </span><span class="annot"><span class="annottext">forall a. HasCallStack =&gt; String -&gt; a
</span><span class="hs-identifier hs-var">error</span></span><span> </span><span class="annot"><span class="annottext">forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span> </span><span class="annot"><span class="annottext">forall a. Monoid a =&gt; [a] -&gt; a
</span><span class="hs-identifier hs-var">mconcat</span></span><span>
</span><span id="line-364"></span><span>                            </span><span class="hs-special">[</span><span> </span><span class="annot"><span class="annottext">String
</span><span class="hs-string">&quot;Foreign reference needs to have the same number &quot;</span></span><span>
</span><span id="line-365"></span><span>                            </span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">String
</span><span class="hs-string">&quot;of fields as the target table.&quot;</span></span><span>
</span><span id="line-366"></span><span>                            </span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">String
</span><span class="hs-string">&quot;\n  Table        : &quot;</span></span><span>
</span><span id="line-367"></span><span>                            </span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">forall a. Show a =&gt; a -&gt; String
</span><span class="hs-identifier hs-var">show</span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">UnboundEntityDef -&gt; EntityNameHS
</span><a href="Database.Persist.Quasi.Internal.html#getUnboundEntityNameHS"><span class="hs-identifier hs-var">getUnboundEntityNameHS</span></a></span><span> </span><span class="annot"><span class="annottext">UnboundEntityDef
</span><a href="#local-6989586621679965351"><span class="hs-identifier hs-var">unboundEnt</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-368"></span><span>                            </span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">String
</span><span class="hs-string">&quot;\n  Foreign Table: &quot;</span></span><span>
</span><span id="line-369"></span><span>                            </span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">forall a. Show a =&gt; a -&gt; String
</span><span class="hs-identifier hs-var">show</span></span><span> </span><span class="annot"><span class="annottext">EntityNameHS
</span><a href="#local-6989586621679965327"><span class="hs-identifier hs-var">parentTableName</span></a></span><span>
</span><span id="line-370"></span><span>                            </span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">String
</span><span class="hs-string">&quot;\n  Fields       : &quot;</span></span><span>
</span><span id="line-371"></span><span>                            </span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">forall a. Show a =&gt; a -&gt; String
</span><span class="hs-identifier hs-var">show</span></span><span> </span><span class="annot"><span class="annottext">[FieldNameHS]
</span><a href="#local-6989586621679965318"><span class="hs-identifier hs-var">fieldNames</span></a></span><span>
</span><span id="line-372"></span><span>                            </span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">String
</span><span class="hs-string">&quot;\n  Parent fields: &quot;</span></span><span>
</span><span id="line-373"></span><span>                            </span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">forall a. Show a =&gt; a -&gt; String
</span><span class="hs-identifier hs-var">show</span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">forall (f :: * -&gt; *) a b. Functor f =&gt; (a -&gt; b) -&gt; f a -&gt; f b
</span><span class="hs-identifier hs-var">fmap</span></span><span> </span><span class="annot"><span class="annottext">forall a b. (a, b) -&gt; a
</span><span class="hs-identifier hs-var">fst</span></span><span> </span><span class="annot"><span class="annottext">[ForeignFieldDef]
</span><a href="#local-6989586621679965315"><span class="hs-identifier hs-var">parentKeyFieldNames</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-374"></span><span>                            </span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">String
</span><span class="hs-string">&quot;\n\nYou can use the References keyword to fix this.&quot;</span></span><span>
</span><span id="line-375"></span><span>                            </span><span class="hs-special">]</span><span>
</span><span id="line-376"></span><span>                    </span><span class="hs-glyph">|</span><span> </span><span class="annot"><span class="annottext">Bool
</span><span class="hs-identifier hs-var">otherwise</span></span><span> </span><span class="hs-glyph">=</span><span>
</span><span id="line-377"></span><span>                        </span><span class="annot"><span class="annottext">forall a b. [a] -&gt; [b] -&gt; [(a, b)]
</span><span class="hs-identifier hs-var">zip</span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">forall (f :: * -&gt; *) a b. Functor f =&gt; (a -&gt; b) -&gt; f a -&gt; f b
</span><span class="hs-identifier hs-var">fmap</span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">FieldStore -&gt; FieldNameHS -&gt; ForeignFieldDef
</span><a href="#local-6989586621679965313"><span class="hs-identifier hs-var">withDbName</span></a></span><span> </span><span class="annot"><span class="annottext">FieldStore
</span><a href="#local-6989586621679965312"><span class="hs-identifier hs-var">fieldStore</span></a></span><span class="hs-special">)</span><span> </span><span class="annot"><span class="annottext">[FieldNameHS]
</span><a href="#local-6989586621679965318"><span class="hs-identifier hs-var">fieldNames</span></a></span><span class="hs-special">)</span><span> </span><span class="annot"><span class="annottext">[ForeignFieldDef]
</span><a href="#local-6989586621679965315"><span class="hs-identifier hs-var">parentKeyFieldNames</span></a></span><span>
</span><span id="line-378"></span><span>                  </span><span class="hs-keyword">where</span><span>
</span><span id="line-379"></span><span>                    </span><span class="annot"><a href="#local-6989586621679965315"><span class="hs-identifier hs-type">parentKeyFieldNames</span></a></span><span>
</span><span id="line-380"></span><span>                        </span><span class="hs-glyph">::</span><span> </span><span class="hs-special">[</span><span class="hs-special">(</span><span class="annot"><a href="Database.Persist.Names.html#FieldNameHS"><span class="hs-identifier hs-type">FieldNameHS</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><a href="Database.Persist.Names.html#FieldNameDB"><span class="hs-identifier hs-type">FieldNameDB</span></a></span><span class="hs-special">)</span><span class="hs-special">]</span><span>
</span><span id="line-381"></span><span>                    </span><span id="local-6989586621679965315"><span class="annot"><span class="annottext">parentKeyFieldNames :: [ForeignFieldDef]
</span><a href="#local-6989586621679965315"><span class="hs-identifier hs-var hs-var">parentKeyFieldNames</span></a></span></span><span> </span><span class="hs-glyph">=</span><span>
</span><span id="line-382"></span><span>                        </span><span class="hs-keyword">case</span><span> </span><span class="annot"><span class="annottext">UnboundEntityDef -&gt; PrimarySpec
</span><a href="Database.Persist.Quasi.Internal.html#unboundPrimarySpec"><span class="hs-identifier hs-var">unboundPrimarySpec</span></a></span><span> </span><span class="annot"><span class="annottext">UnboundEntityDef
</span><a href="#local-6989586621679965335"><span class="hs-identifier hs-var">parentDef</span></a></span><span> </span><span class="hs-keyword">of</span><span>
</span><span id="line-383"></span><span>                            </span><span class="annot"><a href="Database.Persist.Quasi.Internal.html#NaturalKey"><span class="hs-identifier hs-type">NaturalKey</span></a></span><span> </span><span id="local-6989586621679965309"><span class="annot"><span class="annottext">UnboundCompositeDef
</span><a href="#local-6989586621679965309"><span class="hs-identifier hs-var">ucd</span></a></span></span><span> </span><span class="hs-glyph">-&gt;</span><span>
</span><span id="line-384"></span><span>                                </span><span class="annot"><span class="annottext">forall (f :: * -&gt; *) a b. Functor f =&gt; (a -&gt; b) -&gt; f a -&gt; f b
</span><span class="hs-identifier hs-var">fmap</span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">FieldStore -&gt; FieldNameHS -&gt; ForeignFieldDef
</span><a href="#local-6989586621679965313"><span class="hs-identifier hs-var">withDbName</span></a></span><span> </span><span class="annot"><span class="annottext">FieldStore
</span><a href="#local-6989586621679965308"><span class="hs-identifier hs-var">parentFieldStore</span></a></span><span class="hs-special">)</span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">UnboundCompositeDef -&gt; [FieldNameHS]
</span><a href="Database.Persist.Quasi.Internal.html#unboundCompositeCols"><span class="hs-identifier hs-var">unboundCompositeCols</span></a></span><span> </span><span class="annot"><span class="annottext">UnboundCompositeDef
</span><a href="#local-6989586621679965309"><span class="hs-identifier hs-var">ucd</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-385"></span><span>                            </span><span class="annot"><a href="Database.Persist.Quasi.Internal.html#SurrogateKey"><span class="hs-identifier hs-type">SurrogateKey</span></a></span><span> </span><span id="local-6989586621679965305"><span class="annot"><span class="annottext">UnboundIdDef
</span><a href="#local-6989586621679965305"><span class="hs-identifier hs-var">uid</span></a></span></span><span> </span><span class="hs-glyph">-&gt;</span><span>
</span><span id="line-386"></span><span>                                </span><span class="hs-special">[</span><span class="hs-special">(</span><span class="annot"><span class="annottext">Text -&gt; FieldNameHS
</span><a href="Database.Persist.Names.html#FieldNameHS"><span class="hs-identifier hs-var">FieldNameHS</span></a></span><span> </span><span class="annot"><span class="annottext">Text
</span><span class="hs-string">&quot;Id&quot;</span></span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">UnboundIdDef -&gt; FieldNameDB
</span><a href="Database.Persist.Quasi.Internal.html#unboundIdDBName"><span class="hs-identifier hs-var">unboundIdDBName</span></a></span><span>  </span><span class="annot"><span class="annottext">UnboundIdDef
</span><a href="#local-6989586621679965305"><span class="hs-identifier hs-var">uid</span></a></span><span class="hs-special">)</span><span class="hs-special">]</span><span>
</span><span id="line-387"></span><span>                            </span><span class="annot"><a href="Database.Persist.Quasi.Internal.html#DefaultKey"><span class="hs-identifier hs-type">DefaultKey</span></a></span><span> </span><span id="local-6989586621679965301"><span class="annot"><span class="annottext">FieldNameDB
</span><a href="#local-6989586621679965301"><span class="hs-identifier hs-var">dbName</span></a></span></span><span> </span><span class="hs-glyph">-&gt;</span><span>
</span><span id="line-388"></span><span>                                </span><span class="hs-special">[</span><span class="hs-special">(</span><span class="annot"><span class="annottext">Text -&gt; FieldNameHS
</span><a href="Database.Persist.Names.html#FieldNameHS"><span class="hs-identifier hs-var">FieldNameHS</span></a></span><span> </span><span class="annot"><span class="annottext">Text
</span><span class="hs-string">&quot;Id&quot;</span></span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">FieldNameDB
</span><a href="#local-6989586621679965301"><span class="hs-identifier hs-var">dbName</span></a></span><span class="hs-special">)</span><span class="hs-special">]</span><span>
</span><span id="line-389"></span><span>                </span><span id="local-6989586621679965313"><span class="annot"><span class="annottext">withDbName :: FieldStore -&gt; FieldNameHS -&gt; ForeignFieldDef
</span><a href="#local-6989586621679965313"><span class="hs-identifier hs-var hs-var">withDbName</span></a></span></span><span> </span><span id="local-6989586621679965300"><span class="annot"><span class="annottext">FieldStore
</span><a href="#local-6989586621679965300"><span class="hs-identifier hs-var">store</span></a></span></span><span> </span><span id="local-6989586621679965299"><span class="annot"><span class="annottext">FieldNameHS
</span><a href="#local-6989586621679965299"><span class="hs-identifier hs-var">fieldNameHS</span></a></span></span><span> </span><span class="hs-glyph">=</span><span>
</span><span id="line-390"></span><span>                    </span><span class="hs-special">(</span><span> </span><span class="annot"><span class="annottext">FieldNameHS
</span><a href="#local-6989586621679965299"><span class="hs-identifier hs-var">fieldNameHS</span></a></span><span>
</span><span id="line-391"></span><span>                    </span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">FieldStore -&gt; FieldNameHS -&gt; FieldNameDB
</span><a href="#local-6989586621679965298"><span class="hs-identifier hs-var">findDBName</span></a></span><span> </span><span class="annot"><span class="annottext">FieldStore
</span><a href="#local-6989586621679965300"><span class="hs-identifier hs-var">store</span></a></span><span> </span><span class="annot"><span class="annottext">FieldNameHS
</span><a href="#local-6989586621679965299"><span class="hs-identifier hs-var">fieldNameHS</span></a></span><span>
</span><span id="line-392"></span><span>                    </span><span class="hs-special">)</span><span>
</span><span id="line-393"></span><span>                </span><span class="annot"><a href="#local-6989586621679965319"><span class="hs-identifier hs-type">convReferences</span></a></span><span>
</span><span id="line-394"></span><span>                    </span><span class="hs-glyph">::</span><span> </span><span class="annot"><a href="Database.Persist.Quasi.Internal.html#ForeignFieldReference"><span class="hs-identifier hs-type">ForeignFieldReference</span></a></span><span>
</span><span id="line-395"></span><span>                    </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-special">(</span><span class="annot"><a href="Database.Persist.Types.Base.html#ForeignFieldDef"><span class="hs-identifier hs-type">ForeignFieldDef</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><a href="Database.Persist.Types.Base.html#ForeignFieldDef"><span class="hs-identifier hs-type">ForeignFieldDef</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-396"></span><span>                </span><span id="local-6989586621679965319"><span class="annot"><span class="annottext">convReferences :: ForeignFieldReference -&gt; (ForeignFieldDef, ForeignFieldDef)
</span><a href="#local-6989586621679965319"><span class="hs-identifier hs-var hs-var">convReferences</span></a></span></span><span> </span><span class="annot"><a href="Database.Persist.Quasi.Internal.html#ForeignFieldReference"><span class="hs-identifier hs-type">ForeignFieldReference</span></a></span><span> </span><span class="hs-special">{</span><span id="local-6989586621679965295"><span id="local-6989586621679965296"><span class="annot"><span class="annottext">FieldNameHS
ffrTargetField :: ForeignFieldReference -&gt; FieldNameHS
ffrTargetField :: FieldNameHS
ffrSourceField :: FieldNameHS
ffrSourceField :: ForeignFieldReference -&gt; FieldNameHS
</span><a href="Database.Persist.Quasi.Internal.html#ffrTargetField"><span class="hs-glyph hs-var hs-var hs-var hs-var">..</span></a></span></span></span><span class="hs-special">}</span><span> </span><span class="hs-glyph">=</span><span>
</span><span id="line-397"></span><span>                    </span><span class="hs-special">(</span><span> </span><span class="annot"><span class="annottext">FieldStore -&gt; FieldNameHS -&gt; ForeignFieldDef
</span><a href="#local-6989586621679965313"><span class="hs-identifier hs-var">withDbName</span></a></span><span> </span><span class="annot"><span class="annottext">FieldStore
</span><a href="#local-6989586621679965312"><span class="hs-identifier hs-var">fieldStore</span></a></span><span> </span><span class="annot"><span class="annottext">FieldNameHS
</span><a href="#local-6989586621679965296"><span class="hs-identifier hs-var">ffrSourceField</span></a></span><span>
</span><span id="line-398"></span><span>                    </span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">FieldStore -&gt; FieldNameHS -&gt; ForeignFieldDef
</span><a href="#local-6989586621679965313"><span class="hs-identifier hs-var">withDbName</span></a></span><span> </span><span class="annot"><span class="annottext">FieldStore
</span><a href="#local-6989586621679965308"><span class="hs-identifier hs-var">parentFieldStore</span></a></span><span> </span><span class="annot"><span class="annottext">FieldNameHS
</span><a href="#local-6989586621679965295"><span class="hs-identifier hs-var">ffrTargetField</span></a></span><span>
</span><span id="line-399"></span><span>                    </span><span class="hs-special">)</span><span>
</span><span id="line-400"></span><span>            </span><span id="local-6989586621679965293"><span class="annot"><span class="annottext">fixForeignNullable :: Bool
</span><a href="#local-6989586621679965293"><span class="hs-identifier hs-var hs-var">fixForeignNullable</span></a></span></span><span> </span><span class="hs-glyph">=</span><span>
</span><span id="line-401"></span><span>                </span><span class="annot"><span class="annottext">forall (t :: * -&gt; *) a. Foldable t =&gt; (a -&gt; Bool) -&gt; t a -&gt; Bool
</span><span class="hs-identifier hs-var">all</span></span><span> </span><span class="hs-special">(</span><span class="hs-special">(</span><span class="annot"><span class="annottext">IsNullable
</span><a href="Database.Persist.Types.Base.html#NotNullable"><span class="hs-identifier hs-var">NotNullable</span></a></span><span> </span><span class="annot"><span class="annottext">forall a. Eq a =&gt; a -&gt; a -&gt; Bool
</span><span class="hs-operator hs-var">/=</span></span><span class="hs-special">)</span><span> </span><span class="annot"><span class="annottext">forall b c a. (b -&gt; c) -&gt; (a -&gt; b) -&gt; a -&gt; c
</span><span class="hs-operator hs-var">.</span></span><span> </span><span class="annot"><span class="annottext">FieldNameHS -&gt; IsNullable
</span><a href="#local-6989586621679965290"><span class="hs-identifier hs-var">isForeignNullable</span></a></span><span class="hs-special">)</span><span> </span><span class="annot"><span class="annottext">NonEmpty FieldNameHS
</span><a href="#local-6989586621679965334"><span class="hs-identifier hs-var">foreignFieldNames</span></a></span><span>
</span><span id="line-402"></span><span>              </span><span class="hs-keyword">where</span><span>
</span><span id="line-403"></span><span>                </span><span id="local-6989586621679965290"><span class="annot"><span class="annottext">isForeignNullable :: FieldNameHS -&gt; IsNullable
</span><a href="#local-6989586621679965290"><span class="hs-identifier hs-var hs-var">isForeignNullable</span></a></span></span><span> </span><span id="local-6989586621679965289"><span class="annot"><span class="annottext">FieldNameHS
</span><a href="#local-6989586621679965289"><span class="hs-identifier hs-var">fieldNameHS</span></a></span></span><span> </span><span class="hs-glyph">=</span><span>
</span><span id="line-404"></span><span>                    </span><span class="hs-keyword">case</span><span> </span><span class="annot"><span class="annottext">FieldNameHS -&gt; FieldStore -&gt; Maybe UnboundFieldDef
</span><a href="Database.Persist.TH.html#getFieldDef"><span class="hs-identifier hs-var">getFieldDef</span></a></span><span> </span><span class="annot"><span class="annottext">FieldNameHS
</span><a href="#local-6989586621679965289"><span class="hs-identifier hs-var">fieldNameHS</span></a></span><span> </span><span class="annot"><span class="annottext">FieldStore
</span><a href="#local-6989586621679965312"><span class="hs-identifier hs-var">fieldStore</span></a></span><span> </span><span class="hs-keyword">of</span><span>
</span><span id="line-405"></span><span>                        </span><span class="annot"><span class="annottext">Maybe UnboundFieldDef
</span><span class="hs-identifier hs-var">Nothing</span></span><span> </span><span class="hs-glyph">-&gt;</span><span>
</span><span id="line-406"></span><span>                            </span><span class="annot"><span class="annottext">forall a. HasCallStack =&gt; String -&gt; a
</span><span class="hs-identifier hs-var">error</span></span><span> </span><span class="annot"><span class="annottext">String
</span><span class="hs-string">&quot;Field name not present in map&quot;</span></span><span>
</span><span id="line-407"></span><span>                        </span><span class="annot"><span class="hs-identifier hs-type">Just</span></span><span> </span><span id="local-6989586621679965287"><span class="annot"><span class="annottext">UnboundFieldDef
</span><a href="#local-6989586621679965287"><span class="hs-identifier hs-var">a</span></a></span></span><span> </span><span class="hs-glyph">-&gt;</span><span>
</span><span id="line-408"></span><span>                            </span><span class="annot"><span class="annottext">UnboundFieldDef -&gt; IsNullable
</span><a href="Database.Persist.Quasi.Internal.html#isUnboundFieldNullable"><span class="hs-identifier hs-var">isUnboundFieldNullable</span></a></span><span> </span><span class="annot"><span class="annottext">UnboundFieldDef
</span><a href="#local-6989586621679965287"><span class="hs-identifier hs-var">a</span></a></span><span>
</span><span id="line-409"></span><span>
</span><span id="line-410"></span><span>            </span><span id="local-6989586621679965312"><span class="annot"><span class="annottext">fieldStore :: FieldStore
</span><a href="#local-6989586621679965312"><span class="hs-identifier hs-var hs-var">fieldStore</span></a></span></span><span> </span><span class="hs-glyph">=</span><span>
</span><span id="line-411"></span><span>                </span><span class="annot"><span class="annottext">UnboundEntityDef -&gt; FieldStore
</span><a href="Database.Persist.TH.html#mkFieldStore"><span class="hs-identifier hs-var">mkFieldStore</span></a></span><span> </span><span class="annot"><span class="annottext">UnboundEntityDef
</span><a href="#local-6989586621679965351"><span class="hs-identifier hs-var">unboundEnt</span></a></span><span>
</span><span id="line-412"></span><span>            </span><span id="local-6989586621679965308"><span class="annot"><span class="annottext">parentFieldStore :: FieldStore
</span><a href="#local-6989586621679965308"><span class="hs-identifier hs-var hs-var">parentFieldStore</span></a></span></span><span> </span><span class="hs-glyph">=</span><span>
</span><span id="line-413"></span><span>                </span><span class="annot"><span class="annottext">UnboundEntityDef -&gt; FieldStore
</span><a href="Database.Persist.TH.html#mkFieldStore"><span class="hs-identifier hs-var">mkFieldStore</span></a></span><span> </span><span class="annot"><span class="annottext">UnboundEntityDef
</span><a href="#local-6989586621679965335"><span class="hs-identifier hs-var">parentDef</span></a></span><span>
</span><span id="line-414"></span><span>            </span><span id="local-6989586621679965298"><span class="annot"><span class="annottext">findDBName :: FieldStore -&gt; FieldNameHS -&gt; FieldNameDB
</span><a href="#local-6989586621679965298"><span class="hs-identifier hs-var hs-var">findDBName</span></a></span></span><span> </span><span id="local-6989586621679965278"><span class="annot"><span class="annottext">FieldStore
</span><a href="#local-6989586621679965278"><span class="hs-identifier hs-var">store</span></a></span></span><span> </span><span id="local-6989586621679965277"><span class="annot"><span class="annottext">FieldNameHS
</span><a href="#local-6989586621679965277"><span class="hs-identifier hs-var">fieldNameHS</span></a></span></span><span> </span><span class="hs-glyph">=</span><span>
</span><span id="line-415"></span><span>                </span><span class="hs-keyword">case</span><span> </span><span class="annot"><span class="annottext">FieldNameHS -&gt; FieldStore -&gt; Maybe FieldNameDB
</span><a href="Database.Persist.TH.html#getFieldDBName"><span class="hs-identifier hs-var">getFieldDBName</span></a></span><span> </span><span class="annot"><span class="annottext">FieldNameHS
</span><a href="#local-6989586621679965277"><span class="hs-identifier hs-var">fieldNameHS</span></a></span><span> </span><span class="annot"><span class="annottext">FieldStore
</span><a href="#local-6989586621679965278"><span class="hs-identifier hs-var">store</span></a></span><span> </span><span class="hs-keyword">of</span><span>
</span><span id="line-416"></span><span>                    </span><span class="annot"><span class="annottext">Maybe FieldNameDB
</span><span class="hs-identifier hs-var">Nothing</span></span><span> </span><span class="hs-glyph">-&gt;</span><span>
</span><span id="line-417"></span><span>                        </span><span class="annot"><span class="annottext">forall a. HasCallStack =&gt; String -&gt; a
</span><span class="hs-identifier hs-var">error</span></span><span> </span><span class="annot"><span class="annottext">forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span> </span><span class="annot"><span class="annottext">forall a. Monoid a =&gt; [a] -&gt; a
</span><span class="hs-identifier hs-var">mconcat</span></span><span>
</span><span id="line-418"></span><span>                            </span><span class="hs-special">[</span><span> </span><span class="annot"><span class="annottext">String
</span><span class="hs-string">&quot;findDBName: failed to fix dbname for: &quot;</span></span><span>
</span><span id="line-419"></span><span>                            </span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">forall a. Show a =&gt; a -&gt; String
</span><span class="hs-identifier hs-var">show</span></span><span> </span><span class="annot"><span class="annottext">FieldNameHS
</span><a href="#local-6989586621679965277"><span class="hs-identifier hs-var">fieldNameHS</span></a></span><span>
</span><span id="line-420"></span><span>                            </span><span class="hs-special">]</span><span>
</span><span id="line-421"></span><span>                    </span><span class="annot"><span class="hs-identifier hs-type">Just</span></span><span> </span><span id="local-6989586621679965275"><span class="annot"><span class="annottext">FieldNameDB
</span><a href="#local-6989586621679965275"><span class="hs-identifier hs-var">a</span></a></span></span><span class="hs-glyph">-&gt;</span><span>
</span><span id="line-422"></span><span>                        </span><span class="annot"><span class="annottext">FieldNameDB
</span><a href="#local-6989586621679965275"><span class="hs-identifier hs-var">a</span></a></span><span>
</span><span id="line-423"></span><span>
</span><span id="line-424"></span><span>    </span><span class="annot"><a href="#local-6989586621679965274"><span class="hs-identifier hs-type">combinedFixFieldDef</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><a href="Database.Persist.Quasi.Internal.html#UnboundFieldDef"><span class="hs-identifier hs-type">UnboundFieldDef</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="hs-identifier hs-type">Q</span></span><span> </span><span class="annot"><span class="hs-identifier hs-type">Exp</span></span><span>
</span><span id="line-425"></span><span>    </span><span id="local-6989586621679965274"><span class="annot"><span class="annottext">combinedFixFieldDef :: UnboundFieldDef -&gt; Q Exp
</span><a href="#local-6989586621679965274"><span class="hs-identifier hs-var hs-var">combinedFixFieldDef</span></a></span></span><span> </span><span id="local-6989586621679965273"><span class="annot"><span class="annottext">ufd :: UnboundFieldDef
</span><a href="#local-6989586621679965273"><span class="hs-identifier hs-var">ufd</span></a></span></span><span class="hs-glyph">@</span><span class="annot"><a href="Database.Persist.Quasi.Internal.html#UnboundFieldDef"><span class="hs-identifier hs-type">UnboundFieldDef</span></a></span><span class="hs-special">{</span><span id="local-6989586621679965264"><span id="local-6989586621679965265"><span id="local-6989586621679965266"><span id="local-6989586621679965267"><span id="local-6989586621679965268"><span id="local-6989586621679965269"><span id="local-6989586621679965270"><span id="local-6989586621679965271"><span class="annot"><span class="annottext">Bool
[FieldAttr]
Maybe Text
FieldNameHS
FieldNameDB
FieldCascade
FieldType
unboundFieldComments :: UnboundFieldDef -&gt; Maybe Text
unboundFieldGenerated :: UnboundFieldDef -&gt; Maybe Text
unboundFieldCascade :: UnboundFieldDef -&gt; FieldCascade
unboundFieldType :: UnboundFieldDef -&gt; FieldType
unboundFieldStrict :: UnboundFieldDef -&gt; Bool
unboundFieldAttrs :: UnboundFieldDef -&gt; [FieldAttr]
unboundFieldNameDB :: UnboundFieldDef -&gt; FieldNameDB
unboundFieldNameHS :: UnboundFieldDef -&gt; FieldNameHS
unboundFieldComments :: Maybe Text
unboundFieldGenerated :: Maybe Text
unboundFieldCascade :: FieldCascade
unboundFieldType :: FieldType
unboundFieldStrict :: Bool
unboundFieldAttrs :: [FieldAttr]
unboundFieldNameDB :: FieldNameDB
unboundFieldNameHS :: FieldNameHS
</span><a href="Database.Persist.Quasi.Internal.html#unboundFieldComments"><span class="hs-glyph hs-var hs-var hs-var hs-var hs-var hs-var hs-var hs-var hs-var hs-var hs-var hs-var hs-var hs-var hs-var hs-var">..</span></a></span></span></span></span></span></span></span></span></span><span class="hs-special">}</span><span> </span><span class="hs-glyph">=</span><span>
</span><span id="line-426"></span><span>        </span><span class="hs-special">[|</span><span>
</span><span id="line-427"></span><span>        </span><span class="hs-identifier">FieldDef</span><span>
</span><span id="line-428"></span><span>            </span><span class="hs-special">{</span><span> </span><span class="hs-identifier">fieldHaskell</span><span> </span><span class="hs-glyph">=</span><span>
</span><span id="line-429"></span><span>                </span><span class="hs-identifier">unboundFieldNameHS</span><span>
</span><span id="line-430"></span><span>            </span><span class="hs-special">,</span><span> </span><span class="hs-identifier">fieldDB</span><span> </span><span class="hs-glyph">=</span><span>
</span><span id="line-431"></span><span>                </span><span class="hs-identifier">unboundFieldNameDB</span><span>
</span><span id="line-432"></span><span>            </span><span class="hs-special">,</span><span> </span><span class="hs-identifier">fieldType</span><span> </span><span class="hs-glyph">=</span><span>
</span><span id="line-433"></span><span>                </span><span class="hs-identifier">unboundFieldType</span><span>
</span><span id="line-434"></span><span>            </span><span class="hs-special">,</span><span> </span><span class="hs-identifier">fieldSqlType</span><span> </span><span class="hs-glyph">=</span><span>
</span><span id="line-435"></span><span>                </span><span class="hs-special">$</span><span class="hs-special">(</span><span class="hs-identifier">sqlTyp'</span><span class="hs-special">)</span><span>
</span><span id="line-436"></span><span>            </span><span class="hs-special">,</span><span> </span><span class="hs-identifier">fieldAttrs</span><span> </span><span class="hs-glyph">=</span><span>
</span><span id="line-437"></span><span>                </span><span class="hs-identifier">unboundFieldAttrs</span><span>
</span><span id="line-438"></span><span>            </span><span class="hs-special">,</span><span> </span><span class="hs-identifier">fieldStrict</span><span> </span><span class="hs-glyph">=</span><span>
</span><span id="line-439"></span><span>                </span><span class="hs-identifier">unboundFieldStrict</span><span>
</span><span id="line-440"></span><span>            </span><span class="hs-special">,</span><span> </span><span class="hs-identifier">fieldReference</span><span> </span><span class="hs-glyph">=</span><span>
</span><span id="line-441"></span><span>                </span><span class="hs-special">$</span><span class="hs-special">(</span><span class="hs-identifier">fieldRef'</span><span class="hs-special">)</span><span>
</span><span id="line-442"></span><span>            </span><span class="hs-special">,</span><span> </span><span class="hs-identifier">fieldCascade</span><span> </span><span class="hs-glyph">=</span><span>
</span><span id="line-443"></span><span>                </span><span class="hs-identifier">unboundFieldCascade</span><span>
</span><span id="line-444"></span><span>            </span><span class="hs-special">,</span><span> </span><span class="hs-identifier">fieldComments</span><span> </span><span class="hs-glyph">=</span><span>
</span><span id="line-445"></span><span>                </span><span class="hs-identifier">unboundFieldComments</span><span>
</span><span id="line-446"></span><span>            </span><span class="hs-special">,</span><span> </span><span class="hs-identifier">fieldGenerated</span><span> </span><span class="hs-glyph">=</span><span>
</span><span id="line-447"></span><span>                </span><span class="hs-identifier">unboundFieldGenerated</span><span>
</span><span id="line-448"></span><span>            </span><span class="hs-special">,</span><span> </span><span class="hs-identifier">fieldIsImplicitIdColumn</span><span> </span><span class="hs-glyph">=</span><span>
</span><span id="line-449"></span><span>                </span><span class="hs-identifier">False</span><span>
</span><span id="line-450"></span><span>            </span><span class="hs-special">}</span><span>
</span><span id="line-451"></span><span>        </span><span class="hs-special">|]</span><span>
</span><span id="line-452"></span><span>      </span><span class="hs-keyword">where</span><span>
</span><span id="line-453"></span><span>        </span><span id="local-6989586621679965255"><span class="annot"><span class="annottext">sqlTypeExp :: SqlTypeExp
</span><a href="#local-6989586621679965255"><span class="hs-identifier hs-var hs-var">sqlTypeExp</span></a></span></span><span> </span><span class="hs-glyph">=</span><span>
</span><span id="line-454"></span><span>            </span><span class="annot"><span class="annottext">forall a.
Map EntityNameHS a -&gt; EntityMap -&gt; UnboundFieldDef -&gt; SqlTypeExp
</span><a href="Database.Persist.TH.html#getSqlType"><span class="hs-identifier hs-var">getSqlType</span></a></span><span> </span><span class="annot"><span class="annottext">Map EntityNameHS a
</span><a href="#local-6989586621679965353"><span class="hs-identifier hs-var">emEntities</span></a></span><span> </span><span class="annot"><span class="annottext">EntityMap
</span><a href="#local-6989586621679965352"><span class="hs-identifier hs-var">entityMap</span></a></span><span> </span><span class="annot"><span class="annottext">UnboundFieldDef
</span><a href="#local-6989586621679965273"><span class="hs-identifier hs-var">ufd</span></a></span><span>
</span><span id="line-455"></span><span>        </span><span class="annot"><a href="Database.Persist.Types.Base.html#FieldDef"><span class="hs-identifier hs-type">FieldDef</span></a></span><span> </span><span id="local-6989586621679965250"><span class="annot"><span class="annottext">FieldNameHS
</span><a href="#local-6989586621679965250"><span class="hs-identifier hs-var">_x</span></a></span></span><span> </span><span class="annot"><span class="annottext">FieldNameDB
</span><span class="hs-identifier">_</span></span><span> </span><span class="annot"><span class="annottext">FieldType
</span><span class="hs-identifier">_</span></span><span> </span><span class="annot"><span class="annottext">SqlType
</span><span class="hs-identifier">_</span></span><span> </span><span class="annot"><span class="annottext">[FieldAttr]
</span><span class="hs-identifier">_</span></span><span> </span><span class="annot"><span class="annottext">Bool
</span><span class="hs-identifier">_</span></span><span> </span><span class="annot"><span class="annottext">ReferenceDef
</span><span class="hs-identifier">_</span></span><span> </span><span class="annot"><span class="annottext">FieldCascade
</span><span class="hs-identifier">_</span></span><span> </span><span class="annot"><span class="annottext">Maybe Text
</span><span class="hs-identifier">_</span></span><span> </span><span class="annot"><span class="annottext">Maybe Text
</span><span class="hs-identifier">_</span></span><span> </span><span class="annot"><span class="annottext">Bool
</span><span class="hs-identifier">_</span></span><span> </span><span class="hs-glyph">=</span><span>
</span><span id="line-456"></span><span>            </span><span class="annot"><span class="annottext">forall a. HasCallStack =&gt; String -&gt; a
</span><span class="hs-identifier hs-var">error</span></span><span> </span><span class="annot"><span class="annottext">String
</span><span class="hs-string">&quot;need to update this record wildcard match&quot;</span></span><span>
</span><span id="line-457"></span><span>        </span><span class="hs-special">(</span><span id="local-6989586621679965249"><span class="annot"><span class="annottext">Q Exp
</span><a href="#local-6989586621679965249"><span class="hs-identifier hs-var">fieldRef'</span></a></span></span><span class="hs-special">,</span><span> </span><span id="local-6989586621679965248"><span class="annot"><span class="annottext">Q Exp
</span><a href="#local-6989586621679965248"><span class="hs-identifier hs-var">sqlTyp'</span></a></span></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">=</span><span>
</span><span id="line-458"></span><span>            </span><span class="hs-keyword">case</span><span> </span><span class="annot"><span class="annottext">EntityMap -&gt; UnboundFieldDef -&gt; Maybe EntityNameHS
</span><a href="Database.Persist.TH.html#extractForeignRef"><span class="hs-identifier hs-var">extractForeignRef</span></a></span><span> </span><span class="annot"><span class="annottext">EntityMap
</span><a href="#local-6989586621679965352"><span class="hs-identifier hs-var">entityMap</span></a></span><span> </span><span class="annot"><span class="annottext">UnboundFieldDef
</span><a href="#local-6989586621679965273"><span class="hs-identifier hs-var">ufd</span></a></span><span> </span><span class="hs-keyword">of</span><span>
</span><span id="line-459"></span><span>                </span><span class="annot"><span class="hs-identifier hs-type">Just</span></span><span> </span><span id="local-6989586621679965246"><span class="annot"><span class="annottext">EntityNameHS
</span><a href="#local-6989586621679965246"><span class="hs-identifier hs-var">targetTable</span></a></span></span><span> </span><span class="hs-glyph">-&gt;</span><span>
</span><span id="line-460"></span><span>                    </span><span class="hs-special">(</span><span class="annot"><span class="annottext">forall t (m :: * -&gt; *). (Lift t, Quote m) =&gt; t -&gt; m Exp
</span><span class="hs-identifier hs-var">lift</span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">EntityNameHS -&gt; ReferenceDef
</span><a href="Database.Persist.Types.Base.html#ForeignRef"><span class="hs-identifier hs-var">ForeignRef</span></a></span><span> </span><span class="annot"><span class="annottext">EntityNameHS
</span><a href="#local-6989586621679965246"><span class="hs-identifier hs-var">targetTable</span></a></span><span class="hs-special">)</span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">SqlTypeExp -&gt; Q Exp
</span><a href="Database.Persist.TH.html#liftSqlTypeExp"><span class="hs-identifier hs-var">liftSqlTypeExp</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">EntityNameHS -&gt; SqlTypeExp
</span><a href="Database.Persist.TH.html#SqlTypeReference"><span class="hs-identifier hs-var">SqlTypeReference</span></a></span><span> </span><span class="annot"><span class="annottext">EntityNameHS
</span><a href="#local-6989586621679965246"><span class="hs-identifier hs-var">targetTable</span></a></span><span class="hs-special">)</span><span class="hs-special">)</span><span>
</span><span id="line-461"></span><span>                </span><span class="annot"><span class="annottext">Maybe EntityNameHS
</span><span class="hs-identifier hs-var">Nothing</span></span><span> </span><span class="hs-glyph">-&gt;</span><span>
</span><span id="line-462"></span><span>                    </span><span class="hs-special">(</span><span class="annot"><span class="annottext">forall t (m :: * -&gt; *). (Lift t, Quote m) =&gt; t -&gt; m Exp
</span><span class="hs-identifier hs-var">lift</span></span><span> </span><span class="annot"><span class="annottext">ReferenceDef
</span><a href="Database.Persist.Types.Base.html#NoReference"><span class="hs-identifier hs-var">NoReference</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">SqlTypeExp -&gt; Q Exp
</span><a href="Database.Persist.TH.html#liftSqlTypeExp"><span class="hs-identifier hs-var">liftSqlTypeExp</span></a></span><span> </span><span class="annot"><span class="annottext">SqlTypeExp
</span><a href="#local-6989586621679965255"><span class="hs-identifier hs-var">sqlTypeExp</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-463"></span><span>
</span><span id="line-464"></span><span class="hs-keyword">data</span><span> </span><span id="FieldStore"><span class="annot"><a href="Database.Persist.TH.html#FieldStore"><span class="hs-identifier hs-var">FieldStore</span></a></span></span><span>
</span><span id="line-465"></span><span>    </span><span class="hs-glyph">=</span><span> </span><span id="FieldStore"><span class="annot"><a href="Database.Persist.TH.html#FieldStore"><span class="hs-identifier hs-var">FieldStore</span></a></span></span><span>
</span><span id="line-466"></span><span>    </span><span class="hs-special">{</span><span> </span><span id="fieldStoreMap"><span class="annot"><span class="annottext">FieldStore -&gt; Map FieldNameHS UnboundFieldDef
</span><a href="Database.Persist.TH.html#fieldStoreMap"><span class="hs-identifier hs-var hs-var">fieldStoreMap</span></a></span></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><span class="hs-identifier hs-type">M.Map</span></span><span> </span><span class="annot"><a href="Database.Persist.Names.html#FieldNameHS"><span class="hs-identifier hs-type">FieldNameHS</span></a></span><span> </span><span class="annot"><a href="Database.Persist.Quasi.Internal.html#UnboundFieldDef"><span class="hs-identifier hs-type">UnboundFieldDef</span></a></span><span>
</span><span id="line-467"></span><span>    </span><span class="hs-special">,</span><span> </span><span id="fieldStoreId"><span class="annot"><span class="annottext">FieldStore -&gt; Maybe FieldNameDB
</span><a href="Database.Persist.TH.html#fieldStoreId"><span class="hs-identifier hs-var hs-var">fieldStoreId</span></a></span></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><span class="hs-identifier hs-type">Maybe</span></span><span> </span><span class="annot"><a href="Database.Persist.Names.html#FieldNameDB"><span class="hs-identifier hs-type">FieldNameDB</span></a></span><span>
</span><span id="line-468"></span><span>    </span><span class="hs-special">,</span><span> </span><span id="fieldStoreEntity"><span class="annot"><span class="annottext">FieldStore -&gt; UnboundEntityDef
</span><a href="Database.Persist.TH.html#fieldStoreEntity"><span class="hs-identifier hs-var hs-var">fieldStoreEntity</span></a></span></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><a href="Database.Persist.Quasi.Internal.html#UnboundEntityDef"><span class="hs-identifier hs-type">UnboundEntityDef</span></a></span><span>
</span><span id="line-469"></span><span>    </span><span class="hs-special">}</span><span>
</span><span id="line-470"></span><span>
</span><span id="line-471"></span><span class="annot"><a href="Database.Persist.TH.html#mkFieldStore"><span class="hs-identifier hs-type">mkFieldStore</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><a href="Database.Persist.Quasi.Internal.html#UnboundEntityDef"><span class="hs-identifier hs-type">UnboundEntityDef</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="Database.Persist.TH.html#FieldStore"><span class="hs-identifier hs-type">FieldStore</span></a></span><span>
</span><span id="line-472"></span><span id="mkFieldStore"><span class="annot"><span class="annottext">mkFieldStore :: UnboundEntityDef -&gt; FieldStore
</span><a href="Database.Persist.TH.html#mkFieldStore"><span class="hs-identifier hs-var hs-var">mkFieldStore</span></a></span></span><span> </span><span id="local-6989586621679965237"><span class="annot"><span class="annottext">UnboundEntityDef
</span><a href="#local-6989586621679965237"><span class="hs-identifier hs-var">ued</span></a></span></span><span> </span><span class="hs-glyph">=</span><span>
</span><span id="line-473"></span><span>    </span><span class="annot"><a href="Database.Persist.TH.html#FieldStore"><span class="hs-identifier hs-type">FieldStore</span></a></span><span>
</span><span id="line-474"></span><span>        </span><span class="hs-special">{</span><span> </span><span class="annot"><span class="annottext">fieldStoreEntity :: UnboundEntityDef
</span><a href="Database.Persist.TH.html#fieldStoreEntity"><span class="hs-identifier hs-var">fieldStoreEntity</span></a></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">UnboundEntityDef
</span><a href="#local-6989586621679965237"><span class="hs-identifier hs-var">ued</span></a></span><span>
</span><span id="line-475"></span><span>        </span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">fieldStoreMap :: Map FieldNameHS UnboundFieldDef
</span><a href="Database.Persist.TH.html#fieldStoreMap"><span class="hs-identifier hs-var">fieldStoreMap</span></a></span><span> </span><span class="hs-glyph">=</span><span>
</span><span id="line-476"></span><span>            </span><span class="annot"><span class="annottext">forall k a. Ord k =&gt; [(k, a)] -&gt; Map k a
</span><span class="hs-identifier hs-var">M.fromList</span></span><span>
</span><span id="line-477"></span><span>                </span><span class="annot"><span class="annottext">forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span> </span><span class="annot"><span class="annottext">forall (f :: * -&gt; *) a b. Functor f =&gt; (a -&gt; b) -&gt; f a -&gt; f b
</span><span class="hs-identifier hs-var">fmap</span></span><span> </span><span class="hs-special">(</span><span class="hs-glyph">\</span><span id="local-6989586621679965235"><span class="annot"><span class="annottext">UnboundFieldDef
</span><a href="#local-6989586621679965235"><span class="hs-identifier hs-var">ufd</span></a></span></span><span> </span><span class="hs-glyph">-&gt;</span><span>
</span><span id="line-478"></span><span>                    </span><span class="hs-special">(</span><span> </span><span class="annot"><span class="annottext">UnboundFieldDef -&gt; FieldNameHS
</span><a href="Database.Persist.Quasi.Internal.html#unboundFieldNameHS"><span class="hs-identifier hs-var">unboundFieldNameHS</span></a></span><span> </span><span class="annot"><span class="annottext">UnboundFieldDef
</span><a href="#local-6989586621679965235"><span class="hs-identifier hs-var">ufd</span></a></span><span>
</span><span id="line-479"></span><span>                    </span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">UnboundFieldDef
</span><a href="#local-6989586621679965235"><span class="hs-identifier hs-var">ufd</span></a></span><span>
</span><span id="line-480"></span><span>                    </span><span class="hs-special">)</span><span>
</span><span id="line-481"></span><span>                </span><span class="hs-special">)</span><span>
</span><span id="line-482"></span><span>                </span><span class="annot"><span class="annottext">forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span> </span><span class="annot"><span class="annottext">UnboundEntityDef -&gt; [UnboundFieldDef]
</span><a href="Database.Persist.Quasi.Internal.html#getUnboundFieldDefs"><span class="hs-identifier hs-var">getUnboundFieldDefs</span></a></span><span>
</span><span id="line-483"></span><span>                </span><span class="annot"><span class="annottext">forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span> </span><span class="annot"><span class="annottext">UnboundEntityDef
</span><a href="#local-6989586621679965237"><span class="hs-identifier hs-var">ued</span></a></span><span>
</span><span id="line-484"></span><span>        </span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">fieldStoreId :: Maybe FieldNameDB
</span><a href="Database.Persist.TH.html#fieldStoreId"><span class="hs-identifier hs-var">fieldStoreId</span></a></span><span> </span><span class="hs-glyph">=</span><span>
</span><span id="line-485"></span><span>            </span><span class="hs-keyword">case</span><span> </span><span class="annot"><span class="annottext">UnboundEntityDef -&gt; PrimarySpec
</span><a href="Database.Persist.Quasi.Internal.html#unboundPrimarySpec"><span class="hs-identifier hs-var">unboundPrimarySpec</span></a></span><span> </span><span class="annot"><span class="annottext">UnboundEntityDef
</span><a href="#local-6989586621679965237"><span class="hs-identifier hs-var">ued</span></a></span><span> </span><span class="hs-keyword">of</span><span>
</span><span id="line-486"></span><span>                </span><span class="annot"><a href="Database.Persist.Quasi.Internal.html#NaturalKey"><span class="hs-identifier hs-type">NaturalKey</span></a></span><span> </span><span class="annot"><span class="annottext">UnboundCompositeDef
</span><span class="hs-identifier">_</span></span><span> </span><span class="hs-glyph">-&gt;</span><span>
</span><span id="line-487"></span><span>                    </span><span class="annot"><span class="annottext">forall a. Maybe a
</span><span class="hs-identifier hs-var">Nothing</span></span><span>
</span><span id="line-488"></span><span>                </span><span class="annot"><a href="Database.Persist.Quasi.Internal.html#SurrogateKey"><span class="hs-identifier hs-type">SurrogateKey</span></a></span><span> </span><span id="local-6989586621679965234"><span class="annot"><span class="annottext">UnboundIdDef
</span><a href="#local-6989586621679965234"><span class="hs-identifier hs-var">fd</span></a></span></span><span> </span><span class="hs-glyph">-&gt;</span><span>
</span><span id="line-489"></span><span>                    </span><span class="annot"><span class="annottext">forall a. a -&gt; Maybe a
</span><span class="hs-identifier hs-var">Just</span></span><span> </span><span class="annot"><span class="annottext">forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span> </span><span class="annot"><span class="annottext">UnboundIdDef -&gt; FieldNameDB
</span><a href="Database.Persist.Quasi.Internal.html#unboundIdDBName"><span class="hs-identifier hs-var">unboundIdDBName</span></a></span><span> </span><span class="annot"><span class="annottext">UnboundIdDef
</span><a href="#local-6989586621679965234"><span class="hs-identifier hs-var">fd</span></a></span><span>
</span><span id="line-490"></span><span>                </span><span class="annot"><a href="Database.Persist.Quasi.Internal.html#DefaultKey"><span class="hs-identifier hs-type">DefaultKey</span></a></span><span> </span><span id="local-6989586621679965233"><span class="annot"><span class="annottext">FieldNameDB
</span><a href="#local-6989586621679965233"><span class="hs-identifier hs-var">n</span></a></span></span><span> </span><span class="hs-glyph">-&gt;</span><span>
</span><span id="line-491"></span><span>                    </span><span class="annot"><span class="annottext">forall a. a -&gt; Maybe a
</span><span class="hs-identifier hs-var">Just</span></span><span> </span><span class="annot"><span class="annottext">FieldNameDB
</span><a href="#local-6989586621679965233"><span class="hs-identifier hs-var">n</span></a></span><span>
</span><span id="line-492"></span><span>        </span><span class="hs-special">}</span><span>
</span><span id="line-493"></span><span>
</span><span id="line-494"></span><span class="annot"><a href="Database.Persist.TH.html#getFieldDBName"><span class="hs-identifier hs-type">getFieldDBName</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><a href="Database.Persist.Names.html#FieldNameHS"><span class="hs-identifier hs-type">FieldNameHS</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="Database.Persist.TH.html#FieldStore"><span class="hs-identifier hs-type">FieldStore</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="hs-identifier hs-type">Maybe</span></span><span> </span><span class="annot"><a href="Database.Persist.Names.html#FieldNameDB"><span class="hs-identifier hs-type">FieldNameDB</span></a></span><span>
</span><span id="line-495"></span><span id="getFieldDBName"><span class="annot"><span class="annottext">getFieldDBName :: FieldNameHS -&gt; FieldStore -&gt; Maybe FieldNameDB
</span><a href="Database.Persist.TH.html#getFieldDBName"><span class="hs-identifier hs-var hs-var">getFieldDBName</span></a></span></span><span> </span><span id="local-6989586621679965232"><span class="annot"><span class="annottext">FieldNameHS
</span><a href="#local-6989586621679965232"><span class="hs-identifier hs-var">name</span></a></span></span><span> </span><span id="local-6989586621679965231"><span class="annot"><span class="annottext">FieldStore
</span><a href="#local-6989586621679965231"><span class="hs-identifier hs-var">fs</span></a></span></span><span>
</span><span id="line-496"></span><span>    </span><span class="hs-glyph">|</span><span> </span><span class="annot"><span class="annottext">Text -&gt; FieldNameHS
</span><a href="Database.Persist.Names.html#FieldNameHS"><span class="hs-identifier hs-var">FieldNameHS</span></a></span><span> </span><span class="annot"><span class="annottext">Text
</span><span class="hs-string">&quot;Id&quot;</span></span><span> </span><span class="annot"><span class="annottext">forall a. Eq a =&gt; a -&gt; a -&gt; Bool
</span><span class="hs-operator hs-var">==</span></span><span> </span><span class="annot"><span class="annottext">FieldNameHS
</span><a href="#local-6989586621679965232"><span class="hs-identifier hs-var">name</span></a></span><span> </span><span class="hs-glyph">=</span><span>
</span><span id="line-497"></span><span>        </span><span class="annot"><span class="annottext">FieldStore -&gt; Maybe FieldNameDB
</span><a href="Database.Persist.TH.html#fieldStoreId"><span class="hs-identifier hs-var">fieldStoreId</span></a></span><span> </span><span class="annot"><span class="annottext">FieldStore
</span><a href="#local-6989586621679965231"><span class="hs-identifier hs-var">fs</span></a></span><span>
</span><span id="line-498"></span><span>    </span><span class="hs-glyph">|</span><span> </span><span class="annot"><span class="annottext">Bool
</span><span class="hs-identifier hs-var">otherwise</span></span><span> </span><span class="hs-glyph">=</span><span>
</span><span id="line-499"></span><span>        </span><span class="annot"><span class="annottext">UnboundFieldDef -&gt; FieldNameDB
</span><a href="Database.Persist.Quasi.Internal.html#unboundFieldNameDB"><span class="hs-identifier hs-var">unboundFieldNameDB</span></a></span><span> </span><span class="annot"><span class="annottext">forall (f :: * -&gt; *) a b. Functor f =&gt; (a -&gt; b) -&gt; f a -&gt; f b
</span><span class="hs-operator hs-var">&lt;$&gt;</span></span><span> </span><span class="annot"><span class="annottext">FieldNameHS -&gt; FieldStore -&gt; Maybe UnboundFieldDef
</span><a href="Database.Persist.TH.html#getFieldDef"><span class="hs-identifier hs-var">getFieldDef</span></a></span><span> </span><span class="annot"><span class="annottext">FieldNameHS
</span><a href="#local-6989586621679965232"><span class="hs-identifier hs-var">name</span></a></span><span> </span><span class="annot"><span class="annottext">FieldStore
</span><a href="#local-6989586621679965231"><span class="hs-identifier hs-var">fs</span></a></span><span>
</span><span id="line-500"></span><span>
</span><span id="line-501"></span><span class="annot"><a href="Database.Persist.TH.html#getFieldDef"><span class="hs-identifier hs-type">getFieldDef</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><a href="Database.Persist.Names.html#FieldNameHS"><span class="hs-identifier hs-type">FieldNameHS</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="Database.Persist.TH.html#FieldStore"><span class="hs-identifier hs-type">FieldStore</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="hs-identifier hs-type">Maybe</span></span><span> </span><span class="annot"><a href="Database.Persist.Quasi.Internal.html#UnboundFieldDef"><span class="hs-identifier hs-type">UnboundFieldDef</span></a></span><span>
</span><span id="line-502"></span><span id="getFieldDef"><span class="annot"><span class="annottext">getFieldDef :: FieldNameHS -&gt; FieldStore -&gt; Maybe UnboundFieldDef
</span><a href="Database.Persist.TH.html#getFieldDef"><span class="hs-identifier hs-var hs-var">getFieldDef</span></a></span></span><span> </span><span id="local-6989586621679965229"><span class="annot"><span class="annottext">FieldNameHS
</span><a href="#local-6989586621679965229"><span class="hs-identifier hs-var">fieldNameHS</span></a></span></span><span> </span><span id="local-6989586621679965228"><span class="annot"><span class="annottext">FieldStore
</span><a href="#local-6989586621679965228"><span class="hs-identifier hs-var">fs</span></a></span></span><span> </span><span class="hs-glyph">=</span><span>
</span><span id="line-503"></span><span>    </span><span class="annot"><span class="annottext">forall k a. Ord k =&gt; k -&gt; Map k a -&gt; Maybe a
</span><span class="hs-identifier hs-var">M.lookup</span></span><span> </span><span class="annot"><span class="annottext">FieldNameHS
</span><a href="#local-6989586621679965229"><span class="hs-identifier hs-var">fieldNameHS</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">FieldStore -&gt; Map FieldNameHS UnboundFieldDef
</span><a href="Database.Persist.TH.html#fieldStoreMap"><span class="hs-identifier hs-var">fieldStoreMap</span></a></span><span> </span><span class="annot"><span class="annottext">FieldStore
</span><a href="#local-6989586621679965228"><span class="hs-identifier hs-var">fs</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-504"></span><span>
</span><span id="line-505"></span><span class="annot"><a href="Database.Persist.TH.html#extractForeignRef"><span class="hs-identifier hs-type">extractForeignRef</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><a href="Database.Persist.TH.html#EntityMap"><span class="hs-identifier hs-type">EntityMap</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="Database.Persist.Quasi.Internal.html#UnboundFieldDef"><span class="hs-identifier hs-type">UnboundFieldDef</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="hs-identifier hs-type">Maybe</span></span><span> </span><span class="annot"><a href="Database.Persist.Names.html#EntityNameHS"><span class="hs-identifier hs-type">EntityNameHS</span></a></span><span>
</span><span id="line-506"></span><span id="extractForeignRef"><span class="annot"><span class="annottext">extractForeignRef :: EntityMap -&gt; UnboundFieldDef -&gt; Maybe EntityNameHS
</span><a href="Database.Persist.TH.html#extractForeignRef"><span class="hs-identifier hs-var hs-var">extractForeignRef</span></a></span></span><span> </span><span id="local-6989586621679965227"><span class="annot"><span class="annottext">EntityMap
</span><a href="#local-6989586621679965227"><span class="hs-identifier hs-var">entityMap</span></a></span></span><span> </span><span id="local-6989586621679965226"><span class="annot"><span class="annottext">UnboundFieldDef
</span><a href="#local-6989586621679965226"><span class="hs-identifier hs-var">fieldDef</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-keyword">do</span><span>
</span><span id="line-507"></span><span>    </span><span id="local-6989586621679965225"><span class="annot"><span class="annottext">EntityNameHS
</span><a href="#local-6989586621679965225"><span class="hs-identifier hs-var">refName</span></a></span></span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">UnboundFieldDef -&gt; Maybe EntityNameHS
</span><a href="Database.Persist.TH.html#guessFieldReference"><span class="hs-identifier hs-var">guessFieldReference</span></a></span><span> </span><span class="annot"><span class="annottext">UnboundFieldDef
</span><a href="#local-6989586621679965226"><span class="hs-identifier hs-var">fieldDef</span></a></span><span>
</span><span id="line-508"></span><span>    </span><span id="local-6989586621679965223"><span class="annot"><span class="annottext">UnboundEntityDef
</span><a href="#local-6989586621679965223"><span class="hs-identifier hs-var">ent</span></a></span></span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">forall k a. Ord k =&gt; k -&gt; Map k a -&gt; Maybe a
</span><span class="hs-identifier hs-var">M.lookup</span></span><span> </span><span class="annot"><span class="annottext">EntityNameHS
</span><a href="#local-6989586621679965225"><span class="hs-identifier hs-var">refName</span></a></span><span> </span><span class="annot"><span class="annottext">EntityMap
</span><a href="#local-6989586621679965227"><span class="hs-identifier hs-var">entityMap</span></a></span><span>
</span><span id="line-509"></span><span>    </span><span class="annot"><span class="annottext">forall (f :: * -&gt; *) a. Applicative f =&gt; a -&gt; f a
</span><span class="hs-identifier hs-var">pure</span></span><span> </span><span class="annot"><span class="annottext">forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span> </span><span class="annot"><span class="annottext">EntityDef -&gt; EntityNameHS
</span><a href="Database.Persist.Types.Base.html#entityHaskell"><span class="hs-identifier hs-var">entityHaskell</span></a></span><span> </span><span class="annot"><span class="annottext">forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span> </span><span class="annot"><span class="annottext">UnboundEntityDef -&gt; EntityDef
</span><a href="Database.Persist.Quasi.Internal.html#unboundEntityDef"><span class="hs-identifier hs-var">unboundEntityDef</span></a></span><span> </span><span class="annot"><span class="annottext">UnboundEntityDef
</span><a href="#local-6989586621679965223"><span class="hs-identifier hs-var">ent</span></a></span><span>
</span><span id="line-510"></span><span>
</span><span id="line-511"></span><span class="annot"><a href="Database.Persist.TH.html#guessFieldReference"><span class="hs-identifier hs-type">guessFieldReference</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><a href="Database.Persist.Quasi.Internal.html#UnboundFieldDef"><span class="hs-identifier hs-type">UnboundFieldDef</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="hs-identifier hs-type">Maybe</span></span><span> </span><span class="annot"><a href="Database.Persist.Names.html#EntityNameHS"><span class="hs-identifier hs-type">EntityNameHS</span></a></span><span>
</span><span id="line-512"></span><span id="guessFieldReference"><span class="annot"><span class="annottext">guessFieldReference :: UnboundFieldDef -&gt; Maybe EntityNameHS
</span><a href="Database.Persist.TH.html#guessFieldReference"><span class="hs-identifier hs-var hs-var">guessFieldReference</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">FieldType -&gt; Maybe EntityNameHS
</span><a href="Database.Persist.TH.html#guessReference"><span class="hs-identifier hs-var">guessReference</span></a></span><span> </span><span class="annot"><span class="annottext">forall b c a. (b -&gt; c) -&gt; (a -&gt; b) -&gt; a -&gt; c
</span><span class="hs-operator hs-var">.</span></span><span> </span><span class="annot"><span class="annottext">UnboundFieldDef -&gt; FieldType
</span><a href="Database.Persist.Quasi.Internal.html#unboundFieldType"><span class="hs-identifier hs-var">unboundFieldType</span></a></span><span>
</span><span id="line-513"></span><span>
</span><span id="line-514"></span><span class="annot"><a href="Database.Persist.TH.html#guessReference"><span class="hs-identifier hs-type">guessReference</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><a href="Database.Persist.Types.Base.html#FieldType"><span class="hs-identifier hs-type">FieldType</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="hs-identifier hs-type">Maybe</span></span><span> </span><span class="annot"><a href="Database.Persist.Names.html#EntityNameHS"><span class="hs-identifier hs-type">EntityNameHS</span></a></span><span>
</span><span id="line-515"></span><span id="guessReference"><span class="annot"><span class="annottext">guessReference :: FieldType -&gt; Maybe EntityNameHS
</span><a href="Database.Persist.TH.html#guessReference"><span class="hs-identifier hs-var hs-var">guessReference</span></a></span></span><span> </span><span id="local-6989586621679965221"><span class="annot"><span class="annottext">FieldType
</span><a href="#local-6989586621679965221"><span class="hs-identifier hs-var">ft</span></a></span></span><span> </span><span class="hs-glyph">=</span><span>
</span><span id="line-516"></span><span>    </span><span class="hs-keyword">case</span><span> </span><span class="annot"><span class="annottext">FieldType
</span><a href="#local-6989586621679965221"><span class="hs-identifier hs-var">ft</span></a></span><span> </span><span class="hs-keyword">of</span><span>
</span><span id="line-517"></span><span>        </span><span class="annot"><a href="Database.Persist.Types.Base.html#FTTypeCon"><span class="hs-identifier hs-type">FTTypeCon</span></a></span><span> </span><span class="annot"><span class="annottext">Maybe Text
</span><span class="hs-identifier hs-var">Nothing</span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Text -&gt; Text -&gt; Maybe Text
</span><span class="hs-identifier hs-var">T.stripSuffix</span></span><span> </span><span class="annot"><span class="annottext">Text
</span><span class="hs-string">&quot;Id&quot;</span></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="hs-identifier hs-type">Just</span></span><span> </span><span id="local-6989586621679965220"><span class="annot"><span class="annottext">Text
</span><a href="#local-6989586621679965220"><span class="hs-identifier hs-var">tableName</span></a></span></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">-&gt;</span><span>
</span><span id="line-518"></span><span>            </span><span class="annot"><span class="annottext">forall a. a -&gt; Maybe a
</span><span class="hs-identifier hs-var">Just</span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Text -&gt; EntityNameHS
</span><a href="Database.Persist.Names.html#EntityNameHS"><span class="hs-identifier hs-var">EntityNameHS</span></a></span><span> </span><span class="annot"><span class="annottext">Text
</span><a href="#local-6989586621679965220"><span class="hs-identifier hs-var">tableName</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-519"></span><span>        </span><span class="annot"><a href="Database.Persist.Types.Base.html#FTApp"><span class="hs-identifier hs-type">FTApp</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="Database.Persist.Types.Base.html#FTTypeCon"><span class="hs-identifier hs-type">FTTypeCon</span></a></span><span> </span><span class="annot"><span class="annottext">Maybe Text
</span><span class="hs-identifier hs-var">Nothing</span></span><span> </span><span class="annot"><span class="annottext">Text
</span><span class="hs-string">&quot;Key&quot;</span></span><span class="hs-special">)</span><span> </span><span class="hs-special">(</span><span class="annot"><a href="Database.Persist.Types.Base.html#FTTypeCon"><span class="hs-identifier hs-type">FTTypeCon</span></a></span><span> </span><span class="annot"><span class="annottext">Maybe Text
</span><span class="hs-identifier hs-var">Nothing</span></span><span> </span><span id="local-6989586621679965217"><span class="annot"><span class="annottext">Text
</span><a href="#local-6989586621679965217"><span class="hs-identifier hs-var">tableName</span></a></span></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">-&gt;</span><span>
</span><span id="line-520"></span><span>            </span><span class="annot"><span class="annottext">forall a. a -&gt; Maybe a
</span><span class="hs-identifier hs-var">Just</span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Text -&gt; EntityNameHS
</span><a href="Database.Persist.Names.html#EntityNameHS"><span class="hs-identifier hs-var">EntityNameHS</span></a></span><span> </span><span class="annot"><span class="annottext">Text
</span><a href="#local-6989586621679965217"><span class="hs-identifier hs-var">tableName</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-521"></span><span>        </span><span class="annot"><span class="annottext">FieldType
</span><span class="hs-identifier">_</span></span><span> </span><span class="hs-glyph">-&gt;</span><span>
</span><span id="line-522"></span><span>            </span><span class="annot"><span class="annottext">forall a. Maybe a
</span><span class="hs-identifier hs-var">Nothing</span></span><span>
</span><span id="line-523"></span><span>
</span><span id="line-524"></span><span class="annot"><a href="Database.Persist.TH.html#mkDefaultKey"><span class="hs-identifier hs-type">mkDefaultKey</span></a></span><span>
</span><span id="line-525"></span><span>    </span><span class="hs-glyph">::</span><span> </span><span class="annot"><a href="Database.Persist.TH.html#MkPersistSettings"><span class="hs-identifier hs-type">MkPersistSettings</span></a></span><span>
</span><span id="line-526"></span><span>    </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="Database.Persist.Names.html#FieldNameDB"><span class="hs-identifier hs-type">FieldNameDB</span></a></span><span>
</span><span id="line-527"></span><span>    </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="Database.Persist.Names.html#EntityNameHS"><span class="hs-identifier hs-type">EntityNameHS</span></a></span><span>
</span><span id="line-528"></span><span>    </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="Database.Persist.Types.Base.html#FieldDef"><span class="hs-identifier hs-type">FieldDef</span></a></span><span>
</span><span id="line-529"></span><span id="mkDefaultKey"><span class="annot"><span class="annottext">mkDefaultKey :: MkPersistSettings -&gt; FieldNameDB -&gt; EntityNameHS -&gt; FieldDef
</span><a href="Database.Persist.TH.html#mkDefaultKey"><span class="hs-identifier hs-var hs-var">mkDefaultKey</span></a></span></span><span> </span><span id="local-6989586621679965215"><span class="annot"><span class="annottext">MkPersistSettings
</span><a href="#local-6989586621679965215"><span class="hs-identifier hs-var">mps</span></a></span></span><span>  </span><span id="local-6989586621679965214"><span class="annot"><span class="annottext">FieldNameDB
</span><a href="#local-6989586621679965214"><span class="hs-identifier hs-var">pk</span></a></span></span><span> </span><span id="local-6989586621679965213"><span class="annot"><span class="annottext">EntityNameHS
</span><a href="#local-6989586621679965213"><span class="hs-identifier hs-var">unboundHaskellName</span></a></span></span><span> </span><span class="hs-glyph">=</span><span>
</span><span id="line-530"></span><span>    </span><span class="hs-keyword">let</span><span>
</span><span id="line-531"></span><span>        </span><span id="local-6989586621679965212"><span class="annot"><span class="annottext">iid :: ImplicitIdDef
</span><a href="#local-6989586621679965212"><span class="hs-identifier hs-var hs-var">iid</span></a></span></span><span> </span><span class="hs-glyph">=</span><span>
</span><span id="line-532"></span><span>            </span><span class="annot"><span class="annottext">MkPersistSettings -&gt; ImplicitIdDef
</span><a href="Database.Persist.TH.html#mpsImplicitIdDef"><span class="hs-identifier hs-var">mpsImplicitIdDef</span></a></span><span> </span><span class="annot"><span class="annottext">MkPersistSettings
</span><a href="#local-6989586621679965215"><span class="hs-identifier hs-var">mps</span></a></span><span>
</span><span id="line-533"></span><span>    </span><span class="hs-keyword">in</span><span>
</span><span id="line-534"></span><span>        </span><span class="annot"><span class="annottext">forall b a. b -&gt; (a -&gt; b) -&gt; Maybe a -&gt; b
</span><span class="hs-identifier hs-var">maybe</span></span><span> </span><span class="annot"><span class="annottext">forall a. a -&gt; a
</span><span class="hs-identifier hs-var">id</span></span><span> </span><span class="annot"><span class="annottext">FieldAttr -&gt; FieldDef -&gt; FieldDef
</span><a href="Database.Persist.FieldDef.html#addFieldAttr"><span class="hs-identifier hs-var">addFieldAttr</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Text -&gt; FieldAttr
</span><a href="Database.Persist.Types.Base.html#FieldAttrDefault"><span class="hs-identifier hs-var">FieldAttrDefault</span></a></span><span> </span><span class="annot"><span class="annottext">forall (f :: * -&gt; *) a b. Functor f =&gt; (a -&gt; b) -&gt; f a -&gt; f b
</span><span class="hs-operator hs-var">&lt;$&gt;</span></span><span> </span><span class="annot"><span class="annottext">ImplicitIdDef -&gt; Maybe Text
</span><a href="Database.Persist.ImplicitIdDef.Internal.html#iidDefault"><span class="hs-identifier hs-var">iidDefault</span></a></span><span> </span><span class="annot"><span class="annottext">ImplicitIdDef
</span><a href="#local-6989586621679965212"><span class="hs-identifier hs-var">iid</span></a></span><span class="hs-special">)</span><span> </span><span class="annot"><span class="annottext">forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span>
</span><span id="line-535"></span><span>        </span><span class="annot"><span class="annottext">forall b a. b -&gt; (a -&gt; b) -&gt; Maybe a -&gt; b
</span><span class="hs-identifier hs-var">maybe</span></span><span> </span><span class="annot"><span class="annottext">forall a. a -&gt; a
</span><span class="hs-identifier hs-var">id</span></span><span> </span><span class="annot"><span class="annottext">FieldAttr -&gt; FieldDef -&gt; FieldDef
</span><a href="Database.Persist.FieldDef.html#addFieldAttr"><span class="hs-identifier hs-var">addFieldAttr</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Integer -&gt; FieldAttr
</span><a href="Database.Persist.Types.Base.html#FieldAttrMaxlen"><span class="hs-identifier hs-var">FieldAttrMaxlen</span></a></span><span> </span><span class="annot"><span class="annottext">forall (f :: * -&gt; *) a b. Functor f =&gt; (a -&gt; b) -&gt; f a -&gt; f b
</span><span class="hs-operator hs-var">&lt;$&gt;</span></span><span> </span><span class="annot"><span class="annottext">ImplicitIdDef -&gt; Maybe Integer
</span><a href="Database.Persist.ImplicitIdDef.Internal.html#iidMaxLen"><span class="hs-identifier hs-var">iidMaxLen</span></a></span><span> </span><span class="annot"><span class="annottext">ImplicitIdDef
</span><a href="#local-6989586621679965212"><span class="hs-identifier hs-var">iid</span></a></span><span class="hs-special">)</span><span> </span><span class="annot"><span class="annottext">forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span>
</span><span id="line-536"></span><span>        </span><span class="annot"><span class="annottext">FieldNameDB -&gt; EntityNameHS -&gt; SqlType -&gt; FieldDef
</span><a href="Database.Persist.Quasi.Internal.html#mkAutoIdField%27"><span class="hs-identifier hs-var">mkAutoIdField'</span></a></span><span> </span><span class="annot"><span class="annottext">FieldNameDB
</span><a href="#local-6989586621679965214"><span class="hs-identifier hs-var">pk</span></a></span><span> </span><span class="annot"><span class="annottext">EntityNameHS
</span><a href="#local-6989586621679965213"><span class="hs-identifier hs-var">unboundHaskellName</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">ImplicitIdDef -&gt; SqlType
</span><a href="Database.Persist.ImplicitIdDef.Internal.html#iidFieldSqlType"><span class="hs-identifier hs-var">iidFieldSqlType</span></a></span><span> </span><span class="annot"><span class="annottext">ImplicitIdDef
</span><a href="#local-6989586621679965212"><span class="hs-identifier hs-var">iid</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-537"></span><span>
</span><span id="line-538"></span><span class="annot"><a href="Database.Persist.TH.html#fixPrimarySpec"><span class="hs-identifier hs-type">fixPrimarySpec</span></a></span><span>
</span><span id="line-539"></span><span>    </span><span class="hs-glyph">::</span><span> </span><span class="annot"><a href="Database.Persist.TH.html#MkPersistSettings"><span class="hs-identifier hs-type">MkPersistSettings</span></a></span><span>
</span><span id="line-540"></span><span>    </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="Database.Persist.Quasi.Internal.html#UnboundEntityDef"><span class="hs-identifier hs-type">UnboundEntityDef</span></a></span><span>
</span><span id="line-541"></span><span>    </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="hs-identifier hs-type">Q</span></span><span> </span><span class="annot"><span class="hs-identifier hs-type">Exp</span></span><span>
</span><span id="line-542"></span><span id="fixPrimarySpec"><span class="annot"><span class="annottext">fixPrimarySpec :: MkPersistSettings -&gt; UnboundEntityDef -&gt; Q Exp
</span><a href="Database.Persist.TH.html#fixPrimarySpec"><span class="hs-identifier hs-var hs-var">fixPrimarySpec</span></a></span></span><span> </span><span id="local-6989586621679965200"><span class="annot"><span class="annottext">MkPersistSettings
</span><a href="#local-6989586621679965200"><span class="hs-identifier hs-var">mps</span></a></span></span><span> </span><span id="local-6989586621679965199"><span class="annot"><span class="annottext">UnboundEntityDef
</span><a href="#local-6989586621679965199"><span class="hs-identifier hs-var">unboundEnt</span></a></span></span><span class="hs-glyph">=</span><span> </span><span class="hs-keyword">do</span><span>
</span><span id="line-543"></span><span>    </span><span class="hs-keyword">case</span><span> </span><span class="annot"><span class="annottext">UnboundEntityDef -&gt; PrimarySpec
</span><a href="Database.Persist.Quasi.Internal.html#unboundPrimarySpec"><span class="hs-identifier hs-var">unboundPrimarySpec</span></a></span><span> </span><span class="annot"><span class="annottext">UnboundEntityDef
</span><a href="#local-6989586621679965199"><span class="hs-identifier hs-var">unboundEnt</span></a></span><span> </span><span class="hs-keyword">of</span><span>
</span><span id="line-544"></span><span>        </span><span class="annot"><a href="Database.Persist.Quasi.Internal.html#DefaultKey"><span class="hs-identifier hs-type">DefaultKey</span></a></span><span> </span><span id="local-6989586621679965198"><span class="annot"><span class="annottext">FieldNameDB
</span><a href="#local-6989586621679965198"><span class="hs-identifier hs-var">pk</span></a></span></span><span> </span><span class="hs-glyph">-&gt;</span><span>
</span><span id="line-545"></span><span>            </span><span class="annot"><span class="annottext">forall t (m :: * -&gt; *). (Lift t, Quote m) =&gt; t -&gt; m Exp
</span><span class="hs-identifier hs-var">lift</span></span><span> </span><span class="annot"><span class="annottext">forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span> </span><span class="annot"><span class="annottext">FieldDef -&gt; EntityIdDef
</span><a href="Database.Persist.Types.Base.html#EntityIdField"><span class="hs-identifier hs-var">EntityIdField</span></a></span><span> </span><span class="annot"><span class="annottext">forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span>
</span><span id="line-546"></span><span>                </span><span class="annot"><span class="annottext">MkPersistSettings -&gt; FieldNameDB -&gt; EntityNameHS -&gt; FieldDef
</span><a href="Database.Persist.TH.html#mkDefaultKey"><span class="hs-identifier hs-var">mkDefaultKey</span></a></span><span> </span><span class="annot"><span class="annottext">MkPersistSettings
</span><a href="#local-6989586621679965200"><span class="hs-identifier hs-var">mps</span></a></span><span> </span><span class="annot"><span class="annottext">FieldNameDB
</span><a href="#local-6989586621679965198"><span class="hs-identifier hs-var">pk</span></a></span><span> </span><span class="annot"><span class="annottext">EntityNameHS
</span><a href="#local-6989586621679965196"><span class="hs-identifier hs-var">unboundHaskellName</span></a></span><span>
</span><span id="line-547"></span><span>        </span><span class="annot"><a href="Database.Persist.Quasi.Internal.html#SurrogateKey"><span class="hs-identifier hs-type">SurrogateKey</span></a></span><span> </span><span id="local-6989586621679965195"><span class="annot"><span class="annottext">UnboundIdDef
</span><a href="#local-6989586621679965195"><span class="hs-identifier hs-var">uid</span></a></span></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-keyword">do</span><span>
</span><span id="line-548"></span><span>            </span><span class="hs-keyword">let</span><span>
</span><span id="line-549"></span><span>                </span><span id="local-6989586621679965194"><span class="annot"><span class="annottext">entNameHS :: EntityNameHS
</span><a href="#local-6989586621679965194"><span class="hs-identifier hs-var hs-var">entNameHS</span></a></span></span><span> </span><span class="hs-glyph">=</span><span>
</span><span id="line-550"></span><span>                    </span><span class="annot"><span class="annottext">UnboundEntityDef -&gt; EntityNameHS
</span><a href="Database.Persist.Quasi.Internal.html#getUnboundEntityNameHS"><span class="hs-identifier hs-var">getUnboundEntityNameHS</span></a></span><span> </span><span class="annot"><span class="annottext">UnboundEntityDef
</span><a href="#local-6989586621679965199"><span class="hs-identifier hs-var">unboundEnt</span></a></span><span>
</span><span id="line-551"></span><span>                </span><span id="local-6989586621679965193"><span class="annot"><span class="annottext">fieldTyp :: FieldType
</span><a href="#local-6989586621679965193"><span class="hs-identifier hs-var hs-var">fieldTyp</span></a></span></span><span> </span><span class="hs-glyph">=</span><span>
</span><span id="line-552"></span><span>                    </span><span class="annot"><span class="annottext">forall a. a -&gt; Maybe a -&gt; a
</span><span class="hs-identifier hs-var">fromMaybe</span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">EntityNameHS -&gt; FieldType
</span><a href="Database.Persist.Quasi.Internal.html#mkKeyConType"><span class="hs-identifier hs-var">mkKeyConType</span></a></span><span> </span><span class="annot"><span class="annottext">EntityNameHS
</span><a href="#local-6989586621679965194"><span class="hs-identifier hs-var">entNameHS</span></a></span><span class="hs-special">)</span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">UnboundIdDef -&gt; Maybe FieldType
</span><a href="Database.Persist.Quasi.Internal.html#unboundIdType"><span class="hs-identifier hs-var">unboundIdType</span></a></span><span> </span><span class="annot"><span class="annottext">UnboundIdDef
</span><a href="#local-6989586621679965195"><span class="hs-identifier hs-var">uid</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-553"></span><span>            </span><span class="hs-special">[|</span><span>
</span><span id="line-554"></span><span>                </span><span class="hs-identifier">EntityIdField</span><span>
</span><span id="line-555"></span><span>                    </span><span class="hs-identifier">FieldDef</span><span>
</span><span id="line-556"></span><span>                        </span><span class="hs-special">{</span><span> </span><span class="hs-identifier">fieldHaskell</span><span> </span><span class="hs-glyph">=</span><span>
</span><span id="line-557"></span><span>                            </span><span class="hs-identifier">FieldNameHS</span><span> </span><span class="hs-string">&quot;Id&quot;</span><span>
</span><span id="line-558"></span><span>                        </span><span class="hs-special">,</span><span> </span><span class="hs-identifier">fieldDB</span><span> </span><span class="hs-glyph">=</span><span>
</span><span id="line-559"></span><span>                            </span><span class="hs-special">$</span><span class="hs-special">(</span><span class="hs-identifier">lift</span><span> </span><span class="hs-operator">$</span><span> </span><span class="hs-identifier">getSqlNameOr</span><span> </span><span class="hs-special">(</span><span class="hs-identifier">unboundIdDBName</span><span> </span><span class="hs-identifier">uid</span><span class="hs-special">)</span><span> </span><span class="hs-special">(</span><span class="hs-identifier">unboundIdAttrs</span><span> </span><span class="hs-identifier">uid</span><span class="hs-special">)</span><span class="hs-special">)</span><span>
</span><span id="line-560"></span><span>                        </span><span class="hs-special">,</span><span> </span><span class="hs-identifier">fieldType</span><span> </span><span class="hs-glyph">=</span><span>
</span><span id="line-561"></span><span>                            </span><span class="hs-special">$</span><span class="hs-special">(</span><span class="hs-identifier">lift</span><span> </span><span class="hs-identifier">fieldTyp</span><span class="hs-special">)</span><span>
</span><span id="line-562"></span><span>                        </span><span class="hs-special">,</span><span> </span><span class="hs-identifier">fieldSqlType</span><span> </span><span class="hs-glyph">=</span><span>
</span><span id="line-563"></span><span>                            </span><span class="hs-special">$</span><span class="hs-special">(</span><span> </span><span class="hs-identifier">liftSqlTypeExp</span><span> </span><span class="hs-special">(</span><span class="hs-identifier">SqlTypeExp</span><span>  </span><span class="hs-identifier">fieldTyp</span><span class="hs-special">)</span><span> </span><span class="hs-special">)</span><span>
</span><span id="line-564"></span><span>                        </span><span class="hs-special">,</span><span> </span><span class="hs-identifier">fieldStrict</span><span> </span><span class="hs-glyph">=</span><span>
</span><span id="line-565"></span><span>                            </span><span class="hs-identifier">False</span><span>
</span><span id="line-566"></span><span>                        </span><span class="hs-special">,</span><span> </span><span class="hs-identifier">fieldReference</span><span> </span><span class="hs-glyph">=</span><span>
</span><span id="line-567"></span><span>                            </span><span class="hs-identifier">ForeignRef</span><span> </span><span class="hs-identifier">entNameHS</span><span>
</span><span id="line-568"></span><span>                        </span><span class="hs-special">,</span><span> </span><span class="hs-identifier">fieldAttrs</span><span> </span><span class="hs-glyph">=</span><span>
</span><span id="line-569"></span><span>                            </span><span class="hs-identifier">unboundIdAttrs</span><span> </span><span class="hs-identifier">uid</span><span>
</span><span id="line-570"></span><span>                        </span><span class="hs-special">,</span><span> </span><span class="hs-identifier">fieldComments</span><span> </span><span class="hs-glyph">=</span><span>
</span><span id="line-571"></span><span>                            </span><span class="hs-identifier">Nothing</span><span>
</span><span id="line-572"></span><span>                        </span><span class="hs-special">,</span><span> </span><span class="hs-identifier">fieldCascade</span><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-identifier">unboundIdCascade</span><span> </span><span class="hs-identifier">uid</span><span>
</span><span id="line-573"></span><span>                        </span><span class="hs-special">,</span><span> </span><span class="hs-identifier">fieldGenerated</span><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-identifier">Nothing</span><span>
</span><span id="line-574"></span><span>                        </span><span class="hs-special">,</span><span> </span><span class="hs-identifier">fieldIsImplicitIdColumn</span><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-identifier">True</span><span>
</span><span id="line-575"></span><span>                        </span><span class="hs-special">}</span><span>
</span><span id="line-576"></span><span>
</span><span id="line-577"></span><span>                </span><span class="hs-special">|]</span><span>
</span><span id="line-578"></span><span>        </span><span class="annot"><a href="Database.Persist.Quasi.Internal.html#NaturalKey"><span class="hs-identifier hs-type">NaturalKey</span></a></span><span> </span><span id="local-6989586621679965190"><span class="annot"><span class="annottext">UnboundCompositeDef
</span><a href="#local-6989586621679965190"><span class="hs-identifier hs-var">ucd</span></a></span></span><span> </span><span class="hs-glyph">-&gt;</span><span>
</span><span id="line-579"></span><span>            </span><span class="hs-special">[|</span><span> </span><span class="hs-identifier">EntityIdNaturalKey</span><span> </span><span class="hs-special">$</span><span class="hs-special">(</span><span class="hs-identifier">bindCompositeDef</span><span> </span><span class="hs-identifier">unboundEnt</span><span> </span><span class="hs-identifier">ucd</span><span class="hs-special">)</span><span> </span><span class="hs-special">|]</span><span>
</span><span id="line-580"></span><span>  </span><span class="hs-keyword">where</span><span>
</span><span id="line-581"></span><span>    </span><span id="local-6989586621679965196"><span class="annot"><span class="annottext">unboundHaskellName :: EntityNameHS
</span><a href="#local-6989586621679965196"><span class="hs-identifier hs-var hs-var">unboundHaskellName</span></a></span></span><span> </span><span class="hs-glyph">=</span><span>
</span><span id="line-582"></span><span>        </span><span class="annot"><span class="annottext">UnboundEntityDef -&gt; EntityNameHS
</span><a href="Database.Persist.Quasi.Internal.html#getUnboundEntityNameHS"><span class="hs-identifier hs-var">getUnboundEntityNameHS</span></a></span><span> </span><span class="annot"><span class="annottext">UnboundEntityDef
</span><a href="#local-6989586621679965199"><span class="hs-identifier hs-var">unboundEnt</span></a></span><span>
</span><span id="line-583"></span><span>
</span><span id="line-584"></span><span class="annot"><a href="Database.Persist.TH.html#bindCompositeDef"><span class="hs-identifier hs-type">bindCompositeDef</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><a href="Database.Persist.Quasi.Internal.html#UnboundEntityDef"><span class="hs-identifier hs-type">UnboundEntityDef</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="Database.Persist.Quasi.Internal.html#UnboundCompositeDef"><span class="hs-identifier hs-type">UnboundCompositeDef</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="hs-identifier hs-type">Q</span></span><span> </span><span class="annot"><span class="hs-identifier hs-type">Exp</span></span><span>
</span><span id="line-585"></span><span id="bindCompositeDef"><span class="annot"><span class="annottext">bindCompositeDef :: UnboundEntityDef -&gt; UnboundCompositeDef -&gt; Q Exp
</span><a href="Database.Persist.TH.html#bindCompositeDef"><span class="hs-identifier hs-var hs-var">bindCompositeDef</span></a></span></span><span> </span><span id="local-6989586621679965188"><span class="annot"><span class="annottext">UnboundEntityDef
</span><a href="#local-6989586621679965188"><span class="hs-identifier hs-var">ued</span></a></span></span><span> </span><span id="local-6989586621679965187"><span class="annot"><span class="annottext">UnboundCompositeDef
</span><a href="#local-6989586621679965187"><span class="hs-identifier hs-var">ucd</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-keyword">do</span><span>
</span><span id="line-586"></span><span>    </span><span id="local-6989586621679965186"><span class="annot"><span class="annottext">Exp
</span><a href="#local-6989586621679965186"><span class="hs-identifier hs-var">fieldDefs</span></a></span></span><span> </span><span class="hs-glyph">&lt;-</span><span>
</span><span id="line-587"></span><span>       </span><span class="annot"><span class="annottext">forall (f :: * -&gt; *) a b. Functor f =&gt; (a -&gt; b) -&gt; f a -&gt; f b
</span><span class="hs-identifier hs-var">fmap</span></span><span> </span><span class="annot"><span class="annottext">[Exp] -&gt; Exp
</span><span class="hs-identifier hs-var">ListE</span></span><span> </span><span class="annot"><span class="annottext">forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span> </span><span class="annot"><span class="annottext">forall (t :: * -&gt; *) (m :: * -&gt; *) a b.
(Traversable t, Monad m) =&gt;
t a -&gt; (a -&gt; m b) -&gt; m (t b)
</span><span class="hs-identifier hs-var">forM</span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">UnboundCompositeDef -&gt; [FieldNameHS]
</span><a href="Database.Persist.Quasi.Internal.html#unboundCompositeCols"><span class="hs-identifier hs-var">unboundCompositeCols</span></a></span><span> </span><span class="annot"><span class="annottext">UnboundCompositeDef
</span><a href="#local-6989586621679965187"><span class="hs-identifier hs-var">ucd</span></a></span><span class="hs-special">)</span><span> </span><span class="annot"><span class="annottext">forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span> </span><span class="hs-glyph">\</span><span id="local-6989586621679965185"><span class="annot"><span class="annottext">FieldNameHS
</span><a href="#local-6989586621679965185"><span class="hs-identifier hs-var">col</span></a></span></span><span> </span><span class="hs-glyph">-&gt;</span><span>
</span><span id="line-588"></span><span>           </span><span class="annot"><span class="annottext">UnboundEntityDef -&gt; FieldNameHS -&gt; Q Exp
</span><a href="Database.Persist.TH.html#mkLookupEntityField"><span class="hs-identifier hs-var">mkLookupEntityField</span></a></span><span> </span><span class="annot"><span class="annottext">UnboundEntityDef
</span><a href="#local-6989586621679965188"><span class="hs-identifier hs-var">ued</span></a></span><span> </span><span class="annot"><span class="annottext">FieldNameHS
</span><a href="#local-6989586621679965185"><span class="hs-identifier hs-var">col</span></a></span><span>
</span><span id="line-589"></span><span>    </span><span class="hs-special">[|</span><span>
</span><span id="line-590"></span><span>        </span><span class="hs-identifier">CompositeDef</span><span>
</span><span id="line-591"></span><span>            </span><span class="hs-special">{</span><span> </span><span class="hs-identifier">compositeFields</span><span> </span><span class="hs-glyph">=</span><span>
</span><span id="line-592"></span><span>                </span><span class="hs-identifier">NEL.fromList</span><span> </span><span class="hs-special">$</span><span class="hs-special">(</span><span class="hs-identifier">pure</span><span> </span><span class="hs-identifier">fieldDefs</span><span class="hs-special">)</span><span>
</span><span id="line-593"></span><span>            </span><span class="hs-special">,</span><span> </span><span class="hs-identifier">compositeAttrs</span><span> </span><span class="hs-glyph">=</span><span>
</span><span id="line-594"></span><span>                </span><span class="hs-special">$</span><span class="hs-special">(</span><span class="hs-identifier">lift</span><span> </span><span class="hs-operator">$</span><span> </span><span class="hs-identifier">unboundCompositeAttrs</span><span> </span><span class="hs-identifier">ucd</span><span class="hs-special">)</span><span>
</span><span id="line-595"></span><span>            </span><span class="hs-special">}</span><span>
</span><span id="line-596"></span><span>        </span><span class="hs-special">|]</span><span>
</span><span id="line-597"></span><span>
</span><span id="line-598"></span><span id="local-6989586621679966521"><span class="annot"><a href="Database.Persist.TH.html#getSqlType"><span class="hs-identifier hs-type">getSqlType</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><span class="hs-identifier hs-type">M.Map</span></span><span> </span><span class="annot"><a href="Database.Persist.Names.html#EntityNameHS"><span class="hs-identifier hs-type">EntityNameHS</span></a></span><span> </span><span class="annot"><a href="#local-6989586621679966521"><span class="hs-identifier hs-type">a</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="Database.Persist.TH.html#EntityMap"><span class="hs-identifier hs-type">EntityMap</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="Database.Persist.Quasi.Internal.html#UnboundFieldDef"><span class="hs-identifier hs-type">UnboundFieldDef</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="Database.Persist.TH.html#SqlTypeExp"><span class="hs-identifier hs-type">SqlTypeExp</span></a></span></span><span>
</span><span id="line-599"></span><span id="getSqlType"><span class="annot"><span class="annottext">getSqlType :: forall a.
Map EntityNameHS a -&gt; EntityMap -&gt; UnboundFieldDef -&gt; SqlTypeExp
</span><a href="Database.Persist.TH.html#getSqlType"><span class="hs-identifier hs-var hs-var">getSqlType</span></a></span></span><span> </span><span id="local-6989586621679965183"><span class="annot"><span class="annottext">Map EntityNameHS a
</span><a href="#local-6989586621679965183"><span class="hs-identifier hs-var">emEntities</span></a></span></span><span> </span><span id="local-6989586621679965182"><span class="annot"><span class="annottext">EntityMap
</span><a href="#local-6989586621679965182"><span class="hs-identifier hs-var">entityMap</span></a></span></span><span> </span><span id="local-6989586621679965181"><span class="annot"><span class="annottext">UnboundFieldDef
</span><a href="#local-6989586621679965181"><span class="hs-identifier hs-var">field</span></a></span></span><span> </span><span class="hs-glyph">=</span><span>
</span><span id="line-600"></span><span>    </span><span class="annot"><span class="annottext">forall b a. b -&gt; (a -&gt; b) -&gt; Maybe a -&gt; b
</span><span class="hs-identifier hs-var">maybe</span></span><span>
</span><span id="line-601"></span><span>        </span><span class="hs-special">(</span><span class="annot"><span class="annottext">forall a.
Map EntityNameHS a -&gt; EntityMap -&gt; UnboundFieldDef -&gt; SqlTypeExp
</span><a href="Database.Persist.TH.html#defaultSqlTypeExp"><span class="hs-identifier hs-var">defaultSqlTypeExp</span></a></span><span> </span><span class="annot"><span class="annottext">Map EntityNameHS a
</span><a href="#local-6989586621679965183"><span class="hs-identifier hs-var">emEntities</span></a></span><span> </span><span class="annot"><span class="annottext">EntityMap
</span><a href="#local-6989586621679965182"><span class="hs-identifier hs-var">entityMap</span></a></span><span> </span><span class="annot"><span class="annottext">UnboundFieldDef
</span><a href="#local-6989586621679965181"><span class="hs-identifier hs-var">field</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-602"></span><span>        </span><span class="hs-special">(</span><span class="annot"><span class="annottext">SqlType -&gt; SqlTypeExp
</span><a href="Database.Persist.TH.html#SqlType%27"><span class="hs-identifier hs-var">SqlType'</span></a></span><span> </span><span class="annot"><span class="annottext">forall b c a. (b -&gt; c) -&gt; (a -&gt; b) -&gt; a -&gt; c
</span><span class="hs-operator hs-var">.</span></span><span> </span><span class="annot"><span class="annottext">Text -&gt; SqlType
</span><a href="Database.Persist.Types.Base.html#SqlOther"><span class="hs-identifier hs-var">SqlOther</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-603"></span><span>        </span><span class="hs-special">(</span><span class="annot"><span class="annottext">forall a. [a] -&gt; Maybe a
</span><span class="hs-identifier hs-var">listToMaybe</span></span><span> </span><span class="annot"><span class="annottext">forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span> </span><span class="annot"><span class="annottext">forall a b. (a -&gt; Maybe b) -&gt; [a] -&gt; [b]
</span><span class="hs-identifier hs-var">mapMaybe</span></span><span> </span><span class="annot"><span class="annottext">FieldAttr -&gt; Maybe Text
</span><a href="Database.Persist.TH.html#attrSqlType"><span class="hs-identifier hs-var">attrSqlType</span></a></span><span> </span><span class="annot"><span class="annottext">forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span> </span><span class="annot"><span class="annottext">UnboundFieldDef -&gt; [FieldAttr]
</span><a href="Database.Persist.Quasi.Internal.html#unboundFieldAttrs"><span class="hs-identifier hs-var">unboundFieldAttrs</span></a></span><span> </span><span class="annot"><span class="annottext">UnboundFieldDef
</span><a href="#local-6989586621679965181"><span class="hs-identifier hs-var">field</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-604"></span><span>
</span><span id="line-605"></span><span class="hs-comment">-- In the case of embedding, there won't be any datatype created yet.</span><span>
</span><span id="line-606"></span><span class="hs-comment">-- We just use SqlString, as the data will be serialized to JSON.</span><span>
</span><span id="line-607"></span><span id="local-6989586621679965176"><span class="annot"><a href="Database.Persist.TH.html#defaultSqlTypeExp"><span class="hs-identifier hs-type">defaultSqlTypeExp</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><span class="hs-identifier hs-type">M.Map</span></span><span> </span><span class="annot"><a href="Database.Persist.Names.html#EntityNameHS"><span class="hs-identifier hs-type">EntityNameHS</span></a></span><span> </span><span class="annot"><a href="#local-6989586621679965176"><span class="hs-identifier hs-type">a</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="Database.Persist.TH.html#EntityMap"><span class="hs-identifier hs-type">EntityMap</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="Database.Persist.Quasi.Internal.html#UnboundFieldDef"><span class="hs-identifier hs-type">UnboundFieldDef</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="Database.Persist.TH.html#SqlTypeExp"><span class="hs-identifier hs-type">SqlTypeExp</span></a></span></span><span>
</span><span id="line-608"></span><span id="defaultSqlTypeExp"><span class="annot"><span class="annottext">defaultSqlTypeExp :: forall a.
Map EntityNameHS a -&gt; EntityMap -&gt; UnboundFieldDef -&gt; SqlTypeExp
</span><a href="Database.Persist.TH.html#defaultSqlTypeExp"><span class="hs-identifier hs-var hs-var">defaultSqlTypeExp</span></a></span></span><span> </span><span id="local-6989586621679965174"><span class="annot"><span class="annottext">Map EntityNameHS a
</span><a href="#local-6989586621679965174"><span class="hs-identifier hs-var">emEntities</span></a></span></span><span> </span><span id="local-6989586621679965173"><span class="annot"><span class="annottext">EntityMap
</span><a href="#local-6989586621679965173"><span class="hs-identifier hs-var">entityMap</span></a></span></span><span> </span><span id="local-6989586621679965172"><span class="annot"><span class="annottext">UnboundFieldDef
</span><a href="#local-6989586621679965172"><span class="hs-identifier hs-var">field</span></a></span></span><span> </span><span class="hs-glyph">=</span><span>
</span><span id="line-609"></span><span>    </span><span class="hs-keyword">case</span><span> </span><span class="annot"><span class="annottext">forall a.
Map EntityNameHS a
-&gt; FieldType -&gt; Either (Maybe FTTypeConDescr) EntityNameHS
</span><a href="Database.Persist.TH.html#mEmbedded"><span class="hs-identifier hs-var">mEmbedded</span></a></span><span> </span><span class="annot"><span class="annottext">Map EntityNameHS a
</span><a href="#local-6989586621679965174"><span class="hs-identifier hs-var">emEntities</span></a></span><span> </span><span class="annot"><span class="annottext">FieldType
</span><a href="#local-6989586621679965170"><span class="hs-identifier hs-var">ftype</span></a></span><span> </span><span class="hs-keyword">of</span><span>
</span><span id="line-610"></span><span>        </span><span class="annot"><span class="hs-identifier hs-type">Right</span></span><span> </span><span class="annot"><span class="annottext">EntityNameHS
</span><span class="hs-identifier">_</span></span><span> </span><span class="hs-glyph">-&gt;</span><span>
</span><span id="line-611"></span><span>            </span><span class="annot"><span class="annottext">SqlType -&gt; SqlTypeExp
</span><a href="Database.Persist.TH.html#SqlType%27"><span class="hs-identifier hs-var">SqlType'</span></a></span><span> </span><span class="annot"><span class="annottext">SqlType
</span><a href="Database.Persist.Types.Base.html#SqlString"><span class="hs-identifier hs-var">SqlString</span></a></span><span>
</span><span id="line-612"></span><span>        </span><span class="annot"><span class="hs-identifier hs-type">Left</span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="hs-identifier hs-type">Just</span></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="Database.Persist.TH.html#FTKeyCon"><span class="hs-identifier hs-type">FTKeyCon</span></a></span><span> </span><span id="local-6989586621679965167"><span class="annot"><span class="annottext">Text
</span><a href="#local-6989586621679965167"><span class="hs-identifier hs-var">ty</span></a></span></span><span class="hs-special">)</span><span class="hs-special">)</span><span> </span><span class="hs-glyph">-&gt;</span><span>
</span><span id="line-613"></span><span>            </span><span class="annot"><span class="annottext">FieldType -&gt; SqlTypeExp
</span><a href="Database.Persist.TH.html#SqlTypeExp"><span class="hs-identifier hs-var">SqlTypeExp</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Maybe Text -&gt; Text -&gt; FieldType
</span><a href="Database.Persist.Types.Base.html#FTTypeCon"><span class="hs-identifier hs-var">FTTypeCon</span></a></span><span> </span><span class="annot"><span class="annottext">forall a. Maybe a
</span><span class="hs-identifier hs-var">Nothing</span></span><span> </span><span class="annot"><span class="annottext">Text
</span><a href="#local-6989586621679965167"><span class="hs-identifier hs-var">ty</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-614"></span><span>        </span><span class="annot"><span class="hs-identifier hs-type">Left</span></span><span> </span><span class="annot"><span class="annottext">Maybe FTTypeConDescr
</span><span class="hs-identifier hs-var">Nothing</span></span><span> </span><span class="hs-glyph">-&gt;</span><span>
</span><span id="line-615"></span><span>            </span><span class="hs-keyword">case</span><span> </span><span class="annot"><span class="annottext">EntityMap -&gt; UnboundFieldDef -&gt; Maybe EntityNameHS
</span><a href="Database.Persist.TH.html#extractForeignRef"><span class="hs-identifier hs-var">extractForeignRef</span></a></span><span> </span><span class="annot"><span class="annottext">EntityMap
</span><a href="#local-6989586621679965173"><span class="hs-identifier hs-var">entityMap</span></a></span><span> </span><span class="annot"><span class="annottext">UnboundFieldDef
</span><a href="#local-6989586621679965172"><span class="hs-identifier hs-var">field</span></a></span><span> </span><span class="hs-keyword">of</span><span>
</span><span id="line-616"></span><span>                </span><span class="annot"><span class="hs-identifier hs-type">Just</span></span><span> </span><span id="local-6989586621679965165"><span class="annot"><span class="annottext">EntityNameHS
</span><a href="#local-6989586621679965165"><span class="hs-identifier hs-var">refName</span></a></span></span><span> </span><span class="hs-glyph">-&gt;</span><span>
</span><span id="line-617"></span><span>                    </span><span class="hs-keyword">case</span><span> </span><span class="annot"><span class="annottext">forall k a. Ord k =&gt; k -&gt; Map k a -&gt; Maybe a
</span><span class="hs-identifier hs-var">M.lookup</span></span><span> </span><span class="annot"><span class="annottext">EntityNameHS
</span><a href="#local-6989586621679965165"><span class="hs-identifier hs-var">refName</span></a></span><span> </span><span class="annot"><span class="annottext">EntityMap
</span><a href="#local-6989586621679965173"><span class="hs-identifier hs-var">entityMap</span></a></span><span> </span><span class="hs-keyword">of</span><span>
</span><span id="line-618"></span><span>                        </span><span class="annot"><span class="annottext">Maybe UnboundEntityDef
</span><span class="hs-identifier hs-var">Nothing</span></span><span> </span><span class="hs-glyph">-&gt;</span><span>
</span><span id="line-619"></span><span>                            </span><span class="hs-comment">-- error $ mconcat</span><span>
</span><span id="line-620"></span><span>                            </span><span class="hs-comment">--     [ &quot;Failed to find model: &quot;</span><span>
</span><span id="line-621"></span><span>                            </span><span class="hs-comment">--     , show refName</span><span>
</span><span id="line-622"></span><span>                            </span><span class="hs-comment">--     , &quot; in entity list: \n&quot;</span><span>
</span><span id="line-623"></span><span>                            </span><span class="hs-comment">--     ]</span><span>
</span><span id="line-624"></span><span>                            </span><span class="hs-comment">--     &lt;&gt; (unlines $ map show $ M.keys $ entityMap)</span><span>
</span><span id="line-625"></span><span>                            </span><span class="hs-comment">-- going to assume that it's fine, will reify it out</span><span>
</span><span id="line-626"></span><span>                            </span><span class="hs-comment">-- right later anyway)</span><span>
</span><span id="line-627"></span><span>                            </span><span class="annot"><span class="annottext">FieldType -&gt; SqlTypeExp
</span><a href="Database.Persist.TH.html#SqlTypeExp"><span class="hs-identifier hs-var">SqlTypeExp</span></a></span><span> </span><span class="annot"><span class="annottext">FieldType
</span><a href="#local-6989586621679965170"><span class="hs-identifier hs-var">ftype</span></a></span><span>
</span><span id="line-628"></span><span>                        </span><span class="hs-comment">-- A ForeignRef is blindly set to an Int64 in setEmbedField</span><span>
</span><span id="line-629"></span><span>                        </span><span class="hs-comment">-- correct that now</span><span>
</span><span id="line-630"></span><span>                        </span><span class="annot"><span class="hs-identifier hs-type">Just</span></span><span> </span><span class="annot"><span class="annottext">UnboundEntityDef
</span><span class="hs-identifier">_</span></span><span> </span><span class="hs-glyph">-&gt;</span><span>
</span><span id="line-631"></span><span>                            </span><span class="annot"><span class="annottext">EntityNameHS -&gt; SqlTypeExp
</span><a href="Database.Persist.TH.html#SqlTypeReference"><span class="hs-identifier hs-var">SqlTypeReference</span></a></span><span> </span><span class="annot"><span class="annottext">EntityNameHS
</span><a href="#local-6989586621679965165"><span class="hs-identifier hs-var">refName</span></a></span><span>
</span><span id="line-632"></span><span>                </span><span class="annot"><span class="annottext">Maybe EntityNameHS
</span><span class="hs-identifier">_</span></span><span> </span><span class="hs-glyph">-&gt;</span><span>
</span><span id="line-633"></span><span>                    </span><span class="hs-keyword">case</span><span> </span><span class="annot"><span class="annottext">FieldType
</span><a href="#local-6989586621679965170"><span class="hs-identifier hs-var">ftype</span></a></span><span> </span><span class="hs-keyword">of</span><span>
</span><span id="line-634"></span><span>                        </span><span class="hs-comment">-- In the case of lists, we always serialize to a string</span><span>
</span><span id="line-635"></span><span>                        </span><span class="hs-comment">-- value (via JSON).</span><span>
</span><span id="line-636"></span><span>                        </span><span class="hs-comment">--</span><span>
</span><span id="line-637"></span><span>                        </span><span class="hs-comment">-- Normally, this would be determined automatically by</span><span>
</span><span id="line-638"></span><span>                        </span><span class="hs-comment">-- SqlTypeExp. However, there's one corner case: if there's</span><span>
</span><span id="line-639"></span><span>                        </span><span class="hs-comment">-- a list of entity IDs, the datatype for the ID has not</span><span>
</span><span id="line-640"></span><span>                        </span><span class="hs-comment">-- yet been created, so the compiler will fail. This extra</span><span>
</span><span id="line-641"></span><span>                        </span><span class="hs-comment">-- clause works around this limitation.</span><span>
</span><span id="line-642"></span><span>                        </span><span class="annot"><a href="Database.Persist.Types.Base.html#FTList"><span class="hs-identifier hs-type">FTList</span></a></span><span> </span><span class="annot"><span class="annottext">FieldType
</span><span class="hs-identifier">_</span></span><span> </span><span class="hs-glyph">-&gt;</span><span>
</span><span id="line-643"></span><span>                            </span><span class="annot"><span class="annottext">SqlType -&gt; SqlTypeExp
</span><a href="Database.Persist.TH.html#SqlType%27"><span class="hs-identifier hs-var">SqlType'</span></a></span><span> </span><span class="annot"><span class="annottext">SqlType
</span><a href="Database.Persist.Types.Base.html#SqlString"><span class="hs-identifier hs-var">SqlString</span></a></span><span>
</span><span id="line-644"></span><span>                        </span><span class="annot"><span class="annottext">FieldType
</span><span class="hs-identifier">_</span></span><span> </span><span class="hs-glyph">-&gt;</span><span>
</span><span id="line-645"></span><span>                            </span><span class="annot"><span class="annottext">FieldType -&gt; SqlTypeExp
</span><a href="Database.Persist.TH.html#SqlTypeExp"><span class="hs-identifier hs-var">SqlTypeExp</span></a></span><span> </span><span class="annot"><span class="annottext">FieldType
</span><a href="#local-6989586621679965170"><span class="hs-identifier hs-var">ftype</span></a></span><span>
</span><span id="line-646"></span><span>    </span><span class="hs-keyword">where</span><span>
</span><span id="line-647"></span><span>        </span><span id="local-6989586621679965170"><span class="annot"><span class="annottext">ftype :: FieldType
</span><a href="#local-6989586621679965170"><span class="hs-identifier hs-var hs-var">ftype</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">UnboundFieldDef -&gt; FieldType
</span><a href="Database.Persist.Quasi.Internal.html#unboundFieldType"><span class="hs-identifier hs-var">unboundFieldType</span></a></span><span> </span><span class="annot"><span class="annottext">UnboundFieldDef
</span><a href="#local-6989586621679965172"><span class="hs-identifier hs-var">field</span></a></span><span>
</span><span id="line-648"></span><span>
</span><span id="line-649"></span><span class="annot"><a href="Database.Persist.TH.html#attrSqlType"><span class="hs-identifier hs-type">attrSqlType</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><a href="Database.Persist.Types.Base.html#FieldAttr"><span class="hs-identifier hs-type">FieldAttr</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="hs-identifier hs-type">Maybe</span></span><span> </span><span class="annot"><span class="hs-identifier hs-type">Text</span></span><span>
</span><span id="line-650"></span><span id="attrSqlType"><span class="annot"><span class="annottext">attrSqlType :: FieldAttr -&gt; Maybe Text
</span><a href="Database.Persist.TH.html#attrSqlType"><span class="hs-identifier hs-var hs-var">attrSqlType</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-glyph">\</span><span class="hs-glyph">case</span><span>
</span><span id="line-651"></span><span>    </span><span class="annot"><a href="Database.Persist.Types.Base.html#FieldAttrSqltype"><span class="hs-identifier hs-type">FieldAttrSqltype</span></a></span><span> </span><span id="local-6989586621679965162"><span class="annot"><span class="annottext">Text
</span><a href="#local-6989586621679965162"><span class="hs-identifier hs-var">x</span></a></span></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="annottext">forall a. a -&gt; Maybe a
</span><span class="hs-identifier hs-var">Just</span></span><span> </span><span class="annot"><span class="annottext">Text
</span><a href="#local-6989586621679965162"><span class="hs-identifier hs-var">x</span></a></span><span>
</span><span id="line-652"></span><span>    </span><span class="annot"><span class="annottext">FieldAttr
</span><span class="hs-identifier">_</span></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="annottext">forall a. Maybe a
</span><span class="hs-identifier hs-var">Nothing</span></span><span>
</span><span id="line-653"></span><span>
</span><span id="line-654"></span><span class="hs-keyword">data</span><span> </span><span id="SqlTypeExp"><span class="annot"><a href="Database.Persist.TH.html#SqlTypeExp"><span class="hs-identifier hs-var">SqlTypeExp</span></a></span></span><span>
</span><span id="line-655"></span><span>    </span><span class="hs-glyph">=</span><span> </span><span id="SqlTypeExp"><span class="annot"><a href="Database.Persist.TH.html#SqlTypeExp"><span class="hs-identifier hs-var">SqlTypeExp</span></a></span></span><span> </span><span class="annot"><a href="Database.Persist.Types.Base.html#FieldType"><span class="hs-identifier hs-type">FieldType</span></a></span><span>
</span><span id="line-656"></span><span>    </span><span class="hs-glyph">|</span><span> </span><span id="SqlType%27"><span class="annot"><a href="Database.Persist.TH.html#SqlType%27"><span class="hs-identifier hs-var">SqlType'</span></a></span></span><span> </span><span class="annot"><a href="Database.Persist.Types.Base.html#SqlType"><span class="hs-identifier hs-type">SqlType</span></a></span><span>
</span><span id="line-657"></span><span>    </span><span class="hs-glyph">|</span><span> </span><span id="SqlTypeReference"><span class="annot"><a href="Database.Persist.TH.html#SqlTypeReference"><span class="hs-identifier hs-var">SqlTypeReference</span></a></span></span><span> </span><span class="annot"><a href="Database.Persist.Names.html#EntityNameHS"><span class="hs-identifier hs-type">EntityNameHS</span></a></span><span>
</span><span id="line-658"></span><span>    </span><span class="hs-keyword">deriving</span><span> </span><span id="local-6989586621679965148"><span id="local-6989586621679965150"><span id="local-6989586621679965160"><span class="annot"><span class="annottext">Int -&gt; SqlTypeExp -&gt; ShowS
[SqlTypeExp] -&gt; ShowS
SqlTypeExp -&gt; String
forall a.
(Int -&gt; a -&gt; ShowS) -&gt; (a -&gt; String) -&gt; ([a] -&gt; ShowS) -&gt; Show a
showList :: [SqlTypeExp] -&gt; ShowS
$cshowList :: [SqlTypeExp] -&gt; ShowS
show :: SqlTypeExp -&gt; String
$cshow :: SqlTypeExp -&gt; String
showsPrec :: Int -&gt; SqlTypeExp -&gt; ShowS
$cshowsPrec :: Int -&gt; SqlTypeExp -&gt; ShowS
</span><span class="hs-identifier hs-var hs-var hs-var hs-var hs-var hs-var hs-var hs-var">Show</span></span></span></span></span><span>
</span><span id="line-659"></span><span>
</span><span id="line-660"></span><span class="annot"><a href="Database.Persist.TH.html#liftSqlTypeExp"><span class="hs-identifier hs-type">liftSqlTypeExp</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><a href="Database.Persist.TH.html#SqlTypeExp"><span class="hs-identifier hs-type">SqlTypeExp</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="hs-identifier hs-type">Q</span></span><span> </span><span class="annot"><span class="hs-identifier hs-type">Exp</span></span><span>
</span><span id="line-661"></span><span id="liftSqlTypeExp"><span class="annot"><span class="annottext">liftSqlTypeExp :: SqlTypeExp -&gt; Q Exp
</span><a href="Database.Persist.TH.html#liftSqlTypeExp"><span class="hs-identifier hs-var hs-var">liftSqlTypeExp</span></a></span></span><span> </span><span id="local-6989586621679965146"><span class="annot"><span class="annottext">SqlTypeExp
</span><a href="#local-6989586621679965146"><span class="hs-identifier hs-var">ste</span></a></span></span><span> </span><span class="hs-glyph">=</span><span>
</span><span id="line-662"></span><span>    </span><span class="hs-keyword">case</span><span> </span><span class="annot"><span class="annottext">SqlTypeExp
</span><a href="#local-6989586621679965146"><span class="hs-identifier hs-var">ste</span></a></span><span> </span><span class="hs-keyword">of</span><span>
</span><span id="line-663"></span><span>        </span><span class="annot"><a href="Database.Persist.TH.html#SqlType%27"><span class="hs-identifier hs-type">SqlType'</span></a></span><span> </span><span id="local-6989586621679965145"><span class="annot"><span class="annottext">SqlType
</span><a href="#local-6989586621679965145"><span class="hs-identifier hs-var">t</span></a></span></span><span> </span><span class="hs-glyph">-&gt;</span><span>
</span><span id="line-664"></span><span>            </span><span class="annot"><span class="annottext">forall t (m :: * -&gt; *). (Lift t, Quote m) =&gt; t -&gt; m Exp
</span><span class="hs-identifier hs-var">lift</span></span><span> </span><span class="annot"><span class="annottext">SqlType
</span><a href="#local-6989586621679965145"><span class="hs-identifier hs-var">t</span></a></span><span>
</span><span id="line-665"></span><span>        </span><span class="annot"><a href="Database.Persist.TH.html#SqlTypeExp"><span class="hs-identifier hs-type">SqlTypeExp</span></a></span><span> </span><span id="local-6989586621679965144"><span class="annot"><span class="annottext">FieldType
</span><a href="#local-6989586621679965144"><span class="hs-identifier hs-var">ftype</span></a></span></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-keyword">do</span><span>
</span><span id="line-666"></span><span>            </span><span class="hs-keyword">let</span><span>
</span><span id="line-667"></span><span>                </span><span id="local-6989586621679965143"><span class="annot"><span class="annottext">typ :: Type
</span><a href="#local-6989586621679965143"><span class="hs-identifier hs-var hs-var">typ</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">FieldType -&gt; Type
</span><a href="Database.Persist.TH.html#ftToType"><span class="hs-identifier hs-var">ftToType</span></a></span><span> </span><span class="annot"><span class="annottext">FieldType
</span><a href="#local-6989586621679965144"><span class="hs-identifier hs-var">ftype</span></a></span><span>
</span><span id="line-668"></span><span>                </span><span id="local-6989586621679965141"><span class="annot"><span class="annottext">mtyp :: Type
</span><a href="#local-6989586621679965141"><span class="hs-identifier hs-var hs-var">mtyp</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">Name -&gt; Type
</span><span class="hs-identifier hs-var">ConT</span></span><span> </span><span class="hs-special">''</span><span class="hs-identifier">Proxy</span><span> </span><span class="annot"><span class="annottext">Type -&gt; Type -&gt; Type
</span><span class="hs-operator hs-var">`AppT`</span></span><span> </span><span class="annot"><span class="annottext">Type
</span><a href="#local-6989586621679965143"><span class="hs-identifier hs-var">typ</span></a></span><span>
</span><span id="line-669"></span><span>                </span><span id="local-6989586621679965138"><span class="annot"><span class="annottext">typedNothing :: Exp
</span><a href="#local-6989586621679965138"><span class="hs-identifier hs-var hs-var">typedNothing</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">Exp -&gt; Type -&gt; Exp
</span><span class="hs-identifier hs-var">SigE</span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Name -&gt; Exp
</span><span class="hs-identifier hs-var">ConE</span></span><span> </span><span class="hs-special">'</span><span class="hs-identifier">Proxy</span><span class="hs-special">)</span><span> </span><span class="annot"><span class="annottext">Type
</span><a href="#local-6989586621679965141"><span class="hs-identifier hs-var">mtyp</span></a></span><span>
</span><span id="line-670"></span><span>            </span><span class="annot"><span class="annottext">forall (f :: * -&gt; *) a. Applicative f =&gt; a -&gt; f a
</span><span class="hs-identifier hs-var">pure</span></span><span> </span><span class="annot"><span class="annottext">forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span> </span><span class="annot"><span class="annottext">Name -&gt; Exp
</span><span class="hs-identifier hs-var">VarE</span></span><span> </span><span class="hs-special">'</span><span class="hs-identifier">sqlType</span><span> </span><span class="annot"><span class="annottext">Exp -&gt; Exp -&gt; Exp
</span><span class="hs-operator hs-var">`AppE`</span></span><span> </span><span class="annot"><span class="annottext">Exp
</span><a href="#local-6989586621679965138"><span class="hs-identifier hs-var">typedNothing</span></a></span><span>
</span><span id="line-671"></span><span>        </span><span class="annot"><a href="Database.Persist.TH.html#SqlTypeReference"><span class="hs-identifier hs-type">SqlTypeReference</span></a></span><span> </span><span id="local-6989586621679965133"><span class="annot"><span class="annottext">EntityNameHS
</span><a href="#local-6989586621679965133"><span class="hs-identifier hs-var">entNameHs</span></a></span></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-keyword">do</span><span>
</span><span id="line-672"></span><span>            </span><span class="hs-keyword">let</span><span>
</span><span id="line-673"></span><span>                </span><span class="annot"><a href="#local-6989586621679965132"><span class="hs-identifier hs-type">entNameId</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><span class="hs-identifier hs-type">Name</span></span><span>
</span><span id="line-674"></span><span>                </span><span id="local-6989586621679965132"><span class="annot"><span class="annottext">entNameId :: Name
</span><a href="#local-6989586621679965132"><span class="hs-identifier hs-var hs-var">entNameId</span></a></span></span><span> </span><span class="hs-glyph">=</span><span>
</span><span id="line-675"></span><span>                    </span><span class="annot"><span class="annottext">String -&gt; Name
</span><span class="hs-identifier hs-var">mkName</span></span><span> </span><span class="annot"><span class="annottext">forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span> </span><span class="annot"><span class="annottext">Text -&gt; String
</span><span class="hs-identifier hs-var">T.unpack</span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">EntityNameHS -&gt; Text
</span><a href="Database.Persist.Names.html#unEntityNameHS"><span class="hs-identifier hs-var">unEntityNameHS</span></a></span><span> </span><span class="annot"><span class="annottext">EntityNameHS
</span><a href="#local-6989586621679965133"><span class="hs-identifier hs-var">entNameHs</span></a></span><span class="hs-special">)</span><span> </span><span class="annot"><span class="annottext">forall a. Semigroup a =&gt; a -&gt; a -&gt; a
</span><span class="hs-operator hs-var">&lt;&gt;</span></span><span> </span><span class="annot"><span class="annottext">String
</span><span class="hs-string">&quot;Id&quot;</span></span><span>
</span><span id="line-676"></span><span>
</span><span id="line-677"></span><span>            </span><span class="hs-special">[|</span><span> </span><span class="hs-identifier">sqlType</span><span> </span><span class="hs-special">(</span><span class="hs-identifier">Proxy</span><span> </span><span class="hs-glyph">::</span><span> </span><span class="hs-identifier">Proxy</span><span> </span><span class="hs-special">$</span><span class="hs-special">(</span><span class="hs-identifier">conT</span><span> </span><span class="hs-identifier">entNameId</span><span class="hs-special">)</span><span class="hs-special">)</span><span> </span><span class="hs-special">|]</span><span>
</span><span id="line-678"></span><span>
</span><span id="line-679"></span><span>
</span><span id="line-680"></span><span class="hs-keyword">type</span><span> </span><span id="EmbedEntityMap"><span class="annot"><a href="Database.Persist.TH.html#EmbedEntityMap"><span class="hs-identifier hs-var">EmbedEntityMap</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="hs-identifier hs-type">M.Map</span></span><span> </span><span class="annot"><a href="Database.Persist.Names.html#EntityNameHS"><span class="hs-identifier hs-type">EntityNameHS</span></a></span><span> </span><span class="hs-special">(</span><span class="hs-special">)</span><span>
</span><span id="line-681"></span><span>
</span><span id="line-682"></span><span class="annot"><a href="Database.Persist.TH.html#constructEmbedEntityMap"><span class="hs-identifier hs-type">constructEmbedEntityMap</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="hs-special">[</span><span class="annot"><a href="Database.Persist.Quasi.Internal.html#UnboundEntityDef"><span class="hs-identifier hs-type">UnboundEntityDef</span></a></span><span class="hs-special">]</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="Database.Persist.TH.html#EmbedEntityMap"><span class="hs-identifier hs-type">EmbedEntityMap</span></a></span><span>
</span><span id="line-683"></span><span id="constructEmbedEntityMap"><span class="annot"><span class="annottext">constructEmbedEntityMap :: [UnboundEntityDef] -&gt; EmbedEntityMap
</span><a href="Database.Persist.TH.html#constructEmbedEntityMap"><span class="hs-identifier hs-var hs-var">constructEmbedEntityMap</span></a></span></span><span> </span><span class="hs-glyph">=</span><span>
</span><span id="line-684"></span><span>    </span><span class="annot"><span class="annottext">forall k a. Ord k =&gt; [(k, a)] -&gt; Map k a
</span><span class="hs-identifier hs-var">M.fromList</span></span><span> </span><span class="annot"><span class="annottext">forall b c a. (b -&gt; c) -&gt; (a -&gt; b) -&gt; a -&gt; c
</span><span class="hs-operator hs-var">.</span></span><span> </span><span class="annot"><span class="annottext">forall (f :: * -&gt; *) a b. Functor f =&gt; (a -&gt; b) -&gt; f a -&gt; f b
</span><span class="hs-identifier hs-var">fmap</span></span><span>
</span><span id="line-685"></span><span>        </span><span class="hs-special">(</span><span class="hs-glyph">\</span><span id="local-6989586621679965130"><span class="annot"><span class="annottext">UnboundEntityDef
</span><a href="#local-6989586621679965130"><span class="hs-identifier hs-var">ent</span></a></span></span><span> </span><span class="hs-glyph">-&gt;</span><span>
</span><span id="line-686"></span><span>                </span><span class="hs-special">(</span><span> </span><span class="annot"><span class="annottext">EntityDef -&gt; EntityNameHS
</span><a href="Database.Persist.Types.Base.html#entityHaskell"><span class="hs-identifier hs-var">entityHaskell</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">UnboundEntityDef -&gt; EntityDef
</span><a href="Database.Persist.Quasi.Internal.html#unboundEntityDef"><span class="hs-identifier hs-var">unboundEntityDef</span></a></span><span> </span><span class="annot"><span class="annottext">UnboundEntityDef
</span><a href="#local-6989586621679965130"><span class="hs-identifier hs-var">ent</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-687"></span><span>                </span><span class="hs-comment">-- , toEmbedEntityDef (unboundEntityDef ent)</span><span>
</span><span id="line-688"></span><span>                </span><span class="hs-special">,</span><span> </span><span class="hs-special">(</span><span class="hs-special">)</span><span>
</span><span id="line-689"></span><span>                </span><span class="hs-special">)</span><span>
</span><span id="line-690"></span><span>        </span><span class="hs-special">)</span><span>
</span><span id="line-691"></span><span>
</span><span id="line-692"></span><span id="local-6989586621679966501"><span class="annot"><a href="Database.Persist.TH.html#lookupEmbedEntity"><span class="hs-identifier hs-type">lookupEmbedEntity</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><span class="hs-identifier hs-type">M.Map</span></span><span> </span><span class="annot"><a href="Database.Persist.Names.html#EntityNameHS"><span class="hs-identifier hs-type">EntityNameHS</span></a></span><span> </span><span class="annot"><a href="#local-6989586621679966501"><span class="hs-identifier hs-type">a</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="Database.Persist.Types.Base.html#FieldDef"><span class="hs-identifier hs-type">FieldDef</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="hs-identifier hs-type">Maybe</span></span><span> </span><span class="annot"><a href="Database.Persist.Names.html#EntityNameHS"><span class="hs-identifier hs-type">EntityNameHS</span></a></span></span><span>
</span><span id="line-693"></span><span id="lookupEmbedEntity"><span class="annot"><span class="annottext">lookupEmbedEntity :: forall a. Map EntityNameHS a -&gt; FieldDef -&gt; Maybe EntityNameHS
</span><a href="Database.Persist.TH.html#lookupEmbedEntity"><span class="hs-identifier hs-var hs-var">lookupEmbedEntity</span></a></span></span><span> </span><span id="local-6989586621679965122"><span class="annot"><span class="annottext">Map EntityNameHS a
</span><a href="#local-6989586621679965122"><span class="hs-identifier hs-var">allEntities</span></a></span></span><span> </span><span id="local-6989586621679965121"><span class="annot"><span class="annottext">FieldDef
</span><a href="#local-6989586621679965121"><span class="hs-identifier hs-var">field</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-keyword">do</span><span>
</span><span id="line-694"></span><span>    </span><span id="local-6989586621679965120"><span class="annot"><span class="annottext">EntityNameHS
</span><a href="#local-6989586621679965120"><span class="hs-identifier hs-var">entName</span></a></span></span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">Text -&gt; EntityNameHS
</span><a href="Database.Persist.Names.html#EntityNameHS"><span class="hs-identifier hs-var">EntityNameHS</span></a></span><span> </span><span class="annot"><span class="annottext">forall (f :: * -&gt; *) a b. Functor f =&gt; (a -&gt; b) -&gt; f a -&gt; f b
</span><span class="hs-operator hs-var">&lt;$&gt;</span></span><span> </span><span class="annot"><span class="annottext">FieldType -&gt; Maybe Text
</span><a href="Database.Persist.TH.html#stripId"><span class="hs-identifier hs-var">stripId</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">FieldDef -&gt; FieldType
</span><a href="Database.Persist.Types.Base.html#fieldType"><span class="hs-identifier hs-var">fieldType</span></a></span><span> </span><span class="annot"><span class="annottext">FieldDef
</span><a href="#local-6989586621679965121"><span class="hs-identifier hs-var">field</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-695"></span><span>    </span><span class="annot"><span class="annottext">forall (f :: * -&gt; *). Alternative f =&gt; Bool -&gt; f ()
</span><span class="hs-identifier hs-var">guard</span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">forall k a. Ord k =&gt; k -&gt; Map k a -&gt; Bool
</span><span class="hs-identifier hs-var">M.member</span></span><span> </span><span class="annot"><span class="annottext">EntityNameHS
</span><a href="#local-6989586621679965120"><span class="hs-identifier hs-var">entName</span></a></span><span> </span><span class="annot"><span class="annottext">Map EntityNameHS a
</span><a href="#local-6989586621679965122"><span class="hs-identifier hs-var">allEntities</span></a></span><span class="hs-special">)</span><span> </span><span class="hs-comment">-- check entity name exists in embed fmap</span><span>
</span><span id="line-696"></span><span>    </span><span class="annot"><span class="annottext">forall (f :: * -&gt; *) a. Applicative f =&gt; a -&gt; f a
</span><span class="hs-identifier hs-var">pure</span></span><span> </span><span class="annot"><span class="annottext">EntityNameHS
</span><a href="#local-6989586621679965120"><span class="hs-identifier hs-var">entName</span></a></span><span>
</span><span id="line-697"></span><span>
</span><span id="line-698"></span><span class="hs-keyword">type</span><span> </span><span id="EntityMap"><span class="annot"><a href="Database.Persist.TH.html#EntityMap"><span class="hs-identifier hs-var">EntityMap</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="hs-identifier hs-type">M.Map</span></span><span> </span><span class="annot"><a href="Database.Persist.Names.html#EntityNameHS"><span class="hs-identifier hs-type">EntityNameHS</span></a></span><span> </span><span class="annot"><a href="Database.Persist.Quasi.Internal.html#UnboundEntityDef"><span class="hs-identifier hs-type">UnboundEntityDef</span></a></span><span>
</span><span id="line-699"></span><span>
</span><span id="line-700"></span><span class="annot"><a href="Database.Persist.TH.html#constructEntityMap"><span class="hs-identifier hs-type">constructEntityMap</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="hs-special">[</span><span class="annot"><a href="Database.Persist.Quasi.Internal.html#UnboundEntityDef"><span class="hs-identifier hs-type">UnboundEntityDef</span></a></span><span class="hs-special">]</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="Database.Persist.TH.html#EntityMap"><span class="hs-identifier hs-type">EntityMap</span></a></span><span>
</span><span id="line-701"></span><span id="constructEntityMap"><span class="annot"><span class="annottext">constructEntityMap :: [UnboundEntityDef] -&gt; EntityMap
</span><a href="Database.Persist.TH.html#constructEntityMap"><span class="hs-identifier hs-var hs-var">constructEntityMap</span></a></span></span><span> </span><span class="hs-glyph">=</span><span>
</span><span id="line-702"></span><span>    </span><span class="annot"><span class="annottext">forall k a. Ord k =&gt; [(k, a)] -&gt; Map k a
</span><span class="hs-identifier hs-var">M.fromList</span></span><span> </span><span class="annot"><span class="annottext">forall b c a. (b -&gt; c) -&gt; (a -&gt; b) -&gt; a -&gt; c
</span><span class="hs-operator hs-var">.</span></span><span> </span><span class="annot"><span class="annottext">forall (f :: * -&gt; *) a b. Functor f =&gt; (a -&gt; b) -&gt; f a -&gt; f b
</span><span class="hs-identifier hs-var">fmap</span></span><span> </span><span class="hs-special">(</span><span class="hs-glyph">\</span><span id="local-6989586621679965116"><span class="annot"><span class="annottext">UnboundEntityDef
</span><a href="#local-6989586621679965116"><span class="hs-identifier hs-var">ent</span></a></span></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">EntityDef -&gt; EntityNameHS
</span><a href="Database.Persist.Types.Base.html#entityHaskell"><span class="hs-identifier hs-var">entityHaskell</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">UnboundEntityDef -&gt; EntityDef
</span><a href="Database.Persist.Quasi.Internal.html#unboundEntityDef"><span class="hs-identifier hs-var">unboundEntityDef</span></a></span><span> </span><span class="annot"><span class="annottext">UnboundEntityDef
</span><a href="#local-6989586621679965116"><span class="hs-identifier hs-var">ent</span></a></span><span class="hs-special">)</span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">UnboundEntityDef
</span><a href="#local-6989586621679965116"><span class="hs-identifier hs-var">ent</span></a></span><span class="hs-special">)</span><span class="hs-special">)</span><span>
</span><span id="line-703"></span><span>
</span><span id="line-704"></span><span class="hs-keyword">data</span><span> </span><span id="FTTypeConDescr"><span class="annot"><a href="Database.Persist.TH.html#FTTypeConDescr"><span class="hs-identifier hs-var">FTTypeConDescr</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span id="FTKeyCon"><span class="annot"><a href="Database.Persist.TH.html#FTKeyCon"><span class="hs-identifier hs-var">FTKeyCon</span></a></span></span><span> </span><span class="annot"><span class="hs-identifier hs-type">Text</span></span><span>
</span><span id="line-705"></span><span>    </span><span class="hs-keyword">deriving</span><span> </span><span id="local-6989586621679965108"><span id="local-6989586621679965110"><span id="local-6989586621679965114"><span class="annot"><span class="annottext">Int -&gt; FTTypeConDescr -&gt; ShowS
[FTTypeConDescr] -&gt; ShowS
FTTypeConDescr -&gt; String
forall a.
(Int -&gt; a -&gt; ShowS) -&gt; (a -&gt; String) -&gt; ([a] -&gt; ShowS) -&gt; Show a
showList :: [FTTypeConDescr] -&gt; ShowS
$cshowList :: [FTTypeConDescr] -&gt; ShowS
show :: FTTypeConDescr -&gt; String
$cshow :: FTTypeConDescr -&gt; String
showsPrec :: Int -&gt; FTTypeConDescr -&gt; ShowS
$cshowsPrec :: Int -&gt; FTTypeConDescr -&gt; ShowS
</span><span class="hs-identifier hs-var hs-var hs-var hs-var hs-var hs-var hs-var hs-var">Show</span></span></span></span></span><span>
</span><span id="line-706"></span><span>
</span><span id="line-707"></span><span class="hs-comment">-- | Recurses through the 'FieldType'. Returns a 'Right' with the</span><span>
</span><span id="line-708"></span><span class="hs-comment">-- 'EmbedEntityDef' if the 'FieldType' corresponds to an unqualified use of</span><span>
</span><span id="line-709"></span><span class="hs-comment">-- a name and that name is present in the 'EmbedEntityMap' provided as</span><span>
</span><span id="line-710"></span><span class="hs-comment">-- a first argument.</span><span>
</span><span id="line-711"></span><span class="hs-comment">--</span><span>
</span><span id="line-712"></span><span class="hs-comment">-- If the 'FieldType' represents a @Key something@, this returns a @'Left</span><span>
</span><span id="line-713"></span><span class="hs-comment">-- ('Just' 'FTKeyCon')@.</span><span>
</span><span id="line-714"></span><span class="hs-comment">--</span><span>
</span><span id="line-715"></span><span class="hs-comment">-- If the 'FieldType' has a module qualified value, then it returns @'Left'</span><span>
</span><span id="line-716"></span><span class="hs-comment">-- 'Nothing'@.</span><span>
</span><span id="line-717"></span><span id="local-6989586621679966503"><span class="annot"><a href="Database.Persist.TH.html#mEmbedded"><span class="hs-identifier hs-type">mEmbedded</span></a></span><span>
</span><span id="line-718"></span><span>    </span><span class="hs-glyph">::</span><span> </span><span class="annot"><span class="hs-identifier hs-type">M.Map</span></span><span> </span><span class="annot"><a href="Database.Persist.Names.html#EntityNameHS"><span class="hs-identifier hs-type">EntityNameHS</span></a></span><span> </span><span class="annot"><a href="#local-6989586621679966503"><span class="hs-identifier hs-type">a</span></a></span><span>
</span><span id="line-719"></span><span>    </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="Database.Persist.Types.Base.html#FieldType"><span class="hs-identifier hs-type">FieldType</span></a></span><span>
</span><span id="line-720"></span><span>    </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="hs-identifier hs-type">Either</span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="hs-identifier hs-type">Maybe</span></span><span> </span><span class="annot"><a href="Database.Persist.TH.html#FTTypeConDescr"><span class="hs-identifier hs-type">FTTypeConDescr</span></a></span><span class="hs-special">)</span><span> </span><span class="annot"><a href="Database.Persist.Names.html#EntityNameHS"><span class="hs-identifier hs-type">EntityNameHS</span></a></span></span><span>
</span><span id="line-721"></span><span id="mEmbedded"><span class="annot"><span class="annottext">mEmbedded :: forall a.
Map EntityNameHS a
-&gt; FieldType -&gt; Either (Maybe FTTypeConDescr) EntityNameHS
</span><a href="Database.Persist.TH.html#mEmbedded"><span class="hs-identifier hs-var hs-var">mEmbedded</span></a></span></span><span> </span><span class="annot"><span class="annottext">Map EntityNameHS a
</span><span class="hs-identifier">_</span></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="Database.Persist.Types.Base.html#FTTypeCon"><span class="hs-identifier hs-type">FTTypeCon</span></a></span><span> </span><span class="annot"><span class="hs-identifier hs-type">Just</span></span><span class="hs-special">{</span><span class="hs-special">}</span><span> </span><span class="annot"><span class="annottext">Text
</span><span class="hs-identifier">_</span></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">=</span><span>
</span><span id="line-722"></span><span>    </span><span class="annot"><span class="annottext">forall a b. a -&gt; Either a b
</span><span class="hs-identifier hs-var">Left</span></span><span> </span><span class="annot"><span class="annottext">forall a. Maybe a
</span><span class="hs-identifier hs-var">Nothing</span></span><span>
</span><span id="line-723"></span><span class="annot"><a href="Database.Persist.TH.html#mEmbedded"><span class="hs-identifier hs-var">mEmbedded</span></a></span><span> </span><span id="local-6989586621679965102"><span class="annot"><span class="annottext">Map EntityNameHS a
</span><a href="#local-6989586621679965102"><span class="hs-identifier hs-var">ents</span></a></span></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="Database.Persist.Types.Base.html#FTTypeCon"><span class="hs-identifier hs-type">FTTypeCon</span></a></span><span> </span><span class="annot"><span class="annottext">Maybe Text
</span><span class="hs-identifier hs-var">Nothing</span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Text -&gt; EntityNameHS
</span><a href="Database.Persist.Names.html#EntityNameHS"><span class="hs-identifier hs-var">EntityNameHS</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span id="local-6989586621679965101"><span class="annot"><span class="annottext">EntityNameHS
</span><a href="#local-6989586621679965101"><span class="hs-identifier hs-var">name</span></a></span></span><span class="hs-special">)</span><span class="hs-special">)</span><span> </span><span class="hs-glyph">=</span><span>
</span><span id="line-724"></span><span>    </span><span class="annot"><span class="annottext">forall b a. b -&gt; (a -&gt; b) -&gt; Maybe a -&gt; b
</span><span class="hs-identifier hs-var">maybe</span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">forall a b. a -&gt; Either a b
</span><span class="hs-identifier hs-var">Left</span></span><span> </span><span class="annot"><span class="annottext">forall a. Maybe a
</span><span class="hs-identifier hs-var">Nothing</span></span><span class="hs-special">)</span><span> </span><span class="hs-special">(</span><span class="hs-glyph">\</span><span class="annot"><span class="annottext">a
</span><span class="hs-identifier">_</span></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="annottext">forall a b. b -&gt; Either a b
</span><span class="hs-identifier hs-var">Right</span></span><span> </span><span class="annot"><span class="annottext">EntityNameHS
</span><a href="#local-6989586621679965101"><span class="hs-identifier hs-var">name</span></a></span><span class="hs-special">)</span><span> </span><span class="annot"><span class="annottext">forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span> </span><span class="annot"><span class="annottext">forall k a. Ord k =&gt; k -&gt; Map k a -&gt; Maybe a
</span><span class="hs-identifier hs-var">M.lookup</span></span><span> </span><span class="annot"><span class="annottext">EntityNameHS
</span><a href="#local-6989586621679965101"><span class="hs-identifier hs-var">name</span></a></span><span> </span><span class="annot"><span class="annottext">Map EntityNameHS a
</span><a href="#local-6989586621679965102"><span class="hs-identifier hs-var">ents</span></a></span><span>
</span><span id="line-725"></span><span class="annot"><a href="Database.Persist.TH.html#mEmbedded"><span class="hs-identifier hs-var">mEmbedded</span></a></span><span> </span><span class="annot"><span class="annottext">Map EntityNameHS a
</span><span class="hs-identifier">_</span></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="Database.Persist.Types.Base.html#FTTypePromoted"><span class="hs-identifier hs-type">FTTypePromoted</span></a></span><span> </span><span class="annot"><span class="annottext">Text
</span><span class="hs-identifier">_</span></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">=</span><span>
</span><span id="line-726"></span><span>    </span><span class="annot"><span class="annottext">forall a b. a -&gt; Either a b
</span><span class="hs-identifier hs-var">Left</span></span><span> </span><span class="annot"><span class="annottext">forall a. Maybe a
</span><span class="hs-identifier hs-var">Nothing</span></span><span>
</span><span id="line-727"></span><span class="annot"><a href="Database.Persist.TH.html#mEmbedded"><span class="hs-identifier hs-var">mEmbedded</span></a></span><span> </span><span id="local-6989586621679965099"><span class="annot"><span class="annottext">Map EntityNameHS a
</span><a href="#local-6989586621679965099"><span class="hs-identifier hs-var">ents</span></a></span></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="Database.Persist.Types.Base.html#FTList"><span class="hs-identifier hs-type">FTList</span></a></span><span> </span><span id="local-6989586621679965098"><span class="annot"><span class="annottext">FieldType
</span><a href="#local-6989586621679965098"><span class="hs-identifier hs-var">x</span></a></span></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">=</span><span>
</span><span id="line-728"></span><span>    </span><span class="annot"><span class="annottext">forall a.
Map EntityNameHS a
-&gt; FieldType -&gt; Either (Maybe FTTypeConDescr) EntityNameHS
</span><a href="Database.Persist.TH.html#mEmbedded"><span class="hs-identifier hs-var">mEmbedded</span></a></span><span> </span><span class="annot"><span class="annottext">Map EntityNameHS a
</span><a href="#local-6989586621679965099"><span class="hs-identifier hs-var">ents</span></a></span><span> </span><span class="annot"><span class="annottext">FieldType
</span><a href="#local-6989586621679965098"><span class="hs-identifier hs-var">x</span></a></span><span>
</span><span id="line-729"></span><span class="annot"><a href="Database.Persist.TH.html#mEmbedded"><span class="hs-identifier hs-var">mEmbedded</span></a></span><span> </span><span class="annot"><span class="annottext">Map EntityNameHS a
</span><span class="hs-identifier">_</span></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="Database.Persist.Types.Base.html#FTApp"><span class="hs-identifier hs-type">FTApp</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="Database.Persist.Types.Base.html#FTTypeCon"><span class="hs-identifier hs-type">FTTypeCon</span></a></span><span> </span><span class="annot"><span class="annottext">Maybe Text
</span><span class="hs-identifier hs-var">Nothing</span></span><span> </span><span class="annot"><span class="annottext">Text
</span><span class="hs-string">&quot;Key&quot;</span></span><span class="hs-special">)</span><span> </span><span class="hs-special">(</span><span class="annot"><a href="Database.Persist.Types.Base.html#FTTypeCon"><span class="hs-identifier hs-type">FTTypeCon</span></a></span><span> </span><span class="annot"><span class="annottext">Maybe Text
</span><span class="hs-identifier">_</span></span><span> </span><span id="local-6989586621679965097"><span class="annot"><span class="annottext">Text
</span><a href="#local-6989586621679965097"><span class="hs-identifier hs-var">a</span></a></span></span><span class="hs-special">)</span><span class="hs-special">)</span><span> </span><span class="hs-glyph">=</span><span>
</span><span id="line-730"></span><span>    </span><span class="annot"><span class="annottext">forall a b. a -&gt; Either a b
</span><span class="hs-identifier hs-var">Left</span></span><span> </span><span class="annot"><span class="annottext">forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span> </span><span class="annot"><span class="annottext">forall a. a -&gt; Maybe a
</span><span class="hs-identifier hs-var">Just</span></span><span> </span><span class="annot"><span class="annottext">forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span> </span><span class="annot"><span class="annottext">Text -&gt; FTTypeConDescr
</span><a href="Database.Persist.TH.html#FTKeyCon"><span class="hs-identifier hs-var">FTKeyCon</span></a></span><span> </span><span class="annot"><span class="annottext">forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span> </span><span class="annot"><span class="annottext">Text
</span><a href="#local-6989586621679965097"><span class="hs-identifier hs-var">a</span></a></span><span> </span><span class="annot"><span class="annottext">forall a. Semigroup a =&gt; a -&gt; a -&gt; a
</span><span class="hs-operator hs-var">&lt;&gt;</span></span><span> </span><span class="annot"><span class="annottext">Text
</span><span class="hs-string">&quot;Id&quot;</span></span><span>
</span><span id="line-731"></span><span class="annot"><a href="Database.Persist.TH.html#mEmbedded"><span class="hs-identifier hs-var">mEmbedded</span></a></span><span> </span><span class="annot"><span class="annottext">Map EntityNameHS a
</span><span class="hs-identifier">_</span></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="Database.Persist.Types.Base.html#FTApp"><span class="hs-identifier hs-type">FTApp</span></a></span><span> </span><span class="annot"><span class="annottext">FieldType
</span><span class="hs-identifier">_</span></span><span> </span><span class="annot"><span class="annottext">FieldType
</span><span class="hs-identifier">_</span></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">=</span><span>
</span><span id="line-732"></span><span>    </span><span class="annot"><span class="annottext">forall a b. a -&gt; Either a b
</span><span class="hs-identifier hs-var">Left</span></span><span> </span><span class="annot"><span class="annottext">forall a. Maybe a
</span><span class="hs-identifier hs-var">Nothing</span></span><span>
</span><span id="line-733"></span><span>
</span><span id="line-734"></span><span id="local-6989586621679966565"><span class="annot"><a href="Database.Persist.TH.html#setEmbedField"><span class="hs-identifier hs-type">setEmbedField</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><a href="Database.Persist.Names.html#EntityNameHS"><span class="hs-identifier hs-type">EntityNameHS</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="hs-identifier hs-type">M.Map</span></span><span> </span><span class="annot"><a href="Database.Persist.Names.html#EntityNameHS"><span class="hs-identifier hs-type">EntityNameHS</span></a></span><span> </span><span class="annot"><a href="#local-6989586621679966565"><span class="hs-identifier hs-type">a</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="Database.Persist.Types.Base.html#FieldDef"><span class="hs-identifier hs-type">FieldDef</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="Database.Persist.Types.Base.html#FieldDef"><span class="hs-identifier hs-type">FieldDef</span></a></span></span><span>
</span><span id="line-735"></span><span id="setEmbedField"><span class="annot"><span class="annottext">setEmbedField :: forall a.
EntityNameHS -&gt; Map EntityNameHS a -&gt; FieldDef -&gt; FieldDef
</span><a href="Database.Persist.TH.html#setEmbedField"><span class="hs-identifier hs-var hs-var">setEmbedField</span></a></span></span><span> </span><span id="local-6989586621679965089"><span class="annot"><span class="annottext">EntityNameHS
</span><a href="#local-6989586621679965089"><span class="hs-identifier hs-var">entName</span></a></span></span><span> </span><span id="local-6989586621679965088"><span class="annot"><span class="annottext">Map EntityNameHS a
</span><a href="#local-6989586621679965088"><span class="hs-identifier hs-var">allEntities</span></a></span></span><span> </span><span id="local-6989586621679965087"><span class="annot"><span class="annottext">FieldDef
</span><a href="#local-6989586621679965087"><span class="hs-identifier hs-var">field</span></a></span></span><span> </span><span class="hs-glyph">=</span><span>
</span><span id="line-736"></span><span>    </span><span class="hs-keyword">case</span><span> </span><span class="annot"><span class="annottext">FieldDef -&gt; ReferenceDef
</span><a href="Database.Persist.Types.Base.html#fieldReference"><span class="hs-identifier hs-var">fieldReference</span></a></span><span> </span><span class="annot"><span class="annottext">FieldDef
</span><a href="#local-6989586621679965087"><span class="hs-identifier hs-var">field</span></a></span><span> </span><span class="hs-keyword">of</span><span>
</span><span id="line-737"></span><span>      </span><span class="annot"><span class="annottext">ReferenceDef
</span><a href="Database.Persist.Types.Base.html#NoReference"><span class="hs-identifier hs-var">NoReference</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span>
</span><span id="line-738"></span><span>          </span><span class="annot"><span class="annottext">ReferenceDef -&gt; FieldDef -&gt; FieldDef
</span><a href="Database.Persist.TH.html#setFieldReference"><span class="hs-identifier hs-var">setFieldReference</span></a></span><span> </span><span class="annot"><span class="annottext">ReferenceDef
</span><a href="#local-6989586621679965084"><span class="hs-identifier hs-var">ref</span></a></span><span> </span><span class="annot"><span class="annottext">FieldDef
</span><a href="#local-6989586621679965087"><span class="hs-identifier hs-var">field</span></a></span><span>
</span><span id="line-739"></span><span>      </span><span class="annot"><span class="annottext">ReferenceDef
</span><span class="hs-identifier">_</span></span><span> </span><span class="hs-glyph">-&gt;</span><span>
</span><span id="line-740"></span><span>          </span><span class="annot"><span class="annottext">FieldDef
</span><a href="#local-6989586621679965087"><span class="hs-identifier hs-var">field</span></a></span><span>
</span><span id="line-741"></span><span>  </span><span class="hs-keyword">where</span><span>
</span><span id="line-742"></span><span>    </span><span id="local-6989586621679965084"><span class="annot"><span class="annottext">ref :: ReferenceDef
</span><a href="#local-6989586621679965084"><span class="hs-identifier hs-var hs-var">ref</span></a></span></span><span> </span><span class="hs-glyph">=</span><span>
</span><span id="line-743"></span><span>        </span><span class="hs-keyword">case</span><span> </span><span class="annot"><span class="annottext">forall a.
Map EntityNameHS a
-&gt; FieldType -&gt; Either (Maybe FTTypeConDescr) EntityNameHS
</span><a href="Database.Persist.TH.html#mEmbedded"><span class="hs-identifier hs-var">mEmbedded</span></a></span><span> </span><span class="annot"><span class="annottext">Map EntityNameHS a
</span><a href="#local-6989586621679965088"><span class="hs-identifier hs-var">allEntities</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">FieldDef -&gt; FieldType
</span><a href="Database.Persist.Types.Base.html#fieldType"><span class="hs-identifier hs-var">fieldType</span></a></span><span> </span><span class="annot"><span class="annottext">FieldDef
</span><a href="#local-6989586621679965087"><span class="hs-identifier hs-var">field</span></a></span><span class="hs-special">)</span><span> </span><span class="hs-keyword">of</span><span>
</span><span id="line-744"></span><span>            </span><span class="annot"><span class="hs-identifier hs-type">Left</span></span><span> </span><span class="annot"><span class="annottext">Maybe FTTypeConDescr
</span><span class="hs-identifier">_</span></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="annottext">forall a. a -&gt; Maybe a -&gt; a
</span><span class="hs-identifier hs-var">fromMaybe</span></span><span> </span><span class="annot"><span class="annottext">ReferenceDef
</span><a href="Database.Persist.Types.Base.html#NoReference"><span class="hs-identifier hs-var">NoReference</span></a></span><span> </span><span class="annot"><span class="annottext">forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span> </span><span class="hs-keyword">do</span><span>
</span><span id="line-745"></span><span>                </span><span id="local-6989586621679965083"><span class="annot"><span class="annottext">EntityNameHS
</span><a href="#local-6989586621679965083"><span class="hs-identifier hs-var">refEntName</span></a></span></span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">forall a. Map EntityNameHS a -&gt; FieldDef -&gt; Maybe EntityNameHS
</span><a href="Database.Persist.TH.html#lookupEmbedEntity"><span class="hs-identifier hs-var">lookupEmbedEntity</span></a></span><span> </span><span class="annot"><span class="annottext">Map EntityNameHS a
</span><a href="#local-6989586621679965088"><span class="hs-identifier hs-var">allEntities</span></a></span><span> </span><span class="annot"><span class="annottext">FieldDef
</span><a href="#local-6989586621679965087"><span class="hs-identifier hs-var">field</span></a></span><span>
</span><span id="line-746"></span><span>                </span><span class="annot"><span class="annottext">forall (f :: * -&gt; *) a. Applicative f =&gt; a -&gt; f a
</span><span class="hs-identifier hs-var">pure</span></span><span> </span><span class="annot"><span class="annottext">forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span> </span><span class="annot"><span class="annottext">EntityNameHS -&gt; ReferenceDef
</span><a href="Database.Persist.Types.Base.html#ForeignRef"><span class="hs-identifier hs-var">ForeignRef</span></a></span><span> </span><span class="annot"><span class="annottext">EntityNameHS
</span><a href="#local-6989586621679965083"><span class="hs-identifier hs-var">refEntName</span></a></span><span>
</span><span id="line-747"></span><span>            </span><span class="annot"><span class="hs-identifier hs-type">Right</span></span><span> </span><span id="local-6989586621679965082"><span class="annot"><span class="annottext">EntityNameHS
</span><a href="#local-6989586621679965082"><span class="hs-identifier hs-var">em</span></a></span></span><span> </span><span class="hs-glyph">-&gt;</span><span>
</span><span id="line-748"></span><span>                </span><span class="hs-keyword">if</span><span> </span><span class="annot"><span class="annottext">EntityNameHS
</span><a href="#local-6989586621679965082"><span class="hs-identifier hs-var">em</span></a></span><span> </span><span class="annot"><span class="annottext">forall a. Eq a =&gt; a -&gt; a -&gt; Bool
</span><span class="hs-operator hs-var">/=</span></span><span> </span><span class="annot"><span class="annottext">EntityNameHS
</span><a href="#local-6989586621679965089"><span class="hs-identifier hs-var">entName</span></a></span><span>
</span><span id="line-749"></span><span>                     </span><span class="hs-keyword">then</span><span> </span><span class="annot"><span class="annottext">EntityNameHS -&gt; ReferenceDef
</span><a href="Database.Persist.Types.Base.html#EmbedRef"><span class="hs-identifier hs-var">EmbedRef</span></a></span><span> </span><span class="annot"><span class="annottext">EntityNameHS
</span><a href="#local-6989586621679965082"><span class="hs-identifier hs-var">em</span></a></span><span>
</span><span id="line-750"></span><span>                </span><span class="hs-keyword">else</span><span> </span><span class="hs-keyword">if</span><span> </span><span class="annot"><span class="annottext">UnboundFieldDef -&gt; Bool
</span><a href="Database.Persist.TH.html#maybeNullable"><span class="hs-identifier hs-var">maybeNullable</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">FieldDef -&gt; UnboundFieldDef
</span><a href="Database.Persist.Quasi.Internal.html#unbindFieldDef"><span class="hs-identifier hs-var">unbindFieldDef</span></a></span><span> </span><span class="annot"><span class="annottext">FieldDef
</span><a href="#local-6989586621679965087"><span class="hs-identifier hs-var">field</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-751"></span><span>                     </span><span class="hs-keyword">then</span><span> </span><span class="annot"><span class="annottext">ReferenceDef
</span><a href="Database.Persist.Types.Base.html#SelfReference"><span class="hs-identifier hs-var">SelfReference</span></a></span><span>
</span><span id="line-752"></span><span>                </span><span class="hs-keyword">else</span><span> </span><span class="hs-keyword">case</span><span> </span><span class="annot"><span class="annottext">FieldDef -&gt; FieldType
</span><a href="Database.Persist.Types.Base.html#fieldType"><span class="hs-identifier hs-var">fieldType</span></a></span><span> </span><span class="annot"><span class="annottext">FieldDef
</span><a href="#local-6989586621679965087"><span class="hs-identifier hs-var">field</span></a></span><span> </span><span class="hs-keyword">of</span><span>
</span><span id="line-753"></span><span>                         </span><span class="annot"><a href="Database.Persist.Types.Base.html#FTList"><span class="hs-identifier hs-type">FTList</span></a></span><span> </span><span class="annot"><span class="annottext">FieldType
</span><span class="hs-identifier">_</span></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="annottext">ReferenceDef
</span><a href="Database.Persist.Types.Base.html#SelfReference"><span class="hs-identifier hs-var">SelfReference</span></a></span><span>
</span><span id="line-754"></span><span>                         </span><span class="annot"><span class="annottext">FieldType
</span><span class="hs-identifier">_</span></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="annottext">forall a. HasCallStack =&gt; String -&gt; a
</span><span class="hs-identifier hs-var">error</span></span><span> </span><span class="annot"><span class="annottext">forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span> </span><span class="annot"><span class="annottext">Text -&gt; String
</span><span class="hs-identifier hs-var">unpack</span></span><span> </span><span class="annot"><span class="annottext">forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span> </span><span class="annot"><span class="annottext">EntityNameHS -&gt; Text
</span><a href="Database.Persist.Names.html#unEntityNameHS"><span class="hs-identifier hs-var">unEntityNameHS</span></a></span><span> </span><span class="annot"><span class="annottext">EntityNameHS
</span><a href="#local-6989586621679965089"><span class="hs-identifier hs-var">entName</span></a></span><span> </span><span class="annot"><span class="annottext">forall a. Semigroup a =&gt; a -&gt; a -&gt; a
</span><span class="hs-operator hs-var">&lt;&gt;</span></span><span> </span><span class="annot"><span class="annottext">Text
</span><span class="hs-string">&quot;: a self reference must be a Maybe or List&quot;</span></span><span>
</span><span id="line-755"></span><span>
</span><span id="line-756"></span><span class="annot"><a href="Database.Persist.TH.html#setFieldReference"><span class="hs-identifier hs-type">setFieldReference</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><a href="Database.Persist.Types.Base.html#ReferenceDef"><span class="hs-identifier hs-type">ReferenceDef</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="Database.Persist.Types.Base.html#FieldDef"><span class="hs-identifier hs-type">FieldDef</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="Database.Persist.Types.Base.html#FieldDef"><span class="hs-identifier hs-type">FieldDef</span></a></span><span>
</span><span id="line-757"></span><span id="setFieldReference"><span class="annot"><span class="annottext">setFieldReference :: ReferenceDef -&gt; FieldDef -&gt; FieldDef
</span><a href="Database.Persist.TH.html#setFieldReference"><span class="hs-identifier hs-var hs-var">setFieldReference</span></a></span></span><span> </span><span id="local-6989586621679965077"><span class="annot"><span class="annottext">ReferenceDef
</span><a href="#local-6989586621679965077"><span class="hs-identifier hs-var">ref</span></a></span></span><span> </span><span id="local-6989586621679965076"><span class="annot"><span class="annottext">FieldDef
</span><a href="#local-6989586621679965076"><span class="hs-identifier hs-var">field</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">FieldDef
</span><a href="#local-6989586621679965076"><span class="hs-identifier hs-var">field</span></a></span><span> </span><span class="hs-special">{</span><span> </span><span class="annot"><span class="annottext">fieldReference :: ReferenceDef
</span><a href="Database.Persist.Types.Base.html#fieldReference"><span class="hs-identifier hs-var">fieldReference</span></a></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">ReferenceDef
</span><a href="#local-6989586621679965077"><span class="hs-identifier hs-var">ref</span></a></span><span> </span><span class="hs-special">}</span><span>
</span><span id="line-758"></span><span>
</span><span id="line-759"></span><span class="hs-comment">-- | Create data types and appropriate 'PersistEntity' instances for the given</span><span>
</span><span id="line-760"></span><span class="hs-comment">-- 'EntityDef's. Works well with the persist quasi-quoter.</span><span>
</span><span id="line-761"></span><span class="annot"><a href="Database.Persist.TH.html#mkPersist"><span class="hs-identifier hs-type">mkPersist</span></a></span><span>
</span><span id="line-762"></span><span>    </span><span class="hs-glyph">::</span><span> </span><span class="annot"><a href="Database.Persist.TH.html#MkPersistSettings"><span class="hs-identifier hs-type">MkPersistSettings</span></a></span><span>
</span><span id="line-763"></span><span>    </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-special">[</span><span class="annot"><a href="Database.Persist.Quasi.Internal.html#UnboundEntityDef"><span class="hs-identifier hs-type">UnboundEntityDef</span></a></span><span class="hs-special">]</span><span>
</span><span id="line-764"></span><span>    </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="hs-identifier hs-type">Q</span></span><span> </span><span class="hs-special">[</span><span class="annot"><span class="hs-identifier hs-type">Dec</span></span><span class="hs-special">]</span><span>
</span><span id="line-765"></span><span id="mkPersist"><span class="annot"><span class="annottext">mkPersist :: MkPersistSettings -&gt; [UnboundEntityDef] -&gt; Q [Dec]
</span><a href="Database.Persist.TH.html#mkPersist"><span class="hs-identifier hs-var hs-var">mkPersist</span></a></span></span><span> </span><span id="local-6989586621679965075"><span class="annot"><span class="annottext">MkPersistSettings
</span><a href="#local-6989586621679965075"><span class="hs-identifier hs-var">mps</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">MkPersistSettings -&gt; [EntityDef] -&gt; [UnboundEntityDef] -&gt; Q [Dec]
</span><a href="Database.Persist.TH.html#mkPersistWith"><span class="hs-identifier hs-var">mkPersistWith</span></a></span><span> </span><span class="annot"><span class="annottext">MkPersistSettings
</span><a href="#local-6989586621679965075"><span class="hs-identifier hs-var">mps</span></a></span><span> </span><span class="hs-special">[</span><span class="hs-special">]</span><span>
</span><span id="line-766"></span><span>
</span><span id="line-767"></span><span class="hs-comment">-- | Like '</span><span>
</span><span id="line-768"></span><span class="hs-comment">--</span><span>
</span><span id="line-769"></span><span class="hs-comment">-- @since 2.13.0.0</span><span>
</span><span id="line-770"></span><span class="annot"><a href="Database.Persist.TH.html#mkPersistWith"><span class="hs-identifier hs-type">mkPersistWith</span></a></span><span>
</span><span id="line-771"></span><span>    </span><span class="hs-glyph">::</span><span> </span><span class="annot"><a href="Database.Persist.TH.html#MkPersistSettings"><span class="hs-identifier hs-type">MkPersistSettings</span></a></span><span>
</span><span id="line-772"></span><span>    </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-special">[</span><span class="annot"><a href="Database.Persist.Types.Base.html#EntityDef"><span class="hs-identifier hs-type">EntityDef</span></a></span><span class="hs-special">]</span><span>
</span><span id="line-773"></span><span>    </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-special">[</span><span class="annot"><a href="Database.Persist.Quasi.Internal.html#UnboundEntityDef"><span class="hs-identifier hs-type">UnboundEntityDef</span></a></span><span class="hs-special">]</span><span>
</span><span id="line-774"></span><span>    </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="hs-identifier hs-type">Q</span></span><span> </span><span class="hs-special">[</span><span class="annot"><span class="hs-identifier hs-type">Dec</span></span><span class="hs-special">]</span><span>
</span><span id="line-775"></span><span id="mkPersistWith"><span class="annot"><span class="annottext">mkPersistWith :: MkPersistSettings -&gt; [EntityDef] -&gt; [UnboundEntityDef] -&gt; Q [Dec]
</span><a href="Database.Persist.TH.html#mkPersistWith"><span class="hs-identifier hs-var hs-var">mkPersistWith</span></a></span></span><span> </span><span id="local-6989586621679965074"><span class="annot"><span class="annottext">MkPersistSettings
</span><a href="#local-6989586621679965074"><span class="hs-identifier hs-var">mps</span></a></span></span><span> </span><span id="local-6989586621679965073"><span class="annot"><span class="annottext">[EntityDef]
</span><a href="#local-6989586621679965073"><span class="hs-identifier hs-var">preexistingEntities</span></a></span></span><span> </span><span id="local-6989586621679965072"><span class="annot"><span class="annottext">[UnboundEntityDef]
</span><a href="#local-6989586621679965072"><span class="hs-identifier hs-var">ents'</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-keyword">do</span><span>
</span><span id="line-776"></span><span>    </span><span class="hs-keyword">let</span><span>
</span><span id="line-777"></span><span>        </span><span class="hs-special">(</span><span id="local-6989586621679965071"><span class="annot"><span class="annottext">EmbedEntityMap
</span><a href="#local-6989586621679965071"><span class="hs-identifier hs-var">embedEntityMap</span></a></span></span><span class="hs-special">,</span><span> </span><span id="local-6989586621679965070"><span class="annot"><span class="annottext">[UnboundEntityDef]
</span><a href="#local-6989586621679965070"><span class="hs-identifier hs-var">predefs</span></a></span></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">=</span><span>
</span><span id="line-778"></span><span>            </span><span class="annot"><span class="annottext">[EntityDef]
-&gt; [UnboundEntityDef] -&gt; (EmbedEntityMap, [UnboundEntityDef])
</span><a href="Database.Persist.TH.html#preprocessUnboundDefs"><span class="hs-identifier hs-var">preprocessUnboundDefs</span></a></span><span> </span><span class="annot"><span class="annottext">[EntityDef]
</span><a href="#local-6989586621679965073"><span class="hs-identifier hs-var">preexistingEntities</span></a></span><span> </span><span class="annot"><span class="annottext">[UnboundEntityDef]
</span><a href="#local-6989586621679965072"><span class="hs-identifier hs-var">ents'</span></a></span><span>
</span><span id="line-779"></span><span>        </span><span id="local-6989586621679965069"><span class="annot"><span class="annottext">allEnts :: [UnboundEntityDef]
</span><a href="#local-6989586621679965069"><span class="hs-identifier hs-var hs-var">allEnts</span></a></span></span><span> </span><span class="hs-glyph">=</span><span>
</span><span id="line-780"></span><span>            </span><span class="annot"><span class="annottext">[EntityDef] -&gt; [UnboundEntityDef] -&gt; [UnboundEntityDef]
</span><a href="Database.Persist.TH.html#embedEntityDefs"><span class="hs-identifier hs-var">embedEntityDefs</span></a></span><span> </span><span class="annot"><span class="annottext">[EntityDef]
</span><a href="#local-6989586621679965073"><span class="hs-identifier hs-var">preexistingEntities</span></a></span><span>
</span><span id="line-781"></span><span>            </span><span class="annot"><span class="annottext">forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span> </span><span class="annot"><span class="annottext">forall (f :: * -&gt; *) a b. Functor f =&gt; (a -&gt; b) -&gt; f a -&gt; f b
</span><span class="hs-identifier hs-var">fmap</span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">MkPersistSettings -&gt; UnboundEntityDef -&gt; UnboundEntityDef
</span><a href="Database.Persist.TH.html#setDefaultIdFields"><span class="hs-identifier hs-var">setDefaultIdFields</span></a></span><span> </span><span class="annot"><span class="annottext">MkPersistSettings
</span><a href="#local-6989586621679965074"><span class="hs-identifier hs-var">mps</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-782"></span><span>            </span><span class="annot"><span class="annottext">forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span> </span><span class="annot"><span class="annottext">[UnboundEntityDef]
</span><a href="#local-6989586621679965070"><span class="hs-identifier hs-var">predefs</span></a></span><span>
</span><span id="line-783"></span><span>        </span><span id="local-6989586621679965067"><span class="annot"><span class="annottext">entityMap :: EntityMap
</span><a href="#local-6989586621679965067"><span class="hs-identifier hs-var hs-var">entityMap</span></a></span></span><span> </span><span class="hs-glyph">=</span><span>
</span><span id="line-784"></span><span>            </span><span class="annot"><span class="annottext">[UnboundEntityDef] -&gt; EntityMap
</span><a href="Database.Persist.TH.html#constructEntityMap"><span class="hs-identifier hs-var">constructEntityMap</span></a></span><span> </span><span class="annot"><span class="annottext">[UnboundEntityDef]
</span><a href="#local-6989586621679965069"><span class="hs-identifier hs-var">allEnts</span></a></span><span>
</span><span id="line-785"></span><span>        </span><span id="local-6989586621679965066"><span class="annot"><span class="annottext">preexistingSet :: Set EntityNameHS
</span><a href="#local-6989586621679965066"><span class="hs-identifier hs-var hs-var">preexistingSet</span></a></span></span><span> </span><span class="hs-glyph">=</span><span>
</span><span id="line-786"></span><span>            </span><span class="annot"><span class="annottext">forall a. Ord a =&gt; [a] -&gt; Set a
</span><span class="hs-identifier hs-var">Set.fromList</span></span><span> </span><span class="annot"><span class="annottext">forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span> </span><span class="annot"><span class="annottext">forall a b. (a -&gt; b) -&gt; [a] -&gt; [b]
</span><span class="hs-identifier hs-var">map</span></span><span> </span><span class="annot"><span class="annottext">EntityDef -&gt; EntityNameHS
</span><a href="Database.Persist.EntityDef.html#getEntityHaskellName"><span class="hs-identifier hs-var">getEntityHaskellName</span></a></span><span> </span><span class="annot"><span class="annottext">[EntityDef]
</span><a href="#local-6989586621679965073"><span class="hs-identifier hs-var">preexistingEntities</span></a></span><span>
</span><span id="line-787"></span><span>        </span><span id="local-6989586621679965063"><span class="annot"><span class="annottext">newEnts :: [UnboundEntityDef]
</span><a href="#local-6989586621679965063"><span class="hs-identifier hs-var hs-var">newEnts</span></a></span></span><span> </span><span class="hs-glyph">=</span><span>
</span><span id="line-788"></span><span>            </span><span class="annot"><span class="annottext">forall a. (a -&gt; Bool) -&gt; [a] -&gt; [a]
</span><span class="hs-identifier hs-var">filter</span></span><span>
</span><span id="line-789"></span><span>                </span><span class="hs-special">(</span><span class="hs-glyph">\</span><span id="local-6989586621679965062"><span class="annot"><span class="annottext">UnboundEntityDef
</span><a href="#local-6989586621679965062"><span class="hs-identifier hs-var">e</span></a></span></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="annottext">UnboundEntityDef -&gt; EntityNameHS
</span><a href="Database.Persist.Quasi.Internal.html#getUnboundEntityNameHS"><span class="hs-identifier hs-var">getUnboundEntityNameHS</span></a></span><span> </span><span class="annot"><span class="annottext">UnboundEntityDef
</span><a href="#local-6989586621679965062"><span class="hs-identifier hs-var">e</span></a></span><span> </span><span class="annot"><span class="annottext">forall a. Ord a =&gt; a -&gt; Set a -&gt; Bool
</span><span class="hs-operator hs-var">`Set.notMember`</span></span><span> </span><span class="annot"><span class="annottext">Set EntityNameHS
</span><a href="#local-6989586621679965066"><span class="hs-identifier hs-var">preexistingSet</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-790"></span><span>                </span><span class="annot"><span class="annottext">[UnboundEntityDef]
</span><a href="#local-6989586621679965069"><span class="hs-identifier hs-var">allEnts</span></a></span><span>
</span><span id="line-791"></span><span>    </span><span id="local-6989586621679965060"><span class="annot"><span class="annottext">[UnboundEntityDef]
</span><a href="#local-6989586621679965060"><span class="hs-identifier hs-var">ents</span></a></span></span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">forall (m :: * -&gt; *) a.
Applicative m =&gt;
(a -&gt; m Bool) -&gt; [a] -&gt; m [a]
</span><span class="hs-identifier hs-var">filterM</span></span><span> </span><span class="annot"><span class="annottext">UnboundEntityDef -&gt; Q Bool
</span><a href="Database.Persist.TH.html#shouldGenerateCode"><span class="hs-identifier hs-var">shouldGenerateCode</span></a></span><span> </span><span class="annot"><span class="annottext">[UnboundEntityDef]
</span><a href="#local-6989586621679965063"><span class="hs-identifier hs-var">newEnts</span></a></span><span>
</span><span id="line-792"></span><span>    </span><span class="annot"><span class="annottext">[[Extension]] -&gt; Q ()
</span><a href="Database.Persist.TH.html#requireExtensions"><span class="hs-identifier hs-var">requireExtensions</span></a></span><span>
</span><span id="line-793"></span><span>        </span><span class="hs-special">[</span><span> </span><span class="hs-special">[</span><span class="annot"><span class="annottext">Extension
</span><span class="hs-identifier hs-var">TypeFamilies</span></span><span class="hs-special">]</span><span class="hs-special">,</span><span> </span><span class="hs-special">[</span><span class="annot"><span class="annottext">Extension
</span><span class="hs-identifier hs-var">GADTs</span></span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">Extension
</span><span class="hs-identifier hs-var">ExistentialQuantification</span></span><span class="hs-special">]</span><span>
</span><span id="line-794"></span><span>        </span><span class="hs-special">,</span><span> </span><span class="hs-special">[</span><span class="annot"><span class="annottext">Extension
</span><span class="hs-identifier hs-var">DerivingStrategies</span></span><span class="hs-special">]</span><span class="hs-special">,</span><span> </span><span class="hs-special">[</span><span class="annot"><span class="annottext">Extension
</span><span class="hs-identifier hs-var">GeneralizedNewtypeDeriving</span></span><span class="hs-special">]</span><span class="hs-special">,</span><span> </span><span class="hs-special">[</span><span class="annot"><span class="annottext">Extension
</span><span class="hs-identifier hs-var">StandaloneDeriving</span></span><span class="hs-special">]</span><span>
</span><span id="line-795"></span><span>        </span><span class="hs-special">,</span><span> </span><span class="hs-special">[</span><span class="annot"><span class="annottext">Extension
</span><span class="hs-identifier hs-var">UndecidableInstances</span></span><span class="hs-special">]</span><span class="hs-special">,</span><span> </span><span class="hs-special">[</span><span class="annot"><span class="annottext">Extension
</span><span class="hs-identifier hs-var">DataKinds</span></span><span class="hs-special">]</span><span class="hs-special">,</span><span> </span><span class="hs-special">[</span><span class="annot"><span class="annottext">Extension
</span><span class="hs-identifier hs-var">FlexibleInstances</span></span><span class="hs-special">]</span><span>
</span><span id="line-796"></span><span>        </span><span class="hs-special">]</span><span>
</span><span id="line-797"></span><span>    </span><span id="local-6989586621679965047"><span class="annot"><span class="annottext">[Dec]
</span><a href="#local-6989586621679965047"><span class="hs-identifier hs-var">persistFieldDecs</span></a></span></span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">forall (f :: * -&gt; *) a b. Functor f =&gt; (a -&gt; b) -&gt; f a -&gt; f b
</span><span class="hs-identifier hs-var">fmap</span></span><span> </span><span class="annot"><span class="annottext">forall a. Monoid a =&gt; [a] -&gt; a
</span><span class="hs-identifier hs-var">mconcat</span></span><span> </span><span class="annot"><span class="annottext">forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span> </span><span class="annot"><span class="annottext">forall (t :: * -&gt; *) (m :: * -&gt; *) a b.
(Traversable t, Monad m) =&gt;
(a -&gt; m b) -&gt; t a -&gt; m (t b)
</span><span class="hs-identifier hs-var">mapM</span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">MkPersistSettings -&gt; UnboundEntityDef -&gt; Q [Dec]
</span><a href="Database.Persist.TH.html#persistFieldFromEntity"><span class="hs-identifier hs-var">persistFieldFromEntity</span></a></span><span> </span><span class="annot"><span class="annottext">MkPersistSettings
</span><a href="#local-6989586621679965074"><span class="hs-identifier hs-var">mps</span></a></span><span class="hs-special">)</span><span> </span><span class="annot"><span class="annottext">[UnboundEntityDef]
</span><a href="#local-6989586621679965060"><span class="hs-identifier hs-var">ents</span></a></span><span>
</span><span id="line-798"></span><span>    </span><span id="local-6989586621679965046"><span class="annot"><span class="annottext">[Dec]
</span><a href="#local-6989586621679965046"><span class="hs-identifier hs-var">entityDecs</span></a></span></span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">forall (f :: * -&gt; *) a b. Functor f =&gt; (a -&gt; b) -&gt; f a -&gt; f b
</span><span class="hs-identifier hs-var">fmap</span></span><span> </span><span class="annot"><span class="annottext">forall a. Monoid a =&gt; [a] -&gt; a
</span><span class="hs-identifier hs-var">mconcat</span></span><span> </span><span class="annot"><span class="annottext">forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span> </span><span class="annot"><span class="annottext">forall (t :: * -&gt; *) (m :: * -&gt; *) a b.
(Traversable t, Monad m) =&gt;
(a -&gt; m b) -&gt; t a -&gt; m (t b)
</span><span class="hs-identifier hs-var">mapM</span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">forall a.
Map EntityNameHS a
-&gt; EntityMap -&gt; MkPersistSettings -&gt; UnboundEntityDef -&gt; Q [Dec]
</span><a href="Database.Persist.TH.html#mkEntity"><span class="hs-identifier hs-var">mkEntity</span></a></span><span> </span><span class="annot"><span class="annottext">EmbedEntityMap
</span><a href="#local-6989586621679965071"><span class="hs-identifier hs-var">embedEntityMap</span></a></span><span> </span><span class="annot"><span class="annottext">EntityMap
</span><a href="#local-6989586621679965067"><span class="hs-identifier hs-var">entityMap</span></a></span><span> </span><span class="annot"><span class="annottext">MkPersistSettings
</span><a href="#local-6989586621679965074"><span class="hs-identifier hs-var">mps</span></a></span><span class="hs-special">)</span><span> </span><span class="annot"><span class="annottext">[UnboundEntityDef]
</span><a href="#local-6989586621679965060"><span class="hs-identifier hs-var">ents</span></a></span><span>
</span><span id="line-799"></span><span>    </span><span id="local-6989586621679965044"><span class="annot"><span class="annottext">[Dec]
</span><a href="#local-6989586621679965044"><span class="hs-identifier hs-var">jsonDecs</span></a></span></span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">forall (f :: * -&gt; *) a b. Functor f =&gt; (a -&gt; b) -&gt; f a -&gt; f b
</span><span class="hs-identifier hs-var">fmap</span></span><span> </span><span class="annot"><span class="annottext">forall a. Monoid a =&gt; [a] -&gt; a
</span><span class="hs-identifier hs-var">mconcat</span></span><span> </span><span class="annot"><span class="annottext">forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span> </span><span class="annot"><span class="annottext">forall (t :: * -&gt; *) (m :: * -&gt; *) a b.
(Traversable t, Monad m) =&gt;
(a -&gt; m b) -&gt; t a -&gt; m (t b)
</span><span class="hs-identifier hs-var">mapM</span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">MkPersistSettings -&gt; UnboundEntityDef -&gt; Q [Dec]
</span><a href="Database.Persist.TH.html#mkJSON"><span class="hs-identifier hs-var">mkJSON</span></a></span><span> </span><span class="annot"><span class="annottext">MkPersistSettings
</span><a href="#local-6989586621679965074"><span class="hs-identifier hs-var">mps</span></a></span><span class="hs-special">)</span><span> </span><span class="annot"><span class="annottext">[UnboundEntityDef]
</span><a href="#local-6989586621679965060"><span class="hs-identifier hs-var">ents</span></a></span><span>
</span><span id="line-800"></span><span>    </span><span id="local-6989586621679965042"><span class="annot"><span class="annottext">[Dec]
</span><a href="#local-6989586621679965042"><span class="hs-identifier hs-var">uniqueKeyInstances</span></a></span></span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">forall (f :: * -&gt; *) a b. Functor f =&gt; (a -&gt; b) -&gt; f a -&gt; f b
</span><span class="hs-identifier hs-var">fmap</span></span><span> </span><span class="annot"><span class="annottext">forall a. Monoid a =&gt; [a] -&gt; a
</span><span class="hs-identifier hs-var">mconcat</span></span><span> </span><span class="annot"><span class="annottext">forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span> </span><span class="annot"><span class="annottext">forall (t :: * -&gt; *) (m :: * -&gt; *) a b.
(Traversable t, Monad m) =&gt;
(a -&gt; m b) -&gt; t a -&gt; m (t b)
</span><span class="hs-identifier hs-var">mapM</span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">MkPersistSettings -&gt; UnboundEntityDef -&gt; Q [Dec]
</span><a href="Database.Persist.TH.html#mkUniqueKeyInstances"><span class="hs-identifier hs-var">mkUniqueKeyInstances</span></a></span><span> </span><span class="annot"><span class="annottext">MkPersistSettings
</span><a href="#local-6989586621679965074"><span class="hs-identifier hs-var">mps</span></a></span><span class="hs-special">)</span><span> </span><span class="annot"><span class="annottext">[UnboundEntityDef]
</span><a href="#local-6989586621679965060"><span class="hs-identifier hs-var">ents</span></a></span><span>
</span><span id="line-801"></span><span>    </span><span id="local-6989586621679965040"><span class="annot"><span class="annottext">[Dec]
</span><a href="#local-6989586621679965040"><span class="hs-identifier hs-var">symbolToFieldInstances</span></a></span></span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">forall (f :: * -&gt; *) a b. Functor f =&gt; (a -&gt; b) -&gt; f a -&gt; f b
</span><span class="hs-identifier hs-var">fmap</span></span><span> </span><span class="annot"><span class="annottext">forall a. Monoid a =&gt; [a] -&gt; a
</span><span class="hs-identifier hs-var">mconcat</span></span><span> </span><span class="annot"><span class="annottext">forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span> </span><span class="annot"><span class="annottext">forall (t :: * -&gt; *) (m :: * -&gt; *) a b.
(Traversable t, Monad m) =&gt;
(a -&gt; m b) -&gt; t a -&gt; m (t b)
</span><span class="hs-identifier hs-var">mapM</span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">MkPersistSettings -&gt; EntityMap -&gt; UnboundEntityDef -&gt; Q [Dec]
</span><a href="Database.Persist.TH.html#mkSymbolToFieldInstances"><span class="hs-identifier hs-var">mkSymbolToFieldInstances</span></a></span><span> </span><span class="annot"><span class="annottext">MkPersistSettings
</span><a href="#local-6989586621679965074"><span class="hs-identifier hs-var">mps</span></a></span><span> </span><span class="annot"><span class="annottext">EntityMap
</span><a href="#local-6989586621679965067"><span class="hs-identifier hs-var">entityMap</span></a></span><span class="hs-special">)</span><span> </span><span class="annot"><span class="annottext">[UnboundEntityDef]
</span><a href="#local-6989586621679965060"><span class="hs-identifier hs-var">ents</span></a></span><span>
</span><span id="line-802"></span><span>    </span><span class="annot"><span class="annottext">forall (m :: * -&gt; *) a. Monad m =&gt; a -&gt; m a
</span><span class="hs-identifier hs-var">return</span></span><span> </span><span class="annot"><span class="annottext">forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span> </span><span class="annot"><span class="annottext">forall a. Monoid a =&gt; [a] -&gt; a
</span><span class="hs-identifier hs-var">mconcat</span></span><span>
</span><span id="line-803"></span><span>        </span><span class="hs-special">[</span><span> </span><span class="annot"><span class="annottext">[Dec]
</span><a href="#local-6989586621679965047"><span class="hs-identifier hs-var">persistFieldDecs</span></a></span><span>
</span><span id="line-804"></span><span>        </span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">[Dec]
</span><a href="#local-6989586621679965046"><span class="hs-identifier hs-var">entityDecs</span></a></span><span>
</span><span id="line-805"></span><span>        </span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">[Dec]
</span><a href="#local-6989586621679965044"><span class="hs-identifier hs-var">jsonDecs</span></a></span><span>
</span><span id="line-806"></span><span>        </span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">[Dec]
</span><a href="#local-6989586621679965042"><span class="hs-identifier hs-var">uniqueKeyInstances</span></a></span><span>
</span><span id="line-807"></span><span>        </span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">[Dec]
</span><a href="#local-6989586621679965040"><span class="hs-identifier hs-var">symbolToFieldInstances</span></a></span><span>
</span><span id="line-808"></span><span>        </span><span class="hs-special">]</span><span>
</span><span id="line-809"></span><span>
</span><span id="line-810"></span><span class="hs-comment">-- we can't just use 'isInstance' because TH throws an error</span><span>
</span><span id="line-811"></span><span class="annot"><a href="Database.Persist.TH.html#shouldGenerateCode"><span class="hs-identifier hs-type">shouldGenerateCode</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><a href="Database.Persist.Quasi.Internal.html#UnboundEntityDef"><span class="hs-identifier hs-type">UnboundEntityDef</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="hs-identifier hs-type">Q</span></span><span> </span><span class="annot"><span class="hs-identifier hs-type">Bool</span></span><span>
</span><span id="line-812"></span><span id="shouldGenerateCode"><span class="annot"><span class="annottext">shouldGenerateCode :: UnboundEntityDef -&gt; Q Bool
</span><a href="Database.Persist.TH.html#shouldGenerateCode"><span class="hs-identifier hs-var hs-var">shouldGenerateCode</span></a></span></span><span> </span><span id="local-6989586621679965038"><span class="annot"><span class="annottext">UnboundEntityDef
</span><a href="#local-6989586621679965038"><span class="hs-identifier hs-var">ed</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-keyword">do</span><span>
</span><span id="line-813"></span><span>    </span><span id="local-6989586621679965037"><span class="annot"><span class="annottext">Maybe Name
</span><a href="#local-6989586621679965037"><span class="hs-identifier hs-var">mtyp</span></a></span></span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">String -&gt; Q (Maybe Name)
</span><span class="hs-identifier hs-var">lookupTypeName</span></span><span> </span><span class="annot"><span class="annottext">String
</span><a href="#local-6989586621679965035"><span class="hs-identifier hs-var">entityName</span></a></span><span>
</span><span id="line-814"></span><span>    </span><span class="hs-keyword">case</span><span> </span><span class="annot"><span class="annottext">Maybe Name
</span><a href="#local-6989586621679965037"><span class="hs-identifier hs-var">mtyp</span></a></span><span> </span><span class="hs-keyword">of</span><span>
</span><span id="line-815"></span><span>        </span><span class="annot"><span class="annottext">Maybe Name
</span><span class="hs-identifier hs-var">Nothing</span></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-keyword">do</span><span>
</span><span id="line-816"></span><span>            </span><span class="annot"><span class="annottext">forall (f :: * -&gt; *) a. Applicative f =&gt; a -&gt; f a
</span><span class="hs-identifier hs-var">pure</span></span><span> </span><span class="annot"><span class="annottext">Bool
</span><span class="hs-identifier hs-var">True</span></span><span>
</span><span id="line-817"></span><span>        </span><span class="annot"><span class="hs-identifier hs-type">Just</span></span><span> </span><span id="local-6989586621679965034"><span class="annot"><span class="annottext">Name
</span><a href="#local-6989586621679965034"><span class="hs-identifier hs-var">typeName</span></a></span></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-keyword">do</span><span>
</span><span id="line-818"></span><span>            </span><span id="local-6989586621679965033"><span class="annot"><span class="annottext">Bool
</span><a href="#local-6989586621679965033"><span class="hs-identifier hs-var">instanceExists</span></a></span></span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">Name -&gt; [Type] -&gt; Q Bool
</span><span class="hs-identifier hs-var">isInstance</span></span><span> </span><span class="hs-special">''</span><span class="hs-identifier">PersistEntity</span><span> </span><span class="hs-special">[</span><span class="annot"><span class="annottext">Name -&gt; Type
</span><span class="hs-identifier hs-var">ConT</span></span><span> </span><span class="annot"><span class="annottext">Name
</span><a href="#local-6989586621679965034"><span class="hs-identifier hs-var">typeName</span></a></span><span class="hs-special">]</span><span>
</span><span id="line-819"></span><span>            </span><span class="annot"><span class="annottext">forall (f :: * -&gt; *) a. Applicative f =&gt; a -&gt; f a
</span><span class="hs-identifier hs-var">pure</span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Bool -&gt; Bool
</span><span class="hs-identifier hs-var">not</span></span><span> </span><span class="annot"><span class="annottext">Bool
</span><a href="#local-6989586621679965033"><span class="hs-identifier hs-var">instanceExists</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-820"></span><span>  </span><span class="hs-keyword">where</span><span>
</span><span id="line-821"></span><span>    </span><span id="local-6989586621679965035"><span class="annot"><span class="annottext">entityName :: String
</span><a href="#local-6989586621679965035"><span class="hs-identifier hs-var hs-var">entityName</span></a></span></span><span> </span><span class="hs-glyph">=</span><span>
</span><span id="line-822"></span><span>        </span><span class="annot"><span class="annottext">Text -&gt; String
</span><span class="hs-identifier hs-var">T.unpack</span></span><span> </span><span class="annot"><span class="annottext">forall b c a. (b -&gt; c) -&gt; (a -&gt; b) -&gt; a -&gt; c
</span><span class="hs-operator hs-var">.</span></span><span> </span><span class="annot"><span class="annottext">EntityNameHS -&gt; Text
</span><a href="Database.Persist.Names.html#unEntityNameHS"><span class="hs-identifier hs-var">unEntityNameHS</span></a></span><span> </span><span class="annot"><span class="annottext">forall b c a. (b -&gt; c) -&gt; (a -&gt; b) -&gt; a -&gt; c
</span><span class="hs-operator hs-var">.</span></span><span> </span><span class="annot"><span class="annottext">EntityDef -&gt; EntityNameHS
</span><a href="Database.Persist.EntityDef.html#getEntityHaskellName"><span class="hs-identifier hs-var">getEntityHaskellName</span></a></span><span> </span><span class="annot"><span class="annottext">forall b c a. (b -&gt; c) -&gt; (a -&gt; b) -&gt; a -&gt; c
</span><span class="hs-operator hs-var">.</span></span><span> </span><span class="annot"><span class="annottext">UnboundEntityDef -&gt; EntityDef
</span><a href="Database.Persist.Quasi.Internal.html#unboundEntityDef"><span class="hs-identifier hs-var">unboundEntityDef</span></a></span><span> </span><span class="annot"><span class="annottext">forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span> </span><span class="annot"><span class="annottext">UnboundEntityDef
</span><a href="#local-6989586621679965038"><span class="hs-identifier hs-var">ed</span></a></span><span>
</span><span id="line-823"></span><span>
</span><span id="line-824"></span><span class="annot"><a href="Database.Persist.TH.html#overEntityDef"><span class="hs-identifier hs-type">overEntityDef</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="hs-special">(</span><span class="annot"><a href="Database.Persist.Types.Base.html#EntityDef"><span class="hs-identifier hs-type">EntityDef</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="Database.Persist.Types.Base.html#EntityDef"><span class="hs-identifier hs-type">EntityDef</span></a></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="Database.Persist.Quasi.Internal.html#UnboundEntityDef"><span class="hs-identifier hs-type">UnboundEntityDef</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="Database.Persist.Quasi.Internal.html#UnboundEntityDef"><span class="hs-identifier hs-type">UnboundEntityDef</span></a></span><span>
</span><span id="line-825"></span><span id="overEntityDef"><span class="annot"><span class="annottext">overEntityDef :: (EntityDef -&gt; EntityDef) -&gt; UnboundEntityDef -&gt; UnboundEntityDef
</span><a href="Database.Persist.TH.html#overEntityDef"><span class="hs-identifier hs-var hs-var">overEntityDef</span></a></span></span><span> </span><span id="local-6989586621679965029"><span class="annot"><span class="annottext">EntityDef -&gt; EntityDef
</span><a href="#local-6989586621679965029"><span class="hs-identifier hs-var">f</span></a></span></span><span> </span><span id="local-6989586621679965028"><span class="annot"><span class="annottext">UnboundEntityDef
</span><a href="#local-6989586621679965028"><span class="hs-identifier hs-var">ued</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">UnboundEntityDef
</span><a href="#local-6989586621679965028"><span class="hs-identifier hs-var">ued</span></a></span><span> </span><span class="hs-special">{</span><span> </span><span class="annot"><span class="annottext">unboundEntityDef :: EntityDef
</span><a href="Database.Persist.Quasi.Internal.html#unboundEntityDef"><span class="hs-identifier hs-var">unboundEntityDef</span></a></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">EntityDef -&gt; EntityDef
</span><a href="#local-6989586621679965029"><span class="hs-identifier hs-var">f</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">UnboundEntityDef -&gt; EntityDef
</span><a href="Database.Persist.Quasi.Internal.html#unboundEntityDef"><span class="hs-identifier hs-var">unboundEntityDef</span></a></span><span> </span><span class="annot"><span class="annottext">UnboundEntityDef
</span><a href="#local-6989586621679965028"><span class="hs-identifier hs-var">ued</span></a></span><span class="hs-special">)</span><span> </span><span class="hs-special">}</span><span>
</span><span id="line-826"></span><span>
</span><span id="line-827"></span><span class="annot"><a href="Database.Persist.TH.html#setDefaultIdFields"><span class="hs-identifier hs-type">setDefaultIdFields</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><a href="Database.Persist.TH.html#MkPersistSettings"><span class="hs-identifier hs-type">MkPersistSettings</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="Database.Persist.Quasi.Internal.html#UnboundEntityDef"><span class="hs-identifier hs-type">UnboundEntityDef</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="Database.Persist.Quasi.Internal.html#UnboundEntityDef"><span class="hs-identifier hs-type">UnboundEntityDef</span></a></span><span>
</span><span id="line-828"></span><span id="setDefaultIdFields"><span class="annot"><span class="annottext">setDefaultIdFields :: MkPersistSettings -&gt; UnboundEntityDef -&gt; UnboundEntityDef
</span><a href="Database.Persist.TH.html#setDefaultIdFields"><span class="hs-identifier hs-var hs-var">setDefaultIdFields</span></a></span></span><span> </span><span id="local-6989586621679965027"><span class="annot"><span class="annottext">MkPersistSettings
</span><a href="#local-6989586621679965027"><span class="hs-identifier hs-var">mps</span></a></span></span><span> </span><span id="local-6989586621679965026"><span class="annot"><span class="annottext">UnboundEntityDef
</span><a href="#local-6989586621679965026"><span class="hs-identifier hs-var">ued</span></a></span></span><span>
</span><span id="line-829"></span><span>    </span><span class="hs-glyph">|</span><span> </span><span class="annot"><span class="annottext">UnboundEntityDef -&gt; Bool
</span><a href="Database.Persist.TH.html#defaultIdType"><span class="hs-identifier hs-var">defaultIdType</span></a></span><span> </span><span class="annot"><span class="annottext">UnboundEntityDef
</span><a href="#local-6989586621679965026"><span class="hs-identifier hs-var">ued</span></a></span><span> </span><span class="hs-glyph">=</span><span>
</span><span id="line-830"></span><span>        </span><span class="annot"><span class="annottext">(EntityDef -&gt; EntityDef) -&gt; UnboundEntityDef -&gt; UnboundEntityDef
</span><a href="Database.Persist.TH.html#overEntityDef"><span class="hs-identifier hs-var">overEntityDef</span></a></span><span>
</span><span id="line-831"></span><span>            </span><span class="hs-special">(</span><span class="annot"><span class="annottext">EntityIdDef -&gt; EntityDef -&gt; EntityDef
</span><a href="Database.Persist.EntityDef.html#setEntityIdDef"><span class="hs-identifier hs-var">setEntityIdDef</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">ImplicitIdDef -&gt; EntityIdDef -&gt; EntityIdDef
</span><a href="#local-6989586621679965023"><span class="hs-identifier hs-var">setToMpsDefault</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">MkPersistSettings -&gt; ImplicitIdDef
</span><a href="Database.Persist.TH.html#mpsImplicitIdDef"><span class="hs-identifier hs-var">mpsImplicitIdDef</span></a></span><span> </span><span class="annot"><span class="annottext">MkPersistSettings
</span><a href="#local-6989586621679965027"><span class="hs-identifier hs-var">mps</span></a></span><span class="hs-special">)</span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">EntityDef -&gt; EntityIdDef
</span><a href="Database.Persist.EntityDef.html#getEntityId"><span class="hs-identifier hs-var">getEntityId</span></a></span><span> </span><span class="annot"><span class="annottext">EntityDef
</span><a href="#local-6989586621679965021"><span class="hs-identifier hs-var">ed</span></a></span><span class="hs-special">)</span><span class="hs-special">)</span><span class="hs-special">)</span><span>
</span><span id="line-832"></span><span>            </span><span class="annot"><span class="annottext">UnboundEntityDef
</span><a href="#local-6989586621679965026"><span class="hs-identifier hs-var">ued</span></a></span><span>
</span><span id="line-833"></span><span>    </span><span class="hs-glyph">|</span><span> </span><span class="annot"><span class="annottext">Bool
</span><span class="hs-identifier hs-var">otherwise</span></span><span> </span><span class="hs-glyph">=</span><span>
</span><span id="line-834"></span><span>        </span><span class="annot"><span class="annottext">UnboundEntityDef
</span><a href="#local-6989586621679965026"><span class="hs-identifier hs-var">ued</span></a></span><span>
</span><span id="line-835"></span><span>  </span><span class="hs-keyword">where</span><span>
</span><span id="line-836"></span><span>    </span><span id="local-6989586621679965021"><span class="annot"><span class="annottext">ed :: EntityDef
</span><a href="#local-6989586621679965021"><span class="hs-identifier hs-var hs-var">ed</span></a></span></span><span> </span><span class="hs-glyph">=</span><span>
</span><span id="line-837"></span><span>        </span><span class="annot"><span class="annottext">UnboundEntityDef -&gt; EntityDef
</span><a href="Database.Persist.Quasi.Internal.html#unboundEntityDef"><span class="hs-identifier hs-var">unboundEntityDef</span></a></span><span> </span><span class="annot"><span class="annottext">UnboundEntityDef
</span><a href="#local-6989586621679965026"><span class="hs-identifier hs-var">ued</span></a></span><span>
</span><span id="line-838"></span><span>    </span><span class="annot"><a href="#local-6989586621679965023"><span class="hs-identifier hs-type">setToMpsDefault</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><a href="Database.Persist.ImplicitIdDef.Internal.html#ImplicitIdDef"><span class="hs-identifier hs-type">ImplicitIdDef</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="Database.Persist.Types.Base.html#EntityIdDef"><span class="hs-identifier hs-type">EntityIdDef</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="Database.Persist.Types.Base.html#EntityIdDef"><span class="hs-identifier hs-type">EntityIdDef</span></a></span><span>
</span><span id="line-839"></span><span>    </span><span id="local-6989586621679965023"><span class="annot"><span class="annottext">setToMpsDefault :: ImplicitIdDef -&gt; EntityIdDef -&gt; EntityIdDef
</span><a href="#local-6989586621679965023"><span class="hs-identifier hs-var hs-var">setToMpsDefault</span></a></span></span><span> </span><span id="local-6989586621679965020"><span class="annot"><span class="annottext">ImplicitIdDef
</span><a href="#local-6989586621679965020"><span class="hs-identifier hs-var">iid</span></a></span></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="Database.Persist.Types.Base.html#EntityIdField"><span class="hs-identifier hs-type">EntityIdField</span></a></span><span> </span><span id="local-6989586621679965019"><span class="annot"><span class="annottext">FieldDef
</span><a href="#local-6989586621679965019"><span class="hs-identifier hs-var">fd</span></a></span></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">=</span><span>
</span><span id="line-840"></span><span>        </span><span class="annot"><span class="annottext">FieldDef -&gt; EntityIdDef
</span><a href="Database.Persist.Types.Base.html#EntityIdField"><span class="hs-identifier hs-var">EntityIdField</span></a></span><span> </span><span class="annot"><span class="annottext">FieldDef
</span><a href="#local-6989586621679965019"><span class="hs-identifier hs-var">fd</span></a></span><span>
</span><span id="line-841"></span><span>            </span><span class="hs-special">{</span><span> </span><span class="annot"><span class="annottext">fieldType :: FieldType
</span><a href="Database.Persist.Types.Base.html#fieldType"><span class="hs-identifier hs-var">fieldType</span></a></span><span> </span><span class="hs-glyph">=</span><span>
</span><span id="line-842"></span><span>                </span><span class="annot"><span class="annottext">ImplicitIdDef -&gt; EntityNameHS -&gt; FieldType
</span><a href="Database.Persist.ImplicitIdDef.Internal.html#iidFieldType"><span class="hs-identifier hs-var">iidFieldType</span></a></span><span> </span><span class="annot"><span class="annottext">ImplicitIdDef
</span><a href="#local-6989586621679965020"><span class="hs-identifier hs-var">iid</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">EntityDef -&gt; EntityNameHS
</span><a href="Database.Persist.EntityDef.html#getEntityHaskellName"><span class="hs-identifier hs-var">getEntityHaskellName</span></a></span><span> </span><span class="annot"><span class="annottext">EntityDef
</span><a href="#local-6989586621679965021"><span class="hs-identifier hs-var">ed</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-843"></span><span>            </span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">fieldSqlType :: SqlType
</span><a href="Database.Persist.Types.Base.html#fieldSqlType"><span class="hs-identifier hs-var">fieldSqlType</span></a></span><span> </span><span class="hs-glyph">=</span><span>
</span><span id="line-844"></span><span>                </span><span class="annot"><span class="annottext">ImplicitIdDef -&gt; SqlType
</span><a href="Database.Persist.ImplicitIdDef.Internal.html#iidFieldSqlType"><span class="hs-identifier hs-var">iidFieldSqlType</span></a></span><span> </span><span class="annot"><span class="annottext">ImplicitIdDef
</span><a href="#local-6989586621679965020"><span class="hs-identifier hs-var">iid</span></a></span><span>
</span><span id="line-845"></span><span>            </span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">fieldAttrs :: [FieldAttr]
</span><a href="Database.Persist.Types.Base.html#fieldAttrs"><span class="hs-identifier hs-var">fieldAttrs</span></a></span><span> </span><span class="hs-glyph">=</span><span>
</span><span id="line-846"></span><span>                </span><span class="hs-keyword">let</span><span>
</span><span id="line-847"></span><span>                    </span><span id="local-6989586621679965015"><span class="annot"><span class="annottext">def :: [FieldAttr]
</span><a href="#local-6989586621679965015"><span class="hs-identifier hs-var hs-var">def</span></a></span></span><span> </span><span class="hs-glyph">=</span><span>
</span><span id="line-848"></span><span>                        </span><span class="annot"><span class="annottext">forall (t :: * -&gt; *) a. Foldable t =&gt; t a -&gt; [a]
</span><span class="hs-identifier hs-var">toList</span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Text -&gt; FieldAttr
</span><a href="Database.Persist.Types.Base.html#FieldAttrDefault"><span class="hs-identifier hs-var">FieldAttrDefault</span></a></span><span> </span><span class="annot"><span class="annottext">forall (f :: * -&gt; *) a b. Functor f =&gt; (a -&gt; b) -&gt; f a -&gt; f b
</span><span class="hs-operator hs-var">&lt;$&gt;</span></span><span> </span><span class="annot"><span class="annottext">ImplicitIdDef -&gt; Maybe Text
</span><a href="Database.Persist.ImplicitIdDef.Internal.html#iidDefault"><span class="hs-identifier hs-var">iidDefault</span></a></span><span> </span><span class="annot"><span class="annottext">ImplicitIdDef
</span><a href="#local-6989586621679965020"><span class="hs-identifier hs-var">iid</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-849"></span><span>                    </span><span id="local-6989586621679965014"><span class="annot"><span class="annottext">maxlen :: [FieldAttr]
</span><a href="#local-6989586621679965014"><span class="hs-identifier hs-var hs-var">maxlen</span></a></span></span><span> </span><span class="hs-glyph">=</span><span>
</span><span id="line-850"></span><span>                        </span><span class="annot"><span class="annottext">forall (t :: * -&gt; *) a. Foldable t =&gt; t a -&gt; [a]
</span><span class="hs-identifier hs-var">toList</span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Integer -&gt; FieldAttr
</span><a href="Database.Persist.Types.Base.html#FieldAttrMaxlen"><span class="hs-identifier hs-var">FieldAttrMaxlen</span></a></span><span> </span><span class="annot"><span class="annottext">forall (f :: * -&gt; *) a b. Functor f =&gt; (a -&gt; b) -&gt; f a -&gt; f b
</span><span class="hs-operator hs-var">&lt;$&gt;</span></span><span> </span><span class="annot"><span class="annottext">ImplicitIdDef -&gt; Maybe Integer
</span><a href="Database.Persist.ImplicitIdDef.Internal.html#iidMaxLen"><span class="hs-identifier hs-var">iidMaxLen</span></a></span><span> </span><span class="annot"><span class="annottext">ImplicitIdDef
</span><a href="#local-6989586621679965020"><span class="hs-identifier hs-var">iid</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-851"></span><span>                 </span><span class="hs-keyword">in</span><span>
</span><span id="line-852"></span><span>                    </span><span class="annot"><span class="annottext">[FieldAttr]
</span><a href="#local-6989586621679965015"><span class="hs-identifier hs-var">def</span></a></span><span> </span><span class="annot"><span class="annottext">forall a. Semigroup a =&gt; a -&gt; a -&gt; a
</span><span class="hs-operator hs-var">&lt;&gt;</span></span><span> </span><span class="annot"><span class="annottext">[FieldAttr]
</span><a href="#local-6989586621679965014"><span class="hs-identifier hs-var">maxlen</span></a></span><span> </span><span class="annot"><span class="annottext">forall a. Semigroup a =&gt; a -&gt; a -&gt; a
</span><span class="hs-operator hs-var">&lt;&gt;</span></span><span> </span><span class="annot"><span class="annottext">FieldDef -&gt; [FieldAttr]
</span><a href="Database.Persist.Types.Base.html#fieldAttrs"><span class="hs-identifier hs-var">fieldAttrs</span></a></span><span> </span><span class="annot"><span class="annottext">FieldDef
</span><a href="#local-6989586621679965019"><span class="hs-identifier hs-var">fd</span></a></span><span>
</span><span id="line-853"></span><span>            </span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">fieldIsImplicitIdColumn :: Bool
</span><a href="Database.Persist.Types.Base.html#fieldIsImplicitIdColumn"><span class="hs-identifier hs-var">fieldIsImplicitIdColumn</span></a></span><span> </span><span class="hs-glyph">=</span><span>
</span><span id="line-854"></span><span>                </span><span class="annot"><span class="annottext">Bool
</span><span class="hs-identifier hs-var">True</span></span><span>
</span><span id="line-855"></span><span>            </span><span class="hs-special">}</span><span>
</span><span id="line-856"></span><span>    </span><span class="annot"><a href="#local-6989586621679965023"><span class="hs-identifier hs-var">setToMpsDefault</span></a></span><span> </span><span class="annot"><span class="annottext">ImplicitIdDef
</span><span class="hs-identifier">_</span></span><span> </span><span id="local-6989586621679965012"><span class="annot"><span class="annottext">EntityIdDef
</span><a href="#local-6989586621679965012"><span class="hs-identifier hs-var">x</span></a></span></span><span> </span><span class="hs-glyph">=</span><span>
</span><span id="line-857"></span><span>        </span><span class="annot"><span class="annottext">EntityIdDef
</span><a href="#local-6989586621679965012"><span class="hs-identifier hs-var">x</span></a></span><span>
</span><span id="line-858"></span><span>
</span><span id="line-859"></span><span class="hs-comment">-- | Implement special preprocessing on EntityDef as necessary for 'mkPersist'.</span><span>
</span><span id="line-860"></span><span class="hs-comment">-- For example, strip out any fields marked as MigrationOnly.</span><span>
</span><span id="line-861"></span><span class="hs-comment">--</span><span>
</span><span id="line-862"></span><span class="hs-comment">-- This should be called when performing Haskell codegen, but the 'EntityDef'</span><span>
</span><span id="line-863"></span><span class="hs-comment">-- *should* keep all of the fields present when defining 'entityDef'. This is</span><span>
</span><span id="line-864"></span><span class="hs-comment">-- necessary so that migrations know to keep these columns around, or to delete</span><span>
</span><span id="line-865"></span><span class="hs-comment">-- them, as appropriate.</span><span>
</span><span id="line-866"></span><span class="annot"><a href="Database.Persist.TH.html#fixEntityDef"><span class="hs-identifier hs-type">fixEntityDef</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><a href="Database.Persist.Quasi.Internal.html#UnboundEntityDef"><span class="hs-identifier hs-type">UnboundEntityDef</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="Database.Persist.Quasi.Internal.html#UnboundEntityDef"><span class="hs-identifier hs-type">UnboundEntityDef</span></a></span><span>
</span><span id="line-867"></span><span id="fixEntityDef"><span class="annot"><span class="annottext">fixEntityDef :: UnboundEntityDef -&gt; UnboundEntityDef
</span><a href="Database.Persist.TH.html#fixEntityDef"><span class="hs-identifier hs-var hs-var">fixEntityDef</span></a></span></span><span> </span><span id="local-6989586621679965010"><span class="annot"><span class="annottext">UnboundEntityDef
</span><a href="#local-6989586621679965010"><span class="hs-identifier hs-var">ued</span></a></span></span><span> </span><span class="hs-glyph">=</span><span>
</span><span id="line-868"></span><span>    </span><span class="annot"><span class="annottext">UnboundEntityDef
</span><a href="#local-6989586621679965010"><span class="hs-identifier hs-var">ued</span></a></span><span>
</span><span id="line-869"></span><span>        </span><span class="hs-special">{</span><span> </span><span class="annot"><span class="annottext">unboundEntityFields :: [UnboundFieldDef]
</span><a href="Database.Persist.Quasi.Internal.html#unboundEntityFields"><span class="hs-identifier hs-var">unboundEntityFields</span></a></span><span> </span><span class="hs-glyph">=</span><span>
</span><span id="line-870"></span><span>            </span><span class="annot"><span class="annottext">forall a. (a -&gt; Bool) -&gt; [a] -&gt; [a]
</span><span class="hs-identifier hs-var">filter</span></span><span> </span><span class="annot"><span class="annottext">UnboundFieldDef -&gt; Bool
</span><a href="Database.Persist.Quasi.Internal.html#isHaskellUnboundField"><span class="hs-identifier hs-var">isHaskellUnboundField</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">UnboundEntityDef -&gt; [UnboundFieldDef]
</span><a href="Database.Persist.Quasi.Internal.html#unboundEntityFields"><span class="hs-identifier hs-var">unboundEntityFields</span></a></span><span> </span><span class="annot"><span class="annottext">UnboundEntityDef
</span><a href="#local-6989586621679965010"><span class="hs-identifier hs-var">ued</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-871"></span><span>        </span><span class="hs-special">}</span><span>
</span><span id="line-872"></span><span>
</span><span id="line-873"></span><span class="hs-comment">-- | Settings to be passed to the 'mkPersist' function.</span><span>
</span><span id="line-874"></span><span class="hs-keyword">data</span><span> </span><span id="MkPersistSettings"><span class="annot"><a href="Database.Persist.TH.html#MkPersistSettings"><span class="hs-identifier hs-var">MkPersistSettings</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span id="MkPersistSettings"><span class="annot"><a href="Database.Persist.TH.html#MkPersistSettings"><span class="hs-identifier hs-var">MkPersistSettings</span></a></span></span><span>
</span><span id="line-875"></span><span>    </span><span class="hs-special">{</span><span> </span><span id="mpsBackend"><span class="annot"><span class="annottext">MkPersistSettings -&gt; Type
</span><a href="Database.Persist.TH.html#mpsBackend"><span class="hs-identifier hs-var hs-var">mpsBackend</span></a></span></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><span class="hs-identifier hs-type">Type</span></span><span>
</span><span id="line-876"></span><span>    </span><span class="hs-comment">-- ^ Which database backend we\'re using. This type is used for the</span><span>
</span><span id="line-877"></span><span>    </span><span class="hs-comment">-- 'PersistEntityBackend' associated type in the entities that are</span><span>
</span><span id="line-878"></span><span>    </span><span class="hs-comment">-- generated.</span><span>
</span><span id="line-879"></span><span>    </span><span class="hs-comment">--</span><span>
</span><span id="line-880"></span><span>    </span><span class="hs-comment">-- If the 'mpsGeneric' value is set to 'True', then this type is used for</span><span>
</span><span id="line-881"></span><span>    </span><span class="hs-comment">-- the non-Generic type alias. The data and type will be named:</span><span>
</span><span id="line-882"></span><span>    </span><span class="hs-comment">--</span><span>
</span><span id="line-883"></span><span>    </span><span class="hs-comment">-- @</span><span>
</span><span id="line-884"></span><span>    </span><span class="hs-comment">-- data ModelGeneric backend = Model { ... }</span><span>
</span><span id="line-885"></span><span>    </span><span class="hs-comment">-- @</span><span>
</span><span id="line-886"></span><span>    </span><span class="hs-comment">--</span><span>
</span><span id="line-887"></span><span>    </span><span class="hs-comment">-- And, for convenience's sake, we provide a type alias:</span><span>
</span><span id="line-888"></span><span>    </span><span class="hs-comment">--</span><span>
</span><span id="line-889"></span><span>    </span><span class="hs-comment">-- @</span><span>
</span><span id="line-890"></span><span>    </span><span class="hs-comment">-- type Model = ModelGeneric $(the type you give here)</span><span>
</span><span id="line-891"></span><span>    </span><span class="hs-comment">-- @</span><span>
</span><span id="line-892"></span><span>    </span><span class="hs-special">,</span><span> </span><span id="mpsGeneric"><span class="annot"><span class="annottext">MkPersistSettings -&gt; Bool
</span><a href="Database.Persist.TH.html#mpsGeneric"><span class="hs-identifier hs-var hs-var">mpsGeneric</span></a></span></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><span class="hs-identifier hs-type">Bool</span></span><span>
</span><span id="line-893"></span><span>    </span><span class="hs-comment">-- ^ Create generic types that can be used with multiple backends. Good for</span><span>
</span><span id="line-894"></span><span>    </span><span class="hs-comment">-- reusable code, but makes error messages harder to understand. Default:</span><span>
</span><span id="line-895"></span><span>    </span><span class="hs-comment">-- False.</span><span>
</span><span id="line-896"></span><span>    </span><span class="hs-special">,</span><span> </span><span id="mpsPrefixFields"><span class="annot"><span class="annottext">MkPersistSettings -&gt; Bool
</span><a href="Database.Persist.TH.html#mpsPrefixFields"><span class="hs-identifier hs-var hs-var">mpsPrefixFields</span></a></span></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><span class="hs-identifier hs-type">Bool</span></span><span>
</span><span id="line-897"></span><span>    </span><span class="hs-comment">-- ^ Prefix field names with the model name. Default: True.</span><span>
</span><span id="line-898"></span><span>    </span><span class="hs-comment">--</span><span>
</span><span id="line-899"></span><span>    </span><span class="hs-comment">-- Note: this field is deprecated. Use the mpsFieldLabelModifier  and</span><span>
</span><span id="line-900"></span><span>    </span><span class="hs-comment">-- 'mpsConstraintLabelModifier' instead.</span><span>
</span><span id="line-901"></span><span>    </span><span class="hs-special">,</span><span> </span><span id="mpsFieldLabelModifier"><span class="annot"><span class="annottext">MkPersistSettings -&gt; Text -&gt; Text -&gt; Text
</span><a href="Database.Persist.TH.html#mpsFieldLabelModifier"><span class="hs-identifier hs-var hs-var">mpsFieldLabelModifier</span></a></span></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><span class="hs-identifier hs-type">Text</span></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="hs-identifier hs-type">Text</span></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="hs-identifier hs-type">Text</span></span><span>
</span><span id="line-902"></span><span>    </span><span class="hs-comment">-- ^ Customise the field accessors and lens names using the entity and field</span><span>
</span><span id="line-903"></span><span>    </span><span class="hs-comment">-- name.  Both arguments are upper cased.</span><span>
</span><span id="line-904"></span><span>    </span><span class="hs-comment">--</span><span>
</span><span id="line-905"></span><span>    </span><span class="hs-comment">-- Default: appends entity and field.</span><span>
</span><span id="line-906"></span><span>    </span><span class="hs-comment">--</span><span>
</span><span id="line-907"></span><span>    </span><span class="hs-comment">-- Note: this setting is ignored if mpsPrefixFields is set to False.</span><span>
</span><span id="line-908"></span><span>    </span><span class="hs-comment">--</span><span>
</span><span id="line-909"></span><span>    </span><span class="hs-comment">-- @since 2.11.0.0</span><span>
</span><span id="line-910"></span><span>    </span><span class="hs-special">,</span><span> </span><span id="mpsConstraintLabelModifier"><span class="annot"><span class="annottext">MkPersistSettings -&gt; Text -&gt; Text -&gt; Text
</span><a href="Database.Persist.TH.html#mpsConstraintLabelModifier"><span class="hs-identifier hs-var hs-var">mpsConstraintLabelModifier</span></a></span></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><span class="hs-identifier hs-type">Text</span></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="hs-identifier hs-type">Text</span></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="hs-identifier hs-type">Text</span></span><span>
</span><span id="line-911"></span><span>    </span><span class="hs-comment">-- ^ Customise the Constraint names using the entity and field name. The</span><span>
</span><span id="line-912"></span><span>    </span><span class="hs-comment">-- result should be a valid haskell type (start with an upper cased letter).</span><span>
</span><span id="line-913"></span><span>    </span><span class="hs-comment">--</span><span>
</span><span id="line-914"></span><span>    </span><span class="hs-comment">-- Default: appends entity and field</span><span>
</span><span id="line-915"></span><span>    </span><span class="hs-comment">--</span><span>
</span><span id="line-916"></span><span>    </span><span class="hs-comment">-- Note: this setting is ignored if mpsPrefixFields is set to False.</span><span>
</span><span id="line-917"></span><span>    </span><span class="hs-comment">--</span><span>
</span><span id="line-918"></span><span>    </span><span class="hs-comment">-- @since 2.11.0.0</span><span>
</span><span id="line-919"></span><span>    </span><span class="hs-special">,</span><span> </span><span id="mpsEntityJSON"><span class="annot"><span class="annottext">MkPersistSettings -&gt; Maybe EntityJSON
</span><a href="Database.Persist.TH.html#mpsEntityJSON"><span class="hs-identifier hs-var hs-var">mpsEntityJSON</span></a></span></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><span class="hs-identifier hs-type">Maybe</span></span><span> </span><span class="annot"><a href="Database.Persist.TH.html#EntityJSON"><span class="hs-identifier hs-type">EntityJSON</span></a></span><span>
</span><span id="line-920"></span><span>    </span><span class="hs-comment">-- ^ Generate @ToJSON@/@FromJSON@ instances for each model types. If it's</span><span>
</span><span id="line-921"></span><span>    </span><span class="hs-comment">-- @Nothing@, no instances will be generated. Default:</span><span>
</span><span id="line-922"></span><span>    </span><span class="hs-comment">--</span><span>
</span><span id="line-923"></span><span>    </span><span class="hs-comment">-- @</span><span>
</span><span id="line-924"></span><span>    </span><span class="hs-comment">--  Just 'EntityJSON'</span><span>
</span><span id="line-925"></span><span>    </span><span class="hs-comment">--      { 'entityToJSON' = 'entityIdToJSON</span><span>
</span><span id="line-926"></span><span>    </span><span class="hs-comment">--      , 'entityFromJSON' = 'entityIdFromJSON</span><span>
</span><span id="line-927"></span><span>    </span><span class="hs-comment">--      }</span><span>
</span><span id="line-928"></span><span>    </span><span class="hs-comment">-- @</span><span>
</span><span id="line-929"></span><span>    </span><span class="hs-special">,</span><span> </span><span id="mpsGenerateLenses"><span class="annot"><span class="annottext">MkPersistSettings -&gt; Bool
</span><a href="Database.Persist.TH.html#mpsGenerateLenses"><span class="hs-identifier hs-var hs-var">mpsGenerateLenses</span></a></span></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><span class="hs-identifier hs-type">Bool</span></span><span>
</span><span id="line-930"></span><span>    </span><span class="hs-comment">-- ^ Instead of generating normal field accessors, generator lens-style</span><span>
</span><span id="line-931"></span><span>    </span><span class="hs-comment">-- accessors.</span><span>
</span><span id="line-932"></span><span>    </span><span class="hs-comment">--</span><span>
</span><span id="line-933"></span><span>    </span><span class="hs-comment">-- Default: False</span><span>
</span><span id="line-934"></span><span>    </span><span class="hs-comment">--</span><span>
</span><span id="line-935"></span><span>    </span><span class="hs-comment">-- @since 1.3.1</span><span>
</span><span id="line-936"></span><span>    </span><span class="hs-special">,</span><span> </span><span id="mpsDeriveInstances"><span class="annot"><span class="annottext">MkPersistSettings -&gt; [Name]
</span><a href="Database.Persist.TH.html#mpsDeriveInstances"><span class="hs-identifier hs-var hs-var">mpsDeriveInstances</span></a></span></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="hs-special">[</span><span class="annot"><span class="hs-identifier hs-type">Name</span></span><span class="hs-special">]</span><span>
</span><span id="line-937"></span><span>    </span><span class="hs-comment">-- ^ Automatically derive these typeclass instances for all record and key</span><span>
</span><span id="line-938"></span><span>    </span><span class="hs-comment">-- types.</span><span>
</span><span id="line-939"></span><span>    </span><span class="hs-comment">--</span><span>
</span><span id="line-940"></span><span>    </span><span class="hs-comment">-- Default: []</span><span>
</span><span id="line-941"></span><span>    </span><span class="hs-comment">--</span><span>
</span><span id="line-942"></span><span>    </span><span class="hs-comment">-- @since 2.8.1</span><span>
</span><span id="line-943"></span><span>    </span><span class="hs-special">,</span><span> </span><span id="mpsImplicitIdDef"><span class="annot"><span class="annottext">MkPersistSettings -&gt; ImplicitIdDef
</span><a href="Database.Persist.TH.html#mpsImplicitIdDef"><span class="hs-identifier hs-var hs-var">mpsImplicitIdDef</span></a></span></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><a href="Database.Persist.ImplicitIdDef.Internal.html#ImplicitIdDef"><span class="hs-identifier hs-type">ImplicitIdDef</span></a></span><span>
</span><span id="line-944"></span><span>    </span><span class="hs-comment">-- ^ TODO: document</span><span>
</span><span id="line-945"></span><span>    </span><span class="hs-comment">--</span><span>
</span><span id="line-946"></span><span>    </span><span class="hs-comment">-- @since 2.13.0.0</span><span>
</span><span id="line-947"></span><span>    </span><span class="hs-special">}</span><span>
</span><span id="line-948"></span><span>
</span><span id="line-949"></span><span class="hs-pragma">{-# DEPRECATED</span><span> </span><span class="hs-pragma">mpsGeneric</span><span> </span><span class="hs-pragma">&quot;The mpsGeneric function adds a considerable amount of overhead and complexity to the library without bringing significant benefit. We would like to remove it. If you require this feature, please comment on the linked GitHub issue, and we'll either keep it around, or we can figure out a nicer way to solve your problem.\n\n Github: https://github.com/yesodweb/persistent/issues/1204&quot;</span><span> </span><span class="hs-pragma">#-}</span><span>
</span><span id="line-950"></span><span>
</span><span id="line-951"></span><span class="hs-comment">-- |  Set the 'ImplicitIdDef' in the given 'MkPersistSettings'. The default</span><span>
</span><span id="line-952"></span><span class="hs-comment">-- value is 'autoIncrementingInteger'.</span><span>
</span><span id="line-953"></span><span class="hs-comment">--</span><span>
</span><span id="line-954"></span><span class="hs-comment">-- @since 2.13.0.0</span><span>
</span><span id="line-955"></span><span class="annot"><a href="Database.Persist.TH.html#setImplicitIdDef"><span class="hs-identifier hs-type">setImplicitIdDef</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><a href="Database.Persist.ImplicitIdDef.Internal.html#ImplicitIdDef"><span class="hs-identifier hs-type">ImplicitIdDef</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="Database.Persist.TH.html#MkPersistSettings"><span class="hs-identifier hs-type">MkPersistSettings</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="Database.Persist.TH.html#MkPersistSettings"><span class="hs-identifier hs-type">MkPersistSettings</span></a></span><span>
</span><span id="line-956"></span><span id="setImplicitIdDef"><span class="annot"><span class="annottext">setImplicitIdDef :: ImplicitIdDef -&gt; MkPersistSettings -&gt; MkPersistSettings
</span><a href="Database.Persist.TH.html#setImplicitIdDef"><span class="hs-identifier hs-var hs-var">setImplicitIdDef</span></a></span></span><span> </span><span id="local-6989586621679965006"><span class="annot"><span class="annottext">ImplicitIdDef
</span><a href="#local-6989586621679965006"><span class="hs-identifier hs-var">iid</span></a></span></span><span> </span><span id="local-6989586621679965005"><span class="annot"><span class="annottext">MkPersistSettings
</span><a href="#local-6989586621679965005"><span class="hs-identifier hs-var">mps</span></a></span></span><span> </span><span class="hs-glyph">=</span><span>
</span><span id="line-957"></span><span>    </span><span class="annot"><span class="annottext">MkPersistSettings
</span><a href="#local-6989586621679965005"><span class="hs-identifier hs-var">mps</span></a></span><span> </span><span class="hs-special">{</span><span> </span><span class="annot"><span class="annottext">mpsImplicitIdDef :: ImplicitIdDef
</span><a href="Database.Persist.TH.html#mpsImplicitIdDef"><span class="hs-identifier hs-var">mpsImplicitIdDef</span></a></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">ImplicitIdDef
</span><a href="#local-6989586621679965006"><span class="hs-identifier hs-var">iid</span></a></span><span> </span><span class="hs-special">}</span><span>
</span><span id="line-958"></span><span>
</span><span id="line-959"></span><span class="annot"><a href="Database.Persist.TH.html#getImplicitIdType"><span class="hs-identifier hs-type">getImplicitIdType</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><a href="Database.Persist.TH.html#MkPersistSettings"><span class="hs-identifier hs-type">MkPersistSettings</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="hs-identifier hs-type">Type</span></span><span>
</span><span id="line-960"></span><span id="getImplicitIdType"><span class="annot"><span class="annottext">getImplicitIdType :: MkPersistSettings -&gt; Type
</span><a href="Database.Persist.TH.html#getImplicitIdType"><span class="hs-identifier hs-var hs-var">getImplicitIdType</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-keyword">do</span><span>
</span><span id="line-961"></span><span>    </span><span id="local-6989586621679965003"><span class="annot"><span class="annottext">ImplicitIdDef
</span><a href="#local-6989586621679965003"><span class="hs-identifier hs-var">idDef</span></a></span></span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">MkPersistSettings -&gt; ImplicitIdDef
</span><a href="Database.Persist.TH.html#mpsImplicitIdDef"><span class="hs-identifier hs-var">mpsImplicitIdDef</span></a></span><span>
</span><span id="line-962"></span><span>    </span><span id="local-6989586621679965002"><span class="annot"><span class="annottext">Bool
</span><a href="#local-6989586621679965002"><span class="hs-identifier hs-var">isGeneric</span></a></span></span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">MkPersistSettings -&gt; Bool
</span><a href="Database.Persist.TH.html#mpsGeneric"><span class="hs-identifier hs-var">mpsGeneric</span></a></span><span>
</span><span id="line-963"></span><span>    </span><span id="local-6989586621679965001"><span class="annot"><span class="annottext">Type
</span><a href="#local-6989586621679965001"><span class="hs-identifier hs-var">backendTy</span></a></span></span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">MkPersistSettings -&gt; Type
</span><a href="Database.Persist.TH.html#mpsBackend"><span class="hs-identifier hs-var">mpsBackend</span></a></span><span>
</span><span id="line-964"></span><span>    </span><span class="annot"><span class="annottext">forall (f :: * -&gt; *) a. Applicative f =&gt; a -&gt; f a
</span><span class="hs-identifier hs-var">pure</span></span><span> </span><span class="annot"><span class="annottext">forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span> </span><span class="annot"><span class="annottext">ImplicitIdDef -&gt; Bool -&gt; Type -&gt; Type
</span><a href="Database.Persist.ImplicitIdDef.Internal.html#iidType"><span class="hs-identifier hs-var">iidType</span></a></span><span> </span><span class="annot"><span class="annottext">ImplicitIdDef
</span><a href="#local-6989586621679965003"><span class="hs-identifier hs-var">idDef</span></a></span><span> </span><span class="annot"><span class="annottext">Bool
</span><a href="#local-6989586621679965002"><span class="hs-identifier hs-var">isGeneric</span></a></span><span> </span><span class="annot"><span class="annottext">Type
</span><a href="#local-6989586621679965001"><span class="hs-identifier hs-var">backendTy</span></a></span><span>
</span><span id="line-965"></span><span>
</span><span id="line-966"></span><span class="hs-keyword">data</span><span> </span><span id="EntityJSON"><span class="annot"><a href="Database.Persist.TH.html#EntityJSON"><span class="hs-identifier hs-var">EntityJSON</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span id="EntityJSON"><span class="annot"><a href="Database.Persist.TH.html#EntityJSON"><span class="hs-identifier hs-var">EntityJSON</span></a></span></span><span>
</span><span id="line-967"></span><span>    </span><span class="hs-special">{</span><span> </span><span id="entityToJSON"><span class="annot"><span class="annottext">EntityJSON -&gt; Name
</span><a href="Database.Persist.TH.html#entityToJSON"><span class="hs-identifier hs-var hs-var">entityToJSON</span></a></span></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><span class="hs-identifier hs-type">Name</span></span><span>
</span><span id="line-968"></span><span>    </span><span class="hs-comment">-- ^ Name of the @toJSON@ implementation for @Entity a@.</span><span>
</span><span id="line-969"></span><span>    </span><span class="hs-special">,</span><span> </span><span id="entityFromJSON"><span class="annot"><span class="annottext">EntityJSON -&gt; Name
</span><a href="Database.Persist.TH.html#entityFromJSON"><span class="hs-identifier hs-var hs-var">entityFromJSON</span></a></span></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><span class="hs-identifier hs-type">Name</span></span><span>
</span><span id="line-970"></span><span>    </span><span class="hs-comment">-- ^ Name of the @fromJSON@ implementation for @Entity a@.</span><span>
</span><span id="line-971"></span><span>    </span><span class="hs-special">}</span><span>
</span><span id="line-972"></span><span>
</span><span id="line-973"></span><span class="hs-comment">-- | Create an @MkPersistSettings@ with default values.</span><span>
</span><span id="line-974"></span><span class="annot"><a href="Database.Persist.TH.html#mkPersistSettings"><span class="hs-identifier hs-type">mkPersistSettings</span></a></span><span>
</span><span id="line-975"></span><span>    </span><span class="hs-glyph">::</span><span> </span><span class="annot"><span class="hs-identifier hs-type">Type</span></span><span> </span><span class="hs-comment">-- ^ Value for 'mpsBackend'</span><span>
</span><span id="line-976"></span><span>    </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="Database.Persist.TH.html#MkPersistSettings"><span class="hs-identifier hs-type">MkPersistSettings</span></a></span><span>
</span><span id="line-977"></span><span id="mkPersistSettings"><span class="annot"><span class="annottext">mkPersistSettings :: Type -&gt; MkPersistSettings
</span><a href="Database.Persist.TH.html#mkPersistSettings"><span class="hs-identifier hs-var hs-var">mkPersistSettings</span></a></span></span><span> </span><span id="local-6989586621679964996"><span class="annot"><span class="annottext">Type
</span><a href="#local-6989586621679964996"><span class="hs-identifier hs-var">backend</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><a href="Database.Persist.TH.html#MkPersistSettings"><span class="hs-identifier hs-type">MkPersistSettings</span></a></span><span>
</span><span id="line-978"></span><span>    </span><span class="hs-special">{</span><span> </span><span class="annot"><span class="annottext">mpsBackend :: Type
</span><a href="Database.Persist.TH.html#mpsBackend"><span class="hs-identifier hs-var">mpsBackend</span></a></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">Type
</span><a href="#local-6989586621679964996"><span class="hs-identifier hs-var">backend</span></a></span><span>
</span><span id="line-979"></span><span>    </span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">mpsGeneric :: Bool
</span><a href="Database.Persist.TH.html#mpsGeneric"><span class="hs-identifier hs-var">mpsGeneric</span></a></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">Bool
</span><span class="hs-identifier hs-var">False</span></span><span>
</span><span id="line-980"></span><span>    </span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">mpsPrefixFields :: Bool
</span><a href="Database.Persist.TH.html#mpsPrefixFields"><span class="hs-identifier hs-var">mpsPrefixFields</span></a></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">Bool
</span><span class="hs-identifier hs-var">True</span></span><span>
</span><span id="line-981"></span><span>    </span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">mpsFieldLabelModifier :: Text -&gt; Text -&gt; Text
</span><a href="Database.Persist.TH.html#mpsFieldLabelModifier"><span class="hs-identifier hs-var">mpsFieldLabelModifier</span></a></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">forall m. Monoid m =&gt; m -&gt; m -&gt; m
</span><a href="Database.Persist.TH.html#%2B%2B"><span class="hs-operator hs-var">(++)</span></a></span><span>
</span><span id="line-982"></span><span>    </span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">mpsConstraintLabelModifier :: Text -&gt; Text -&gt; Text
</span><a href="Database.Persist.TH.html#mpsConstraintLabelModifier"><span class="hs-identifier hs-var">mpsConstraintLabelModifier</span></a></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">forall m. Monoid m =&gt; m -&gt; m -&gt; m
</span><a href="Database.Persist.TH.html#%2B%2B"><span class="hs-operator hs-var">(++)</span></a></span><span>
</span><span id="line-983"></span><span>    </span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">mpsEntityJSON :: Maybe EntityJSON
</span><a href="Database.Persist.TH.html#mpsEntityJSON"><span class="hs-identifier hs-var">mpsEntityJSON</span></a></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">forall a. a -&gt; Maybe a
</span><span class="hs-identifier hs-var">Just</span></span><span> </span><span class="annot"><a href="Database.Persist.TH.html#EntityJSON"><span class="hs-identifier hs-type">EntityJSON</span></a></span><span>
</span><span id="line-984"></span><span>        </span><span class="hs-special">{</span><span> </span><span class="annot"><span class="annottext">entityToJSON :: Name
</span><a href="Database.Persist.TH.html#entityToJSON"><span class="hs-identifier hs-var">entityToJSON</span></a></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-special">'</span><span class="hs-identifier">entityIdToJSON</span><span>
</span><span id="line-985"></span><span>        </span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">entityFromJSON :: Name
</span><a href="Database.Persist.TH.html#entityFromJSON"><span class="hs-identifier hs-var">entityFromJSON</span></a></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-special">'</span><span class="hs-identifier">entityIdFromJSON</span><span>
</span><span id="line-986"></span><span>        </span><span class="hs-special">}</span><span>
</span><span id="line-987"></span><span>    </span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">mpsGenerateLenses :: Bool
</span><a href="Database.Persist.TH.html#mpsGenerateLenses"><span class="hs-identifier hs-var">mpsGenerateLenses</span></a></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">Bool
</span><span class="hs-identifier hs-var">False</span></span><span>
</span><span id="line-988"></span><span>    </span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">mpsDeriveInstances :: [Name]
</span><a href="Database.Persist.TH.html#mpsDeriveInstances"><span class="hs-identifier hs-var">mpsDeriveInstances</span></a></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-special">[</span><span class="hs-special">]</span><span>
</span><span id="line-989"></span><span>    </span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">mpsImplicitIdDef :: ImplicitIdDef
</span><a href="Database.Persist.TH.html#mpsImplicitIdDef"><span class="hs-identifier hs-var">mpsImplicitIdDef</span></a></span><span> </span><span class="hs-glyph">=</span><span>
</span><span id="line-990"></span><span>        </span><span class="annot"><span class="annottext">ImplicitIdDef
</span><a href="Database.Persist.ImplicitIdDef.html#autoIncrementingInteger"><span class="hs-identifier hs-var">autoIncrementingInteger</span></a></span><span>
</span><span id="line-991"></span><span>    </span><span class="hs-special">}</span><span>
</span><span id="line-992"></span><span>
</span><span id="line-993"></span><span class="hs-comment">-- | Use the 'SqlPersist' backend.</span><span>
</span><span id="line-994"></span><span class="annot"><a href="Database.Persist.TH.html#sqlSettings"><span class="hs-identifier hs-type">sqlSettings</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><a href="Database.Persist.TH.html#MkPersistSettings"><span class="hs-identifier hs-type">MkPersistSettings</span></a></span><span>
</span><span id="line-995"></span><span id="sqlSettings"><span class="annot"><span class="annottext">sqlSettings :: MkPersistSettings
</span><a href="Database.Persist.TH.html#sqlSettings"><span class="hs-identifier hs-var hs-var">sqlSettings</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">Type -&gt; MkPersistSettings
</span><a href="Database.Persist.TH.html#mkPersistSettings"><span class="hs-identifier hs-var">mkPersistSettings</span></a></span><span> </span><span class="annot"><span class="annottext">forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span> </span><span class="annot"><span class="annottext">Name -&gt; Type
</span><span class="hs-identifier hs-var">ConT</span></span><span> </span><span class="hs-special">''</span><span class="hs-identifier">SqlBackend</span><span>
</span><span id="line-996"></span><span>
</span><span id="line-997"></span><span class="annot"><a href="Database.Persist.TH.html#lowerFirst"><span class="hs-identifier hs-type">lowerFirst</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><span class="hs-identifier hs-type">Text</span></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="hs-identifier hs-type">Text</span></span><span>
</span><span id="line-998"></span><span id="lowerFirst"><span class="annot"><span class="annottext">lowerFirst :: Text -&gt; Text
</span><a href="Database.Persist.TH.html#lowerFirst"><span class="hs-identifier hs-var hs-var">lowerFirst</span></a></span></span><span> </span><span id="local-6989586621679964993"><span class="annot"><span class="annottext">Text
</span><a href="#local-6989586621679964993"><span class="hs-identifier hs-var">t</span></a></span></span><span> </span><span class="hs-glyph">=</span><span>
</span><span id="line-999"></span><span>    </span><span class="hs-keyword">case</span><span> </span><span class="annot"><span class="annottext">Text -&gt; Maybe (Char, Text)
</span><span class="hs-identifier hs-var">uncons</span></span><span> </span><span class="annot"><span class="annottext">Text
</span><a href="#local-6989586621679964993"><span class="hs-identifier hs-var">t</span></a></span><span> </span><span class="hs-keyword">of</span><span>
</span><span id="line-1000"></span><span>        </span><span class="annot"><span class="hs-identifier hs-type">Just</span></span><span> </span><span class="hs-special">(</span><span id="local-6989586621679964992"><span class="annot"><span class="annottext">Char
</span><a href="#local-6989586621679964992"><span class="hs-identifier hs-var">a</span></a></span></span><span class="hs-special">,</span><span> </span><span id="local-6989586621679964991"><span class="annot"><span class="annottext">Text
</span><a href="#local-6989586621679964991"><span class="hs-identifier hs-var">b</span></a></span></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="annottext">Char -&gt; Text -&gt; Text
</span><span class="hs-identifier hs-var">cons</span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Char -&gt; Char
</span><span class="hs-identifier hs-var">toLower</span></span><span> </span><span class="annot"><span class="annottext">Char
</span><a href="#local-6989586621679964992"><span class="hs-identifier hs-var">a</span></a></span><span class="hs-special">)</span><span> </span><span class="annot"><span class="annottext">Text
</span><a href="#local-6989586621679964991"><span class="hs-identifier hs-var">b</span></a></span><span>
</span><span id="line-1001"></span><span>        </span><span class="annot"><span class="annottext">Maybe (Char, Text)
</span><span class="hs-identifier hs-var">Nothing</span></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="annottext">Text
</span><a href="#local-6989586621679964993"><span class="hs-identifier hs-var">t</span></a></span><span>
</span><span id="line-1002"></span><span>
</span><span id="line-1003"></span><span class="annot"><a href="Database.Persist.TH.html#upperFirst"><span class="hs-identifier hs-type">upperFirst</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><span class="hs-identifier hs-type">Text</span></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="hs-identifier hs-type">Text</span></span><span>
</span><span id="line-1004"></span><span id="upperFirst"><span class="annot"><span class="annottext">upperFirst :: Text -&gt; Text
</span><a href="Database.Persist.TH.html#upperFirst"><span class="hs-identifier hs-var hs-var">upperFirst</span></a></span></span><span> </span><span id="local-6989586621679964989"><span class="annot"><span class="annottext">Text
</span><a href="#local-6989586621679964989"><span class="hs-identifier hs-var">t</span></a></span></span><span> </span><span class="hs-glyph">=</span><span>
</span><span id="line-1005"></span><span>    </span><span class="hs-keyword">case</span><span> </span><span class="annot"><span class="annottext">Text -&gt; Maybe (Char, Text)
</span><span class="hs-identifier hs-var">uncons</span></span><span> </span><span class="annot"><span class="annottext">Text
</span><a href="#local-6989586621679964989"><span class="hs-identifier hs-var">t</span></a></span><span> </span><span class="hs-keyword">of</span><span>
</span><span id="line-1006"></span><span>        </span><span class="annot"><span class="hs-identifier hs-type">Just</span></span><span> </span><span class="hs-special">(</span><span id="local-6989586621679964988"><span class="annot"><span class="annottext">Char
</span><a href="#local-6989586621679964988"><span class="hs-identifier hs-var">a</span></a></span></span><span class="hs-special">,</span><span> </span><span id="local-6989586621679964987"><span class="annot"><span class="annottext">Text
</span><a href="#local-6989586621679964987"><span class="hs-identifier hs-var">b</span></a></span></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="annottext">Char -&gt; Text -&gt; Text
</span><span class="hs-identifier hs-var">cons</span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Char -&gt; Char
</span><span class="hs-identifier hs-var">toUpper</span></span><span> </span><span class="annot"><span class="annottext">Char
</span><a href="#local-6989586621679964988"><span class="hs-identifier hs-var">a</span></a></span><span class="hs-special">)</span><span> </span><span class="annot"><span class="annottext">Text
</span><a href="#local-6989586621679964987"><span class="hs-identifier hs-var">b</span></a></span><span>
</span><span id="line-1007"></span><span>        </span><span class="annot"><span class="annottext">Maybe (Char, Text)
</span><span class="hs-identifier hs-var">Nothing</span></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="annottext">Text
</span><a href="#local-6989586621679964989"><span class="hs-identifier hs-var">t</span></a></span><span>
</span><span id="line-1008"></span><span>
</span><span id="line-1009"></span><span class="annot"><a href="Database.Persist.TH.html#dataTypeDec"><span class="hs-identifier hs-type">dataTypeDec</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><a href="Database.Persist.TH.html#MkPersistSettings"><span class="hs-identifier hs-type">MkPersistSettings</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="Database.Persist.TH.html#EntityMap"><span class="hs-identifier hs-type">EntityMap</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="Database.Persist.Quasi.Internal.html#UnboundEntityDef"><span class="hs-identifier hs-type">UnboundEntityDef</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="hs-identifier hs-type">Q</span></span><span> </span><span class="annot"><span class="hs-identifier hs-type">Dec</span></span><span>
</span><span id="line-1010"></span><span id="dataTypeDec"><span class="annot"><span class="annottext">dataTypeDec :: MkPersistSettings -&gt; EntityMap -&gt; UnboundEntityDef -&gt; Q Dec
</span><a href="Database.Persist.TH.html#dataTypeDec"><span class="hs-identifier hs-var hs-var">dataTypeDec</span></a></span></span><span> </span><span id="local-6989586621679964985"><span class="annot"><span class="annottext">MkPersistSettings
</span><a href="#local-6989586621679964985"><span class="hs-identifier hs-var">mps</span></a></span></span><span> </span><span id="local-6989586621679964984"><span class="annot"><span class="annottext">EntityMap
</span><a href="#local-6989586621679964984"><span class="hs-identifier hs-var">entityMap</span></a></span></span><span> </span><span id="local-6989586621679964983"><span class="annot"><span class="annottext">UnboundEntityDef
</span><a href="#local-6989586621679964983"><span class="hs-identifier hs-var">entDef</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-keyword">do</span><span>
</span><span id="line-1011"></span><span>    </span><span class="hs-keyword">let</span><span>
</span><span id="line-1012"></span><span>        </span><span id="local-6989586621679964982"><span class="annot"><span class="annottext">names :: [Name]
</span><a href="#local-6989586621679964982"><span class="hs-identifier hs-var hs-var">names</span></a></span></span><span> </span><span class="hs-glyph">=</span><span>
</span><span id="line-1013"></span><span>            </span><span class="annot"><span class="annottext">MkPersistSettings -&gt; UnboundEntityDef -&gt; [Name]
</span><a href="Database.Persist.TH.html#mkEntityDefDeriveNames"><span class="hs-identifier hs-var">mkEntityDefDeriveNames</span></a></span><span> </span><span class="annot"><span class="annottext">MkPersistSettings
</span><a href="#local-6989586621679964985"><span class="hs-identifier hs-var">mps</span></a></span><span> </span><span class="annot"><span class="annottext">UnboundEntityDef
</span><a href="#local-6989586621679964983"><span class="hs-identifier hs-var">entDef</span></a></span><span>
</span><span id="line-1014"></span><span>
</span><span id="line-1015"></span><span>    </span><span class="hs-keyword">let</span><span> </span><span class="hs-special">(</span><span id="local-6989586621679964980"><span class="annot"><span class="annottext">[Name]
</span><a href="#local-6989586621679964980"><span class="hs-identifier hs-var">stocks</span></a></span></span><span class="hs-special">,</span><span> </span><span id="local-6989586621679964979"><span class="annot"><span class="annottext">[Name]
</span><a href="#local-6989586621679964979"><span class="hs-identifier hs-var">anyclasses</span></a></span></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">forall a b. [Either a b] -&gt; ([a], [b])
</span><span class="hs-identifier hs-var">partitionEithers</span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">forall (f :: * -&gt; *) a b. Functor f =&gt; (a -&gt; b) -&gt; f a -&gt; f b
</span><span class="hs-identifier hs-var">fmap</span></span><span> </span><span class="annot"><span class="annottext">Name -&gt; Either Name Name
</span><a href="#local-6989586621679964977"><span class="hs-identifier hs-var">stratFor</span></a></span><span> </span><span class="annot"><span class="annottext">[Name]
</span><a href="#local-6989586621679964982"><span class="hs-identifier hs-var">names</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-1016"></span><span>    </span><span class="hs-keyword">let</span><span> </span><span id="local-6989586621679964976"><span class="annot"><span class="annottext">stockDerives :: [DerivClause]
</span><a href="#local-6989586621679964976"><span class="hs-identifier hs-var hs-var">stockDerives</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-keyword">do</span><span>
</span><span id="line-1017"></span><span>            </span><span class="annot"><span class="annottext">forall (f :: * -&gt; *). Alternative f =&gt; Bool -&gt; f ()
</span><span class="hs-identifier hs-var">guard</span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Bool -&gt; Bool
</span><span class="hs-identifier hs-var">not</span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">forall (t :: * -&gt; *) a. Foldable t =&gt; t a -&gt; Bool
</span><span class="hs-identifier hs-var">null</span></span><span> </span><span class="annot"><span class="annottext">[Name]
</span><a href="#local-6989586621679964980"><span class="hs-identifier hs-var">stocks</span></a></span><span class="hs-special">)</span><span class="hs-special">)</span><span>
</span><span id="line-1018"></span><span>            </span><span class="annot"><span class="annottext">forall (f :: * -&gt; *) a. Applicative f =&gt; a -&gt; f a
</span><span class="hs-identifier hs-var">pure</span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Maybe DerivStrategy -&gt; [Type] -&gt; DerivClause
</span><span class="hs-identifier hs-var">DerivClause</span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">forall a. a -&gt; Maybe a
</span><span class="hs-identifier hs-var">Just</span></span><span> </span><span class="annot"><span class="annottext">DerivStrategy
</span><span class="hs-identifier hs-var">StockStrategy</span></span><span class="hs-special">)</span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">forall (f :: * -&gt; *) a b. Functor f =&gt; (a -&gt; b) -&gt; f a -&gt; f b
</span><span class="hs-identifier hs-var">fmap</span></span><span> </span><span class="annot"><span class="annottext">Name -&gt; Type
</span><span class="hs-identifier hs-var">ConT</span></span><span> </span><span class="annot"><span class="annottext">[Name]
</span><a href="#local-6989586621679964980"><span class="hs-identifier hs-var">stocks</span></a></span><span class="hs-special">)</span><span class="hs-special">)</span><span>
</span><span id="line-1019"></span><span>        </span><span id="local-6989586621679964972"><span class="annot"><span class="annottext">anyclassDerives :: [DerivClause]
</span><a href="#local-6989586621679964972"><span class="hs-identifier hs-var hs-var">anyclassDerives</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-keyword">do</span><span>
</span><span id="line-1020"></span><span>            </span><span class="annot"><span class="annottext">forall (f :: * -&gt; *). Alternative f =&gt; Bool -&gt; f ()
</span><span class="hs-identifier hs-var">guard</span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Bool -&gt; Bool
</span><span class="hs-identifier hs-var">not</span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">forall (t :: * -&gt; *) a. Foldable t =&gt; t a -&gt; Bool
</span><span class="hs-identifier hs-var">null</span></span><span> </span><span class="annot"><span class="annottext">[Name]
</span><a href="#local-6989586621679964979"><span class="hs-identifier hs-var">anyclasses</span></a></span><span class="hs-special">)</span><span class="hs-special">)</span><span>
</span><span id="line-1021"></span><span>            </span><span class="annot"><span class="annottext">forall (f :: * -&gt; *) a. Applicative f =&gt; a -&gt; f a
</span><span class="hs-identifier hs-var">pure</span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Maybe DerivStrategy -&gt; [Type] -&gt; DerivClause
</span><span class="hs-identifier hs-var">DerivClause</span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">forall a. a -&gt; Maybe a
</span><span class="hs-identifier hs-var">Just</span></span><span> </span><span class="annot"><span class="annottext">DerivStrategy
</span><span class="hs-identifier hs-var">AnyclassStrategy</span></span><span class="hs-special">)</span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">forall (f :: * -&gt; *) a b. Functor f =&gt; (a -&gt; b) -&gt; f a -&gt; f b
</span><span class="hs-identifier hs-var">fmap</span></span><span> </span><span class="annot"><span class="annottext">Name -&gt; Type
</span><span class="hs-identifier hs-var">ConT</span></span><span> </span><span class="annot"><span class="annottext">[Name]
</span><a href="#local-6989586621679964979"><span class="hs-identifier hs-var">anyclasses</span></a></span><span class="hs-special">)</span><span class="hs-special">)</span><span>
</span><span id="line-1022"></span><span>    </span><span class="annot"><span class="annottext">forall (f :: * -&gt; *). Applicative f =&gt; Bool -&gt; f () -&gt; f ()
</span><span class="hs-identifier hs-var">unless</span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">forall (t :: * -&gt; *) a. Foldable t =&gt; t a -&gt; Bool
</span><span class="hs-identifier hs-var">null</span></span><span> </span><span class="annot"><span class="annottext">[DerivClause]
</span><a href="#local-6989586621679964972"><span class="hs-identifier hs-var">anyclassDerives</span></a></span><span class="hs-special">)</span><span> </span><span class="annot"><span class="annottext">forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span> </span><span class="hs-keyword">do</span><span>
</span><span id="line-1023"></span><span>        </span><span class="annot"><span class="annottext">[[Extension]] -&gt; Q ()
</span><a href="Database.Persist.TH.html#requireExtensions"><span class="hs-identifier hs-var">requireExtensions</span></a></span><span> </span><span class="hs-special">[</span><span class="hs-special">[</span><span class="annot"><span class="annottext">Extension
</span><span class="hs-identifier hs-var">DeriveAnyClass</span></span><span class="hs-special">]</span><span class="hs-special">]</span><span>
</span><span id="line-1024"></span><span>    </span><span class="annot"><span class="annottext">forall (f :: * -&gt; *) a. Applicative f =&gt; a -&gt; f a
</span><span class="hs-identifier hs-var">pure</span></span><span> </span><span class="annot"><span class="annottext">forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span> </span><span class="annot"><span class="annottext">[Type]
-&gt; Name
-&gt; [TyVarBndr ()]
-&gt; Maybe Type
-&gt; [Con]
-&gt; [DerivClause]
-&gt; Dec
</span><span class="hs-identifier hs-var">DataD</span></span><span> </span><span class="hs-special">[</span><span class="hs-special">]</span><span> </span><span class="annot"><span class="annottext">Name
</span><a href="#local-6989586621679964967"><span class="hs-identifier hs-var">nameFinal</span></a></span><span> </span><span class="annot"><span class="annottext">[TyVarBndr ()]
</span><a href="#local-6989586621679964966"><span class="hs-identifier hs-var">paramsFinal</span></a></span><span>
</span><span id="line-1025"></span><span>                </span><span class="annot"><span class="annottext">forall a. Maybe a
</span><span class="hs-identifier hs-var">Nothing</span></span><span>
</span><span id="line-1026"></span><span>                </span><span class="annot"><span class="annottext">[Con]
</span><a href="#local-6989586621679964965"><span class="hs-identifier hs-var">constrs</span></a></span><span>
</span><span id="line-1027"></span><span>                </span><span class="hs-special">(</span><span class="annot"><span class="annottext">[DerivClause]
</span><a href="#local-6989586621679964976"><span class="hs-identifier hs-var">stockDerives</span></a></span><span> </span><span class="annot"><span class="annottext">forall a. Semigroup a =&gt; a -&gt; a -&gt; a
</span><span class="hs-operator hs-var">&lt;&gt;</span></span><span> </span><span class="annot"><span class="annottext">[DerivClause]
</span><a href="#local-6989586621679964972"><span class="hs-identifier hs-var">anyclassDerives</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-1028"></span><span>  </span><span class="hs-keyword">where</span><span>
</span><span id="line-1029"></span><span>    </span><span id="local-6989586621679964977"><span class="annot"><span class="annottext">stratFor :: Name -&gt; Either Name Name
</span><a href="#local-6989586621679964977"><span class="hs-identifier hs-var hs-var">stratFor</span></a></span></span><span> </span><span id="local-6989586621679964961"><span class="annot"><span class="annottext">Name
</span><a href="#local-6989586621679964961"><span class="hs-identifier hs-var">n</span></a></span></span><span> </span><span class="hs-glyph">=</span><span>
</span><span id="line-1030"></span><span>        </span><span class="hs-keyword">if</span><span> </span><span class="annot"><span class="annottext">Name
</span><a href="#local-6989586621679964961"><span class="hs-identifier hs-var">n</span></a></span><span> </span><span class="annot"><span class="annottext">forall (t :: * -&gt; *) a. (Foldable t, Eq a) =&gt; a -&gt; t a -&gt; Bool
</span><span class="hs-operator hs-var">`elem`</span></span><span> </span><span class="annot"><span class="annottext">Set Name
</span><a href="#local-6989586621679964959"><span class="hs-identifier hs-var">stockClasses</span></a></span><span> </span><span class="hs-keyword">then</span><span>
</span><span id="line-1031"></span><span>            </span><span class="annot"><span class="annottext">forall a b. a -&gt; Either a b
</span><span class="hs-identifier hs-var">Left</span></span><span> </span><span class="annot"><span class="annottext">Name
</span><a href="#local-6989586621679964961"><span class="hs-identifier hs-var">n</span></a></span><span>
</span><span id="line-1032"></span><span>        </span><span class="hs-keyword">else</span><span>
</span><span id="line-1033"></span><span>            </span><span class="annot"><span class="annottext">forall a b. b -&gt; Either a b
</span><span class="hs-identifier hs-var">Right</span></span><span> </span><span class="annot"><span class="annottext">Name
</span><a href="#local-6989586621679964961"><span class="hs-identifier hs-var">n</span></a></span><span>
</span><span id="line-1034"></span><span>
</span><span id="line-1035"></span><span>    </span><span id="local-6989586621679964959"><span class="annot"><span class="annottext">stockClasses :: Set Name
</span><a href="#local-6989586621679964959"><span class="hs-identifier hs-var hs-var">stockClasses</span></a></span></span><span> </span><span class="hs-glyph">=</span><span>
</span><span id="line-1036"></span><span>        </span><span class="annot"><span class="annottext">forall a. Ord a =&gt; [a] -&gt; Set a
</span><span class="hs-identifier hs-var">Set.fromList</span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">forall (f :: * -&gt; *) a b. Functor f =&gt; (a -&gt; b) -&gt; f a -&gt; f b
</span><span class="hs-identifier hs-var">fmap</span></span><span> </span><span class="annot"><span class="annottext">String -&gt; Name
</span><span class="hs-identifier hs-var">mkName</span></span><span>
</span><span id="line-1037"></span><span>        </span><span class="hs-special">[</span><span> </span><span class="annot"><span class="annottext">String
</span><span class="hs-string">&quot;Eq&quot;</span></span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">String
</span><span class="hs-string">&quot;Ord&quot;</span></span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">String
</span><span class="hs-string">&quot;Show&quot;</span></span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">String
</span><span class="hs-string">&quot;Read&quot;</span></span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">String
</span><span class="hs-string">&quot;Bounded&quot;</span></span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">String
</span><span class="hs-string">&quot;Enum&quot;</span></span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">String
</span><span class="hs-string">&quot;Ix&quot;</span></span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">String
</span><span class="hs-string">&quot;Generic&quot;</span></span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">String
</span><span class="hs-string">&quot;Data&quot;</span></span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">String
</span><span class="hs-string">&quot;Typeable&quot;</span></span><span>
</span><span id="line-1038"></span><span>        </span><span class="hs-special">]</span><span> </span><span class="annot"><span class="annottext">forall a. Semigroup a =&gt; a -&gt; a -&gt; a
</span><span class="hs-operator hs-var">&lt;&gt;</span></span><span> </span><span class="hs-special">[</span><span class="hs-special">''</span><span class="hs-identifier">Eq</span><span class="hs-special">,</span><span> </span><span class="hs-special">''</span><span class="hs-identifier">Ord</span><span class="hs-special">,</span><span> </span><span class="hs-special">''</span><span class="hs-identifier">Show</span><span class="hs-special">,</span><span> </span><span class="hs-special">''</span><span class="hs-identifier">Read</span><span class="hs-special">,</span><span> </span><span class="hs-special">''</span><span class="hs-identifier">Bounded</span><span class="hs-special">,</span><span> </span><span class="hs-special">''</span><span class="hs-identifier">Enum</span><span class="hs-special">,</span><span> </span><span class="hs-special">''</span><span class="hs-identifier">Ix</span><span class="hs-special">,</span><span> </span><span class="hs-special">''</span><span class="hs-identifier">Generic</span><span class="hs-special">,</span><span> </span><span class="hs-special">''</span><span class="hs-identifier">Data</span><span class="hs-special">,</span><span> </span><span class="hs-special">''</span><span class="hs-identifier">Typeable</span><span>
</span><span id="line-1039"></span><span>        </span><span class="hs-special">]</span><span>
</span><span id="line-1040"></span><span>        </span><span class="hs-special">)</span><span>
</span><span id="line-1041"></span><span>
</span><span id="line-1042"></span><span>    </span><span class="hs-special">(</span><span id="local-6989586621679964967"><span class="annot"><span class="annottext">Name
</span><a href="#local-6989586621679964967"><span class="hs-identifier hs-var">nameFinal</span></a></span></span><span class="hs-special">,</span><span> </span><span id="local-6989586621679964966"><span class="annot"><span class="annottext">[TyVarBndr ()]
</span><a href="#local-6989586621679964966"><span class="hs-identifier hs-var">paramsFinal</span></a></span></span><span class="hs-special">)</span><span>
</span><span id="line-1043"></span><span>        </span><span class="hs-glyph">|</span><span> </span><span class="annot"><span class="annottext">MkPersistSettings -&gt; Bool
</span><a href="Database.Persist.TH.html#mpsGeneric"><span class="hs-identifier hs-var">mpsGeneric</span></a></span><span> </span><span class="annot"><span class="annottext">MkPersistSettings
</span><a href="#local-6989586621679964985"><span class="hs-identifier hs-var">mps</span></a></span><span> </span><span class="hs-glyph">=</span><span>
</span><span id="line-1044"></span><span>            </span><span class="hs-special">(</span><span> </span><span class="annot"><span class="annottext">UnboundEntityDef -&gt; Name
</span><a href="Database.Persist.TH.html#mkEntityDefGenericName"><span class="hs-identifier hs-var">mkEntityDefGenericName</span></a></span><span> </span><span class="annot"><span class="annottext">UnboundEntityDef
</span><a href="#local-6989586621679964983"><span class="hs-identifier hs-var">entDef</span></a></span><span>
</span><span id="line-1045"></span><span>            </span><span class="hs-special">,</span><span> </span><span class="hs-special">[</span><span> </span><span class="annot"><span class="annottext">Name -&gt; TyVarBndr ()
</span><a href="Database.Persist.TH.html#mkPlainTV"><span class="hs-identifier hs-var">mkPlainTV</span></a></span><span> </span><span class="annot"><span class="annottext">Name
</span><a href="Database.Persist.TH.html#backendName"><span class="hs-identifier hs-var">backendName</span></a></span><span>
</span><span id="line-1046"></span><span>              </span><span class="hs-special">]</span><span>
</span><span id="line-1047"></span><span>            </span><span class="hs-special">)</span><span>
</span><span id="line-1048"></span><span>
</span><span id="line-1049"></span><span>        </span><span class="hs-glyph">|</span><span> </span><span class="annot"><span class="annottext">Bool
</span><span class="hs-identifier hs-var">otherwise</span></span><span> </span><span class="hs-glyph">=</span><span>
</span><span id="line-1050"></span><span>            </span><span class="hs-special">(</span><span class="annot"><span class="annottext">UnboundEntityDef -&gt; Name
</span><a href="Database.Persist.TH.html#mkEntityDefName"><span class="hs-identifier hs-var">mkEntityDefName</span></a></span><span> </span><span class="annot"><span class="annottext">UnboundEntityDef
</span><a href="#local-6989586621679964983"><span class="hs-identifier hs-var">entDef</span></a></span><span class="hs-special">,</span><span> </span><span class="hs-special">[</span><span class="hs-special">]</span><span class="hs-special">)</span><span>
</span><span id="line-1051"></span><span>
</span><span id="line-1052"></span><span>    </span><span class="annot"><a href="#local-6989586621679964939"><span class="hs-identifier hs-type">cols</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="hs-special">[</span><span class="annot"><span class="hs-identifier hs-type">VarBangType</span></span><span class="hs-special">]</span><span>
</span><span id="line-1053"></span><span>    </span><span id="local-6989586621679964939"><span class="annot"><span class="annottext">cols :: [VarBangType]
</span><a href="#local-6989586621679964939"><span class="hs-identifier hs-var hs-var">cols</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-keyword">do</span><span>
</span><span id="line-1054"></span><span>        </span><span id="local-6989586621679964938"><span class="annot"><span class="annottext">UnboundFieldDef
</span><a href="#local-6989586621679964938"><span class="hs-identifier hs-var">fieldDef</span></a></span></span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">UnboundEntityDef -&gt; [UnboundFieldDef]
</span><a href="Database.Persist.Quasi.Internal.html#getUnboundFieldDefs"><span class="hs-identifier hs-var">getUnboundFieldDefs</span></a></span><span> </span><span class="annot"><span class="annottext">UnboundEntityDef
</span><a href="#local-6989586621679964983"><span class="hs-identifier hs-var">entDef</span></a></span><span>
</span><span id="line-1055"></span><span>        </span><span class="hs-keyword">let</span><span>
</span><span id="line-1056"></span><span>            </span><span id="local-6989586621679964937"><span class="annot"><span class="annottext">recordName :: Name
</span><a href="#local-6989586621679964937"><span class="hs-identifier hs-var hs-var">recordName</span></a></span></span><span> </span><span class="hs-glyph">=</span><span>
</span><span id="line-1057"></span><span>                </span><span class="annot"><span class="annottext">MkPersistSettings -&gt; UnboundEntityDef -&gt; UnboundFieldDef -&gt; Name
</span><a href="Database.Persist.TH.html#fieldDefToRecordName"><span class="hs-identifier hs-var">fieldDefToRecordName</span></a></span><span> </span><span class="annot"><span class="annottext">MkPersistSettings
</span><a href="#local-6989586621679964985"><span class="hs-identifier hs-var">mps</span></a></span><span> </span><span class="annot"><span class="annottext">UnboundEntityDef
</span><a href="#local-6989586621679964983"><span class="hs-identifier hs-var">entDef</span></a></span><span> </span><span class="annot"><span class="annottext">UnboundFieldDef
</span><a href="#local-6989586621679964938"><span class="hs-identifier hs-var">fieldDef</span></a></span><span>
</span><span id="line-1058"></span><span>            </span><span id="local-6989586621679964935"><span class="annot"><span class="annottext">strictness :: Bang
</span><a href="#local-6989586621679964935"><span class="hs-identifier hs-var hs-var">strictness</span></a></span></span><span> </span><span class="hs-glyph">=</span><span>
</span><span id="line-1059"></span><span>                </span><span class="hs-keyword">if</span><span> </span><span class="annot"><span class="annottext">UnboundFieldDef -&gt; Bool
</span><a href="Database.Persist.Quasi.Internal.html#unboundFieldStrict"><span class="hs-identifier hs-var">unboundFieldStrict</span></a></span><span> </span><span class="annot"><span class="annottext">UnboundFieldDef
</span><a href="#local-6989586621679964938"><span class="hs-identifier hs-var">fieldDef</span></a></span><span>
</span><span id="line-1060"></span><span>                </span><span class="hs-keyword">then</span><span> </span><span class="annot"><span class="annottext">Bang
</span><a href="Database.Persist.TH.html#isStrict"><span class="hs-identifier hs-var">isStrict</span></a></span><span>
</span><span id="line-1061"></span><span>                </span><span class="hs-keyword">else</span><span> </span><span class="annot"><span class="annottext">Bang
</span><a href="Database.Persist.TH.html#notStrict"><span class="hs-identifier hs-var">notStrict</span></a></span><span>
</span><span id="line-1062"></span><span>            </span><span id="local-6989586621679964932"><span class="annot"><span class="annottext">fieldIdType :: Type
</span><a href="#local-6989586621679964932"><span class="hs-identifier hs-var hs-var">fieldIdType</span></a></span></span><span> </span><span class="hs-glyph">=</span><span>
</span><span id="line-1063"></span><span>                </span><span class="annot"><span class="annottext">MkPersistSettings
-&gt; EntityMap
-&gt; UnboundFieldDef
-&gt; Maybe Name
-&gt; Maybe IsNullable
-&gt; Type
</span><a href="Database.Persist.TH.html#maybeIdType"><span class="hs-identifier hs-var">maybeIdType</span></a></span><span> </span><span class="annot"><span class="annottext">MkPersistSettings
</span><a href="#local-6989586621679964985"><span class="hs-identifier hs-var">mps</span></a></span><span> </span><span class="annot"><span class="annottext">EntityMap
</span><a href="#local-6989586621679964984"><span class="hs-identifier hs-var">entityMap</span></a></span><span> </span><span class="annot"><span class="annottext">UnboundFieldDef
</span><a href="#local-6989586621679964938"><span class="hs-identifier hs-var">fieldDef</span></a></span><span> </span><span class="annot"><span class="annottext">forall a. Maybe a
</span><span class="hs-identifier hs-var">Nothing</span></span><span> </span><span class="annot"><span class="annottext">forall a. Maybe a
</span><span class="hs-identifier hs-var">Nothing</span></span><span>
</span><span id="line-1064"></span><span>        </span><span class="annot"><span class="annottext">forall (f :: * -&gt; *) a. Applicative f =&gt; a -&gt; f a
</span><span class="hs-identifier hs-var">pure</span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Name
</span><a href="#local-6989586621679964937"><span class="hs-identifier hs-var">recordName</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">Bang
</span><a href="#local-6989586621679964935"><span class="hs-identifier hs-var">strictness</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">Type
</span><a href="#local-6989586621679964932"><span class="hs-identifier hs-var">fieldIdType</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-1065"></span><span>
</span><span id="line-1066"></span><span>    </span><span id="local-6989586621679964965"><span class="annot"><span class="annottext">constrs :: [Con]
</span><a href="#local-6989586621679964965"><span class="hs-identifier hs-var hs-var">constrs</span></a></span></span><span>
</span><span id="line-1067"></span><span>        </span><span class="hs-glyph">|</span><span> </span><span class="annot"><span class="annottext">UnboundEntityDef -&gt; Bool
</span><a href="Database.Persist.TH.html#unboundEntitySum"><span class="hs-identifier hs-var">unboundEntitySum</span></a></span><span> </span><span class="annot"><span class="annottext">UnboundEntityDef
</span><a href="#local-6989586621679964983"><span class="hs-identifier hs-var">entDef</span></a></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">forall (f :: * -&gt; *) a b. Functor f =&gt; (a -&gt; b) -&gt; f a -&gt; f b
</span><span class="hs-identifier hs-var">fmap</span></span><span> </span><span class="annot"><span class="annottext">UnboundFieldDef -&gt; Con
</span><a href="#local-6989586621679964929"><span class="hs-identifier hs-var">sumCon</span></a></span><span> </span><span class="annot"><span class="annottext">forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span> </span><span class="annot"><span class="annottext">UnboundEntityDef -&gt; [UnboundFieldDef]
</span><a href="Database.Persist.Quasi.Internal.html#getUnboundFieldDefs"><span class="hs-identifier hs-var">getUnboundFieldDefs</span></a></span><span> </span><span class="annot"><span class="annottext">UnboundEntityDef
</span><a href="#local-6989586621679964983"><span class="hs-identifier hs-var">entDef</span></a></span><span>
</span><span id="line-1068"></span><span>        </span><span class="hs-glyph">|</span><span> </span><span class="annot"><span class="annottext">Bool
</span><span class="hs-identifier hs-var">otherwise</span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-special">[</span><span class="annot"><span class="annottext">Name -&gt; [VarBangType] -&gt; Con
</span><span class="hs-identifier hs-var">RecC</span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">UnboundEntityDef -&gt; Name
</span><a href="Database.Persist.TH.html#mkEntityDefName"><span class="hs-identifier hs-var">mkEntityDefName</span></a></span><span> </span><span class="annot"><span class="annottext">UnboundEntityDef
</span><a href="#local-6989586621679964983"><span class="hs-identifier hs-var">entDef</span></a></span><span class="hs-special">)</span><span> </span><span class="annot"><span class="annottext">[VarBangType]
</span><a href="#local-6989586621679964939"><span class="hs-identifier hs-var">cols</span></a></span><span class="hs-special">]</span><span>
</span><span id="line-1069"></span><span>
</span><span id="line-1070"></span><span>    </span><span id="local-6989586621679964929"><span class="annot"><span class="annottext">sumCon :: UnboundFieldDef -&gt; Con
</span><a href="#local-6989586621679964929"><span class="hs-identifier hs-var hs-var">sumCon</span></a></span></span><span> </span><span id="local-6989586621679964927"><span class="annot"><span class="annottext">UnboundFieldDef
</span><a href="#local-6989586621679964927"><span class="hs-identifier hs-var">fieldDef</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">Name -&gt; [BangType] -&gt; Con
</span><span class="hs-identifier hs-var">NormalC</span></span><span>
</span><span id="line-1071"></span><span>        </span><span class="hs-special">(</span><span class="annot"><span class="annottext">MkPersistSettings -&gt; UnboundEntityDef -&gt; UnboundFieldDef -&gt; Name
</span><a href="Database.Persist.TH.html#sumConstrName"><span class="hs-identifier hs-var">sumConstrName</span></a></span><span> </span><span class="annot"><span class="annottext">MkPersistSettings
</span><a href="#local-6989586621679964985"><span class="hs-identifier hs-var">mps</span></a></span><span> </span><span class="annot"><span class="annottext">UnboundEntityDef
</span><a href="#local-6989586621679964983"><span class="hs-identifier hs-var">entDef</span></a></span><span> </span><span class="annot"><span class="annottext">UnboundFieldDef
</span><a href="#local-6989586621679964927"><span class="hs-identifier hs-var">fieldDef</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-1072"></span><span>        </span><span class="hs-special">[</span><span class="hs-special">(</span><span class="annot"><span class="annottext">Bang
</span><a href="Database.Persist.TH.html#notStrict"><span class="hs-identifier hs-var">notStrict</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">MkPersistSettings
-&gt; EntityMap
-&gt; UnboundFieldDef
-&gt; Maybe Name
-&gt; Maybe IsNullable
-&gt; Type
</span><a href="Database.Persist.TH.html#maybeIdType"><span class="hs-identifier hs-var">maybeIdType</span></a></span><span> </span><span class="annot"><span class="annottext">MkPersistSettings
</span><a href="#local-6989586621679964985"><span class="hs-identifier hs-var">mps</span></a></span><span> </span><span class="annot"><span class="annottext">EntityMap
</span><a href="#local-6989586621679964984"><span class="hs-identifier hs-var">entityMap</span></a></span><span> </span><span class="annot"><span class="annottext">UnboundFieldDef
</span><a href="#local-6989586621679964927"><span class="hs-identifier hs-var">fieldDef</span></a></span><span> </span><span class="annot"><span class="annottext">forall a. Maybe a
</span><span class="hs-identifier hs-var">Nothing</span></span><span> </span><span class="annot"><span class="annottext">forall a. Maybe a
</span><span class="hs-identifier hs-var">Nothing</span></span><span class="hs-special">)</span><span class="hs-special">]</span><span>
</span><span id="line-1073"></span><span>
</span><span id="line-1074"></span><span class="annot"><a href="Database.Persist.TH.html#uniqueTypeDec"><span class="hs-identifier hs-type">uniqueTypeDec</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><a href="Database.Persist.TH.html#MkPersistSettings"><span class="hs-identifier hs-type">MkPersistSettings</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="Database.Persist.TH.html#EntityMap"><span class="hs-identifier hs-type">EntityMap</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="Database.Persist.Quasi.Internal.html#UnboundEntityDef"><span class="hs-identifier hs-type">UnboundEntityDef</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="hs-identifier hs-type">Dec</span></span><span>
</span><span id="line-1075"></span><span id="uniqueTypeDec"><span class="annot"><span class="annottext">uniqueTypeDec :: MkPersistSettings -&gt; EntityMap -&gt; UnboundEntityDef -&gt; Dec
</span><a href="Database.Persist.TH.html#uniqueTypeDec"><span class="hs-identifier hs-var hs-var">uniqueTypeDec</span></a></span></span><span> </span><span id="local-6989586621679964923"><span class="annot"><span class="annottext">MkPersistSettings
</span><a href="#local-6989586621679964923"><span class="hs-identifier hs-var">mps</span></a></span></span><span> </span><span id="local-6989586621679964922"><span class="annot"><span class="annottext">EntityMap
</span><a href="#local-6989586621679964922"><span class="hs-identifier hs-var">entityMap</span></a></span></span><span> </span><span id="local-6989586621679964921"><span class="annot"><span class="annottext">UnboundEntityDef
</span><a href="#local-6989586621679964921"><span class="hs-identifier hs-var">entDef</span></a></span></span><span> </span><span class="hs-glyph">=</span><span>
</span><span id="line-1076"></span><span>    </span><span class="annot"><span class="annottext">[Type]
-&gt; Maybe [TyVarBndr ()]
-&gt; Type
-&gt; Maybe Type
-&gt; [Con]
-&gt; [DerivClause]
-&gt; Dec
</span><span class="hs-identifier hs-var">DataInstD</span></span><span>
</span><span id="line-1077"></span><span>        </span><span class="hs-special">[</span><span class="hs-special">]</span><span class="hs-cpp">
#if MIN_VERSION_template_haskell(2,15,0)
</span><span>        </span><span class="annot"><span class="annottext">forall a. Maybe a
</span><span class="hs-identifier hs-var">Nothing</span></span><span>
</span><span id="line-1080"></span><span>        </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Type -&gt; Type -&gt; Type
</span><span class="hs-identifier hs-var">AppT</span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Name -&gt; Type
</span><span class="hs-identifier hs-var">ConT</span></span><span> </span><span class="hs-special">''</span><span class="hs-identifier">Unique</span><span class="hs-special">)</span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">MkPersistSettings -&gt; EntityNameHS -&gt; Type -&gt; Type
</span><a href="Database.Persist.TH.html#genericDataType"><span class="hs-identifier hs-var">genericDataType</span></a></span><span> </span><span class="annot"><span class="annottext">MkPersistSettings
</span><a href="#local-6989586621679964923"><span class="hs-identifier hs-var">mps</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">UnboundEntityDef -&gt; EntityNameHS
</span><a href="Database.Persist.Quasi.Internal.html#getUnboundEntityNameHS"><span class="hs-identifier hs-var">getUnboundEntityNameHS</span></a></span><span> </span><span class="annot"><span class="annottext">UnboundEntityDef
</span><a href="#local-6989586621679964921"><span class="hs-identifier hs-var">entDef</span></a></span><span class="hs-special">)</span><span> </span><span class="annot"><span class="annottext">Type
</span><a href="Database.Persist.TH.html#backendT"><span class="hs-identifier hs-var">backendT</span></a></span><span class="hs-special">)</span><span class="hs-special">)</span><span class="hs-cpp">
#else
</span><span>        </span><span class="hs-special">''</span><span class="hs-identifier">Unique</span><span>
</span><span id="line-1083"></span><span>        </span><span class="hs-special">[</span><span class="hs-identifier">genericDataType</span><span> </span><span class="hs-identifier">mps</span><span> </span><span class="hs-special">(</span><span class="hs-identifier">getUnboundEntityNameHS</span><span> </span><span class="hs-identifier">entDef</span><span class="hs-special">)</span><span> </span><span class="hs-identifier">backendT</span><span class="hs-special">]</span><span class="hs-cpp">
#endif
</span><span>        </span><span class="annot"><span class="annottext">forall a. Maybe a
</span><span class="hs-identifier hs-var">Nothing</span></span><span>
</span><span id="line-1086"></span><span>        </span><span class="hs-special">(</span><span class="annot"><span class="annottext">forall (f :: * -&gt; *) a b. Functor f =&gt; (a -&gt; b) -&gt; f a -&gt; f b
</span><span class="hs-identifier hs-var">fmap</span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">MkPersistSettings
-&gt; EntityMap -&gt; UnboundEntityDef -&gt; UniqueDef -&gt; Con
</span><a href="Database.Persist.TH.html#mkUnique"><span class="hs-identifier hs-var">mkUnique</span></a></span><span> </span><span class="annot"><span class="annottext">MkPersistSettings
</span><a href="#local-6989586621679964923"><span class="hs-identifier hs-var">mps</span></a></span><span> </span><span class="annot"><span class="annottext">EntityMap
</span><a href="#local-6989586621679964922"><span class="hs-identifier hs-var">entityMap</span></a></span><span> </span><span class="annot"><span class="annottext">UnboundEntityDef
</span><a href="#local-6989586621679964921"><span class="hs-identifier hs-var">entDef</span></a></span><span class="hs-special">)</span><span> </span><span class="annot"><span class="annottext">forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span> </span><span class="annot"><span class="annottext">EntityDef -&gt; [UniqueDef]
</span><a href="Database.Persist.Types.Base.html#entityUniques"><span class="hs-identifier hs-var">entityUniques</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">UnboundEntityDef -&gt; EntityDef
</span><a href="Database.Persist.Quasi.Internal.html#unboundEntityDef"><span class="hs-identifier hs-var">unboundEntityDef</span></a></span><span> </span><span class="annot"><span class="annottext">UnboundEntityDef
</span><a href="#local-6989586621679964921"><span class="hs-identifier hs-var">entDef</span></a></span><span class="hs-special">)</span><span class="hs-special">)</span><span>
</span><span id="line-1087"></span><span>        </span><span class="hs-special">[</span><span class="hs-special">]</span><span>
</span><span id="line-1088"></span><span>
</span><span id="line-1089"></span><span class="annot"><a href="Database.Persist.TH.html#mkUnique"><span class="hs-identifier hs-type">mkUnique</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><a href="Database.Persist.TH.html#MkPersistSettings"><span class="hs-identifier hs-type">MkPersistSettings</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="Database.Persist.TH.html#EntityMap"><span class="hs-identifier hs-type">EntityMap</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="Database.Persist.Quasi.Internal.html#UnboundEntityDef"><span class="hs-identifier hs-type">UnboundEntityDef</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="Database.Persist.Types.Base.html#UniqueDef"><span class="hs-identifier hs-type">UniqueDef</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="hs-identifier hs-type">Con</span></span><span>
</span><span id="line-1090"></span><span id="mkUnique"><span class="annot"><span class="annottext">mkUnique :: MkPersistSettings
-&gt; EntityMap -&gt; UnboundEntityDef -&gt; UniqueDef -&gt; Con
</span><a href="Database.Persist.TH.html#mkUnique"><span class="hs-identifier hs-var hs-var">mkUnique</span></a></span></span><span> </span><span id="local-6989586621679964915"><span class="annot"><span class="annottext">MkPersistSettings
</span><a href="#local-6989586621679964915"><span class="hs-identifier hs-var">mps</span></a></span></span><span> </span><span id="local-6989586621679964914"><span class="annot"><span class="annottext">EntityMap
</span><a href="#local-6989586621679964914"><span class="hs-identifier hs-var">entityMap</span></a></span></span><span> </span><span id="local-6989586621679964913"><span class="annot"><span class="annottext">UnboundEntityDef
</span><a href="#local-6989586621679964913"><span class="hs-identifier hs-var">entDef</span></a></span></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="Database.Persist.Types.Base.html#UniqueDef"><span class="hs-identifier hs-type">UniqueDef</span></a></span><span> </span><span id="local-6989586621679964911"><span class="annot"><span class="annottext">ConstraintNameHS
</span><a href="#local-6989586621679964911"><span class="hs-identifier hs-var">constr</span></a></span></span><span> </span><span class="annot"><span class="annottext">ConstraintNameDB
</span><span class="hs-identifier">_</span></span><span> </span><span id="local-6989586621679964910"><span class="annot"><span class="annottext">NonEmpty ForeignFieldDef
</span><a href="#local-6989586621679964910"><span class="hs-identifier hs-var">fields</span></a></span></span><span> </span><span id="local-6989586621679964909"><span class="annot"><span class="annottext">[Text]
</span><a href="#local-6989586621679964909"><span class="hs-identifier hs-var">attrs</span></a></span></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">=</span><span>
</span><span id="line-1091"></span><span>    </span><span class="annot"><span class="annottext">Name -&gt; [BangType] -&gt; Con
</span><span class="hs-identifier hs-var">NormalC</span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">ConstraintNameHS -&gt; Name
</span><a href="Database.Persist.TH.html#mkConstraintName"><span class="hs-identifier hs-var">mkConstraintName</span></a></span><span> </span><span class="annot"><span class="annottext">ConstraintNameHS
</span><a href="#local-6989586621679964911"><span class="hs-identifier hs-var">constr</span></a></span><span class="hs-special">)</span><span> </span><span class="annot"><span class="annottext">forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span> </span><span class="annot"><span class="annottext">forall (t :: * -&gt; *) a. Foldable t =&gt; t a -&gt; [a]
</span><span class="hs-identifier hs-var">toList</span></span><span> </span><span class="annot"><span class="annottext">NonEmpty BangType
</span><a href="#local-6989586621679964907"><span class="hs-identifier hs-var">types</span></a></span><span>
</span><span id="line-1092"></span><span>  </span><span class="hs-keyword">where</span><span>
</span><span id="line-1093"></span><span>    </span><span id="local-6989586621679964907"><span class="annot"><span class="annottext">types :: NonEmpty BangType
</span><a href="#local-6989586621679964907"><span class="hs-identifier hs-var hs-var">types</span></a></span></span><span> </span><span class="hs-glyph">=</span><span>
</span><span id="line-1094"></span><span>      </span><span class="annot"><span class="annottext">forall (f :: * -&gt; *) a b. Functor f =&gt; (a -&gt; b) -&gt; f a -&gt; f b
</span><span class="hs-identifier hs-var">fmap</span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">(UnboundFieldDef, IsNullable) -&gt; BangType
</span><a href="#local-6989586621679964906"><span class="hs-identifier hs-var">go</span></a></span><span> </span><span class="annot"><span class="annottext">forall b c a. (b -&gt; c) -&gt; (a -&gt; b) -&gt; a -&gt; c
</span><span class="hs-operator hs-var">.</span></span><span> </span><span class="annot"><span class="annottext">forall a b c. (a -&gt; b -&gt; c) -&gt; b -&gt; a -&gt; c
</span><span class="hs-identifier hs-var">flip</span></span><span> </span><span class="annot"><span class="annottext">Text -&gt; [UnboundFieldDef] -&gt; (UnboundFieldDef, IsNullable)
</span><a href="#local-6989586621679964904"><span class="hs-identifier hs-var">lookup3</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">UnboundEntityDef -&gt; [UnboundFieldDef]
</span><a href="Database.Persist.Quasi.Internal.html#getUnboundFieldDefs"><span class="hs-identifier hs-var">getUnboundFieldDefs</span></a></span><span> </span><span class="annot"><span class="annottext">UnboundEntityDef
</span><a href="#local-6989586621679964913"><span class="hs-identifier hs-var">entDef</span></a></span><span class="hs-special">)</span><span> </span><span class="annot"><span class="annottext">forall b c a. (b -&gt; c) -&gt; (a -&gt; b) -&gt; a -&gt; c
</span><span class="hs-operator hs-var">.</span></span><span> </span><span class="annot"><span class="annottext">FieldNameHS -&gt; Text
</span><a href="Database.Persist.Names.html#unFieldNameHS"><span class="hs-identifier hs-var">unFieldNameHS</span></a></span><span> </span><span class="annot"><span class="annottext">forall b c a. (b -&gt; c) -&gt; (a -&gt; b) -&gt; a -&gt; c
</span><span class="hs-operator hs-var">.</span></span><span> </span><span class="annot"><span class="annottext">forall a b. (a, b) -&gt; a
</span><span class="hs-identifier hs-var">fst</span></span><span class="hs-special">)</span><span> </span><span class="annot"><span class="annottext">NonEmpty ForeignFieldDef
</span><a href="#local-6989586621679964910"><span class="hs-identifier hs-var">fields</span></a></span><span>
</span><span id="line-1095"></span><span>
</span><span id="line-1096"></span><span>    </span><span id="local-6989586621679964902"><span class="annot"><span class="annottext">force :: Bool
</span><a href="#local-6989586621679964902"><span class="hs-identifier hs-var hs-var">force</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">Text
</span><span class="hs-string">&quot;!force&quot;</span></span><span> </span><span class="annot"><span class="annottext">forall (t :: * -&gt; *) a. (Foldable t, Eq a) =&gt; a -&gt; t a -&gt; Bool
</span><span class="hs-operator hs-var">`elem`</span></span><span> </span><span class="annot"><span class="annottext">[Text]
</span><a href="#local-6989586621679964909"><span class="hs-identifier hs-var">attrs</span></a></span><span>
</span><span id="line-1097"></span><span>
</span><span id="line-1098"></span><span>    </span><span class="annot"><a href="#local-6989586621679964906"><span class="hs-identifier hs-type">go</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="hs-special">(</span><span class="annot"><a href="Database.Persist.Quasi.Internal.html#UnboundFieldDef"><span class="hs-identifier hs-type">UnboundFieldDef</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><a href="Database.Persist.Types.Base.html#IsNullable"><span class="hs-identifier hs-type">IsNullable</span></a></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-special">(</span><span class="annot"><span class="hs-identifier hs-type">Strict</span></span><span class="hs-special">,</span><span> </span><span class="annot"><span class="hs-identifier hs-type">Type</span></span><span class="hs-special">)</span><span>
</span><span id="line-1099"></span><span>    </span><span id="local-6989586621679964906"><span class="annot"><span class="annottext">go :: (UnboundFieldDef, IsNullable) -&gt; BangType
</span><a href="#local-6989586621679964906"><span class="hs-identifier hs-var hs-var">go</span></a></span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">UnboundFieldDef
</span><span class="hs-identifier">_</span></span><span class="hs-special">,</span><span> </span><span class="annot"><a href="Database.Persist.Types.Base.html#Nullable"><span class="hs-identifier hs-type">Nullable</span></a></span><span> </span><span class="annot"><span class="annottext">WhyNullable
</span><span class="hs-identifier">_</span></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">|</span><span> </span><span class="annot"><span class="annottext">Bool -&gt; Bool
</span><span class="hs-identifier hs-var">not</span></span><span> </span><span class="annot"><span class="annottext">Bool
</span><a href="#local-6989586621679964902"><span class="hs-identifier hs-var">force</span></a></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">forall a. HasCallStack =&gt; String -&gt; a
</span><span class="hs-identifier hs-var">error</span></span><span> </span><span class="annot"><span class="annottext">String
</span><a href="#local-6989586621679964899"><span class="hs-identifier hs-var">nullErrMsg</span></a></span><span>
</span><span id="line-1100"></span><span>    </span><span class="annot"><a href="#local-6989586621679964906"><span class="hs-identifier hs-var">go</span></a></span><span> </span><span class="hs-special">(</span><span id="local-6989586621679964898"><span class="annot"><span class="annottext">UnboundFieldDef
</span><a href="#local-6989586621679964898"><span class="hs-identifier hs-var">fd</span></a></span></span><span class="hs-special">,</span><span> </span><span id="local-6989586621679964897"><span class="annot"><span class="annottext">IsNullable
</span><a href="#local-6989586621679964897"><span class="hs-identifier hs-var">y</span></a></span></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Bang
</span><a href="Database.Persist.TH.html#notStrict"><span class="hs-identifier hs-var">notStrict</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">MkPersistSettings
-&gt; EntityMap
-&gt; UnboundFieldDef
-&gt; Maybe Name
-&gt; Maybe IsNullable
-&gt; Type
</span><a href="Database.Persist.TH.html#maybeIdType"><span class="hs-identifier hs-var">maybeIdType</span></a></span><span> </span><span class="annot"><span class="annottext">MkPersistSettings
</span><a href="#local-6989586621679964915"><span class="hs-identifier hs-var">mps</span></a></span><span> </span><span class="annot"><span class="annottext">EntityMap
</span><a href="#local-6989586621679964914"><span class="hs-identifier hs-var">entityMap</span></a></span><span> </span><span class="annot"><span class="annottext">UnboundFieldDef
</span><a href="#local-6989586621679964898"><span class="hs-identifier hs-var">fd</span></a></span><span> </span><span class="annot"><span class="annottext">forall a. Maybe a
</span><span class="hs-identifier hs-var">Nothing</span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">forall a. a -&gt; Maybe a
</span><span class="hs-identifier hs-var">Just</span></span><span> </span><span class="annot"><span class="annottext">IsNullable
</span><a href="#local-6989586621679964897"><span class="hs-identifier hs-var">y</span></a></span><span class="hs-special">)</span><span class="hs-special">)</span><span>
</span><span id="line-1101"></span><span>
</span><span id="line-1102"></span><span>    </span><span class="annot"><a href="#local-6989586621679964904"><span class="hs-identifier hs-type">lookup3</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><span class="hs-identifier hs-type">Text</span></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-special">[</span><span class="annot"><a href="Database.Persist.Quasi.Internal.html#UnboundFieldDef"><span class="hs-identifier hs-type">UnboundFieldDef</span></a></span><span class="hs-special">]</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-special">(</span><span class="annot"><a href="Database.Persist.Quasi.Internal.html#UnboundFieldDef"><span class="hs-identifier hs-type">UnboundFieldDef</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><a href="Database.Persist.Types.Base.html#IsNullable"><span class="hs-identifier hs-type">IsNullable</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-1103"></span><span>    </span><span id="local-6989586621679964904"><span class="annot"><span class="annottext">lookup3 :: Text -&gt; [UnboundFieldDef] -&gt; (UnboundFieldDef, IsNullable)
</span><a href="#local-6989586621679964904"><span class="hs-identifier hs-var hs-var">lookup3</span></a></span></span><span> </span><span id="local-6989586621679964896"><span class="annot"><span class="annottext">Text
</span><a href="#local-6989586621679964896"><span class="hs-identifier hs-var">s</span></a></span></span><span> </span><span class="hs-special">[</span><span class="hs-special">]</span><span> </span><span class="hs-glyph">=</span><span>
</span><span id="line-1104"></span><span>        </span><span class="annot"><span class="annottext">forall a. HasCallStack =&gt; String -&gt; a
</span><span class="hs-identifier hs-var">error</span></span><span> </span><span class="annot"><span class="annottext">forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span> </span><span class="annot"><span class="annottext">Text -&gt; String
</span><span class="hs-identifier hs-var">unpack</span></span><span> </span><span class="annot"><span class="annottext">forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span> </span><span class="annot"><span class="annottext">Text
</span><span class="hs-string">&quot;Column not found: &quot;</span></span><span> </span><span class="annot"><span class="annottext">forall m. Monoid m =&gt; m -&gt; m -&gt; m
</span><a href="Database.Persist.TH.html#%2B%2B"><span class="hs-operator hs-var">++</span></a></span><span> </span><span class="annot"><span class="annottext">Text
</span><a href="#local-6989586621679964896"><span class="hs-identifier hs-var">s</span></a></span><span> </span><span class="annot"><span class="annottext">forall m. Monoid m =&gt; m -&gt; m -&gt; m
</span><a href="Database.Persist.TH.html#%2B%2B"><span class="hs-operator hs-var">++</span></a></span><span> </span><span class="annot"><span class="annottext">Text
</span><span class="hs-string">&quot; in unique &quot;</span></span><span> </span><span class="annot"><span class="annottext">forall m. Monoid m =&gt; m -&gt; m -&gt; m
</span><a href="Database.Persist.TH.html#%2B%2B"><span class="hs-operator hs-var">++</span></a></span><span> </span><span class="annot"><span class="annottext">ConstraintNameHS -&gt; Text
</span><a href="Database.Persist.Names.html#unConstraintNameHS"><span class="hs-identifier hs-var">unConstraintNameHS</span></a></span><span> </span><span class="annot"><span class="annottext">ConstraintNameHS
</span><a href="#local-6989586621679964911"><span class="hs-identifier hs-var">constr</span></a></span><span>
</span><span id="line-1105"></span><span>    </span><span class="annot"><a href="#local-6989586621679964904"><span class="hs-identifier hs-var">lookup3</span></a></span><span> </span><span id="local-6989586621679964894"><span class="annot"><span class="annottext">Text
</span><a href="#local-6989586621679964894"><span class="hs-identifier hs-var">x</span></a></span></span><span> </span><span class="hs-special">(</span><span id="local-6989586621679964893"><span class="annot"><span class="annottext">UnboundFieldDef
</span><a href="#local-6989586621679964893"><span class="hs-identifier hs-var">fd</span></a></span></span><span class="annot"><span class="hs-glyph hs-type">:</span></span><span id="local-6989586621679964892"><span class="annot"><span class="annottext">[UnboundFieldDef]
</span><a href="#local-6989586621679964892"><span class="hs-identifier hs-var">rest</span></a></span></span><span class="hs-special">)</span><span>
</span><span id="line-1106"></span><span>        </span><span class="hs-glyph">|</span><span> </span><span class="annot"><span class="annottext">Text
</span><a href="#local-6989586621679964894"><span class="hs-identifier hs-var">x</span></a></span><span> </span><span class="annot"><span class="annottext">forall a. Eq a =&gt; a -&gt; a -&gt; Bool
</span><span class="hs-operator hs-var">==</span></span><span> </span><span class="annot"><span class="annottext">FieldNameHS -&gt; Text
</span><a href="Database.Persist.Names.html#unFieldNameHS"><span class="hs-identifier hs-var">unFieldNameHS</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">UnboundFieldDef -&gt; FieldNameHS
</span><a href="Database.Persist.Quasi.Internal.html#unboundFieldNameHS"><span class="hs-identifier hs-var">unboundFieldNameHS</span></a></span><span> </span><span class="annot"><span class="annottext">UnboundFieldDef
</span><a href="#local-6989586621679964893"><span class="hs-identifier hs-var">fd</span></a></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">=</span><span>
</span><span id="line-1107"></span><span>            </span><span class="hs-special">(</span><span class="annot"><span class="annottext">UnboundFieldDef
</span><a href="#local-6989586621679964893"><span class="hs-identifier hs-var">fd</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">UnboundFieldDef -&gt; IsNullable
</span><a href="Database.Persist.Quasi.Internal.html#isUnboundFieldNullable"><span class="hs-identifier hs-var">isUnboundFieldNullable</span></a></span><span> </span><span class="annot"><span class="annottext">UnboundFieldDef
</span><a href="#local-6989586621679964893"><span class="hs-identifier hs-var">fd</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-1108"></span><span>        </span><span class="hs-glyph">|</span><span> </span><span class="annot"><span class="annottext">Bool
</span><span class="hs-identifier hs-var">otherwise</span></span><span> </span><span class="hs-glyph">=</span><span>
</span><span id="line-1109"></span><span>            </span><span class="annot"><span class="annottext">Text -&gt; [UnboundFieldDef] -&gt; (UnboundFieldDef, IsNullable)
</span><a href="#local-6989586621679964904"><span class="hs-identifier hs-var">lookup3</span></a></span><span> </span><span class="annot"><span class="annottext">Text
</span><a href="#local-6989586621679964894"><span class="hs-identifier hs-var">x</span></a></span><span> </span><span class="annot"><span class="annottext">[UnboundFieldDef]
</span><a href="#local-6989586621679964892"><span class="hs-identifier hs-var">rest</span></a></span><span>
</span><span id="line-1110"></span><span>
</span><span id="line-1111"></span><span>    </span><span id="local-6989586621679964899"><span class="annot"><span class="annottext">nullErrMsg :: String
</span><a href="#local-6989586621679964899"><span class="hs-identifier hs-var hs-var">nullErrMsg</span></a></span></span><span> </span><span class="hs-glyph">=</span><span>
</span><span id="line-1112"></span><span>      </span><span class="annot"><span class="annottext">forall a. Monoid a =&gt; [a] -&gt; a
</span><span class="hs-identifier hs-var">mconcat</span></span><span> </span><span class="hs-special">[</span><span> </span><span class="annot"><span class="annottext">String
</span><span class="hs-string">&quot;Error:  By default we disallow NULLables in an uniqueness &quot;</span></span><span>
</span><span id="line-1113"></span><span>              </span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">String
</span><span class="hs-string">&quot;constraint.  The semantics of how NULL interacts with those &quot;</span></span><span>
</span><span id="line-1114"></span><span>              </span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">String
</span><span class="hs-string">&quot;constraints is non-trivial:  two NULL values are not &quot;</span></span><span>
</span><span id="line-1115"></span><span>              </span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">String
</span><span class="hs-string">&quot;considered equal for the purposes of an uniqueness &quot;</span></span><span>
</span><span id="line-1116"></span><span>              </span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">String
</span><span class="hs-string">&quot;constraint.  If you understand this feature, it is possible &quot;</span></span><span>
</span><span id="line-1117"></span><span>              </span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">String
</span><span class="hs-string">&quot;to use it your advantage.    *** Use a \&quot;!force\&quot; attribute &quot;</span></span><span>
</span><span id="line-1118"></span><span>              </span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">String
</span><span class="hs-string">&quot;on the end of the line that defines your uniqueness &quot;</span></span><span>
</span><span id="line-1119"></span><span>              </span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">String
</span><span class="hs-string">&quot;constraint in order to disable this check. ***&quot;</span></span><span> </span><span class="hs-special">]</span><span>
</span><span id="line-1120"></span><span>
</span><span id="line-1121"></span><span class="hs-comment">-- | This function renders a Template Haskell 'Type' for an 'UnboundFieldDef'.</span><span>
</span><span id="line-1122"></span><span class="hs-comment">-- It takes care to respect the 'mpsGeneric' setting to render an Id faithfully,</span><span>
</span><span id="line-1123"></span><span class="hs-comment">-- and it also ensures that the generated Haskell type is 'Maybe' if the</span><span>
</span><span id="line-1124"></span><span class="hs-comment">-- database column has that attribute.</span><span>
</span><span id="line-1125"></span><span class="hs-comment">--</span><span>
</span><span id="line-1126"></span><span class="hs-comment">-- For a database schema with @'mpsGeneric' = False@, this is simple - it uses</span><span>
</span><span id="line-1127"></span><span class="hs-comment">-- the @ModelNameId@ type directly. This resolves just fine.</span><span>
</span><span id="line-1128"></span><span class="hs-comment">--</span><span>
</span><span id="line-1129"></span><span class="hs-comment">-- If 'mpsGeneric' is @True@, then we have to do something a bit more</span><span>
</span><span id="line-1130"></span><span class="hs-comment">-- complicated. We can't refer to a @ModelNameId@ directly, because that @Id@</span><span>
</span><span id="line-1131"></span><span class="hs-comment">-- alias hides the backend type variable. Instead, we need to refer to:</span><span>
</span><span id="line-1132"></span><span class="hs-comment">--</span><span>
</span><span id="line-1133"></span><span class="hs-comment">-- &gt; Key (ModelNameGeneric backend)</span><span>
</span><span id="line-1134"></span><span class="hs-comment">--</span><span>
</span><span id="line-1135"></span><span class="hs-comment">-- This means that the client code will need both the term @ModelNameId@ in</span><span>
</span><span id="line-1136"></span><span class="hs-comment">-- scope, as well as the @ModelNameGeneric@ constructor, despite the fact that</span><span>
</span><span id="line-1137"></span><span class="hs-comment">-- the @ModelNameId@ is the only term explicitly used (and imported).</span><span>
</span><span id="line-1138"></span><span class="hs-comment">--</span><span>
</span><span id="line-1139"></span><span class="hs-comment">-- However, we're not guaranteed to have @ModelName@ in scope - we've only</span><span>
</span><span id="line-1140"></span><span class="hs-comment">-- referenced @ModelNameId@ in code, and so code generation *should* work even</span><span>
</span><span id="line-1141"></span><span class="hs-comment">-- without this. Consider an explicit-style import:</span><span>
</span><span id="line-1142"></span><span class="hs-comment">--</span><span>
</span><span id="line-1143"></span><span class="hs-comment">-- @</span><span>
</span><span id="line-1144"></span><span class="hs-comment">-- import Model.Foo (FooId)</span><span>
</span><span id="line-1145"></span><span class="hs-comment">--</span><span>
</span><span id="line-1146"></span><span class="hs-comment">-- mkPersistWith sqlSettings $(discoverEntities) [persistLowerCase|</span><span>
</span><span id="line-1147"></span><span class="hs-comment">--   Bar</span><span>
</span><span id="line-1148"></span><span class="hs-comment">--     foo FooId</span><span>
</span><span id="line-1149"></span><span class="hs-comment">-- |]</span><span>
</span><span id="line-1150"></span><span class="hs-comment">-- @</span><span>
</span><span id="line-1151"></span><span class="hs-comment">--</span><span>
</span><span id="line-1152"></span><span class="hs-comment">-- This looks like it ought to work, but it would fail with @mpsGeneric@ being</span><span>
</span><span id="line-1153"></span><span class="hs-comment">-- enabled. One hacky work-around is to perform a @'lookupTypeName' :: String -&gt;</span><span>
</span><span id="line-1154"></span><span class="hs-comment">-- Q (Maybe Name)@ on the @&quot;ModelNameId&quot;@ type string. If the @Id@ is</span><span>
</span><span id="line-1155"></span><span class="hs-comment">-- a reference in the 'EntityMap' and @lookupTypeName@ returns @'Just' name@,</span><span>
</span><span id="line-1156"></span><span class="hs-comment">-- then that 'Name' contains the fully qualified information needed to use the</span><span>
</span><span id="line-1157"></span><span class="hs-comment">-- 'Name' without importing it at the client-site. Then we can perform a bit of</span><span>
</span><span id="line-1158"></span><span class="hs-comment">-- surgery on the 'Name' to strip the @Id@ suffix, turn it into a 'Type', and</span><span>
</span><span id="line-1159"></span><span class="hs-comment">-- apply the 'Key' constructor.</span><span>
</span><span id="line-1160"></span><span class="annot"><a href="Database.Persist.TH.html#maybeIdType"><span class="hs-identifier hs-type">maybeIdType</span></a></span><span>
</span><span id="line-1161"></span><span>    </span><span class="hs-glyph">::</span><span> </span><span class="annot"><a href="Database.Persist.TH.html#MkPersistSettings"><span class="hs-identifier hs-type">MkPersistSettings</span></a></span><span>
</span><span id="line-1162"></span><span>    </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="Database.Persist.TH.html#EntityMap"><span class="hs-identifier hs-type">EntityMap</span></a></span><span>
</span><span id="line-1163"></span><span>    </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="Database.Persist.Quasi.Internal.html#UnboundFieldDef"><span class="hs-identifier hs-type">UnboundFieldDef</span></a></span><span>
</span><span id="line-1164"></span><span>    </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="hs-identifier hs-type">Maybe</span></span><span> </span><span class="annot"><span class="hs-identifier hs-type">Name</span></span><span> </span><span class="hs-comment">-- ^ backend</span><span>
</span><span id="line-1165"></span><span>    </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="hs-identifier hs-type">Maybe</span></span><span> </span><span class="annot"><a href="Database.Persist.Types.Base.html#IsNullable"><span class="hs-identifier hs-type">IsNullable</span></a></span><span>
</span><span id="line-1166"></span><span>    </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="hs-identifier hs-type">Type</span></span><span>
</span><span id="line-1167"></span><span id="maybeIdType"><span class="annot"><span class="annottext">maybeIdType :: MkPersistSettings
-&gt; EntityMap
-&gt; UnboundFieldDef
-&gt; Maybe Name
-&gt; Maybe IsNullable
-&gt; Type
</span><a href="Database.Persist.TH.html#maybeIdType"><span class="hs-identifier hs-var hs-var">maybeIdType</span></a></span></span><span> </span><span id="local-6989586621679964882"><span class="annot"><span class="annottext">MkPersistSettings
</span><a href="#local-6989586621679964882"><span class="hs-identifier hs-var">mps</span></a></span></span><span> </span><span id="local-6989586621679964881"><span class="annot"><span class="annottext">EntityMap
</span><a href="#local-6989586621679964881"><span class="hs-identifier hs-var">entityMap</span></a></span></span><span> </span><span id="local-6989586621679964880"><span class="annot"><span class="annottext">UnboundFieldDef
</span><a href="#local-6989586621679964880"><span class="hs-identifier hs-var">fieldDef</span></a></span></span><span> </span><span id="local-6989586621679964879"><span class="annot"><span class="annottext">Maybe Name
</span><a href="#local-6989586621679964879"><span class="hs-identifier hs-var">mbackend</span></a></span></span><span> </span><span id="local-6989586621679964878"><span class="annot"><span class="annottext">Maybe IsNullable
</span><a href="#local-6989586621679964878"><span class="hs-identifier hs-var">mnull</span></a></span></span><span> </span><span class="hs-glyph">=</span><span>
</span><span id="line-1168"></span><span>    </span><span class="annot"><span class="annottext">Bool -&gt; Type -&gt; Type
</span><a href="Database.Persist.TH.html#maybeTyp"><span class="hs-identifier hs-var">maybeTyp</span></a></span><span> </span><span class="annot"><span class="annottext">Bool
</span><a href="#local-6989586621679964876"><span class="hs-identifier hs-var">mayNullable</span></a></span><span> </span><span class="annot"><span class="annottext">Type
</span><a href="#local-6989586621679964875"><span class="hs-identifier hs-var">idType</span></a></span><span>
</span><span id="line-1169"></span><span>  </span><span class="hs-keyword">where</span><span>
</span><span id="line-1170"></span><span>    </span><span id="local-6989586621679964876"><span class="annot"><span class="annottext">mayNullable :: Bool
</span><a href="#local-6989586621679964876"><span class="hs-identifier hs-var hs-var">mayNullable</span></a></span></span><span> </span><span class="hs-glyph">=</span><span>
</span><span id="line-1171"></span><span>        </span><span class="hs-keyword">case</span><span> </span><span class="annot"><span class="annottext">Maybe IsNullable
</span><a href="#local-6989586621679964878"><span class="hs-identifier hs-var">mnull</span></a></span><span> </span><span class="hs-keyword">of</span><span>
</span><span id="line-1172"></span><span>            </span><span class="annot"><span class="hs-identifier hs-type">Just</span></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="Database.Persist.Types.Base.html#Nullable"><span class="hs-identifier hs-type">Nullable</span></a></span><span> </span><span class="annot"><span class="annottext">WhyNullable
</span><a href="Database.Persist.Types.Base.html#ByMaybeAttr"><span class="hs-identifier hs-var">ByMaybeAttr</span></a></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">-&gt;</span><span>
</span><span id="line-1173"></span><span>                </span><span class="annot"><span class="annottext">Bool
</span><span class="hs-identifier hs-var">True</span></span><span>
</span><span id="line-1174"></span><span>            </span><span class="annot"><span class="annottext">Maybe IsNullable
</span><span class="hs-identifier">_</span></span><span> </span><span class="hs-glyph">-&gt;</span><span>
</span><span id="line-1175"></span><span>                </span><span class="annot"><span class="annottext">UnboundFieldDef -&gt; Bool
</span><a href="Database.Persist.TH.html#maybeNullable"><span class="hs-identifier hs-var">maybeNullable</span></a></span><span> </span><span class="annot"><span class="annottext">UnboundFieldDef
</span><a href="#local-6989586621679964880"><span class="hs-identifier hs-var">fieldDef</span></a></span><span>
</span><span id="line-1176"></span><span>    </span><span id="local-6989586621679964875"><span class="annot"><span class="annottext">idType :: Type
</span><a href="#local-6989586621679964875"><span class="hs-identifier hs-var hs-var">idType</span></a></span></span><span> </span><span class="hs-glyph">=</span><span>
</span><span id="line-1177"></span><span>        </span><span class="annot"><span class="annottext">forall a. a -&gt; Maybe a -&gt; a
</span><span class="hs-identifier hs-var">fromMaybe</span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">FieldType -&gt; Type
</span><a href="Database.Persist.TH.html#ftToType"><span class="hs-identifier hs-var">ftToType</span></a></span><span> </span><span class="annot"><span class="annottext">forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span> </span><span class="annot"><span class="annottext">UnboundFieldDef -&gt; FieldType
</span><a href="Database.Persist.Quasi.Internal.html#unboundFieldType"><span class="hs-identifier hs-var">unboundFieldType</span></a></span><span> </span><span class="annot"><span class="annottext">UnboundFieldDef
</span><a href="#local-6989586621679964880"><span class="hs-identifier hs-var">fieldDef</span></a></span><span class="hs-special">)</span><span> </span><span class="annot"><span class="annottext">forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span> </span><span class="hs-keyword">do</span><span>
</span><span id="line-1178"></span><span>            </span><span id="local-6989586621679964873"><span class="annot"><span class="annottext">EntityNameHS
</span><a href="#local-6989586621679964873"><span class="hs-identifier hs-var">typ</span></a></span></span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">EntityMap -&gt; UnboundFieldDef -&gt; Maybe EntityNameHS
</span><a href="Database.Persist.TH.html#extractForeignRef"><span class="hs-identifier hs-var">extractForeignRef</span></a></span><span> </span><span class="annot"><span class="annottext">EntityMap
</span><a href="#local-6989586621679964881"><span class="hs-identifier hs-var">entityMap</span></a></span><span> </span><span class="annot"><span class="annottext">UnboundFieldDef
</span><a href="#local-6989586621679964880"><span class="hs-identifier hs-var">fieldDef</span></a></span><span>
</span><span id="line-1179"></span><span>            </span><span class="annot"><span class="annottext">forall (f :: * -&gt; *). Alternative f =&gt; Bool -&gt; f ()
</span><span class="hs-identifier hs-var">guard</span></span><span> </span><span class="hs-special">(</span><span class="hs-special">(</span><span class="annot"><span class="annottext">MkPersistSettings -&gt; Bool
</span><a href="Database.Persist.TH.html#mpsGeneric"><span class="hs-identifier hs-var">mpsGeneric</span></a></span><span> </span><span class="annot"><span class="annottext">MkPersistSettings
</span><a href="#local-6989586621679964882"><span class="hs-identifier hs-var">mps</span></a></span><span class="hs-special">)</span><span class="hs-special">)</span><span>
</span><span id="line-1180"></span><span>            </span><span class="annot"><span class="annottext">forall (f :: * -&gt; *) a. Applicative f =&gt; a -&gt; f a
</span><span class="hs-identifier hs-var">pure</span></span><span> </span><span class="annot"><span class="annottext">forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span>
</span><span id="line-1181"></span><span>                </span><span class="annot"><span class="annottext">Name -&gt; Type
</span><span class="hs-identifier hs-var">ConT</span></span><span> </span><span class="hs-special">''</span><span class="hs-identifier">Key</span><span>
</span><span id="line-1182"></span><span>                </span><span class="annot"><span class="annottext">Type -&gt; Type -&gt; Type
</span><span class="hs-operator hs-var">`AppT`</span></span><span> </span><span class="annot"><span class="annottext">MkPersistSettings -&gt; EntityNameHS -&gt; Type -&gt; Type
</span><a href="Database.Persist.TH.html#genericDataType"><span class="hs-identifier hs-var">genericDataType</span></a></span><span> </span><span class="annot"><span class="annottext">MkPersistSettings
</span><a href="#local-6989586621679964882"><span class="hs-identifier hs-var">mps</span></a></span><span> </span><span class="annot"><span class="annottext">EntityNameHS
</span><a href="#local-6989586621679964873"><span class="hs-identifier hs-var">typ</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Name -&gt; Type
</span><span class="hs-identifier hs-var">VarT</span></span><span> </span><span class="annot"><span class="annottext">forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span> </span><span class="annot"><span class="annottext">forall a. a -&gt; Maybe a -&gt; a
</span><span class="hs-identifier hs-var">fromMaybe</span></span><span> </span><span class="annot"><span class="annottext">Name
</span><a href="Database.Persist.TH.html#backendName"><span class="hs-identifier hs-var">backendName</span></a></span><span> </span><span class="annot"><span class="annottext">Maybe Name
</span><a href="#local-6989586621679964879"><span class="hs-identifier hs-var">mbackend</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-1183"></span><span>
</span><span id="line-1184"></span><span>    </span><span class="hs-comment">-- TODO: if we keep mpsGeneric, this needs to check 'mpsGeneric' and then</span><span>
</span><span id="line-1185"></span><span>    </span><span class="hs-comment">-- append Generic to the model name, probably</span><span>
</span><span id="line-1186"></span><span>    </span><span class="annot"><a href="#local-6989586621679964871"><span class="hs-identifier hs-type">_removeIdFromTypeSuffix</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><span class="hs-identifier hs-type">Name</span></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="hs-identifier hs-type">Type</span></span><span>
</span><span id="line-1187"></span><span>    </span><span id="local-6989586621679964871"><span class="annot"><span class="annottext">_removeIdFromTypeSuffix :: Name -&gt; Type
</span><a href="#local-6989586621679964871"><span class="hs-identifier hs-var hs-var">_removeIdFromTypeSuffix</span></a></span></span><span> </span><span id="local-6989586621679964870"><span class="annot"><span class="annottext">oldName :: Name
</span><a href="#local-6989586621679964870"><span class="hs-identifier hs-var">oldName</span></a></span></span><span class="hs-glyph">@</span><span class="hs-special">(</span><span class="annot"><span class="hs-identifier hs-type">Name</span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="hs-identifier hs-type">OccName</span></span><span> </span><span id="local-6989586621679964867"><span class="annot"><span class="annottext">String
</span><a href="#local-6989586621679964867"><span class="hs-identifier hs-var">nm</span></a></span></span><span class="hs-special">)</span><span> </span><span id="local-6989586621679964866"><span class="annot"><span class="annottext">NameFlavour
</span><a href="#local-6989586621679964866"><span class="hs-identifier hs-var">nameFlavor</span></a></span></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">=</span><span>
</span><span id="line-1188"></span><span>        </span><span class="hs-keyword">case</span><span> </span><span class="annot"><span class="annottext">Text -&gt; Text -&gt; Maybe Text
</span><span class="hs-identifier hs-var">stripSuffix</span></span><span> </span><span class="annot"><span class="annottext">Text
</span><span class="hs-string">&quot;Id&quot;</span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">String -&gt; Text
</span><span class="hs-identifier hs-var">T.pack</span></span><span> </span><span class="annot"><span class="annottext">String
</span><a href="#local-6989586621679964867"><span class="hs-identifier hs-var">nm</span></a></span><span class="hs-special">)</span><span> </span><span class="hs-keyword">of</span><span>
</span><span id="line-1189"></span><span>            </span><span class="annot"><span class="annottext">Maybe Text
</span><span class="hs-identifier hs-var">Nothing</span></span><span> </span><span class="hs-glyph">-&gt;</span><span>
</span><span id="line-1190"></span><span>                </span><span class="annot"><span class="annottext">Name -&gt; Type
</span><span class="hs-identifier hs-var">ConT</span></span><span> </span><span class="annot"><span class="annottext">Name
</span><a href="#local-6989586621679964870"><span class="hs-identifier hs-var">oldName</span></a></span><span>
</span><span id="line-1191"></span><span>            </span><span class="annot"><span class="hs-identifier hs-type">Just</span></span><span> </span><span id="local-6989586621679964865"><span class="annot"><span class="annottext">Text
</span><a href="#local-6989586621679964865"><span class="hs-identifier hs-var">name</span></a></span></span><span> </span><span class="hs-glyph">-&gt;</span><span>
</span><span id="line-1192"></span><span>                </span><span class="annot"><span class="annottext">Name -&gt; Type
</span><span class="hs-identifier hs-var">ConT</span></span><span> </span><span class="hs-special">''</span><span class="hs-identifier">Key</span><span>
</span><span id="line-1193"></span><span>                </span><span class="annot"><span class="annottext">Type -&gt; Type -&gt; Type
</span><span class="hs-operator hs-var">`AppT`</span></span><span> </span><span class="hs-keyword">do</span><span>
</span><span id="line-1194"></span><span>                    </span><span class="annot"><span class="annottext">Name -&gt; Type
</span><span class="hs-identifier hs-var">ConT</span></span><span> </span><span class="annot"><span class="annottext">forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span> </span><span class="annot"><span class="annottext">OccName -&gt; NameFlavour -&gt; Name
</span><span class="hs-identifier hs-var">Name</span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">String -&gt; OccName
</span><span class="hs-identifier hs-var">OccName</span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Text -&gt; String
</span><span class="hs-identifier hs-var">T.unpack</span></span><span> </span><span class="annot"><span class="annottext">Text
</span><a href="#local-6989586621679964865"><span class="hs-identifier hs-var">name</span></a></span><span class="hs-special">)</span><span class="hs-special">)</span><span> </span><span class="annot"><span class="annottext">NameFlavour
</span><a href="#local-6989586621679964866"><span class="hs-identifier hs-var">nameFlavor</span></a></span><span>
</span><span id="line-1195"></span><span>
</span><span id="line-1196"></span><span>    </span><span class="hs-comment">-- | TODO: if we keep mpsGeneric, let's incorporate this behavior here, so</span><span>
</span><span id="line-1197"></span><span>    </span><span class="hs-comment">-- end users don't need to import the constructor type as well as the id type</span><span>
</span><span id="line-1198"></span><span>    </span><span class="hs-comment">--</span><span>
</span><span id="line-1199"></span><span>    </span><span class="hs-comment">-- Returns 'Nothing' if the given text does not appear to be a table reference.</span><span>
</span><span id="line-1200"></span><span>    </span><span class="hs-comment">-- In that case, do the usual thing for generating a type name.</span><span>
</span><span id="line-1201"></span><span>    </span><span class="hs-comment">--</span><span>
</span><span id="line-1202"></span><span>    </span><span class="hs-comment">-- Returns a @Just typ@ if the text appears to be a model name, and if the</span><span>
</span><span id="line-1203"></span><span>    </span><span class="hs-comment">-- @ModelId@ type is in scope. The 'Type' is a fully qualified reference to</span><span>
</span><span id="line-1204"></span><span>    </span><span class="hs-comment">-- @'Key' ModelName@ such that end users won't have to import it directly.</span><span>
</span><span id="line-1205"></span><span>    </span><span class="annot"><a href="#local-6989586621679964864"><span class="hs-identifier hs-type">_lookupReferencedTable</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><a href="Database.Persist.TH.html#EntityMap"><span class="hs-identifier hs-type">EntityMap</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="hs-identifier hs-type">Text</span></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="hs-identifier hs-type">Q</span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="hs-identifier hs-type">Maybe</span></span><span> </span><span class="annot"><span class="hs-identifier hs-type">Type</span></span><span class="hs-special">)</span><span>
</span><span id="line-1206"></span><span>    </span><span id="local-6989586621679964864"><span class="annot"><span class="annottext">_lookupReferencedTable :: EntityMap -&gt; Text -&gt; Q (Maybe Type)
</span><a href="#local-6989586621679964864"><span class="hs-identifier hs-var hs-var">_lookupReferencedTable</span></a></span></span><span> </span><span id="local-6989586621679964863"><span class="annot"><span class="annottext">EntityMap
</span><a href="#local-6989586621679964863"><span class="hs-identifier hs-var">em</span></a></span></span><span> </span><span id="local-6989586621679964862"><span class="annot"><span class="annottext">Text
</span><a href="#local-6989586621679964862"><span class="hs-identifier hs-var">fieldTypeText</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-keyword">do</span><span>
</span><span id="line-1207"></span><span>        </span><span class="hs-keyword">let</span><span>
</span><span id="line-1208"></span><span>            </span><span id="local-6989586621679964861"><span class="annot"><span class="annottext">mmodelIdString :: Maybe String
</span><a href="#local-6989586621679964861"><span class="hs-identifier hs-var hs-var">mmodelIdString</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-keyword">do</span><span>
</span><span id="line-1209"></span><span>                </span><span id="local-6989586621679964860"><span class="annot"><span class="annottext">Text
</span><a href="#local-6989586621679964860"><span class="hs-identifier hs-var">fieldTypeNoId</span></a></span></span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">Text -&gt; Text -&gt; Maybe Text
</span><span class="hs-identifier hs-var">stripSuffix</span></span><span> </span><span class="annot"><span class="annottext">Text
</span><span class="hs-string">&quot;Id&quot;</span></span><span> </span><span class="annot"><span class="annottext">Text
</span><a href="#local-6989586621679964862"><span class="hs-identifier hs-var">fieldTypeText</span></a></span><span>
</span><span id="line-1210"></span><span>                </span><span class="annot"><span class="annottext">UnboundEntityDef
</span><span class="hs-identifier">_</span></span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">forall k a. Ord k =&gt; k -&gt; Map k a -&gt; Maybe a
</span><span class="hs-identifier hs-var">M.lookup</span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Text -&gt; EntityNameHS
</span><a href="Database.Persist.Names.html#EntityNameHS"><span class="hs-identifier hs-var">EntityNameHS</span></a></span><span> </span><span class="annot"><span class="annottext">Text
</span><a href="#local-6989586621679964860"><span class="hs-identifier hs-var">fieldTypeNoId</span></a></span><span class="hs-special">)</span><span> </span><span class="annot"><span class="annottext">EntityMap
</span><a href="#local-6989586621679964863"><span class="hs-identifier hs-var">em</span></a></span><span>
</span><span id="line-1211"></span><span>                </span><span class="annot"><span class="annottext">forall (f :: * -&gt; *) a. Applicative f =&gt; a -&gt; f a
</span><span class="hs-identifier hs-var">pure</span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Text -&gt; String
</span><span class="hs-identifier hs-var">T.unpack</span></span><span> </span><span class="annot"><span class="annottext">Text
</span><a href="#local-6989586621679964862"><span class="hs-identifier hs-var">fieldTypeText</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-1212"></span><span>        </span><span class="hs-keyword">case</span><span> </span><span class="annot"><span class="annottext">Maybe String
</span><a href="#local-6989586621679964861"><span class="hs-identifier hs-var">mmodelIdString</span></a></span><span> </span><span class="hs-keyword">of</span><span>
</span><span id="line-1213"></span><span>            </span><span class="annot"><span class="annottext">Maybe String
</span><span class="hs-identifier hs-var">Nothing</span></span><span> </span><span class="hs-glyph">-&gt;</span><span>
</span><span id="line-1214"></span><span>                </span><span class="annot"><span class="annottext">forall (f :: * -&gt; *) a. Applicative f =&gt; a -&gt; f a
</span><span class="hs-identifier hs-var">pure</span></span><span> </span><span class="annot"><span class="annottext">forall a. Maybe a
</span><span class="hs-identifier hs-var">Nothing</span></span><span>
</span><span id="line-1215"></span><span>            </span><span class="annot"><span class="hs-identifier hs-type">Just</span></span><span> </span><span id="local-6989586621679964859"><span class="annot"><span class="annottext">String
</span><a href="#local-6989586621679964859"><span class="hs-identifier hs-var">modelIdString</span></a></span></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-keyword">do</span><span>
</span><span id="line-1216"></span><span>                </span><span id="local-6989586621679964858"><span class="annot"><span class="annottext">Maybe Name
</span><a href="#local-6989586621679964858"><span class="hs-identifier hs-var">mIdName</span></a></span></span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">String -&gt; Q (Maybe Name)
</span><span class="hs-identifier hs-var">lookupTypeName</span></span><span> </span><span class="annot"><span class="annottext">String
</span><a href="#local-6989586621679964859"><span class="hs-identifier hs-var">modelIdString</span></a></span><span>
</span><span id="line-1217"></span><span>                </span><span class="annot"><span class="annottext">forall (f :: * -&gt; *) a. Applicative f =&gt; a -&gt; f a
</span><span class="hs-identifier hs-var">pure</span></span><span> </span><span class="annot"><span class="annottext">forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span> </span><span class="annot"><span class="annottext">forall (f :: * -&gt; *) a b. Functor f =&gt; (a -&gt; b) -&gt; f a -&gt; f b
</span><span class="hs-identifier hs-var">fmap</span></span><span> </span><span class="annot"><span class="annottext">Name -&gt; Type
</span><a href="#local-6989586621679964871"><span class="hs-identifier hs-var">_removeIdFromTypeSuffix</span></a></span><span> </span><span class="annot"><span class="annottext">Maybe Name
</span><a href="#local-6989586621679964858"><span class="hs-identifier hs-var">mIdName</span></a></span><span>
</span><span id="line-1218"></span><span>
</span><span id="line-1219"></span><span>    </span><span class="annot"><a href="#local-6989586621679964857"><span class="hs-identifier hs-type">_fieldNameEndsWithId</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><a href="Database.Persist.Quasi.Internal.html#UnboundFieldDef"><span class="hs-identifier hs-type">UnboundFieldDef</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="hs-identifier hs-type">Maybe</span></span><span> </span><span class="annot"><span class="hs-identifier hs-type">String</span></span><span>
</span><span id="line-1220"></span><span>    </span><span id="local-6989586621679964857"><span class="annot"><span class="annottext">_fieldNameEndsWithId :: UnboundFieldDef -&gt; Maybe String
</span><a href="#local-6989586621679964857"><span class="hs-identifier hs-var hs-var">_fieldNameEndsWithId</span></a></span></span><span> </span><span id="local-6989586621679964856"><span class="annot"><span class="annottext">UnboundFieldDef
</span><a href="#local-6989586621679964856"><span class="hs-identifier hs-var">ufd</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">FieldType -&gt; Maybe String
</span><a href="#local-6989586621679964855"><span class="hs-identifier hs-var">go</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">UnboundFieldDef -&gt; FieldType
</span><a href="Database.Persist.Quasi.Internal.html#unboundFieldType"><span class="hs-identifier hs-var">unboundFieldType</span></a></span><span> </span><span class="annot"><span class="annottext">UnboundFieldDef
</span><a href="#local-6989586621679964856"><span class="hs-identifier hs-var">ufd</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-1221"></span><span>      </span><span class="hs-keyword">where</span><span>
</span><span id="line-1222"></span><span>        </span><span id="local-6989586621679964855"><span class="annot"><span class="annottext">go :: FieldType -&gt; Maybe String
</span><a href="#local-6989586621679964855"><span class="hs-identifier hs-var hs-var">go</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-glyph">\</span><span class="hs-glyph">case</span><span>
</span><span id="line-1223"></span><span>            </span><span class="annot"><a href="Database.Persist.Types.Base.html#FTTypeCon"><span class="hs-identifier hs-type">FTTypeCon</span></a></span><span> </span><span id="local-6989586621679964846"><span class="annot"><span class="annottext">Maybe Text
</span><a href="#local-6989586621679964846"><span class="hs-identifier hs-var">mmodule</span></a></span></span><span> </span><span id="local-6989586621679964845"><span class="annot"><span class="annottext">Text
</span><a href="#local-6989586621679964845"><span class="hs-identifier hs-var">name</span></a></span></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-keyword">do</span><span>
</span><span id="line-1224"></span><span>                </span><span id="local-6989586621679964844"><span class="annot"><span class="annottext">Text
</span><a href="#local-6989586621679964844"><span class="hs-identifier hs-var">a</span></a></span></span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">Text -&gt; Text -&gt; Maybe Text
</span><span class="hs-identifier hs-var">stripSuffix</span></span><span> </span><span class="annot"><span class="annottext">Text
</span><span class="hs-string">&quot;Id&quot;</span></span><span> </span><span class="annot"><span class="annottext">Text
</span><a href="#local-6989586621679964845"><span class="hs-identifier hs-var">name</span></a></span><span>
</span><span id="line-1225"></span><span>                </span><span class="annot"><span class="annottext">forall (f :: * -&gt; *) a. Applicative f =&gt; a -&gt; f a
</span><span class="hs-identifier hs-var">pure</span></span><span> </span><span class="annot"><span class="annottext">forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span>
</span><span id="line-1226"></span><span>                    </span><span class="annot"><span class="annottext">Text -&gt; String
</span><span class="hs-identifier hs-var">T.unpack</span></span><span> </span><span class="annot"><span class="annottext">forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span> </span><span class="annot"><span class="annottext">forall a. Monoid a =&gt; [a] -&gt; a
</span><span class="hs-identifier hs-var">mconcat</span></span><span>
</span><span id="line-1227"></span><span>                        </span><span class="hs-special">[</span><span> </span><span class="hs-keyword">case</span><span> </span><span class="annot"><span class="annottext">Maybe Text
</span><a href="#local-6989586621679964846"><span class="hs-identifier hs-var">mmodule</span></a></span><span> </span><span class="hs-keyword">of</span><span>
</span><span id="line-1228"></span><span>                            </span><span class="annot"><span class="annottext">Maybe Text
</span><span class="hs-identifier hs-var">Nothing</span></span><span> </span><span class="hs-glyph">-&gt;</span><span>
</span><span id="line-1229"></span><span>                                </span><span class="annot"><span class="annottext">Text
</span><span class="hs-string">&quot;&quot;</span></span><span>
</span><span id="line-1230"></span><span>                            </span><span class="annot"><span class="hs-identifier hs-type">Just</span></span><span> </span><span id="local-6989586621679964843"><span class="annot"><span class="annottext">Text
</span><a href="#local-6989586621679964843"><span class="hs-identifier hs-var">m</span></a></span></span><span> </span><span class="hs-glyph">-&gt;</span><span>
</span><span id="line-1231"></span><span>                                </span><span class="annot"><span class="annottext">forall a. Monoid a =&gt; [a] -&gt; a
</span><span class="hs-identifier hs-var">mconcat</span></span><span> </span><span class="hs-special">[</span><span class="annot"><span class="annottext">Text
</span><a href="#local-6989586621679964843"><span class="hs-identifier hs-var">m</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">Text
</span><span class="hs-string">&quot;.&quot;</span></span><span class="hs-special">]</span><span>
</span><span id="line-1232"></span><span>                        </span><span class="hs-special">,</span><span>  </span><span class="annot"><span class="annottext">Text
</span><a href="#local-6989586621679964844"><span class="hs-identifier hs-var">a</span></a></span><span>
</span><span id="line-1233"></span><span>                        </span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">Text
</span><span class="hs-string">&quot;Id&quot;</span></span><span>
</span><span id="line-1234"></span><span>                        </span><span class="hs-special">]</span><span>
</span><span id="line-1235"></span><span>            </span><span class="annot"><span class="annottext">FieldType
</span><span class="hs-identifier">_</span></span><span> </span><span class="hs-glyph">-&gt;</span><span>
</span><span id="line-1236"></span><span>                </span><span class="annot"><span class="annottext">forall a. Maybe a
</span><span class="hs-identifier hs-var">Nothing</span></span><span>
</span><span id="line-1237"></span><span>
</span><span id="line-1238"></span><span class="annot"><a href="Database.Persist.TH.html#backendDataType"><span class="hs-identifier hs-type">backendDataType</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><a href="Database.Persist.TH.html#MkPersistSettings"><span class="hs-identifier hs-type">MkPersistSettings</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="hs-identifier hs-type">Type</span></span><span>
</span><span id="line-1239"></span><span id="backendDataType"><span class="annot"><span class="annottext">backendDataType :: MkPersistSettings -&gt; Type
</span><a href="Database.Persist.TH.html#backendDataType"><span class="hs-identifier hs-var hs-var">backendDataType</span></a></span></span><span> </span><span id="local-6989586621679964841"><span class="annot"><span class="annottext">MkPersistSettings
</span><a href="#local-6989586621679964841"><span class="hs-identifier hs-var">mps</span></a></span></span><span>
</span><span id="line-1240"></span><span>    </span><span class="hs-glyph">|</span><span> </span><span class="annot"><span class="annottext">MkPersistSettings -&gt; Bool
</span><a href="Database.Persist.TH.html#mpsGeneric"><span class="hs-identifier hs-var">mpsGeneric</span></a></span><span> </span><span class="annot"><span class="annottext">MkPersistSettings
</span><a href="#local-6989586621679964841"><span class="hs-identifier hs-var">mps</span></a></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">Type
</span><a href="Database.Persist.TH.html#backendT"><span class="hs-identifier hs-var">backendT</span></a></span><span>
</span><span id="line-1241"></span><span>    </span><span class="hs-glyph">|</span><span> </span><span class="annot"><span class="annottext">Bool
</span><span class="hs-identifier hs-var">otherwise</span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">MkPersistSettings -&gt; Type
</span><a href="Database.Persist.TH.html#mpsBackend"><span class="hs-identifier hs-var">mpsBackend</span></a></span><span> </span><span class="annot"><span class="annottext">MkPersistSettings
</span><a href="#local-6989586621679964841"><span class="hs-identifier hs-var">mps</span></a></span><span>
</span><span id="line-1242"></span><span>
</span><span id="line-1243"></span><span class="hs-comment">-- | TODO:</span><span>
</span><span id="line-1244"></span><span class="hs-comment">--</span><span>
</span><span id="line-1245"></span><span class="hs-comment">-- if we keep mpsGeneric</span><span>
</span><span id="line-1246"></span><span class="hs-comment">-- then</span><span>
</span><span id="line-1247"></span><span class="hs-comment">--      let's make this fully qualify the generic name</span><span>
</span><span id="line-1248"></span><span class="hs-comment">-- else</span><span>
</span><span id="line-1249"></span><span class="hs-comment">--      let's delete it</span><span>
</span><span id="line-1250"></span><span class="annot"><a href="Database.Persist.TH.html#genericDataType"><span class="hs-identifier hs-type">genericDataType</span></a></span><span>
</span><span id="line-1251"></span><span>    </span><span class="hs-glyph">::</span><span> </span><span class="annot"><a href="Database.Persist.TH.html#MkPersistSettings"><span class="hs-identifier hs-type">MkPersistSettings</span></a></span><span>
</span><span id="line-1252"></span><span>    </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="Database.Persist.Names.html#EntityNameHS"><span class="hs-identifier hs-type">EntityNameHS</span></a></span><span>
</span><span id="line-1253"></span><span>    </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="hs-identifier hs-type">Type</span></span><span> </span><span class="hs-comment">-- ^ backend</span><span>
</span><span id="line-1254"></span><span>    </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="hs-identifier hs-type">Type</span></span><span>
</span><span id="line-1255"></span><span id="genericDataType"><span class="annot"><span class="annottext">genericDataType :: MkPersistSettings -&gt; EntityNameHS -&gt; Type -&gt; Type
</span><a href="Database.Persist.TH.html#genericDataType"><span class="hs-identifier hs-var hs-var">genericDataType</span></a></span></span><span> </span><span id="local-6989586621679964840"><span class="annot"><span class="annottext">MkPersistSettings
</span><a href="#local-6989586621679964840"><span class="hs-identifier hs-var">mps</span></a></span></span><span> </span><span id="local-6989586621679964839"><span class="annot"><span class="annottext">EntityNameHS
</span><a href="#local-6989586621679964839"><span class="hs-identifier hs-var">name</span></a></span></span><span> </span><span id="local-6989586621679964838"><span class="annot"><span class="annottext">Type
</span><a href="#local-6989586621679964838"><span class="hs-identifier hs-var">backend</span></a></span></span><span>
</span><span id="line-1256"></span><span>    </span><span class="hs-glyph">|</span><span> </span><span class="annot"><span class="annottext">MkPersistSettings -&gt; Bool
</span><a href="Database.Persist.TH.html#mpsGeneric"><span class="hs-identifier hs-var">mpsGeneric</span></a></span><span> </span><span class="annot"><span class="annottext">MkPersistSettings
</span><a href="#local-6989586621679964840"><span class="hs-identifier hs-var">mps</span></a></span><span> </span><span class="hs-glyph">=</span><span>
</span><span id="line-1257"></span><span>        </span><span class="annot"><span class="annottext">Name -&gt; Type
</span><span class="hs-identifier hs-var">ConT</span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">EntityNameHS -&gt; Name
</span><a href="Database.Persist.TH.html#mkEntityNameHSGenericName"><span class="hs-identifier hs-var">mkEntityNameHSGenericName</span></a></span><span> </span><span class="annot"><span class="annottext">EntityNameHS
</span><a href="#local-6989586621679964839"><span class="hs-identifier hs-var">name</span></a></span><span class="hs-special">)</span><span> </span><span class="annot"><span class="annottext">Type -&gt; Type -&gt; Type
</span><span class="hs-operator hs-var">`AppT`</span></span><span> </span><span class="annot"><span class="annottext">Type
</span><a href="#local-6989586621679964838"><span class="hs-identifier hs-var">backend</span></a></span><span>
</span><span id="line-1258"></span><span>    </span><span class="hs-glyph">|</span><span> </span><span class="annot"><span class="annottext">Bool
</span><span class="hs-identifier hs-var">otherwise</span></span><span> </span><span class="hs-glyph">=</span><span>
</span><span id="line-1259"></span><span>        </span><span class="annot"><span class="annottext">Name -&gt; Type
</span><span class="hs-identifier hs-var">ConT</span></span><span> </span><span class="annot"><span class="annottext">forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span> </span><span class="annot"><span class="annottext">EntityNameHS -&gt; Name
</span><a href="Database.Persist.TH.html#mkEntityNameHSName"><span class="hs-identifier hs-var">mkEntityNameHSName</span></a></span><span> </span><span class="annot"><span class="annottext">EntityNameHS
</span><a href="#local-6989586621679964839"><span class="hs-identifier hs-var">name</span></a></span><span>
</span><span id="line-1260"></span><span>
</span><span id="line-1261"></span><span class="annot"><a href="Database.Persist.TH.html#degen"><span class="hs-identifier hs-type">degen</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="hs-special">[</span><span class="annot"><span class="hs-identifier hs-type">Clause</span></span><span class="hs-special">]</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-special">[</span><span class="annot"><span class="hs-identifier hs-type">Clause</span></span><span class="hs-special">]</span><span>
</span><span id="line-1262"></span><span id="degen"><span class="annot"><span class="annottext">degen :: [Clause] -&gt; [Clause]
</span><a href="Database.Persist.TH.html#degen"><span class="hs-identifier hs-var hs-var">degen</span></a></span></span><span> </span><span class="hs-special">[</span><span class="hs-special">]</span><span> </span><span class="hs-glyph">=</span><span>
</span><span id="line-1263"></span><span>    </span><span class="hs-keyword">let</span><span> </span><span id="local-6989586621679964834"><span class="annot"><span class="annottext">err :: Exp
</span><a href="#local-6989586621679964834"><span class="hs-identifier hs-var hs-var">err</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">Name -&gt; Exp
</span><span class="hs-identifier hs-var">VarE</span></span><span> </span><span class="hs-special">'</span><span class="hs-identifier">error</span><span> </span><span class="annot"><span class="annottext">Exp -&gt; Exp -&gt; Exp
</span><span class="hs-operator hs-var">`AppE`</span></span><span> </span><span class="annot"><span class="annottext">Lit -&gt; Exp
</span><span class="hs-identifier hs-var">LitE</span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">String -&gt; Lit
</span><span class="hs-identifier hs-var">StringL</span></span><span>
</span><span id="line-1264"></span><span>                </span><span class="annot"><span class="annottext">String
</span><span class="hs-string">&quot;Degenerate case, should never happen&quot;</span></span><span class="hs-special">)</span><span>
</span><span id="line-1265"></span><span>     </span><span class="hs-keyword">in</span><span> </span><span class="hs-special">[</span><span class="annot"><span class="annottext">[Pat] -&gt; Exp -&gt; Clause
</span><a href="Database.Persist.TH.html#normalClause"><span class="hs-identifier hs-var">normalClause</span></a></span><span> </span><span class="hs-special">[</span><span class="annot"><span class="annottext">Pat
</span><span class="hs-identifier hs-var">WildP</span></span><span class="hs-special">]</span><span> </span><span class="annot"><span class="annottext">Exp
</span><a href="#local-6989586621679964834"><span class="hs-identifier hs-var">err</span></a></span><span class="hs-special">]</span><span>
</span><span id="line-1266"></span><span class="annot"><a href="Database.Persist.TH.html#degen"><span class="hs-identifier hs-var">degen</span></a></span><span> </span><span id="local-6989586621679964829"><span class="annot"><span class="annottext">[Clause]
</span><a href="#local-6989586621679964829"><span class="hs-identifier hs-var">x</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">[Clause]
</span><a href="#local-6989586621679964829"><span class="hs-identifier hs-var">x</span></a></span><span>
</span><span id="line-1267"></span><span>
</span><span id="line-1268"></span><span class="hs-comment">-- needs:</span><span>
</span><span id="line-1269"></span><span class="hs-comment">--</span><span>
</span><span id="line-1270"></span><span class="hs-comment">-- * isEntitySum ed</span><span>
</span><span id="line-1271"></span><span class="hs-comment">--     * field accesor</span><span>
</span><span id="line-1272"></span><span class="hs-comment">-- * getEntityFields ed</span><span>
</span><span id="line-1273"></span><span class="hs-comment">--     * used in goSum, or sumConstrName</span><span>
</span><span id="line-1274"></span><span class="hs-comment">-- * mkEntityDefName ed</span><span>
</span><span id="line-1275"></span><span class="hs-comment">--     * uses entityHaskell</span><span>
</span><span id="line-1276"></span><span class="hs-comment">-- * sumConstrName ed fieldDef</span><span>
</span><span id="line-1277"></span><span class="hs-comment">--     * only needs entity name and field name</span><span>
</span><span id="line-1278"></span><span class="hs-comment">--</span><span>
</span><span id="line-1279"></span><span class="hs-comment">-- data MkToPersistFields = MkToPersistFields</span><span>
</span><span id="line-1280"></span><span class="hs-comment">--     { isEntitySum :: Bool</span><span>
</span><span id="line-1281"></span><span class="hs-comment">--     , entityHaskell :: HaskellNameHS</span><span>
</span><span id="line-1282"></span><span class="hs-comment">--     , entityFieldNames :: [FieldNameHS]</span><span>
</span><span id="line-1283"></span><span class="hs-comment">--     }</span><span>
</span><span id="line-1284"></span><span class="annot"><a href="Database.Persist.TH.html#mkToPersistFields"><span class="hs-identifier hs-type">mkToPersistFields</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><a href="Database.Persist.TH.html#MkPersistSettings"><span class="hs-identifier hs-type">MkPersistSettings</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="Database.Persist.Quasi.Internal.html#UnboundEntityDef"><span class="hs-identifier hs-type">UnboundEntityDef</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="hs-identifier hs-type">Q</span></span><span> </span><span class="annot"><span class="hs-identifier hs-type">Dec</span></span><span>
</span><span id="line-1285"></span><span id="mkToPersistFields"><span class="annot"><span class="annottext">mkToPersistFields :: MkPersistSettings -&gt; UnboundEntityDef -&gt; Q Dec
</span><a href="Database.Persist.TH.html#mkToPersistFields"><span class="hs-identifier hs-var hs-var">mkToPersistFields</span></a></span></span><span> </span><span id="local-6989586621679964827"><span class="annot"><span class="annottext">MkPersistSettings
</span><a href="#local-6989586621679964827"><span class="hs-identifier hs-var">mps</span></a></span></span><span> </span><span id="local-6989586621679964826"><span class="annot"><span class="annottext">UnboundEntityDef
</span><a href="#local-6989586621679964826"><span class="hs-identifier hs-var">ed</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-keyword">do</span><span>
</span><span id="line-1286"></span><span>    </span><span class="hs-keyword">let</span><span> </span><span id="local-6989586621679964825"><span class="annot"><span class="annottext">isSum :: Bool
</span><a href="#local-6989586621679964825"><span class="hs-identifier hs-var hs-var">isSum</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">UnboundEntityDef -&gt; Bool
</span><a href="Database.Persist.TH.html#unboundEntitySum"><span class="hs-identifier hs-var">unboundEntitySum</span></a></span><span> </span><span class="annot"><span class="annottext">UnboundEntityDef
</span><a href="#local-6989586621679964826"><span class="hs-identifier hs-var">ed</span></a></span><span>
</span><span id="line-1287"></span><span>        </span><span id="local-6989586621679964824"><span class="annot"><span class="annottext">fields :: [UnboundFieldDef]
</span><a href="#local-6989586621679964824"><span class="hs-identifier hs-var hs-var">fields</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">UnboundEntityDef -&gt; [UnboundFieldDef]
</span><a href="Database.Persist.Quasi.Internal.html#getUnboundFieldDefs"><span class="hs-identifier hs-var">getUnboundFieldDefs</span></a></span><span> </span><span class="annot"><span class="annottext">UnboundEntityDef
</span><a href="#local-6989586621679964826"><span class="hs-identifier hs-var">ed</span></a></span><span>
</span><span id="line-1288"></span><span>    </span><span id="local-6989586621679964823"><span class="annot"><span class="annottext">[Clause]
</span><a href="#local-6989586621679964823"><span class="hs-identifier hs-var">clauses</span></a></span></span><span> </span><span class="hs-glyph">&lt;-</span><span>
</span><span id="line-1289"></span><span>        </span><span class="hs-keyword">if</span><span> </span><span class="annot"><span class="annottext">Bool
</span><a href="#local-6989586621679964825"><span class="hs-identifier hs-var">isSum</span></a></span><span>
</span><span id="line-1290"></span><span>            </span><span class="hs-keyword">then</span><span> </span><span class="annot"><span class="annottext">forall (t :: * -&gt; *) (m :: * -&gt; *) a.
(Traversable t, Monad m) =&gt;
t (m a) -&gt; m (t a)
</span><span class="hs-identifier hs-var">sequence</span></span><span> </span><span class="annot"><span class="annottext">forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span> </span><span class="annot"><span class="annottext">forall a b c. (a -&gt; b -&gt; c) -&gt; [a] -&gt; [b] -&gt; [c]
</span><span class="hs-identifier hs-var">zipWith</span></span><span> </span><span class="annot"><span class="annottext">UnboundFieldDef -&gt; Int -&gt; Q Clause
</span><a href="#local-6989586621679964820"><span class="hs-identifier hs-var">goSum</span></a></span><span> </span><span class="annot"><span class="annottext">[UnboundFieldDef]
</span><a href="#local-6989586621679964824"><span class="hs-identifier hs-var">fields</span></a></span><span> </span><span class="hs-special">[</span><span class="annot"><span class="annottext">Int
</span><span class="hs-number">1</span></span><span class="hs-glyph">..</span><span class="hs-special">]</span><span>
</span><span id="line-1291"></span><span>            </span><span class="hs-keyword">else</span><span> </span><span class="annot"><span class="annottext">forall (f :: * -&gt; *) a b. Functor f =&gt; (a -&gt; b) -&gt; f a -&gt; f b
</span><span class="hs-identifier hs-var">fmap</span></span><span> </span><span class="annot"><span class="annottext">forall (m :: * -&gt; *) a. Monad m =&gt; a -&gt; m a
</span><span class="hs-identifier hs-var">return</span></span><span> </span><span class="annot"><span class="annottext">Q Clause
</span><a href="#local-6989586621679964819"><span class="hs-identifier hs-var">go</span></a></span><span>
</span><span id="line-1292"></span><span>    </span><span class="annot"><span class="annottext">forall (m :: * -&gt; *) a. Monad m =&gt; a -&gt; m a
</span><span class="hs-identifier hs-var">return</span></span><span> </span><span class="annot"><span class="annottext">forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span> </span><span class="annot"><span class="annottext">Name -&gt; [Clause] -&gt; Dec
</span><span class="hs-identifier hs-var">FunD</span></span><span> </span><span class="hs-special">'</span><span class="hs-identifier">toPersistFields</span><span> </span><span class="annot"><span class="annottext">[Clause]
</span><a href="#local-6989586621679964823"><span class="hs-identifier hs-var">clauses</span></a></span><span>
</span><span id="line-1293"></span><span>  </span><span class="hs-keyword">where</span><span>
</span><span id="line-1294"></span><span>    </span><span class="annot"><a href="#local-6989586621679964819"><span class="hs-identifier hs-type">go</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><span class="hs-identifier hs-type">Q</span></span><span> </span><span class="annot"><span class="hs-identifier hs-type">Clause</span></span><span>
</span><span id="line-1295"></span><span>    </span><span id="local-6989586621679964819"><span class="annot"><span class="annottext">go :: Q Clause
</span><a href="#local-6989586621679964819"><span class="hs-identifier hs-var hs-var">go</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-keyword">do</span><span>
</span><span id="line-1296"></span><span>        </span><span id="local-6989586621679964817"><span class="annot"><span class="annottext">[Name]
</span><a href="#local-6989586621679964817"><span class="hs-identifier hs-var">xs</span></a></span></span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">forall (t :: * -&gt; *) (m :: * -&gt; *) a.
(Traversable t, Monad m) =&gt;
t (m a) -&gt; m (t a)
</span><span class="hs-identifier hs-var">sequence</span></span><span> </span><span class="annot"><span class="annottext">forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span> </span><span class="annot"><span class="annottext">forall a. Int -&gt; a -&gt; [a]
</span><span class="hs-identifier hs-var">replicate</span></span><span> </span><span class="annot"><span class="annottext">Int
</span><a href="#local-6989586621679964815"><span class="hs-identifier hs-var">fieldCount</span></a></span><span> </span><span class="annot"><span class="annottext">forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span> </span><span class="annot"><span class="annottext">forall (m :: * -&gt; *). Quote m =&gt; String -&gt; m Name
</span><span class="hs-identifier hs-var">newName</span></span><span> </span><span class="annot"><span class="annottext">String
</span><span class="hs-string">&quot;x&quot;</span></span><span>
</span><span id="line-1297"></span><span>        </span><span class="hs-keyword">let</span><span> </span><span id="local-6989586621679964814"><span class="annot"><span class="annottext">name :: Name
</span><a href="#local-6989586621679964814"><span class="hs-identifier hs-var hs-var">name</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">UnboundEntityDef -&gt; Name
</span><a href="Database.Persist.TH.html#mkEntityDefName"><span class="hs-identifier hs-var">mkEntityDefName</span></a></span><span> </span><span class="annot"><span class="annottext">UnboundEntityDef
</span><a href="#local-6989586621679964826"><span class="hs-identifier hs-var">ed</span></a></span><span>
</span><span id="line-1298"></span><span>            </span><span id="local-6989586621679964813"><span class="annot"><span class="annottext">pat :: Pat
</span><a href="#local-6989586621679964813"><span class="hs-identifier hs-var hs-var">pat</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">Name -&gt; [Pat] -&gt; Pat
</span><a href="Database.Persist.TH.html#conp"><span class="hs-identifier hs-var">conp</span></a></span><span> </span><span class="annot"><span class="annottext">Name
</span><a href="#local-6989586621679964814"><span class="hs-identifier hs-var">name</span></a></span><span> </span><span class="annot"><span class="annottext">forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span> </span><span class="annot"><span class="annottext">forall (f :: * -&gt; *) a b. Functor f =&gt; (a -&gt; b) -&gt; f a -&gt; f b
</span><span class="hs-identifier hs-var">fmap</span></span><span> </span><span class="annot"><span class="annottext">Name -&gt; Pat
</span><span class="hs-identifier hs-var">VarP</span></span><span> </span><span class="annot"><span class="annottext">[Name]
</span><a href="#local-6989586621679964817"><span class="hs-identifier hs-var">xs</span></a></span><span>
</span><span id="line-1299"></span><span>        </span><span id="local-6989586621679964811"><span class="annot"><span class="annottext">Exp
</span><a href="#local-6989586621679964811"><span class="hs-identifier hs-var">sp</span></a></span></span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="hs-special">[|</span><span class="hs-identifier">SomePersistField</span><span class="hs-special">|]</span><span>
</span><span id="line-1300"></span><span>        </span><span class="hs-keyword">let</span><span> </span><span id="local-6989586621679964810"><span class="annot"><span class="annottext">bod :: Exp
</span><a href="#local-6989586621679964810"><span class="hs-identifier hs-var hs-var">bod</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">[Exp] -&gt; Exp
</span><span class="hs-identifier hs-var">ListE</span></span><span> </span><span class="annot"><span class="annottext">forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span> </span><span class="annot"><span class="annottext">forall (f :: * -&gt; *) a b. Functor f =&gt; (a -&gt; b) -&gt; f a -&gt; f b
</span><span class="hs-identifier hs-var">fmap</span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Exp -&gt; Exp -&gt; Exp
</span><span class="hs-identifier hs-var">AppE</span></span><span> </span><span class="annot"><span class="annottext">Exp
</span><a href="#local-6989586621679964811"><span class="hs-identifier hs-var">sp</span></a></span><span> </span><span class="annot"><span class="annottext">forall b c a. (b -&gt; c) -&gt; (a -&gt; b) -&gt; a -&gt; c
</span><span class="hs-operator hs-var">.</span></span><span> </span><span class="annot"><span class="annottext">Name -&gt; Exp
</span><span class="hs-identifier hs-var">VarE</span></span><span class="hs-special">)</span><span> </span><span class="annot"><span class="annottext">[Name]
</span><a href="#local-6989586621679964817"><span class="hs-identifier hs-var">xs</span></a></span><span>
</span><span id="line-1301"></span><span>        </span><span class="annot"><span class="annottext">forall (m :: * -&gt; *) a. Monad m =&gt; a -&gt; m a
</span><span class="hs-identifier hs-var">return</span></span><span> </span><span class="annot"><span class="annottext">forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span> </span><span class="annot"><span class="annottext">[Pat] -&gt; Exp -&gt; Clause
</span><a href="Database.Persist.TH.html#normalClause"><span class="hs-identifier hs-var">normalClause</span></a></span><span> </span><span class="hs-special">[</span><span class="annot"><span class="annottext">Pat
</span><a href="#local-6989586621679964813"><span class="hs-identifier hs-var">pat</span></a></span><span class="hs-special">]</span><span> </span><span class="annot"><span class="annottext">Exp
</span><a href="#local-6989586621679964810"><span class="hs-identifier hs-var">bod</span></a></span><span>
</span><span id="line-1302"></span><span>
</span><span id="line-1303"></span><span>    </span><span id="local-6989586621679964815"><span class="annot"><span class="annottext">fieldCount :: Int
</span><a href="#local-6989586621679964815"><span class="hs-identifier hs-var hs-var">fieldCount</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">forall (t :: * -&gt; *) a. Foldable t =&gt; t a -&gt; Int
</span><span class="hs-identifier hs-var">length</span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">UnboundEntityDef -&gt; [UnboundFieldDef]
</span><a href="Database.Persist.Quasi.Internal.html#getUnboundFieldDefs"><span class="hs-identifier hs-var">getUnboundFieldDefs</span></a></span><span> </span><span class="annot"><span class="annottext">UnboundEntityDef
</span><a href="#local-6989586621679964826"><span class="hs-identifier hs-var">ed</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-1304"></span><span>
</span><span id="line-1305"></span><span>    </span><span class="annot"><a href="#local-6989586621679964820"><span class="hs-identifier hs-type">goSum</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><a href="Database.Persist.Quasi.Internal.html#UnboundFieldDef"><span class="hs-identifier hs-type">UnboundFieldDef</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="hs-identifier hs-type">Int</span></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="hs-identifier hs-type">Q</span></span><span> </span><span class="annot"><span class="hs-identifier hs-type">Clause</span></span><span>
</span><span id="line-1306"></span><span>    </span><span id="local-6989586621679964820"><span class="annot"><span class="annottext">goSum :: UnboundFieldDef -&gt; Int -&gt; Q Clause
</span><a href="#local-6989586621679964820"><span class="hs-identifier hs-var hs-var">goSum</span></a></span></span><span> </span><span id="local-6989586621679964809"><span class="annot"><span class="annottext">UnboundFieldDef
</span><a href="#local-6989586621679964809"><span class="hs-identifier hs-var">fieldDef</span></a></span></span><span> </span><span id="local-6989586621679964808"><span class="annot"><span class="annottext">Int
</span><a href="#local-6989586621679964808"><span class="hs-identifier hs-var">idx</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-keyword">do</span><span>
</span><span id="line-1307"></span><span>        </span><span class="hs-keyword">let</span><span> </span><span id="local-6989586621679964807"><span class="annot"><span class="annottext">name :: Name
</span><a href="#local-6989586621679964807"><span class="hs-identifier hs-var hs-var">name</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">MkPersistSettings -&gt; UnboundEntityDef -&gt; UnboundFieldDef -&gt; Name
</span><a href="Database.Persist.TH.html#sumConstrName"><span class="hs-identifier hs-var">sumConstrName</span></a></span><span> </span><span class="annot"><span class="annottext">MkPersistSettings
</span><a href="#local-6989586621679964827"><span class="hs-identifier hs-var">mps</span></a></span><span> </span><span class="annot"><span class="annottext">UnboundEntityDef
</span><a href="#local-6989586621679964826"><span class="hs-identifier hs-var">ed</span></a></span><span> </span><span class="annot"><span class="annottext">UnboundFieldDef
</span><a href="#local-6989586621679964809"><span class="hs-identifier hs-var">fieldDef</span></a></span><span>
</span><span id="line-1308"></span><span>        </span><span id="local-6989586621679964806"><span class="annot"><span class="annottext">Exp
</span><a href="#local-6989586621679964806"><span class="hs-identifier hs-var">enull</span></a></span></span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="hs-special">[|</span><span class="hs-identifier">SomePersistField</span><span> </span><span class="hs-identifier">PersistNull</span><span class="hs-special">|]</span><span>
</span><span id="line-1309"></span><span>        </span><span class="hs-keyword">let</span><span> </span><span id="local-6989586621679964805"><span class="annot"><span class="annottext">beforeCount :: Int
</span><a href="#local-6989586621679964805"><span class="hs-identifier hs-var hs-var">beforeCount</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">Int
</span><a href="#local-6989586621679964808"><span class="hs-identifier hs-var">idx</span></a></span><span> </span><span class="annot"><span class="annottext">forall a. Num a =&gt; a -&gt; a -&gt; a
</span><span class="hs-glyph hs-var">-</span></span><span> </span><span class="annot"><span class="annottext">Int
</span><span class="hs-number">1</span></span><span>
</span><span id="line-1310"></span><span>            </span><span id="local-6989586621679964804"><span class="annot"><span class="annottext">afterCount :: Int
</span><a href="#local-6989586621679964804"><span class="hs-identifier hs-var hs-var">afterCount</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">Int
</span><a href="#local-6989586621679964815"><span class="hs-identifier hs-var">fieldCount</span></a></span><span> </span><span class="annot"><span class="annottext">forall a. Num a =&gt; a -&gt; a -&gt; a
</span><span class="hs-glyph hs-var">-</span></span><span> </span><span class="annot"><span class="annottext">Int
</span><a href="#local-6989586621679964808"><span class="hs-identifier hs-var">idx</span></a></span><span>
</span><span id="line-1311"></span><span>            </span><span id="local-6989586621679964803"><span class="annot"><span class="annottext">before :: [Exp]
</span><a href="#local-6989586621679964803"><span class="hs-identifier hs-var hs-var">before</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">forall a. Int -&gt; a -&gt; [a]
</span><span class="hs-identifier hs-var">replicate</span></span><span> </span><span class="annot"><span class="annottext">Int
</span><a href="#local-6989586621679964805"><span class="hs-identifier hs-var">beforeCount</span></a></span><span> </span><span class="annot"><span class="annottext">Exp
</span><a href="#local-6989586621679964806"><span class="hs-identifier hs-var">enull</span></a></span><span>
</span><span id="line-1312"></span><span>            </span><span id="local-6989586621679964802"><span class="annot"><span class="annottext">after :: [Exp]
</span><a href="#local-6989586621679964802"><span class="hs-identifier hs-var hs-var">after</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">forall a. Int -&gt; a -&gt; [a]
</span><span class="hs-identifier hs-var">replicate</span></span><span> </span><span class="annot"><span class="annottext">Int
</span><a href="#local-6989586621679964804"><span class="hs-identifier hs-var">afterCount</span></a></span><span> </span><span class="annot"><span class="annottext">Exp
</span><a href="#local-6989586621679964806"><span class="hs-identifier hs-var">enull</span></a></span><span>
</span><span id="line-1313"></span><span>        </span><span id="local-6989586621679964801"><span class="annot"><span class="annottext">Name
</span><a href="#local-6989586621679964801"><span class="hs-identifier hs-var">x</span></a></span></span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">forall (m :: * -&gt; *). Quote m =&gt; String -&gt; m Name
</span><span class="hs-identifier hs-var">newName</span></span><span> </span><span class="annot"><span class="annottext">String
</span><span class="hs-string">&quot;x&quot;</span></span><span>
</span><span id="line-1314"></span><span>        </span><span id="local-6989586621679964800"><span class="annot"><span class="annottext">Exp
</span><a href="#local-6989586621679964800"><span class="hs-identifier hs-var">sp</span></a></span></span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="hs-special">[|</span><span class="hs-identifier">SomePersistField</span><span class="hs-special">|]</span><span>
</span><span id="line-1315"></span><span>        </span><span class="hs-keyword">let</span><span> </span><span id="local-6989586621679964799"><span class="annot"><span class="annottext">body :: Exp
</span><a href="#local-6989586621679964799"><span class="hs-identifier hs-var hs-var">body</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">[Exp] -&gt; Exp
</span><span class="hs-identifier hs-var">ListE</span></span><span> </span><span class="annot"><span class="annottext">forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span> </span><span class="annot"><span class="annottext">forall a. Monoid a =&gt; [a] -&gt; a
</span><span class="hs-identifier hs-var">mconcat</span></span><span>
</span><span id="line-1316"></span><span>                </span><span class="hs-special">[</span><span> </span><span class="annot"><span class="annottext">[Exp]
</span><a href="#local-6989586621679964803"><span class="hs-identifier hs-var">before</span></a></span><span>
</span><span id="line-1317"></span><span>                </span><span class="hs-special">,</span><span> </span><span class="hs-special">[</span><span class="annot"><span class="annottext">Exp
</span><a href="#local-6989586621679964800"><span class="hs-identifier hs-var">sp</span></a></span><span> </span><span class="annot"><span class="annottext">Exp -&gt; Exp -&gt; Exp
</span><span class="hs-operator hs-var">`AppE`</span></span><span> </span><span class="annot"><span class="annottext">Name -&gt; Exp
</span><span class="hs-identifier hs-var">VarE</span></span><span> </span><span class="annot"><span class="annottext">Name
</span><a href="#local-6989586621679964801"><span class="hs-identifier hs-var">x</span></a></span><span class="hs-special">]</span><span>
</span><span id="line-1318"></span><span>                </span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">[Exp]
</span><a href="#local-6989586621679964802"><span class="hs-identifier hs-var">after</span></a></span><span>
</span><span id="line-1319"></span><span>                </span><span class="hs-special">]</span><span>
</span><span id="line-1320"></span><span>        </span><span class="annot"><span class="annottext">forall (m :: * -&gt; *) a. Monad m =&gt; a -&gt; m a
</span><span class="hs-identifier hs-var">return</span></span><span> </span><span class="annot"><span class="annottext">forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span> </span><span class="annot"><span class="annottext">[Pat] -&gt; Exp -&gt; Clause
</span><a href="Database.Persist.TH.html#normalClause"><span class="hs-identifier hs-var">normalClause</span></a></span><span> </span><span class="hs-special">[</span><span class="annot"><span class="annottext">Name -&gt; [Pat] -&gt; Pat
</span><a href="Database.Persist.TH.html#conp"><span class="hs-identifier hs-var">conp</span></a></span><span> </span><span class="annot"><span class="annottext">Name
</span><a href="#local-6989586621679964807"><span class="hs-identifier hs-var">name</span></a></span><span> </span><span class="hs-special">[</span><span class="annot"><span class="annottext">Name -&gt; Pat
</span><span class="hs-identifier hs-var">VarP</span></span><span> </span><span class="annot"><span class="annottext">Name
</span><a href="#local-6989586621679964801"><span class="hs-identifier hs-var">x</span></a></span><span class="hs-special">]</span><span class="hs-special">]</span><span> </span><span class="annot"><span class="annottext">Exp
</span><a href="#local-6989586621679964799"><span class="hs-identifier hs-var">body</span></a></span><span>
</span><span id="line-1321"></span><span>
</span><span id="line-1322"></span><span class="annot"><a href="Database.Persist.TH.html#mkToFieldNames"><span class="hs-identifier hs-type">mkToFieldNames</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="hs-special">[</span><span class="annot"><a href="Database.Persist.Types.Base.html#UniqueDef"><span class="hs-identifier hs-type">UniqueDef</span></a></span><span class="hs-special">]</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="hs-identifier hs-type">Q</span></span><span> </span><span class="annot"><span class="hs-identifier hs-type">Dec</span></span><span>
</span><span id="line-1323"></span><span id="mkToFieldNames"><span class="annot"><span class="annottext">mkToFieldNames :: [UniqueDef] -&gt; Q Dec
</span><a href="Database.Persist.TH.html#mkToFieldNames"><span class="hs-identifier hs-var hs-var">mkToFieldNames</span></a></span></span><span> </span><span id="local-6989586621679964797"><span class="annot"><span class="annottext">[UniqueDef]
</span><a href="#local-6989586621679964797"><span class="hs-identifier hs-var">pairs</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-keyword">do</span><span>
</span><span id="line-1324"></span><span>    </span><span id="local-6989586621679964796"><span class="annot"><span class="annottext">[Clause]
</span><a href="#local-6989586621679964796"><span class="hs-identifier hs-var">pairs'</span></a></span></span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">forall (t :: * -&gt; *) (m :: * -&gt; *) a b.
(Traversable t, Monad m) =&gt;
(a -&gt; m b) -&gt; t a -&gt; m (t b)
</span><span class="hs-identifier hs-var">mapM</span></span><span> </span><span class="annot"><span class="annottext">forall {m :: * -&gt; *}. Quote m =&gt; UniqueDef -&gt; m Clause
</span><a href="#local-6989586621679964795"><span class="hs-identifier hs-var">go</span></a></span><span> </span><span class="annot"><span class="annottext">[UniqueDef]
</span><a href="#local-6989586621679964797"><span class="hs-identifier hs-var">pairs</span></a></span><span>
</span><span id="line-1325"></span><span>    </span><span class="annot"><span class="annottext">forall (m :: * -&gt; *) a. Monad m =&gt; a -&gt; m a
</span><span class="hs-identifier hs-var">return</span></span><span> </span><span class="annot"><span class="annottext">forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span> </span><span class="annot"><span class="annottext">Name -&gt; [Clause] -&gt; Dec
</span><span class="hs-identifier hs-var">FunD</span></span><span> </span><span class="hs-special">'</span><span class="hs-identifier">persistUniqueToFieldNames</span><span> </span><span class="annot"><span class="annottext">forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span> </span><span class="annot"><span class="annottext">[Clause] -&gt; [Clause]
</span><a href="Database.Persist.TH.html#degen"><span class="hs-identifier hs-var">degen</span></a></span><span> </span><span class="annot"><span class="annottext">[Clause]
</span><a href="#local-6989586621679964796"><span class="hs-identifier hs-var">pairs'</span></a></span><span>
</span><span id="line-1326"></span><span>  </span><span class="hs-keyword">where</span><span>
</span><span id="line-1327"></span><span>    </span><span id="local-6989586621679964795"><span class="annot"><span class="annottext">go :: UniqueDef -&gt; m Clause
</span><a href="#local-6989586621679964795"><span class="hs-identifier hs-var hs-var">go</span></a></span></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="Database.Persist.Types.Base.html#UniqueDef"><span class="hs-identifier hs-type">UniqueDef</span></a></span><span> </span><span id="local-6989586621679964783"><span class="annot"><span class="annottext">ConstraintNameHS
</span><a href="#local-6989586621679964783"><span class="hs-identifier hs-var">constr</span></a></span></span><span> </span><span class="annot"><span class="annottext">ConstraintNameDB
</span><span class="hs-identifier">_</span></span><span> </span><span id="local-6989586621679964782"><span class="annot"><span class="annottext">NonEmpty ForeignFieldDef
</span><a href="#local-6989586621679964782"><span class="hs-identifier hs-var">names</span></a></span></span><span> </span><span class="annot"><span class="annottext">[Text]
</span><span class="hs-identifier">_</span></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-keyword">do</span><span>
</span><span id="line-1328"></span><span>        </span><span id="local-6989586621679964781"><span class="annot"><span class="annottext">Exp
</span><a href="#local-6989586621679964781"><span class="hs-identifier hs-var">names'</span></a></span></span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">forall t (m :: * -&gt; *). (Lift t, Quote m) =&gt; t -&gt; m Exp
</span><span class="hs-identifier hs-var">lift</span></span><span> </span><span class="annot"><span class="annottext">NonEmpty ForeignFieldDef
</span><a href="#local-6989586621679964782"><span class="hs-identifier hs-var">names</span></a></span><span>
</span><span id="line-1329"></span><span>        </span><span class="annot"><span class="annottext">forall (m :: * -&gt; *) a. Monad m =&gt; a -&gt; m a
</span><span class="hs-identifier hs-var">return</span></span><span> </span><span class="annot"><span class="annottext">forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span>
</span><span id="line-1330"></span><span>            </span><span class="annot"><span class="annottext">[Pat] -&gt; Exp -&gt; Clause
</span><a href="Database.Persist.TH.html#normalClause"><span class="hs-identifier hs-var">normalClause</span></a></span><span>
</span><span id="line-1331"></span><span>                </span><span class="hs-special">[</span><span class="annot"><span class="annottext">Name -&gt; [FieldPat] -&gt; Pat
</span><span class="hs-identifier hs-var">RecP</span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">ConstraintNameHS -&gt; Name
</span><a href="Database.Persist.TH.html#mkConstraintName"><span class="hs-identifier hs-var">mkConstraintName</span></a></span><span> </span><span class="annot"><span class="annottext">ConstraintNameHS
</span><a href="#local-6989586621679964783"><span class="hs-identifier hs-var">constr</span></a></span><span class="hs-special">)</span><span> </span><span class="hs-special">[</span><span class="hs-special">]</span><span class="hs-special">]</span><span>
</span><span id="line-1332"></span><span>                </span><span class="annot"><span class="annottext">Exp
</span><a href="#local-6989586621679964781"><span class="hs-identifier hs-var">names'</span></a></span><span>
</span><span id="line-1333"></span><span>
</span><span id="line-1334"></span><span class="annot"><a href="Database.Persist.TH.html#mkUniqueToValues"><span class="hs-identifier hs-type">mkUniqueToValues</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="hs-special">[</span><span class="annot"><a href="Database.Persist.Types.Base.html#UniqueDef"><span class="hs-identifier hs-type">UniqueDef</span></a></span><span class="hs-special">]</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="hs-identifier hs-type">Q</span></span><span> </span><span class="annot"><span class="hs-identifier hs-type">Dec</span></span><span>
</span><span id="line-1335"></span><span id="mkUniqueToValues"><span class="annot"><span class="annottext">mkUniqueToValues :: [UniqueDef] -&gt; Q Dec
</span><a href="Database.Persist.TH.html#mkUniqueToValues"><span class="hs-identifier hs-var hs-var">mkUniqueToValues</span></a></span></span><span> </span><span id="local-6989586621679964778"><span class="annot"><span class="annottext">[UniqueDef]
</span><a href="#local-6989586621679964778"><span class="hs-identifier hs-var">pairs</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-keyword">do</span><span>
</span><span id="line-1336"></span><span>    </span><span id="local-6989586621679964777"><span class="annot"><span class="annottext">[Clause]
</span><a href="#local-6989586621679964777"><span class="hs-identifier hs-var">pairs'</span></a></span></span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">forall (t :: * -&gt; *) (m :: * -&gt; *) a b.
(Traversable t, Monad m) =&gt;
(a -&gt; m b) -&gt; t a -&gt; m (t b)
</span><span class="hs-identifier hs-var">mapM</span></span><span> </span><span class="annot"><span class="annottext">UniqueDef -&gt; Q Clause
</span><a href="#local-6989586621679964776"><span class="hs-identifier hs-var">go</span></a></span><span> </span><span class="annot"><span class="annottext">[UniqueDef]
</span><a href="#local-6989586621679964778"><span class="hs-identifier hs-var">pairs</span></a></span><span>
</span><span id="line-1337"></span><span>    </span><span class="annot"><span class="annottext">forall (m :: * -&gt; *) a. Monad m =&gt; a -&gt; m a
</span><span class="hs-identifier hs-var">return</span></span><span> </span><span class="annot"><span class="annottext">forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span> </span><span class="annot"><span class="annottext">Name -&gt; [Clause] -&gt; Dec
</span><span class="hs-identifier hs-var">FunD</span></span><span> </span><span class="hs-special">'</span><span class="hs-identifier">persistUniqueToValues</span><span> </span><span class="annot"><span class="annottext">forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span> </span><span class="annot"><span class="annottext">[Clause] -&gt; [Clause]
</span><a href="Database.Persist.TH.html#degen"><span class="hs-identifier hs-var">degen</span></a></span><span> </span><span class="annot"><span class="annottext">[Clause]
</span><a href="#local-6989586621679964777"><span class="hs-identifier hs-var">pairs'</span></a></span><span>
</span><span id="line-1338"></span><span>  </span><span class="hs-keyword">where</span><span>
</span><span id="line-1339"></span><span>    </span><span class="annot"><a href="#local-6989586621679964776"><span class="hs-identifier hs-type">go</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><a href="Database.Persist.Types.Base.html#UniqueDef"><span class="hs-identifier hs-type">UniqueDef</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="hs-identifier hs-type">Q</span></span><span> </span><span class="annot"><span class="hs-identifier hs-type">Clause</span></span><span>
</span><span id="line-1340"></span><span>    </span><span id="local-6989586621679964776"><span class="annot"><span class="annottext">go :: UniqueDef -&gt; Q Clause
</span><a href="#local-6989586621679964776"><span class="hs-identifier hs-var hs-var">go</span></a></span></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="Database.Persist.Types.Base.html#UniqueDef"><span class="hs-identifier hs-type">UniqueDef</span></a></span><span> </span><span id="local-6989586621679964775"><span class="annot"><span class="annottext">ConstraintNameHS
</span><a href="#local-6989586621679964775"><span class="hs-identifier hs-var">constr</span></a></span></span><span> </span><span class="annot"><span class="annottext">ConstraintNameDB
</span><span class="hs-identifier">_</span></span><span> </span><span id="local-6989586621679964774"><span class="annot"><span class="annottext">NonEmpty ForeignFieldDef
</span><a href="#local-6989586621679964774"><span class="hs-identifier hs-var">names</span></a></span></span><span> </span><span class="annot"><span class="annottext">[Text]
</span><span class="hs-identifier">_</span></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-keyword">do</span><span>
</span><span id="line-1341"></span><span>        </span><span id="local-6989586621679964773"><span class="annot"><span class="annottext">NonEmpty Name
</span><a href="#local-6989586621679964773"><span class="hs-identifier hs-var">xs</span></a></span></span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">forall (t :: * -&gt; *) (m :: * -&gt; *) a b.
(Traversable t, Monad m) =&gt;
(a -&gt; m b) -&gt; t a -&gt; m (t b)
</span><span class="hs-identifier hs-var">mapM</span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">forall a b. a -&gt; b -&gt; a
</span><span class="hs-identifier hs-var">const</span></span><span> </span><span class="annot"><span class="annottext">forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span> </span><span class="annot"><span class="annottext">forall (m :: * -&gt; *). Quote m =&gt; String -&gt; m Name
</span><span class="hs-identifier hs-var">newName</span></span><span> </span><span class="annot"><span class="annottext">String
</span><span class="hs-string">&quot;x&quot;</span></span><span class="hs-special">)</span><span> </span><span class="annot"><span class="annottext">NonEmpty ForeignFieldDef
</span><a href="#local-6989586621679964774"><span class="hs-identifier hs-var">names</span></a></span><span>
</span><span id="line-1342"></span><span>        </span><span class="hs-keyword">let</span><span> </span><span id="local-6989586621679964771"><span class="annot"><span class="annottext">pat :: Pat
</span><a href="#local-6989586621679964771"><span class="hs-identifier hs-var hs-var">pat</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">Name -&gt; [Pat] -&gt; Pat
</span><a href="Database.Persist.TH.html#conp"><span class="hs-identifier hs-var">conp</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">ConstraintNameHS -&gt; Name
</span><a href="Database.Persist.TH.html#mkConstraintName"><span class="hs-identifier hs-var">mkConstraintName</span></a></span><span> </span><span class="annot"><span class="annottext">ConstraintNameHS
</span><a href="#local-6989586621679964775"><span class="hs-identifier hs-var">constr</span></a></span><span class="hs-special">)</span><span> </span><span class="annot"><span class="annottext">forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span> </span><span class="annot"><span class="annottext">forall (f :: * -&gt; *) a b. Functor f =&gt; (a -&gt; b) -&gt; f a -&gt; f b
</span><span class="hs-identifier hs-var">fmap</span></span><span> </span><span class="annot"><span class="annottext">Name -&gt; Pat
</span><span class="hs-identifier hs-var">VarP</span></span><span> </span><span class="annot"><span class="annottext">forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span> </span><span class="annot"><span class="annottext">forall (t :: * -&gt; *) a. Foldable t =&gt; t a -&gt; [a]
</span><span class="hs-identifier hs-var">toList</span></span><span> </span><span class="annot"><span class="annottext">NonEmpty Name
</span><a href="#local-6989586621679964773"><span class="hs-identifier hs-var">xs</span></a></span><span>
</span><span id="line-1343"></span><span>        </span><span id="local-6989586621679964770"><span class="annot"><span class="annottext">Exp
</span><a href="#local-6989586621679964770"><span class="hs-identifier hs-var">tpv</span></a></span></span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="hs-special">[|</span><span class="hs-identifier">toPersistValue</span><span class="hs-special">|]</span><span>
</span><span id="line-1344"></span><span>        </span><span class="hs-keyword">let</span><span> </span><span id="local-6989586621679964769"><span class="annot"><span class="annottext">bod :: Exp
</span><a href="#local-6989586621679964769"><span class="hs-identifier hs-var hs-var">bod</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">[Exp] -&gt; Exp
</span><span class="hs-identifier hs-var">ListE</span></span><span> </span><span class="annot"><span class="annottext">forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span> </span><span class="annot"><span class="annottext">forall (f :: * -&gt; *) a b. Functor f =&gt; (a -&gt; b) -&gt; f a -&gt; f b
</span><span class="hs-identifier hs-var">fmap</span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Exp -&gt; Exp -&gt; Exp
</span><span class="hs-identifier hs-var">AppE</span></span><span> </span><span class="annot"><span class="annottext">Exp
</span><a href="#local-6989586621679964770"><span class="hs-identifier hs-var">tpv</span></a></span><span> </span><span class="annot"><span class="annottext">forall b c a. (b -&gt; c) -&gt; (a -&gt; b) -&gt; a -&gt; c
</span><span class="hs-operator hs-var">.</span></span><span> </span><span class="annot"><span class="annottext">Name -&gt; Exp
</span><span class="hs-identifier hs-var">VarE</span></span><span class="hs-special">)</span><span> </span><span class="annot"><span class="annottext">forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span> </span><span class="annot"><span class="annottext">forall (t :: * -&gt; *) a. Foldable t =&gt; t a -&gt; [a]
</span><span class="hs-identifier hs-var">toList</span></span><span> </span><span class="annot"><span class="annottext">NonEmpty Name
</span><a href="#local-6989586621679964773"><span class="hs-identifier hs-var">xs</span></a></span><span>
</span><span id="line-1345"></span><span>        </span><span class="annot"><span class="annottext">forall (m :: * -&gt; *) a. Monad m =&gt; a -&gt; m a
</span><span class="hs-identifier hs-var">return</span></span><span> </span><span class="annot"><span class="annottext">forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span> </span><span class="annot"><span class="annottext">[Pat] -&gt; Exp -&gt; Clause
</span><a href="Database.Persist.TH.html#normalClause"><span class="hs-identifier hs-var">normalClause</span></a></span><span> </span><span class="hs-special">[</span><span class="annot"><span class="annottext">Pat
</span><a href="#local-6989586621679964771"><span class="hs-identifier hs-var">pat</span></a></span><span class="hs-special">]</span><span> </span><span class="annot"><span class="annottext">Exp
</span><a href="#local-6989586621679964769"><span class="hs-identifier hs-var">bod</span></a></span><span>
</span><span id="line-1346"></span><span>
</span><span id="line-1347"></span><span class="annot"><a href="Database.Persist.TH.html#isNotNull"><span class="hs-identifier hs-type">isNotNull</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><a href="Database.Persist.PersistValue.html#PersistValue"><span class="hs-identifier hs-type">PersistValue</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="hs-identifier hs-type">Bool</span></span><span>
</span><span id="line-1348"></span><span id="isNotNull"><span class="annot"><span class="annottext">isNotNull :: PersistValue -&gt; Bool
</span><a href="Database.Persist.TH.html#isNotNull"><span class="hs-identifier hs-var hs-var">isNotNull</span></a></span></span><span> </span><span class="annot"><span class="annottext">PersistValue
</span><a href="Database.Persist.PersistValue.html#PersistNull"><span class="hs-identifier hs-var">PersistNull</span></a></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">Bool
</span><span class="hs-identifier hs-var">False</span></span><span>
</span><span id="line-1349"></span><span class="annot"><a href="Database.Persist.TH.html#isNotNull"><span class="hs-identifier hs-var">isNotNull</span></a></span><span> </span><span class="annot"><span class="annottext">PersistValue
</span><span class="hs-identifier">_</span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">Bool
</span><span class="hs-identifier hs-var">True</span></span><span>
</span><span id="line-1350"></span><span>
</span><span id="line-1351"></span><span id="local-6989586621679966450"><span id="local-6989586621679966451"><span id="local-6989586621679966452"><span class="annot"><a href="Database.Persist.TH.html#mapLeft"><span class="hs-identifier hs-type">mapLeft</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="hs-special">(</span><span class="annot"><a href="#local-6989586621679966452"><span class="hs-identifier hs-type">a</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="#local-6989586621679966451"><span class="hs-identifier hs-type">c</span></a></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="hs-identifier hs-type">Either</span></span><span> </span><span class="annot"><a href="#local-6989586621679966452"><span class="hs-identifier hs-type">a</span></a></span><span> </span><span class="annot"><a href="#local-6989586621679966450"><span class="hs-identifier hs-type">b</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="hs-identifier hs-type">Either</span></span><span> </span><span class="annot"><a href="#local-6989586621679966451"><span class="hs-identifier hs-type">c</span></a></span><span> </span><span class="annot"><a href="#local-6989586621679966450"><span class="hs-identifier hs-type">b</span></a></span></span></span></span><span>
</span><span id="line-1352"></span><span id="mapLeft"><span class="annot"><span class="annottext">mapLeft :: forall a c b. (a -&gt; c) -&gt; Either a b -&gt; Either c b
</span><a href="Database.Persist.TH.html#mapLeft"><span class="hs-identifier hs-var hs-var">mapLeft</span></a></span></span><span> </span><span class="annot"><span class="annottext">a -&gt; c
</span><span class="hs-identifier">_</span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="hs-identifier hs-type">Right</span></span><span> </span><span id="local-6989586621679964765"><span class="annot"><span class="annottext">b
</span><a href="#local-6989586621679964765"><span class="hs-identifier hs-var">r</span></a></span></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">forall a b. b -&gt; Either a b
</span><span class="hs-identifier hs-var">Right</span></span><span> </span><span class="annot"><span class="annottext">b
</span><a href="#local-6989586621679964765"><span class="hs-identifier hs-var">r</span></a></span><span>
</span><span id="line-1353"></span><span class="annot"><a href="Database.Persist.TH.html#mapLeft"><span class="hs-identifier hs-var">mapLeft</span></a></span><span> </span><span id="local-6989586621679964764"><span class="annot"><span class="annottext">a -&gt; c
</span><a href="#local-6989586621679964764"><span class="hs-identifier hs-var">f</span></a></span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="hs-identifier hs-type">Left</span></span><span> </span><span id="local-6989586621679964763"><span class="annot"><span class="annottext">a
</span><a href="#local-6989586621679964763"><span class="hs-identifier hs-var">l</span></a></span></span><span class="hs-special">)</span><span>  </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">forall a b. a -&gt; Either a b
</span><span class="hs-identifier hs-var">Left</span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">a -&gt; c
</span><a href="#local-6989586621679964764"><span class="hs-identifier hs-var">f</span></a></span><span> </span><span class="annot"><span class="annottext">a
</span><a href="#local-6989586621679964763"><span class="hs-identifier hs-var">l</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-1354"></span><span>
</span><span id="line-1355"></span><span class="hs-comment">-- needs:</span><span>
</span><span id="line-1356"></span><span class="hs-comment">--</span><span>
</span><span id="line-1357"></span><span class="hs-comment">-- * getEntityFields</span><span>
</span><span id="line-1358"></span><span class="hs-comment">--     * sumConstrName on field</span><span>
</span><span id="line-1359"></span><span class="hs-comment">-- * fromValues</span><span>
</span><span id="line-1360"></span><span class="hs-comment">-- * entityHaskell</span><span>
</span><span id="line-1361"></span><span class="hs-comment">-- * sumConstrName</span><span>
</span><span id="line-1362"></span><span class="hs-comment">-- * entityDefConE</span><span>
</span><span id="line-1363"></span><span class="hs-comment">--</span><span>
</span><span id="line-1364"></span><span class="hs-comment">--</span><span>
</span><span id="line-1365"></span><span class="annot"><a href="Database.Persist.TH.html#mkFromPersistValues"><span class="hs-identifier hs-type">mkFromPersistValues</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><a href="Database.Persist.TH.html#MkPersistSettings"><span class="hs-identifier hs-type">MkPersistSettings</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="Database.Persist.Quasi.Internal.html#UnboundEntityDef"><span class="hs-identifier hs-type">UnboundEntityDef</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="hs-identifier hs-type">Q</span></span><span> </span><span class="hs-special">[</span><span class="annot"><span class="hs-identifier hs-type">Clause</span></span><span class="hs-special">]</span><span>
</span><span id="line-1366"></span><span id="mkFromPersistValues"><span class="annot"><span class="annottext">mkFromPersistValues :: MkPersistSettings -&gt; UnboundEntityDef -&gt; Q [Clause]
</span><a href="Database.Persist.TH.html#mkFromPersistValues"><span class="hs-identifier hs-var hs-var">mkFromPersistValues</span></a></span></span><span> </span><span id="local-6989586621679964761"><span class="annot"><span class="annottext">MkPersistSettings
</span><a href="#local-6989586621679964761"><span class="hs-identifier hs-var">mps</span></a></span></span><span> </span><span id="local-6989586621679964760"><span class="annot"><span class="annottext">UnboundEntityDef
</span><a href="#local-6989586621679964760"><span class="hs-identifier hs-var">entDef</span></a></span></span><span>
</span><span id="line-1367"></span><span>    </span><span class="hs-glyph">|</span><span> </span><span class="annot"><span class="annottext">UnboundEntityDef -&gt; Bool
</span><a href="Database.Persist.TH.html#unboundEntitySum"><span class="hs-identifier hs-var">unboundEntitySum</span></a></span><span> </span><span class="annot"><span class="annottext">UnboundEntityDef
</span><a href="#local-6989586621679964760"><span class="hs-identifier hs-var">entDef</span></a></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-keyword">do</span><span>
</span><span id="line-1368"></span><span>        </span><span id="local-6989586621679964759"><span class="annot"><span class="annottext">Exp
</span><a href="#local-6989586621679964759"><span class="hs-identifier hs-var">nothing</span></a></span></span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="hs-special">[|</span><span class="hs-identifier">Left</span><span> </span><span class="hs-special">(</span><span class="hs-string">&quot;Invalid fromPersistValues input: sum type with all nulls. Entity: &quot;</span><span> </span><span class="hs-special">`</span><span class="hs-identifier">mappend</span><span class="hs-special">`</span><span> </span><span class="hs-identifier">entName</span><span class="hs-special">)</span><span class="hs-special">|]</span><span>
</span><span id="line-1369"></span><span>        </span><span id="local-6989586621679964758"><span class="annot"><span class="annottext">[Clause]
</span><a href="#local-6989586621679964758"><span class="hs-identifier hs-var">clauses</span></a></span></span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">[UnboundFieldDef] -&gt; [UnboundFieldDef] -&gt; Q [Clause]
</span><a href="#local-6989586621679964757"><span class="hs-identifier hs-var">mkClauses</span></a></span><span> </span><span class="hs-special">[</span><span class="hs-special">]</span><span> </span><span class="annot"><span class="annottext">forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span> </span><span class="annot"><span class="annottext">UnboundEntityDef -&gt; [UnboundFieldDef]
</span><a href="Database.Persist.Quasi.Internal.html#getUnboundFieldDefs"><span class="hs-identifier hs-var">getUnboundFieldDefs</span></a></span><span> </span><span class="annot"><span class="annottext">UnboundEntityDef
</span><a href="#local-6989586621679964760"><span class="hs-identifier hs-var">entDef</span></a></span><span>
</span><span id="line-1370"></span><span>        </span><span class="annot"><span class="annottext">forall (m :: * -&gt; *) a. Monad m =&gt; a -&gt; m a
</span><span class="hs-identifier hs-var">return</span></span><span> </span><span class="annot"><span class="annottext">forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span> </span><span class="annot"><span class="annottext">[Clause]
</span><a href="#local-6989586621679964758"><span class="hs-identifier hs-var">clauses</span></a></span><span> </span><span class="annot"><span class="annottext">forall m. Monoid m =&gt; m -&gt; m -&gt; m
</span><span class="hs-operator hs-var">`mappend`</span></span><span> </span><span class="hs-special">[</span><span class="annot"><span class="annottext">[Pat] -&gt; Exp -&gt; Clause
</span><a href="Database.Persist.TH.html#normalClause"><span class="hs-identifier hs-var">normalClause</span></a></span><span> </span><span class="hs-special">[</span><span class="annot"><span class="annottext">Pat
</span><span class="hs-identifier hs-var">WildP</span></span><span class="hs-special">]</span><span> </span><span class="annot"><span class="annottext">Exp
</span><a href="#local-6989586621679964759"><span class="hs-identifier hs-var">nothing</span></a></span><span class="hs-special">]</span><span>
</span><span id="line-1371"></span><span>    </span><span class="hs-glyph">|</span><span> </span><span class="annot"><span class="annottext">Bool
</span><span class="hs-identifier hs-var">otherwise</span></span><span> </span><span class="hs-glyph">=</span><span>
</span><span id="line-1372"></span><span>        </span><span class="annot"><span class="annottext">UnboundEntityDef -&gt; Text -&gt; Exp -&gt; [FieldNameHS] -&gt; Q [Clause]
</span><a href="Database.Persist.TH.html#fromValues"><span class="hs-identifier hs-var">fromValues</span></a></span><span> </span><span class="annot"><span class="annottext">UnboundEntityDef
</span><a href="#local-6989586621679964760"><span class="hs-identifier hs-var">entDef</span></a></span><span> </span><span class="annot"><span class="annottext">Text
</span><span class="hs-string">&quot;fromPersistValues&quot;</span></span><span> </span><span class="annot"><span class="annottext">Exp
</span><a href="#local-6989586621679964755"><span class="hs-identifier hs-var">entE</span></a></span><span>
</span><span id="line-1373"></span><span>        </span><span class="annot"><span class="annottext">forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span> </span><span class="annot"><span class="annottext">forall (f :: * -&gt; *) a b. Functor f =&gt; (a -&gt; b) -&gt; f a -&gt; f b
</span><span class="hs-identifier hs-var">fmap</span></span><span> </span><span class="annot"><span class="annottext">UnboundFieldDef -&gt; FieldNameHS
</span><a href="Database.Persist.Quasi.Internal.html#unboundFieldNameHS"><span class="hs-identifier hs-var">unboundFieldNameHS</span></a></span><span>
</span><span id="line-1374"></span><span>        </span><span class="annot"><span class="annottext">forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span> </span><span class="annot"><span class="annottext">forall a. (a -&gt; Bool) -&gt; [a] -&gt; [a]
</span><span class="hs-identifier hs-var">filter</span></span><span> </span><span class="annot"><span class="annottext">UnboundFieldDef -&gt; Bool
</span><a href="Database.Persist.Quasi.Internal.html#isHaskellUnboundField"><span class="hs-identifier hs-var">isHaskellUnboundField</span></a></span><span>
</span><span id="line-1375"></span><span>        </span><span class="annot"><span class="annottext">forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span> </span><span class="annot"><span class="annottext">UnboundEntityDef -&gt; [UnboundFieldDef]
</span><a href="Database.Persist.Quasi.Internal.html#getUnboundFieldDefs"><span class="hs-identifier hs-var">getUnboundFieldDefs</span></a></span><span> </span><span class="annot"><span class="annottext">UnboundEntityDef
</span><a href="#local-6989586621679964760"><span class="hs-identifier hs-var">entDef</span></a></span><span>
</span><span id="line-1376"></span><span>  </span><span class="hs-keyword">where</span><span>
</span><span id="line-1377"></span><span>    </span><span id="local-6989586621679964754"><span class="annot"><span class="annottext">entName :: Text
</span><a href="#local-6989586621679964754"><span class="hs-identifier hs-var hs-var">entName</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">EntityNameHS -&gt; Text
</span><a href="Database.Persist.Names.html#unEntityNameHS"><span class="hs-identifier hs-var">unEntityNameHS</span></a></span><span> </span><span class="annot"><span class="annottext">forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span> </span><span class="annot"><span class="annottext">UnboundEntityDef -&gt; EntityNameHS
</span><a href="Database.Persist.Quasi.Internal.html#getUnboundEntityNameHS"><span class="hs-identifier hs-var">getUnboundEntityNameHS</span></a></span><span> </span><span class="annot"><span class="annottext">UnboundEntityDef
</span><a href="#local-6989586621679964760"><span class="hs-identifier hs-var">entDef</span></a></span><span>
</span><span id="line-1378"></span><span>    </span><span id="local-6989586621679964757"><span class="annot"><span class="annottext">mkClauses :: [UnboundFieldDef] -&gt; [UnboundFieldDef] -&gt; Q [Clause]
</span><a href="#local-6989586621679964757"><span class="hs-identifier hs-var hs-var">mkClauses</span></a></span></span><span> </span><span class="annot"><span class="annottext">[UnboundFieldDef]
</span><span class="hs-identifier">_</span></span><span> </span><span class="hs-special">[</span><span class="hs-special">]</span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">forall (m :: * -&gt; *) a. Monad m =&gt; a -&gt; m a
</span><span class="hs-identifier hs-var">return</span></span><span> </span><span class="hs-special">[</span><span class="hs-special">]</span><span>
</span><span id="line-1379"></span><span>    </span><span class="annot"><a href="#local-6989586621679964757"><span class="hs-identifier hs-var">mkClauses</span></a></span><span> </span><span id="local-6989586621679964753"><span class="annot"><span class="annottext">[UnboundFieldDef]
</span><a href="#local-6989586621679964753"><span class="hs-identifier hs-var">before</span></a></span></span><span> </span><span class="hs-special">(</span><span id="local-6989586621679964752"><span class="annot"><span class="annottext">UnboundFieldDef
</span><a href="#local-6989586621679964752"><span class="hs-identifier hs-var">field</span></a></span></span><span class="annot"><span class="hs-glyph hs-type">:</span></span><span id="local-6989586621679964751"><span class="annot"><span class="annottext">[UnboundFieldDef]
</span><a href="#local-6989586621679964751"><span class="hs-identifier hs-var">after</span></a></span></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-keyword">do</span><span>
</span><span id="line-1380"></span><span>        </span><span id="local-6989586621679964750"><span class="annot"><span class="annottext">Name
</span><a href="#local-6989586621679964750"><span class="hs-identifier hs-var">x</span></a></span></span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">forall (m :: * -&gt; *). Quote m =&gt; String -&gt; m Name
</span><span class="hs-identifier hs-var">newName</span></span><span> </span><span class="annot"><span class="annottext">String
</span><span class="hs-string">&quot;x&quot;</span></span><span>
</span><span id="line-1381"></span><span>        </span><span class="hs-keyword">let</span><span> </span><span id="local-6989586621679964749"><span class="annot"><span class="annottext">null' :: Pat
</span><a href="#local-6989586621679964749"><span class="hs-identifier hs-var hs-var">null'</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">Name -&gt; [Pat] -&gt; Pat
</span><a href="Database.Persist.TH.html#conp"><span class="hs-identifier hs-var">conp</span></a></span><span> </span><span class="hs-special">'</span><span class="hs-identifier">PersistNull</span><span> </span><span class="hs-special">[</span><span class="hs-special">]</span><span>
</span><span id="line-1382"></span><span>            </span><span id="local-6989586621679964748"><span class="annot"><span class="annottext">pat :: Pat
</span><a href="#local-6989586621679964748"><span class="hs-identifier hs-var hs-var">pat</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">[Pat] -&gt; Pat
</span><span class="hs-identifier hs-var">ListP</span></span><span> </span><span class="annot"><span class="annottext">forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span> </span><span class="annot"><span class="annottext">forall a. Monoid a =&gt; [a] -&gt; a
</span><span class="hs-identifier hs-var">mconcat</span></span><span>
</span><span id="line-1383"></span><span>                </span><span class="hs-special">[</span><span> </span><span class="annot"><span class="annottext">forall (f :: * -&gt; *) a b. Functor f =&gt; (a -&gt; b) -&gt; f a -&gt; f b
</span><span class="hs-identifier hs-var">fmap</span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">forall a b. a -&gt; b -&gt; a
</span><span class="hs-identifier hs-var">const</span></span><span> </span><span class="annot"><span class="annottext">Pat
</span><a href="#local-6989586621679964749"><span class="hs-identifier hs-var">null'</span></a></span><span class="hs-special">)</span><span> </span><span class="annot"><span class="annottext">[UnboundFieldDef]
</span><a href="#local-6989586621679964753"><span class="hs-identifier hs-var">before</span></a></span><span>
</span><span id="line-1384"></span><span>                </span><span class="hs-special">,</span><span> </span><span class="hs-special">[</span><span class="annot"><span class="annottext">Name -&gt; Pat
</span><span class="hs-identifier hs-var">VarP</span></span><span> </span><span class="annot"><span class="annottext">Name
</span><a href="#local-6989586621679964750"><span class="hs-identifier hs-var">x</span></a></span><span class="hs-special">]</span><span>
</span><span id="line-1385"></span><span>                </span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">forall (f :: * -&gt; *) a b. Functor f =&gt; (a -&gt; b) -&gt; f a -&gt; f b
</span><span class="hs-identifier hs-var">fmap</span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">forall a b. a -&gt; b -&gt; a
</span><span class="hs-identifier hs-var">const</span></span><span> </span><span class="annot"><span class="annottext">Pat
</span><a href="#local-6989586621679964749"><span class="hs-identifier hs-var">null'</span></a></span><span class="hs-special">)</span><span> </span><span class="annot"><span class="annottext">[UnboundFieldDef]
</span><a href="#local-6989586621679964751"><span class="hs-identifier hs-var">after</span></a></span><span>
</span><span id="line-1386"></span><span>                </span><span class="hs-special">]</span><span>
</span><span id="line-1387"></span><span>            </span><span id="local-6989586621679964746"><span class="annot"><span class="annottext">constr :: Exp
</span><a href="#local-6989586621679964746"><span class="hs-identifier hs-var hs-var">constr</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">Name -&gt; Exp
</span><span class="hs-identifier hs-var">ConE</span></span><span> </span><span class="annot"><span class="annottext">forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span> </span><span class="annot"><span class="annottext">MkPersistSettings -&gt; UnboundEntityDef -&gt; UnboundFieldDef -&gt; Name
</span><a href="Database.Persist.TH.html#sumConstrName"><span class="hs-identifier hs-var">sumConstrName</span></a></span><span> </span><span class="annot"><span class="annottext">MkPersistSettings
</span><a href="#local-6989586621679964761"><span class="hs-identifier hs-var">mps</span></a></span><span> </span><span class="annot"><span class="annottext">UnboundEntityDef
</span><a href="#local-6989586621679964760"><span class="hs-identifier hs-var">entDef</span></a></span><span> </span><span class="annot"><span class="annottext">UnboundFieldDef
</span><a href="#local-6989586621679964752"><span class="hs-identifier hs-var">field</span></a></span><span>
</span><span id="line-1388"></span><span>        </span><span id="local-6989586621679964745"><span class="annot"><span class="annottext">Exp
</span><a href="#local-6989586621679964745"><span class="hs-identifier hs-var">fs</span></a></span></span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="hs-special">[|</span><span class="hs-identifier">fromPersistValue</span><span> </span><span class="hs-special">$</span><span class="hs-special">(</span><span class="hs-identifier">return</span><span> </span><span class="hs-operator">$</span><span> </span><span class="hs-identifier">VarE</span><span> </span><span class="hs-identifier">x</span><span class="hs-special">)</span><span class="hs-special">|]</span><span>
</span><span id="line-1389"></span><span>        </span><span class="hs-keyword">let</span><span> </span><span id="local-6989586621679964744"><span class="annot"><span class="annottext">guard' :: Guard
</span><a href="#local-6989586621679964744"><span class="hs-identifier hs-var hs-var">guard'</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">Exp -&gt; Guard
</span><span class="hs-identifier hs-var">NormalG</span></span><span> </span><span class="annot"><span class="annottext">forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span> </span><span class="annot"><span class="annottext">Name -&gt; Exp
</span><span class="hs-identifier hs-var">VarE</span></span><span> </span><span class="hs-special">'</span><span class="hs-identifier">isNotNull</span><span> </span><span class="annot"><span class="annottext">Exp -&gt; Exp -&gt; Exp
</span><span class="hs-operator hs-var">`AppE`</span></span><span> </span><span class="annot"><span class="annottext">Name -&gt; Exp
</span><span class="hs-identifier hs-var">VarE</span></span><span> </span><span class="annot"><span class="annottext">Name
</span><a href="#local-6989586621679964750"><span class="hs-identifier hs-var">x</span></a></span><span>
</span><span id="line-1390"></span><span>        </span><span class="hs-keyword">let</span><span> </span><span id="local-6989586621679964742"><span class="annot"><span class="annottext">clause :: Clause
</span><a href="#local-6989586621679964742"><span class="hs-identifier hs-var hs-var">clause</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">[Pat] -&gt; Body -&gt; [Dec] -&gt; Clause
</span><span class="hs-identifier hs-var">Clause</span></span><span> </span><span class="hs-special">[</span><span class="annot"><span class="annottext">Pat
</span><a href="#local-6989586621679964748"><span class="hs-identifier hs-var">pat</span></a></span><span class="hs-special">]</span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">[(Guard, Exp)] -&gt; Body
</span><span class="hs-identifier hs-var">GuardedB</span></span><span> </span><span class="hs-special">[</span><span class="hs-special">(</span><span class="annot"><span class="annottext">Guard
</span><a href="#local-6989586621679964744"><span class="hs-identifier hs-var">guard'</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">Maybe Exp -&gt; Exp -&gt; Maybe Exp -&gt; Exp
</span><span class="hs-identifier hs-var">InfixE</span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">forall a. a -&gt; Maybe a
</span><span class="hs-identifier hs-var">Just</span></span><span> </span><span class="annot"><span class="annottext">Exp
</span><a href="#local-6989586621679964746"><span class="hs-identifier hs-var">constr</span></a></span><span class="hs-special">)</span><span> </span><span class="annot"><span class="annottext">Exp
</span><a href="Database.Persist.TH.html#fmapE"><span class="hs-identifier hs-var">fmapE</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">forall a. a -&gt; Maybe a
</span><span class="hs-identifier hs-var">Just</span></span><span> </span><span class="annot"><span class="annottext">Exp
</span><a href="#local-6989586621679964745"><span class="hs-identifier hs-var">fs</span></a></span><span class="hs-special">)</span><span class="hs-special">)</span><span class="hs-special">]</span><span class="hs-special">)</span><span> </span><span class="hs-special">[</span><span class="hs-special">]</span><span>
</span><span id="line-1391"></span><span>        </span><span id="local-6989586621679964737"><span class="annot"><span class="annottext">[Clause]
</span><a href="#local-6989586621679964737"><span class="hs-identifier hs-var">clauses</span></a></span></span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">[UnboundFieldDef] -&gt; [UnboundFieldDef] -&gt; Q [Clause]
</span><a href="#local-6989586621679964757"><span class="hs-identifier hs-var">mkClauses</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">UnboundFieldDef
</span><a href="#local-6989586621679964752"><span class="hs-identifier hs-var">field</span></a></span><span> </span><span class="annot"><span class="annottext">forall a. a -&gt; [a] -&gt; [a]
</span><span class="hs-glyph hs-var">:</span></span><span> </span><span class="annot"><span class="annottext">[UnboundFieldDef]
</span><a href="#local-6989586621679964753"><span class="hs-identifier hs-var">before</span></a></span><span class="hs-special">)</span><span> </span><span class="annot"><span class="annottext">[UnboundFieldDef]
</span><a href="#local-6989586621679964751"><span class="hs-identifier hs-var">after</span></a></span><span>
</span><span id="line-1392"></span><span>        </span><span class="annot"><span class="annottext">forall (m :: * -&gt; *) a. Monad m =&gt; a -&gt; m a
</span><span class="hs-identifier hs-var">return</span></span><span> </span><span class="annot"><span class="annottext">forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span> </span><span class="annot"><span class="annottext">Clause
</span><a href="#local-6989586621679964742"><span class="hs-identifier hs-var">clause</span></a></span><span> </span><span class="annot"><span class="annottext">forall a. a -&gt; [a] -&gt; [a]
</span><span class="hs-glyph hs-var">:</span></span><span> </span><span class="annot"><span class="annottext">[Clause]
</span><a href="#local-6989586621679964737"><span class="hs-identifier hs-var">clauses</span></a></span><span>
</span><span id="line-1393"></span><span>    </span><span id="local-6989586621679964755"><span class="annot"><span class="annottext">entE :: Exp
</span><a href="#local-6989586621679964755"><span class="hs-identifier hs-var hs-var">entE</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">UnboundEntityDef -&gt; Exp
</span><a href="Database.Persist.TH.html#entityDefConE"><span class="hs-identifier hs-var">entityDefConE</span></a></span><span> </span><span class="annot"><span class="annottext">UnboundEntityDef
</span><a href="#local-6989586621679964760"><span class="hs-identifier hs-var">entDef</span></a></span><span>
</span><span id="line-1394"></span><span>
</span><span id="line-1395"></span><span>
</span><span id="line-1396"></span><span class="hs-keyword">type</span><span> </span><span id="Lens"><span class="annot"><a href="Database.Persist.TH.html#Lens"><span class="hs-identifier hs-var">Lens</span></a></span></span><span> </span><span id="local-6989586621679964735"><span class="annot"><a href="#local-6989586621679964735"><span class="hs-identifier hs-type">s</span></a></span></span><span> </span><span id="local-6989586621679964734"><span class="annot"><a href="#local-6989586621679964734"><span class="hs-identifier hs-type">t</span></a></span></span><span> </span><span id="local-6989586621679964733"><span class="annot"><a href="#local-6989586621679964733"><span class="hs-identifier hs-type">a</span></a></span></span><span> </span><span id="local-6989586621679964732"><span class="annot"><a href="#local-6989586621679964732"><span class="hs-identifier hs-type">b</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-keyword">forall</span><span> </span><span id="local-6989586621679964731"><span class="annot"><a href="#local-6989586621679964731"><span class="hs-identifier hs-type">f</span></a></span></span><span class="hs-operator">.</span><span> </span><span class="annot"><span class="hs-identifier hs-type">Functor</span></span><span> </span><span class="annot"><a href="#local-6989586621679964731"><span class="hs-identifier hs-type">f</span></a></span><span> </span><span class="hs-glyph">=&gt;</span><span> </span><span class="hs-special">(</span><span class="annot"><a href="#local-6989586621679964733"><span class="hs-identifier hs-type">a</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="#local-6989586621679964731"><span class="hs-identifier hs-type">f</span></a></span><span> </span><span class="annot"><a href="#local-6989586621679964732"><span class="hs-identifier hs-type">b</span></a></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="#local-6989586621679964735"><span class="hs-identifier hs-type">s</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="#local-6989586621679964731"><span class="hs-identifier hs-type">f</span></a></span><span> </span><span class="annot"><a href="#local-6989586621679964734"><span class="hs-identifier hs-type">t</span></a></span><span>
</span><span id="line-1397"></span><span>
</span><span id="line-1398"></span><span id="local-6989586621679966441"><span id="local-6989586621679966442"><span id="local-6989586621679966443"><span id="local-6989586621679966444"><span class="annot"><a href="Database.Persist.TH.html#lensPTH"><span class="hs-identifier hs-type">lensPTH</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="hs-special">(</span><span class="annot"><a href="#local-6989586621679966444"><span class="hs-identifier hs-type">s</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="#local-6989586621679966443"><span class="hs-identifier hs-type">a</span></a></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-special">(</span><span class="annot"><a href="#local-6989586621679966444"><span class="hs-identifier hs-type">s</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="#local-6989586621679966442"><span class="hs-identifier hs-type">b</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="#local-6989586621679966441"><span class="hs-identifier hs-type">t</span></a></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="Database.Persist.TH.html#Lens"><span class="hs-identifier hs-type">Lens</span></a></span><span> </span><span class="annot"><a href="#local-6989586621679966444"><span class="hs-identifier hs-type">s</span></a></span><span> </span><span class="annot"><a href="#local-6989586621679966441"><span class="hs-identifier hs-type">t</span></a></span><span> </span><span class="annot"><a href="#local-6989586621679966443"><span class="hs-identifier hs-type">a</span></a></span><span> </span><span class="annot"><a href="#local-6989586621679966442"><span class="hs-identifier hs-type">b</span></a></span></span></span></span></span><span>
</span><span id="line-1399"></span><span id="lensPTH"><span class="annot"><span class="annottext">lensPTH :: forall s a b t. (s -&gt; a) -&gt; (s -&gt; b -&gt; t) -&gt; Lens s t a b
</span><a href="Database.Persist.TH.html#lensPTH"><span class="hs-identifier hs-var hs-var">lensPTH</span></a></span></span><span> </span><span id="local-6989586621679964726"><span class="annot"><span class="annottext">s -&gt; a
</span><a href="#local-6989586621679964726"><span class="hs-identifier hs-var">sa</span></a></span></span><span> </span><span id="local-6989586621679964725"><span class="annot"><span class="annottext">s -&gt; b -&gt; t
</span><a href="#local-6989586621679964725"><span class="hs-identifier hs-var">sbt</span></a></span></span><span> </span><span id="local-6989586621679964724"><span class="annot"><span class="annottext">a -&gt; f b
</span><a href="#local-6989586621679964724"><span class="hs-identifier hs-var">afb</span></a></span></span><span> </span><span id="local-6989586621679964723"><span class="annot"><span class="annottext">s
</span><a href="#local-6989586621679964723"><span class="hs-identifier hs-var">s</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">forall (f :: * -&gt; *) a b. Functor f =&gt; (a -&gt; b) -&gt; f a -&gt; f b
</span><span class="hs-identifier hs-var">fmap</span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">s -&gt; b -&gt; t
</span><a href="#local-6989586621679964725"><span class="hs-identifier hs-var">sbt</span></a></span><span> </span><span class="annot"><span class="annottext">s
</span><a href="#local-6989586621679964723"><span class="hs-identifier hs-var">s</span></a></span><span class="hs-special">)</span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">a -&gt; f b
</span><a href="#local-6989586621679964724"><span class="hs-identifier hs-var">afb</span></a></span><span> </span><span class="annot"><span class="annottext">forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span> </span><span class="annot"><span class="annottext">s -&gt; a
</span><a href="#local-6989586621679964726"><span class="hs-identifier hs-var">sa</span></a></span><span> </span><span class="annot"><span class="annottext">s
</span><a href="#local-6989586621679964723"><span class="hs-identifier hs-var">s</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-1400"></span><span>
</span><span id="line-1401"></span><span class="annot"><a href="Database.Persist.TH.html#fmapE"><span class="hs-identifier hs-type">fmapE</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><span class="hs-identifier hs-type">Exp</span></span><span>
</span><span id="line-1402"></span><span id="fmapE"><span class="annot"><span class="annottext">fmapE :: Exp
</span><a href="Database.Persist.TH.html#fmapE"><span class="hs-identifier hs-var hs-var">fmapE</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">Name -&gt; Exp
</span><span class="hs-identifier hs-var">VarE</span></span><span> </span><span class="hs-special">'</span><span class="hs-identifier">fmap</span><span>
</span><span id="line-1403"></span><span>
</span><span id="line-1404"></span><span class="annot"><a href="Database.Persist.TH.html#unboundEntitySum"><span class="hs-identifier hs-type">unboundEntitySum</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><a href="Database.Persist.Quasi.Internal.html#UnboundEntityDef"><span class="hs-identifier hs-type">UnboundEntityDef</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="hs-identifier hs-type">Bool</span></span><span>
</span><span id="line-1405"></span><span id="unboundEntitySum"><span class="annot"><span class="annottext">unboundEntitySum :: UnboundEntityDef -&gt; Bool
</span><a href="Database.Persist.TH.html#unboundEntitySum"><span class="hs-identifier hs-var hs-var">unboundEntitySum</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">EntityDef -&gt; Bool
</span><a href="Database.Persist.Types.Base.html#entitySum"><span class="hs-identifier hs-var">entitySum</span></a></span><span> </span><span class="annot"><span class="annottext">forall b c a. (b -&gt; c) -&gt; (a -&gt; b) -&gt; a -&gt; c
</span><span class="hs-operator hs-var">.</span></span><span> </span><span class="annot"><span class="annottext">UnboundEntityDef -&gt; EntityDef
</span><a href="Database.Persist.Quasi.Internal.html#unboundEntityDef"><span class="hs-identifier hs-var">unboundEntityDef</span></a></span><span>
</span><span id="line-1406"></span><span>
</span><span id="line-1407"></span><span class="annot"><a href="Database.Persist.TH.html#fieldSel"><span class="hs-identifier hs-type">fieldSel</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><span class="hs-identifier hs-type">Name</span></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="hs-identifier hs-type">Name</span></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="hs-identifier hs-type">Exp</span></span><span>
</span><span id="line-1408"></span><span id="fieldSel"><span class="annot"><span class="annottext">fieldSel :: Name -&gt; Name -&gt; Exp
</span><a href="Database.Persist.TH.html#fieldSel"><span class="hs-identifier hs-var hs-var">fieldSel</span></a></span></span><span> </span><span id="local-6989586621679964720"><span class="annot"><span class="annottext">Name
</span><a href="#local-6989586621679964720"><span class="hs-identifier hs-var">conName</span></a></span></span><span> </span><span id="local-6989586621679964719"><span class="annot"><span class="annottext">Name
</span><a href="#local-6989586621679964719"><span class="hs-identifier hs-var">fieldName</span></a></span></span><span>
</span><span id="line-1409"></span><span>    </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">[Pat] -&gt; Exp -&gt; Exp
</span><span class="hs-identifier hs-var">LamE</span></span><span> </span><span class="hs-special">[</span><span class="annot"><span class="annottext">Name -&gt; [FieldPat] -&gt; Pat
</span><span class="hs-identifier hs-var">RecP</span></span><span> </span><span class="annot"><span class="annottext">Name
</span><a href="#local-6989586621679964720"><span class="hs-identifier hs-var">conName</span></a></span><span> </span><span class="hs-special">[</span><span class="hs-special">(</span><span class="annot"><span class="annottext">Name
</span><a href="#local-6989586621679964719"><span class="hs-identifier hs-var">fieldName</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">Name -&gt; Pat
</span><span class="hs-identifier hs-var">VarP</span></span><span> </span><span class="annot"><span class="annottext">Name
</span><a href="#local-6989586621679964717"><span class="hs-identifier hs-var">xName</span></a></span><span class="hs-special">)</span><span class="hs-special">]</span><span class="hs-special">]</span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Name -&gt; Exp
</span><span class="hs-identifier hs-var">VarE</span></span><span> </span><span class="annot"><span class="annottext">Name
</span><a href="#local-6989586621679964717"><span class="hs-identifier hs-var">xName</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-1410"></span><span>  </span><span class="hs-keyword">where</span><span>
</span><span id="line-1411"></span><span>      </span><span id="local-6989586621679964717"><span class="annot"><span class="annottext">xName :: Name
</span><a href="#local-6989586621679964717"><span class="hs-identifier hs-var hs-var">xName</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">String -&gt; Name
</span><span class="hs-identifier hs-var">mkName</span></span><span> </span><span class="annot"><span class="annottext">String
</span><span class="hs-string">&quot;x&quot;</span></span><span>
</span><span id="line-1412"></span><span>
</span><span id="line-1413"></span><span class="annot"><a href="Database.Persist.TH.html#fieldUpd"><span class="hs-identifier hs-type">fieldUpd</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><span class="hs-identifier hs-type">Name</span></span><span> </span><span class="hs-comment">-- ^ constructor name</span><span>
</span><span id="line-1414"></span><span>    </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-special">[</span><span class="annot"><span class="hs-identifier hs-type">Name</span></span><span class="hs-special">]</span><span> </span><span class="hs-comment">-- ^ list of field names</span><span>
</span><span id="line-1415"></span><span>    </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="hs-identifier hs-type">Exp</span></span><span> </span><span class="hs-comment">-- ^ record value</span><span>
</span><span id="line-1416"></span><span>    </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="hs-identifier hs-type">Name</span></span><span> </span><span class="hs-comment">-- ^ field name to update</span><span>
</span><span id="line-1417"></span><span>    </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="hs-identifier hs-type">Exp</span></span><span> </span><span class="hs-comment">-- ^ new value</span><span>
</span><span id="line-1418"></span><span>    </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="hs-identifier hs-type">Exp</span></span><span>
</span><span id="line-1419"></span><span id="fieldUpd"><span class="annot"><span class="annottext">fieldUpd :: Name -&gt; [Name] -&gt; Exp -&gt; Name -&gt; Exp -&gt; Exp
</span><a href="Database.Persist.TH.html#fieldUpd"><span class="hs-identifier hs-var hs-var">fieldUpd</span></a></span></span><span> </span><span id="local-6989586621679964715"><span class="annot"><span class="annottext">Name
</span><a href="#local-6989586621679964715"><span class="hs-identifier hs-var">con</span></a></span></span><span> </span><span id="local-6989586621679964714"><span class="annot"><span class="annottext">[Name]
</span><a href="#local-6989586621679964714"><span class="hs-identifier hs-var">names</span></a></span></span><span> </span><span id="local-6989586621679964713"><span class="annot"><span class="annottext">Exp
</span><a href="#local-6989586621679964713"><span class="hs-identifier hs-var">record</span></a></span></span><span> </span><span id="local-6989586621679964712"><span class="annot"><span class="annottext">Name
</span><a href="#local-6989586621679964712"><span class="hs-identifier hs-var">name</span></a></span></span><span> </span><span id="local-6989586621679964711"><span class="annot"><span class="annottext">Exp
</span><a href="#local-6989586621679964711"><span class="hs-identifier hs-var">new</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">Exp -&gt; [Match] -&gt; Exp
</span><span class="hs-identifier hs-var">CaseE</span></span><span> </span><span class="annot"><span class="annottext">Exp
</span><a href="#local-6989586621679964713"><span class="hs-identifier hs-var">record</span></a></span><span>
</span><span id="line-1420"></span><span>    </span><span class="hs-special">[</span><span> </span><span class="annot"><span class="annottext">Pat -&gt; Body -&gt; [Dec] -&gt; Match
</span><span class="hs-identifier hs-var">Match</span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Name -&gt; [FieldPat] -&gt; Pat
</span><span class="hs-identifier hs-var">RecP</span></span><span> </span><span class="annot"><span class="annottext">Name
</span><a href="#local-6989586621679964715"><span class="hs-identifier hs-var">con</span></a></span><span> </span><span class="annot"><span class="annottext">[FieldPat]
</span><a href="#local-6989586621679964708"><span class="hs-identifier hs-var">pats</span></a></span><span class="hs-special">)</span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Exp -&gt; Body
</span><span class="hs-identifier hs-var">NormalB</span></span><span> </span><span class="annot"><span class="annottext">Exp
</span><a href="#local-6989586621679964706"><span class="hs-identifier hs-var">body</span></a></span><span class="hs-special">)</span><span> </span><span class="hs-special">[</span><span class="hs-special">]</span><span class="hs-special">]</span><span>
</span><span id="line-1421"></span><span>    </span><span class="hs-keyword">where</span><span>
</span><span id="line-1422"></span><span>        </span><span id="local-6989586621679964706"><span class="annot"><span class="annottext">body :: Exp
</span><a href="#local-6989586621679964706"><span class="hs-identifier hs-var hs-var">body</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">Name -&gt; [FieldExp] -&gt; Exp
</span><span class="hs-identifier hs-var">RecConE</span></span><span> </span><span class="annot"><span class="annottext">Name
</span><a href="#local-6989586621679964715"><span class="hs-identifier hs-var">con</span></a></span><span>
</span><span id="line-1423"></span><span>            </span><span class="hs-special">[</span><span> </span><span class="hs-keyword">if</span><span> </span><span class="annot"><span class="annottext">Name
</span><a href="#local-6989586621679964704"><span class="hs-identifier hs-var">k</span></a></span><span> </span><span class="annot"><span class="annottext">forall a. Eq a =&gt; a -&gt; a -&gt; Bool
</span><span class="hs-operator hs-var">==</span></span><span> </span><span class="annot"><span class="annottext">Name
</span><a href="#local-6989586621679964712"><span class="hs-identifier hs-var">name</span></a></span><span> </span><span class="hs-keyword">then</span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Name
</span><a href="#local-6989586621679964712"><span class="hs-identifier hs-var">name</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">Exp
</span><a href="#local-6989586621679964711"><span class="hs-identifier hs-var">new</span></a></span><span class="hs-special">)</span><span> </span><span class="hs-keyword">else</span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Name
</span><a href="#local-6989586621679964704"><span class="hs-identifier hs-var">k</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">Name -&gt; Exp
</span><span class="hs-identifier hs-var">VarE</span></span><span> </span><span class="annot"><span class="annottext">Name
</span><a href="#local-6989586621679964704"><span class="hs-identifier hs-var">k</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-1424"></span><span>            </span><span class="hs-glyph">|</span><span> </span><span id="local-6989586621679964704"><span class="annot"><span class="annottext">Name
</span><a href="#local-6989586621679964704"><span class="hs-identifier hs-var">k</span></a></span></span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">[Name]
</span><a href="#local-6989586621679964714"><span class="hs-identifier hs-var">names</span></a></span><span>
</span><span id="line-1425"></span><span>            </span><span class="hs-special">]</span><span>
</span><span id="line-1426"></span><span>        </span><span id="local-6989586621679964708"><span class="annot"><span class="annottext">pats :: [FieldPat]
</span><a href="#local-6989586621679964708"><span class="hs-identifier hs-var hs-var">pats</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-special">[</span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Name
</span><a href="#local-6989586621679964703"><span class="hs-identifier hs-var">k</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">Name -&gt; Pat
</span><span class="hs-identifier hs-var">VarP</span></span><span> </span><span class="annot"><span class="annottext">Name
</span><a href="#local-6989586621679964703"><span class="hs-identifier hs-var">k</span></a></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">|</span><span> </span><span id="local-6989586621679964703"><span class="annot"><span class="annottext">Name
</span><a href="#local-6989586621679964703"><span class="hs-identifier hs-var">k</span></a></span></span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">[Name]
</span><a href="#local-6989586621679964714"><span class="hs-identifier hs-var">names</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">Name
</span><a href="#local-6989586621679964703"><span class="hs-identifier hs-var">k</span></a></span><span> </span><span class="annot"><span class="annottext">forall a. Eq a =&gt; a -&gt; a -&gt; Bool
</span><span class="hs-operator hs-var">/=</span></span><span> </span><span class="annot"><span class="annottext">Name
</span><a href="#local-6989586621679964712"><span class="hs-identifier hs-var">name</span></a></span><span class="hs-special">]</span><span>
</span><span id="line-1427"></span><span>
</span><span id="line-1428"></span><span>
</span><span id="line-1429"></span><span class="annot"><a href="Database.Persist.TH.html#mkLensClauses"><span class="hs-identifier hs-type">mkLensClauses</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><a href="Database.Persist.TH.html#MkPersistSettings"><span class="hs-identifier hs-type">MkPersistSettings</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="Database.Persist.Quasi.Internal.html#UnboundEntityDef"><span class="hs-identifier hs-type">UnboundEntityDef</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="hs-identifier hs-type">Type</span></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="hs-identifier hs-type">Q</span></span><span> </span><span class="hs-special">[</span><span class="annot"><span class="hs-identifier hs-type">Clause</span></span><span class="hs-special">]</span><span>
</span><span id="line-1430"></span><span id="mkLensClauses"><span class="annot"><span class="annottext">mkLensClauses :: MkPersistSettings -&gt; UnboundEntityDef -&gt; Type -&gt; Q [Clause]
</span><a href="Database.Persist.TH.html#mkLensClauses"><span class="hs-identifier hs-var hs-var">mkLensClauses</span></a></span></span><span> </span><span id="local-6989586621679964701"><span class="annot"><span class="annottext">MkPersistSettings
</span><a href="#local-6989586621679964701"><span class="hs-identifier hs-var">mps</span></a></span></span><span> </span><span id="local-6989586621679964700"><span class="annot"><span class="annottext">UnboundEntityDef
</span><a href="#local-6989586621679964700"><span class="hs-identifier hs-var">entDef</span></a></span></span><span> </span><span id="local-6989586621679964699"><span class="annot"><span class="annottext">Type
</span><a href="#local-6989586621679964699"><span class="hs-identifier hs-var">genDataType</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-keyword">do</span><span>
</span><span id="line-1431"></span><span>    </span><span id="local-6989586621679964698"><span class="annot"><span class="annottext">Exp
</span><a href="#local-6989586621679964698"><span class="hs-identifier hs-var">lens'</span></a></span></span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="hs-special">[|</span><span class="hs-identifier">lensPTH</span><span class="hs-special">|]</span><span>
</span><span id="line-1432"></span><span>    </span><span id="local-6989586621679964697"><span class="annot"><span class="annottext">Exp
</span><a href="#local-6989586621679964697"><span class="hs-identifier hs-var">getId</span></a></span></span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="hs-special">[|</span><span class="hs-identifier">entityKey</span><span class="hs-special">|]</span><span>
</span><span id="line-1433"></span><span>    </span><span id="local-6989586621679964696"><span class="annot"><span class="annottext">Exp
</span><a href="#local-6989586621679964696"><span class="hs-identifier hs-var">setId</span></a></span></span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="hs-special">[|</span><span class="hs-glyph">\</span><span class="hs-special">(</span><span class="hs-identifier">Entity</span><span> </span><span class="hs-identifier">_</span><span> </span><span class="hs-identifier">value</span><span class="hs-special">)</span><span> </span><span class="hs-identifier">key</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-identifier">Entity</span><span> </span><span class="hs-identifier">key</span><span> </span><span class="hs-identifier">value</span><span class="hs-special">|]</span><span>
</span><span id="line-1434"></span><span>    </span><span id="local-6989586621679964695"><span class="annot"><span class="annottext">Exp
</span><a href="#local-6989586621679964695"><span class="hs-identifier hs-var">getVal</span></a></span></span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="hs-special">[|</span><span class="hs-identifier">entityVal</span><span class="hs-special">|]</span><span>
</span><span id="line-1435"></span><span>    </span><span id="local-6989586621679964694"><span class="annot"><span class="annottext">Exp
</span><a href="#local-6989586621679964694"><span class="hs-identifier hs-var">dot</span></a></span></span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="hs-special">[|</span><span class="hs-special">(</span><span class="hs-operator">.</span><span class="hs-special">)</span><span class="hs-special">|]</span><span>
</span><span id="line-1436"></span><span>    </span><span id="local-6989586621679964693"><span class="annot"><span class="annottext">Name
</span><a href="#local-6989586621679964693"><span class="hs-identifier hs-var">keyVar</span></a></span></span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">forall (m :: * -&gt; *). Quote m =&gt; String -&gt; m Name
</span><span class="hs-identifier hs-var">newName</span></span><span> </span><span class="annot"><span class="annottext">String
</span><span class="hs-string">&quot;key&quot;</span></span><span>
</span><span id="line-1437"></span><span>    </span><span id="local-6989586621679964692"><span class="annot"><span class="annottext">Name
</span><a href="#local-6989586621679964692"><span class="hs-identifier hs-var">valName</span></a></span></span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">forall (m :: * -&gt; *). Quote m =&gt; String -&gt; m Name
</span><span class="hs-identifier hs-var">newName</span></span><span> </span><span class="annot"><span class="annottext">String
</span><span class="hs-string">&quot;value&quot;</span></span><span>
</span><span id="line-1438"></span><span>    </span><span id="local-6989586621679964691"><span class="annot"><span class="annottext">Name
</span><a href="#local-6989586621679964691"><span class="hs-identifier hs-var">xName</span></a></span></span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">forall (m :: * -&gt; *). Quote m =&gt; String -&gt; m Name
</span><span class="hs-identifier hs-var">newName</span></span><span> </span><span class="annot"><span class="annottext">String
</span><span class="hs-string">&quot;x&quot;</span></span><span>
</span><span id="line-1439"></span><span>    </span><span class="hs-keyword">let</span><span> </span><span id="local-6989586621679964690"><span class="annot"><span class="annottext">idClause :: Clause
</span><a href="#local-6989586621679964690"><span class="hs-identifier hs-var hs-var">idClause</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">[Pat] -&gt; Exp -&gt; Clause
</span><a href="Database.Persist.TH.html#normalClause"><span class="hs-identifier hs-var">normalClause</span></a></span><span>
</span><span id="line-1440"></span><span>            </span><span class="hs-special">[</span><span class="annot"><span class="annottext">Name -&gt; [Pat] -&gt; Pat
</span><a href="Database.Persist.TH.html#conp"><span class="hs-identifier hs-var">conp</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">UnboundEntityDef -&gt; Name
</span><a href="Database.Persist.TH.html#keyIdName"><span class="hs-identifier hs-var">keyIdName</span></a></span><span> </span><span class="annot"><span class="annottext">UnboundEntityDef
</span><a href="#local-6989586621679964700"><span class="hs-identifier hs-var">entDef</span></a></span><span class="hs-special">)</span><span> </span><span class="hs-special">[</span><span class="hs-special">]</span><span class="hs-special">]</span><span>
</span><span id="line-1441"></span><span>            </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Exp
</span><a href="#local-6989586621679964698"><span class="hs-identifier hs-var">lens'</span></a></span><span> </span><span class="annot"><span class="annottext">Exp -&gt; Exp -&gt; Exp
</span><span class="hs-operator hs-var">`AppE`</span></span><span> </span><span class="annot"><span class="annottext">Exp
</span><a href="#local-6989586621679964697"><span class="hs-identifier hs-var">getId</span></a></span><span> </span><span class="annot"><span class="annottext">Exp -&gt; Exp -&gt; Exp
</span><span class="hs-operator hs-var">`AppE`</span></span><span> </span><span class="annot"><span class="annottext">Exp
</span><a href="#local-6989586621679964696"><span class="hs-identifier hs-var">setId</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-1442"></span><span>    </span><span class="annot"><span class="annottext">forall (m :: * -&gt; *) a. Monad m =&gt; a -&gt; m a
</span><span class="hs-identifier hs-var">return</span></span><span> </span><span class="annot"><span class="annottext">forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span> </span><span class="annot"><span class="annottext">Clause
</span><a href="#local-6989586621679964690"><span class="hs-identifier hs-var">idClause</span></a></span><span> </span><span class="annot"><span class="annottext">forall a. a -&gt; [a] -&gt; [a]
</span><span class="hs-glyph hs-var">:</span></span><span> </span><span class="hs-keyword">if</span><span> </span><span class="annot"><span class="annottext">UnboundEntityDef -&gt; Bool
</span><a href="Database.Persist.TH.html#unboundEntitySum"><span class="hs-identifier hs-var">unboundEntitySum</span></a></span><span> </span><span class="annot"><span class="annottext">UnboundEntityDef
</span><a href="#local-6989586621679964700"><span class="hs-identifier hs-var">entDef</span></a></span><span>
</span><span id="line-1443"></span><span>        </span><span class="hs-keyword">then</span><span> </span><span class="annot"><span class="annottext">forall (f :: * -&gt; *) a b. Functor f =&gt; (a -&gt; b) -&gt; f a -&gt; f b
</span><span class="hs-identifier hs-var">fmap</span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Exp -&gt; Name -&gt; Name -&gt; Name -&gt; UnboundFieldDef -&gt; Clause
</span><a href="#local-6989586621679964688"><span class="hs-identifier hs-var">toSumClause</span></a></span><span> </span><span class="annot"><span class="annottext">Exp
</span><a href="#local-6989586621679964698"><span class="hs-identifier hs-var">lens'</span></a></span><span> </span><span class="annot"><span class="annottext">Name
</span><a href="#local-6989586621679964693"><span class="hs-identifier hs-var">keyVar</span></a></span><span> </span><span class="annot"><span class="annottext">Name
</span><a href="#local-6989586621679964692"><span class="hs-identifier hs-var">valName</span></a></span><span> </span><span class="annot"><span class="annottext">Name
</span><a href="#local-6989586621679964691"><span class="hs-identifier hs-var">xName</span></a></span><span class="hs-special">)</span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">UnboundEntityDef -&gt; [UnboundFieldDef]
</span><a href="Database.Persist.Quasi.Internal.html#getUnboundFieldDefs"><span class="hs-identifier hs-var">getUnboundFieldDefs</span></a></span><span> </span><span class="annot"><span class="annottext">UnboundEntityDef
</span><a href="#local-6989586621679964700"><span class="hs-identifier hs-var">entDef</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-1444"></span><span>        </span><span class="hs-keyword">else</span><span> </span><span class="annot"><span class="annottext">forall a b c. (a -&gt; b -&gt; c) -&gt; [a] -&gt; [b] -&gt; [c]
</span><span class="hs-identifier hs-var">zipWith</span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Exp
-&gt; Exp
-&gt; Exp
-&gt; Name
-&gt; Name
-&gt; Name
-&gt; UnboundFieldDef
-&gt; Name
-&gt; Clause
</span><a href="#local-6989586621679964687"><span class="hs-identifier hs-var">toClause</span></a></span><span> </span><span class="annot"><span class="annottext">Exp
</span><a href="#local-6989586621679964698"><span class="hs-identifier hs-var">lens'</span></a></span><span> </span><span class="annot"><span class="annottext">Exp
</span><a href="#local-6989586621679964695"><span class="hs-identifier hs-var">getVal</span></a></span><span> </span><span class="annot"><span class="annottext">Exp
</span><a href="#local-6989586621679964694"><span class="hs-identifier hs-var">dot</span></a></span><span> </span><span class="annot"><span class="annottext">Name
</span><a href="#local-6989586621679964693"><span class="hs-identifier hs-var">keyVar</span></a></span><span> </span><span class="annot"><span class="annottext">Name
</span><a href="#local-6989586621679964692"><span class="hs-identifier hs-var">valName</span></a></span><span> </span><span class="annot"><span class="annottext">Name
</span><a href="#local-6989586621679964691"><span class="hs-identifier hs-var">xName</span></a></span><span class="hs-special">)</span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">UnboundEntityDef -&gt; [UnboundFieldDef]
</span><a href="Database.Persist.Quasi.Internal.html#getUnboundFieldDefs"><span class="hs-identifier hs-var">getUnboundFieldDefs</span></a></span><span> </span><span class="annot"><span class="annottext">UnboundEntityDef
</span><a href="#local-6989586621679964700"><span class="hs-identifier hs-var">entDef</span></a></span><span class="hs-special">)</span><span> </span><span class="annot"><span class="annottext">[Name]
</span><a href="#local-6989586621679964686"><span class="hs-identifier hs-var">fieldNames</span></a></span><span>
</span><span id="line-1445"></span><span>  </span><span class="hs-keyword">where</span><span>
</span><span id="line-1446"></span><span>    </span><span id="local-6989586621679964686"><span class="annot"><span class="annottext">fieldNames :: [Name]
</span><a href="#local-6989586621679964686"><span class="hs-identifier hs-var hs-var">fieldNames</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">MkPersistSettings -&gt; UnboundEntityDef -&gt; UnboundFieldDef -&gt; Name
</span><a href="Database.Persist.TH.html#fieldDefToRecordName"><span class="hs-identifier hs-var">fieldDefToRecordName</span></a></span><span> </span><span class="annot"><span class="annottext">MkPersistSettings
</span><a href="#local-6989586621679964701"><span class="hs-identifier hs-var">mps</span></a></span><span> </span><span class="annot"><span class="annottext">UnboundEntityDef
</span><a href="#local-6989586621679964700"><span class="hs-identifier hs-var">entDef</span></a></span><span> </span><span class="annot"><span class="annottext">forall (f :: * -&gt; *) a b. Functor f =&gt; (a -&gt; b) -&gt; f a -&gt; f b
</span><span class="hs-operator hs-var">&lt;$&gt;</span></span><span> </span><span class="annot"><span class="annottext">UnboundEntityDef -&gt; [UnboundFieldDef]
</span><a href="Database.Persist.Quasi.Internal.html#getUnboundFieldDefs"><span class="hs-identifier hs-var">getUnboundFieldDefs</span></a></span><span> </span><span class="annot"><span class="annottext">UnboundEntityDef
</span><a href="#local-6989586621679964700"><span class="hs-identifier hs-var">entDef</span></a></span><span>
</span><span id="line-1447"></span><span>    </span><span id="local-6989586621679964687"><span class="annot"><span class="annottext">toClause :: Exp
-&gt; Exp
-&gt; Exp
-&gt; Name
-&gt; Name
-&gt; Name
-&gt; UnboundFieldDef
-&gt; Name
-&gt; Clause
</span><a href="#local-6989586621679964687"><span class="hs-identifier hs-var hs-var">toClause</span></a></span></span><span> </span><span id="local-6989586621679964685"><span class="annot"><span class="annottext">Exp
</span><a href="#local-6989586621679964685"><span class="hs-identifier hs-var">lens'</span></a></span></span><span> </span><span id="local-6989586621679964684"><span class="annot"><span class="annottext">Exp
</span><a href="#local-6989586621679964684"><span class="hs-identifier hs-var">getVal</span></a></span></span><span> </span><span id="local-6989586621679964683"><span class="annot"><span class="annottext">Exp
</span><a href="#local-6989586621679964683"><span class="hs-identifier hs-var">dot</span></a></span></span><span> </span><span id="local-6989586621679964682"><span class="annot"><span class="annottext">Name
</span><a href="#local-6989586621679964682"><span class="hs-identifier hs-var">keyVar</span></a></span></span><span> </span><span id="local-6989586621679964681"><span class="annot"><span class="annottext">Name
</span><a href="#local-6989586621679964681"><span class="hs-identifier hs-var">valName</span></a></span></span><span> </span><span id="local-6989586621679964680"><span class="annot"><span class="annottext">Name
</span><a href="#local-6989586621679964680"><span class="hs-identifier hs-var">xName</span></a></span></span><span> </span><span id="local-6989586621679964679"><span class="annot"><span class="annottext">UnboundFieldDef
</span><a href="#local-6989586621679964679"><span class="hs-identifier hs-var">fieldDef</span></a></span></span><span> </span><span id="local-6989586621679964678"><span class="annot"><span class="annottext">Name
</span><a href="#local-6989586621679964678"><span class="hs-identifier hs-var">fieldName</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">[Pat] -&gt; Exp -&gt; Clause
</span><a href="Database.Persist.TH.html#normalClause"><span class="hs-identifier hs-var">normalClause</span></a></span><span>
</span><span id="line-1448"></span><span>        </span><span class="hs-special">[</span><span class="annot"><span class="annottext">Name -&gt; [Pat] -&gt; Pat
</span><a href="Database.Persist.TH.html#conp"><span class="hs-identifier hs-var">conp</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">MkPersistSettings -&gt; UnboundEntityDef -&gt; UnboundFieldDef -&gt; Name
</span><a href="Database.Persist.TH.html#filterConName"><span class="hs-identifier hs-var">filterConName</span></a></span><span> </span><span class="annot"><span class="annottext">MkPersistSettings
</span><a href="#local-6989586621679964701"><span class="hs-identifier hs-var">mps</span></a></span><span> </span><span class="annot"><span class="annottext">UnboundEntityDef
</span><a href="#local-6989586621679964700"><span class="hs-identifier hs-var">entDef</span></a></span><span> </span><span class="annot"><span class="annottext">UnboundFieldDef
</span><a href="#local-6989586621679964679"><span class="hs-identifier hs-var">fieldDef</span></a></span><span class="hs-special">)</span><span> </span><span class="hs-special">[</span><span class="hs-special">]</span><span class="hs-special">]</span><span>
</span><span id="line-1449"></span><span>        </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Exp
</span><a href="#local-6989586621679964685"><span class="hs-identifier hs-var">lens'</span></a></span><span> </span><span class="annot"><span class="annottext">Exp -&gt; Exp -&gt; Exp
</span><span class="hs-operator hs-var">`AppE`</span></span><span> </span><span class="annot"><span class="annottext">Exp
</span><a href="#local-6989586621679964676"><span class="hs-identifier hs-var">getter</span></a></span><span> </span><span class="annot"><span class="annottext">Exp -&gt; Exp -&gt; Exp
</span><span class="hs-operator hs-var">`AppE`</span></span><span> </span><span class="annot"><span class="annottext">Exp
</span><a href="#local-6989586621679964675"><span class="hs-identifier hs-var">setter</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-1450"></span><span>      </span><span class="hs-keyword">where</span><span>
</span><span id="line-1451"></span><span>        </span><span id="local-6989586621679964674"><span class="annot"><span class="annottext">defName :: Name
</span><a href="#local-6989586621679964674"><span class="hs-identifier hs-var hs-var">defName</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">UnboundEntityDef -&gt; Name
</span><a href="Database.Persist.TH.html#mkEntityDefName"><span class="hs-identifier hs-var">mkEntityDefName</span></a></span><span> </span><span class="annot"><span class="annottext">UnboundEntityDef
</span><a href="#local-6989586621679964700"><span class="hs-identifier hs-var">entDef</span></a></span><span>
</span><span id="line-1452"></span><span>        </span><span id="local-6989586621679964676"><span class="annot"><span class="annottext">getter :: Exp
</span><a href="#local-6989586621679964676"><span class="hs-identifier hs-var hs-var">getter</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">Maybe Exp -&gt; Exp -&gt; Maybe Exp -&gt; Exp
</span><span class="hs-identifier hs-var">InfixE</span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">forall a. a -&gt; Maybe a
</span><span class="hs-identifier hs-var">Just</span></span><span> </span><span class="annot"><span class="annottext">forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span> </span><span class="annot"><span class="annottext">Name -&gt; Name -&gt; Exp
</span><a href="Database.Persist.TH.html#fieldSel"><span class="hs-identifier hs-var">fieldSel</span></a></span><span> </span><span class="annot"><span class="annottext">Name
</span><a href="#local-6989586621679964674"><span class="hs-identifier hs-var">defName</span></a></span><span> </span><span class="annot"><span class="annottext">Name
</span><a href="#local-6989586621679964678"><span class="hs-identifier hs-var">fieldName</span></a></span><span class="hs-special">)</span><span> </span><span class="annot"><span class="annottext">Exp
</span><a href="#local-6989586621679964683"><span class="hs-identifier hs-var">dot</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">forall a. a -&gt; Maybe a
</span><span class="hs-identifier hs-var">Just</span></span><span> </span><span class="annot"><span class="annottext">Exp
</span><a href="#local-6989586621679964684"><span class="hs-identifier hs-var">getVal</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-1453"></span><span>        </span><span id="local-6989586621679964675"><span class="annot"><span class="annottext">setter :: Exp
</span><a href="#local-6989586621679964675"><span class="hs-identifier hs-var hs-var">setter</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">[Pat] -&gt; Exp -&gt; Exp
</span><span class="hs-identifier hs-var">LamE</span></span><span>
</span><span id="line-1454"></span><span>            </span><span class="hs-special">[</span><span> </span><span class="annot"><span class="annottext">Name -&gt; [Pat] -&gt; Pat
</span><a href="Database.Persist.TH.html#conp"><span class="hs-identifier hs-var">conp</span></a></span><span> </span><span class="hs-special">'</span><span class="hs-identifier">Entity</span><span> </span><span class="hs-special">[</span><span class="annot"><span class="annottext">Name -&gt; Pat
</span><span class="hs-identifier hs-var">VarP</span></span><span> </span><span class="annot"><span class="annottext">Name
</span><a href="#local-6989586621679964682"><span class="hs-identifier hs-var">keyVar</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">Name -&gt; Pat
</span><span class="hs-identifier hs-var">VarP</span></span><span> </span><span class="annot"><span class="annottext">Name
</span><a href="#local-6989586621679964681"><span class="hs-identifier hs-var">valName</span></a></span><span class="hs-special">]</span><span>
</span><span id="line-1455"></span><span>            </span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">Name -&gt; Pat
</span><span class="hs-identifier hs-var">VarP</span></span><span> </span><span class="annot"><span class="annottext">Name
</span><a href="#local-6989586621679964680"><span class="hs-identifier hs-var">xName</span></a></span><span>
</span><span id="line-1456"></span><span>            </span><span class="hs-special">]</span><span>
</span><span id="line-1457"></span><span>            </span><span class="annot"><span class="annottext">forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span> </span><span class="annot"><span class="annottext">Name -&gt; Exp
</span><span class="hs-identifier hs-var">ConE</span></span><span> </span><span class="hs-special">'</span><span class="hs-identifier">Entity</span><span> </span><span class="annot"><span class="annottext">Exp -&gt; Exp -&gt; Exp
</span><span class="hs-operator hs-var">`AppE`</span></span><span> </span><span class="annot"><span class="annottext">Name -&gt; Exp
</span><span class="hs-identifier hs-var">VarE</span></span><span> </span><span class="annot"><span class="annottext">Name
</span><a href="#local-6989586621679964682"><span class="hs-identifier hs-var">keyVar</span></a></span><span>
</span><span id="line-1458"></span><span>                </span><span class="annot"><span class="annottext">Exp -&gt; Exp -&gt; Exp
</span><span class="hs-operator hs-var">`AppE`</span></span><span> </span><span class="annot"><span class="annottext">Name -&gt; [Name] -&gt; Exp -&gt; Name -&gt; Exp -&gt; Exp
</span><a href="Database.Persist.TH.html#fieldUpd"><span class="hs-identifier hs-var">fieldUpd</span></a></span><span> </span><span class="annot"><span class="annottext">Name
</span><a href="#local-6989586621679964674"><span class="hs-identifier hs-var">defName</span></a></span><span> </span><span class="annot"><span class="annottext">[Name]
</span><a href="#local-6989586621679964686"><span class="hs-identifier hs-var">fieldNames</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Name -&gt; Exp
</span><span class="hs-identifier hs-var">VarE</span></span><span> </span><span class="annot"><span class="annottext">Name
</span><a href="#local-6989586621679964681"><span class="hs-identifier hs-var">valName</span></a></span><span class="hs-special">)</span><span> </span><span class="annot"><span class="annottext">Name
</span><a href="#local-6989586621679964678"><span class="hs-identifier hs-var">fieldName</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Name -&gt; Exp
</span><span class="hs-identifier hs-var">VarE</span></span><span> </span><span class="annot"><span class="annottext">Name
</span><a href="#local-6989586621679964680"><span class="hs-identifier hs-var">xName</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-1459"></span><span>
</span><span id="line-1460"></span><span>    </span><span id="local-6989586621679964688"><span class="annot"><span class="annottext">toSumClause :: Exp -&gt; Name -&gt; Name -&gt; Name -&gt; UnboundFieldDef -&gt; Clause
</span><a href="#local-6989586621679964688"><span class="hs-identifier hs-var hs-var">toSumClause</span></a></span></span><span> </span><span id="local-6989586621679964673"><span class="annot"><span class="annottext">Exp
</span><a href="#local-6989586621679964673"><span class="hs-identifier hs-var">lens'</span></a></span></span><span> </span><span id="local-6989586621679964672"><span class="annot"><span class="annottext">Name
</span><a href="#local-6989586621679964672"><span class="hs-identifier hs-var">keyVar</span></a></span></span><span> </span><span id="local-6989586621679964671"><span class="annot"><span class="annottext">Name
</span><a href="#local-6989586621679964671"><span class="hs-identifier hs-var">valName</span></a></span></span><span> </span><span id="local-6989586621679964670"><span class="annot"><span class="annottext">Name
</span><a href="#local-6989586621679964670"><span class="hs-identifier hs-var">xName</span></a></span></span><span> </span><span id="local-6989586621679964669"><span class="annot"><span class="annottext">UnboundFieldDef
</span><a href="#local-6989586621679964669"><span class="hs-identifier hs-var">fieldDef</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">[Pat] -&gt; Exp -&gt; Clause
</span><a href="Database.Persist.TH.html#normalClause"><span class="hs-identifier hs-var">normalClause</span></a></span><span>
</span><span id="line-1461"></span><span>        </span><span class="hs-special">[</span><span class="annot"><span class="annottext">Name -&gt; [Pat] -&gt; Pat
</span><a href="Database.Persist.TH.html#conp"><span class="hs-identifier hs-var">conp</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">MkPersistSettings -&gt; UnboundEntityDef -&gt; UnboundFieldDef -&gt; Name
</span><a href="Database.Persist.TH.html#filterConName"><span class="hs-identifier hs-var">filterConName</span></a></span><span> </span><span class="annot"><span class="annottext">MkPersistSettings
</span><a href="#local-6989586621679964701"><span class="hs-identifier hs-var">mps</span></a></span><span> </span><span class="annot"><span class="annottext">UnboundEntityDef
</span><a href="#local-6989586621679964700"><span class="hs-identifier hs-var">entDef</span></a></span><span> </span><span class="annot"><span class="annottext">UnboundFieldDef
</span><a href="#local-6989586621679964669"><span class="hs-identifier hs-var">fieldDef</span></a></span><span class="hs-special">)</span><span> </span><span class="hs-special">[</span><span class="hs-special">]</span><span class="hs-special">]</span><span>
</span><span id="line-1462"></span><span>        </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Exp
</span><a href="#local-6989586621679964673"><span class="hs-identifier hs-var">lens'</span></a></span><span> </span><span class="annot"><span class="annottext">Exp -&gt; Exp -&gt; Exp
</span><span class="hs-operator hs-var">`AppE`</span></span><span> </span><span class="annot"><span class="annottext">Exp
</span><a href="#local-6989586621679964668"><span class="hs-identifier hs-var">getter</span></a></span><span> </span><span class="annot"><span class="annottext">Exp -&gt; Exp -&gt; Exp
</span><span class="hs-operator hs-var">`AppE`</span></span><span> </span><span class="annot"><span class="annottext">Exp
</span><a href="#local-6989586621679964667"><span class="hs-identifier hs-var">setter</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-1463"></span><span>      </span><span class="hs-keyword">where</span><span>
</span><span id="line-1464"></span><span>        </span><span id="local-6989586621679964666"><span class="annot"><span class="annottext">emptyMatch :: Match
</span><a href="#local-6989586621679964666"><span class="hs-identifier hs-var hs-var">emptyMatch</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">Pat -&gt; Body -&gt; [Dec] -&gt; Match
</span><span class="hs-identifier hs-var">Match</span></span><span> </span><span class="annot"><span class="annottext">Pat
</span><span class="hs-identifier hs-var">WildP</span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Exp -&gt; Body
</span><span class="hs-identifier hs-var">NormalB</span></span><span> </span><span class="annot"><span class="annottext">forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span> </span><span class="annot"><span class="annottext">Name -&gt; Exp
</span><span class="hs-identifier hs-var">VarE</span></span><span> </span><span class="hs-special">'</span><span class="hs-identifier">error</span><span> </span><span class="annot"><span class="annottext">Exp -&gt; Exp -&gt; Exp
</span><span class="hs-operator hs-var">`AppE`</span></span><span> </span><span class="annot"><span class="annottext">Lit -&gt; Exp
</span><span class="hs-identifier hs-var">LitE</span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">String -&gt; Lit
</span><span class="hs-identifier hs-var">StringL</span></span><span> </span><span class="annot"><span class="annottext">String
</span><span class="hs-string">&quot;Tried to use fieldLens on a Sum type&quot;</span></span><span class="hs-special">)</span><span class="hs-special">)</span><span> </span><span class="hs-special">[</span><span class="hs-special">]</span><span>
</span><span id="line-1465"></span><span>        </span><span id="local-6989586621679964668"><span class="annot"><span class="annottext">getter :: Exp
</span><a href="#local-6989586621679964668"><span class="hs-identifier hs-var hs-var">getter</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">[Pat] -&gt; Exp -&gt; Exp
</span><span class="hs-identifier hs-var">LamE</span></span><span>
</span><span id="line-1466"></span><span>            </span><span class="hs-special">[</span><span> </span><span class="annot"><span class="annottext">Name -&gt; [Pat] -&gt; Pat
</span><a href="Database.Persist.TH.html#conp"><span class="hs-identifier hs-var">conp</span></a></span><span> </span><span class="hs-special">'</span><span class="hs-identifier">Entity</span><span> </span><span class="hs-special">[</span><span class="annot"><span class="annottext">Pat
</span><span class="hs-identifier hs-var">WildP</span></span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">Name -&gt; Pat
</span><span class="hs-identifier hs-var">VarP</span></span><span> </span><span class="annot"><span class="annottext">Name
</span><a href="#local-6989586621679964671"><span class="hs-identifier hs-var">valName</span></a></span><span class="hs-special">]</span><span>
</span><span id="line-1467"></span><span>            </span><span class="hs-special">]</span><span> </span><span class="annot"><span class="annottext">forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span> </span><span class="annot"><span class="annottext">Exp -&gt; [Match] -&gt; Exp
</span><span class="hs-identifier hs-var">CaseE</span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Name -&gt; Exp
</span><span class="hs-identifier hs-var">VarE</span></span><span> </span><span class="annot"><span class="annottext">Name
</span><a href="#local-6989586621679964671"><span class="hs-identifier hs-var">valName</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-1468"></span><span>            </span><span class="annot"><span class="annottext">forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span> </span><span class="annot"><span class="annottext">Pat -&gt; Body -&gt; [Dec] -&gt; Match
</span><span class="hs-identifier hs-var">Match</span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Name -&gt; [Pat] -&gt; Pat
</span><a href="Database.Persist.TH.html#conp"><span class="hs-identifier hs-var">conp</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">MkPersistSettings -&gt; UnboundEntityDef -&gt; UnboundFieldDef -&gt; Name
</span><a href="Database.Persist.TH.html#sumConstrName"><span class="hs-identifier hs-var">sumConstrName</span></a></span><span> </span><span class="annot"><span class="annottext">MkPersistSettings
</span><a href="#local-6989586621679964701"><span class="hs-identifier hs-var">mps</span></a></span><span> </span><span class="annot"><span class="annottext">UnboundEntityDef
</span><a href="#local-6989586621679964700"><span class="hs-identifier hs-var">entDef</span></a></span><span> </span><span class="annot"><span class="annottext">UnboundFieldDef
</span><a href="#local-6989586621679964669"><span class="hs-identifier hs-var">fieldDef</span></a></span><span class="hs-special">)</span><span> </span><span class="hs-special">[</span><span class="annot"><span class="annottext">Name -&gt; Pat
</span><span class="hs-identifier hs-var">VarP</span></span><span> </span><span class="annot"><span class="annottext">Name
</span><a href="#local-6989586621679964670"><span class="hs-identifier hs-var">xName</span></a></span><span class="hs-special">]</span><span class="hs-special">)</span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Exp -&gt; Body
</span><span class="hs-identifier hs-var">NormalB</span></span><span> </span><span class="annot"><span class="annottext">forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span> </span><span class="annot"><span class="annottext">Name -&gt; Exp
</span><span class="hs-identifier hs-var">VarE</span></span><span> </span><span class="annot"><span class="annottext">Name
</span><a href="#local-6989586621679964670"><span class="hs-identifier hs-var">xName</span></a></span><span class="hs-special">)</span><span> </span><span class="hs-special">[</span><span class="hs-special">]</span><span>
</span><span id="line-1469"></span><span>
</span><span id="line-1470"></span><span>            </span><span class="hs-comment">-- FIXME It would be nice if the types expressed that the Field is</span><span>
</span><span id="line-1471"></span><span>            </span><span class="hs-comment">-- a sum type and therefore could result in Maybe.</span><span>
</span><span id="line-1472"></span><span>            </span><span class="annot"><span class="annottext">forall a. a -&gt; [a] -&gt; [a]
</span><span class="hs-glyph hs-var">:</span></span><span> </span><span class="hs-keyword">if</span><span> </span><span class="annot"><span class="annottext">forall (t :: * -&gt; *) a. Foldable t =&gt; t a -&gt; Int
</span><span class="hs-identifier hs-var">length</span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">UnboundEntityDef -&gt; [UnboundFieldDef]
</span><a href="Database.Persist.Quasi.Internal.html#getUnboundFieldDefs"><span class="hs-identifier hs-var">getUnboundFieldDefs</span></a></span><span> </span><span class="annot"><span class="annottext">UnboundEntityDef
</span><a href="#local-6989586621679964700"><span class="hs-identifier hs-var">entDef</span></a></span><span class="hs-special">)</span><span> </span><span class="annot"><span class="annottext">forall a. Ord a =&gt; a -&gt; a -&gt; Bool
</span><span class="hs-operator hs-var">&gt;</span></span><span> </span><span class="annot"><span class="annottext">Int
</span><span class="hs-number">1</span></span><span> </span><span class="hs-keyword">then</span><span> </span><span class="hs-special">[</span><span class="annot"><span class="annottext">Match
</span><a href="#local-6989586621679964666"><span class="hs-identifier hs-var">emptyMatch</span></a></span><span class="hs-special">]</span><span> </span><span class="hs-keyword">else</span><span> </span><span class="hs-special">[</span><span class="hs-special">]</span><span>
</span><span id="line-1473"></span><span>        </span><span id="local-6989586621679964667"><span class="annot"><span class="annottext">setter :: Exp
</span><a href="#local-6989586621679964667"><span class="hs-identifier hs-var hs-var">setter</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">[Pat] -&gt; Exp -&gt; Exp
</span><span class="hs-identifier hs-var">LamE</span></span><span>
</span><span id="line-1474"></span><span>            </span><span class="hs-special">[</span><span> </span><span class="annot"><span class="annottext">Name -&gt; [Pat] -&gt; Pat
</span><a href="Database.Persist.TH.html#conp"><span class="hs-identifier hs-var">conp</span></a></span><span> </span><span class="hs-special">'</span><span class="hs-identifier">Entity</span><span> </span><span class="hs-special">[</span><span class="annot"><span class="annottext">Name -&gt; Pat
</span><span class="hs-identifier hs-var">VarP</span></span><span> </span><span class="annot"><span class="annottext">Name
</span><a href="#local-6989586621679964672"><span class="hs-identifier hs-var">keyVar</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">Pat
</span><span class="hs-identifier hs-var">WildP</span></span><span class="hs-special">]</span><span>
</span><span id="line-1475"></span><span>            </span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">Name -&gt; Pat
</span><span class="hs-identifier hs-var">VarP</span></span><span> </span><span class="annot"><span class="annottext">Name
</span><a href="#local-6989586621679964670"><span class="hs-identifier hs-var">xName</span></a></span><span>
</span><span id="line-1476"></span><span>            </span><span class="hs-special">]</span><span>
</span><span id="line-1477"></span><span>            </span><span class="annot"><span class="annottext">forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span> </span><span class="annot"><span class="annottext">Name -&gt; Exp
</span><span class="hs-identifier hs-var">ConE</span></span><span> </span><span class="hs-special">'</span><span class="hs-identifier">Entity</span><span> </span><span class="annot"><span class="annottext">Exp -&gt; Exp -&gt; Exp
</span><span class="hs-operator hs-var">`AppE`</span></span><span> </span><span class="annot"><span class="annottext">Name -&gt; Exp
</span><span class="hs-identifier hs-var">VarE</span></span><span> </span><span class="annot"><span class="annottext">Name
</span><a href="#local-6989586621679964672"><span class="hs-identifier hs-var">keyVar</span></a></span><span> </span><span class="annot"><span class="annottext">Exp -&gt; Exp -&gt; Exp
</span><span class="hs-operator hs-var">`AppE`</span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Name -&gt; Exp
</span><span class="hs-identifier hs-var">ConE</span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">MkPersistSettings -&gt; UnboundEntityDef -&gt; UnboundFieldDef -&gt; Name
</span><a href="Database.Persist.TH.html#sumConstrName"><span class="hs-identifier hs-var">sumConstrName</span></a></span><span> </span><span class="annot"><span class="annottext">MkPersistSettings
</span><a href="#local-6989586621679964701"><span class="hs-identifier hs-var">mps</span></a></span><span> </span><span class="annot"><span class="annottext">UnboundEntityDef
</span><a href="#local-6989586621679964700"><span class="hs-identifier hs-var">entDef</span></a></span><span> </span><span class="annot"><span class="annottext">UnboundFieldDef
</span><a href="#local-6989586621679964669"><span class="hs-identifier hs-var">fieldDef</span></a></span><span class="hs-special">)</span><span> </span><span class="annot"><span class="annottext">Exp -&gt; Exp -&gt; Exp
</span><span class="hs-operator hs-var">`AppE`</span></span><span> </span><span class="annot"><span class="annottext">Name -&gt; Exp
</span><span class="hs-identifier hs-var">VarE</span></span><span> </span><span class="annot"><span class="annottext">Name
</span><a href="#local-6989586621679964670"><span class="hs-identifier hs-var">xName</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-1478"></span><span>
</span><span id="line-1479"></span><span class="hs-comment">-- | declare the key type and associated instances</span><span>
</span><span id="line-1480"></span><span class="hs-comment">-- @'PathPiece'@, @'ToHttpApiData'@ and @'FromHttpApiData'@ instances are only generated for a Key with one field</span><span>
</span><span id="line-1481"></span><span class="annot"><a href="Database.Persist.TH.html#mkKeyTypeDec"><span class="hs-identifier hs-type">mkKeyTypeDec</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><a href="Database.Persist.TH.html#MkPersistSettings"><span class="hs-identifier hs-type">MkPersistSettings</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="Database.Persist.Quasi.Internal.html#UnboundEntityDef"><span class="hs-identifier hs-type">UnboundEntityDef</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="hs-identifier hs-type">Q</span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="hs-identifier hs-type">Dec</span></span><span class="hs-special">,</span><span> </span><span class="hs-special">[</span><span class="annot"><span class="hs-identifier hs-type">Dec</span></span><span class="hs-special">]</span><span class="hs-special">)</span><span>
</span><span id="line-1482"></span><span id="mkKeyTypeDec"><span class="annot"><span class="annottext">mkKeyTypeDec :: MkPersistSettings -&gt; UnboundEntityDef -&gt; Q (Dec, [Dec])
</span><a href="Database.Persist.TH.html#mkKeyTypeDec"><span class="hs-identifier hs-var hs-var">mkKeyTypeDec</span></a></span></span><span> </span><span id="local-6989586621679964663"><span class="annot"><span class="annottext">MkPersistSettings
</span><a href="#local-6989586621679964663"><span class="hs-identifier hs-var">mps</span></a></span></span><span> </span><span id="local-6989586621679964662"><span class="annot"><span class="annottext">UnboundEntityDef
</span><a href="#local-6989586621679964662"><span class="hs-identifier hs-var">entDef</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-keyword">do</span><span>
</span><span id="line-1483"></span><span>    </span><span class="hs-special">(</span><span id="local-6989586621679964661"><span class="annot"><span class="annottext">[Dec]
</span><a href="#local-6989586621679964661"><span class="hs-identifier hs-var">instDecs</span></a></span></span><span class="hs-special">,</span><span> </span><span id="local-6989586621679964660"><span class="annot"><span class="annottext">[Name]
</span><a href="#local-6989586621679964660"><span class="hs-identifier hs-var">i</span></a></span></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">&lt;-</span><span>
</span><span id="line-1484"></span><span>      </span><span class="hs-keyword">if</span><span> </span><span class="annot"><span class="annottext">MkPersistSettings -&gt; Bool
</span><a href="Database.Persist.TH.html#mpsGeneric"><span class="hs-identifier hs-var">mpsGeneric</span></a></span><span> </span><span class="annot"><span class="annottext">MkPersistSettings
</span><a href="#local-6989586621679964663"><span class="hs-identifier hs-var">mps</span></a></span><span>
</span><span id="line-1485"></span><span>        </span><span class="hs-keyword">then</span><span> </span><span class="hs-keyword">if</span><span> </span><span class="annot"><span class="annottext">Bool -&gt; Bool
</span><span class="hs-identifier hs-var">not</span></span><span> </span><span class="annot"><span class="annottext">Bool
</span><a href="#local-6989586621679964659"><span class="hs-identifier hs-var">useNewtype</span></a></span><span>
</span><span id="line-1486"></span><span>               </span><span class="hs-keyword">then</span><span> </span><span class="hs-keyword">do</span><span> </span><span id="local-6989586621679964658"><span class="annot"><span class="annottext">[Dec]
</span><a href="#local-6989586621679964658"><span class="hs-identifier hs-var">pfDec</span></a></span></span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">Q [Dec]
</span><a href="#local-6989586621679964657"><span class="hs-identifier hs-var">pfInstD</span></a></span><span>
</span><span id="line-1487"></span><span>                       </span><span class="annot"><span class="annottext">forall (m :: * -&gt; *) a. Monad m =&gt; a -&gt; m a
</span><span class="hs-identifier hs-var">return</span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">[Dec]
</span><a href="#local-6989586621679964658"><span class="hs-identifier hs-var">pfDec</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">[Name] -&gt; [Name]
</span><a href="#local-6989586621679964656"><span class="hs-identifier hs-var">supplement</span></a></span><span> </span><span class="hs-special">[</span><span class="hs-special">''</span><span class="hs-identifier">Generic</span><span class="hs-special">]</span><span class="hs-special">)</span><span>
</span><span id="line-1488"></span><span>               </span><span class="hs-keyword">else</span><span> </span><span class="hs-keyword">do</span><span> </span><span id="local-6989586621679964655"><span class="annot"><span class="annottext">[Dec]
</span><a href="#local-6989586621679964655"><span class="hs-identifier hs-var">gi</span></a></span></span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">Q [Dec]
</span><a href="#local-6989586621679964654"><span class="hs-identifier hs-var">genericNewtypeInstances</span></a></span><span>
</span><span id="line-1489"></span><span>                       </span><span class="annot"><span class="annottext">forall (m :: * -&gt; *) a. Monad m =&gt; a -&gt; m a
</span><span class="hs-identifier hs-var">return</span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">[Dec]
</span><a href="#local-6989586621679964655"><span class="hs-identifier hs-var">gi</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">[Name] -&gt; [Name]
</span><a href="#local-6989586621679964656"><span class="hs-identifier hs-var">supplement</span></a></span><span> </span><span class="hs-special">[</span><span class="hs-special">]</span><span class="hs-special">)</span><span>
</span><span id="line-1490"></span><span>        </span><span class="hs-keyword">else</span><span> </span><span class="hs-keyword">if</span><span> </span><span class="annot"><span class="annottext">Bool -&gt; Bool
</span><span class="hs-identifier hs-var">not</span></span><span> </span><span class="annot"><span class="annottext">Bool
</span><a href="#local-6989586621679964659"><span class="hs-identifier hs-var">useNewtype</span></a></span><span>
</span><span id="line-1491"></span><span>               </span><span class="hs-keyword">then</span><span> </span><span class="hs-keyword">do</span><span> </span><span id="local-6989586621679964653"><span class="annot"><span class="annottext">[Dec]
</span><a href="#local-6989586621679964653"><span class="hs-identifier hs-var">pfDec</span></a></span></span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">Q [Dec]
</span><a href="#local-6989586621679964657"><span class="hs-identifier hs-var">pfInstD</span></a></span><span>
</span><span id="line-1492"></span><span>                       </span><span class="annot"><span class="annottext">forall (m :: * -&gt; *) a. Monad m =&gt; a -&gt; m a
</span><span class="hs-identifier hs-var">return</span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">[Dec]
</span><a href="#local-6989586621679964653"><span class="hs-identifier hs-var">pfDec</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">[Name] -&gt; [Name]
</span><a href="#local-6989586621679964656"><span class="hs-identifier hs-var">supplement</span></a></span><span> </span><span class="hs-special">[</span><span class="hs-special">''</span><span class="hs-identifier">Show</span><span class="hs-special">,</span><span> </span><span class="hs-special">''</span><span class="hs-identifier">Read</span><span class="hs-special">,</span><span> </span><span class="hs-special">''</span><span class="hs-identifier">Eq</span><span class="hs-special">,</span><span> </span><span class="hs-special">''</span><span class="hs-identifier">Ord</span><span class="hs-special">,</span><span> </span><span class="hs-special">''</span><span class="hs-identifier">Generic</span><span class="hs-special">]</span><span class="hs-special">)</span><span>
</span><span id="line-1493"></span><span>                </span><span class="hs-keyword">else</span><span> </span><span class="hs-keyword">do</span><span>
</span><span id="line-1494"></span><span>                    </span><span class="hs-keyword">let</span><span> </span><span id="local-6989586621679964652"><span class="annot"><span class="annottext">allInstances :: [Name]
</span><a href="#local-6989586621679964652"><span class="hs-identifier hs-var hs-var">allInstances</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">[Name] -&gt; [Name]
</span><a href="#local-6989586621679964656"><span class="hs-identifier hs-var">supplement</span></a></span><span> </span><span class="hs-special">[</span><span class="hs-special">''</span><span class="hs-identifier">Show</span><span class="hs-special">,</span><span> </span><span class="hs-special">''</span><span class="hs-identifier">Read</span><span class="hs-special">,</span><span> </span><span class="hs-special">''</span><span class="hs-identifier">Eq</span><span class="hs-special">,</span><span> </span><span class="hs-special">''</span><span class="hs-identifier">Ord</span><span class="hs-special">,</span><span> </span><span class="hs-special">''</span><span class="hs-identifier">PathPiece</span><span class="hs-special">,</span><span> </span><span class="hs-special">''</span><span class="hs-identifier">ToHttpApiData</span><span class="hs-special">,</span><span> </span><span class="hs-special">''</span><span class="hs-identifier">FromHttpApiData</span><span class="hs-special">,</span><span> </span><span class="hs-special">''</span><span class="hs-identifier">PersistField</span><span class="hs-special">,</span><span> </span><span class="hs-special">''</span><span class="hs-identifier">PersistFieldSql</span><span class="hs-special">,</span><span> </span><span class="hs-special">''</span><span class="hs-identifier">ToJSON</span><span class="hs-special">,</span><span> </span><span class="hs-special">''</span><span class="hs-identifier">FromJSON</span><span class="hs-special">]</span><span>
</span><span id="line-1495"></span><span>                    </span><span class="hs-keyword">if</span><span> </span><span class="annot"><span class="annottext">Bool
</span><a href="#local-6989586621679964651"><span class="hs-identifier hs-var">customKeyType</span></a></span><span>
</span><span id="line-1496"></span><span>                      </span><span class="hs-keyword">then</span><span> </span><span class="annot"><span class="annottext">forall (m :: * -&gt; *) a. Monad m =&gt; a -&gt; m a
</span><span class="hs-identifier hs-var">return</span></span><span> </span><span class="hs-special">(</span><span class="hs-special">[</span><span class="hs-special">]</span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">[Name]
</span><a href="#local-6989586621679964652"><span class="hs-identifier hs-var">allInstances</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-1497"></span><span>                      </span><span class="hs-keyword">else</span><span> </span><span class="hs-keyword">do</span><span>
</span><span id="line-1498"></span><span>                        </span><span id="local-6989586621679964650"><span class="annot"><span class="annottext">[Dec]
</span><a href="#local-6989586621679964650"><span class="hs-identifier hs-var">bi</span></a></span></span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">Q [Dec]
</span><a href="#local-6989586621679964649"><span class="hs-identifier hs-var">backendKeyI</span></a></span><span>
</span><span id="line-1499"></span><span>                        </span><span class="annot"><span class="annottext">forall (m :: * -&gt; *) a. Monad m =&gt; a -&gt; m a
</span><span class="hs-identifier hs-var">return</span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">[Dec]
</span><a href="#local-6989586621679964650"><span class="hs-identifier hs-var">bi</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">[Name]
</span><a href="#local-6989586621679964652"><span class="hs-identifier hs-var">allInstances</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-1500"></span><span>
</span><span id="line-1501"></span><span>    </span><span class="annot"><span class="annottext">Q ()
</span><a href="Database.Persist.TH.html#requirePersistentExtensions"><span class="hs-identifier hs-var">requirePersistentExtensions</span></a></span><span>
</span><span id="line-1502"></span><span>
</span><span id="line-1503"></span><span>    </span><span class="hs-comment">-- Always use StockStrategy for Show/Read. This means e.g. (FooKey 1) shows as (&quot;FooKey 1&quot;), rather than just &quot;1&quot;</span><span>
</span><span id="line-1504"></span><span>    </span><span class="hs-comment">-- This is much better for debugging/logging purposes</span><span>
</span><span id="line-1505"></span><span>    </span><span class="hs-comment">-- cf. https://github.com/yesodweb/persistent/issues/1104</span><span>
</span><span id="line-1506"></span><span>    </span><span class="hs-keyword">let</span><span> </span><span id="local-6989586621679964647"><span class="annot"><span class="annottext">alwaysStockStrategyTypeclasses :: [Name]
</span><a href="#local-6989586621679964647"><span class="hs-identifier hs-var hs-var">alwaysStockStrategyTypeclasses</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-special">[</span><span class="hs-special">''</span><span class="hs-identifier">Show</span><span class="hs-special">,</span><span> </span><span class="hs-special">''</span><span class="hs-identifier">Read</span><span class="hs-special">]</span><span>
</span><span id="line-1507"></span><span>        </span><span id="local-6989586621679964646"><span class="annot"><span class="annottext">deriveClauses :: [DerivClause]
</span><a href="#local-6989586621679964646"><span class="hs-identifier hs-var hs-var">deriveClauses</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">forall (f :: * -&gt; *) a b. Functor f =&gt; (a -&gt; b) -&gt; f a -&gt; f b
</span><span class="hs-identifier hs-var">fmap</span></span><span> </span><span class="hs-special">(</span><span class="hs-glyph">\</span><span id="local-6989586621679964645"><span class="annot"><span class="annottext">Name
</span><a href="#local-6989586621679964645"><span class="hs-identifier hs-var">typeclass</span></a></span></span><span> </span><span class="hs-glyph">-&gt;</span><span>
</span><span id="line-1508"></span><span>            </span><span class="hs-keyword">if</span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Bool -&gt; Bool
</span><span class="hs-identifier hs-var">not</span></span><span> </span><span class="annot"><span class="annottext">Bool
</span><a href="#local-6989586621679964659"><span class="hs-identifier hs-var">useNewtype</span></a></span><span> </span><span class="annot"><span class="annottext">Bool -&gt; Bool -&gt; Bool
</span><span class="hs-operator hs-var">||</span></span><span> </span><span class="annot"><span class="annottext">Name
</span><a href="#local-6989586621679964645"><span class="hs-identifier hs-var">typeclass</span></a></span><span> </span><span class="annot"><span class="annottext">forall (t :: * -&gt; *) a. (Foldable t, Eq a) =&gt; a -&gt; t a -&gt; Bool
</span><span class="hs-operator hs-var">`elem`</span></span><span> </span><span class="annot"><span class="annottext">[Name]
</span><a href="#local-6989586621679964647"><span class="hs-identifier hs-var">alwaysStockStrategyTypeclasses</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-1509"></span><span>                </span><span class="hs-keyword">then</span><span> </span><span class="annot"><span class="annottext">Maybe DerivStrategy -&gt; [Type] -&gt; DerivClause
</span><span class="hs-identifier hs-var">DerivClause</span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">forall a. a -&gt; Maybe a
</span><span class="hs-identifier hs-var">Just</span></span><span> </span><span class="annot"><span class="annottext">DerivStrategy
</span><span class="hs-identifier hs-var">StockStrategy</span></span><span class="hs-special">)</span><span> </span><span class="hs-special">[</span><span class="hs-special">(</span><span class="annot"><span class="annottext">Name -&gt; Type
</span><span class="hs-identifier hs-var">ConT</span></span><span> </span><span class="annot"><span class="annottext">Name
</span><a href="#local-6989586621679964645"><span class="hs-identifier hs-var">typeclass</span></a></span><span class="hs-special">)</span><span class="hs-special">]</span><span>
</span><span id="line-1510"></span><span>                </span><span class="hs-keyword">else</span><span> </span><span class="annot"><span class="annottext">Maybe DerivStrategy -&gt; [Type] -&gt; DerivClause
</span><span class="hs-identifier hs-var">DerivClause</span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">forall a. a -&gt; Maybe a
</span><span class="hs-identifier hs-var">Just</span></span><span> </span><span class="annot"><span class="annottext">DerivStrategy
</span><span class="hs-identifier hs-var">NewtypeStrategy</span></span><span class="hs-special">)</span><span> </span><span class="hs-special">[</span><span class="hs-special">(</span><span class="annot"><span class="annottext">Name -&gt; Type
</span><span class="hs-identifier hs-var">ConT</span></span><span> </span><span class="annot"><span class="annottext">Name
</span><a href="#local-6989586621679964645"><span class="hs-identifier hs-var">typeclass</span></a></span><span class="hs-special">)</span><span class="hs-special">]</span><span>
</span><span id="line-1511"></span><span>            </span><span class="hs-special">)</span><span> </span><span class="annot"><span class="annottext">[Name]
</span><a href="#local-6989586621679964660"><span class="hs-identifier hs-var">i</span></a></span><span class="hs-cpp">

#if MIN_VERSION_template_haskell(2,15,0)
</span><span>    </span><span class="hs-keyword">let</span><span> </span><span id="local-6989586621679964642"><span class="annot"><span class="annottext">kd :: Dec
</span><a href="#local-6989586621679964642"><span class="hs-identifier hs-var hs-var">kd</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-keyword">if</span><span> </span><span class="annot"><span class="annottext">Bool
</span><a href="#local-6989586621679964659"><span class="hs-identifier hs-var">useNewtype</span></a></span><span>
</span><span id="line-1515"></span><span>               </span><span class="hs-keyword">then</span><span> </span><span class="annot"><span class="annottext">[Type]
-&gt; Maybe [TyVarBndr ()]
-&gt; Type
-&gt; Maybe Type
-&gt; Con
-&gt; [DerivClause]
-&gt; Dec
</span><span class="hs-identifier hs-var">NewtypeInstD</span></span><span> </span><span class="hs-special">[</span><span class="hs-special">]</span><span> </span><span class="annot"><span class="annottext">forall a. Maybe a
</span><span class="hs-identifier hs-var">Nothing</span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Type -&gt; Type -&gt; Type
</span><span class="hs-identifier hs-var">AppT</span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Name -&gt; Type
</span><span class="hs-identifier hs-var">ConT</span></span><span> </span><span class="annot"><span class="annottext">Name
</span><a href="#local-6989586621679964640"><span class="hs-identifier hs-var">k</span></a></span><span class="hs-special">)</span><span> </span><span class="annot"><span class="annottext">Type
</span><a href="#local-6989586621679964639"><span class="hs-identifier hs-var">recordType</span></a></span><span class="hs-special">)</span><span> </span><span class="annot"><span class="annottext">forall a. Maybe a
</span><span class="hs-identifier hs-var">Nothing</span></span><span> </span><span class="annot"><span class="annottext">Con
</span><a href="#local-6989586621679964638"><span class="hs-identifier hs-var">dec</span></a></span><span> </span><span class="annot"><span class="annottext">[DerivClause]
</span><a href="#local-6989586621679964646"><span class="hs-identifier hs-var">deriveClauses</span></a></span><span>
</span><span id="line-1516"></span><span>               </span><span class="hs-keyword">else</span><span> </span><span class="annot"><span class="annottext">[Type]
-&gt; Maybe [TyVarBndr ()]
-&gt; Type
-&gt; Maybe Type
-&gt; [Con]
-&gt; [DerivClause]
-&gt; Dec
</span><span class="hs-identifier hs-var">DataInstD</span></span><span>    </span><span class="hs-special">[</span><span class="hs-special">]</span><span> </span><span class="annot"><span class="annottext">forall a. Maybe a
</span><span class="hs-identifier hs-var">Nothing</span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Type -&gt; Type -&gt; Type
</span><span class="hs-identifier hs-var">AppT</span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Name -&gt; Type
</span><span class="hs-identifier hs-var">ConT</span></span><span> </span><span class="annot"><span class="annottext">Name
</span><a href="#local-6989586621679964640"><span class="hs-identifier hs-var">k</span></a></span><span class="hs-special">)</span><span> </span><span class="annot"><span class="annottext">Type
</span><a href="#local-6989586621679964639"><span class="hs-identifier hs-var">recordType</span></a></span><span class="hs-special">)</span><span> </span><span class="annot"><span class="annottext">forall a. Maybe a
</span><span class="hs-identifier hs-var">Nothing</span></span><span> </span><span class="hs-special">[</span><span class="annot"><span class="annottext">Con
</span><a href="#local-6989586621679964638"><span class="hs-identifier hs-var">dec</span></a></span><span class="hs-special">]</span><span> </span><span class="annot"><span class="annottext">[DerivClause]
</span><a href="#local-6989586621679964646"><span class="hs-identifier hs-var">deriveClauses</span></a></span><span class="hs-cpp">
#else
</span><span>    </span><span class="hs-keyword">let</span><span> </span><span class="hs-identifier">kd</span><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-keyword">if</span><span> </span><span class="hs-identifier">useNewtype</span><span>
</span><span id="line-1519"></span><span>               </span><span class="hs-keyword">then</span><span> </span><span class="hs-identifier">NewtypeInstD</span><span> </span><span class="hs-special">[</span><span class="hs-special">]</span><span> </span><span class="hs-identifier">k</span><span> </span><span class="hs-special">[</span><span class="hs-identifier">recordType</span><span class="hs-special">]</span><span> </span><span class="hs-identifier">Nothing</span><span> </span><span class="hs-identifier">dec</span><span> </span><span class="hs-identifier">deriveClauses</span><span>
</span><span id="line-1520"></span><span>               </span><span class="hs-keyword">else</span><span> </span><span class="hs-identifier">DataInstD</span><span>    </span><span class="hs-special">[</span><span class="hs-special">]</span><span> </span><span class="hs-identifier">k</span><span> </span><span class="hs-special">[</span><span class="hs-identifier">recordType</span><span class="hs-special">]</span><span> </span><span class="hs-identifier">Nothing</span><span> </span><span class="hs-special">[</span><span class="hs-identifier">dec</span><span class="hs-special">]</span><span> </span><span class="hs-identifier">deriveClauses</span><span class="hs-cpp">
#endif
</span><span>    </span><span class="annot"><span class="annottext">forall (m :: * -&gt; *) a. Monad m =&gt; a -&gt; m a
</span><span class="hs-identifier hs-var">return</span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Dec
</span><a href="#local-6989586621679964642"><span class="hs-identifier hs-var">kd</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">[Dec]
</span><a href="#local-6989586621679964661"><span class="hs-identifier hs-var">instDecs</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-1523"></span><span>  </span><span class="hs-keyword">where</span><span>
</span><span id="line-1524"></span><span>    </span><span id="local-6989586621679964637"><span class="annot"><span class="annottext">keyConE :: Exp
</span><a href="#local-6989586621679964637"><span class="hs-identifier hs-var hs-var">keyConE</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">UnboundEntityDef -&gt; Exp
</span><a href="Database.Persist.TH.html#keyConExp"><span class="hs-identifier hs-var">keyConExp</span></a></span><span> </span><span class="annot"><span class="annottext">UnboundEntityDef
</span><a href="#local-6989586621679964662"><span class="hs-identifier hs-var">entDef</span></a></span><span>
</span><span id="line-1525"></span><span>    </span><span id="local-6989586621679964635"><span class="annot"><span class="annottext">unKeyE :: Exp
</span><a href="#local-6989586621679964635"><span class="hs-identifier hs-var hs-var">unKeyE</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">UnboundEntityDef -&gt; Exp
</span><a href="Database.Persist.TH.html#unKeyExp"><span class="hs-identifier hs-var">unKeyExp</span></a></span><span> </span><span class="annot"><span class="annottext">UnboundEntityDef
</span><a href="#local-6989586621679964662"><span class="hs-identifier hs-var">entDef</span></a></span><span>
</span><span id="line-1526"></span><span>    </span><span id="local-6989586621679964638"><span class="annot"><span class="annottext">dec :: Con
</span><a href="#local-6989586621679964638"><span class="hs-identifier hs-var hs-var">dec</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">Name -&gt; [VarBangType] -&gt; Con
</span><span class="hs-identifier hs-var">RecC</span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">UnboundEntityDef -&gt; Name
</span><a href="Database.Persist.TH.html#keyConName"><span class="hs-identifier hs-var">keyConName</span></a></span><span> </span><span class="annot"><span class="annottext">UnboundEntityDef
</span><a href="#local-6989586621679964662"><span class="hs-identifier hs-var">entDef</span></a></span><span class="hs-special">)</span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">MkPersistSettings -&gt; UnboundEntityDef -&gt; [VarBangType]
</span><a href="Database.Persist.TH.html#keyFields"><span class="hs-identifier hs-var">keyFields</span></a></span><span> </span><span class="annot"><span class="annottext">MkPersistSettings
</span><a href="#local-6989586621679964663"><span class="hs-identifier hs-var">mps</span></a></span><span> </span><span class="annot"><span class="annottext">UnboundEntityDef
</span><a href="#local-6989586621679964662"><span class="hs-identifier hs-var">entDef</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-1527"></span><span>    </span><span id="local-6989586621679964640"><span class="annot"><span class="annottext">k :: Name
</span><a href="#local-6989586621679964640"><span class="hs-identifier hs-var hs-var">k</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-special">''</span><span class="hs-identifier">Key</span><span>
</span><span id="line-1528"></span><span>    </span><span id="local-6989586621679964639"><span class="annot"><span class="annottext">recordType :: Type
</span><a href="#local-6989586621679964639"><span class="hs-identifier hs-var hs-var">recordType</span></a></span></span><span> </span><span class="hs-glyph">=</span><span>
</span><span id="line-1529"></span><span>        </span><span class="annot"><span class="annottext">MkPersistSettings -&gt; EntityNameHS -&gt; Type -&gt; Type
</span><a href="Database.Persist.TH.html#genericDataType"><span class="hs-identifier hs-var">genericDataType</span></a></span><span> </span><span class="annot"><span class="annottext">MkPersistSettings
</span><a href="#local-6989586621679964663"><span class="hs-identifier hs-var">mps</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">UnboundEntityDef -&gt; EntityNameHS
</span><a href="Database.Persist.Quasi.Internal.html#getUnboundEntityNameHS"><span class="hs-identifier hs-var">getUnboundEntityNameHS</span></a></span><span> </span><span class="annot"><span class="annottext">UnboundEntityDef
</span><a href="#local-6989586621679964662"><span class="hs-identifier hs-var">entDef</span></a></span><span class="hs-special">)</span><span> </span><span class="annot"><span class="annottext">Type
</span><a href="Database.Persist.TH.html#backendT"><span class="hs-identifier hs-var">backendT</span></a></span><span>
</span><span id="line-1530"></span><span>    </span><span id="local-6989586621679964657"><span class="annot"><span class="annottext">pfInstD :: Q [Dec]
</span><a href="#local-6989586621679964657"><span class="hs-identifier hs-var hs-var">pfInstD</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-comment">-- FIXME: generate a PersistMap instead of PersistList</span><span>
</span><span id="line-1531"></span><span>      </span><span class="hs-special">[d|</span><span class="hs-keyword">instance</span><span> </span><span class="hs-identifier">PersistField</span><span> </span><span class="hs-special">(</span><span class="hs-identifier">Key</span><span> </span><span class="hs-special">$</span><span class="hs-special">(</span><span class="hs-identifier">pure</span><span> </span><span class="hs-identifier">recordType</span><span class="hs-special">)</span><span class="hs-special">)</span><span> </span><span class="hs-keyword">where</span><span>
</span><span id="line-1532"></span><span>            </span><span class="hs-identifier">toPersistValue</span><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-identifier">PersistList</span><span> </span><span class="hs-operator">.</span><span> </span><span class="hs-identifier">keyToValues</span><span>
</span><span id="line-1533"></span><span>            </span><span class="hs-identifier">fromPersistValue</span><span> </span><span class="hs-special">(</span><span class="hs-identifier">PersistList</span><span> </span><span class="hs-identifier">l</span><span class="hs-special">)</span><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-identifier">keyFromValues</span><span> </span><span class="hs-identifier">l</span><span>
</span><span id="line-1534"></span><span>            </span><span class="hs-identifier">fromPersistValue</span><span> </span><span class="hs-identifier">got</span><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-identifier">error</span><span> </span><span class="hs-operator">$</span><span> </span><span class="hs-string">&quot;fromPersistValue: expected PersistList, got: &quot;</span><span> </span><span class="hs-special">`</span><span class="hs-identifier">mappend</span><span class="hs-special">`</span><span> </span><span class="hs-identifier">show</span><span> </span><span class="hs-identifier">got</span><span>
</span><span id="line-1535"></span><span>         </span><span class="hs-keyword">instance</span><span> </span><span class="hs-identifier">PersistFieldSql</span><span> </span><span class="hs-special">(</span><span class="hs-identifier">Key</span><span> </span><span class="hs-special">$</span><span class="hs-special">(</span><span class="hs-identifier">pure</span><span> </span><span class="hs-identifier">recordType</span><span class="hs-special">)</span><span class="hs-special">)</span><span> </span><span class="hs-keyword">where</span><span>
</span><span id="line-1536"></span><span>            </span><span class="hs-identifier">sqlType</span><span> </span><span class="hs-identifier">_</span><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-identifier">SqlString</span><span>
</span><span id="line-1537"></span><span>         </span><span class="hs-keyword">instance</span><span> </span><span class="hs-identifier">ToJSON</span><span> </span><span class="hs-special">(</span><span class="hs-identifier">Key</span><span> </span><span class="hs-special">$</span><span class="hs-special">(</span><span class="hs-identifier">pure</span><span> </span><span class="hs-identifier">recordType</span><span class="hs-special">)</span><span class="hs-special">)</span><span>
</span><span id="line-1538"></span><span>         </span><span class="hs-keyword">instance</span><span> </span><span class="hs-identifier">FromJSON</span><span> </span><span class="hs-special">(</span><span class="hs-identifier">Key</span><span> </span><span class="hs-special">$</span><span class="hs-special">(</span><span class="hs-identifier">pure</span><span> </span><span class="hs-identifier">recordType</span><span class="hs-special">)</span><span class="hs-special">)</span><span>
</span><span id="line-1539"></span><span>      </span><span class="hs-special">|]</span><span>
</span><span id="line-1540"></span><span>
</span><span id="line-1541"></span><span>    </span><span id="local-6989586621679964631"><span class="annot"><span class="annottext">backendKeyGenericI :: Q [Dec]
</span><a href="#local-6989586621679964631"><span class="hs-identifier hs-var hs-var">backendKeyGenericI</span></a></span></span><span> </span><span class="hs-glyph">=</span><span>
</span><span id="line-1542"></span><span>        </span><span class="hs-special">[d|</span><span> </span><span class="hs-keyword">instance</span><span> </span><span class="hs-identifier">PersistStore</span><span> </span><span class="hs-special">$</span><span class="hs-special">(</span><span class="hs-identifier">pure</span><span> </span><span class="hs-identifier">backendT</span><span class="hs-special">)</span><span> </span><span class="hs-glyph">=&gt;</span><span>
</span><span id="line-1543"></span><span>              </span><span class="hs-identifier">ToBackendKey</span><span> </span><span class="hs-special">$</span><span class="hs-special">(</span><span class="hs-identifier">pure</span><span> </span><span class="hs-identifier">backendT</span><span class="hs-special">)</span><span> </span><span class="hs-special">$</span><span class="hs-special">(</span><span class="hs-identifier">pure</span><span> </span><span class="hs-identifier">recordType</span><span class="hs-special">)</span><span> </span><span class="hs-keyword">where</span><span>
</span><span id="line-1544"></span><span>                </span><span class="hs-identifier">toBackendKey</span><span>   </span><span class="hs-glyph">=</span><span> </span><span class="hs-special">$</span><span class="hs-special">(</span><span class="hs-identifier">return</span><span> </span><span class="hs-identifier">unKeyE</span><span class="hs-special">)</span><span>
</span><span id="line-1545"></span><span>                </span><span class="hs-identifier">fromBackendKey</span><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-special">$</span><span class="hs-special">(</span><span class="hs-identifier">return</span><span> </span><span class="hs-identifier">keyConE</span><span class="hs-special">)</span><span>
</span><span id="line-1546"></span><span>        </span><span class="hs-special">|]</span><span>
</span><span id="line-1547"></span><span>    </span><span id="local-6989586621679964649"><span class="annot"><span class="annottext">backendKeyI :: Q [Dec]
</span><a href="#local-6989586621679964649"><span class="hs-identifier hs-var hs-var">backendKeyI</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-keyword">let</span><span> </span><span id="local-6989586621679964630"><span class="annot"><span class="annottext">bdt :: Type
</span><a href="#local-6989586621679964630"><span class="hs-identifier hs-var hs-var">bdt</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">MkPersistSettings -&gt; Type
</span><a href="Database.Persist.TH.html#backendDataType"><span class="hs-identifier hs-var">backendDataType</span></a></span><span> </span><span class="annot"><span class="annottext">MkPersistSettings
</span><a href="#local-6989586621679964663"><span class="hs-identifier hs-var">mps</span></a></span><span> </span><span class="hs-keyword">in</span><span>
</span><span id="line-1548"></span><span>        </span><span class="hs-special">[d|</span><span> </span><span class="hs-keyword">instance</span><span> </span><span class="hs-identifier">ToBackendKey</span><span> </span><span class="hs-special">$</span><span class="hs-special">(</span><span class="hs-identifier">pure</span><span> </span><span class="hs-identifier">bdt</span><span class="hs-special">)</span><span> </span><span class="hs-special">$</span><span class="hs-special">(</span><span class="hs-identifier">pure</span><span> </span><span class="hs-identifier">recordType</span><span class="hs-special">)</span><span> </span><span class="hs-keyword">where</span><span>
</span><span id="line-1549"></span><span>                </span><span class="hs-identifier">toBackendKey</span><span>   </span><span class="hs-glyph">=</span><span> </span><span class="hs-special">$</span><span class="hs-special">(</span><span class="hs-identifier">return</span><span> </span><span class="hs-identifier">unKeyE</span><span class="hs-special">)</span><span>
</span><span id="line-1550"></span><span>                </span><span class="hs-identifier">fromBackendKey</span><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-special">$</span><span class="hs-special">(</span><span class="hs-identifier">return</span><span> </span><span class="hs-identifier">keyConE</span><span class="hs-special">)</span><span>
</span><span id="line-1551"></span><span>        </span><span class="hs-special">|]</span><span>
</span><span id="line-1552"></span><span>
</span><span id="line-1553"></span><span>    </span><span id="local-6989586621679964654"><span class="annot"><span class="annottext">genericNewtypeInstances :: Q [Dec]
</span><a href="#local-6989586621679964654"><span class="hs-identifier hs-var hs-var">genericNewtypeInstances</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-keyword">do</span><span>
</span><span id="line-1554"></span><span>        </span><span class="annot"><span class="annottext">Q ()
</span><a href="Database.Persist.TH.html#requirePersistentExtensions"><span class="hs-identifier hs-var">requirePersistentExtensions</span></a></span><span>
</span><span id="line-1555"></span><span>
</span><span id="line-1556"></span><span>        </span><span id="local-6989586621679964629"><span class="annot"><span class="annottext">[Dec]
</span><a href="#local-6989586621679964629"><span class="hs-identifier hs-var">alwaysInstances</span></a></span></span><span> </span><span class="hs-glyph">&lt;-</span><span>
</span><span id="line-1557"></span><span>          </span><span class="hs-comment">-- See the &quot;Always use StockStrategy&quot; comment above, on why Show/Read use &quot;stock&quot; here</span><span>
</span><span id="line-1558"></span><span>          </span><span class="hs-special">[d|</span><span class="hs-keyword">deriving</span><span> </span><span class="hs-keyword">stock</span><span> </span><span class="hs-keyword">instance</span><span> </span><span class="hs-identifier">Show</span><span> </span><span class="hs-special">(</span><span class="hs-identifier">BackendKey</span><span> </span><span class="hs-special">$</span><span class="hs-special">(</span><span class="hs-identifier">pure</span><span> </span><span class="hs-identifier">backendT</span><span class="hs-special">)</span><span class="hs-special">)</span><span> </span><span class="hs-glyph">=&gt;</span><span> </span><span class="hs-identifier">Show</span><span> </span><span class="hs-special">(</span><span class="hs-identifier">Key</span><span> </span><span class="hs-special">$</span><span class="hs-special">(</span><span class="hs-identifier">pure</span><span> </span><span class="hs-identifier">recordType</span><span class="hs-special">)</span><span class="hs-special">)</span><span>
</span><span id="line-1559"></span><span>             </span><span class="hs-keyword">deriving</span><span> </span><span class="hs-keyword">stock</span><span> </span><span class="hs-keyword">instance</span><span> </span><span class="hs-identifier">Read</span><span> </span><span class="hs-special">(</span><span class="hs-identifier">BackendKey</span><span> </span><span class="hs-special">$</span><span class="hs-special">(</span><span class="hs-identifier">pure</span><span> </span><span class="hs-identifier">backendT</span><span class="hs-special">)</span><span class="hs-special">)</span><span> </span><span class="hs-glyph">=&gt;</span><span> </span><span class="hs-identifier">Read</span><span> </span><span class="hs-special">(</span><span class="hs-identifier">Key</span><span> </span><span class="hs-special">$</span><span class="hs-special">(</span><span class="hs-identifier">pure</span><span> </span><span class="hs-identifier">recordType</span><span class="hs-special">)</span><span class="hs-special">)</span><span>
</span><span id="line-1560"></span><span>             </span><span class="hs-keyword">deriving</span><span> </span><span class="hs-keyword">newtype</span><span> </span><span class="hs-keyword">instance</span><span> </span><span class="hs-identifier">Eq</span><span> </span><span class="hs-special">(</span><span class="hs-identifier">BackendKey</span><span> </span><span class="hs-special">$</span><span class="hs-special">(</span><span class="hs-identifier">pure</span><span> </span><span class="hs-identifier">backendT</span><span class="hs-special">)</span><span class="hs-special">)</span><span> </span><span class="hs-glyph">=&gt;</span><span> </span><span class="hs-identifier">Eq</span><span> </span><span class="hs-special">(</span><span class="hs-identifier">Key</span><span> </span><span class="hs-special">$</span><span class="hs-special">(</span><span class="hs-identifier">pure</span><span> </span><span class="hs-identifier">recordType</span><span class="hs-special">)</span><span class="hs-special">)</span><span>
</span><span id="line-1561"></span><span>             </span><span class="hs-keyword">deriving</span><span> </span><span class="hs-keyword">newtype</span><span> </span><span class="hs-keyword">instance</span><span> </span><span class="hs-identifier">Ord</span><span> </span><span class="hs-special">(</span><span class="hs-identifier">BackendKey</span><span> </span><span class="hs-special">$</span><span class="hs-special">(</span><span class="hs-identifier">pure</span><span> </span><span class="hs-identifier">backendT</span><span class="hs-special">)</span><span class="hs-special">)</span><span> </span><span class="hs-glyph">=&gt;</span><span> </span><span class="hs-identifier">Ord</span><span> </span><span class="hs-special">(</span><span class="hs-identifier">Key</span><span> </span><span class="hs-special">$</span><span class="hs-special">(</span><span class="hs-identifier">pure</span><span> </span><span class="hs-identifier">recordType</span><span class="hs-special">)</span><span class="hs-special">)</span><span>
</span><span id="line-1562"></span><span>             </span><span class="hs-keyword">deriving</span><span> </span><span class="hs-keyword">newtype</span><span> </span><span class="hs-keyword">instance</span><span> </span><span class="hs-identifier">ToHttpApiData</span><span> </span><span class="hs-special">(</span><span class="hs-identifier">BackendKey</span><span> </span><span class="hs-special">$</span><span class="hs-special">(</span><span class="hs-identifier">pure</span><span> </span><span class="hs-identifier">backendT</span><span class="hs-special">)</span><span class="hs-special">)</span><span> </span><span class="hs-glyph">=&gt;</span><span> </span><span class="hs-identifier">ToHttpApiData</span><span> </span><span class="hs-special">(</span><span class="hs-identifier">Key</span><span> </span><span class="hs-special">$</span><span class="hs-special">(</span><span class="hs-identifier">pure</span><span> </span><span class="hs-identifier">recordType</span><span class="hs-special">)</span><span class="hs-special">)</span><span>
</span><span id="line-1563"></span><span>             </span><span class="hs-keyword">deriving</span><span> </span><span class="hs-keyword">newtype</span><span> </span><span class="hs-keyword">instance</span><span> </span><span class="hs-identifier">FromHttpApiData</span><span> </span><span class="hs-special">(</span><span class="hs-identifier">BackendKey</span><span> </span><span class="hs-special">$</span><span class="hs-special">(</span><span class="hs-identifier">pure</span><span> </span><span class="hs-identifier">backendT</span><span class="hs-special">)</span><span class="hs-special">)</span><span> </span><span class="hs-glyph">=&gt;</span><span> </span><span class="hs-identifier">FromHttpApiData</span><span class="hs-special">(</span><span class="hs-identifier">Key</span><span> </span><span class="hs-special">$</span><span class="hs-special">(</span><span class="hs-identifier">pure</span><span> </span><span class="hs-identifier">recordType</span><span class="hs-special">)</span><span class="hs-special">)</span><span>
</span><span id="line-1564"></span><span>             </span><span class="hs-keyword">deriving</span><span> </span><span class="hs-keyword">newtype</span><span> </span><span class="hs-keyword">instance</span><span> </span><span class="hs-identifier">PathPiece</span><span> </span><span class="hs-special">(</span><span class="hs-identifier">BackendKey</span><span> </span><span class="hs-special">$</span><span class="hs-special">(</span><span class="hs-identifier">pure</span><span> </span><span class="hs-identifier">backendT</span><span class="hs-special">)</span><span class="hs-special">)</span><span> </span><span class="hs-glyph">=&gt;</span><span> </span><span class="hs-identifier">PathPiece</span><span> </span><span class="hs-special">(</span><span class="hs-identifier">Key</span><span> </span><span class="hs-special">$</span><span class="hs-special">(</span><span class="hs-identifier">pure</span><span> </span><span class="hs-identifier">recordType</span><span class="hs-special">)</span><span class="hs-special">)</span><span>
</span><span id="line-1565"></span><span>             </span><span class="hs-keyword">deriving</span><span> </span><span class="hs-keyword">newtype</span><span> </span><span class="hs-keyword">instance</span><span> </span><span class="hs-identifier">PersistField</span><span> </span><span class="hs-special">(</span><span class="hs-identifier">BackendKey</span><span> </span><span class="hs-special">$</span><span class="hs-special">(</span><span class="hs-identifier">pure</span><span> </span><span class="hs-identifier">backendT</span><span class="hs-special">)</span><span class="hs-special">)</span><span> </span><span class="hs-glyph">=&gt;</span><span> </span><span class="hs-identifier">PersistField</span><span> </span><span class="hs-special">(</span><span class="hs-identifier">Key</span><span> </span><span class="hs-special">$</span><span class="hs-special">(</span><span class="hs-identifier">pure</span><span> </span><span class="hs-identifier">recordType</span><span class="hs-special">)</span><span class="hs-special">)</span><span>
</span><span id="line-1566"></span><span>             </span><span class="hs-keyword">deriving</span><span> </span><span class="hs-keyword">newtype</span><span> </span><span class="hs-keyword">instance</span><span> </span><span class="hs-identifier">PersistFieldSql</span><span> </span><span class="hs-special">(</span><span class="hs-identifier">BackendKey</span><span> </span><span class="hs-special">$</span><span class="hs-special">(</span><span class="hs-identifier">pure</span><span> </span><span class="hs-identifier">backendT</span><span class="hs-special">)</span><span class="hs-special">)</span><span> </span><span class="hs-glyph">=&gt;</span><span> </span><span class="hs-identifier">PersistFieldSql</span><span> </span><span class="hs-special">(</span><span class="hs-identifier">Key</span><span> </span><span class="hs-special">$</span><span class="hs-special">(</span><span class="hs-identifier">pure</span><span> </span><span class="hs-identifier">recordType</span><span class="hs-special">)</span><span class="hs-special">)</span><span>
</span><span id="line-1567"></span><span>             </span><span class="hs-keyword">deriving</span><span> </span><span class="hs-keyword">newtype</span><span> </span><span class="hs-keyword">instance</span><span> </span><span class="hs-identifier">ToJSON</span><span> </span><span class="hs-special">(</span><span class="hs-identifier">BackendKey</span><span> </span><span class="hs-special">$</span><span class="hs-special">(</span><span class="hs-identifier">pure</span><span> </span><span class="hs-identifier">backendT</span><span class="hs-special">)</span><span class="hs-special">)</span><span> </span><span class="hs-glyph">=&gt;</span><span> </span><span class="hs-identifier">ToJSON</span><span> </span><span class="hs-special">(</span><span class="hs-identifier">Key</span><span> </span><span class="hs-special">$</span><span class="hs-special">(</span><span class="hs-identifier">pure</span><span> </span><span class="hs-identifier">recordType</span><span class="hs-special">)</span><span class="hs-special">)</span><span>
</span><span id="line-1568"></span><span>             </span><span class="hs-keyword">deriving</span><span> </span><span class="hs-keyword">newtype</span><span> </span><span class="hs-keyword">instance</span><span> </span><span class="hs-identifier">FromJSON</span><span> </span><span class="hs-special">(</span><span class="hs-identifier">BackendKey</span><span> </span><span class="hs-special">$</span><span class="hs-special">(</span><span class="hs-identifier">pure</span><span> </span><span class="hs-identifier">backendT</span><span class="hs-special">)</span><span class="hs-special">)</span><span> </span><span class="hs-glyph">=&gt;</span><span> </span><span class="hs-identifier">FromJSON</span><span> </span><span class="hs-special">(</span><span class="hs-identifier">Key</span><span> </span><span class="hs-special">$</span><span class="hs-special">(</span><span class="hs-identifier">pure</span><span> </span><span class="hs-identifier">recordType</span><span class="hs-special">)</span><span class="hs-special">)</span><span>
</span><span id="line-1569"></span><span>              </span><span class="hs-special">|]</span><span>
</span><span id="line-1570"></span><span>
</span><span id="line-1571"></span><span>        </span><span class="annot"><span class="annottext">forall m. Monoid m =&gt; m -&gt; m -&gt; m
</span><span class="hs-identifier hs-var">mappend</span></span><span> </span><span class="annot"><span class="annottext">[Dec]
</span><a href="#local-6989586621679964629"><span class="hs-identifier hs-var">alwaysInstances</span></a></span><span> </span><span class="annot"><span class="annottext">forall (f :: * -&gt; *) a b. Functor f =&gt; (a -&gt; b) -&gt; f a -&gt; f b
</span><span class="hs-operator hs-var">&lt;$&gt;</span></span><span>
</span><span id="line-1572"></span><span>            </span><span class="hs-keyword">if</span><span> </span><span class="annot"><span class="annottext">Bool
</span><a href="#local-6989586621679964651"><span class="hs-identifier hs-var">customKeyType</span></a></span><span>
</span><span id="line-1573"></span><span>            </span><span class="hs-keyword">then</span><span> </span><span class="annot"><span class="annottext">forall (f :: * -&gt; *) a. Applicative f =&gt; a -&gt; f a
</span><span class="hs-identifier hs-var">pure</span></span><span> </span><span class="hs-special">[</span><span class="hs-special">]</span><span>
</span><span id="line-1574"></span><span>            </span><span class="hs-keyword">else</span><span> </span><span class="annot"><span class="annottext">Q [Dec]
</span><a href="#local-6989586621679964631"><span class="hs-identifier hs-var">backendKeyGenericI</span></a></span><span>
</span><span id="line-1575"></span><span>
</span><span id="line-1576"></span><span>    </span><span id="local-6989586621679964659"><span class="annot"><span class="annottext">useNewtype :: Bool
</span><a href="#local-6989586621679964659"><span class="hs-identifier hs-var hs-var">useNewtype</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">MkPersistSettings -&gt; UnboundEntityDef -&gt; Bool
</span><a href="Database.Persist.TH.html#pkNewtype"><span class="hs-identifier hs-var">pkNewtype</span></a></span><span> </span><span class="annot"><span class="annottext">MkPersistSettings
</span><a href="#local-6989586621679964663"><span class="hs-identifier hs-var">mps</span></a></span><span> </span><span class="annot"><span class="annottext">UnboundEntityDef
</span><a href="#local-6989586621679964662"><span class="hs-identifier hs-var">entDef</span></a></span><span>
</span><span id="line-1577"></span><span>    </span><span id="local-6989586621679964651"><span class="annot"><span class="annottext">customKeyType :: Bool
</span><a href="#local-6989586621679964651"><span class="hs-identifier hs-var hs-var">customKeyType</span></a></span></span><span> </span><span class="hs-glyph">=</span><span>
</span><span id="line-1578"></span><span>        </span><span class="annot"><span class="annottext">forall (t :: * -&gt; *). Foldable t =&gt; t Bool -&gt; Bool
</span><span class="hs-identifier hs-var">or</span></span><span>
</span><span id="line-1579"></span><span>            </span><span class="hs-special">[</span><span> </span><span class="annot"><span class="annottext">Bool -&gt; Bool
</span><span class="hs-identifier hs-var">not</span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">UnboundEntityDef -&gt; Bool
</span><a href="Database.Persist.TH.html#defaultIdType"><span class="hs-identifier hs-var">defaultIdType</span></a></span><span> </span><span class="annot"><span class="annottext">UnboundEntityDef
</span><a href="#local-6989586621679964662"><span class="hs-identifier hs-var">entDef</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-1580"></span><span>            </span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">Bool -&gt; Bool
</span><span class="hs-identifier hs-var">not</span></span><span> </span><span class="annot"><span class="annottext">Bool
</span><a href="#local-6989586621679964659"><span class="hs-identifier hs-var">useNewtype</span></a></span><span>
</span><span id="line-1581"></span><span>            </span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">forall a. Maybe a -&gt; Bool
</span><span class="hs-identifier hs-var">isJust</span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">EntityDef -&gt; Maybe CompositeDef
</span><a href="Database.Persist.Types.Base.html#entityPrimary"><span class="hs-identifier hs-var">entityPrimary</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">UnboundEntityDef -&gt; EntityDef
</span><a href="Database.Persist.Quasi.Internal.html#unboundEntityDef"><span class="hs-identifier hs-var">unboundEntityDef</span></a></span><span> </span><span class="annot"><span class="annottext">UnboundEntityDef
</span><a href="#local-6989586621679964662"><span class="hs-identifier hs-var">entDef</span></a></span><span class="hs-special">)</span><span class="hs-special">)</span><span>
</span><span id="line-1582"></span><span>            </span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">Bool -&gt; Bool
</span><span class="hs-identifier hs-var">not</span></span><span> </span><span class="annot"><span class="annottext">Bool
</span><a href="#local-6989586621679964626"><span class="hs-identifier hs-var">isBackendKey</span></a></span><span>
</span><span id="line-1583"></span><span>            </span><span class="hs-special">]</span><span>
</span><span id="line-1584"></span><span>
</span><span id="line-1585"></span><span>    </span><span id="local-6989586621679964626"><span class="annot"><span class="annottext">isBackendKey :: Bool
</span><a href="#local-6989586621679964626"><span class="hs-identifier hs-var hs-var">isBackendKey</span></a></span></span><span> </span><span class="hs-glyph">=</span><span>
</span><span id="line-1586"></span><span>        </span><span class="hs-keyword">case</span><span> </span><span class="annot"><span class="annottext">MkPersistSettings -&gt; Type
</span><a href="Database.Persist.TH.html#getImplicitIdType"><span class="hs-identifier hs-var">getImplicitIdType</span></a></span><span> </span><span class="annot"><span class="annottext">MkPersistSettings
</span><a href="#local-6989586621679964663"><span class="hs-identifier hs-var">mps</span></a></span><span> </span><span class="hs-keyword">of</span><span>
</span><span id="line-1587"></span><span>            </span><span class="annot"><span class="hs-identifier hs-type">ConT</span></span><span> </span><span id="local-6989586621679964625"><span class="annot"><span class="annottext">Name
</span><a href="#local-6989586621679964625"><span class="hs-identifier hs-var">bk</span></a></span></span><span> </span><span class="annot"><span class="hs-operator hs-type">`AppT`</span></span><span> </span><span class="annot"><span class="annottext">Type
</span><span class="hs-identifier">_</span></span><span>
</span><span id="line-1588"></span><span>                </span><span class="hs-glyph">|</span><span> </span><span class="annot"><span class="annottext">Name
</span><a href="#local-6989586621679964625"><span class="hs-identifier hs-var">bk</span></a></span><span> </span><span class="annot"><span class="annottext">forall a. Eq a =&gt; a -&gt; a -&gt; Bool
</span><span class="hs-operator hs-var">==</span></span><span> </span><span class="hs-special">''</span><span class="hs-identifier">BackendKey</span><span> </span><span class="hs-glyph">-&gt;</span><span>
</span><span id="line-1589"></span><span>                    </span><span class="annot"><span class="annottext">Bool
</span><span class="hs-identifier hs-var">True</span></span><span>
</span><span id="line-1590"></span><span>            </span><span class="annot"><span class="annottext">Type
</span><span class="hs-identifier">_</span></span><span> </span><span class="hs-glyph">-&gt;</span><span>
</span><span id="line-1591"></span><span>                </span><span class="annot"><span class="annottext">Bool
</span><span class="hs-identifier hs-var">False</span></span><span>
</span><span id="line-1592"></span><span>
</span><span id="line-1593"></span><span>    </span><span class="annot"><a href="#local-6989586621679964656"><span class="hs-identifier hs-type">supplement</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="hs-special">[</span><span class="annot"><span class="hs-identifier hs-type">Name</span></span><span class="hs-special">]</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-special">[</span><span class="annot"><span class="hs-identifier hs-type">Name</span></span><span class="hs-special">]</span><span>
</span><span id="line-1594"></span><span>    </span><span id="local-6989586621679964656"><span class="annot"><span class="annottext">supplement :: [Name] -&gt; [Name]
</span><a href="#local-6989586621679964656"><span class="hs-identifier hs-var hs-var">supplement</span></a></span></span><span> </span><span id="local-6989586621679964624"><span class="annot"><span class="annottext">[Name]
</span><a href="#local-6989586621679964624"><span class="hs-identifier hs-var">names</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">[Name]
</span><a href="#local-6989586621679964624"><span class="hs-identifier hs-var">names</span></a></span><span> </span><span class="annot"><span class="annottext">forall a. Semigroup a =&gt; a -&gt; a -&gt; a
</span><span class="hs-operator hs-var">&lt;&gt;</span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">forall a. (a -&gt; Bool) -&gt; [a] -&gt; [a]
</span><span class="hs-identifier hs-var">filter</span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">forall (t :: * -&gt; *) a. (Foldable t, Eq a) =&gt; a -&gt; t a -&gt; Bool
</span><span class="hs-operator hs-var">`notElem`</span></span><span> </span><span class="annot"><span class="annottext">[Name]
</span><a href="#local-6989586621679964624"><span class="hs-identifier hs-var">names</span></a></span><span class="hs-special">)</span><span> </span><span class="annot"><span class="annottext">forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span> </span><span class="annot"><span class="annottext">MkPersistSettings -&gt; [Name]
</span><a href="Database.Persist.TH.html#mpsDeriveInstances"><span class="hs-identifier hs-var">mpsDeriveInstances</span></a></span><span> </span><span class="annot"><span class="annottext">MkPersistSettings
</span><a href="#local-6989586621679964663"><span class="hs-identifier hs-var">mps</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-1595"></span><span>
</span><span id="line-1596"></span><span class="hs-comment">-- | Returns 'True' if the key definition has less than 2 fields.</span><span>
</span><span id="line-1597"></span><span class="hs-comment">--</span><span>
</span><span id="line-1598"></span><span class="hs-comment">-- @since 2.11.0.0</span><span>
</span><span id="line-1599"></span><span class="annot"><a href="Database.Persist.TH.html#pkNewtype"><span class="hs-identifier hs-type">pkNewtype</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><a href="Database.Persist.TH.html#MkPersistSettings"><span class="hs-identifier hs-type">MkPersistSettings</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="Database.Persist.Quasi.Internal.html#UnboundEntityDef"><span class="hs-identifier hs-type">UnboundEntityDef</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="hs-identifier hs-type">Bool</span></span><span>
</span><span id="line-1600"></span><span id="pkNewtype"><span class="annot"><span class="annottext">pkNewtype :: MkPersistSettings -&gt; UnboundEntityDef -&gt; Bool
</span><a href="Database.Persist.TH.html#pkNewtype"><span class="hs-identifier hs-var hs-var">pkNewtype</span></a></span></span><span> </span><span id="local-6989586621679964622"><span class="annot"><span class="annottext">MkPersistSettings
</span><a href="#local-6989586621679964622"><span class="hs-identifier hs-var">mps</span></a></span></span><span> </span><span id="local-6989586621679964621"><span class="annot"><span class="annottext">UnboundEntityDef
</span><a href="#local-6989586621679964621"><span class="hs-identifier hs-var">entDef</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">forall (t :: * -&gt; *) a. Foldable t =&gt; t a -&gt; Int
</span><span class="hs-identifier hs-var">length</span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">MkPersistSettings -&gt; UnboundEntityDef -&gt; [VarBangType]
</span><a href="Database.Persist.TH.html#keyFields"><span class="hs-identifier hs-var">keyFields</span></a></span><span> </span><span class="annot"><span class="annottext">MkPersistSettings
</span><a href="#local-6989586621679964622"><span class="hs-identifier hs-var">mps</span></a></span><span> </span><span class="annot"><span class="annottext">UnboundEntityDef
</span><a href="#local-6989586621679964621"><span class="hs-identifier hs-var">entDef</span></a></span><span class="hs-special">)</span><span> </span><span class="annot"><span class="annottext">forall a. Ord a =&gt; a -&gt; a -&gt; Bool
</span><span class="hs-operator hs-var">&lt;</span></span><span> </span><span class="annot"><span class="annottext">Int
</span><span class="hs-number">2</span></span><span>
</span><span id="line-1601"></span><span>
</span><span id="line-1602"></span><span class="hs-comment">-- | Kind of a nasty hack. Checks to see if the 'fieldType' matches what the</span><span>
</span><span id="line-1603"></span><span class="hs-comment">-- QuasiQuoter produces for an implicit ID and</span><span>
</span><span id="line-1604"></span><span class="annot"><a href="Database.Persist.TH.html#defaultIdType"><span class="hs-identifier hs-type">defaultIdType</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><a href="Database.Persist.Quasi.Internal.html#UnboundEntityDef"><span class="hs-identifier hs-type">UnboundEntityDef</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="hs-identifier hs-type">Bool</span></span><span>
</span><span id="line-1605"></span><span id="defaultIdType"><span class="annot"><span class="annottext">defaultIdType :: UnboundEntityDef -&gt; Bool
</span><a href="Database.Persist.TH.html#defaultIdType"><span class="hs-identifier hs-var hs-var">defaultIdType</span></a></span></span><span> </span><span id="local-6989586621679964619"><span class="annot"><span class="annottext">UnboundEntityDef
</span><a href="#local-6989586621679964619"><span class="hs-identifier hs-var">entDef</span></a></span></span><span> </span><span class="hs-glyph">=</span><span>
</span><span id="line-1606"></span><span>    </span><span class="hs-keyword">case</span><span> </span><span class="annot"><span class="annottext">UnboundEntityDef -&gt; PrimarySpec
</span><a href="Database.Persist.Quasi.Internal.html#unboundPrimarySpec"><span class="hs-identifier hs-var">unboundPrimarySpec</span></a></span><span> </span><span class="annot"><span class="annottext">UnboundEntityDef
</span><a href="#local-6989586621679964619"><span class="hs-identifier hs-var">entDef</span></a></span><span> </span><span class="hs-keyword">of</span><span>
</span><span id="line-1607"></span><span>        </span><span class="annot"><a href="Database.Persist.Quasi.Internal.html#DefaultKey"><span class="hs-identifier hs-type">DefaultKey</span></a></span><span> </span><span class="annot"><span class="annottext">FieldNameDB
</span><span class="hs-identifier">_</span></span><span> </span><span class="hs-glyph">-&gt;</span><span>
</span><span id="line-1608"></span><span>            </span><span class="annot"><span class="annottext">Bool
</span><span class="hs-identifier hs-var">True</span></span><span>
</span><span id="line-1609"></span><span>        </span><span class="annot"><span class="annottext">PrimarySpec
</span><span class="hs-identifier">_</span></span><span> </span><span class="hs-glyph">-&gt;</span><span>
</span><span id="line-1610"></span><span>            </span><span class="annot"><span class="annottext">Bool
</span><span class="hs-identifier hs-var">False</span></span><span>
</span><span id="line-1611"></span><span>
</span><span id="line-1612"></span><span class="annot"><a href="Database.Persist.TH.html#keyFields"><span class="hs-identifier hs-type">keyFields</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><a href="Database.Persist.TH.html#MkPersistSettings"><span class="hs-identifier hs-type">MkPersistSettings</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="Database.Persist.Quasi.Internal.html#UnboundEntityDef"><span class="hs-identifier hs-type">UnboundEntityDef</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-special">[</span><span class="hs-special">(</span><span class="annot"><span class="hs-identifier hs-type">Name</span></span><span class="hs-special">,</span><span> </span><span class="annot"><span class="hs-identifier hs-type">Strict</span></span><span class="hs-special">,</span><span> </span><span class="annot"><span class="hs-identifier hs-type">Type</span></span><span class="hs-special">)</span><span class="hs-special">]</span><span>
</span><span id="line-1613"></span><span id="keyFields"><span class="annot"><span class="annottext">keyFields :: MkPersistSettings -&gt; UnboundEntityDef -&gt; [VarBangType]
</span><a href="Database.Persist.TH.html#keyFields"><span class="hs-identifier hs-var hs-var">keyFields</span></a></span></span><span> </span><span id="local-6989586621679964618"><span class="annot"><span class="annottext">MkPersistSettings
</span><a href="#local-6989586621679964618"><span class="hs-identifier hs-var">mps</span></a></span></span><span> </span><span id="local-6989586621679964617"><span class="annot"><span class="annottext">UnboundEntityDef
</span><a href="#local-6989586621679964617"><span class="hs-identifier hs-var">entDef</span></a></span></span><span> </span><span class="hs-glyph">=</span><span>
</span><span id="line-1614"></span><span>    </span><span class="hs-keyword">case</span><span> </span><span class="annot"><span class="annottext">UnboundEntityDef -&gt; PrimarySpec
</span><a href="Database.Persist.Quasi.Internal.html#unboundPrimarySpec"><span class="hs-identifier hs-var">unboundPrimarySpec</span></a></span><span> </span><span class="annot"><span class="annottext">UnboundEntityDef
</span><a href="#local-6989586621679964617"><span class="hs-identifier hs-var">entDef</span></a></span><span> </span><span class="hs-keyword">of</span><span>
</span><span id="line-1615"></span><span>        </span><span class="annot"><a href="Database.Persist.Quasi.Internal.html#NaturalKey"><span class="hs-identifier hs-type">NaturalKey</span></a></span><span> </span><span id="local-6989586621679964616"><span class="annot"><span class="annottext">UnboundCompositeDef
</span><a href="#local-6989586621679964616"><span class="hs-identifier hs-var">ucd</span></a></span></span><span> </span><span class="hs-glyph">-&gt;</span><span>
</span><span id="line-1616"></span><span>            </span><span class="annot"><span class="annottext">forall (f :: * -&gt; *) a b. Functor f =&gt; (a -&gt; b) -&gt; f a -&gt; f b
</span><span class="hs-identifier hs-var">fmap</span></span><span> </span><span class="annot"><span class="annottext">FieldNameHS -&gt; VarBangType
</span><a href="#local-6989586621679964615"><span class="hs-identifier hs-var">naturalKeyVar</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">UnboundCompositeDef -&gt; [FieldNameHS]
</span><a href="Database.Persist.Quasi.Internal.html#unboundCompositeCols"><span class="hs-identifier hs-var">unboundCompositeCols</span></a></span><span> </span><span class="annot"><span class="annottext">UnboundCompositeDef
</span><a href="#local-6989586621679964616"><span class="hs-identifier hs-var">ucd</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-1617"></span><span>        </span><span class="annot"><a href="Database.Persist.Quasi.Internal.html#DefaultKey"><span class="hs-identifier hs-type">DefaultKey</span></a></span><span> </span><span class="annot"><span class="annottext">FieldNameDB
</span><span class="hs-identifier">_</span></span><span> </span><span class="hs-glyph">-&gt;</span><span>
</span><span id="line-1618"></span><span>            </span><span class="annot"><span class="annottext">forall (f :: * -&gt; *) a. Applicative f =&gt; a -&gt; f a
</span><span class="hs-identifier hs-var">pure</span></span><span> </span><span class="annot"><span class="annottext">forall b c a. (b -&gt; c) -&gt; (a -&gt; b) -&gt; a -&gt; c
</span><span class="hs-operator hs-var">.</span></span><span> </span><span class="annot"><span class="annottext">Type -&gt; VarBangType
</span><a href="#local-6989586621679964614"><span class="hs-identifier hs-var">idKeyVar</span></a></span><span> </span><span class="annot"><span class="annottext">forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span> </span><span class="annot"><span class="annottext">MkPersistSettings -&gt; Type
</span><a href="Database.Persist.TH.html#getImplicitIdType"><span class="hs-identifier hs-var">getImplicitIdType</span></a></span><span> </span><span class="annot"><span class="annottext">MkPersistSettings
</span><a href="#local-6989586621679964618"><span class="hs-identifier hs-var">mps</span></a></span><span>
</span><span id="line-1619"></span><span>        </span><span class="annot"><a href="Database.Persist.Quasi.Internal.html#SurrogateKey"><span class="hs-identifier hs-type">SurrogateKey</span></a></span><span> </span><span id="local-6989586621679964613"><span class="annot"><span class="annottext">UnboundIdDef
</span><a href="#local-6989586621679964613"><span class="hs-identifier hs-var">k</span></a></span></span><span> </span><span class="hs-glyph">-&gt;</span><span>
</span><span id="line-1620"></span><span>            </span><span class="annot"><span class="annottext">forall (f :: * -&gt; *) a. Applicative f =&gt; a -&gt; f a
</span><span class="hs-identifier hs-var">pure</span></span><span> </span><span class="annot"><span class="annottext">forall b c a. (b -&gt; c) -&gt; (a -&gt; b) -&gt; a -&gt; c
</span><span class="hs-operator hs-var">.</span></span><span> </span><span class="annot"><span class="annottext">Type -&gt; VarBangType
</span><a href="#local-6989586621679964614"><span class="hs-identifier hs-var">idKeyVar</span></a></span><span> </span><span class="annot"><span class="annottext">forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span> </span><span class="hs-keyword">case</span><span> </span><span class="annot"><span class="annottext">UnboundIdDef -&gt; Maybe FieldType
</span><a href="Database.Persist.Quasi.Internal.html#unboundIdType"><span class="hs-identifier hs-var">unboundIdType</span></a></span><span> </span><span class="annot"><span class="annottext">UnboundIdDef
</span><a href="#local-6989586621679964613"><span class="hs-identifier hs-var">k</span></a></span><span> </span><span class="hs-keyword">of</span><span>
</span><span id="line-1621"></span><span>                </span><span class="annot"><span class="annottext">Maybe FieldType
</span><span class="hs-identifier hs-var">Nothing</span></span><span> </span><span class="hs-glyph">-&gt;</span><span>
</span><span id="line-1622"></span><span>                    </span><span class="annot"><span class="annottext">MkPersistSettings -&gt; Type
</span><a href="Database.Persist.TH.html#getImplicitIdType"><span class="hs-identifier hs-var">getImplicitIdType</span></a></span><span> </span><span class="annot"><span class="annottext">MkPersistSettings
</span><a href="#local-6989586621679964618"><span class="hs-identifier hs-var">mps</span></a></span><span>
</span><span id="line-1623"></span><span>                </span><span class="annot"><span class="hs-identifier hs-type">Just</span></span><span> </span><span id="local-6989586621679964612"><span class="annot"><span class="annottext">FieldType
</span><a href="#local-6989586621679964612"><span class="hs-identifier hs-var">ty</span></a></span></span><span> </span><span class="hs-glyph">-&gt;</span><span>
</span><span id="line-1624"></span><span>                    </span><span class="annot"><span class="annottext">FieldType -&gt; Type
</span><a href="Database.Persist.TH.html#ftToType"><span class="hs-identifier hs-var">ftToType</span></a></span><span> </span><span class="annot"><span class="annottext">FieldType
</span><a href="#local-6989586621679964612"><span class="hs-identifier hs-var">ty</span></a></span><span>
</span><span id="line-1625"></span><span>  </span><span class="hs-keyword">where</span><span>
</span><span id="line-1626"></span><span>    </span><span id="local-6989586621679964611"><span class="annot"><span class="annottext">unboundFieldDefs :: [UnboundFieldDef]
</span><a href="#local-6989586621679964611"><span class="hs-identifier hs-var hs-var">unboundFieldDefs</span></a></span></span><span> </span><span class="hs-glyph">=</span><span>
</span><span id="line-1627"></span><span>        </span><span class="annot"><span class="annottext">UnboundEntityDef -&gt; [UnboundFieldDef]
</span><a href="Database.Persist.Quasi.Internal.html#getUnboundFieldDefs"><span class="hs-identifier hs-var">getUnboundFieldDefs</span></a></span><span> </span><span class="annot"><span class="annottext">UnboundEntityDef
</span><a href="#local-6989586621679964617"><span class="hs-identifier hs-var">entDef</span></a></span><span>
</span><span id="line-1628"></span><span>    </span><span id="local-6989586621679964615"><span class="annot"><span class="annottext">naturalKeyVar :: FieldNameHS -&gt; VarBangType
</span><a href="#local-6989586621679964615"><span class="hs-identifier hs-var hs-var">naturalKeyVar</span></a></span></span><span> </span><span id="local-6989586621679964610"><span class="annot"><span class="annottext">FieldNameHS
</span><a href="#local-6989586621679964610"><span class="hs-identifier hs-var">fieldName</span></a></span></span><span> </span><span class="hs-glyph">=</span><span>
</span><span id="line-1629"></span><span>        </span><span class="hs-keyword">case</span><span> </span><span class="annot"><span class="annottext">FieldNameHS -&gt; [UnboundFieldDef] -&gt; Maybe UnboundFieldDef
</span><a href="Database.Persist.TH.html#findField"><span class="hs-identifier hs-var">findField</span></a></span><span> </span><span class="annot"><span class="annottext">FieldNameHS
</span><a href="#local-6989586621679964610"><span class="hs-identifier hs-var">fieldName</span></a></span><span> </span><span class="annot"><span class="annottext">[UnboundFieldDef]
</span><a href="#local-6989586621679964611"><span class="hs-identifier hs-var">unboundFieldDefs</span></a></span><span> </span><span class="hs-keyword">of</span><span>
</span><span id="line-1630"></span><span>            </span><span class="annot"><span class="annottext">Maybe UnboundFieldDef
</span><span class="hs-identifier hs-var">Nothing</span></span><span> </span><span class="hs-glyph">-&gt;</span><span>
</span><span id="line-1631"></span><span>                </span><span class="annot"><span class="annottext">forall a. HasCallStack =&gt; String -&gt; a
</span><span class="hs-identifier hs-var">error</span></span><span> </span><span class="annot"><span class="annottext">String
</span><span class="hs-string">&quot;column not defined on entity&quot;</span></span><span>
</span><span id="line-1632"></span><span>            </span><span class="annot"><span class="hs-identifier hs-type">Just</span></span><span> </span><span id="local-6989586621679964608"><span class="annot"><span class="annottext">UnboundFieldDef
</span><a href="#local-6989586621679964608"><span class="hs-identifier hs-var">unboundFieldDef</span></a></span></span><span> </span><span class="hs-glyph">-&gt;</span><span>
</span><span id="line-1633"></span><span>                </span><span class="hs-special">(</span><span> </span><span class="annot"><span class="annottext">MkPersistSettings -&gt; UnboundEntityDef -&gt; FieldNameHS -&gt; Name
</span><a href="Database.Persist.TH.html#keyFieldName"><span class="hs-identifier hs-var">keyFieldName</span></a></span><span> </span><span class="annot"><span class="annottext">MkPersistSettings
</span><a href="#local-6989586621679964618"><span class="hs-identifier hs-var">mps</span></a></span><span> </span><span class="annot"><span class="annottext">UnboundEntityDef
</span><a href="#local-6989586621679964617"><span class="hs-identifier hs-var">entDef</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">UnboundFieldDef -&gt; FieldNameHS
</span><a href="Database.Persist.Quasi.Internal.html#unboundFieldNameHS"><span class="hs-identifier hs-var">unboundFieldNameHS</span></a></span><span> </span><span class="annot"><span class="annottext">UnboundFieldDef
</span><a href="#local-6989586621679964608"><span class="hs-identifier hs-var">unboundFieldDef</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-1634"></span><span>                </span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">Bang
</span><a href="Database.Persist.TH.html#notStrict"><span class="hs-identifier hs-var">notStrict</span></a></span><span>
</span><span id="line-1635"></span><span>                </span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">FieldType -&gt; Type
</span><a href="Database.Persist.TH.html#ftToType"><span class="hs-identifier hs-var">ftToType</span></a></span><span> </span><span class="annot"><span class="annottext">forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span> </span><span class="annot"><span class="annottext">UnboundFieldDef -&gt; FieldType
</span><a href="Database.Persist.Quasi.Internal.html#unboundFieldType"><span class="hs-identifier hs-var">unboundFieldType</span></a></span><span> </span><span class="annot"><span class="annottext">UnboundFieldDef
</span><a href="#local-6989586621679964608"><span class="hs-identifier hs-var">unboundFieldDef</span></a></span><span>
</span><span id="line-1636"></span><span>                </span><span class="hs-special">)</span><span>
</span><span id="line-1637"></span><span>
</span><span id="line-1638"></span><span>    </span><span id="local-6989586621679964614"><span class="annot"><span class="annottext">idKeyVar :: Type -&gt; VarBangType
</span><a href="#local-6989586621679964614"><span class="hs-identifier hs-var hs-var">idKeyVar</span></a></span></span><span> </span><span id="local-6989586621679964606"><span class="annot"><span class="annottext">Type
</span><a href="#local-6989586621679964606"><span class="hs-identifier hs-var">ft</span></a></span></span><span> </span><span class="hs-glyph">=</span><span>
</span><span id="line-1639"></span><span>        </span><span class="hs-special">(</span><span> </span><span class="annot"><span class="annottext">UnboundEntityDef -&gt; Name
</span><a href="Database.Persist.TH.html#unKeyName"><span class="hs-identifier hs-var">unKeyName</span></a></span><span> </span><span class="annot"><span class="annottext">UnboundEntityDef
</span><a href="#local-6989586621679964617"><span class="hs-identifier hs-var">entDef</span></a></span><span>
</span><span id="line-1640"></span><span>        </span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">Bang
</span><a href="Database.Persist.TH.html#notStrict"><span class="hs-identifier hs-var">notStrict</span></a></span><span>
</span><span id="line-1641"></span><span>        </span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">Type
</span><a href="#local-6989586621679964606"><span class="hs-identifier hs-var">ft</span></a></span><span>
</span><span id="line-1642"></span><span>        </span><span class="hs-special">)</span><span>
</span><span id="line-1643"></span><span>
</span><span id="line-1644"></span><span class="annot"><a href="Database.Persist.TH.html#findField"><span class="hs-identifier hs-type">findField</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><a href="Database.Persist.Names.html#FieldNameHS"><span class="hs-identifier hs-type">FieldNameHS</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-special">[</span><span class="annot"><a href="Database.Persist.Quasi.Internal.html#UnboundFieldDef"><span class="hs-identifier hs-type">UnboundFieldDef</span></a></span><span class="hs-special">]</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="hs-identifier hs-type">Maybe</span></span><span> </span><span class="annot"><a href="Database.Persist.Quasi.Internal.html#UnboundFieldDef"><span class="hs-identifier hs-type">UnboundFieldDef</span></a></span><span>
</span><span id="line-1645"></span><span id="findField"><span class="annot"><span class="annottext">findField :: FieldNameHS -&gt; [UnboundFieldDef] -&gt; Maybe UnboundFieldDef
</span><a href="Database.Persist.TH.html#findField"><span class="hs-identifier hs-var hs-var">findField</span></a></span></span><span> </span><span id="local-6989586621679964604"><span class="annot"><span class="annottext">FieldNameHS
</span><a href="#local-6989586621679964604"><span class="hs-identifier hs-var">fieldName</span></a></span></span><span> </span><span class="hs-glyph">=</span><span>
</span><span id="line-1646"></span><span>    </span><span class="annot"><span class="annottext">forall (t :: * -&gt; *) a. Foldable t =&gt; (a -&gt; Bool) -&gt; t a -&gt; Maybe a
</span><span class="hs-identifier hs-var">List.find</span></span><span> </span><span class="hs-special">(</span><span class="hs-special">(</span><span class="annot"><span class="annottext">FieldNameHS
</span><a href="#local-6989586621679964604"><span class="hs-identifier hs-var">fieldName</span></a></span><span> </span><span class="annot"><span class="annottext">forall a. Eq a =&gt; a -&gt; a -&gt; Bool
</span><span class="hs-operator hs-var">==</span></span><span class="hs-special">)</span><span> </span><span class="annot"><span class="annottext">forall b c a. (b -&gt; c) -&gt; (a -&gt; b) -&gt; a -&gt; c
</span><span class="hs-operator hs-var">.</span></span><span> </span><span class="annot"><span class="annottext">UnboundFieldDef -&gt; FieldNameHS
</span><a href="Database.Persist.Quasi.Internal.html#unboundFieldNameHS"><span class="hs-identifier hs-var">unboundFieldNameHS</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-1647"></span><span>
</span><span id="line-1648"></span><span class="annot"><a href="Database.Persist.TH.html#mkKeyToValues"><span class="hs-identifier hs-type">mkKeyToValues</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><a href="Database.Persist.TH.html#MkPersistSettings"><span class="hs-identifier hs-type">MkPersistSettings</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="Database.Persist.Quasi.Internal.html#UnboundEntityDef"><span class="hs-identifier hs-type">UnboundEntityDef</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="hs-identifier hs-type">Q</span></span><span> </span><span class="annot"><span class="hs-identifier hs-type">Dec</span></span><span>
</span><span id="line-1649"></span><span id="mkKeyToValues"><span class="annot"><span class="annottext">mkKeyToValues :: MkPersistSettings -&gt; UnboundEntityDef -&gt; Q Dec
</span><a href="Database.Persist.TH.html#mkKeyToValues"><span class="hs-identifier hs-var hs-var">mkKeyToValues</span></a></span></span><span> </span><span id="local-6989586621679964601"><span class="annot"><span class="annottext">MkPersistSettings
</span><a href="#local-6989586621679964601"><span class="hs-identifier hs-var">mps</span></a></span></span><span> </span><span id="local-6989586621679964600"><span class="annot"><span class="annottext">UnboundEntityDef
</span><a href="#local-6989586621679964600"><span class="hs-identifier hs-var">entDef</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-keyword">do</span><span>
</span><span id="line-1650"></span><span>    </span><span id="local-6989586621679964599"><span class="annot"><span class="annottext">Name
</span><a href="#local-6989586621679964599"><span class="hs-identifier hs-var">recordName</span></a></span></span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">forall (m :: * -&gt; *). Quote m =&gt; String -&gt; m Name
</span><span class="hs-identifier hs-var">newName</span></span><span> </span><span class="annot"><span class="annottext">String
</span><span class="hs-string">&quot;record&quot;</span></span><span>
</span><span id="line-1651"></span><span>    </span><span class="annot"><span class="annottext">Name -&gt; [Clause] -&gt; Dec
</span><span class="hs-identifier hs-var">FunD</span></span><span> </span><span class="hs-special">'</span><span class="hs-identifier">keyToValues</span><span> </span><span class="annot"><span class="annottext">forall b c a. (b -&gt; c) -&gt; (a -&gt; b) -&gt; a -&gt; c
</span><span class="hs-operator hs-var">.</span></span><span> </span><span class="annot"><span class="annottext">forall (f :: * -&gt; *) a. Applicative f =&gt; a -&gt; f a
</span><span class="hs-identifier hs-var">pure</span></span><span> </span><span class="annot"><span class="annottext">forall (f :: * -&gt; *) a b. Functor f =&gt; (a -&gt; b) -&gt; f a -&gt; f b
</span><span class="hs-operator hs-var">&lt;$&gt;</span></span><span>
</span><span id="line-1652"></span><span>        </span><span class="hs-keyword">case</span><span> </span><span class="annot"><span class="annottext">UnboundEntityDef -&gt; PrimarySpec
</span><a href="Database.Persist.Quasi.Internal.html#unboundPrimarySpec"><span class="hs-identifier hs-var">unboundPrimarySpec</span></a></span><span> </span><span class="annot"><span class="annottext">UnboundEntityDef
</span><a href="#local-6989586621679964600"><span class="hs-identifier hs-var">entDef</span></a></span><span> </span><span class="hs-keyword">of</span><span>
</span><span id="line-1653"></span><span>            </span><span class="annot"><a href="Database.Persist.Quasi.Internal.html#NaturalKey"><span class="hs-identifier hs-type">NaturalKey</span></a></span><span> </span><span id="local-6989586621679964598"><span class="annot"><span class="annottext">UnboundCompositeDef
</span><a href="#local-6989586621679964598"><span class="hs-identifier hs-var">ucd</span></a></span></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-keyword">do</span><span>
</span><span id="line-1654"></span><span>                </span><span class="annot"><span class="annottext">[Pat] -&gt; Exp -&gt; Clause
</span><a href="Database.Persist.TH.html#normalClause"><span class="hs-identifier hs-var">normalClause</span></a></span><span> </span><span class="hs-special">[</span><span class="annot"><span class="annottext">Name -&gt; Pat
</span><span class="hs-identifier hs-var">VarP</span></span><span> </span><span class="annot"><span class="annottext">Name
</span><a href="#local-6989586621679964599"><span class="hs-identifier hs-var">recordName</span></a></span><span class="hs-special">]</span><span> </span><span class="annot"><span class="annottext">forall (f :: * -&gt; *) a b. Functor f =&gt; (a -&gt; b) -&gt; f a -&gt; f b
</span><span class="hs-operator hs-var">&lt;$&gt;</span></span><span>
</span><span id="line-1655"></span><span>                    </span><span class="annot"><span class="annottext">Name -&gt; UnboundCompositeDef -&gt; Q Exp
</span><a href="#local-6989586621679964597"><span class="hs-identifier hs-var">toValuesPrimary</span></a></span><span> </span><span class="annot"><span class="annottext">Name
</span><a href="#local-6989586621679964599"><span class="hs-identifier hs-var">recordName</span></a></span><span> </span><span class="annot"><span class="annottext">UnboundCompositeDef
</span><a href="#local-6989586621679964598"><span class="hs-identifier hs-var">ucd</span></a></span><span>
</span><span id="line-1656"></span><span>            </span><span class="annot"><span class="annottext">PrimarySpec
</span><span class="hs-identifier">_</span></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-keyword">do</span><span>
</span><span id="line-1657"></span><span>                </span><span class="annot"><span class="annottext">[Pat] -&gt; Exp -&gt; Clause
</span><a href="Database.Persist.TH.html#normalClause"><span class="hs-identifier hs-var">normalClause</span></a></span><span> </span><span class="hs-special">[</span><span class="hs-special">]</span><span> </span><span class="annot"><span class="annottext">forall (f :: * -&gt; *) a b. Functor f =&gt; (a -&gt; b) -&gt; f a -&gt; f b
</span><span class="hs-operator hs-var">&lt;$&gt;</span></span><span>
</span><span id="line-1658"></span><span>                    </span><span class="hs-special">[|</span><span class="hs-special">(</span><span class="hs-glyph">:</span><span class="hs-special">[</span><span class="hs-special">]</span><span class="hs-special">)</span><span> </span><span class="hs-operator">.</span><span> </span><span class="hs-identifier">toPersistValue</span><span> </span><span class="hs-operator">.</span><span> </span><span class="hs-special">$</span><span class="hs-special">(</span><span class="hs-identifier">pure</span><span> </span><span class="hs-operator">$</span><span> </span><span class="hs-identifier">unKeyExp</span><span> </span><span class="hs-identifier">entDef</span><span class="hs-special">)</span><span class="hs-special">|]</span><span>
</span><span id="line-1659"></span><span>  </span><span class="hs-keyword">where</span><span>
</span><span id="line-1660"></span><span>    </span><span id="local-6989586621679964597"><span class="annot"><span class="annottext">toValuesPrimary :: Name -&gt; UnboundCompositeDef -&gt; Q Exp
</span><a href="#local-6989586621679964597"><span class="hs-identifier hs-var hs-var">toValuesPrimary</span></a></span></span><span> </span><span id="local-6989586621679964596"><span class="annot"><span class="annottext">Name
</span><a href="#local-6989586621679964596"><span class="hs-identifier hs-var">recName</span></a></span></span><span> </span><span id="local-6989586621679964595"><span class="annot"><span class="annottext">UnboundCompositeDef
</span><a href="#local-6989586621679964595"><span class="hs-identifier hs-var">ucd</span></a></span></span><span> </span><span class="hs-glyph">=</span><span>
</span><span id="line-1661"></span><span>        </span><span class="annot"><span class="annottext">[Exp] -&gt; Exp
</span><span class="hs-identifier hs-var">ListE</span></span><span> </span><span class="annot"><span class="annottext">forall (f :: * -&gt; *) a b. Functor f =&gt; (a -&gt; b) -&gt; f a -&gt; f b
</span><span class="hs-operator hs-var">&lt;$&gt;</span></span><span> </span><span class="annot"><span class="annottext">forall (t :: * -&gt; *) (m :: * -&gt; *) a b.
(Traversable t, Monad m) =&gt;
(a -&gt; m b) -&gt; t a -&gt; m (t b)
</span><span class="hs-identifier hs-var">mapM</span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Name -&gt; FieldNameHS -&gt; Q Exp
</span><a href="#local-6989586621679964594"><span class="hs-identifier hs-var">f</span></a></span><span> </span><span class="annot"><span class="annottext">Name
</span><a href="#local-6989586621679964596"><span class="hs-identifier hs-var">recName</span></a></span><span class="hs-special">)</span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">UnboundCompositeDef -&gt; [FieldNameHS]
</span><a href="Database.Persist.Quasi.Internal.html#unboundCompositeCols"><span class="hs-identifier hs-var">unboundCompositeCols</span></a></span><span> </span><span class="annot"><span class="annottext">UnboundCompositeDef
</span><a href="#local-6989586621679964595"><span class="hs-identifier hs-var">ucd</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-1662"></span><span>    </span><span id="local-6989586621679964594"><span class="annot"><span class="annottext">f :: Name -&gt; FieldNameHS -&gt; Q Exp
</span><a href="#local-6989586621679964594"><span class="hs-identifier hs-var hs-var">f</span></a></span></span><span> </span><span id="local-6989586621679964593"><span class="annot"><span class="annottext">Name
</span><a href="#local-6989586621679964593"><span class="hs-identifier hs-var">recName</span></a></span></span><span> </span><span id="local-6989586621679964592"><span class="annot"><span class="annottext">FieldNameHS
</span><a href="#local-6989586621679964592"><span class="hs-identifier hs-var">fieldNameHS</span></a></span></span><span> </span><span class="hs-glyph">=</span><span>
</span><span id="line-1663"></span><span>        </span><span class="hs-special">[|</span><span>
</span><span id="line-1664"></span><span>        </span><span class="hs-identifier">toPersistValue</span><span> </span><span class="hs-special">(</span><span class="hs-special">$</span><span class="hs-special">(</span><span class="hs-identifier">varE</span><span> </span><span class="hs-operator">$</span><span> </span><span class="hs-identifier">keyFieldName</span><span> </span><span class="hs-identifier">mps</span><span> </span><span class="hs-identifier">entDef</span><span> </span><span class="hs-identifier">fieldNameHS</span><span class="hs-special">)</span><span> </span><span class="hs-special">$</span><span class="hs-special">(</span><span class="hs-identifier">varE</span><span> </span><span class="hs-identifier">recName</span><span class="hs-special">)</span><span class="hs-special">)</span><span>
</span><span id="line-1665"></span><span>        </span><span class="hs-special">|]</span><span>
</span><span id="line-1666"></span><span>
</span><span id="line-1667"></span><span class="annot"><a href="Database.Persist.TH.html#normalClause"><span class="hs-identifier hs-type">normalClause</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="hs-special">[</span><span class="annot"><span class="hs-identifier hs-type">Pat</span></span><span class="hs-special">]</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="hs-identifier hs-type">Exp</span></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="hs-identifier hs-type">Clause</span></span><span>
</span><span id="line-1668"></span><span id="normalClause"><span class="annot"><span class="annottext">normalClause :: [Pat] -&gt; Exp -&gt; Clause
</span><a href="Database.Persist.TH.html#normalClause"><span class="hs-identifier hs-var hs-var">normalClause</span></a></span></span><span> </span><span id="local-6989586621679964591"><span class="annot"><span class="annottext">[Pat]
</span><a href="#local-6989586621679964591"><span class="hs-identifier hs-var">p</span></a></span></span><span> </span><span id="local-6989586621679964590"><span class="annot"><span class="annottext">Exp
</span><a href="#local-6989586621679964590"><span class="hs-identifier hs-var">e</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">[Pat] -&gt; Body -&gt; [Dec] -&gt; Clause
</span><span class="hs-identifier hs-var">Clause</span></span><span> </span><span class="annot"><span class="annottext">[Pat]
</span><a href="#local-6989586621679964591"><span class="hs-identifier hs-var">p</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Exp -&gt; Body
</span><span class="hs-identifier hs-var">NormalB</span></span><span> </span><span class="annot"><span class="annottext">Exp
</span><a href="#local-6989586621679964590"><span class="hs-identifier hs-var">e</span></a></span><span class="hs-special">)</span><span> </span><span class="hs-special">[</span><span class="hs-special">]</span><span>
</span><span id="line-1669"></span><span>
</span><span id="line-1670"></span><span class="hs-comment">-- needs:</span><span>
</span><span id="line-1671"></span><span class="hs-comment">--</span><span>
</span><span id="line-1672"></span><span class="hs-comment">-- * entityPrimary</span><span>
</span><span id="line-1673"></span><span class="hs-comment">-- * keyConExp entDef</span><span>
</span><span id="line-1674"></span><span class="annot"><a href="Database.Persist.TH.html#mkKeyFromValues"><span class="hs-identifier hs-type">mkKeyFromValues</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><a href="Database.Persist.TH.html#MkPersistSettings"><span class="hs-identifier hs-type">MkPersistSettings</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="Database.Persist.Quasi.Internal.html#UnboundEntityDef"><span class="hs-identifier hs-type">UnboundEntityDef</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="hs-identifier hs-type">Q</span></span><span> </span><span class="annot"><span class="hs-identifier hs-type">Dec</span></span><span>
</span><span id="line-1675"></span><span id="mkKeyFromValues"><span class="annot"><span class="annottext">mkKeyFromValues :: MkPersistSettings -&gt; UnboundEntityDef -&gt; Q Dec
</span><a href="Database.Persist.TH.html#mkKeyFromValues"><span class="hs-identifier hs-var hs-var">mkKeyFromValues</span></a></span></span><span> </span><span id="local-6989586621679964588"><span class="annot"><span class="annottext">MkPersistSettings
</span><a href="#local-6989586621679964588"><span class="hs-identifier hs-var">_mps</span></a></span></span><span> </span><span id="local-6989586621679964587"><span class="annot"><span class="annottext">UnboundEntityDef
</span><a href="#local-6989586621679964587"><span class="hs-identifier hs-var">entDef</span></a></span></span><span> </span><span class="hs-glyph">=</span><span>
</span><span id="line-1676"></span><span>    </span><span class="annot"><span class="annottext">Name -&gt; [Clause] -&gt; Dec
</span><span class="hs-identifier hs-var">FunD</span></span><span> </span><span class="hs-special">'</span><span class="hs-identifier">keyFromValues</span><span> </span><span class="annot"><span class="annottext">forall (f :: * -&gt; *) a b. Functor f =&gt; (a -&gt; b) -&gt; f a -&gt; f b
</span><span class="hs-operator hs-var">&lt;$&gt;</span></span><span>
</span><span id="line-1677"></span><span>        </span><span class="hs-keyword">case</span><span> </span><span class="annot"><span class="annottext">UnboundEntityDef -&gt; PrimarySpec
</span><a href="Database.Persist.Quasi.Internal.html#unboundPrimarySpec"><span class="hs-identifier hs-var">unboundPrimarySpec</span></a></span><span> </span><span class="annot"><span class="annottext">UnboundEntityDef
</span><a href="#local-6989586621679964587"><span class="hs-identifier hs-var">entDef</span></a></span><span> </span><span class="hs-keyword">of</span><span>
</span><span id="line-1678"></span><span>            </span><span class="annot"><a href="Database.Persist.Quasi.Internal.html#NaturalKey"><span class="hs-identifier hs-type">NaturalKey</span></a></span><span> </span><span id="local-6989586621679964586"><span class="annot"><span class="annottext">UnboundCompositeDef
</span><a href="#local-6989586621679964586"><span class="hs-identifier hs-var">ucd</span></a></span></span><span> </span><span class="hs-glyph">-&gt;</span><span>
</span><span id="line-1679"></span><span>                </span><span class="annot"><span class="annottext">UnboundEntityDef -&gt; Text -&gt; Exp -&gt; [FieldNameHS] -&gt; Q [Clause]
</span><a href="Database.Persist.TH.html#fromValues"><span class="hs-identifier hs-var">fromValues</span></a></span><span> </span><span class="annot"><span class="annottext">UnboundEntityDef
</span><a href="#local-6989586621679964587"><span class="hs-identifier hs-var">entDef</span></a></span><span> </span><span class="annot"><span class="annottext">Text
</span><span class="hs-string">&quot;keyFromValues&quot;</span></span><span> </span><span class="annot"><span class="annottext">Exp
</span><a href="#local-6989586621679964585"><span class="hs-identifier hs-var">keyConE</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">UnboundCompositeDef -&gt; [FieldNameHS]
</span><a href="Database.Persist.Quasi.Internal.html#unboundCompositeCols"><span class="hs-identifier hs-var">unboundCompositeCols</span></a></span><span> </span><span class="annot"><span class="annottext">UnboundCompositeDef
</span><a href="#local-6989586621679964586"><span class="hs-identifier hs-var">ucd</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-1680"></span><span>            </span><span class="annot"><span class="annottext">PrimarySpec
</span><span class="hs-identifier">_</span></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-keyword">do</span><span>
</span><span id="line-1681"></span><span>                </span><span id="local-6989586621679964584"><span class="annot"><span class="annottext">Exp
</span><a href="#local-6989586621679964584"><span class="hs-identifier hs-var">e</span></a></span></span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="hs-special">[|</span><span class="hs-identifier">fmap</span><span> </span><span class="hs-special">$</span><span class="hs-special">(</span><span class="hs-identifier">return</span><span> </span><span class="hs-identifier">keyConE</span><span class="hs-special">)</span><span> </span><span class="hs-operator">.</span><span> </span><span class="hs-identifier">fromPersistValue</span><span> </span><span class="hs-operator">.</span><span> </span><span class="hs-identifier">headNote</span><span class="hs-special">|]</span><span>
</span><span id="line-1682"></span><span>                </span><span class="annot"><span class="annottext">forall (m :: * -&gt; *) a. Monad m =&gt; a -&gt; m a
</span><span class="hs-identifier hs-var">return</span></span><span> </span><span class="hs-special">[</span><span class="annot"><span class="annottext">[Pat] -&gt; Exp -&gt; Clause
</span><a href="Database.Persist.TH.html#normalClause"><span class="hs-identifier hs-var">normalClause</span></a></span><span> </span><span class="hs-special">[</span><span class="hs-special">]</span><span> </span><span class="annot"><span class="annottext">Exp
</span><a href="#local-6989586621679964584"><span class="hs-identifier hs-var">e</span></a></span><span class="hs-special">]</span><span>
</span><span id="line-1683"></span><span>  </span><span class="hs-keyword">where</span><span>
</span><span id="line-1684"></span><span>    </span><span id="local-6989586621679964585"><span class="annot"><span class="annottext">keyConE :: Exp
</span><a href="#local-6989586621679964585"><span class="hs-identifier hs-var hs-var">keyConE</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">UnboundEntityDef -&gt; Exp
</span><a href="Database.Persist.TH.html#keyConExp"><span class="hs-identifier hs-var">keyConExp</span></a></span><span> </span><span class="annot"><span class="annottext">UnboundEntityDef
</span><a href="#local-6989586621679964587"><span class="hs-identifier hs-var">entDef</span></a></span><span>
</span><span id="line-1685"></span><span>
</span><span id="line-1686"></span><span class="annot"><a href="Database.Persist.TH.html#headNote"><span class="hs-identifier hs-type">headNote</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="hs-special">[</span><span class="annot"><a href="Database.Persist.PersistValue.html#PersistValue"><span class="hs-identifier hs-type">PersistValue</span></a></span><span class="hs-special">]</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="Database.Persist.PersistValue.html#PersistValue"><span class="hs-identifier hs-type">PersistValue</span></a></span><span>
</span><span id="line-1687"></span><span id="headNote"><span class="annot"><span class="annottext">headNote :: [PersistValue] -&gt; PersistValue
</span><a href="Database.Persist.TH.html#headNote"><span class="hs-identifier hs-var hs-var">headNote</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-glyph">\</span><span class="hs-glyph">case</span><span>
</span><span id="line-1688"></span><span>  </span><span class="hs-special">[</span><span id="local-6989586621679964582"><span class="annot"><span class="annottext">PersistValue
</span><a href="#local-6989586621679964582"><span class="hs-identifier hs-var">x</span></a></span></span><span class="hs-special">]</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="annottext">PersistValue
</span><a href="#local-6989586621679964582"><span class="hs-identifier hs-var">x</span></a></span><span>
</span><span id="line-1689"></span><span>  </span><span id="local-6989586621679964581"><span class="annot"><span class="annottext">[PersistValue]
</span><a href="#local-6989586621679964581"><span class="hs-identifier hs-var">xs</span></a></span></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="annottext">forall a. HasCallStack =&gt; String -&gt; a
</span><span class="hs-identifier hs-var">error</span></span><span> </span><span class="annot"><span class="annottext">forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span> </span><span class="annot"><span class="annottext">String
</span><span class="hs-string">&quot;mkKeyFromValues: expected a list of one element, got: &quot;</span></span><span> </span><span class="annot"><span class="annottext">forall m. Monoid m =&gt; m -&gt; m -&gt; m
</span><span class="hs-operator hs-var">`mappend`</span></span><span> </span><span class="annot"><span class="annottext">forall a. Show a =&gt; a -&gt; String
</span><span class="hs-identifier hs-var">show</span></span><span> </span><span class="annot"><span class="annottext">[PersistValue]
</span><a href="#local-6989586621679964581"><span class="hs-identifier hs-var">xs</span></a></span><span>
</span><span id="line-1690"></span><span>
</span><span id="line-1691"></span><span class="hs-comment">-- needs from entity:</span><span>
</span><span id="line-1692"></span><span class="hs-comment">--</span><span>
</span><span id="line-1693"></span><span class="hs-comment">-- * entityText entDef</span><span>
</span><span id="line-1694"></span><span class="hs-comment">--     * entityHaskell</span><span>
</span><span id="line-1695"></span><span class="hs-comment">-- * entityDB entDef</span><span>
</span><span id="line-1696"></span><span class="hs-comment">--</span><span>
</span><span id="line-1697"></span><span class="hs-comment">-- needs from fields:</span><span>
</span><span id="line-1698"></span><span class="hs-comment">--</span><span>
</span><span id="line-1699"></span><span class="hs-comment">-- * mkPersistValue</span><span>
</span><span id="line-1700"></span><span class="hs-comment">--     *  fieldHaskell</span><span>
</span><span id="line-1701"></span><span class="hs-comment">--</span><span>
</span><span id="line-1702"></span><span class="hs-comment">-- data MkFromValues = MkFromValues</span><span>
</span><span id="line-1703"></span><span class="hs-comment">--     { entityHaskell :: EntityNameHS</span><span>
</span><span id="line-1704"></span><span class="hs-comment">--     , entityDB :: EntitynameDB</span><span>
</span><span id="line-1705"></span><span class="hs-comment">--     , entityFieldNames :: [FieldNameHS]</span><span>
</span><span id="line-1706"></span><span class="hs-comment">--     }</span><span>
</span><span id="line-1707"></span><span class="annot"><a href="Database.Persist.TH.html#fromValues"><span class="hs-identifier hs-type">fromValues</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><a href="Database.Persist.Quasi.Internal.html#UnboundEntityDef"><span class="hs-identifier hs-type">UnboundEntityDef</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="hs-identifier hs-type">Text</span></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="hs-identifier hs-type">Exp</span></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-special">[</span><span class="annot"><a href="Database.Persist.Names.html#FieldNameHS"><span class="hs-identifier hs-type">FieldNameHS</span></a></span><span class="hs-special">]</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="hs-identifier hs-type">Q</span></span><span> </span><span class="hs-special">[</span><span class="annot"><span class="hs-identifier hs-type">Clause</span></span><span class="hs-special">]</span><span>
</span><span id="line-1708"></span><span id="fromValues"><span class="annot"><span class="annottext">fromValues :: UnboundEntityDef -&gt; Text -&gt; Exp -&gt; [FieldNameHS] -&gt; Q [Clause]
</span><a href="Database.Persist.TH.html#fromValues"><span class="hs-identifier hs-var hs-var">fromValues</span></a></span></span><span> </span><span id="local-6989586621679964580"><span class="annot"><span class="annottext">UnboundEntityDef
</span><a href="#local-6989586621679964580"><span class="hs-identifier hs-var">entDef</span></a></span></span><span> </span><span id="local-6989586621679964579"><span class="annot"><span class="annottext">Text
</span><a href="#local-6989586621679964579"><span class="hs-identifier hs-var">funName</span></a></span></span><span> </span><span id="local-6989586621679964578"><span class="annot"><span class="annottext">Exp
</span><a href="#local-6989586621679964578"><span class="hs-identifier hs-var">constructExpr</span></a></span></span><span> </span><span id="local-6989586621679964577"><span class="annot"><span class="annottext">[FieldNameHS]
</span><a href="#local-6989586621679964577"><span class="hs-identifier hs-var">fields</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-keyword">do</span><span>
</span><span id="line-1709"></span><span>    </span><span id="local-6989586621679964576"><span class="annot"><span class="annottext">Name
</span><a href="#local-6989586621679964576"><span class="hs-identifier hs-var">x</span></a></span></span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">forall (m :: * -&gt; *). Quote m =&gt; String -&gt; m Name
</span><span class="hs-identifier hs-var">newName</span></span><span> </span><span class="annot"><span class="annottext">String
</span><span class="hs-string">&quot;x&quot;</span></span><span>
</span><span id="line-1710"></span><span>    </span><span class="hs-keyword">let</span><span>
</span><span id="line-1711"></span><span>        </span><span id="local-6989586621679964575"><span class="annot"><span class="annottext">funMsg :: Text
</span><a href="#local-6989586621679964575"><span class="hs-identifier hs-var hs-var">funMsg</span></a></span></span><span> </span><span class="hs-glyph">=</span><span>
</span><span id="line-1712"></span><span>            </span><span class="annot"><span class="annottext">forall a. Monoid a =&gt; [a] -&gt; a
</span><span class="hs-identifier hs-var">mconcat</span></span><span>
</span><span id="line-1713"></span><span>                </span><span class="hs-special">[</span><span> </span><span class="annot"><span class="annottext">UnboundEntityDef -&gt; Text
</span><a href="Database.Persist.TH.html#entityText"><span class="hs-identifier hs-var">entityText</span></a></span><span> </span><span class="annot"><span class="annottext">UnboundEntityDef
</span><a href="#local-6989586621679964580"><span class="hs-identifier hs-var">entDef</span></a></span><span>
</span><span id="line-1714"></span><span>                </span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">Text
</span><span class="hs-string">&quot;: &quot;</span></span><span>
</span><span id="line-1715"></span><span>                </span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">Text
</span><a href="#local-6989586621679964579"><span class="hs-identifier hs-var">funName</span></a></span><span>
</span><span id="line-1716"></span><span>                </span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">Text
</span><span class="hs-string">&quot; failed on: &quot;</span></span><span>
</span><span id="line-1717"></span><span>                </span><span class="hs-special">]</span><span>
</span><span id="line-1718"></span><span>    </span><span id="local-6989586621679964573"><span class="annot"><span class="annottext">Exp
</span><a href="#local-6989586621679964573"><span class="hs-identifier hs-var">patternMatchFailure</span></a></span></span><span> </span><span class="hs-glyph">&lt;-</span><span>
</span><span id="line-1719"></span><span>        </span><span class="hs-special">[|</span><span class="hs-identifier">Left</span><span> </span><span class="hs-operator">$</span><span> </span><span class="hs-identifier">mappend</span><span> </span><span class="hs-identifier">funMsg</span><span> </span><span class="hs-special">(</span><span class="hs-identifier">pack</span><span> </span><span class="hs-operator">$</span><span> </span><span class="hs-identifier">show</span><span> </span><span class="hs-special">$</span><span class="hs-special">(</span><span class="hs-identifier">return</span><span> </span><span class="hs-operator">$</span><span> </span><span class="hs-identifier">VarE</span><span> </span><span class="hs-identifier">x</span><span class="hs-special">)</span><span class="hs-special">)</span><span class="hs-special">|]</span><span>
</span><span id="line-1720"></span><span>    </span><span id="local-6989586621679964572"><span class="annot"><span class="annottext">Clause
</span><a href="#local-6989586621679964572"><span class="hs-identifier hs-var">suc</span></a></span></span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">Q Clause
</span><a href="#local-6989586621679964571"><span class="hs-identifier hs-var">patternSuccess</span></a></span><span>
</span><span id="line-1721"></span><span>    </span><span class="annot"><span class="annottext">forall (m :: * -&gt; *) a. Monad m =&gt; a -&gt; m a
</span><span class="hs-identifier hs-var">return</span></span><span> </span><span class="hs-special">[</span><span> </span><span class="annot"><span class="annottext">Clause
</span><a href="#local-6989586621679964572"><span class="hs-identifier hs-var">suc</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">[Pat] -&gt; Exp -&gt; Clause
</span><a href="Database.Persist.TH.html#normalClause"><span class="hs-identifier hs-var">normalClause</span></a></span><span> </span><span class="hs-special">[</span><span class="annot"><span class="annottext">Name -&gt; Pat
</span><span class="hs-identifier hs-var">VarP</span></span><span> </span><span class="annot"><span class="annottext">Name
</span><a href="#local-6989586621679964576"><span class="hs-identifier hs-var">x</span></a></span><span class="hs-special">]</span><span> </span><span class="annot"><span class="annottext">Exp
</span><a href="#local-6989586621679964573"><span class="hs-identifier hs-var">patternMatchFailure</span></a></span><span> </span><span class="hs-special">]</span><span>
</span><span id="line-1722"></span><span>  </span><span class="hs-keyword">where</span><span>
</span><span id="line-1723"></span><span>    </span><span id="local-6989586621679964570"><span class="annot"><span class="annottext">tableName :: Text
</span><a href="#local-6989586621679964570"><span class="hs-identifier hs-var hs-var">tableName</span></a></span></span><span> </span><span class="hs-glyph">=</span><span>
</span><span id="line-1724"></span><span>        </span><span class="annot"><span class="annottext">EntityNameDB -&gt; Text
</span><a href="Database.Persist.Names.html#unEntityNameDB"><span class="hs-identifier hs-var">unEntityNameDB</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">EntityDef -&gt; EntityNameDB
</span><a href="Database.Persist.Types.Base.html#entityDB"><span class="hs-identifier hs-var">entityDB</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">UnboundEntityDef -&gt; EntityDef
</span><a href="Database.Persist.Quasi.Internal.html#unboundEntityDef"><span class="hs-identifier hs-var">unboundEntityDef</span></a></span><span> </span><span class="annot"><span class="annottext">UnboundEntityDef
</span><a href="#local-6989586621679964580"><span class="hs-identifier hs-var">entDef</span></a></span><span class="hs-special">)</span><span class="hs-special">)</span><span>
</span><span id="line-1725"></span><span>    </span><span id="local-6989586621679964571"><span class="annot"><span class="annottext">patternSuccess :: Q Clause
</span><a href="#local-6989586621679964571"><span class="hs-identifier hs-var hs-var">patternSuccess</span></a></span></span><span> </span><span class="hs-glyph">=</span><span>
</span><span id="line-1726"></span><span>        </span><span class="hs-keyword">case</span><span> </span><span class="annot"><span class="annottext">[FieldNameHS]
</span><a href="#local-6989586621679964577"><span class="hs-identifier hs-var">fields</span></a></span><span> </span><span class="hs-keyword">of</span><span>
</span><span id="line-1727"></span><span>            </span><span class="hs-special">[</span><span class="hs-special">]</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-keyword">do</span><span>
</span><span id="line-1728"></span><span>                </span><span id="local-6989586621679964568"><span class="annot"><span class="annottext">Exp
</span><a href="#local-6989586621679964568"><span class="hs-identifier hs-var">rightE</span></a></span></span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="hs-special">[|</span><span class="hs-identifier">Right</span><span class="hs-special">|]</span><span>
</span><span id="line-1729"></span><span>                </span><span class="annot"><span class="annottext">forall (m :: * -&gt; *) a. Monad m =&gt; a -&gt; m a
</span><span class="hs-identifier hs-var">return</span></span><span> </span><span class="annot"><span class="annottext">forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span> </span><span class="annot"><span class="annottext">[Pat] -&gt; Exp -&gt; Clause
</span><a href="Database.Persist.TH.html#normalClause"><span class="hs-identifier hs-var">normalClause</span></a></span><span> </span><span class="hs-special">[</span><span class="annot"><span class="annottext">[Pat] -&gt; Pat
</span><span class="hs-identifier hs-var">ListP</span></span><span> </span><span class="hs-special">[</span><span class="hs-special">]</span><span class="hs-special">]</span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Exp
</span><a href="#local-6989586621679964568"><span class="hs-identifier hs-var">rightE</span></a></span><span> </span><span class="annot"><span class="annottext">Exp -&gt; Exp -&gt; Exp
</span><span class="hs-operator hs-var">`AppE`</span></span><span> </span><span class="annot"><span class="annottext">Exp
</span><a href="#local-6989586621679964578"><span class="hs-identifier hs-var">constructExpr</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-1730"></span><span>            </span><span class="annot"><span class="annottext">[FieldNameHS]
</span><span class="hs-identifier">_</span></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-keyword">do</span><span>
</span><span id="line-1731"></span><span>                </span><span id="local-6989586621679964567"><span class="annot"><span class="annottext">Name
</span><a href="#local-6989586621679964567"><span class="hs-identifier hs-var">x1</span></a></span></span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">forall (m :: * -&gt; *). Quote m =&gt; String -&gt; m Name
</span><span class="hs-identifier hs-var">newName</span></span><span> </span><span class="annot"><span class="annottext">String
</span><span class="hs-string">&quot;x1&quot;</span></span><span>
</span><span id="line-1732"></span><span>                </span><span id="local-6989586621679964566"><span class="annot"><span class="annottext">[Name]
</span><a href="#local-6989586621679964566"><span class="hs-identifier hs-var">restNames</span></a></span></span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">forall (t :: * -&gt; *) (m :: * -&gt; *) a b.
(Traversable t, Monad m) =&gt;
(a -&gt; m b) -&gt; t a -&gt; m (t b)
</span><span class="hs-identifier hs-var">mapM</span></span><span> </span><span class="hs-special">(</span><span class="hs-glyph">\</span><span id="local-6989586621679964565"><span class="annot"><span class="annottext">Int
</span><a href="#local-6989586621679964565"><span class="hs-identifier hs-var">i</span></a></span></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="annottext">forall (m :: * -&gt; *). Quote m =&gt; String -&gt; m Name
</span><span class="hs-identifier hs-var">newName</span></span><span> </span><span class="annot"><span class="annottext">forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span> </span><span class="annot"><span class="annottext">String
</span><span class="hs-string">&quot;x&quot;</span></span><span> </span><span class="annot"><span class="annottext">forall m. Monoid m =&gt; m -&gt; m -&gt; m
</span><span class="hs-operator hs-var">`mappend`</span></span><span> </span><span class="annot"><span class="annottext">forall a. Show a =&gt; a -&gt; String
</span><span class="hs-identifier hs-var">show</span></span><span> </span><span class="annot"><span class="annottext">Int
</span><a href="#local-6989586621679964565"><span class="hs-identifier hs-var">i</span></a></span><span class="hs-special">)</span><span> </span><span class="hs-special">[</span><span class="annot"><span class="annottext">Int
</span><span class="hs-number">2</span></span><span class="hs-glyph">..</span><span class="annot"><span class="annottext">forall (t :: * -&gt; *) a. Foldable t =&gt; t a -&gt; Int
</span><span class="hs-identifier hs-var">length</span></span><span> </span><span class="annot"><span class="annottext">[FieldNameHS]
</span><a href="#local-6989586621679964577"><span class="hs-identifier hs-var">fields</span></a></span><span class="hs-special">]</span><span>
</span><span id="line-1733"></span><span>                </span><span class="hs-special">(</span><span id="local-6989586621679964564"><span class="annot"><span class="annottext">Exp
</span><a href="#local-6989586621679964564"><span class="hs-identifier hs-var">fpv1</span></a></span></span><span class="annot"><span class="hs-glyph hs-type">:</span></span><span id="local-6989586621679964563"><span class="annot"><span class="annottext">[Exp]
</span><a href="#local-6989586621679964563"><span class="hs-identifier hs-var">mkPersistValues</span></a></span></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">forall (t :: * -&gt; *) (m :: * -&gt; *) a b.
(Traversable t, Monad m) =&gt;
(a -&gt; m b) -&gt; t a -&gt; m (t b)
</span><span class="hs-identifier hs-var">mapM</span></span><span> </span><span class="annot"><span class="annottext">FieldNameHS -&gt; Q Exp
</span><a href="#local-6989586621679964562"><span class="hs-identifier hs-var">mkPersistValue</span></a></span><span> </span><span class="annot"><span class="annottext">[FieldNameHS]
</span><a href="#local-6989586621679964577"><span class="hs-identifier hs-var">fields</span></a></span><span>
</span><span id="line-1734"></span><span>                </span><span id="local-6989586621679964561"><span class="annot"><span class="annottext">Exp
</span><a href="#local-6989586621679964561"><span class="hs-identifier hs-var">app1E</span></a></span></span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="hs-special">[|</span><span class="hs-special">(</span><span class="hs-operator">&lt;$&gt;</span><span class="hs-special">)</span><span class="hs-special">|]</span><span>
</span><span id="line-1735"></span><span>                </span><span class="hs-keyword">let</span><span> </span><span id="local-6989586621679964560"><span class="annot"><span class="annottext">conApp :: Exp
</span><a href="#local-6989586621679964560"><span class="hs-identifier hs-var hs-var">conApp</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">Exp -&gt; Exp -&gt; Exp -&gt; Name -&gt; Exp
</span><a href="#local-6989586621679964559"><span class="hs-identifier hs-var">infixFromPersistValue</span></a></span><span> </span><span class="annot"><span class="annottext">Exp
</span><a href="#local-6989586621679964561"><span class="hs-identifier hs-var">app1E</span></a></span><span> </span><span class="annot"><span class="annottext">Exp
</span><a href="#local-6989586621679964564"><span class="hs-identifier hs-var">fpv1</span></a></span><span> </span><span class="annot"><span class="annottext">Exp
</span><a href="#local-6989586621679964578"><span class="hs-identifier hs-var">constructExpr</span></a></span><span> </span><span class="annot"><span class="annottext">Name
</span><a href="#local-6989586621679964567"><span class="hs-identifier hs-var">x1</span></a></span><span>
</span><span id="line-1736"></span><span>                </span><span id="local-6989586621679964558"><span class="annot"><span class="annottext">Exp
</span><a href="#local-6989586621679964558"><span class="hs-identifier hs-var">applyE</span></a></span></span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="hs-special">[|</span><span class="hs-special">(</span><span class="hs-operator">&lt;*&gt;</span><span class="hs-special">)</span><span class="hs-special">|]</span><span>
</span><span id="line-1737"></span><span>                </span><span class="hs-keyword">let</span><span> </span><span id="local-6989586621679964557"><span class="annot"><span class="annottext">applyFromPersistValue :: Exp -&gt; Exp -&gt; Name -&gt; Exp
</span><a href="#local-6989586621679964557"><span class="hs-identifier hs-var hs-var">applyFromPersistValue</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">Exp -&gt; Exp -&gt; Exp -&gt; Name -&gt; Exp
</span><a href="#local-6989586621679964559"><span class="hs-identifier hs-var">infixFromPersistValue</span></a></span><span> </span><span class="annot"><span class="annottext">Exp
</span><a href="#local-6989586621679964558"><span class="hs-identifier hs-var">applyE</span></a></span><span>
</span><span id="line-1738"></span><span>
</span><span id="line-1739"></span><span>                </span><span class="annot"><span class="annottext">forall (m :: * -&gt; *) a. Monad m =&gt; a -&gt; m a
</span><span class="hs-identifier hs-var">return</span></span><span> </span><span class="annot"><span class="annottext">forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span> </span><span class="annot"><span class="annottext">[Pat] -&gt; Exp -&gt; Clause
</span><a href="Database.Persist.TH.html#normalClause"><span class="hs-identifier hs-var">normalClause</span></a></span><span>
</span><span id="line-1740"></span><span>                    </span><span class="hs-special">[</span><span class="annot"><span class="annottext">[Pat] -&gt; Pat
</span><span class="hs-identifier hs-var">ListP</span></span><span> </span><span class="annot"><span class="annottext">forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span> </span><span class="annot"><span class="annottext">forall (f :: * -&gt; *) a b. Functor f =&gt; (a -&gt; b) -&gt; f a -&gt; f b
</span><span class="hs-identifier hs-var">fmap</span></span><span> </span><span class="annot"><span class="annottext">Name -&gt; Pat
</span><span class="hs-identifier hs-var">VarP</span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Name
</span><a href="#local-6989586621679964567"><span class="hs-identifier hs-var">x1</span></a></span><span class="annot"><span class="annottext">forall a. a -&gt; [a] -&gt; [a]
</span><span class="hs-glyph hs-var">:</span></span><span class="annot"><span class="annottext">[Name]
</span><a href="#local-6989586621679964566"><span class="hs-identifier hs-var">restNames</span></a></span><span class="hs-special">)</span><span class="hs-special">]</span><span>
</span><span id="line-1741"></span><span>                    </span><span class="hs-special">(</span><span class="annot"><span class="annottext">forall (t :: * -&gt; *) b a.
Foldable t =&gt;
(b -&gt; a -&gt; b) -&gt; b -&gt; t a -&gt; b
</span><span class="hs-identifier hs-var">foldl'</span></span><span> </span><span class="hs-special">(</span><span class="hs-glyph">\</span><span id="local-6989586621679964556"><span class="annot"><span class="annottext">Exp
</span><a href="#local-6989586621679964556"><span class="hs-identifier hs-var">exp</span></a></span></span><span> </span><span class="hs-special">(</span><span id="local-6989586621679964555"><span class="annot"><span class="annottext">Name
</span><a href="#local-6989586621679964555"><span class="hs-identifier hs-var">name</span></a></span></span><span class="hs-special">,</span><span> </span><span id="local-6989586621679964554"><span class="annot"><span class="annottext">Exp
</span><a href="#local-6989586621679964554"><span class="hs-identifier hs-var">fpv</span></a></span></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="annottext">Exp -&gt; Exp -&gt; Name -&gt; Exp
</span><a href="#local-6989586621679964557"><span class="hs-identifier hs-var">applyFromPersistValue</span></a></span><span> </span><span class="annot"><span class="annottext">Exp
</span><a href="#local-6989586621679964554"><span class="hs-identifier hs-var">fpv</span></a></span><span> </span><span class="annot"><span class="annottext">Exp
</span><a href="#local-6989586621679964556"><span class="hs-identifier hs-var">exp</span></a></span><span> </span><span class="annot"><span class="annottext">Name
</span><a href="#local-6989586621679964555"><span class="hs-identifier hs-var">name</span></a></span><span class="hs-special">)</span><span> </span><span class="annot"><span class="annottext">Exp
</span><a href="#local-6989586621679964560"><span class="hs-identifier hs-var">conApp</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">forall a b. [a] -&gt; [b] -&gt; [(a, b)]
</span><span class="hs-identifier hs-var">zip</span></span><span> </span><span class="annot"><span class="annottext">[Name]
</span><a href="#local-6989586621679964566"><span class="hs-identifier hs-var">restNames</span></a></span><span> </span><span class="annot"><span class="annottext">[Exp]
</span><a href="#local-6989586621679964563"><span class="hs-identifier hs-var">mkPersistValues</span></a></span><span class="hs-special">)</span><span class="hs-special">)</span><span>
</span><span id="line-1742"></span><span>
</span><span id="line-1743"></span><span>    </span><span id="local-6989586621679964559"><span class="annot"><span class="annottext">infixFromPersistValue :: Exp -&gt; Exp -&gt; Exp -&gt; Name -&gt; Exp
</span><a href="#local-6989586621679964559"><span class="hs-identifier hs-var hs-var">infixFromPersistValue</span></a></span></span><span> </span><span id="local-6989586621679964553"><span class="annot"><span class="annottext">Exp
</span><a href="#local-6989586621679964553"><span class="hs-identifier hs-var">applyE</span></a></span></span><span> </span><span id="local-6989586621679964552"><span class="annot"><span class="annottext">Exp
</span><a href="#local-6989586621679964552"><span class="hs-identifier hs-var">fpv</span></a></span></span><span> </span><span id="local-6989586621679964551"><span class="annot"><span class="annottext">Exp
</span><a href="#local-6989586621679964551"><span class="hs-identifier hs-var">exp</span></a></span></span><span> </span><span id="local-6989586621679964550"><span class="annot"><span class="annottext">Name
</span><a href="#local-6989586621679964550"><span class="hs-identifier hs-var">name</span></a></span></span><span> </span><span class="hs-glyph">=</span><span>
</span><span id="line-1744"></span><span>        </span><span class="annot"><span class="annottext">Exp -&gt; Exp -&gt; Exp -&gt; Exp
</span><span class="hs-identifier hs-var">UInfixE</span></span><span> </span><span class="annot"><span class="annottext">Exp
</span><a href="#local-6989586621679964551"><span class="hs-identifier hs-var">exp</span></a></span><span> </span><span class="annot"><span class="annottext">Exp
</span><a href="#local-6989586621679964553"><span class="hs-identifier hs-var">applyE</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Exp
</span><a href="#local-6989586621679964552"><span class="hs-identifier hs-var">fpv</span></a></span><span> </span><span class="annot"><span class="annottext">Exp -&gt; Exp -&gt; Exp
</span><span class="hs-operator hs-var">`AppE`</span></span><span> </span><span class="annot"><span class="annottext">Name -&gt; Exp
</span><span class="hs-identifier hs-var">VarE</span></span><span> </span><span class="annot"><span class="annottext">Name
</span><a href="#local-6989586621679964550"><span class="hs-identifier hs-var">name</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-1745"></span><span>
</span><span id="line-1746"></span><span>    </span><span id="local-6989586621679964562"><span class="annot"><span class="annottext">mkPersistValue :: FieldNameHS -&gt; Q Exp
</span><a href="#local-6989586621679964562"><span class="hs-identifier hs-var hs-var">mkPersistValue</span></a></span></span><span> </span><span id="local-6989586621679964548"><span class="annot"><span class="annottext">FieldNameHS
</span><a href="#local-6989586621679964548"><span class="hs-identifier hs-var">field</span></a></span></span><span> </span><span class="hs-glyph">=</span><span>
</span><span id="line-1747"></span><span>        </span><span class="hs-keyword">let</span><span> </span><span id="local-6989586621679964547"><span class="annot"><span class="annottext">fieldName :: Text
</span><a href="#local-6989586621679964547"><span class="hs-identifier hs-var hs-var">fieldName</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">FieldNameHS -&gt; Text
</span><a href="Database.Persist.Names.html#unFieldNameHS"><span class="hs-identifier hs-var">unFieldNameHS</span></a></span><span> </span><span class="annot"><span class="annottext">FieldNameHS
</span><a href="#local-6989586621679964548"><span class="hs-identifier hs-var">field</span></a></span><span>
</span><span id="line-1748"></span><span>        </span><span class="hs-keyword">in</span><span> </span><span class="hs-special">[|</span><span class="hs-identifier">mapLeft</span><span> </span><span class="hs-special">(</span><span class="hs-identifier">fieldError</span><span> </span><span class="hs-identifier">tableName</span><span> </span><span class="hs-identifier">fieldName</span><span class="hs-special">)</span><span> </span><span class="hs-operator">.</span><span> </span><span class="hs-identifier">fromPersistValue</span><span class="hs-special">|]</span><span>
</span><span id="line-1749"></span><span>
</span><span id="line-1750"></span><span class="hs-comment">-- |  Render an error message based on the @tableName@ and @fieldName@ with</span><span>
</span><span id="line-1751"></span><span class="hs-comment">-- the provided message.</span><span>
</span><span id="line-1752"></span><span class="hs-comment">--</span><span>
</span><span id="line-1753"></span><span class="hs-comment">-- @since 2.8.2</span><span>
</span><span id="line-1754"></span><span class="annot"><a href="Database.Persist.TH.html#fieldError"><span class="hs-identifier hs-type">fieldError</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><span class="hs-identifier hs-type">Text</span></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="hs-identifier hs-type">Text</span></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="hs-identifier hs-type">Text</span></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="hs-identifier hs-type">Text</span></span><span>
</span><span id="line-1755"></span><span id="fieldError"><span class="annot"><span class="annottext">fieldError :: Text -&gt; Text -&gt; Text -&gt; Text
</span><a href="Database.Persist.TH.html#fieldError"><span class="hs-identifier hs-var hs-var">fieldError</span></a></span></span><span> </span><span id="local-6989586621679964546"><span class="annot"><span class="annottext">Text
</span><a href="#local-6989586621679964546"><span class="hs-identifier hs-var">tableName</span></a></span></span><span> </span><span id="local-6989586621679964545"><span class="annot"><span class="annottext">Text
</span><a href="#local-6989586621679964545"><span class="hs-identifier hs-var">fieldName</span></a></span></span><span> </span><span id="local-6989586621679964544"><span class="annot"><span class="annottext">Text
</span><a href="#local-6989586621679964544"><span class="hs-identifier hs-var">err</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">forall a. Monoid a =&gt; [a] -&gt; a
</span><span class="hs-identifier hs-var">mconcat</span></span><span>
</span><span id="line-1756"></span><span>    </span><span class="hs-special">[</span><span> </span><span class="annot"><span class="annottext">Text
</span><span class="hs-string">&quot;Couldn't parse field `&quot;</span></span><span>
</span><span id="line-1757"></span><span>    </span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">Text
</span><a href="#local-6989586621679964545"><span class="hs-identifier hs-var">fieldName</span></a></span><span>
</span><span id="line-1758"></span><span>    </span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">Text
</span><span class="hs-string">&quot;` from table `&quot;</span></span><span>
</span><span id="line-1759"></span><span>    </span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">Text
</span><a href="#local-6989586621679964546"><span class="hs-identifier hs-var">tableName</span></a></span><span>
</span><span id="line-1760"></span><span>    </span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">Text
</span><span class="hs-string">&quot;`. &quot;</span></span><span>
</span><span id="line-1761"></span><span>    </span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">Text
</span><a href="#local-6989586621679964544"><span class="hs-identifier hs-var">err</span></a></span><span>
</span><span id="line-1762"></span><span>    </span><span class="hs-special">]</span><span>
</span><span id="line-1763"></span><span>
</span><span id="line-1764"></span><span id="local-6989586621679966486"><span class="annot"><a href="Database.Persist.TH.html#mkEntity"><span class="hs-identifier hs-type">mkEntity</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><span class="hs-identifier hs-type">M.Map</span></span><span> </span><span class="annot"><a href="Database.Persist.Names.html#EntityNameHS"><span class="hs-identifier hs-type">EntityNameHS</span></a></span><span> </span><span class="annot"><a href="#local-6989586621679966486"><span class="hs-identifier hs-type">a</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="Database.Persist.TH.html#EntityMap"><span class="hs-identifier hs-type">EntityMap</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="Database.Persist.TH.html#MkPersistSettings"><span class="hs-identifier hs-type">MkPersistSettings</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="Database.Persist.Quasi.Internal.html#UnboundEntityDef"><span class="hs-identifier hs-type">UnboundEntityDef</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="hs-identifier hs-type">Q</span></span><span> </span><span class="hs-special">[</span><span class="annot"><span class="hs-identifier hs-type">Dec</span></span><span class="hs-special">]</span></span><span>
</span><span id="line-1765"></span><span id="mkEntity"><span class="annot"><span class="annottext">mkEntity :: forall a.
Map EntityNameHS a
-&gt; EntityMap -&gt; MkPersistSettings -&gt; UnboundEntityDef -&gt; Q [Dec]
</span><a href="Database.Persist.TH.html#mkEntity"><span class="hs-identifier hs-var hs-var">mkEntity</span></a></span></span><span> </span><span id="local-6989586621679964507"><span class="annot"><span class="annottext">Map EntityNameHS a
</span><a href="#local-6989586621679964507"><span class="hs-identifier hs-var">embedEntityMap</span></a></span></span><span> </span><span id="local-6989586621679964506"><span class="annot"><span class="annottext">EntityMap
</span><a href="#local-6989586621679964506"><span class="hs-identifier hs-var">entityMap</span></a></span></span><span> </span><span id="local-6989586621679964505"><span class="annot"><span class="annottext">MkPersistSettings
</span><a href="#local-6989586621679964505"><span class="hs-identifier hs-var">mps</span></a></span></span><span> </span><span id="local-6989586621679964504"><span class="annot"><span class="annottext">UnboundEntityDef
</span><a href="#local-6989586621679964504"><span class="hs-identifier hs-var">preDef</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-keyword">do</span><span>
</span><span id="line-1766"></span><span>    </span><span id="local-6989586621679964503"><span class="annot"><span class="annottext">Exp
</span><a href="#local-6989586621679964503"><span class="hs-identifier hs-var">entityDefExp</span></a></span></span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">forall a.
MkPersistSettings
-&gt; Map EntityNameHS a -&gt; EntityMap -&gt; UnboundEntityDef -&gt; Q Exp
</span><a href="Database.Persist.TH.html#liftAndFixKeys"><span class="hs-identifier hs-var">liftAndFixKeys</span></a></span><span> </span><span class="annot"><span class="annottext">MkPersistSettings
</span><a href="#local-6989586621679964505"><span class="hs-identifier hs-var">mps</span></a></span><span> </span><span class="annot"><span class="annottext">Map EntityNameHS a
</span><a href="#local-6989586621679964507"><span class="hs-identifier hs-var">embedEntityMap</span></a></span><span> </span><span class="annot"><span class="annottext">EntityMap
</span><a href="#local-6989586621679964506"><span class="hs-identifier hs-var">entityMap</span></a></span><span> </span><span class="annot"><span class="annottext">UnboundEntityDef
</span><a href="#local-6989586621679964504"><span class="hs-identifier hs-var">preDef</span></a></span><span>
</span><span id="line-1767"></span><span>    </span><span class="hs-keyword">let</span><span>
</span><span id="line-1768"></span><span>        </span><span id="local-6989586621679964502"><span class="annot"><span class="annottext">entDef :: UnboundEntityDef
</span><a href="#local-6989586621679964502"><span class="hs-identifier hs-var hs-var">entDef</span></a></span></span><span> </span><span class="hs-glyph">=</span><span>
</span><span id="line-1769"></span><span>            </span><span class="annot"><span class="annottext">UnboundEntityDef -&gt; UnboundEntityDef
</span><a href="Database.Persist.TH.html#fixEntityDef"><span class="hs-identifier hs-var">fixEntityDef</span></a></span><span> </span><span class="annot"><span class="annottext">UnboundEntityDef
</span><a href="#local-6989586621679964504"><span class="hs-identifier hs-var">preDef</span></a></span><span>
</span><span id="line-1770"></span><span>    </span><span id="local-6989586621679964501"><span class="annot"><span class="annottext">EntityFieldsTH
</span><a href="#local-6989586621679964501"><span class="hs-identifier hs-var">fields</span></a></span></span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">MkPersistSettings
-&gt; EntityMap -&gt; UnboundEntityDef -&gt; Q EntityFieldsTH
</span><a href="Database.Persist.TH.html#mkFields"><span class="hs-identifier hs-var">mkFields</span></a></span><span> </span><span class="annot"><span class="annottext">MkPersistSettings
</span><a href="#local-6989586621679964505"><span class="hs-identifier hs-var">mps</span></a></span><span> </span><span class="annot"><span class="annottext">EntityMap
</span><a href="#local-6989586621679964506"><span class="hs-identifier hs-var">entityMap</span></a></span><span> </span><span class="annot"><span class="annottext">UnboundEntityDef
</span><a href="#local-6989586621679964502"><span class="hs-identifier hs-var">entDef</span></a></span><span>
</span><span id="line-1771"></span><span>    </span><span class="hs-keyword">let</span><span> </span><span id="local-6989586621679964499"><span class="annot"><span class="annottext">name :: Name
</span><a href="#local-6989586621679964499"><span class="hs-identifier hs-var hs-var">name</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">UnboundEntityDef -&gt; Name
</span><a href="Database.Persist.TH.html#mkEntityDefName"><span class="hs-identifier hs-var">mkEntityDefName</span></a></span><span> </span><span class="annot"><span class="annottext">UnboundEntityDef
</span><a href="#local-6989586621679964502"><span class="hs-identifier hs-var">entDef</span></a></span><span>
</span><span id="line-1772"></span><span>    </span><span class="hs-keyword">let</span><span> </span><span id="local-6989586621679964498"><span class="annot"><span class="annottext">clazz :: Type
</span><a href="#local-6989586621679964498"><span class="hs-identifier hs-var hs-var">clazz</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">Name -&gt; Type
</span><span class="hs-identifier hs-var">ConT</span></span><span> </span><span class="hs-special">''</span><span class="hs-identifier">PersistEntity</span><span> </span><span class="annot"><span class="annottext">Type -&gt; Type -&gt; Type
</span><span class="hs-operator hs-var">`AppT`</span></span><span> </span><span class="annot"><span class="annottext">Type
</span><a href="#local-6989586621679964497"><span class="hs-identifier hs-var">genDataType</span></a></span><span>
</span><span id="line-1773"></span><span>    </span><span id="local-6989586621679964496"><span class="annot"><span class="annottext">Dec
</span><a href="#local-6989586621679964496"><span class="hs-identifier hs-var">tpf</span></a></span></span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">MkPersistSettings -&gt; UnboundEntityDef -&gt; Q Dec
</span><a href="Database.Persist.TH.html#mkToPersistFields"><span class="hs-identifier hs-var">mkToPersistFields</span></a></span><span> </span><span class="annot"><span class="annottext">MkPersistSettings
</span><a href="#local-6989586621679964505"><span class="hs-identifier hs-var">mps</span></a></span><span> </span><span class="annot"><span class="annottext">UnboundEntityDef
</span><a href="#local-6989586621679964502"><span class="hs-identifier hs-var">entDef</span></a></span><span>
</span><span id="line-1774"></span><span>    </span><span id="local-6989586621679964495"><span class="annot"><span class="annottext">[Clause]
</span><a href="#local-6989586621679964495"><span class="hs-identifier hs-var">fpv</span></a></span></span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">MkPersistSettings -&gt; UnboundEntityDef -&gt; Q [Clause]
</span><a href="Database.Persist.TH.html#mkFromPersistValues"><span class="hs-identifier hs-var">mkFromPersistValues</span></a></span><span> </span><span class="annot"><span class="annottext">MkPersistSettings
</span><a href="#local-6989586621679964505"><span class="hs-identifier hs-var">mps</span></a></span><span> </span><span class="annot"><span class="annottext">UnboundEntityDef
</span><a href="#local-6989586621679964502"><span class="hs-identifier hs-var">entDef</span></a></span><span>
</span><span id="line-1775"></span><span>    </span><span id="local-6989586621679964494"><span class="annot"><span class="annottext">Dec
</span><a href="#local-6989586621679964494"><span class="hs-identifier hs-var">utv</span></a></span></span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">[UniqueDef] -&gt; Q Dec
</span><a href="Database.Persist.TH.html#mkUniqueToValues"><span class="hs-identifier hs-var">mkUniqueToValues</span></a></span><span> </span><span class="annot"><span class="annottext">forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span> </span><span class="annot"><span class="annottext">EntityDef -&gt; [UniqueDef]
</span><a href="Database.Persist.Types.Base.html#entityUniques"><span class="hs-identifier hs-var">entityUniques</span></a></span><span> </span><span class="annot"><span class="annottext">forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span> </span><span class="annot"><span class="annottext">UnboundEntityDef -&gt; EntityDef
</span><a href="Database.Persist.Quasi.Internal.html#unboundEntityDef"><span class="hs-identifier hs-var">unboundEntityDef</span></a></span><span> </span><span class="annot"><span class="annottext">UnboundEntityDef
</span><a href="#local-6989586621679964502"><span class="hs-identifier hs-var">entDef</span></a></span><span>
</span><span id="line-1776"></span><span>    </span><span id="local-6989586621679964493"><span class="annot"><span class="annottext">Dec
</span><a href="#local-6989586621679964493"><span class="hs-identifier hs-var">puk</span></a></span></span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">UnboundEntityDef -&gt; Q Dec
</span><a href="Database.Persist.TH.html#mkUniqueKeys"><span class="hs-identifier hs-var">mkUniqueKeys</span></a></span><span> </span><span class="annot"><span class="annottext">UnboundEntityDef
</span><a href="#local-6989586621679964502"><span class="hs-identifier hs-var">entDef</span></a></span><span>
</span><span id="line-1777"></span><span>    </span><span id="local-6989586621679964491"><span class="annot"><span class="annottext">[[Dec]]
</span><a href="#local-6989586621679964491"><span class="hs-identifier hs-var">fkc</span></a></span></span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">forall (t :: * -&gt; *) (m :: * -&gt; *) a b.
(Traversable t, Monad m) =&gt;
(a -&gt; m b) -&gt; t a -&gt; m (t b)
</span><span class="hs-identifier hs-var">mapM</span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">MkPersistSettings
-&gt; UnboundEntityDef -&gt; UnboundForeignDef -&gt; Q [Dec]
</span><a href="Database.Persist.TH.html#mkForeignKeysComposite"><span class="hs-identifier hs-var">mkForeignKeysComposite</span></a></span><span> </span><span class="annot"><span class="annottext">MkPersistSettings
</span><a href="#local-6989586621679964505"><span class="hs-identifier hs-var">mps</span></a></span><span> </span><span class="annot"><span class="annottext">UnboundEntityDef
</span><a href="#local-6989586621679964502"><span class="hs-identifier hs-var">entDef</span></a></span><span class="hs-special">)</span><span> </span><span class="annot"><span class="annottext">forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span> </span><span class="annot"><span class="annottext">UnboundEntityDef -&gt; [UnboundForeignDef]
</span><a href="Database.Persist.Quasi.Internal.html#unboundForeignDefs"><span class="hs-identifier hs-var">unboundForeignDefs</span></a></span><span> </span><span class="annot"><span class="annottext">UnboundEntityDef
</span><a href="#local-6989586621679964502"><span class="hs-identifier hs-var">entDef</span></a></span><span>
</span><span id="line-1778"></span><span>
</span><span id="line-1779"></span><span>    </span><span id="local-6989586621679964488"><span class="annot"><span class="annottext">Dec
</span><a href="#local-6989586621679964488"><span class="hs-identifier hs-var">toFieldNames</span></a></span></span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">[UniqueDef] -&gt; Q Dec
</span><a href="Database.Persist.TH.html#mkToFieldNames"><span class="hs-identifier hs-var">mkToFieldNames</span></a></span><span> </span><span class="annot"><span class="annottext">forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span> </span><span class="annot"><span class="annottext">EntityDef -&gt; [UniqueDef]
</span><a href="Database.Persist.Types.Base.html#entityUniques"><span class="hs-identifier hs-var">entityUniques</span></a></span><span> </span><span class="annot"><span class="annottext">forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span> </span><span class="annot"><span class="annottext">UnboundEntityDef -&gt; EntityDef
</span><a href="Database.Persist.Quasi.Internal.html#unboundEntityDef"><span class="hs-identifier hs-var">unboundEntityDef</span></a></span><span> </span><span class="annot"><span class="annottext">UnboundEntityDef
</span><a href="#local-6989586621679964502"><span class="hs-identifier hs-var">entDef</span></a></span><span>
</span><span id="line-1780"></span><span>
</span><span id="line-1781"></span><span>    </span><span class="hs-special">(</span><span id="local-6989586621679964487"><span class="annot"><span class="annottext">Dec
</span><a href="#local-6989586621679964487"><span class="hs-identifier hs-var">keyTypeDec</span></a></span></span><span class="hs-special">,</span><span> </span><span id="local-6989586621679964486"><span class="annot"><span class="annottext">[Dec]
</span><a href="#local-6989586621679964486"><span class="hs-identifier hs-var">keyInstanceDecs</span></a></span></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">MkPersistSettings -&gt; UnboundEntityDef -&gt; Q (Dec, [Dec])
</span><a href="Database.Persist.TH.html#mkKeyTypeDec"><span class="hs-identifier hs-var">mkKeyTypeDec</span></a></span><span> </span><span class="annot"><span class="annottext">MkPersistSettings
</span><a href="#local-6989586621679964505"><span class="hs-identifier hs-var">mps</span></a></span><span> </span><span class="annot"><span class="annottext">UnboundEntityDef
</span><a href="#local-6989586621679964502"><span class="hs-identifier hs-var">entDef</span></a></span><span>
</span><span id="line-1782"></span><span>    </span><span id="local-6989586621679964485"><span class="annot"><span class="annottext">Dec
</span><a href="#local-6989586621679964485"><span class="hs-identifier hs-var">keyToValues'</span></a></span></span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">MkPersistSettings -&gt; UnboundEntityDef -&gt; Q Dec
</span><a href="Database.Persist.TH.html#mkKeyToValues"><span class="hs-identifier hs-var">mkKeyToValues</span></a></span><span> </span><span class="annot"><span class="annottext">MkPersistSettings
</span><a href="#local-6989586621679964505"><span class="hs-identifier hs-var">mps</span></a></span><span> </span><span class="annot"><span class="annottext">UnboundEntityDef
</span><a href="#local-6989586621679964502"><span class="hs-identifier hs-var">entDef</span></a></span><span>
</span><span id="line-1783"></span><span>    </span><span id="local-6989586621679964484"><span class="annot"><span class="annottext">Dec
</span><a href="#local-6989586621679964484"><span class="hs-identifier hs-var">keyFromValues'</span></a></span></span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">MkPersistSettings -&gt; UnboundEntityDef -&gt; Q Dec
</span><a href="Database.Persist.TH.html#mkKeyFromValues"><span class="hs-identifier hs-var">mkKeyFromValues</span></a></span><span> </span><span class="annot"><span class="annottext">MkPersistSettings
</span><a href="#local-6989586621679964505"><span class="hs-identifier hs-var">mps</span></a></span><span> </span><span class="annot"><span class="annottext">UnboundEntityDef
</span><a href="#local-6989586621679964502"><span class="hs-identifier hs-var">entDef</span></a></span><span>
</span><span id="line-1784"></span><span>
</span><span id="line-1785"></span><span>    </span><span class="hs-keyword">let</span><span> </span><span id="local-6989586621679964483"><span class="annot"><span class="annottext">addSyn :: [Dec] -&gt; [Dec]
</span><a href="#local-6989586621679964483"><span class="hs-identifier hs-var hs-var">addSyn</span></a></span></span><span> </span><span class="hs-comment">-- FIXME maybe remove this</span><span>
</span><span id="line-1786"></span><span>            </span><span class="hs-glyph">|</span><span> </span><span class="annot"><span class="annottext">MkPersistSettings -&gt; Bool
</span><a href="Database.Persist.TH.html#mpsGeneric"><span class="hs-identifier hs-var">mpsGeneric</span></a></span><span> </span><span class="annot"><span class="annottext">MkPersistSettings
</span><a href="#local-6989586621679964505"><span class="hs-identifier hs-var">mps</span></a></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-special">(</span><span class="hs-glyph">:</span><span class="hs-special">)</span><span> </span><span class="annot"><span class="annottext">forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span>
</span><span id="line-1787"></span><span>                </span><span class="annot"><span class="annottext">Name -&gt; [TyVarBndr ()] -&gt; Type -&gt; Dec
</span><span class="hs-identifier hs-var">TySynD</span></span><span> </span><span class="annot"><span class="annottext">Name
</span><a href="#local-6989586621679964499"><span class="hs-identifier hs-var">name</span></a></span><span> </span><span class="hs-special">[</span><span class="hs-special">]</span><span> </span><span class="annot"><span class="annottext">forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span>
</span><span id="line-1788"></span><span>                    </span><span class="annot"><span class="annottext">MkPersistSettings -&gt; EntityNameHS -&gt; Type -&gt; Type
</span><a href="Database.Persist.TH.html#genericDataType"><span class="hs-identifier hs-var">genericDataType</span></a></span><span> </span><span class="annot"><span class="annottext">MkPersistSettings
</span><a href="#local-6989586621679964505"><span class="hs-identifier hs-var">mps</span></a></span><span> </span><span class="annot"><span class="annottext">EntityNameHS
</span><a href="#local-6989586621679964481"><span class="hs-identifier hs-var">entName</span></a></span><span> </span><span class="annot"><span class="annottext">forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span> </span><span class="annot"><span class="annottext">MkPersistSettings -&gt; Type
</span><a href="Database.Persist.TH.html#mpsBackend"><span class="hs-identifier hs-var">mpsBackend</span></a></span><span> </span><span class="annot"><span class="annottext">MkPersistSettings
</span><a href="#local-6989586621679964505"><span class="hs-identifier hs-var">mps</span></a></span><span>
</span><span id="line-1789"></span><span>            </span><span class="hs-glyph">|</span><span> </span><span class="annot"><span class="annottext">Bool
</span><span class="hs-identifier hs-var">otherwise</span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">forall a. a -&gt; a
</span><span class="hs-identifier hs-var">id</span></span><span>
</span><span id="line-1790"></span><span>
</span><span id="line-1791"></span><span>    </span><span id="local-6989586621679964480"><span class="annot"><span class="annottext">[Clause]
</span><a href="#local-6989586621679964480"><span class="hs-identifier hs-var">lensClauses</span></a></span></span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">MkPersistSettings -&gt; UnboundEntityDef -&gt; Type -&gt; Q [Clause]
</span><a href="Database.Persist.TH.html#mkLensClauses"><span class="hs-identifier hs-var">mkLensClauses</span></a></span><span> </span><span class="annot"><span class="annottext">MkPersistSettings
</span><a href="#local-6989586621679964505"><span class="hs-identifier hs-var">mps</span></a></span><span> </span><span class="annot"><span class="annottext">UnboundEntityDef
</span><a href="#local-6989586621679964502"><span class="hs-identifier hs-var">entDef</span></a></span><span> </span><span class="annot"><span class="annottext">Type
</span><a href="#local-6989586621679964497"><span class="hs-identifier hs-var">genDataType</span></a></span><span>
</span><span id="line-1792"></span><span>
</span><span id="line-1793"></span><span>    </span><span id="local-6989586621679964479"><span class="annot"><span class="annottext">[Dec]
</span><a href="#local-6989586621679964479"><span class="hs-identifier hs-var">lenses</span></a></span></span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">MkPersistSettings -&gt; EntityMap -&gt; UnboundEntityDef -&gt; Q [Dec]
</span><a href="Database.Persist.TH.html#mkLenses"><span class="hs-identifier hs-var">mkLenses</span></a></span><span> </span><span class="annot"><span class="annottext">MkPersistSettings
</span><a href="#local-6989586621679964505"><span class="hs-identifier hs-var">mps</span></a></span><span> </span><span class="annot"><span class="annottext">EntityMap
</span><a href="#local-6989586621679964506"><span class="hs-identifier hs-var">entityMap</span></a></span><span> </span><span class="annot"><span class="annottext">UnboundEntityDef
</span><a href="#local-6989586621679964502"><span class="hs-identifier hs-var">entDef</span></a></span><span>
</span><span id="line-1794"></span><span>    </span><span class="hs-keyword">let</span><span> </span><span id="local-6989586621679964477"><span class="annot"><span class="annottext">instanceConstraint :: [Type]
</span><a href="#local-6989586621679964477"><span class="hs-identifier hs-var hs-var">instanceConstraint</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-keyword">if</span><span> </span><span class="annot"><span class="annottext">Bool -&gt; Bool
</span><span class="hs-identifier hs-var">not</span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">MkPersistSettings -&gt; Bool
</span><a href="Database.Persist.TH.html#mpsGeneric"><span class="hs-identifier hs-var">mpsGeneric</span></a></span><span> </span><span class="annot"><span class="annottext">MkPersistSettings
</span><a href="#local-6989586621679964505"><span class="hs-identifier hs-var">mps</span></a></span><span class="hs-special">)</span><span> </span><span class="hs-keyword">then</span><span> </span><span class="hs-special">[</span><span class="hs-special">]</span><span> </span><span class="hs-keyword">else</span><span>
</span><span id="line-1795"></span><span>          </span><span class="hs-special">[</span><span class="annot"><span class="annottext">Name -&gt; [Type] -&gt; Type
</span><a href="Database.Persist.TH.html#mkClassP"><span class="hs-identifier hs-var">mkClassP</span></a></span><span> </span><span class="hs-special">''</span><span class="hs-identifier">PersistStore</span><span> </span><span class="hs-special">[</span><span class="annot"><span class="annottext">Type
</span><a href="Database.Persist.TH.html#backendT"><span class="hs-identifier hs-var">backendT</span></a></span><span class="hs-special">]</span><span class="hs-special">]</span><span>
</span><span id="line-1796"></span><span>
</span><span id="line-1797"></span><span>    </span><span class="hs-special">[</span><span id="local-6989586621679964475"><span class="annot"><span class="annottext">Dec
</span><a href="#local-6989586621679964475"><span class="hs-identifier hs-var">keyFromRecordM'</span></a></span></span><span class="hs-special">]</span><span> </span><span class="hs-glyph">&lt;-</span><span>
</span><span id="line-1798"></span><span>        </span><span class="hs-keyword">case</span><span> </span><span class="annot"><span class="annottext">UnboundEntityDef -&gt; PrimarySpec
</span><a href="Database.Persist.Quasi.Internal.html#unboundPrimarySpec"><span class="hs-identifier hs-var">unboundPrimarySpec</span></a></span><span> </span><span class="annot"><span class="annottext">UnboundEntityDef
</span><a href="#local-6989586621679964502"><span class="hs-identifier hs-var">entDef</span></a></span><span> </span><span class="hs-keyword">of</span><span>
</span><span id="line-1799"></span><span>            </span><span class="annot"><a href="Database.Persist.Quasi.Internal.html#NaturalKey"><span class="hs-identifier hs-type">NaturalKey</span></a></span><span> </span><span id="local-6989586621679964474"><span class="annot"><span class="annottext">UnboundCompositeDef
</span><a href="#local-6989586621679964474"><span class="hs-identifier hs-var">ucd</span></a></span></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-keyword">do</span><span>
</span><span id="line-1800"></span><span>                </span><span id="local-6989586621679964473"><span class="annot"><span class="annottext">Name
</span><a href="#local-6989586621679964473"><span class="hs-identifier hs-var">recordName</span></a></span></span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">forall (m :: * -&gt; *). Quote m =&gt; String -&gt; m Name
</span><span class="hs-identifier hs-var">newName</span></span><span> </span><span class="annot"><span class="annottext">String
</span><span class="hs-string">&quot;record&quot;</span></span><span>
</span><span id="line-1801"></span><span>                </span><span class="hs-keyword">let</span><span>
</span><span id="line-1802"></span><span>                    </span><span id="local-6989586621679964472"><span class="annot"><span class="annottext">keyCon :: Name
</span><a href="#local-6989586621679964472"><span class="hs-identifier hs-var hs-var">keyCon</span></a></span></span><span> </span><span class="hs-glyph">=</span><span>
</span><span id="line-1803"></span><span>                        </span><span class="annot"><span class="annottext">UnboundEntityDef -&gt; Name
</span><a href="Database.Persist.TH.html#keyConName"><span class="hs-identifier hs-var">keyConName</span></a></span><span> </span><span class="annot"><span class="annottext">UnboundEntityDef
</span><a href="#local-6989586621679964502"><span class="hs-identifier hs-var">entDef</span></a></span><span>
</span><span id="line-1804"></span><span>                    </span><span id="local-6989586621679964471"><span class="annot"><span class="annottext">keyFields' :: [Name]
</span><a href="#local-6989586621679964471"><span class="hs-identifier hs-var hs-var">keyFields'</span></a></span></span><span> </span><span class="hs-glyph">=</span><span>
</span><span id="line-1805"></span><span>                        </span><span class="annot"><span class="annottext">MkPersistSettings -&gt; UnboundEntityDef -&gt; FieldNameHS -&gt; Name
</span><a href="Database.Persist.TH.html#fieldNameToRecordName"><span class="hs-identifier hs-var">fieldNameToRecordName</span></a></span><span> </span><span class="annot"><span class="annottext">MkPersistSettings
</span><a href="#local-6989586621679964505"><span class="hs-identifier hs-var">mps</span></a></span><span> </span><span class="annot"><span class="annottext">UnboundEntityDef
</span><a href="#local-6989586621679964502"><span class="hs-identifier hs-var">entDef</span></a></span><span> </span><span class="annot"><span class="annottext">forall (f :: * -&gt; *) a b. Functor f =&gt; (a -&gt; b) -&gt; f a -&gt; f b
</span><span class="hs-operator hs-var">&lt;$&gt;</span></span><span> </span><span class="annot"><span class="annottext">UnboundCompositeDef -&gt; [FieldNameHS]
</span><a href="Database.Persist.Quasi.Internal.html#unboundCompositeCols"><span class="hs-identifier hs-var">unboundCompositeCols</span></a></span><span> </span><span class="annot"><span class="annottext">UnboundCompositeDef
</span><a href="#local-6989586621679964474"><span class="hs-identifier hs-var">ucd</span></a></span><span>
</span><span id="line-1806"></span><span>                    </span><span id="local-6989586621679964469"><span class="annot"><span class="annottext">constr :: Exp
</span><a href="#local-6989586621679964469"><span class="hs-identifier hs-var hs-var">constr</span></a></span></span><span> </span><span class="hs-glyph">=</span><span>
</span><span id="line-1807"></span><span>                        </span><span class="annot"><span class="annottext">forall (t :: * -&gt; *) b a.
Foldable t =&gt;
(b -&gt; a -&gt; b) -&gt; b -&gt; t a -&gt; b
</span><span class="hs-identifier hs-var">foldl'</span></span><span>
</span><span id="line-1808"></span><span>                            </span><span class="annot"><span class="annottext">Exp -&gt; Exp -&gt; Exp
</span><span class="hs-identifier hs-var">AppE</span></span><span>
</span><span id="line-1809"></span><span>                            </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Name -&gt; Exp
</span><span class="hs-identifier hs-var">ConE</span></span><span> </span><span class="annot"><span class="annottext">Name
</span><a href="#local-6989586621679964472"><span class="hs-identifier hs-var">keyCon</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-1810"></span><span>                            </span><span class="hs-special">(</span><span class="annot"><span class="annottext">forall (t :: * -&gt; *) a. Foldable t =&gt; t a -&gt; [a]
</span><span class="hs-identifier hs-var">toList</span></span><span> </span><span class="annot"><span class="annottext">forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span> </span><span class="annot"><span class="annottext">forall (f :: * -&gt; *) a b. Functor f =&gt; (a -&gt; b) -&gt; f a -&gt; f b
</span><span class="hs-identifier hs-var">fmap</span></span><span>
</span><span id="line-1811"></span><span>                                </span><span class="hs-special">(</span><span class="hs-glyph">\</span><span id="local-6989586621679964468"><span class="annot"><span class="annottext">Name
</span><a href="#local-6989586621679964468"><span class="hs-identifier hs-var">n</span></a></span></span><span> </span><span class="hs-glyph">-&gt;</span><span>
</span><span id="line-1812"></span><span>                                    </span><span class="annot"><span class="annottext">Name -&gt; Exp
</span><span class="hs-identifier hs-var">VarE</span></span><span> </span><span class="annot"><span class="annottext">Name
</span><a href="#local-6989586621679964468"><span class="hs-identifier hs-var">n</span></a></span><span> </span><span class="annot"><span class="annottext">Exp -&gt; Exp -&gt; Exp
</span><span class="hs-operator hs-var">`AppE`</span></span><span> </span><span class="annot"><span class="annottext">Name -&gt; Exp
</span><span class="hs-identifier hs-var">VarE</span></span><span> </span><span class="annot"><span class="annottext">Name
</span><a href="#local-6989586621679964473"><span class="hs-identifier hs-var">recordName</span></a></span><span>
</span><span id="line-1813"></span><span>                                </span><span class="hs-special">)</span><span>
</span><span id="line-1814"></span><span>                                </span><span class="annot"><span class="annottext">[Name]
</span><a href="#local-6989586621679964471"><span class="hs-identifier hs-var">keyFields'</span></a></span><span>
</span><span id="line-1815"></span><span>                            </span><span class="hs-special">)</span><span>
</span><span id="line-1816"></span><span>                    </span><span id="local-6989586621679964466"><span class="annot"><span class="annottext">keyFromRec :: Q Pat
</span><a href="#local-6989586621679964466"><span class="hs-identifier hs-var hs-var">keyFromRec</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">forall (m :: * -&gt; *). Quote m =&gt; Name -&gt; m Pat
</span><span class="hs-identifier hs-var">varP</span></span><span> </span><span class="hs-special">'</span><span class="hs-identifier">keyFromRecordM</span><span>
</span><span id="line-1817"></span><span>                </span><span class="hs-special">[d|</span><span>
</span><span id="line-1818"></span><span>                    </span><span class="hs-special">$</span><span class="hs-special">(</span><span class="hs-identifier">keyFromRec</span><span class="hs-special">)</span><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-identifier">Just</span><span> </span><span class="hs-special">(</span><span> </span><span class="hs-glyph">\</span><span> </span><span class="hs-special">$</span><span class="hs-special">(</span><span class="hs-identifier">varP</span><span> </span><span class="hs-identifier">recordName</span><span class="hs-special">)</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-special">$</span><span class="hs-special">(</span><span class="hs-identifier">pure</span><span> </span><span class="hs-identifier">constr</span><span class="hs-special">)</span><span class="hs-special">)</span><span>
</span><span id="line-1819"></span><span>                    </span><span class="hs-special">|]</span><span>
</span><span id="line-1820"></span><span>
</span><span id="line-1821"></span><span>            </span><span class="annot"><span class="annottext">PrimarySpec
</span><span class="hs-identifier">_</span></span><span> </span><span class="hs-glyph">-&gt;</span><span>
</span><span id="line-1822"></span><span>                </span><span class="hs-special">[d|</span><span class="hs-special">$</span><span class="hs-special">(</span><span class="hs-identifier">varP</span><span> </span><span class="hs-special">'</span><span class="hs-identifier">keyFromRecordM</span><span class="hs-special">)</span><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-identifier">Nothing</span><span class="hs-special">|]</span><span>
</span><span id="line-1823"></span><span>
</span><span id="line-1824"></span><span>    </span><span id="local-6989586621679964465"><span class="annot"><span class="annottext">Dec
</span><a href="#local-6989586621679964465"><span class="hs-identifier hs-var">dtd</span></a></span></span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">MkPersistSettings -&gt; EntityMap -&gt; UnboundEntityDef -&gt; Q Dec
</span><a href="Database.Persist.TH.html#dataTypeDec"><span class="hs-identifier hs-var">dataTypeDec</span></a></span><span> </span><span class="annot"><span class="annottext">MkPersistSettings
</span><a href="#local-6989586621679964505"><span class="hs-identifier hs-var">mps</span></a></span><span> </span><span class="annot"><span class="annottext">EntityMap
</span><a href="#local-6989586621679964506"><span class="hs-identifier hs-var">entityMap</span></a></span><span> </span><span class="annot"><span class="annottext">UnboundEntityDef
</span><a href="#local-6989586621679964502"><span class="hs-identifier hs-var">entDef</span></a></span><span>
</span><span id="line-1825"></span><span>    </span><span class="hs-keyword">let</span><span>
</span><span id="line-1826"></span><span>        </span><span id="local-6989586621679964464"><span class="annot"><span class="annottext">allEntDefs :: [Con]
</span><a href="#local-6989586621679964464"><span class="hs-identifier hs-var hs-var">allEntDefs</span></a></span></span><span> </span><span class="hs-glyph">=</span><span>
</span><span id="line-1827"></span><span>            </span><span class="annot"><span class="annottext">EntityFieldTH -&gt; Con
</span><a href="Database.Persist.TH.html#entityFieldTHCon"><span class="hs-identifier hs-var">entityFieldTHCon</span></a></span><span> </span><span class="annot"><span class="annottext">forall (f :: * -&gt; *) a b. Functor f =&gt; (a -&gt; b) -&gt; f a -&gt; f b
</span><span class="hs-operator hs-var">&lt;$&gt;</span></span><span> </span><span class="annot"><span class="annottext">EntityFieldsTH -&gt; [EntityFieldTH]
</span><a href="Database.Persist.TH.html#efthAllFields"><span class="hs-identifier hs-var">efthAllFields</span></a></span><span> </span><span class="annot"><span class="annottext">EntityFieldsTH
</span><a href="#local-6989586621679964501"><span class="hs-identifier hs-var">fields</span></a></span><span>
</span><span id="line-1828"></span><span>        </span><span id="local-6989586621679964461"><span class="annot"><span class="annottext">allEntDefClauses :: [Clause]
</span><a href="#local-6989586621679964461"><span class="hs-identifier hs-var hs-var">allEntDefClauses</span></a></span></span><span> </span><span class="hs-glyph">=</span><span>
</span><span id="line-1829"></span><span>            </span><span class="annot"><span class="annottext">EntityFieldTH -&gt; Clause
</span><a href="Database.Persist.TH.html#entityFieldTHClause"><span class="hs-identifier hs-var">entityFieldTHClause</span></a></span><span> </span><span class="annot"><span class="annottext">forall (f :: * -&gt; *) a b. Functor f =&gt; (a -&gt; b) -&gt; f a -&gt; f b
</span><span class="hs-operator hs-var">&lt;$&gt;</span></span><span> </span><span class="annot"><span class="annottext">EntityFieldsTH -&gt; [EntityFieldTH]
</span><a href="Database.Persist.TH.html#efthAllFields"><span class="hs-identifier hs-var">efthAllFields</span></a></span><span> </span><span class="annot"><span class="annottext">EntityFieldsTH
</span><a href="#local-6989586621679964501"><span class="hs-identifier hs-var">fields</span></a></span><span>
</span><span id="line-1830"></span><span>    </span><span class="annot"><span class="annottext">forall (m :: * -&gt; *) a. Monad m =&gt; a -&gt; m a
</span><span class="hs-identifier hs-var">return</span></span><span> </span><span class="annot"><span class="annottext">forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span> </span><span class="annot"><span class="annottext">[Dec] -&gt; [Dec]
</span><a href="#local-6989586621679964483"><span class="hs-identifier hs-var">addSyn</span></a></span><span> </span><span class="annot"><span class="annottext">forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span>
</span><span id="line-1831"></span><span>       </span><span class="annot"><span class="annottext">Dec
</span><a href="#local-6989586621679964465"><span class="hs-identifier hs-var">dtd</span></a></span><span> </span><span class="annot"><span class="annottext">forall a. a -&gt; [a] -&gt; [a]
</span><span class="hs-glyph hs-var">:</span></span><span> </span><span class="annot"><span class="annottext">forall a. Monoid a =&gt; [a] -&gt; a
</span><span class="hs-identifier hs-var">mconcat</span></span><span> </span><span class="annot"><span class="annottext">[[Dec]]
</span><a href="#local-6989586621679964491"><span class="hs-identifier hs-var">fkc</span></a></span><span> </span><span class="annot"><span class="annottext">forall m. Monoid m =&gt; m -&gt; m -&gt; m
</span><span class="hs-operator hs-var">`mappend`</span></span><span>
</span><span id="line-1832"></span><span>      </span><span class="hs-special">(</span><span> </span><span class="hs-special">[</span><span> </span><span class="annot"><span class="annottext">Name -&gt; [TyVarBndr ()] -&gt; Type -&gt; Dec
</span><span class="hs-identifier hs-var">TySynD</span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">UnboundEntityDef -&gt; Name
</span><a href="Database.Persist.TH.html#keyIdName"><span class="hs-identifier hs-var">keyIdName</span></a></span><span> </span><span class="annot"><span class="annottext">UnboundEntityDef
</span><a href="#local-6989586621679964502"><span class="hs-identifier hs-var">entDef</span></a></span><span class="hs-special">)</span><span> </span><span class="hs-special">[</span><span class="hs-special">]</span><span> </span><span class="annot"><span class="annottext">forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span>
</span><span id="line-1833"></span><span>            </span><span class="annot"><span class="annottext">Name -&gt; Type
</span><span class="hs-identifier hs-var">ConT</span></span><span> </span><span class="hs-special">''</span><span class="hs-identifier">Key</span><span> </span><span class="annot"><span class="annottext">Type -&gt; Type -&gt; Type
</span><span class="hs-operator hs-var">`AppT`</span></span><span> </span><span class="annot"><span class="annottext">Name -&gt; Type
</span><span class="hs-identifier hs-var">ConT</span></span><span> </span><span class="annot"><span class="annottext">Name
</span><a href="#local-6989586621679964499"><span class="hs-identifier hs-var">name</span></a></span><span>
</span><span id="line-1834"></span><span>      </span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">[Type] -&gt; Type -&gt; [Dec] -&gt; Dec
</span><a href="Database.Persist.TH.html#instanceD"><span class="hs-identifier hs-var">instanceD</span></a></span><span> </span><span class="annot"><span class="annottext">[Type]
</span><a href="#local-6989586621679964477"><span class="hs-identifier hs-var">instanceConstraint</span></a></span><span> </span><span class="annot"><span class="annottext">Type
</span><a href="#local-6989586621679964498"><span class="hs-identifier hs-var">clazz</span></a></span><span>
</span><span id="line-1835"></span><span>        </span><span class="hs-special">[</span><span> </span><span class="annot"><span class="annottext">MkPersistSettings -&gt; EntityMap -&gt; UnboundEntityDef -&gt; Dec
</span><a href="Database.Persist.TH.html#uniqueTypeDec"><span class="hs-identifier hs-var">uniqueTypeDec</span></a></span><span> </span><span class="annot"><span class="annottext">MkPersistSettings
</span><a href="#local-6989586621679964505"><span class="hs-identifier hs-var">mps</span></a></span><span> </span><span class="annot"><span class="annottext">EntityMap
</span><a href="#local-6989586621679964506"><span class="hs-identifier hs-var">entityMap</span></a></span><span> </span><span class="annot"><span class="annottext">UnboundEntityDef
</span><a href="#local-6989586621679964502"><span class="hs-identifier hs-var">entDef</span></a></span><span>
</span><span id="line-1836"></span><span>        </span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">Dec
</span><a href="#local-6989586621679964487"><span class="hs-identifier hs-var">keyTypeDec</span></a></span><span>
</span><span id="line-1837"></span><span>        </span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">Dec
</span><a href="#local-6989586621679964485"><span class="hs-identifier hs-var">keyToValues'</span></a></span><span>
</span><span id="line-1838"></span><span>        </span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">Dec
</span><a href="#local-6989586621679964484"><span class="hs-identifier hs-var">keyFromValues'</span></a></span><span>
</span><span id="line-1839"></span><span>        </span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">Dec
</span><a href="#local-6989586621679964475"><span class="hs-identifier hs-var">keyFromRecordM'</span></a></span><span>
</span><span id="line-1840"></span><span>        </span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">Name -&gt; [Clause] -&gt; Dec
</span><span class="hs-identifier hs-var">FunD</span></span><span> </span><span class="hs-special">'</span><span class="hs-identifier">entityDef</span><span> </span><span class="hs-special">[</span><span class="annot"><span class="annottext">[Pat] -&gt; Exp -&gt; Clause
</span><a href="Database.Persist.TH.html#normalClause"><span class="hs-identifier hs-var">normalClause</span></a></span><span> </span><span class="hs-special">[</span><span class="annot"><span class="annottext">Pat
</span><span class="hs-identifier hs-var">WildP</span></span><span class="hs-special">]</span><span> </span><span class="annot"><span class="annottext">Exp
</span><a href="#local-6989586621679964503"><span class="hs-identifier hs-var">entityDefExp</span></a></span><span class="hs-special">]</span><span>
</span><span id="line-1841"></span><span>        </span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">Dec
</span><a href="#local-6989586621679964496"><span class="hs-identifier hs-var">tpf</span></a></span><span>
</span><span id="line-1842"></span><span>        </span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">Name -&gt; [Clause] -&gt; Dec
</span><span class="hs-identifier hs-var">FunD</span></span><span> </span><span class="hs-special">'</span><span class="hs-identifier">fromPersistValues</span><span> </span><span class="annot"><span class="annottext">[Clause]
</span><a href="#local-6989586621679964495"><span class="hs-identifier hs-var">fpv</span></a></span><span>
</span><span id="line-1843"></span><span>        </span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">Dec
</span><a href="#local-6989586621679964488"><span class="hs-identifier hs-var">toFieldNames</span></a></span><span>
</span><span id="line-1844"></span><span>        </span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">Dec
</span><a href="#local-6989586621679964494"><span class="hs-identifier hs-var">utv</span></a></span><span>
</span><span id="line-1845"></span><span>        </span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">Dec
</span><a href="#local-6989586621679964493"><span class="hs-identifier hs-var">puk</span></a></span><span class="hs-cpp">
#if MIN_VERSION_template_haskell(2,15,0)
</span><span>        </span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">[Type]
-&gt; Maybe [TyVarBndr ()]
-&gt; Type
-&gt; Maybe Type
-&gt; [Con]
-&gt; [DerivClause]
-&gt; Dec
</span><span class="hs-identifier hs-var">DataInstD</span></span><span>
</span><span id="line-1848"></span><span>            </span><span class="hs-special">[</span><span class="hs-special">]</span><span>
</span><span id="line-1849"></span><span>            </span><span class="annot"><span class="annottext">forall a. Maybe a
</span><span class="hs-identifier hs-var">Nothing</span></span><span>
</span><span id="line-1850"></span><span>            </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Type -&gt; Type -&gt; Type
</span><span class="hs-identifier hs-var">AppT</span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Type -&gt; Type -&gt; Type
</span><span class="hs-identifier hs-var">AppT</span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Name -&gt; Type
</span><span class="hs-identifier hs-var">ConT</span></span><span> </span><span class="hs-special">''</span><span class="hs-identifier">EntityField</span><span class="hs-special">)</span><span> </span><span class="annot"><span class="annottext">Type
</span><a href="#local-6989586621679964497"><span class="hs-identifier hs-var">genDataType</span></a></span><span class="hs-special">)</span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Name -&gt; Type
</span><span class="hs-identifier hs-var">VarT</span></span><span> </span><span class="annot"><span class="annottext">forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span> </span><span class="annot"><span class="annottext">String -&gt; Name
</span><span class="hs-identifier hs-var">mkName</span></span><span> </span><span class="annot"><span class="annottext">String
</span><span class="hs-string">&quot;typ&quot;</span></span><span class="hs-special">)</span><span class="hs-special">)</span><span>
</span><span id="line-1851"></span><span>            </span><span class="annot"><span class="annottext">forall a. Maybe a
</span><span class="hs-identifier hs-var">Nothing</span></span><span>
</span><span id="line-1852"></span><span>            </span><span class="annot"><span class="annottext">[Con]
</span><a href="#local-6989586621679964464"><span class="hs-identifier hs-var">allEntDefs</span></a></span><span>
</span><span id="line-1853"></span><span>            </span><span class="hs-special">[</span><span class="hs-special">]</span><span class="hs-cpp">
#else
</span><span>        </span><span class="hs-special">,</span><span> </span><span class="hs-identifier">DataInstD</span><span>
</span><span id="line-1856"></span><span>            </span><span class="hs-special">[</span><span class="hs-special">]</span><span>
</span><span id="line-1857"></span><span>            </span><span class="hs-special">''</span><span class="hs-identifier">EntityField</span><span>
</span><span id="line-1858"></span><span>            </span><span class="hs-special">[</span><span> </span><span class="hs-identifier">genDataType</span><span>
</span><span id="line-1859"></span><span>            </span><span class="hs-special">,</span><span> </span><span class="hs-identifier">VarT</span><span> </span><span class="hs-operator">$</span><span> </span><span class="hs-identifier">mkName</span><span> </span><span class="hs-string">&quot;typ&quot;</span><span>
</span><span id="line-1860"></span><span>            </span><span class="hs-special">]</span><span>
</span><span id="line-1861"></span><span>            </span><span class="hs-identifier">Nothing</span><span>
</span><span id="line-1862"></span><span>            </span><span class="hs-identifier">allEntDefs</span><span>
</span><span id="line-1863"></span><span>            </span><span class="hs-special">[</span><span class="hs-special">]</span><span class="hs-cpp">
#endif
</span><span>        </span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">Name -&gt; [Clause] -&gt; Dec
</span><span class="hs-identifier hs-var">FunD</span></span><span> </span><span class="hs-special">'</span><span class="hs-identifier">persistFieldDef</span><span> </span><span class="annot"><span class="annottext">[Clause]
</span><a href="#local-6989586621679964461"><span class="hs-identifier hs-var">allEntDefClauses</span></a></span><span class="hs-cpp">
#if MIN_VERSION_template_haskell(2,15,0)
</span><span>        </span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">TySynEqn -&gt; Dec
</span><span class="hs-identifier hs-var">TySynInstD</span></span><span>
</span><span id="line-1868"></span><span>            </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Maybe [TyVarBndr ()] -&gt; Type -&gt; Type -&gt; TySynEqn
</span><span class="hs-identifier hs-var">TySynEqn</span></span><span>
</span><span id="line-1869"></span><span>               </span><span class="annot"><span class="annottext">forall a. Maybe a
</span><span class="hs-identifier hs-var">Nothing</span></span><span>
</span><span id="line-1870"></span><span>               </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Type -&gt; Type -&gt; Type
</span><span class="hs-identifier hs-var">AppT</span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Name -&gt; Type
</span><span class="hs-identifier hs-var">ConT</span></span><span> </span><span class="hs-special">''</span><span class="hs-identifier">PersistEntityBackend</span><span class="hs-special">)</span><span> </span><span class="annot"><span class="annottext">Type
</span><a href="#local-6989586621679964497"><span class="hs-identifier hs-var">genDataType</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-1871"></span><span>               </span><span class="hs-special">(</span><span class="annot"><span class="annottext">MkPersistSettings -&gt; Type
</span><a href="Database.Persist.TH.html#backendDataType"><span class="hs-identifier hs-var">backendDataType</span></a></span><span> </span><span class="annot"><span class="annottext">MkPersistSettings
</span><a href="#local-6989586621679964505"><span class="hs-identifier hs-var">mps</span></a></span><span class="hs-special">)</span><span class="hs-special">)</span><span class="hs-cpp">
#else
</span><span>        </span><span class="hs-special">,</span><span> </span><span class="hs-identifier">TySynInstD</span><span>
</span><span id="line-1874"></span><span>            </span><span class="hs-special">''</span><span class="hs-identifier">PersistEntityBackend</span><span>
</span><span id="line-1875"></span><span>            </span><span class="hs-special">(</span><span class="hs-identifier">TySynEqn</span><span>
</span><span id="line-1876"></span><span>               </span><span class="hs-special">[</span><span class="hs-identifier">genDataType</span><span class="hs-special">]</span><span>
</span><span id="line-1877"></span><span>               </span><span class="hs-special">(</span><span class="hs-identifier">backendDataType</span><span> </span><span class="hs-identifier">mps</span><span class="hs-special">)</span><span class="hs-special">)</span><span class="hs-cpp">
#endif
</span><span>        </span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">Name -&gt; [Clause] -&gt; Dec
</span><span class="hs-identifier hs-var">FunD</span></span><span> </span><span class="hs-special">'</span><span class="hs-identifier">persistIdField</span><span> </span><span class="hs-special">[</span><span class="annot"><span class="annottext">[Pat] -&gt; Exp -&gt; Clause
</span><a href="Database.Persist.TH.html#normalClause"><span class="hs-identifier hs-var">normalClause</span></a></span><span> </span><span class="hs-special">[</span><span class="hs-special">]</span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Name -&gt; Exp
</span><span class="hs-identifier hs-var">ConE</span></span><span> </span><span class="annot"><span class="annottext">forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span> </span><span class="annot"><span class="annottext">UnboundEntityDef -&gt; Name
</span><a href="Database.Persist.TH.html#keyIdName"><span class="hs-identifier hs-var">keyIdName</span></a></span><span> </span><span class="annot"><span class="annottext">UnboundEntityDef
</span><a href="#local-6989586621679964502"><span class="hs-identifier hs-var">entDef</span></a></span><span class="hs-special">)</span><span class="hs-special">]</span><span>
</span><span id="line-1880"></span><span>        </span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">Name -&gt; [Clause] -&gt; Dec
</span><span class="hs-identifier hs-var">FunD</span></span><span> </span><span class="hs-special">'</span><span class="hs-identifier">fieldLens</span><span> </span><span class="annot"><span class="annottext">[Clause]
</span><a href="#local-6989586621679964480"><span class="hs-identifier hs-var">lensClauses</span></a></span><span>
</span><span id="line-1881"></span><span>        </span><span class="hs-special">]</span><span>
</span><span id="line-1882"></span><span>      </span><span class="hs-special">]</span><span> </span><span class="annot"><span class="annottext">forall m. Monoid m =&gt; m -&gt; m -&gt; m
</span><span class="hs-operator hs-var">`mappend`</span></span><span> </span><span class="annot"><span class="annottext">[Dec]
</span><a href="#local-6989586621679964479"><span class="hs-identifier hs-var">lenses</span></a></span><span class="hs-special">)</span><span> </span><span class="annot"><span class="annottext">forall m. Monoid m =&gt; m -&gt; m -&gt; m
</span><span class="hs-operator hs-var">`mappend`</span></span><span> </span><span class="annot"><span class="annottext">[Dec]
</span><a href="#local-6989586621679964486"><span class="hs-identifier hs-var">keyInstanceDecs</span></a></span><span>
</span><span id="line-1883"></span><span>  </span><span class="hs-keyword">where</span><span>
</span><span id="line-1884"></span><span>    </span><span id="local-6989586621679964497"><span class="annot"><span class="annottext">genDataType :: Type
</span><a href="#local-6989586621679964497"><span class="hs-identifier hs-var hs-var">genDataType</span></a></span></span><span> </span><span class="hs-glyph">=</span><span>
</span><span id="line-1885"></span><span>        </span><span class="annot"><span class="annottext">MkPersistSettings -&gt; EntityNameHS -&gt; Type -&gt; Type
</span><a href="Database.Persist.TH.html#genericDataType"><span class="hs-identifier hs-var">genericDataType</span></a></span><span> </span><span class="annot"><span class="annottext">MkPersistSettings
</span><a href="#local-6989586621679964505"><span class="hs-identifier hs-var">mps</span></a></span><span> </span><span class="annot"><span class="annottext">EntityNameHS
</span><a href="#local-6989586621679964481"><span class="hs-identifier hs-var">entName</span></a></span><span> </span><span class="annot"><span class="annottext">Type
</span><a href="Database.Persist.TH.html#backendT"><span class="hs-identifier hs-var">backendT</span></a></span><span>
</span><span id="line-1886"></span><span>    </span><span id="local-6989586621679964481"><span class="annot"><span class="annottext">entName :: EntityNameHS
</span><a href="#local-6989586621679964481"><span class="hs-identifier hs-var hs-var">entName</span></a></span></span><span> </span><span class="hs-glyph">=</span><span>
</span><span id="line-1887"></span><span>        </span><span class="annot"><span class="annottext">UnboundEntityDef -&gt; EntityNameHS
</span><a href="Database.Persist.Quasi.Internal.html#getUnboundEntityNameHS"><span class="hs-identifier hs-var">getUnboundEntityNameHS</span></a></span><span> </span><span class="annot"><span class="annottext">UnboundEntityDef
</span><a href="#local-6989586621679964504"><span class="hs-identifier hs-var">preDef</span></a></span><span>
</span><span id="line-1888"></span><span>
</span><span id="line-1889"></span><span class="hs-keyword">data</span><span> </span><span id="EntityFieldsTH"><span class="annot"><a href="Database.Persist.TH.html#EntityFieldsTH"><span class="hs-identifier hs-var">EntityFieldsTH</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span id="EntityFieldsTH"><span class="annot"><a href="Database.Persist.TH.html#EntityFieldsTH"><span class="hs-identifier hs-var">EntityFieldsTH</span></a></span></span><span>
</span><span id="line-1890"></span><span>    </span><span class="hs-special">{</span><span> </span><span id="entityFieldsTHPrimary"><span class="annot"><span class="annottext">EntityFieldsTH -&gt; EntityFieldTH
</span><a href="Database.Persist.TH.html#entityFieldsTHPrimary"><span class="hs-identifier hs-var hs-var">entityFieldsTHPrimary</span></a></span></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><a href="Database.Persist.TH.html#EntityFieldTH"><span class="hs-identifier hs-type">EntityFieldTH</span></a></span><span>
</span><span id="line-1891"></span><span>    </span><span class="hs-special">,</span><span> </span><span id="entityFieldsTHFields"><span class="annot"><span class="annottext">EntityFieldsTH -&gt; [EntityFieldTH]
</span><a href="Database.Persist.TH.html#entityFieldsTHFields"><span class="hs-identifier hs-var hs-var">entityFieldsTHFields</span></a></span></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="hs-special">[</span><span class="annot"><a href="Database.Persist.TH.html#EntityFieldTH"><span class="hs-identifier hs-type">EntityFieldTH</span></a></span><span class="hs-special">]</span><span>
</span><span id="line-1892"></span><span>    </span><span class="hs-special">}</span><span>
</span><span id="line-1893"></span><span>
</span><span id="line-1894"></span><span class="annot"><a href="Database.Persist.TH.html#efthAllFields"><span class="hs-identifier hs-type">efthAllFields</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><a href="Database.Persist.TH.html#EntityFieldsTH"><span class="hs-identifier hs-type">EntityFieldsTH</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-special">[</span><span class="annot"><a href="Database.Persist.TH.html#EntityFieldTH"><span class="hs-identifier hs-type">EntityFieldTH</span></a></span><span class="hs-special">]</span><span>
</span><span id="line-1895"></span><span id="efthAllFields"><span class="annot"><span class="annottext">efthAllFields :: EntityFieldsTH -&gt; [EntityFieldTH]
</span><a href="Database.Persist.TH.html#efthAllFields"><span class="hs-identifier hs-var hs-var">efthAllFields</span></a></span></span><span> </span><span class="annot"><a href="Database.Persist.TH.html#EntityFieldsTH"><span class="hs-identifier hs-type">EntityFieldsTH</span></a></span><span class="hs-special">{</span><span id="local-6989586621679964452"><span id="local-6989586621679964453"><span class="annot"><span class="annottext">[EntityFieldTH]
EntityFieldTH
entityFieldsTHFields :: [EntityFieldTH]
entityFieldsTHPrimary :: EntityFieldTH
entityFieldsTHFields :: EntityFieldsTH -&gt; [EntityFieldTH]
entityFieldsTHPrimary :: EntityFieldsTH -&gt; EntityFieldTH
</span><a href="#local-6989586621679964452"><span class="hs-glyph hs-var hs-var hs-var hs-var">..</span></a></span></span></span><span class="hs-special">}</span><span> </span><span class="hs-glyph">=</span><span>
</span><span id="line-1896"></span><span>    </span><span class="annot"><span class="annottext">EntityFieldTH -&gt; EntityFieldTH
</span><a href="Database.Persist.TH.html#stripIdFieldDef"><span class="hs-identifier hs-var">stripIdFieldDef</span></a></span><span> </span><span class="annot"><span class="annottext">EntityFieldTH
</span><a href="#local-6989586621679964453"><span class="hs-identifier hs-var">entityFieldsTHPrimary</span></a></span><span> </span><span class="annot"><span class="annottext">forall a. a -&gt; [a] -&gt; [a]
</span><span class="hs-glyph hs-var">:</span></span><span> </span><span class="annot"><span class="annottext">[EntityFieldTH]
</span><a href="#local-6989586621679964452"><span class="hs-identifier hs-var">entityFieldsTHFields</span></a></span><span>
</span><span id="line-1897"></span><span>
</span><span id="line-1898"></span><span class="annot"><a href="Database.Persist.TH.html#stripIdFieldDef"><span class="hs-identifier hs-type">stripIdFieldDef</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><a href="Database.Persist.TH.html#EntityFieldTH"><span class="hs-identifier hs-type">EntityFieldTH</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="Database.Persist.TH.html#EntityFieldTH"><span class="hs-identifier hs-type">EntityFieldTH</span></a></span><span>
</span><span id="line-1899"></span><span id="stripIdFieldDef"><span class="annot"><span class="annottext">stripIdFieldDef :: EntityFieldTH -&gt; EntityFieldTH
</span><a href="Database.Persist.TH.html#stripIdFieldDef"><span class="hs-identifier hs-var hs-var">stripIdFieldDef</span></a></span></span><span> </span><span id="local-6989586621679964450"><span class="annot"><span class="annottext">EntityFieldTH
</span><a href="#local-6989586621679964450"><span class="hs-identifier hs-var">efth</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">EntityFieldTH
</span><a href="#local-6989586621679964450"><span class="hs-identifier hs-var">efth</span></a></span><span>
</span><span id="line-1900"></span><span>    </span><span class="hs-special">{</span><span> </span><span class="annot"><span class="annottext">entityFieldTHClause :: Clause
</span><a href="Database.Persist.TH.html#entityFieldTHClause"><span class="hs-identifier hs-var">entityFieldTHClause</span></a></span><span> </span><span class="hs-glyph">=</span><span>
</span><span id="line-1901"></span><span>        </span><span class="annot"><span class="annottext">Clause -&gt; Clause
</span><a href="#local-6989586621679964449"><span class="hs-identifier hs-var">go</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">EntityFieldTH -&gt; Clause
</span><a href="Database.Persist.TH.html#entityFieldTHClause"><span class="hs-identifier hs-var">entityFieldTHClause</span></a></span><span> </span><span class="annot"><span class="annottext">EntityFieldTH
</span><a href="#local-6989586621679964450"><span class="hs-identifier hs-var">efth</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-1902"></span><span>    </span><span class="hs-special">}</span><span>
</span><span id="line-1903"></span><span>  </span><span class="hs-keyword">where</span><span>
</span><span id="line-1904"></span><span>    </span><span id="local-6989586621679964449"><span class="annot"><span class="annottext">go :: Clause -&gt; Clause
</span><a href="#local-6989586621679964449"><span class="hs-identifier hs-var hs-var">go</span></a></span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="hs-identifier hs-type">Clause</span></span><span> </span><span id="local-6989586621679964448"><span class="annot"><span class="annottext">[Pat]
</span><a href="#local-6989586621679964448"><span class="hs-identifier hs-var">ps</span></a></span></span><span> </span><span id="local-6989586621679964447"><span class="annot"><span class="annottext">Body
</span><a href="#local-6989586621679964447"><span class="hs-identifier hs-var">bdy</span></a></span></span><span> </span><span id="local-6989586621679964446"><span class="annot"><span class="annottext">[Dec]
</span><a href="#local-6989586621679964446"><span class="hs-identifier hs-var">ds</span></a></span></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">=</span><span>
</span><span id="line-1905"></span><span>        </span><span class="annot"><span class="annottext">[Pat] -&gt; Body -&gt; [Dec] -&gt; Clause
</span><span class="hs-identifier hs-var">Clause</span></span><span> </span><span class="annot"><span class="annottext">[Pat]
</span><a href="#local-6989586621679964448"><span class="hs-identifier hs-var">ps</span></a></span><span> </span><span class="annot"><span class="annottext">Body
</span><a href="#local-6989586621679964445"><span class="hs-identifier hs-var">bdy'</span></a></span><span> </span><span class="annot"><span class="annottext">[Dec]
</span><a href="#local-6989586621679964446"><span class="hs-identifier hs-var">ds</span></a></span><span>
</span><span id="line-1906"></span><span>      </span><span class="hs-keyword">where</span><span>
</span><span id="line-1907"></span><span>        </span><span id="local-6989586621679964445"><span class="annot"><span class="annottext">bdy' :: Body
</span><a href="#local-6989586621679964445"><span class="hs-identifier hs-var hs-var">bdy'</span></a></span></span><span> </span><span class="hs-glyph">=</span><span>
</span><span id="line-1908"></span><span>            </span><span class="hs-keyword">case</span><span> </span><span class="annot"><span class="annottext">Body
</span><a href="#local-6989586621679964447"><span class="hs-identifier hs-var">bdy</span></a></span><span> </span><span class="hs-keyword">of</span><span>
</span><span id="line-1909"></span><span>                </span><span class="annot"><span class="hs-identifier hs-type">NormalB</span></span><span> </span><span id="local-6989586621679964444"><span class="annot"><span class="annottext">Exp
</span><a href="#local-6989586621679964444"><span class="hs-identifier hs-var">e</span></a></span></span><span> </span><span class="hs-glyph">-&gt;</span><span>
</span><span id="line-1910"></span><span>                    </span><span class="annot"><span class="annottext">Exp -&gt; Body
</span><span class="hs-identifier hs-var">NormalB</span></span><span> </span><span class="annot"><span class="annottext">forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span> </span><span class="annot"><span class="annottext">Exp -&gt; Exp -&gt; Exp
</span><span class="hs-identifier hs-var">AppE</span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Name -&gt; Exp
</span><span class="hs-identifier hs-var">VarE</span></span><span> </span><span class="hs-special">'</span><span class="hs-identifier">stripIdFieldImpl</span><span class="hs-special">)</span><span> </span><span class="annot"><span class="annottext">Exp
</span><a href="#local-6989586621679964444"><span class="hs-identifier hs-var">e</span></a></span><span>
</span><span id="line-1911"></span><span>                </span><span class="annot"><span class="annottext">Body
</span><span class="hs-identifier">_</span></span><span> </span><span class="hs-glyph">-&gt;</span><span>
</span><span id="line-1912"></span><span>                    </span><span class="annot"><span class="annottext">Body
</span><a href="#local-6989586621679964447"><span class="hs-identifier hs-var">bdy</span></a></span><span>
</span><span id="line-1913"></span><span>
</span><span id="line-1914"></span><span class="hs-comment">-- | @persistent@ used to assume that an Id was always a single field.</span><span>
</span><span id="line-1915"></span><span class="hs-comment">--</span><span>
</span><span id="line-1916"></span><span class="hs-comment">-- This method preserves as much backwards compatibility as possible.</span><span>
</span><span id="line-1917"></span><span class="annot"><a href="Database.Persist.TH.html#stripIdFieldImpl"><span class="hs-identifier hs-type">stripIdFieldImpl</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><span class="hs-identifier hs-type">HasCallStack</span></span><span> </span><span class="hs-glyph">=&gt;</span><span> </span><span class="annot"><a href="Database.Persist.Types.Base.html#EntityIdDef"><span class="hs-identifier hs-type">EntityIdDef</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="Database.Persist.Types.Base.html#FieldDef"><span class="hs-identifier hs-type">FieldDef</span></a></span><span>
</span><span id="line-1918"></span><span id="stripIdFieldImpl"><span class="annot"><span class="annottext">stripIdFieldImpl :: HasCallStack =&gt; EntityIdDef -&gt; FieldDef
</span><a href="Database.Persist.TH.html#stripIdFieldImpl"><span class="hs-identifier hs-var hs-var">stripIdFieldImpl</span></a></span></span><span> </span><span id="local-6989586621679964441"><span class="annot"><span class="annottext">EntityIdDef
</span><a href="#local-6989586621679964441"><span class="hs-identifier hs-var">eid</span></a></span></span><span> </span><span class="hs-glyph">=</span><span>
</span><span id="line-1919"></span><span>    </span><span class="hs-keyword">case</span><span> </span><span class="annot"><span class="annottext">EntityIdDef
</span><a href="#local-6989586621679964441"><span class="hs-identifier hs-var">eid</span></a></span><span> </span><span class="hs-keyword">of</span><span>
</span><span id="line-1920"></span><span>        </span><span class="annot"><a href="Database.Persist.Types.Base.html#EntityIdField"><span class="hs-identifier hs-type">EntityIdField</span></a></span><span> </span><span id="local-6989586621679964440"><span class="annot"><span class="annottext">FieldDef
</span><a href="#local-6989586621679964440"><span class="hs-identifier hs-var">fd</span></a></span></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="annottext">FieldDef
</span><a href="#local-6989586621679964440"><span class="hs-identifier hs-var">fd</span></a></span><span>
</span><span id="line-1921"></span><span>        </span><span class="annot"><a href="Database.Persist.Types.Base.html#EntityIdNaturalKey"><span class="hs-identifier hs-type">EntityIdNaturalKey</span></a></span><span> </span><span id="local-6989586621679964438"><span class="annot"><span class="annottext">CompositeDef
</span><a href="#local-6989586621679964438"><span class="hs-identifier hs-var">cd</span></a></span></span><span> </span><span class="hs-glyph">-&gt;</span><span>
</span><span id="line-1922"></span><span>            </span><span class="hs-keyword">case</span><span> </span><span class="annot"><span class="annottext">CompositeDef -&gt; NonEmpty FieldDef
</span><a href="Database.Persist.Types.Base.html#compositeFields"><span class="hs-identifier hs-var">compositeFields</span></a></span><span> </span><span class="annot"><span class="annottext">CompositeDef
</span><a href="#local-6989586621679964438"><span class="hs-identifier hs-var">cd</span></a></span><span> </span><span class="hs-keyword">of</span><span>
</span><span id="line-1923"></span><span>                </span><span class="hs-special">(</span><span id="local-6989586621679964436"><span class="annot"><span class="annottext">FieldDef
</span><a href="#local-6989586621679964436"><span class="hs-identifier hs-var">x</span></a></span></span><span> </span><span class="annot"><span class="hs-operator hs-type">:|</span></span><span> </span><span id="local-6989586621679964435"><span class="annot"><span class="annottext">[FieldDef]
</span><a href="#local-6989586621679964435"><span class="hs-identifier hs-var">xs</span></a></span></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">-&gt;</span><span>
</span><span id="line-1924"></span><span>                    </span><span class="hs-keyword">case</span><span> </span><span class="annot"><span class="annottext">[FieldDef]
</span><a href="#local-6989586621679964435"><span class="hs-identifier hs-var">xs</span></a></span><span> </span><span class="hs-keyword">of</span><span>
</span><span id="line-1925"></span><span>                        </span><span class="hs-special">[</span><span class="hs-special">]</span><span> </span><span class="hs-glyph">-&gt;</span><span>
</span><span id="line-1926"></span><span>                            </span><span class="annot"><span class="annottext">FieldDef
</span><a href="#local-6989586621679964436"><span class="hs-identifier hs-var">x</span></a></span><span>
</span><span id="line-1927"></span><span>                        </span><span class="annot"><span class="annottext">[FieldDef]
</span><span class="hs-identifier">_</span></span><span> </span><span class="hs-glyph">-&gt;</span><span>
</span><span id="line-1928"></span><span>                            </span><span class="annot"><span class="annottext">FieldDef
</span><a href="#local-6989586621679964434"><span class="hs-identifier hs-var">dummyFieldDef</span></a></span><span>
</span><span id="line-1929"></span><span>  </span><span class="hs-keyword">where</span><span>
</span><span id="line-1930"></span><span>    </span><span id="local-6989586621679964434"><span class="annot"><span class="annottext">dummyFieldDef :: FieldDef
</span><a href="#local-6989586621679964434"><span class="hs-identifier hs-var hs-var">dummyFieldDef</span></a></span></span><span> </span><span class="hs-glyph">=</span><span>
</span><span id="line-1931"></span><span>        </span><span class="annot"><a href="Database.Persist.Types.Base.html#FieldDef"><span class="hs-identifier hs-type">FieldDef</span></a></span><span>
</span><span id="line-1932"></span><span>            </span><span class="hs-special">{</span><span> </span><span class="annot"><span class="annottext">fieldHaskell :: FieldNameHS
</span><a href="Database.Persist.Types.Base.html#fieldHaskell"><span class="hs-identifier hs-var">fieldHaskell</span></a></span><span> </span><span class="hs-glyph">=</span><span>
</span><span id="line-1933"></span><span>                </span><span class="annot"><span class="annottext">Text -&gt; FieldNameHS
</span><a href="Database.Persist.Names.html#FieldNameHS"><span class="hs-identifier hs-var">FieldNameHS</span></a></span><span> </span><span class="annot"><span class="annottext">Text
</span><span class="hs-string">&quot;Id&quot;</span></span><span>
</span><span id="line-1934"></span><span>            </span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">fieldDB :: FieldNameDB
</span><a href="Database.Persist.Types.Base.html#fieldDB"><span class="hs-identifier hs-var">fieldDB</span></a></span><span> </span><span class="hs-glyph">=</span><span>
</span><span id="line-1935"></span><span>                </span><span class="annot"><span class="annottext">Text -&gt; FieldNameDB
</span><a href="Database.Persist.Names.html#FieldNameDB"><span class="hs-identifier hs-var">FieldNameDB</span></a></span><span> </span><span class="annot"><span class="annottext">Text
</span><span class="hs-string">&quot;__composite_key_no_id__&quot;</span></span><span>
</span><span id="line-1936"></span><span>            </span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">fieldType :: FieldType
</span><a href="Database.Persist.Types.Base.html#fieldType"><span class="hs-identifier hs-var">fieldType</span></a></span><span> </span><span class="hs-glyph">=</span><span>
</span><span id="line-1937"></span><span>                </span><span class="annot"><span class="annottext">Maybe Text -&gt; Text -&gt; FieldType
</span><a href="Database.Persist.Types.Base.html#FTTypeCon"><span class="hs-identifier hs-var">FTTypeCon</span></a></span><span> </span><span class="annot"><span class="annottext">forall a. Maybe a
</span><span class="hs-identifier hs-var">Nothing</span></span><span> </span><span class="annot"><span class="annottext">Text
</span><span class="hs-string">&quot;__Composite_Key__&quot;</span></span><span>
</span><span id="line-1938"></span><span>            </span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">fieldSqlType :: SqlType
</span><a href="Database.Persist.Types.Base.html#fieldSqlType"><span class="hs-identifier hs-var">fieldSqlType</span></a></span><span> </span><span class="hs-glyph">=</span><span>
</span><span id="line-1939"></span><span>                </span><span class="annot"><span class="annottext">Text -&gt; SqlType
</span><a href="Database.Persist.Types.Base.html#SqlOther"><span class="hs-identifier hs-var">SqlOther</span></a></span><span> </span><span class="annot"><span class="annottext">Text
</span><span class="hs-string">&quot;Composite Key&quot;</span></span><span>
</span><span id="line-1940"></span><span>            </span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">fieldAttrs :: [FieldAttr]
</span><a href="Database.Persist.Types.Base.html#fieldAttrs"><span class="hs-identifier hs-var">fieldAttrs</span></a></span><span> </span><span class="hs-glyph">=</span><span>
</span><span id="line-1941"></span><span>                </span><span class="hs-special">[</span><span class="hs-special">]</span><span>
</span><span id="line-1942"></span><span>            </span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">fieldStrict :: Bool
</span><a href="Database.Persist.Types.Base.html#fieldStrict"><span class="hs-identifier hs-var">fieldStrict</span></a></span><span> </span><span class="hs-glyph">=</span><span>
</span><span id="line-1943"></span><span>                </span><span class="annot"><span class="annottext">Bool
</span><span class="hs-identifier hs-var">False</span></span><span>
</span><span id="line-1944"></span><span>            </span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">fieldReference :: ReferenceDef
</span><a href="Database.Persist.Types.Base.html#fieldReference"><span class="hs-identifier hs-var">fieldReference</span></a></span><span> </span><span class="hs-glyph">=</span><span>
</span><span id="line-1945"></span><span>                </span><span class="annot"><span class="annottext">ReferenceDef
</span><a href="Database.Persist.Types.Base.html#NoReference"><span class="hs-identifier hs-var">NoReference</span></a></span><span>
</span><span id="line-1946"></span><span>            </span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">fieldCascade :: FieldCascade
</span><a href="Database.Persist.Types.Base.html#fieldCascade"><span class="hs-identifier hs-var">fieldCascade</span></a></span><span> </span><span class="hs-glyph">=</span><span>
</span><span id="line-1947"></span><span>                </span><span class="annot"><span class="annottext">FieldCascade
</span><a href="Database.Persist.Types.Base.html#noCascade"><span class="hs-identifier hs-var">noCascade</span></a></span><span>
</span><span id="line-1948"></span><span>            </span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">fieldComments :: Maybe Text
</span><a href="Database.Persist.Types.Base.html#fieldComments"><span class="hs-identifier hs-var">fieldComments</span></a></span><span> </span><span class="hs-glyph">=</span><span>
</span><span id="line-1949"></span><span>                </span><span class="annot"><span class="annottext">forall a. Maybe a
</span><span class="hs-identifier hs-var">Nothing</span></span><span>
</span><span id="line-1950"></span><span>            </span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">fieldGenerated :: Maybe Text
</span><a href="Database.Persist.Types.Base.html#fieldGenerated"><span class="hs-identifier hs-var">fieldGenerated</span></a></span><span> </span><span class="hs-glyph">=</span><span>
</span><span id="line-1951"></span><span>                </span><span class="annot"><span class="annottext">forall a. Maybe a
</span><span class="hs-identifier hs-var">Nothing</span></span><span>
</span><span id="line-1952"></span><span>            </span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">fieldIsImplicitIdColumn :: Bool
</span><a href="Database.Persist.Types.Base.html#fieldIsImplicitIdColumn"><span class="hs-identifier hs-var">fieldIsImplicitIdColumn</span></a></span><span> </span><span class="hs-glyph">=</span><span>
</span><span id="line-1953"></span><span>                </span><span class="annot"><span class="annottext">Bool
</span><span class="hs-identifier hs-var">False</span></span><span>
</span><span id="line-1954"></span><span>            </span><span class="hs-special">}</span><span>
</span><span id="line-1955"></span><span>
</span><span id="line-1956"></span><span class="annot"><a href="Database.Persist.TH.html#mkFields"><span class="hs-identifier hs-type">mkFields</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><a href="Database.Persist.TH.html#MkPersistSettings"><span class="hs-identifier hs-type">MkPersistSettings</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="Database.Persist.TH.html#EntityMap"><span class="hs-identifier hs-type">EntityMap</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="Database.Persist.Quasi.Internal.html#UnboundEntityDef"><span class="hs-identifier hs-type">UnboundEntityDef</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="hs-identifier hs-type">Q</span></span><span> </span><span class="annot"><a href="Database.Persist.TH.html#EntityFieldsTH"><span class="hs-identifier hs-type">EntityFieldsTH</span></a></span><span>
</span><span id="line-1957"></span><span id="mkFields"><span class="annot"><span class="annottext">mkFields :: MkPersistSettings
-&gt; EntityMap -&gt; UnboundEntityDef -&gt; Q EntityFieldsTH
</span><a href="Database.Persist.TH.html#mkFields"><span class="hs-identifier hs-var hs-var">mkFields</span></a></span></span><span> </span><span id="local-6989586621679964421"><span class="annot"><span class="annottext">MkPersistSettings
</span><a href="#local-6989586621679964421"><span class="hs-identifier hs-var">mps</span></a></span></span><span> </span><span id="local-6989586621679964420"><span class="annot"><span class="annottext">EntityMap
</span><a href="#local-6989586621679964420"><span class="hs-identifier hs-var">entityMap</span></a></span></span><span> </span><span id="local-6989586621679964419"><span class="annot"><span class="annottext">UnboundEntityDef
</span><a href="#local-6989586621679964419"><span class="hs-identifier hs-var">entDef</span></a></span></span><span> </span><span class="hs-glyph">=</span><span>
</span><span id="line-1958"></span><span>    </span><span class="annot"><span class="annottext">EntityFieldTH -&gt; [EntityFieldTH] -&gt; EntityFieldsTH
</span><a href="Database.Persist.TH.html#EntityFieldsTH"><span class="hs-identifier hs-var">EntityFieldsTH</span></a></span><span>
</span><span id="line-1959"></span><span>        </span><span class="annot"><span class="annottext">forall (f :: * -&gt; *) a b. Functor f =&gt; (a -&gt; b) -&gt; f a -&gt; f b
</span><span class="hs-operator hs-var">&lt;$&gt;</span></span><span> </span><span class="annot"><span class="annottext">MkPersistSettings -&gt; UnboundEntityDef -&gt; Q EntityFieldTH
</span><a href="Database.Persist.TH.html#mkIdField"><span class="hs-identifier hs-var">mkIdField</span></a></span><span> </span><span class="annot"><span class="annottext">MkPersistSettings
</span><a href="#local-6989586621679964421"><span class="hs-identifier hs-var">mps</span></a></span><span> </span><span class="annot"><span class="annottext">UnboundEntityDef
</span><a href="#local-6989586621679964419"><span class="hs-identifier hs-var">entDef</span></a></span><span>
</span><span id="line-1960"></span><span>        </span><span class="annot"><span class="annottext">forall (f :: * -&gt; *) a b. Applicative f =&gt; f (a -&gt; b) -&gt; f a -&gt; f b
</span><span class="hs-operator hs-var">&lt;*&gt;</span></span><span> </span><span class="annot"><span class="annottext">forall (t :: * -&gt; *) (m :: * -&gt; *) a b.
(Traversable t, Monad m) =&gt;
(a -&gt; m b) -&gt; t a -&gt; m (t b)
</span><span class="hs-identifier hs-var">mapM</span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">MkPersistSettings
-&gt; EntityMap
-&gt; UnboundEntityDef
-&gt; UnboundFieldDef
-&gt; Q EntityFieldTH
</span><a href="Database.Persist.TH.html#mkField"><span class="hs-identifier hs-var">mkField</span></a></span><span> </span><span class="annot"><span class="annottext">MkPersistSettings
</span><a href="#local-6989586621679964421"><span class="hs-identifier hs-var">mps</span></a></span><span> </span><span class="annot"><span class="annottext">EntityMap
</span><a href="#local-6989586621679964420"><span class="hs-identifier hs-var">entityMap</span></a></span><span> </span><span class="annot"><span class="annottext">UnboundEntityDef
</span><a href="#local-6989586621679964419"><span class="hs-identifier hs-var">entDef</span></a></span><span class="hs-special">)</span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">UnboundEntityDef -&gt; [UnboundFieldDef]
</span><a href="Database.Persist.Quasi.Internal.html#getUnboundFieldDefs"><span class="hs-identifier hs-var">getUnboundFieldDefs</span></a></span><span> </span><span class="annot"><span class="annottext">UnboundEntityDef
</span><a href="#local-6989586621679964419"><span class="hs-identifier hs-var">entDef</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-1961"></span><span>
</span><span id="line-1962"></span><span class="annot"><a href="Database.Persist.TH.html#mkUniqueKeyInstances"><span class="hs-identifier hs-type">mkUniqueKeyInstances</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><a href="Database.Persist.TH.html#MkPersistSettings"><span class="hs-identifier hs-type">MkPersistSettings</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="Database.Persist.Quasi.Internal.html#UnboundEntityDef"><span class="hs-identifier hs-type">UnboundEntityDef</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="hs-identifier hs-type">Q</span></span><span> </span><span class="hs-special">[</span><span class="annot"><span class="hs-identifier hs-type">Dec</span></span><span class="hs-special">]</span><span>
</span><span id="line-1963"></span><span id="mkUniqueKeyInstances"><span class="annot"><span class="annottext">mkUniqueKeyInstances :: MkPersistSettings -&gt; UnboundEntityDef -&gt; Q [Dec]
</span><a href="Database.Persist.TH.html#mkUniqueKeyInstances"><span class="hs-identifier hs-var hs-var">mkUniqueKeyInstances</span></a></span></span><span> </span><span id="local-6989586621679964416"><span class="annot"><span class="annottext">MkPersistSettings
</span><a href="#local-6989586621679964416"><span class="hs-identifier hs-var">mps</span></a></span></span><span> </span><span id="local-6989586621679964415"><span class="annot"><span class="annottext">UnboundEntityDef
</span><a href="#local-6989586621679964415"><span class="hs-identifier hs-var">entDef</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-keyword">do</span><span>
</span><span id="line-1964"></span><span>    </span><span class="annot"><span class="annottext">Q ()
</span><a href="Database.Persist.TH.html#requirePersistentExtensions"><span class="hs-identifier hs-var">requirePersistentExtensions</span></a></span><span>
</span><span id="line-1965"></span><span>    </span><span class="hs-keyword">case</span><span> </span><span class="annot"><span class="annottext">EntityDef -&gt; [UniqueDef]
</span><a href="Database.Persist.Types.Base.html#entityUniques"><span class="hs-identifier hs-var">entityUniques</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">UnboundEntityDef -&gt; EntityDef
</span><a href="Database.Persist.Quasi.Internal.html#unboundEntityDef"><span class="hs-identifier hs-var">unboundEntityDef</span></a></span><span> </span><span class="annot"><span class="annottext">UnboundEntityDef
</span><a href="#local-6989586621679964415"><span class="hs-identifier hs-var">entDef</span></a></span><span class="hs-special">)</span><span> </span><span class="hs-keyword">of</span><span>
</span><span id="line-1966"></span><span>        </span><span class="hs-special">[</span><span class="hs-special">]</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="annottext">forall m. Monoid m =&gt; m -&gt; m -&gt; m
</span><span class="hs-identifier hs-var">mappend</span></span><span> </span><span class="annot"><span class="annottext">forall (f :: * -&gt; *) a b. Functor f =&gt; (a -&gt; b) -&gt; f a -&gt; f b
</span><span class="hs-operator hs-var">&lt;$&gt;</span></span><span> </span><span class="annot"><span class="annottext">Q [Dec]
</span><a href="#local-6989586621679964414"><span class="hs-identifier hs-var">typeErrorSingle</span></a></span><span> </span><span class="annot"><span class="annottext">forall (f :: * -&gt; *) a b. Applicative f =&gt; f (a -&gt; b) -&gt; f a -&gt; f b
</span><span class="hs-operator hs-var">&lt;*&gt;</span></span><span> </span><span class="annot"><span class="annottext">Q [Dec]
</span><a href="#local-6989586621679964413"><span class="hs-identifier hs-var">typeErrorAtLeastOne</span></a></span><span>
</span><span id="line-1967"></span><span>        </span><span class="hs-special">[</span><span class="annot"><span class="annottext">UniqueDef
</span><span class="hs-identifier">_</span></span><span class="hs-special">]</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="annottext">forall m. Monoid m =&gt; m -&gt; m -&gt; m
</span><span class="hs-identifier hs-var">mappend</span></span><span> </span><span class="annot"><span class="annottext">forall (f :: * -&gt; *) a b. Functor f =&gt; (a -&gt; b) -&gt; f a -&gt; f b
</span><span class="hs-operator hs-var">&lt;$&gt;</span></span><span> </span><span class="annot"><span class="annottext">Q [Dec]
</span><a href="#local-6989586621679964412"><span class="hs-identifier hs-var">singleUniqueKey</span></a></span><span> </span><span class="annot"><span class="annottext">forall (f :: * -&gt; *) a b. Applicative f =&gt; f (a -&gt; b) -&gt; f a -&gt; f b
</span><span class="hs-operator hs-var">&lt;*&gt;</span></span><span> </span><span class="annot"><span class="annottext">Q [Dec]
</span><a href="#local-6989586621679964411"><span class="hs-identifier hs-var">atLeastOneKey</span></a></span><span>
</span><span id="line-1968"></span><span>        </span><span class="hs-special">(</span><span class="annot"><span class="annottext">UniqueDef
</span><span class="hs-identifier">_</span></span><span class="annot"><span class="hs-glyph hs-type">:</span></span><span class="annot"><span class="annottext">[UniqueDef]
</span><span class="hs-identifier">_</span></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="annottext">forall m. Monoid m =&gt; m -&gt; m -&gt; m
</span><span class="hs-identifier hs-var">mappend</span></span><span> </span><span class="annot"><span class="annottext">forall (f :: * -&gt; *) a b. Functor f =&gt; (a -&gt; b) -&gt; f a -&gt; f b
</span><span class="hs-operator hs-var">&lt;$&gt;</span></span><span> </span><span class="annot"><span class="annottext">Q [Dec]
</span><a href="#local-6989586621679964410"><span class="hs-identifier hs-var">typeErrorMultiple</span></a></span><span> </span><span class="annot"><span class="annottext">forall (f :: * -&gt; *) a b. Applicative f =&gt; f (a -&gt; b) -&gt; f a -&gt; f b
</span><span class="hs-operator hs-var">&lt;*&gt;</span></span><span> </span><span class="annot"><span class="annottext">Q [Dec]
</span><a href="#local-6989586621679964411"><span class="hs-identifier hs-var">atLeastOneKey</span></a></span><span>
</span><span id="line-1969"></span><span>  </span><span class="hs-keyword">where</span><span>
</span><span id="line-1970"></span><span>    </span><span id="local-6989586621679964409"><span class="annot"><span class="annottext">requireUniquesPName :: Name
</span><a href="#local-6989586621679964409"><span class="hs-identifier hs-var hs-var">requireUniquesPName</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-special">'</span><span class="hs-identifier">requireUniquesP</span><span>
</span><span id="line-1971"></span><span>    </span><span id="local-6989586621679964408"><span class="annot"><span class="annottext">onlyUniquePName :: Name
</span><a href="#local-6989586621679964408"><span class="hs-identifier hs-var hs-var">onlyUniquePName</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-special">'</span><span class="hs-identifier">onlyUniqueP</span><span>
</span><span id="line-1972"></span><span>    </span><span id="local-6989586621679964414"><span class="annot"><span class="annottext">typeErrorSingle :: Q [Dec]
</span><a href="#local-6989586621679964414"><span class="hs-identifier hs-var hs-var">typeErrorSingle</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">Q [Type] -&gt; Q [Dec]
</span><a href="#local-6989586621679964407"><span class="hs-identifier hs-var">mkOnlyUniqueError</span></a></span><span> </span><span class="annot"><span class="annottext">Q [Type]
</span><a href="#local-6989586621679964406"><span class="hs-identifier hs-var">typeErrorNoneCtx</span></a></span><span>
</span><span id="line-1973"></span><span>    </span><span id="local-6989586621679964410"><span class="annot"><span class="annottext">typeErrorMultiple :: Q [Dec]
</span><a href="#local-6989586621679964410"><span class="hs-identifier hs-var hs-var">typeErrorMultiple</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">Q [Type] -&gt; Q [Dec]
</span><a href="#local-6989586621679964407"><span class="hs-identifier hs-var">mkOnlyUniqueError</span></a></span><span> </span><span class="annot"><span class="annottext">Q [Type]
</span><a href="#local-6989586621679964405"><span class="hs-identifier hs-var">typeErrorMultipleCtx</span></a></span><span>
</span><span id="line-1974"></span><span>
</span><span id="line-1975"></span><span>    </span><span id="local-6989586621679964404"><span class="annot"><span class="annottext">withPersistStoreWriteCxt :: Q [Type]
</span><a href="#local-6989586621679964404"><span class="hs-identifier hs-var hs-var">withPersistStoreWriteCxt</span></a></span></span><span> </span><span class="hs-glyph">=</span><span>
</span><span id="line-1976"></span><span>        </span><span class="hs-keyword">if</span><span> </span><span class="annot"><span class="annottext">MkPersistSettings -&gt; Bool
</span><a href="Database.Persist.TH.html#mpsGeneric"><span class="hs-identifier hs-var">mpsGeneric</span></a></span><span> </span><span class="annot"><span class="annottext">MkPersistSettings
</span><a href="#local-6989586621679964416"><span class="hs-identifier hs-var">mps</span></a></span><span>
</span><span id="line-1977"></span><span>            </span><span class="hs-keyword">then</span><span> </span><span class="hs-keyword">do</span><span>
</span><span id="line-1978"></span><span>                </span><span id="local-6989586621679964403"><span class="annot"><span class="annottext">Type
</span><a href="#local-6989586621679964403"><span class="hs-identifier hs-var">write</span></a></span></span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="hs-special">[t|</span><span class="hs-identifier">PersistStoreWrite</span><span> </span><span class="hs-special">$</span><span class="hs-special">(</span><span class="hs-identifier">pure</span><span> </span><span class="hs-identifier">backendT</span><span class="hs-special">)</span><span> </span><span class="hs-special">|]</span><span>
</span><span id="line-1979"></span><span>                </span><span class="annot"><span class="annottext">forall (f :: * -&gt; *) a. Applicative f =&gt; a -&gt; f a
</span><span class="hs-identifier hs-var">pure</span></span><span> </span><span class="hs-special">[</span><span class="annot"><span class="annottext">Type
</span><a href="#local-6989586621679964403"><span class="hs-identifier hs-var">write</span></a></span><span class="hs-special">]</span><span>
</span><span id="line-1980"></span><span>            </span><span class="hs-keyword">else</span><span> </span><span class="hs-keyword">do</span><span>
</span><span id="line-1981"></span><span>                </span><span class="annot"><span class="annottext">forall (f :: * -&gt; *) a. Applicative f =&gt; a -&gt; f a
</span><span class="hs-identifier hs-var">pure</span></span><span> </span><span class="hs-special">[</span><span class="hs-special">]</span><span>
</span><span id="line-1982"></span><span>
</span><span id="line-1983"></span><span>    </span><span id="local-6989586621679964406"><span class="annot"><span class="annottext">typeErrorNoneCtx :: Q [Type]
</span><a href="#local-6989586621679964406"><span class="hs-identifier hs-var hs-var">typeErrorNoneCtx</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-keyword">do</span><span>
</span><span id="line-1984"></span><span>        </span><span id="local-6989586621679964402"><span class="annot"><span class="annottext">Type
</span><a href="#local-6989586621679964402"><span class="hs-identifier hs-var">tyErr</span></a></span></span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="hs-special">[t|</span><span class="hs-identifier">TypeError</span><span> </span><span class="hs-special">(</span><span class="hs-identifier">NoUniqueKeysError</span><span> </span><span class="hs-special">$</span><span class="hs-special">(</span><span class="hs-identifier">pure</span><span> </span><span class="hs-identifier">genDataType</span><span class="hs-special">)</span><span class="hs-special">)</span><span class="hs-special">|]</span><span>
</span><span id="line-1985"></span><span>        </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Type
</span><a href="#local-6989586621679964402"><span class="hs-identifier hs-var">tyErr</span></a></span><span> </span><span class="annot"><span class="annottext">forall a. a -&gt; [a] -&gt; [a]
</span><span class="hs-glyph hs-var">:</span></span><span class="hs-special">)</span><span> </span><span class="annot"><span class="annottext">forall (f :: * -&gt; *) a b. Functor f =&gt; (a -&gt; b) -&gt; f a -&gt; f b
</span><span class="hs-operator hs-var">&lt;$&gt;</span></span><span> </span><span class="annot"><span class="annottext">Q [Type]
</span><a href="#local-6989586621679964404"><span class="hs-identifier hs-var">withPersistStoreWriteCxt</span></a></span><span>
</span><span id="line-1986"></span><span>
</span><span id="line-1987"></span><span>    </span><span id="local-6989586621679964405"><span class="annot"><span class="annottext">typeErrorMultipleCtx :: Q [Type]
</span><a href="#local-6989586621679964405"><span class="hs-identifier hs-var hs-var">typeErrorMultipleCtx</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-keyword">do</span><span>
</span><span id="line-1988"></span><span>        </span><span id="local-6989586621679964401"><span class="annot"><span class="annottext">Type
</span><a href="#local-6989586621679964401"><span class="hs-identifier hs-var">tyErr</span></a></span></span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="hs-special">[t|</span><span class="hs-identifier">TypeError</span><span> </span><span class="hs-special">(</span><span class="hs-identifier">MultipleUniqueKeysError</span><span> </span><span class="hs-special">$</span><span class="hs-special">(</span><span class="hs-identifier">pure</span><span> </span><span class="hs-identifier">genDataType</span><span class="hs-special">)</span><span class="hs-special">)</span><span class="hs-special">|]</span><span>
</span><span id="line-1989"></span><span>        </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Type
</span><a href="#local-6989586621679964401"><span class="hs-identifier hs-var">tyErr</span></a></span><span> </span><span class="annot"><span class="annottext">forall a. a -&gt; [a] -&gt; [a]
</span><span class="hs-glyph hs-var">:</span></span><span class="hs-special">)</span><span> </span><span class="annot"><span class="annottext">forall (f :: * -&gt; *) a b. Functor f =&gt; (a -&gt; b) -&gt; f a -&gt; f b
</span><span class="hs-operator hs-var">&lt;$&gt;</span></span><span> </span><span class="annot"><span class="annottext">Q [Type]
</span><a href="#local-6989586621679964404"><span class="hs-identifier hs-var">withPersistStoreWriteCxt</span></a></span><span>
</span><span id="line-1990"></span><span>
</span><span id="line-1991"></span><span>    </span><span class="annot"><a href="#local-6989586621679964407"><span class="hs-identifier hs-type">mkOnlyUniqueError</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><span class="hs-identifier hs-type">Q</span></span><span> </span><span class="annot"><span class="hs-identifier hs-type">Cxt</span></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="hs-identifier hs-type">Q</span></span><span> </span><span class="hs-special">[</span><span class="annot"><span class="hs-identifier hs-type">Dec</span></span><span class="hs-special">]</span><span>
</span><span id="line-1992"></span><span>    </span><span id="local-6989586621679964407"><span class="annot"><span class="annottext">mkOnlyUniqueError :: Q [Type] -&gt; Q [Dec]
</span><a href="#local-6989586621679964407"><span class="hs-identifier hs-var hs-var">mkOnlyUniqueError</span></a></span></span><span> </span><span id="local-6989586621679964399"><span class="annot"><span class="annottext">Q [Type]
</span><a href="#local-6989586621679964399"><span class="hs-identifier hs-var">mkCtx</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-keyword">do</span><span>
</span><span id="line-1993"></span><span>        </span><span id="local-6989586621679964398"><span class="annot"><span class="annottext">[Type]
</span><a href="#local-6989586621679964398"><span class="hs-identifier hs-var">ctx</span></a></span></span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">Q [Type]
</span><a href="#local-6989586621679964399"><span class="hs-identifier hs-var">mkCtx</span></a></span><span>
</span><span id="line-1994"></span><span>        </span><span class="hs-keyword">let</span><span> </span><span id="local-6989586621679964397"><span class="annot"><span class="annottext">impl :: [Dec]
</span><a href="#local-6989586621679964397"><span class="hs-identifier hs-var hs-var">impl</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">Name -&gt; [Dec]
</span><a href="#local-6989586621679964396"><span class="hs-identifier hs-var">mkImpossible</span></a></span><span> </span><span class="annot"><span class="annottext">Name
</span><a href="#local-6989586621679964408"><span class="hs-identifier hs-var">onlyUniquePName</span></a></span><span>
</span><span id="line-1995"></span><span>        </span><span class="annot"><span class="annottext">forall (f :: * -&gt; *) a. Applicative f =&gt; a -&gt; f a
</span><span class="hs-identifier hs-var">pure</span></span><span> </span><span class="hs-special">[</span><span class="annot"><span class="annottext">[Type] -&gt; Type -&gt; [Dec] -&gt; Dec
</span><a href="Database.Persist.TH.html#instanceD"><span class="hs-identifier hs-var">instanceD</span></a></span><span> </span><span class="annot"><span class="annottext">[Type]
</span><a href="#local-6989586621679964398"><span class="hs-identifier hs-var">ctx</span></a></span><span> </span><span class="annot"><span class="annottext">Type
</span><a href="#local-6989586621679964395"><span class="hs-identifier hs-var">onlyOneUniqueKeyClass</span></a></span><span> </span><span class="annot"><span class="annottext">[Dec]
</span><a href="#local-6989586621679964397"><span class="hs-identifier hs-var">impl</span></a></span><span class="hs-special">]</span><span>
</span><span id="line-1996"></span><span>
</span><span id="line-1997"></span><span>    </span><span id="local-6989586621679964396"><span class="annot"><span class="annottext">mkImpossible :: Name -&gt; [Dec]
</span><a href="#local-6989586621679964396"><span class="hs-identifier hs-var hs-var">mkImpossible</span></a></span></span><span> </span><span id="local-6989586621679964394"><span class="annot"><span class="annottext">Name
</span><a href="#local-6989586621679964394"><span class="hs-identifier hs-var">name</span></a></span></span><span> </span><span class="hs-glyph">=</span><span>
</span><span id="line-1998"></span><span>        </span><span class="hs-special">[</span><span> </span><span class="annot"><span class="annottext">Name -&gt; [Clause] -&gt; Dec
</span><span class="hs-identifier hs-var">FunD</span></span><span> </span><span class="annot"><span class="annottext">Name
</span><a href="#local-6989586621679964394"><span class="hs-identifier hs-var">name</span></a></span><span>
</span><span id="line-1999"></span><span>            </span><span class="hs-special">[</span><span> </span><span class="annot"><span class="annottext">[Pat] -&gt; Body -&gt; [Dec] -&gt; Clause
</span><span class="hs-identifier hs-var">Clause</span></span><span>
</span><span id="line-2000"></span><span>                </span><span class="hs-special">[</span><span> </span><span class="annot"><span class="annottext">Pat
</span><span class="hs-identifier hs-var">WildP</span></span><span> </span><span class="hs-special">]</span><span>
</span><span id="line-2001"></span><span>                </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Exp -&gt; Body
</span><span class="hs-identifier hs-var">NormalB</span></span><span>
</span><span id="line-2002"></span><span>                    </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Name -&gt; Exp
</span><span class="hs-identifier hs-var">VarE</span></span><span> </span><span class="hs-special">'</span><span class="hs-identifier">error</span><span> </span><span class="annot"><span class="annottext">Exp -&gt; Exp -&gt; Exp
</span><span class="hs-operator hs-var">`AppE`</span></span><span> </span><span class="annot"><span class="annottext">Lit -&gt; Exp
</span><span class="hs-identifier hs-var">LitE</span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">String -&gt; Lit
</span><span class="hs-identifier hs-var">StringL</span></span><span> </span><span class="annot"><span class="annottext">String
</span><span class="hs-string">&quot;impossible&quot;</span></span><span class="hs-special">)</span><span class="hs-special">)</span><span>
</span><span id="line-2003"></span><span>                </span><span class="hs-special">)</span><span>
</span><span id="line-2004"></span><span>                </span><span class="hs-special">[</span><span class="hs-special">]</span><span>
</span><span id="line-2005"></span><span>            </span><span class="hs-special">]</span><span>
</span><span id="line-2006"></span><span>        </span><span class="hs-special">]</span><span>
</span><span id="line-2007"></span><span>
</span><span id="line-2008"></span><span>    </span><span class="annot"><a href="#local-6989586621679964413"><span class="hs-identifier hs-type">typeErrorAtLeastOne</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><span class="hs-identifier hs-type">Q</span></span><span> </span><span class="hs-special">[</span><span class="annot"><span class="hs-identifier hs-type">Dec</span></span><span class="hs-special">]</span><span>
</span><span id="line-2009"></span><span>    </span><span id="local-6989586621679964413"><span class="annot"><span class="annottext">typeErrorAtLeastOne :: Q [Dec]
</span><a href="#local-6989586621679964413"><span class="hs-identifier hs-var hs-var">typeErrorAtLeastOne</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-keyword">do</span><span>
</span><span id="line-2010"></span><span>        </span><span class="hs-keyword">let</span><span> </span><span id="local-6989586621679964393"><span class="annot"><span class="annottext">impl :: [Dec]
</span><a href="#local-6989586621679964393"><span class="hs-identifier hs-var hs-var">impl</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">Name -&gt; [Dec]
</span><a href="#local-6989586621679964396"><span class="hs-identifier hs-var">mkImpossible</span></a></span><span> </span><span class="annot"><span class="annottext">Name
</span><a href="#local-6989586621679964409"><span class="hs-identifier hs-var">requireUniquesPName</span></a></span><span>
</span><span id="line-2011"></span><span>        </span><span id="local-6989586621679964392"><span class="annot"><span class="annottext">[Type]
</span><a href="#local-6989586621679964392"><span class="hs-identifier hs-var">cxt</span></a></span></span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">Q [Type]
</span><a href="#local-6989586621679964405"><span class="hs-identifier hs-var">typeErrorMultipleCtx</span></a></span><span>
</span><span id="line-2012"></span><span>        </span><span class="annot"><span class="annottext">forall (f :: * -&gt; *) a. Applicative f =&gt; a -&gt; f a
</span><span class="hs-identifier hs-var">pure</span></span><span> </span><span class="hs-special">[</span><span class="annot"><span class="annottext">[Type] -&gt; Type -&gt; [Dec] -&gt; Dec
</span><a href="Database.Persist.TH.html#instanceD"><span class="hs-identifier hs-var">instanceD</span></a></span><span> </span><span class="annot"><span class="annottext">[Type]
</span><a href="#local-6989586621679964392"><span class="hs-identifier hs-var">cxt</span></a></span><span> </span><span class="annot"><span class="annottext">Type
</span><a href="#local-6989586621679964391"><span class="hs-identifier hs-var">atLeastOneUniqueKeyClass</span></a></span><span> </span><span class="annot"><span class="annottext">[Dec]
</span><a href="#local-6989586621679964393"><span class="hs-identifier hs-var">impl</span></a></span><span class="hs-special">]</span><span>
</span><span id="line-2013"></span><span>
</span><span id="line-2014"></span><span>    </span><span class="annot"><a href="#local-6989586621679964412"><span class="hs-identifier hs-type">singleUniqueKey</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><span class="hs-identifier hs-type">Q</span></span><span> </span><span class="hs-special">[</span><span class="annot"><span class="hs-identifier hs-type">Dec</span></span><span class="hs-special">]</span><span>
</span><span id="line-2015"></span><span>    </span><span id="local-6989586621679964412"><span class="annot"><span class="annottext">singleUniqueKey :: Q [Dec]
</span><a href="#local-6989586621679964412"><span class="hs-identifier hs-var hs-var">singleUniqueKey</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-keyword">do</span><span>
</span><span id="line-2016"></span><span>        </span><span id="local-6989586621679964390"><span class="annot"><span class="annottext">Exp
</span><a href="#local-6989586621679964390"><span class="hs-identifier hs-var">expr</span></a></span></span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="hs-special">[e|</span><span> </span><span class="hs-identifier">head</span><span> </span><span class="hs-operator">.</span><span> </span><span class="hs-identifier">persistUniqueKeys</span><span class="hs-special">|]</span><span>
</span><span id="line-2017"></span><span>        </span><span class="hs-keyword">let</span><span> </span><span id="local-6989586621679964389"><span class="annot"><span class="annottext">impl :: [Dec]
</span><a href="#local-6989586621679964389"><span class="hs-identifier hs-var hs-var">impl</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-special">[</span><span class="annot"><span class="annottext">Name -&gt; [Clause] -&gt; Dec
</span><span class="hs-identifier hs-var">FunD</span></span><span> </span><span class="annot"><span class="annottext">Name
</span><a href="#local-6989586621679964408"><span class="hs-identifier hs-var">onlyUniquePName</span></a></span><span> </span><span class="hs-special">[</span><span class="annot"><span class="annottext">[Pat] -&gt; Body -&gt; [Dec] -&gt; Clause
</span><span class="hs-identifier hs-var">Clause</span></span><span> </span><span class="hs-special">[</span><span class="hs-special">]</span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Exp -&gt; Body
</span><span class="hs-identifier hs-var">NormalB</span></span><span> </span><span class="annot"><span class="annottext">Exp
</span><a href="#local-6989586621679964390"><span class="hs-identifier hs-var">expr</span></a></span><span class="hs-special">)</span><span> </span><span class="hs-special">[</span><span class="hs-special">]</span><span class="hs-special">]</span><span class="hs-special">]</span><span>
</span><span id="line-2018"></span><span>        </span><span id="local-6989586621679964388"><span class="annot"><span class="annottext">[Type]
</span><a href="#local-6989586621679964388"><span class="hs-identifier hs-var">cxt</span></a></span></span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">Q [Type]
</span><a href="#local-6989586621679964404"><span class="hs-identifier hs-var">withPersistStoreWriteCxt</span></a></span><span>
</span><span id="line-2019"></span><span>        </span><span class="annot"><span class="annottext">forall (f :: * -&gt; *) a. Applicative f =&gt; a -&gt; f a
</span><span class="hs-identifier hs-var">pure</span></span><span> </span><span class="hs-special">[</span><span class="annot"><span class="annottext">[Type] -&gt; Type -&gt; [Dec] -&gt; Dec
</span><a href="Database.Persist.TH.html#instanceD"><span class="hs-identifier hs-var">instanceD</span></a></span><span> </span><span class="annot"><span class="annottext">[Type]
</span><a href="#local-6989586621679964388"><span class="hs-identifier hs-var">cxt</span></a></span><span> </span><span class="annot"><span class="annottext">Type
</span><a href="#local-6989586621679964395"><span class="hs-identifier hs-var">onlyOneUniqueKeyClass</span></a></span><span> </span><span class="annot"><span class="annottext">[Dec]
</span><a href="#local-6989586621679964389"><span class="hs-identifier hs-var">impl</span></a></span><span class="hs-special">]</span><span>
</span><span id="line-2020"></span><span>
</span><span id="line-2021"></span><span>    </span><span id="local-6989586621679964391"><span class="annot"><span class="annottext">atLeastOneUniqueKeyClass :: Type
</span><a href="#local-6989586621679964391"><span class="hs-identifier hs-var hs-var">atLeastOneUniqueKeyClass</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">Name -&gt; Type
</span><span class="hs-identifier hs-var">ConT</span></span><span> </span><span class="hs-special">''</span><span class="hs-identifier">AtLeastOneUniqueKey</span><span> </span><span class="annot"><span class="annottext">Type -&gt; Type -&gt; Type
</span><span class="hs-operator hs-var">`AppT`</span></span><span> </span><span class="annot"><span class="annottext">Type
</span><a href="#local-6989586621679964387"><span class="hs-identifier hs-var">genDataType</span></a></span><span>
</span><span id="line-2022"></span><span>    </span><span id="local-6989586621679964395"><span class="annot"><span class="annottext">onlyOneUniqueKeyClass :: Type
</span><a href="#local-6989586621679964395"><span class="hs-identifier hs-var hs-var">onlyOneUniqueKeyClass</span></a></span></span><span> </span><span class="hs-glyph">=</span><span>  </span><span class="annot"><span class="annottext">Name -&gt; Type
</span><span class="hs-identifier hs-var">ConT</span></span><span> </span><span class="hs-special">''</span><span class="hs-identifier">OnlyOneUniqueKey</span><span> </span><span class="annot"><span class="annottext">Type -&gt; Type -&gt; Type
</span><span class="hs-operator hs-var">`AppT`</span></span><span> </span><span class="annot"><span class="annottext">Type
</span><a href="#local-6989586621679964387"><span class="hs-identifier hs-var">genDataType</span></a></span><span>
</span><span id="line-2023"></span><span>
</span><span id="line-2024"></span><span>    </span><span class="annot"><a href="#local-6989586621679964411"><span class="hs-identifier hs-type">atLeastOneKey</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><span class="hs-identifier hs-type">Q</span></span><span> </span><span class="hs-special">[</span><span class="annot"><span class="hs-identifier hs-type">Dec</span></span><span class="hs-special">]</span><span>
</span><span id="line-2025"></span><span>    </span><span id="local-6989586621679964411"><span class="annot"><span class="annottext">atLeastOneKey :: Q [Dec]
</span><a href="#local-6989586621679964411"><span class="hs-identifier hs-var hs-var">atLeastOneKey</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-keyword">do</span><span>
</span><span id="line-2026"></span><span>        </span><span id="local-6989586621679964386"><span class="annot"><span class="annottext">Exp
</span><a href="#local-6989586621679964386"><span class="hs-identifier hs-var">expr</span></a></span></span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="hs-special">[e|</span><span> </span><span class="hs-identifier">NEL.fromList</span><span> </span><span class="hs-operator">.</span><span> </span><span class="hs-identifier">persistUniqueKeys</span><span class="hs-special">|]</span><span>
</span><span id="line-2027"></span><span>        </span><span class="hs-keyword">let</span><span> </span><span id="local-6989586621679964385"><span class="annot"><span class="annottext">impl :: [Dec]
</span><a href="#local-6989586621679964385"><span class="hs-identifier hs-var hs-var">impl</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-special">[</span><span class="annot"><span class="annottext">Name -&gt; [Clause] -&gt; Dec
</span><span class="hs-identifier hs-var">FunD</span></span><span> </span><span class="annot"><span class="annottext">Name
</span><a href="#local-6989586621679964409"><span class="hs-identifier hs-var">requireUniquesPName</span></a></span><span> </span><span class="hs-special">[</span><span class="annot"><span class="annottext">[Pat] -&gt; Body -&gt; [Dec] -&gt; Clause
</span><span class="hs-identifier hs-var">Clause</span></span><span> </span><span class="hs-special">[</span><span class="hs-special">]</span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Exp -&gt; Body
</span><span class="hs-identifier hs-var">NormalB</span></span><span> </span><span class="annot"><span class="annottext">Exp
</span><a href="#local-6989586621679964386"><span class="hs-identifier hs-var">expr</span></a></span><span class="hs-special">)</span><span> </span><span class="hs-special">[</span><span class="hs-special">]</span><span class="hs-special">]</span><span class="hs-special">]</span><span>
</span><span id="line-2028"></span><span>        </span><span id="local-6989586621679964384"><span class="annot"><span class="annottext">[Type]
</span><a href="#local-6989586621679964384"><span class="hs-identifier hs-var">cxt</span></a></span></span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">Q [Type]
</span><a href="#local-6989586621679964404"><span class="hs-identifier hs-var">withPersistStoreWriteCxt</span></a></span><span>
</span><span id="line-2029"></span><span>        </span><span class="annot"><span class="annottext">forall (f :: * -&gt; *) a. Applicative f =&gt; a -&gt; f a
</span><span class="hs-identifier hs-var">pure</span></span><span> </span><span class="hs-special">[</span><span class="annot"><span class="annottext">[Type] -&gt; Type -&gt; [Dec] -&gt; Dec
</span><a href="Database.Persist.TH.html#instanceD"><span class="hs-identifier hs-var">instanceD</span></a></span><span> </span><span class="annot"><span class="annottext">[Type]
</span><a href="#local-6989586621679964384"><span class="hs-identifier hs-var">cxt</span></a></span><span> </span><span class="annot"><span class="annottext">Type
</span><a href="#local-6989586621679964391"><span class="hs-identifier hs-var">atLeastOneUniqueKeyClass</span></a></span><span> </span><span class="annot"><span class="annottext">[Dec]
</span><a href="#local-6989586621679964385"><span class="hs-identifier hs-var">impl</span></a></span><span class="hs-special">]</span><span>
</span><span id="line-2030"></span><span>
</span><span id="line-2031"></span><span>    </span><span id="local-6989586621679964387"><span class="annot"><span class="annottext">genDataType :: Type
</span><a href="#local-6989586621679964387"><span class="hs-identifier hs-var hs-var">genDataType</span></a></span></span><span> </span><span class="hs-glyph">=</span><span>
</span><span id="line-2032"></span><span>        </span><span class="annot"><span class="annottext">MkPersistSettings -&gt; EntityNameHS -&gt; Type -&gt; Type
</span><a href="Database.Persist.TH.html#genericDataType"><span class="hs-identifier hs-var">genericDataType</span></a></span><span> </span><span class="annot"><span class="annottext">MkPersistSettings
</span><a href="#local-6989586621679964416"><span class="hs-identifier hs-var">mps</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">UnboundEntityDef -&gt; EntityNameHS
</span><a href="Database.Persist.Quasi.Internal.html#getUnboundEntityNameHS"><span class="hs-identifier hs-var">getUnboundEntityNameHS</span></a></span><span> </span><span class="annot"><span class="annottext">UnboundEntityDef
</span><a href="#local-6989586621679964415"><span class="hs-identifier hs-var">entDef</span></a></span><span class="hs-special">)</span><span> </span><span class="annot"><span class="annottext">Type
</span><a href="Database.Persist.TH.html#backendT"><span class="hs-identifier hs-var">backendT</span></a></span><span>
</span><span id="line-2033"></span><span>
</span><span id="line-2034"></span><span class="annot"><a href="Database.Persist.TH.html#entityText"><span class="hs-identifier hs-type">entityText</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><a href="Database.Persist.Quasi.Internal.html#UnboundEntityDef"><span class="hs-identifier hs-type">UnboundEntityDef</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="hs-identifier hs-type">Text</span></span><span>
</span><span id="line-2035"></span><span id="entityText"><span class="annot"><span class="annottext">entityText :: UnboundEntityDef -&gt; Text
</span><a href="Database.Persist.TH.html#entityText"><span class="hs-identifier hs-var hs-var">entityText</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">EntityNameHS -&gt; Text
</span><a href="Database.Persist.Names.html#unEntityNameHS"><span class="hs-identifier hs-var">unEntityNameHS</span></a></span><span> </span><span class="annot"><span class="annottext">forall b c a. (b -&gt; c) -&gt; (a -&gt; b) -&gt; a -&gt; c
</span><span class="hs-operator hs-var">.</span></span><span> </span><span class="annot"><span class="annottext">UnboundEntityDef -&gt; EntityNameHS
</span><a href="Database.Persist.Quasi.Internal.html#getUnboundEntityNameHS"><span class="hs-identifier hs-var">getUnboundEntityNameHS</span></a></span><span>
</span><span id="line-2036"></span><span>
</span><span id="line-2037"></span><span class="annot"><a href="Database.Persist.TH.html#mkLenses"><span class="hs-identifier hs-type">mkLenses</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><a href="Database.Persist.TH.html#MkPersistSettings"><span class="hs-identifier hs-type">MkPersistSettings</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="Database.Persist.TH.html#EntityMap"><span class="hs-identifier hs-type">EntityMap</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="Database.Persist.Quasi.Internal.html#UnboundEntityDef"><span class="hs-identifier hs-type">UnboundEntityDef</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="hs-identifier hs-type">Q</span></span><span> </span><span class="hs-special">[</span><span class="annot"><span class="hs-identifier hs-type">Dec</span></span><span class="hs-special">]</span><span>
</span><span id="line-2038"></span><span id="mkLenses"><span class="annot"><span class="annottext">mkLenses :: MkPersistSettings -&gt; EntityMap -&gt; UnboundEntityDef -&gt; Q [Dec]
</span><a href="Database.Persist.TH.html#mkLenses"><span class="hs-identifier hs-var hs-var">mkLenses</span></a></span></span><span> </span><span id="local-6989586621679964383"><span class="annot"><span class="annottext">MkPersistSettings
</span><a href="#local-6989586621679964383"><span class="hs-identifier hs-var">mps</span></a></span></span><span> </span><span class="annot"><span class="annottext">EntityMap
</span><span class="hs-identifier">_</span></span><span> </span><span class="annot"><span class="annottext">UnboundEntityDef
</span><span class="hs-identifier">_</span></span><span> </span><span class="hs-glyph">|</span><span> </span><span class="annot"><span class="annottext">Bool -&gt; Bool
</span><span class="hs-identifier hs-var">not</span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">MkPersistSettings -&gt; Bool
</span><a href="Database.Persist.TH.html#mpsGenerateLenses"><span class="hs-identifier hs-var">mpsGenerateLenses</span></a></span><span> </span><span class="annot"><span class="annottext">MkPersistSettings
</span><a href="#local-6989586621679964383"><span class="hs-identifier hs-var">mps</span></a></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">forall (m :: * -&gt; *) a. Monad m =&gt; a -&gt; m a
</span><span class="hs-identifier hs-var">return</span></span><span> </span><span class="hs-special">[</span><span class="hs-special">]</span><span>
</span><span id="line-2039"></span><span class="annot"><a href="Database.Persist.TH.html#mkLenses"><span class="hs-identifier hs-var">mkLenses</span></a></span><span> </span><span class="annot"><span class="annottext">MkPersistSettings
</span><span class="hs-identifier">_</span></span><span> </span><span class="annot"><span class="annottext">EntityMap
</span><span class="hs-identifier">_</span></span><span> </span><span id="local-6989586621679964382"><span class="annot"><span class="annottext">UnboundEntityDef
</span><a href="#local-6989586621679964382"><span class="hs-identifier hs-var">ent</span></a></span></span><span> </span><span class="hs-glyph">|</span><span> </span><span class="annot"><span class="annottext">EntityDef -&gt; Bool
</span><a href="Database.Persist.Types.Base.html#entitySum"><span class="hs-identifier hs-var">entitySum</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">UnboundEntityDef -&gt; EntityDef
</span><a href="Database.Persist.Quasi.Internal.html#unboundEntityDef"><span class="hs-identifier hs-var">unboundEntityDef</span></a></span><span> </span><span class="annot"><span class="annottext">UnboundEntityDef
</span><a href="#local-6989586621679964382"><span class="hs-identifier hs-var">ent</span></a></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">forall (m :: * -&gt; *) a. Monad m =&gt; a -&gt; m a
</span><span class="hs-identifier hs-var">return</span></span><span> </span><span class="hs-special">[</span><span class="hs-special">]</span><span>
</span><span id="line-2040"></span><span class="annot"><a href="Database.Persist.TH.html#mkLenses"><span class="hs-identifier hs-var">mkLenses</span></a></span><span> </span><span id="local-6989586621679964381"><span class="annot"><span class="annottext">MkPersistSettings
</span><a href="#local-6989586621679964381"><span class="hs-identifier hs-var">mps</span></a></span></span><span> </span><span id="local-6989586621679964380"><span class="annot"><span class="annottext">EntityMap
</span><a href="#local-6989586621679964380"><span class="hs-identifier hs-var">entityMap</span></a></span></span><span> </span><span id="local-6989586621679964379"><span class="annot"><span class="annottext">UnboundEntityDef
</span><a href="#local-6989586621679964379"><span class="hs-identifier hs-var">ent</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">forall (f :: * -&gt; *) a b. Functor f =&gt; (a -&gt; b) -&gt; f a -&gt; f b
</span><span class="hs-identifier hs-var">fmap</span></span><span> </span><span class="annot"><span class="annottext">forall a. Monoid a =&gt; [a] -&gt; a
</span><span class="hs-identifier hs-var">mconcat</span></span><span> </span><span class="annot"><span class="annottext">forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span> </span><span class="annot"><span class="annottext">forall (t :: * -&gt; *) (m :: * -&gt; *) a b.
(Traversable t, Monad m) =&gt;
t a -&gt; (a -&gt; m b) -&gt; m (t b)
</span><span class="hs-identifier hs-var">forM</span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">UnboundEntityDef -&gt; [UnboundFieldDef]
</span><a href="Database.Persist.Quasi.Internal.html#getUnboundFieldDefs"><span class="hs-identifier hs-var">getUnboundFieldDefs</span></a></span><span> </span><span class="annot"><span class="annottext">UnboundEntityDef
</span><a href="#local-6989586621679964379"><span class="hs-identifier hs-var">ent</span></a></span><span> </span><span class="annot"><span class="annottext">forall a b. [a] -&gt; [b] -&gt; [(a, b)]
</span><span class="hs-operator hs-var">`zip`</span></span><span> </span><span class="annot"><span class="annottext">[Name]
</span><a href="#local-6989586621679964378"><span class="hs-identifier hs-var">fieldNames</span></a></span><span class="hs-special">)</span><span> </span><span class="annot"><span class="annottext">forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span> </span><span class="hs-glyph">\</span><span class="hs-special">(</span><span id="local-6989586621679964377"><span class="annot"><span class="annottext">UnboundFieldDef
</span><a href="#local-6989586621679964377"><span class="hs-identifier hs-var">field</span></a></span></span><span class="hs-special">,</span><span> </span><span id="local-6989586621679964376"><span class="annot"><span class="annottext">Name
</span><a href="#local-6989586621679964376"><span class="hs-identifier hs-var">fieldName</span></a></span></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-keyword">do</span><span>
</span><span id="line-2041"></span><span>    </span><span class="hs-keyword">let</span><span> </span><span id="local-6989586621679964375"><span class="annot"><span class="annottext">lensName :: Name
</span><a href="#local-6989586621679964375"><span class="hs-identifier hs-var hs-var">lensName</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">MkPersistSettings -&gt; UnboundEntityDef -&gt; UnboundFieldDef -&gt; Name
</span><a href="Database.Persist.TH.html#mkEntityLensName"><span class="hs-identifier hs-var">mkEntityLensName</span></a></span><span> </span><span class="annot"><span class="annottext">MkPersistSettings
</span><a href="#local-6989586621679964381"><span class="hs-identifier hs-var">mps</span></a></span><span> </span><span class="annot"><span class="annottext">UnboundEntityDef
</span><a href="#local-6989586621679964379"><span class="hs-identifier hs-var">ent</span></a></span><span> </span><span class="annot"><span class="annottext">UnboundFieldDef
</span><a href="#local-6989586621679964377"><span class="hs-identifier hs-var">field</span></a></span><span>
</span><span id="line-2042"></span><span>    </span><span id="local-6989586621679964373"><span class="annot"><span class="annottext">Name
</span><a href="#local-6989586621679964373"><span class="hs-identifier hs-var">needleN</span></a></span></span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">forall (m :: * -&gt; *). Quote m =&gt; String -&gt; m Name
</span><span class="hs-identifier hs-var">newName</span></span><span> </span><span class="annot"><span class="annottext">String
</span><span class="hs-string">&quot;needle&quot;</span></span><span>
</span><span id="line-2043"></span><span>    </span><span id="local-6989586621679964372"><span class="annot"><span class="annottext">Name
</span><a href="#local-6989586621679964372"><span class="hs-identifier hs-var">setterN</span></a></span></span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">forall (m :: * -&gt; *). Quote m =&gt; String -&gt; m Name
</span><span class="hs-identifier hs-var">newName</span></span><span> </span><span class="annot"><span class="annottext">String
</span><span class="hs-string">&quot;setter&quot;</span></span><span>
</span><span id="line-2044"></span><span>    </span><span id="local-6989586621679964371"><span class="annot"><span class="annottext">Name
</span><a href="#local-6989586621679964371"><span class="hs-identifier hs-var">fN</span></a></span></span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">forall (m :: * -&gt; *). Quote m =&gt; String -&gt; m Name
</span><span class="hs-identifier hs-var">newName</span></span><span> </span><span class="annot"><span class="annottext">String
</span><span class="hs-string">&quot;f&quot;</span></span><span>
</span><span id="line-2045"></span><span>    </span><span id="local-6989586621679964370"><span class="annot"><span class="annottext">Name
</span><a href="#local-6989586621679964370"><span class="hs-identifier hs-var">aN</span></a></span></span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">forall (m :: * -&gt; *). Quote m =&gt; String -&gt; m Name
</span><span class="hs-identifier hs-var">newName</span></span><span> </span><span class="annot"><span class="annottext">String
</span><span class="hs-string">&quot;a&quot;</span></span><span>
</span><span id="line-2046"></span><span>    </span><span id="local-6989586621679964369"><span class="annot"><span class="annottext">Name
</span><a href="#local-6989586621679964369"><span class="hs-identifier hs-var">yN</span></a></span></span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">forall (m :: * -&gt; *). Quote m =&gt; String -&gt; m Name
</span><span class="hs-identifier hs-var">newName</span></span><span> </span><span class="annot"><span class="annottext">String
</span><span class="hs-string">&quot;y&quot;</span></span><span>
</span><span id="line-2047"></span><span>    </span><span class="hs-keyword">let</span><span> </span><span id="local-6989586621679964368"><span class="annot"><span class="annottext">needle :: Exp
</span><a href="#local-6989586621679964368"><span class="hs-identifier hs-var hs-var">needle</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">Name -&gt; Exp
</span><span class="hs-identifier hs-var">VarE</span></span><span> </span><span class="annot"><span class="annottext">Name
</span><a href="#local-6989586621679964373"><span class="hs-identifier hs-var">needleN</span></a></span><span>
</span><span id="line-2048"></span><span>        </span><span id="local-6989586621679964367"><span class="annot"><span class="annottext">setter :: Exp
</span><a href="#local-6989586621679964367"><span class="hs-identifier hs-var hs-var">setter</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">Name -&gt; Exp
</span><span class="hs-identifier hs-var">VarE</span></span><span> </span><span class="annot"><span class="annottext">Name
</span><a href="#local-6989586621679964372"><span class="hs-identifier hs-var">setterN</span></a></span><span>
</span><span id="line-2049"></span><span>        </span><span id="local-6989586621679964366"><span class="annot"><span class="annottext">f :: Exp
</span><a href="#local-6989586621679964366"><span class="hs-identifier hs-var hs-var">f</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">Name -&gt; Exp
</span><span class="hs-identifier hs-var">VarE</span></span><span> </span><span class="annot"><span class="annottext">Name
</span><a href="#local-6989586621679964371"><span class="hs-identifier hs-var">fN</span></a></span><span>
</span><span id="line-2050"></span><span>        </span><span id="local-6989586621679964365"><span class="annot"><span class="annottext">a :: Exp
</span><a href="#local-6989586621679964365"><span class="hs-identifier hs-var hs-var">a</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">Name -&gt; Exp
</span><span class="hs-identifier hs-var">VarE</span></span><span> </span><span class="annot"><span class="annottext">Name
</span><a href="#local-6989586621679964370"><span class="hs-identifier hs-var">aN</span></a></span><span>
</span><span id="line-2051"></span><span>        </span><span id="local-6989586621679964364"><span class="annot"><span class="annottext">y :: Exp
</span><a href="#local-6989586621679964364"><span class="hs-identifier hs-var hs-var">y</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">Name -&gt; Exp
</span><span class="hs-identifier hs-var">VarE</span></span><span> </span><span class="annot"><span class="annottext">Name
</span><a href="#local-6989586621679964369"><span class="hs-identifier hs-var">yN</span></a></span><span>
</span><span id="line-2052"></span><span>        </span><span id="local-6989586621679964363"><span class="annot"><span class="annottext">fT :: Name
</span><a href="#local-6989586621679964363"><span class="hs-identifier hs-var hs-var">fT</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">String -&gt; Name
</span><span class="hs-identifier hs-var">mkName</span></span><span> </span><span class="annot"><span class="annottext">String
</span><span class="hs-string">&quot;f&quot;</span></span><span>
</span><span id="line-2053"></span><span>        </span><span class="hs-comment">-- FIXME if we want to get really fancy, then: if this field is the</span><span>
</span><span id="line-2054"></span><span>        </span><span class="hs-comment">-- *only* Id field present, then set backend1 and backend2 to different</span><span>
</span><span id="line-2055"></span><span>        </span><span class="hs-comment">-- values</span><span>
</span><span id="line-2056"></span><span>        </span><span id="local-6989586621679964362"><span class="annot"><span class="annottext">backend1 :: Name
</span><a href="#local-6989586621679964362"><span class="hs-identifier hs-var hs-var">backend1</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">Name
</span><a href="Database.Persist.TH.html#backendName"><span class="hs-identifier hs-var">backendName</span></a></span><span>
</span><span id="line-2057"></span><span>        </span><span id="local-6989586621679964361"><span class="annot"><span class="annottext">backend2 :: Name
</span><a href="#local-6989586621679964361"><span class="hs-identifier hs-var hs-var">backend2</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">Name
</span><a href="Database.Persist.TH.html#backendName"><span class="hs-identifier hs-var">backendName</span></a></span><span>
</span><span id="line-2058"></span><span>        </span><span id="local-6989586621679964360"><span class="annot"><span class="annottext">aT :: Type
</span><a href="#local-6989586621679964360"><span class="hs-identifier hs-var hs-var">aT</span></a></span></span><span> </span><span class="hs-glyph">=</span><span>
</span><span id="line-2059"></span><span>            </span><span class="annot"><span class="annottext">MkPersistSettings
-&gt; EntityMap
-&gt; UnboundFieldDef
-&gt; Maybe Name
-&gt; Maybe IsNullable
-&gt; Type
</span><a href="Database.Persist.TH.html#maybeIdType"><span class="hs-identifier hs-var">maybeIdType</span></a></span><span> </span><span class="annot"><span class="annottext">MkPersistSettings
</span><a href="#local-6989586621679964381"><span class="hs-identifier hs-var">mps</span></a></span><span> </span><span class="annot"><span class="annottext">EntityMap
</span><a href="#local-6989586621679964380"><span class="hs-identifier hs-var">entityMap</span></a></span><span> </span><span class="annot"><span class="annottext">UnboundFieldDef
</span><a href="#local-6989586621679964377"><span class="hs-identifier hs-var">field</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">forall a. a -&gt; Maybe a
</span><span class="hs-identifier hs-var">Just</span></span><span> </span><span class="annot"><span class="annottext">Name
</span><a href="#local-6989586621679964362"><span class="hs-identifier hs-var">backend1</span></a></span><span class="hs-special">)</span><span> </span><span class="annot"><span class="annottext">forall a. Maybe a
</span><span class="hs-identifier hs-var">Nothing</span></span><span>
</span><span id="line-2060"></span><span>        </span><span id="local-6989586621679964359"><span class="annot"><span class="annottext">bT :: Type
</span><a href="#local-6989586621679964359"><span class="hs-identifier hs-var hs-var">bT</span></a></span></span><span> </span><span class="hs-glyph">=</span><span>
</span><span id="line-2061"></span><span>            </span><span class="annot"><span class="annottext">MkPersistSettings
-&gt; EntityMap
-&gt; UnboundFieldDef
-&gt; Maybe Name
-&gt; Maybe IsNullable
-&gt; Type
</span><a href="Database.Persist.TH.html#maybeIdType"><span class="hs-identifier hs-var">maybeIdType</span></a></span><span> </span><span class="annot"><span class="annottext">MkPersistSettings
</span><a href="#local-6989586621679964381"><span class="hs-identifier hs-var">mps</span></a></span><span> </span><span class="annot"><span class="annottext">EntityMap
</span><a href="#local-6989586621679964380"><span class="hs-identifier hs-var">entityMap</span></a></span><span> </span><span class="annot"><span class="annottext">UnboundFieldDef
</span><a href="#local-6989586621679964377"><span class="hs-identifier hs-var">field</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">forall a. a -&gt; Maybe a
</span><span class="hs-identifier hs-var">Just</span></span><span> </span><span class="annot"><span class="annottext">Name
</span><a href="#local-6989586621679964361"><span class="hs-identifier hs-var">backend2</span></a></span><span class="hs-special">)</span><span> </span><span class="annot"><span class="annottext">forall a. Maybe a
</span><span class="hs-identifier hs-var">Nothing</span></span><span>
</span><span id="line-2062"></span><span>        </span><span id="local-6989586621679964358"><span class="annot"><span class="annottext">mkST :: Name -&gt; Type
</span><a href="#local-6989586621679964358"><span class="hs-identifier hs-var hs-var">mkST</span></a></span></span><span> </span><span id="local-6989586621679964357"><span class="annot"><span class="annottext">Name
</span><a href="#local-6989586621679964357"><span class="hs-identifier hs-var">backend</span></a></span></span><span> </span><span class="hs-glyph">=</span><span>
</span><span id="line-2063"></span><span>            </span><span class="annot"><span class="annottext">MkPersistSettings -&gt; EntityNameHS -&gt; Type -&gt; Type
</span><a href="Database.Persist.TH.html#genericDataType"><span class="hs-identifier hs-var">genericDataType</span></a></span><span> </span><span class="annot"><span class="annottext">MkPersistSettings
</span><a href="#local-6989586621679964381"><span class="hs-identifier hs-var">mps</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">UnboundEntityDef -&gt; EntityNameHS
</span><a href="Database.Persist.Quasi.Internal.html#getUnboundEntityNameHS"><span class="hs-identifier hs-var">getUnboundEntityNameHS</span></a></span><span> </span><span class="annot"><span class="annottext">UnboundEntityDef
</span><a href="#local-6989586621679964379"><span class="hs-identifier hs-var">ent</span></a></span><span class="hs-special">)</span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Name -&gt; Type
</span><span class="hs-identifier hs-var">VarT</span></span><span> </span><span class="annot"><span class="annottext">Name
</span><a href="#local-6989586621679964357"><span class="hs-identifier hs-var">backend</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-2064"></span><span>        </span><span id="local-6989586621679964356"><span class="annot"><span class="annottext">sT :: Type
</span><a href="#local-6989586621679964356"><span class="hs-identifier hs-var hs-var">sT</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">Name -&gt; Type
</span><a href="#local-6989586621679964358"><span class="hs-identifier hs-var">mkST</span></a></span><span> </span><span class="annot"><span class="annottext">Name
</span><a href="#local-6989586621679964362"><span class="hs-identifier hs-var">backend1</span></a></span><span>
</span><span id="line-2065"></span><span>        </span><span id="local-6989586621679964355"><span class="annot"><span class="annottext">tT :: Type
</span><a href="#local-6989586621679964355"><span class="hs-identifier hs-var hs-var">tT</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">Name -&gt; Type
</span><a href="#local-6989586621679964358"><span class="hs-identifier hs-var">mkST</span></a></span><span> </span><span class="annot"><span class="annottext">Name
</span><a href="#local-6989586621679964361"><span class="hs-identifier hs-var">backend2</span></a></span><span>
</span><span id="line-2066"></span><span>        </span><span id="local-6989586621679964354"><span class="annot"><span class="annottext">Type
</span><a href="#local-6989586621679964354"><span class="hs-identifier hs-var">t1</span></a></span></span><span> </span><span id="local-6989586621679964353"><span class="annot"><span class="annottext">arrow :: Type -&gt; Type -&gt; Type
</span><a href="#local-6989586621679964353"><span class="hs-operator hs-var hs-var">`arrow`</span></a></span></span><span> </span><span id="local-6989586621679964352"><span class="annot"><span class="annottext">Type
</span><a href="#local-6989586621679964352"><span class="hs-identifier hs-var">t2</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">Type
</span><span class="hs-identifier hs-var">ArrowT</span></span><span> </span><span class="annot"><span class="annottext">Type -&gt; Type -&gt; Type
</span><span class="hs-operator hs-var">`AppT`</span></span><span> </span><span class="annot"><span class="annottext">Type
</span><a href="#local-6989586621679964354"><span class="hs-identifier hs-var">t1</span></a></span><span> </span><span class="annot"><span class="annottext">Type -&gt; Type -&gt; Type
</span><span class="hs-operator hs-var">`AppT`</span></span><span> </span><span class="annot"><span class="annottext">Type
</span><a href="#local-6989586621679964352"><span class="hs-identifier hs-var">t2</span></a></span><span>
</span><span id="line-2067"></span><span>        </span><span id="local-6989586621679964350"><span class="annot"><span class="annottext">vars :: [TyVarBndr Specificity]
</span><a href="#local-6989586621679964350"><span class="hs-identifier hs-var hs-var">vars</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">Name -&gt; TyVarBndr Specificity
</span><a href="Database.Persist.TH.html#mkForallTV"><span class="hs-identifier hs-var">mkForallTV</span></a></span><span> </span><span class="annot"><span class="annottext">Name
</span><a href="#local-6989586621679964363"><span class="hs-identifier hs-var">fT</span></a></span><span>
</span><span id="line-2068"></span><span>             </span><span class="annot"><span class="annottext">forall a. a -&gt; [a] -&gt; [a]
</span><span class="hs-glyph hs-var">:</span></span><span> </span><span class="hs-special">(</span><span class="hs-keyword">if</span><span> </span><span class="annot"><span class="annottext">MkPersistSettings -&gt; Bool
</span><a href="Database.Persist.TH.html#mpsGeneric"><span class="hs-identifier hs-var">mpsGeneric</span></a></span><span> </span><span class="annot"><span class="annottext">MkPersistSettings
</span><a href="#local-6989586621679964381"><span class="hs-identifier hs-var">mps</span></a></span><span> </span><span class="hs-keyword">then</span><span> </span><span class="hs-special">[</span><span class="annot"><span class="annottext">Name -&gt; TyVarBndr Specificity
</span><a href="Database.Persist.TH.html#mkForallTV"><span class="hs-identifier hs-var">mkForallTV</span></a></span><span> </span><span class="annot"><span class="annottext">Name
</span><a href="#local-6989586621679964362"><span class="hs-identifier hs-var">backend1</span></a></span><span class="hs-comment">{-, PlainTV backend2-}</span><span class="hs-special">]</span><span> </span><span class="hs-keyword">else</span><span> </span><span class="hs-special">[</span><span class="hs-special">]</span><span class="hs-special">)</span><span>
</span><span id="line-2069"></span><span>    </span><span class="annot"><span class="annottext">forall (m :: * -&gt; *) a. Monad m =&gt; a -&gt; m a
</span><span class="hs-identifier hs-var">return</span></span><span>
</span><span id="line-2070"></span><span>        </span><span class="hs-special">[</span><span> </span><span class="annot"><span class="annottext">Name -&gt; Type -&gt; Dec
</span><span class="hs-identifier hs-var">SigD</span></span><span> </span><span class="annot"><span class="annottext">Name
</span><a href="#local-6989586621679964375"><span class="hs-identifier hs-var">lensName</span></a></span><span> </span><span class="annot"><span class="annottext">forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span> </span><span class="annot"><span class="annottext">[TyVarBndr Specificity] -&gt; [Type] -&gt; Type -&gt; Type
</span><span class="hs-identifier hs-var">ForallT</span></span><span> </span><span class="annot"><span class="annottext">[TyVarBndr Specificity]
</span><a href="#local-6989586621679964350"><span class="hs-identifier hs-var">vars</span></a></span><span> </span><span class="hs-special">[</span><span class="annot"><span class="annottext">Name -&gt; [Type] -&gt; Type
</span><a href="Database.Persist.TH.html#mkClassP"><span class="hs-identifier hs-var">mkClassP</span></a></span><span> </span><span class="hs-special">''</span><span class="hs-identifier">Functor</span><span> </span><span class="hs-special">[</span><span class="annot"><span class="annottext">Name -&gt; Type
</span><span class="hs-identifier hs-var">VarT</span></span><span> </span><span class="annot"><span class="annottext">Name
</span><a href="#local-6989586621679964363"><span class="hs-identifier hs-var">fT</span></a></span><span class="hs-special">]</span><span class="hs-special">]</span><span> </span><span class="annot"><span class="annottext">forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span>
</span><span id="line-2071"></span><span>            </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Type
</span><a href="#local-6989586621679964360"><span class="hs-identifier hs-var">aT</span></a></span><span> </span><span class="annot"><span class="annottext">Type -&gt; Type -&gt; Type
</span><a href="#local-6989586621679964353"><span class="hs-operator hs-var">`arrow`</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Name -&gt; Type
</span><span class="hs-identifier hs-var">VarT</span></span><span> </span><span class="annot"><span class="annottext">Name
</span><a href="#local-6989586621679964363"><span class="hs-identifier hs-var">fT</span></a></span><span> </span><span class="annot"><span class="annottext">Type -&gt; Type -&gt; Type
</span><span class="hs-operator hs-var">`AppT`</span></span><span> </span><span class="annot"><span class="annottext">Type
</span><a href="#local-6989586621679964359"><span class="hs-identifier hs-var">bT</span></a></span><span class="hs-special">)</span><span class="hs-special">)</span><span> </span><span class="annot"><span class="annottext">Type -&gt; Type -&gt; Type
</span><a href="#local-6989586621679964353"><span class="hs-operator hs-var">`arrow`</span></a></span><span>
</span><span id="line-2072"></span><span>            </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Type
</span><a href="#local-6989586621679964356"><span class="hs-identifier hs-var">sT</span></a></span><span> </span><span class="annot"><span class="annottext">Type -&gt; Type -&gt; Type
</span><a href="#local-6989586621679964353"><span class="hs-operator hs-var">`arrow`</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Name -&gt; Type
</span><span class="hs-identifier hs-var">VarT</span></span><span> </span><span class="annot"><span class="annottext">Name
</span><a href="#local-6989586621679964363"><span class="hs-identifier hs-var">fT</span></a></span><span> </span><span class="annot"><span class="annottext">Type -&gt; Type -&gt; Type
</span><span class="hs-operator hs-var">`AppT`</span></span><span> </span><span class="annot"><span class="annottext">Type
</span><a href="#local-6989586621679964355"><span class="hs-identifier hs-var">tT</span></a></span><span class="hs-special">)</span><span class="hs-special">)</span><span>
</span><span id="line-2073"></span><span>        </span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">Name -&gt; [Clause] -&gt; Dec
</span><span class="hs-identifier hs-var">FunD</span></span><span> </span><span class="annot"><span class="annottext">Name
</span><a href="#local-6989586621679964375"><span class="hs-identifier hs-var">lensName</span></a></span><span> </span><span class="annot"><span class="annottext">forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span> </span><span class="annot"><span class="annottext">forall (m :: * -&gt; *) a. Monad m =&gt; a -&gt; m a
</span><span class="hs-identifier hs-var">return</span></span><span> </span><span class="annot"><span class="annottext">forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span> </span><span class="annot"><span class="annottext">[Pat] -&gt; Body -&gt; [Dec] -&gt; Clause
</span><span class="hs-identifier hs-var">Clause</span></span><span>
</span><span id="line-2074"></span><span>            </span><span class="hs-special">[</span><span class="annot"><span class="annottext">Name -&gt; Pat
</span><span class="hs-identifier hs-var">VarP</span></span><span> </span><span class="annot"><span class="annottext">Name
</span><a href="#local-6989586621679964371"><span class="hs-identifier hs-var">fN</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">Name -&gt; Pat
</span><span class="hs-identifier hs-var">VarP</span></span><span> </span><span class="annot"><span class="annottext">Name
</span><a href="#local-6989586621679964370"><span class="hs-identifier hs-var">aN</span></a></span><span class="hs-special">]</span><span>
</span><span id="line-2075"></span><span>            </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Exp -&gt; Body
</span><span class="hs-identifier hs-var">NormalB</span></span><span> </span><span class="annot"><span class="annottext">forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span> </span><span class="annot"><span class="annottext">Exp
</span><a href="Database.Persist.TH.html#fmapE"><span class="hs-identifier hs-var">fmapE</span></a></span><span>
</span><span id="line-2076"></span><span>                </span><span class="annot"><span class="annottext">Exp -&gt; Exp -&gt; Exp
</span><span class="hs-operator hs-var">`AppE`</span></span><span> </span><span class="annot"><span class="annottext">Exp
</span><a href="#local-6989586621679964367"><span class="hs-identifier hs-var">setter</span></a></span><span>
</span><span id="line-2077"></span><span>                </span><span class="annot"><span class="annottext">Exp -&gt; Exp -&gt; Exp
</span><span class="hs-operator hs-var">`AppE`</span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Exp
</span><a href="#local-6989586621679964366"><span class="hs-identifier hs-var">f</span></a></span><span> </span><span class="annot"><span class="annottext">Exp -&gt; Exp -&gt; Exp
</span><span class="hs-operator hs-var">`AppE`</span></span><span> </span><span class="annot"><span class="annottext">Exp
</span><a href="#local-6989586621679964368"><span class="hs-identifier hs-var">needle</span></a></span><span class="hs-special">)</span><span class="hs-special">)</span><span>
</span><span id="line-2078"></span><span>            </span><span class="hs-special">[</span><span> </span><span class="annot"><span class="annottext">Name -&gt; [Clause] -&gt; Dec
</span><span class="hs-identifier hs-var">FunD</span></span><span> </span><span class="annot"><span class="annottext">Name
</span><a href="#local-6989586621679964373"><span class="hs-identifier hs-var">needleN</span></a></span><span> </span><span class="hs-special">[</span><span class="annot"><span class="annottext">[Pat] -&gt; Exp -&gt; Clause
</span><a href="Database.Persist.TH.html#normalClause"><span class="hs-identifier hs-var">normalClause</span></a></span><span> </span><span class="hs-special">[</span><span class="hs-special">]</span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Name -&gt; Name -&gt; Exp
</span><a href="Database.Persist.TH.html#fieldSel"><span class="hs-identifier hs-var">fieldSel</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">UnboundEntityDef -&gt; Name
</span><a href="Database.Persist.TH.html#mkEntityDefName"><span class="hs-identifier hs-var">mkEntityDefName</span></a></span><span> </span><span class="annot"><span class="annottext">UnboundEntityDef
</span><a href="#local-6989586621679964379"><span class="hs-identifier hs-var">ent</span></a></span><span class="hs-special">)</span><span> </span><span class="annot"><span class="annottext">Name
</span><a href="#local-6989586621679964376"><span class="hs-identifier hs-var">fieldName</span></a></span><span> </span><span class="annot"><span class="annottext">Exp -&gt; Exp -&gt; Exp
</span><span class="hs-operator hs-var">`AppE`</span></span><span> </span><span class="annot"><span class="annottext">Exp
</span><a href="#local-6989586621679964365"><span class="hs-identifier hs-var">a</span></a></span><span class="hs-special">)</span><span class="hs-special">]</span><span>
</span><span id="line-2079"></span><span>            </span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">Name -&gt; [Clause] -&gt; Dec
</span><span class="hs-identifier hs-var">FunD</span></span><span> </span><span class="annot"><span class="annottext">Name
</span><a href="#local-6989586621679964372"><span class="hs-identifier hs-var">setterN</span></a></span><span> </span><span class="annot"><span class="annottext">forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span> </span><span class="annot"><span class="annottext">forall (m :: * -&gt; *) a. Monad m =&gt; a -&gt; m a
</span><span class="hs-identifier hs-var">return</span></span><span> </span><span class="annot"><span class="annottext">forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span> </span><span class="annot"><span class="annottext">[Pat] -&gt; Exp -&gt; Clause
</span><a href="Database.Persist.TH.html#normalClause"><span class="hs-identifier hs-var">normalClause</span></a></span><span>
</span><span id="line-2080"></span><span>                </span><span class="hs-special">[</span><span class="annot"><span class="annottext">Name -&gt; Pat
</span><span class="hs-identifier hs-var">VarP</span></span><span> </span><span class="annot"><span class="annottext">Name
</span><a href="#local-6989586621679964369"><span class="hs-identifier hs-var">yN</span></a></span><span class="hs-special">]</span><span>
</span><span id="line-2081"></span><span>                </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Name -&gt; [Name] -&gt; Exp -&gt; Name -&gt; Exp -&gt; Exp
</span><a href="Database.Persist.TH.html#fieldUpd"><span class="hs-identifier hs-var">fieldUpd</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">UnboundEntityDef -&gt; Name
</span><a href="Database.Persist.TH.html#mkEntityDefName"><span class="hs-identifier hs-var">mkEntityDefName</span></a></span><span> </span><span class="annot"><span class="annottext">UnboundEntityDef
</span><a href="#local-6989586621679964379"><span class="hs-identifier hs-var">ent</span></a></span><span class="hs-special">)</span><span> </span><span class="annot"><span class="annottext">[Name]
</span><a href="#local-6989586621679964378"><span class="hs-identifier hs-var">fieldNames</span></a></span><span> </span><span class="annot"><span class="annottext">Exp
</span><a href="#local-6989586621679964365"><span class="hs-identifier hs-var">a</span></a></span><span> </span><span class="annot"><span class="annottext">Name
</span><a href="#local-6989586621679964376"><span class="hs-identifier hs-var">fieldName</span></a></span><span> </span><span class="annot"><span class="annottext">Exp
</span><a href="#local-6989586621679964364"><span class="hs-identifier hs-var">y</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-2082"></span><span>            </span><span class="hs-special">]</span><span>
</span><span id="line-2083"></span><span>        </span><span class="hs-special">]</span><span>
</span><span id="line-2084"></span><span>    </span><span class="hs-keyword">where</span><span>
</span><span id="line-2085"></span><span>        </span><span id="local-6989586621679964378"><span class="annot"><span class="annottext">fieldNames :: [Name]
</span><a href="#local-6989586621679964378"><span class="hs-identifier hs-var hs-var">fieldNames</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">MkPersistSettings -&gt; UnboundEntityDef -&gt; UnboundFieldDef -&gt; Name
</span><a href="Database.Persist.TH.html#fieldDefToRecordName"><span class="hs-identifier hs-var">fieldDefToRecordName</span></a></span><span> </span><span class="annot"><span class="annottext">MkPersistSettings
</span><a href="#local-6989586621679964381"><span class="hs-identifier hs-var">mps</span></a></span><span> </span><span class="annot"><span class="annottext">UnboundEntityDef
</span><a href="#local-6989586621679964379"><span class="hs-identifier hs-var">ent</span></a></span><span> </span><span class="annot"><span class="annottext">forall (f :: * -&gt; *) a b. Functor f =&gt; (a -&gt; b) -&gt; f a -&gt; f b
</span><span class="hs-operator hs-var">&lt;$&gt;</span></span><span> </span><span class="annot"><span class="annottext">UnboundEntityDef -&gt; [UnboundFieldDef]
</span><a href="Database.Persist.Quasi.Internal.html#getUnboundFieldDefs"><span class="hs-identifier hs-var">getUnboundFieldDefs</span></a></span><span> </span><span class="annot"><span class="annottext">UnboundEntityDef
</span><a href="#local-6989586621679964379"><span class="hs-identifier hs-var">ent</span></a></span><span class="hs-cpp">

#if MIN_VERSION_template_haskell(2,17,0)
</span><span class="annot"><a href="Database.Persist.TH.html#mkPlainTV"><span class="hs-identifier hs-type">mkPlainTV</span></a></span><span>
</span><span id="line-2089"></span><span>    </span><span class="hs-glyph">::</span><span> </span><span class="annot"><span class="hs-identifier hs-type">Name</span></span><span>
</span><span id="line-2090"></span><span>    </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="hs-identifier hs-type">TyVarBndr</span></span><span> </span><span class="hs-special">(</span><span class="hs-special">)</span><span>
</span><span id="line-2091"></span><span id="mkPlainTV"><span class="annot"><span class="annottext">mkPlainTV :: Name -&gt; TyVarBndr ()
</span><a href="Database.Persist.TH.html#mkPlainTV"><span class="hs-identifier hs-var hs-var">mkPlainTV</span></a></span></span><span> </span><span id="local-6989586621679964346"><span class="annot"><span class="annottext">Name
</span><a href="#local-6989586621679964346"><span class="hs-identifier hs-var">n</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">forall flag. Name -&gt; flag -&gt; TyVarBndr flag
</span><span class="hs-identifier hs-var">PlainTV</span></span><span> </span><span class="annot"><span class="annottext">Name
</span><a href="#local-6989586621679964346"><span class="hs-identifier hs-var">n</span></a></span><span> </span><span class="hs-special">(</span><span class="hs-special">)</span><span>
</span><span id="line-2092"></span><span>
</span><span id="line-2093"></span><span class="annot"><a href="Database.Persist.TH.html#mkDoE"><span class="hs-identifier hs-type">mkDoE</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="hs-special">[</span><span class="annot"><span class="hs-identifier hs-type">Stmt</span></span><span class="hs-special">]</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="hs-identifier hs-type">Exp</span></span><span>
</span><span id="line-2094"></span><span id="mkDoE"><span class="annot"><span class="annottext">mkDoE :: [Stmt] -&gt; Exp
</span><a href="Database.Persist.TH.html#mkDoE"><span class="hs-identifier hs-var hs-var">mkDoE</span></a></span></span><span> </span><span id="local-6989586621679964343"><span class="annot"><span class="annottext">[Stmt]
</span><a href="#local-6989586621679964343"><span class="hs-identifier hs-var">stmts</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">Maybe ModName -&gt; [Stmt] -&gt; Exp
</span><span class="hs-identifier hs-var">DoE</span></span><span> </span><span class="annot"><span class="annottext">forall a. Maybe a
</span><span class="hs-identifier hs-var">Nothing</span></span><span> </span><span class="annot"><span class="annottext">[Stmt]
</span><a href="#local-6989586621679964343"><span class="hs-identifier hs-var">stmts</span></a></span><span>
</span><span id="line-2095"></span><span>
</span><span id="line-2096"></span><span class="annot"><a href="Database.Persist.TH.html#mkForallTV"><span class="hs-identifier hs-type">mkForallTV</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><span class="hs-identifier hs-type">Name</span></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="hs-identifier hs-type">TyVarBndr</span></span><span> </span><span class="annot"><span class="hs-identifier hs-type">Specificity</span></span><span>
</span><span id="line-2097"></span><span id="mkForallTV"><span class="annot"><span class="annottext">mkForallTV :: Name -&gt; TyVarBndr Specificity
</span><a href="Database.Persist.TH.html#mkForallTV"><span class="hs-identifier hs-var hs-var">mkForallTV</span></a></span></span><span> </span><span id="local-6989586621679964341"><span class="annot"><span class="annottext">Name
</span><a href="#local-6989586621679964341"><span class="hs-identifier hs-var">n</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">forall flag. Name -&gt; flag -&gt; TyVarBndr flag
</span><span class="hs-identifier hs-var">PlainTV</span></span><span> </span><span class="annot"><span class="annottext">Name
</span><a href="#local-6989586621679964341"><span class="hs-identifier hs-var">n</span></a></span><span> </span><span class="annot"><span class="annottext">Specificity
</span><span class="hs-identifier hs-var">SpecifiedSpec</span></span><span class="hs-cpp">
#else
</span><span>
</span><span id="line-2100"></span><span class="hs-identifier">mkDoE</span><span> </span><span class="hs-glyph">::</span><span> </span><span class="hs-special">[</span><span class="hs-identifier">Stmt</span><span class="hs-special">]</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-identifier">Exp</span><span>
</span><span id="line-2101"></span><span class="hs-identifier">mkDoE</span><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-identifier">DoE</span><span>
</span><span id="line-2102"></span><span>
</span><span id="line-2103"></span><span class="hs-identifier">mkPlainTV</span><span>
</span><span id="line-2104"></span><span>    </span><span class="hs-glyph">::</span><span> </span><span class="hs-identifier">Name</span><span>
</span><span id="line-2105"></span><span>    </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-identifier">TyVarBndr</span><span>
</span><span id="line-2106"></span><span class="hs-identifier">mkPlainTV</span><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-identifier">PlainTV</span><span>
</span><span id="line-2107"></span><span>
</span><span id="line-2108"></span><span class="hs-identifier">mkForallTV</span><span>
</span><span id="line-2109"></span><span>    </span><span class="hs-glyph">::</span><span> </span><span class="hs-identifier">Name</span><span>
</span><span id="line-2110"></span><span>    </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-identifier">TyVarBndr</span><span>
</span><span id="line-2111"></span><span class="hs-identifier">mkForallTV</span><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-identifier">mkPlainTV</span><span class="hs-cpp">
#endif
</span><span>
</span><span id="line-2114"></span><span class="annot"><a href="Database.Persist.TH.html#mkForeignKeysComposite"><span class="hs-identifier hs-type">mkForeignKeysComposite</span></a></span><span>
</span><span id="line-2115"></span><span>    </span><span class="hs-glyph">::</span><span> </span><span class="annot"><a href="Database.Persist.TH.html#MkPersistSettings"><span class="hs-identifier hs-type">MkPersistSettings</span></a></span><span>
</span><span id="line-2116"></span><span>    </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="Database.Persist.Quasi.Internal.html#UnboundEntityDef"><span class="hs-identifier hs-type">UnboundEntityDef</span></a></span><span>
</span><span id="line-2117"></span><span>    </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="Database.Persist.Quasi.Internal.html#UnboundForeignDef"><span class="hs-identifier hs-type">UnboundForeignDef</span></a></span><span>
</span><span id="line-2118"></span><span>    </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="hs-identifier hs-type">Q</span></span><span> </span><span class="hs-special">[</span><span class="annot"><span class="hs-identifier hs-type">Dec</span></span><span class="hs-special">]</span><span>
</span><span id="line-2119"></span><span id="mkForeignKeysComposite"><span class="annot"><span class="annottext">mkForeignKeysComposite :: MkPersistSettings
-&gt; UnboundEntityDef -&gt; UnboundForeignDef -&gt; Q [Dec]
</span><a href="Database.Persist.TH.html#mkForeignKeysComposite"><span class="hs-identifier hs-var hs-var">mkForeignKeysComposite</span></a></span></span><span> </span><span id="local-6989586621679964339"><span class="annot"><span class="annottext">MkPersistSettings
</span><a href="#local-6989586621679964339"><span class="hs-identifier hs-var">mps</span></a></span></span><span> </span><span id="local-6989586621679964338"><span class="annot"><span class="annottext">UnboundEntityDef
</span><a href="#local-6989586621679964338"><span class="hs-identifier hs-var">entDef</span></a></span></span><span> </span><span id="local-6989586621679964337"><span class="annot"><span class="annottext">UnboundForeignDef
</span><a href="#local-6989586621679964337"><span class="hs-identifier hs-var">foreignDef</span></a></span></span><span>
</span><span id="line-2120"></span><span>    </span><span class="hs-glyph">|</span><span> </span><span class="annot"><span class="annottext">ForeignDef -&gt; Bool
</span><a href="Database.Persist.Types.Base.html#foreignToPrimary"><span class="hs-identifier hs-var">foreignToPrimary</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">UnboundForeignDef -&gt; ForeignDef
</span><a href="Database.Persist.Quasi.Internal.html#unboundForeignDef"><span class="hs-identifier hs-var">unboundForeignDef</span></a></span><span> </span><span class="annot"><span class="annottext">UnboundForeignDef
</span><a href="#local-6989586621679964337"><span class="hs-identifier hs-var">foreignDef</span></a></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-keyword">do</span><span>
</span><span id="line-2121"></span><span>        </span><span class="hs-keyword">let</span><span>
</span><span id="line-2122"></span><span>            </span><span id="local-6989586621679964335"><span class="annot"><span class="annottext">fieldName :: FieldNameHS -&gt; Name
</span><a href="#local-6989586621679964335"><span class="hs-identifier hs-var hs-var">fieldName</span></a></span></span><span> </span><span class="hs-glyph">=</span><span>
</span><span id="line-2123"></span><span>                </span><span class="annot"><span class="annottext">MkPersistSettings -&gt; UnboundEntityDef -&gt; FieldNameHS -&gt; Name
</span><a href="Database.Persist.TH.html#fieldNameToRecordName"><span class="hs-identifier hs-var">fieldNameToRecordName</span></a></span><span> </span><span class="annot"><span class="annottext">MkPersistSettings
</span><a href="#local-6989586621679964339"><span class="hs-identifier hs-var">mps</span></a></span><span> </span><span class="annot"><span class="annottext">UnboundEntityDef
</span><a href="#local-6989586621679964338"><span class="hs-identifier hs-var">entDef</span></a></span><span>
</span><span id="line-2124"></span><span>            </span><span id="local-6989586621679964334"><span class="annot"><span class="annottext">fname :: Name
</span><a href="#local-6989586621679964334"><span class="hs-identifier hs-var hs-var">fname</span></a></span></span><span> </span><span class="hs-glyph">=</span><span>
</span><span id="line-2125"></span><span>                </span><span class="annot"><span class="annottext">FieldNameHS -&gt; Name
</span><a href="#local-6989586621679964335"><span class="hs-identifier hs-var">fieldName</span></a></span><span> </span><span class="annot"><span class="annottext">forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span> </span><span class="annot"><span class="annottext">ConstraintNameHS -&gt; FieldNameHS
</span><a href="#local-6989586621679964333"><span class="hs-identifier hs-var">constraintToField</span></a></span><span> </span><span class="annot"><span class="annottext">forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span> </span><span class="annot"><span class="annottext">ForeignDef -&gt; ConstraintNameHS
</span><a href="Database.Persist.Types.Base.html#foreignConstraintNameHaskell"><span class="hs-identifier hs-var">foreignConstraintNameHaskell</span></a></span><span> </span><span class="annot"><span class="annottext">forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span> </span><span class="annot"><span class="annottext">UnboundForeignDef -&gt; ForeignDef
</span><a href="Database.Persist.Quasi.Internal.html#unboundForeignDef"><span class="hs-identifier hs-var">unboundForeignDef</span></a></span><span> </span><span class="annot"><span class="annottext">UnboundForeignDef
</span><a href="#local-6989586621679964337"><span class="hs-identifier hs-var">foreignDef</span></a></span><span>
</span><span id="line-2126"></span><span>            </span><span id="local-6989586621679964331"><span class="annot"><span class="annottext">reftableString :: String
</span><a href="#local-6989586621679964331"><span class="hs-identifier hs-var hs-var">reftableString</span></a></span></span><span> </span><span class="hs-glyph">=</span><span>
</span><span id="line-2127"></span><span>                </span><span class="annot"><span class="annottext">Text -&gt; String
</span><span class="hs-identifier hs-var">unpack</span></span><span> </span><span class="annot"><span class="annottext">forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span> </span><span class="annot"><span class="annottext">EntityNameHS -&gt; Text
</span><a href="Database.Persist.Names.html#unEntityNameHS"><span class="hs-identifier hs-var">unEntityNameHS</span></a></span><span> </span><span class="annot"><span class="annottext">forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span> </span><span class="annot"><span class="annottext">ForeignDef -&gt; EntityNameHS
</span><a href="Database.Persist.Types.Base.html#foreignRefTableHaskell"><span class="hs-identifier hs-var">foreignRefTableHaskell</span></a></span><span> </span><span class="annot"><span class="annottext">forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span> </span><span class="annot"><span class="annottext">UnboundForeignDef -&gt; ForeignDef
</span><a href="Database.Persist.Quasi.Internal.html#unboundForeignDef"><span class="hs-identifier hs-var">unboundForeignDef</span></a></span><span> </span><span class="annot"><span class="annottext">UnboundForeignDef
</span><a href="#local-6989586621679964337"><span class="hs-identifier hs-var">foreignDef</span></a></span><span>
</span><span id="line-2128"></span><span>            </span><span id="local-6989586621679964330"><span class="annot"><span class="annottext">reftableKeyName :: Name
</span><a href="#local-6989586621679964330"><span class="hs-identifier hs-var hs-var">reftableKeyName</span></a></span></span><span> </span><span class="hs-glyph">=</span><span>
</span><span id="line-2129"></span><span>                </span><span class="annot"><span class="annottext">String -&gt; Name
</span><span class="hs-identifier hs-var">mkName</span></span><span> </span><span class="annot"><span class="annottext">forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span> </span><span class="annot"><span class="annottext">String
</span><a href="#local-6989586621679964331"><span class="hs-identifier hs-var">reftableString</span></a></span><span> </span><span class="annot"><span class="annottext">forall m. Monoid m =&gt; m -&gt; m -&gt; m
</span><span class="hs-operator hs-var">`mappend`</span></span><span> </span><span class="annot"><span class="annottext">String
</span><span class="hs-string">&quot;Key&quot;</span></span><span>
</span><span id="line-2130"></span><span>            </span><span id="local-6989586621679964329"><span class="annot"><span class="annottext">tablename :: Name
</span><a href="#local-6989586621679964329"><span class="hs-identifier hs-var hs-var">tablename</span></a></span></span><span> </span><span class="hs-glyph">=</span><span>
</span><span id="line-2131"></span><span>                </span><span class="annot"><span class="annottext">UnboundEntityDef -&gt; Name
</span><a href="Database.Persist.TH.html#mkEntityDefName"><span class="hs-identifier hs-var">mkEntityDefName</span></a></span><span> </span><span class="annot"><span class="annottext">UnboundEntityDef
</span><a href="#local-6989586621679964338"><span class="hs-identifier hs-var">entDef</span></a></span><span>
</span><span id="line-2132"></span><span>            </span><span id="local-6989586621679964328"><span class="annot"><span class="annottext">fieldStore :: FieldStore
</span><a href="#local-6989586621679964328"><span class="hs-identifier hs-var hs-var">fieldStore</span></a></span></span><span> </span><span class="hs-glyph">=</span><span>
</span><span id="line-2133"></span><span>                </span><span class="annot"><span class="annottext">UnboundEntityDef -&gt; FieldStore
</span><a href="Database.Persist.TH.html#mkFieldStore"><span class="hs-identifier hs-var">mkFieldStore</span></a></span><span> </span><span class="annot"><span class="annottext">UnboundEntityDef
</span><a href="#local-6989586621679964338"><span class="hs-identifier hs-var">entDef</span></a></span><span>
</span><span id="line-2134"></span><span>
</span><span id="line-2135"></span><span>        </span><span id="local-6989586621679964327"><span class="annot"><span class="annottext">Name
</span><a href="#local-6989586621679964327"><span class="hs-identifier hs-var">recordName</span></a></span></span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">forall (m :: * -&gt; *). Quote m =&gt; String -&gt; m Name
</span><span class="hs-identifier hs-var">newName</span></span><span> </span><span class="annot"><span class="annottext">String
</span><span class="hs-string">&quot;record_mkForeignKeysComposite&quot;</span></span><span>
</span><span id="line-2136"></span><span>
</span><span id="line-2137"></span><span>        </span><span class="hs-keyword">let</span><span>
</span><span id="line-2138"></span><span>            </span><span id="local-6989586621679964326"><span class="annot"><span class="annottext">mkFldE :: FieldNameHS -&gt; Exp
</span><a href="#local-6989586621679964326"><span class="hs-identifier hs-var hs-var">mkFldE</span></a></span></span><span> </span><span id="local-6989586621679964325"><span class="annot"><span class="annottext">FieldNameHS
</span><a href="#local-6989586621679964325"><span class="hs-identifier hs-var">foreignName</span></a></span></span><span>  </span><span class="hs-glyph">=</span><span>
</span><span id="line-2139"></span><span>                </span><span class="hs-comment">-- using coerce here to convince SqlBackendKey to go away</span><span>
</span><span id="line-2140"></span><span>                </span><span class="annot"><span class="annottext">Name -&gt; Exp
</span><span class="hs-identifier hs-var">VarE</span></span><span> </span><span class="hs-special">'</span><span class="hs-identifier">coerce</span><span> </span><span class="annot"><span class="annottext">Exp -&gt; Exp -&gt; Exp
</span><span class="hs-operator hs-var">`AppE`</span></span><span>
</span><span id="line-2141"></span><span>                </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Name -&gt; Exp
</span><span class="hs-identifier hs-var">VarE</span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">FieldNameHS -&gt; Name
</span><a href="#local-6989586621679964335"><span class="hs-identifier hs-var">fieldName</span></a></span><span> </span><span class="annot"><span class="annottext">FieldNameHS
</span><a href="#local-6989586621679964325"><span class="hs-identifier hs-var">foreignName</span></a></span><span class="hs-special">)</span><span> </span><span class="annot"><span class="annottext">Exp -&gt; Exp -&gt; Exp
</span><span class="hs-operator hs-var">`AppE`</span></span><span> </span><span class="annot"><span class="annottext">Name -&gt; Exp
</span><span class="hs-identifier hs-var">VarE</span></span><span> </span><span class="annot"><span class="annottext">Name
</span><a href="#local-6989586621679964327"><span class="hs-identifier hs-var">recordName</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-2142"></span><span>            </span><span id="local-6989586621679964324"><span class="annot"><span class="annottext">mkFldR :: ForeignFieldReference -&gt; Exp
</span><a href="#local-6989586621679964324"><span class="hs-identifier hs-var hs-var">mkFldR</span></a></span></span><span> </span><span id="local-6989586621679964323"><span class="annot"><span class="annottext">ForeignFieldReference
</span><a href="#local-6989586621679964323"><span class="hs-identifier hs-var">ffr</span></a></span></span><span> </span><span class="hs-glyph">=</span><span>
</span><span id="line-2143"></span><span>                </span><span class="hs-keyword">let</span><span>
</span><span id="line-2144"></span><span>                    </span><span id="local-6989586621679964322"><span class="annot"><span class="annottext">e :: Exp
</span><a href="#local-6989586621679964322"><span class="hs-identifier hs-var hs-var">e</span></a></span></span><span> </span><span class="hs-glyph">=</span><span>
</span><span id="line-2145"></span><span>                        </span><span class="annot"><span class="annottext">FieldNameHS -&gt; Exp
</span><a href="#local-6989586621679964326"><span class="hs-identifier hs-var">mkFldE</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">ForeignFieldReference -&gt; FieldNameHS
</span><a href="Database.Persist.Quasi.Internal.html#ffrSourceField"><span class="hs-identifier hs-var">ffrSourceField</span></a></span><span> </span><span class="annot"><span class="annottext">ForeignFieldReference
</span><a href="#local-6989586621679964323"><span class="hs-identifier hs-var">ffr</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-2146"></span><span>                </span><span class="hs-keyword">in</span><span>
</span><span id="line-2147"></span><span>                    </span><span class="hs-keyword">case</span><span> </span><span class="annot"><span class="annottext">ForeignFieldReference -&gt; FieldNameHS
</span><a href="Database.Persist.Quasi.Internal.html#ffrTargetField"><span class="hs-identifier hs-var">ffrTargetField</span></a></span><span> </span><span class="annot"><span class="annottext">ForeignFieldReference
</span><a href="#local-6989586621679964323"><span class="hs-identifier hs-var">ffr</span></a></span><span> </span><span class="hs-keyword">of</span><span>
</span><span id="line-2148"></span><span>                        </span><span class="annot"><a href="Database.Persist.Names.html#FieldNameHS"><span class="hs-identifier hs-type">FieldNameHS</span></a></span><span> </span><span class="annot"><span class="annottext">Text
</span><span class="hs-string">&quot;Id&quot;</span></span><span> </span><span class="hs-glyph">-&gt;</span><span>
</span><span id="line-2149"></span><span>                            </span><span class="annot"><span class="annottext">Name -&gt; Exp
</span><span class="hs-identifier hs-var">VarE</span></span><span> </span><span class="hs-special">'</span><span class="hs-identifier">toBackendKey</span><span> </span><span class="annot"><span class="annottext">Exp -&gt; Exp -&gt; Exp
</span><span class="hs-operator hs-var">`AppE`</span></span><span>
</span><span id="line-2150"></span><span>                                </span><span class="annot"><span class="annottext">Exp
</span><a href="#local-6989586621679964322"><span class="hs-identifier hs-var">e</span></a></span><span>
</span><span id="line-2151"></span><span>                        </span><span class="annot"><span class="annottext">FieldNameHS
</span><span class="hs-identifier">_</span></span><span> </span><span class="hs-glyph">-&gt;</span><span>
</span><span id="line-2152"></span><span>                            </span><span class="annot"><span class="annottext">Exp
</span><a href="#local-6989586621679964322"><span class="hs-identifier hs-var">e</span></a></span><span>
</span><span id="line-2153"></span><span>            </span><span id="local-6989586621679964320"><span class="annot"><span class="annottext">foreignFieldNames :: UnboundForeignFieldList -&gt; NonEmpty FieldNameHS
</span><a href="#local-6989586621679964320"><span class="hs-identifier hs-var hs-var">foreignFieldNames</span></a></span></span><span> </span><span id="local-6989586621679964319"><span class="annot"><span class="annottext">UnboundForeignFieldList
</span><a href="#local-6989586621679964319"><span class="hs-identifier hs-var">foreignFieldList</span></a></span></span><span> </span><span class="hs-glyph">=</span><span>
</span><span id="line-2154"></span><span>                </span><span class="hs-keyword">case</span><span> </span><span class="annot"><span class="annottext">UnboundForeignFieldList
</span><a href="#local-6989586621679964319"><span class="hs-identifier hs-var">foreignFieldList</span></a></span><span> </span><span class="hs-keyword">of</span><span>
</span><span id="line-2155"></span><span>                    </span><span class="annot"><a href="Database.Persist.Quasi.Internal.html#FieldListImpliedId"><span class="hs-identifier hs-type">FieldListImpliedId</span></a></span><span> </span><span id="local-6989586621679964318"><span class="annot"><span class="annottext">NonEmpty FieldNameHS
</span><a href="#local-6989586621679964318"><span class="hs-identifier hs-var">names</span></a></span></span><span> </span><span class="hs-glyph">-&gt;</span><span>
</span><span id="line-2156"></span><span>                        </span><span class="annot"><span class="annottext">NonEmpty FieldNameHS
</span><a href="#local-6989586621679964318"><span class="hs-identifier hs-var">names</span></a></span><span>
</span><span id="line-2157"></span><span>                    </span><span class="annot"><a href="Database.Persist.Quasi.Internal.html#FieldListHasReferences"><span class="hs-identifier hs-type">FieldListHasReferences</span></a></span><span> </span><span id="local-6989586621679964317"><span class="annot"><span class="annottext">NonEmpty ForeignFieldReference
</span><a href="#local-6989586621679964317"><span class="hs-identifier hs-var">refs</span></a></span></span><span> </span><span class="hs-glyph">-&gt;</span><span>
</span><span id="line-2158"></span><span>                        </span><span class="annot"><span class="annottext">forall (f :: * -&gt; *) a b. Functor f =&gt; (a -&gt; b) -&gt; f a -&gt; f b
</span><span class="hs-identifier hs-var">fmap</span></span><span> </span><span class="annot"><span class="annottext">ForeignFieldReference -&gt; FieldNameHS
</span><a href="Database.Persist.Quasi.Internal.html#ffrSourceField"><span class="hs-identifier hs-var">ffrSourceField</span></a></span><span> </span><span class="annot"><span class="annottext">NonEmpty ForeignFieldReference
</span><a href="#local-6989586621679964317"><span class="hs-identifier hs-var">refs</span></a></span><span>
</span><span id="line-2159"></span><span>
</span><span id="line-2160"></span><span>            </span><span id="local-6989586621679964316"><span class="annot"><span class="annottext">fldsE :: NonEmpty Exp
</span><a href="#local-6989586621679964316"><span class="hs-identifier hs-var hs-var">fldsE</span></a></span></span><span> </span><span class="hs-glyph">=</span><span>
</span><span id="line-2161"></span><span>                </span><span class="annot"><span class="annottext">UnboundForeignFieldList -&gt; NonEmpty Exp
</span><a href="#local-6989586621679964315"><span class="hs-identifier hs-var">getForeignNames</span></a></span><span> </span><span class="annot"><span class="annottext">forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">UnboundForeignDef -&gt; UnboundForeignFieldList
</span><a href="Database.Persist.Quasi.Internal.html#unboundForeignFields"><span class="hs-identifier hs-var">unboundForeignFields</span></a></span><span> </span><span class="annot"><span class="annottext">UnboundForeignDef
</span><a href="#local-6989586621679964337"><span class="hs-identifier hs-var">foreignDef</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-2162"></span><span>            </span><span id="local-6989586621679964315"><span class="annot"><span class="annottext">getForeignNames :: UnboundForeignFieldList -&gt; NonEmpty Exp
</span><a href="#local-6989586621679964315"><span class="hs-identifier hs-var hs-var">getForeignNames</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-glyph">\</span><span class="hs-glyph">case</span><span>
</span><span id="line-2163"></span><span>                </span><span class="annot"><a href="Database.Persist.Quasi.Internal.html#FieldListImpliedId"><span class="hs-identifier hs-type">FieldListImpliedId</span></a></span><span> </span><span id="local-6989586621679964314"><span class="annot"><span class="annottext">NonEmpty FieldNameHS
</span><a href="#local-6989586621679964314"><span class="hs-identifier hs-var">xs</span></a></span></span><span> </span><span class="hs-glyph">-&gt;</span><span>
</span><span id="line-2164"></span><span>                   </span><span class="annot"><span class="annottext">forall (f :: * -&gt; *) a b. Functor f =&gt; (a -&gt; b) -&gt; f a -&gt; f b
</span><span class="hs-identifier hs-var">fmap</span></span><span> </span><span class="annot"><span class="annottext">FieldNameHS -&gt; Exp
</span><a href="#local-6989586621679964326"><span class="hs-identifier hs-var">mkFldE</span></a></span><span> </span><span class="annot"><span class="annottext">NonEmpty FieldNameHS
</span><a href="#local-6989586621679964314"><span class="hs-identifier hs-var">xs</span></a></span><span>
</span><span id="line-2165"></span><span>                </span><span class="annot"><a href="Database.Persist.Quasi.Internal.html#FieldListHasReferences"><span class="hs-identifier hs-type">FieldListHasReferences</span></a></span><span> </span><span id="local-6989586621679964313"><span class="annot"><span class="annottext">NonEmpty ForeignFieldReference
</span><a href="#local-6989586621679964313"><span class="hs-identifier hs-var">xs</span></a></span></span><span> </span><span class="hs-glyph">-&gt;</span><span>
</span><span id="line-2166"></span><span>                    </span><span class="annot"><span class="annottext">forall (f :: * -&gt; *) a b. Functor f =&gt; (a -&gt; b) -&gt; f a -&gt; f b
</span><span class="hs-identifier hs-var">fmap</span></span><span> </span><span class="annot"><span class="annottext">ForeignFieldReference -&gt; Exp
</span><a href="#local-6989586621679964324"><span class="hs-identifier hs-var">mkFldR</span></a></span><span> </span><span class="annot"><span class="annottext">NonEmpty ForeignFieldReference
</span><a href="#local-6989586621679964313"><span class="hs-identifier hs-var">xs</span></a></span><span>
</span><span id="line-2167"></span><span>
</span><span id="line-2168"></span><span>            </span><span id="local-6989586621679964305"><span class="annot"><span class="annottext">nullErr :: a -&gt; a
</span><a href="#local-6989586621679964305"><span class="hs-identifier hs-var hs-var">nullErr</span></a></span></span><span> </span><span id="local-6989586621679964304"><span class="annot"><span class="annottext">a
</span><a href="#local-6989586621679964304"><span class="hs-identifier hs-var">n</span></a></span></span><span> </span><span class="hs-glyph">=</span><span>
</span><span id="line-2169"></span><span>               </span><span class="annot"><span class="annottext">forall a. HasCallStack =&gt; String -&gt; a
</span><span class="hs-identifier hs-var">error</span></span><span> </span><span class="annot"><span class="annottext">forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span> </span><span class="annot"><span class="annottext">String
</span><span class="hs-string">&quot;Could not find field definition for: &quot;</span></span><span> </span><span class="annot"><span class="annottext">forall a. Semigroup a =&gt; a -&gt; a -&gt; a
</span><span class="hs-operator hs-var">&lt;&gt;</span></span><span> </span><span class="annot"><span class="annottext">forall a. Show a =&gt; a -&gt; String
</span><span class="hs-identifier hs-var">show</span></span><span> </span><span class="annot"><span class="annottext">a
</span><a href="#local-6989586621679964304"><span class="hs-identifier hs-var">n</span></a></span><span>
</span><span id="line-2170"></span><span>            </span><span id="local-6989586621679964303"><span class="annot"><span class="annottext">fNullable :: Bool
</span><a href="#local-6989586621679964303"><span class="hs-identifier hs-var hs-var">fNullable</span></a></span></span><span> </span><span class="hs-glyph">=</span><span>
</span><span id="line-2171"></span><span>                </span><span class="annot"><span class="annottext">NonEmpty UnboundFieldDef -&gt; Bool
</span><a href="Database.Persist.TH.html#setNull"><span class="hs-identifier hs-var">setNull</span></a></span><span>
</span><span id="line-2172"></span><span>                   </span><span class="annot"><span class="annottext">forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span> </span><span class="annot"><span class="annottext">forall (f :: * -&gt; *) a b. Functor f =&gt; (a -&gt; b) -&gt; f a -&gt; f b
</span><span class="hs-identifier hs-var">fmap</span></span><span> </span><span class="hs-special">(</span><span class="hs-glyph">\</span><span id="local-6989586621679964301"><span class="annot"><span class="annottext">FieldNameHS
</span><a href="#local-6989586621679964301"><span class="hs-identifier hs-var">n</span></a></span></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="annottext">forall a. a -&gt; Maybe a -&gt; a
</span><span class="hs-identifier hs-var">fromMaybe</span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">forall {a} {a}. Show a =&gt; a -&gt; a
</span><a href="#local-6989586621679964305"><span class="hs-identifier hs-var">nullErr</span></a></span><span> </span><span class="annot"><span class="annottext">FieldNameHS
</span><a href="#local-6989586621679964301"><span class="hs-identifier hs-var">n</span></a></span><span class="hs-special">)</span><span> </span><span class="annot"><span class="annottext">forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span> </span><span class="annot"><span class="annottext">FieldNameHS -&gt; FieldStore -&gt; Maybe UnboundFieldDef
</span><a href="Database.Persist.TH.html#getFieldDef"><span class="hs-identifier hs-var">getFieldDef</span></a></span><span> </span><span class="annot"><span class="annottext">FieldNameHS
</span><a href="#local-6989586621679964301"><span class="hs-identifier hs-var">n</span></a></span><span> </span><span class="annot"><span class="annottext">FieldStore
</span><a href="#local-6989586621679964328"><span class="hs-identifier hs-var">fieldStore</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-2173"></span><span>                   </span><span class="annot"><span class="annottext">forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span> </span><span class="annot"><span class="annottext">UnboundForeignFieldList -&gt; NonEmpty FieldNameHS
</span><a href="#local-6989586621679964320"><span class="hs-identifier hs-var">foreignFieldNames</span></a></span><span>
</span><span id="line-2174"></span><span>                   </span><span class="annot"><span class="annottext">forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span> </span><span class="annot"><span class="annottext">UnboundForeignDef -&gt; UnboundForeignFieldList
</span><a href="Database.Persist.Quasi.Internal.html#unboundForeignFields"><span class="hs-identifier hs-var">unboundForeignFields</span></a></span><span> </span><span class="annot"><span class="annottext">UnboundForeignDef
</span><a href="#local-6989586621679964337"><span class="hs-identifier hs-var">foreignDef</span></a></span><span>
</span><span id="line-2175"></span><span>            </span><span id="local-6989586621679964300"><span class="annot"><span class="annottext">mkKeyE :: Exp
</span><a href="#local-6989586621679964300"><span class="hs-identifier hs-var hs-var">mkKeyE</span></a></span></span><span> </span><span class="hs-glyph">=</span><span>
</span><span id="line-2176"></span><span>                </span><span class="annot"><span class="annottext">forall (t :: * -&gt; *) b a.
Foldable t =&gt;
(b -&gt; a -&gt; b) -&gt; b -&gt; t a -&gt; b
</span><span class="hs-identifier hs-var">foldl'</span></span><span> </span><span class="annot"><span class="annottext">Exp -&gt; Exp -&gt; Exp
</span><span class="hs-identifier hs-var">AppE</span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Bool -&gt; Exp -&gt; Exp
</span><a href="Database.Persist.TH.html#maybeExp"><span class="hs-identifier hs-var">maybeExp</span></a></span><span> </span><span class="annot"><span class="annottext">Bool
</span><a href="#local-6989586621679964303"><span class="hs-identifier hs-var">fNullable</span></a></span><span> </span><span class="annot"><span class="annottext">forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span> </span><span class="annot"><span class="annottext">Name -&gt; Exp
</span><span class="hs-identifier hs-var">ConE</span></span><span> </span><span class="annot"><span class="annottext">Name
</span><a href="#local-6989586621679964330"><span class="hs-identifier hs-var">reftableKeyName</span></a></span><span class="hs-special">)</span><span> </span><span class="annot"><span class="annottext">NonEmpty Exp
</span><a href="#local-6989586621679964316"><span class="hs-identifier hs-var">fldsE</span></a></span><span>
</span><span id="line-2177"></span><span>            </span><span id="local-6989586621679964298"><span class="annot"><span class="annottext">fn :: Dec
</span><a href="#local-6989586621679964298"><span class="hs-identifier hs-var hs-var">fn</span></a></span></span><span> </span><span class="hs-glyph">=</span><span>
</span><span id="line-2178"></span><span>                </span><span class="annot"><span class="annottext">Name -&gt; [Clause] -&gt; Dec
</span><span class="hs-identifier hs-var">FunD</span></span><span> </span><span class="annot"><span class="annottext">Name
</span><a href="#local-6989586621679964334"><span class="hs-identifier hs-var">fname</span></a></span><span> </span><span class="hs-special">[</span><span class="annot"><span class="annottext">[Pat] -&gt; Exp -&gt; Clause
</span><a href="Database.Persist.TH.html#normalClause"><span class="hs-identifier hs-var">normalClause</span></a></span><span> </span><span class="hs-special">[</span><span class="annot"><span class="annottext">Name -&gt; Pat
</span><span class="hs-identifier hs-var">VarP</span></span><span> </span><span class="annot"><span class="annottext">Name
</span><a href="#local-6989586621679964327"><span class="hs-identifier hs-var">recordName</span></a></span><span class="hs-special">]</span><span> </span><span class="annot"><span class="annottext">Exp
</span><a href="#local-6989586621679964300"><span class="hs-identifier hs-var">mkKeyE</span></a></span><span class="hs-special">]</span><span>
</span><span id="line-2179"></span><span>
</span><span id="line-2180"></span><span>            </span><span id="local-6989586621679964297"><span class="annot"><span class="annottext">keyTargetTable :: Type
</span><a href="#local-6989586621679964297"><span class="hs-identifier hs-var hs-var">keyTargetTable</span></a></span></span><span> </span><span class="hs-glyph">=</span><span>
</span><span id="line-2181"></span><span>                </span><span class="annot"><span class="annottext">Bool -&gt; Type -&gt; Type
</span><a href="Database.Persist.TH.html#maybeTyp"><span class="hs-identifier hs-var">maybeTyp</span></a></span><span> </span><span class="annot"><span class="annottext">Bool
</span><a href="#local-6989586621679964303"><span class="hs-identifier hs-var">fNullable</span></a></span><span> </span><span class="annot"><span class="annottext">forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span> </span><span class="annot"><span class="annottext">Name -&gt; Type
</span><span class="hs-identifier hs-var">ConT</span></span><span> </span><span class="hs-special">''</span><span class="hs-identifier">Key</span><span> </span><span class="annot"><span class="annottext">Type -&gt; Type -&gt; Type
</span><span class="hs-operator hs-var">`AppT`</span></span><span> </span><span class="annot"><span class="annottext">Name -&gt; Type
</span><span class="hs-identifier hs-var">ConT</span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">String -&gt; Name
</span><span class="hs-identifier hs-var">mkName</span></span><span> </span><span class="annot"><span class="annottext">String
</span><a href="#local-6989586621679964331"><span class="hs-identifier hs-var">reftableString</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-2182"></span><span>
</span><span id="line-2183"></span><span>        </span><span id="local-6989586621679964296"><span class="annot"><span class="annottext">Type
</span><a href="#local-6989586621679964296"><span class="hs-identifier hs-var">sigTy</span></a></span></span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="hs-special">[t|</span><span> </span><span class="hs-special">$</span><span class="hs-special">(</span><span class="hs-identifier">conT</span><span> </span><span class="hs-identifier">tablename</span><span class="hs-special">)</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-special">$</span><span class="hs-special">(</span><span class="hs-identifier">pure</span><span> </span><span class="hs-identifier">keyTargetTable</span><span class="hs-special">)</span><span> </span><span class="hs-special">|]</span><span>
</span><span id="line-2184"></span><span>        </span><span class="annot"><span class="annottext">forall (f :: * -&gt; *) a. Applicative f =&gt; a -&gt; f a
</span><span class="hs-identifier hs-var">pure</span></span><span>
</span><span id="line-2185"></span><span>            </span><span class="hs-special">[</span><span> </span><span class="annot"><span class="annottext">Name -&gt; Type -&gt; Dec
</span><span class="hs-identifier hs-var">SigD</span></span><span> </span><span class="annot"><span class="annottext">Name
</span><a href="#local-6989586621679964334"><span class="hs-identifier hs-var">fname</span></a></span><span> </span><span class="annot"><span class="annottext">Type
</span><a href="#local-6989586621679964296"><span class="hs-identifier hs-var">sigTy</span></a></span><span>
</span><span id="line-2186"></span><span>            </span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">Dec
</span><a href="#local-6989586621679964298"><span class="hs-identifier hs-var">fn</span></a></span><span>
</span><span id="line-2187"></span><span>            </span><span class="hs-special">]</span><span>
</span><span id="line-2188"></span><span>
</span><span id="line-2189"></span><span>    </span><span class="hs-glyph">|</span><span> </span><span class="annot"><span class="annottext">Bool
</span><span class="hs-identifier hs-var">otherwise</span></span><span> </span><span class="hs-glyph">=</span><span>
</span><span id="line-2190"></span><span>        </span><span class="annot"><span class="annottext">forall (f :: * -&gt; *) a. Applicative f =&gt; a -&gt; f a
</span><span class="hs-identifier hs-var">pure</span></span><span> </span><span class="hs-special">[</span><span class="hs-special">]</span><span>
</span><span id="line-2191"></span><span>  </span><span class="hs-keyword">where</span><span>
</span><span id="line-2192"></span><span>    </span><span id="local-6989586621679964333"><span class="annot"><span class="annottext">constraintToField :: ConstraintNameHS -&gt; FieldNameHS
</span><a href="#local-6989586621679964333"><span class="hs-identifier hs-var hs-var">constraintToField</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">Text -&gt; FieldNameHS
</span><a href="Database.Persist.Names.html#FieldNameHS"><span class="hs-identifier hs-var">FieldNameHS</span></a></span><span> </span><span class="annot"><span class="annottext">forall b c a. (b -&gt; c) -&gt; (a -&gt; b) -&gt; a -&gt; c
</span><span class="hs-operator hs-var">.</span></span><span> </span><span class="annot"><span class="annottext">ConstraintNameHS -&gt; Text
</span><a href="Database.Persist.Names.html#unConstraintNameHS"><span class="hs-identifier hs-var">unConstraintNameHS</span></a></span><span>
</span><span id="line-2193"></span><span>
</span><span id="line-2194"></span><span>
</span><span id="line-2195"></span><span class="annot"><a href="Database.Persist.TH.html#maybeExp"><span class="hs-identifier hs-type">maybeExp</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><span class="hs-identifier hs-type">Bool</span></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="hs-identifier hs-type">Exp</span></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="hs-identifier hs-type">Exp</span></span><span>
</span><span id="line-2196"></span><span id="maybeExp"><span class="annot"><span class="annottext">maybeExp :: Bool -&gt; Exp -&gt; Exp
</span><a href="Database.Persist.TH.html#maybeExp"><span class="hs-identifier hs-var hs-var">maybeExp</span></a></span></span><span> </span><span id="local-6989586621679964295"><span class="annot"><span class="annottext">Bool
</span><a href="#local-6989586621679964295"><span class="hs-identifier hs-var">may</span></a></span></span><span> </span><span id="local-6989586621679964294"><span class="annot"><span class="annottext">Exp
</span><a href="#local-6989586621679964294"><span class="hs-identifier hs-var">exp</span></a></span></span><span> </span><span class="hs-glyph">|</span><span> </span><span class="annot"><span class="annottext">Bool
</span><a href="#local-6989586621679964295"><span class="hs-identifier hs-var">may</span></a></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">Exp
</span><a href="Database.Persist.TH.html#fmapE"><span class="hs-identifier hs-var">fmapE</span></a></span><span> </span><span class="annot"><span class="annottext">Exp -&gt; Exp -&gt; Exp
</span><span class="hs-operator hs-var">`AppE`</span></span><span> </span><span class="annot"><span class="annottext">Exp
</span><a href="#local-6989586621679964294"><span class="hs-identifier hs-var">exp</span></a></span><span>
</span><span id="line-2197"></span><span>                 </span><span class="hs-glyph">|</span><span> </span><span class="annot"><span class="annottext">Bool
</span><span class="hs-identifier hs-var">otherwise</span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">Exp
</span><a href="#local-6989586621679964294"><span class="hs-identifier hs-var">exp</span></a></span><span>
</span><span id="line-2198"></span><span>
</span><span id="line-2199"></span><span class="annot"><a href="Database.Persist.TH.html#maybeTyp"><span class="hs-identifier hs-type">maybeTyp</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><span class="hs-identifier hs-type">Bool</span></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="hs-identifier hs-type">Type</span></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="hs-identifier hs-type">Type</span></span><span>
</span><span id="line-2200"></span><span id="maybeTyp"><span class="annot"><span class="annottext">maybeTyp :: Bool -&gt; Type -&gt; Type
</span><a href="Database.Persist.TH.html#maybeTyp"><span class="hs-identifier hs-var hs-var">maybeTyp</span></a></span></span><span> </span><span id="local-6989586621679964293"><span class="annot"><span class="annottext">Bool
</span><a href="#local-6989586621679964293"><span class="hs-identifier hs-var">may</span></a></span></span><span> </span><span id="local-6989586621679964292"><span class="annot"><span class="annottext">Type
</span><a href="#local-6989586621679964292"><span class="hs-identifier hs-var">typ</span></a></span></span><span> </span><span class="hs-glyph">|</span><span> </span><span class="annot"><span class="annottext">Bool
</span><a href="#local-6989586621679964293"><span class="hs-identifier hs-var">may</span></a></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">Name -&gt; Type
</span><span class="hs-identifier hs-var">ConT</span></span><span> </span><span class="hs-special">''</span><span class="hs-identifier">Maybe</span><span> </span><span class="annot"><span class="annottext">Type -&gt; Type -&gt; Type
</span><span class="hs-operator hs-var">`AppT`</span></span><span> </span><span class="annot"><span class="annottext">Type
</span><a href="#local-6989586621679964292"><span class="hs-identifier hs-var">typ</span></a></span><span>
</span><span id="line-2201"></span><span>                 </span><span class="hs-glyph">|</span><span> </span><span class="annot"><span class="annottext">Bool
</span><span class="hs-identifier hs-var">otherwise</span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">Type
</span><a href="#local-6989586621679964292"><span class="hs-identifier hs-var">typ</span></a></span><span>
</span><span id="line-2202"></span><span>
</span><span id="line-2203"></span><span id="local-6989586621679966414"><span class="annot"><a href="Database.Persist.TH.html#entityToPersistValueHelper"><span class="hs-identifier hs-type">entityToPersistValueHelper</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="hs-special">(</span><span class="annot"><a href="Database.Persist.Class.PersistEntity.html#PersistEntity"><span class="hs-identifier hs-type">PersistEntity</span></a></span><span> </span><span class="annot"><a href="#local-6989586621679966414"><span class="hs-identifier hs-type">record</span></a></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">=&gt;</span><span> </span><span class="annot"><a href="#local-6989586621679966414"><span class="hs-identifier hs-type">record</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="Database.Persist.PersistValue.html#PersistValue"><span class="hs-identifier hs-type">PersistValue</span></a></span></span><span>
</span><span id="line-2204"></span><span id="entityToPersistValueHelper"><span class="annot"><span class="annottext">entityToPersistValueHelper :: forall record. PersistEntity record =&gt; record -&gt; PersistValue
</span><a href="Database.Persist.TH.html#entityToPersistValueHelper"><span class="hs-identifier hs-var hs-var">entityToPersistValueHelper</span></a></span></span><span> </span><span id="local-6989586621679964283"><span class="annot"><span class="annottext">record
</span><a href="#local-6989586621679964283"><span class="hs-identifier hs-var">entity</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">[(Text, PersistValue)] -&gt; PersistValue
</span><a href="Database.Persist.PersistValue.html#PersistMap"><span class="hs-identifier hs-var">PersistMap</span></a></span><span> </span><span class="annot"><span class="annottext">forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span> </span><span class="annot"><span class="annottext">forall a b. [a] -&gt; [b] -&gt; [(a, b)]
</span><span class="hs-identifier hs-var">zip</span></span><span> </span><span class="annot"><span class="annottext">[Text]
</span><a href="#local-6989586621679964281"><span class="hs-identifier hs-var">columnNames</span></a></span><span> </span><span class="annot"><span class="annottext">[PersistValue]
</span><a href="#local-6989586621679964280"><span class="hs-identifier hs-var">fieldsAsPersistValues</span></a></span><span>
</span><span id="line-2205"></span><span>    </span><span class="hs-keyword">where</span><span>
</span><span id="line-2206"></span><span>        </span><span id="local-6989586621679964281"><span class="annot"><span class="annottext">columnNames :: [Text]
</span><a href="#local-6989586621679964281"><span class="hs-identifier hs-var hs-var">columnNames</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">forall (f :: * -&gt; *) a b. Functor f =&gt; (a -&gt; b) -&gt; f a -&gt; f b
</span><span class="hs-identifier hs-var">fmap</span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">FieldNameHS -&gt; Text
</span><a href="Database.Persist.Names.html#unFieldNameHS"><span class="hs-identifier hs-var">unFieldNameHS</span></a></span><span> </span><span class="annot"><span class="annottext">forall b c a. (b -&gt; c) -&gt; (a -&gt; b) -&gt; a -&gt; c
</span><span class="hs-operator hs-var">.</span></span><span> </span><span class="annot"><span class="annottext">FieldDef -&gt; FieldNameHS
</span><a href="Database.Persist.Types.Base.html#fieldHaskell"><span class="hs-identifier hs-var">fieldHaskell</span></a></span><span class="hs-special">)</span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">EntityDef -&gt; [FieldDef]
</span><a href="Database.Persist.EntityDef.html#getEntityFields"><span class="hs-identifier hs-var">getEntityFields</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">forall record (proxy :: * -&gt; *).
PersistEntity record =&gt;
proxy record -&gt; EntityDef
</span><a href="Database.Persist.Class.PersistEntity.html#entityDef"><span class="hs-identifier hs-var">entityDef</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">forall a. a -&gt; Maybe a
</span><span class="hs-identifier hs-var">Just</span></span><span> </span><span class="annot"><span class="annottext">record
</span><a href="#local-6989586621679964283"><span class="hs-identifier hs-var">entity</span></a></span><span class="hs-special">)</span><span class="hs-special">)</span><span class="hs-special">)</span><span>
</span><span id="line-2207"></span><span>        </span><span id="local-6989586621679964280"><span class="annot"><span class="annottext">fieldsAsPersistValues :: [PersistValue]
</span><a href="#local-6989586621679964280"><span class="hs-identifier hs-var hs-var">fieldsAsPersistValues</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">forall (f :: * -&gt; *) a b. Functor f =&gt; (a -&gt; b) -&gt; f a -&gt; f b
</span><span class="hs-identifier hs-var">fmap</span></span><span> </span><span class="annot"><span class="annottext">forall a. PersistField a =&gt; a -&gt; PersistValue
</span><a href="Database.Persist.Class.PersistField.html#toPersistValue"><span class="hs-identifier hs-var">toPersistValue</span></a></span><span> </span><span class="annot"><span class="annottext">forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span> </span><span class="annot"><span class="annottext">forall record. PersistEntity record =&gt; record -&gt; [SomePersistField]
</span><a href="Database.Persist.Class.PersistEntity.html#toPersistFields"><span class="hs-identifier hs-var">toPersistFields</span></a></span><span> </span><span class="annot"><span class="annottext">record
</span><a href="#local-6989586621679964283"><span class="hs-identifier hs-var">entity</span></a></span><span>
</span><span id="line-2208"></span><span>
</span><span id="line-2209"></span><span id="local-6989586621679966406"><span class="annot"><a href="Database.Persist.TH.html#entityFromPersistValueHelper"><span class="hs-identifier hs-type">entityFromPersistValueHelper</span></a></span><span>
</span><span id="line-2210"></span><span>    </span><span class="hs-glyph">::</span><span> </span><span class="hs-special">(</span><span class="annot"><a href="Database.Persist.Class.PersistEntity.html#PersistEntity"><span class="hs-identifier hs-type">PersistEntity</span></a></span><span> </span><span class="annot"><a href="#local-6989586621679966406"><span class="hs-identifier hs-type">record</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-2211"></span><span>    </span><span class="hs-glyph">=&gt;</span><span> </span><span class="hs-special">[</span><span class="annot"><span class="hs-identifier hs-type">String</span></span><span class="hs-special">]</span><span> </span><span class="hs-comment">-- ^ Column names, as '[String]' to avoid extra calls to &quot;pack&quot; in the generated code</span><span>
</span><span id="line-2212"></span><span>    </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="Database.Persist.PersistValue.html#PersistValue"><span class="hs-identifier hs-type">PersistValue</span></a></span><span>
</span><span id="line-2213"></span><span>    </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="hs-identifier hs-type">Either</span></span><span> </span><span class="annot"><span class="hs-identifier hs-type">Text</span></span><span> </span><span class="annot"><a href="#local-6989586621679966406"><span class="hs-identifier hs-type">record</span></a></span></span><span>
</span><span id="line-2214"></span><span id="entityFromPersistValueHelper"><span class="annot"><span class="annottext">entityFromPersistValueHelper :: forall record.
PersistEntity record =&gt;
[String] -&gt; PersistValue -&gt; Either Text record
</span><a href="Database.Persist.TH.html#entityFromPersistValueHelper"><span class="hs-identifier hs-var hs-var">entityFromPersistValueHelper</span></a></span></span><span> </span><span id="local-6989586621679964264"><span class="annot"><span class="annottext">[String]
</span><a href="#local-6989586621679964264"><span class="hs-identifier hs-var">columnNames</span></a></span></span><span> </span><span id="local-6989586621679964263"><span class="annot"><span class="annottext">PersistValue
</span><a href="#local-6989586621679964263"><span class="hs-identifier hs-var">pv</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-keyword">do</span><span>
</span><span id="line-2215"></span><span>    </span><span class="hs-special">(</span><span id="local-6989586621679964262"><span class="annot"><span class="annottext">[(Text, PersistValue)]
</span><a href="#local-6989586621679964262"><span class="hs-identifier hs-var">persistMap</span></a></span></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="hs-special">[</span><span class="hs-special">(</span><span class="annot"><span class="hs-identifier hs-type">T.Text</span></span><span class="hs-special">,</span><span> </span><span class="annot"><a href="Database.Persist.PersistValue.html#PersistValue"><span class="hs-identifier hs-type">PersistValue</span></a></span><span class="hs-special">)</span><span class="hs-special">]</span><span class="hs-special">)</span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">PersistValue -&gt; Either Text [(Text, PersistValue)]
</span><a href="Database.Persist.Class.PersistField.html#getPersistMap"><span class="hs-identifier hs-var">getPersistMap</span></a></span><span> </span><span class="annot"><span class="annottext">PersistValue
</span><a href="#local-6989586621679964263"><span class="hs-identifier hs-var">pv</span></a></span><span>
</span><span id="line-2216"></span><span>
</span><span id="line-2217"></span><span>    </span><span class="hs-keyword">let</span><span> </span><span id="local-6989586621679964260"><span class="annot"><span class="annottext">columnMap :: HashMap Text PersistValue
</span><a href="#local-6989586621679964260"><span class="hs-identifier hs-var hs-var">columnMap</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">forall k v. (Eq k, Hashable k) =&gt; [(k, v)] -&gt; HashMap k v
</span><span class="hs-identifier hs-var">HM.fromList</span></span><span> </span><span class="annot"><span class="annottext">[(Text, PersistValue)]
</span><a href="#local-6989586621679964262"><span class="hs-identifier hs-var">persistMap</span></a></span><span>
</span><span id="line-2218"></span><span>        </span><span class="annot"><a href="#local-6989586621679964258"><span class="hs-identifier hs-type">lookupPersistValueByColumnName</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><span class="hs-identifier hs-type">String</span></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="Database.Persist.PersistValue.html#PersistValue"><span class="hs-identifier hs-type">PersistValue</span></a></span><span>
</span><span id="line-2219"></span><span>        </span><span id="local-6989586621679964258"><span class="annot"><span class="annottext">lookupPersistValueByColumnName :: String -&gt; PersistValue
</span><a href="#local-6989586621679964258"><span class="hs-identifier hs-var hs-var">lookupPersistValueByColumnName</span></a></span></span><span> </span><span id="local-6989586621679964257"><span class="annot"><span class="annottext">String
</span><a href="#local-6989586621679964257"><span class="hs-identifier hs-var">columnName</span></a></span></span><span> </span><span class="hs-glyph">=</span><span>
</span><span id="line-2220"></span><span>            </span><span class="annot"><span class="annottext">forall a. a -&gt; Maybe a -&gt; a
</span><span class="hs-identifier hs-var">fromMaybe</span></span><span> </span><span class="annot"><span class="annottext">PersistValue
</span><a href="Database.Persist.PersistValue.html#PersistNull"><span class="hs-identifier hs-var">PersistNull</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">forall k v. (Eq k, Hashable k) =&gt; k -&gt; HashMap k v -&gt; Maybe v
</span><span class="hs-identifier hs-var">HM.lookup</span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">String -&gt; Text
</span><span class="hs-identifier hs-var">pack</span></span><span> </span><span class="annot"><span class="annottext">String
</span><a href="#local-6989586621679964257"><span class="hs-identifier hs-var">columnName</span></a></span><span class="hs-special">)</span><span> </span><span class="annot"><span class="annottext">HashMap Text PersistValue
</span><a href="#local-6989586621679964260"><span class="hs-identifier hs-var">columnMap</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-2221"></span><span>
</span><span id="line-2222"></span><span>    </span><span class="annot"><span class="annottext">forall record.
PersistEntity record =&gt;
[PersistValue] -&gt; Either Text record
</span><a href="Database.Persist.Class.PersistEntity.html#fromPersistValues"><span class="hs-identifier hs-var">fromPersistValues</span></a></span><span> </span><span class="annot"><span class="annottext">forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span> </span><span class="annot"><span class="annottext">forall (f :: * -&gt; *) a b. Functor f =&gt; (a -&gt; b) -&gt; f a -&gt; f b
</span><span class="hs-identifier hs-var">fmap</span></span><span> </span><span class="annot"><span class="annottext">String -&gt; PersistValue
</span><a href="#local-6989586621679964258"><span class="hs-identifier hs-var">lookupPersistValueByColumnName</span></a></span><span> </span><span class="annot"><span class="annottext">[String]
</span><a href="#local-6989586621679964264"><span class="hs-identifier hs-var">columnNames</span></a></span><span>
</span><span id="line-2223"></span><span>
</span><span id="line-2224"></span><span class="hs-comment">-- | Produce code similar to the following:</span><span>
</span><span id="line-2225"></span><span class="hs-comment">--</span><span>
</span><span id="line-2226"></span><span class="hs-comment">-- @</span><span>
</span><span id="line-2227"></span><span class="hs-comment">--   instance PersistEntity e =&gt; PersistField e where</span><span>
</span><span id="line-2228"></span><span class="hs-comment">--      toPersistValue = entityToPersistValueHelper</span><span>
</span><span id="line-2229"></span><span class="hs-comment">--      fromPersistValue = entityFromPersistValueHelper [&quot;col1&quot;, &quot;col2&quot;]</span><span>
</span><span id="line-2230"></span><span class="hs-comment">--      sqlType _ = SqlString</span><span>
</span><span id="line-2231"></span><span class="hs-comment">-- @</span><span>
</span><span id="line-2232"></span><span class="annot"><a href="Database.Persist.TH.html#persistFieldFromEntity"><span class="hs-identifier hs-type">persistFieldFromEntity</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><a href="Database.Persist.TH.html#MkPersistSettings"><span class="hs-identifier hs-type">MkPersistSettings</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="Database.Persist.Quasi.Internal.html#UnboundEntityDef"><span class="hs-identifier hs-type">UnboundEntityDef</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="hs-identifier hs-type">Q</span></span><span> </span><span class="hs-special">[</span><span class="annot"><span class="hs-identifier hs-type">Dec</span></span><span class="hs-special">]</span><span>
</span><span id="line-2233"></span><span id="persistFieldFromEntity"><span class="annot"><span class="annottext">persistFieldFromEntity :: MkPersistSettings -&gt; UnboundEntityDef -&gt; Q [Dec]
</span><a href="Database.Persist.TH.html#persistFieldFromEntity"><span class="hs-identifier hs-var hs-var">persistFieldFromEntity</span></a></span></span><span> </span><span id="local-6989586621679964254"><span class="annot"><span class="annottext">MkPersistSettings
</span><a href="#local-6989586621679964254"><span class="hs-identifier hs-var">mps</span></a></span></span><span> </span><span id="local-6989586621679964253"><span class="annot"><span class="annottext">UnboundEntityDef
</span><a href="#local-6989586621679964253"><span class="hs-identifier hs-var">entDef</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-keyword">do</span><span>
</span><span id="line-2234"></span><span>    </span><span id="local-6989586621679964252"><span class="annot"><span class="annottext">Exp
</span><a href="#local-6989586621679964252"><span class="hs-identifier hs-var">sqlStringConstructor'</span></a></span></span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="hs-special">[|</span><span class="hs-identifier">SqlString</span><span class="hs-special">|]</span><span>
</span><span id="line-2235"></span><span>    </span><span id="local-6989586621679964251"><span class="annot"><span class="annottext">Exp
</span><a href="#local-6989586621679964251"><span class="hs-identifier hs-var">toPersistValueImplementation</span></a></span></span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="hs-special">[|</span><span class="hs-identifier">entityToPersistValueHelper</span><span class="hs-special">|]</span><span>
</span><span id="line-2236"></span><span>    </span><span id="local-6989586621679964250"><span class="annot"><span class="annottext">Exp
</span><a href="#local-6989586621679964250"><span class="hs-identifier hs-var">fromPersistValueImplementation</span></a></span></span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="hs-special">[|</span><span class="hs-identifier">entityFromPersistValueHelper</span><span> </span><span class="hs-identifier">columnNames</span><span class="hs-special">|]</span><span>
</span><span id="line-2237"></span><span>
</span><span id="line-2238"></span><span>    </span><span class="annot"><span class="annottext">forall (m :: * -&gt; *) a. Monad m =&gt; a -&gt; m a
</span><span class="hs-identifier hs-var">return</span></span><span>
</span><span id="line-2239"></span><span>        </span><span class="hs-special">[</span><span> </span><span class="annot"><span class="annottext">Bool -&gt; Type -&gt; [Dec] -&gt; Dec
</span><a href="Database.Persist.TH.html#persistFieldInstanceD"><span class="hs-identifier hs-var">persistFieldInstanceD</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">MkPersistSettings -&gt; Bool
</span><a href="Database.Persist.TH.html#mpsGeneric"><span class="hs-identifier hs-var">mpsGeneric</span></a></span><span> </span><span class="annot"><span class="annottext">MkPersistSettings
</span><a href="#local-6989586621679964254"><span class="hs-identifier hs-var">mps</span></a></span><span class="hs-special">)</span><span> </span><span class="annot"><span class="annottext">Type
</span><a href="#local-6989586621679964248"><span class="hs-identifier hs-var">typ</span></a></span><span>
</span><span id="line-2240"></span><span>            </span><span class="hs-special">[</span><span> </span><span class="annot"><span class="annottext">Name -&gt; [Clause] -&gt; Dec
</span><span class="hs-identifier hs-var">FunD</span></span><span> </span><span class="hs-special">'</span><span class="hs-identifier">toPersistValue</span><span> </span><span class="hs-special">[</span><span> </span><span class="annot"><span class="annottext">[Pat] -&gt; Exp -&gt; Clause
</span><a href="Database.Persist.TH.html#normalClause"><span class="hs-identifier hs-var">normalClause</span></a></span><span> </span><span class="hs-special">[</span><span class="hs-special">]</span><span> </span><span class="annot"><span class="annottext">Exp
</span><a href="#local-6989586621679964251"><span class="hs-identifier hs-var">toPersistValueImplementation</span></a></span><span> </span><span class="hs-special">]</span><span>
</span><span id="line-2241"></span><span>            </span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">Name -&gt; [Clause] -&gt; Dec
</span><span class="hs-identifier hs-var">FunD</span></span><span> </span><span class="hs-special">'</span><span class="hs-identifier">fromPersistValue</span><span>
</span><span id="line-2242"></span><span>                </span><span class="hs-special">[</span><span> </span><span class="annot"><span class="annottext">[Pat] -&gt; Exp -&gt; Clause
</span><a href="Database.Persist.TH.html#normalClause"><span class="hs-identifier hs-var">normalClause</span></a></span><span> </span><span class="hs-special">[</span><span class="hs-special">]</span><span> </span><span class="annot"><span class="annottext">Exp
</span><a href="#local-6989586621679964250"><span class="hs-identifier hs-var">fromPersistValueImplementation</span></a></span><span> </span><span class="hs-special">]</span><span>
</span><span id="line-2243"></span><span>            </span><span class="hs-special">]</span><span>
</span><span id="line-2244"></span><span>        </span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">Bool -&gt; Type -&gt; [Dec] -&gt; Dec
</span><a href="Database.Persist.TH.html#persistFieldSqlInstanceD"><span class="hs-identifier hs-var">persistFieldSqlInstanceD</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">MkPersistSettings -&gt; Bool
</span><a href="Database.Persist.TH.html#mpsGeneric"><span class="hs-identifier hs-var">mpsGeneric</span></a></span><span> </span><span class="annot"><span class="annottext">MkPersistSettings
</span><a href="#local-6989586621679964254"><span class="hs-identifier hs-var">mps</span></a></span><span class="hs-special">)</span><span> </span><span class="annot"><span class="annottext">Type
</span><a href="#local-6989586621679964248"><span class="hs-identifier hs-var">typ</span></a></span><span>
</span><span id="line-2245"></span><span>            </span><span class="hs-special">[</span><span> </span><span class="annot"><span class="annottext">Exp -&gt; Dec
</span><a href="Database.Persist.TH.html#sqlTypeFunD"><span class="hs-identifier hs-var">sqlTypeFunD</span></a></span><span> </span><span class="annot"><span class="annottext">Exp
</span><a href="#local-6989586621679964252"><span class="hs-identifier hs-var">sqlStringConstructor'</span></a></span><span>
</span><span id="line-2246"></span><span>            </span><span class="hs-special">]</span><span>
</span><span id="line-2247"></span><span>        </span><span class="hs-special">]</span><span>
</span><span id="line-2248"></span><span>  </span><span class="hs-keyword">where</span><span>
</span><span id="line-2249"></span><span>    </span><span id="local-6989586621679964248"><span class="annot"><span class="annottext">typ :: Type
</span><a href="#local-6989586621679964248"><span class="hs-identifier hs-var hs-var">typ</span></a></span></span><span> </span><span class="hs-glyph">=</span><span>
</span><span id="line-2250"></span><span>        </span><span class="annot"><span class="annottext">MkPersistSettings -&gt; EntityNameHS -&gt; Type -&gt; Type
</span><a href="Database.Persist.TH.html#genericDataType"><span class="hs-identifier hs-var">genericDataType</span></a></span><span> </span><span class="annot"><span class="annottext">MkPersistSettings
</span><a href="#local-6989586621679964254"><span class="hs-identifier hs-var">mps</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">EntityDef -&gt; EntityNameHS
</span><a href="Database.Persist.Types.Base.html#entityHaskell"><span class="hs-identifier hs-var">entityHaskell</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">UnboundEntityDef -&gt; EntityDef
</span><a href="Database.Persist.Quasi.Internal.html#unboundEntityDef"><span class="hs-identifier hs-var">unboundEntityDef</span></a></span><span> </span><span class="annot"><span class="annottext">UnboundEntityDef
</span><a href="#local-6989586621679964253"><span class="hs-identifier hs-var">entDef</span></a></span><span class="hs-special">)</span><span class="hs-special">)</span><span> </span><span class="annot"><span class="annottext">Type
</span><a href="Database.Persist.TH.html#backendT"><span class="hs-identifier hs-var">backendT</span></a></span><span>
</span><span id="line-2251"></span><span>    </span><span id="local-6989586621679964245"><span class="annot"><span class="annottext">entFields :: [UnboundFieldDef]
</span><a href="#local-6989586621679964245"><span class="hs-identifier hs-var hs-var">entFields</span></a></span></span><span> </span><span class="hs-glyph">=</span><span>
</span><span id="line-2252"></span><span>        </span><span class="annot"><span class="annottext">forall a. (a -&gt; Bool) -&gt; [a] -&gt; [a]
</span><span class="hs-identifier hs-var">filter</span></span><span> </span><span class="annot"><span class="annottext">UnboundFieldDef -&gt; Bool
</span><a href="Database.Persist.Quasi.Internal.html#isHaskellUnboundField"><span class="hs-identifier hs-var">isHaskellUnboundField</span></a></span><span> </span><span class="annot"><span class="annottext">forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span> </span><span class="annot"><span class="annottext">UnboundEntityDef -&gt; [UnboundFieldDef]
</span><a href="Database.Persist.Quasi.Internal.html#getUnboundFieldDefs"><span class="hs-identifier hs-var">getUnboundFieldDefs</span></a></span><span> </span><span class="annot"><span class="annottext">UnboundEntityDef
</span><a href="#local-6989586621679964253"><span class="hs-identifier hs-var">entDef</span></a></span><span>
</span><span id="line-2253"></span><span>    </span><span id="local-6989586621679964244"><span class="annot"><span class="annottext">columnNames :: [String]
</span><a href="#local-6989586621679964244"><span class="hs-identifier hs-var hs-var">columnNames</span></a></span></span><span> </span><span class="hs-glyph">=</span><span>
</span><span id="line-2254"></span><span>        </span><span class="annot"><span class="annottext">forall (f :: * -&gt; *) a b. Functor f =&gt; (a -&gt; b) -&gt; f a -&gt; f b
</span><span class="hs-identifier hs-var">fmap</span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Text -&gt; String
</span><span class="hs-identifier hs-var">unpack</span></span><span> </span><span class="annot"><span class="annottext">forall b c a. (b -&gt; c) -&gt; (a -&gt; b) -&gt; a -&gt; c
</span><span class="hs-operator hs-var">.</span></span><span> </span><span class="annot"><span class="annottext">FieldNameHS -&gt; Text
</span><a href="Database.Persist.Names.html#unFieldNameHS"><span class="hs-identifier hs-var">unFieldNameHS</span></a></span><span> </span><span class="annot"><span class="annottext">forall b c a. (b -&gt; c) -&gt; (a -&gt; b) -&gt; a -&gt; c
</span><span class="hs-operator hs-var">.</span></span><span> </span><span class="annot"><span class="annottext">UnboundFieldDef -&gt; FieldNameHS
</span><a href="Database.Persist.Quasi.Internal.html#unboundFieldNameHS"><span class="hs-identifier hs-var">unboundFieldNameHS</span></a></span><span class="hs-special">)</span><span> </span><span class="annot"><span class="annottext">[UnboundFieldDef]
</span><a href="#local-6989586621679964245"><span class="hs-identifier hs-var">entFields</span></a></span><span>
</span><span id="line-2255"></span><span>
</span><span id="line-2256"></span><span class="hs-comment">-- | Apply the given list of functions to the same @EntityDef@s.</span><span>
</span><span id="line-2257"></span><span class="hs-comment">--</span><span>
</span><span id="line-2258"></span><span class="hs-comment">-- This function is useful for cases such as:</span><span>
</span><span id="line-2259"></span><span class="hs-comment">--</span><span>
</span><span id="line-2260"></span><span class="hs-comment">-- &gt;&gt;&gt; share [mkSave &quot;myDefs&quot;, mkPersist sqlSettings] [persistLowerCase|...|]</span><span>
</span><span id="line-2261"></span><span id="local-6989586621679966397"><span class="annot"><a href="Database.Persist.TH.html#share"><span class="hs-identifier hs-type">share</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="hs-special">[</span><span class="hs-special">[</span><span class="annot"><a href="#local-6989586621679966397"><span class="hs-identifier hs-type">a</span></a></span><span class="hs-special">]</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="hs-identifier hs-type">Q</span></span><span> </span><span class="hs-special">[</span><span class="annot"><span class="hs-identifier hs-type">Dec</span></span><span class="hs-special">]</span><span class="hs-special">]</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-special">[</span><span class="annot"><a href="#local-6989586621679966397"><span class="hs-identifier hs-type">a</span></a></span><span class="hs-special">]</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="hs-identifier hs-type">Q</span></span><span> </span><span class="hs-special">[</span><span class="annot"><span class="hs-identifier hs-type">Dec</span></span><span class="hs-special">]</span></span><span>
</span><span id="line-2262"></span><span id="share"><span class="annot"><span class="annottext">share :: forall a. [[a] -&gt; Q [Dec]] -&gt; [a] -&gt; Q [Dec]
</span><a href="Database.Persist.TH.html#share"><span class="hs-identifier hs-var hs-var">share</span></a></span></span><span> </span><span id="local-6989586621679964239"><span class="annot"><span class="annottext">[[a] -&gt; Q [Dec]]
</span><a href="#local-6989586621679964239"><span class="hs-identifier hs-var">fs</span></a></span></span><span> </span><span id="local-6989586621679964238"><span class="annot"><span class="annottext">[a]
</span><a href="#local-6989586621679964238"><span class="hs-identifier hs-var">x</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">forall a. Monoid a =&gt; [a] -&gt; a
</span><span class="hs-identifier hs-var">mconcat</span></span><span> </span><span class="annot"><span class="annottext">forall (f :: * -&gt; *) a b. Functor f =&gt; (a -&gt; b) -&gt; f a -&gt; f b
</span><span class="hs-operator hs-var">&lt;$&gt;</span></span><span> </span><span class="annot"><span class="annottext">forall (t :: * -&gt; *) (m :: * -&gt; *) a b.
(Traversable t, Monad m) =&gt;
(a -&gt; m b) -&gt; t a -&gt; m (t b)
</span><span class="hs-identifier hs-var">mapM</span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span> </span><span class="annot"><span class="annottext">[a]
</span><a href="#local-6989586621679964238"><span class="hs-identifier hs-var">x</span></a></span><span class="hs-special">)</span><span> </span><span class="annot"><span class="annottext">[[a] -&gt; Q [Dec]]
</span><a href="#local-6989586621679964239"><span class="hs-identifier hs-var">fs</span></a></span><span>
</span><span id="line-2263"></span><span>
</span><span id="line-2264"></span><span class="hs-comment">-- | Save the @EntityDef@s passed in under the given name.</span><span>
</span><span id="line-2265"></span><span class="hs-comment">--</span><span>
</span><span id="line-2266"></span><span class="hs-comment">-- This function was deprecated in @persistent-2.13.0.0@. It doesn't properly</span><span>
</span><span id="line-2267"></span><span class="hs-comment">-- fix foreign keys. Please refer to 'mkEntityDefList' for a replacement.</span><span>
</span><span id="line-2268"></span><span class="annot"><a href="Database.Persist.TH.html#mkSave"><span class="hs-identifier hs-type">mkSave</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><span class="hs-identifier hs-type">String</span></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-special">[</span><span class="annot"><a href="Database.Persist.Types.Base.html#EntityDef"><span class="hs-identifier hs-type">EntityDef</span></a></span><span class="hs-special">]</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="hs-identifier hs-type">Q</span></span><span> </span><span class="hs-special">[</span><span class="annot"><span class="hs-identifier hs-type">Dec</span></span><span class="hs-special">]</span><span>
</span><span id="line-2269"></span><span id="mkSave"><span class="annot"><span class="annottext">mkSave :: String -&gt; [EntityDef] -&gt; Q [Dec]
</span><a href="Database.Persist.TH.html#mkSave"><span class="hs-identifier hs-var hs-var">mkSave</span></a></span></span><span> </span><span id="local-6989586621679964237"><span class="annot"><span class="annottext">String
</span><a href="#local-6989586621679964237"><span class="hs-identifier hs-var">name'</span></a></span></span><span> </span><span id="local-6989586621679964236"><span class="annot"><span class="annottext">[EntityDef]
</span><a href="#local-6989586621679964236"><span class="hs-identifier hs-var">defs'</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-keyword">do</span><span>
</span><span id="line-2270"></span><span>    </span><span class="hs-keyword">let</span><span> </span><span id="local-6989586621679964235"><span class="annot"><span class="annottext">name :: Name
</span><a href="#local-6989586621679964235"><span class="hs-identifier hs-var hs-var">name</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">String -&gt; Name
</span><span class="hs-identifier hs-var">mkName</span></span><span> </span><span class="annot"><span class="annottext">String
</span><a href="#local-6989586621679964237"><span class="hs-identifier hs-var">name'</span></a></span><span>
</span><span id="line-2271"></span><span>    </span><span id="local-6989586621679964234"><span class="annot"><span class="annottext">Exp
</span><a href="#local-6989586621679964234"><span class="hs-identifier hs-var">defs</span></a></span></span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">forall t (m :: * -&gt; *). (Lift t, Quote m) =&gt; t -&gt; m Exp
</span><span class="hs-identifier hs-var">lift</span></span><span> </span><span class="annot"><span class="annottext">[EntityDef]
</span><a href="#local-6989586621679964236"><span class="hs-identifier hs-var">defs'</span></a></span><span>
</span><span id="line-2272"></span><span>    </span><span class="annot"><span class="annottext">forall (m :: * -&gt; *) a. Monad m =&gt; a -&gt; m a
</span><span class="hs-identifier hs-var">return</span></span><span> </span><span class="hs-special">[</span><span> </span><span class="annot"><span class="annottext">Name -&gt; Type -&gt; Dec
</span><span class="hs-identifier hs-var">SigD</span></span><span> </span><span class="annot"><span class="annottext">Name
</span><a href="#local-6989586621679964235"><span class="hs-identifier hs-var">name</span></a></span><span> </span><span class="annot"><span class="annottext">forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span> </span><span class="annot"><span class="annottext">Type
</span><span class="hs-identifier hs-var">ListT</span></span><span> </span><span class="annot"><span class="annottext">Type -&gt; Type -&gt; Type
</span><span class="hs-operator hs-var">`AppT`</span></span><span> </span><span class="annot"><span class="annottext">Name -&gt; Type
</span><span class="hs-identifier hs-var">ConT</span></span><span> </span><span class="hs-special">''</span><span class="hs-identifier">EntityDef</span><span>
</span><span id="line-2273"></span><span>           </span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">Name -&gt; [Clause] -&gt; Dec
</span><span class="hs-identifier hs-var">FunD</span></span><span> </span><span class="annot"><span class="annottext">Name
</span><a href="#local-6989586621679964235"><span class="hs-identifier hs-var">name</span></a></span><span> </span><span class="hs-special">[</span><span class="annot"><span class="annottext">[Pat] -&gt; Exp -&gt; Clause
</span><a href="Database.Persist.TH.html#normalClause"><span class="hs-identifier hs-var">normalClause</span></a></span><span> </span><span class="hs-special">[</span><span class="hs-special">]</span><span> </span><span class="annot"><span class="annottext">Exp
</span><a href="#local-6989586621679964234"><span class="hs-identifier hs-var">defs</span></a></span><span class="hs-special">]</span><span>
</span><span id="line-2274"></span><span>           </span><span class="hs-special">]</span><span>
</span><span id="line-2275"></span><span>
</span><span id="line-2276"></span><span class="hs-pragma">{-# DEPRECATED</span><span> </span><span class="hs-pragma">mkSave</span><span> </span><span class="hs-pragma">&quot;This function is broken. mkEntityDefList is a drop-in replacement that will properly handle foreign keys correctly.&quot;</span><span> </span><span class="hs-pragma">#-}</span><span>
</span><span id="line-2277"></span><span>
</span><span id="line-2278"></span><span class="hs-keyword">data</span><span> </span><span id="Dep"><span class="annot"><a href="Database.Persist.TH.html#Dep"><span class="hs-identifier hs-var">Dep</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span id="Dep"><span class="annot"><a href="Database.Persist.TH.html#Dep"><span class="hs-identifier hs-var">Dep</span></a></span></span><span>
</span><span id="line-2279"></span><span>    </span><span class="hs-special">{</span><span> </span><span id="depTarget"><span class="annot"><span class="annottext">Dep -&gt; EntityNameHS
</span><a href="Database.Persist.TH.html#depTarget"><span class="hs-identifier hs-var hs-var">depTarget</span></a></span></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><a href="Database.Persist.Names.html#EntityNameHS"><span class="hs-identifier hs-type">EntityNameHS</span></a></span><span>
</span><span id="line-2280"></span><span>    </span><span class="hs-special">,</span><span> </span><span id="depSourceTable"><span class="annot"><span class="annottext">Dep -&gt; EntityNameHS
</span><a href="Database.Persist.TH.html#depSourceTable"><span class="hs-identifier hs-var hs-var">depSourceTable</span></a></span></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><a href="Database.Persist.Names.html#EntityNameHS"><span class="hs-identifier hs-type">EntityNameHS</span></a></span><span>
</span><span id="line-2281"></span><span>    </span><span class="hs-special">,</span><span> </span><span id="depSourceField"><span class="annot"><span class="annottext">Dep -&gt; FieldNameHS
</span><a href="Database.Persist.TH.html#depSourceField"><span class="hs-identifier hs-var hs-var">depSourceField</span></a></span></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><a href="Database.Persist.Names.html#FieldNameHS"><span class="hs-identifier hs-type">FieldNameHS</span></a></span><span>
</span><span id="line-2282"></span><span>    </span><span class="hs-special">,</span><span> </span><span id="depSourceNull"><span class="annot"><span class="annottext">Dep -&gt; IsNullable
</span><a href="Database.Persist.TH.html#depSourceNull"><span class="hs-identifier hs-var hs-var">depSourceNull</span></a></span></span><span>  </span><span class="hs-glyph">::</span><span> </span><span class="annot"><a href="Database.Persist.Types.Base.html#IsNullable"><span class="hs-identifier hs-type">IsNullable</span></a></span><span>
</span><span id="line-2283"></span><span>    </span><span class="hs-special">}</span><span>
</span><span id="line-2284"></span><span>
</span><span id="line-2285"></span><span class="hs-pragma">{-# DEPRECATED</span><span> </span><span class="hs-pragma">mkDeleteCascade</span><span> </span><span class="hs-pragma">&quot;You can now set update and delete cascade behavior directly on the entity in the quasiquoter. This function and class are deprecated and will be removed in the next major ersion.&quot;</span><span> </span><span class="hs-pragma">#-}</span><span>
</span><span id="line-2286"></span><span>
</span><span id="line-2287"></span><span class="hs-comment">-- | Generate a 'DeleteCascade' instance for the given @EntityDef@s.</span><span>
</span><span id="line-2288"></span><span class="hs-comment">--</span><span>
</span><span id="line-2289"></span><span class="hs-comment">-- This function is deprecated as of 2.13.0.0. You can now set cascade</span><span>
</span><span id="line-2290"></span><span class="hs-comment">-- behavior directly in the quasiquoter.</span><span>
</span><span id="line-2291"></span><span class="annot"><a href="Database.Persist.TH.html#mkDeleteCascade"><span class="hs-identifier hs-type">mkDeleteCascade</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><a href="Database.Persist.TH.html#MkPersistSettings"><span class="hs-identifier hs-type">MkPersistSettings</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-special">[</span><span class="annot"><a href="Database.Persist.Quasi.Internal.html#UnboundEntityDef"><span class="hs-identifier hs-type">UnboundEntityDef</span></a></span><span class="hs-special">]</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="hs-identifier hs-type">Q</span></span><span> </span><span class="hs-special">[</span><span class="annot"><span class="hs-identifier hs-type">Dec</span></span><span class="hs-special">]</span><span>
</span><span id="line-2292"></span><span id="mkDeleteCascade"><span class="annot"><span class="annottext">mkDeleteCascade :: MkPersistSettings -&gt; [UnboundEntityDef] -&gt; Q [Dec]
</span><a href="Database.Persist.TH.html#mkDeleteCascade"><span class="hs-identifier hs-var hs-var">mkDeleteCascade</span></a></span></span><span> </span><span id="local-6989586621679964227"><span class="annot"><span class="annottext">MkPersistSettings
</span><a href="#local-6989586621679964227"><span class="hs-identifier hs-var">mps</span></a></span></span><span> </span><span id="local-6989586621679964226"><span class="annot"><span class="annottext">[UnboundEntityDef]
</span><a href="#local-6989586621679964226"><span class="hs-identifier hs-var">defs</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-keyword">do</span><span>
</span><span id="line-2293"></span><span>    </span><span class="hs-keyword">let</span><span> </span><span id="local-6989586621679964225"><span class="annot"><span class="annottext">deps :: [Dep]
</span><a href="#local-6989586621679964225"><span class="hs-identifier hs-var hs-var">deps</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">forall (t :: * -&gt; *) a b. Foldable t =&gt; (a -&gt; [b]) -&gt; t a -&gt; [b]
</span><span class="hs-identifier hs-var">concatMap</span></span><span> </span><span class="annot"><span class="annottext">UnboundEntityDef -&gt; [Dep]
</span><a href="#local-6989586621679964223"><span class="hs-identifier hs-var">getDeps</span></a></span><span> </span><span class="annot"><span class="annottext">[UnboundEntityDef]
</span><a href="#local-6989586621679964226"><span class="hs-identifier hs-var">defs</span></a></span><span>
</span><span id="line-2294"></span><span>    </span><span class="annot"><span class="annottext">forall (t :: * -&gt; *) (m :: * -&gt; *) a b.
(Traversable t, Monad m) =&gt;
(a -&gt; m b) -&gt; t a -&gt; m (t b)
</span><span class="hs-identifier hs-var">mapM</span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">[Dep] -&gt; UnboundEntityDef -&gt; Q Dec
</span><a href="#local-6989586621679964222"><span class="hs-identifier hs-var">go</span></a></span><span> </span><span class="annot"><span class="annottext">[Dep]
</span><a href="#local-6989586621679964225"><span class="hs-identifier hs-var">deps</span></a></span><span class="hs-special">)</span><span> </span><span class="annot"><span class="annottext">[UnboundEntityDef]
</span><a href="#local-6989586621679964226"><span class="hs-identifier hs-var">defs</span></a></span><span>
</span><span id="line-2295"></span><span>  </span><span class="hs-keyword">where</span><span>
</span><span id="line-2296"></span><span>    </span><span class="annot"><a href="#local-6989586621679964223"><span class="hs-identifier hs-type">getDeps</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><a href="Database.Persist.Quasi.Internal.html#UnboundEntityDef"><span class="hs-identifier hs-type">UnboundEntityDef</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-special">[</span><span class="annot"><a href="Database.Persist.TH.html#Dep"><span class="hs-identifier hs-type">Dep</span></a></span><span class="hs-special">]</span><span>
</span><span id="line-2297"></span><span>    </span><span id="local-6989586621679964223"><span class="annot"><span class="annottext">getDeps :: UnboundEntityDef -&gt; [Dep]
</span><a href="#local-6989586621679964223"><span class="hs-identifier hs-var hs-var">getDeps</span></a></span></span><span> </span><span id="local-6989586621679964221"><span class="annot"><span class="annottext">UnboundEntityDef
</span><a href="#local-6989586621679964221"><span class="hs-identifier hs-var">def</span></a></span></span><span> </span><span class="hs-glyph">=</span><span>
</span><span id="line-2298"></span><span>        </span><span class="annot"><span class="annottext">forall (t :: * -&gt; *) a b. Foldable t =&gt; (a -&gt; [b]) -&gt; t a -&gt; [b]
</span><span class="hs-identifier hs-var">concatMap</span></span><span> </span><span class="annot"><span class="annottext">UnboundFieldDef -&gt; [Dep]
</span><a href="#local-6989586621679964220"><span class="hs-identifier hs-var">getDeps'</span></a></span><span> </span><span class="annot"><span class="annottext">forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span> </span><span class="annot"><span class="annottext">UnboundEntityDef -&gt; [UnboundFieldDef]
</span><a href="Database.Persist.Quasi.Internal.html#getUnboundFieldDefs"><span class="hs-identifier hs-var">getUnboundFieldDefs</span></a></span><span> </span><span class="annot"><span class="annottext">forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span> </span><span class="annot"><span class="annottext">UnboundEntityDef -&gt; UnboundEntityDef
</span><a href="Database.Persist.TH.html#fixEntityDef"><span class="hs-identifier hs-var">fixEntityDef</span></a></span><span> </span><span class="annot"><span class="annottext">UnboundEntityDef
</span><a href="#local-6989586621679964221"><span class="hs-identifier hs-var">def</span></a></span><span>
</span><span id="line-2299"></span><span>      </span><span class="hs-keyword">where</span><span>
</span><span id="line-2300"></span><span>        </span><span class="annot"><a href="#local-6989586621679964220"><span class="hs-identifier hs-type">getDeps'</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><a href="Database.Persist.Quasi.Internal.html#UnboundFieldDef"><span class="hs-identifier hs-type">UnboundFieldDef</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-special">[</span><span class="annot"><a href="Database.Persist.TH.html#Dep"><span class="hs-identifier hs-type">Dep</span></a></span><span class="hs-special">]</span><span>
</span><span id="line-2301"></span><span>        </span><span id="local-6989586621679964220"><span class="annot"><span class="annottext">getDeps' :: UnboundFieldDef -&gt; [Dep]
</span><a href="#local-6989586621679964220"><span class="hs-identifier hs-var hs-var">getDeps'</span></a></span></span><span> </span><span id="local-6989586621679964219"><span class="annot"><span class="annottext">UnboundFieldDef
</span><a href="#local-6989586621679964219"><span class="hs-identifier hs-var">field</span></a></span></span><span> </span><span class="hs-glyph">=</span><span>
</span><span id="line-2302"></span><span>            </span><span class="hs-keyword">case</span><span> </span><span class="annot"><span class="annottext">UnboundFieldDef -&gt; Maybe EntityNameHS
</span><a href="Database.Persist.TH.html#guessFieldReference"><span class="hs-identifier hs-var">guessFieldReference</span></a></span><span> </span><span class="annot"><span class="annottext">UnboundFieldDef
</span><a href="#local-6989586621679964219"><span class="hs-identifier hs-var">field</span></a></span><span> </span><span class="hs-keyword">of</span><span>
</span><span id="line-2303"></span><span>                </span><span class="annot"><span class="hs-identifier hs-type">Just</span></span><span> </span><span id="local-6989586621679964218"><span class="annot"><span class="annottext">EntityNameHS
</span><a href="#local-6989586621679964218"><span class="hs-identifier hs-var">name</span></a></span></span><span> </span><span class="hs-glyph">-&gt;</span><span>
</span><span id="line-2304"></span><span>                    </span><span class="annot"><span class="annottext">forall (m :: * -&gt; *) a. Monad m =&gt; a -&gt; m a
</span><span class="hs-identifier hs-var">return</span></span><span> </span><span class="annot"><a href="Database.Persist.TH.html#Dep"><span class="hs-identifier hs-type">Dep</span></a></span><span>
</span><span id="line-2305"></span><span>                        </span><span class="hs-special">{</span><span> </span><span class="annot"><span class="annottext">depTarget :: EntityNameHS
</span><a href="Database.Persist.TH.html#depTarget"><span class="hs-identifier hs-var">depTarget</span></a></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">EntityNameHS
</span><a href="#local-6989586621679964218"><span class="hs-identifier hs-var">name</span></a></span><span>
</span><span id="line-2306"></span><span>                        </span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">depSourceTable :: EntityNameHS
</span><a href="Database.Persist.TH.html#depSourceTable"><span class="hs-identifier hs-var">depSourceTable</span></a></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">EntityDef -&gt; EntityNameHS
</span><a href="Database.Persist.Types.Base.html#entityHaskell"><span class="hs-identifier hs-var">entityHaskell</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">UnboundEntityDef -&gt; EntityDef
</span><a href="Database.Persist.Quasi.Internal.html#unboundEntityDef"><span class="hs-identifier hs-var">unboundEntityDef</span></a></span><span> </span><span class="annot"><span class="annottext">UnboundEntityDef
</span><a href="#local-6989586621679964221"><span class="hs-identifier hs-var">def</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-2307"></span><span>                        </span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">depSourceField :: FieldNameHS
</span><a href="Database.Persist.TH.html#depSourceField"><span class="hs-identifier hs-var">depSourceField</span></a></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">UnboundFieldDef -&gt; FieldNameHS
</span><a href="Database.Persist.Quasi.Internal.html#unboundFieldNameHS"><span class="hs-identifier hs-var">unboundFieldNameHS</span></a></span><span> </span><span class="annot"><span class="annottext">UnboundFieldDef
</span><a href="#local-6989586621679964219"><span class="hs-identifier hs-var">field</span></a></span><span>
</span><span id="line-2308"></span><span>                        </span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">depSourceNull :: IsNullable
</span><a href="Database.Persist.TH.html#depSourceNull"><span class="hs-identifier hs-var">depSourceNull</span></a></span><span>  </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">UnboundFieldDef -&gt; IsNullable
</span><a href="Database.Persist.Quasi.Internal.html#isUnboundFieldNullable"><span class="hs-identifier hs-var">isUnboundFieldNullable</span></a></span><span> </span><span class="annot"><span class="annottext">UnboundFieldDef
</span><a href="#local-6989586621679964219"><span class="hs-identifier hs-var">field</span></a></span><span>
</span><span id="line-2309"></span><span>                        </span><span class="hs-special">}</span><span>
</span><span id="line-2310"></span><span>                </span><span class="annot"><span class="annottext">Maybe EntityNameHS
</span><span class="hs-identifier hs-var">Nothing</span></span><span> </span><span class="hs-glyph">-&gt;</span><span>
</span><span id="line-2311"></span><span>                    </span><span class="hs-special">[</span><span class="hs-special">]</span><span>
</span><span id="line-2312"></span><span>    </span><span class="annot"><a href="#local-6989586621679964222"><span class="hs-identifier hs-type">go</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="hs-special">[</span><span class="annot"><a href="Database.Persist.TH.html#Dep"><span class="hs-identifier hs-type">Dep</span></a></span><span class="hs-special">]</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="Database.Persist.Quasi.Internal.html#UnboundEntityDef"><span class="hs-identifier hs-type">UnboundEntityDef</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="hs-identifier hs-type">Q</span></span><span> </span><span class="annot"><span class="hs-identifier hs-type">Dec</span></span><span>
</span><span id="line-2313"></span><span>    </span><span id="local-6989586621679964222"><span class="annot"><span class="annottext">go :: [Dep] -&gt; UnboundEntityDef -&gt; Q Dec
</span><a href="#local-6989586621679964222"><span class="hs-identifier hs-var hs-var">go</span></a></span></span><span> </span><span id="local-6989586621679964217"><span class="annot"><span class="annottext">[Dep]
</span><a href="#local-6989586621679964217"><span class="hs-identifier hs-var">allDeps</span></a></span></span><span> </span><span id="local-6989586621679964216"><span class="annot"><span class="annottext">UnboundEntityDef
</span><a href="#local-6989586621679964216"><span class="hs-identifier hs-var">ued</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-keyword">do</span><span>
</span><span id="line-2314"></span><span>        </span><span class="hs-keyword">let</span><span> </span><span id="local-6989586621679964215"><span class="annot"><span class="annottext">name :: EntityNameHS
</span><a href="#local-6989586621679964215"><span class="hs-identifier hs-var hs-var">name</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">EntityDef -&gt; EntityNameHS
</span><a href="Database.Persist.Types.Base.html#entityHaskell"><span class="hs-identifier hs-var">entityHaskell</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">UnboundEntityDef -&gt; EntityDef
</span><a href="Database.Persist.Quasi.Internal.html#unboundEntityDef"><span class="hs-identifier hs-var">unboundEntityDef</span></a></span><span> </span><span class="annot"><span class="annottext">UnboundEntityDef
</span><a href="#local-6989586621679964216"><span class="hs-identifier hs-var">ued</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-2315"></span><span>        </span><span class="hs-keyword">let</span><span> </span><span id="local-6989586621679964214"><span class="annot"><span class="annottext">deps :: [Dep]
</span><a href="#local-6989586621679964214"><span class="hs-identifier hs-var hs-var">deps</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">forall a. (a -&gt; Bool) -&gt; [a] -&gt; [a]
</span><span class="hs-identifier hs-var">filter</span></span><span> </span><span class="hs-special">(</span><span class="hs-glyph">\</span><span id="local-6989586621679964213"><span class="annot"><span class="annottext">Dep
</span><a href="#local-6989586621679964213"><span class="hs-identifier hs-var">x</span></a></span></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="annottext">Dep -&gt; EntityNameHS
</span><a href="Database.Persist.TH.html#depTarget"><span class="hs-identifier hs-var">depTarget</span></a></span><span> </span><span class="annot"><span class="annottext">Dep
</span><a href="#local-6989586621679964213"><span class="hs-identifier hs-var">x</span></a></span><span> </span><span class="annot"><span class="annottext">forall a. Eq a =&gt; a -&gt; a -&gt; Bool
</span><span class="hs-operator hs-var">==</span></span><span> </span><span class="annot"><span class="annottext">EntityNameHS
</span><a href="#local-6989586621679964215"><span class="hs-identifier hs-var">name</span></a></span><span class="hs-special">)</span><span> </span><span class="annot"><span class="annottext">[Dep]
</span><a href="#local-6989586621679964217"><span class="hs-identifier hs-var">allDeps</span></a></span><span>
</span><span id="line-2316"></span><span>        </span><span id="local-6989586621679964212"><span class="annot"><span class="annottext">Name
</span><a href="#local-6989586621679964212"><span class="hs-identifier hs-var">key</span></a></span></span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">forall (m :: * -&gt; *). Quote m =&gt; String -&gt; m Name
</span><span class="hs-identifier hs-var">newName</span></span><span> </span><span class="annot"><span class="annottext">String
</span><span class="hs-string">&quot;key&quot;</span></span><span>
</span><span id="line-2317"></span><span>        </span><span class="hs-keyword">let</span><span> </span><span id="local-6989586621679964211"><span class="annot"><span class="annottext">del :: Exp
</span><a href="#local-6989586621679964211"><span class="hs-identifier hs-var hs-var">del</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">Name -&gt; Exp
</span><span class="hs-identifier hs-var">VarE</span></span><span> </span><span class="hs-special">'</span><span class="hs-identifier">delete</span><span>
</span><span id="line-2318"></span><span>        </span><span class="hs-keyword">let</span><span> </span><span id="local-6989586621679964210"><span class="annot"><span class="annottext">dcw :: Exp
</span><a href="#local-6989586621679964210"><span class="hs-identifier hs-var hs-var">dcw</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">Name -&gt; Exp
</span><span class="hs-identifier hs-var">VarE</span></span><span> </span><span class="hs-special">'</span><span class="hs-identifier">deleteCascadeWhere</span><span>
</span><span id="line-2319"></span><span>        </span><span id="local-6989586621679964209"><span class="annot"><span class="annottext">Exp
</span><a href="#local-6989586621679964209"><span class="hs-identifier hs-var">just</span></a></span></span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="hs-special">[|</span><span class="hs-identifier">Just</span><span class="hs-special">|]</span><span>
</span><span id="line-2320"></span><span>        </span><span id="local-6989586621679964208"><span class="annot"><span class="annottext">Exp
</span><a href="#local-6989586621679964208"><span class="hs-identifier hs-var">filt</span></a></span></span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="hs-special">[|</span><span class="hs-identifier">Filter</span><span class="hs-special">|]</span><span>
</span><span id="line-2321"></span><span>        </span><span id="local-6989586621679964207"><span class="annot"><span class="annottext">Exp
</span><a href="#local-6989586621679964207"><span class="hs-identifier hs-var">eq</span></a></span></span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="hs-special">[|</span><span class="hs-identifier">Eq</span><span class="hs-special">|]</span><span>
</span><span id="line-2322"></span><span>        </span><span id="local-6989586621679964206"><span class="annot"><span class="annottext">Exp
</span><a href="#local-6989586621679964206"><span class="hs-identifier hs-var">value</span></a></span></span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="hs-special">[|</span><span class="hs-identifier">FilterValue</span><span class="hs-special">|]</span><span>
</span><span id="line-2323"></span><span>        </span><span class="hs-keyword">let</span><span> </span><span class="annot"><a href="#local-6989586621679964205"><span class="hs-identifier hs-type">mkStmt</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><a href="Database.Persist.TH.html#Dep"><span class="hs-identifier hs-type">Dep</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="hs-identifier hs-type">Stmt</span></span><span>
</span><span id="line-2324"></span><span>            </span><span id="local-6989586621679964205"><span class="annot"><span class="annottext">mkStmt :: Dep -&gt; Stmt
</span><a href="#local-6989586621679964205"><span class="hs-identifier hs-var hs-var">mkStmt</span></a></span></span><span> </span><span id="local-6989586621679964204"><span class="annot"><span class="annottext">Dep
</span><a href="#local-6989586621679964204"><span class="hs-identifier hs-var">dep</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">Exp -&gt; Stmt
</span><span class="hs-identifier hs-var">NoBindS</span></span><span>
</span><span id="line-2325"></span><span>                </span><span class="annot"><span class="annottext">forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span> </span><span class="annot"><span class="annottext">Exp
</span><a href="#local-6989586621679964210"><span class="hs-identifier hs-var">dcw</span></a></span><span> </span><span class="annot"><span class="annottext">Exp -&gt; Exp -&gt; Exp
</span><span class="hs-operator hs-var">`AppE`</span></span><span>
</span><span id="line-2326"></span><span>                  </span><span class="annot"><span class="annottext">[Exp] -&gt; Exp
</span><span class="hs-identifier hs-var">ListE</span></span><span>
</span><span id="line-2327"></span><span>                    </span><span class="hs-special">[</span><span> </span><span class="annot"><span class="annottext">Exp
</span><a href="#local-6989586621679964208"><span class="hs-identifier hs-var">filt</span></a></span><span> </span><span class="annot"><span class="annottext">Exp -&gt; Exp -&gt; Exp
</span><span class="hs-operator hs-var">`AppE`</span></span><span> </span><span class="annot"><span class="annottext">Name -&gt; Exp
</span><span class="hs-identifier hs-var">ConE</span></span><span> </span><span class="annot"><span class="annottext">Name
</span><a href="#local-6989586621679964202"><span class="hs-identifier hs-var">filtName</span></a></span><span>
</span><span id="line-2328"></span><span>                           </span><span class="annot"><span class="annottext">Exp -&gt; Exp -&gt; Exp
</span><span class="hs-operator hs-var">`AppE`</span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Exp
</span><a href="#local-6989586621679964206"><span class="hs-identifier hs-var">value</span></a></span><span> </span><span class="annot"><span class="annottext">Exp -&gt; Exp -&gt; Exp
</span><span class="hs-operator hs-var">`AppE`</span></span><span> </span><span class="annot"><span class="annottext">IsNullable -&gt; Exp
</span><a href="#local-6989586621679964201"><span class="hs-identifier hs-var">val</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Dep -&gt; IsNullable
</span><a href="Database.Persist.TH.html#depSourceNull"><span class="hs-identifier hs-var">depSourceNull</span></a></span><span> </span><span class="annot"><span class="annottext">Dep
</span><a href="#local-6989586621679964204"><span class="hs-identifier hs-var">dep</span></a></span><span class="hs-special">)</span><span class="hs-special">)</span><span>
</span><span id="line-2329"></span><span>                           </span><span class="annot"><span class="annottext">Exp -&gt; Exp -&gt; Exp
</span><span class="hs-operator hs-var">`AppE`</span></span><span> </span><span class="annot"><span class="annottext">Exp
</span><a href="#local-6989586621679964207"><span class="hs-identifier hs-var">eq</span></a></span><span>
</span><span id="line-2330"></span><span>                    </span><span class="hs-special">]</span><span>
</span><span id="line-2331"></span><span>              </span><span class="hs-keyword">where</span><span>
</span><span id="line-2332"></span><span>                </span><span id="local-6989586621679964202"><span class="annot"><span class="annottext">filtName :: Name
</span><a href="#local-6989586621679964202"><span class="hs-identifier hs-var hs-var">filtName</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">MkPersistSettings -&gt; EntityNameHS -&gt; FieldNameHS -&gt; Name
</span><a href="Database.Persist.TH.html#filterConName%27"><span class="hs-identifier hs-var">filterConName'</span></a></span><span> </span><span class="annot"><span class="annottext">MkPersistSettings
</span><a href="#local-6989586621679964227"><span class="hs-identifier hs-var">mps</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Dep -&gt; EntityNameHS
</span><a href="Database.Persist.TH.html#depSourceTable"><span class="hs-identifier hs-var">depSourceTable</span></a></span><span> </span><span class="annot"><span class="annottext">Dep
</span><a href="#local-6989586621679964204"><span class="hs-identifier hs-var">dep</span></a></span><span class="hs-special">)</span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Dep -&gt; FieldNameHS
</span><a href="Database.Persist.TH.html#depSourceField"><span class="hs-identifier hs-var">depSourceField</span></a></span><span> </span><span class="annot"><span class="annottext">Dep
</span><a href="#local-6989586621679964204"><span class="hs-identifier hs-var">dep</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-2333"></span><span>                </span><span id="local-6989586621679964201"><span class="annot"><span class="annottext">val :: IsNullable -&gt; Exp
</span><a href="#local-6989586621679964201"><span class="hs-identifier hs-var hs-var">val</span></a></span></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="Database.Persist.Types.Base.html#Nullable"><span class="hs-identifier hs-type">Nullable</span></a></span><span> </span><span class="annot"><span class="annottext">WhyNullable
</span><a href="Database.Persist.Types.Base.html#ByMaybeAttr"><span class="hs-identifier hs-var">ByMaybeAttr</span></a></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">Exp
</span><a href="#local-6989586621679964209"><span class="hs-identifier hs-var">just</span></a></span><span> </span><span class="annot"><span class="annottext">Exp -&gt; Exp -&gt; Exp
</span><span class="hs-operator hs-var">`AppE`</span></span><span> </span><span class="annot"><span class="annottext">Name -&gt; Exp
</span><span class="hs-identifier hs-var">VarE</span></span><span> </span><span class="annot"><span class="annottext">Name
</span><a href="#local-6989586621679964212"><span class="hs-identifier hs-var">key</span></a></span><span>
</span><span id="line-2334"></span><span>                </span><span class="annot"><a href="#local-6989586621679964201"><span class="hs-identifier hs-var">val</span></a></span><span> </span><span class="annot"><span class="annottext">IsNullable
</span><span class="hs-identifier">_</span></span><span>                      </span><span class="hs-glyph">=</span><span>             </span><span class="annot"><span class="annottext">Name -&gt; Exp
</span><span class="hs-identifier hs-var">VarE</span></span><span> </span><span class="annot"><span class="annottext">Name
</span><a href="#local-6989586621679964212"><span class="hs-identifier hs-var">key</span></a></span><span>
</span><span id="line-2335"></span><span>
</span><span id="line-2336"></span><span>        </span><span class="hs-keyword">let</span><span> </span><span class="annot"><a href="#local-6989586621679964199"><span class="hs-identifier hs-type">stmts</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="hs-special">[</span><span class="annot"><span class="hs-identifier hs-type">Stmt</span></span><span class="hs-special">]</span><span>
</span><span id="line-2337"></span><span>            </span><span id="local-6989586621679964199"><span class="annot"><span class="annottext">stmts :: [Stmt]
</span><a href="#local-6989586621679964199"><span class="hs-identifier hs-var hs-var">stmts</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">forall (f :: * -&gt; *) a b. Functor f =&gt; (a -&gt; b) -&gt; f a -&gt; f b
</span><span class="hs-identifier hs-var">fmap</span></span><span> </span><span class="annot"><span class="annottext">Dep -&gt; Stmt
</span><a href="#local-6989586621679964205"><span class="hs-identifier hs-var">mkStmt</span></a></span><span> </span><span class="annot"><span class="annottext">[Dep]
</span><a href="#local-6989586621679964214"><span class="hs-identifier hs-var">deps</span></a></span><span> </span><span class="annot"><span class="annottext">forall m. Monoid m =&gt; m -&gt; m -&gt; m
</span><span class="hs-operator hs-var">`mappend`</span></span><span>
</span><span id="line-2338"></span><span>                    </span><span class="hs-special">[</span><span class="annot"><span class="annottext">Exp -&gt; Stmt
</span><span class="hs-identifier hs-var">NoBindS</span></span><span> </span><span class="annot"><span class="annottext">forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span> </span><span class="annot"><span class="annottext">Exp
</span><a href="#local-6989586621679964211"><span class="hs-identifier hs-var">del</span></a></span><span> </span><span class="annot"><span class="annottext">Exp -&gt; Exp -&gt; Exp
</span><span class="hs-operator hs-var">`AppE`</span></span><span> </span><span class="annot"><span class="annottext">Name -&gt; Exp
</span><span class="hs-identifier hs-var">VarE</span></span><span> </span><span class="annot"><span class="annottext">Name
</span><a href="#local-6989586621679964212"><span class="hs-identifier hs-var">key</span></a></span><span class="hs-special">]</span><span>
</span><span id="line-2339"></span><span>
</span><span id="line-2340"></span><span>        </span><span class="hs-keyword">let</span><span> </span><span id="local-6989586621679964198"><span class="annot"><span class="annottext">entityT :: Type
</span><a href="#local-6989586621679964198"><span class="hs-identifier hs-var hs-var">entityT</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">MkPersistSettings -&gt; EntityNameHS -&gt; Type -&gt; Type
</span><a href="Database.Persist.TH.html#genericDataType"><span class="hs-identifier hs-var">genericDataType</span></a></span><span> </span><span class="annot"><span class="annottext">MkPersistSettings
</span><a href="#local-6989586621679964227"><span class="hs-identifier hs-var">mps</span></a></span><span> </span><span class="annot"><span class="annottext">EntityNameHS
</span><a href="#local-6989586621679964215"><span class="hs-identifier hs-var">name</span></a></span><span> </span><span class="annot"><span class="annottext">Type
</span><a href="Database.Persist.TH.html#backendT"><span class="hs-identifier hs-var">backendT</span></a></span><span>
</span><span id="line-2341"></span><span>
</span><span id="line-2342"></span><span>        </span><span class="annot"><span class="annottext">forall (m :: * -&gt; *) a. Monad m =&gt; a -&gt; m a
</span><span class="hs-identifier hs-var">return</span></span><span> </span><span class="annot"><span class="annottext">forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span>
</span><span id="line-2343"></span><span>            </span><span class="annot"><span class="annottext">[Type] -&gt; Type -&gt; [Dec] -&gt; Dec
</span><a href="Database.Persist.TH.html#instanceD"><span class="hs-identifier hs-var">instanceD</span></a></span><span>
</span><span id="line-2344"></span><span>            </span><span class="hs-special">[</span><span> </span><span class="annot"><span class="annottext">Name -&gt; [Type] -&gt; Type
</span><a href="Database.Persist.TH.html#mkClassP"><span class="hs-identifier hs-var">mkClassP</span></a></span><span> </span><span class="hs-special">''</span><span class="hs-identifier">PersistQuery</span><span> </span><span class="hs-special">[</span><span class="annot"><span class="annottext">Type
</span><a href="Database.Persist.TH.html#backendT"><span class="hs-identifier hs-var">backendT</span></a></span><span class="hs-special">]</span><span>
</span><span id="line-2345"></span><span>            </span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">Type -&gt; Type -&gt; Type
</span><a href="Database.Persist.TH.html#mkEqualP"><span class="hs-identifier hs-var">mkEqualP</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Name -&gt; Type
</span><span class="hs-identifier hs-var">ConT</span></span><span> </span><span class="hs-special">''</span><span class="hs-identifier">PersistEntityBackend</span><span> </span><span class="annot"><span class="annottext">Type -&gt; Type -&gt; Type
</span><span class="hs-operator hs-var">`AppT`</span></span><span> </span><span class="annot"><span class="annottext">Type
</span><a href="#local-6989586621679964198"><span class="hs-identifier hs-var">entityT</span></a></span><span class="hs-special">)</span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Name -&gt; Type
</span><span class="hs-identifier hs-var">ConT</span></span><span> </span><span class="hs-special">''</span><span class="hs-identifier">BaseBackend</span><span> </span><span class="annot"><span class="annottext">Type -&gt; Type -&gt; Type
</span><span class="hs-operator hs-var">`AppT`</span></span><span> </span><span class="annot"><span class="annottext">Type
</span><a href="Database.Persist.TH.html#backendT"><span class="hs-identifier hs-var">backendT</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-2346"></span><span>            </span><span class="hs-special">]</span><span>
</span><span id="line-2347"></span><span>            </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Name -&gt; Type
</span><span class="hs-identifier hs-var">ConT</span></span><span> </span><span class="hs-special">''</span><span class="hs-identifier">DeleteCascade</span><span> </span><span class="annot"><span class="annottext">Type -&gt; Type -&gt; Type
</span><span class="hs-operator hs-var">`AppT`</span></span><span> </span><span class="annot"><span class="annottext">Type
</span><a href="#local-6989586621679964198"><span class="hs-identifier hs-var">entityT</span></a></span><span> </span><span class="annot"><span class="annottext">Type -&gt; Type -&gt; Type
</span><span class="hs-operator hs-var">`AppT`</span></span><span> </span><span class="annot"><span class="annottext">Type
</span><a href="Database.Persist.TH.html#backendT"><span class="hs-identifier hs-var">backendT</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-2348"></span><span>            </span><span class="hs-special">[</span><span> </span><span class="annot"><span class="annottext">Name -&gt; [Clause] -&gt; Dec
</span><span class="hs-identifier hs-var">FunD</span></span><span> </span><span class="hs-special">'</span><span class="hs-identifier">deleteCascade</span><span>
</span><span id="line-2349"></span><span>                </span><span class="hs-special">[</span><span class="annot"><span class="annottext">[Pat] -&gt; Exp -&gt; Clause
</span><a href="Database.Persist.TH.html#normalClause"><span class="hs-identifier hs-var">normalClause</span></a></span><span> </span><span class="hs-special">[</span><span class="annot"><span class="annottext">Name -&gt; Pat
</span><span class="hs-identifier hs-var">VarP</span></span><span> </span><span class="annot"><span class="annottext">Name
</span><a href="#local-6989586621679964212"><span class="hs-identifier hs-var">key</span></a></span><span class="hs-special">]</span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">[Stmt] -&gt; Exp
</span><a href="Database.Persist.TH.html#mkDoE"><span class="hs-identifier hs-var">mkDoE</span></a></span><span> </span><span class="annot"><span class="annottext">[Stmt]
</span><a href="#local-6989586621679964199"><span class="hs-identifier hs-var">stmts</span></a></span><span class="hs-special">)</span><span class="hs-special">]</span><span>
</span><span id="line-2350"></span><span>            </span><span class="hs-special">]</span><span>
</span><span id="line-2351"></span><span>
</span><span id="line-2352"></span><span class="hs-comment">-- | Creates a declaration for the @['EntityDef']@ from the @persistent@</span><span>
</span><span id="line-2353"></span><span class="hs-comment">-- schema. This is necessary because the Persistent QuasiQuoter is unable</span><span>
</span><span id="line-2354"></span><span class="hs-comment">-- to know the correct type of ID fields, and assumes that they are all</span><span>
</span><span id="line-2355"></span><span class="hs-comment">-- Int64.</span><span>
</span><span id="line-2356"></span><span class="hs-comment">--</span><span>
</span><span id="line-2357"></span><span class="hs-comment">-- Provide this in the list you give to 'share', much like @'mkMigrate'@.</span><span>
</span><span id="line-2358"></span><span class="hs-comment">--</span><span>
</span><span id="line-2359"></span><span class="hs-comment">-- @</span><span>
</span><span id="line-2360"></span><span class="hs-comment">-- 'share' ['mkMigrate' &quot;migrateAll&quot;, 'mkEntityDefList' &quot;entityDefs&quot;] [...]</span><span>
</span><span id="line-2361"></span><span class="hs-comment">-- @</span><span>
</span><span id="line-2362"></span><span class="hs-comment">--</span><span>
</span><span id="line-2363"></span><span class="hs-comment">-- @since 2.7.1</span><span>
</span><span id="line-2364"></span><span class="annot"><a href="Database.Persist.TH.html#mkEntityDefList"><span class="hs-identifier hs-type">mkEntityDefList</span></a></span><span>
</span><span id="line-2365"></span><span>    </span><span class="hs-glyph">::</span><span> </span><span class="annot"><span class="hs-identifier hs-type">String</span></span><span>
</span><span id="line-2366"></span><span>    </span><span class="hs-comment">-- ^ The name that will be given to the 'EntityDef' list.</span><span>
</span><span id="line-2367"></span><span>    </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-special">[</span><span class="annot"><a href="Database.Persist.Quasi.Internal.html#UnboundEntityDef"><span class="hs-identifier hs-type">UnboundEntityDef</span></a></span><span class="hs-special">]</span><span>
</span><span id="line-2368"></span><span>    </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="hs-identifier hs-type">Q</span></span><span> </span><span class="hs-special">[</span><span class="annot"><span class="hs-identifier hs-type">Dec</span></span><span class="hs-special">]</span><span>
</span><span id="line-2369"></span><span id="mkEntityDefList"><span class="annot"><span class="annottext">mkEntityDefList :: String -&gt; [UnboundEntityDef] -&gt; Q [Dec]
</span><a href="Database.Persist.TH.html#mkEntityDefList"><span class="hs-identifier hs-var hs-var">mkEntityDefList</span></a></span></span><span> </span><span id="local-6989586621679964196"><span class="annot"><span class="annottext">String
</span><a href="#local-6989586621679964196"><span class="hs-identifier hs-var">entityList</span></a></span></span><span> </span><span id="local-6989586621679964195"><span class="annot"><span class="annottext">[UnboundEntityDef]
</span><a href="#local-6989586621679964195"><span class="hs-identifier hs-var">entityDefs</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-keyword">do</span><span>
</span><span id="line-2370"></span><span>    </span><span class="hs-keyword">let</span><span> </span><span id="local-6989586621679964194"><span class="annot"><span class="annottext">entityListName :: Name
</span><a href="#local-6989586621679964194"><span class="hs-identifier hs-var hs-var">entityListName</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">String -&gt; Name
</span><span class="hs-identifier hs-var">mkName</span></span><span> </span><span class="annot"><span class="annottext">String
</span><a href="#local-6989586621679964196"><span class="hs-identifier hs-var">entityList</span></a></span><span>
</span><span id="line-2371"></span><span>    </span><span id="local-6989586621679964193"><span class="annot"><span class="annottext">Exp
</span><a href="#local-6989586621679964193"><span class="hs-identifier hs-var">edefs</span></a></span></span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">forall (f :: * -&gt; *) a b. Functor f =&gt; (a -&gt; b) -&gt; f a -&gt; f b
</span><span class="hs-identifier hs-var">fmap</span></span><span> </span><span class="annot"><span class="annottext">[Exp] -&gt; Exp
</span><span class="hs-identifier hs-var">ListE</span></span><span>
</span><span id="line-2372"></span><span>        </span><span class="annot"><span class="annottext">forall b c a. (b -&gt; c) -&gt; (a -&gt; b) -&gt; a -&gt; c
</span><span class="hs-operator hs-var">.</span></span><span> </span><span class="annot"><span class="annottext">forall (t :: * -&gt; *) (m :: * -&gt; *) a b.
(Traversable t, Monad m) =&gt;
t a -&gt; (a -&gt; m b) -&gt; m (t b)
</span><span class="hs-identifier hs-var">forM</span></span><span> </span><span class="annot"><span class="annottext">[UnboundEntityDef]
</span><a href="#local-6989586621679964195"><span class="hs-identifier hs-var">entityDefs</span></a></span><span>
</span><span id="line-2373"></span><span>        </span><span class="annot"><span class="annottext">forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span> </span><span class="hs-glyph">\</span><span id="local-6989586621679964192"><span class="annot"><span class="annottext">UnboundEntityDef
</span><a href="#local-6989586621679964192"><span class="hs-identifier hs-var">entDef</span></a></span></span><span> </span><span class="hs-glyph">-&gt;</span><span>
</span><span id="line-2374"></span><span>            </span><span class="hs-keyword">let</span><span> </span><span id="local-6989586621679964191"><span class="annot"><span class="annottext">entityType :: Q Type
</span><a href="#local-6989586621679964191"><span class="hs-identifier hs-var hs-var">entityType</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">UnboundEntityDef -&gt; Q Type
</span><a href="Database.Persist.TH.html#entityDefConT"><span class="hs-identifier hs-var">entityDefConT</span></a></span><span> </span><span class="annot"><span class="annottext">UnboundEntityDef
</span><a href="#local-6989586621679964192"><span class="hs-identifier hs-var">entDef</span></a></span><span>
</span><span id="line-2375"></span><span>             </span><span class="hs-keyword">in</span><span> </span><span class="hs-special">[|</span><span class="hs-identifier">entityDef</span><span> </span><span class="hs-special">(</span><span class="hs-identifier">Proxy</span><span> </span><span class="hs-glyph">::</span><span> </span><span class="hs-identifier">Proxy</span><span> </span><span class="hs-special">$</span><span class="hs-special">(</span><span class="hs-identifier">entityType</span><span class="hs-special">)</span><span class="hs-special">)</span><span class="hs-special">|]</span><span>
</span><span id="line-2376"></span><span>    </span><span id="local-6989586621679964189"><span class="annot"><span class="annottext">Type
</span><a href="#local-6989586621679964189"><span class="hs-identifier hs-var">typ</span></a></span></span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="hs-special">[t|</span><span class="hs-special">[</span><span class="hs-identifier">EntityDef</span><span class="hs-special">]</span><span class="hs-special">|]</span><span>
</span><span id="line-2377"></span><span>    </span><span class="annot"><span class="annottext">forall (f :: * -&gt; *) a. Applicative f =&gt; a -&gt; f a
</span><span class="hs-identifier hs-var">pure</span></span><span>
</span><span id="line-2378"></span><span>        </span><span class="hs-special">[</span><span> </span><span class="annot"><span class="annottext">Name -&gt; Type -&gt; Dec
</span><span class="hs-identifier hs-var">SigD</span></span><span> </span><span class="annot"><span class="annottext">Name
</span><a href="#local-6989586621679964194"><span class="hs-identifier hs-var">entityListName</span></a></span><span> </span><span class="annot"><span class="annottext">Type
</span><a href="#local-6989586621679964189"><span class="hs-identifier hs-var">typ</span></a></span><span>
</span><span id="line-2379"></span><span>        </span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">Pat -&gt; Body -&gt; [Dec] -&gt; Dec
</span><span class="hs-identifier hs-var">ValD</span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Name -&gt; Pat
</span><span class="hs-identifier hs-var">VarP</span></span><span> </span><span class="annot"><span class="annottext">Name
</span><a href="#local-6989586621679964194"><span class="hs-identifier hs-var">entityListName</span></a></span><span class="hs-special">)</span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Exp -&gt; Body
</span><span class="hs-identifier hs-var">NormalB</span></span><span> </span><span class="annot"><span class="annottext">Exp
</span><a href="#local-6989586621679964193"><span class="hs-identifier hs-var">edefs</span></a></span><span class="hs-special">)</span><span> </span><span class="hs-special">[</span><span class="hs-special">]</span><span>
</span><span id="line-2380"></span><span>        </span><span class="hs-special">]</span><span>
</span><span id="line-2381"></span><span>
</span><span id="line-2382"></span><span class="annot"><a href="Database.Persist.TH.html#mkUniqueKeys"><span class="hs-identifier hs-type">mkUniqueKeys</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><a href="Database.Persist.Quasi.Internal.html#UnboundEntityDef"><span class="hs-identifier hs-type">UnboundEntityDef</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="hs-identifier hs-type">Q</span></span><span> </span><span class="annot"><span class="hs-identifier hs-type">Dec</span></span><span>
</span><span id="line-2383"></span><span id="mkUniqueKeys"><span class="annot"><span class="annottext">mkUniqueKeys :: UnboundEntityDef -&gt; Q Dec
</span><a href="Database.Persist.TH.html#mkUniqueKeys"><span class="hs-identifier hs-var hs-var">mkUniqueKeys</span></a></span></span><span> </span><span id="local-6989586621679964187"><span class="annot"><span class="annottext">UnboundEntityDef
</span><a href="#local-6989586621679964187"><span class="hs-identifier hs-var">def</span></a></span></span><span> </span><span class="hs-glyph">|</span><span> </span><span class="annot"><span class="annottext">EntityDef -&gt; Bool
</span><a href="Database.Persist.Types.Base.html#entitySum"><span class="hs-identifier hs-var">entitySum</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">UnboundEntityDef -&gt; EntityDef
</span><a href="Database.Persist.Quasi.Internal.html#unboundEntityDef"><span class="hs-identifier hs-var">unboundEntityDef</span></a></span><span> </span><span class="annot"><span class="annottext">UnboundEntityDef
</span><a href="#local-6989586621679964187"><span class="hs-identifier hs-var">def</span></a></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">=</span><span>
</span><span id="line-2384"></span><span>    </span><span class="annot"><span class="annottext">forall (m :: * -&gt; *) a. Monad m =&gt; a -&gt; m a
</span><span class="hs-identifier hs-var">return</span></span><span> </span><span class="annot"><span class="annottext">forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span> </span><span class="annot"><span class="annottext">Name -&gt; [Clause] -&gt; Dec
</span><span class="hs-identifier hs-var">FunD</span></span><span> </span><span class="hs-special">'</span><span class="hs-identifier">persistUniqueKeys</span><span> </span><span class="hs-special">[</span><span class="annot"><span class="annottext">[Pat] -&gt; Exp -&gt; Clause
</span><a href="Database.Persist.TH.html#normalClause"><span class="hs-identifier hs-var">normalClause</span></a></span><span> </span><span class="hs-special">[</span><span class="annot"><span class="annottext">Pat
</span><span class="hs-identifier hs-var">WildP</span></span><span class="hs-special">]</span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">[Exp] -&gt; Exp
</span><span class="hs-identifier hs-var">ListE</span></span><span> </span><span class="hs-special">[</span><span class="hs-special">]</span><span class="hs-special">)</span><span class="hs-special">]</span><span>
</span><span id="line-2385"></span><span class="annot"><a href="Database.Persist.TH.html#mkUniqueKeys"><span class="hs-identifier hs-var">mkUniqueKeys</span></a></span><span> </span><span id="local-6989586621679964186"><span class="annot"><span class="annottext">UnboundEntityDef
</span><a href="#local-6989586621679964186"><span class="hs-identifier hs-var">def</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-keyword">do</span><span>
</span><span id="line-2386"></span><span>    </span><span id="local-6989586621679964185"><span class="annot"><span class="annottext">Clause
</span><a href="#local-6989586621679964185"><span class="hs-identifier hs-var">c</span></a></span></span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">Q Clause
</span><a href="#local-6989586621679964184"><span class="hs-identifier hs-var">clause</span></a></span><span>
</span><span id="line-2387"></span><span>    </span><span class="annot"><span class="annottext">forall (m :: * -&gt; *) a. Monad m =&gt; a -&gt; m a
</span><span class="hs-identifier hs-var">return</span></span><span> </span><span class="annot"><span class="annottext">forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span> </span><span class="annot"><span class="annottext">Name -&gt; [Clause] -&gt; Dec
</span><span class="hs-identifier hs-var">FunD</span></span><span> </span><span class="hs-special">'</span><span class="hs-identifier">persistUniqueKeys</span><span> </span><span class="hs-special">[</span><span class="annot"><span class="annottext">Clause
</span><a href="#local-6989586621679964185"><span class="hs-identifier hs-var">c</span></a></span><span class="hs-special">]</span><span>
</span><span id="line-2388"></span><span>  </span><span class="hs-keyword">where</span><span>
</span><span id="line-2389"></span><span>    </span><span id="local-6989586621679964184"><span class="annot"><span class="annottext">clause :: Q Clause
</span><a href="#local-6989586621679964184"><span class="hs-identifier hs-var hs-var">clause</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-keyword">do</span><span>
</span><span id="line-2390"></span><span>        </span><span id="local-6989586621679964183"><span class="annot"><span class="annottext">[(FieldNameHS, Name)]
</span><a href="#local-6989586621679964183"><span class="hs-identifier hs-var">xs</span></a></span></span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">forall (t :: * -&gt; *) (m :: * -&gt; *) a b.
(Traversable t, Monad m) =&gt;
t a -&gt; (a -&gt; m b) -&gt; m (t b)
</span><span class="hs-identifier hs-var">forM</span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">UnboundEntityDef -&gt; [UnboundFieldDef]
</span><a href="Database.Persist.Quasi.Internal.html#getUnboundFieldDefs"><span class="hs-identifier hs-var">getUnboundFieldDefs</span></a></span><span> </span><span class="annot"><span class="annottext">UnboundEntityDef
</span><a href="#local-6989586621679964186"><span class="hs-identifier hs-var">def</span></a></span><span class="hs-special">)</span><span> </span><span class="annot"><span class="annottext">forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span> </span><span class="hs-glyph">\</span><span id="local-6989586621679964182"><span class="annot"><span class="annottext">UnboundFieldDef
</span><a href="#local-6989586621679964182"><span class="hs-identifier hs-var">fieldDef</span></a></span></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-keyword">do</span><span>
</span><span id="line-2391"></span><span>            </span><span class="hs-keyword">let</span><span> </span><span id="local-6989586621679964181"><span class="annot"><span class="annottext">x :: FieldNameHS
</span><a href="#local-6989586621679964181"><span class="hs-identifier hs-var hs-var">x</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">UnboundFieldDef -&gt; FieldNameHS
</span><a href="Database.Persist.Quasi.Internal.html#unboundFieldNameHS"><span class="hs-identifier hs-var">unboundFieldNameHS</span></a></span><span> </span><span class="annot"><span class="annottext">UnboundFieldDef
</span><a href="#local-6989586621679964182"><span class="hs-identifier hs-var">fieldDef</span></a></span><span>
</span><span id="line-2392"></span><span>            </span><span id="local-6989586621679964180"><span class="annot"><span class="annottext">Name
</span><a href="#local-6989586621679964180"><span class="hs-identifier hs-var">x'</span></a></span></span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">forall (m :: * -&gt; *). Quote m =&gt; String -&gt; m Name
</span><span class="hs-identifier hs-var">newName</span></span><span> </span><span class="annot"><span class="annottext">forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span> </span><span class="annot"><span class="annottext">Char
</span><span class="hs-char">'_'</span></span><span> </span><span class="annot"><span class="annottext">forall a. a -&gt; [a] -&gt; [a]
</span><span class="hs-glyph hs-var">:</span></span><span> </span><span class="annot"><span class="annottext">Text -&gt; String
</span><span class="hs-identifier hs-var">unpack</span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">FieldNameHS -&gt; Text
</span><a href="Database.Persist.Names.html#unFieldNameHS"><span class="hs-identifier hs-var">unFieldNameHS</span></a></span><span> </span><span class="annot"><span class="annottext">FieldNameHS
</span><a href="#local-6989586621679964181"><span class="hs-identifier hs-var">x</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-2393"></span><span>            </span><span class="annot"><span class="annottext">forall (m :: * -&gt; *) a. Monad m =&gt; a -&gt; m a
</span><span class="hs-identifier hs-var">return</span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">FieldNameHS
</span><a href="#local-6989586621679964181"><span class="hs-identifier hs-var">x</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">Name
</span><a href="#local-6989586621679964180"><span class="hs-identifier hs-var">x'</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-2394"></span><span>        </span><span class="hs-keyword">let</span><span> </span><span id="local-6989586621679964179"><span class="annot"><span class="annottext">pcs :: [Exp]
</span><a href="#local-6989586621679964179"><span class="hs-identifier hs-var hs-var">pcs</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">forall (f :: * -&gt; *) a b. Functor f =&gt; (a -&gt; b) -&gt; f a -&gt; f b
</span><span class="hs-identifier hs-var">fmap</span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">[(FieldNameHS, Name)] -&gt; UniqueDef -&gt; Exp
</span><a href="#local-6989586621679964178"><span class="hs-identifier hs-var">go</span></a></span><span> </span><span class="annot"><span class="annottext">[(FieldNameHS, Name)]
</span><a href="#local-6989586621679964183"><span class="hs-identifier hs-var">xs</span></a></span><span class="hs-special">)</span><span> </span><span class="annot"><span class="annottext">forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span> </span><span class="annot"><span class="annottext">EntityDef -&gt; [UniqueDef]
</span><a href="Database.Persist.Types.Base.html#entityUniques"><span class="hs-identifier hs-var">entityUniques</span></a></span><span> </span><span class="annot"><span class="annottext">forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span> </span><span class="annot"><span class="annottext">UnboundEntityDef -&gt; EntityDef
</span><a href="Database.Persist.Quasi.Internal.html#unboundEntityDef"><span class="hs-identifier hs-var">unboundEntityDef</span></a></span><span> </span><span class="annot"><span class="annottext">UnboundEntityDef
</span><a href="#local-6989586621679964186"><span class="hs-identifier hs-var">def</span></a></span><span>
</span><span id="line-2395"></span><span>        </span><span class="hs-keyword">let</span><span> </span><span id="local-6989586621679964177"><span class="annot"><span class="annottext">pat :: Pat
</span><a href="#local-6989586621679964177"><span class="hs-identifier hs-var hs-var">pat</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">Name -&gt; [Pat] -&gt; Pat
</span><a href="Database.Persist.TH.html#conp"><span class="hs-identifier hs-var">conp</span></a></span><span>
</span><span id="line-2396"></span><span>                </span><span class="hs-special">(</span><span class="annot"><span class="annottext">UnboundEntityDef -&gt; Name
</span><a href="Database.Persist.TH.html#mkEntityDefName"><span class="hs-identifier hs-var">mkEntityDefName</span></a></span><span> </span><span class="annot"><span class="annottext">UnboundEntityDef
</span><a href="#local-6989586621679964186"><span class="hs-identifier hs-var">def</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-2397"></span><span>                </span><span class="hs-special">(</span><span class="annot"><span class="annottext">forall (f :: * -&gt; *) a b. Functor f =&gt; (a -&gt; b) -&gt; f a -&gt; f b
</span><span class="hs-identifier hs-var">fmap</span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Name -&gt; Pat
</span><span class="hs-identifier hs-var">VarP</span></span><span> </span><span class="annot"><span class="annottext">forall b c a. (b -&gt; c) -&gt; (a -&gt; b) -&gt; a -&gt; c
</span><span class="hs-operator hs-var">.</span></span><span> </span><span class="annot"><span class="annottext">forall a b. (a, b) -&gt; b
</span><span class="hs-identifier hs-var">snd</span></span><span class="hs-special">)</span><span> </span><span class="annot"><span class="annottext">[(FieldNameHS, Name)]
</span><a href="#local-6989586621679964183"><span class="hs-identifier hs-var">xs</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-2398"></span><span>        </span><span class="annot"><span class="annottext">forall (m :: * -&gt; *) a. Monad m =&gt; a -&gt; m a
</span><span class="hs-identifier hs-var">return</span></span><span> </span><span class="annot"><span class="annottext">forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span> </span><span class="annot"><span class="annottext">[Pat] -&gt; Exp -&gt; Clause
</span><a href="Database.Persist.TH.html#normalClause"><span class="hs-identifier hs-var">normalClause</span></a></span><span> </span><span class="hs-special">[</span><span class="annot"><span class="annottext">Pat
</span><a href="#local-6989586621679964177"><span class="hs-identifier hs-var">pat</span></a></span><span class="hs-special">]</span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">[Exp] -&gt; Exp
</span><span class="hs-identifier hs-var">ListE</span></span><span> </span><span class="annot"><span class="annottext">[Exp]
</span><a href="#local-6989586621679964179"><span class="hs-identifier hs-var">pcs</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-2399"></span><span>
</span><span id="line-2400"></span><span>    </span><span class="annot"><a href="#local-6989586621679964178"><span class="hs-identifier hs-type">go</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="hs-special">[</span><span class="hs-special">(</span><span class="annot"><a href="Database.Persist.Names.html#FieldNameHS"><span class="hs-identifier hs-type">FieldNameHS</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><span class="hs-identifier hs-type">Name</span></span><span class="hs-special">)</span><span class="hs-special">]</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="Database.Persist.Types.Base.html#UniqueDef"><span class="hs-identifier hs-type">UniqueDef</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="hs-identifier hs-type">Exp</span></span><span>
</span><span id="line-2401"></span><span>    </span><span id="local-6989586621679964178"><span class="annot"><span class="annottext">go :: [(FieldNameHS, Name)] -&gt; UniqueDef -&gt; Exp
</span><a href="#local-6989586621679964178"><span class="hs-identifier hs-var hs-var">go</span></a></span></span><span> </span><span id="local-6989586621679964176"><span class="annot"><span class="annottext">[(FieldNameHS, Name)]
</span><a href="#local-6989586621679964176"><span class="hs-identifier hs-var">xs</span></a></span></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="Database.Persist.Types.Base.html#UniqueDef"><span class="hs-identifier hs-type">UniqueDef</span></a></span><span> </span><span id="local-6989586621679964175"><span class="annot"><span class="annottext">ConstraintNameHS
</span><a href="#local-6989586621679964175"><span class="hs-identifier hs-var">name</span></a></span></span><span> </span><span class="annot"><span class="annottext">ConstraintNameDB
</span><span class="hs-identifier">_</span></span><span> </span><span id="local-6989586621679964174"><span class="annot"><span class="annottext">NonEmpty ForeignFieldDef
</span><a href="#local-6989586621679964174"><span class="hs-identifier hs-var">cols</span></a></span></span><span> </span><span class="annot"><span class="annottext">[Text]
</span><span class="hs-identifier">_</span></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">=</span><span>
</span><span id="line-2402"></span><span>        </span><span class="annot"><span class="annottext">forall (t :: * -&gt; *) b a.
Foldable t =&gt;
(b -&gt; a -&gt; b) -&gt; b -&gt; t a -&gt; b
</span><span class="hs-identifier hs-var">foldl'</span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">[(FieldNameHS, Name)] -&gt; Exp -&gt; FieldNameHS -&gt; Exp
</span><a href="#local-6989586621679964173"><span class="hs-identifier hs-var">go'</span></a></span><span> </span><span class="annot"><span class="annottext">[(FieldNameHS, Name)]
</span><a href="#local-6989586621679964176"><span class="hs-identifier hs-var">xs</span></a></span><span class="hs-special">)</span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Name -&gt; Exp
</span><span class="hs-identifier hs-var">ConE</span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">ConstraintNameHS -&gt; Name
</span><a href="Database.Persist.TH.html#mkConstraintName"><span class="hs-identifier hs-var">mkConstraintName</span></a></span><span> </span><span class="annot"><span class="annottext">ConstraintNameHS
</span><a href="#local-6989586621679964175"><span class="hs-identifier hs-var">name</span></a></span><span class="hs-special">)</span><span class="hs-special">)</span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">forall (t :: * -&gt; *) a. Foldable t =&gt; t a -&gt; [a]
</span><span class="hs-identifier hs-var">toList</span></span><span> </span><span class="annot"><span class="annottext">forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span> </span><span class="annot"><span class="annottext">forall (f :: * -&gt; *) a b. Functor f =&gt; (a -&gt; b) -&gt; f a -&gt; f b
</span><span class="hs-identifier hs-var">fmap</span></span><span> </span><span class="annot"><span class="annottext">forall a b. (a, b) -&gt; a
</span><span class="hs-identifier hs-var">fst</span></span><span> </span><span class="annot"><span class="annottext">NonEmpty ForeignFieldDef
</span><a href="#local-6989586621679964174"><span class="hs-identifier hs-var">cols</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-2403"></span><span>
</span><span id="line-2404"></span><span>    </span><span class="annot"><a href="#local-6989586621679964173"><span class="hs-identifier hs-type">go'</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="hs-special">[</span><span class="hs-special">(</span><span class="annot"><a href="Database.Persist.Names.html#FieldNameHS"><span class="hs-identifier hs-type">FieldNameHS</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><span class="hs-identifier hs-type">Name</span></span><span class="hs-special">)</span><span class="hs-special">]</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="hs-identifier hs-type">Exp</span></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="Database.Persist.Names.html#FieldNameHS"><span class="hs-identifier hs-type">FieldNameHS</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="hs-identifier hs-type">Exp</span></span><span>
</span><span id="line-2405"></span><span>    </span><span id="local-6989586621679964173"><span class="annot"><span class="annottext">go' :: [(FieldNameHS, Name)] -&gt; Exp -&gt; FieldNameHS -&gt; Exp
</span><a href="#local-6989586621679964173"><span class="hs-identifier hs-var hs-var">go'</span></a></span></span><span> </span><span id="local-6989586621679964172"><span class="annot"><span class="annottext">[(FieldNameHS, Name)]
</span><a href="#local-6989586621679964172"><span class="hs-identifier hs-var">xs</span></a></span></span><span> </span><span id="local-6989586621679964171"><span class="annot"><span class="annottext">Exp
</span><a href="#local-6989586621679964171"><span class="hs-identifier hs-var">front</span></a></span></span><span> </span><span id="local-6989586621679964170"><span class="annot"><span class="annottext">FieldNameHS
</span><a href="#local-6989586621679964170"><span class="hs-identifier hs-var">col</span></a></span></span><span> </span><span class="hs-glyph">=</span><span>
</span><span id="line-2406"></span><span>        </span><span class="hs-keyword">let</span><span> </span><span class="annot"><span class="hs-identifier hs-type">Just</span></span><span> </span><span id="local-6989586621679964169"><span class="annot"><span class="annottext">Name
</span><a href="#local-6989586621679964169"><span class="hs-identifier hs-var">col'</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">forall a b. Eq a =&gt; a -&gt; [(a, b)] -&gt; Maybe b
</span><span class="hs-identifier hs-var">lookup</span></span><span> </span><span class="annot"><span class="annottext">FieldNameHS
</span><a href="#local-6989586621679964170"><span class="hs-identifier hs-var">col</span></a></span><span> </span><span class="annot"><span class="annottext">[(FieldNameHS, Name)]
</span><a href="#local-6989586621679964172"><span class="hs-identifier hs-var">xs</span></a></span><span>
</span><span id="line-2407"></span><span>         </span><span class="hs-keyword">in</span><span> </span><span class="annot"><span class="annottext">Exp
</span><a href="#local-6989586621679964171"><span class="hs-identifier hs-var">front</span></a></span><span> </span><span class="annot"><span class="annottext">Exp -&gt; Exp -&gt; Exp
</span><span class="hs-operator hs-var">`AppE`</span></span><span> </span><span class="annot"><span class="annottext">Name -&gt; Exp
</span><span class="hs-identifier hs-var">VarE</span></span><span> </span><span class="annot"><span class="annottext">Name
</span><a href="#local-6989586621679964169"><span class="hs-identifier hs-var">col'</span></a></span><span>
</span><span id="line-2408"></span><span>
</span><span id="line-2409"></span><span class="annot"><a href="Database.Persist.TH.html#sqlTypeFunD"><span class="hs-identifier hs-type">sqlTypeFunD</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><span class="hs-identifier hs-type">Exp</span></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="hs-identifier hs-type">Dec</span></span><span>
</span><span id="line-2410"></span><span id="sqlTypeFunD"><span class="annot"><span class="annottext">sqlTypeFunD :: Exp -&gt; Dec
</span><a href="Database.Persist.TH.html#sqlTypeFunD"><span class="hs-identifier hs-var hs-var">sqlTypeFunD</span></a></span></span><span> </span><span id="local-6989586621679964167"><span class="annot"><span class="annottext">Exp
</span><a href="#local-6989586621679964167"><span class="hs-identifier hs-var">st</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">Name -&gt; [Clause] -&gt; Dec
</span><span class="hs-identifier hs-var">FunD</span></span><span> </span><span class="hs-special">'</span><span class="hs-identifier">sqlType</span><span>
</span><span id="line-2411"></span><span>                </span><span class="hs-special">[</span><span> </span><span class="annot"><span class="annottext">[Pat] -&gt; Exp -&gt; Clause
</span><a href="Database.Persist.TH.html#normalClause"><span class="hs-identifier hs-var">normalClause</span></a></span><span> </span><span class="hs-special">[</span><span class="annot"><span class="annottext">Pat
</span><span class="hs-identifier hs-var">WildP</span></span><span class="hs-special">]</span><span> </span><span class="annot"><span class="annottext">Exp
</span><a href="#local-6989586621679964167"><span class="hs-identifier hs-var">st</span></a></span><span> </span><span class="hs-special">]</span><span>
</span><span id="line-2412"></span><span>
</span><span id="line-2413"></span><span class="annot"><a href="Database.Persist.TH.html#typeInstanceD"><span class="hs-identifier hs-type">typeInstanceD</span></a></span><span>
</span><span id="line-2414"></span><span>    </span><span class="hs-glyph">::</span><span> </span><span class="annot"><span class="hs-identifier hs-type">Name</span></span><span>
</span><span id="line-2415"></span><span>    </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="hs-identifier hs-type">Bool</span></span><span> </span><span class="hs-comment">-- ^ include PersistStore backend constraint</span><span>
</span><span id="line-2416"></span><span>    </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="hs-identifier hs-type">Type</span></span><span>
</span><span id="line-2417"></span><span>    </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-special">[</span><span class="annot"><span class="hs-identifier hs-type">Dec</span></span><span class="hs-special">]</span><span>
</span><span id="line-2418"></span><span>    </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="hs-identifier hs-type">Dec</span></span><span>
</span><span id="line-2419"></span><span id="typeInstanceD"><span class="annot"><span class="annottext">typeInstanceD :: Name -&gt; Bool -&gt; Type -&gt; [Dec] -&gt; Dec
</span><a href="Database.Persist.TH.html#typeInstanceD"><span class="hs-identifier hs-var hs-var">typeInstanceD</span></a></span></span><span> </span><span id="local-6989586621679964165"><span class="annot"><span class="annottext">Name
</span><a href="#local-6989586621679964165"><span class="hs-identifier hs-var">clazz</span></a></span></span><span> </span><span id="local-6989586621679964164"><span class="annot"><span class="annottext">Bool
</span><a href="#local-6989586621679964164"><span class="hs-identifier hs-var">hasBackend</span></a></span></span><span> </span><span id="local-6989586621679964163"><span class="annot"><span class="annottext">Type
</span><a href="#local-6989586621679964163"><span class="hs-identifier hs-var">typ</span></a></span></span><span> </span><span class="hs-glyph">=</span><span>
</span><span id="line-2420"></span><span>    </span><span class="annot"><span class="annottext">[Type] -&gt; Type -&gt; [Dec] -&gt; Dec
</span><a href="Database.Persist.TH.html#instanceD"><span class="hs-identifier hs-var">instanceD</span></a></span><span> </span><span class="annot"><span class="annottext">[Type]
</span><a href="#local-6989586621679964162"><span class="hs-identifier hs-var">ctx</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Name -&gt; Type
</span><span class="hs-identifier hs-var">ConT</span></span><span> </span><span class="annot"><span class="annottext">Name
</span><a href="#local-6989586621679964165"><span class="hs-identifier hs-var">clazz</span></a></span><span> </span><span class="annot"><span class="annottext">Type -&gt; Type -&gt; Type
</span><span class="hs-operator hs-var">`AppT`</span></span><span> </span><span class="annot"><span class="annottext">Type
</span><a href="#local-6989586621679964163"><span class="hs-identifier hs-var">typ</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-2421"></span><span>  </span><span class="hs-keyword">where</span><span>
</span><span id="line-2422"></span><span>    </span><span id="local-6989586621679964162"><span class="annot"><span class="annottext">ctx :: [Type]
</span><a href="#local-6989586621679964162"><span class="hs-identifier hs-var hs-var">ctx</span></a></span></span><span>
</span><span id="line-2423"></span><span>        </span><span class="hs-glyph">|</span><span> </span><span class="annot"><span class="annottext">Bool
</span><a href="#local-6989586621679964164"><span class="hs-identifier hs-var">hasBackend</span></a></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-special">[</span><span class="annot"><span class="annottext">Name -&gt; [Type] -&gt; Type
</span><a href="Database.Persist.TH.html#mkClassP"><span class="hs-identifier hs-var">mkClassP</span></a></span><span> </span><span class="hs-special">''</span><span class="hs-identifier">PersistStore</span><span> </span><span class="hs-special">[</span><span class="annot"><span class="annottext">Type
</span><a href="Database.Persist.TH.html#backendT"><span class="hs-identifier hs-var">backendT</span></a></span><span class="hs-special">]</span><span class="hs-special">]</span><span>
</span><span id="line-2424"></span><span>        </span><span class="hs-glyph">|</span><span> </span><span class="annot"><span class="annottext">Bool
</span><span class="hs-identifier hs-var">otherwise</span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-special">[</span><span class="hs-special">]</span><span>
</span><span id="line-2425"></span><span>
</span><span id="line-2426"></span><span class="annot"><a href="Database.Persist.TH.html#persistFieldInstanceD"><span class="hs-identifier hs-type">persistFieldInstanceD</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><span class="hs-identifier hs-type">Bool</span></span><span> </span><span class="hs-comment">-- ^ include PersistStore backend constraint</span><span>
</span><span id="line-2427"></span><span>                      </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="hs-identifier hs-type">Type</span></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-special">[</span><span class="annot"><span class="hs-identifier hs-type">Dec</span></span><span class="hs-special">]</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="hs-identifier hs-type">Dec</span></span><span>
</span><span id="line-2428"></span><span id="persistFieldInstanceD"><span class="annot"><span class="annottext">persistFieldInstanceD :: Bool -&gt; Type -&gt; [Dec] -&gt; Dec
</span><a href="Database.Persist.TH.html#persistFieldInstanceD"><span class="hs-identifier hs-var hs-var">persistFieldInstanceD</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">Name -&gt; Bool -&gt; Type -&gt; [Dec] -&gt; Dec
</span><a href="Database.Persist.TH.html#typeInstanceD"><span class="hs-identifier hs-var">typeInstanceD</span></a></span><span> </span><span class="hs-special">''</span><span class="hs-identifier">PersistField</span><span>
</span><span id="line-2429"></span><span>
</span><span id="line-2430"></span><span class="annot"><a href="Database.Persist.TH.html#persistFieldSqlInstanceD"><span class="hs-identifier hs-type">persistFieldSqlInstanceD</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><span class="hs-identifier hs-type">Bool</span></span><span> </span><span class="hs-comment">-- ^ include PersistStore backend constraint</span><span>
</span><span id="line-2431"></span><span>                         </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="hs-identifier hs-type">Type</span></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-special">[</span><span class="annot"><span class="hs-identifier hs-type">Dec</span></span><span class="hs-special">]</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="hs-identifier hs-type">Dec</span></span><span>
</span><span id="line-2432"></span><span id="persistFieldSqlInstanceD"><span class="annot"><span class="annottext">persistFieldSqlInstanceD :: Bool -&gt; Type -&gt; [Dec] -&gt; Dec
</span><a href="Database.Persist.TH.html#persistFieldSqlInstanceD"><span class="hs-identifier hs-var hs-var">persistFieldSqlInstanceD</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">Name -&gt; Bool -&gt; Type -&gt; [Dec] -&gt; Dec
</span><a href="Database.Persist.TH.html#typeInstanceD"><span class="hs-identifier hs-var">typeInstanceD</span></a></span><span> </span><span class="hs-special">''</span><span class="hs-identifier">PersistFieldSql</span><span>
</span><span id="line-2433"></span><span>
</span><span id="line-2434"></span><span class="hs-comment">-- | Automatically creates a valid 'PersistField' instance for any datatype</span><span>
</span><span id="line-2435"></span><span class="hs-comment">-- that has valid 'Show' and 'Read' instances. Can be very convenient for</span><span>
</span><span id="line-2436"></span><span class="hs-comment">-- 'Enum' types.</span><span>
</span><span id="line-2437"></span><span class="annot"><a href="Database.Persist.TH.html#derivePersistField"><span class="hs-identifier hs-type">derivePersistField</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><span class="hs-identifier hs-type">String</span></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="hs-identifier hs-type">Q</span></span><span> </span><span class="hs-special">[</span><span class="annot"><span class="hs-identifier hs-type">Dec</span></span><span class="hs-special">]</span><span>
</span><span id="line-2438"></span><span id="derivePersistField"><span class="annot"><span class="annottext">derivePersistField :: String -&gt; Q [Dec]
</span><a href="Database.Persist.TH.html#derivePersistField"><span class="hs-identifier hs-var hs-var">derivePersistField</span></a></span></span><span> </span><span id="local-6989586621679964161"><span class="annot"><span class="annottext">String
</span><a href="#local-6989586621679964161"><span class="hs-identifier hs-var">s</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-keyword">do</span><span>
</span><span id="line-2439"></span><span>    </span><span id="local-6989586621679964160"><span class="annot"><span class="annottext">Exp
</span><a href="#local-6989586621679964160"><span class="hs-identifier hs-var">ss</span></a></span></span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="hs-special">[|</span><span class="hs-identifier">SqlString</span><span class="hs-special">|]</span><span>
</span><span id="line-2440"></span><span>    </span><span id="local-6989586621679964159"><span class="annot"><span class="annottext">Exp
</span><a href="#local-6989586621679964159"><span class="hs-identifier hs-var">tpv</span></a></span></span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="hs-special">[|</span><span class="hs-identifier">PersistText</span><span> </span><span class="hs-operator">.</span><span> </span><span class="hs-identifier">pack</span><span> </span><span class="hs-operator">.</span><span> </span><span class="hs-identifier">show</span><span class="hs-special">|]</span><span>
</span><span id="line-2441"></span><span>    </span><span id="local-6989586621679964158"><span class="annot"><span class="annottext">Exp
</span><a href="#local-6989586621679964158"><span class="hs-identifier hs-var">fpv</span></a></span></span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="hs-special">[|</span><span class="hs-glyph">\</span><span class="hs-identifier">dt</span><span> </span><span class="hs-identifier">v</span><span> </span><span class="hs-glyph">-&gt;</span><span>
</span><span id="line-2442"></span><span>                </span><span class="hs-keyword">case</span><span> </span><span class="hs-identifier">fromPersistValue</span><span> </span><span class="hs-identifier">v</span><span> </span><span class="hs-keyword">of</span><span>
</span><span id="line-2443"></span><span>                    </span><span class="hs-identifier">Left</span><span> </span><span class="hs-identifier">e</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-identifier">Left</span><span> </span><span class="hs-identifier">e</span><span>
</span><span id="line-2444"></span><span>                    </span><span class="hs-identifier">Right</span><span> </span><span class="hs-identifier">s'</span><span> </span><span class="hs-glyph">-&gt;</span><span>
</span><span id="line-2445"></span><span>                        </span><span class="hs-keyword">case</span><span> </span><span class="hs-identifier">reads</span><span> </span><span class="hs-operator">$</span><span> </span><span class="hs-identifier">unpack</span><span> </span><span class="hs-identifier">s'</span><span> </span><span class="hs-keyword">of</span><span>
</span><span id="line-2446"></span><span>                            </span><span class="hs-special">(</span><span class="hs-identifier">x</span><span class="hs-special">,</span><span> </span><span class="hs-identifier">_</span><span class="hs-special">)</span><span class="hs-glyph">:</span><span class="hs-identifier">_</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-identifier">Right</span><span> </span><span class="hs-identifier">x</span><span>
</span><span id="line-2447"></span><span>                            </span><span class="hs-special">[</span><span class="hs-special">]</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-identifier">Left</span><span> </span><span class="hs-operator">$</span><span> </span><span class="hs-identifier">pack</span><span> </span><span class="hs-string">&quot;Invalid &quot;</span><span> </span><span class="hs-operator">++</span><span> </span><span class="hs-identifier">pack</span><span> </span><span class="hs-identifier">dt</span><span> </span><span class="hs-operator">++</span><span> </span><span class="hs-identifier">pack</span><span> </span><span class="hs-string">&quot;: &quot;</span><span> </span><span class="hs-operator">++</span><span> </span><span class="hs-identifier">s'</span><span class="hs-special">|]</span><span>
</span><span id="line-2448"></span><span>    </span><span class="annot"><span class="annottext">forall (m :: * -&gt; *) a. Monad m =&gt; a -&gt; m a
</span><span class="hs-identifier hs-var">return</span></span><span>
</span><span id="line-2449"></span><span>        </span><span class="hs-special">[</span><span> </span><span class="annot"><span class="annottext">Bool -&gt; Type -&gt; [Dec] -&gt; Dec
</span><a href="Database.Persist.TH.html#persistFieldInstanceD"><span class="hs-identifier hs-var">persistFieldInstanceD</span></a></span><span> </span><span class="annot"><span class="annottext">Bool
</span><span class="hs-identifier hs-var">False</span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Name -&gt; Type
</span><span class="hs-identifier hs-var">ConT</span></span><span> </span><span class="annot"><span class="annottext">forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span> </span><span class="annot"><span class="annottext">String -&gt; Name
</span><span class="hs-identifier hs-var">mkName</span></span><span> </span><span class="annot"><span class="annottext">String
</span><a href="#local-6989586621679964161"><span class="hs-identifier hs-var">s</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-2450"></span><span>            </span><span class="hs-special">[</span><span> </span><span class="annot"><span class="annottext">Name -&gt; [Clause] -&gt; Dec
</span><span class="hs-identifier hs-var">FunD</span></span><span> </span><span class="hs-special">'</span><span class="hs-identifier">toPersistValue</span><span>
</span><span id="line-2451"></span><span>                </span><span class="hs-special">[</span><span> </span><span class="annot"><span class="annottext">[Pat] -&gt; Exp -&gt; Clause
</span><a href="Database.Persist.TH.html#normalClause"><span class="hs-identifier hs-var">normalClause</span></a></span><span> </span><span class="hs-special">[</span><span class="hs-special">]</span><span> </span><span class="annot"><span class="annottext">Exp
</span><a href="#local-6989586621679964159"><span class="hs-identifier hs-var">tpv</span></a></span><span>
</span><span id="line-2452"></span><span>                </span><span class="hs-special">]</span><span>
</span><span id="line-2453"></span><span>            </span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">Name -&gt; [Clause] -&gt; Dec
</span><span class="hs-identifier hs-var">FunD</span></span><span> </span><span class="hs-special">'</span><span class="hs-identifier">fromPersistValue</span><span>
</span><span id="line-2454"></span><span>                </span><span class="hs-special">[</span><span> </span><span class="annot"><span class="annottext">[Pat] -&gt; Exp -&gt; Clause
</span><a href="Database.Persist.TH.html#normalClause"><span class="hs-identifier hs-var">normalClause</span></a></span><span> </span><span class="hs-special">[</span><span class="hs-special">]</span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Exp
</span><a href="#local-6989586621679964158"><span class="hs-identifier hs-var">fpv</span></a></span><span> </span><span class="annot"><span class="annottext">Exp -&gt; Exp -&gt; Exp
</span><span class="hs-operator hs-var">`AppE`</span></span><span> </span><span class="annot"><span class="annottext">Lit -&gt; Exp
</span><span class="hs-identifier hs-var">LitE</span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">String -&gt; Lit
</span><span class="hs-identifier hs-var">StringL</span></span><span> </span><span class="annot"><span class="annottext">String
</span><a href="#local-6989586621679964161"><span class="hs-identifier hs-var">s</span></a></span><span class="hs-special">)</span><span class="hs-special">)</span><span>
</span><span id="line-2455"></span><span>                </span><span class="hs-special">]</span><span>
</span><span id="line-2456"></span><span>            </span><span class="hs-special">]</span><span>
</span><span id="line-2457"></span><span>        </span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">Bool -&gt; Type -&gt; [Dec] -&gt; Dec
</span><a href="Database.Persist.TH.html#persistFieldSqlInstanceD"><span class="hs-identifier hs-var">persistFieldSqlInstanceD</span></a></span><span> </span><span class="annot"><span class="annottext">Bool
</span><span class="hs-identifier hs-var">False</span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Name -&gt; Type
</span><span class="hs-identifier hs-var">ConT</span></span><span> </span><span class="annot"><span class="annottext">forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span> </span><span class="annot"><span class="annottext">String -&gt; Name
</span><span class="hs-identifier hs-var">mkName</span></span><span> </span><span class="annot"><span class="annottext">String
</span><a href="#local-6989586621679964161"><span class="hs-identifier hs-var">s</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-2458"></span><span>            </span><span class="hs-special">[</span><span> </span><span class="annot"><span class="annottext">Exp -&gt; Dec
</span><a href="Database.Persist.TH.html#sqlTypeFunD"><span class="hs-identifier hs-var">sqlTypeFunD</span></a></span><span> </span><span class="annot"><span class="annottext">Exp
</span><a href="#local-6989586621679964160"><span class="hs-identifier hs-var">ss</span></a></span><span>
</span><span id="line-2459"></span><span>            </span><span class="hs-special">]</span><span>
</span><span id="line-2460"></span><span>        </span><span class="hs-special">]</span><span>
</span><span id="line-2461"></span><span>
</span><span id="line-2462"></span><span class="hs-comment">-- | Automatically creates a valid 'PersistField' instance for any datatype</span><span>
</span><span id="line-2463"></span><span class="hs-comment">-- that has valid 'ToJSON' and 'FromJSON' instances. For a datatype @T@ it</span><span>
</span><span id="line-2464"></span><span class="hs-comment">-- generates instances similar to these:</span><span>
</span><span id="line-2465"></span><span class="hs-comment">--</span><span>
</span><span id="line-2466"></span><span class="hs-comment">-- @</span><span>
</span><span id="line-2467"></span><span class="hs-comment">--    instance PersistField T where</span><span>
</span><span id="line-2468"></span><span class="hs-comment">--        toPersistValue = PersistByteString . L.toStrict . encode</span><span>
</span><span id="line-2469"></span><span class="hs-comment">--        fromPersistValue = (left T.pack) . eitherDecodeStrict' &lt;=&lt; fromPersistValue</span><span>
</span><span id="line-2470"></span><span class="hs-comment">--    instance PersistFieldSql T where</span><span>
</span><span id="line-2471"></span><span class="hs-comment">--        sqlType _ = SqlString</span><span>
</span><span id="line-2472"></span><span class="hs-comment">-- @</span><span>
</span><span id="line-2473"></span><span class="annot"><a href="Database.Persist.TH.html#derivePersistFieldJSON"><span class="hs-identifier hs-type">derivePersistFieldJSON</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><span class="hs-identifier hs-type">String</span></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="hs-identifier hs-type">Q</span></span><span> </span><span class="hs-special">[</span><span class="annot"><span class="hs-identifier hs-type">Dec</span></span><span class="hs-special">]</span><span>
</span><span id="line-2474"></span><span id="derivePersistFieldJSON"><span class="annot"><span class="annottext">derivePersistFieldJSON :: String -&gt; Q [Dec]
</span><a href="Database.Persist.TH.html#derivePersistFieldJSON"><span class="hs-identifier hs-var hs-var">derivePersistFieldJSON</span></a></span></span><span> </span><span id="local-6989586621679964157"><span class="annot"><span class="annottext">String
</span><a href="#local-6989586621679964157"><span class="hs-identifier hs-var">s</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-keyword">do</span><span>
</span><span id="line-2475"></span><span>    </span><span id="local-6989586621679964156"><span class="annot"><span class="annottext">Exp
</span><a href="#local-6989586621679964156"><span class="hs-identifier hs-var">ss</span></a></span></span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="hs-special">[|</span><span class="hs-identifier">SqlString</span><span class="hs-special">|]</span><span>
</span><span id="line-2476"></span><span>    </span><span id="local-6989586621679964155"><span class="annot"><span class="annottext">Exp
</span><a href="#local-6989586621679964155"><span class="hs-identifier hs-var">tpv</span></a></span></span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="hs-special">[|</span><span class="hs-identifier">PersistText</span><span> </span><span class="hs-operator">.</span><span> </span><span class="hs-identifier">toJsonText</span><span class="hs-special">|]</span><span>
</span><span id="line-2477"></span><span>    </span><span id="local-6989586621679964154"><span class="annot"><span class="annottext">Exp
</span><a href="#local-6989586621679964154"><span class="hs-identifier hs-var">fpv</span></a></span></span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="hs-special">[|</span><span class="hs-glyph">\</span><span class="hs-identifier">dt</span><span> </span><span class="hs-identifier">v</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-keyword">do</span><span>
</span><span id="line-2478"></span><span>                </span><span class="hs-identifier">text</span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="hs-identifier">fromPersistValue</span><span> </span><span class="hs-identifier">v</span><span>
</span><span id="line-2479"></span><span>                </span><span class="hs-keyword">let</span><span> </span><span class="hs-identifier">bs'</span><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-identifier">TE.encodeUtf8</span><span> </span><span class="hs-identifier">text</span><span>
</span><span id="line-2480"></span><span>                </span><span class="hs-keyword">case</span><span> </span><span class="hs-identifier">eitherDecodeStrict'</span><span> </span><span class="hs-identifier">bs'</span><span> </span><span class="hs-keyword">of</span><span>
</span><span id="line-2481"></span><span>                    </span><span class="hs-identifier">Left</span><span> </span><span class="hs-identifier">e</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-identifier">Left</span><span> </span><span class="hs-operator">$</span><span> </span><span class="hs-identifier">pack</span><span> </span><span class="hs-string">&quot;JSON decoding error for &quot;</span><span> </span><span class="hs-operator">++</span><span> </span><span class="hs-identifier">pack</span><span> </span><span class="hs-identifier">dt</span><span> </span><span class="hs-operator">++</span><span> </span><span class="hs-identifier">pack</span><span> </span><span class="hs-string">&quot;: &quot;</span><span> </span><span class="hs-operator">++</span><span> </span><span class="hs-identifier">pack</span><span> </span><span class="hs-identifier">e</span><span> </span><span class="hs-operator">++</span><span> </span><span class="hs-identifier">pack</span><span> </span><span class="hs-string">&quot;. On Input: &quot;</span><span> </span><span class="hs-operator">++</span><span> </span><span class="hs-identifier">decodeUtf8</span><span> </span><span class="hs-identifier">bs'</span><span>
</span><span id="line-2482"></span><span>                    </span><span class="hs-identifier">Right</span><span> </span><span class="hs-identifier">x</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-identifier">Right</span><span> </span><span class="hs-identifier">x</span><span class="hs-special">|]</span><span>
</span><span id="line-2483"></span><span>    </span><span class="annot"><span class="annottext">forall (m :: * -&gt; *) a. Monad m =&gt; a -&gt; m a
</span><span class="hs-identifier hs-var">return</span></span><span>
</span><span id="line-2484"></span><span>        </span><span class="hs-special">[</span><span> </span><span class="annot"><span class="annottext">Bool -&gt; Type -&gt; [Dec] -&gt; Dec
</span><a href="Database.Persist.TH.html#persistFieldInstanceD"><span class="hs-identifier hs-var">persistFieldInstanceD</span></a></span><span> </span><span class="annot"><span class="annottext">Bool
</span><span class="hs-identifier hs-var">False</span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Name -&gt; Type
</span><span class="hs-identifier hs-var">ConT</span></span><span> </span><span class="annot"><span class="annottext">forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span> </span><span class="annot"><span class="annottext">String -&gt; Name
</span><span class="hs-identifier hs-var">mkName</span></span><span> </span><span class="annot"><span class="annottext">String
</span><a href="#local-6989586621679964157"><span class="hs-identifier hs-var">s</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-2485"></span><span>            </span><span class="hs-special">[</span><span> </span><span class="annot"><span class="annottext">Name -&gt; [Clause] -&gt; Dec
</span><span class="hs-identifier hs-var">FunD</span></span><span> </span><span class="hs-special">'</span><span class="hs-identifier">toPersistValue</span><span>
</span><span id="line-2486"></span><span>                </span><span class="hs-special">[</span><span> </span><span class="annot"><span class="annottext">[Pat] -&gt; Exp -&gt; Clause
</span><a href="Database.Persist.TH.html#normalClause"><span class="hs-identifier hs-var">normalClause</span></a></span><span> </span><span class="hs-special">[</span><span class="hs-special">]</span><span> </span><span class="annot"><span class="annottext">Exp
</span><a href="#local-6989586621679964155"><span class="hs-identifier hs-var">tpv</span></a></span><span>
</span><span id="line-2487"></span><span>                </span><span class="hs-special">]</span><span>
</span><span id="line-2488"></span><span>            </span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">Name -&gt; [Clause] -&gt; Dec
</span><span class="hs-identifier hs-var">FunD</span></span><span> </span><span class="hs-special">'</span><span class="hs-identifier">fromPersistValue</span><span>
</span><span id="line-2489"></span><span>                </span><span class="hs-special">[</span><span> </span><span class="annot"><span class="annottext">[Pat] -&gt; Exp -&gt; Clause
</span><a href="Database.Persist.TH.html#normalClause"><span class="hs-identifier hs-var">normalClause</span></a></span><span> </span><span class="hs-special">[</span><span class="hs-special">]</span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Exp
</span><a href="#local-6989586621679964154"><span class="hs-identifier hs-var">fpv</span></a></span><span> </span><span class="annot"><span class="annottext">Exp -&gt; Exp -&gt; Exp
</span><span class="hs-operator hs-var">`AppE`</span></span><span> </span><span class="annot"><span class="annottext">Lit -&gt; Exp
</span><span class="hs-identifier hs-var">LitE</span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">String -&gt; Lit
</span><span class="hs-identifier hs-var">StringL</span></span><span> </span><span class="annot"><span class="annottext">String
</span><a href="#local-6989586621679964157"><span class="hs-identifier hs-var">s</span></a></span><span class="hs-special">)</span><span class="hs-special">)</span><span>
</span><span id="line-2490"></span><span>                </span><span class="hs-special">]</span><span>
</span><span id="line-2491"></span><span>            </span><span class="hs-special">]</span><span>
</span><span id="line-2492"></span><span>        </span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">Bool -&gt; Type -&gt; [Dec] -&gt; Dec
</span><a href="Database.Persist.TH.html#persistFieldSqlInstanceD"><span class="hs-identifier hs-var">persistFieldSqlInstanceD</span></a></span><span> </span><span class="annot"><span class="annottext">Bool
</span><span class="hs-identifier hs-var">False</span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Name -&gt; Type
</span><span class="hs-identifier hs-var">ConT</span></span><span> </span><span class="annot"><span class="annottext">forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span> </span><span class="annot"><span class="annottext">String -&gt; Name
</span><span class="hs-identifier hs-var">mkName</span></span><span> </span><span class="annot"><span class="annottext">String
</span><a href="#local-6989586621679964157"><span class="hs-identifier hs-var">s</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-2493"></span><span>            </span><span class="hs-special">[</span><span> </span><span class="annot"><span class="annottext">Exp -&gt; Dec
</span><a href="Database.Persist.TH.html#sqlTypeFunD"><span class="hs-identifier hs-var">sqlTypeFunD</span></a></span><span> </span><span class="annot"><span class="annottext">Exp
</span><a href="#local-6989586621679964156"><span class="hs-identifier hs-var">ss</span></a></span><span>
</span><span id="line-2494"></span><span>            </span><span class="hs-special">]</span><span>
</span><span id="line-2495"></span><span>        </span><span class="hs-special">]</span><span>
</span><span id="line-2496"></span><span>
</span><span id="line-2497"></span><span class="hs-comment">-- | The basic function for migrating models, no Template Haskell required.</span><span>
</span><span id="line-2498"></span><span class="hs-comment">--</span><span>
</span><span id="line-2499"></span><span class="hs-comment">-- It's probably best to use this in concert with 'mkEntityDefList', and then</span><span>
</span><span id="line-2500"></span><span class="hs-comment">-- call 'migrateModels' with the result from that function.</span><span>
</span><span id="line-2501"></span><span class="hs-comment">--</span><span>
</span><span id="line-2502"></span><span class="hs-comment">-- @</span><span>
</span><span id="line-2503"></span><span class="hs-comment">-- share [mkPersist sqlSettings, mkEntityDefList &quot;entities&quot;] [persistLowerCase| ... |]</span><span>
</span><span id="line-2504"></span><span class="hs-comment">--</span><span>
</span><span id="line-2505"></span><span class="hs-comment">-- migrateAll = 'migrateModels' entities</span><span>
</span><span id="line-2506"></span><span class="hs-comment">-- @</span><span>
</span><span id="line-2507"></span><span class="hs-comment">--</span><span>
</span><span id="line-2508"></span><span class="hs-comment">-- The function 'mkMigrate' currently implements exactly this behavior now. If</span><span>
</span><span id="line-2509"></span><span class="hs-comment">-- you're splitting up the entity definitions into separate files, then it is</span><span>
</span><span id="line-2510"></span><span class="hs-comment">-- better to use the entity definition list and the concatenate all the models</span><span>
</span><span id="line-2511"></span><span class="hs-comment">-- together into a big list to call with 'migrateModels'.</span><span>
</span><span id="line-2512"></span><span class="hs-comment">--</span><span>
</span><span id="line-2513"></span><span class="hs-comment">-- @</span><span>
</span><span id="line-2514"></span><span class="hs-comment">-- module Foo where</span><span>
</span><span id="line-2515"></span><span class="hs-comment">--</span><span>
</span><span id="line-2516"></span><span class="hs-comment">--     share [mkPersist s, mkEntityDefList &quot;fooModels&quot;] ...</span><span>
</span><span id="line-2517"></span><span class="hs-comment">--</span><span>
</span><span id="line-2518"></span><span class="hs-comment">--</span><span>
</span><span id="line-2519"></span><span class="hs-comment">-- module Bar where</span><span>
</span><span id="line-2520"></span><span class="hs-comment">--</span><span>
</span><span id="line-2521"></span><span class="hs-comment">--     share [mkPersist s, mkEntityDefList &quot;barModels&quot;] ...</span><span>
</span><span id="line-2522"></span><span class="hs-comment">--</span><span>
</span><span id="line-2523"></span><span class="hs-comment">-- module Migration where</span><span>
</span><span id="line-2524"></span><span class="hs-comment">--</span><span>
</span><span id="line-2525"></span><span class="hs-comment">--     import Foo</span><span>
</span><span id="line-2526"></span><span class="hs-comment">--     import Bar</span><span>
</span><span id="line-2527"></span><span class="hs-comment">--</span><span>
</span><span id="line-2528"></span><span class="hs-comment">--     migrateAll = migrateModels (fooModels &lt;&gt; barModels)</span><span>
</span><span id="line-2529"></span><span class="hs-comment">-- @</span><span>
</span><span id="line-2530"></span><span class="hs-comment">--</span><span>
</span><span id="line-2531"></span><span class="hs-comment">-- @since 2.13.0.0</span><span>
</span><span id="line-2532"></span><span class="annot"><a href="Database.Persist.TH.html#migrateModels"><span class="hs-identifier hs-type">migrateModels</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="hs-special">[</span><span class="annot"><a href="Database.Persist.Types.Base.html#EntityDef"><span class="hs-identifier hs-type">EntityDef</span></a></span><span class="hs-special">]</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="Database.Persist.Sql.Migration.html#Migration"><span class="hs-identifier hs-type">Migration</span></a></span><span>
</span><span id="line-2533"></span><span id="migrateModels"><span class="annot"><span class="annottext">migrateModels :: [EntityDef] -&gt; Migration
</span><a href="Database.Persist.TH.html#migrateModels"><span class="hs-identifier hs-var hs-var">migrateModels</span></a></span></span><span> </span><span id="local-6989586621679964153"><span class="annot"><span class="annottext">[EntityDef]
</span><a href="#local-6989586621679964153"><span class="hs-identifier hs-var">defs</span></a></span></span><span class="hs-glyph">=</span><span>
</span><span id="line-2534"></span><span>    </span><span class="annot"><span class="annottext">forall (t :: * -&gt; *) (m :: * -&gt; *) a b.
(Foldable t, Monad m) =&gt;
t a -&gt; (a -&gt; m b) -&gt; m ()
</span><span class="hs-identifier hs-var">forM_</span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">forall a. (a -&gt; Bool) -&gt; [a] -&gt; [a]
</span><span class="hs-identifier hs-var">filter</span></span><span> </span><span class="annot"><span class="annottext">EntityDef -&gt; Bool
</span><a href="#local-6989586621679964151"><span class="hs-identifier hs-var">isMigrated</span></a></span><span> </span><span class="annot"><span class="annottext">[EntityDef]
</span><a href="#local-6989586621679964153"><span class="hs-identifier hs-var">defs</span></a></span><span class="hs-special">)</span><span> </span><span class="annot"><span class="annottext">forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span> </span><span class="hs-glyph">\</span><span id="local-6989586621679964150"><span class="annot"><span class="annottext">EntityDef
</span><a href="#local-6989586621679964150"><span class="hs-identifier hs-var">def</span></a></span></span><span> </span><span class="hs-glyph">-&gt;</span><span>
</span><span id="line-2535"></span><span>        </span><span class="annot"><span class="annottext">[EntityDef] -&gt; EntityDef -&gt; Migration
</span><a href="Database.Persist.Sql.Migration.html#migrate"><span class="hs-identifier hs-var">migrate</span></a></span><span> </span><span class="annot"><span class="annottext">[EntityDef]
</span><a href="#local-6989586621679964153"><span class="hs-identifier hs-var">defs</span></a></span><span> </span><span class="annot"><span class="annottext">EntityDef
</span><a href="#local-6989586621679964150"><span class="hs-identifier hs-var">def</span></a></span><span>
</span><span id="line-2536"></span><span>  </span><span class="hs-keyword">where</span><span>
</span><span id="line-2537"></span><span>    </span><span id="local-6989586621679964151"><span class="annot"><span class="annottext">isMigrated :: EntityDef -&gt; Bool
</span><a href="#local-6989586621679964151"><span class="hs-identifier hs-var hs-var">isMigrated</span></a></span></span><span> </span><span id="local-6989586621679964147"><span class="annot"><span class="annottext">EntityDef
</span><a href="#local-6989586621679964147"><span class="hs-identifier hs-var">def</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">String -&gt; Text
</span><span class="hs-identifier hs-var">pack</span></span><span> </span><span class="annot"><span class="annottext">String
</span><span class="hs-string">&quot;no-migrate&quot;</span></span><span> </span><span class="annot"><span class="annottext">forall (t :: * -&gt; *) a. (Foldable t, Eq a) =&gt; a -&gt; t a -&gt; Bool
</span><span class="hs-operator hs-var">`notElem`</span></span><span> </span><span class="annot"><span class="annottext">EntityDef -&gt; [Text]
</span><a href="Database.Persist.Types.Base.html#entityAttrs"><span class="hs-identifier hs-var">entityAttrs</span></a></span><span> </span><span class="annot"><span class="annottext">EntityDef
</span><a href="#local-6989586621679964147"><span class="hs-identifier hs-var">def</span></a></span><span>
</span><span id="line-2538"></span><span>
</span><span id="line-2539"></span><span class="hs-comment">-- | Creates a single function to perform all migrations for the entities</span><span>
</span><span id="line-2540"></span><span class="hs-comment">-- defined here. One thing to be aware of is dependencies: if you have entities</span><span>
</span><span id="line-2541"></span><span class="hs-comment">-- with foreign references, make sure to place those definitions after the</span><span>
</span><span id="line-2542"></span><span class="hs-comment">-- entities they reference.</span><span>
</span><span id="line-2543"></span><span class="hs-comment">--</span><span>
</span><span id="line-2544"></span><span class="hs-comment">-- In @persistent-2.13.0.0@, this was changed to *ignore* the input entity def</span><span>
</span><span id="line-2545"></span><span class="hs-comment">-- list, and instead defer to 'mkEntityDefList' to get the correct entities.</span><span>
</span><span id="line-2546"></span><span class="hs-comment">-- This avoids problems where the QuasiQuoter is unable to know what the right</span><span>
</span><span id="line-2547"></span><span class="hs-comment">-- reference types are. This sets 'mkPersist' to be the &quot;single source of truth&quot;</span><span>
</span><span id="line-2548"></span><span class="hs-comment">-- for entity definitions.</span><span>
</span><span id="line-2549"></span><span class="annot"><a href="Database.Persist.TH.html#mkMigrate"><span class="hs-identifier hs-type">mkMigrate</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><span class="hs-identifier hs-type">String</span></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-special">[</span><span class="annot"><a href="Database.Persist.Quasi.Internal.html#UnboundEntityDef"><span class="hs-identifier hs-type">UnboundEntityDef</span></a></span><span class="hs-special">]</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="hs-identifier hs-type">Q</span></span><span> </span><span class="hs-special">[</span><span class="annot"><span class="hs-identifier hs-type">Dec</span></span><span class="hs-special">]</span><span>
</span><span id="line-2550"></span><span id="mkMigrate"><span class="annot"><span class="annottext">mkMigrate :: String -&gt; [UnboundEntityDef] -&gt; Q [Dec]
</span><a href="Database.Persist.TH.html#mkMigrate"><span class="hs-identifier hs-var hs-var">mkMigrate</span></a></span></span><span> </span><span id="local-6989586621679964145"><span class="annot"><span class="annottext">String
</span><a href="#local-6989586621679964145"><span class="hs-identifier hs-var">fun</span></a></span></span><span> </span><span id="local-6989586621679964144"><span class="annot"><span class="annottext">[UnboundEntityDef]
</span><a href="#local-6989586621679964144"><span class="hs-identifier hs-var">eds</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-keyword">do</span><span>
</span><span id="line-2551"></span><span>    </span><span class="hs-keyword">let</span><span> </span><span id="local-6989586621679964143"><span class="annot"><span class="annottext">entityDefListName :: String
</span><a href="#local-6989586621679964143"><span class="hs-identifier hs-var hs-var">entityDefListName</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">String
</span><span class="hs-string">&quot;entityDefListFor&quot;</span></span><span> </span><span class="annot"><span class="annottext">forall a. Semigroup a =&gt; a -&gt; a -&gt; a
</span><span class="hs-operator hs-var">&lt;&gt;</span></span><span> </span><span class="annot"><span class="annottext">String
</span><a href="#local-6989586621679964145"><span class="hs-identifier hs-var">fun</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-2552"></span><span>    </span><span id="local-6989586621679964142"><span class="annot"><span class="annottext">Exp
</span><a href="#local-6989586621679964142"><span class="hs-identifier hs-var">body</span></a></span></span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="hs-special">[|</span><span> </span><span class="hs-identifier">migrateModels</span><span> </span><span class="hs-special">$</span><span class="hs-special">(</span><span class="hs-identifier">varE</span><span> </span><span class="hs-special">(</span><span class="hs-identifier">mkName</span><span> </span><span class="hs-identifier">entityDefListName</span><span class="hs-special">)</span><span class="hs-special">)</span><span> </span><span class="hs-special">|]</span><span>
</span><span id="line-2553"></span><span>    </span><span id="local-6989586621679964141"><span class="annot"><span class="annottext">[Dec]
</span><a href="#local-6989586621679964141"><span class="hs-identifier hs-var">edList</span></a></span></span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">String -&gt; [UnboundEntityDef] -&gt; Q [Dec]
</span><a href="Database.Persist.TH.html#mkEntityDefList"><span class="hs-identifier hs-var">mkEntityDefList</span></a></span><span> </span><span class="annot"><span class="annottext">String
</span><a href="#local-6989586621679964143"><span class="hs-identifier hs-var">entityDefListName</span></a></span><span> </span><span class="annot"><span class="annottext">[UnboundEntityDef]
</span><a href="#local-6989586621679964144"><span class="hs-identifier hs-var">eds</span></a></span><span>
</span><span id="line-2554"></span><span>    </span><span class="annot"><span class="annottext">forall (f :: * -&gt; *) a. Applicative f =&gt; a -&gt; f a
</span><span class="hs-identifier hs-var">pure</span></span><span> </span><span class="annot"><span class="annottext">forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span> </span><span class="annot"><span class="annottext">[Dec]
</span><a href="#local-6989586621679964141"><span class="hs-identifier hs-var">edList</span></a></span><span> </span><span class="annot"><span class="annottext">forall a. Semigroup a =&gt; a -&gt; a -&gt; a
</span><span class="hs-operator hs-var">&lt;&gt;</span></span><span>
</span><span id="line-2555"></span><span>        </span><span class="hs-special">[</span><span> </span><span class="annot"><span class="annottext">Name -&gt; Type -&gt; Dec
</span><span class="hs-identifier hs-var">SigD</span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">String -&gt; Name
</span><span class="hs-identifier hs-var">mkName</span></span><span> </span><span class="annot"><span class="annottext">String
</span><a href="#local-6989586621679964145"><span class="hs-identifier hs-var">fun</span></a></span><span class="hs-special">)</span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Name -&gt; Type
</span><span class="hs-identifier hs-var">ConT</span></span><span> </span><span class="hs-special">''</span><span class="hs-identifier">Migration</span><span class="hs-special">)</span><span>
</span><span id="line-2556"></span><span>        </span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">Name -&gt; [Clause] -&gt; Dec
</span><span class="hs-identifier hs-var">FunD</span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">String -&gt; Name
</span><span class="hs-identifier hs-var">mkName</span></span><span> </span><span class="annot"><span class="annottext">String
</span><a href="#local-6989586621679964145"><span class="hs-identifier hs-var">fun</span></a></span><span class="hs-special">)</span><span> </span><span class="hs-special">[</span><span class="annot"><span class="annottext">[Pat] -&gt; Exp -&gt; Clause
</span><a href="Database.Persist.TH.html#normalClause"><span class="hs-identifier hs-var">normalClause</span></a></span><span> </span><span class="hs-special">[</span><span class="hs-special">]</span><span> </span><span class="annot"><span class="annottext">Exp
</span><a href="#local-6989586621679964142"><span class="hs-identifier hs-var">body</span></a></span><span class="hs-special">]</span><span>
</span><span id="line-2557"></span><span>        </span><span class="hs-special">]</span><span>
</span><span id="line-2558"></span><span>
</span><span id="line-2559"></span><span class="hs-keyword">data</span><span> </span><span id="EntityFieldTH"><span class="annot"><a href="Database.Persist.TH.html#EntityFieldTH"><span class="hs-identifier hs-var">EntityFieldTH</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span id="EntityFieldTH"><span class="annot"><a href="Database.Persist.TH.html#EntityFieldTH"><span class="hs-identifier hs-var">EntityFieldTH</span></a></span></span><span>
</span><span id="line-2560"></span><span>    </span><span class="hs-special">{</span><span> </span><span id="entityFieldTHCon"><span class="annot"><span class="annottext">EntityFieldTH -&gt; Con
</span><a href="Database.Persist.TH.html#entityFieldTHCon"><span class="hs-identifier hs-var hs-var">entityFieldTHCon</span></a></span></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><span class="hs-identifier hs-type">Con</span></span><span>
</span><span id="line-2561"></span><span>    </span><span class="hs-special">,</span><span> </span><span id="entityFieldTHClause"><span class="annot"><span class="annottext">EntityFieldTH -&gt; Clause
</span><a href="Database.Persist.TH.html#entityFieldTHClause"><span class="hs-identifier hs-var hs-var">entityFieldTHClause</span></a></span></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><span class="hs-identifier hs-type">Clause</span></span><span>
</span><span id="line-2562"></span><span>    </span><span class="hs-special">}</span><span>
</span><span id="line-2563"></span><span>
</span><span id="line-2564"></span><span class="hs-comment">-- Ent</span><span>
</span><span id="line-2565"></span><span class="hs-comment">--   fieldName FieldType</span><span>
</span><span id="line-2566"></span><span class="hs-comment">--</span><span>
</span><span id="line-2567"></span><span class="hs-comment">-- forall . typ ~ FieldType =&gt; EntFieldName</span><span>
</span><span id="line-2568"></span><span class="hs-comment">--</span><span>
</span><span id="line-2569"></span><span class="hs-comment">-- EntFieldName = FieldDef ....</span><span>
</span><span id="line-2570"></span><span class="hs-comment">--</span><span>
</span><span id="line-2571"></span><span class="hs-comment">-- Field Def Accessors Required:</span><span>
</span><span id="line-2572"></span><span class="annot"><a href="Database.Persist.TH.html#mkField"><span class="hs-identifier hs-type">mkField</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><a href="Database.Persist.TH.html#MkPersistSettings"><span class="hs-identifier hs-type">MkPersistSettings</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="Database.Persist.TH.html#EntityMap"><span class="hs-identifier hs-type">EntityMap</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="Database.Persist.Quasi.Internal.html#UnboundEntityDef"><span class="hs-identifier hs-type">UnboundEntityDef</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="Database.Persist.Quasi.Internal.html#UnboundFieldDef"><span class="hs-identifier hs-type">UnboundFieldDef</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="hs-identifier hs-type">Q</span></span><span> </span><span class="annot"><a href="Database.Persist.TH.html#EntityFieldTH"><span class="hs-identifier hs-type">EntityFieldTH</span></a></span><span>
</span><span id="line-2573"></span><span id="mkField"><span class="annot"><span class="annottext">mkField :: MkPersistSettings
-&gt; EntityMap
-&gt; UnboundEntityDef
-&gt; UnboundFieldDef
-&gt; Q EntityFieldTH
</span><a href="Database.Persist.TH.html#mkField"><span class="hs-identifier hs-var hs-var">mkField</span></a></span></span><span> </span><span id="local-6989586621679964139"><span class="annot"><span class="annottext">MkPersistSettings
</span><a href="#local-6989586621679964139"><span class="hs-identifier hs-var">mps</span></a></span></span><span> </span><span id="local-6989586621679964138"><span class="annot"><span class="annottext">EntityMap
</span><a href="#local-6989586621679964138"><span class="hs-identifier hs-var">entityMap</span></a></span></span><span> </span><span id="local-6989586621679964137"><span class="annot"><span class="annottext">UnboundEntityDef
</span><a href="#local-6989586621679964137"><span class="hs-identifier hs-var">et</span></a></span></span><span> </span><span id="local-6989586621679964136"><span class="annot"><span class="annottext">UnboundFieldDef
</span><a href="#local-6989586621679964136"><span class="hs-identifier hs-var">fieldDef</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-keyword">do</span><span>
</span><span id="line-2574"></span><span>    </span><span class="hs-keyword">let</span><span>
</span><span id="line-2575"></span><span>        </span><span id="local-6989586621679964135"><span class="annot"><span class="annottext">con :: Con
</span><a href="#local-6989586621679964135"><span class="hs-identifier hs-var hs-var">con</span></a></span></span><span> </span><span class="hs-glyph">=</span><span>
</span><span id="line-2576"></span><span>            </span><span class="annot"><span class="annottext">[TyVarBndr Specificity] -&gt; [Type] -&gt; Con -&gt; Con
</span><span class="hs-identifier hs-var">ForallC</span></span><span>
</span><span id="line-2577"></span><span>                </span><span class="hs-special">[</span><span class="hs-special">]</span><span>
</span><span id="line-2578"></span><span>                </span><span class="hs-special">[</span><span class="annot"><span class="annottext">Type -&gt; Type -&gt; Type
</span><a href="Database.Persist.TH.html#mkEqualP"><span class="hs-identifier hs-var">mkEqualP</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Name -&gt; Type
</span><span class="hs-identifier hs-var">VarT</span></span><span> </span><span class="annot"><span class="annottext">forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span> </span><span class="annot"><span class="annottext">String -&gt; Name
</span><span class="hs-identifier hs-var">mkName</span></span><span> </span><span class="annot"><span class="annottext">String
</span><span class="hs-string">&quot;typ&quot;</span></span><span class="hs-special">)</span><span> </span><span class="annot"><span class="annottext">Type
</span><a href="#local-6989586621679964133"><span class="hs-identifier hs-var">fieldT</span></a></span><span class="hs-special">]</span><span>
</span><span id="line-2579"></span><span>                </span><span class="annot"><span class="annottext">forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span> </span><span class="annot"><span class="annottext">Name -&gt; [BangType] -&gt; Con
</span><span class="hs-identifier hs-var">NormalC</span></span><span> </span><span class="annot"><span class="annottext">Name
</span><a href="#local-6989586621679964132"><span class="hs-identifier hs-var">name</span></a></span><span> </span><span class="hs-special">[</span><span class="hs-special">]</span><span>
</span><span id="line-2580"></span><span>        </span><span id="local-6989586621679964133"><span class="annot"><span class="annottext">fieldT :: Type
</span><a href="#local-6989586621679964133"><span class="hs-identifier hs-var hs-var">fieldT</span></a></span></span><span> </span><span class="hs-glyph">=</span><span>
</span><span id="line-2581"></span><span>            </span><span class="annot"><span class="annottext">MkPersistSettings
-&gt; EntityMap
-&gt; UnboundFieldDef
-&gt; Maybe Name
-&gt; Maybe IsNullable
-&gt; Type
</span><a href="Database.Persist.TH.html#maybeIdType"><span class="hs-identifier hs-var">maybeIdType</span></a></span><span> </span><span class="annot"><span class="annottext">MkPersistSettings
</span><a href="#local-6989586621679964139"><span class="hs-identifier hs-var">mps</span></a></span><span> </span><span class="annot"><span class="annottext">EntityMap
</span><a href="#local-6989586621679964138"><span class="hs-identifier hs-var">entityMap</span></a></span><span> </span><span class="annot"><span class="annottext">UnboundFieldDef
</span><a href="#local-6989586621679964136"><span class="hs-identifier hs-var">fieldDef</span></a></span><span> </span><span class="annot"><span class="annottext">forall a. Maybe a
</span><span class="hs-identifier hs-var">Nothing</span></span><span> </span><span class="annot"><span class="annottext">forall a. Maybe a
</span><span class="hs-identifier hs-var">Nothing</span></span><span>
</span><span id="line-2582"></span><span>    </span><span id="local-6989586621679964131"><span class="annot"><span class="annottext">Exp
</span><a href="#local-6989586621679964131"><span class="hs-identifier hs-var">bod</span></a></span></span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">UnboundEntityDef -&gt; FieldNameHS -&gt; Q Exp
</span><a href="Database.Persist.TH.html#mkLookupEntityField"><span class="hs-identifier hs-var">mkLookupEntityField</span></a></span><span> </span><span class="annot"><span class="annottext">UnboundEntityDef
</span><a href="#local-6989586621679964137"><span class="hs-identifier hs-var">et</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">UnboundFieldDef -&gt; FieldNameHS
</span><a href="Database.Persist.Quasi.Internal.html#unboundFieldNameHS"><span class="hs-identifier hs-var">unboundFieldNameHS</span></a></span><span> </span><span class="annot"><span class="annottext">UnboundFieldDef
</span><a href="#local-6989586621679964136"><span class="hs-identifier hs-var">fieldDef</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-2583"></span><span>    </span><span class="hs-keyword">let</span><span> </span><span id="local-6989586621679964130"><span class="annot"><span class="annottext">cla :: Clause
</span><a href="#local-6989586621679964130"><span class="hs-identifier hs-var hs-var">cla</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">[Pat] -&gt; Exp -&gt; Clause
</span><a href="Database.Persist.TH.html#normalClause"><span class="hs-identifier hs-var">normalClause</span></a></span><span>
</span><span id="line-2584"></span><span>                </span><span class="hs-special">[</span><span class="annot"><span class="annottext">Name -&gt; [Pat] -&gt; Pat
</span><a href="Database.Persist.TH.html#conp"><span class="hs-identifier hs-var">conp</span></a></span><span> </span><span class="annot"><span class="annottext">Name
</span><a href="#local-6989586621679964132"><span class="hs-identifier hs-var">name</span></a></span><span> </span><span class="hs-special">[</span><span class="hs-special">]</span><span class="hs-special">]</span><span>
</span><span id="line-2585"></span><span>                </span><span class="annot"><span class="annottext">Exp
</span><a href="#local-6989586621679964131"><span class="hs-identifier hs-var">bod</span></a></span><span>
</span><span id="line-2586"></span><span>    </span><span class="annot"><span class="annottext">forall (m :: * -&gt; *) a. Monad m =&gt; a -&gt; m a
</span><span class="hs-identifier hs-var">return</span></span><span> </span><span class="annot"><span class="annottext">forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span> </span><span class="annot"><span class="annottext">Con -&gt; Clause -&gt; EntityFieldTH
</span><a href="Database.Persist.TH.html#EntityFieldTH"><span class="hs-identifier hs-var">EntityFieldTH</span></a></span><span> </span><span class="annot"><span class="annottext">Con
</span><a href="#local-6989586621679964135"><span class="hs-identifier hs-var">con</span></a></span><span> </span><span class="annot"><span class="annottext">Clause
</span><a href="#local-6989586621679964130"><span class="hs-identifier hs-var">cla</span></a></span><span>
</span><span id="line-2587"></span><span>  </span><span class="hs-keyword">where</span><span>
</span><span id="line-2588"></span><span>    </span><span id="local-6989586621679964132"><span class="annot"><span class="annottext">name :: Name
</span><a href="#local-6989586621679964132"><span class="hs-identifier hs-var hs-var">name</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">MkPersistSettings -&gt; UnboundEntityDef -&gt; UnboundFieldDef -&gt; Name
</span><a href="Database.Persist.TH.html#filterConName"><span class="hs-identifier hs-var">filterConName</span></a></span><span> </span><span class="annot"><span class="annottext">MkPersistSettings
</span><a href="#local-6989586621679964139"><span class="hs-identifier hs-var">mps</span></a></span><span> </span><span class="annot"><span class="annottext">UnboundEntityDef
</span><a href="#local-6989586621679964137"><span class="hs-identifier hs-var">et</span></a></span><span> </span><span class="annot"><span class="annottext">UnboundFieldDef
</span><a href="#local-6989586621679964136"><span class="hs-identifier hs-var">fieldDef</span></a></span><span>
</span><span id="line-2589"></span><span>
</span><span id="line-2590"></span><span class="annot"><a href="Database.Persist.TH.html#mkIdField"><span class="hs-identifier hs-type">mkIdField</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><a href="Database.Persist.TH.html#MkPersistSettings"><span class="hs-identifier hs-type">MkPersistSettings</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="Database.Persist.Quasi.Internal.html#UnboundEntityDef"><span class="hs-identifier hs-type">UnboundEntityDef</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="hs-identifier hs-type">Q</span></span><span> </span><span class="annot"><a href="Database.Persist.TH.html#EntityFieldTH"><span class="hs-identifier hs-type">EntityFieldTH</span></a></span><span>
</span><span id="line-2591"></span><span id="mkIdField"><span class="annot"><span class="annottext">mkIdField :: MkPersistSettings -&gt; UnboundEntityDef -&gt; Q EntityFieldTH
</span><a href="Database.Persist.TH.html#mkIdField"><span class="hs-identifier hs-var hs-var">mkIdField</span></a></span></span><span> </span><span id="local-6989586621679964129"><span class="annot"><span class="annottext">MkPersistSettings
</span><a href="#local-6989586621679964129"><span class="hs-identifier hs-var">mps</span></a></span></span><span> </span><span id="local-6989586621679964128"><span class="annot"><span class="annottext">UnboundEntityDef
</span><a href="#local-6989586621679964128"><span class="hs-identifier hs-var">ued</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-keyword">do</span><span>
</span><span id="line-2592"></span><span>    </span><span class="hs-keyword">let</span><span>
</span><span id="line-2593"></span><span>        </span><span id="local-6989586621679964127"><span class="annot"><span class="annottext">entityName :: EntityNameHS
</span><a href="#local-6989586621679964127"><span class="hs-identifier hs-var hs-var">entityName</span></a></span></span><span> </span><span class="hs-glyph">=</span><span>
</span><span id="line-2594"></span><span>            </span><span class="annot"><span class="annottext">UnboundEntityDef -&gt; EntityNameHS
</span><a href="Database.Persist.Quasi.Internal.html#getUnboundEntityNameHS"><span class="hs-identifier hs-var">getUnboundEntityNameHS</span></a></span><span> </span><span class="annot"><span class="annottext">UnboundEntityDef
</span><a href="#local-6989586621679964128"><span class="hs-identifier hs-var">ued</span></a></span><span>
</span><span id="line-2595"></span><span>        </span><span id="local-6989586621679964126"><span class="annot"><span class="annottext">entityIdType :: Type
</span><a href="#local-6989586621679964126"><span class="hs-identifier hs-var hs-var">entityIdType</span></a></span></span><span>
</span><span id="line-2596"></span><span>            </span><span class="hs-glyph">|</span><span> </span><span class="annot"><span class="annottext">MkPersistSettings -&gt; Bool
</span><a href="Database.Persist.TH.html#mpsGeneric"><span class="hs-identifier hs-var">mpsGeneric</span></a></span><span> </span><span class="annot"><span class="annottext">MkPersistSettings
</span><a href="#local-6989586621679964129"><span class="hs-identifier hs-var">mps</span></a></span><span> </span><span class="hs-glyph">=</span><span>
</span><span id="line-2597"></span><span>                </span><span class="annot"><span class="annottext">Name -&gt; Type
</span><span class="hs-identifier hs-var">ConT</span></span><span> </span><span class="hs-special">''</span><span class="hs-identifier">Key</span><span> </span><span class="annot"><span class="annottext">Type -&gt; Type -&gt; Type
</span><span class="hs-operator hs-var">`AppT`</span></span><span> </span><span class="hs-special">(</span><span>
</span><span id="line-2598"></span><span>                    </span><span class="annot"><span class="annottext">Name -&gt; Type
</span><span class="hs-identifier hs-var">ConT</span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">EntityNameHS -&gt; Name
</span><a href="Database.Persist.TH.html#mkEntityNameHSGenericName"><span class="hs-identifier hs-var">mkEntityNameHSGenericName</span></a></span><span> </span><span class="annot"><span class="annottext">EntityNameHS
</span><a href="#local-6989586621679964127"><span class="hs-identifier hs-var">entityName</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-2599"></span><span>                    </span><span class="annot"><span class="annottext">Type -&gt; Type -&gt; Type
</span><span class="hs-operator hs-var">`AppT`</span></span><span> </span><span class="annot"><span class="annottext">Type
</span><a href="Database.Persist.TH.html#backendT"><span class="hs-identifier hs-var">backendT</span></a></span><span>
</span><span id="line-2600"></span><span>                </span><span class="hs-special">)</span><span>
</span><span id="line-2601"></span><span>            </span><span class="hs-glyph">|</span><span> </span><span class="annot"><span class="annottext">Bool
</span><span class="hs-identifier hs-var">otherwise</span></span><span> </span><span class="hs-glyph">=</span><span>
</span><span id="line-2602"></span><span>                </span><span class="annot"><span class="annottext">Name -&gt; Type
</span><span class="hs-identifier hs-var">ConT</span></span><span> </span><span class="annot"><span class="annottext">forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span> </span><span class="annot"><span class="annottext">String -&gt; Name
</span><span class="hs-identifier hs-var">mkName</span></span><span> </span><span class="annot"><span class="annottext">forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Text -&gt; String
</span><span class="hs-identifier hs-var">T.unpack</span></span><span> </span><span class="annot"><span class="annottext">forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span> </span><span class="annot"><span class="annottext">EntityNameHS -&gt; Text
</span><a href="Database.Persist.Names.html#unEntityNameHS"><span class="hs-identifier hs-var">unEntityNameHS</span></a></span><span> </span><span class="annot"><span class="annottext">EntityNameHS
</span><a href="#local-6989586621679964127"><span class="hs-identifier hs-var">entityName</span></a></span><span class="hs-special">)</span><span> </span><span class="annot"><span class="annottext">forall m. Monoid m =&gt; m -&gt; m -&gt; m
</span><a href="Database.Persist.TH.html#%2B%2B"><span class="hs-operator hs-var">++</span></a></span><span> </span><span class="annot"><span class="annottext">String
</span><span class="hs-string">&quot;Id&quot;</span></span><span>
</span><span id="line-2603"></span><span>        </span><span id="local-6989586621679964125"><span class="annot"><span class="annottext">name :: Name
</span><a href="#local-6989586621679964125"><span class="hs-identifier hs-var hs-var">name</span></a></span></span><span> </span><span class="hs-glyph">=</span><span>
</span><span id="line-2604"></span><span>            </span><span class="annot"><span class="annottext">MkPersistSettings -&gt; EntityNameHS -&gt; FieldNameHS -&gt; Name
</span><a href="Database.Persist.TH.html#filterConName%27"><span class="hs-identifier hs-var">filterConName'</span></a></span><span> </span><span class="annot"><span class="annottext">MkPersistSettings
</span><a href="#local-6989586621679964129"><span class="hs-identifier hs-var">mps</span></a></span><span> </span><span class="annot"><span class="annottext">EntityNameHS
</span><a href="#local-6989586621679964127"><span class="hs-identifier hs-var">entityName</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Text -&gt; FieldNameHS
</span><a href="Database.Persist.Names.html#FieldNameHS"><span class="hs-identifier hs-var">FieldNameHS</span></a></span><span> </span><span class="annot"><span class="annottext">Text
</span><span class="hs-string">&quot;Id&quot;</span></span><span class="hs-special">)</span><span>
</span><span id="line-2605"></span><span>    </span><span id="local-6989586621679964124"><span class="annot"><span class="annottext">Exp
</span><a href="#local-6989586621679964124"><span class="hs-identifier hs-var">clause</span></a></span></span><span>  </span><span class="hs-glyph">&lt;-</span><span>
</span><span id="line-2606"></span><span>        </span><span class="annot"><span class="annottext">MkPersistSettings -&gt; UnboundEntityDef -&gt; Q Exp
</span><a href="Database.Persist.TH.html#fixPrimarySpec"><span class="hs-identifier hs-var">fixPrimarySpec</span></a></span><span> </span><span class="annot"><span class="annottext">MkPersistSettings
</span><a href="#local-6989586621679964129"><span class="hs-identifier hs-var">mps</span></a></span><span> </span><span class="annot"><span class="annottext">UnboundEntityDef
</span><a href="#local-6989586621679964128"><span class="hs-identifier hs-var">ued</span></a></span><span>
</span><span id="line-2607"></span><span>    </span><span class="annot"><span class="annottext">forall (f :: * -&gt; *) a. Applicative f =&gt; a -&gt; f a
</span><span class="hs-identifier hs-var">pure</span></span><span> </span><span class="annot"><a href="Database.Persist.TH.html#EntityFieldTH"><span class="hs-identifier hs-type">EntityFieldTH</span></a></span><span>
</span><span id="line-2608"></span><span>        </span><span class="hs-special">{</span><span> </span><span class="annot"><span class="annottext">entityFieldTHCon :: Con
</span><a href="Database.Persist.TH.html#entityFieldTHCon"><span class="hs-identifier hs-var">entityFieldTHCon</span></a></span><span> </span><span class="hs-glyph">=</span><span>
</span><span id="line-2609"></span><span>            </span><span class="annot"><span class="annottext">[TyVarBndr Specificity] -&gt; [Type] -&gt; Con -&gt; Con
</span><span class="hs-identifier hs-var">ForallC</span></span><span>
</span><span id="line-2610"></span><span>                </span><span class="hs-special">[</span><span class="hs-special">]</span><span>
</span><span id="line-2611"></span><span>                </span><span class="hs-special">[</span><span class="annot"><span class="annottext">Type -&gt; Type -&gt; Type
</span><a href="Database.Persist.TH.html#mkEqualP"><span class="hs-identifier hs-var">mkEqualP</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Name -&gt; Type
</span><span class="hs-identifier hs-var">VarT</span></span><span> </span><span class="annot"><span class="annottext">forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span> </span><span class="annot"><span class="annottext">String -&gt; Name
</span><span class="hs-identifier hs-var">mkName</span></span><span> </span><span class="annot"><span class="annottext">String
</span><span class="hs-string">&quot;typ&quot;</span></span><span class="hs-special">)</span><span> </span><span class="annot"><span class="annottext">Type
</span><a href="#local-6989586621679964126"><span class="hs-identifier hs-var">entityIdType</span></a></span><span class="hs-special">]</span><span>
</span><span id="line-2612"></span><span>                </span><span class="annot"><span class="annottext">forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span> </span><span class="annot"><span class="annottext">Name -&gt; [BangType] -&gt; Con
</span><span class="hs-identifier hs-var">NormalC</span></span><span> </span><span class="annot"><span class="annottext">Name
</span><a href="#local-6989586621679964125"><span class="hs-identifier hs-var">name</span></a></span><span> </span><span class="hs-special">[</span><span class="hs-special">]</span><span>
</span><span id="line-2613"></span><span>        </span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">entityFieldTHClause :: Clause
</span><a href="Database.Persist.TH.html#entityFieldTHClause"><span class="hs-identifier hs-var">entityFieldTHClause</span></a></span><span> </span><span class="hs-glyph">=</span><span>
</span><span id="line-2614"></span><span>            </span><span class="annot"><span class="annottext">[Pat] -&gt; Exp -&gt; Clause
</span><a href="Database.Persist.TH.html#normalClause"><span class="hs-identifier hs-var">normalClause</span></a></span><span> </span><span class="hs-special">[</span><span class="annot"><span class="annottext">Name -&gt; [Pat] -&gt; Pat
</span><a href="Database.Persist.TH.html#conp"><span class="hs-identifier hs-var">conp</span></a></span><span> </span><span class="annot"><span class="annottext">Name
</span><a href="#local-6989586621679964125"><span class="hs-identifier hs-var">name</span></a></span><span> </span><span class="hs-special">[</span><span class="hs-special">]</span><span class="hs-special">]</span><span> </span><span class="annot"><span class="annottext">Exp
</span><a href="#local-6989586621679964124"><span class="hs-identifier hs-var">clause</span></a></span><span>
</span><span id="line-2615"></span><span>        </span><span class="hs-special">}</span><span>
</span><span id="line-2616"></span><span>
</span><span id="line-2617"></span><span id="local-6989586621679966384"><span class="annot"><a href="Database.Persist.TH.html#lookupEntityField"><span class="hs-identifier hs-type">lookupEntityField</span></a></span><span>
</span><span id="line-2618"></span><span>    </span><span class="hs-glyph">::</span><span> </span><span class="annot"><a href="Database.Persist.Class.PersistEntity.html#PersistEntity"><span class="hs-identifier hs-type">PersistEntity</span></a></span><span> </span><span class="annot"><a href="#local-6989586621679966384"><span class="hs-identifier hs-type">entity</span></a></span><span>
</span><span id="line-2619"></span><span>    </span><span class="hs-glyph">=&gt;</span><span> </span><span class="annot"><span class="hs-identifier hs-type">Proxy</span></span><span> </span><span class="annot"><a href="#local-6989586621679966384"><span class="hs-identifier hs-type">entity</span></a></span><span>
</span><span id="line-2620"></span><span>    </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="Database.Persist.Names.html#FieldNameHS"><span class="hs-identifier hs-type">FieldNameHS</span></a></span><span>
</span><span id="line-2621"></span><span>    </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="Database.Persist.Types.Base.html#FieldDef"><span class="hs-identifier hs-type">FieldDef</span></a></span></span><span>
</span><span id="line-2622"></span><span id="lookupEntityField"><span class="annot"><span class="annottext">lookupEntityField :: forall entity.
PersistEntity entity =&gt;
Proxy entity -&gt; FieldNameHS -&gt; FieldDef
</span><a href="Database.Persist.TH.html#lookupEntityField"><span class="hs-identifier hs-var hs-var">lookupEntityField</span></a></span></span><span> </span><span id="local-6989586621679964118"><span class="annot"><span class="annottext">Proxy entity
</span><a href="#local-6989586621679964118"><span class="hs-identifier hs-var">prxy</span></a></span></span><span> </span><span id="local-6989586621679964117"><span class="annot"><span class="annottext">FieldNameHS
</span><a href="#local-6989586621679964117"><span class="hs-identifier hs-var">fieldNameHS</span></a></span></span><span> </span><span class="hs-glyph">=</span><span>
</span><span id="line-2623"></span><span>    </span><span class="annot"><span class="annottext">forall a. a -&gt; Maybe a -&gt; a
</span><span class="hs-identifier hs-var">fromMaybe</span></span><span> </span><span class="annot"><span class="annottext">forall {a}. a
</span><a href="#local-6989586621679964116"><span class="hs-identifier hs-var">boom</span></a></span><span> </span><span class="annot"><span class="annottext">forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span> </span><span class="annot"><span class="annottext">forall (t :: * -&gt; *) a. Foldable t =&gt; (a -&gt; Bool) -&gt; t a -&gt; Maybe a
</span><span class="hs-identifier hs-var">List.find</span></span><span> </span><span class="hs-special">(</span><span class="hs-special">(</span><span class="annot"><span class="annottext">FieldNameHS
</span><a href="#local-6989586621679964117"><span class="hs-identifier hs-var">fieldNameHS</span></a></span><span> </span><span class="annot"><span class="annottext">forall a. Eq a =&gt; a -&gt; a -&gt; Bool
</span><span class="hs-operator hs-var">==</span></span><span class="hs-special">)</span><span> </span><span class="annot"><span class="annottext">forall b c a. (b -&gt; c) -&gt; (a -&gt; b) -&gt; a -&gt; c
</span><span class="hs-operator hs-var">.</span></span><span> </span><span class="annot"><span class="annottext">FieldDef -&gt; FieldNameHS
</span><a href="Database.Persist.Types.Base.html#fieldHaskell"><span class="hs-identifier hs-var">fieldHaskell</span></a></span><span class="hs-special">)</span><span> </span><span class="annot"><span class="annottext">forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span> </span><span class="annot"><span class="annottext">EntityDef -&gt; [FieldDef]
</span><a href="Database.Persist.Types.Base.html#entityFields"><span class="hs-identifier hs-var">entityFields</span></a></span><span> </span><span class="annot"><span class="annottext">forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span> </span><span class="annot"><span class="annottext">forall record (proxy :: * -&gt; *).
PersistEntity record =&gt;
proxy record -&gt; EntityDef
</span><a href="Database.Persist.Class.PersistEntity.html#entityDef"><span class="hs-identifier hs-var">entityDef</span></a></span><span> </span><span class="annot"><span class="annottext">Proxy entity
</span><a href="#local-6989586621679964118"><span class="hs-identifier hs-var">prxy</span></a></span><span>
</span><span id="line-2624"></span><span>  </span><span class="hs-keyword">where</span><span>
</span><span id="line-2625"></span><span>    </span><span id="local-6989586621679964116"><span class="annot"><span class="annottext">boom :: a
</span><a href="#local-6989586621679964116"><span class="hs-identifier hs-var hs-var">boom</span></a></span></span><span> </span><span class="hs-glyph">=</span><span>
</span><span id="line-2626"></span><span>        </span><span class="annot"><span class="annottext">forall a. HasCallStack =&gt; String -&gt; a
</span><span class="hs-identifier hs-var">error</span></span><span> </span><span class="annot"><span class="annottext">String
</span><span class="hs-string">&quot;Database.Persist.TH.Internal.lookupEntityField: failed to find entity field with database name&quot;</span></span><span>
</span><span id="line-2627"></span><span>
</span><span id="line-2628"></span><span class="annot"><a href="Database.Persist.TH.html#mkLookupEntityField"><span class="hs-identifier hs-type">mkLookupEntityField</span></a></span><span>
</span><span id="line-2629"></span><span>    </span><span class="hs-glyph">::</span><span> </span><span class="annot"><a href="Database.Persist.Quasi.Internal.html#UnboundEntityDef"><span class="hs-identifier hs-type">UnboundEntityDef</span></a></span><span>
</span><span id="line-2630"></span><span>    </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="Database.Persist.Names.html#FieldNameHS"><span class="hs-identifier hs-type">FieldNameHS</span></a></span><span>
</span><span id="line-2631"></span><span>    </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="hs-identifier hs-type">Q</span></span><span> </span><span class="annot"><span class="hs-identifier hs-type">Exp</span></span><span>
</span><span id="line-2632"></span><span id="mkLookupEntityField"><span class="annot"><span class="annottext">mkLookupEntityField :: UnboundEntityDef -&gt; FieldNameHS -&gt; Q Exp
</span><a href="Database.Persist.TH.html#mkLookupEntityField"><span class="hs-identifier hs-var hs-var">mkLookupEntityField</span></a></span></span><span> </span><span id="local-6989586621679964112"><span class="annot"><span class="annottext">UnboundEntityDef
</span><a href="#local-6989586621679964112"><span class="hs-identifier hs-var">ued</span></a></span></span><span> </span><span id="local-6989586621679964111"><span class="annot"><span class="annottext">FieldNameHS
</span><a href="#local-6989586621679964111"><span class="hs-identifier hs-var">ufd</span></a></span></span><span> </span><span class="hs-glyph">=</span><span>
</span><span id="line-2633"></span><span>    </span><span class="hs-special">[|</span><span>
</span><span id="line-2634"></span><span>        </span><span class="hs-identifier">lookupEntityField</span><span>
</span><span id="line-2635"></span><span>            </span><span class="hs-special">(</span><span class="hs-identifier">Proxy</span><span> </span><span class="hs-glyph">::</span><span> </span><span class="hs-identifier">Proxy</span><span> </span><span class="hs-special">$</span><span class="hs-special">(</span><span class="hs-identifier">conT</span><span> </span><span class="hs-identifier">entityName</span><span class="hs-special">)</span><span class="hs-special">)</span><span>
</span><span id="line-2636"></span><span>            </span><span class="hs-special">$</span><span class="hs-special">(</span><span class="hs-identifier">lift</span><span> </span><span class="hs-identifier">ufd</span><span class="hs-special">)</span><span>
</span><span id="line-2637"></span><span>    </span><span class="hs-special">|]</span><span>
</span><span id="line-2638"></span><span>  </span><span class="hs-keyword">where</span><span>
</span><span id="line-2639"></span><span>    </span><span id="local-6989586621679964110"><span class="annot"><span class="annottext">entityName :: Name
</span><a href="#local-6989586621679964110"><span class="hs-identifier hs-var hs-var">entityName</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">EntityNameHS -&gt; Name
</span><a href="Database.Persist.TH.html#mkEntityNameHSName"><span class="hs-identifier hs-var">mkEntityNameHSName</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">UnboundEntityDef -&gt; EntityNameHS
</span><a href="Database.Persist.Quasi.Internal.html#getUnboundEntityNameHS"><span class="hs-identifier hs-var">getUnboundEntityNameHS</span></a></span><span> </span><span class="annot"><span class="annottext">UnboundEntityDef
</span><a href="#local-6989586621679964112"><span class="hs-identifier hs-var">ued</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-2640"></span><span>
</span><span id="line-2641"></span><span class="annot"><a href="Database.Persist.TH.html#maybeNullable"><span class="hs-identifier hs-type">maybeNullable</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><a href="Database.Persist.Quasi.Internal.html#UnboundFieldDef"><span class="hs-identifier hs-type">UnboundFieldDef</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="hs-identifier hs-type">Bool</span></span><span>
</span><span id="line-2642"></span><span id="maybeNullable"><span class="annot"><span class="annottext">maybeNullable :: UnboundFieldDef -&gt; Bool
</span><a href="Database.Persist.TH.html#maybeNullable"><span class="hs-identifier hs-var hs-var">maybeNullable</span></a></span></span><span> </span><span id="local-6989586621679964109"><span class="annot"><span class="annottext">UnboundFieldDef
</span><a href="#local-6989586621679964109"><span class="hs-identifier hs-var">fd</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">UnboundFieldDef -&gt; IsNullable
</span><a href="Database.Persist.Quasi.Internal.html#isUnboundFieldNullable"><span class="hs-identifier hs-var">isUnboundFieldNullable</span></a></span><span> </span><span class="annot"><span class="annottext">UnboundFieldDef
</span><a href="#local-6989586621679964109"><span class="hs-identifier hs-var">fd</span></a></span><span> </span><span class="annot"><span class="annottext">forall a. Eq a =&gt; a -&gt; a -&gt; Bool
</span><span class="hs-operator hs-var">==</span></span><span> </span><span class="annot"><span class="annottext">WhyNullable -&gt; IsNullable
</span><a href="Database.Persist.Types.Base.html#Nullable"><span class="hs-identifier hs-var">Nullable</span></a></span><span> </span><span class="annot"><span class="annottext">WhyNullable
</span><a href="Database.Persist.Types.Base.html#ByMaybeAttr"><span class="hs-identifier hs-var">ByMaybeAttr</span></a></span><span>
</span><span id="line-2643"></span><span>
</span><span id="line-2644"></span><span class="annot"><a href="Database.Persist.TH.html#ftToType"><span class="hs-identifier hs-type">ftToType</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><a href="Database.Persist.Types.Base.html#FieldType"><span class="hs-identifier hs-type">FieldType</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="hs-identifier hs-type">Type</span></span><span>
</span><span id="line-2645"></span><span id="ftToType"><span class="annot"><span class="annottext">ftToType :: FieldType -&gt; Type
</span><a href="Database.Persist.TH.html#ftToType"><span class="hs-identifier hs-var hs-var">ftToType</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-glyph">\</span><span class="hs-glyph">case</span><span>
</span><span id="line-2646"></span><span>    </span><span class="annot"><a href="Database.Persist.Types.Base.html#FTTypeCon"><span class="hs-identifier hs-type">FTTypeCon</span></a></span><span> </span><span class="annot"><span class="annottext">Maybe Text
</span><span class="hs-identifier hs-var">Nothing</span></span><span> </span><span id="local-6989586621679964108"><span class="annot"><span class="annottext">Text
</span><a href="#local-6989586621679964108"><span class="hs-identifier hs-var">t</span></a></span></span><span> </span><span class="hs-glyph">-&gt;</span><span>
</span><span id="line-2647"></span><span>        </span><span class="annot"><span class="annottext">Name -&gt; Type
</span><span class="hs-identifier hs-var">ConT</span></span><span> </span><span class="annot"><span class="annottext">forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span> </span><span class="annot"><span class="annottext">String -&gt; Name
</span><span class="hs-identifier hs-var">mkName</span></span><span> </span><span class="annot"><span class="annottext">forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span> </span><span class="annot"><span class="annottext">Text -&gt; String
</span><span class="hs-identifier hs-var">T.unpack</span></span><span> </span><span class="annot"><span class="annottext">Text
</span><a href="#local-6989586621679964108"><span class="hs-identifier hs-var">t</span></a></span><span>
</span><span id="line-2648"></span><span>    </span><span class="hs-comment">-- This type is generated from the Quasi-Quoter.</span><span>
</span><span id="line-2649"></span><span>    </span><span class="hs-comment">-- Adding this special case avoids users needing to import Data.Int</span><span>
</span><span id="line-2650"></span><span>    </span><span class="annot"><a href="Database.Persist.Types.Base.html#FTTypeCon"><span class="hs-identifier hs-type">FTTypeCon</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="hs-identifier hs-type">Just</span></span><span> </span><span class="annot"><span class="annottext">Text
</span><span class="hs-string">&quot;Data.Int&quot;</span></span><span class="hs-special">)</span><span> </span><span class="annot"><span class="annottext">Text
</span><span class="hs-string">&quot;Int64&quot;</span></span><span> </span><span class="hs-glyph">-&gt;</span><span>
</span><span id="line-2651"></span><span>        </span><span class="annot"><span class="annottext">Name -&gt; Type
</span><span class="hs-identifier hs-var">ConT</span></span><span> </span><span class="hs-special">''</span><span class="hs-identifier">Int64</span><span>
</span><span id="line-2652"></span><span>    </span><span class="annot"><a href="Database.Persist.Types.Base.html#FTTypeCon"><span class="hs-identifier hs-type">FTTypeCon</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="hs-identifier hs-type">Just</span></span><span> </span><span id="local-6989586621679964107"><span class="annot"><span class="annottext">Text
</span><a href="#local-6989586621679964107"><span class="hs-identifier hs-var">m</span></a></span></span><span class="hs-special">)</span><span> </span><span id="local-6989586621679964106"><span class="annot"><span class="annottext">Text
</span><a href="#local-6989586621679964106"><span class="hs-identifier hs-var">t</span></a></span></span><span> </span><span class="hs-glyph">-&gt;</span><span>
</span><span id="line-2653"></span><span>        </span><span class="annot"><span class="annottext">Name -&gt; Type
</span><span class="hs-identifier hs-var">ConT</span></span><span> </span><span class="annot"><span class="annottext">forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span> </span><span class="annot"><span class="annottext">String -&gt; Name
</span><span class="hs-identifier hs-var">mkName</span></span><span> </span><span class="annot"><span class="annottext">forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span> </span><span class="annot"><span class="annottext">Text -&gt; String
</span><span class="hs-identifier hs-var">unpack</span></span><span> </span><span class="annot"><span class="annottext">forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span> </span><span class="annot"><span class="annottext">[Text] -&gt; Text
</span><span class="hs-identifier hs-var">concat</span></span><span> </span><span class="hs-special">[</span><span class="annot"><span class="annottext">Text
</span><a href="#local-6989586621679964107"><span class="hs-identifier hs-var">m</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">Text
</span><span class="hs-string">&quot;.&quot;</span></span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">Text
</span><a href="#local-6989586621679964106"><span class="hs-identifier hs-var">t</span></a></span><span class="hs-special">]</span><span>
</span><span id="line-2654"></span><span>    </span><span class="annot"><a href="Database.Persist.Types.Base.html#FTTypePromoted"><span class="hs-identifier hs-type">FTTypePromoted</span></a></span><span> </span><span id="local-6989586621679964105"><span class="annot"><span class="annottext">Text
</span><a href="#local-6989586621679964105"><span class="hs-identifier hs-var">t</span></a></span></span><span> </span><span class="hs-glyph">-&gt;</span><span>
</span><span id="line-2655"></span><span>        </span><span class="annot"><span class="annottext">Name -&gt; Type
</span><span class="hs-identifier hs-var">PromotedT</span></span><span> </span><span class="annot"><span class="annottext">forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span> </span><span class="annot"><span class="annottext">String -&gt; Name
</span><span class="hs-identifier hs-var">mkName</span></span><span> </span><span class="annot"><span class="annottext">forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span> </span><span class="annot"><span class="annottext">Text -&gt; String
</span><span class="hs-identifier hs-var">T.unpack</span></span><span> </span><span class="annot"><span class="annottext">Text
</span><a href="#local-6989586621679964105"><span class="hs-identifier hs-var">t</span></a></span><span>
</span><span id="line-2656"></span><span>    </span><span class="annot"><a href="Database.Persist.Types.Base.html#FTApp"><span class="hs-identifier hs-type">FTApp</span></a></span><span> </span><span id="local-6989586621679964103"><span class="annot"><span class="annottext">FieldType
</span><a href="#local-6989586621679964103"><span class="hs-identifier hs-var">x</span></a></span></span><span> </span><span id="local-6989586621679964102"><span class="annot"><span class="annottext">FieldType
</span><a href="#local-6989586621679964102"><span class="hs-identifier hs-var">y</span></a></span></span><span> </span><span class="hs-glyph">-&gt;</span><span>
</span><span id="line-2657"></span><span>        </span><span class="annot"><span class="annottext">FieldType -&gt; Type
</span><a href="Database.Persist.TH.html#ftToType"><span class="hs-identifier hs-var">ftToType</span></a></span><span> </span><span class="annot"><span class="annottext">FieldType
</span><a href="#local-6989586621679964103"><span class="hs-identifier hs-var">x</span></a></span><span> </span><span class="annot"><span class="annottext">Type -&gt; Type -&gt; Type
</span><span class="hs-operator hs-var">`AppT`</span></span><span> </span><span class="annot"><span class="annottext">FieldType -&gt; Type
</span><a href="Database.Persist.TH.html#ftToType"><span class="hs-identifier hs-var">ftToType</span></a></span><span> </span><span class="annot"><span class="annottext">FieldType
</span><a href="#local-6989586621679964102"><span class="hs-identifier hs-var">y</span></a></span><span>
</span><span id="line-2658"></span><span>    </span><span class="annot"><a href="Database.Persist.Types.Base.html#FTList"><span class="hs-identifier hs-type">FTList</span></a></span><span> </span><span id="local-6989586621679964101"><span class="annot"><span class="annottext">FieldType
</span><a href="#local-6989586621679964101"><span class="hs-identifier hs-var">x</span></a></span></span><span> </span><span class="hs-glyph">-&gt;</span><span>
</span><span id="line-2659"></span><span>        </span><span class="annot"><span class="annottext">Type
</span><span class="hs-identifier hs-var">ListT</span></span><span> </span><span class="annot"><span class="annottext">Type -&gt; Type -&gt; Type
</span><span class="hs-operator hs-var">`AppT`</span></span><span> </span><span class="annot"><span class="annottext">FieldType -&gt; Type
</span><a href="Database.Persist.TH.html#ftToType"><span class="hs-identifier hs-var">ftToType</span></a></span><span> </span><span class="annot"><span class="annottext">FieldType
</span><a href="#local-6989586621679964101"><span class="hs-identifier hs-var">x</span></a></span><span>
</span><span id="line-2660"></span><span>
</span><span id="line-2661"></span><span class="hs-keyword">infixr</span><span> </span><span class="hs-number">5</span><span> </span><span class="annot"><a href="Database.Persist.TH.html#%2B%2B"><span class="hs-operator hs-type">++</span></a></span><span>
</span><span id="line-2662"></span><span id="local-6989586621679966482"><span class="annot"><a href="Database.Persist.TH.html#%2B%2B"><span class="hs-operator hs-type">(++)</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><span class="hs-identifier hs-type">Monoid</span></span><span> </span><span class="annot"><a href="#local-6989586621679966482"><span class="hs-identifier hs-type">m</span></a></span><span> </span><span class="hs-glyph">=&gt;</span><span> </span><span class="annot"><a href="#local-6989586621679966482"><span class="hs-identifier hs-type">m</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="#local-6989586621679966482"><span class="hs-identifier hs-type">m</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="#local-6989586621679966482"><span class="hs-identifier hs-type">m</span></a></span></span><span>
</span><span id="line-2663"></span><span id="%2B%2B"><span class="annot"><span class="annottext">++ :: forall m. Monoid m =&gt; m -&gt; m -&gt; m
</span><a href="Database.Persist.TH.html#%2B%2B"><span class="hs-operator hs-var hs-var">(++)</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">forall m. Monoid m =&gt; m -&gt; m -&gt; m
</span><span class="hs-identifier hs-var">mappend</span></span><span>
</span><span id="line-2664"></span><span>
</span><span id="line-2665"></span><span class="annot"><a href="Database.Persist.TH.html#mkJSON"><span class="hs-identifier hs-type">mkJSON</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><a href="Database.Persist.TH.html#MkPersistSettings"><span class="hs-identifier hs-type">MkPersistSettings</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="Database.Persist.Quasi.Internal.html#UnboundEntityDef"><span class="hs-identifier hs-type">UnboundEntityDef</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="hs-identifier hs-type">Q</span></span><span> </span><span class="hs-special">[</span><span class="annot"><span class="hs-identifier hs-type">Dec</span></span><span class="hs-special">]</span><span>
</span><span id="line-2666"></span><span id="mkJSON"><span class="annot"><span class="annottext">mkJSON :: MkPersistSettings -&gt; UnboundEntityDef -&gt; Q [Dec]
</span><a href="Database.Persist.TH.html#mkJSON"><span class="hs-identifier hs-var hs-var">mkJSON</span></a></span></span><span> </span><span class="annot"><span class="annottext">MkPersistSettings
</span><span class="hs-identifier">_</span></span><span> </span><span id="local-6989586621679964098"><span class="annot"><span class="annottext">UnboundEntityDef
</span><a href="#local-6989586621679964098"><span class="hs-identifier hs-var">def</span></a></span></span><span> </span><span class="hs-glyph">|</span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Text
</span><span class="hs-string">&quot;json&quot;</span></span><span> </span><span class="annot"><span class="annottext">forall (t :: * -&gt; *) a. (Foldable t, Eq a) =&gt; a -&gt; t a -&gt; Bool
</span><span class="hs-operator hs-var">`notElem`</span></span><span> </span><span class="annot"><span class="annottext">EntityDef -&gt; [Text]
</span><a href="Database.Persist.Types.Base.html#entityAttrs"><span class="hs-identifier hs-var">entityAttrs</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">UnboundEntityDef -&gt; EntityDef
</span><a href="Database.Persist.Quasi.Internal.html#unboundEntityDef"><span class="hs-identifier hs-var">unboundEntityDef</span></a></span><span> </span><span class="annot"><span class="annottext">UnboundEntityDef
</span><a href="#local-6989586621679964098"><span class="hs-identifier hs-var">def</span></a></span><span class="hs-special">)</span><span class="hs-special">)</span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">forall (m :: * -&gt; *) a. Monad m =&gt; a -&gt; m a
</span><span class="hs-identifier hs-var">return</span></span><span> </span><span class="hs-special">[</span><span class="hs-special">]</span><span>
</span><span id="line-2667"></span><span class="annot"><a href="Database.Persist.TH.html#mkJSON"><span class="hs-identifier hs-var">mkJSON</span></a></span><span> </span><span id="local-6989586621679964097"><span class="annot"><span class="annottext">MkPersistSettings
</span><a href="#local-6989586621679964097"><span class="hs-identifier hs-var">mps</span></a></span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">UnboundEntityDef -&gt; UnboundEntityDef
</span><a href="Database.Persist.TH.html#fixEntityDef"><span class="hs-identifier hs-var">fixEntityDef</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span id="local-6989586621679964096"><span class="annot"><span class="annottext">UnboundEntityDef
</span><a href="#local-6989586621679964096"><span class="hs-identifier hs-var">def</span></a></span></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-keyword">do</span><span>
</span><span id="line-2668"></span><span>    </span><span class="annot"><span class="annottext">[[Extension]] -&gt; Q ()
</span><a href="Database.Persist.TH.html#requireExtensions"><span class="hs-identifier hs-var">requireExtensions</span></a></span><span> </span><span class="hs-special">[</span><span class="hs-special">[</span><span class="annot"><span class="annottext">Extension
</span><span class="hs-identifier hs-var">FlexibleInstances</span></span><span class="hs-special">]</span><span class="hs-special">]</span><span>
</span><span id="line-2669"></span><span>    </span><span id="local-6989586621679964095"><span class="annot"><span class="annottext">Exp
</span><a href="#local-6989586621679964095"><span class="hs-identifier hs-var">pureE</span></a></span></span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="hs-special">[|</span><span class="hs-identifier">pure</span><span class="hs-special">|]</span><span>
</span><span id="line-2670"></span><span>    </span><span id="local-6989586621679964094"><span class="annot"><span class="annottext">Exp
</span><a href="#local-6989586621679964094"><span class="hs-identifier hs-var">apE'</span></a></span></span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="hs-special">[|</span><span class="hs-special">(</span><span class="hs-operator">&lt;*&gt;</span><span class="hs-special">)</span><span class="hs-special">|]</span><span>
</span><span id="line-2671"></span><span>
</span><span id="line-2672"></span><span>    </span><span class="hs-keyword">let</span><span> </span><span id="local-6989586621679964093"><span class="annot"><span class="annottext">objectE :: Exp
</span><a href="#local-6989586621679964093"><span class="hs-identifier hs-var hs-var">objectE</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">Name -&gt; Exp
</span><span class="hs-identifier hs-var">VarE</span></span><span> </span><span class="hs-special">'</span><span class="hs-identifier">object</span><span>
</span><span id="line-2673"></span><span>        </span><span id="local-6989586621679964092"><span class="annot"><span class="annottext">withObjectE :: Exp
</span><a href="#local-6989586621679964092"><span class="hs-identifier hs-var hs-var">withObjectE</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">Name -&gt; Exp
</span><span class="hs-identifier hs-var">VarE</span></span><span> </span><span class="hs-special">'</span><span class="hs-identifier">withObject</span><span>
</span><span id="line-2674"></span><span>        </span><span id="local-6989586621679964091"><span class="annot"><span class="annottext">dotEqualE :: Exp
</span><a href="#local-6989586621679964091"><span class="hs-identifier hs-var hs-var">dotEqualE</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">Name -&gt; Exp
</span><span class="hs-identifier hs-var">VarE</span></span><span> </span><span class="hs-special">'</span><span class="hs-special">(</span><span class="hs-operator">.=</span><span class="hs-special">)</span><span>
</span><span id="line-2675"></span><span>        </span><span id="local-6989586621679964090"><span class="annot"><span class="annottext">dotColonE :: Exp
</span><a href="#local-6989586621679964090"><span class="hs-identifier hs-var hs-var">dotColonE</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">Name -&gt; Exp
</span><span class="hs-identifier hs-var">VarE</span></span><span> </span><span class="hs-special">'</span><span class="hs-special">(</span><span class="hs-operator">.:</span><span class="hs-special">)</span><span>
</span><span id="line-2676"></span><span>        </span><span id="local-6989586621679964089"><span class="annot"><span class="annottext">dotColonQE :: Exp
</span><a href="#local-6989586621679964089"><span class="hs-identifier hs-var hs-var">dotColonQE</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">Name -&gt; Exp
</span><span class="hs-identifier hs-var">VarE</span></span><span> </span><span class="hs-special">'</span><span class="hs-special">(</span><span class="hs-operator">.:?</span><span class="hs-special">)</span><span class="hs-cpp">
#if MIN_VERSION_aeson(2,0,0)
</span><span>        </span><span id="local-6989586621679964088"><span class="annot"><span class="annottext">toKeyE :: Exp
</span><a href="#local-6989586621679964088"><span class="hs-identifier hs-var hs-var">toKeyE</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">Name -&gt; Exp
</span><span class="hs-identifier hs-var">VarE</span></span><span> </span><span class="hs-special">'</span><span class="hs-identifier">Key.fromString</span><span class="hs-cpp">
#else
</span><span>        </span><span class="hs-identifier">toKeyE</span><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-identifier">VarE</span><span> </span><span class="hs-special">'</span><span class="hs-identifier">pack</span><span class="hs-cpp">
#endif
</span><span>    </span><span id="local-6989586621679964087"><span class="annot"><span class="annottext">Name
</span><a href="#local-6989586621679964087"><span class="hs-identifier hs-var">obj</span></a></span></span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">forall (m :: * -&gt; *). Quote m =&gt; String -&gt; m Name
</span><span class="hs-identifier hs-var">newName</span></span><span> </span><span class="annot"><span class="annottext">String
</span><span class="hs-string">&quot;obj&quot;</span></span><span>
</span><span id="line-2683"></span><span>    </span><span class="hs-keyword">let</span><span>
</span><span id="line-2684"></span><span>        </span><span id="local-6989586621679964086"><span class="annot"><span class="annottext">fields :: [UnboundFieldDef]
</span><a href="#local-6989586621679964086"><span class="hs-identifier hs-var hs-var">fields</span></a></span></span><span> </span><span class="hs-glyph">=</span><span>
</span><span id="line-2685"></span><span>            </span><span class="annot"><span class="annottext">UnboundEntityDef -&gt; [UnboundFieldDef]
</span><a href="Database.Persist.Quasi.Internal.html#getUnboundFieldDefs"><span class="hs-identifier hs-var">getUnboundFieldDefs</span></a></span><span> </span><span class="annot"><span class="annottext">UnboundEntityDef
</span><a href="#local-6989586621679964096"><span class="hs-identifier hs-var">def</span></a></span><span>
</span><span id="line-2686"></span><span>
</span><span id="line-2687"></span><span>    </span><span id="local-6989586621679964085"><span class="annot"><span class="annottext">[Name]
</span><a href="#local-6989586621679964085"><span class="hs-identifier hs-var">xs</span></a></span></span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">forall (t :: * -&gt; *) (m :: * -&gt; *) a b.
(Traversable t, Monad m) =&gt;
(a -&gt; m b) -&gt; t a -&gt; m (t b)
</span><span class="hs-identifier hs-var">mapM</span></span><span> </span><span class="annot"><span class="annottext">UnboundFieldDef -&gt; Q Name
</span><a href="Database.Persist.TH.html#fieldToJSONValName"><span class="hs-identifier hs-var">fieldToJSONValName</span></a></span><span> </span><span class="annot"><span class="annottext">[UnboundFieldDef]
</span><a href="#local-6989586621679964086"><span class="hs-identifier hs-var">fields</span></a></span><span>
</span><span id="line-2688"></span><span>
</span><span id="line-2689"></span><span>    </span><span class="hs-keyword">let</span><span>
</span><span id="line-2690"></span><span>        </span><span id="local-6989586621679964083"><span class="annot"><span class="annottext">conName :: Name
</span><a href="#local-6989586621679964083"><span class="hs-identifier hs-var hs-var">conName</span></a></span></span><span> </span><span class="hs-glyph">=</span><span>
</span><span id="line-2691"></span><span>            </span><span class="annot"><span class="annottext">UnboundEntityDef -&gt; Name
</span><a href="Database.Persist.TH.html#mkEntityDefName"><span class="hs-identifier hs-var">mkEntityDefName</span></a></span><span> </span><span class="annot"><span class="annottext">UnboundEntityDef
</span><a href="#local-6989586621679964096"><span class="hs-identifier hs-var">def</span></a></span><span>
</span><span id="line-2692"></span><span>        </span><span id="local-6989586621679964082"><span class="annot"><span class="annottext">typ :: Type
</span><a href="#local-6989586621679964082"><span class="hs-identifier hs-var hs-var">typ</span></a></span></span><span> </span><span class="hs-glyph">=</span><span>
</span><span id="line-2693"></span><span>            </span><span class="annot"><span class="annottext">MkPersistSettings -&gt; EntityNameHS -&gt; Type -&gt; Type
</span><a href="Database.Persist.TH.html#genericDataType"><span class="hs-identifier hs-var">genericDataType</span></a></span><span> </span><span class="annot"><span class="annottext">MkPersistSettings
</span><a href="#local-6989586621679964097"><span class="hs-identifier hs-var">mps</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">EntityDef -&gt; EntityNameHS
</span><a href="Database.Persist.Types.Base.html#entityHaskell"><span class="hs-identifier hs-var">entityHaskell</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">UnboundEntityDef -&gt; EntityDef
</span><a href="Database.Persist.Quasi.Internal.html#unboundEntityDef"><span class="hs-identifier hs-var">unboundEntityDef</span></a></span><span> </span><span class="annot"><span class="annottext">UnboundEntityDef
</span><a href="#local-6989586621679964096"><span class="hs-identifier hs-var">def</span></a></span><span class="hs-special">)</span><span class="hs-special">)</span><span> </span><span class="annot"><span class="annottext">Type
</span><a href="Database.Persist.TH.html#backendT"><span class="hs-identifier hs-var">backendT</span></a></span><span>
</span><span id="line-2694"></span><span>        </span><span id="local-6989586621679964081"><span class="annot"><span class="annottext">toJSONI :: Dec
</span><a href="#local-6989586621679964081"><span class="hs-identifier hs-var hs-var">toJSONI</span></a></span></span><span> </span><span class="hs-glyph">=</span><span>
</span><span id="line-2695"></span><span>            </span><span class="annot"><span class="annottext">Name -&gt; Bool -&gt; Type -&gt; [Dec] -&gt; Dec
</span><a href="Database.Persist.TH.html#typeInstanceD"><span class="hs-identifier hs-var">typeInstanceD</span></a></span><span> </span><span class="hs-special">''</span><span class="hs-identifier">ToJSON</span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">MkPersistSettings -&gt; Bool
</span><a href="Database.Persist.TH.html#mpsGeneric"><span class="hs-identifier hs-var">mpsGeneric</span></a></span><span> </span><span class="annot"><span class="annottext">MkPersistSettings
</span><a href="#local-6989586621679964097"><span class="hs-identifier hs-var">mps</span></a></span><span class="hs-special">)</span><span> </span><span class="annot"><span class="annottext">Type
</span><a href="#local-6989586621679964082"><span class="hs-identifier hs-var">typ</span></a></span><span> </span><span class="hs-special">[</span><span class="annot"><span class="annottext">Dec
</span><a href="#local-6989586621679964080"><span class="hs-identifier hs-var">toJSON'</span></a></span><span class="hs-special">]</span><span>
</span><span id="line-2696"></span><span>          </span><span class="hs-keyword">where</span><span>
</span><span id="line-2697"></span><span>            </span><span id="local-6989586621679964080"><span class="annot"><span class="annottext">toJSON' :: Dec
</span><a href="#local-6989586621679964080"><span class="hs-identifier hs-var hs-var">toJSON'</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">Name -&gt; [Clause] -&gt; Dec
</span><span class="hs-identifier hs-var">FunD</span></span><span> </span><span class="hs-special">'</span><span class="hs-identifier">toJSON</span><span> </span><span class="annot"><span class="annottext">forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span> </span><span class="annot"><span class="annottext">forall (m :: * -&gt; *) a. Monad m =&gt; a -&gt; m a
</span><span class="hs-identifier hs-var">return</span></span><span> </span><span class="annot"><span class="annottext">forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span> </span><span class="annot"><span class="annottext">[Pat] -&gt; Exp -&gt; Clause
</span><a href="Database.Persist.TH.html#normalClause"><span class="hs-identifier hs-var">normalClause</span></a></span><span>
</span><span id="line-2698"></span><span>                </span><span class="hs-special">[</span><span class="annot"><span class="annottext">Name -&gt; [Pat] -&gt; Pat
</span><a href="Database.Persist.TH.html#conp"><span class="hs-identifier hs-var">conp</span></a></span><span> </span><span class="annot"><span class="annottext">Name
</span><a href="#local-6989586621679964083"><span class="hs-identifier hs-var">conName</span></a></span><span> </span><span class="annot"><span class="annottext">forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span> </span><span class="annot"><span class="annottext">forall (f :: * -&gt; *) a b. Functor f =&gt; (a -&gt; b) -&gt; f a -&gt; f b
</span><span class="hs-identifier hs-var">fmap</span></span><span> </span><span class="annot"><span class="annottext">Name -&gt; Pat
</span><span class="hs-identifier hs-var">VarP</span></span><span> </span><span class="annot"><span class="annottext">[Name]
</span><a href="#local-6989586621679964085"><span class="hs-identifier hs-var">xs</span></a></span><span class="hs-special">]</span><span>
</span><span id="line-2699"></span><span>                </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Exp
</span><a href="#local-6989586621679964093"><span class="hs-identifier hs-var">objectE</span></a></span><span> </span><span class="annot"><span class="annottext">Exp -&gt; Exp -&gt; Exp
</span><span class="hs-operator hs-var">`AppE`</span></span><span> </span><span class="annot"><span class="annottext">[Exp] -&gt; Exp
</span><span class="hs-identifier hs-var">ListE</span></span><span> </span><span class="annot"><span class="annottext">[Exp]
</span><a href="#local-6989586621679964079"><span class="hs-identifier hs-var">pairs</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-2700"></span><span>              </span><span class="hs-keyword">where</span><span>
</span><span id="line-2701"></span><span>                </span><span id="local-6989586621679964079"><span class="annot"><span class="annottext">pairs :: [Exp]
</span><a href="#local-6989586621679964079"><span class="hs-identifier hs-var hs-var">pairs</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">forall a b c. (a -&gt; b -&gt; c) -&gt; [a] -&gt; [b] -&gt; [c]
</span><span class="hs-identifier hs-var">zipWith</span></span><span> </span><span class="annot"><span class="annottext">UnboundFieldDef -&gt; Name -&gt; Exp
</span><a href="#local-6989586621679964078"><span class="hs-identifier hs-var">toPair</span></a></span><span> </span><span class="annot"><span class="annottext">[UnboundFieldDef]
</span><a href="#local-6989586621679964086"><span class="hs-identifier hs-var">fields</span></a></span><span> </span><span class="annot"><span class="annottext">[Name]
</span><a href="#local-6989586621679964085"><span class="hs-identifier hs-var">xs</span></a></span><span>
</span><span id="line-2702"></span><span>                </span><span id="local-6989586621679964078"><span class="annot"><span class="annottext">toPair :: UnboundFieldDef -&gt; Name -&gt; Exp
</span><a href="#local-6989586621679964078"><span class="hs-identifier hs-var hs-var">toPair</span></a></span></span><span> </span><span id="local-6989586621679964077"><span class="annot"><span class="annottext">UnboundFieldDef
</span><a href="#local-6989586621679964077"><span class="hs-identifier hs-var">f</span></a></span></span><span> </span><span id="local-6989586621679964076"><span class="annot"><span class="annottext">Name
</span><a href="#local-6989586621679964076"><span class="hs-identifier hs-var">x</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">Maybe Exp -&gt; Exp -&gt; Maybe Exp -&gt; Exp
</span><span class="hs-identifier hs-var">InfixE</span></span><span>
</span><span id="line-2703"></span><span>                    </span><span class="hs-special">(</span><span class="annot"><span class="annottext">forall a. a -&gt; Maybe a
</span><span class="hs-identifier hs-var">Just</span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Exp
</span><a href="#local-6989586621679964088"><span class="hs-identifier hs-var">toKeyE</span></a></span><span> </span><span class="annot"><span class="annottext">Exp -&gt; Exp -&gt; Exp
</span><span class="hs-operator hs-var">`AppE`</span></span><span> </span><span class="annot"><span class="annottext">Lit -&gt; Exp
</span><span class="hs-identifier hs-var">LitE</span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">String -&gt; Lit
</span><span class="hs-identifier hs-var">StringL</span></span><span> </span><span class="annot"><span class="annottext">forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span> </span><span class="annot"><span class="annottext">Text -&gt; String
</span><span class="hs-identifier hs-var">unpack</span></span><span> </span><span class="annot"><span class="annottext">forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span> </span><span class="annot"><span class="annottext">FieldNameHS -&gt; Text
</span><a href="Database.Persist.Names.html#unFieldNameHS"><span class="hs-identifier hs-var">unFieldNameHS</span></a></span><span> </span><span class="annot"><span class="annottext">forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span> </span><span class="annot"><span class="annottext">UnboundFieldDef -&gt; FieldNameHS
</span><a href="Database.Persist.Quasi.Internal.html#unboundFieldNameHS"><span class="hs-identifier hs-var">unboundFieldNameHS</span></a></span><span> </span><span class="annot"><span class="annottext">UnboundFieldDef
</span><a href="#local-6989586621679964077"><span class="hs-identifier hs-var">f</span></a></span><span class="hs-special">)</span><span class="hs-special">)</span><span class="hs-special">)</span><span>
</span><span id="line-2704"></span><span>                    </span><span class="annot"><span class="annottext">Exp
</span><a href="#local-6989586621679964091"><span class="hs-identifier hs-var">dotEqualE</span></a></span><span>
</span><span id="line-2705"></span><span>                    </span><span class="hs-special">(</span><span class="annot"><span class="annottext">forall a. a -&gt; Maybe a
</span><span class="hs-identifier hs-var">Just</span></span><span> </span><span class="annot"><span class="annottext">forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span> </span><span class="annot"><span class="annottext">Name -&gt; Exp
</span><span class="hs-identifier hs-var">VarE</span></span><span> </span><span class="annot"><span class="annottext">Name
</span><a href="#local-6989586621679964076"><span class="hs-identifier hs-var">x</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-2706"></span><span>        </span><span id="local-6989586621679964075"><span class="annot"><span class="annottext">fromJSONI :: Dec
</span><a href="#local-6989586621679964075"><span class="hs-identifier hs-var hs-var">fromJSONI</span></a></span></span><span> </span><span class="hs-glyph">=</span><span>
</span><span id="line-2707"></span><span>            </span><span class="annot"><span class="annottext">Name -&gt; Bool -&gt; Type -&gt; [Dec] -&gt; Dec
</span><a href="Database.Persist.TH.html#typeInstanceD"><span class="hs-identifier hs-var">typeInstanceD</span></a></span><span> </span><span class="hs-special">''</span><span class="hs-identifier">FromJSON</span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">MkPersistSettings -&gt; Bool
</span><a href="Database.Persist.TH.html#mpsGeneric"><span class="hs-identifier hs-var">mpsGeneric</span></a></span><span> </span><span class="annot"><span class="annottext">MkPersistSettings
</span><a href="#local-6989586621679964097"><span class="hs-identifier hs-var">mps</span></a></span><span class="hs-special">)</span><span> </span><span class="annot"><span class="annottext">Type
</span><a href="#local-6989586621679964082"><span class="hs-identifier hs-var">typ</span></a></span><span> </span><span class="hs-special">[</span><span class="annot"><span class="annottext">Dec
</span><a href="#local-6989586621679964074"><span class="hs-identifier hs-var">parseJSON'</span></a></span><span class="hs-special">]</span><span>
</span><span id="line-2708"></span><span>          </span><span class="hs-keyword">where</span><span>
</span><span id="line-2709"></span><span>            </span><span id="local-6989586621679964073"><span class="annot"><span class="annottext">entNameStrLit :: Lit
</span><a href="#local-6989586621679964073"><span class="hs-identifier hs-var hs-var">entNameStrLit</span></a></span></span><span> </span><span class="hs-glyph">=</span><span>
</span><span id="line-2710"></span><span>                </span><span class="annot"><span class="annottext">String -&gt; Lit
</span><span class="hs-identifier hs-var">StringL</span></span><span> </span><span class="annot"><span class="annottext">forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span> </span><span class="annot"><span class="annottext">Text -&gt; String
</span><span class="hs-identifier hs-var">T.unpack</span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">EntityNameHS -&gt; Text
</span><a href="Database.Persist.Names.html#unEntityNameHS"><span class="hs-identifier hs-var">unEntityNameHS</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">UnboundEntityDef -&gt; EntityNameHS
</span><a href="Database.Persist.Quasi.Internal.html#getUnboundEntityNameHS"><span class="hs-identifier hs-var">getUnboundEntityNameHS</span></a></span><span> </span><span class="annot"><span class="annottext">UnboundEntityDef
</span><a href="#local-6989586621679964096"><span class="hs-identifier hs-var">def</span></a></span><span class="hs-special">)</span><span class="hs-special">)</span><span>
</span><span id="line-2711"></span><span>            </span><span id="local-6989586621679964072"><span class="annot"><span class="annottext">parseJSONBody :: Exp
</span><a href="#local-6989586621679964072"><span class="hs-identifier hs-var hs-var">parseJSONBody</span></a></span></span><span> </span><span class="hs-glyph">=</span><span>
</span><span id="line-2712"></span><span>                </span><span class="annot"><span class="annottext">Exp
</span><a href="#local-6989586621679964092"><span class="hs-identifier hs-var">withObjectE</span></a></span><span> </span><span class="annot"><span class="annottext">Exp -&gt; Exp -&gt; Exp
</span><span class="hs-operator hs-var">`AppE`</span></span><span> </span><span class="annot"><span class="annottext">Lit -&gt; Exp
</span><span class="hs-identifier hs-var">LitE</span></span><span> </span><span class="annot"><span class="annottext">Lit
</span><a href="#local-6989586621679964073"><span class="hs-identifier hs-var">entNameStrLit</span></a></span><span> </span><span class="annot"><span class="annottext">Exp -&gt; Exp -&gt; Exp
</span><span class="hs-operator hs-var">`AppE`</span></span><span> </span><span class="annot"><span class="annottext">Exp
</span><a href="#local-6989586621679964071"><span class="hs-identifier hs-var">decoderImpl</span></a></span><span>
</span><span id="line-2713"></span><span>            </span><span id="local-6989586621679964074"><span class="annot"><span class="annottext">parseJSON' :: Dec
</span><a href="#local-6989586621679964074"><span class="hs-identifier hs-var hs-var">parseJSON'</span></a></span></span><span> </span><span class="hs-glyph">=</span><span>
</span><span id="line-2714"></span><span>                </span><span class="annot"><span class="annottext">Name -&gt; [Clause] -&gt; Dec
</span><span class="hs-identifier hs-var">FunD</span></span><span> </span><span class="hs-special">'</span><span class="hs-identifier">parseJSON</span><span> </span><span class="hs-special">[</span><span> </span><span class="annot"><span class="annottext">[Pat] -&gt; Exp -&gt; Clause
</span><a href="Database.Persist.TH.html#normalClause"><span class="hs-identifier hs-var">normalClause</span></a></span><span> </span><span class="hs-special">[</span><span class="hs-special">]</span><span> </span><span class="annot"><span class="annottext">Exp
</span><a href="#local-6989586621679964072"><span class="hs-identifier hs-var">parseJSONBody</span></a></span><span> </span><span class="hs-special">]</span><span>
</span><span id="line-2715"></span><span>            </span><span id="local-6989586621679964071"><span class="annot"><span class="annottext">decoderImpl :: Exp
</span><a href="#local-6989586621679964071"><span class="hs-identifier hs-var hs-var">decoderImpl</span></a></span></span><span> </span><span class="hs-glyph">=</span><span>
</span><span id="line-2716"></span><span>                </span><span class="annot"><span class="annottext">[Pat] -&gt; Exp -&gt; Exp
</span><span class="hs-identifier hs-var">LamE</span></span><span> </span><span class="hs-special">[</span><span class="annot"><span class="annottext">Name -&gt; Pat
</span><span class="hs-identifier hs-var">VarP</span></span><span> </span><span class="annot"><span class="annottext">Name
</span><a href="#local-6989586621679964087"><span class="hs-identifier hs-var">obj</span></a></span><span class="hs-special">]</span><span>
</span><span id="line-2717"></span><span>                    </span><span class="hs-special">(</span><span class="annot"><span class="annottext">forall (t :: * -&gt; *) b a.
Foldable t =&gt;
(b -&gt; a -&gt; b) -&gt; b -&gt; t a -&gt; b
</span><span class="hs-identifier hs-var">foldl'</span></span><span>
</span><span id="line-2718"></span><span>                        </span><span class="hs-special">(</span><span class="hs-glyph">\</span><span id="local-6989586621679964070"><span class="annot"><span class="annottext">Exp
</span><a href="#local-6989586621679964070"><span class="hs-identifier hs-var">x</span></a></span></span><span> </span><span id="local-6989586621679964069"><span class="annot"><span class="annottext">Exp
</span><a href="#local-6989586621679964069"><span class="hs-identifier hs-var">y</span></a></span></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="annottext">Maybe Exp -&gt; Exp -&gt; Maybe Exp -&gt; Exp
</span><span class="hs-identifier hs-var">InfixE</span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">forall a. a -&gt; Maybe a
</span><span class="hs-identifier hs-var">Just</span></span><span> </span><span class="annot"><span class="annottext">Exp
</span><a href="#local-6989586621679964070"><span class="hs-identifier hs-var">x</span></a></span><span class="hs-special">)</span><span> </span><span class="annot"><span class="annottext">Exp
</span><a href="#local-6989586621679964094"><span class="hs-identifier hs-var">apE'</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">forall a. a -&gt; Maybe a
</span><span class="hs-identifier hs-var">Just</span></span><span> </span><span class="annot"><span class="annottext">Exp
</span><a href="#local-6989586621679964069"><span class="hs-identifier hs-var">y</span></a></span><span class="hs-special">)</span><span class="hs-special">)</span><span>
</span><span id="line-2719"></span><span>                        </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Exp
</span><a href="#local-6989586621679964095"><span class="hs-identifier hs-var">pureE</span></a></span><span> </span><span class="annot"><span class="annottext">Exp -&gt; Exp -&gt; Exp
</span><span class="hs-operator hs-var">`AppE`</span></span><span> </span><span class="annot"><span class="annottext">Name -&gt; Exp
</span><span class="hs-identifier hs-var">ConE</span></span><span> </span><span class="annot"><span class="annottext">Name
</span><a href="#local-6989586621679964083"><span class="hs-identifier hs-var">conName</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-2720"></span><span>                        </span><span class="annot"><span class="annottext">[Exp]
</span><a href="#local-6989586621679964068"><span class="hs-identifier hs-var">pulls</span></a></span><span>
</span><span id="line-2721"></span><span>                    </span><span class="hs-special">)</span><span>
</span><span id="line-2722"></span><span>              </span><span class="hs-keyword">where</span><span>
</span><span id="line-2723"></span><span>                </span><span id="local-6989586621679964068"><span class="annot"><span class="annottext">pulls :: [Exp]
</span><a href="#local-6989586621679964068"><span class="hs-identifier hs-var hs-var">pulls</span></a></span></span><span> </span><span class="hs-glyph">=</span><span>
</span><span id="line-2724"></span><span>                    </span><span class="annot"><span class="annottext">forall (f :: * -&gt; *) a b. Functor f =&gt; (a -&gt; b) -&gt; f a -&gt; f b
</span><span class="hs-identifier hs-var">fmap</span></span><span> </span><span class="annot"><span class="annottext">UnboundFieldDef -&gt; Exp
</span><a href="#local-6989586621679964067"><span class="hs-identifier hs-var">toPull</span></a></span><span> </span><span class="annot"><span class="annottext">[UnboundFieldDef]
</span><a href="#local-6989586621679964086"><span class="hs-identifier hs-var">fields</span></a></span><span>
</span><span id="line-2725"></span><span>                </span><span id="local-6989586621679964067"><span class="annot"><span class="annottext">toPull :: UnboundFieldDef -&gt; Exp
</span><a href="#local-6989586621679964067"><span class="hs-identifier hs-var hs-var">toPull</span></a></span></span><span> </span><span id="local-6989586621679964066"><span class="annot"><span class="annottext">UnboundFieldDef
</span><a href="#local-6989586621679964066"><span class="hs-identifier hs-var">f</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">Maybe Exp -&gt; Exp -&gt; Maybe Exp -&gt; Exp
</span><span class="hs-identifier hs-var">InfixE</span></span><span>
</span><span id="line-2726"></span><span>                    </span><span class="hs-special">(</span><span class="annot"><span class="annottext">forall a. a -&gt; Maybe a
</span><span class="hs-identifier hs-var">Just</span></span><span> </span><span class="annot"><span class="annottext">forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span> </span><span class="annot"><span class="annottext">Name -&gt; Exp
</span><span class="hs-identifier hs-var">VarE</span></span><span> </span><span class="annot"><span class="annottext">Name
</span><a href="#local-6989586621679964087"><span class="hs-identifier hs-var">obj</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-2727"></span><span>                    </span><span class="hs-special">(</span><span class="hs-keyword">if</span><span> </span><span class="annot"><span class="annottext">UnboundFieldDef -&gt; Bool
</span><a href="Database.Persist.TH.html#maybeNullable"><span class="hs-identifier hs-var">maybeNullable</span></a></span><span> </span><span class="annot"><span class="annottext">UnboundFieldDef
</span><a href="#local-6989586621679964066"><span class="hs-identifier hs-var">f</span></a></span><span> </span><span class="hs-keyword">then</span><span> </span><span class="annot"><span class="annottext">Exp
</span><a href="#local-6989586621679964089"><span class="hs-identifier hs-var">dotColonQE</span></a></span><span> </span><span class="hs-keyword">else</span><span> </span><span class="annot"><span class="annottext">Exp
</span><a href="#local-6989586621679964090"><span class="hs-identifier hs-var">dotColonE</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-2728"></span><span>                    </span><span class="hs-special">(</span><span class="annot"><span class="annottext">forall a. a -&gt; Maybe a
</span><span class="hs-identifier hs-var">Just</span></span><span> </span><span class="annot"><span class="annottext">forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span> </span><span class="annot"><span class="annottext">Exp -&gt; Exp -&gt; Exp
</span><span class="hs-identifier hs-var">AppE</span></span><span> </span><span class="annot"><span class="annottext">Exp
</span><a href="#local-6989586621679964088"><span class="hs-identifier hs-var">toKeyE</span></a></span><span> </span><span class="annot"><span class="annottext">forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span> </span><span class="annot"><span class="annottext">Lit -&gt; Exp
</span><span class="hs-identifier hs-var">LitE</span></span><span> </span><span class="annot"><span class="annottext">forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span> </span><span class="annot"><span class="annottext">String -&gt; Lit
</span><span class="hs-identifier hs-var">StringL</span></span><span> </span><span class="annot"><span class="annottext">forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span> </span><span class="annot"><span class="annottext">Text -&gt; String
</span><span class="hs-identifier hs-var">unpack</span></span><span> </span><span class="annot"><span class="annottext">forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span> </span><span class="annot"><span class="annottext">FieldNameHS -&gt; Text
</span><a href="Database.Persist.Names.html#unFieldNameHS"><span class="hs-identifier hs-var">unFieldNameHS</span></a></span><span> </span><span class="annot"><span class="annottext">forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span> </span><span class="annot"><span class="annottext">UnboundFieldDef -&gt; FieldNameHS
</span><a href="Database.Persist.Quasi.Internal.html#unboundFieldNameHS"><span class="hs-identifier hs-var">unboundFieldNameHS</span></a></span><span> </span><span class="annot"><span class="annottext">UnboundFieldDef
</span><a href="#local-6989586621679964066"><span class="hs-identifier hs-var">f</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-2729"></span><span>
</span><span id="line-2730"></span><span>    </span><span class="hs-keyword">case</span><span> </span><span class="annot"><span class="annottext">MkPersistSettings -&gt; Maybe EntityJSON
</span><a href="Database.Persist.TH.html#mpsEntityJSON"><span class="hs-identifier hs-var">mpsEntityJSON</span></a></span><span> </span><span class="annot"><span class="annottext">MkPersistSettings
</span><a href="#local-6989586621679964097"><span class="hs-identifier hs-var">mps</span></a></span><span> </span><span class="hs-keyword">of</span><span>
</span><span id="line-2731"></span><span>        </span><span class="annot"><span class="annottext">Maybe EntityJSON
</span><span class="hs-identifier hs-var">Nothing</span></span><span> </span><span class="hs-glyph">-&gt;</span><span>
</span><span id="line-2732"></span><span>            </span><span class="annot"><span class="annottext">forall (m :: * -&gt; *) a. Monad m =&gt; a -&gt; m a
</span><span class="hs-identifier hs-var">return</span></span><span> </span><span class="hs-special">[</span><span class="annot"><span class="annottext">Dec
</span><a href="#local-6989586621679964081"><span class="hs-identifier hs-var">toJSONI</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">Dec
</span><a href="#local-6989586621679964075"><span class="hs-identifier hs-var">fromJSONI</span></a></span><span class="hs-special">]</span><span>
</span><span id="line-2733"></span><span>        </span><span class="annot"><span class="hs-identifier hs-type">Just</span></span><span> </span><span id="local-6989586621679964065"><span class="annot"><span class="annottext">EntityJSON
</span><a href="#local-6989586621679964065"><span class="hs-identifier hs-var">entityJSON</span></a></span></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-keyword">do</span><span>
</span><span id="line-2734"></span><span>            </span><span id="local-6989586621679964064"><span class="annot"><span class="annottext">[Dec]
</span><a href="#local-6989586621679964064"><span class="hs-identifier hs-var">entityJSONIs</span></a></span></span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="hs-keyword">if</span><span> </span><span class="annot"><span class="annottext">MkPersistSettings -&gt; Bool
</span><a href="Database.Persist.TH.html#mpsGeneric"><span class="hs-identifier hs-var">mpsGeneric</span></a></span><span> </span><span class="annot"><span class="annottext">MkPersistSettings
</span><a href="#local-6989586621679964097"><span class="hs-identifier hs-var">mps</span></a></span><span>
</span><span id="line-2735"></span><span>              </span><span class="hs-keyword">then</span><span> </span><span class="hs-special">[d|</span><span>
</span><span id="line-2736"></span><span>                </span><span class="hs-keyword">instance</span><span> </span><span class="hs-identifier">PersistStore</span><span> </span><span class="hs-special">$</span><span class="hs-special">(</span><span class="hs-identifier">pure</span><span> </span><span class="hs-identifier">backendT</span><span class="hs-special">)</span><span> </span><span class="hs-glyph">=&gt;</span><span> </span><span class="hs-identifier">ToJSON</span><span> </span><span class="hs-special">(</span><span class="hs-identifier">Entity</span><span> </span><span class="hs-special">$</span><span class="hs-special">(</span><span class="hs-identifier">pure</span><span> </span><span class="hs-identifier">typ</span><span class="hs-special">)</span><span class="hs-special">)</span><span> </span><span class="hs-keyword">where</span><span>
</span><span id="line-2737"></span><span>                    </span><span class="hs-identifier">toJSON</span><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-special">$</span><span class="hs-special">(</span><span class="hs-identifier">varE</span><span> </span><span class="hs-special">(</span><span class="hs-identifier">entityToJSON</span><span> </span><span class="hs-identifier">entityJSON</span><span class="hs-special">)</span><span class="hs-special">)</span><span>
</span><span id="line-2738"></span><span>                </span><span class="hs-keyword">instance</span><span> </span><span class="hs-identifier">PersistStore</span><span> </span><span class="hs-special">$</span><span class="hs-special">(</span><span class="hs-identifier">pure</span><span> </span><span class="hs-identifier">backendT</span><span class="hs-special">)</span><span> </span><span class="hs-glyph">=&gt;</span><span> </span><span class="hs-identifier">FromJSON</span><span> </span><span class="hs-special">(</span><span class="hs-identifier">Entity</span><span> </span><span class="hs-special">$</span><span class="hs-special">(</span><span class="hs-identifier">pure</span><span> </span><span class="hs-identifier">typ</span><span class="hs-special">)</span><span class="hs-special">)</span><span> </span><span class="hs-keyword">where</span><span>
</span><span id="line-2739"></span><span>                    </span><span class="hs-identifier">parseJSON</span><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-special">$</span><span class="hs-special">(</span><span class="hs-identifier">varE</span><span> </span><span class="hs-special">(</span><span class="hs-identifier">entityFromJSON</span><span> </span><span class="hs-identifier">entityJSON</span><span class="hs-special">)</span><span class="hs-special">)</span><span>
</span><span id="line-2740"></span><span>                </span><span class="hs-special">|]</span><span>
</span><span id="line-2741"></span><span>              </span><span class="hs-keyword">else</span><span> </span><span class="hs-special">[d|</span><span>
</span><span id="line-2742"></span><span>                </span><span class="hs-keyword">instance</span><span> </span><span class="hs-identifier">ToJSON</span><span> </span><span class="hs-special">(</span><span class="hs-identifier">Entity</span><span> </span><span class="hs-special">$</span><span class="hs-special">(</span><span class="hs-identifier">pure</span><span> </span><span class="hs-identifier">typ</span><span class="hs-special">)</span><span class="hs-special">)</span><span> </span><span class="hs-keyword">where</span><span>
</span><span id="line-2743"></span><span>                    </span><span class="hs-identifier">toJSON</span><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-special">$</span><span class="hs-special">(</span><span class="hs-identifier">varE</span><span> </span><span class="hs-special">(</span><span class="hs-identifier">entityToJSON</span><span> </span><span class="hs-identifier">entityJSON</span><span class="hs-special">)</span><span class="hs-special">)</span><span>
</span><span id="line-2744"></span><span>                </span><span class="hs-keyword">instance</span><span> </span><span class="hs-identifier">FromJSON</span><span> </span><span class="hs-special">(</span><span class="hs-identifier">Entity</span><span> </span><span class="hs-special">$</span><span class="hs-special">(</span><span class="hs-identifier">pure</span><span> </span><span class="hs-identifier">typ</span><span class="hs-special">)</span><span class="hs-special">)</span><span> </span><span class="hs-keyword">where</span><span>
</span><span id="line-2745"></span><span>                    </span><span class="hs-identifier">parseJSON</span><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-special">$</span><span class="hs-special">(</span><span class="hs-identifier">varE</span><span> </span><span class="hs-special">(</span><span class="hs-identifier">entityFromJSON</span><span> </span><span class="hs-identifier">entityJSON</span><span class="hs-special">)</span><span class="hs-special">)</span><span>
</span><span id="line-2746"></span><span>                </span><span class="hs-special">|]</span><span>
</span><span id="line-2747"></span><span>            </span><span class="annot"><span class="annottext">forall (m :: * -&gt; *) a. Monad m =&gt; a -&gt; m a
</span><span class="hs-identifier hs-var">return</span></span><span> </span><span class="annot"><span class="annottext">forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span> </span><span class="annot"><span class="annottext">Dec
</span><a href="#local-6989586621679964081"><span class="hs-identifier hs-var">toJSONI</span></a></span><span> </span><span class="annot"><span class="annottext">forall a. a -&gt; [a] -&gt; [a]
</span><span class="hs-glyph hs-var">:</span></span><span> </span><span class="annot"><span class="annottext">Dec
</span><a href="#local-6989586621679964075"><span class="hs-identifier hs-var">fromJSONI</span></a></span><span> </span><span class="annot"><span class="annottext">forall a. a -&gt; [a] -&gt; [a]
</span><span class="hs-glyph hs-var">:</span></span><span> </span><span class="annot"><span class="annottext">[Dec]
</span><a href="#local-6989586621679964064"><span class="hs-identifier hs-var">entityJSONIs</span></a></span><span>
</span><span id="line-2748"></span><span>
</span><span id="line-2749"></span><span class="annot"><a href="Database.Persist.TH.html#mkClassP"><span class="hs-identifier hs-type">mkClassP</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><span class="hs-identifier hs-type">Name</span></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-special">[</span><span class="annot"><span class="hs-identifier hs-type">Type</span></span><span class="hs-special">]</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="hs-identifier hs-type">Pred</span></span><span>
</span><span id="line-2750"></span><span id="mkClassP"><span class="annot"><span class="annottext">mkClassP :: Name -&gt; [Type] -&gt; Type
</span><a href="Database.Persist.TH.html#mkClassP"><span class="hs-identifier hs-var hs-var">mkClassP</span></a></span></span><span> </span><span id="local-6989586621679964063"><span class="annot"><span class="annottext">Name
</span><a href="#local-6989586621679964063"><span class="hs-identifier hs-var">cla</span></a></span></span><span> </span><span id="local-6989586621679964062"><span class="annot"><span class="annottext">[Type]
</span><a href="#local-6989586621679964062"><span class="hs-identifier hs-var">tys</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">forall (t :: * -&gt; *) b a.
Foldable t =&gt;
(b -&gt; a -&gt; b) -&gt; b -&gt; t a -&gt; b
</span><span class="hs-identifier hs-var">foldl</span></span><span> </span><span class="annot"><span class="annottext">Type -&gt; Type -&gt; Type
</span><span class="hs-identifier hs-var">AppT</span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Name -&gt; Type
</span><span class="hs-identifier hs-var">ConT</span></span><span> </span><span class="annot"><span class="annottext">Name
</span><a href="#local-6989586621679964063"><span class="hs-identifier hs-var">cla</span></a></span><span class="hs-special">)</span><span> </span><span class="annot"><span class="annottext">[Type]
</span><a href="#local-6989586621679964062"><span class="hs-identifier hs-var">tys</span></a></span><span>
</span><span id="line-2751"></span><span>
</span><span id="line-2752"></span><span class="annot"><a href="Database.Persist.TH.html#mkEqualP"><span class="hs-identifier hs-type">mkEqualP</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><span class="hs-identifier hs-type">Type</span></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="hs-identifier hs-type">Type</span></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="hs-identifier hs-type">Pred</span></span><span>
</span><span id="line-2753"></span><span id="mkEqualP"><span class="annot"><span class="annottext">mkEqualP :: Type -&gt; Type -&gt; Type
</span><a href="Database.Persist.TH.html#mkEqualP"><span class="hs-identifier hs-var hs-var">mkEqualP</span></a></span></span><span> </span><span id="local-6989586621679964060"><span class="annot"><span class="annottext">Type
</span><a href="#local-6989586621679964060"><span class="hs-identifier hs-var">tleft</span></a></span></span><span> </span><span id="local-6989586621679964059"><span class="annot"><span class="annottext">Type
</span><a href="#local-6989586621679964059"><span class="hs-identifier hs-var">tright</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">forall (t :: * -&gt; *) b a.
Foldable t =&gt;
(b -&gt; a -&gt; b) -&gt; b -&gt; t a -&gt; b
</span><span class="hs-identifier hs-var">foldl</span></span><span> </span><span class="annot"><span class="annottext">Type -&gt; Type -&gt; Type
</span><span class="hs-identifier hs-var">AppT</span></span><span> </span><span class="annot"><span class="annottext">Type
</span><span class="hs-identifier hs-var">EqualityT</span></span><span> </span><span class="hs-special">[</span><span class="annot"><span class="annottext">Type
</span><a href="#local-6989586621679964060"><span class="hs-identifier hs-var">tleft</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">Type
</span><a href="#local-6989586621679964059"><span class="hs-identifier hs-var">tright</span></a></span><span class="hs-special">]</span><span>
</span><span id="line-2754"></span><span>
</span><span id="line-2755"></span><span class="annot"><a href="Database.Persist.TH.html#notStrict"><span class="hs-identifier hs-type">notStrict</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><span class="hs-identifier hs-type">Bang</span></span><span>
</span><span id="line-2756"></span><span id="notStrict"><span class="annot"><span class="annottext">notStrict :: Bang
</span><a href="Database.Persist.TH.html#notStrict"><span class="hs-identifier hs-var hs-var">notStrict</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">SourceUnpackedness -&gt; SourceStrictness -&gt; Bang
</span><span class="hs-identifier hs-var">Bang</span></span><span> </span><span class="annot"><span class="annottext">SourceUnpackedness
</span><span class="hs-identifier hs-var">NoSourceUnpackedness</span></span><span> </span><span class="annot"><span class="annottext">SourceStrictness
</span><span class="hs-identifier hs-var">NoSourceStrictness</span></span><span>
</span><span id="line-2757"></span><span>
</span><span id="line-2758"></span><span class="annot"><a href="Database.Persist.TH.html#isStrict"><span class="hs-identifier hs-type">isStrict</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><span class="hs-identifier hs-type">Bang</span></span><span>
</span><span id="line-2759"></span><span id="isStrict"><span class="annot"><span class="annottext">isStrict :: Bang
</span><a href="Database.Persist.TH.html#isStrict"><span class="hs-identifier hs-var hs-var">isStrict</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">SourceUnpackedness -&gt; SourceStrictness -&gt; Bang
</span><span class="hs-identifier hs-var">Bang</span></span><span> </span><span class="annot"><span class="annottext">SourceUnpackedness
</span><span class="hs-identifier hs-var">NoSourceUnpackedness</span></span><span> </span><span class="annot"><span class="annottext">SourceStrictness
</span><span class="hs-identifier hs-var">SourceStrict</span></span><span>
</span><span id="line-2760"></span><span>
</span><span id="line-2761"></span><span class="annot"><a href="Database.Persist.TH.html#instanceD"><span class="hs-identifier hs-type">instanceD</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><span class="hs-identifier hs-type">Cxt</span></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="hs-identifier hs-type">Type</span></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-special">[</span><span class="annot"><span class="hs-identifier hs-type">Dec</span></span><span class="hs-special">]</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="hs-identifier hs-type">Dec</span></span><span>
</span><span id="line-2762"></span><span id="instanceD"><span class="annot"><span class="annottext">instanceD :: [Type] -&gt; Type -&gt; [Dec] -&gt; Dec
</span><a href="Database.Persist.TH.html#instanceD"><span class="hs-identifier hs-var hs-var">instanceD</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">Maybe Overlap -&gt; [Type] -&gt; Type -&gt; [Dec] -&gt; Dec
</span><span class="hs-identifier hs-var">InstanceD</span></span><span> </span><span class="annot"><span class="annottext">forall a. Maybe a
</span><span class="hs-identifier hs-var">Nothing</span></span><span>
</span><span id="line-2763"></span><span>
</span><span id="line-2764"></span><span class="hs-comment">-- | Check that all of Persistent's required extensions are enabled, or else fail compilation</span><span>
</span><span id="line-2765"></span><span class="hs-comment">--</span><span>
</span><span id="line-2766"></span><span class="hs-comment">-- This function should be called before any code that depends on one of the required extensions being enabled.</span><span>
</span><span id="line-2767"></span><span class="annot"><a href="Database.Persist.TH.html#requirePersistentExtensions"><span class="hs-identifier hs-type">requirePersistentExtensions</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><span class="hs-identifier hs-type">Q</span></span><span> </span><span class="hs-special">(</span><span class="hs-special">)</span><span>
</span><span id="line-2768"></span><span id="requirePersistentExtensions"><span class="annot"><span class="annottext">requirePersistentExtensions :: Q ()
</span><a href="Database.Persist.TH.html#requirePersistentExtensions"><span class="hs-identifier hs-var hs-var">requirePersistentExtensions</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">[[Extension]] -&gt; Q ()
</span><a href="Database.Persist.TH.html#requireExtensions"><span class="hs-identifier hs-var">requireExtensions</span></a></span><span> </span><span class="annot"><span class="annottext">[[Extension]]
</span><a href="#local-6989586621679964052"><span class="hs-identifier hs-var">requiredExtensions</span></a></span><span>
</span><span id="line-2769"></span><span>  </span><span class="hs-keyword">where</span><span>
</span><span id="line-2770"></span><span>    </span><span id="local-6989586621679964052"><span class="annot"><span class="annottext">requiredExtensions :: [[Extension]]
</span><a href="#local-6989586621679964052"><span class="hs-identifier hs-var hs-var">requiredExtensions</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">forall (f :: * -&gt; *) a b. Functor f =&gt; (a -&gt; b) -&gt; f a -&gt; f b
</span><span class="hs-identifier hs-var">fmap</span></span><span> </span><span class="annot"><span class="annottext">forall (f :: * -&gt; *) a. Applicative f =&gt; a -&gt; f a
</span><span class="hs-identifier hs-var">pure</span></span><span>
</span><span id="line-2771"></span><span>        </span><span class="hs-special">[</span><span> </span><span class="annot"><span class="annottext">Extension
</span><span class="hs-identifier hs-var">DerivingStrategies</span></span><span>
</span><span id="line-2772"></span><span>        </span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">Extension
</span><span class="hs-identifier hs-var">GeneralizedNewtypeDeriving</span></span><span>
</span><span id="line-2773"></span><span>        </span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">Extension
</span><span class="hs-identifier hs-var">StandaloneDeriving</span></span><span>
</span><span id="line-2774"></span><span>        </span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">Extension
</span><span class="hs-identifier hs-var">UndecidableInstances</span></span><span>
</span><span id="line-2775"></span><span>        </span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">Extension
</span><span class="hs-identifier hs-var">MultiParamTypeClasses</span></span><span>
</span><span id="line-2776"></span><span>        </span><span class="hs-special">]</span><span>
</span><span id="line-2777"></span><span>
</span><span id="line-2778"></span><span class="annot"><a href="Database.Persist.TH.html#mkSymbolToFieldInstances"><span class="hs-identifier hs-type">mkSymbolToFieldInstances</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><a href="Database.Persist.TH.html#MkPersistSettings"><span class="hs-identifier hs-type">MkPersistSettings</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="Database.Persist.TH.html#EntityMap"><span class="hs-identifier hs-type">EntityMap</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="Database.Persist.Quasi.Internal.html#UnboundEntityDef"><span class="hs-identifier hs-type">UnboundEntityDef</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="hs-identifier hs-type">Q</span></span><span> </span><span class="hs-special">[</span><span class="annot"><span class="hs-identifier hs-type">Dec</span></span><span class="hs-special">]</span><span>
</span><span id="line-2779"></span><span id="mkSymbolToFieldInstances"><span class="annot"><span class="annottext">mkSymbolToFieldInstances :: MkPersistSettings -&gt; EntityMap -&gt; UnboundEntityDef -&gt; Q [Dec]
</span><a href="Database.Persist.TH.html#mkSymbolToFieldInstances"><span class="hs-identifier hs-var hs-var">mkSymbolToFieldInstances</span></a></span></span><span> </span><span id="local-6989586621679964048"><span class="annot"><span class="annottext">MkPersistSettings
</span><a href="#local-6989586621679964048"><span class="hs-identifier hs-var">mps</span></a></span></span><span> </span><span id="local-6989586621679964047"><span class="annot"><span class="annottext">EntityMap
</span><a href="#local-6989586621679964047"><span class="hs-identifier hs-var">entityMap</span></a></span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">UnboundEntityDef -&gt; UnboundEntityDef
</span><a href="Database.Persist.TH.html#fixEntityDef"><span class="hs-identifier hs-var">fixEntityDef</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span id="local-6989586621679964046"><span class="annot"><span class="annottext">UnboundEntityDef
</span><a href="#local-6989586621679964046"><span class="hs-identifier hs-var">ed</span></a></span></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-keyword">do</span><span>
</span><span id="line-2780"></span><span>    </span><span class="hs-keyword">let</span><span>
</span><span id="line-2781"></span><span>        </span><span id="local-6989586621679964045"><span class="annot"><span class="annottext">entityHaskellName :: EntityNameHS
</span><a href="#local-6989586621679964045"><span class="hs-identifier hs-var hs-var">entityHaskellName</span></a></span></span><span> </span><span class="hs-glyph">=</span><span>
</span><span id="line-2782"></span><span>            </span><span class="annot"><span class="annottext">EntityDef -&gt; EntityNameHS
</span><a href="Database.Persist.EntityDef.html#getEntityHaskellName"><span class="hs-identifier hs-var">getEntityHaskellName</span></a></span><span> </span><span class="annot"><span class="annottext">forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span> </span><span class="annot"><span class="annottext">UnboundEntityDef -&gt; EntityDef
</span><a href="Database.Persist.Quasi.Internal.html#unboundEntityDef"><span class="hs-identifier hs-var">unboundEntityDef</span></a></span><span> </span><span class="annot"><span class="annottext">UnboundEntityDef
</span><a href="#local-6989586621679964046"><span class="hs-identifier hs-var">ed</span></a></span><span>
</span><span id="line-2783"></span><span>        </span><span id="local-6989586621679964044"><span class="annot"><span class="annottext">allFields :: [UnboundFieldDef]
</span><a href="#local-6989586621679964044"><span class="hs-identifier hs-var hs-var">allFields</span></a></span></span><span> </span><span class="hs-glyph">=</span><span>
</span><span id="line-2784"></span><span>            </span><span class="annot"><span class="annottext">UnboundEntityDef -&gt; [UnboundFieldDef]
</span><a href="Database.Persist.Quasi.Internal.html#getUnboundFieldDefs"><span class="hs-identifier hs-var">getUnboundFieldDefs</span></a></span><span> </span><span class="annot"><span class="annottext">UnboundEntityDef
</span><a href="#local-6989586621679964046"><span class="hs-identifier hs-var">ed</span></a></span><span>
</span><span id="line-2785"></span><span>        </span><span id="local-6989586621679964043"><span class="annot"><span class="annottext">mkEntityFieldConstr :: FieldNameHS -&gt; Q Exp
</span><a href="#local-6989586621679964043"><span class="hs-identifier hs-var hs-var">mkEntityFieldConstr</span></a></span></span><span> </span><span id="local-6989586621679964042"><span class="annot"><span class="annottext">FieldNameHS
</span><a href="#local-6989586621679964042"><span class="hs-identifier hs-var">fieldHaskellName</span></a></span></span><span> </span><span class="hs-glyph">=</span><span>
</span><span id="line-2786"></span><span>            </span><span class="annot"><span class="annottext">forall (m :: * -&gt; *). Quote m =&gt; Name -&gt; m Exp
</span><span class="hs-identifier hs-var">conE</span></span><span> </span><span class="annot"><span class="annottext">forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span> </span><span class="annot"><span class="annottext">MkPersistSettings -&gt; EntityNameHS -&gt; FieldNameHS -&gt; Name
</span><a href="Database.Persist.TH.html#filterConName%27"><span class="hs-identifier hs-var">filterConName'</span></a></span><span> </span><span class="annot"><span class="annottext">MkPersistSettings
</span><a href="#local-6989586621679964048"><span class="hs-identifier hs-var">mps</span></a></span><span> </span><span class="annot"><span class="annottext">EntityNameHS
</span><a href="#local-6989586621679964045"><span class="hs-identifier hs-var">entityHaskellName</span></a></span><span> </span><span class="annot"><span class="annottext">FieldNameHS
</span><a href="#local-6989586621679964042"><span class="hs-identifier hs-var">fieldHaskellName</span></a></span><span>
</span><span id="line-2787"></span><span>                </span><span class="hs-glyph">::</span><span> </span><span class="annot"><span class="hs-identifier hs-type">Q</span></span><span> </span><span class="annot"><span class="hs-identifier hs-type">Exp</span></span><span>
</span><span id="line-2788"></span><span>    </span><span id="local-6989586621679964041"><span class="annot"><span class="annottext">[[Dec]]
</span><a href="#local-6989586621679964041"><span class="hs-identifier hs-var">regularFields</span></a></span></span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">forall (t :: * -&gt; *) (m :: * -&gt; *) a b.
(Traversable t, Monad m) =&gt;
t a -&gt; (a -&gt; m b) -&gt; m (t b)
</span><span class="hs-identifier hs-var">forM</span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">forall (t :: * -&gt; *) a. Foldable t =&gt; t a -&gt; [a]
</span><span class="hs-identifier hs-var">toList</span></span><span> </span><span class="annot"><span class="annottext">[UnboundFieldDef]
</span><a href="#local-6989586621679964044"><span class="hs-identifier hs-var">allFields</span></a></span><span class="hs-special">)</span><span> </span><span class="annot"><span class="annottext">forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span> </span><span class="hs-glyph">\</span><span id="local-6989586621679964040"><span class="annot"><span class="annottext">UnboundFieldDef
</span><a href="#local-6989586621679964040"><span class="hs-identifier hs-var">fieldDef</span></a></span></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-keyword">do</span><span>
</span><span id="line-2789"></span><span>        </span><span class="hs-keyword">let</span><span>
</span><span id="line-2790"></span><span>            </span><span id="local-6989586621679964039"><span class="annot"><span class="annottext">fieldHaskellName :: FieldNameHS
</span><a href="#local-6989586621679964039"><span class="hs-identifier hs-var hs-var">fieldHaskellName</span></a></span></span><span> </span><span class="hs-glyph">=</span><span>
</span><span id="line-2791"></span><span>                </span><span class="annot"><span class="annottext">UnboundFieldDef -&gt; FieldNameHS
</span><a href="Database.Persist.Quasi.Internal.html#unboundFieldNameHS"><span class="hs-identifier hs-var">unboundFieldNameHS</span></a></span><span> </span><span class="annot"><span class="annottext">UnboundFieldDef
</span><a href="#local-6989586621679964040"><span class="hs-identifier hs-var">fieldDef</span></a></span><span>
</span><span id="line-2792"></span><span>
</span><span id="line-2793"></span><span>        </span><span class="hs-keyword">let</span><span> </span><span class="annot"><a href="#local-6989586621679964038"><span class="hs-identifier hs-type">fieldNameT</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><span class="hs-identifier hs-type">Q</span></span><span> </span><span class="annot"><span class="hs-identifier hs-type">Type</span></span><span>
</span><span id="line-2794"></span><span>            </span><span id="local-6989586621679964038"><span class="annot"><span class="annottext">fieldNameT :: Q Type
</span><a href="#local-6989586621679964038"><span class="hs-identifier hs-var hs-var">fieldNameT</span></a></span></span><span> </span><span class="hs-glyph">=</span><span>
</span><span id="line-2795"></span><span>                </span><span class="annot"><span class="annottext">forall (m :: * -&gt; *). Quote m =&gt; m TyLit -&gt; m Type
</span><span class="hs-identifier hs-var">litT</span></span><span> </span><span class="annot"><span class="annottext">forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span> </span><span class="annot"><span class="annottext">forall (m :: * -&gt; *). Quote m =&gt; String -&gt; m TyLit
</span><span class="hs-identifier hs-var">strTyLit</span></span><span>
</span><span id="line-2796"></span><span>                    </span><span class="annot"><span class="annottext">forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span> </span><span class="annot"><span class="annottext">Text -&gt; String
</span><span class="hs-identifier hs-var">T.unpack</span></span><span> </span><span class="annot"><span class="annottext">forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span> </span><span class="annot"><span class="annottext">forall {a}. (Eq a, IsString a) =&gt; a -&gt; a
</span><a href="#local-6989586621679964037"><span class="hs-identifier hs-var">lowerFirstIfId</span></a></span><span>
</span><span id="line-2797"></span><span>                    </span><span class="annot"><span class="annottext">forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span> </span><span class="annot"><span class="annottext">FieldNameHS -&gt; Text
</span><a href="Database.Persist.Names.html#unFieldNameHS"><span class="hs-identifier hs-var">unFieldNameHS</span></a></span><span> </span><span class="annot"><span class="annottext">FieldNameHS
</span><a href="#local-6989586621679964039"><span class="hs-identifier hs-var">fieldHaskellName</span></a></span><span>
</span><span id="line-2798"></span><span>
</span><span id="line-2799"></span><span>            </span><span id="local-6989586621679964037"><span class="annot"><span class="annottext">lowerFirstIfId :: a -&gt; a
</span><a href="#local-6989586621679964037"><span class="hs-identifier hs-var hs-var">lowerFirstIfId</span></a></span></span><span> </span><span class="annot"><span class="annottext">a
</span><span class="hs-string">&quot;Id&quot;</span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">a
</span><span class="hs-string">&quot;id&quot;</span></span><span>
</span><span id="line-2800"></span><span>            </span><span class="annot"><a href="#local-6989586621679964037"><span class="hs-identifier hs-var">lowerFirstIfId</span></a></span><span> </span><span id="local-6989586621679964031"><span class="annot"><span class="annottext">a
</span><a href="#local-6989586621679964031"><span class="hs-identifier hs-var">xs</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">a
</span><a href="#local-6989586621679964031"><span class="hs-identifier hs-var">xs</span></a></span><span>
</span><span id="line-2801"></span><span>
</span><span id="line-2802"></span><span>            </span><span id="local-6989586621679964030"><span class="annot"><span class="annottext">fieldTypeT :: Q Type
</span><a href="#local-6989586621679964030"><span class="hs-identifier hs-var hs-var">fieldTypeT</span></a></span></span><span>
</span><span id="line-2803"></span><span>                </span><span class="hs-glyph">|</span><span> </span><span class="annot"><span class="annottext">FieldNameHS
</span><a href="#local-6989586621679964039"><span class="hs-identifier hs-var">fieldHaskellName</span></a></span><span> </span><span class="annot"><span class="annottext">forall a. Eq a =&gt; a -&gt; a -&gt; Bool
</span><span class="hs-operator hs-var">==</span></span><span> </span><span class="annot"><span class="annottext">Text -&gt; FieldNameHS
</span><a href="Database.Persist.Names.html#FieldNameHS"><span class="hs-identifier hs-var">FieldNameHS</span></a></span><span> </span><span class="annot"><span class="annottext">Text
</span><span class="hs-string">&quot;Id&quot;</span></span><span> </span><span class="hs-glyph">=</span><span>
</span><span id="line-2804"></span><span>                    </span><span class="annot"><span class="annottext">forall (m :: * -&gt; *). Quote m =&gt; Name -&gt; m Type
</span><span class="hs-identifier hs-var">conT</span></span><span> </span><span class="hs-special">''</span><span class="hs-identifier">Key</span><span> </span><span class="annot"><span class="annottext">forall (m :: * -&gt; *). Quote m =&gt; m Type -&gt; m Type -&gt; m Type
</span><span class="hs-operator hs-var">`appT`</span></span><span> </span><span class="annot"><span class="annottext">Q Type
</span><a href="#local-6989586621679964029"><span class="hs-identifier hs-var">recordNameT</span></a></span><span>
</span><span id="line-2805"></span><span>                </span><span class="hs-glyph">|</span><span> </span><span class="annot"><span class="annottext">Bool
</span><span class="hs-identifier hs-var">otherwise</span></span><span> </span><span class="hs-glyph">=</span><span>
</span><span id="line-2806"></span><span>                    </span><span class="annot"><span class="annottext">forall (f :: * -&gt; *) a. Applicative f =&gt; a -&gt; f a
</span><span class="hs-identifier hs-var">pure</span></span><span> </span><span class="annot"><span class="annottext">forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span> </span><span class="annot"><span class="annottext">MkPersistSettings
-&gt; EntityMap
-&gt; UnboundFieldDef
-&gt; Maybe Name
-&gt; Maybe IsNullable
-&gt; Type
</span><a href="Database.Persist.TH.html#maybeIdType"><span class="hs-identifier hs-var">maybeIdType</span></a></span><span> </span><span class="annot"><span class="annottext">MkPersistSettings
</span><a href="#local-6989586621679964048"><span class="hs-identifier hs-var">mps</span></a></span><span> </span><span class="annot"><span class="annottext">EntityMap
</span><a href="#local-6989586621679964047"><span class="hs-identifier hs-var">entityMap</span></a></span><span> </span><span class="annot"><span class="annottext">UnboundFieldDef
</span><a href="#local-6989586621679964040"><span class="hs-identifier hs-var">fieldDef</span></a></span><span> </span><span class="annot"><span class="annottext">forall a. Maybe a
</span><span class="hs-identifier hs-var">Nothing</span></span><span> </span><span class="annot"><span class="annottext">forall a. Maybe a
</span><span class="hs-identifier hs-var">Nothing</span></span><span>
</span><span id="line-2807"></span><span>            </span><span id="local-6989586621679964028"><span class="annot"><span class="annottext">entityFieldConstr :: Q Exp
</span><a href="#local-6989586621679964028"><span class="hs-identifier hs-var hs-var">entityFieldConstr</span></a></span></span><span> </span><span class="hs-glyph">=</span><span>
</span><span id="line-2808"></span><span>                </span><span class="annot"><span class="annottext">FieldNameHS -&gt; Q Exp
</span><a href="#local-6989586621679964043"><span class="hs-identifier hs-var">mkEntityFieldConstr</span></a></span><span> </span><span class="annot"><span class="annottext">FieldNameHS
</span><a href="#local-6989586621679964039"><span class="hs-identifier hs-var">fieldHaskellName</span></a></span><span>
</span><span id="line-2809"></span><span>        </span><span class="annot"><span class="annottext">Q Type -&gt; Q Type -&gt; Q Exp -&gt; Q [Dec]
</span><a href="#local-6989586621679964027"><span class="hs-identifier hs-var">mkInstance</span></a></span><span> </span><span class="annot"><span class="annottext">Q Type
</span><a href="#local-6989586621679964038"><span class="hs-identifier hs-var">fieldNameT</span></a></span><span> </span><span class="annot"><span class="annottext">Q Type
</span><a href="#local-6989586621679964030"><span class="hs-identifier hs-var">fieldTypeT</span></a></span><span> </span><span class="annot"><span class="annottext">Q Exp
</span><a href="#local-6989586621679964028"><span class="hs-identifier hs-var">entityFieldConstr</span></a></span><span>
</span><span id="line-2810"></span><span>
</span><span id="line-2811"></span><span>    </span><span id="local-6989586621679964026"><span class="annot"><span class="annottext">[Dec]
</span><a href="#local-6989586621679964026"><span class="hs-identifier hs-var">mkey</span></a></span></span><span> </span><span class="hs-glyph">&lt;-</span><span>
</span><span id="line-2812"></span><span>        </span><span class="hs-keyword">case</span><span> </span><span class="annot"><span class="annottext">UnboundEntityDef -&gt; PrimarySpec
</span><a href="Database.Persist.Quasi.Internal.html#unboundPrimarySpec"><span class="hs-identifier hs-var">unboundPrimarySpec</span></a></span><span> </span><span class="annot"><span class="annottext">UnboundEntityDef
</span><a href="#local-6989586621679964046"><span class="hs-identifier hs-var">ed</span></a></span><span> </span><span class="hs-keyword">of</span><span>
</span><span id="line-2813"></span><span>            </span><span class="annot"><a href="Database.Persist.Quasi.Internal.html#NaturalKey"><span class="hs-identifier hs-type">NaturalKey</span></a></span><span> </span><span class="annot"><span class="annottext">UnboundCompositeDef
</span><span class="hs-identifier">_</span></span><span> </span><span class="hs-glyph">-&gt;</span><span>
</span><span id="line-2814"></span><span>                </span><span class="annot"><span class="annottext">forall (f :: * -&gt; *) a. Applicative f =&gt; a -&gt; f a
</span><span class="hs-identifier hs-var">pure</span></span><span> </span><span class="hs-special">[</span><span class="hs-special">]</span><span>
</span><span id="line-2815"></span><span>            </span><span class="annot"><span class="annottext">PrimarySpec
</span><span class="hs-identifier">_</span></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-keyword">do</span><span>
</span><span id="line-2816"></span><span>                </span><span class="hs-keyword">let</span><span>
</span><span id="line-2817"></span><span>                    </span><span id="local-6989586621679964024"><span class="annot"><span class="annottext">fieldHaskellName :: FieldNameHS
</span><a href="#local-6989586621679964024"><span class="hs-identifier hs-var hs-var">fieldHaskellName</span></a></span></span><span> </span><span class="hs-glyph">=</span><span>
</span><span id="line-2818"></span><span>                        </span><span class="annot"><span class="annottext">Text -&gt; FieldNameHS
</span><a href="Database.Persist.Names.html#FieldNameHS"><span class="hs-identifier hs-var">FieldNameHS</span></a></span><span> </span><span class="annot"><span class="annottext">Text
</span><span class="hs-string">&quot;Id&quot;</span></span><span>
</span><span id="line-2819"></span><span>                    </span><span id="local-6989586621679964023"><span class="annot"><span class="annottext">entityFieldConstr :: Q Exp
</span><a href="#local-6989586621679964023"><span class="hs-identifier hs-var hs-var">entityFieldConstr</span></a></span></span><span> </span><span class="hs-glyph">=</span><span>
</span><span id="line-2820"></span><span>                        </span><span class="annot"><span class="annottext">FieldNameHS -&gt; Q Exp
</span><a href="#local-6989586621679964043"><span class="hs-identifier hs-var">mkEntityFieldConstr</span></a></span><span> </span><span class="annot"><span class="annottext">FieldNameHS
</span><a href="#local-6989586621679964024"><span class="hs-identifier hs-var">fieldHaskellName</span></a></span><span>
</span><span id="line-2821"></span><span>                    </span><span id="local-6989586621679964022"><span class="annot"><span class="annottext">fieldTypeT :: Q Type
</span><a href="#local-6989586621679964022"><span class="hs-identifier hs-var hs-var">fieldTypeT</span></a></span></span><span> </span><span class="hs-glyph">=</span><span>
</span><span id="line-2822"></span><span>                        </span><span class="annot"><span class="annottext">forall (m :: * -&gt; *). Quote m =&gt; Name -&gt; m Type
</span><span class="hs-identifier hs-var">conT</span></span><span> </span><span class="hs-special">''</span><span class="hs-identifier">Key</span><span> </span><span class="annot"><span class="annottext">forall (m :: * -&gt; *). Quote m =&gt; m Type -&gt; m Type -&gt; m Type
</span><span class="hs-operator hs-var">`appT`</span></span><span> </span><span class="annot"><span class="annottext">Q Type
</span><a href="#local-6989586621679964029"><span class="hs-identifier hs-var">recordNameT</span></a></span><span>
</span><span id="line-2823"></span><span>                </span><span class="annot"><span class="annottext">Q Type -&gt; Q Type -&gt; Q Exp -&gt; Q [Dec]
</span><a href="#local-6989586621679964027"><span class="hs-identifier hs-var">mkInstance</span></a></span><span> </span><span class="hs-special">[t|</span><span class="hs-string">&quot;id&quot;</span><span class="hs-special">|]</span><span> </span><span class="annot"><span class="annottext">Q Type
</span><a href="#local-6989586621679964022"><span class="hs-identifier hs-var">fieldTypeT</span></a></span><span> </span><span class="annot"><span class="annottext">Q Exp
</span><a href="#local-6989586621679964023"><span class="hs-identifier hs-var">entityFieldConstr</span></a></span><span>
</span><span id="line-2824"></span><span>
</span><span id="line-2825"></span><span>    </span><span class="annot"><span class="annottext">forall (f :: * -&gt; *) a. Applicative f =&gt; a -&gt; f a
</span><span class="hs-identifier hs-var">pure</span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">[Dec]
</span><a href="#local-6989586621679964026"><span class="hs-identifier hs-var">mkey</span></a></span><span> </span><span class="annot"><span class="annottext">forall a. Semigroup a =&gt; a -&gt; a -&gt; a
</span><span class="hs-operator hs-var">&lt;&gt;</span></span><span> </span><span class="annot"><span class="annottext">forall (m :: * -&gt; *) a. Monad m =&gt; m (m a) -&gt; m a
</span><span class="hs-identifier hs-var">join</span></span><span> </span><span class="annot"><span class="annottext">[[Dec]]
</span><a href="#local-6989586621679964041"><span class="hs-identifier hs-var">regularFields</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-2826"></span><span>  </span><span class="hs-keyword">where</span><span>
</span><span id="line-2827"></span><span>    </span><span id="local-6989586621679964021"><span class="annot"><span class="annottext">nameG :: Name
</span><a href="#local-6989586621679964021"><span class="hs-identifier hs-var hs-var">nameG</span></a></span></span><span> </span><span class="hs-glyph">=</span><span>
</span><span id="line-2828"></span><span>        </span><span class="annot"><span class="annottext">UnboundEntityDef -&gt; Name
</span><a href="Database.Persist.TH.html#mkEntityDefGenericName"><span class="hs-identifier hs-var">mkEntityDefGenericName</span></a></span><span> </span><span class="annot"><span class="annottext">UnboundEntityDef
</span><a href="#local-6989586621679964046"><span class="hs-identifier hs-var">ed</span></a></span><span>
</span><span id="line-2829"></span><span>    </span><span id="local-6989586621679964029"><span class="annot"><span class="annottext">recordNameT :: Q Type
</span><a href="#local-6989586621679964029"><span class="hs-identifier hs-var hs-var">recordNameT</span></a></span></span><span>
</span><span id="line-2830"></span><span>        </span><span class="hs-glyph">|</span><span> </span><span class="annot"><span class="annottext">MkPersistSettings -&gt; Bool
</span><a href="Database.Persist.TH.html#mpsGeneric"><span class="hs-identifier hs-var">mpsGeneric</span></a></span><span> </span><span class="annot"><span class="annottext">MkPersistSettings
</span><a href="#local-6989586621679964048"><span class="hs-identifier hs-var">mps</span></a></span><span> </span><span class="hs-glyph">=</span><span>
</span><span id="line-2831"></span><span>            </span><span class="annot"><span class="annottext">forall (m :: * -&gt; *). Quote m =&gt; Name -&gt; m Type
</span><span class="hs-identifier hs-var">conT</span></span><span> </span><span class="annot"><span class="annottext">Name
</span><a href="#local-6989586621679964021"><span class="hs-identifier hs-var">nameG</span></a></span><span> </span><span class="annot"><span class="annottext">forall (m :: * -&gt; *). Quote m =&gt; m Type -&gt; m Type -&gt; m Type
</span><span class="hs-operator hs-var">`appT`</span></span><span> </span><span class="annot"><span class="annottext">forall (m :: * -&gt; *). Quote m =&gt; Name -&gt; m Type
</span><span class="hs-identifier hs-var">varT</span></span><span> </span><span class="annot"><span class="annottext">Name
</span><a href="Database.Persist.TH.html#backendName"><span class="hs-identifier hs-var">backendName</span></a></span><span>
</span><span id="line-2832"></span><span>        </span><span class="hs-glyph">|</span><span> </span><span class="annot"><span class="annottext">Bool
</span><span class="hs-identifier hs-var">otherwise</span></span><span> </span><span class="hs-glyph">=</span><span>
</span><span id="line-2833"></span><span>            </span><span class="annot"><span class="annottext">UnboundEntityDef -&gt; Q Type
</span><a href="Database.Persist.TH.html#entityDefConT"><span class="hs-identifier hs-var">entityDefConT</span></a></span><span> </span><span class="annot"><span class="annottext">UnboundEntityDef
</span><a href="#local-6989586621679964046"><span class="hs-identifier hs-var">ed</span></a></span><span>
</span><span id="line-2834"></span><span>    </span><span id="local-6989586621679964027"><span class="annot"><span class="annottext">mkInstance :: Q Type -&gt; Q Type -&gt; Q Exp -&gt; Q [Dec]
</span><a href="#local-6989586621679964027"><span class="hs-identifier hs-var hs-var">mkInstance</span></a></span></span><span> </span><span id="local-6989586621679964020"><span class="annot"><span class="annottext">Q Type
</span><a href="#local-6989586621679964020"><span class="hs-identifier hs-var">fieldNameT</span></a></span></span><span> </span><span id="local-6989586621679964019"><span class="annot"><span class="annottext">Q Type
</span><a href="#local-6989586621679964019"><span class="hs-identifier hs-var">fieldTypeT</span></a></span></span><span> </span><span id="local-6989586621679964018"><span class="annot"><span class="annottext">Q Exp
</span><a href="#local-6989586621679964018"><span class="hs-identifier hs-var">entityFieldConstr</span></a></span></span><span> </span><span class="hs-glyph">=</span><span>
</span><span id="line-2835"></span><span>        </span><span class="hs-special">[d|</span><span>
</span><span id="line-2836"></span><span>            </span><span class="hs-keyword">instance</span><span> </span><span class="hs-identifier">SymbolToField</span><span> </span><span class="hs-special">$</span><span class="hs-special">(</span><span class="hs-identifier">fieldNameT</span><span class="hs-special">)</span><span> </span><span class="hs-special">$</span><span class="hs-special">(</span><span class="hs-identifier">recordNameT</span><span class="hs-special">)</span><span> </span><span class="hs-special">$</span><span class="hs-special">(</span><span class="hs-identifier">fieldTypeT</span><span class="hs-special">)</span><span> </span><span class="hs-keyword">where</span><span>
</span><span id="line-2837"></span><span>                </span><span class="hs-identifier">symbolToField</span><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-special">$</span><span class="hs-special">(</span><span class="hs-identifier">entityFieldConstr</span><span class="hs-special">)</span><span>
</span><span id="line-2838"></span><span>            </span><span class="hs-special">|]</span><span>
</span><span id="line-2839"></span><span>
</span><span id="line-2840"></span><span class="hs-comment">-- | Pass in a list of lists of extensions, where any of the given</span><span>
</span><span id="line-2841"></span><span class="hs-comment">-- extensions will satisfy it. For example, you might need either GADTs or</span><span>
</span><span id="line-2842"></span><span class="hs-comment">-- ExistentialQuantification, so you'd write:</span><span>
</span><span id="line-2843"></span><span class="hs-comment">--</span><span>
</span><span id="line-2844"></span><span class="hs-comment">-- &gt; requireExtensions [[GADTs, ExistentialQuantification]]</span><span>
</span><span id="line-2845"></span><span class="hs-comment">--</span><span>
</span><span id="line-2846"></span><span class="hs-comment">-- But if you need TypeFamilies and MultiParamTypeClasses, then you'd</span><span>
</span><span id="line-2847"></span><span class="hs-comment">-- write:</span><span>
</span><span id="line-2848"></span><span class="hs-comment">--</span><span>
</span><span id="line-2849"></span><span class="hs-comment">-- &gt; requireExtensions [[TypeFamilies], [MultiParamTypeClasses]]</span><span>
</span><span id="line-2850"></span><span class="annot"><a href="Database.Persist.TH.html#requireExtensions"><span class="hs-identifier hs-type">requireExtensions</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="hs-special">[</span><span class="hs-special">[</span><span class="annot"><span class="hs-identifier hs-type">Extension</span></span><span class="hs-special">]</span><span class="hs-special">]</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="hs-identifier hs-type">Q</span></span><span> </span><span class="hs-special">(</span><span class="hs-special">)</span><span>
</span><span id="line-2851"></span><span id="requireExtensions"><span class="annot"><span class="annottext">requireExtensions :: [[Extension]] -&gt; Q ()
</span><a href="Database.Persist.TH.html#requireExtensions"><span class="hs-identifier hs-var hs-var">requireExtensions</span></a></span></span><span> </span><span id="local-6989586621679964017"><span class="annot"><span class="annottext">[[Extension]]
</span><a href="#local-6989586621679964017"><span class="hs-identifier hs-var">requiredExtensions</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-keyword">do</span><span>
</span><span id="line-2852"></span><span>  </span><span class="hs-comment">-- isExtEnabled breaks the persistent-template benchmark with the following error:</span><span>
</span><span id="line-2853"></span><span>  </span><span class="hs-comment">-- Template Haskell error: Can't do `isExtEnabled' in the IO monad</span><span>
</span><span id="line-2854"></span><span>  </span><span class="hs-comment">-- You can workaround this by replacing isExtEnabled with (pure . const True)</span><span>
</span><span id="line-2855"></span><span>  </span><span id="local-6989586621679964016"><span class="annot"><span class="annottext">[[Extension]]
</span><a href="#local-6989586621679964016"><span class="hs-identifier hs-var">unenabledExtensions</span></a></span></span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">forall (m :: * -&gt; *) a.
Applicative m =&gt;
(a -&gt; m Bool) -&gt; [a] -&gt; m [a]
</span><span class="hs-identifier hs-var">filterM</span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">forall (f :: * -&gt; *) a b. Functor f =&gt; (a -&gt; b) -&gt; f a -&gt; f b
</span><span class="hs-identifier hs-var">fmap</span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Bool -&gt; Bool
</span><span class="hs-identifier hs-var">not</span></span><span> </span><span class="annot"><span class="annottext">forall b c a. (b -&gt; c) -&gt; (a -&gt; b) -&gt; a -&gt; c
</span><span class="hs-operator hs-var">.</span></span><span> </span><span class="annot"><span class="annottext">forall (t :: * -&gt; *). Foldable t =&gt; t Bool -&gt; Bool
</span><span class="hs-identifier hs-var">or</span></span><span class="hs-special">)</span><span> </span><span class="annot"><span class="annottext">forall b c a. (b -&gt; c) -&gt; (a -&gt; b) -&gt; a -&gt; c
</span><span class="hs-operator hs-var">.</span></span><span> </span><span class="annot"><span class="annottext">forall (t :: * -&gt; *) (f :: * -&gt; *) a b.
(Traversable t, Applicative f) =&gt;
(a -&gt; f b) -&gt; t a -&gt; f (t b)
</span><span class="hs-identifier hs-var">traverse</span></span><span> </span><span class="annot"><span class="annottext">Extension -&gt; Q Bool
</span><span class="hs-identifier hs-var">isExtEnabled</span></span><span class="hs-special">)</span><span> </span><span class="annot"><span class="annottext">[[Extension]]
</span><a href="#local-6989586621679964017"><span class="hs-identifier hs-var">requiredExtensions</span></a></span><span>
</span><span id="line-2856"></span><span>
</span><span id="line-2857"></span><span>  </span><span class="hs-keyword">case</span><span> </span><span class="annot"><span class="annottext">forall a b. (a -&gt; Maybe b) -&gt; [a] -&gt; [b]
</span><span class="hs-identifier hs-var">mapMaybe</span></span><span> </span><span class="annot"><span class="annottext">forall a. [a] -&gt; Maybe a
</span><span class="hs-identifier hs-var">listToMaybe</span></span><span> </span><span class="annot"><span class="annottext">[[Extension]]
</span><a href="#local-6989586621679964016"><span class="hs-identifier hs-var">unenabledExtensions</span></a></span><span> </span><span class="hs-keyword">of</span><span>
</span><span id="line-2858"></span><span>    </span><span class="hs-special">[</span><span class="hs-special">]</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="annottext">forall (f :: * -&gt; *) a. Applicative f =&gt; a -&gt; f a
</span><span class="hs-identifier hs-var">pure</span></span><span> </span><span class="hs-special">(</span><span class="hs-special">)</span><span>
</span><span id="line-2859"></span><span>    </span><span class="hs-special">[</span><span id="local-6989586621679964013"><span class="annot"><span class="annottext">Extension
</span><a href="#local-6989586621679964013"><span class="hs-identifier hs-var">extension</span></a></span></span><span class="hs-special">]</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="annottext">forall (m :: * -&gt; *) a. MonadFail m =&gt; String -&gt; m a
</span><span class="hs-identifier hs-var">fail</span></span><span> </span><span class="annot"><span class="annottext">forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span> </span><span class="annot"><span class="annottext">forall a. Monoid a =&gt; [a] -&gt; a
</span><span class="hs-identifier hs-var">mconcat</span></span><span>
</span><span id="line-2860"></span><span>                     </span><span class="hs-special">[</span><span> </span><span class="annot"><span class="annottext">String
</span><span class="hs-string">&quot;Generating Persistent entities now requires the &quot;</span></span><span>
</span><span id="line-2861"></span><span>                     </span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">forall a. Show a =&gt; a -&gt; String
</span><span class="hs-identifier hs-var">show</span></span><span> </span><span class="annot"><span class="annottext">Extension
</span><a href="#local-6989586621679964013"><span class="hs-identifier hs-var">extension</span></a></span><span>
</span><span id="line-2862"></span><span>                     </span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">String
</span><span class="hs-string">&quot; language extension. Please enable it by copy/pasting this line to the top of your file:\n\n&quot;</span></span><span>
</span><span id="line-2863"></span><span>                     </span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">forall a. Show a =&gt; a -&gt; String
</span><a href="#local-6989586621679964012"><span class="hs-identifier hs-var">extensionToPragma</span></a></span><span> </span><span class="annot"><span class="annottext">Extension
</span><a href="#local-6989586621679964013"><span class="hs-identifier hs-var">extension</span></a></span><span>
</span><span id="line-2864"></span><span>                     </span><span class="hs-special">]</span><span>
</span><span id="line-2865"></span><span>    </span><span id="local-6989586621679964011"><span class="annot"><span class="annottext">[Extension]
</span><a href="#local-6989586621679964011"><span class="hs-identifier hs-var">extensions</span></a></span></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="annottext">forall (m :: * -&gt; *) a. MonadFail m =&gt; String -&gt; m a
</span><span class="hs-identifier hs-var">fail</span></span><span> </span><span class="annot"><span class="annottext">forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span> </span><span class="annot"><span class="annottext">forall a. Monoid a =&gt; [a] -&gt; a
</span><span class="hs-identifier hs-var">mconcat</span></span><span>
</span><span id="line-2866"></span><span>                    </span><span class="hs-special">[</span><span> </span><span class="annot"><span class="annottext">String
</span><span class="hs-string">&quot;Generating Persistent entities now requires the following language extensions:\n\n&quot;</span></span><span>
</span><span id="line-2867"></span><span>                    </span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">forall a. [a] -&gt; [[a]] -&gt; [a]
</span><span class="hs-identifier hs-var">List.intercalate</span></span><span> </span><span class="annot"><span class="annottext">String
</span><span class="hs-string">&quot;\n&quot;</span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">forall (f :: * -&gt; *) a b. Functor f =&gt; (a -&gt; b) -&gt; f a -&gt; f b
</span><span class="hs-identifier hs-var">fmap</span></span><span> </span><span class="annot"><span class="annottext">forall a. Show a =&gt; a -&gt; String
</span><span class="hs-identifier hs-var">show</span></span><span> </span><span class="annot"><span class="annottext">[Extension]
</span><a href="#local-6989586621679964011"><span class="hs-identifier hs-var">extensions</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-2868"></span><span>                    </span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">String
</span><span class="hs-string">&quot;\n\nPlease enable the extensions by copy/pasting these lines into the top of your file:\n\n&quot;</span></span><span>
</span><span id="line-2869"></span><span>                    </span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">forall a. [a] -&gt; [[a]] -&gt; [a]
</span><span class="hs-identifier hs-var">List.intercalate</span></span><span> </span><span class="annot"><span class="annottext">String
</span><span class="hs-string">&quot;\n&quot;</span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">forall (f :: * -&gt; *) a b. Functor f =&gt; (a -&gt; b) -&gt; f a -&gt; f b
</span><span class="hs-identifier hs-var">fmap</span></span><span> </span><span class="annot"><span class="annottext">forall a. Show a =&gt; a -&gt; String
</span><a href="#local-6989586621679964012"><span class="hs-identifier hs-var">extensionToPragma</span></a></span><span> </span><span class="annot"><span class="annottext">[Extension]
</span><a href="#local-6989586621679964011"><span class="hs-identifier hs-var">extensions</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-2870"></span><span>                    </span><span class="hs-special">]</span><span>
</span><span id="line-2871"></span><span>
</span><span id="line-2872"></span><span>  </span><span class="hs-keyword">where</span><span>
</span><span id="line-2873"></span><span>    </span><span id="local-6989586621679964012"><span class="annot"><span class="annottext">extensionToPragma :: a -&gt; String
</span><a href="#local-6989586621679964012"><span class="hs-identifier hs-var hs-var">extensionToPragma</span></a></span></span><span> </span><span id="local-6989586621679964002"><span class="annot"><span class="annottext">a
</span><a href="#local-6989586621679964002"><span class="hs-identifier hs-var">ext</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">String
</span><span class="hs-string">&quot;{-# LANGUAGE &quot;</span></span><span> </span><span class="annot"><span class="annottext">forall a. Semigroup a =&gt; a -&gt; a -&gt; a
</span><span class="hs-operator hs-var">&lt;&gt;</span></span><span> </span><span class="annot"><span class="annottext">forall a. Show a =&gt; a -&gt; String
</span><span class="hs-identifier hs-var">show</span></span><span> </span><span class="annot"><span class="annottext">a
</span><a href="#local-6989586621679964002"><span class="hs-identifier hs-var">ext</span></a></span><span> </span><span class="annot"><span class="annottext">forall a. Semigroup a =&gt; a -&gt; a -&gt; a
</span><span class="hs-operator hs-var">&lt;&gt;</span></span><span> </span><span class="annot"><span class="annottext">String
</span><span class="hs-string">&quot; #-}&quot;</span></span><span>
</span><span id="line-2874"></span><span>
</span><span id="line-2875"></span><span class="hs-comment">-- | creates a TH Name for use in the ToJSON instance</span><span>
</span><span id="line-2876"></span><span class="annot"><a href="Database.Persist.TH.html#fieldToJSONValName"><span class="hs-identifier hs-type">fieldToJSONValName</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><a href="Database.Persist.Quasi.Internal.html#UnboundFieldDef"><span class="hs-identifier hs-type">UnboundFieldDef</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="hs-identifier hs-type">Q</span></span><span> </span><span class="annot"><span class="hs-identifier hs-type">Name</span></span><span>
</span><span id="line-2877"></span><span id="fieldToJSONValName"><span class="annot"><span class="annottext">fieldToJSONValName :: UnboundFieldDef -&gt; Q Name
</span><a href="Database.Persist.TH.html#fieldToJSONValName"><span class="hs-identifier hs-var hs-var">fieldToJSONValName</span></a></span></span><span> </span><span class="hs-glyph">=</span><span>
</span><span id="line-2878"></span><span>    </span><span class="annot"><span class="annottext">forall (m :: * -&gt; *). Quote m =&gt; String -&gt; m Name
</span><span class="hs-identifier hs-var">newName</span></span><span> </span><span class="annot"><span class="annottext">forall b c a. (b -&gt; c) -&gt; (a -&gt; b) -&gt; a -&gt; c
</span><span class="hs-operator hs-var">.</span></span><span> </span><span class="annot"><span class="annottext">Text -&gt; String
</span><span class="hs-identifier hs-var">T.unpack</span></span><span> </span><span class="annot"><span class="annottext">forall b c a. (b -&gt; c) -&gt; (a -&gt; b) -&gt; a -&gt; c
</span><span class="hs-operator hs-var">.</span></span><span> </span><span class="annot"><span class="annottext">FieldNameHS -&gt; Text
</span><a href="Database.Persist.TH.html#unFieldNameHSForJSON"><span class="hs-identifier hs-var">unFieldNameHSForJSON</span></a></span><span> </span><span class="annot"><span class="annottext">forall b c a. (b -&gt; c) -&gt; (a -&gt; b) -&gt; a -&gt; c
</span><span class="hs-operator hs-var">.</span></span><span> </span><span class="annot"><span class="annottext">UnboundFieldDef -&gt; FieldNameHS
</span><a href="Database.Persist.Quasi.Internal.html#unboundFieldNameHS"><span class="hs-identifier hs-var">unboundFieldNameHS</span></a></span><span>
</span><span id="line-2879"></span><span>
</span><span id="line-2880"></span><span class="hs-comment">-- | This special-cases &quot;type_&quot; and strips out its underscore. When</span><span>
</span><span id="line-2881"></span><span class="hs-comment">-- used for JSON serialization and deserialization, it works around</span><span>
</span><span id="line-2882"></span><span class="hs-comment">-- &lt;https://github.com/yesodweb/persistent/issues/412&gt;</span><span>
</span><span id="line-2883"></span><span class="annot"><a href="Database.Persist.TH.html#unFieldNameHSForJSON"><span class="hs-identifier hs-type">unFieldNameHSForJSON</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><a href="Database.Persist.Names.html#FieldNameHS"><span class="hs-identifier hs-type">FieldNameHS</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="hs-identifier hs-type">Text</span></span><span>
</span><span id="line-2884"></span><span id="unFieldNameHSForJSON"><span class="annot"><span class="annottext">unFieldNameHSForJSON :: FieldNameHS -&gt; Text
</span><a href="Database.Persist.TH.html#unFieldNameHSForJSON"><span class="hs-identifier hs-var hs-var">unFieldNameHSForJSON</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">Text -&gt; Text
</span><a href="#local-6989586621679964000"><span class="hs-identifier hs-var">fixTypeUnderscore</span></a></span><span> </span><span class="annot"><span class="annottext">forall b c a. (b -&gt; c) -&gt; (a -&gt; b) -&gt; a -&gt; c
</span><span class="hs-operator hs-var">.</span></span><span> </span><span class="annot"><span class="annottext">FieldNameHS -&gt; Text
</span><a href="Database.Persist.Names.html#unFieldNameHS"><span class="hs-identifier hs-var">unFieldNameHS</span></a></span><span>
</span><span id="line-2885"></span><span>  </span><span class="hs-keyword">where</span><span>
</span><span id="line-2886"></span><span>    </span><span id="local-6989586621679964000"><span class="annot"><span class="annottext">fixTypeUnderscore :: Text -&gt; Text
</span><a href="#local-6989586621679964000"><span class="hs-identifier hs-var hs-var">fixTypeUnderscore</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-glyph">\</span><span class="hs-glyph">case</span><span>
</span><span id="line-2887"></span><span>        </span><span class="annot"><span class="annottext">Text
</span><span class="hs-string">&quot;type&quot;</span></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="annottext">Text
</span><span class="hs-string">&quot;type_&quot;</span></span><span>
</span><span id="line-2888"></span><span>        </span><span id="local-6989586621679963996"><span class="annot"><span class="annottext">Text
</span><a href="#local-6989586621679963996"><span class="hs-identifier hs-var">name</span></a></span></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="annottext">Text
</span><a href="#local-6989586621679963996"><span class="hs-identifier hs-var">name</span></a></span><span>
</span><span id="line-2889"></span><span>
</span><span id="line-2890"></span><span class="annot"><a href="Database.Persist.TH.html#entityDefConK"><span class="hs-identifier hs-type">entityDefConK</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><a href="Database.Persist.Quasi.Internal.html#UnboundEntityDef"><span class="hs-identifier hs-type">UnboundEntityDef</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="hs-identifier hs-type">Kind</span></span><span>
</span><span id="line-2891"></span><span id="entityDefConK"><span class="annot"><span class="annottext">entityDefConK :: UnboundEntityDef -&gt; Type
</span><a href="Database.Persist.TH.html#entityDefConK"><span class="hs-identifier hs-var hs-var">entityDefConK</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">Name -&gt; Type
</span><span class="hs-identifier hs-var">conK</span></span><span> </span><span class="annot"><span class="annottext">forall b c a. (b -&gt; c) -&gt; (a -&gt; b) -&gt; a -&gt; c
</span><span class="hs-operator hs-var">.</span></span><span> </span><span class="annot"><span class="annottext">UnboundEntityDef -&gt; Name
</span><a href="Database.Persist.TH.html#mkEntityDefName"><span class="hs-identifier hs-var">mkEntityDefName</span></a></span><span>
</span><span id="line-2892"></span><span>
</span><span id="line-2893"></span><span class="annot"><a href="Database.Persist.TH.html#entityDefConT"><span class="hs-identifier hs-type">entityDefConT</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><a href="Database.Persist.Quasi.Internal.html#UnboundEntityDef"><span class="hs-identifier hs-type">UnboundEntityDef</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="hs-identifier hs-type">Q</span></span><span> </span><span class="annot"><span class="hs-identifier hs-type">Type</span></span><span>
</span><span id="line-2894"></span><span id="entityDefConT"><span class="annot"><span class="annottext">entityDefConT :: UnboundEntityDef -&gt; Q Type
</span><a href="Database.Persist.TH.html#entityDefConT"><span class="hs-identifier hs-var hs-var">entityDefConT</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">forall (f :: * -&gt; *) a. Applicative f =&gt; a -&gt; f a
</span><span class="hs-identifier hs-var">pure</span></span><span> </span><span class="annot"><span class="annottext">forall b c a. (b -&gt; c) -&gt; (a -&gt; b) -&gt; a -&gt; c
</span><span class="hs-operator hs-var">.</span></span><span> </span><span class="annot"><span class="annottext">UnboundEntityDef -&gt; Type
</span><a href="Database.Persist.TH.html#entityDefConK"><span class="hs-identifier hs-var">entityDefConK</span></a></span><span>
</span><span id="line-2895"></span><span>
</span><span id="line-2896"></span><span class="annot"><a href="Database.Persist.TH.html#entityDefConE"><span class="hs-identifier hs-type">entityDefConE</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><a href="Database.Persist.Quasi.Internal.html#UnboundEntityDef"><span class="hs-identifier hs-type">UnboundEntityDef</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="hs-identifier hs-type">Exp</span></span><span>
</span><span id="line-2897"></span><span id="entityDefConE"><span class="annot"><span class="annottext">entityDefConE :: UnboundEntityDef -&gt; Exp
</span><a href="Database.Persist.TH.html#entityDefConE"><span class="hs-identifier hs-var hs-var">entityDefConE</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">Name -&gt; Exp
</span><span class="hs-identifier hs-var">ConE</span></span><span> </span><span class="annot"><span class="annottext">forall b c a. (b -&gt; c) -&gt; (a -&gt; b) -&gt; a -&gt; c
</span><span class="hs-operator hs-var">.</span></span><span> </span><span class="annot"><span class="annottext">UnboundEntityDef -&gt; Name
</span><a href="Database.Persist.TH.html#mkEntityDefName"><span class="hs-identifier hs-var">mkEntityDefName</span></a></span><span>
</span><span id="line-2898"></span><span>
</span><span id="line-2899"></span><span class="hs-comment">-- | creates a TH Name for an entity's field, based on the entity</span><span>
</span><span id="line-2900"></span><span class="hs-comment">-- name and the field name, so for example:</span><span>
</span><span id="line-2901"></span><span class="hs-comment">--</span><span>
</span><span id="line-2902"></span><span class="hs-comment">-- Customer</span><span>
</span><span id="line-2903"></span><span class="hs-comment">--   name Text</span><span>
</span><span id="line-2904"></span><span class="hs-comment">--</span><span>
</span><span id="line-2905"></span><span class="hs-comment">-- This would generate `customerName` as a TH Name</span><span>
</span><span id="line-2906"></span><span class="annot"><a href="Database.Persist.TH.html#fieldNameToRecordName"><span class="hs-identifier hs-type">fieldNameToRecordName</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><a href="Database.Persist.TH.html#MkPersistSettings"><span class="hs-identifier hs-type">MkPersistSettings</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="Database.Persist.Quasi.Internal.html#UnboundEntityDef"><span class="hs-identifier hs-type">UnboundEntityDef</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="Database.Persist.Names.html#FieldNameHS"><span class="hs-identifier hs-type">FieldNameHS</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="hs-identifier hs-type">Name</span></span><span>
</span><span id="line-2907"></span><span id="fieldNameToRecordName"><span class="annot"><span class="annottext">fieldNameToRecordName :: MkPersistSettings -&gt; UnboundEntityDef -&gt; FieldNameHS -&gt; Name
</span><a href="Database.Persist.TH.html#fieldNameToRecordName"><span class="hs-identifier hs-var hs-var">fieldNameToRecordName</span></a></span></span><span> </span><span id="local-6989586621679963994"><span class="annot"><span class="annottext">MkPersistSettings
</span><a href="#local-6989586621679963994"><span class="hs-identifier hs-var">mps</span></a></span></span><span> </span><span id="local-6989586621679963993"><span class="annot"><span class="annottext">UnboundEntityDef
</span><a href="#local-6989586621679963993"><span class="hs-identifier hs-var">entDef</span></a></span></span><span> </span><span id="local-6989586621679963992"><span class="annot"><span class="annottext">FieldNameHS
</span><a href="#local-6989586621679963992"><span class="hs-identifier hs-var">fieldName</span></a></span></span><span> </span><span class="hs-glyph">=</span><span>
</span><span id="line-2908"></span><span>    </span><span class="annot"><span class="annottext">MkPersistSettings
-&gt; Maybe Text -&gt; EntityNameHS -&gt; FieldNameHS -&gt; Name
</span><a href="Database.Persist.TH.html#mkRecordName"><span class="hs-identifier hs-var">mkRecordName</span></a></span><span> </span><span class="annot"><span class="annottext">MkPersistSettings
</span><a href="#local-6989586621679963994"><span class="hs-identifier hs-var">mps</span></a></span><span> </span><span class="annot"><span class="annottext">Maybe Text
</span><a href="#local-6989586621679963990"><span class="hs-identifier hs-var">mUnderscore</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">EntityDef -&gt; EntityNameHS
</span><a href="Database.Persist.Types.Base.html#entityHaskell"><span class="hs-identifier hs-var">entityHaskell</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">UnboundEntityDef -&gt; EntityDef
</span><a href="Database.Persist.Quasi.Internal.html#unboundEntityDef"><span class="hs-identifier hs-var">unboundEntityDef</span></a></span><span> </span><span class="annot"><span class="annottext">UnboundEntityDef
</span><a href="#local-6989586621679963993"><span class="hs-identifier hs-var">entDef</span></a></span><span class="hs-special">)</span><span class="hs-special">)</span><span> </span><span class="annot"><span class="annottext">FieldNameHS
</span><a href="#local-6989586621679963992"><span class="hs-identifier hs-var">fieldName</span></a></span><span>
</span><span id="line-2909"></span><span>  </span><span class="hs-keyword">where</span><span>
</span><span id="line-2910"></span><span>    </span><span id="local-6989586621679963990"><span class="annot"><span class="annottext">mUnderscore :: Maybe Text
</span><a href="#local-6989586621679963990"><span class="hs-identifier hs-var hs-var">mUnderscore</span></a></span></span><span>
</span><span id="line-2911"></span><span>        </span><span class="hs-glyph">|</span><span> </span><span class="annot"><span class="annottext">MkPersistSettings -&gt; Bool
</span><a href="Database.Persist.TH.html#mpsGenerateLenses"><span class="hs-identifier hs-var">mpsGenerateLenses</span></a></span><span> </span><span class="annot"><span class="annottext">MkPersistSettings
</span><a href="#local-6989586621679963994"><span class="hs-identifier hs-var">mps</span></a></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">forall a. a -&gt; Maybe a
</span><span class="hs-identifier hs-var">Just</span></span><span> </span><span class="annot"><span class="annottext">Text
</span><span class="hs-string">&quot;_&quot;</span></span><span>
</span><span id="line-2912"></span><span>        </span><span class="hs-glyph">|</span><span> </span><span class="annot"><span class="annottext">Bool
</span><span class="hs-identifier hs-var">otherwise</span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">forall a. Maybe a
</span><span class="hs-identifier hs-var">Nothing</span></span><span>
</span><span id="line-2913"></span><span>
</span><span id="line-2914"></span><span class="hs-comment">-- | as above, only takes a `FieldDef`</span><span>
</span><span id="line-2915"></span><span class="annot"><a href="Database.Persist.TH.html#fieldDefToRecordName"><span class="hs-identifier hs-type">fieldDefToRecordName</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><a href="Database.Persist.TH.html#MkPersistSettings"><span class="hs-identifier hs-type">MkPersistSettings</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="Database.Persist.Quasi.Internal.html#UnboundEntityDef"><span class="hs-identifier hs-type">UnboundEntityDef</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="Database.Persist.Quasi.Internal.html#UnboundFieldDef"><span class="hs-identifier hs-type">UnboundFieldDef</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="hs-identifier hs-type">Name</span></span><span>
</span><span id="line-2916"></span><span id="fieldDefToRecordName"><span class="annot"><span class="annottext">fieldDefToRecordName :: MkPersistSettings -&gt; UnboundEntityDef -&gt; UnboundFieldDef -&gt; Name
</span><a href="Database.Persist.TH.html#fieldDefToRecordName"><span class="hs-identifier hs-var hs-var">fieldDefToRecordName</span></a></span></span><span> </span><span id="local-6989586621679963989"><span class="annot"><span class="annottext">MkPersistSettings
</span><a href="#local-6989586621679963989"><span class="hs-identifier hs-var">mps</span></a></span></span><span> </span><span id="local-6989586621679963988"><span class="annot"><span class="annottext">UnboundEntityDef
</span><a href="#local-6989586621679963988"><span class="hs-identifier hs-var">entDef</span></a></span></span><span> </span><span id="local-6989586621679963987"><span class="annot"><span class="annottext">UnboundFieldDef
</span><a href="#local-6989586621679963987"><span class="hs-identifier hs-var">fieldDef</span></a></span></span><span> </span><span class="hs-glyph">=</span><span>
</span><span id="line-2917"></span><span>    </span><span class="annot"><span class="annottext">MkPersistSettings -&gt; UnboundEntityDef -&gt; FieldNameHS -&gt; Name
</span><a href="Database.Persist.TH.html#fieldNameToRecordName"><span class="hs-identifier hs-var">fieldNameToRecordName</span></a></span><span> </span><span class="annot"><span class="annottext">MkPersistSettings
</span><a href="#local-6989586621679963989"><span class="hs-identifier hs-var">mps</span></a></span><span> </span><span class="annot"><span class="annottext">UnboundEntityDef
</span><a href="#local-6989586621679963988"><span class="hs-identifier hs-var">entDef</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">UnboundFieldDef -&gt; FieldNameHS
</span><a href="Database.Persist.Quasi.Internal.html#unboundFieldNameHS"><span class="hs-identifier hs-var">unboundFieldNameHS</span></a></span><span> </span><span class="annot"><span class="annottext">UnboundFieldDef
</span><a href="#local-6989586621679963987"><span class="hs-identifier hs-var">fieldDef</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-2918"></span><span>
</span><span id="line-2919"></span><span class="hs-comment">-- | creates a TH Name for a lens on an entity's field, based on the entity</span><span>
</span><span id="line-2920"></span><span class="hs-comment">-- name and the field name, so as above but for the Lens</span><span>
</span><span id="line-2921"></span><span class="hs-comment">--</span><span>
</span><span id="line-2922"></span><span class="hs-comment">-- Customer</span><span>
</span><span id="line-2923"></span><span class="hs-comment">--   name Text</span><span>
</span><span id="line-2924"></span><span class="hs-comment">--</span><span>
</span><span id="line-2925"></span><span class="hs-comment">-- Generates a lens `customerName` when `mpsGenerateLenses` is true</span><span>
</span><span id="line-2926"></span><span class="hs-comment">-- while `fieldNameToRecordName` generates a prefixed function</span><span>
</span><span id="line-2927"></span><span class="hs-comment">-- `_customerName`</span><span>
</span><span id="line-2928"></span><span class="annot"><a href="Database.Persist.TH.html#mkEntityLensName"><span class="hs-identifier hs-type">mkEntityLensName</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><a href="Database.Persist.TH.html#MkPersistSettings"><span class="hs-identifier hs-type">MkPersistSettings</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="Database.Persist.Quasi.Internal.html#UnboundEntityDef"><span class="hs-identifier hs-type">UnboundEntityDef</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="Database.Persist.Quasi.Internal.html#UnboundFieldDef"><span class="hs-identifier hs-type">UnboundFieldDef</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="hs-identifier hs-type">Name</span></span><span>
</span><span id="line-2929"></span><span id="mkEntityLensName"><span class="annot"><span class="annottext">mkEntityLensName :: MkPersistSettings -&gt; UnboundEntityDef -&gt; UnboundFieldDef -&gt; Name
</span><a href="Database.Persist.TH.html#mkEntityLensName"><span class="hs-identifier hs-var hs-var">mkEntityLensName</span></a></span></span><span> </span><span id="local-6989586621679963986"><span class="annot"><span class="annottext">MkPersistSettings
</span><a href="#local-6989586621679963986"><span class="hs-identifier hs-var">mps</span></a></span></span><span> </span><span id="local-6989586621679963985"><span class="annot"><span class="annottext">UnboundEntityDef
</span><a href="#local-6989586621679963985"><span class="hs-identifier hs-var">entDef</span></a></span></span><span> </span><span id="local-6989586621679963984"><span class="annot"><span class="annottext">UnboundFieldDef
</span><a href="#local-6989586621679963984"><span class="hs-identifier hs-var">fieldDef</span></a></span></span><span> </span><span class="hs-glyph">=</span><span>
</span><span id="line-2930"></span><span>    </span><span class="annot"><span class="annottext">MkPersistSettings
-&gt; Maybe Text -&gt; EntityNameHS -&gt; FieldNameHS -&gt; Name
</span><a href="Database.Persist.TH.html#mkRecordName"><span class="hs-identifier hs-var">mkRecordName</span></a></span><span> </span><span class="annot"><span class="annottext">MkPersistSettings
</span><a href="#local-6989586621679963986"><span class="hs-identifier hs-var">mps</span></a></span><span> </span><span class="annot"><span class="annottext">forall a. Maybe a
</span><span class="hs-identifier hs-var">Nothing</span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">EntityDef -&gt; EntityNameHS
</span><a href="Database.Persist.Types.Base.html#entityHaskell"><span class="hs-identifier hs-var">entityHaskell</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">UnboundEntityDef -&gt; EntityDef
</span><a href="Database.Persist.Quasi.Internal.html#unboundEntityDef"><span class="hs-identifier hs-var">unboundEntityDef</span></a></span><span> </span><span class="annot"><span class="annottext">UnboundEntityDef
</span><a href="#local-6989586621679963985"><span class="hs-identifier hs-var">entDef</span></a></span><span class="hs-special">)</span><span class="hs-special">)</span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">UnboundFieldDef -&gt; FieldNameHS
</span><a href="Database.Persist.Quasi.Internal.html#unboundFieldNameHS"><span class="hs-identifier hs-var">unboundFieldNameHS</span></a></span><span> </span><span class="annot"><span class="annottext">UnboundFieldDef
</span><a href="#local-6989586621679963984"><span class="hs-identifier hs-var">fieldDef</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-2931"></span><span>
</span><span id="line-2932"></span><span class="annot"><a href="Database.Persist.TH.html#mkRecordName"><span class="hs-identifier hs-type">mkRecordName</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><a href="Database.Persist.TH.html#MkPersistSettings"><span class="hs-identifier hs-type">MkPersistSettings</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="hs-identifier hs-type">Maybe</span></span><span> </span><span class="annot"><span class="hs-identifier hs-type">Text</span></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="Database.Persist.Names.html#EntityNameHS"><span class="hs-identifier hs-type">EntityNameHS</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="Database.Persist.Names.html#FieldNameHS"><span class="hs-identifier hs-type">FieldNameHS</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="hs-identifier hs-type">Name</span></span><span>
</span><span id="line-2933"></span><span id="mkRecordName"><span class="annot"><span class="annottext">mkRecordName :: MkPersistSettings
-&gt; Maybe Text -&gt; EntityNameHS -&gt; FieldNameHS -&gt; Name
</span><a href="Database.Persist.TH.html#mkRecordName"><span class="hs-identifier hs-var hs-var">mkRecordName</span></a></span></span><span> </span><span id="local-6989586621679963983"><span class="annot"><span class="annottext">MkPersistSettings
</span><a href="#local-6989586621679963983"><span class="hs-identifier hs-var">mps</span></a></span></span><span> </span><span id="local-6989586621679963982"><span class="annot"><span class="annottext">Maybe Text
</span><a href="#local-6989586621679963982"><span class="hs-identifier hs-var">prefix</span></a></span></span><span> </span><span id="local-6989586621679963981"><span class="annot"><span class="annottext">EntityNameHS
</span><a href="#local-6989586621679963981"><span class="hs-identifier hs-var">entNameHS</span></a></span></span><span> </span><span id="local-6989586621679963980"><span class="annot"><span class="annottext">FieldNameHS
</span><a href="#local-6989586621679963980"><span class="hs-identifier hs-var">fieldNameHS</span></a></span></span><span> </span><span class="hs-glyph">=</span><span>
</span><span id="line-2934"></span><span>    </span><span class="annot"><span class="annottext">String -&gt; Name
</span><span class="hs-identifier hs-var">mkName</span></span><span> </span><span class="annot"><span class="annottext">forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span> </span><span class="annot"><span class="annottext">Text -&gt; String
</span><span class="hs-identifier hs-var">T.unpack</span></span><span> </span><span class="annot"><span class="annottext">forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span> </span><span class="annot"><span class="annottext">forall a. a -&gt; Maybe a -&gt; a
</span><span class="hs-identifier hs-var">fromMaybe</span></span><span> </span><span class="annot"><span class="annottext">Text
</span><span class="hs-string">&quot;&quot;</span></span><span> </span><span class="annot"><span class="annottext">Maybe Text
</span><a href="#local-6989586621679963982"><span class="hs-identifier hs-var">prefix</span></a></span><span> </span><span class="annot"><span class="annottext">forall a. Semigroup a =&gt; a -&gt; a -&gt; a
</span><span class="hs-operator hs-var">&lt;&gt;</span></span><span> </span><span class="annot"><span class="annottext">Text -&gt; Text
</span><a href="Database.Persist.TH.html#lowerFirst"><span class="hs-identifier hs-var">lowerFirst</span></a></span><span> </span><span class="annot"><span class="annottext">Text
</span><a href="#local-6989586621679963979"><span class="hs-identifier hs-var">recName</span></a></span><span>
</span><span id="line-2935"></span><span>  </span><span class="hs-keyword">where</span><span>
</span><span id="line-2936"></span><span>    </span><span class="annot"><a href="#local-6989586621679963979"><span class="hs-identifier hs-type">recName</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><span class="hs-identifier hs-type">Text</span></span><span>
</span><span id="line-2937"></span><span>    </span><span id="local-6989586621679963979"><span class="annot"><span class="annottext">recName :: Text
</span><a href="#local-6989586621679963979"><span class="hs-identifier hs-var hs-var">recName</span></a></span></span><span>
</span><span id="line-2938"></span><span>      </span><span class="hs-glyph">|</span><span> </span><span class="annot"><span class="annottext">MkPersistSettings -&gt; Bool
</span><a href="Database.Persist.TH.html#mpsPrefixFields"><span class="hs-identifier hs-var">mpsPrefixFields</span></a></span><span> </span><span class="annot"><span class="annottext">MkPersistSettings
</span><a href="#local-6989586621679963983"><span class="hs-identifier hs-var">mps</span></a></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">MkPersistSettings -&gt; Text -&gt; Text -&gt; Text
</span><a href="Database.Persist.TH.html#mpsFieldLabelModifier"><span class="hs-identifier hs-var">mpsFieldLabelModifier</span></a></span><span> </span><span class="annot"><span class="annottext">MkPersistSettings
</span><a href="#local-6989586621679963983"><span class="hs-identifier hs-var">mps</span></a></span><span> </span><span class="annot"><span class="annottext">Text
</span><a href="#local-6989586621679963978"><span class="hs-identifier hs-var">entityNameText</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Text -&gt; Text
</span><a href="Database.Persist.TH.html#upperFirst"><span class="hs-identifier hs-var">upperFirst</span></a></span><span> </span><span class="annot"><span class="annottext">Text
</span><a href="#local-6989586621679963977"><span class="hs-identifier hs-var">fieldNameText</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-2939"></span><span>      </span><span class="hs-glyph">|</span><span> </span><span class="annot"><span class="annottext">Bool
</span><span class="hs-identifier hs-var">otherwise</span></span><span>           </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">Text
</span><a href="#local-6989586621679963977"><span class="hs-identifier hs-var">fieldNameText</span></a></span><span>
</span><span id="line-2940"></span><span>
</span><span id="line-2941"></span><span>    </span><span class="annot"><a href="#local-6989586621679963978"><span class="hs-identifier hs-type">entityNameText</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><span class="hs-identifier hs-type">Text</span></span><span>
</span><span id="line-2942"></span><span>    </span><span id="local-6989586621679963978"><span class="annot"><span class="annottext">entityNameText :: Text
</span><a href="#local-6989586621679963978"><span class="hs-identifier hs-var hs-var">entityNameText</span></a></span></span><span> </span><span class="hs-glyph">=</span><span>
</span><span id="line-2943"></span><span>      </span><span class="annot"><span class="annottext">EntityNameHS -&gt; Text
</span><a href="Database.Persist.Names.html#unEntityNameHS"><span class="hs-identifier hs-var">unEntityNameHS</span></a></span><span> </span><span class="annot"><span class="annottext">EntityNameHS
</span><a href="#local-6989586621679963981"><span class="hs-identifier hs-var">entNameHS</span></a></span><span>
</span><span id="line-2944"></span><span>
</span><span id="line-2945"></span><span>    </span><span class="annot"><a href="#local-6989586621679963977"><span class="hs-identifier hs-type">fieldNameText</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><span class="hs-identifier hs-type">Text</span></span><span>
</span><span id="line-2946"></span><span>    </span><span id="local-6989586621679963977"><span class="annot"><span class="annottext">fieldNameText :: Text
</span><a href="#local-6989586621679963977"><span class="hs-identifier hs-var hs-var">fieldNameText</span></a></span></span><span> </span><span class="hs-glyph">=</span><span>
</span><span id="line-2947"></span><span>        </span><span class="annot"><span class="annottext">FieldNameHS -&gt; Text
</span><a href="Database.Persist.Names.html#unFieldNameHS"><span class="hs-identifier hs-var">unFieldNameHS</span></a></span><span> </span><span class="annot"><span class="annottext">FieldNameHS
</span><a href="#local-6989586621679963980"><span class="hs-identifier hs-var">fieldNameHS</span></a></span><span>
</span><span id="line-2948"></span><span>
</span><span id="line-2949"></span><span class="hs-comment">-- | Construct a list of TH Names for the typeclasses of an EntityDef's `entityDerives`</span><span>
</span><span id="line-2950"></span><span class="annot"><a href="Database.Persist.TH.html#mkEntityDefDeriveNames"><span class="hs-identifier hs-type">mkEntityDefDeriveNames</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><a href="Database.Persist.TH.html#MkPersistSettings"><span class="hs-identifier hs-type">MkPersistSettings</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="Database.Persist.Quasi.Internal.html#UnboundEntityDef"><span class="hs-identifier hs-type">UnboundEntityDef</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-special">[</span><span class="annot"><span class="hs-identifier hs-type">Name</span></span><span class="hs-special">]</span><span>
</span><span id="line-2951"></span><span id="mkEntityDefDeriveNames"><span class="annot"><span class="annottext">mkEntityDefDeriveNames :: MkPersistSettings -&gt; UnboundEntityDef -&gt; [Name]
</span><a href="Database.Persist.TH.html#mkEntityDefDeriveNames"><span class="hs-identifier hs-var hs-var">mkEntityDefDeriveNames</span></a></span></span><span> </span><span id="local-6989586621679963976"><span class="annot"><span class="annottext">MkPersistSettings
</span><a href="#local-6989586621679963976"><span class="hs-identifier hs-var">mps</span></a></span></span><span> </span><span id="local-6989586621679963975"><span class="annot"><span class="annottext">UnboundEntityDef
</span><a href="#local-6989586621679963975"><span class="hs-identifier hs-var">entDef</span></a></span></span><span> </span><span class="hs-glyph">=</span><span>
</span><span id="line-2952"></span><span>    </span><span class="hs-keyword">let</span><span>
</span><span id="line-2953"></span><span>        </span><span id="local-6989586621679963974"><span class="annot"><span class="annottext">entityInstances :: [Name]
</span><a href="#local-6989586621679963974"><span class="hs-identifier hs-var hs-var">entityInstances</span></a></span></span><span> </span><span class="hs-glyph">=</span><span>
</span><span id="line-2954"></span><span>            </span><span class="annot"><span class="annottext">String -&gt; Name
</span><span class="hs-identifier hs-var">mkName</span></span><span> </span><span class="annot"><span class="annottext">forall b c a. (b -&gt; c) -&gt; (a -&gt; b) -&gt; a -&gt; c
</span><span class="hs-operator hs-var">.</span></span><span> </span><span class="annot"><span class="annottext">Text -&gt; String
</span><span class="hs-identifier hs-var">T.unpack</span></span><span> </span><span class="annot"><span class="annottext">forall (f :: * -&gt; *) a b. Functor f =&gt; (a -&gt; b) -&gt; f a -&gt; f b
</span><span class="hs-operator hs-var">&lt;$&gt;</span></span><span> </span><span class="annot"><span class="annottext">EntityDef -&gt; [Text]
</span><a href="Database.Persist.Types.Base.html#entityDerives"><span class="hs-identifier hs-var">entityDerives</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">UnboundEntityDef -&gt; EntityDef
</span><a href="Database.Persist.Quasi.Internal.html#unboundEntityDef"><span class="hs-identifier hs-var">unboundEntityDef</span></a></span><span> </span><span class="annot"><span class="annottext">UnboundEntityDef
</span><a href="#local-6989586621679963975"><span class="hs-identifier hs-var">entDef</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-2955"></span><span>        </span><span id="local-6989586621679963972"><span class="annot"><span class="annottext">additionalInstances :: [Name]
</span><a href="#local-6989586621679963972"><span class="hs-identifier hs-var hs-var">additionalInstances</span></a></span></span><span> </span><span class="hs-glyph">=</span><span>
</span><span id="line-2956"></span><span>            </span><span class="annot"><span class="annottext">forall a. (a -&gt; Bool) -&gt; [a] -&gt; [a]
</span><span class="hs-identifier hs-var">filter</span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">forall (t :: * -&gt; *) a. (Foldable t, Eq a) =&gt; a -&gt; t a -&gt; Bool
</span><span class="hs-operator hs-var">`notElem`</span></span><span> </span><span class="annot"><span class="annottext">[Name]
</span><a href="#local-6989586621679963974"><span class="hs-identifier hs-var">entityInstances</span></a></span><span class="hs-special">)</span><span> </span><span class="annot"><span class="annottext">forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span> </span><span class="annot"><span class="annottext">MkPersistSettings -&gt; [Name]
</span><a href="Database.Persist.TH.html#mpsDeriveInstances"><span class="hs-identifier hs-var">mpsDeriveInstances</span></a></span><span> </span><span class="annot"><span class="annottext">MkPersistSettings
</span><a href="#local-6989586621679963976"><span class="hs-identifier hs-var">mps</span></a></span><span>
</span><span id="line-2957"></span><span>     </span><span class="hs-keyword">in</span><span>
</span><span id="line-2958"></span><span>        </span><span class="annot"><span class="annottext">[Name]
</span><a href="#local-6989586621679963974"><span class="hs-identifier hs-var">entityInstances</span></a></span><span> </span><span class="annot"><span class="annottext">forall a. Semigroup a =&gt; a -&gt; a -&gt; a
</span><span class="hs-operator hs-var">&lt;&gt;</span></span><span> </span><span class="annot"><span class="annottext">[Name]
</span><a href="#local-6989586621679963972"><span class="hs-identifier hs-var">additionalInstances</span></a></span><span>
</span><span id="line-2959"></span><span>
</span><span id="line-2960"></span><span class="hs-comment">-- | Make a TH Name for the EntityDef's Haskell type</span><span>
</span><span id="line-2961"></span><span class="annot"><a href="Database.Persist.TH.html#mkEntityNameHSName"><span class="hs-identifier hs-type">mkEntityNameHSName</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><a href="Database.Persist.Names.html#EntityNameHS"><span class="hs-identifier hs-type">EntityNameHS</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="hs-identifier hs-type">Name</span></span><span>
</span><span id="line-2962"></span><span id="mkEntityNameHSName"><span class="annot"><span class="annottext">mkEntityNameHSName :: EntityNameHS -&gt; Name
</span><a href="Database.Persist.TH.html#mkEntityNameHSName"><span class="hs-identifier hs-var hs-var">mkEntityNameHSName</span></a></span></span><span> </span><span class="hs-glyph">=</span><span>
</span><span id="line-2963"></span><span>    </span><span class="annot"><span class="annottext">String -&gt; Name
</span><span class="hs-identifier hs-var">mkName</span></span><span> </span><span class="annot"><span class="annottext">forall b c a. (b -&gt; c) -&gt; (a -&gt; b) -&gt; a -&gt; c
</span><span class="hs-operator hs-var">.</span></span><span> </span><span class="annot"><span class="annottext">Text -&gt; String
</span><span class="hs-identifier hs-var">T.unpack</span></span><span> </span><span class="annot"><span class="annottext">forall b c a. (b -&gt; c) -&gt; (a -&gt; b) -&gt; a -&gt; c
</span><span class="hs-operator hs-var">.</span></span><span> </span><span class="annot"><span class="annottext">EntityNameHS -&gt; Text
</span><a href="Database.Persist.Names.html#unEntityNameHS"><span class="hs-identifier hs-var">unEntityNameHS</span></a></span><span>
</span><span id="line-2964"></span><span>
</span><span id="line-2965"></span><span class="hs-comment">-- | As above only taking an `EntityDef`</span><span>
</span><span id="line-2966"></span><span class="annot"><a href="Database.Persist.TH.html#mkEntityDefName"><span class="hs-identifier hs-type">mkEntityDefName</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><a href="Database.Persist.Quasi.Internal.html#UnboundEntityDef"><span class="hs-identifier hs-type">UnboundEntityDef</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="hs-identifier hs-type">Name</span></span><span>
</span><span id="line-2967"></span><span id="mkEntityDefName"><span class="annot"><span class="annottext">mkEntityDefName :: UnboundEntityDef -&gt; Name
</span><a href="Database.Persist.TH.html#mkEntityDefName"><span class="hs-identifier hs-var hs-var">mkEntityDefName</span></a></span></span><span> </span><span class="hs-glyph">=</span><span>
</span><span id="line-2968"></span><span>    </span><span class="annot"><span class="annottext">EntityNameHS -&gt; Name
</span><a href="Database.Persist.TH.html#mkEntityNameHSName"><span class="hs-identifier hs-var">mkEntityNameHSName</span></a></span><span> </span><span class="annot"><span class="annottext">forall b c a. (b -&gt; c) -&gt; (a -&gt; b) -&gt; a -&gt; c
</span><span class="hs-operator hs-var">.</span></span><span> </span><span class="annot"><span class="annottext">EntityDef -&gt; EntityNameHS
</span><a href="Database.Persist.Types.Base.html#entityHaskell"><span class="hs-identifier hs-var">entityHaskell</span></a></span><span> </span><span class="annot"><span class="annottext">forall b c a. (b -&gt; c) -&gt; (a -&gt; b) -&gt; a -&gt; c
</span><span class="hs-operator hs-var">.</span></span><span> </span><span class="annot"><span class="annottext">UnboundEntityDef -&gt; EntityDef
</span><a href="Database.Persist.Quasi.Internal.html#unboundEntityDef"><span class="hs-identifier hs-var">unboundEntityDef</span></a></span><span>
</span><span id="line-2969"></span><span>
</span><span id="line-2970"></span><span class="hs-comment">-- | Make a TH Name for the EntityDef's Haskell type, when using mpsGeneric</span><span>
</span><span id="line-2971"></span><span class="annot"><a href="Database.Persist.TH.html#mkEntityDefGenericName"><span class="hs-identifier hs-type">mkEntityDefGenericName</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><a href="Database.Persist.Quasi.Internal.html#UnboundEntityDef"><span class="hs-identifier hs-type">UnboundEntityDef</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="hs-identifier hs-type">Name</span></span><span>
</span><span id="line-2972"></span><span id="mkEntityDefGenericName"><span class="annot"><span class="annottext">mkEntityDefGenericName :: UnboundEntityDef -&gt; Name
</span><a href="Database.Persist.TH.html#mkEntityDefGenericName"><span class="hs-identifier hs-var hs-var">mkEntityDefGenericName</span></a></span></span><span> </span><span class="hs-glyph">=</span><span>
</span><span id="line-2973"></span><span>    </span><span class="annot"><span class="annottext">EntityNameHS -&gt; Name
</span><a href="Database.Persist.TH.html#mkEntityNameHSGenericName"><span class="hs-identifier hs-var">mkEntityNameHSGenericName</span></a></span><span> </span><span class="annot"><span class="annottext">forall b c a. (b -&gt; c) -&gt; (a -&gt; b) -&gt; a -&gt; c
</span><span class="hs-operator hs-var">.</span></span><span> </span><span class="annot"><span class="annottext">EntityDef -&gt; EntityNameHS
</span><a href="Database.Persist.Types.Base.html#entityHaskell"><span class="hs-identifier hs-var">entityHaskell</span></a></span><span> </span><span class="annot"><span class="annottext">forall b c a. (b -&gt; c) -&gt; (a -&gt; b) -&gt; a -&gt; c
</span><span class="hs-operator hs-var">.</span></span><span> </span><span class="annot"><span class="annottext">UnboundEntityDef -&gt; EntityDef
</span><a href="Database.Persist.Quasi.Internal.html#unboundEntityDef"><span class="hs-identifier hs-var">unboundEntityDef</span></a></span><span>
</span><span id="line-2974"></span><span>
</span><span id="line-2975"></span><span class="annot"><a href="Database.Persist.TH.html#mkEntityNameHSGenericName"><span class="hs-identifier hs-type">mkEntityNameHSGenericName</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><a href="Database.Persist.Names.html#EntityNameHS"><span class="hs-identifier hs-type">EntityNameHS</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="hs-identifier hs-type">Name</span></span><span>
</span><span id="line-2976"></span><span id="mkEntityNameHSGenericName"><span class="annot"><span class="annottext">mkEntityNameHSGenericName :: EntityNameHS -&gt; Name
</span><a href="Database.Persist.TH.html#mkEntityNameHSGenericName"><span class="hs-identifier hs-var hs-var">mkEntityNameHSGenericName</span></a></span></span><span> </span><span id="local-6989586621679963971"><span class="annot"><span class="annottext">EntityNameHS
</span><a href="#local-6989586621679963971"><span class="hs-identifier hs-var">name</span></a></span></span><span> </span><span class="hs-glyph">=</span><span>
</span><span id="line-2977"></span><span>    </span><span class="annot"><span class="annottext">String -&gt; Name
</span><span class="hs-identifier hs-var">mkName</span></span><span> </span><span class="annot"><span class="annottext">forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span> </span><span class="annot"><span class="annottext">Text -&gt; String
</span><span class="hs-identifier hs-var">T.unpack</span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">EntityNameHS -&gt; Text
</span><a href="Database.Persist.Names.html#unEntityNameHS"><span class="hs-identifier hs-var">unEntityNameHS</span></a></span><span> </span><span class="annot"><span class="annottext">EntityNameHS
</span><a href="#local-6989586621679963971"><span class="hs-identifier hs-var">name</span></a></span><span> </span><span class="annot"><span class="annottext">forall a. Semigroup a =&gt; a -&gt; a -&gt; a
</span><span class="hs-operator hs-var">&lt;&gt;</span></span><span> </span><span class="annot"><span class="annottext">Text
</span><span class="hs-string">&quot;Generic&quot;</span></span><span class="hs-special">)</span><span>
</span><span id="line-2978"></span><span>
</span><span id="line-2979"></span><span class="hs-comment">-- needs:</span><span>
</span><span id="line-2980"></span><span class="hs-comment">--</span><span>
</span><span id="line-2981"></span><span class="hs-comment">-- * entityHaskell</span><span>
</span><span id="line-2982"></span><span class="hs-comment">--     * field on EntityDef</span><span>
</span><span id="line-2983"></span><span class="hs-comment">-- * fieldHaskell</span><span>
</span><span id="line-2984"></span><span class="hs-comment">--     * field on FieldDef</span><span>
</span><span id="line-2985"></span><span class="hs-comment">--</span><span>
</span><span id="line-2986"></span><span class="annot"><a href="Database.Persist.TH.html#sumConstrName"><span class="hs-identifier hs-type">sumConstrName</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><a href="Database.Persist.TH.html#MkPersistSettings"><span class="hs-identifier hs-type">MkPersistSettings</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="Database.Persist.Quasi.Internal.html#UnboundEntityDef"><span class="hs-identifier hs-type">UnboundEntityDef</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="Database.Persist.Quasi.Internal.html#UnboundFieldDef"><span class="hs-identifier hs-type">UnboundFieldDef</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="hs-identifier hs-type">Name</span></span><span>
</span><span id="line-2987"></span><span id="sumConstrName"><span class="annot"><span class="annottext">sumConstrName :: MkPersistSettings -&gt; UnboundEntityDef -&gt; UnboundFieldDef -&gt; Name
</span><a href="Database.Persist.TH.html#sumConstrName"><span class="hs-identifier hs-var hs-var">sumConstrName</span></a></span></span><span> </span><span id="local-6989586621679963970"><span class="annot"><span class="annottext">MkPersistSettings
</span><a href="#local-6989586621679963970"><span class="hs-identifier hs-var">mps</span></a></span></span><span> </span><span id="local-6989586621679963969"><span class="annot"><span class="annottext">UnboundEntityDef
</span><a href="#local-6989586621679963969"><span class="hs-identifier hs-var">entDef</span></a></span></span><span> </span><span id="local-6989586621679963968"><span class="annot"><span class="annottext">UnboundFieldDef
</span><a href="#local-6989586621679963968"><span class="hs-identifier hs-var">unboundFieldDef</span></a></span></span><span> </span><span class="hs-glyph">=</span><span>
</span><span id="line-2988"></span><span>    </span><span class="annot"><span class="annottext">String -&gt; Name
</span><span class="hs-identifier hs-var">mkName</span></span><span> </span><span class="annot"><span class="annottext">forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span> </span><span class="annot"><span class="annottext">Text -&gt; String
</span><span class="hs-identifier hs-var">T.unpack</span></span><span> </span><span class="annot"><span class="annottext">Text
</span><a href="#local-6989586621679963967"><span class="hs-identifier hs-var">name</span></a></span><span>
</span><span id="line-2989"></span><span>  </span><span class="hs-keyword">where</span><span>
</span><span id="line-2990"></span><span>    </span><span id="local-6989586621679963967"><span class="annot"><span class="annottext">name :: Text
</span><a href="#local-6989586621679963967"><span class="hs-identifier hs-var hs-var">name</span></a></span></span><span>
</span><span id="line-2991"></span><span>        </span><span class="hs-glyph">|</span><span> </span><span class="annot"><span class="annottext">MkPersistSettings -&gt; Bool
</span><a href="Database.Persist.TH.html#mpsPrefixFields"><span class="hs-identifier hs-var">mpsPrefixFields</span></a></span><span> </span><span class="annot"><span class="annottext">MkPersistSettings
</span><a href="#local-6989586621679963970"><span class="hs-identifier hs-var">mps</span></a></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">Text
</span><a href="#local-6989586621679963966"><span class="hs-identifier hs-var">modifiedName</span></a></span><span> </span><span class="annot"><span class="annottext">forall m. Monoid m =&gt; m -&gt; m -&gt; m
</span><a href="Database.Persist.TH.html#%2B%2B"><span class="hs-operator hs-var">++</span></a></span><span> </span><span class="annot"><span class="annottext">Text
</span><span class="hs-string">&quot;Sum&quot;</span></span><span>
</span><span id="line-2992"></span><span>        </span><span class="hs-glyph">|</span><span> </span><span class="annot"><span class="annottext">Bool
</span><span class="hs-identifier hs-var">otherwise</span></span><span>           </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">Text
</span><a href="#local-6989586621679963965"><span class="hs-identifier hs-var">fieldName</span></a></span><span> </span><span class="annot"><span class="annottext">forall m. Monoid m =&gt; m -&gt; m -&gt; m
</span><a href="Database.Persist.TH.html#%2B%2B"><span class="hs-operator hs-var">++</span></a></span><span> </span><span class="annot"><span class="annottext">Text
</span><span class="hs-string">&quot;Sum&quot;</span></span><span>
</span><span id="line-2993"></span><span>    </span><span id="local-6989586621679963964"><span class="annot"><span class="annottext">fieldNameHS :: FieldNameHS
</span><a href="#local-6989586621679963964"><span class="hs-identifier hs-var hs-var">fieldNameHS</span></a></span></span><span> </span><span class="hs-glyph">=</span><span>
</span><span id="line-2994"></span><span>        </span><span class="annot"><span class="annottext">UnboundFieldDef -&gt; FieldNameHS
</span><a href="Database.Persist.Quasi.Internal.html#unboundFieldNameHS"><span class="hs-identifier hs-var">unboundFieldNameHS</span></a></span><span> </span><span class="annot"><span class="annottext">UnboundFieldDef
</span><a href="#local-6989586621679963968"><span class="hs-identifier hs-var">unboundFieldDef</span></a></span><span>
</span><span id="line-2995"></span><span>    </span><span id="local-6989586621679963966"><span class="annot"><span class="annottext">modifiedName :: Text
</span><a href="#local-6989586621679963966"><span class="hs-identifier hs-var hs-var">modifiedName</span></a></span></span><span> </span><span class="hs-glyph">=</span><span>
</span><span id="line-2996"></span><span>        </span><span class="annot"><span class="annottext">MkPersistSettings -&gt; Text -&gt; Text -&gt; Text
</span><a href="Database.Persist.TH.html#mpsConstraintLabelModifier"><span class="hs-identifier hs-var">mpsConstraintLabelModifier</span></a></span><span> </span><span class="annot"><span class="annottext">MkPersistSettings
</span><a href="#local-6989586621679963970"><span class="hs-identifier hs-var">mps</span></a></span><span> </span><span class="annot"><span class="annottext">Text
</span><a href="#local-6989586621679963963"><span class="hs-identifier hs-var">entityName</span></a></span><span> </span><span class="annot"><span class="annottext">Text
</span><a href="#local-6989586621679963965"><span class="hs-identifier hs-var">fieldName</span></a></span><span>
</span><span id="line-2997"></span><span>    </span><span id="local-6989586621679963963"><span class="annot"><span class="annottext">entityName :: Text
</span><a href="#local-6989586621679963963"><span class="hs-identifier hs-var hs-var">entityName</span></a></span></span><span> </span><span class="hs-glyph">=</span><span>
</span><span id="line-2998"></span><span>        </span><span class="annot"><span class="annottext">EntityNameHS -&gt; Text
</span><a href="Database.Persist.Names.html#unEntityNameHS"><span class="hs-identifier hs-var">unEntityNameHS</span></a></span><span> </span><span class="annot"><span class="annottext">forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span> </span><span class="annot"><span class="annottext">UnboundEntityDef -&gt; EntityNameHS
</span><a href="Database.Persist.Quasi.Internal.html#getUnboundEntityNameHS"><span class="hs-identifier hs-var">getUnboundEntityNameHS</span></a></span><span> </span><span class="annot"><span class="annottext">UnboundEntityDef
</span><a href="#local-6989586621679963969"><span class="hs-identifier hs-var">entDef</span></a></span><span>
</span><span id="line-2999"></span><span>    </span><span id="local-6989586621679963965"><span class="annot"><span class="annottext">fieldName :: Text
</span><a href="#local-6989586621679963965"><span class="hs-identifier hs-var hs-var">fieldName</span></a></span></span><span> </span><span class="hs-glyph">=</span><span>
</span><span id="line-3000"></span><span>        </span><span class="annot"><span class="annottext">Text -&gt; Text
</span><a href="Database.Persist.TH.html#upperFirst"><span class="hs-identifier hs-var">upperFirst</span></a></span><span> </span><span class="annot"><span class="annottext">forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span> </span><span class="annot"><span class="annottext">FieldNameHS -&gt; Text
</span><a href="Database.Persist.Names.html#unFieldNameHS"><span class="hs-identifier hs-var">unFieldNameHS</span></a></span><span> </span><span class="annot"><span class="annottext">FieldNameHS
</span><a href="#local-6989586621679963964"><span class="hs-identifier hs-var">fieldNameHS</span></a></span><span>
</span><span id="line-3001"></span><span>
</span><span id="line-3002"></span><span class="hs-comment">-- | Turn a ConstraintName into a TH Name</span><span>
</span><span id="line-3003"></span><span class="annot"><a href="Database.Persist.TH.html#mkConstraintName"><span class="hs-identifier hs-type">mkConstraintName</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><a href="Database.Persist.Names.html#ConstraintNameHS"><span class="hs-identifier hs-type">ConstraintNameHS</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="hs-identifier hs-type">Name</span></span><span>
</span><span id="line-3004"></span><span id="mkConstraintName"><span class="annot"><span class="annottext">mkConstraintName :: ConstraintNameHS -&gt; Name
</span><a href="Database.Persist.TH.html#mkConstraintName"><span class="hs-identifier hs-var hs-var">mkConstraintName</span></a></span></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="Database.Persist.Names.html#ConstraintNameHS"><span class="hs-identifier hs-type">ConstraintNameHS</span></a></span><span> </span><span id="local-6989586621679963961"><span class="annot"><span class="annottext">Text
</span><a href="#local-6989586621679963961"><span class="hs-identifier hs-var">name</span></a></span></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">=</span><span>
</span><span id="line-3005"></span><span>    </span><span class="annot"><span class="annottext">String -&gt; Name
</span><span class="hs-identifier hs-var">mkName</span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Text -&gt; String
</span><span class="hs-identifier hs-var">T.unpack</span></span><span> </span><span class="annot"><span class="annottext">Text
</span><a href="#local-6989586621679963961"><span class="hs-identifier hs-var">name</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-3006"></span><span>
</span><span id="line-3007"></span><span class="annot"><a href="Database.Persist.TH.html#keyIdName"><span class="hs-identifier hs-type">keyIdName</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><a href="Database.Persist.Quasi.Internal.html#UnboundEntityDef"><span class="hs-identifier hs-type">UnboundEntityDef</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="hs-identifier hs-type">Name</span></span><span>
</span><span id="line-3008"></span><span id="keyIdName"><span class="annot"><span class="annottext">keyIdName :: UnboundEntityDef -&gt; Name
</span><a href="Database.Persist.TH.html#keyIdName"><span class="hs-identifier hs-var hs-var">keyIdName</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">String -&gt; Name
</span><span class="hs-identifier hs-var">mkName</span></span><span> </span><span class="annot"><span class="annottext">forall b c a. (b -&gt; c) -&gt; (a -&gt; b) -&gt; a -&gt; c
</span><span class="hs-operator hs-var">.</span></span><span> </span><span class="annot"><span class="annottext">Text -&gt; String
</span><span class="hs-identifier hs-var">T.unpack</span></span><span> </span><span class="annot"><span class="annottext">forall b c a. (b -&gt; c) -&gt; (a -&gt; b) -&gt; a -&gt; c
</span><span class="hs-operator hs-var">.</span></span><span> </span><span class="annot"><span class="annottext">UnboundEntityDef -&gt; Text
</span><a href="Database.Persist.TH.html#keyIdText"><span class="hs-identifier hs-var">keyIdText</span></a></span><span>
</span><span id="line-3009"></span><span>
</span><span id="line-3010"></span><span class="annot"><a href="Database.Persist.TH.html#keyIdText"><span class="hs-identifier hs-type">keyIdText</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><a href="Database.Persist.Quasi.Internal.html#UnboundEntityDef"><span class="hs-identifier hs-type">UnboundEntityDef</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="hs-identifier hs-type">Text</span></span><span>
</span><span id="line-3011"></span><span id="keyIdText"><span class="annot"><span class="annottext">keyIdText :: UnboundEntityDef -&gt; Text
</span><a href="Database.Persist.TH.html#keyIdText"><span class="hs-identifier hs-var hs-var">keyIdText</span></a></span></span><span> </span><span id="local-6989586621679963959"><span class="annot"><span class="annottext">UnboundEntityDef
</span><a href="#local-6989586621679963959"><span class="hs-identifier hs-var">entDef</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">EntityNameHS -&gt; Text
</span><a href="Database.Persist.Names.html#unEntityNameHS"><span class="hs-identifier hs-var">unEntityNameHS</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">UnboundEntityDef -&gt; EntityNameHS
</span><a href="Database.Persist.Quasi.Internal.html#getUnboundEntityNameHS"><span class="hs-identifier hs-var">getUnboundEntityNameHS</span></a></span><span> </span><span class="annot"><span class="annottext">UnboundEntityDef
</span><a href="#local-6989586621679963959"><span class="hs-identifier hs-var">entDef</span></a></span><span class="hs-special">)</span><span> </span><span class="annot"><span class="annottext">forall m. Monoid m =&gt; m -&gt; m -&gt; m
</span><span class="hs-operator hs-var">`mappend`</span></span><span> </span><span class="annot"><span class="annottext">Text
</span><span class="hs-string">&quot;Id&quot;</span></span><span>
</span><span id="line-3012"></span><span>
</span><span id="line-3013"></span><span class="annot"><a href="Database.Persist.TH.html#unKeyName"><span class="hs-identifier hs-type">unKeyName</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><a href="Database.Persist.Quasi.Internal.html#UnboundEntityDef"><span class="hs-identifier hs-type">UnboundEntityDef</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="hs-identifier hs-type">Name</span></span><span>
</span><span id="line-3014"></span><span id="unKeyName"><span class="annot"><span class="annottext">unKeyName :: UnboundEntityDef -&gt; Name
</span><a href="Database.Persist.TH.html#unKeyName"><span class="hs-identifier hs-var hs-var">unKeyName</span></a></span></span><span> </span><span id="local-6989586621679963958"><span class="annot"><span class="annottext">UnboundEntityDef
</span><a href="#local-6989586621679963958"><span class="hs-identifier hs-var">entDef</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">String -&gt; Name
</span><span class="hs-identifier hs-var">mkName</span></span><span> </span><span class="annot"><span class="annottext">forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span> </span><span class="annot"><span class="annottext">Text -&gt; String
</span><span class="hs-identifier hs-var">T.unpack</span></span><span> </span><span class="annot"><span class="annottext">forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span> </span><span class="annot"><span class="annottext">Text
</span><span class="hs-string">&quot;un&quot;</span></span><span> </span><span class="annot"><span class="annottext">forall m. Monoid m =&gt; m -&gt; m -&gt; m
</span><span class="hs-operator hs-var">`mappend`</span></span><span> </span><span class="annot"><span class="annottext">UnboundEntityDef -&gt; Text
</span><a href="Database.Persist.TH.html#keyText"><span class="hs-identifier hs-var">keyText</span></a></span><span> </span><span class="annot"><span class="annottext">UnboundEntityDef
</span><a href="#local-6989586621679963958"><span class="hs-identifier hs-var">entDef</span></a></span><span>
</span><span id="line-3015"></span><span>
</span><span id="line-3016"></span><span class="annot"><a href="Database.Persist.TH.html#unKeyExp"><span class="hs-identifier hs-type">unKeyExp</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><a href="Database.Persist.Quasi.Internal.html#UnboundEntityDef"><span class="hs-identifier hs-type">UnboundEntityDef</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="hs-identifier hs-type">Exp</span></span><span>
</span><span id="line-3017"></span><span id="unKeyExp"><span class="annot"><span class="annottext">unKeyExp :: UnboundEntityDef -&gt; Exp
</span><a href="Database.Persist.TH.html#unKeyExp"><span class="hs-identifier hs-var hs-var">unKeyExp</span></a></span></span><span> </span><span id="local-6989586621679963956"><span class="annot"><span class="annottext">UnboundEntityDef
</span><a href="#local-6989586621679963956"><span class="hs-identifier hs-var">ent</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">Name -&gt; Name -&gt; Exp
</span><a href="Database.Persist.TH.html#fieldSel"><span class="hs-identifier hs-var">fieldSel</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">UnboundEntityDef -&gt; Name
</span><a href="Database.Persist.TH.html#keyConName"><span class="hs-identifier hs-var">keyConName</span></a></span><span> </span><span class="annot"><span class="annottext">UnboundEntityDef
</span><a href="#local-6989586621679963956"><span class="hs-identifier hs-var">ent</span></a></span><span class="hs-special">)</span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">UnboundEntityDef -&gt; Name
</span><a href="Database.Persist.TH.html#unKeyName"><span class="hs-identifier hs-var">unKeyName</span></a></span><span> </span><span class="annot"><span class="annottext">UnboundEntityDef
</span><a href="#local-6989586621679963956"><span class="hs-identifier hs-var">ent</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-3018"></span><span>
</span><span id="line-3019"></span><span class="annot"><a href="Database.Persist.TH.html#backendT"><span class="hs-identifier hs-type">backendT</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><span class="hs-identifier hs-type">Type</span></span><span>
</span><span id="line-3020"></span><span id="backendT"><span class="annot"><span class="annottext">backendT :: Type
</span><a href="Database.Persist.TH.html#backendT"><span class="hs-identifier hs-var hs-var">backendT</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">Name -&gt; Type
</span><span class="hs-identifier hs-var">VarT</span></span><span> </span><span class="annot"><span class="annottext">Name
</span><a href="Database.Persist.TH.html#backendName"><span class="hs-identifier hs-var">backendName</span></a></span><span>
</span><span id="line-3021"></span><span>
</span><span id="line-3022"></span><span class="annot"><a href="Database.Persist.TH.html#backendName"><span class="hs-identifier hs-type">backendName</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><span class="hs-identifier hs-type">Name</span></span><span>
</span><span id="line-3023"></span><span id="backendName"><span class="annot"><span class="annottext">backendName :: Name
</span><a href="Database.Persist.TH.html#backendName"><span class="hs-identifier hs-var hs-var">backendName</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">String -&gt; Name
</span><span class="hs-identifier hs-var">mkName</span></span><span> </span><span class="annot"><span class="annottext">String
</span><span class="hs-string">&quot;backend&quot;</span></span><span>
</span><span id="line-3024"></span><span>
</span><span id="line-3025"></span><span class="hs-comment">-- needs:</span><span>
</span><span id="line-3026"></span><span class="hs-comment">--</span><span>
</span><span id="line-3027"></span><span class="hs-comment">-- * keyText</span><span>
</span><span id="line-3028"></span><span class="hs-comment">--     * entityNameHaskell</span><span>
</span><span id="line-3029"></span><span class="hs-comment">--  * fields</span><span>
</span><span id="line-3030"></span><span class="hs-comment">--      * fieldHaskell</span><span>
</span><span id="line-3031"></span><span class="hs-comment">--</span><span>
</span><span id="line-3032"></span><span class="hs-comment">-- keyConName :: EntityNameHS -&gt; [FieldHaskell] -&gt; Name</span><span>
</span><span id="line-3033"></span><span class="annot"><a href="Database.Persist.TH.html#keyConName"><span class="hs-identifier hs-type">keyConName</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><a href="Database.Persist.Quasi.Internal.html#UnboundEntityDef"><span class="hs-identifier hs-type">UnboundEntityDef</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="hs-identifier hs-type">Name</span></span><span>
</span><span id="line-3034"></span><span id="keyConName"><span class="annot"><span class="annottext">keyConName :: UnboundEntityDef -&gt; Name
</span><a href="Database.Persist.TH.html#keyConName"><span class="hs-identifier hs-var hs-var">keyConName</span></a></span></span><span> </span><span id="local-6989586621679963955"><span class="annot"><span class="annottext">UnboundEntityDef
</span><a href="#local-6989586621679963955"><span class="hs-identifier hs-var">entDef</span></a></span></span><span> </span><span class="hs-glyph">=</span><span>
</span><span id="line-3035"></span><span>    </span><span class="annot"><span class="annottext">EntityNameHS -&gt; [FieldNameHS] -&gt; Name
</span><a href="Database.Persist.TH.html#keyConName%27"><span class="hs-identifier hs-var">keyConName'</span></a></span><span>
</span><span id="line-3036"></span><span>        </span><span class="hs-special">(</span><span class="annot"><span class="annottext">UnboundEntityDef -&gt; EntityNameHS
</span><a href="Database.Persist.Quasi.Internal.html#getUnboundEntityNameHS"><span class="hs-identifier hs-var">getUnboundEntityNameHS</span></a></span><span> </span><span class="annot"><span class="annottext">UnboundEntityDef
</span><a href="#local-6989586621679963955"><span class="hs-identifier hs-var">entDef</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-3037"></span><span>        </span><span class="hs-special">(</span><span class="annot"><span class="annottext">UnboundFieldDef -&gt; FieldNameHS
</span><a href="Database.Persist.Quasi.Internal.html#unboundFieldNameHS"><span class="hs-identifier hs-var">unboundFieldNameHS</span></a></span><span> </span><span class="annot"><span class="annottext">forall (f :: * -&gt; *) a b. Functor f =&gt; (a -&gt; b) -&gt; f a -&gt; f b
</span><span class="hs-operator hs-var">&lt;$&gt;</span></span><span> </span><span class="annot"><span class="annottext">UnboundEntityDef -&gt; [UnboundFieldDef]
</span><a href="Database.Persist.Quasi.Internal.html#unboundEntityFields"><span class="hs-identifier hs-var">unboundEntityFields</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">UnboundEntityDef
</span><a href="#local-6989586621679963955"><span class="hs-identifier hs-var">entDef</span></a></span><span class="hs-special">)</span><span class="hs-special">)</span><span>
</span><span id="line-3038"></span><span>
</span><span id="line-3039"></span><span>
</span><span id="line-3040"></span><span class="annot"><a href="Database.Persist.TH.html#keyConName%27"><span class="hs-identifier hs-type">keyConName'</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><a href="Database.Persist.Names.html#EntityNameHS"><span class="hs-identifier hs-type">EntityNameHS</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-special">[</span><span class="annot"><a href="Database.Persist.Names.html#FieldNameHS"><span class="hs-identifier hs-type">FieldNameHS</span></a></span><span class="hs-special">]</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="hs-identifier hs-type">Name</span></span><span>
</span><span id="line-3041"></span><span id="keyConName%27"><span class="annot"><span class="annottext">keyConName' :: EntityNameHS -&gt; [FieldNameHS] -&gt; Name
</span><a href="Database.Persist.TH.html#keyConName%27"><span class="hs-identifier hs-var hs-var">keyConName'</span></a></span></span><span> </span><span id="local-6989586621679963953"><span class="annot"><span class="annottext">EntityNameHS
</span><a href="#local-6989586621679963953"><span class="hs-identifier hs-var">entName</span></a></span></span><span> </span><span id="local-6989586621679963952"><span class="annot"><span class="annottext">[FieldNameHS]
</span><a href="#local-6989586621679963952"><span class="hs-identifier hs-var">entFields</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">String -&gt; Name
</span><span class="hs-identifier hs-var">mkName</span></span><span> </span><span class="annot"><span class="annottext">forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span> </span><span class="annot"><span class="annottext">Text -&gt; String
</span><span class="hs-identifier hs-var">T.unpack</span></span><span> </span><span class="annot"><span class="annottext">forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span> </span><span class="annot"><span class="annottext">Text -&gt; Text
</span><a href="#local-6989586621679963951"><span class="hs-identifier hs-var">resolveConflict</span></a></span><span> </span><span class="annot"><span class="annottext">forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span> </span><span class="annot"><span class="annottext">EntityNameHS -&gt; Text
</span><a href="Database.Persist.TH.html#keyText%27"><span class="hs-identifier hs-var">keyText'</span></a></span><span> </span><span class="annot"><span class="annottext">EntityNameHS
</span><a href="#local-6989586621679963953"><span class="hs-identifier hs-var">entName</span></a></span><span>
</span><span id="line-3042"></span><span>  </span><span class="hs-keyword">where</span><span>
</span><span id="line-3043"></span><span>    </span><span id="local-6989586621679963951"><span class="annot"><span class="annottext">resolveConflict :: Text -&gt; Text
</span><a href="#local-6989586621679963951"><span class="hs-identifier hs-var hs-var">resolveConflict</span></a></span></span><span> </span><span id="local-6989586621679963949"><span class="annot"><span class="annottext">Text
</span><a href="#local-6989586621679963949"><span class="hs-identifier hs-var">kn</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-keyword">if</span><span> </span><span class="annot"><span class="annottext">Bool
</span><a href="#local-6989586621679963948"><span class="hs-identifier hs-var">conflict</span></a></span><span> </span><span class="hs-keyword">then</span><span> </span><span class="annot"><span class="annottext">Text
</span><a href="#local-6989586621679963949"><span class="hs-identifier hs-var">kn</span></a></span><span> </span><span class="annot"><span class="annottext">forall m. Monoid m =&gt; m -&gt; m -&gt; m
</span><span class="hs-operator hs-var">`mappend`</span></span><span> </span><span class="annot"><span class="annottext">Text
</span><span class="hs-string">&quot;'&quot;</span></span><span> </span><span class="hs-keyword">else</span><span> </span><span class="annot"><span class="annottext">Text
</span><a href="#local-6989586621679963949"><span class="hs-identifier hs-var">kn</span></a></span><span>
</span><span id="line-3044"></span><span>    </span><span id="local-6989586621679963948"><span class="annot"><span class="annottext">conflict :: Bool
</span><a href="#local-6989586621679963948"><span class="hs-identifier hs-var hs-var">conflict</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">forall (t :: * -&gt; *) a. Foldable t =&gt; (a -&gt; Bool) -&gt; t a -&gt; Bool
</span><span class="hs-identifier hs-var">any</span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">forall a. Eq a =&gt; a -&gt; a -&gt; Bool
</span><span class="hs-operator hs-var">==</span></span><span> </span><span class="annot"><span class="annottext">Text -&gt; FieldNameHS
</span><a href="Database.Persist.Names.html#FieldNameHS"><span class="hs-identifier hs-var">FieldNameHS</span></a></span><span> </span><span class="annot"><span class="annottext">Text
</span><span class="hs-string">&quot;key&quot;</span></span><span class="hs-special">)</span><span> </span><span class="annot"><span class="annottext">[FieldNameHS]
</span><a href="#local-6989586621679963952"><span class="hs-identifier hs-var">entFields</span></a></span><span>
</span><span id="line-3045"></span><span>
</span><span id="line-3046"></span><span class="hs-comment">-- keyConExp :: EntityNameHS -&gt; [FieldNameHS] -&gt; Exp</span><span>
</span><span id="line-3047"></span><span class="annot"><a href="Database.Persist.TH.html#keyConExp"><span class="hs-identifier hs-type">keyConExp</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><a href="Database.Persist.Quasi.Internal.html#UnboundEntityDef"><span class="hs-identifier hs-type">UnboundEntityDef</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="hs-identifier hs-type">Exp</span></span><span>
</span><span id="line-3048"></span><span id="keyConExp"><span class="annot"><span class="annottext">keyConExp :: UnboundEntityDef -&gt; Exp
</span><a href="Database.Persist.TH.html#keyConExp"><span class="hs-identifier hs-var hs-var">keyConExp</span></a></span></span><span> </span><span id="local-6989586621679963946"><span class="annot"><span class="annottext">UnboundEntityDef
</span><a href="#local-6989586621679963946"><span class="hs-identifier hs-var">ed</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">Name -&gt; Exp
</span><span class="hs-identifier hs-var">ConE</span></span><span> </span><span class="annot"><span class="annottext">forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span> </span><span class="annot"><span class="annottext">UnboundEntityDef -&gt; Name
</span><a href="Database.Persist.TH.html#keyConName"><span class="hs-identifier hs-var">keyConName</span></a></span><span> </span><span class="annot"><span class="annottext">UnboundEntityDef
</span><a href="#local-6989586621679963946"><span class="hs-identifier hs-var">ed</span></a></span><span>
</span><span id="line-3049"></span><span>
</span><span id="line-3050"></span><span class="annot"><a href="Database.Persist.TH.html#keyText"><span class="hs-identifier hs-type">keyText</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><a href="Database.Persist.Quasi.Internal.html#UnboundEntityDef"><span class="hs-identifier hs-type">UnboundEntityDef</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="hs-identifier hs-type">Text</span></span><span>
</span><span id="line-3051"></span><span id="keyText"><span class="annot"><span class="annottext">keyText :: UnboundEntityDef -&gt; Text
</span><a href="Database.Persist.TH.html#keyText"><span class="hs-identifier hs-var hs-var">keyText</span></a></span></span><span> </span><span id="local-6989586621679963945"><span class="annot"><span class="annottext">UnboundEntityDef
</span><a href="#local-6989586621679963945"><span class="hs-identifier hs-var">entDef</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">EntityNameHS -&gt; Text
</span><a href="Database.Persist.Names.html#unEntityNameHS"><span class="hs-identifier hs-var">unEntityNameHS</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">UnboundEntityDef -&gt; EntityNameHS
</span><a href="Database.Persist.Quasi.Internal.html#getUnboundEntityNameHS"><span class="hs-identifier hs-var">getUnboundEntityNameHS</span></a></span><span> </span><span class="annot"><span class="annottext">UnboundEntityDef
</span><a href="#local-6989586621679963945"><span class="hs-identifier hs-var">entDef</span></a></span><span class="hs-special">)</span><span> </span><span class="annot"><span class="annottext">forall m. Monoid m =&gt; m -&gt; m -&gt; m
</span><a href="Database.Persist.TH.html#%2B%2B"><span class="hs-operator hs-var">++</span></a></span><span> </span><span class="annot"><span class="annottext">Text
</span><span class="hs-string">&quot;Key&quot;</span></span><span>
</span><span id="line-3052"></span><span>
</span><span id="line-3053"></span><span class="annot"><a href="Database.Persist.TH.html#keyText%27"><span class="hs-identifier hs-type">keyText'</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><a href="Database.Persist.Names.html#EntityNameHS"><span class="hs-identifier hs-type">EntityNameHS</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="hs-identifier hs-type">Text</span></span><span>
</span><span id="line-3054"></span><span id="keyText%27"><span class="annot"><span class="annottext">keyText' :: EntityNameHS -&gt; Text
</span><a href="Database.Persist.TH.html#keyText%27"><span class="hs-identifier hs-var hs-var">keyText'</span></a></span></span><span> </span><span id="local-6989586621679963944"><span class="annot"><span class="annottext">EntityNameHS
</span><a href="#local-6989586621679963944"><span class="hs-identifier hs-var">entName</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">EntityNameHS -&gt; Text
</span><a href="Database.Persist.Names.html#unEntityNameHS"><span class="hs-identifier hs-var">unEntityNameHS</span></a></span><span> </span><span class="annot"><span class="annottext">EntityNameHS
</span><a href="#local-6989586621679963944"><span class="hs-identifier hs-var">entName</span></a></span><span> </span><span class="annot"><span class="annottext">forall m. Monoid m =&gt; m -&gt; m -&gt; m
</span><a href="Database.Persist.TH.html#%2B%2B"><span class="hs-operator hs-var">++</span></a></span><span> </span><span class="annot"><span class="annottext">Text
</span><span class="hs-string">&quot;Key&quot;</span></span><span>
</span><span id="line-3055"></span><span>
</span><span id="line-3056"></span><span class="annot"><a href="Database.Persist.TH.html#keyFieldName"><span class="hs-identifier hs-type">keyFieldName</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><a href="Database.Persist.TH.html#MkPersistSettings"><span class="hs-identifier hs-type">MkPersistSettings</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="Database.Persist.Quasi.Internal.html#UnboundEntityDef"><span class="hs-identifier hs-type">UnboundEntityDef</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="Database.Persist.Names.html#FieldNameHS"><span class="hs-identifier hs-type">FieldNameHS</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="hs-identifier hs-type">Name</span></span><span>
</span><span id="line-3057"></span><span id="keyFieldName"><span class="annot"><span class="annottext">keyFieldName :: MkPersistSettings -&gt; UnboundEntityDef -&gt; FieldNameHS -&gt; Name
</span><a href="Database.Persist.TH.html#keyFieldName"><span class="hs-identifier hs-var hs-var">keyFieldName</span></a></span></span><span> </span><span id="local-6989586621679963943"><span class="annot"><span class="annottext">MkPersistSettings
</span><a href="#local-6989586621679963943"><span class="hs-identifier hs-var">mps</span></a></span></span><span> </span><span id="local-6989586621679963942"><span class="annot"><span class="annottext">UnboundEntityDef
</span><a href="#local-6989586621679963942"><span class="hs-identifier hs-var">entDef</span></a></span></span><span> </span><span id="local-6989586621679963941"><span class="annot"><span class="annottext">FieldNameHS
</span><a href="#local-6989586621679963941"><span class="hs-identifier hs-var">fieldDef</span></a></span></span><span>
</span><span id="line-3058"></span><span>    </span><span class="hs-glyph">|</span><span> </span><span class="annot"><span class="annottext">MkPersistSettings -&gt; UnboundEntityDef -&gt; Bool
</span><a href="Database.Persist.TH.html#pkNewtype"><span class="hs-identifier hs-var">pkNewtype</span></a></span><span> </span><span class="annot"><span class="annottext">MkPersistSettings
</span><a href="#local-6989586621679963943"><span class="hs-identifier hs-var">mps</span></a></span><span> </span><span class="annot"><span class="annottext">UnboundEntityDef
</span><a href="#local-6989586621679963942"><span class="hs-identifier hs-var">entDef</span></a></span><span> </span><span class="hs-glyph">=</span><span>
</span><span id="line-3059"></span><span>        </span><span class="annot"><span class="annottext">UnboundEntityDef -&gt; Name
</span><a href="Database.Persist.TH.html#unKeyName"><span class="hs-identifier hs-var">unKeyName</span></a></span><span> </span><span class="annot"><span class="annottext">UnboundEntityDef
</span><a href="#local-6989586621679963942"><span class="hs-identifier hs-var">entDef</span></a></span><span>
</span><span id="line-3060"></span><span>    </span><span class="hs-glyph">|</span><span> </span><span class="annot"><span class="annottext">Bool
</span><span class="hs-identifier hs-var">otherwise</span></span><span> </span><span class="hs-glyph">=</span><span>
</span><span id="line-3061"></span><span>        </span><span class="annot"><span class="annottext">String -&gt; Name
</span><span class="hs-identifier hs-var">mkName</span></span><span> </span><span class="annot"><span class="annottext">forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span> </span><span class="annot"><span class="annottext">Text -&gt; String
</span><span class="hs-identifier hs-var">T.unpack</span></span><span> </span><span class="annot"><span class="annottext">forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span> </span><span class="annot"><span class="annottext">Text -&gt; Text
</span><a href="Database.Persist.TH.html#lowerFirst"><span class="hs-identifier hs-var">lowerFirst</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">UnboundEntityDef -&gt; Text
</span><a href="Database.Persist.TH.html#keyText"><span class="hs-identifier hs-var">keyText</span></a></span><span> </span><span class="annot"><span class="annottext">UnboundEntityDef
</span><a href="#local-6989586621679963942"><span class="hs-identifier hs-var">entDef</span></a></span><span class="hs-special">)</span><span> </span><span class="annot"><span class="annottext">forall m. Monoid m =&gt; m -&gt; m -&gt; m
</span><span class="hs-operator hs-var">`mappend`</span></span><span> </span><span class="annot"><span class="annottext">FieldNameHS -&gt; Text
</span><a href="Database.Persist.Names.html#unFieldNameHS"><span class="hs-identifier hs-var">unFieldNameHS</span></a></span><span> </span><span class="annot"><span class="annottext">FieldNameHS
</span><a href="#local-6989586621679963941"><span class="hs-identifier hs-var">fieldDef</span></a></span><span>
</span><span id="line-3062"></span><span>
</span><span id="line-3063"></span><span class="annot"><a href="Database.Persist.TH.html#filterConName"><span class="hs-identifier hs-type">filterConName</span></a></span><span>
</span><span id="line-3064"></span><span>    </span><span class="hs-glyph">::</span><span> </span><span class="annot"><a href="Database.Persist.TH.html#MkPersistSettings"><span class="hs-identifier hs-type">MkPersistSettings</span></a></span><span>
</span><span id="line-3065"></span><span>    </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="Database.Persist.Quasi.Internal.html#UnboundEntityDef"><span class="hs-identifier hs-type">UnboundEntityDef</span></a></span><span>
</span><span id="line-3066"></span><span>    </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="Database.Persist.Quasi.Internal.html#UnboundFieldDef"><span class="hs-identifier hs-type">UnboundFieldDef</span></a></span><span>
</span><span id="line-3067"></span><span>    </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="hs-identifier hs-type">Name</span></span><span>
</span><span id="line-3068"></span><span id="filterConName"><span class="annot"><span class="annottext">filterConName :: MkPersistSettings -&gt; UnboundEntityDef -&gt; UnboundFieldDef -&gt; Name
</span><a href="Database.Persist.TH.html#filterConName"><span class="hs-identifier hs-var hs-var">filterConName</span></a></span></span><span> </span><span id="local-6989586621679963940"><span class="annot"><span class="annottext">MkPersistSettings
</span><a href="#local-6989586621679963940"><span class="hs-identifier hs-var">mps</span></a></span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">UnboundEntityDef -&gt; EntityDef
</span><a href="Database.Persist.Quasi.Internal.html#unboundEntityDef"><span class="hs-identifier hs-var">unboundEntityDef</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span id="local-6989586621679963939"><span class="annot"><span class="annottext">EntityDef
</span><a href="#local-6989586621679963939"><span class="hs-identifier hs-var">entity</span></a></span></span><span class="hs-special">)</span><span> </span><span id="local-6989586621679963938"><span class="annot"><span class="annottext">UnboundFieldDef
</span><a href="#local-6989586621679963938"><span class="hs-identifier hs-var">field</span></a></span></span><span> </span><span class="hs-glyph">=</span><span>
</span><span id="line-3069"></span><span>    </span><span class="annot"><span class="annottext">MkPersistSettings -&gt; EntityNameHS -&gt; FieldNameHS -&gt; Name
</span><a href="Database.Persist.TH.html#filterConName%27"><span class="hs-identifier hs-var">filterConName'</span></a></span><span> </span><span class="annot"><span class="annottext">MkPersistSettings
</span><a href="#local-6989586621679963940"><span class="hs-identifier hs-var">mps</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">EntityDef -&gt; EntityNameHS
</span><a href="Database.Persist.Types.Base.html#entityHaskell"><span class="hs-identifier hs-var">entityHaskell</span></a></span><span> </span><span class="annot"><span class="annottext">EntityDef
</span><a href="#local-6989586621679963939"><span class="hs-identifier hs-var">entity</span></a></span><span class="hs-special">)</span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">UnboundFieldDef -&gt; FieldNameHS
</span><a href="Database.Persist.Quasi.Internal.html#unboundFieldNameHS"><span class="hs-identifier hs-var">unboundFieldNameHS</span></a></span><span> </span><span class="annot"><span class="annottext">UnboundFieldDef
</span><a href="#local-6989586621679963938"><span class="hs-identifier hs-var">field</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-3070"></span><span>
</span><span id="line-3071"></span><span class="annot"><a href="Database.Persist.TH.html#filterConName%27"><span class="hs-identifier hs-type">filterConName'</span></a></span><span>
</span><span id="line-3072"></span><span>    </span><span class="hs-glyph">::</span><span> </span><span class="annot"><a href="Database.Persist.TH.html#MkPersistSettings"><span class="hs-identifier hs-type">MkPersistSettings</span></a></span><span>
</span><span id="line-3073"></span><span>    </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="Database.Persist.Names.html#EntityNameHS"><span class="hs-identifier hs-type">EntityNameHS</span></a></span><span>
</span><span id="line-3074"></span><span>    </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="Database.Persist.Names.html#FieldNameHS"><span class="hs-identifier hs-type">FieldNameHS</span></a></span><span>
</span><span id="line-3075"></span><span>    </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="hs-identifier hs-type">Name</span></span><span>
</span><span id="line-3076"></span><span id="filterConName%27"><span class="annot"><span class="annottext">filterConName' :: MkPersistSettings -&gt; EntityNameHS -&gt; FieldNameHS -&gt; Name
</span><a href="Database.Persist.TH.html#filterConName%27"><span class="hs-identifier hs-var hs-var">filterConName'</span></a></span></span><span> </span><span id="local-6989586621679963937"><span class="annot"><span class="annottext">MkPersistSettings
</span><a href="#local-6989586621679963937"><span class="hs-identifier hs-var">mps</span></a></span></span><span> </span><span id="local-6989586621679963936"><span class="annot"><span class="annottext">EntityNameHS
</span><a href="#local-6989586621679963936"><span class="hs-identifier hs-var">entity</span></a></span></span><span> </span><span id="local-6989586621679963935"><span class="annot"><span class="annottext">FieldNameHS
</span><a href="#local-6989586621679963935"><span class="hs-identifier hs-var">field</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">String -&gt; Name
</span><span class="hs-identifier hs-var">mkName</span></span><span> </span><span class="annot"><span class="annottext">forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span> </span><span class="annot"><span class="annottext">Text -&gt; String
</span><span class="hs-identifier hs-var">T.unpack</span></span><span> </span><span class="annot"><span class="annottext">Text
</span><a href="#local-6989586621679963934"><span class="hs-identifier hs-var">name</span></a></span><span>
</span><span id="line-3077"></span><span>    </span><span class="hs-keyword">where</span><span>
</span><span id="line-3078"></span><span>        </span><span id="local-6989586621679963934"><span class="annot"><span class="annottext">name :: Text
</span><a href="#local-6989586621679963934"><span class="hs-identifier hs-var hs-var">name</span></a></span></span><span>
</span><span id="line-3079"></span><span>            </span><span class="hs-glyph">|</span><span> </span><span class="annot"><span class="annottext">FieldNameHS
</span><a href="#local-6989586621679963935"><span class="hs-identifier hs-var">field</span></a></span><span> </span><span class="annot"><span class="annottext">forall a. Eq a =&gt; a -&gt; a -&gt; Bool
</span><span class="hs-operator hs-var">==</span></span><span> </span><span class="annot"><span class="annottext">Text -&gt; FieldNameHS
</span><a href="Database.Persist.Names.html#FieldNameHS"><span class="hs-identifier hs-var">FieldNameHS</span></a></span><span> </span><span class="annot"><span class="annottext">Text
</span><span class="hs-string">&quot;Id&quot;</span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">Text
</span><a href="#local-6989586621679963933"><span class="hs-identifier hs-var">entityName</span></a></span><span> </span><span class="annot"><span class="annottext">forall m. Monoid m =&gt; m -&gt; m -&gt; m
</span><a href="Database.Persist.TH.html#%2B%2B"><span class="hs-operator hs-var">++</span></a></span><span> </span><span class="annot"><span class="annottext">Text
</span><a href="#local-6989586621679963932"><span class="hs-identifier hs-var">fieldName</span></a></span><span>
</span><span id="line-3080"></span><span>            </span><span class="hs-glyph">|</span><span> </span><span class="annot"><span class="annottext">MkPersistSettings -&gt; Bool
</span><a href="Database.Persist.TH.html#mpsPrefixFields"><span class="hs-identifier hs-var">mpsPrefixFields</span></a></span><span> </span><span class="annot"><span class="annottext">MkPersistSettings
</span><a href="#local-6989586621679963937"><span class="hs-identifier hs-var">mps</span></a></span><span>       </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">Text
</span><a href="#local-6989586621679963931"><span class="hs-identifier hs-var">modifiedName</span></a></span><span>
</span><span id="line-3081"></span><span>            </span><span class="hs-glyph">|</span><span> </span><span class="annot"><span class="annottext">Bool
</span><span class="hs-identifier hs-var">otherwise</span></span><span>                 </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">Text
</span><a href="#local-6989586621679963932"><span class="hs-identifier hs-var">fieldName</span></a></span><span>
</span><span id="line-3082"></span><span>
</span><span id="line-3083"></span><span>        </span><span id="local-6989586621679963931"><span class="annot"><span class="annottext">modifiedName :: Text
</span><a href="#local-6989586621679963931"><span class="hs-identifier hs-var hs-var">modifiedName</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">MkPersistSettings -&gt; Text -&gt; Text -&gt; Text
</span><a href="Database.Persist.TH.html#mpsConstraintLabelModifier"><span class="hs-identifier hs-var">mpsConstraintLabelModifier</span></a></span><span> </span><span class="annot"><span class="annottext">MkPersistSettings
</span><a href="#local-6989586621679963937"><span class="hs-identifier hs-var">mps</span></a></span><span> </span><span class="annot"><span class="annottext">Text
</span><a href="#local-6989586621679963933"><span class="hs-identifier hs-var">entityName</span></a></span><span> </span><span class="annot"><span class="annottext">Text
</span><a href="#local-6989586621679963932"><span class="hs-identifier hs-var">fieldName</span></a></span><span>
</span><span id="line-3084"></span><span>        </span><span id="local-6989586621679963933"><span class="annot"><span class="annottext">entityName :: Text
</span><a href="#local-6989586621679963933"><span class="hs-identifier hs-var hs-var">entityName</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">EntityNameHS -&gt; Text
</span><a href="Database.Persist.Names.html#unEntityNameHS"><span class="hs-identifier hs-var">unEntityNameHS</span></a></span><span> </span><span class="annot"><span class="annottext">EntityNameHS
</span><a href="#local-6989586621679963936"><span class="hs-identifier hs-var">entity</span></a></span><span>
</span><span id="line-3085"></span><span>        </span><span id="local-6989586621679963932"><span class="annot"><span class="annottext">fieldName :: Text
</span><a href="#local-6989586621679963932"><span class="hs-identifier hs-var hs-var">fieldName</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">Text -&gt; Text
</span><a href="Database.Persist.TH.html#upperFirst"><span class="hs-identifier hs-var">upperFirst</span></a></span><span> </span><span class="annot"><span class="annottext">forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span> </span><span class="annot"><span class="annottext">FieldNameHS -&gt; Text
</span><a href="Database.Persist.Names.html#unFieldNameHS"><span class="hs-identifier hs-var">unFieldNameHS</span></a></span><span> </span><span class="annot"><span class="annottext">FieldNameHS
</span><a href="#local-6989586621679963935"><span class="hs-identifier hs-var">field</span></a></span><span>
</span><span id="line-3086"></span><span>
</span><span id="line-3087"></span><span class="hs-comment">-- | Splice in a list of all 'EntityDef' in scope. This is useful when running</span><span>
</span><span id="line-3088"></span><span class="hs-comment">-- 'mkPersist' to ensure that all entity definitions are available for setting</span><span>
</span><span id="line-3089"></span><span class="hs-comment">-- foreign keys, and for performing migrations with all entities available.</span><span>
</span><span id="line-3090"></span><span class="hs-comment">--</span><span>
</span><span id="line-3091"></span><span class="hs-comment">-- 'mkPersist' has the type @MkPersistSettings -&gt; [EntityDef] -&gt; DecsQ@. So, to</span><span>
</span><span id="line-3092"></span><span class="hs-comment">-- account for entities defined elsewhere, you'll @mappend $(discoverEntities)@.</span><span>
</span><span id="line-3093"></span><span class="hs-comment">--</span><span>
</span><span id="line-3094"></span><span class="hs-comment">-- For example,</span><span>
</span><span id="line-3095"></span><span class="hs-comment">--</span><span>
</span><span id="line-3096"></span><span class="hs-comment">-- @</span><span>
</span><span id="line-3097"></span><span class="hs-comment">-- share</span><span>
</span><span id="line-3098"></span><span class="hs-comment">--   [ mkPersistWith sqlSettings $(discoverEntities)</span><span>
</span><span id="line-3099"></span><span class="hs-comment">--   ]</span><span>
</span><span id="line-3100"></span><span class="hs-comment">--   [persistLowerCase| ... |]</span><span>
</span><span id="line-3101"></span><span class="hs-comment">-- @</span><span>
</span><span id="line-3102"></span><span class="hs-comment">--</span><span>
</span><span id="line-3103"></span><span class="hs-comment">-- Likewise, to run migrations with all entity instances in scope, you'd write:</span><span>
</span><span id="line-3104"></span><span class="hs-comment">--</span><span>
</span><span id="line-3105"></span><span class="hs-comment">-- @</span><span>
</span><span id="line-3106"></span><span class="hs-comment">-- migrateAll = migrateModels $(discoverEntities)</span><span>
</span><span id="line-3107"></span><span class="hs-comment">-- @</span><span>
</span><span id="line-3108"></span><span class="hs-comment">--</span><span>
</span><span id="line-3109"></span><span class="hs-comment">-- Note that there is some odd behavior with Template Haskell and splicing</span><span>
</span><span id="line-3110"></span><span class="hs-comment">-- groups. If you call 'discoverEntities' in the same module that defines</span><span>
</span><span id="line-3111"></span><span class="hs-comment">-- 'PersistEntity' instances, you need to ensure they are in different top-level</span><span>
</span><span id="line-3112"></span><span class="hs-comment">-- binding groups. You can write @$(pure [])@ at the top level to do this.</span><span>
</span><span id="line-3113"></span><span class="hs-comment">--</span><span>
</span><span id="line-3114"></span><span class="hs-comment">-- @</span><span>
</span><span id="line-3115"></span><span class="hs-comment">-- -- Foo and Bar both export an instance of PersistEntity</span><span>
</span><span id="line-3116"></span><span class="hs-comment">-- import Foo</span><span>
</span><span id="line-3117"></span><span class="hs-comment">-- import Bar</span><span>
</span><span id="line-3118"></span><span class="hs-comment">--</span><span>
</span><span id="line-3119"></span><span class="hs-comment">-- -- Since Foo and Bar are both imported, discoverEntities can find them here.</span><span>
</span><span id="line-3120"></span><span class="hs-comment">-- mkPersistWith sqlSettings $(discoverEntities) [persistLowerCase|</span><span>
</span><span id="line-3121"></span><span class="hs-comment">--   User</span><span>
</span><span id="line-3122"></span><span class="hs-comment">--     name Text</span><span>
</span><span id="line-3123"></span><span class="hs-comment">--     age  Int</span><span>
</span><span id="line-3124"></span><span class="hs-comment">--   |]</span><span>
</span><span id="line-3125"></span><span class="hs-comment">--</span><span>
</span><span id="line-3126"></span><span class="hs-comment">-- -- onlyFooBar is defined in the same 'top level group' as the above generated</span><span>
</span><span id="line-3127"></span><span class="hs-comment">-- -- instance for User, so it isn't present in this list.</span><span>
</span><span id="line-3128"></span><span class="hs-comment">-- onlyFooBar :: [EntityDef]</span><span>
</span><span id="line-3129"></span><span class="hs-comment">-- onlyFooBar = $(discoverEntities)</span><span>
</span><span id="line-3130"></span><span class="hs-comment">--</span><span>
</span><span id="line-3131"></span><span class="hs-comment">-- -- We can manually create a new binding group with this, which splices an</span><span>
</span><span id="line-3132"></span><span class="hs-comment">-- -- empty list of declarations in.</span><span>
</span><span id="line-3133"></span><span class="hs-comment">-- $(pure [])</span><span>
</span><span id="line-3134"></span><span class="hs-comment">--</span><span>
</span><span id="line-3135"></span><span class="hs-comment">-- -- fooBarUser is able to see the 'User' instance.</span><span>
</span><span id="line-3136"></span><span class="hs-comment">-- fooBarUser :: [EntityDef]</span><span>
</span><span id="line-3137"></span><span class="hs-comment">-- fooBarUser = $(discoverEntities)</span><span>
</span><span id="line-3138"></span><span class="hs-comment">-- @</span><span>
</span><span id="line-3139"></span><span class="hs-comment">--</span><span>
</span><span id="line-3140"></span><span class="hs-comment">-- @since 2.13.0.0</span><span>
</span><span id="line-3141"></span><span class="annot"><a href="Database.Persist.TH.html#discoverEntities"><span class="hs-identifier hs-type">discoverEntities</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><span class="hs-identifier hs-type">Q</span></span><span> </span><span class="annot"><span class="hs-identifier hs-type">Exp</span></span><span>
</span><span id="line-3142"></span><span id="discoverEntities"><span class="annot"><span class="annottext">discoverEntities :: Q Exp
</span><a href="Database.Persist.TH.html#discoverEntities"><span class="hs-identifier hs-var hs-var">discoverEntities</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-keyword">do</span><span>
</span><span id="line-3143"></span><span>    </span><span id="local-6989586621679963930"><span class="annot"><span class="annottext">[Dec]
</span><a href="#local-6989586621679963930"><span class="hs-identifier hs-var">instances</span></a></span></span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">Name -&gt; [Type] -&gt; Q [Dec]
</span><span class="hs-identifier hs-var">reifyInstances</span></span><span> </span><span class="hs-special">''</span><span class="hs-identifier">PersistEntity</span><span> </span><span class="hs-special">[</span><span class="annot"><span class="annottext">Name -&gt; Type
</span><span class="hs-identifier hs-var">VarT</span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">String -&gt; Name
</span><span class="hs-identifier hs-var">mkName</span></span><span> </span><span class="annot"><span class="annottext">String
</span><span class="hs-string">&quot;a&quot;</span></span><span class="hs-special">)</span><span class="hs-special">]</span><span>
</span><span id="line-3144"></span><span>    </span><span class="hs-keyword">let</span><span>
</span><span id="line-3145"></span><span>        </span><span id="local-6989586621679963928"><span class="annot"><span class="annottext">types :: [Type]
</span><a href="#local-6989586621679963928"><span class="hs-identifier hs-var hs-var">types</span></a></span></span><span> </span><span class="hs-glyph">=</span><span>
</span><span id="line-3146"></span><span>            </span><span class="annot"><span class="annottext">forall a b. (a -&gt; Maybe b) -&gt; [a] -&gt; [b]
</span><span class="hs-identifier hs-var">mapMaybe</span></span><span> </span><span class="annot"><span class="annottext">Dec -&gt; Maybe Type
</span><a href="#local-6989586621679963927"><span class="hs-identifier hs-var">getDecType</span></a></span><span> </span><span class="annot"><span class="annottext">[Dec]
</span><a href="#local-6989586621679963930"><span class="hs-identifier hs-var">instances</span></a></span><span>
</span><span id="line-3147"></span><span>        </span><span id="local-6989586621679963927"><span class="annot"><span class="annottext">getDecType :: Dec -&gt; Maybe Type
</span><a href="#local-6989586621679963927"><span class="hs-identifier hs-var hs-var">getDecType</span></a></span></span><span> </span><span id="local-6989586621679963926"><span class="annot"><span class="annottext">Dec
</span><a href="#local-6989586621679963926"><span class="hs-identifier hs-var">dec</span></a></span></span><span> </span><span class="hs-glyph">=</span><span>
</span><span id="line-3148"></span><span>            </span><span class="hs-keyword">case</span><span> </span><span class="annot"><span class="annottext">Dec
</span><a href="#local-6989586621679963926"><span class="hs-identifier hs-var">dec</span></a></span><span> </span><span class="hs-keyword">of</span><span>
</span><span id="line-3149"></span><span>                </span><span class="annot"><span class="hs-identifier hs-type">InstanceD</span></span><span> </span><span id="local-6989586621679963925"><span class="annot"><span class="annottext">Maybe Overlap
</span><a href="#local-6989586621679963925"><span class="hs-identifier hs-var">_moverlap</span></a></span></span><span> </span><span class="hs-special">[</span><span class="hs-special">]</span><span> </span><span id="local-6989586621679963924"><span class="annot"><span class="annottext">Type
</span><a href="#local-6989586621679963924"><span class="hs-identifier hs-var">typ</span></a></span></span><span> </span><span id="local-6989586621679963923"><span class="annot"><span class="annottext">[Dec]
</span><a href="#local-6989586621679963923"><span class="hs-identifier hs-var">_decs</span></a></span></span><span> </span><span class="hs-glyph">-&gt;</span><span>
</span><span id="line-3150"></span><span>                    </span><span class="annot"><span class="annottext">Type -&gt; Maybe Type
</span><a href="#local-6989586621679963922"><span class="hs-identifier hs-var">stripPersistEntity</span></a></span><span> </span><span class="annot"><span class="annottext">Type
</span><a href="#local-6989586621679963924"><span class="hs-identifier hs-var">typ</span></a></span><span>
</span><span id="line-3151"></span><span>                </span><span class="annot"><span class="annottext">Dec
</span><span class="hs-identifier">_</span></span><span> </span><span class="hs-glyph">-&gt;</span><span>
</span><span id="line-3152"></span><span>                    </span><span class="annot"><span class="annottext">forall a. Maybe a
</span><span class="hs-identifier hs-var">Nothing</span></span><span>
</span><span id="line-3153"></span><span>        </span><span id="local-6989586621679963922"><span class="annot"><span class="annottext">stripPersistEntity :: Type -&gt; Maybe Type
</span><a href="#local-6989586621679963922"><span class="hs-identifier hs-var hs-var">stripPersistEntity</span></a></span></span><span> </span><span id="local-6989586621679963920"><span class="annot"><span class="annottext">Type
</span><a href="#local-6989586621679963920"><span class="hs-identifier hs-var">typ</span></a></span></span><span> </span><span class="hs-glyph">=</span><span>
</span><span id="line-3154"></span><span>            </span><span class="hs-keyword">case</span><span> </span><span class="annot"><span class="annottext">Type
</span><a href="#local-6989586621679963920"><span class="hs-identifier hs-var">typ</span></a></span><span> </span><span class="hs-keyword">of</span><span>
</span><span id="line-3155"></span><span>                </span><span class="annot"><span class="hs-identifier hs-type">AppT</span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="hs-identifier hs-type">ConT</span></span><span> </span><span id="local-6989586621679963919"><span class="annot"><span class="annottext">Name
</span><a href="#local-6989586621679963919"><span class="hs-identifier hs-var">tyName</span></a></span></span><span class="hs-special">)</span><span> </span><span id="local-6989586621679963918"><span class="annot"><span class="annottext">Type
</span><a href="#local-6989586621679963918"><span class="hs-identifier hs-var">t</span></a></span></span><span> </span><span class="hs-glyph">|</span><span> </span><span class="annot"><span class="annottext">Name
</span><a href="#local-6989586621679963919"><span class="hs-identifier hs-var">tyName</span></a></span><span> </span><span class="annot"><span class="annottext">forall a. Eq a =&gt; a -&gt; a -&gt; Bool
</span><span class="hs-operator hs-var">==</span></span><span> </span><span class="hs-special">''</span><span class="hs-identifier">PersistEntity</span><span> </span><span class="hs-glyph">-&gt;</span><span>
</span><span id="line-3156"></span><span>                    </span><span class="annot"><span class="annottext">forall a. a -&gt; Maybe a
</span><span class="hs-identifier hs-var">Just</span></span><span> </span><span class="annot"><span class="annottext">Type
</span><a href="#local-6989586621679963918"><span class="hs-identifier hs-var">t</span></a></span><span>
</span><span id="line-3157"></span><span>                </span><span class="annot"><span class="annottext">Type
</span><span class="hs-identifier">_</span></span><span> </span><span class="hs-glyph">-&gt;</span><span>
</span><span id="line-3158"></span><span>                    </span><span class="annot"><span class="annottext">forall a. Maybe a
</span><span class="hs-identifier hs-var">Nothing</span></span><span>
</span><span id="line-3159"></span><span>
</span><span id="line-3160"></span><span>    </span><span class="annot"><span class="annottext">forall (f :: * -&gt; *) a b. Functor f =&gt; (a -&gt; b) -&gt; f a -&gt; f b
</span><span class="hs-identifier hs-var">fmap</span></span><span> </span><span class="annot"><span class="annottext">[Exp] -&gt; Exp
</span><span class="hs-identifier hs-var">ListE</span></span><span> </span><span class="annot"><span class="annottext">forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span>
</span><span id="line-3161"></span><span>        </span><span class="annot"><span class="annottext">forall (t :: * -&gt; *) (m :: * -&gt; *) a b.
(Traversable t, Monad m) =&gt;
t a -&gt; (a -&gt; m b) -&gt; m (t b)
</span><span class="hs-identifier hs-var">forM</span></span><span> </span><span class="annot"><span class="annottext">[Type]
</span><a href="#local-6989586621679963928"><span class="hs-identifier hs-var">types</span></a></span><span> </span><span class="annot"><span class="annottext">forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span> </span><span class="hs-glyph">\</span><span id="local-6989586621679963917"><span class="annot"><span class="annottext">Type
</span><a href="#local-6989586621679963917"><span class="hs-identifier hs-var">typ</span></a></span></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-keyword">do</span><span>
</span><span id="line-3162"></span><span>            </span><span class="hs-special">[e|</span><span> </span><span class="hs-identifier">entityDef</span><span> </span><span class="hs-special">(</span><span class="hs-identifier">Proxy</span><span> </span><span class="hs-glyph">::</span><span> </span><span class="hs-identifier">Proxy</span><span> </span><span class="hs-special">$</span><span class="hs-special">(</span><span class="hs-identifier">pure</span><span> </span><span class="hs-identifier">typ</span><span class="hs-special">)</span><span class="hs-special">)</span><span> </span><span class="hs-special">|]</span><span>
</span><span id="line-3163"></span><span>
</span><span id="line-3164"></span><span class="annot"><a href="Database.Persist.TH.html#setNull"><span class="hs-identifier hs-type">setNull</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><span class="hs-identifier hs-type">NonEmpty</span></span><span> </span><span class="annot"><a href="Database.Persist.Quasi.Internal.html#UnboundFieldDef"><span class="hs-identifier hs-type">UnboundFieldDef</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="hs-identifier hs-type">Bool</span></span><span>
</span><span id="line-3165"></span><span id="setNull"><span class="annot"><span class="annottext">setNull :: NonEmpty UnboundFieldDef -&gt; Bool
</span><a href="Database.Persist.TH.html#setNull"><span class="hs-identifier hs-var hs-var">setNull</span></a></span></span><span> </span><span class="hs-special">(</span><span id="local-6989586621679963916"><span class="annot"><span class="annottext">UnboundFieldDef
</span><a href="#local-6989586621679963916"><span class="hs-identifier hs-var">fd</span></a></span></span><span> </span><span class="annot"><span class="hs-operator hs-type">:|</span></span><span> </span><span id="local-6989586621679963915"><span class="annot"><span class="annottext">[UnboundFieldDef]
</span><a href="#local-6989586621679963915"><span class="hs-identifier hs-var">fds</span></a></span></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">=</span><span>
</span><span id="line-3166"></span><span>    </span><span class="hs-keyword">let</span><span>
</span><span id="line-3167"></span><span>        </span><span id="local-6989586621679963914"><span class="annot"><span class="annottext">nullSetting :: Bool
</span><a href="#local-6989586621679963914"><span class="hs-identifier hs-var hs-var">nullSetting</span></a></span></span><span> </span><span class="hs-glyph">=</span><span>
</span><span id="line-3168"></span><span>            </span><span class="annot"><span class="annottext">UnboundFieldDef -&gt; Bool
</span><a href="#local-6989586621679963913"><span class="hs-identifier hs-var">isNull</span></a></span><span> </span><span class="annot"><span class="annottext">UnboundFieldDef
</span><a href="#local-6989586621679963916"><span class="hs-identifier hs-var">fd</span></a></span><span>
</span><span id="line-3169"></span><span>        </span><span id="local-6989586621679963913"><span class="annot"><span class="annottext">isNull :: UnboundFieldDef -&gt; Bool
</span><a href="#local-6989586621679963913"><span class="hs-identifier hs-var hs-var">isNull</span></a></span></span><span> </span><span class="hs-glyph">=</span><span>
</span><span id="line-3170"></span><span>            </span><span class="hs-special">(</span><span class="annot"><span class="annottext">IsNullable
</span><a href="Database.Persist.Types.Base.html#NotNullable"><span class="hs-identifier hs-var">NotNullable</span></a></span><span> </span><span class="annot"><span class="annottext">forall a. Eq a =&gt; a -&gt; a -&gt; Bool
</span><span class="hs-operator hs-var">/=</span></span><span class="hs-special">)</span><span> </span><span class="annot"><span class="annottext">forall b c a. (b -&gt; c) -&gt; (a -&gt; b) -&gt; a -&gt; c
</span><span class="hs-operator hs-var">.</span></span><span> </span><span class="annot"><span class="annottext">UnboundFieldDef -&gt; IsNullable
</span><a href="Database.Persist.Quasi.Internal.html#isUnboundFieldNullable"><span class="hs-identifier hs-var">isUnboundFieldNullable</span></a></span><span>
</span><span id="line-3171"></span><span>    </span><span class="hs-keyword">in</span><span>
</span><span id="line-3172"></span><span>        </span><span class="hs-keyword">if</span><span> </span><span class="annot"><span class="annottext">forall (t :: * -&gt; *) a. Foldable t =&gt; (a -&gt; Bool) -&gt; t a -&gt; Bool
</span><span class="hs-identifier hs-var">all</span></span><span> </span><span class="hs-special">(</span><span class="hs-special">(</span><span class="annot"><span class="annottext">Bool
</span><a href="#local-6989586621679963914"><span class="hs-identifier hs-var">nullSetting</span></a></span><span> </span><span class="annot"><span class="annottext">forall a. Eq a =&gt; a -&gt; a -&gt; Bool
</span><span class="hs-operator hs-var">==</span></span><span class="hs-special">)</span><span> </span><span class="annot"><span class="annottext">forall b c a. (b -&gt; c) -&gt; (a -&gt; b) -&gt; a -&gt; c
</span><span class="hs-operator hs-var">.</span></span><span> </span><span class="annot"><span class="annottext">UnboundFieldDef -&gt; Bool
</span><a href="#local-6989586621679963913"><span class="hs-identifier hs-var">isNull</span></a></span><span class="hs-special">)</span><span> </span><span class="annot"><span class="annottext">[UnboundFieldDef]
</span><a href="#local-6989586621679963915"><span class="hs-identifier hs-var">fds</span></a></span><span>
</span><span id="line-3173"></span><span>        </span><span class="hs-keyword">then</span><span> </span><span class="annot"><span class="annottext">Bool
</span><a href="#local-6989586621679963914"><span class="hs-identifier hs-var">nullSetting</span></a></span><span>
</span><span id="line-3174"></span><span>        </span><span class="hs-keyword">else</span><span> </span><span class="annot"><span class="annottext">forall a. HasCallStack =&gt; String -&gt; a
</span><span class="hs-identifier hs-var">error</span></span><span> </span><span class="annot"><span class="annottext">forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span>
</span><span id="line-3175"></span><span>            </span><span class="annot"><span class="annottext">String
</span><span class="hs-string">&quot;foreign key columns must all be nullable or non-nullable&quot;</span></span><span>
</span><span id="line-3176"></span><span>           </span><span class="annot"><span class="annottext">forall m. Monoid m =&gt; m -&gt; m -&gt; m
</span><a href="Database.Persist.TH.html#%2B%2B"><span class="hs-operator hs-var">++</span></a></span><span> </span><span class="annot"><span class="annottext">forall a. Show a =&gt; a -&gt; String
</span><span class="hs-identifier hs-var">show</span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">forall (f :: * -&gt; *) a b. Functor f =&gt; (a -&gt; b) -&gt; f a -&gt; f b
</span><span class="hs-identifier hs-var">fmap</span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">FieldNameHS -&gt; Text
</span><a href="Database.Persist.Names.html#unFieldNameHS"><span class="hs-identifier hs-var">unFieldNameHS</span></a></span><span> </span><span class="annot"><span class="annottext">forall b c a. (b -&gt; c) -&gt; (a -&gt; b) -&gt; a -&gt; c
</span><span class="hs-operator hs-var">.</span></span><span> </span><span class="annot"><span class="annottext">UnboundFieldDef -&gt; FieldNameHS
</span><a href="Database.Persist.Quasi.Internal.html#unboundFieldNameHS"><span class="hs-identifier hs-var">unboundFieldNameHS</span></a></span><span class="hs-special">)</span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">UnboundFieldDef
</span><a href="#local-6989586621679963916"><span class="hs-identifier hs-var">fd</span></a></span><span class="annot"><span class="annottext">forall a. a -&gt; [a] -&gt; [a]
</span><span class="hs-glyph hs-var">:</span></span><span class="annot"><span class="annottext">[UnboundFieldDef]
</span><a href="#local-6989586621679963915"><span class="hs-identifier hs-var">fds</span></a></span><span class="hs-special">)</span><span class="hs-special">)</span><span>
</span><span id="line-3177"></span></pre></body></html>