<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd"><html xmlns="http://www.w3.org/1999/xhtml"><head><link rel="stylesheet" type="text/css" href="style.css" /><script type="text/javascript" src="highlight.js"></script></head><body><pre><span class="hs-pragma">{-# LANGUAGE CPP                 #-}</span><span>
</span><span id="line-2"></span><span class="hs-pragma">{-# LANGUAGE FlexibleContexts    #-}</span><span>
</span><span id="line-3"></span><span class="hs-pragma">{-# LANGUAGE RankNTypes          #-}</span><span>
</span><span id="line-4"></span><span class="hs-pragma">{-# LANGUAGE ScopedTypeVariables #-}</span><span>
</span><span id="line-5"></span><span>
</span><span id="line-6"></span><span class="hs-comment">{-
(c) The University of Glasgow 2006
-}</span><span>
</span><span id="line-9"></span><span>
</span><span id="line-10"></span><span class="hs-comment">-- | Module for (a) type kinds and (b) type coercions,</span><span>
</span><span id="line-11"></span><span class="hs-comment">-- as used in System FC. See 'GHC.Core.Expr' for</span><span>
</span><span id="line-12"></span><span class="hs-comment">-- more on System FC and how coercions fit into it.</span><span>
</span><span id="line-13"></span><span class="hs-comment">--</span><span>
</span><span id="line-14"></span><span class="hs-keyword">module</span><span> </span><span class="hs-identifier">GHC.Core.Coercion</span><span> </span><span class="hs-special">(</span><span>
</span><span id="line-15"></span><span>        </span><span class="annot"><span class="hs-comment">-- * Main data type</span></span><span>
</span><span id="line-16"></span><span>        </span><span class="annot"><a href="GHC.Core.TyCo.Rep.html#Coercion"><span class="hs-identifier">Coercion</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><a href="GHC.Core.TyCo.Rep.html#CoercionN"><span class="hs-identifier">CoercionN</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><a href="GHC.Core.TyCo.Rep.html#CoercionR"><span class="hs-identifier">CoercionR</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><a href="GHC.Core.TyCo.Rep.html#CoercionP"><span class="hs-identifier">CoercionP</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><a href="GHC.Core.TyCo.Rep.html#MCoercion"><span class="hs-identifier">MCoercion</span></a></span><span class="hs-special">(</span><span class="hs-glyph">..</span><span class="hs-special">)</span><span class="hs-special">,</span><span> </span><span class="annot"><a href="GHC.Core.TyCo.Rep.html#MCoercionN"><span class="hs-identifier">MCoercionN</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><a href="GHC.Core.TyCo.Rep.html#MCoercionR"><span class="hs-identifier">MCoercionR</span></a></span><span class="hs-special">,</span><span>
</span><span id="line-17"></span><span>        </span><span class="annot"><a href="GHC.Core.TyCo.Rep.html#UnivCoProvenance"><span class="hs-identifier">UnivCoProvenance</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><a href="GHC.Core.TyCo.Rep.html#CoercionHole"><span class="hs-identifier">CoercionHole</span></a></span><span class="hs-special">(</span><span class="hs-glyph">..</span><span class="hs-special">)</span><span class="hs-special">,</span><span>
</span><span id="line-18"></span><span>        </span><span class="annot"><a href="GHC.Core.TyCo.Rep.html#coHoleCoVar"><span class="hs-identifier">coHoleCoVar</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><a href="GHC.Core.TyCo.Rep.html#setCoHoleCoVar"><span class="hs-identifier">setCoHoleCoVar</span></a></span><span class="hs-special">,</span><span>
</span><span id="line-19"></span><span>        </span><span class="annot"><a href="GHC.Types.Basic.html#LeftOrRight"><span class="hs-identifier">LeftOrRight</span></a></span><span class="hs-special">(</span><span class="hs-glyph">..</span><span class="hs-special">)</span><span class="hs-special">,</span><span>
</span><span id="line-20"></span><span>        </span><span class="annot"><a href="GHC.Types.Var.html#Var"><span class="hs-identifier">Var</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><a href="GHC.Types.Var.html#CoVar"><span class="hs-identifier">CoVar</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><a href="GHC.Types.Var.html#TyCoVar"><span class="hs-identifier">TyCoVar</span></a></span><span class="hs-special">,</span><span>
</span><span id="line-21"></span><span>        </span><span class="annot"><a href="GHC.Core.Coercion.Axiom.html#Role"><span class="hs-identifier">Role</span></a></span><span class="hs-special">(</span><span class="hs-glyph">..</span><span class="hs-special">)</span><span class="hs-special">,</span><span> </span><span class="annot"><a href="GHC.Core.Coercion.html#ltRole"><span class="hs-identifier">ltRole</span></a></span><span class="hs-special">,</span><span>
</span><span id="line-22"></span><span>
</span><span id="line-23"></span><span>        </span><span class="annot"><span class="hs-comment">-- ** Functions over coercions</span></span><span>
</span><span id="line-24"></span><span>        </span><span class="annot"><a href="GHC.Core.Coercion.html#coVarTypes"><span class="hs-identifier">coVarTypes</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><a href="GHC.Core.Coercion.html#coVarKind"><span class="hs-identifier">coVarKind</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><a href="GHC.Core.Coercion.html#coVarKindsTypesRole"><span class="hs-identifier">coVarKindsTypesRole</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><a href="GHC.Core.Coercion.html#coVarRole"><span class="hs-identifier">coVarRole</span></a></span><span class="hs-special">,</span><span>
</span><span id="line-25"></span><span>        </span><span class="annot"><a href="GHC.Core.Coercion.html#coercionType"><span class="hs-identifier">coercionType</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><a href="GHC.Core.Coercion.html#mkCoercionType"><span class="hs-identifier">mkCoercionType</span></a></span><span class="hs-special">,</span><span>
</span><span id="line-26"></span><span>        </span><span class="annot"><a href="GHC.Core.Coercion.html#coercionKind"><span class="hs-identifier">coercionKind</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><a href="GHC.Core.Coercion.html#coercionLKind"><span class="hs-identifier">coercionLKind</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><a href="GHC.Core.Coercion.html#coercionRKind"><span class="hs-identifier">coercionRKind</span></a></span><span class="hs-special">,</span><span class="annot"><a href="GHC.Core.Coercion.html#coercionKinds"><span class="hs-identifier">coercionKinds</span></a></span><span class="hs-special">,</span><span>
</span><span id="line-27"></span><span>        </span><span class="annot"><a href="GHC.Core.Coercion.html#coercionRole"><span class="hs-identifier">coercionRole</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><a href="GHC.Core.Coercion.html#coercionKindRole"><span class="hs-identifier">coercionKindRole</span></a></span><span class="hs-special">,</span><span>
</span><span id="line-28"></span><span>
</span><span id="line-29"></span><span>        </span><span class="annot"><span class="hs-comment">-- ** Constructing coercions</span></span><span>
</span><span id="line-30"></span><span>        </span><span class="annot"><a href="GHC.Core.Coercion.html#mkGReflCo"><span class="hs-identifier">mkGReflCo</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><a href="GHC.Core.Coercion.html#mkReflCo"><span class="hs-identifier">mkReflCo</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><a href="GHC.Core.Coercion.html#mkRepReflCo"><span class="hs-identifier">mkRepReflCo</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><a href="GHC.Core.Coercion.html#mkNomReflCo"><span class="hs-identifier">mkNomReflCo</span></a></span><span class="hs-special">,</span><span>
</span><span id="line-31"></span><span>        </span><span class="annot"><a href="GHC.Core.Coercion.html#mkCoVarCo"><span class="hs-identifier">mkCoVarCo</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><a href="GHC.Core.Coercion.html#mkCoVarCos"><span class="hs-identifier">mkCoVarCos</span></a></span><span class="hs-special">,</span><span>
</span><span id="line-32"></span><span>        </span><span class="annot"><a href="GHC.Core.Coercion.html#mkAxInstCo"><span class="hs-identifier">mkAxInstCo</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><a href="GHC.Core.Coercion.html#mkUnbranchedAxInstCo"><span class="hs-identifier">mkUnbranchedAxInstCo</span></a></span><span class="hs-special">,</span><span>
</span><span id="line-33"></span><span>        </span><span class="annot"><a href="GHC.Core.Coercion.html#mkAxInstRHS"><span class="hs-identifier">mkAxInstRHS</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><a href="GHC.Core.Coercion.html#mkUnbranchedAxInstRHS"><span class="hs-identifier">mkUnbranchedAxInstRHS</span></a></span><span class="hs-special">,</span><span>
</span><span id="line-34"></span><span>        </span><span class="annot"><a href="GHC.Core.Coercion.html#mkAxInstLHS"><span class="hs-identifier">mkAxInstLHS</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><a href="GHC.Core.Coercion.html#mkUnbranchedAxInstLHS"><span class="hs-identifier">mkUnbranchedAxInstLHS</span></a></span><span class="hs-special">,</span><span>
</span><span id="line-35"></span><span>        </span><span class="annot"><a href="GHC.Core.Coercion.html#mkPiCo"><span class="hs-identifier">mkPiCo</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><a href="GHC.Core.Coercion.html#mkPiCos"><span class="hs-identifier">mkPiCos</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><a href="GHC.Core.Coercion.html#mkCoCast"><span class="hs-identifier">mkCoCast</span></a></span><span class="hs-special">,</span><span>
</span><span id="line-36"></span><span>        </span><span class="annot"><a href="GHC.Core.Coercion.html#mkSymCo"><span class="hs-identifier">mkSymCo</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><a href="GHC.Core.Coercion.html#mkTransCo"><span class="hs-identifier">mkTransCo</span></a></span><span class="hs-special">,</span><span>
</span><span id="line-37"></span><span>        </span><span class="annot"><a href="GHC.Core.Coercion.html#mkNthCo"><span class="hs-identifier">mkNthCo</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><a href="GHC.Core.Coercion.html#mkNthCoFunCo"><span class="hs-identifier">mkNthCoFunCo</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><a href="GHC.Core.Coercion.html#nthCoRole"><span class="hs-identifier">nthCoRole</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><a href="GHC.Core.Coercion.html#mkLRCo"><span class="hs-identifier">mkLRCo</span></a></span><span class="hs-special">,</span><span>
</span><span id="line-38"></span><span>        </span><span class="annot"><a href="GHC.Core.Coercion.html#mkInstCo"><span class="hs-identifier">mkInstCo</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><a href="GHC.Core.Coercion.html#mkAppCo"><span class="hs-identifier">mkAppCo</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><a href="GHC.Core.Coercion.html#mkAppCos"><span class="hs-identifier">mkAppCos</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><a href="GHC.Core.Coercion.html#mkTyConAppCo"><span class="hs-identifier">mkTyConAppCo</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><a href="GHC.Core.Coercion.html#mkFunCo"><span class="hs-identifier">mkFunCo</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><a href="GHC.Core.Coercion.html#mkFunResCo"><span class="hs-identifier">mkFunResCo</span></a></span><span class="hs-special">,</span><span>
</span><span id="line-39"></span><span>        </span><span class="annot"><a href="GHC.Core.Coercion.html#mkForAllCo"><span class="hs-identifier">mkForAllCo</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><a href="GHC.Core.Coercion.html#mkForAllCos"><span class="hs-identifier">mkForAllCos</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><a href="GHC.Core.Coercion.html#mkHomoForAllCos"><span class="hs-identifier">mkHomoForAllCos</span></a></span><span class="hs-special">,</span><span>
</span><span id="line-40"></span><span>        </span><span class="annot"><a href="GHC.Core.Coercion.html#mkPhantomCo"><span class="hs-identifier">mkPhantomCo</span></a></span><span class="hs-special">,</span><span>
</span><span id="line-41"></span><span>        </span><span class="annot"><a href="GHC.Core.Coercion.html#mkHoleCo"><span class="hs-identifier">mkHoleCo</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><a href="GHC.Core.Coercion.html#mkUnivCo"><span class="hs-identifier">mkUnivCo</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><a href="GHC.Core.Coercion.html#mkSubCo"><span class="hs-identifier">mkSubCo</span></a></span><span class="hs-special">,</span><span>
</span><span id="line-42"></span><span>        </span><span class="annot"><a href="GHC.Core.Coercion.html#mkAxiomInstCo"><span class="hs-identifier">mkAxiomInstCo</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><a href="GHC.Core.Coercion.html#mkProofIrrelCo"><span class="hs-identifier">mkProofIrrelCo</span></a></span><span class="hs-special">,</span><span>
</span><span id="line-43"></span><span>        </span><span class="annot"><a href="GHC.Core.Coercion.html#downgradeRole"><span class="hs-identifier">downgradeRole</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><a href="GHC.Core.Coercion.html#mkAxiomRuleCo"><span class="hs-identifier">mkAxiomRuleCo</span></a></span><span class="hs-special">,</span><span>
</span><span id="line-44"></span><span>        </span><span class="annot"><a href="GHC.Core.Coercion.html#mkGReflRightCo"><span class="hs-identifier">mkGReflRightCo</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><a href="GHC.Core.Coercion.html#mkGReflLeftCo"><span class="hs-identifier">mkGReflLeftCo</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><a href="GHC.Core.Coercion.html#mkCoherenceLeftCo"><span class="hs-identifier">mkCoherenceLeftCo</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><a href="GHC.Core.Coercion.html#mkCoherenceRightCo"><span class="hs-identifier">mkCoherenceRightCo</span></a></span><span class="hs-special">,</span><span>
</span><span id="line-45"></span><span>        </span><span class="annot"><a href="GHC.Core.Coercion.html#mkKindCo"><span class="hs-identifier">mkKindCo</span></a></span><span class="hs-special">,</span><span>
</span><span id="line-46"></span><span>        </span><span class="annot"><a href="GHC.Core.Coercion.html#castCoercionKind"><span class="hs-identifier">castCoercionKind</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><a href="GHC.Core.Coercion.html#castCoercionKind1"><span class="hs-identifier">castCoercionKind1</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><a href="GHC.Core.Coercion.html#castCoercionKind2"><span class="hs-identifier">castCoercionKind2</span></a></span><span class="hs-special">,</span><span>
</span><span id="line-47"></span><span>        </span><span class="annot"><a href="GHC.Core.Coercion.html#mkFamilyTyConAppCo"><span class="hs-identifier">mkFamilyTyConAppCo</span></a></span><span class="hs-special">,</span><span>
</span><span id="line-48"></span><span>
</span><span id="line-49"></span><span>        </span><span class="annot"><a href="GHC.Core.Coercion.html#mkHeteroCoercionType"><span class="hs-identifier">mkHeteroCoercionType</span></a></span><span class="hs-special">,</span><span>
</span><span id="line-50"></span><span>        </span><span class="annot"><a href="GHC.Core.Coercion.html#mkPrimEqPred"><span class="hs-identifier">mkPrimEqPred</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><a href="GHC.Core.Coercion.html#mkReprPrimEqPred"><span class="hs-identifier">mkReprPrimEqPred</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><a href="GHC.Core.Coercion.html#mkPrimEqPredRole"><span class="hs-identifier">mkPrimEqPredRole</span></a></span><span class="hs-special">,</span><span>
</span><span id="line-51"></span><span>        </span><span class="annot"><a href="GHC.Core.Coercion.html#mkHeteroPrimEqPred"><span class="hs-identifier">mkHeteroPrimEqPred</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><a href="GHC.Core.Coercion.html#mkHeteroReprPrimEqPred"><span class="hs-identifier">mkHeteroReprPrimEqPred</span></a></span><span class="hs-special">,</span><span>
</span><span id="line-52"></span><span>
</span><span id="line-53"></span><span>        </span><span class="annot"><span class="hs-comment">-- ** Decomposition</span></span><span>
</span><span id="line-54"></span><span>        </span><span class="annot"><a href="GHC.Core.Coercion.html#instNewTyCon_maybe"><span class="hs-identifier">instNewTyCon_maybe</span></a></span><span class="hs-special">,</span><span>
</span><span id="line-55"></span><span>
</span><span id="line-56"></span><span>        </span><span class="annot"><a href="GHC.Core.Coercion.html#NormaliseStepper"><span class="hs-identifier">NormaliseStepper</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><a href="GHC.Core.Coercion.html#NormaliseStepResult"><span class="hs-identifier">NormaliseStepResult</span></a></span><span class="hs-special">(</span><span class="hs-glyph">..</span><span class="hs-special">)</span><span class="hs-special">,</span><span> </span><span class="annot"><a href="GHC.Core.Coercion.html#composeSteppers"><span class="hs-identifier">composeSteppers</span></a></span><span class="hs-special">,</span><span>
</span><span id="line-57"></span><span>        </span><span class="annot"><a href="GHC.Core.Coercion.html#mapStepResult"><span class="hs-identifier">mapStepResult</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><a href="GHC.Core.Coercion.html#unwrapNewTypeStepper"><span class="hs-identifier">unwrapNewTypeStepper</span></a></span><span class="hs-special">,</span><span>
</span><span id="line-58"></span><span>        </span><span class="annot"><a href="GHC.Core.Coercion.html#topNormaliseNewType_maybe"><span class="hs-identifier">topNormaliseNewType_maybe</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><a href="GHC.Core.Coercion.html#topNormaliseTypeX"><span class="hs-identifier">topNormaliseTypeX</span></a></span><span class="hs-special">,</span><span>
</span><span id="line-59"></span><span>
</span><span id="line-60"></span><span>        </span><span class="annot"><a href="GHC.Core.Coercion.html#decomposeCo"><span class="hs-identifier">decomposeCo</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><a href="GHC.Core.Coercion.html#decomposeFunCo"><span class="hs-identifier">decomposeFunCo</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><a href="GHC.Core.Coercion.html#decomposePiCos"><span class="hs-identifier">decomposePiCos</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><a href="GHC.Core.Coercion.html#getCoVar_maybe"><span class="hs-identifier">getCoVar_maybe</span></a></span><span class="hs-special">,</span><span>
</span><span id="line-61"></span><span>        </span><span class="annot"><a href="GHC.Core.Coercion.html#splitTyConAppCo_maybe"><span class="hs-identifier">splitTyConAppCo_maybe</span></a></span><span class="hs-special">,</span><span>
</span><span id="line-62"></span><span>        </span><span class="annot"><a href="GHC.Core.Coercion.html#splitAppCo_maybe"><span class="hs-identifier">splitAppCo_maybe</span></a></span><span class="hs-special">,</span><span>
</span><span id="line-63"></span><span>        </span><span class="annot"><a href="GHC.Core.Coercion.html#splitFunCo_maybe"><span class="hs-identifier">splitFunCo_maybe</span></a></span><span class="hs-special">,</span><span>
</span><span id="line-64"></span><span>        </span><span class="annot"><a href="GHC.Core.Coercion.html#splitForAllCo_maybe"><span class="hs-identifier">splitForAllCo_maybe</span></a></span><span class="hs-special">,</span><span>
</span><span id="line-65"></span><span>        </span><span class="annot"><a href="GHC.Core.Coercion.html#splitForAllCo_ty_maybe"><span class="hs-identifier">splitForAllCo_ty_maybe</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><a href="GHC.Core.Coercion.html#splitForAllCo_co_maybe"><span class="hs-identifier">splitForAllCo_co_maybe</span></a></span><span class="hs-special">,</span><span>
</span><span id="line-66"></span><span>
</span><span id="line-67"></span><span>        </span><span class="annot"><a href="GHC.Core.Coercion.html#nthRole"><span class="hs-identifier">nthRole</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><a href="GHC.Core.Coercion.html#tyConRolesX"><span class="hs-identifier">tyConRolesX</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><a href="GHC.Core.Coercion.html#tyConRolesRepresentational"><span class="hs-identifier">tyConRolesRepresentational</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><a href="GHC.Core.Coercion.html#setNominalRole_maybe"><span class="hs-identifier">setNominalRole_maybe</span></a></span><span class="hs-special">,</span><span>
</span><span id="line-68"></span><span>
</span><span id="line-69"></span><span>        </span><span class="annot"><a href="GHC.Types.Basic.html#pickLR"><span class="hs-identifier">pickLR</span></a></span><span class="hs-special">,</span><span>
</span><span id="line-70"></span><span>
</span><span id="line-71"></span><span>        </span><span class="annot"><a href="GHC.Core.Coercion.html#isGReflCo"><span class="hs-identifier">isGReflCo</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><a href="GHC.Core.Coercion.html#isReflCo"><span class="hs-identifier">isReflCo</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><a href="GHC.Core.Coercion.html#isReflCo_maybe"><span class="hs-identifier">isReflCo_maybe</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><a href="GHC.Core.Coercion.html#isGReflCo_maybe"><span class="hs-identifier">isGReflCo_maybe</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><a href="GHC.Core.Coercion.html#isReflexiveCo"><span class="hs-identifier">isReflexiveCo</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><a href="GHC.Core.Coercion.html#isReflexiveCo_maybe"><span class="hs-identifier">isReflexiveCo_maybe</span></a></span><span class="hs-special">,</span><span>
</span><span id="line-72"></span><span>        </span><span class="annot"><a href="GHC.Core.Coercion.html#isReflCoVar_maybe"><span class="hs-identifier">isReflCoVar_maybe</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><a href="GHC.Core.Coercion.html#isGReflMCo"><span class="hs-identifier">isGReflMCo</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><a href="GHC.Core.Coercion.html#mkGReflLeftMCo"><span class="hs-identifier">mkGReflLeftMCo</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><a href="GHC.Core.Coercion.html#mkGReflRightMCo"><span class="hs-identifier">mkGReflRightMCo</span></a></span><span class="hs-special">,</span><span>
</span><span id="line-73"></span><span>        </span><span class="annot"><a href="GHC.Core.Coercion.html#mkCoherenceRightMCo"><span class="hs-identifier">mkCoherenceRightMCo</span></a></span><span class="hs-special">,</span><span>
</span><span id="line-74"></span><span>
</span><span id="line-75"></span><span>        </span><span class="annot"><a href="GHC.Core.Coercion.html#coToMCo"><span class="hs-identifier">coToMCo</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><a href="GHC.Core.Coercion.html#mkTransMCo"><span class="hs-identifier">mkTransMCo</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><a href="GHC.Core.Coercion.html#mkTransMCoL"><span class="hs-identifier">mkTransMCoL</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><a href="GHC.Core.Coercion.html#mkTransMCoR"><span class="hs-identifier">mkTransMCoR</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><a href="GHC.Core.Coercion.html#mkCastTyMCo"><span class="hs-identifier">mkCastTyMCo</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><a href="GHC.Core.Coercion.html#mkSymMCo"><span class="hs-identifier">mkSymMCo</span></a></span><span class="hs-special">,</span><span>
</span><span id="line-76"></span><span>        </span><span class="annot"><a href="GHC.Core.Coercion.html#mkHomoForAllMCo"><span class="hs-identifier">mkHomoForAllMCo</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><a href="GHC.Core.Coercion.html#mkFunResMCo"><span class="hs-identifier">mkFunResMCo</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><a href="GHC.Core.Coercion.html#mkPiMCos"><span class="hs-identifier">mkPiMCos</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><a href="GHC.Core.Coercion.html#checkReflexiveMCo"><span class="hs-identifier">checkReflexiveMCo</span></a></span><span class="hs-special">,</span><span>
</span><span id="line-77"></span><span>        </span><span class="annot"><a href="GHC.Core.Coercion.html#isReflMCo"><span class="hs-identifier">isReflMCo</span></a></span><span class="hs-special">,</span><span>
</span><span id="line-78"></span><span>
</span><span id="line-79"></span><span>        </span><span class="annot"><span class="hs-comment">-- ** Coercion variables</span></span><span>
</span><span id="line-80"></span><span>        </span><span class="annot"><a href="GHC.Types.Var.html#mkCoVar"><span class="hs-identifier">mkCoVar</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><a href="GHC.Types.Var.html#isCoVar"><span class="hs-identifier">isCoVar</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><a href="GHC.Core.Coercion.html#coVarName"><span class="hs-identifier">coVarName</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><a href="GHC.Core.Coercion.html#setCoVarName"><span class="hs-identifier">setCoVarName</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><a href="GHC.Core.Coercion.html#setCoVarUnique"><span class="hs-identifier">setCoVarUnique</span></a></span><span class="hs-special">,</span><span>
</span><span id="line-81"></span><span>        </span><span class="annot"><a href="GHC.Core.Coercion.html#isCoVar_maybe"><span class="hs-identifier">isCoVar_maybe</span></a></span><span class="hs-special">,</span><span>
</span><span id="line-82"></span><span>
</span><span id="line-83"></span><span>        </span><span class="annot"><span class="hs-comment">-- ** Free variables</span></span><span>
</span><span id="line-84"></span><span>        </span><span class="annot"><a href="GHC.Core.TyCo.FVs.html#tyCoVarsOfCo"><span class="hs-identifier">tyCoVarsOfCo</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><a href="GHC.Core.TyCo.FVs.html#tyCoVarsOfCos"><span class="hs-identifier">tyCoVarsOfCos</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><a href="GHC.Core.TyCo.FVs.html#coVarsOfCo"><span class="hs-identifier">coVarsOfCo</span></a></span><span class="hs-special">,</span><span>
</span><span id="line-85"></span><span>        </span><span class="annot"><a href="GHC.Core.TyCo.FVs.html#tyCoFVsOfCo"><span class="hs-identifier">tyCoFVsOfCo</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><a href="GHC.Core.TyCo.FVs.html#tyCoFVsOfCos"><span class="hs-identifier">tyCoFVsOfCos</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><a href="GHC.Core.TyCo.FVs.html#tyCoVarsOfCoDSet"><span class="hs-identifier">tyCoVarsOfCoDSet</span></a></span><span class="hs-special">,</span><span>
</span><span id="line-86"></span><span>        </span><span class="annot"><a href="GHC.Core.TyCo.Rep.html#coercionSize"><span class="hs-identifier">coercionSize</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><a href="GHC.Core.TyCo.FVs.html#anyFreeVarsOfCo"><span class="hs-identifier">anyFreeVarsOfCo</span></a></span><span class="hs-special">,</span><span>
</span><span id="line-87"></span><span>
</span><span id="line-88"></span><span>        </span><span class="annot"><span class="hs-comment">-- ** Substitution</span></span><span>
</span><span id="line-89"></span><span>        </span><span class="annot"><a href="GHC.Core.TyCo.Subst.html#CvSubstEnv"><span class="hs-identifier">CvSubstEnv</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><a href="GHC.Core.TyCo.Subst.html#emptyCvSubstEnv"><span class="hs-identifier">emptyCvSubstEnv</span></a></span><span class="hs-special">,</span><span>
</span><span id="line-90"></span><span>        </span><span class="annot"><a href="GHC.Core.TyCo.Subst.html#lookupCoVar"><span class="hs-identifier">lookupCoVar</span></a></span><span class="hs-special">,</span><span>
</span><span id="line-91"></span><span>        </span><span class="annot"><a href="GHC.Core.TyCo.Subst.html#substCo"><span class="hs-identifier">substCo</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><a href="GHC.Core.TyCo.Subst.html#substCos"><span class="hs-identifier">substCos</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><a href="GHC.Core.TyCo.Subst.html#substCoVar"><span class="hs-identifier">substCoVar</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><a href="GHC.Core.TyCo.Subst.html#substCoVars"><span class="hs-identifier">substCoVars</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><a href="GHC.Core.TyCo.Subst.html#substCoWith"><span class="hs-identifier">substCoWith</span></a></span><span class="hs-special">,</span><span>
</span><span id="line-92"></span><span>        </span><span class="annot"><a href="GHC.Core.TyCo.Subst.html#substCoVarBndr"><span class="hs-identifier">substCoVarBndr</span></a></span><span class="hs-special">,</span><span>
</span><span id="line-93"></span><span>        </span><span class="annot"><a href="GHC.Core.TyCo.Subst.html#extendTvSubstAndInScope"><span class="hs-identifier">extendTvSubstAndInScope</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><a href="GHC.Core.TyCo.Subst.html#getCvSubstEnv"><span class="hs-identifier">getCvSubstEnv</span></a></span><span class="hs-special">,</span><span>
</span><span id="line-94"></span><span>
</span><span id="line-95"></span><span>        </span><span class="annot"><span class="hs-comment">-- ** Lifting</span></span><span>
</span><span id="line-96"></span><span>        </span><span class="annot"><a href="GHC.Core.Coercion.html#liftCoSubst"><span class="hs-identifier">liftCoSubst</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><a href="GHC.Core.Coercion.html#liftCoSubstTyVar"><span class="hs-identifier">liftCoSubstTyVar</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><a href="GHC.Core.Coercion.html#liftCoSubstWith"><span class="hs-identifier">liftCoSubstWith</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><a href="GHC.Core.Coercion.html#liftCoSubstWithEx"><span class="hs-identifier">liftCoSubstWithEx</span></a></span><span class="hs-special">,</span><span>
</span><span id="line-97"></span><span>        </span><span class="annot"><a href="GHC.Core.Coercion.html#emptyLiftingContext"><span class="hs-identifier">emptyLiftingContext</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><a href="GHC.Core.Coercion.html#extendLiftingContext"><span class="hs-identifier">extendLiftingContext</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><a href="GHC.Core.Coercion.html#extendLiftingContextAndInScope"><span class="hs-identifier">extendLiftingContextAndInScope</span></a></span><span class="hs-special">,</span><span>
</span><span id="line-98"></span><span>        </span><span class="annot"><a href="GHC.Core.Coercion.html#liftCoSubstVarBndrUsing"><span class="hs-identifier">liftCoSubstVarBndrUsing</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><a href="GHC.Core.Coercion.html#isMappedByLC"><span class="hs-identifier">isMappedByLC</span></a></span><span class="hs-special">,</span><span>
</span><span id="line-99"></span><span>
</span><span id="line-100"></span><span>        </span><span class="annot"><a href="GHC.Core.Coercion.html#mkSubstLiftingContext"><span class="hs-identifier">mkSubstLiftingContext</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><a href="GHC.Core.Coercion.html#zapLiftingContext"><span class="hs-identifier">zapLiftingContext</span></a></span><span class="hs-special">,</span><span>
</span><span id="line-101"></span><span>        </span><span class="annot"><a href="GHC.Core.Coercion.html#substForAllCoBndrUsingLC"><span class="hs-identifier">substForAllCoBndrUsingLC</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><a href="GHC.Core.Coercion.html#lcTCvSubst"><span class="hs-identifier">lcTCvSubst</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><a href="GHC.Core.Coercion.html#lcInScopeSet"><span class="hs-identifier">lcInScopeSet</span></a></span><span class="hs-special">,</span><span>
</span><span id="line-102"></span><span>
</span><span id="line-103"></span><span>        </span><span class="annot"><a href="GHC.Core.Coercion.html#LiftCoEnv"><span class="hs-identifier">LiftCoEnv</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><a href="GHC.Core.Coercion.html#LiftingContext"><span class="hs-identifier">LiftingContext</span></a></span><span class="hs-special">(</span><span class="hs-glyph">..</span><span class="hs-special">)</span><span class="hs-special">,</span><span> </span><span class="annot"><a href="GHC.Core.Coercion.html#liftEnvSubstLeft"><span class="hs-identifier">liftEnvSubstLeft</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><a href="GHC.Core.Coercion.html#liftEnvSubstRight"><span class="hs-identifier">liftEnvSubstRight</span></a></span><span class="hs-special">,</span><span>
</span><span id="line-104"></span><span>        </span><span class="annot"><a href="GHC.Core.Coercion.html#substRightCo"><span class="hs-identifier">substRightCo</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><a href="GHC.Core.Coercion.html#substLeftCo"><span class="hs-identifier">substLeftCo</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><a href="GHC.Core.Coercion.html#swapLiftCoEnv"><span class="hs-identifier">swapLiftCoEnv</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><a href="GHC.Core.Coercion.html#lcSubstLeft"><span class="hs-identifier">lcSubstLeft</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><a href="GHC.Core.Coercion.html#lcSubstRight"><span class="hs-identifier">lcSubstRight</span></a></span><span class="hs-special">,</span><span>
</span><span id="line-105"></span><span>
</span><span id="line-106"></span><span>        </span><span class="annot"><span class="hs-comment">-- ** Comparison</span></span><span>
</span><span id="line-107"></span><span>        </span><span class="annot"><a href="GHC.Core.Coercion.html#eqCoercion"><span class="hs-identifier">eqCoercion</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><a href="GHC.Core.Coercion.html#eqCoercionX"><span class="hs-identifier">eqCoercionX</span></a></span><span class="hs-special">,</span><span>
</span><span id="line-108"></span><span>
</span><span id="line-109"></span><span>        </span><span class="annot"><span class="hs-comment">-- ** Forcing evaluation of coercions</span></span><span>
</span><span id="line-110"></span><span>        </span><span class="annot"><a href="GHC.Core.Coercion.html#seqCo"><span class="hs-identifier">seqCo</span></a></span><span class="hs-special">,</span><span>
</span><span id="line-111"></span><span>
</span><span id="line-112"></span><span>        </span><span class="annot"><span class="hs-comment">-- * Pretty-printing</span></span><span>
</span><span id="line-113"></span><span>        </span><span class="annot"><a href="GHC.Core.TyCo.Ppr.html#pprCo"><span class="hs-identifier">pprCo</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><a href="GHC.Core.TyCo.Ppr.html#pprParendCo"><span class="hs-identifier">pprParendCo</span></a></span><span class="hs-special">,</span><span>
</span><span id="line-114"></span><span>        </span><span class="annot"><a href="GHC.Core.Coercion.html#pprCoAxiom"><span class="hs-identifier">pprCoAxiom</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><a href="GHC.Core.Coercion.html#pprCoAxBranch"><span class="hs-identifier">pprCoAxBranch</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><a href="GHC.Core.Coercion.html#pprCoAxBranchLHS"><span class="hs-identifier">pprCoAxBranchLHS</span></a></span><span class="hs-special">,</span><span>
</span><span id="line-115"></span><span>        </span><span class="annot"><a href="GHC.Core.Coercion.html#pprCoAxBranchUser"><span class="hs-identifier">pprCoAxBranchUser</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><a href="GHC.Core.Coercion.html#tidyCoAxBndrsForUser"><span class="hs-identifier">tidyCoAxBndrsForUser</span></a></span><span class="hs-special">,</span><span>
</span><span id="line-116"></span><span>        </span><span class="annot"><a href="GHC.Core.Coercion.html#etaExpandCoAxBranch"><span class="hs-identifier">etaExpandCoAxBranch</span></a></span><span class="hs-special">,</span><span>
</span><span id="line-117"></span><span>
</span><span id="line-118"></span><span>        </span><span class="annot"><span class="hs-comment">-- * Tidying</span></span><span>
</span><span id="line-119"></span><span>        </span><span class="annot"><a href="GHC.Core.TyCo.Tidy.html#tidyCo"><span class="hs-identifier">tidyCo</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><a href="GHC.Core.TyCo.Tidy.html#tidyCos"><span class="hs-identifier">tidyCos</span></a></span><span class="hs-special">,</span><span>
</span><span id="line-120"></span><span>
</span><span id="line-121"></span><span>        </span><span class="annot"><span class="hs-comment">-- * Other</span></span><span>
</span><span id="line-122"></span><span>        </span><span class="annot"><a href="GHC.Core.Coercion.html#promoteCoercion"><span class="hs-identifier">promoteCoercion</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><a href="GHC.Core.Coercion.html#buildCoercion"><span class="hs-identifier">buildCoercion</span></a></span><span class="hs-special">,</span><span>
</span><span id="line-123"></span><span>
</span><span id="line-124"></span><span>        </span><span class="annot"><a href="GHC.Core.Coercion.html#multToCo"><span class="hs-identifier">multToCo</span></a></span><span class="hs-special">,</span><span>
</span><span id="line-125"></span><span>
</span><span id="line-126"></span><span>        </span><span class="annot"><a href="GHC.Core.Coercion.html#simplifyArgsWorker"><span class="hs-identifier">simplifyArgsWorker</span></a></span><span class="hs-special">,</span><span>
</span><span id="line-127"></span><span>
</span><span id="line-128"></span><span>        </span><span class="annot"><a href="GHC.Core.Coercion.html#hasCoercionHoleTy"><span class="hs-identifier">hasCoercionHoleTy</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><a href="GHC.Core.Coercion.html#hasCoercionHoleCo"><span class="hs-identifier">hasCoercionHoleCo</span></a></span><span class="hs-special">,</span><span>
</span><span id="line-129"></span><span>        </span><span class="annot"><a href="GHC.Core.Coercion.html#HoleSet"><span class="hs-identifier">HoleSet</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><a href="GHC.Core.Coercion.html#coercionHolesOfType"><span class="hs-identifier">coercionHolesOfType</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><a href="GHC.Core.Coercion.html#coercionHolesOfCo"><span class="hs-identifier">coercionHolesOfCo</span></a></span><span>
</span><span id="line-130"></span><span>       </span><span class="hs-special">)</span><span> </span><span class="hs-keyword">where</span><span class="hs-cpp">

#include &quot;HsVersions.h&quot;
</span><span>
</span><span id="line-134"></span><span class="hs-keyword">import</span><span> </span><span class="hs-pragma">{-# SOURCE</span><span> </span><span class="hs-pragma">#-}</span><span> </span><span class="annot"><a href="GHC.CoreToIface.html"><span class="hs-identifier">GHC.CoreToIface</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="GHC.CoreToIface.html#toIfaceTyCon"><span class="hs-identifier">toIfaceTyCon</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><a href="GHC.CoreToIface.html#tidyToIfaceTcArgs"><span class="hs-identifier">tidyToIfaceTcArgs</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-135"></span><span>
</span><span id="line-136"></span><span class="hs-keyword">import</span><span> </span><span class="annot"><a href="GHC.Prelude.html"><span class="hs-identifier">GHC.Prelude</span></a></span><span>
</span><span id="line-137"></span><span>
</span><span id="line-138"></span><span class="hs-keyword">import</span><span> </span><span class="annot"><a href="GHC.Iface.Type.html"><span class="hs-identifier">GHC.Iface.Type</span></a></span><span>
</span><span id="line-139"></span><span class="hs-keyword">import</span><span> </span><span class="annot"><a href="GHC.Core.TyCo.Rep.html"><span class="hs-identifier">GHC.Core.TyCo.Rep</span></a></span><span>
</span><span id="line-140"></span><span class="hs-keyword">import</span><span> </span><span class="annot"><a href="GHC.Core.TyCo.FVs.html"><span class="hs-identifier">GHC.Core.TyCo.FVs</span></a></span><span>
</span><span id="line-141"></span><span class="hs-keyword">import</span><span> </span><span class="annot"><a href="GHC.Core.TyCo.Ppr.html"><span class="hs-identifier">GHC.Core.TyCo.Ppr</span></a></span><span>
</span><span id="line-142"></span><span class="hs-keyword">import</span><span> </span><span class="annot"><a href="GHC.Core.TyCo.Subst.html"><span class="hs-identifier">GHC.Core.TyCo.Subst</span></a></span><span>
</span><span id="line-143"></span><span class="hs-keyword">import</span><span> </span><span class="annot"><a href="GHC.Core.TyCo.Tidy.html"><span class="hs-identifier">GHC.Core.TyCo.Tidy</span></a></span><span>
</span><span id="line-144"></span><span class="hs-keyword">import</span><span> </span><span class="annot"><a href="GHC.Core.Type.html"><span class="hs-identifier">GHC.Core.Type</span></a></span><span>
</span><span id="line-145"></span><span class="hs-keyword">import</span><span> </span><span class="annot"><a href="GHC.Core.TyCon.html"><span class="hs-identifier">GHC.Core.TyCon</span></a></span><span>
</span><span id="line-146"></span><span class="hs-keyword">import</span><span> </span><span class="annot"><a href="GHC.Core.TyCon.RecWalk.html"><span class="hs-identifier">GHC.Core.TyCon.RecWalk</span></a></span><span>
</span><span id="line-147"></span><span class="hs-keyword">import</span><span> </span><span class="annot"><a href="GHC.Core.Coercion.Axiom.html"><span class="hs-identifier">GHC.Core.Coercion.Axiom</span></a></span><span>
</span><span id="line-148"></span><span class="hs-keyword">import</span><span> </span><span class="hs-pragma">{-# SOURCE</span><span> </span><span class="hs-pragma">#-}</span><span> </span><span class="annot"><a href="GHC.Core.Utils.html"><span class="hs-identifier">GHC.Core.Utils</span></a></span><span> </span><span class="hs-special">(</span><span> </span><span class="annot"><a href="GHC.Core.Utils.html#mkFunctionType"><span class="hs-identifier">mkFunctionType</span></a></span><span> </span><span class="hs-special">)</span><span>
</span><span id="line-149"></span><span class="hs-keyword">import</span><span> </span><span class="annot"><a href="GHC.Types.Var.html"><span class="hs-identifier">GHC.Types.Var</span></a></span><span>
</span><span id="line-150"></span><span class="hs-keyword">import</span><span> </span><span class="annot"><a href="GHC.Types.Var.Env.html"><span class="hs-identifier">GHC.Types.Var.Env</span></a></span><span>
</span><span id="line-151"></span><span class="hs-keyword">import</span><span> </span><span class="annot"><a href="GHC.Types.Var.Set.html"><span class="hs-identifier">GHC.Types.Var.Set</span></a></span><span>
</span><span id="line-152"></span><span class="hs-keyword">import</span><span> </span><span class="annot"><a href="GHC.Types.Name.html"><span class="hs-identifier">GHC.Types.Name</span></a></span><span> </span><span class="hs-keyword">hiding</span><span> </span><span class="hs-special">(</span><span> </span><span class="annot"><a href="GHC.Types.Name.Occurrence.html#varName"><span class="hs-identifier">varName</span></a></span><span> </span><span class="hs-special">)</span><span>
</span><span id="line-153"></span><span class="hs-keyword">import</span><span> </span><span class="annot"><a href="GHC.Types.Basic.html"><span class="hs-identifier">GHC.Types.Basic</span></a></span><span>
</span><span id="line-154"></span><span class="hs-keyword">import</span><span> </span><span class="annot"><a href="GHC.Types.Unique.html"><span class="hs-identifier">GHC.Types.Unique</span></a></span><span>
</span><span id="line-155"></span><span class="hs-keyword">import</span><span> </span><span class="annot"><a href="GHC.Data.Pair.html"><span class="hs-identifier">GHC.Data.Pair</span></a></span><span>
</span><span id="line-156"></span><span class="hs-keyword">import</span><span> </span><span class="annot"><a href="GHC.Types.SrcLoc.html"><span class="hs-identifier">GHC.Types.SrcLoc</span></a></span><span>
</span><span id="line-157"></span><span class="hs-keyword">import</span><span> </span><span class="annot"><a href="GHC.Builtin.Names.html"><span class="hs-identifier">GHC.Builtin.Names</span></a></span><span>
</span><span id="line-158"></span><span class="hs-keyword">import</span><span> </span><span class="annot"><a href="GHC.Builtin.Types.Prim.html"><span class="hs-identifier">GHC.Builtin.Types.Prim</span></a></span><span>
</span><span id="line-159"></span><span class="hs-keyword">import</span><span> </span><span class="annot"><a href="GHC.Data.List.SetOps.html"><span class="hs-identifier">GHC.Data.List.SetOps</span></a></span><span>
</span><span id="line-160"></span><span class="hs-keyword">import</span><span> </span><span class="annot"><a href="GHC.Data.Maybe.html"><span class="hs-identifier">GHC.Data.Maybe</span></a></span><span>
</span><span id="line-161"></span><span class="hs-keyword">import</span><span> </span><span class="annot"><a href="GHC.Types.Unique.FM.html"><span class="hs-identifier">GHC.Types.Unique.FM</span></a></span><span>
</span><span id="line-162"></span><span class="hs-keyword">import</span><span> </span><span class="annot"><a href="GHC.Types.Unique.Set.html"><span class="hs-identifier">GHC.Types.Unique.Set</span></a></span><span>
</span><span id="line-163"></span><span>
</span><span id="line-164"></span><span class="hs-keyword">import</span><span> </span><span class="annot"><a href="GHC.Utils.Misc.html"><span class="hs-identifier">GHC.Utils.Misc</span></a></span><span>
</span><span id="line-165"></span><span class="hs-keyword">import</span><span> </span><span class="annot"><a href="GHC.Utils.Outputable.html"><span class="hs-identifier">GHC.Utils.Outputable</span></a></span><span>
</span><span id="line-166"></span><span class="hs-keyword">import</span><span> </span><span class="annot"><a href="GHC.Utils.Panic.html"><span class="hs-identifier">GHC.Utils.Panic</span></a></span><span>
</span><span id="line-167"></span><span>
</span><span id="line-168"></span><span class="hs-keyword">import</span><span> </span><span class="annot"><a href="../../base-4.16.4.0/src/Control-Monad.html#"><span class="hs-identifier">Control.Monad</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="../../base-4.16.4.0/src/Control-Monad.html#foldM"><span class="hs-identifier">foldM</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><a href="../../base-4.16.4.0/src/Control-Monad.html#zipWithM"><span class="hs-identifier">zipWithM</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-169"></span><span class="hs-keyword">import</span><span> </span><span class="annot"><a href="../../base-4.16.4.0/src/Data-Function.html#"><span class="hs-identifier">Data.Function</span></a></span><span> </span><span class="hs-special">(</span><span> </span><span class="annot"><a href="../../base-4.16.4.0/src/Data-Function.html#on"><span class="hs-identifier">on</span></a></span><span> </span><span class="hs-special">)</span><span>
</span><span id="line-170"></span><span class="hs-keyword">import</span><span> </span><span class="annot"><a href="../../base-4.16.4.0/src/Data-Char.html#"><span class="hs-identifier">Data.Char</span></a></span><span class="hs-special">(</span><span> </span><span class="annot"><a href="../../base-4.16.4.0/src/GHC-Unicode.html#isDigit"><span class="hs-identifier">isDigit</span></a></span><span> </span><span class="hs-special">)</span><span>
</span><span id="line-171"></span><span class="hs-keyword">import</span><span> </span><span class="hs-keyword">qualified</span><span> </span><span class="annot"><a href="../../base-4.16.4.0/src/Data-Monoid.html#"><span class="hs-identifier">Data.Monoid</span></a></span><span> </span><span class="hs-keyword">as</span><span> </span><span class="annot"><span class="hs-identifier">Monoid</span></span><span>
</span><span id="line-172"></span><span>
</span><span id="line-173"></span><span class="hs-comment">{-
%************************************************************************
%*                                                                      *
     -- The coercion arguments always *precisely* saturate
     -- arity of (that branch of) the CoAxiom.  If there are
     -- any left over, we use AppCo.  See
     -- See [Coercion axioms applied to coercions] in GHC.Core.TyCo.Rep

\subsection{Coercion variables}
%*                                                                      *
%************************************************************************
-}</span><span>
</span><span id="line-185"></span><span>
</span><span id="line-186"></span><span class="annot"><a href="GHC.Core.Coercion.html#coVarName"><span class="hs-identifier hs-type">coVarName</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><a href="GHC.Types.Var.html#CoVar"><span class="hs-identifier hs-type">CoVar</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="GHC.Types.Name.html#Name"><span class="hs-identifier hs-type">Name</span></a></span><span>
</span><span id="line-187"></span><span id="coVarName"><span class="annot"><span class="annottext">coVarName :: CoVar -&gt; Name
</span><a href="GHC.Core.Coercion.html#coVarName"><span class="hs-identifier hs-var hs-var">coVarName</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">CoVar -&gt; Name
</span><a href="GHC.Types.Var.html#varName"><span class="hs-identifier hs-var">varName</span></a></span><span>
</span><span id="line-188"></span><span>
</span><span id="line-189"></span><span class="annot"><a href="GHC.Core.Coercion.html#setCoVarUnique"><span class="hs-identifier hs-type">setCoVarUnique</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><a href="GHC.Types.Var.html#CoVar"><span class="hs-identifier hs-type">CoVar</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="GHC.Types.Unique.html#Unique"><span class="hs-identifier hs-type">Unique</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="GHC.Types.Var.html#CoVar"><span class="hs-identifier hs-type">CoVar</span></a></span><span>
</span><span id="line-190"></span><span id="setCoVarUnique"><span class="annot"><span class="annottext">setCoVarUnique :: CoVar -&gt; Unique -&gt; CoVar
</span><a href="GHC.Core.Coercion.html#setCoVarUnique"><span class="hs-identifier hs-var hs-var">setCoVarUnique</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">CoVar -&gt; Unique -&gt; CoVar
</span><a href="GHC.Types.Var.html#setVarUnique"><span class="hs-identifier hs-var">setVarUnique</span></a></span><span>
</span><span id="line-191"></span><span>
</span><span id="line-192"></span><span class="annot"><a href="GHC.Core.Coercion.html#setCoVarName"><span class="hs-identifier hs-type">setCoVarName</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><a href="GHC.Types.Var.html#CoVar"><span class="hs-identifier hs-type">CoVar</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="GHC.Types.Name.html#Name"><span class="hs-identifier hs-type">Name</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="GHC.Types.Var.html#CoVar"><span class="hs-identifier hs-type">CoVar</span></a></span><span>
</span><span id="line-193"></span><span id="setCoVarName"><span class="annot"><span class="annottext">setCoVarName :: CoVar -&gt; Name -&gt; CoVar
</span><a href="GHC.Core.Coercion.html#setCoVarName"><span class="hs-identifier hs-var hs-var">setCoVarName</span></a></span></span><span>   </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">CoVar -&gt; Name -&gt; CoVar
</span><a href="GHC.Types.Var.html#setVarName"><span class="hs-identifier hs-var">setVarName</span></a></span><span>
</span><span id="line-194"></span><span>
</span><span id="line-195"></span><span class="hs-comment">{-
%************************************************************************
%*                                                                      *
                   Pretty-printing CoAxioms
%*                                                                      *
%************************************************************************

Defined here to avoid module loops. CoAxiom is loaded very early on.

-}</span><span>
</span><span id="line-205"></span><span>
</span><span id="line-206"></span><span class="annot"><a href="GHC.Core.Coercion.html#etaExpandCoAxBranch"><span class="hs-identifier hs-type">etaExpandCoAxBranch</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><a href="GHC.Core.Coercion.Axiom.html#CoAxBranch"><span class="hs-identifier hs-type">CoAxBranch</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-special">(</span><span class="hs-special">[</span><span class="annot"><a href="GHC.Types.Var.html#TyVar"><span class="hs-identifier hs-type">TyVar</span></a></span><span class="hs-special">]</span><span class="hs-special">,</span><span> </span><span class="hs-special">[</span><span class="annot"><a href="GHC.Core.TyCo.Rep.html#Type"><span class="hs-identifier hs-type">Type</span></a></span><span class="hs-special">]</span><span class="hs-special">,</span><span> </span><span class="annot"><a href="GHC.Core.TyCo.Rep.html#Type"><span class="hs-identifier hs-type">Type</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-207"></span><span class="hs-comment">-- Return the (tvs,lhs,rhs) after eta-expanding,</span><span>
</span><span id="line-208"></span><span class="hs-comment">-- to the way in which the axiom was originally written</span><span>
</span><span id="line-209"></span><span class="hs-comment">-- See Note [Eta reduction for data families] in GHC.Core.Coercion.Axiom</span><span>
</span><span id="line-210"></span><span id="etaExpandCoAxBranch"><span class="annot"><span class="annottext">etaExpandCoAxBranch :: CoAxBranch -&gt; ([CoVar], [Type], Type)
</span><a href="GHC.Core.Coercion.html#etaExpandCoAxBranch"><span class="hs-identifier hs-var hs-var">etaExpandCoAxBranch</span></a></span></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="GHC.Core.Coercion.Axiom.html#CoAxBranch"><span class="hs-identifier hs-type">CoAxBranch</span></a></span><span> </span><span class="hs-special">{</span><span> </span><span class="annot"><span class="annottext">cab_tvs :: CoAxBranch -&gt; [CoVar]
</span><a href="GHC.Core.Coercion.Axiom.html#cab_tvs"><span class="hs-identifier hs-var">cab_tvs</span></a></span><span> </span><span class="hs-glyph">=</span><span> </span><span id="local-6989586621681035186"><span class="annot"><span class="annottext">[CoVar]
</span><a href="#local-6989586621681035186"><span class="hs-identifier hs-var">tvs</span></a></span></span><span>
</span><span id="line-211"></span><span>                                </span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">cab_eta_tvs :: CoAxBranch -&gt; [CoVar]
</span><a href="GHC.Core.Coercion.Axiom.html#cab_eta_tvs"><span class="hs-identifier hs-var">cab_eta_tvs</span></a></span><span> </span><span class="hs-glyph">=</span><span> </span><span id="local-6989586621681035184"><span class="annot"><span class="annottext">[CoVar]
</span><a href="#local-6989586621681035184"><span class="hs-identifier hs-var">eta_tvs</span></a></span></span><span>
</span><span id="line-212"></span><span>                                </span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">cab_lhs :: CoAxBranch -&gt; [Type]
</span><a href="GHC.Core.Coercion.Axiom.html#cab_lhs"><span class="hs-identifier hs-var">cab_lhs</span></a></span><span> </span><span class="hs-glyph">=</span><span> </span><span id="local-6989586621681035182"><span class="annot"><span class="annottext">[Type]
</span><a href="#local-6989586621681035182"><span class="hs-identifier hs-var">lhs</span></a></span></span><span>
</span><span id="line-213"></span><span>                                </span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">cab_rhs :: CoAxBranch -&gt; Type
</span><a href="GHC.Core.Coercion.Axiom.html#cab_rhs"><span class="hs-identifier hs-var">cab_rhs</span></a></span><span> </span><span class="hs-glyph">=</span><span> </span><span id="local-6989586621681035180"><span class="annot"><span class="annottext">Type
</span><a href="#local-6989586621681035180"><span class="hs-identifier hs-var">rhs</span></a></span></span><span> </span><span class="hs-special">}</span><span class="hs-special">)</span><span>
</span><span id="line-214"></span><span>  </span><span class="hs-comment">-- ToDo: what about eta_cvs?</span><span>
</span><span id="line-215"></span><span>  </span><span class="hs-glyph">=</span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">[CoVar]
</span><a href="#local-6989586621681035186"><span class="hs-identifier hs-var">tvs</span></a></span><span> </span><span class="annot"><span class="annottext">forall a. [a] -&gt; [a] -&gt; [a]
</span><a href="../../base-4.16.4.0/src/GHC-Base.html#%2B%2B"><span class="hs-operator hs-var">++</span></a></span><span> </span><span class="annot"><span class="annottext">[CoVar]
</span><a href="#local-6989586621681035184"><span class="hs-identifier hs-var">eta_tvs</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">[Type]
</span><a href="#local-6989586621681035182"><span class="hs-identifier hs-var">lhs</span></a></span><span> </span><span class="annot"><span class="annottext">forall a. [a] -&gt; [a] -&gt; [a]
</span><a href="../../base-4.16.4.0/src/GHC-Base.html#%2B%2B"><span class="hs-operator hs-var">++</span></a></span><span> </span><span class="annot"><span class="annottext">[Type]
</span><a href="#local-6989586621681035179"><span class="hs-identifier hs-var">eta_tys</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">Type -&gt; [Type] -&gt; Type
</span><a href="GHC.Core.Type.html#mkAppTys"><span class="hs-identifier hs-var">mkAppTys</span></a></span><span> </span><span class="annot"><span class="annottext">Type
</span><a href="#local-6989586621681035180"><span class="hs-identifier hs-var">rhs</span></a></span><span> </span><span class="annot"><span class="annottext">[Type]
</span><a href="#local-6989586621681035179"><span class="hs-identifier hs-var">eta_tys</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-216"></span><span> </span><span class="hs-keyword">where</span><span>
</span><span id="line-217"></span><span>    </span><span id="local-6989586621681035179"><span class="annot"><span class="annottext">eta_tys :: [Type]
</span><a href="#local-6989586621681035179"><span class="hs-identifier hs-var hs-var">eta_tys</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">[CoVar] -&gt; [Type]
</span><a href="GHC.Core.TyCo.Rep.html#mkTyVarTys"><span class="hs-identifier hs-var">mkTyVarTys</span></a></span><span> </span><span class="annot"><span class="annottext">[CoVar]
</span><a href="#local-6989586621681035184"><span class="hs-identifier hs-var">eta_tvs</span></a></span><span>
</span><span id="line-218"></span><span>
</span><span id="line-219"></span><span id="local-6989586621681035776"><span class="annot"><a href="GHC.Core.Coercion.html#pprCoAxiom"><span class="hs-identifier hs-type">pprCoAxiom</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><a href="GHC.Core.Coercion.Axiom.html#CoAxiom"><span class="hs-identifier hs-type">CoAxiom</span></a></span><span> </span><span class="annot"><a href="#local-6989586621681035776"><span class="hs-identifier hs-type">br</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="GHC.Utils.Outputable.html#SDoc"><span class="hs-identifier hs-type">SDoc</span></a></span></span><span>
</span><span id="line-220"></span><span class="hs-comment">-- Used in debug-printing only</span><span>
</span><span id="line-221"></span><span id="pprCoAxiom"><span class="annot"><span class="annottext">pprCoAxiom :: forall (br :: BranchFlag). CoAxiom br -&gt; SDoc
</span><a href="GHC.Core.Coercion.html#pprCoAxiom"><span class="hs-identifier hs-var hs-var">pprCoAxiom</span></a></span></span><span> </span><span id="local-6989586621681035174"><span class="annot"><span class="annottext">ax :: CoAxiom br
</span><a href="#local-6989586621681035174"><span class="hs-identifier hs-var">ax</span></a></span></span><span class="hs-glyph">@</span><span class="hs-special">(</span><span class="annot"><a href="GHC.Core.Coercion.Axiom.html#CoAxiom"><span class="hs-identifier hs-type">CoAxiom</span></a></span><span> </span><span class="hs-special">{</span><span> </span><span class="annot"><span class="annottext">co_ax_tc :: forall (br :: BranchFlag). CoAxiom br -&gt; TyCon
</span><a href="GHC.Core.Coercion.Axiom.html#co_ax_tc"><span class="hs-identifier hs-var">co_ax_tc</span></a></span><span> </span><span class="hs-glyph">=</span><span> </span><span id="local-6989586621681035171"><span class="annot"><span class="annottext">TyCon
</span><a href="#local-6989586621681035171"><span class="hs-identifier hs-var">tc</span></a></span></span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">co_ax_branches :: forall (br :: BranchFlag). CoAxiom br -&gt; Branches br
</span><a href="GHC.Core.Coercion.Axiom.html#co_ax_branches"><span class="hs-identifier hs-var">co_ax_branches</span></a></span><span> </span><span class="hs-glyph">=</span><span> </span><span id="local-6989586621681035169"><span class="annot"><span class="annottext">Branches br
</span><a href="#local-6989586621681035169"><span class="hs-identifier hs-var">branches</span></a></span></span><span> </span><span class="hs-special">}</span><span class="hs-special">)</span><span>
</span><span id="line-222"></span><span>  </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">SDoc -&gt; Int -&gt; SDoc -&gt; SDoc
</span><a href="GHC.Utils.Outputable.html#hang"><span class="hs-identifier hs-var">hang</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">String -&gt; SDoc
</span><a href="GHC.Utils.Outputable.html#text"><span class="hs-identifier hs-var">text</span></a></span><span> </span><span class="annot"><span class="annottext">String
</span><span class="hs-string">&quot;axiom&quot;</span></span><span> </span><span class="annot"><span class="annottext">SDoc -&gt; SDoc -&gt; SDoc
</span><a href="GHC.Utils.Outputable.html#%3C%2B%3E"><span class="hs-operator hs-var">&lt;+&gt;</span></a></span><span> </span><span class="annot"><span class="annottext">forall a. Outputable a =&gt; a -&gt; SDoc
</span><a href="GHC.Utils.Outputable.html#ppr"><span class="hs-identifier hs-var">ppr</span></a></span><span> </span><span class="annot"><span class="annottext">CoAxiom br
</span><a href="#local-6989586621681035174"><span class="hs-identifier hs-var">ax</span></a></span><span> </span><span class="annot"><span class="annottext">SDoc -&gt; SDoc -&gt; SDoc
</span><a href="GHC.Utils.Outputable.html#%3C%2B%3E"><span class="hs-operator hs-var">&lt;+&gt;</span></a></span><span> </span><span class="annot"><span class="annottext">SDoc
</span><a href="GHC.Utils.Outputable.html#dcolon"><span class="hs-identifier hs-var">dcolon</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-223"></span><span>       </span><span class="annot"><span class="annottext">Int
</span><span class="hs-number">2</span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">[SDoc] -&gt; SDoc
</span><a href="GHC.Utils.Outputable.html#vcat"><span class="hs-identifier hs-var">vcat</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">forall a b. (a -&gt; b) -&gt; [a] -&gt; [b]
</span><a href="../../base-4.16.4.0/src/GHC-Base.html#map"><span class="hs-identifier hs-var">map</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">TyCon -&gt; CoAxBranch -&gt; SDoc
</span><a href="GHC.Core.Coercion.html#pprCoAxBranchUser"><span class="hs-identifier hs-var">pprCoAxBranchUser</span></a></span><span> </span><span class="annot"><span class="annottext">TyCon
</span><a href="#local-6989586621681035171"><span class="hs-identifier hs-var">tc</span></a></span><span class="hs-special">)</span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">forall (br :: BranchFlag). Branches br -&gt; [CoAxBranch]
</span><a href="GHC.Core.Coercion.Axiom.html#fromBranches"><span class="hs-identifier hs-var">fromBranches</span></a></span><span> </span><span class="annot"><span class="annottext">Branches br
</span><a href="#local-6989586621681035169"><span class="hs-identifier hs-var">branches</span></a></span><span class="hs-special">)</span><span class="hs-special">)</span><span class="hs-special">)</span><span>
</span><span id="line-224"></span><span>
</span><span id="line-225"></span><span class="annot"><a href="GHC.Core.Coercion.html#pprCoAxBranchUser"><span class="hs-identifier hs-type">pprCoAxBranchUser</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><a href="GHC.Core.TyCon.html#TyCon"><span class="hs-identifier hs-type">TyCon</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="GHC.Core.Coercion.Axiom.html#CoAxBranch"><span class="hs-identifier hs-type">CoAxBranch</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="GHC.Utils.Outputable.html#SDoc"><span class="hs-identifier hs-type">SDoc</span></a></span><span>
</span><span id="line-226"></span><span class="hs-comment">-- Used when printing injectivity errors (FamInst.reportInjectivityErrors)</span><span>
</span><span id="line-227"></span><span class="hs-comment">-- and inaccessible branches (GHC.Tc.Validity.inaccessibleCoAxBranch)</span><span>
</span><span id="line-228"></span><span class="hs-comment">-- This happens in error messages: don't print the RHS of a data</span><span>
</span><span id="line-229"></span><span class="hs-comment">--   family axiom, which is meaningless to a user</span><span>
</span><span id="line-230"></span><span id="pprCoAxBranchUser"><span class="annot"><span class="annottext">pprCoAxBranchUser :: TyCon -&gt; CoAxBranch -&gt; SDoc
</span><a href="GHC.Core.Coercion.html#pprCoAxBranchUser"><span class="hs-identifier hs-var hs-var">pprCoAxBranchUser</span></a></span></span><span> </span><span id="local-6989586621681035161"><span class="annot"><span class="annottext">TyCon
</span><a href="#local-6989586621681035161"><span class="hs-identifier hs-var">tc</span></a></span></span><span> </span><span id="local-6989586621681035160"><span class="annot"><span class="annottext">CoAxBranch
</span><a href="#local-6989586621681035160"><span class="hs-identifier hs-var">br</span></a></span></span><span>
</span><span id="line-231"></span><span>  </span><span class="hs-glyph">|</span><span> </span><span class="annot"><span class="annottext">TyCon -&gt; Bool
</span><a href="GHC.Core.TyCon.html#isDataFamilyTyCon"><span class="hs-identifier hs-var">isDataFamilyTyCon</span></a></span><span> </span><span class="annot"><span class="annottext">TyCon
</span><a href="#local-6989586621681035161"><span class="hs-identifier hs-var">tc</span></a></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">TyCon -&gt; CoAxBranch -&gt; SDoc
</span><a href="GHC.Core.Coercion.html#pprCoAxBranchLHS"><span class="hs-identifier hs-var">pprCoAxBranchLHS</span></a></span><span> </span><span class="annot"><span class="annottext">TyCon
</span><a href="#local-6989586621681035161"><span class="hs-identifier hs-var">tc</span></a></span><span> </span><span class="annot"><span class="annottext">CoAxBranch
</span><a href="#local-6989586621681035160"><span class="hs-identifier hs-var">br</span></a></span><span>
</span><span id="line-232"></span><span>  </span><span class="hs-glyph">|</span><span> </span><span class="annot"><span class="annottext">Bool
</span><a href="../../base-4.16.4.0/src/GHC-Base.html#otherwise"><span class="hs-identifier hs-var">otherwise</span></a></span><span>            </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">TyCon -&gt; CoAxBranch -&gt; SDoc
</span><a href="GHC.Core.Coercion.html#pprCoAxBranch"><span class="hs-identifier hs-var">pprCoAxBranch</span></a></span><span>    </span><span class="annot"><span class="annottext">TyCon
</span><a href="#local-6989586621681035161"><span class="hs-identifier hs-var">tc</span></a></span><span> </span><span class="annot"><span class="annottext">CoAxBranch
</span><a href="#local-6989586621681035160"><span class="hs-identifier hs-var">br</span></a></span><span>
</span><span id="line-233"></span><span>
</span><span id="line-234"></span><span class="annot"><a href="GHC.Core.Coercion.html#pprCoAxBranchLHS"><span class="hs-identifier hs-type">pprCoAxBranchLHS</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><a href="GHC.Core.TyCon.html#TyCon"><span class="hs-identifier hs-type">TyCon</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="GHC.Core.Coercion.Axiom.html#CoAxBranch"><span class="hs-identifier hs-type">CoAxBranch</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="GHC.Utils.Outputable.html#SDoc"><span class="hs-identifier hs-type">SDoc</span></a></span><span>
</span><span id="line-235"></span><span class="hs-comment">-- Print the family-instance equation when reporting</span><span>
</span><span id="line-236"></span><span class="hs-comment">--   a conflict between equations (FamInst.conflictInstErr)</span><span>
</span><span id="line-237"></span><span class="hs-comment">-- For type families the RHS is important; for data families not so.</span><span>
</span><span id="line-238"></span><span class="hs-comment">--   Indeed for data families the RHS is a mysterious internal</span><span>
</span><span id="line-239"></span><span class="hs-comment">--   type constructor, so we suppress it (#14179)</span><span>
</span><span id="line-240"></span><span class="hs-comment">-- See FamInstEnv Note [Family instance overlap conflicts]</span><span>
</span><span id="line-241"></span><span id="pprCoAxBranchLHS"><span class="annot"><span class="annottext">pprCoAxBranchLHS :: TyCon -&gt; CoAxBranch -&gt; SDoc
</span><a href="GHC.Core.Coercion.html#pprCoAxBranchLHS"><span class="hs-identifier hs-var hs-var">pprCoAxBranchLHS</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">(TidyEnv -&gt; Type -&gt; SDoc) -&gt; TyCon -&gt; CoAxBranch -&gt; SDoc
</span><a href="GHC.Core.Coercion.html#ppr_co_ax_branch"><span class="hs-identifier hs-var">ppr_co_ax_branch</span></a></span><span> </span><span class="annot"><span class="annottext">forall {p} {p}. p -&gt; p -&gt; SDoc
</span><a href="#local-6989586621681035157"><span class="hs-identifier hs-var">pp_rhs</span></a></span><span>
</span><span id="line-242"></span><span>  </span><span class="hs-keyword">where</span><span>
</span><span id="line-243"></span><span>    </span><span id="local-6989586621681035157"><span class="annot"><span class="annottext">pp_rhs :: p -&gt; p -&gt; SDoc
</span><a href="#local-6989586621681035157"><span class="hs-identifier hs-var hs-var">pp_rhs</span></a></span></span><span> </span><span class="annot"><span class="annottext">p
</span><span class="hs-identifier">_</span></span><span> </span><span class="annot"><span class="annottext">p
</span><span class="hs-identifier">_</span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">SDoc
</span><a href="GHC.Utils.Outputable.html#empty"><span class="hs-identifier hs-var">empty</span></a></span><span>
</span><span id="line-244"></span><span>
</span><span id="line-245"></span><span class="annot"><a href="GHC.Core.Coercion.html#pprCoAxBranch"><span class="hs-identifier hs-type">pprCoAxBranch</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><a href="GHC.Core.TyCon.html#TyCon"><span class="hs-identifier hs-type">TyCon</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="GHC.Core.Coercion.Axiom.html#CoAxBranch"><span class="hs-identifier hs-type">CoAxBranch</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="GHC.Utils.Outputable.html#SDoc"><span class="hs-identifier hs-type">SDoc</span></a></span><span>
</span><span id="line-246"></span><span id="pprCoAxBranch"><span class="annot"><span class="annottext">pprCoAxBranch :: TyCon -&gt; CoAxBranch -&gt; SDoc
</span><a href="GHC.Core.Coercion.html#pprCoAxBranch"><span class="hs-identifier hs-var hs-var">pprCoAxBranch</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">(TidyEnv -&gt; Type -&gt; SDoc) -&gt; TyCon -&gt; CoAxBranch -&gt; SDoc
</span><a href="GHC.Core.Coercion.html#ppr_co_ax_branch"><span class="hs-identifier hs-var">ppr_co_ax_branch</span></a></span><span> </span><span class="annot"><span class="annottext">TidyEnv -&gt; Type -&gt; SDoc
</span><a href="#local-6989586621681035155"><span class="hs-identifier hs-var">ppr_rhs</span></a></span><span>
</span><span id="line-247"></span><span>  </span><span class="hs-keyword">where</span><span>
</span><span id="line-248"></span><span>    </span><span id="local-6989586621681035155"><span class="annot"><span class="annottext">ppr_rhs :: TidyEnv -&gt; Type -&gt; SDoc
</span><a href="#local-6989586621681035155"><span class="hs-identifier hs-var hs-var">ppr_rhs</span></a></span></span><span> </span><span id="local-6989586621681035154"><span class="annot"><span class="annottext">TidyEnv
</span><a href="#local-6989586621681035154"><span class="hs-identifier hs-var">env</span></a></span></span><span> </span><span id="local-6989586621681035153"><span class="annot"><span class="annottext">Type
</span><a href="#local-6989586621681035153"><span class="hs-identifier hs-var">rhs</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">SDoc
</span><a href="GHC.Utils.Outputable.html#equals"><span class="hs-identifier hs-var">equals</span></a></span><span> </span><span class="annot"><span class="annottext">SDoc -&gt; SDoc -&gt; SDoc
</span><a href="GHC.Utils.Outputable.html#%3C%2B%3E"><span class="hs-operator hs-var">&lt;+&gt;</span></a></span><span> </span><span class="annot"><span class="annottext">TidyEnv -&gt; PprPrec -&gt; Type -&gt; SDoc
</span><a href="GHC.Core.TyCo.Ppr.html#pprPrecTypeX"><span class="hs-identifier hs-var">pprPrecTypeX</span></a></span><span> </span><span class="annot"><span class="annottext">TidyEnv
</span><a href="#local-6989586621681035154"><span class="hs-identifier hs-var">env</span></a></span><span> </span><span class="annot"><span class="annottext">PprPrec
</span><a href="GHC.Types.Basic.html#topPrec"><span class="hs-identifier hs-var">topPrec</span></a></span><span> </span><span class="annot"><span class="annottext">Type
</span><a href="#local-6989586621681035153"><span class="hs-identifier hs-var">rhs</span></a></span><span>
</span><span id="line-249"></span><span>
</span><span id="line-250"></span><span class="annot"><a href="GHC.Core.Coercion.html#ppr_co_ax_branch"><span class="hs-identifier hs-type">ppr_co_ax_branch</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="hs-special">(</span><span class="annot"><a href="GHC.Types.Var.Env.html#TidyEnv"><span class="hs-identifier hs-type">TidyEnv</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="GHC.Core.TyCo.Rep.html#Type"><span class="hs-identifier hs-type">Type</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="GHC.Utils.Outputable.html#SDoc"><span class="hs-identifier hs-type">SDoc</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-251"></span><span>                 </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="GHC.Core.TyCon.html#TyCon"><span class="hs-identifier hs-type">TyCon</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="GHC.Core.Coercion.Axiom.html#CoAxBranch"><span class="hs-identifier hs-type">CoAxBranch</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="GHC.Utils.Outputable.html#SDoc"><span class="hs-identifier hs-type">SDoc</span></a></span><span>
</span><span id="line-252"></span><span id="ppr_co_ax_branch"><span class="annot"><span class="annottext">ppr_co_ax_branch :: (TidyEnv -&gt; Type -&gt; SDoc) -&gt; TyCon -&gt; CoAxBranch -&gt; SDoc
</span><a href="GHC.Core.Coercion.html#ppr_co_ax_branch"><span class="hs-identifier hs-var hs-var">ppr_co_ax_branch</span></a></span></span><span> </span><span id="local-6989586621681035149"><span class="annot"><span class="annottext">TidyEnv -&gt; Type -&gt; SDoc
</span><a href="#local-6989586621681035149"><span class="hs-identifier hs-var">ppr_rhs</span></a></span></span><span> </span><span id="local-6989586621681035148"><span class="annot"><span class="annottext">TyCon
</span><a href="#local-6989586621681035148"><span class="hs-identifier hs-var">fam_tc</span></a></span></span><span> </span><span id="local-6989586621681035147"><span class="annot"><span class="annottext">CoAxBranch
</span><a href="#local-6989586621681035147"><span class="hs-identifier hs-var">branch</span></a></span></span><span>
</span><span id="line-253"></span><span>  </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">forall (t :: * -&gt; *) a. Foldable t =&gt; (a -&gt; a -&gt; a) -&gt; t a -&gt; a
</span><a href="../../base-4.16.4.0/src/Data-Foldable.html#foldr1"><span class="hs-identifier hs-var">foldr1</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">forall a b c. (a -&gt; b -&gt; c) -&gt; b -&gt; a -&gt; c
</span><a href="../../base-4.16.4.0/src/GHC-Base.html#flip"><span class="hs-identifier hs-var">flip</span></a></span><span> </span><span class="annot"><span class="annottext">SDoc -&gt; Int -&gt; SDoc -&gt; SDoc
</span><a href="GHC.Utils.Outputable.html#hangNotEmpty"><span class="hs-identifier hs-var">hangNotEmpty</span></a></span><span> </span><span class="annot"><span class="annottext">Int
</span><span class="hs-number">2</span></span><span class="hs-special">)</span><span>
</span><span id="line-254"></span><span>    </span><span class="hs-special">[</span><span> </span><span class="annot"><span class="annottext">[TyCoVarBinder] -&gt; SDoc
</span><a href="GHC.Core.TyCo.Ppr.html#pprUserForAll"><span class="hs-identifier hs-var">pprUserForAll</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">forall vis. vis -&gt; [CoVar] -&gt; [VarBndr CoVar vis]
</span><a href="GHC.Types.Var.html#mkTyCoVarBinders"><span class="hs-identifier hs-var">mkTyCoVarBinders</span></a></span><span> </span><span class="annot"><span class="annottext">ArgFlag
</span><a href="GHC.Types.Var.html#Inferred"><span class="hs-identifier hs-var">Inferred</span></a></span><span> </span><span class="annot"><span class="annottext">[CoVar]
</span><a href="#local-6989586621681035140"><span class="hs-identifier hs-var">bndrs'</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-255"></span><span>         </span><span class="hs-comment">-- See Note [Printing foralls in type family instances] in GHC.Iface.Type</span><span>
</span><span id="line-256"></span><span>    </span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">SDoc
</span><a href="#local-6989586621681035139"><span class="hs-identifier hs-var">pp_lhs</span></a></span><span> </span><span class="annot"><span class="annottext">SDoc -&gt; SDoc -&gt; SDoc
</span><a href="GHC.Utils.Outputable.html#%3C%2B%3E"><span class="hs-operator hs-var">&lt;+&gt;</span></a></span><span> </span><span class="annot"><span class="annottext">TidyEnv -&gt; Type -&gt; SDoc
</span><a href="#local-6989586621681035149"><span class="hs-identifier hs-var">ppr_rhs</span></a></span><span> </span><span class="annot"><span class="annottext">TidyEnv
</span><a href="#local-6989586621681035138"><span class="hs-identifier hs-var">tidy_env</span></a></span><span> </span><span class="annot"><span class="annottext">Type
</span><a href="#local-6989586621681035137"><span class="hs-identifier hs-var">ee_rhs</span></a></span><span>
</span><span id="line-257"></span><span>    </span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">String -&gt; SDoc
</span><a href="GHC.Utils.Outputable.html#text"><span class="hs-identifier hs-var">text</span></a></span><span> </span><span class="annot"><span class="annottext">String
</span><span class="hs-string">&quot;-- Defined&quot;</span></span><span> </span><span class="annot"><span class="annottext">SDoc -&gt; SDoc -&gt; SDoc
</span><a href="GHC.Utils.Outputable.html#%3C%2B%3E"><span class="hs-operator hs-var">&lt;+&gt;</span></a></span><span> </span><span class="annot"><span class="annottext">SDoc
</span><a href="#local-6989586621681035136"><span class="hs-identifier hs-var">pp_loc</span></a></span><span> </span><span class="hs-special">]</span><span>
</span><span id="line-258"></span><span>  </span><span class="hs-keyword">where</span><span>
</span><span id="line-259"></span><span>    </span><span id="local-6989586621681035135"><span class="annot"><span class="annottext">loc :: SrcSpan
</span><a href="#local-6989586621681035135"><span class="hs-identifier hs-var hs-var">loc</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">CoAxBranch -&gt; SrcSpan
</span><a href="GHC.Core.Coercion.Axiom.html#coAxBranchSpan"><span class="hs-identifier hs-var">coAxBranchSpan</span></a></span><span> </span><span class="annot"><span class="annottext">CoAxBranch
</span><a href="#local-6989586621681035147"><span class="hs-identifier hs-var">branch</span></a></span><span>
</span><span id="line-260"></span><span>    </span><span id="local-6989586621681035136"><span class="annot"><span class="annottext">pp_loc :: SDoc
</span><a href="#local-6989586621681035136"><span class="hs-identifier hs-var hs-var">pp_loc</span></a></span></span><span> </span><span class="hs-glyph">|</span><span> </span><span class="annot"><span class="annottext">SrcSpan -&gt; Bool
</span><a href="GHC.Types.SrcLoc.html#isGoodSrcSpan"><span class="hs-identifier hs-var">isGoodSrcSpan</span></a></span><span> </span><span class="annot"><span class="annottext">SrcSpan
</span><a href="#local-6989586621681035135"><span class="hs-identifier hs-var">loc</span></a></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">String -&gt; SDoc
</span><a href="GHC.Utils.Outputable.html#text"><span class="hs-identifier hs-var">text</span></a></span><span> </span><span class="annot"><span class="annottext">String
</span><span class="hs-string">&quot;at&quot;</span></span><span> </span><span class="annot"><span class="annottext">SDoc -&gt; SDoc -&gt; SDoc
</span><a href="GHC.Utils.Outputable.html#%3C%2B%3E"><span class="hs-operator hs-var">&lt;+&gt;</span></a></span><span> </span><span class="annot"><span class="annottext">forall a. Outputable a =&gt; a -&gt; SDoc
</span><a href="GHC.Utils.Outputable.html#ppr"><span class="hs-identifier hs-var">ppr</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">SrcSpan -&gt; SrcLoc
</span><a href="GHC.Types.SrcLoc.html#srcSpanStart"><span class="hs-identifier hs-var">srcSpanStart</span></a></span><span> </span><span class="annot"><span class="annottext">SrcSpan
</span><a href="#local-6989586621681035135"><span class="hs-identifier hs-var">loc</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-261"></span><span>           </span><span class="hs-glyph">|</span><span> </span><span class="annot"><span class="annottext">Bool
</span><a href="../../base-4.16.4.0/src/GHC-Base.html#otherwise"><span class="hs-identifier hs-var">otherwise</span></a></span><span>         </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">String -&gt; SDoc
</span><a href="GHC.Utils.Outputable.html#text"><span class="hs-identifier hs-var">text</span></a></span><span> </span><span class="annot"><span class="annottext">String
</span><span class="hs-string">&quot;in&quot;</span></span><span> </span><span class="annot"><span class="annottext">SDoc -&gt; SDoc -&gt; SDoc
</span><a href="GHC.Utils.Outputable.html#%3C%2B%3E"><span class="hs-operator hs-var">&lt;+&gt;</span></a></span><span> </span><span class="annot"><span class="annottext">forall a. Outputable a =&gt; a -&gt; SDoc
</span><a href="GHC.Utils.Outputable.html#ppr"><span class="hs-identifier hs-var">ppr</span></a></span><span> </span><span class="annot"><span class="annottext">SrcSpan
</span><a href="#local-6989586621681035135"><span class="hs-identifier hs-var">loc</span></a></span><span>
</span><span id="line-262"></span><span>
</span><span id="line-263"></span><span>    </span><span class="hs-comment">-- Eta-expand LHS and RHS types, because sometimes data family</span><span>
</span><span id="line-264"></span><span>    </span><span class="hs-comment">-- instances are eta-reduced.</span><span>
</span><span id="line-265"></span><span>    </span><span class="hs-comment">-- See Note [Eta reduction for data families] in GHC.Core.Coercion.Axiom.</span><span>
</span><span id="line-266"></span><span>    </span><span class="hs-special">(</span><span id="local-6989586621681035131"><span class="annot"><span class="annottext">[CoVar]
</span><a href="#local-6989586621681035131"><span class="hs-identifier hs-var">ee_tvs</span></a></span></span><span class="hs-special">,</span><span> </span><span id="local-6989586621681035130"><span class="annot"><span class="annottext">[Type]
</span><a href="#local-6989586621681035130"><span class="hs-identifier hs-var">ee_lhs</span></a></span></span><span class="hs-special">,</span><span> </span><span id="local-6989586621681035137"><span class="annot"><span class="annottext">Type
</span><a href="#local-6989586621681035137"><span class="hs-identifier hs-var">ee_rhs</span></a></span></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">CoAxBranch -&gt; ([CoVar], [Type], Type)
</span><a href="GHC.Core.Coercion.html#etaExpandCoAxBranch"><span class="hs-identifier hs-var">etaExpandCoAxBranch</span></a></span><span> </span><span class="annot"><span class="annottext">CoAxBranch
</span><a href="#local-6989586621681035147"><span class="hs-identifier hs-var">branch</span></a></span><span>
</span><span id="line-267"></span><span>
</span><span id="line-268"></span><span>    </span><span id="local-6989586621681035139"><span class="annot"><span class="annottext">pp_lhs :: SDoc
</span><a href="#local-6989586621681035139"><span class="hs-identifier hs-var hs-var">pp_lhs</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">PprPrec -&gt; IfaceTyCon -&gt; IfaceAppArgs -&gt; SDoc
</span><a href="GHC.Iface.Type.html#pprIfaceTypeApp"><span class="hs-identifier hs-var">pprIfaceTypeApp</span></a></span><span> </span><span class="annot"><span class="annottext">PprPrec
</span><a href="GHC.Types.Basic.html#topPrec"><span class="hs-identifier hs-var">topPrec</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">TyCon -&gt; IfaceTyCon
</span><a href="GHC.CoreToIface.html#toIfaceTyCon"><span class="hs-identifier hs-var">toIfaceTyCon</span></a></span><span> </span><span class="annot"><span class="annottext">TyCon
</span><a href="#local-6989586621681035148"><span class="hs-identifier hs-var">fam_tc</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-269"></span><span>                             </span><span class="hs-special">(</span><span class="annot"><span class="annottext">TidyEnv -&gt; TyCon -&gt; [Type] -&gt; IfaceAppArgs
</span><a href="GHC.CoreToIface.html#tidyToIfaceTcArgs"><span class="hs-identifier hs-var">tidyToIfaceTcArgs</span></a></span><span> </span><span class="annot"><span class="annottext">TidyEnv
</span><a href="#local-6989586621681035138"><span class="hs-identifier hs-var">tidy_env</span></a></span><span> </span><span class="annot"><span class="annottext">TyCon
</span><a href="#local-6989586621681035148"><span class="hs-identifier hs-var">fam_tc</span></a></span><span> </span><span class="annot"><span class="annottext">[Type]
</span><a href="#local-6989586621681035130"><span class="hs-identifier hs-var">ee_lhs</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-270"></span><span>
</span><span id="line-271"></span><span>    </span><span class="hs-special">(</span><span id="local-6989586621681035138"><span class="annot"><span class="annottext">TidyEnv
</span><a href="#local-6989586621681035138"><span class="hs-identifier hs-var">tidy_env</span></a></span></span><span class="hs-special">,</span><span> </span><span id="local-6989586621681035140"><span class="annot"><span class="annottext">[CoVar]
</span><a href="#local-6989586621681035140"><span class="hs-identifier hs-var">bndrs'</span></a></span></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">TidyEnv -&gt; [CoVar] -&gt; (TidyEnv, [CoVar])
</span><a href="GHC.Core.Coercion.html#tidyCoAxBndrsForUser"><span class="hs-identifier hs-var">tidyCoAxBndrsForUser</span></a></span><span> </span><span class="annot"><span class="annottext">TidyEnv
</span><a href="GHC.Types.Var.Env.html#emptyTidyEnv"><span class="hs-identifier hs-var">emptyTidyEnv</span></a></span><span> </span><span class="annot"><span class="annottext">[CoVar]
</span><a href="#local-6989586621681035131"><span class="hs-identifier hs-var">ee_tvs</span></a></span><span>
</span><span id="line-272"></span><span>
</span><span id="line-273"></span><span class="annot"><a href="GHC.Core.Coercion.html#tidyCoAxBndrsForUser"><span class="hs-identifier hs-type">tidyCoAxBndrsForUser</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><a href="GHC.Types.Var.Env.html#TidyEnv"><span class="hs-identifier hs-type">TidyEnv</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-special">[</span><span class="annot"><a href="GHC.Types.Var.html#Var"><span class="hs-identifier hs-type">Var</span></a></span><span class="hs-special">]</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-special">(</span><span class="annot"><a href="GHC.Types.Var.Env.html#TidyEnv"><span class="hs-identifier hs-type">TidyEnv</span></a></span><span class="hs-special">,</span><span> </span><span class="hs-special">[</span><span class="annot"><a href="GHC.Types.Var.html#Var"><span class="hs-identifier hs-type">Var</span></a></span><span class="hs-special">]</span><span class="hs-special">)</span><span>
</span><span id="line-274"></span><span class="hs-comment">-- Tidy wildcards &quot;_1&quot;, &quot;_2&quot; to &quot;_&quot;, and do not return them</span><span>
</span><span id="line-275"></span><span class="hs-comment">-- in the list of binders to be printed</span><span>
</span><span id="line-276"></span><span class="hs-comment">-- This is so that in error messages we see</span><span>
</span><span id="line-277"></span><span class="hs-comment">--     forall a. F _ [a] _ = ...</span><span>
</span><span id="line-278"></span><span class="hs-comment">-- rather than</span><span>
</span><span id="line-279"></span><span class="hs-comment">--     forall a _1 _2. F _1 [a] _2 = ...</span><span>
</span><span id="line-280"></span><span class="hs-comment">--</span><span>
</span><span id="line-281"></span><span class="hs-comment">-- This is a rather disgusting function</span><span>
</span><span id="line-282"></span><span class="hs-comment">-- See Note [Wildcard names] in GHC.Tc.Gen.HsType</span><span>
</span><span id="line-283"></span><span id="tidyCoAxBndrsForUser"><span class="annot"><span class="annottext">tidyCoAxBndrsForUser :: TidyEnv -&gt; [CoVar] -&gt; (TidyEnv, [CoVar])
</span><a href="GHC.Core.Coercion.html#tidyCoAxBndrsForUser"><span class="hs-identifier hs-var hs-var">tidyCoAxBndrsForUser</span></a></span></span><span> </span><span id="local-6989586621681035127"><span class="annot"><span class="annottext">TidyEnv
</span><a href="#local-6989586621681035127"><span class="hs-identifier hs-var">init_env</span></a></span></span><span> </span><span id="local-6989586621681035126"><span class="annot"><span class="annottext">[CoVar]
</span><a href="#local-6989586621681035126"><span class="hs-identifier hs-var">tcvs</span></a></span></span><span>
</span><span id="line-284"></span><span>  </span><span class="hs-glyph">=</span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">TidyEnv
</span><a href="#local-6989586621681035125"><span class="hs-identifier hs-var">tidy_env</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">forall a. [a] -&gt; [a]
</span><a href="../../base-4.16.4.0/src/GHC-List.html#reverse"><span class="hs-identifier hs-var">reverse</span></a></span><span> </span><span class="annot"><span class="annottext">[CoVar]
</span><a href="#local-6989586621681035123"><span class="hs-identifier hs-var">tidy_bndrs</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-285"></span><span>  </span><span class="hs-keyword">where</span><span>
</span><span id="line-286"></span><span>    </span><span class="hs-special">(</span><span id="local-6989586621681035125"><span class="annot"><span class="annottext">TidyEnv
</span><a href="#local-6989586621681035125"><span class="hs-identifier hs-var">tidy_env</span></a></span></span><span class="hs-special">,</span><span> </span><span id="local-6989586621681035123"><span class="annot"><span class="annottext">[CoVar]
</span><a href="#local-6989586621681035123"><span class="hs-identifier hs-var">tidy_bndrs</span></a></span></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">forall (t :: * -&gt; *) b a.
Foldable t =&gt;
(b -&gt; a -&gt; b) -&gt; b -&gt; t a -&gt; b
</span><a href="../../base-4.16.4.0/src/Data-Foldable.html#foldl"><span class="hs-identifier hs-var">foldl</span></a></span><span> </span><span class="annot"><span class="annottext">(TidyEnv, [CoVar]) -&gt; CoVar -&gt; (TidyEnv, [CoVar])
</span><a href="#local-6989586621681035121"><span class="hs-identifier hs-var">tidy_one</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">TidyEnv
</span><a href="#local-6989586621681035127"><span class="hs-identifier hs-var">init_env</span></a></span><span class="hs-special">,</span><span> </span><span class="hs-special">[</span><span class="hs-special">]</span><span class="hs-special">)</span><span> </span><span class="annot"><span class="annottext">[CoVar]
</span><a href="#local-6989586621681035126"><span class="hs-identifier hs-var">tcvs</span></a></span><span>
</span><span id="line-287"></span><span>
</span><span id="line-288"></span><span>    </span><span id="local-6989586621681035121"><span class="annot"><span class="annottext">tidy_one :: (TidyEnv, [CoVar]) -&gt; CoVar -&gt; (TidyEnv, [CoVar])
</span><a href="#local-6989586621681035121"><span class="hs-identifier hs-var hs-var">tidy_one</span></a></span></span><span> </span><span class="hs-special">(</span><span id="local-6989586621681035120"><span class="annot"><span class="annottext">env :: TidyEnv
</span><a href="#local-6989586621681035120"><span class="hs-identifier hs-var">env</span></a></span></span><span class="hs-glyph">@</span><span class="hs-special">(</span><span id="local-6989586621681035119"><span class="annot"><span class="annottext">TidyOccEnv
</span><a href="#local-6989586621681035119"><span class="hs-identifier hs-var">occ_env</span></a></span></span><span class="hs-special">,</span><span> </span><span id="local-6989586621681035118"><span class="annot"><span class="annottext">VarEnv CoVar
</span><a href="#local-6989586621681035118"><span class="hs-identifier hs-var">subst</span></a></span></span><span class="hs-special">)</span><span class="hs-special">,</span><span> </span><span id="local-6989586621681035117"><span class="annot"><span class="annottext">[CoVar]
</span><a href="#local-6989586621681035117"><span class="hs-identifier hs-var">rev_bndrs'</span></a></span></span><span class="hs-special">)</span><span> </span><span id="local-6989586621681035116"><span class="annot"><span class="annottext">CoVar
</span><a href="#local-6989586621681035116"><span class="hs-identifier hs-var">bndr</span></a></span></span><span>
</span><span id="line-289"></span><span>      </span><span class="hs-glyph">|</span><span> </span><span class="annot"><span class="annottext">CoVar -&gt; Bool
</span><a href="#local-6989586621681035115"><span class="hs-identifier hs-var">is_wildcard</span></a></span><span> </span><span class="annot"><span class="annottext">CoVar
</span><a href="#local-6989586621681035116"><span class="hs-identifier hs-var">bndr</span></a></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">TidyEnv
</span><a href="#local-6989586621681035114"><span class="hs-identifier hs-var">env_wild</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">[CoVar]
</span><a href="#local-6989586621681035117"><span class="hs-identifier hs-var">rev_bndrs'</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-290"></span><span>      </span><span class="hs-glyph">|</span><span> </span><span class="annot"><span class="annottext">Bool
</span><a href="../../base-4.16.4.0/src/GHC-Base.html#otherwise"><span class="hs-identifier hs-var">otherwise</span></a></span><span>        </span><span class="hs-glyph">=</span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">TidyEnv
</span><a href="#local-6989586621681035113"><span class="hs-identifier hs-var">env'</span></a></span><span class="hs-special">,</span><span>     </span><span class="annot"><span class="annottext">CoVar
</span><a href="#local-6989586621681035112"><span class="hs-identifier hs-var">bndr'</span></a></span><span> </span><span class="annot"><span class="annottext">forall a. a -&gt; [a] -&gt; [a]
</span><span class="hs-glyph hs-var">:</span></span><span> </span><span class="annot"><span class="annottext">[CoVar]
</span><a href="#local-6989586621681035117"><span class="hs-identifier hs-var">rev_bndrs'</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-291"></span><span>      </span><span class="hs-keyword">where</span><span>
</span><span id="line-292"></span><span>        </span><span class="hs-special">(</span><span id="local-6989586621681035113"><span class="annot"><span class="annottext">TidyEnv
</span><a href="#local-6989586621681035113"><span class="hs-identifier hs-var">env'</span></a></span></span><span class="hs-special">,</span><span> </span><span id="local-6989586621681035112"><span class="annot"><span class="annottext">CoVar
</span><a href="#local-6989586621681035112"><span class="hs-identifier hs-var">bndr'</span></a></span></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">TidyEnv -&gt; CoVar -&gt; (TidyEnv, CoVar)
</span><a href="GHC.Core.TyCo.Tidy.html#tidyVarBndr"><span class="hs-identifier hs-var">tidyVarBndr</span></a></span><span> </span><span class="annot"><span class="annottext">TidyEnv
</span><a href="#local-6989586621681035120"><span class="hs-identifier hs-var">env</span></a></span><span> </span><span class="annot"><span class="annottext">CoVar
</span><a href="#local-6989586621681035116"><span class="hs-identifier hs-var">bndr</span></a></span><span>
</span><span id="line-293"></span><span>        </span><span id="local-6989586621681035114"><span class="annot"><span class="annottext">env_wild :: TidyEnv
</span><a href="#local-6989586621681035114"><span class="hs-identifier hs-var hs-var">env_wild</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">TidyOccEnv
</span><a href="#local-6989586621681035119"><span class="hs-identifier hs-var">occ_env</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">forall a. VarEnv a -&gt; CoVar -&gt; a -&gt; VarEnv a
</span><a href="GHC.Types.Var.Env.html#extendVarEnv"><span class="hs-identifier hs-var">extendVarEnv</span></a></span><span> </span><span class="annot"><span class="annottext">VarEnv CoVar
</span><a href="#local-6989586621681035118"><span class="hs-identifier hs-var">subst</span></a></span><span> </span><span class="annot"><span class="annottext">CoVar
</span><a href="#local-6989586621681035116"><span class="hs-identifier hs-var">bndr</span></a></span><span> </span><span class="annot"><span class="annottext">CoVar
</span><a href="#local-6989586621681035109"><span class="hs-identifier hs-var">wild_bndr</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-294"></span><span>        </span><span id="local-6989586621681035109"><span class="annot"><span class="annottext">wild_bndr :: CoVar
</span><a href="#local-6989586621681035109"><span class="hs-identifier hs-var hs-var">wild_bndr</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">CoVar -&gt; Name -&gt; CoVar
</span><a href="GHC.Types.Var.html#setVarName"><span class="hs-identifier hs-var">setVarName</span></a></span><span> </span><span class="annot"><span class="annottext">CoVar
</span><a href="#local-6989586621681035116"><span class="hs-identifier hs-var">bndr</span></a></span><span> </span><span class="annot"><span class="annottext">forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><a href="../../base-4.16.4.0/src/GHC-Base.html#%24"><span class="hs-operator hs-var">$</span></a></span><span>
</span><span id="line-295"></span><span>                    </span><span class="annot"><span class="annottext">Name -&gt; OccName -&gt; Name
</span><a href="GHC.Types.Name.html#tidyNameOcc"><span class="hs-identifier hs-var">tidyNameOcc</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">CoVar -&gt; Name
</span><a href="GHC.Types.Var.html#varName"><span class="hs-identifier hs-var">varName</span></a></span><span> </span><span class="annot"><span class="annottext">CoVar
</span><a href="#local-6989586621681035116"><span class="hs-identifier hs-var">bndr</span></a></span><span class="hs-special">)</span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">String -&gt; OccName
</span><a href="GHC.Types.Name.Occurrence.html#mkTyVarOcc"><span class="hs-identifier hs-var">mkTyVarOcc</span></a></span><span> </span><span class="annot"><span class="annottext">String
</span><span class="hs-string">&quot;_&quot;</span></span><span class="hs-special">)</span><span>
</span><span id="line-296"></span><span>                    </span><span class="hs-comment">-- Tidy the binder to &quot;_&quot;</span><span>
</span><span id="line-297"></span><span>
</span><span id="line-298"></span><span>    </span><span class="annot"><a href="#local-6989586621681035115"><span class="hs-identifier hs-type">is_wildcard</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><a href="GHC.Types.Var.html#Var"><span class="hs-identifier hs-type">Var</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="hs-identifier hs-type">Bool</span></span><span>
</span><span id="line-299"></span><span>    </span><span id="local-6989586621681035115"><span class="annot"><span class="annottext">is_wildcard :: CoVar -&gt; Bool
</span><a href="#local-6989586621681035115"><span class="hs-identifier hs-var hs-var">is_wildcard</span></a></span></span><span> </span><span id="local-6989586621681035106"><span class="annot"><span class="annottext">CoVar
</span><a href="#local-6989586621681035106"><span class="hs-identifier hs-var">tv</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-keyword">case</span><span> </span><span class="annot"><span class="annottext">OccName -&gt; String
</span><a href="GHC.Types.Name.Occurrence.html#occNameString"><span class="hs-identifier hs-var">occNameString</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">forall a. NamedThing a =&gt; a -&gt; OccName
</span><a href="GHC.Types.Name.html#getOccName"><span class="hs-identifier hs-var">getOccName</span></a></span><span> </span><span class="annot"><span class="annottext">CoVar
</span><a href="#local-6989586621681035106"><span class="hs-identifier hs-var">tv</span></a></span><span class="hs-special">)</span><span> </span><span class="hs-keyword">of</span><span>
</span><span id="line-300"></span><span>                       </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Char
</span><span class="hs-char">'_'</span></span><span> </span><span class="annot"><span class="hs-glyph hs-type">:</span></span><span> </span><span id="local-6989586621681035103"><span class="annot"><span class="annottext">String
</span><a href="#local-6989586621681035103"><span class="hs-identifier hs-var">rest</span></a></span></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="annottext">forall (t :: * -&gt; *) a. Foldable t =&gt; (a -&gt; Bool) -&gt; t a -&gt; Bool
</span><a href="../../base-4.16.4.0/src/Data-Foldable.html#all"><span class="hs-identifier hs-var">all</span></a></span><span> </span><span class="annot"><span class="annottext">Char -&gt; Bool
</span><a href="../../base-4.16.4.0/src/GHC-Unicode.html#isDigit"><span class="hs-identifier hs-var">isDigit</span></a></span><span> </span><span class="annot"><span class="annottext">String
</span><a href="#local-6989586621681035103"><span class="hs-identifier hs-var">rest</span></a></span><span>
</span><span id="line-301"></span><span>                       </span><span class="annot"><span class="annottext">String
</span><span class="hs-identifier">_</span></span><span>            </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="annottext">Bool
</span><span class="hs-identifier hs-var">False</span></span><span>
</span><span id="line-302"></span><span>
</span><span id="line-303"></span><span>
</span><span id="line-304"></span><span class="hs-comment">{- *********************************************************************
*                                                                      *
              MCoercion
*                                                                      *
********************************************************************* -}</span><span>
</span><span id="line-309"></span><span>
</span><span id="line-310"></span><span class="annot"><a href="GHC.Core.Coercion.html#coToMCo"><span class="hs-identifier hs-type">coToMCo</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><a href="GHC.Core.TyCo.Rep.html#Coercion"><span class="hs-identifier hs-type">Coercion</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="GHC.Core.TyCo.Rep.html#MCoercion"><span class="hs-identifier hs-type">MCoercion</span></a></span><span>
</span><span id="line-311"></span><span class="hs-comment">-- Convert a coercion to a MCoercion,</span><span>
</span><span id="line-312"></span><span class="hs-comment">-- It's not clear whether or not isReflexiveCo would be better here</span><span>
</span><span id="line-313"></span><span id="coToMCo"><span class="annot"><span class="annottext">coToMCo :: Coercion -&gt; MCoercion
</span><a href="GHC.Core.Coercion.html#coToMCo"><span class="hs-identifier hs-var hs-var">coToMCo</span></a></span></span><span> </span><span id="local-6989586621681035101"><span class="annot"><span class="annottext">Coercion
</span><a href="#local-6989586621681035101"><span class="hs-identifier hs-var">co</span></a></span></span><span> </span><span class="hs-glyph">|</span><span> </span><span class="annot"><span class="annottext">Coercion -&gt; Bool
</span><a href="GHC.Core.Coercion.html#isReflCo"><span class="hs-identifier hs-var">isReflCo</span></a></span><span> </span><span class="annot"><span class="annottext">Coercion
</span><a href="#local-6989586621681035101"><span class="hs-identifier hs-var">co</span></a></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">MCoercion
</span><a href="GHC.Core.TyCo.Rep.html#MRefl"><span class="hs-identifier hs-var">MRefl</span></a></span><span>
</span><span id="line-314"></span><span>           </span><span class="hs-glyph">|</span><span> </span><span class="annot"><span class="annottext">Bool
</span><a href="../../base-4.16.4.0/src/GHC-Base.html#otherwise"><span class="hs-identifier hs-var">otherwise</span></a></span><span>   </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">Coercion -&gt; MCoercion
</span><a href="GHC.Core.TyCo.Rep.html#MCo"><span class="hs-identifier hs-var">MCo</span></a></span><span> </span><span class="annot"><span class="annottext">Coercion
</span><a href="#local-6989586621681035101"><span class="hs-identifier hs-var">co</span></a></span><span>
</span><span id="line-315"></span><span>
</span><span id="line-316"></span><span class="annot"><a href="GHC.Core.Coercion.html#checkReflexiveMCo"><span class="hs-identifier hs-type">checkReflexiveMCo</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><a href="GHC.Core.TyCo.Rep.html#MCoercion"><span class="hs-identifier hs-type">MCoercion</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="GHC.Core.TyCo.Rep.html#MCoercion"><span class="hs-identifier hs-type">MCoercion</span></a></span><span>
</span><span id="line-317"></span><span id="checkReflexiveMCo"><span class="annot"><span class="annottext">checkReflexiveMCo :: MCoercion -&gt; MCoercion
</span><a href="GHC.Core.Coercion.html#checkReflexiveMCo"><span class="hs-identifier hs-var hs-var">checkReflexiveMCo</span></a></span></span><span> </span><span class="annot"><span class="annottext">MCoercion
</span><a href="GHC.Core.TyCo.Rep.html#MRefl"><span class="hs-identifier hs-var">MRefl</span></a></span><span>                       </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">MCoercion
</span><a href="GHC.Core.TyCo.Rep.html#MRefl"><span class="hs-identifier hs-var">MRefl</span></a></span><span>
</span><span id="line-318"></span><span class="annot"><a href="GHC.Core.Coercion.html#checkReflexiveMCo"><span class="hs-identifier hs-var">checkReflexiveMCo</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="GHC.Core.TyCo.Rep.html#MCo"><span class="hs-identifier hs-type">MCo</span></a></span><span> </span><span id="local-6989586621681035098"><span class="annot"><span class="annottext">Coercion
</span><a href="#local-6989586621681035098"><span class="hs-identifier hs-var">co</span></a></span></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">|</span><span> </span><span class="annot"><span class="annottext">Coercion -&gt; Bool
</span><a href="GHC.Core.Coercion.html#isReflexiveCo"><span class="hs-identifier hs-var">isReflexiveCo</span></a></span><span> </span><span class="annot"><span class="annottext">Coercion
</span><a href="#local-6989586621681035098"><span class="hs-identifier hs-var">co</span></a></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">MCoercion
</span><a href="GHC.Core.TyCo.Rep.html#MRefl"><span class="hs-identifier hs-var">MRefl</span></a></span><span>
</span><span id="line-319"></span><span>                           </span><span class="hs-glyph">|</span><span> </span><span class="annot"><span class="annottext">Bool
</span><a href="../../base-4.16.4.0/src/GHC-Base.html#otherwise"><span class="hs-identifier hs-var">otherwise</span></a></span><span>        </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">Coercion -&gt; MCoercion
</span><a href="GHC.Core.TyCo.Rep.html#MCo"><span class="hs-identifier hs-var">MCo</span></a></span><span> </span><span class="annot"><span class="annottext">Coercion
</span><a href="#local-6989586621681035098"><span class="hs-identifier hs-var">co</span></a></span><span>
</span><span id="line-320"></span><span>
</span><span id="line-321"></span><span class="hs-comment">-- | Tests if this MCoercion is obviously generalized reflexive</span><span>
</span><span id="line-322"></span><span class="hs-comment">-- Guaranteed to work very quickly.</span><span>
</span><span id="line-323"></span><span class="annot"><a href="GHC.Core.Coercion.html#isGReflMCo"><span class="hs-identifier hs-type">isGReflMCo</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><a href="GHC.Core.TyCo.Rep.html#MCoercion"><span class="hs-identifier hs-type">MCoercion</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="hs-identifier hs-type">Bool</span></span><span>
</span><span id="line-324"></span><span id="isGReflMCo"><span class="annot"><span class="annottext">isGReflMCo :: MCoercion -&gt; Bool
</span><a href="GHC.Core.Coercion.html#isGReflMCo"><span class="hs-identifier hs-var hs-var">isGReflMCo</span></a></span></span><span> </span><span class="annot"><span class="annottext">MCoercion
</span><a href="GHC.Core.TyCo.Rep.html#MRefl"><span class="hs-identifier hs-var">MRefl</span></a></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">Bool
</span><span class="hs-identifier hs-var">True</span></span><span>
</span><span id="line-325"></span><span class="annot"><a href="GHC.Core.Coercion.html#isGReflMCo"><span class="hs-identifier hs-var">isGReflMCo</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="GHC.Core.TyCo.Rep.html#MCo"><span class="hs-identifier hs-type">MCo</span></a></span><span> </span><span id="local-6989586621681035097"><span class="annot"><span class="annottext">Coercion
</span><a href="#local-6989586621681035097"><span class="hs-identifier hs-var">co</span></a></span></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">|</span><span> </span><span class="annot"><span class="annottext">Coercion -&gt; Bool
</span><a href="GHC.Core.Coercion.html#isGReflCo"><span class="hs-identifier hs-var">isGReflCo</span></a></span><span> </span><span class="annot"><span class="annottext">Coercion
</span><a href="#local-6989586621681035097"><span class="hs-identifier hs-var">co</span></a></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">Bool
</span><span class="hs-identifier hs-var">True</span></span><span>
</span><span id="line-326"></span><span class="annot"><a href="GHC.Core.Coercion.html#isGReflMCo"><span class="hs-identifier hs-var">isGReflMCo</span></a></span><span> </span><span class="annot"><span class="annottext">MCoercion
</span><span class="hs-identifier">_</span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">Bool
</span><span class="hs-identifier hs-var">False</span></span><span>
</span><span id="line-327"></span><span>
</span><span id="line-328"></span><span class="hs-comment">-- | Make a generalized reflexive coercion</span><span>
</span><span id="line-329"></span><span class="annot"><a href="GHC.Core.Coercion.html#mkGReflCo"><span class="hs-identifier hs-type">mkGReflCo</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><a href="GHC.Core.Coercion.Axiom.html#Role"><span class="hs-identifier hs-type">Role</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="GHC.Core.TyCo.Rep.html#Type"><span class="hs-identifier hs-type">Type</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="GHC.Core.TyCo.Rep.html#MCoercionN"><span class="hs-identifier hs-type">MCoercionN</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="GHC.Core.TyCo.Rep.html#Coercion"><span class="hs-identifier hs-type">Coercion</span></a></span><span>
</span><span id="line-330"></span><span id="mkGReflCo"><span class="annot"><span class="annottext">mkGReflCo :: Role -&gt; Type -&gt; MCoercion -&gt; Coercion
</span><a href="GHC.Core.Coercion.html#mkGReflCo"><span class="hs-identifier hs-var hs-var">mkGReflCo</span></a></span></span><span> </span><span id="local-6989586621681035096"><span class="annot"><span class="annottext">Role
</span><a href="#local-6989586621681035096"><span class="hs-identifier hs-var">r</span></a></span></span><span> </span><span id="local-6989586621681035095"><span class="annot"><span class="annottext">Type
</span><a href="#local-6989586621681035095"><span class="hs-identifier hs-var">ty</span></a></span></span><span> </span><span id="local-6989586621681035094"><span class="annot"><span class="annottext">MCoercion
</span><a href="#local-6989586621681035094"><span class="hs-identifier hs-var">mco</span></a></span></span><span>
</span><span id="line-331"></span><span>  </span><span class="hs-glyph">|</span><span> </span><span class="annot"><span class="annottext">MCoercion -&gt; Bool
</span><a href="GHC.Core.Coercion.html#isGReflMCo"><span class="hs-identifier hs-var">isGReflMCo</span></a></span><span> </span><span class="annot"><span class="annottext">MCoercion
</span><a href="#local-6989586621681035094"><span class="hs-identifier hs-var">mco</span></a></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-keyword">if</span><span> </span><span class="annot"><span class="annottext">Role
</span><a href="#local-6989586621681035096"><span class="hs-identifier hs-var">r</span></a></span><span> </span><span class="annot"><span class="annottext">forall a. Eq a =&gt; a -&gt; a -&gt; Bool
</span><span class="hs-operator hs-var">==</span></span><span> </span><span class="annot"><span class="annottext">Role
</span><a href="GHC.Core.Coercion.Axiom.html#Nominal"><span class="hs-identifier hs-var">Nominal</span></a></span><span> </span><span class="hs-keyword">then</span><span> </span><span class="annot"><span class="annottext">Type -&gt; Coercion
</span><a href="GHC.Core.TyCo.Rep.html#Refl"><span class="hs-identifier hs-var">Refl</span></a></span><span> </span><span class="annot"><span class="annottext">Type
</span><a href="#local-6989586621681035095"><span class="hs-identifier hs-var">ty</span></a></span><span>
</span><span id="line-332"></span><span>                     </span><span class="hs-keyword">else</span><span> </span><span class="annot"><span class="annottext">Role -&gt; Type -&gt; MCoercion -&gt; Coercion
</span><a href="GHC.Core.TyCo.Rep.html#GRefl"><span class="hs-identifier hs-var">GRefl</span></a></span><span> </span><span class="annot"><span class="annottext">Role
</span><a href="#local-6989586621681035096"><span class="hs-identifier hs-var">r</span></a></span><span> </span><span class="annot"><span class="annottext">Type
</span><a href="#local-6989586621681035095"><span class="hs-identifier hs-var">ty</span></a></span><span> </span><span class="annot"><span class="annottext">MCoercion
</span><a href="GHC.Core.TyCo.Rep.html#MRefl"><span class="hs-identifier hs-var">MRefl</span></a></span><span>
</span><span id="line-333"></span><span>  </span><span class="hs-glyph">|</span><span> </span><span class="annot"><span class="annottext">Bool
</span><a href="../../base-4.16.4.0/src/GHC-Base.html#otherwise"><span class="hs-identifier hs-var">otherwise</span></a></span><span>    </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">Role -&gt; Type -&gt; MCoercion -&gt; Coercion
</span><a href="GHC.Core.TyCo.Rep.html#GRefl"><span class="hs-identifier hs-var">GRefl</span></a></span><span> </span><span class="annot"><span class="annottext">Role
</span><a href="#local-6989586621681035096"><span class="hs-identifier hs-var">r</span></a></span><span> </span><span class="annot"><span class="annottext">Type
</span><a href="#local-6989586621681035095"><span class="hs-identifier hs-var">ty</span></a></span><span> </span><span class="annot"><span class="annottext">MCoercion
</span><a href="#local-6989586621681035094"><span class="hs-identifier hs-var">mco</span></a></span><span>
</span><span id="line-334"></span><span>
</span><span id="line-335"></span><span class="hs-comment">-- | Compose two MCoercions via transitivity</span><span>
</span><span id="line-336"></span><span class="annot"><a href="GHC.Core.Coercion.html#mkTransMCo"><span class="hs-identifier hs-type">mkTransMCo</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><a href="GHC.Core.TyCo.Rep.html#MCoercion"><span class="hs-identifier hs-type">MCoercion</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="GHC.Core.TyCo.Rep.html#MCoercion"><span class="hs-identifier hs-type">MCoercion</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="GHC.Core.TyCo.Rep.html#MCoercion"><span class="hs-identifier hs-type">MCoercion</span></a></span><span>
</span><span id="line-337"></span><span id="mkTransMCo"><span class="annot"><span class="annottext">mkTransMCo :: MCoercion -&gt; MCoercion -&gt; MCoercion
</span><a href="GHC.Core.Coercion.html#mkTransMCo"><span class="hs-identifier hs-var hs-var">mkTransMCo</span></a></span></span><span> </span><span class="annot"><span class="annottext">MCoercion
</span><a href="GHC.Core.TyCo.Rep.html#MRefl"><span class="hs-identifier hs-var">MRefl</span></a></span><span>     </span><span id="local-6989586621681035090"><span class="annot"><span class="annottext">MCoercion
</span><a href="#local-6989586621681035090"><span class="hs-identifier hs-var">co2</span></a></span></span><span>       </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">MCoercion
</span><a href="#local-6989586621681035090"><span class="hs-identifier hs-var">co2</span></a></span><span>
</span><span id="line-338"></span><span class="annot"><a href="GHC.Core.Coercion.html#mkTransMCo"><span class="hs-identifier hs-var">mkTransMCo</span></a></span><span> </span><span id="local-6989586621681035089"><span class="annot"><span class="annottext">MCoercion
</span><a href="#local-6989586621681035089"><span class="hs-identifier hs-var">co1</span></a></span></span><span>       </span><span class="annot"><span class="annottext">MCoercion
</span><a href="GHC.Core.TyCo.Rep.html#MRefl"><span class="hs-identifier hs-var">MRefl</span></a></span><span>     </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">MCoercion
</span><a href="#local-6989586621681035089"><span class="hs-identifier hs-var">co1</span></a></span><span>
</span><span id="line-339"></span><span class="annot"><a href="GHC.Core.Coercion.html#mkTransMCo"><span class="hs-identifier hs-var">mkTransMCo</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="GHC.Core.TyCo.Rep.html#MCo"><span class="hs-identifier hs-type">MCo</span></a></span><span> </span><span id="local-6989586621681035088"><span class="annot"><span class="annottext">Coercion
</span><a href="#local-6989586621681035088"><span class="hs-identifier hs-var">co1</span></a></span></span><span class="hs-special">)</span><span> </span><span class="hs-special">(</span><span class="annot"><a href="GHC.Core.TyCo.Rep.html#MCo"><span class="hs-identifier hs-type">MCo</span></a></span><span> </span><span id="local-6989586621681035087"><span class="annot"><span class="annottext">Coercion
</span><a href="#local-6989586621681035087"><span class="hs-identifier hs-var">co2</span></a></span></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">Coercion -&gt; MCoercion
</span><a href="GHC.Core.TyCo.Rep.html#MCo"><span class="hs-identifier hs-var">MCo</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Coercion -&gt; Coercion -&gt; Coercion
</span><a href="GHC.Core.Coercion.html#mkTransCo"><span class="hs-identifier hs-var">mkTransCo</span></a></span><span> </span><span class="annot"><span class="annottext">Coercion
</span><a href="#local-6989586621681035088"><span class="hs-identifier hs-var">co1</span></a></span><span> </span><span class="annot"><span class="annottext">Coercion
</span><a href="#local-6989586621681035087"><span class="hs-identifier hs-var">co2</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-340"></span><span>
</span><span id="line-341"></span><span class="annot"><a href="GHC.Core.Coercion.html#mkTransMCoL"><span class="hs-identifier hs-type">mkTransMCoL</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><a href="GHC.Core.TyCo.Rep.html#MCoercion"><span class="hs-identifier hs-type">MCoercion</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="GHC.Core.TyCo.Rep.html#Coercion"><span class="hs-identifier hs-type">Coercion</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="GHC.Core.TyCo.Rep.html#MCoercion"><span class="hs-identifier hs-type">MCoercion</span></a></span><span>
</span><span id="line-342"></span><span id="mkTransMCoL"><span class="annot"><span class="annottext">mkTransMCoL :: MCoercion -&gt; Coercion -&gt; MCoercion
</span><a href="GHC.Core.Coercion.html#mkTransMCoL"><span class="hs-identifier hs-var hs-var">mkTransMCoL</span></a></span></span><span> </span><span class="annot"><span class="annottext">MCoercion
</span><a href="GHC.Core.TyCo.Rep.html#MRefl"><span class="hs-identifier hs-var">MRefl</span></a></span><span>     </span><span id="local-6989586621681035086"><span class="annot"><span class="annottext">Coercion
</span><a href="#local-6989586621681035086"><span class="hs-identifier hs-var">co2</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">Coercion -&gt; MCoercion
</span><a href="GHC.Core.Coercion.html#coToMCo"><span class="hs-identifier hs-var">coToMCo</span></a></span><span> </span><span class="annot"><span class="annottext">Coercion
</span><a href="#local-6989586621681035086"><span class="hs-identifier hs-var">co2</span></a></span><span>
</span><span id="line-343"></span><span class="annot"><a href="GHC.Core.Coercion.html#mkTransMCoL"><span class="hs-identifier hs-var">mkTransMCoL</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="GHC.Core.TyCo.Rep.html#MCo"><span class="hs-identifier hs-type">MCo</span></a></span><span> </span><span id="local-6989586621681035085"><span class="annot"><span class="annottext">Coercion
</span><a href="#local-6989586621681035085"><span class="hs-identifier hs-var">co1</span></a></span></span><span class="hs-special">)</span><span> </span><span id="local-6989586621681035084"><span class="annot"><span class="annottext">Coercion
</span><a href="#local-6989586621681035084"><span class="hs-identifier hs-var">co2</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">Coercion -&gt; MCoercion
</span><a href="GHC.Core.TyCo.Rep.html#MCo"><span class="hs-identifier hs-var">MCo</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Coercion -&gt; Coercion -&gt; Coercion
</span><a href="GHC.Core.Coercion.html#mkTransCo"><span class="hs-identifier hs-var">mkTransCo</span></a></span><span> </span><span class="annot"><span class="annottext">Coercion
</span><a href="#local-6989586621681035085"><span class="hs-identifier hs-var">co1</span></a></span><span> </span><span class="annot"><span class="annottext">Coercion
</span><a href="#local-6989586621681035084"><span class="hs-identifier hs-var">co2</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-344"></span><span>
</span><span id="line-345"></span><span class="annot"><a href="GHC.Core.Coercion.html#mkTransMCoR"><span class="hs-identifier hs-type">mkTransMCoR</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><a href="GHC.Core.TyCo.Rep.html#Coercion"><span class="hs-identifier hs-type">Coercion</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="GHC.Core.TyCo.Rep.html#MCoercion"><span class="hs-identifier hs-type">MCoercion</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="GHC.Core.TyCo.Rep.html#MCoercion"><span class="hs-identifier hs-type">MCoercion</span></a></span><span>
</span><span id="line-346"></span><span id="mkTransMCoR"><span class="annot"><span class="annottext">mkTransMCoR :: Coercion -&gt; MCoercion -&gt; MCoercion
</span><a href="GHC.Core.Coercion.html#mkTransMCoR"><span class="hs-identifier hs-var hs-var">mkTransMCoR</span></a></span></span><span> </span><span id="local-6989586621681035083"><span class="annot"><span class="annottext">Coercion
</span><a href="#local-6989586621681035083"><span class="hs-identifier hs-var">co1</span></a></span></span><span> </span><span class="annot"><span class="annottext">MCoercion
</span><a href="GHC.Core.TyCo.Rep.html#MRefl"><span class="hs-identifier hs-var">MRefl</span></a></span><span>     </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">Coercion -&gt; MCoercion
</span><a href="GHC.Core.Coercion.html#coToMCo"><span class="hs-identifier hs-var">coToMCo</span></a></span><span> </span><span class="annot"><span class="annottext">Coercion
</span><a href="#local-6989586621681035083"><span class="hs-identifier hs-var">co1</span></a></span><span>
</span><span id="line-347"></span><span class="annot"><a href="GHC.Core.Coercion.html#mkTransMCoR"><span class="hs-identifier hs-var">mkTransMCoR</span></a></span><span> </span><span id="local-6989586621681035082"><span class="annot"><span class="annottext">Coercion
</span><a href="#local-6989586621681035082"><span class="hs-identifier hs-var">co1</span></a></span></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="GHC.Core.TyCo.Rep.html#MCo"><span class="hs-identifier hs-type">MCo</span></a></span><span> </span><span id="local-6989586621681035081"><span class="annot"><span class="annottext">Coercion
</span><a href="#local-6989586621681035081"><span class="hs-identifier hs-var">co2</span></a></span></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">Coercion -&gt; MCoercion
</span><a href="GHC.Core.TyCo.Rep.html#MCo"><span class="hs-identifier hs-var">MCo</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Coercion -&gt; Coercion -&gt; Coercion
</span><a href="GHC.Core.Coercion.html#mkTransCo"><span class="hs-identifier hs-var">mkTransCo</span></a></span><span> </span><span class="annot"><span class="annottext">Coercion
</span><a href="#local-6989586621681035082"><span class="hs-identifier hs-var">co1</span></a></span><span> </span><span class="annot"><span class="annottext">Coercion
</span><a href="#local-6989586621681035081"><span class="hs-identifier hs-var">co2</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-348"></span><span>
</span><span id="line-349"></span><span class="hs-comment">-- | Get the reverse of an 'MCoercion'</span><span>
</span><span id="line-350"></span><span class="annot"><a href="GHC.Core.Coercion.html#mkSymMCo"><span class="hs-identifier hs-type">mkSymMCo</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><a href="GHC.Core.TyCo.Rep.html#MCoercion"><span class="hs-identifier hs-type">MCoercion</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="GHC.Core.TyCo.Rep.html#MCoercion"><span class="hs-identifier hs-type">MCoercion</span></a></span><span>
</span><span id="line-351"></span><span id="mkSymMCo"><span class="annot"><span class="annottext">mkSymMCo :: MCoercion -&gt; MCoercion
</span><a href="GHC.Core.Coercion.html#mkSymMCo"><span class="hs-identifier hs-var hs-var">mkSymMCo</span></a></span></span><span> </span><span class="annot"><span class="annottext">MCoercion
</span><a href="GHC.Core.TyCo.Rep.html#MRefl"><span class="hs-identifier hs-var">MRefl</span></a></span><span>    </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">MCoercion
</span><a href="GHC.Core.TyCo.Rep.html#MRefl"><span class="hs-identifier hs-var">MRefl</span></a></span><span>
</span><span id="line-352"></span><span class="annot"><a href="GHC.Core.Coercion.html#mkSymMCo"><span class="hs-identifier hs-var">mkSymMCo</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="GHC.Core.TyCo.Rep.html#MCo"><span class="hs-identifier hs-type">MCo</span></a></span><span> </span><span id="local-6989586621681035080"><span class="annot"><span class="annottext">Coercion
</span><a href="#local-6989586621681035080"><span class="hs-identifier hs-var">co</span></a></span></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">Coercion -&gt; MCoercion
</span><a href="GHC.Core.TyCo.Rep.html#MCo"><span class="hs-identifier hs-var">MCo</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Coercion -&gt; Coercion
</span><a href="GHC.Core.Coercion.html#mkSymCo"><span class="hs-identifier hs-var">mkSymCo</span></a></span><span> </span><span class="annot"><span class="annottext">Coercion
</span><a href="#local-6989586621681035080"><span class="hs-identifier hs-var">co</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-353"></span><span>
</span><span id="line-354"></span><span class="hs-comment">-- | Cast a type by an 'MCoercion'</span><span>
</span><span id="line-355"></span><span class="annot"><a href="GHC.Core.Coercion.html#mkCastTyMCo"><span class="hs-identifier hs-type">mkCastTyMCo</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><a href="GHC.Core.TyCo.Rep.html#Type"><span class="hs-identifier hs-type">Type</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="GHC.Core.TyCo.Rep.html#MCoercion"><span class="hs-identifier hs-type">MCoercion</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="GHC.Core.TyCo.Rep.html#Type"><span class="hs-identifier hs-type">Type</span></a></span><span>
</span><span id="line-356"></span><span id="mkCastTyMCo"><span class="annot"><span class="annottext">mkCastTyMCo :: Type -&gt; MCoercion -&gt; Type
</span><a href="GHC.Core.Coercion.html#mkCastTyMCo"><span class="hs-identifier hs-var hs-var">mkCastTyMCo</span></a></span></span><span> </span><span id="local-6989586621681035079"><span class="annot"><span class="annottext">Type
</span><a href="#local-6989586621681035079"><span class="hs-identifier hs-var">ty</span></a></span></span><span> </span><span class="annot"><span class="annottext">MCoercion
</span><a href="GHC.Core.TyCo.Rep.html#MRefl"><span class="hs-identifier hs-var">MRefl</span></a></span><span>    </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">Type
</span><a href="#local-6989586621681035079"><span class="hs-identifier hs-var">ty</span></a></span><span>
</span><span id="line-357"></span><span class="annot"><a href="GHC.Core.Coercion.html#mkCastTyMCo"><span class="hs-identifier hs-var">mkCastTyMCo</span></a></span><span> </span><span id="local-6989586621681035078"><span class="annot"><span class="annottext">Type
</span><a href="#local-6989586621681035078"><span class="hs-identifier hs-var">ty</span></a></span></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="GHC.Core.TyCo.Rep.html#MCo"><span class="hs-identifier hs-type">MCo</span></a></span><span> </span><span id="local-6989586621681035077"><span class="annot"><span class="annottext">Coercion
</span><a href="#local-6989586621681035077"><span class="hs-identifier hs-var">co</span></a></span></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">Type
</span><a href="#local-6989586621681035078"><span class="hs-identifier hs-var">ty</span></a></span><span> </span><span class="annot"><span class="annottext">Type -&gt; Coercion -&gt; Type
</span><a href="GHC.Core.Type.html#mkCastTy"><span class="hs-operator hs-var">`mkCastTy`</span></a></span><span> </span><span class="annot"><span class="annottext">Coercion
</span><a href="#local-6989586621681035077"><span class="hs-identifier hs-var">co</span></a></span><span>
</span><span id="line-358"></span><span>
</span><span id="line-359"></span><span class="annot"><a href="GHC.Core.Coercion.html#mkHomoForAllMCo"><span class="hs-identifier hs-type">mkHomoForAllMCo</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><a href="GHC.Types.Var.html#TyCoVar"><span class="hs-identifier hs-type">TyCoVar</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="GHC.Core.TyCo.Rep.html#MCoercion"><span class="hs-identifier hs-type">MCoercion</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="GHC.Core.TyCo.Rep.html#MCoercion"><span class="hs-identifier hs-type">MCoercion</span></a></span><span>
</span><span id="line-360"></span><span id="mkHomoForAllMCo"><span class="annot"><span class="annottext">mkHomoForAllMCo :: CoVar -&gt; MCoercion -&gt; MCoercion
</span><a href="GHC.Core.Coercion.html#mkHomoForAllMCo"><span class="hs-identifier hs-var hs-var">mkHomoForAllMCo</span></a></span></span><span> </span><span class="annot"><span class="annottext">CoVar
</span><span class="hs-identifier">_</span></span><span>   </span><span class="annot"><span class="annottext">MCoercion
</span><a href="GHC.Core.TyCo.Rep.html#MRefl"><span class="hs-identifier hs-var">MRefl</span></a></span><span>    </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">MCoercion
</span><a href="GHC.Core.TyCo.Rep.html#MRefl"><span class="hs-identifier hs-var">MRefl</span></a></span><span>
</span><span id="line-361"></span><span class="annot"><a href="GHC.Core.Coercion.html#mkHomoForAllMCo"><span class="hs-identifier hs-var">mkHomoForAllMCo</span></a></span><span> </span><span id="local-6989586621681035075"><span class="annot"><span class="annottext">CoVar
</span><a href="#local-6989586621681035075"><span class="hs-identifier hs-var">tcv</span></a></span></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="GHC.Core.TyCo.Rep.html#MCo"><span class="hs-identifier hs-type">MCo</span></a></span><span> </span><span id="local-6989586621681035074"><span class="annot"><span class="annottext">Coercion
</span><a href="#local-6989586621681035074"><span class="hs-identifier hs-var">co</span></a></span></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">Coercion -&gt; MCoercion
</span><a href="GHC.Core.TyCo.Rep.html#MCo"><span class="hs-identifier hs-var">MCo</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">[CoVar] -&gt; Coercion -&gt; Coercion
</span><a href="GHC.Core.Coercion.html#mkHomoForAllCos"><span class="hs-identifier hs-var">mkHomoForAllCos</span></a></span><span> </span><span class="hs-special">[</span><span class="annot"><span class="annottext">CoVar
</span><a href="#local-6989586621681035075"><span class="hs-identifier hs-var">tcv</span></a></span><span class="hs-special">]</span><span> </span><span class="annot"><span class="annottext">Coercion
</span><a href="#local-6989586621681035074"><span class="hs-identifier hs-var">co</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-362"></span><span>
</span><span id="line-363"></span><span class="annot"><a href="GHC.Core.Coercion.html#mkPiMCos"><span class="hs-identifier hs-type">mkPiMCos</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="hs-special">[</span><span class="annot"><a href="GHC.Types.Var.html#Var"><span class="hs-identifier hs-type">Var</span></a></span><span class="hs-special">]</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="GHC.Core.TyCo.Rep.html#MCoercion"><span class="hs-identifier hs-type">MCoercion</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="GHC.Core.TyCo.Rep.html#MCoercion"><span class="hs-identifier hs-type">MCoercion</span></a></span><span>
</span><span id="line-364"></span><span id="mkPiMCos"><span class="annot"><span class="annottext">mkPiMCos :: [CoVar] -&gt; MCoercion -&gt; MCoercion
</span><a href="GHC.Core.Coercion.html#mkPiMCos"><span class="hs-identifier hs-var hs-var">mkPiMCos</span></a></span></span><span> </span><span class="annot"><span class="annottext">[CoVar]
</span><span class="hs-identifier">_</span></span><span> </span><span class="annot"><span class="annottext">MCoercion
</span><a href="GHC.Core.TyCo.Rep.html#MRefl"><span class="hs-identifier hs-var">MRefl</span></a></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">MCoercion
</span><a href="GHC.Core.TyCo.Rep.html#MRefl"><span class="hs-identifier hs-var">MRefl</span></a></span><span>
</span><span id="line-365"></span><span class="annot"><a href="GHC.Core.Coercion.html#mkPiMCos"><span class="hs-identifier hs-var">mkPiMCos</span></a></span><span> </span><span id="local-6989586621681035073"><span class="annot"><span class="annottext">[CoVar]
</span><a href="#local-6989586621681035073"><span class="hs-identifier hs-var">vs</span></a></span></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="GHC.Core.TyCo.Rep.html#MCo"><span class="hs-identifier hs-type">MCo</span></a></span><span> </span><span id="local-6989586621681035072"><span class="annot"><span class="annottext">Coercion
</span><a href="#local-6989586621681035072"><span class="hs-identifier hs-var">co</span></a></span></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">Coercion -&gt; MCoercion
</span><a href="GHC.Core.TyCo.Rep.html#MCo"><span class="hs-identifier hs-var">MCo</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Role -&gt; [CoVar] -&gt; Coercion -&gt; Coercion
</span><a href="GHC.Core.Coercion.html#mkPiCos"><span class="hs-identifier hs-var">mkPiCos</span></a></span><span> </span><span class="annot"><span class="annottext">Role
</span><a href="GHC.Core.Coercion.Axiom.html#Representational"><span class="hs-identifier hs-var">Representational</span></a></span><span> </span><span class="annot"><span class="annottext">[CoVar]
</span><a href="#local-6989586621681035073"><span class="hs-identifier hs-var">vs</span></a></span><span> </span><span class="annot"><span class="annottext">Coercion
</span><a href="#local-6989586621681035072"><span class="hs-identifier hs-var">co</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-366"></span><span>
</span><span id="line-367"></span><span class="annot"><a href="GHC.Core.Coercion.html#mkFunResMCo"><span class="hs-identifier hs-type">mkFunResMCo</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><a href="GHC.Core.TyCo.Rep.html#Scaled"><span class="hs-identifier hs-type">Scaled</span></a></span><span> </span><span class="annot"><a href="GHC.Core.TyCo.Rep.html#Type"><span class="hs-identifier hs-type">Type</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="GHC.Core.TyCo.Rep.html#MCoercionR"><span class="hs-identifier hs-type">MCoercionR</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="GHC.Core.TyCo.Rep.html#MCoercionR"><span class="hs-identifier hs-type">MCoercionR</span></a></span><span>
</span><span id="line-368"></span><span id="mkFunResMCo"><span class="annot"><span class="annottext">mkFunResMCo :: Scaled Type -&gt; MCoercion -&gt; MCoercion
</span><a href="GHC.Core.Coercion.html#mkFunResMCo"><span class="hs-identifier hs-var hs-var">mkFunResMCo</span></a></span></span><span> </span><span class="annot"><span class="annottext">Scaled Type
</span><span class="hs-identifier">_</span></span><span>      </span><span class="annot"><span class="annottext">MCoercion
</span><a href="GHC.Core.TyCo.Rep.html#MRefl"><span class="hs-identifier hs-var">MRefl</span></a></span><span>    </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">MCoercion
</span><a href="GHC.Core.TyCo.Rep.html#MRefl"><span class="hs-identifier hs-var">MRefl</span></a></span><span>
</span><span id="line-369"></span><span class="annot"><a href="GHC.Core.Coercion.html#mkFunResMCo"><span class="hs-identifier hs-var">mkFunResMCo</span></a></span><span> </span><span id="local-6989586621681035070"><span class="annot"><span class="annottext">Scaled Type
</span><a href="#local-6989586621681035070"><span class="hs-identifier hs-var">arg_ty</span></a></span></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="GHC.Core.TyCo.Rep.html#MCo"><span class="hs-identifier hs-type">MCo</span></a></span><span> </span><span id="local-6989586621681035069"><span class="annot"><span class="annottext">Coercion
</span><a href="#local-6989586621681035069"><span class="hs-identifier hs-var">co</span></a></span></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">Coercion -&gt; MCoercion
</span><a href="GHC.Core.TyCo.Rep.html#MCo"><span class="hs-identifier hs-var">MCo</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Role -&gt; Scaled Type -&gt; Coercion -&gt; Coercion
</span><a href="GHC.Core.Coercion.html#mkFunResCo"><span class="hs-identifier hs-var">mkFunResCo</span></a></span><span> </span><span class="annot"><span class="annottext">Role
</span><a href="GHC.Core.Coercion.Axiom.html#Representational"><span class="hs-identifier hs-var">Representational</span></a></span><span> </span><span class="annot"><span class="annottext">Scaled Type
</span><a href="#local-6989586621681035070"><span class="hs-identifier hs-var">arg_ty</span></a></span><span> </span><span class="annot"><span class="annottext">Coercion
</span><a href="#local-6989586621681035069"><span class="hs-identifier hs-var">co</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-370"></span><span>
</span><span id="line-371"></span><span class="annot"><a href="GHC.Core.Coercion.html#mkGReflLeftMCo"><span class="hs-identifier hs-type">mkGReflLeftMCo</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><a href="GHC.Core.Coercion.Axiom.html#Role"><span class="hs-identifier hs-type">Role</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="GHC.Core.TyCo.Rep.html#Type"><span class="hs-identifier hs-type">Type</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="GHC.Core.TyCo.Rep.html#MCoercionN"><span class="hs-identifier hs-type">MCoercionN</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="GHC.Core.TyCo.Rep.html#Coercion"><span class="hs-identifier hs-type">Coercion</span></a></span><span>
</span><span id="line-372"></span><span id="mkGReflLeftMCo"><span class="annot"><span class="annottext">mkGReflLeftMCo :: Role -&gt; Type -&gt; MCoercion -&gt; Coercion
</span><a href="GHC.Core.Coercion.html#mkGReflLeftMCo"><span class="hs-identifier hs-var hs-var">mkGReflLeftMCo</span></a></span></span><span> </span><span id="local-6989586621681035068"><span class="annot"><span class="annottext">Role
</span><a href="#local-6989586621681035068"><span class="hs-identifier hs-var">r</span></a></span></span><span> </span><span id="local-6989586621681035067"><span class="annot"><span class="annottext">Type
</span><a href="#local-6989586621681035067"><span class="hs-identifier hs-var">ty</span></a></span></span><span> </span><span class="annot"><span class="annottext">MCoercion
</span><a href="GHC.Core.TyCo.Rep.html#MRefl"><span class="hs-identifier hs-var">MRefl</span></a></span><span>    </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">Role -&gt; Type -&gt; Coercion
</span><a href="GHC.Core.Coercion.html#mkReflCo"><span class="hs-identifier hs-var">mkReflCo</span></a></span><span> </span><span class="annot"><span class="annottext">Role
</span><a href="#local-6989586621681035068"><span class="hs-identifier hs-var">r</span></a></span><span> </span><span class="annot"><span class="annottext">Type
</span><a href="#local-6989586621681035067"><span class="hs-identifier hs-var">ty</span></a></span><span>
</span><span id="line-373"></span><span class="annot"><a href="GHC.Core.Coercion.html#mkGReflLeftMCo"><span class="hs-identifier hs-var">mkGReflLeftMCo</span></a></span><span> </span><span id="local-6989586621681035066"><span class="annot"><span class="annottext">Role
</span><a href="#local-6989586621681035066"><span class="hs-identifier hs-var">r</span></a></span></span><span> </span><span id="local-6989586621681035065"><span class="annot"><span class="annottext">Type
</span><a href="#local-6989586621681035065"><span class="hs-identifier hs-var">ty</span></a></span></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="GHC.Core.TyCo.Rep.html#MCo"><span class="hs-identifier hs-type">MCo</span></a></span><span> </span><span id="local-6989586621681035064"><span class="annot"><span class="annottext">Coercion
</span><a href="#local-6989586621681035064"><span class="hs-identifier hs-var">co</span></a></span></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">Role -&gt; Type -&gt; Coercion -&gt; Coercion
</span><a href="GHC.Core.Coercion.html#mkGReflLeftCo"><span class="hs-identifier hs-var">mkGReflLeftCo</span></a></span><span> </span><span class="annot"><span class="annottext">Role
</span><a href="#local-6989586621681035066"><span class="hs-identifier hs-var">r</span></a></span><span> </span><span class="annot"><span class="annottext">Type
</span><a href="#local-6989586621681035065"><span class="hs-identifier hs-var">ty</span></a></span><span> </span><span class="annot"><span class="annottext">Coercion
</span><a href="#local-6989586621681035064"><span class="hs-identifier hs-var">co</span></a></span><span>
</span><span id="line-374"></span><span>
</span><span id="line-375"></span><span class="annot"><a href="GHC.Core.Coercion.html#mkGReflRightMCo"><span class="hs-identifier hs-type">mkGReflRightMCo</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><a href="GHC.Core.Coercion.Axiom.html#Role"><span class="hs-identifier hs-type">Role</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="GHC.Core.TyCo.Rep.html#Type"><span class="hs-identifier hs-type">Type</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="GHC.Core.TyCo.Rep.html#MCoercionN"><span class="hs-identifier hs-type">MCoercionN</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="GHC.Core.TyCo.Rep.html#Coercion"><span class="hs-identifier hs-type">Coercion</span></a></span><span>
</span><span id="line-376"></span><span id="mkGReflRightMCo"><span class="annot"><span class="annottext">mkGReflRightMCo :: Role -&gt; Type -&gt; MCoercion -&gt; Coercion
</span><a href="GHC.Core.Coercion.html#mkGReflRightMCo"><span class="hs-identifier hs-var hs-var">mkGReflRightMCo</span></a></span></span><span> </span><span id="local-6989586621681035063"><span class="annot"><span class="annottext">Role
</span><a href="#local-6989586621681035063"><span class="hs-identifier hs-var">r</span></a></span></span><span> </span><span id="local-6989586621681035062"><span class="annot"><span class="annottext">Type
</span><a href="#local-6989586621681035062"><span class="hs-identifier hs-var">ty</span></a></span></span><span> </span><span class="annot"><span class="annottext">MCoercion
</span><a href="GHC.Core.TyCo.Rep.html#MRefl"><span class="hs-identifier hs-var">MRefl</span></a></span><span>    </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">Role -&gt; Type -&gt; Coercion
</span><a href="GHC.Core.Coercion.html#mkReflCo"><span class="hs-identifier hs-var">mkReflCo</span></a></span><span> </span><span class="annot"><span class="annottext">Role
</span><a href="#local-6989586621681035063"><span class="hs-identifier hs-var">r</span></a></span><span> </span><span class="annot"><span class="annottext">Type
</span><a href="#local-6989586621681035062"><span class="hs-identifier hs-var">ty</span></a></span><span>
</span><span id="line-377"></span><span class="annot"><a href="GHC.Core.Coercion.html#mkGReflRightMCo"><span class="hs-identifier hs-var">mkGReflRightMCo</span></a></span><span> </span><span id="local-6989586621681035061"><span class="annot"><span class="annottext">Role
</span><a href="#local-6989586621681035061"><span class="hs-identifier hs-var">r</span></a></span></span><span> </span><span id="local-6989586621681035060"><span class="annot"><span class="annottext">Type
</span><a href="#local-6989586621681035060"><span class="hs-identifier hs-var">ty</span></a></span></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="GHC.Core.TyCo.Rep.html#MCo"><span class="hs-identifier hs-type">MCo</span></a></span><span> </span><span id="local-6989586621681035059"><span class="annot"><span class="annottext">Coercion
</span><a href="#local-6989586621681035059"><span class="hs-identifier hs-var">co</span></a></span></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">Role -&gt; Type -&gt; Coercion -&gt; Coercion
</span><a href="GHC.Core.Coercion.html#mkGReflRightCo"><span class="hs-identifier hs-var">mkGReflRightCo</span></a></span><span> </span><span class="annot"><span class="annottext">Role
</span><a href="#local-6989586621681035061"><span class="hs-identifier hs-var">r</span></a></span><span> </span><span class="annot"><span class="annottext">Type
</span><a href="#local-6989586621681035060"><span class="hs-identifier hs-var">ty</span></a></span><span> </span><span class="annot"><span class="annottext">Coercion
</span><a href="#local-6989586621681035059"><span class="hs-identifier hs-var">co</span></a></span><span>
</span><span id="line-378"></span><span>
</span><span id="line-379"></span><span class="hs-comment">-- | Like 'mkCoherenceRightCo', but with an 'MCoercion'</span><span>
</span><span id="line-380"></span><span class="annot"><a href="GHC.Core.Coercion.html#mkCoherenceRightMCo"><span class="hs-identifier hs-type">mkCoherenceRightMCo</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><a href="GHC.Core.Coercion.Axiom.html#Role"><span class="hs-identifier hs-type">Role</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="GHC.Core.TyCo.Rep.html#Type"><span class="hs-identifier hs-type">Type</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="GHC.Core.TyCo.Rep.html#MCoercionN"><span class="hs-identifier hs-type">MCoercionN</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="GHC.Core.TyCo.Rep.html#Coercion"><span class="hs-identifier hs-type">Coercion</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="GHC.Core.TyCo.Rep.html#Coercion"><span class="hs-identifier hs-type">Coercion</span></a></span><span>
</span><span id="line-381"></span><span id="mkCoherenceRightMCo"><span class="annot"><span class="annottext">mkCoherenceRightMCo :: Role -&gt; Type -&gt; MCoercion -&gt; Coercion -&gt; Coercion
</span><a href="GHC.Core.Coercion.html#mkCoherenceRightMCo"><span class="hs-identifier hs-var hs-var">mkCoherenceRightMCo</span></a></span></span><span> </span><span class="annot"><span class="annottext">Role
</span><span class="hs-identifier">_</span></span><span> </span><span class="annot"><span class="annottext">Type
</span><span class="hs-identifier">_</span></span><span>  </span><span class="annot"><span class="annottext">MCoercion
</span><a href="GHC.Core.TyCo.Rep.html#MRefl"><span class="hs-identifier hs-var">MRefl</span></a></span><span>    </span><span id="local-6989586621681035058"><span class="annot"><span class="annottext">Coercion
</span><a href="#local-6989586621681035058"><span class="hs-identifier hs-var">co2</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">Coercion
</span><a href="#local-6989586621681035058"><span class="hs-identifier hs-var">co2</span></a></span><span>
</span><span id="line-382"></span><span class="annot"><a href="GHC.Core.Coercion.html#mkCoherenceRightMCo"><span class="hs-identifier hs-var">mkCoherenceRightMCo</span></a></span><span> </span><span id="local-6989586621681035057"><span class="annot"><span class="annottext">Role
</span><a href="#local-6989586621681035057"><span class="hs-identifier hs-var">r</span></a></span></span><span> </span><span id="local-6989586621681035056"><span class="annot"><span class="annottext">Type
</span><a href="#local-6989586621681035056"><span class="hs-identifier hs-var">ty</span></a></span></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="GHC.Core.TyCo.Rep.html#MCo"><span class="hs-identifier hs-type">MCo</span></a></span><span> </span><span id="local-6989586621681035055"><span class="annot"><span class="annottext">Coercion
</span><a href="#local-6989586621681035055"><span class="hs-identifier hs-var">co</span></a></span></span><span class="hs-special">)</span><span> </span><span id="local-6989586621681035054"><span class="annot"><span class="annottext">Coercion
</span><a href="#local-6989586621681035054"><span class="hs-identifier hs-var">co2</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">Role -&gt; Type -&gt; Coercion -&gt; Coercion -&gt; Coercion
</span><a href="GHC.Core.Coercion.html#mkCoherenceRightCo"><span class="hs-identifier hs-var">mkCoherenceRightCo</span></a></span><span> </span><span class="annot"><span class="annottext">Role
</span><a href="#local-6989586621681035057"><span class="hs-identifier hs-var">r</span></a></span><span> </span><span class="annot"><span class="annottext">Type
</span><a href="#local-6989586621681035056"><span class="hs-identifier hs-var">ty</span></a></span><span> </span><span class="annot"><span class="annottext">Coercion
</span><a href="#local-6989586621681035055"><span class="hs-identifier hs-var">co</span></a></span><span> </span><span class="annot"><span class="annottext">Coercion
</span><a href="#local-6989586621681035054"><span class="hs-identifier hs-var">co2</span></a></span><span>
</span><span id="line-383"></span><span>
</span><span id="line-384"></span><span class="annot"><a href="GHC.Core.Coercion.html#isReflMCo"><span class="hs-identifier hs-type">isReflMCo</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><a href="GHC.Core.TyCo.Rep.html#MCoercion"><span class="hs-identifier hs-type">MCoercion</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="hs-identifier hs-type">Bool</span></span><span>
</span><span id="line-385"></span><span id="isReflMCo"><span class="annot"><span class="annottext">isReflMCo :: MCoercion -&gt; Bool
</span><a href="GHC.Core.Coercion.html#isReflMCo"><span class="hs-identifier hs-var hs-var">isReflMCo</span></a></span></span><span> </span><span class="annot"><span class="annottext">MCoercion
</span><a href="GHC.Core.TyCo.Rep.html#MRefl"><span class="hs-identifier hs-var">MRefl</span></a></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">Bool
</span><span class="hs-identifier hs-var">True</span></span><span>
</span><span id="line-386"></span><span class="annot"><a href="GHC.Core.Coercion.html#isReflMCo"><span class="hs-identifier hs-var">isReflMCo</span></a></span><span> </span><span class="annot"><span class="annottext">MCoercion
</span><span class="hs-identifier">_</span></span><span>     </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">Bool
</span><span class="hs-identifier hs-var">False</span></span><span>
</span><span id="line-387"></span><span>
</span><span id="line-388"></span><span class="hs-comment">{-
%************************************************************************
%*                                                                      *
        Destructing coercions
%*                                                                      *
%************************************************************************

Note [Function coercions]
~~~~~~~~~~~~~~~~~~~~~~~~~
Remember that
  (-&gt;) :: forall {r1} {r2}. TYPE r1 -&gt; TYPE r2 -&gt; TYPE LiftedRep
whose `RuntimeRep' arguments are intentionally marked inferred to
avoid type application.

Hence
  FunCo r mult co1 co2 :: (s1-&gt;t1) ~r (s2-&gt;t2)
is short for
  TyConAppCo (-&gt;) mult co_rep1 co_rep2 co1 co2
where co_rep1, co_rep2 are the coercions on the representations.
-}</span><span>
</span><span id="line-408"></span><span>
</span><span id="line-409"></span><span>
</span><span id="line-410"></span><span class="hs-comment">-- | This breaks a 'Coercion' with type @T A B C ~ T D E F@ into</span><span>
</span><span id="line-411"></span><span class="hs-comment">-- a list of 'Coercion's of kinds @A ~ D@, @B ~ E@ and @E ~ F@. Hence:</span><span>
</span><span id="line-412"></span><span class="hs-comment">--</span><span>
</span><span id="line-413"></span><span class="hs-comment">-- &gt; decomposeCo 3 c [r1, r2, r3] = [nth r1 0 c, nth r2 1 c, nth r3 2 c]</span><span>
</span><span id="line-414"></span><span class="annot"><a href="GHC.Core.Coercion.html#decomposeCo"><span class="hs-identifier hs-type">decomposeCo</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><a href="GHC.Types.Basic.html#Arity"><span class="hs-identifier hs-type">Arity</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="GHC.Core.TyCo.Rep.html#Coercion"><span class="hs-identifier hs-type">Coercion</span></a></span><span>
</span><span id="line-415"></span><span>            </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-special">[</span><span class="annot"><a href="GHC.Core.Coercion.Axiom.html#Role"><span class="hs-identifier hs-type">Role</span></a></span><span class="hs-special">]</span><span>  </span><span class="hs-comment">-- the roles of the output coercions</span><span>
</span><span id="line-416"></span><span>                       </span><span class="hs-comment">-- this must have at least as many</span><span>
</span><span id="line-417"></span><span>                       </span><span class="hs-comment">-- entries as the Arity provided</span><span>
</span><span id="line-418"></span><span>            </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-special">[</span><span class="annot"><a href="GHC.Core.TyCo.Rep.html#Coercion"><span class="hs-identifier hs-type">Coercion</span></a></span><span class="hs-special">]</span><span>
</span><span id="line-419"></span><span id="decomposeCo"><span class="annot"><span class="annottext">decomposeCo :: Int -&gt; Coercion -&gt; [Role] -&gt; [Coercion]
</span><a href="GHC.Core.Coercion.html#decomposeCo"><span class="hs-identifier hs-var hs-var">decomposeCo</span></a></span></span><span> </span><span id="local-6989586621681035052"><span class="annot"><span class="annottext">Int
</span><a href="#local-6989586621681035052"><span class="hs-identifier hs-var">arity</span></a></span></span><span> </span><span id="local-6989586621681035051"><span class="annot"><span class="annottext">Coercion
</span><a href="#local-6989586621681035051"><span class="hs-identifier hs-var">co</span></a></span></span><span> </span><span id="local-6989586621681035050"><span class="annot"><span class="annottext">[Role]
</span><a href="#local-6989586621681035050"><span class="hs-identifier hs-var">rs</span></a></span></span><span>
</span><span id="line-420"></span><span>  </span><span class="hs-glyph">=</span><span> </span><span class="hs-special">[</span><span class="annot"><span class="annottext">HasDebugCallStack =&gt; Role -&gt; Int -&gt; Coercion -&gt; Coercion
</span><a href="GHC.Core.Coercion.html#mkNthCo"><span class="hs-identifier hs-var">mkNthCo</span></a></span><span> </span><span class="annot"><span class="annottext">Role
</span><a href="#local-6989586621681035049"><span class="hs-identifier hs-var">r</span></a></span><span> </span><span class="annot"><span class="annottext">Int
</span><a href="#local-6989586621681035048"><span class="hs-identifier hs-var">n</span></a></span><span> </span><span class="annot"><span class="annottext">Coercion
</span><a href="#local-6989586621681035051"><span class="hs-identifier hs-var">co</span></a></span><span> </span><span class="hs-glyph">|</span><span> </span><span class="hs-special">(</span><span id="local-6989586621681035048"><span class="annot"><span class="annottext">Int
</span><a href="#local-6989586621681035048"><span class="hs-identifier hs-var">n</span></a></span></span><span class="hs-special">,</span><span id="local-6989586621681035049"><span class="annot"><span class="annottext">Role
</span><a href="#local-6989586621681035049"><span class="hs-identifier hs-var">r</span></a></span></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="hs-special">[</span><span class="annot"><span class="annottext">Int
</span><span class="hs-number">0</span></span><span class="hs-glyph">..</span><span class="hs-special">(</span><span class="annot"><span class="annottext">Int
</span><a href="#local-6989586621681035052"><span class="hs-identifier hs-var">arity</span></a></span><span class="annot"><span class="annottext">forall a. Num a =&gt; a -&gt; a -&gt; a
</span><a href="../../base-4.16.4.0/src/GHC-Num.html#-"><span class="hs-glyph hs-var">-</span></a></span><span class="annot"><span class="annottext">Int
</span><span class="hs-number">1</span></span><span class="hs-special">)</span><span class="hs-special">]</span><span> </span><span class="annot"><span class="annottext">forall a b. [a] -&gt; [b] -&gt; [(a, b)]
</span><a href="../../base-4.16.4.0/src/GHC-List.html#zip"><span class="hs-operator hs-var">`zip`</span></a></span><span> </span><span class="annot"><span class="annottext">[Role]
</span><a href="#local-6989586621681035050"><span class="hs-identifier hs-var">rs</span></a></span><span> </span><span class="hs-special">]</span><span>
</span><span id="line-421"></span><span>           </span><span class="hs-comment">-- Remember, Nth is zero-indexed</span><span>
</span><span id="line-422"></span><span>
</span><span id="line-423"></span><span class="annot"><a href="GHC.Core.Coercion.html#decomposeFunCo"><span class="hs-identifier hs-type">decomposeFunCo</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><a href="GHC.Utils.Misc.html#HasDebugCallStack"><span class="hs-identifier hs-type">HasDebugCallStack</span></a></span><span>
</span><span id="line-424"></span><span>               </span><span class="hs-glyph">=&gt;</span><span> </span><span class="annot"><a href="GHC.Core.Coercion.Axiom.html#Role"><span class="hs-identifier hs-type">Role</span></a></span><span>      </span><span class="hs-comment">-- Role of the input coercion</span><span>
</span><span id="line-425"></span><span>               </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="GHC.Core.TyCo.Rep.html#Coercion"><span class="hs-identifier hs-type">Coercion</span></a></span><span>  </span><span class="hs-comment">-- Input coercion</span><span>
</span><span id="line-426"></span><span>               </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-special">(</span><span class="annot"><a href="GHC.Core.TyCo.Rep.html#CoercionN"><span class="hs-identifier hs-type">CoercionN</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><a href="GHC.Core.TyCo.Rep.html#Coercion"><span class="hs-identifier hs-type">Coercion</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><a href="GHC.Core.TyCo.Rep.html#Coercion"><span class="hs-identifier hs-type">Coercion</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-427"></span><span class="hs-comment">-- Expects co :: (s1 -&gt; t1) ~ (s2 -&gt; t2)</span><span>
</span><span id="line-428"></span><span class="hs-comment">-- Returns (co1 :: s1~s2, co2 :: t1~t2)</span><span>
</span><span id="line-429"></span><span class="hs-comment">-- See Note [Function coercions] for the &quot;3&quot; and &quot;4&quot;</span><span>
</span><span id="line-430"></span><span id="decomposeFunCo"><span class="annot"><span class="annottext">decomposeFunCo :: HasDebugCallStack =&gt;
Role -&gt; Coercion -&gt; (Coercion, Coercion, Coercion)
</span><a href="GHC.Core.Coercion.html#decomposeFunCo"><span class="hs-identifier hs-var hs-var">decomposeFunCo</span></a></span></span><span> </span><span id="local-6989586621681035040"><span class="annot"><span class="annottext">Role
</span><a href="#local-6989586621681035040"><span class="hs-identifier hs-var">r</span></a></span></span><span> </span><span id="local-6989586621681035039"><span class="annot"><span class="annottext">Coercion
</span><a href="#local-6989586621681035039"><span class="hs-identifier hs-var">co</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-identifier">ASSERT2</span><span class="hs-special">(</span><span> </span><span class="hs-identifier">all_ok</span><span class="hs-special">,</span><span> </span><span class="hs-identifier">ppr</span><span> </span><span class="hs-identifier">co</span><span> </span><span class="hs-special">)</span><span>
</span><span id="line-431"></span><span>                      </span><span class="hs-special">(</span><span class="annot"><span class="annottext">HasDebugCallStack =&gt; Role -&gt; Int -&gt; Coercion -&gt; Coercion
</span><a href="GHC.Core.Coercion.html#mkNthCo"><span class="hs-identifier hs-var">mkNthCo</span></a></span><span> </span><span class="annot"><span class="annottext">Role
</span><a href="GHC.Core.Coercion.Axiom.html#Nominal"><span class="hs-identifier hs-var">Nominal</span></a></span><span> </span><span class="annot"><span class="annottext">Int
</span><span class="hs-number">0</span></span><span> </span><span class="annot"><span class="annottext">Coercion
</span><a href="#local-6989586621681035039"><span class="hs-identifier hs-var">co</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">HasDebugCallStack =&gt; Role -&gt; Int -&gt; Coercion -&gt; Coercion
</span><a href="GHC.Core.Coercion.html#mkNthCo"><span class="hs-identifier hs-var">mkNthCo</span></a></span><span> </span><span class="annot"><span class="annottext">Role
</span><a href="#local-6989586621681035040"><span class="hs-identifier hs-var">r</span></a></span><span> </span><span class="annot"><span class="annottext">Int
</span><span class="hs-number">3</span></span><span> </span><span class="annot"><span class="annottext">Coercion
</span><a href="#local-6989586621681035039"><span class="hs-identifier hs-var">co</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">HasDebugCallStack =&gt; Role -&gt; Int -&gt; Coercion -&gt; Coercion
</span><a href="GHC.Core.Coercion.html#mkNthCo"><span class="hs-identifier hs-var">mkNthCo</span></a></span><span> </span><span class="annot"><span class="annottext">Role
</span><a href="#local-6989586621681035040"><span class="hs-identifier hs-var">r</span></a></span><span> </span><span class="annot"><span class="annottext">Int
</span><span class="hs-number">4</span></span><span> </span><span class="annot"><span class="annottext">Coercion
</span><a href="#local-6989586621681035039"><span class="hs-identifier hs-var">co</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-432"></span><span>  </span><span class="hs-keyword">where</span><span>
</span><span id="line-433"></span><span>    </span><span class="annot"><a href="GHC.Data.Pair.html#Pair"><span class="hs-identifier hs-type">Pair</span></a></span><span> </span><span id="local-6989586621681035032"><span class="annot"><span class="annottext">Type
</span><a href="#local-6989586621681035032"><span class="hs-identifier hs-var">s1t1</span></a></span></span><span> </span><span id="local-6989586621681035031"><span class="annot"><span class="annottext">Type
</span><a href="#local-6989586621681035031"><span class="hs-identifier hs-var">s2t2</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">Coercion -&gt; Pair Type
</span><a href="GHC.Core.Coercion.html#coercionKind"><span class="hs-identifier hs-var">coercionKind</span></a></span><span> </span><span class="annot"><span class="annottext">Coercion
</span><a href="#local-6989586621681035039"><span class="hs-identifier hs-var">co</span></a></span><span>
</span><span id="line-434"></span><span>    </span><span id="local-6989586621681035035"><span class="annot"><span class="annottext">all_ok :: Bool
</span><a href="#local-6989586621681035035"><span class="hs-identifier hs-var hs-var">all_ok</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">Type -&gt; Bool
</span><a href="GHC.Core.Type.html#isFunTy"><span class="hs-identifier hs-var">isFunTy</span></a></span><span> </span><span class="annot"><span class="annottext">Type
</span><a href="#local-6989586621681035032"><span class="hs-identifier hs-var">s1t1</span></a></span><span> </span><span class="annot"><span class="annottext">Bool -&gt; Bool -&gt; Bool
</span><span class="hs-operator hs-var">&amp;&amp;</span></span><span> </span><span class="annot"><span class="annottext">Type -&gt; Bool
</span><a href="GHC.Core.Type.html#isFunTy"><span class="hs-identifier hs-var">isFunTy</span></a></span><span> </span><span class="annot"><span class="annottext">Type
</span><a href="#local-6989586621681035031"><span class="hs-identifier hs-var">s2t2</span></a></span><span>
</span><span id="line-435"></span><span>
</span><span id="line-436"></span><span class="hs-comment">{- Note [Pushing a coercion into a pi-type]
~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~
Suppose we have this:
    (f |&gt; co) t1 .. tn
Then we want to push the coercion into the arguments, so as to make
progress. For example of why you might want to do so, see Note
[Respecting definitional equality] in GHC.Core.TyCo.Rep.

This is done by decomposePiCos.  Specifically, if
    decomposePiCos co [t1,..,tn] = ([co1,...,cok], cor)
then
    (f |&gt; co) t1 .. tn   =   (f (t1 |&gt; co1) ... (tk |&gt; cok)) |&gt; cor) t(k+1) ... tn

Notes:

* k can be smaller than n! That is decomposePiCos can return *fewer*
  coercions than there are arguments (ie k &lt; n), if the kind provided
  doesn't have enough binders.

* If there is a type error, we might see
       (f |&gt; co) t1
  where co :: (forall a. ty) ~ (ty1 -&gt; ty2)
  Here 'co' is insoluble, but we don't want to crash in decoposePiCos.
  So decomposePiCos carefully tests both sides of the coercion to check
  they are both foralls or both arrows.  Not doing this caused #15343.
-}</span><span>
</span><span id="line-462"></span><span>
</span><span id="line-463"></span><span class="annot"><a href="GHC.Core.Coercion.html#decomposePiCos"><span class="hs-identifier hs-type">decomposePiCos</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><a href="GHC.Utils.Misc.html#HasDebugCallStack"><span class="hs-identifier hs-type">HasDebugCallStack</span></a></span><span>
</span><span id="line-464"></span><span>               </span><span class="hs-glyph">=&gt;</span><span> </span><span class="annot"><a href="GHC.Core.TyCo.Rep.html#CoercionN"><span class="hs-identifier hs-type">CoercionN</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="GHC.Data.Pair.html#Pair"><span class="hs-identifier hs-type">Pair</span></a></span><span> </span><span class="annot"><a href="GHC.Core.TyCo.Rep.html#Type"><span class="hs-identifier hs-type">Type</span></a></span><span>  </span><span class="hs-comment">-- Coercion and its kind</span><span>
</span><span id="line-465"></span><span>               </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-special">[</span><span class="annot"><a href="GHC.Core.TyCo.Rep.html#Type"><span class="hs-identifier hs-type">Type</span></a></span><span class="hs-special">]</span><span>
</span><span id="line-466"></span><span>               </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-special">(</span><span class="hs-special">[</span><span class="annot"><a href="GHC.Core.TyCo.Rep.html#CoercionN"><span class="hs-identifier hs-type">CoercionN</span></a></span><span class="hs-special">]</span><span class="hs-special">,</span><span> </span><span class="annot"><a href="GHC.Core.TyCo.Rep.html#CoercionN"><span class="hs-identifier hs-type">CoercionN</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-467"></span><span class="hs-comment">-- See Note [Pushing a coercion into a pi-type]</span><span>
</span><span id="line-468"></span><span id="decomposePiCos"><span class="annot"><span class="annottext">decomposePiCos :: HasDebugCallStack =&gt;
Coercion -&gt; Pair Type -&gt; [Type] -&gt; ([Coercion], Coercion)
</span><a href="GHC.Core.Coercion.html#decomposePiCos"><span class="hs-identifier hs-var hs-var">decomposePiCos</span></a></span></span><span> </span><span id="local-6989586621681035022"><span class="annot"><span class="annottext">Coercion
</span><a href="#local-6989586621681035022"><span class="hs-identifier hs-var">orig_co</span></a></span></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="GHC.Data.Pair.html#Pair"><span class="hs-identifier hs-type">Pair</span></a></span><span> </span><span id="local-6989586621681035021"><span class="annot"><span class="annottext">Type
</span><a href="#local-6989586621681035021"><span class="hs-identifier hs-var">orig_k1</span></a></span></span><span> </span><span id="local-6989586621681035020"><span class="annot"><span class="annottext">Type
</span><a href="#local-6989586621681035020"><span class="hs-identifier hs-var">orig_k2</span></a></span></span><span class="hs-special">)</span><span> </span><span id="local-6989586621681035019"><span class="annot"><span class="annottext">[Type]
</span><a href="#local-6989586621681035019"><span class="hs-identifier hs-var">orig_args</span></a></span></span><span>
</span><span id="line-469"></span><span>  </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">[Coercion]
-&gt; (TCvSubst, Type)
-&gt; Coercion
-&gt; (TCvSubst, Type)
-&gt; [Type]
-&gt; ([Coercion], Coercion)
</span><a href="#local-6989586621681035018"><span class="hs-identifier hs-var">go</span></a></span><span> </span><span class="hs-special">[</span><span class="hs-special">]</span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">TCvSubst
</span><a href="#local-6989586621681035017"><span class="hs-identifier hs-var">orig_subst</span></a></span><span class="hs-special">,</span><span class="annot"><span class="annottext">Type
</span><a href="#local-6989586621681035021"><span class="hs-identifier hs-var">orig_k1</span></a></span><span class="hs-special">)</span><span> </span><span class="annot"><span class="annottext">Coercion
</span><a href="#local-6989586621681035022"><span class="hs-identifier hs-var">orig_co</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">TCvSubst
</span><a href="#local-6989586621681035017"><span class="hs-identifier hs-var">orig_subst</span></a></span><span class="hs-special">,</span><span class="annot"><span class="annottext">Type
</span><a href="#local-6989586621681035020"><span class="hs-identifier hs-var">orig_k2</span></a></span><span class="hs-special">)</span><span> </span><span class="annot"><span class="annottext">[Type]
</span><a href="#local-6989586621681035019"><span class="hs-identifier hs-var">orig_args</span></a></span><span>
</span><span id="line-470"></span><span>  </span><span class="hs-keyword">where</span><span>
</span><span id="line-471"></span><span>    </span><span id="local-6989586621681035017"><span class="annot"><span class="annottext">orig_subst :: TCvSubst
</span><a href="#local-6989586621681035017"><span class="hs-identifier hs-var hs-var">orig_subst</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">InScopeSet -&gt; TCvSubst
</span><a href="GHC.Core.TyCo.Subst.html#mkEmptyTCvSubst"><span class="hs-identifier hs-var">mkEmptyTCvSubst</span></a></span><span> </span><span class="annot"><span class="annottext">forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><a href="../../base-4.16.4.0/src/GHC-Base.html#%24"><span class="hs-operator hs-var">$</span></a></span><span> </span><span class="annot"><span class="annottext">VarSet -&gt; InScopeSet
</span><a href="GHC.Types.Var.Env.html#mkInScopeSet"><span class="hs-identifier hs-var">mkInScopeSet</span></a></span><span> </span><span class="annot"><span class="annottext">forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><a href="../../base-4.16.4.0/src/GHC-Base.html#%24"><span class="hs-operator hs-var">$</span></a></span><span>
</span><span id="line-472"></span><span>                 </span><span class="annot"><span class="annottext">[Type] -&gt; VarSet
</span><a href="GHC.Core.TyCo.FVs.html#tyCoVarsOfTypes"><span class="hs-identifier hs-var">tyCoVarsOfTypes</span></a></span><span> </span><span class="annot"><span class="annottext">[Type]
</span><a href="#local-6989586621681035019"><span class="hs-identifier hs-var">orig_args</span></a></span><span> </span><span class="annot"><span class="annottext">VarSet -&gt; VarSet -&gt; VarSet
</span><a href="GHC.Types.Var.Set.html#unionVarSet"><span class="hs-operator hs-var">`unionVarSet`</span></a></span><span> </span><span class="annot"><span class="annottext">Coercion -&gt; VarSet
</span><a href="GHC.Core.TyCo.FVs.html#tyCoVarsOfCo"><span class="hs-identifier hs-var">tyCoVarsOfCo</span></a></span><span> </span><span class="annot"><span class="annottext">Coercion
</span><a href="#local-6989586621681035022"><span class="hs-identifier hs-var">orig_co</span></a></span><span>
</span><span id="line-473"></span><span>
</span><span id="line-474"></span><span>    </span><span class="annot"><a href="#local-6989586621681035018"><span class="hs-identifier hs-type">go</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="hs-special">[</span><span class="annot"><a href="GHC.Core.TyCo.Rep.html#CoercionN"><span class="hs-identifier hs-type">CoercionN</span></a></span><span class="hs-special">]</span><span>      </span><span class="hs-comment">-- accumulator for argument coercions, reversed</span><span>
</span><span id="line-475"></span><span>       </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-special">(</span><span class="annot"><a href="GHC.Core.TyCo.Subst.html#TCvSubst"><span class="hs-identifier hs-type">TCvSubst</span></a></span><span class="hs-special">,</span><span class="annot"><a href="GHC.Core.TyCo.Rep.html#Kind"><span class="hs-identifier hs-type">Kind</span></a></span><span class="hs-special">)</span><span>  </span><span class="hs-comment">-- Lhs kind of coercion</span><span>
</span><span id="line-476"></span><span>       </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="GHC.Core.TyCo.Rep.html#CoercionN"><span class="hs-identifier hs-type">CoercionN</span></a></span><span>        </span><span class="hs-comment">-- coercion originally applied to the function</span><span>
</span><span id="line-477"></span><span>       </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-special">(</span><span class="annot"><a href="GHC.Core.TyCo.Subst.html#TCvSubst"><span class="hs-identifier hs-type">TCvSubst</span></a></span><span class="hs-special">,</span><span class="annot"><a href="GHC.Core.TyCo.Rep.html#Kind"><span class="hs-identifier hs-type">Kind</span></a></span><span class="hs-special">)</span><span>  </span><span class="hs-comment">-- Rhs kind of coercion</span><span>
</span><span id="line-478"></span><span>       </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-special">[</span><span class="annot"><a href="GHC.Core.TyCo.Rep.html#Type"><span class="hs-identifier hs-type">Type</span></a></span><span class="hs-special">]</span><span>           </span><span class="hs-comment">-- Arguments to that function</span><span>
</span><span id="line-479"></span><span>       </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-special">(</span><span class="hs-special">[</span><span class="annot"><a href="GHC.Core.TyCo.Rep.html#CoercionN"><span class="hs-identifier hs-type">CoercionN</span></a></span><span class="hs-special">]</span><span class="hs-special">,</span><span> </span><span class="annot"><a href="GHC.Core.TyCo.Rep.html#Coercion"><span class="hs-identifier hs-type">Coercion</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-480"></span><span>    </span><span class="hs-comment">-- Invariant:  co :: subst1(k1) ~ subst2(k2)</span><span>
</span><span id="line-481"></span><span>
</span><span id="line-482"></span><span>    </span><span id="local-6989586621681035018"><span class="annot"><span class="annottext">go :: [Coercion]
-&gt; (TCvSubst, Type)
-&gt; Coercion
-&gt; (TCvSubst, Type)
-&gt; [Type]
-&gt; ([Coercion], Coercion)
</span><a href="#local-6989586621681035018"><span class="hs-identifier hs-var hs-var">go</span></a></span></span><span> </span><span id="local-6989586621681035011"><span class="annot"><span class="annottext">[Coercion]
</span><a href="#local-6989586621681035011"><span class="hs-identifier hs-var">acc_arg_cos</span></a></span></span><span> </span><span class="hs-special">(</span><span id="local-6989586621681035010"><span class="annot"><span class="annottext">TCvSubst
</span><a href="#local-6989586621681035010"><span class="hs-identifier hs-var">subst1</span></a></span></span><span class="hs-special">,</span><span id="local-6989586621681035009"><span class="annot"><span class="annottext">Type
</span><a href="#local-6989586621681035009"><span class="hs-identifier hs-var">k1</span></a></span></span><span class="hs-special">)</span><span> </span><span id="local-6989586621681035008"><span class="annot"><span class="annottext">Coercion
</span><a href="#local-6989586621681035008"><span class="hs-identifier hs-var">co</span></a></span></span><span> </span><span class="hs-special">(</span><span id="local-6989586621681035007"><span class="annot"><span class="annottext">TCvSubst
</span><a href="#local-6989586621681035007"><span class="hs-identifier hs-var">subst2</span></a></span></span><span class="hs-special">,</span><span id="local-6989586621681035006"><span class="annot"><span class="annottext">Type
</span><a href="#local-6989586621681035006"><span class="hs-identifier hs-var">k2</span></a></span></span><span class="hs-special">)</span><span> </span><span class="hs-special">(</span><span id="local-6989586621681035005"><span class="annot"><span class="annottext">Type
</span><a href="#local-6989586621681035005"><span class="hs-identifier hs-var">ty</span></a></span></span><span class="annot"><span class="hs-glyph hs-type">:</span></span><span id="local-6989586621681035004"><span class="annot"><span class="annottext">[Type]
</span><a href="#local-6989586621681035004"><span class="hs-identifier hs-var">tys</span></a></span></span><span class="hs-special">)</span><span>
</span><span id="line-483"></span><span>      </span><span class="hs-glyph">|</span><span> </span><span class="annot"><a href="../../base-4.16.4.0/src/GHC-Maybe.html#Just"><span class="hs-identifier hs-type">Just</span></a></span><span> </span><span class="hs-special">(</span><span id="local-6989586621681035003"><span class="annot"><span class="annottext">CoVar
</span><a href="#local-6989586621681035003"><span class="hs-identifier hs-var">a</span></a></span></span><span class="hs-special">,</span><span> </span><span id="local-6989586621681035002"><span class="annot"><span class="annottext">Type
</span><a href="#local-6989586621681035002"><span class="hs-identifier hs-var">t1</span></a></span></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">Type -&gt; Maybe (CoVar, Type)
</span><a href="GHC.Core.Type.html#splitForAllTyCoVar_maybe"><span class="hs-identifier hs-var">splitForAllTyCoVar_maybe</span></a></span><span> </span><span class="annot"><span class="annottext">Type
</span><a href="#local-6989586621681035009"><span class="hs-identifier hs-var">k1</span></a></span><span>
</span><span id="line-484"></span><span>      </span><span class="hs-special">,</span><span> </span><span class="annot"><a href="../../base-4.16.4.0/src/GHC-Maybe.html#Just"><span class="hs-identifier hs-type">Just</span></a></span><span> </span><span class="hs-special">(</span><span id="local-6989586621681035000"><span class="annot"><span class="annottext">CoVar
</span><a href="#local-6989586621681035000"><span class="hs-identifier hs-var">b</span></a></span></span><span class="hs-special">,</span><span> </span><span id="local-6989586621681034999"><span class="annot"><span class="annottext">Type
</span><a href="#local-6989586621681034999"><span class="hs-identifier hs-var">t2</span></a></span></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">Type -&gt; Maybe (CoVar, Type)
</span><a href="GHC.Core.Type.html#splitForAllTyCoVar_maybe"><span class="hs-identifier hs-var">splitForAllTyCoVar_maybe</span></a></span><span> </span><span class="annot"><span class="annottext">Type
</span><a href="#local-6989586621681035006"><span class="hs-identifier hs-var">k2</span></a></span><span>
</span><span id="line-485"></span><span>        </span><span class="hs-comment">-- know     co :: (forall a:s1.t1) ~ (forall b:s2.t2)</span><span>
</span><span id="line-486"></span><span>        </span><span class="hs-comment">--    function :: forall a:s1.t1   (the function is not passed to decomposePiCos)</span><span>
</span><span id="line-487"></span><span>        </span><span class="hs-comment">--           a :: s1</span><span>
</span><span id="line-488"></span><span>        </span><span class="hs-comment">--           b :: s2</span><span>
</span><span id="line-489"></span><span>        </span><span class="hs-comment">--          ty :: s2</span><span>
</span><span id="line-490"></span><span>        </span><span class="hs-comment">-- need arg_co :: s2 ~ s1</span><span>
</span><span id="line-491"></span><span>        </span><span class="hs-comment">--      res_co :: t1[ty |&gt; arg_co / a] ~ t2[ty / b]</span><span>
</span><span id="line-492"></span><span>      </span><span class="hs-glyph">=</span><span> </span><span class="hs-keyword">let</span><span> </span><span id="local-6989586621681034998"><span class="annot"><span class="annottext">arg_co :: Coercion
</span><a href="#local-6989586621681034998"><span class="hs-identifier hs-var hs-var">arg_co</span></a></span></span><span>  </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">HasDebugCallStack =&gt; Role -&gt; Int -&gt; Coercion -&gt; Coercion
</span><a href="GHC.Core.Coercion.html#mkNthCo"><span class="hs-identifier hs-var">mkNthCo</span></a></span><span> </span><span class="annot"><span class="annottext">Role
</span><a href="GHC.Core.Coercion.Axiom.html#Nominal"><span class="hs-identifier hs-var">Nominal</span></a></span><span> </span><span class="annot"><span class="annottext">Int
</span><span class="hs-number">0</span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Coercion -&gt; Coercion
</span><a href="GHC.Core.Coercion.html#mkSymCo"><span class="hs-identifier hs-var">mkSymCo</span></a></span><span> </span><span class="annot"><span class="annottext">Coercion
</span><a href="#local-6989586621681035008"><span class="hs-identifier hs-var">co</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-493"></span><span>            </span><span id="local-6989586621681034997"><span class="annot"><span class="annottext">res_co :: Coercion
</span><a href="#local-6989586621681034997"><span class="hs-identifier hs-var hs-var">res_co</span></a></span></span><span>  </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">Coercion -&gt; Coercion -&gt; Coercion
</span><a href="GHC.Core.Coercion.html#mkInstCo"><span class="hs-identifier hs-var">mkInstCo</span></a></span><span> </span><span class="annot"><span class="annottext">Coercion
</span><a href="#local-6989586621681035008"><span class="hs-identifier hs-var">co</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Role -&gt; Type -&gt; Coercion -&gt; Coercion
</span><a href="GHC.Core.Coercion.html#mkGReflLeftCo"><span class="hs-identifier hs-var">mkGReflLeftCo</span></a></span><span> </span><span class="annot"><span class="annottext">Role
</span><a href="GHC.Core.Coercion.Axiom.html#Nominal"><span class="hs-identifier hs-var">Nominal</span></a></span><span> </span><span class="annot"><span class="annottext">Type
</span><a href="#local-6989586621681035005"><span class="hs-identifier hs-var">ty</span></a></span><span> </span><span class="annot"><span class="annottext">Coercion
</span><a href="#local-6989586621681034998"><span class="hs-identifier hs-var">arg_co</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-494"></span><span>            </span><span id="local-6989586621681034996"><span class="annot"><span class="annottext">subst1' :: TCvSubst
</span><a href="#local-6989586621681034996"><span class="hs-identifier hs-var hs-var">subst1'</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">TCvSubst -&gt; CoVar -&gt; Type -&gt; TCvSubst
</span><a href="GHC.Core.TyCo.Subst.html#extendTCvSubst"><span class="hs-identifier hs-var">extendTCvSubst</span></a></span><span> </span><span class="annot"><span class="annottext">TCvSubst
</span><a href="#local-6989586621681035010"><span class="hs-identifier hs-var">subst1</span></a></span><span> </span><span class="annot"><span class="annottext">CoVar
</span><a href="#local-6989586621681035003"><span class="hs-identifier hs-var">a</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Type
</span><a href="#local-6989586621681035005"><span class="hs-identifier hs-var">ty</span></a></span><span> </span><span class="annot"><span class="annottext">Type -&gt; Coercion -&gt; Type
</span><a href="GHC.Core.TyCo.Rep.html#CastTy"><span class="hs-operator hs-var">`CastTy`</span></a></span><span> </span><span class="annot"><span class="annottext">Coercion
</span><a href="#local-6989586621681034998"><span class="hs-identifier hs-var">arg_co</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-495"></span><span>            </span><span id="local-6989586621681034993"><span class="annot"><span class="annottext">subst2' :: TCvSubst
</span><a href="#local-6989586621681034993"><span class="hs-identifier hs-var hs-var">subst2'</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">TCvSubst -&gt; CoVar -&gt; Type -&gt; TCvSubst
</span><a href="GHC.Core.TyCo.Subst.html#extendTCvSubst"><span class="hs-identifier hs-var">extendTCvSubst</span></a></span><span> </span><span class="annot"><span class="annottext">TCvSubst
</span><a href="#local-6989586621681035007"><span class="hs-identifier hs-var">subst2</span></a></span><span> </span><span class="annot"><span class="annottext">CoVar
</span><a href="#local-6989586621681035000"><span class="hs-identifier hs-var">b</span></a></span><span> </span><span class="annot"><span class="annottext">Type
</span><a href="#local-6989586621681035005"><span class="hs-identifier hs-var">ty</span></a></span><span>
</span><span id="line-496"></span><span>        </span><span class="hs-keyword">in</span><span>
</span><span id="line-497"></span><span>        </span><span class="annot"><span class="annottext">[Coercion]
-&gt; (TCvSubst, Type)
-&gt; Coercion
-&gt; (TCvSubst, Type)
-&gt; [Type]
-&gt; ([Coercion], Coercion)
</span><a href="#local-6989586621681035018"><span class="hs-identifier hs-var">go</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Coercion
</span><a href="#local-6989586621681034998"><span class="hs-identifier hs-var">arg_co</span></a></span><span> </span><span class="annot"><span class="annottext">forall a. a -&gt; [a] -&gt; [a]
</span><span class="hs-glyph hs-var">:</span></span><span> </span><span class="annot"><span class="annottext">[Coercion]
</span><a href="#local-6989586621681035011"><span class="hs-identifier hs-var">acc_arg_cos</span></a></span><span class="hs-special">)</span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">TCvSubst
</span><a href="#local-6989586621681034996"><span class="hs-identifier hs-var">subst1'</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">Type
</span><a href="#local-6989586621681035002"><span class="hs-identifier hs-var">t1</span></a></span><span class="hs-special">)</span><span> </span><span class="annot"><span class="annottext">Coercion
</span><a href="#local-6989586621681034997"><span class="hs-identifier hs-var">res_co</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">TCvSubst
</span><a href="#local-6989586621681034993"><span class="hs-identifier hs-var">subst2'</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">Type
</span><a href="#local-6989586621681034999"><span class="hs-identifier hs-var">t2</span></a></span><span class="hs-special">)</span><span> </span><span class="annot"><span class="annottext">[Type]
</span><a href="#local-6989586621681035004"><span class="hs-identifier hs-var">tys</span></a></span><span>
</span><span id="line-498"></span><span>
</span><span id="line-499"></span><span>      </span><span class="hs-glyph">|</span><span> </span><span class="annot"><a href="../../base-4.16.4.0/src/GHC-Maybe.html#Just"><span class="hs-identifier hs-type">Just</span></a></span><span> </span><span class="hs-special">(</span><span id="local-6989586621681034992"><span class="annot"><span class="annottext">Type
</span><a href="#local-6989586621681034992"><span class="hs-identifier hs-var">_w1</span></a></span></span><span class="hs-special">,</span><span> </span><span id="local-6989586621681034991"><span class="annot"><span class="annottext">Type
</span><a href="#local-6989586621681034991"><span class="hs-identifier hs-var">_s1</span></a></span></span><span class="hs-special">,</span><span> </span><span id="local-6989586621681034990"><span class="annot"><span class="annottext">Type
</span><a href="#local-6989586621681034990"><span class="hs-identifier hs-var">t1</span></a></span></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">Type -&gt; Maybe (Type, Type, Type)
</span><a href="GHC.Core.Type.html#splitFunTy_maybe"><span class="hs-identifier hs-var">splitFunTy_maybe</span></a></span><span> </span><span class="annot"><span class="annottext">Type
</span><a href="#local-6989586621681035009"><span class="hs-identifier hs-var">k1</span></a></span><span>
</span><span id="line-500"></span><span>      </span><span class="hs-special">,</span><span> </span><span class="annot"><a href="../../base-4.16.4.0/src/GHC-Maybe.html#Just"><span class="hs-identifier hs-type">Just</span></a></span><span> </span><span class="hs-special">(</span><span id="local-6989586621681034988"><span class="annot"><span class="annottext">Type
</span><a href="#local-6989586621681034988"><span class="hs-identifier hs-var">_w1</span></a></span></span><span class="hs-special">,</span><span> </span><span id="local-6989586621681034987"><span class="annot"><span class="annottext">Type
</span><a href="#local-6989586621681034987"><span class="hs-identifier hs-var">_s2</span></a></span></span><span class="hs-special">,</span><span> </span><span id="local-6989586621681034986"><span class="annot"><span class="annottext">Type
</span><a href="#local-6989586621681034986"><span class="hs-identifier hs-var">t2</span></a></span></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">Type -&gt; Maybe (Type, Type, Type)
</span><a href="GHC.Core.Type.html#splitFunTy_maybe"><span class="hs-identifier hs-var">splitFunTy_maybe</span></a></span><span> </span><span class="annot"><span class="annottext">Type
</span><a href="#local-6989586621681035006"><span class="hs-identifier hs-var">k2</span></a></span><span>
</span><span id="line-501"></span><span>        </span><span class="hs-comment">-- know     co :: (s1 -&gt; t1) ~ (s2 -&gt; t2)</span><span>
</span><span id="line-502"></span><span>        </span><span class="hs-comment">--    function :: s1 -&gt; t1</span><span>
</span><span id="line-503"></span><span>        </span><span class="hs-comment">--          ty :: s2</span><span>
</span><span id="line-504"></span><span>        </span><span class="hs-comment">-- need arg_co :: s2 ~ s1</span><span>
</span><span id="line-505"></span><span>        </span><span class="hs-comment">--      res_co :: t1 ~ t2</span><span>
</span><span id="line-506"></span><span>      </span><span class="hs-glyph">=</span><span> </span><span class="hs-keyword">let</span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Coercion
</span><span class="hs-identifier">_</span></span><span class="hs-special">,</span><span> </span><span id="local-6989586621681034985"><span class="annot"><span class="annottext">Coercion
</span><a href="#local-6989586621681034985"><span class="hs-identifier hs-var">sym_arg_co</span></a></span></span><span class="hs-special">,</span><span> </span><span id="local-6989586621681034984"><span class="annot"><span class="annottext">Coercion
</span><a href="#local-6989586621681034984"><span class="hs-identifier hs-var">res_co</span></a></span></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">HasDebugCallStack =&gt;
Role -&gt; Coercion -&gt; (Coercion, Coercion, Coercion)
</span><a href="GHC.Core.Coercion.html#decomposeFunCo"><span class="hs-identifier hs-var">decomposeFunCo</span></a></span><span> </span><span class="annot"><span class="annottext">Role
</span><a href="GHC.Core.Coercion.Axiom.html#Nominal"><span class="hs-identifier hs-var">Nominal</span></a></span><span> </span><span class="annot"><span class="annottext">Coercion
</span><a href="#local-6989586621681035008"><span class="hs-identifier hs-var">co</span></a></span><span>
</span><span id="line-507"></span><span>            </span><span class="hs-comment">-- It should be fine to ignore the multiplicity bit of the coercion</span><span>
</span><span id="line-508"></span><span>            </span><span class="hs-comment">-- for a Nominal coercion.</span><span>
</span><span id="line-509"></span><span>            </span><span id="local-6989586621681034983"><span class="annot"><span class="annottext">arg_co :: Coercion
</span><a href="#local-6989586621681034983"><span class="hs-identifier hs-var hs-var">arg_co</span></a></span></span><span>               </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">Coercion -&gt; Coercion
</span><a href="GHC.Core.Coercion.html#mkSymCo"><span class="hs-identifier hs-var">mkSymCo</span></a></span><span> </span><span class="annot"><span class="annottext">Coercion
</span><a href="#local-6989586621681034985"><span class="hs-identifier hs-var">sym_arg_co</span></a></span><span>
</span><span id="line-510"></span><span>        </span><span class="hs-keyword">in</span><span>
</span><span id="line-511"></span><span>        </span><span class="annot"><span class="annottext">[Coercion]
-&gt; (TCvSubst, Type)
-&gt; Coercion
-&gt; (TCvSubst, Type)
-&gt; [Type]
-&gt; ([Coercion], Coercion)
</span><a href="#local-6989586621681035018"><span class="hs-identifier hs-var">go</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Coercion
</span><a href="#local-6989586621681034983"><span class="hs-identifier hs-var">arg_co</span></a></span><span> </span><span class="annot"><span class="annottext">forall a. a -&gt; [a] -&gt; [a]
</span><span class="hs-glyph hs-var">:</span></span><span> </span><span class="annot"><span class="annottext">[Coercion]
</span><a href="#local-6989586621681035011"><span class="hs-identifier hs-var">acc_arg_cos</span></a></span><span class="hs-special">)</span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">TCvSubst
</span><a href="#local-6989586621681035010"><span class="hs-identifier hs-var">subst1</span></a></span><span class="hs-special">,</span><span class="annot"><span class="annottext">Type
</span><a href="#local-6989586621681034990"><span class="hs-identifier hs-var">t1</span></a></span><span class="hs-special">)</span><span> </span><span class="annot"><span class="annottext">Coercion
</span><a href="#local-6989586621681034984"><span class="hs-identifier hs-var">res_co</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">TCvSubst
</span><a href="#local-6989586621681035007"><span class="hs-identifier hs-var">subst2</span></a></span><span class="hs-special">,</span><span class="annot"><span class="annottext">Type
</span><a href="#local-6989586621681034986"><span class="hs-identifier hs-var">t2</span></a></span><span class="hs-special">)</span><span> </span><span class="annot"><span class="annottext">[Type]
</span><a href="#local-6989586621681035004"><span class="hs-identifier hs-var">tys</span></a></span><span>
</span><span id="line-512"></span><span>
</span><span id="line-513"></span><span>      </span><span class="hs-glyph">|</span><span> </span><span class="annot"><span class="annottext">Bool -&gt; Bool
</span><span class="hs-identifier hs-var">not</span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">TCvSubst -&gt; Bool
</span><a href="GHC.Core.TyCo.Subst.html#isEmptyTCvSubst"><span class="hs-identifier hs-var">isEmptyTCvSubst</span></a></span><span> </span><span class="annot"><span class="annottext">TCvSubst
</span><a href="#local-6989586621681035010"><span class="hs-identifier hs-var">subst1</span></a></span><span class="hs-special">)</span><span> </span><span class="annot"><span class="annottext">Bool -&gt; Bool -&gt; Bool
</span><span class="hs-operator hs-var">||</span></span><span> </span><span class="annot"><span class="annottext">Bool -&gt; Bool
</span><span class="hs-identifier hs-var">not</span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">TCvSubst -&gt; Bool
</span><a href="GHC.Core.TyCo.Subst.html#isEmptyTCvSubst"><span class="hs-identifier hs-var">isEmptyTCvSubst</span></a></span><span> </span><span class="annot"><span class="annottext">TCvSubst
</span><a href="#local-6989586621681035007"><span class="hs-identifier hs-var">subst2</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-514"></span><span>      </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">[Coercion]
-&gt; (TCvSubst, Type)
-&gt; Coercion
-&gt; (TCvSubst, Type)
-&gt; [Type]
-&gt; ([Coercion], Coercion)
</span><a href="#local-6989586621681035018"><span class="hs-identifier hs-var">go</span></a></span><span> </span><span class="annot"><span class="annottext">[Coercion]
</span><a href="#local-6989586621681035011"><span class="hs-identifier hs-var">acc_arg_cos</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">TCvSubst -&gt; TCvSubst
</span><a href="GHC.Core.TyCo.Subst.html#zapTCvSubst"><span class="hs-identifier hs-var">zapTCvSubst</span></a></span><span> </span><span class="annot"><span class="annottext">TCvSubst
</span><a href="#local-6989586621681035010"><span class="hs-identifier hs-var">subst1</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">HasCallStack =&gt; TCvSubst -&gt; Type -&gt; Type
</span><a href="GHC.Core.TyCo.Subst.html#substTy"><span class="hs-identifier hs-var">substTy</span></a></span><span> </span><span class="annot"><span class="annottext">TCvSubst
</span><a href="#local-6989586621681035010"><span class="hs-identifier hs-var">subst1</span></a></span><span> </span><span class="annot"><span class="annottext">Type
</span><a href="#local-6989586621681035009"><span class="hs-identifier hs-var">k1</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-515"></span><span>                       </span><span class="annot"><span class="annottext">Coercion
</span><a href="#local-6989586621681035008"><span class="hs-identifier hs-var">co</span></a></span><span>
</span><span id="line-516"></span><span>                       </span><span class="hs-special">(</span><span class="annot"><span class="annottext">TCvSubst -&gt; TCvSubst
</span><a href="GHC.Core.TyCo.Subst.html#zapTCvSubst"><span class="hs-identifier hs-var">zapTCvSubst</span></a></span><span> </span><span class="annot"><span class="annottext">TCvSubst
</span><a href="#local-6989586621681035007"><span class="hs-identifier hs-var">subst2</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">HasCallStack =&gt; TCvSubst -&gt; Type -&gt; Type
</span><a href="GHC.Core.TyCo.Subst.html#substTy"><span class="hs-identifier hs-var">substTy</span></a></span><span> </span><span class="annot"><span class="annottext">TCvSubst
</span><a href="#local-6989586621681035010"><span class="hs-identifier hs-var">subst1</span></a></span><span> </span><span class="annot"><span class="annottext">Type
</span><a href="#local-6989586621681035006"><span class="hs-identifier hs-var">k2</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-517"></span><span>                       </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Type
</span><a href="#local-6989586621681035005"><span class="hs-identifier hs-var">ty</span></a></span><span class="annot"><span class="annottext">forall a. a -&gt; [a] -&gt; [a]
</span><span class="hs-glyph hs-var">:</span></span><span class="annot"><span class="annottext">[Type]
</span><a href="#local-6989586621681035004"><span class="hs-identifier hs-var">tys</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-518"></span><span>
</span><span id="line-519"></span><span>      </span><span class="hs-comment">-- tys might not be empty, if the left-hand type of the original coercion</span><span>
</span><span id="line-520"></span><span>      </span><span class="hs-comment">-- didn't have enough binders</span><span>
</span><span id="line-521"></span><span>    </span><span class="annot"><a href="#local-6989586621681035018"><span class="hs-identifier hs-var">go</span></a></span><span> </span><span id="local-6989586621681034978"><span class="annot"><span class="annottext">[Coercion]
</span><a href="#local-6989586621681034978"><span class="hs-identifier hs-var">acc_arg_cos</span></a></span></span><span> </span><span id="local-6989586621681034977"><span class="annot"><span class="annottext">(TCvSubst, Type)
</span><a href="#local-6989586621681034977"><span class="hs-identifier hs-var">_ki1</span></a></span></span><span> </span><span id="local-6989586621681034976"><span class="annot"><span class="annottext">Coercion
</span><a href="#local-6989586621681034976"><span class="hs-identifier hs-var">co</span></a></span></span><span> </span><span id="local-6989586621681034975"><span class="annot"><span class="annottext">(TCvSubst, Type)
</span><a href="#local-6989586621681034975"><span class="hs-identifier hs-var">_ki2</span></a></span></span><span> </span><span id="local-6989586621681034974"><span class="annot"><span class="annottext">[Type]
</span><a href="#local-6989586621681034974"><span class="hs-identifier hs-var">_tys</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">forall a. [a] -&gt; [a]
</span><a href="../../base-4.16.4.0/src/GHC-List.html#reverse"><span class="hs-identifier hs-var">reverse</span></a></span><span> </span><span class="annot"><span class="annottext">[Coercion]
</span><a href="#local-6989586621681034978"><span class="hs-identifier hs-var">acc_arg_cos</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">Coercion
</span><a href="#local-6989586621681034976"><span class="hs-identifier hs-var">co</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-522"></span><span>
</span><span id="line-523"></span><span class="hs-comment">-- | Attempts to obtain the type variable underlying a 'Coercion'</span><span>
</span><span id="line-524"></span><span class="annot"><a href="GHC.Core.Coercion.html#getCoVar_maybe"><span class="hs-identifier hs-type">getCoVar_maybe</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><a href="GHC.Core.TyCo.Rep.html#Coercion"><span class="hs-identifier hs-type">Coercion</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="../../base-4.16.4.0/src/GHC-Maybe.html#Maybe"><span class="hs-identifier hs-type">Maybe</span></a></span><span> </span><span class="annot"><a href="GHC.Types.Var.html#CoVar"><span class="hs-identifier hs-type">CoVar</span></a></span><span>
</span><span id="line-525"></span><span id="getCoVar_maybe"><span class="annot"><span class="annottext">getCoVar_maybe :: Coercion -&gt; Maybe CoVar
</span><a href="GHC.Core.Coercion.html#getCoVar_maybe"><span class="hs-identifier hs-var hs-var">getCoVar_maybe</span></a></span></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="GHC.Core.TyCo.Rep.html#CoVarCo"><span class="hs-identifier hs-type">CoVarCo</span></a></span><span> </span><span id="local-6989586621681034972"><span class="annot"><span class="annottext">CoVar
</span><a href="#local-6989586621681034972"><span class="hs-identifier hs-var">cv</span></a></span></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">forall a. a -&gt; Maybe a
</span><a href="../../base-4.16.4.0/src/GHC-Maybe.html#Just"><span class="hs-identifier hs-var">Just</span></a></span><span> </span><span class="annot"><span class="annottext">CoVar
</span><a href="#local-6989586621681034972"><span class="hs-identifier hs-var">cv</span></a></span><span>
</span><span id="line-526"></span><span class="annot"><a href="GHC.Core.Coercion.html#getCoVar_maybe"><span class="hs-identifier hs-var">getCoVar_maybe</span></a></span><span> </span><span class="annot"><span class="annottext">Coercion
</span><span class="hs-identifier">_</span></span><span>            </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">forall a. Maybe a
</span><a href="../../base-4.16.4.0/src/GHC-Maybe.html#Nothing"><span class="hs-identifier hs-var">Nothing</span></a></span><span>
</span><span id="line-527"></span><span>
</span><span id="line-528"></span><span class="hs-comment">-- | Attempts to tease a coercion apart into a type constructor and the application</span><span>
</span><span id="line-529"></span><span class="hs-comment">-- of a number of coercion arguments to that constructor</span><span>
</span><span id="line-530"></span><span class="annot"><a href="GHC.Core.Coercion.html#splitTyConAppCo_maybe"><span class="hs-identifier hs-type">splitTyConAppCo_maybe</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><a href="GHC.Core.TyCo.Rep.html#Coercion"><span class="hs-identifier hs-type">Coercion</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="../../base-4.16.4.0/src/GHC-Maybe.html#Maybe"><span class="hs-identifier hs-type">Maybe</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="GHC.Core.TyCon.html#TyCon"><span class="hs-identifier hs-type">TyCon</span></a></span><span class="hs-special">,</span><span> </span><span class="hs-special">[</span><span class="annot"><a href="GHC.Core.TyCo.Rep.html#Coercion"><span class="hs-identifier hs-type">Coercion</span></a></span><span class="hs-special">]</span><span class="hs-special">)</span><span>
</span><span id="line-531"></span><span id="splitTyConAppCo_maybe"><span class="annot"><span class="annottext">splitTyConAppCo_maybe :: Coercion -&gt; Maybe (TyCon, [Coercion])
</span><a href="GHC.Core.Coercion.html#splitTyConAppCo_maybe"><span class="hs-identifier hs-var hs-var">splitTyConAppCo_maybe</span></a></span></span><span> </span><span id="local-6989586621681034971"><span class="annot"><span class="annottext">Coercion
</span><a href="#local-6989586621681034971"><span class="hs-identifier hs-var">co</span></a></span></span><span>
</span><span id="line-532"></span><span>  </span><span class="hs-glyph">|</span><span> </span><span class="annot"><a href="../../base-4.16.4.0/src/GHC-Maybe.html#Just"><span class="hs-identifier hs-type">Just</span></a></span><span> </span><span class="hs-special">(</span><span id="local-6989586621681034970"><span class="annot"><span class="annottext">Type
</span><a href="#local-6989586621681034970"><span class="hs-identifier hs-var">ty</span></a></span></span><span class="hs-special">,</span><span> </span><span id="local-6989586621681034969"><span class="annot"><span class="annottext">Role
</span><a href="#local-6989586621681034969"><span class="hs-identifier hs-var">r</span></a></span></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">Coercion -&gt; Maybe (Type, Role)
</span><a href="GHC.Core.Coercion.html#isReflCo_maybe"><span class="hs-identifier hs-var">isReflCo_maybe</span></a></span><span> </span><span class="annot"><span class="annottext">Coercion
</span><a href="#local-6989586621681034971"><span class="hs-identifier hs-var">co</span></a></span><span>
</span><span id="line-533"></span><span>  </span><span class="hs-glyph">=</span><span> </span><span class="hs-keyword">do</span><span> </span><span class="hs-special">{</span><span> </span><span class="hs-special">(</span><span id="local-6989586621681034968"><span class="annot"><span class="annottext">TyCon
</span><a href="#local-6989586621681034968"><span class="hs-identifier hs-var">tc</span></a></span></span><span class="hs-special">,</span><span> </span><span id="local-6989586621681034967"><span class="annot"><span class="annottext">[Type]
</span><a href="#local-6989586621681034967"><span class="hs-identifier hs-var">tys</span></a></span></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">HasDebugCallStack =&gt; Type -&gt; Maybe (TyCon, [Type])
</span><a href="GHC.Core.Type.html#splitTyConApp_maybe"><span class="hs-identifier hs-var">splitTyConApp_maybe</span></a></span><span> </span><span class="annot"><span class="annottext">Type
</span><a href="#local-6989586621681034970"><span class="hs-identifier hs-var">ty</span></a></span><span>
</span><span id="line-534"></span><span>       </span><span class="hs-special">;</span><span> </span><span class="hs-keyword">let</span><span> </span><span id="local-6989586621681034965"><span class="annot"><span class="annottext">args :: [Coercion]
</span><a href="#local-6989586621681034965"><span class="hs-identifier hs-var hs-var">args</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">forall a b c. (a -&gt; b -&gt; c) -&gt; [a] -&gt; [b] -&gt; [c]
</span><a href="../../base-4.16.4.0/src/GHC-List.html#zipWith"><span class="hs-identifier hs-var">zipWith</span></a></span><span> </span><span class="annot"><span class="annottext">Role -&gt; Type -&gt; Coercion
</span><a href="GHC.Core.Coercion.html#mkReflCo"><span class="hs-identifier hs-var">mkReflCo</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Role -&gt; TyCon -&gt; [Role]
</span><a href="GHC.Core.Coercion.html#tyConRolesX"><span class="hs-identifier hs-var">tyConRolesX</span></a></span><span> </span><span class="annot"><span class="annottext">Role
</span><a href="#local-6989586621681034969"><span class="hs-identifier hs-var">r</span></a></span><span> </span><span class="annot"><span class="annottext">TyCon
</span><a href="#local-6989586621681034968"><span class="hs-identifier hs-var">tc</span></a></span><span class="hs-special">)</span><span> </span><span class="annot"><span class="annottext">[Type]
</span><a href="#local-6989586621681034967"><span class="hs-identifier hs-var">tys</span></a></span><span>
</span><span id="line-535"></span><span>       </span><span class="hs-special">;</span><span> </span><span class="annot"><span class="annottext">forall (m :: * -&gt; *) a. Monad m =&gt; a -&gt; m a
</span><a href="../../base-4.16.4.0/src/GHC-Base.html#return"><span class="hs-identifier hs-var">return</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">TyCon
</span><a href="#local-6989586621681034968"><span class="hs-identifier hs-var">tc</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">[Coercion]
</span><a href="#local-6989586621681034965"><span class="hs-identifier hs-var">args</span></a></span><span class="hs-special">)</span><span> </span><span class="hs-special">}</span><span>
</span><span id="line-536"></span><span class="annot"><a href="GHC.Core.Coercion.html#splitTyConAppCo_maybe"><span class="hs-identifier hs-var">splitTyConAppCo_maybe</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="GHC.Core.TyCo.Rep.html#TyConAppCo"><span class="hs-identifier hs-type">TyConAppCo</span></a></span><span> </span><span class="annot"><span class="annottext">Role
</span><span class="hs-identifier">_</span></span><span> </span><span id="local-6989586621681034962"><span class="annot"><span class="annottext">TyCon
</span><a href="#local-6989586621681034962"><span class="hs-identifier hs-var">tc</span></a></span></span><span> </span><span id="local-6989586621681034961"><span class="annot"><span class="annottext">[Coercion]
</span><a href="#local-6989586621681034961"><span class="hs-identifier hs-var">cos</span></a></span></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">forall a. a -&gt; Maybe a
</span><a href="../../base-4.16.4.0/src/GHC-Maybe.html#Just"><span class="hs-identifier hs-var">Just</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">TyCon
</span><a href="#local-6989586621681034962"><span class="hs-identifier hs-var">tc</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">[Coercion]
</span><a href="#local-6989586621681034961"><span class="hs-identifier hs-var">cos</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-537"></span><span class="annot"><a href="GHC.Core.Coercion.html#splitTyConAppCo_maybe"><span class="hs-identifier hs-var">splitTyConAppCo_maybe</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="GHC.Core.TyCo.Rep.html#FunCo"><span class="hs-identifier hs-type">FunCo</span></a></span><span> </span><span class="annot"><span class="annottext">Role
</span><span class="hs-identifier">_</span></span><span> </span><span id="local-6989586621681034959"><span class="annot"><span class="annottext">Coercion
</span><a href="#local-6989586621681034959"><span class="hs-identifier hs-var">w</span></a></span></span><span> </span><span id="local-6989586621681034958"><span class="annot"><span class="annottext">Coercion
</span><a href="#local-6989586621681034958"><span class="hs-identifier hs-var">arg</span></a></span></span><span> </span><span id="local-6989586621681034957"><span class="annot"><span class="annottext">Coercion
</span><a href="#local-6989586621681034957"><span class="hs-identifier hs-var">res</span></a></span></span><span class="hs-special">)</span><span>     </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">forall a. a -&gt; Maybe a
</span><a href="../../base-4.16.4.0/src/GHC-Maybe.html#Just"><span class="hs-identifier hs-var">Just</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">TyCon
</span><a href="GHC.Builtin.Types.Prim.html#funTyCon"><span class="hs-identifier hs-var">funTyCon</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">[Coercion]
</span><a href="#local-6989586621681034955"><span class="hs-identifier hs-var">cos</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-538"></span><span>  </span><span class="hs-keyword">where</span><span> </span><span id="local-6989586621681034955"><span class="annot"><span class="annottext">cos :: [Coercion]
</span><a href="#local-6989586621681034955"><span class="hs-identifier hs-var hs-var">cos</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-special">[</span><span class="annot"><span class="annottext">Coercion
</span><a href="#local-6989586621681034959"><span class="hs-identifier hs-var">w</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">HasDebugCallStack =&gt; Coercion -&gt; Coercion
</span><a href="GHC.Core.Coercion.html#mkRuntimeRepCo"><span class="hs-identifier hs-var">mkRuntimeRepCo</span></a></span><span> </span><span class="annot"><span class="annottext">Coercion
</span><a href="#local-6989586621681034958"><span class="hs-identifier hs-var">arg</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">HasDebugCallStack =&gt; Coercion -&gt; Coercion
</span><a href="GHC.Core.Coercion.html#mkRuntimeRepCo"><span class="hs-identifier hs-var">mkRuntimeRepCo</span></a></span><span> </span><span class="annot"><span class="annottext">Coercion
</span><a href="#local-6989586621681034957"><span class="hs-identifier hs-var">res</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">Coercion
</span><a href="#local-6989586621681034958"><span class="hs-identifier hs-var">arg</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">Coercion
</span><a href="#local-6989586621681034957"><span class="hs-identifier hs-var">res</span></a></span><span class="hs-special">]</span><span>
</span><span id="line-539"></span><span class="annot"><a href="GHC.Core.Coercion.html#splitTyConAppCo_maybe"><span class="hs-identifier hs-var">splitTyConAppCo_maybe</span></a></span><span> </span><span class="annot"><span class="annottext">Coercion
</span><span class="hs-identifier">_</span></span><span>                     </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">forall a. Maybe a
</span><a href="../../base-4.16.4.0/src/GHC-Maybe.html#Nothing"><span class="hs-identifier hs-var">Nothing</span></a></span><span>
</span><span id="line-540"></span><span>
</span><span id="line-541"></span><span class="annot"><a href="GHC.Core.Coercion.html#multToCo"><span class="hs-identifier hs-type">multToCo</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><a href="GHC.Core.TyCo.Rep.html#Mult"><span class="hs-identifier hs-type">Mult</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="GHC.Core.TyCo.Rep.html#Coercion"><span class="hs-identifier hs-type">Coercion</span></a></span><span>
</span><span id="line-542"></span><span id="multToCo"><span class="annot"><span class="annottext">multToCo :: Type -&gt; Coercion
</span><a href="GHC.Core.Coercion.html#multToCo"><span class="hs-identifier hs-var hs-var">multToCo</span></a></span></span><span> </span><span id="local-6989586621681034952"><span class="annot"><span class="annottext">Type
</span><a href="#local-6989586621681034952"><span class="hs-identifier hs-var">r</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">Type -&gt; Coercion
</span><a href="GHC.Core.Coercion.html#mkNomReflCo"><span class="hs-identifier hs-var">mkNomReflCo</span></a></span><span> </span><span class="annot"><span class="annottext">Type
</span><a href="#local-6989586621681034952"><span class="hs-identifier hs-var">r</span></a></span><span>
</span><span id="line-543"></span><span>
</span><span id="line-544"></span><span class="hs-comment">-- first result has role equal to input; third result is Nominal</span><span>
</span><span id="line-545"></span><span class="annot"><a href="GHC.Core.Coercion.html#splitAppCo_maybe"><span class="hs-identifier hs-type">splitAppCo_maybe</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><a href="GHC.Core.TyCo.Rep.html#Coercion"><span class="hs-identifier hs-type">Coercion</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="../../base-4.16.4.0/src/GHC-Maybe.html#Maybe"><span class="hs-identifier hs-type">Maybe</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="GHC.Core.TyCo.Rep.html#Coercion"><span class="hs-identifier hs-type">Coercion</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><a href="GHC.Core.TyCo.Rep.html#Coercion"><span class="hs-identifier hs-type">Coercion</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-546"></span><span class="hs-comment">-- ^ Attempt to take a coercion application apart.</span><span>
</span><span id="line-547"></span><span id="splitAppCo_maybe"><span class="annot"><span class="annottext">splitAppCo_maybe :: Coercion -&gt; Maybe (Coercion, Coercion)
</span><a href="GHC.Core.Coercion.html#splitAppCo_maybe"><span class="hs-identifier hs-var hs-var">splitAppCo_maybe</span></a></span></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="GHC.Core.TyCo.Rep.html#AppCo"><span class="hs-identifier hs-type">AppCo</span></a></span><span> </span><span id="local-6989586621681034950"><span class="annot"><span class="annottext">Coercion
</span><a href="#local-6989586621681034950"><span class="hs-identifier hs-var">co</span></a></span></span><span> </span><span id="local-6989586621681034949"><span class="annot"><span class="annottext">Coercion
</span><a href="#local-6989586621681034949"><span class="hs-identifier hs-var">arg</span></a></span></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">forall a. a -&gt; Maybe a
</span><a href="../../base-4.16.4.0/src/GHC-Maybe.html#Just"><span class="hs-identifier hs-var">Just</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Coercion
</span><a href="#local-6989586621681034950"><span class="hs-identifier hs-var">co</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">Coercion
</span><a href="#local-6989586621681034949"><span class="hs-identifier hs-var">arg</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-548"></span><span class="annot"><a href="GHC.Core.Coercion.html#splitAppCo_maybe"><span class="hs-identifier hs-var">splitAppCo_maybe</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="GHC.Core.TyCo.Rep.html#TyConAppCo"><span class="hs-identifier hs-type">TyConAppCo</span></a></span><span> </span><span id="local-6989586621681034948"><span class="annot"><span class="annottext">Role
</span><a href="#local-6989586621681034948"><span class="hs-identifier hs-var">r</span></a></span></span><span> </span><span id="local-6989586621681034947"><span class="annot"><span class="annottext">TyCon
</span><a href="#local-6989586621681034947"><span class="hs-identifier hs-var">tc</span></a></span></span><span> </span><span id="local-6989586621681034946"><span class="annot"><span class="annottext">[Coercion]
</span><a href="#local-6989586621681034946"><span class="hs-identifier hs-var">args</span></a></span></span><span class="hs-special">)</span><span>
</span><span id="line-549"></span><span>  </span><span class="hs-glyph">|</span><span> </span><span class="annot"><span class="annottext">[Coercion]
</span><a href="#local-6989586621681034946"><span class="hs-identifier hs-var">args</span></a></span><span> </span><span class="annot"><span class="annottext">forall a. [a] -&gt; Int -&gt; Bool
</span><a href="GHC.Utils.Misc.html#lengthExceeds"><span class="hs-operator hs-var">`lengthExceeds`</span></a></span><span> </span><span class="annot"><span class="annottext">TyCon -&gt; Int
</span><a href="GHC.Core.TyCon.html#tyConArity"><span class="hs-identifier hs-var">tyConArity</span></a></span><span> </span><span class="annot"><span class="annottext">TyCon
</span><a href="#local-6989586621681034947"><span class="hs-identifier hs-var">tc</span></a></span><span>
</span><span id="line-550"></span><span>  </span><span class="hs-special">,</span><span> </span><span class="annot"><a href="../../base-4.16.4.0/src/GHC-Maybe.html#Just"><span class="hs-identifier hs-type">Just</span></a></span><span> </span><span class="hs-special">(</span><span id="local-6989586621681034943"><span class="annot"><span class="annottext">[Coercion]
</span><a href="#local-6989586621681034943"><span class="hs-identifier hs-var">args'</span></a></span></span><span class="hs-special">,</span><span> </span><span id="local-6989586621681034942"><span class="annot"><span class="annottext">Coercion
</span><a href="#local-6989586621681034942"><span class="hs-identifier hs-var">arg'</span></a></span></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">forall a. [a] -&gt; Maybe ([a], a)
</span><a href="GHC.Utils.Misc.html#snocView"><span class="hs-identifier hs-var">snocView</span></a></span><span> </span><span class="annot"><span class="annottext">[Coercion]
</span><a href="#local-6989586621681034946"><span class="hs-identifier hs-var">args</span></a></span><span>
</span><span id="line-551"></span><span>  </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">forall a. a -&gt; Maybe a
</span><a href="../../base-4.16.4.0/src/GHC-Maybe.html#Just"><span class="hs-identifier hs-var">Just</span></a></span><span> </span><span class="hs-special">(</span><span> </span><span class="annot"><span class="annottext">HasDebugCallStack =&gt; Role -&gt; TyCon -&gt; [Coercion] -&gt; Coercion
</span><a href="GHC.Core.Coercion.html#mkTyConAppCo"><span class="hs-identifier hs-var">mkTyConAppCo</span></a></span><span> </span><span class="annot"><span class="annottext">Role
</span><a href="#local-6989586621681034948"><span class="hs-identifier hs-var">r</span></a></span><span> </span><span class="annot"><span class="annottext">TyCon
</span><a href="#local-6989586621681034947"><span class="hs-identifier hs-var">tc</span></a></span><span> </span><span class="annot"><span class="annottext">[Coercion]
</span><a href="#local-6989586621681034943"><span class="hs-identifier hs-var">args'</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">Coercion
</span><a href="#local-6989586621681034942"><span class="hs-identifier hs-var">arg'</span></a></span><span> </span><span class="hs-special">)</span><span>
</span><span id="line-552"></span><span>
</span><span id="line-553"></span><span>  </span><span class="hs-glyph">|</span><span> </span><span class="annot"><span class="annottext">Bool -&gt; Bool
</span><span class="hs-identifier hs-var">not</span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">TyCon -&gt; Bool
</span><a href="GHC.Core.TyCon.html#mustBeSaturated"><span class="hs-identifier hs-var">mustBeSaturated</span></a></span><span> </span><span class="annot"><span class="annottext">TyCon
</span><a href="#local-6989586621681034947"><span class="hs-identifier hs-var">tc</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-554"></span><span>    </span><span class="hs-comment">-- Never create unsaturated type family apps!</span><span>
</span><span id="line-555"></span><span>  </span><span class="hs-special">,</span><span> </span><span class="annot"><a href="../../base-4.16.4.0/src/GHC-Maybe.html#Just"><span class="hs-identifier hs-type">Just</span></a></span><span> </span><span class="hs-special">(</span><span id="local-6989586621681034939"><span class="annot"><span class="annottext">[Coercion]
</span><a href="#local-6989586621681034939"><span class="hs-identifier hs-var">args'</span></a></span></span><span class="hs-special">,</span><span> </span><span id="local-6989586621681034938"><span class="annot"><span class="annottext">Coercion
</span><a href="#local-6989586621681034938"><span class="hs-identifier hs-var">arg'</span></a></span></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">forall a. [a] -&gt; Maybe ([a], a)
</span><a href="GHC.Utils.Misc.html#snocView"><span class="hs-identifier hs-var">snocView</span></a></span><span> </span><span class="annot"><span class="annottext">[Coercion]
</span><a href="#local-6989586621681034946"><span class="hs-identifier hs-var">args</span></a></span><span>
</span><span id="line-556"></span><span>  </span><span class="hs-special">,</span><span> </span><span class="annot"><a href="../../base-4.16.4.0/src/GHC-Maybe.html#Just"><span class="hs-identifier hs-type">Just</span></a></span><span> </span><span id="local-6989586621681034937"><span class="annot"><span class="annottext">Coercion
</span><a href="#local-6989586621681034937"><span class="hs-identifier hs-var">arg''</span></a></span></span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">Role -&gt; Coercion -&gt; Maybe Coercion
</span><a href="GHC.Core.Coercion.html#setNominalRole_maybe"><span class="hs-identifier hs-var">setNominalRole_maybe</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Role -&gt; TyCon -&gt; Int -&gt; Role
</span><a href="GHC.Core.Coercion.html#nthRole"><span class="hs-identifier hs-var">nthRole</span></a></span><span> </span><span class="annot"><span class="annottext">Role
</span><a href="#local-6989586621681034948"><span class="hs-identifier hs-var">r</span></a></span><span> </span><span class="annot"><span class="annottext">TyCon
</span><a href="#local-6989586621681034947"><span class="hs-identifier hs-var">tc</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">forall (t :: * -&gt; *) a. Foldable t =&gt; t a -&gt; Int
</span><a href="../../base-4.16.4.0/src/Data-Foldable.html#length"><span class="hs-identifier hs-var">length</span></a></span><span> </span><span class="annot"><span class="annottext">[Coercion]
</span><a href="#local-6989586621681034939"><span class="hs-identifier hs-var">args'</span></a></span><span class="hs-special">)</span><span class="hs-special">)</span><span> </span><span class="annot"><span class="annottext">Coercion
</span><a href="#local-6989586621681034938"><span class="hs-identifier hs-var">arg'</span></a></span><span>
</span><span id="line-557"></span><span>  </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">forall a. a -&gt; Maybe a
</span><a href="../../base-4.16.4.0/src/GHC-Maybe.html#Just"><span class="hs-identifier hs-var">Just</span></a></span><span> </span><span class="hs-special">(</span><span> </span><span class="annot"><span class="annottext">HasDebugCallStack =&gt; Role -&gt; TyCon -&gt; [Coercion] -&gt; Coercion
</span><a href="GHC.Core.Coercion.html#mkTyConAppCo"><span class="hs-identifier hs-var">mkTyConAppCo</span></a></span><span> </span><span class="annot"><span class="annottext">Role
</span><a href="#local-6989586621681034948"><span class="hs-identifier hs-var">r</span></a></span><span> </span><span class="annot"><span class="annottext">TyCon
</span><a href="#local-6989586621681034947"><span class="hs-identifier hs-var">tc</span></a></span><span> </span><span class="annot"><span class="annottext">[Coercion]
</span><a href="#local-6989586621681034939"><span class="hs-identifier hs-var">args'</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">Coercion
</span><a href="#local-6989586621681034937"><span class="hs-identifier hs-var">arg''</span></a></span><span> </span><span class="hs-special">)</span><span>
</span><span id="line-558"></span><span>       </span><span class="hs-comment">-- Use mkTyConAppCo to preserve the invariant</span><span>
</span><span id="line-559"></span><span>       </span><span class="hs-comment">--  that identity coercions are always represented by Refl</span><span>
</span><span id="line-560"></span><span>
</span><span id="line-561"></span><span class="annot"><a href="GHC.Core.Coercion.html#splitAppCo_maybe"><span class="hs-identifier hs-var">splitAppCo_maybe</span></a></span><span> </span><span id="local-6989586621681034935"><span class="annot"><span class="annottext">Coercion
</span><a href="#local-6989586621681034935"><span class="hs-identifier hs-var">co</span></a></span></span><span>
</span><span id="line-562"></span><span>  </span><span class="hs-glyph">|</span><span> </span><span class="annot"><a href="../../base-4.16.4.0/src/GHC-Maybe.html#Just"><span class="hs-identifier hs-type">Just</span></a></span><span> </span><span class="hs-special">(</span><span id="local-6989586621681034934"><span class="annot"><span class="annottext">Type
</span><a href="#local-6989586621681034934"><span class="hs-identifier hs-var">ty</span></a></span></span><span class="hs-special">,</span><span> </span><span id="local-6989586621681034933"><span class="annot"><span class="annottext">Role
</span><a href="#local-6989586621681034933"><span class="hs-identifier hs-var">r</span></a></span></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">Coercion -&gt; Maybe (Type, Role)
</span><a href="GHC.Core.Coercion.html#isReflCo_maybe"><span class="hs-identifier hs-var">isReflCo_maybe</span></a></span><span> </span><span class="annot"><span class="annottext">Coercion
</span><a href="#local-6989586621681034935"><span class="hs-identifier hs-var">co</span></a></span><span>
</span><span id="line-563"></span><span>  </span><span class="hs-special">,</span><span> </span><span class="annot"><a href="../../base-4.16.4.0/src/GHC-Maybe.html#Just"><span class="hs-identifier hs-type">Just</span></a></span><span> </span><span class="hs-special">(</span><span id="local-6989586621681034932"><span class="annot"><span class="annottext">Type
</span><a href="#local-6989586621681034932"><span class="hs-identifier hs-var">ty1</span></a></span></span><span class="hs-special">,</span><span> </span><span id="local-6989586621681034931"><span class="annot"><span class="annottext">Type
</span><a href="#local-6989586621681034931"><span class="hs-identifier hs-var">ty2</span></a></span></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">Type -&gt; Maybe (Type, Type)
</span><a href="GHC.Core.Type.html#splitAppTy_maybe"><span class="hs-identifier hs-var">splitAppTy_maybe</span></a></span><span> </span><span class="annot"><span class="annottext">Type
</span><a href="#local-6989586621681034934"><span class="hs-identifier hs-var">ty</span></a></span><span>
</span><span id="line-564"></span><span>  </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">forall a. a -&gt; Maybe a
</span><a href="../../base-4.16.4.0/src/GHC-Maybe.html#Just"><span class="hs-identifier hs-var">Just</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Role -&gt; Type -&gt; Coercion
</span><a href="GHC.Core.Coercion.html#mkReflCo"><span class="hs-identifier hs-var">mkReflCo</span></a></span><span> </span><span class="annot"><span class="annottext">Role
</span><a href="#local-6989586621681034933"><span class="hs-identifier hs-var">r</span></a></span><span> </span><span class="annot"><span class="annottext">Type
</span><a href="#local-6989586621681034932"><span class="hs-identifier hs-var">ty1</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">Type -&gt; Coercion
</span><a href="GHC.Core.Coercion.html#mkNomReflCo"><span class="hs-identifier hs-var">mkNomReflCo</span></a></span><span> </span><span class="annot"><span class="annottext">Type
</span><a href="#local-6989586621681034931"><span class="hs-identifier hs-var">ty2</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-565"></span><span class="annot"><a href="GHC.Core.Coercion.html#splitAppCo_maybe"><span class="hs-identifier hs-var">splitAppCo_maybe</span></a></span><span> </span><span class="annot"><span class="annottext">Coercion
</span><span class="hs-identifier">_</span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">forall a. Maybe a
</span><a href="../../base-4.16.4.0/src/GHC-Maybe.html#Nothing"><span class="hs-identifier hs-var">Nothing</span></a></span><span>
</span><span id="line-566"></span><span>
</span><span id="line-567"></span><span class="hs-comment">-- Only used in specialise/Rules</span><span>
</span><span id="line-568"></span><span class="annot"><a href="GHC.Core.Coercion.html#splitFunCo_maybe"><span class="hs-identifier hs-type">splitFunCo_maybe</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><a href="GHC.Core.TyCo.Rep.html#Coercion"><span class="hs-identifier hs-type">Coercion</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="../../base-4.16.4.0/src/GHC-Maybe.html#Maybe"><span class="hs-identifier hs-type">Maybe</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="GHC.Core.TyCo.Rep.html#Coercion"><span class="hs-identifier hs-type">Coercion</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><a href="GHC.Core.TyCo.Rep.html#Coercion"><span class="hs-identifier hs-type">Coercion</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-569"></span><span id="splitFunCo_maybe"><span class="annot"><span class="annottext">splitFunCo_maybe :: Coercion -&gt; Maybe (Coercion, Coercion)
</span><a href="GHC.Core.Coercion.html#splitFunCo_maybe"><span class="hs-identifier hs-var hs-var">splitFunCo_maybe</span></a></span></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="GHC.Core.TyCo.Rep.html#FunCo"><span class="hs-identifier hs-type">FunCo</span></a></span><span> </span><span class="annot"><span class="annottext">Role
</span><span class="hs-identifier">_</span></span><span> </span><span class="annot"><span class="annottext">Coercion
</span><span class="hs-identifier">_</span></span><span> </span><span id="local-6989586621681034929"><span class="annot"><span class="annottext">Coercion
</span><a href="#local-6989586621681034929"><span class="hs-identifier hs-var">arg</span></a></span></span><span> </span><span id="local-6989586621681034928"><span class="annot"><span class="annottext">Coercion
</span><a href="#local-6989586621681034928"><span class="hs-identifier hs-var">res</span></a></span></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">forall a. a -&gt; Maybe a
</span><a href="../../base-4.16.4.0/src/GHC-Maybe.html#Just"><span class="hs-identifier hs-var">Just</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Coercion
</span><a href="#local-6989586621681034929"><span class="hs-identifier hs-var">arg</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">Coercion
</span><a href="#local-6989586621681034928"><span class="hs-identifier hs-var">res</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-570"></span><span class="annot"><a href="GHC.Core.Coercion.html#splitFunCo_maybe"><span class="hs-identifier hs-var">splitFunCo_maybe</span></a></span><span> </span><span class="annot"><span class="annottext">Coercion
</span><span class="hs-identifier">_</span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">forall a. Maybe a
</span><a href="../../base-4.16.4.0/src/GHC-Maybe.html#Nothing"><span class="hs-identifier hs-var">Nothing</span></a></span><span>
</span><span id="line-571"></span><span>
</span><span id="line-572"></span><span class="annot"><a href="GHC.Core.Coercion.html#splitForAllCo_maybe"><span class="hs-identifier hs-type">splitForAllCo_maybe</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><a href="GHC.Core.TyCo.Rep.html#Coercion"><span class="hs-identifier hs-type">Coercion</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="../../base-4.16.4.0/src/GHC-Maybe.html#Maybe"><span class="hs-identifier hs-type">Maybe</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="GHC.Types.Var.html#TyCoVar"><span class="hs-identifier hs-type">TyCoVar</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><a href="GHC.Core.TyCo.Rep.html#Coercion"><span class="hs-identifier hs-type">Coercion</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><a href="GHC.Core.TyCo.Rep.html#Coercion"><span class="hs-identifier hs-type">Coercion</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-573"></span><span id="splitForAllCo_maybe"><span class="annot"><span class="annottext">splitForAllCo_maybe :: Coercion -&gt; Maybe (CoVar, Coercion, Coercion)
</span><a href="GHC.Core.Coercion.html#splitForAllCo_maybe"><span class="hs-identifier hs-var hs-var">splitForAllCo_maybe</span></a></span></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="GHC.Core.TyCo.Rep.html#ForAllCo"><span class="hs-identifier hs-type">ForAllCo</span></a></span><span> </span><span id="local-6989586621681034926"><span class="annot"><span class="annottext">CoVar
</span><a href="#local-6989586621681034926"><span class="hs-identifier hs-var">tv</span></a></span></span><span> </span><span id="local-6989586621681034925"><span class="annot"><span class="annottext">Coercion
</span><a href="#local-6989586621681034925"><span class="hs-identifier hs-var">k_co</span></a></span></span><span> </span><span id="local-6989586621681034924"><span class="annot"><span class="annottext">Coercion
</span><a href="#local-6989586621681034924"><span class="hs-identifier hs-var">co</span></a></span></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">forall a. a -&gt; Maybe a
</span><a href="../../base-4.16.4.0/src/GHC-Maybe.html#Just"><span class="hs-identifier hs-var">Just</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">CoVar
</span><a href="#local-6989586621681034926"><span class="hs-identifier hs-var">tv</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">Coercion
</span><a href="#local-6989586621681034925"><span class="hs-identifier hs-var">k_co</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">Coercion
</span><a href="#local-6989586621681034924"><span class="hs-identifier hs-var">co</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-574"></span><span class="annot"><a href="GHC.Core.Coercion.html#splitForAllCo_maybe"><span class="hs-identifier hs-var">splitForAllCo_maybe</span></a></span><span> </span><span class="annot"><span class="annottext">Coercion
</span><span class="hs-identifier">_</span></span><span>                     </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">forall a. Maybe a
</span><a href="../../base-4.16.4.0/src/GHC-Maybe.html#Nothing"><span class="hs-identifier hs-var">Nothing</span></a></span><span>
</span><span id="line-575"></span><span>
</span><span id="line-576"></span><span class="hs-comment">-- | Like 'splitForAllCo_maybe', but only returns Just for tyvar binder</span><span>
</span><span id="line-577"></span><span class="annot"><a href="GHC.Core.Coercion.html#splitForAllCo_ty_maybe"><span class="hs-identifier hs-type">splitForAllCo_ty_maybe</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><a href="GHC.Core.TyCo.Rep.html#Coercion"><span class="hs-identifier hs-type">Coercion</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="../../base-4.16.4.0/src/GHC-Maybe.html#Maybe"><span class="hs-identifier hs-type">Maybe</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="GHC.Types.Var.html#TyVar"><span class="hs-identifier hs-type">TyVar</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><a href="GHC.Core.TyCo.Rep.html#Coercion"><span class="hs-identifier hs-type">Coercion</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><a href="GHC.Core.TyCo.Rep.html#Coercion"><span class="hs-identifier hs-type">Coercion</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-578"></span><span id="splitForAllCo_ty_maybe"><span class="annot"><span class="annottext">splitForAllCo_ty_maybe :: Coercion -&gt; Maybe (CoVar, Coercion, Coercion)
</span><a href="GHC.Core.Coercion.html#splitForAllCo_ty_maybe"><span class="hs-identifier hs-var hs-var">splitForAllCo_ty_maybe</span></a></span></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="GHC.Core.TyCo.Rep.html#ForAllCo"><span class="hs-identifier hs-type">ForAllCo</span></a></span><span> </span><span id="local-6989586621681034923"><span class="annot"><span class="annottext">CoVar
</span><a href="#local-6989586621681034923"><span class="hs-identifier hs-var">tv</span></a></span></span><span> </span><span id="local-6989586621681034922"><span class="annot"><span class="annottext">Coercion
</span><a href="#local-6989586621681034922"><span class="hs-identifier hs-var">k_co</span></a></span></span><span> </span><span id="local-6989586621681034921"><span class="annot"><span class="annottext">Coercion
</span><a href="#local-6989586621681034921"><span class="hs-identifier hs-var">co</span></a></span></span><span class="hs-special">)</span><span>
</span><span id="line-579"></span><span>  </span><span class="hs-glyph">|</span><span> </span><span class="annot"><span class="annottext">CoVar -&gt; Bool
</span><a href="GHC.Types.Var.html#isTyVar"><span class="hs-identifier hs-var">isTyVar</span></a></span><span> </span><span class="annot"><span class="annottext">CoVar
</span><a href="#local-6989586621681034923"><span class="hs-identifier hs-var">tv</span></a></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">forall a. a -&gt; Maybe a
</span><a href="../../base-4.16.4.0/src/GHC-Maybe.html#Just"><span class="hs-identifier hs-var">Just</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">CoVar
</span><a href="#local-6989586621681034923"><span class="hs-identifier hs-var">tv</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">Coercion
</span><a href="#local-6989586621681034922"><span class="hs-identifier hs-var">k_co</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">Coercion
</span><a href="#local-6989586621681034921"><span class="hs-identifier hs-var">co</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-580"></span><span class="annot"><a href="GHC.Core.Coercion.html#splitForAllCo_ty_maybe"><span class="hs-identifier hs-var">splitForAllCo_ty_maybe</span></a></span><span> </span><span class="annot"><span class="annottext">Coercion
</span><span class="hs-identifier">_</span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">forall a. Maybe a
</span><a href="../../base-4.16.4.0/src/GHC-Maybe.html#Nothing"><span class="hs-identifier hs-var">Nothing</span></a></span><span>
</span><span id="line-581"></span><span>
</span><span id="line-582"></span><span class="hs-comment">-- | Like 'splitForAllCo_maybe', but only returns Just for covar binder</span><span>
</span><span id="line-583"></span><span class="annot"><a href="GHC.Core.Coercion.html#splitForAllCo_co_maybe"><span class="hs-identifier hs-type">splitForAllCo_co_maybe</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><a href="GHC.Core.TyCo.Rep.html#Coercion"><span class="hs-identifier hs-type">Coercion</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="../../base-4.16.4.0/src/GHC-Maybe.html#Maybe"><span class="hs-identifier hs-type">Maybe</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="GHC.Types.Var.html#CoVar"><span class="hs-identifier hs-type">CoVar</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><a href="GHC.Core.TyCo.Rep.html#Coercion"><span class="hs-identifier hs-type">Coercion</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><a href="GHC.Core.TyCo.Rep.html#Coercion"><span class="hs-identifier hs-type">Coercion</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-584"></span><span id="splitForAllCo_co_maybe"><span class="annot"><span class="annottext">splitForAllCo_co_maybe :: Coercion -&gt; Maybe (CoVar, Coercion, Coercion)
</span><a href="GHC.Core.Coercion.html#splitForAllCo_co_maybe"><span class="hs-identifier hs-var hs-var">splitForAllCo_co_maybe</span></a></span></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="GHC.Core.TyCo.Rep.html#ForAllCo"><span class="hs-identifier hs-type">ForAllCo</span></a></span><span> </span><span id="local-6989586621681034919"><span class="annot"><span class="annottext">CoVar
</span><a href="#local-6989586621681034919"><span class="hs-identifier hs-var">cv</span></a></span></span><span> </span><span id="local-6989586621681034918"><span class="annot"><span class="annottext">Coercion
</span><a href="#local-6989586621681034918"><span class="hs-identifier hs-var">k_co</span></a></span></span><span> </span><span id="local-6989586621681034917"><span class="annot"><span class="annottext">Coercion
</span><a href="#local-6989586621681034917"><span class="hs-identifier hs-var">co</span></a></span></span><span class="hs-special">)</span><span>
</span><span id="line-585"></span><span>  </span><span class="hs-glyph">|</span><span> </span><span class="annot"><span class="annottext">CoVar -&gt; Bool
</span><a href="GHC.Types.Var.html#isCoVar"><span class="hs-identifier hs-var">isCoVar</span></a></span><span> </span><span class="annot"><span class="annottext">CoVar
</span><a href="#local-6989586621681034919"><span class="hs-identifier hs-var">cv</span></a></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">forall a. a -&gt; Maybe a
</span><a href="../../base-4.16.4.0/src/GHC-Maybe.html#Just"><span class="hs-identifier hs-var">Just</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">CoVar
</span><a href="#local-6989586621681034919"><span class="hs-identifier hs-var">cv</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">Coercion
</span><a href="#local-6989586621681034918"><span class="hs-identifier hs-var">k_co</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">Coercion
</span><a href="#local-6989586621681034917"><span class="hs-identifier hs-var">co</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-586"></span><span class="annot"><a href="GHC.Core.Coercion.html#splitForAllCo_co_maybe"><span class="hs-identifier hs-var">splitForAllCo_co_maybe</span></a></span><span> </span><span class="annot"><span class="annottext">Coercion
</span><span class="hs-identifier">_</span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">forall a. Maybe a
</span><a href="../../base-4.16.4.0/src/GHC-Maybe.html#Nothing"><span class="hs-identifier hs-var">Nothing</span></a></span><span>
</span><span id="line-587"></span><span>
</span><span id="line-588"></span><span class="hs-comment">-------------------------------------------------------</span><span>
</span><span id="line-589"></span><span class="hs-comment">-- and some coercion kind stuff</span><span>
</span><span id="line-590"></span><span>
</span><span id="line-591"></span><span class="annot"><a href="GHC.Core.Coercion.html#coVarLType"><span class="hs-identifier hs-type">coVarLType</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><a href="GHC.Core.Coercion.html#coVarRType"><span class="hs-identifier hs-type">coVarRType</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><a href="GHC.Utils.Misc.html#HasDebugCallStack"><span class="hs-identifier hs-type">HasDebugCallStack</span></a></span><span> </span><span class="hs-glyph">=&gt;</span><span> </span><span class="annot"><a href="GHC.Types.Var.html#CoVar"><span class="hs-identifier hs-type">CoVar</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="GHC.Core.TyCo.Rep.html#Type"><span class="hs-identifier hs-type">Type</span></a></span><span>
</span><span id="line-592"></span><span id="coVarLType"><span class="annot"><span class="annottext">coVarLType :: HasDebugCallStack =&gt; CoVar -&gt; Type
</span><a href="GHC.Core.Coercion.html#coVarLType"><span class="hs-identifier hs-var hs-var">coVarLType</span></a></span></span><span> </span><span id="local-6989586621681034912"><span class="annot"><span class="annottext">CoVar
</span><a href="#local-6989586621681034912"><span class="hs-identifier hs-var">cv</span></a></span></span><span> </span><span class="hs-glyph">|</span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Type
</span><span class="hs-identifier">_</span></span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">Type
</span><span class="hs-identifier">_</span></span><span class="hs-special">,</span><span> </span><span id="local-6989586621681034911"><span class="annot"><span class="annottext">Type
</span><a href="#local-6989586621681034911"><span class="hs-identifier hs-var">ty1</span></a></span></span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">Type
</span><span class="hs-identifier">_</span></span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">Role
</span><span class="hs-identifier">_</span></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">HasDebugCallStack =&gt; CoVar -&gt; (Type, Type, Type, Type, Role)
</span><a href="GHC.Core.Coercion.html#coVarKindsTypesRole"><span class="hs-identifier hs-var">coVarKindsTypesRole</span></a></span><span> </span><span class="annot"><span class="annottext">CoVar
</span><a href="#local-6989586621681034912"><span class="hs-identifier hs-var">cv</span></a></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">Type
</span><a href="#local-6989586621681034911"><span class="hs-identifier hs-var">ty1</span></a></span><span>
</span><span id="line-593"></span><span id="coVarRType"><span class="annot"><span class="annottext">coVarRType :: HasDebugCallStack =&gt; CoVar -&gt; Type
</span><a href="GHC.Core.Coercion.html#coVarRType"><span class="hs-identifier hs-var hs-var">coVarRType</span></a></span></span><span> </span><span id="local-6989586621681034908"><span class="annot"><span class="annottext">CoVar
</span><a href="#local-6989586621681034908"><span class="hs-identifier hs-var">cv</span></a></span></span><span> </span><span class="hs-glyph">|</span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Type
</span><span class="hs-identifier">_</span></span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">Type
</span><span class="hs-identifier">_</span></span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">Type
</span><span class="hs-identifier">_</span></span><span class="hs-special">,</span><span> </span><span id="local-6989586621681034907"><span class="annot"><span class="annottext">Type
</span><a href="#local-6989586621681034907"><span class="hs-identifier hs-var">ty2</span></a></span></span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">Role
</span><span class="hs-identifier">_</span></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">HasDebugCallStack =&gt; CoVar -&gt; (Type, Type, Type, Type, Role)
</span><a href="GHC.Core.Coercion.html#coVarKindsTypesRole"><span class="hs-identifier hs-var">coVarKindsTypesRole</span></a></span><span> </span><span class="annot"><span class="annottext">CoVar
</span><a href="#local-6989586621681034908"><span class="hs-identifier hs-var">cv</span></a></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">Type
</span><a href="#local-6989586621681034907"><span class="hs-identifier hs-var">ty2</span></a></span><span>
</span><span id="line-594"></span><span>
</span><span id="line-595"></span><span class="annot"><a href="GHC.Core.Coercion.html#coVarTypes"><span class="hs-identifier hs-type">coVarTypes</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><a href="GHC.Utils.Misc.html#HasDebugCallStack"><span class="hs-identifier hs-type">HasDebugCallStack</span></a></span><span> </span><span class="hs-glyph">=&gt;</span><span> </span><span class="annot"><a href="GHC.Types.Var.html#CoVar"><span class="hs-identifier hs-type">CoVar</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="GHC.Data.Pair.html#Pair"><span class="hs-identifier hs-type">Pair</span></a></span><span> </span><span class="annot"><a href="GHC.Core.TyCo.Rep.html#Type"><span class="hs-identifier hs-type">Type</span></a></span><span>
</span><span id="line-596"></span><span id="coVarTypes"><span class="annot"><span class="annottext">coVarTypes :: HasDebugCallStack =&gt; CoVar -&gt; Pair Type
</span><a href="GHC.Core.Coercion.html#coVarTypes"><span class="hs-identifier hs-var hs-var">coVarTypes</span></a></span></span><span> </span><span id="local-6989586621681034904"><span class="annot"><span class="annottext">CoVar
</span><a href="#local-6989586621681034904"><span class="hs-identifier hs-var">cv</span></a></span></span><span>
</span><span id="line-597"></span><span>  </span><span class="hs-glyph">|</span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Type
</span><span class="hs-identifier">_</span></span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">Type
</span><span class="hs-identifier">_</span></span><span class="hs-special">,</span><span> </span><span id="local-6989586621681034903"><span class="annot"><span class="annottext">Type
</span><a href="#local-6989586621681034903"><span class="hs-identifier hs-var">ty1</span></a></span></span><span class="hs-special">,</span><span> </span><span id="local-6989586621681034902"><span class="annot"><span class="annottext">Type
</span><a href="#local-6989586621681034902"><span class="hs-identifier hs-var">ty2</span></a></span></span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">Role
</span><span class="hs-identifier">_</span></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">HasDebugCallStack =&gt; CoVar -&gt; (Type, Type, Type, Type, Role)
</span><a href="GHC.Core.Coercion.html#coVarKindsTypesRole"><span class="hs-identifier hs-var">coVarKindsTypesRole</span></a></span><span> </span><span class="annot"><span class="annottext">CoVar
</span><a href="#local-6989586621681034904"><span class="hs-identifier hs-var">cv</span></a></span><span>
</span><span id="line-598"></span><span>  </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">forall a. a -&gt; a -&gt; Pair a
</span><a href="GHC.Data.Pair.html#Pair"><span class="hs-identifier hs-var">Pair</span></a></span><span> </span><span class="annot"><span class="annottext">Type
</span><a href="#local-6989586621681034903"><span class="hs-identifier hs-var">ty1</span></a></span><span> </span><span class="annot"><span class="annottext">Type
</span><a href="#local-6989586621681034902"><span class="hs-identifier hs-var">ty2</span></a></span><span>
</span><span id="line-599"></span><span>
</span><span id="line-600"></span><span class="annot"><a href="GHC.Core.Coercion.html#coVarKindsTypesRole"><span class="hs-identifier hs-type">coVarKindsTypesRole</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><a href="GHC.Utils.Misc.html#HasDebugCallStack"><span class="hs-identifier hs-type">HasDebugCallStack</span></a></span><span> </span><span class="hs-glyph">=&gt;</span><span> </span><span class="annot"><a href="GHC.Types.Var.html#CoVar"><span class="hs-identifier hs-type">CoVar</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-special">(</span><span class="annot"><a href="GHC.Core.TyCo.Rep.html#Kind"><span class="hs-identifier hs-type">Kind</span></a></span><span class="hs-special">,</span><span class="annot"><a href="GHC.Core.TyCo.Rep.html#Kind"><span class="hs-identifier hs-type">Kind</span></a></span><span class="hs-special">,</span><span class="annot"><a href="GHC.Core.TyCo.Rep.html#Type"><span class="hs-identifier hs-type">Type</span></a></span><span class="hs-special">,</span><span class="annot"><a href="GHC.Core.TyCo.Rep.html#Type"><span class="hs-identifier hs-type">Type</span></a></span><span class="hs-special">,</span><span class="annot"><a href="GHC.Core.Coercion.Axiom.html#Role"><span class="hs-identifier hs-type">Role</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-601"></span><span id="coVarKindsTypesRole"><span class="annot"><span class="annottext">coVarKindsTypesRole :: HasDebugCallStack =&gt; CoVar -&gt; (Type, Type, Type, Type, Role)
</span><a href="GHC.Core.Coercion.html#coVarKindsTypesRole"><span class="hs-identifier hs-var hs-var">coVarKindsTypesRole</span></a></span></span><span> </span><span id="local-6989586621681034895"><span class="annot"><span class="annottext">CoVar
</span><a href="#local-6989586621681034895"><span class="hs-identifier hs-var">cv</span></a></span></span><span>
</span><span id="line-602"></span><span> </span><span class="hs-glyph">|</span><span> </span><span class="annot"><a href="../../base-4.16.4.0/src/GHC-Maybe.html#Just"><span class="hs-identifier hs-type">Just</span></a></span><span> </span><span class="hs-special">(</span><span id="local-6989586621681034894"><span class="annot"><span class="annottext">TyCon
</span><a href="#local-6989586621681034894"><span class="hs-identifier hs-var">tc</span></a></span></span><span class="hs-special">,</span><span> </span><span class="hs-special">[</span><span id="local-6989586621681034893"><span class="annot"><span class="annottext">Type
</span><a href="#local-6989586621681034893"><span class="hs-identifier hs-var">k1</span></a></span></span><span class="hs-special">,</span><span id="local-6989586621681034892"><span class="annot"><span class="annottext">Type
</span><a href="#local-6989586621681034892"><span class="hs-identifier hs-var">k2</span></a></span></span><span class="hs-special">,</span><span id="local-6989586621681034891"><span class="annot"><span class="annottext">Type
</span><a href="#local-6989586621681034891"><span class="hs-identifier hs-var">ty1</span></a></span></span><span class="hs-special">,</span><span id="local-6989586621681034890"><span class="annot"><span class="annottext">Type
</span><a href="#local-6989586621681034890"><span class="hs-identifier hs-var">ty2</span></a></span></span><span class="hs-special">]</span><span class="hs-special">)</span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">HasDebugCallStack =&gt; Type -&gt; Maybe (TyCon, [Type])
</span><a href="GHC.Core.Type.html#splitTyConApp_maybe"><span class="hs-identifier hs-var">splitTyConApp_maybe</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">CoVar -&gt; Type
</span><a href="GHC.Types.Var.html#varType"><span class="hs-identifier hs-var">varType</span></a></span><span> </span><span class="annot"><span class="annottext">CoVar
</span><a href="#local-6989586621681034895"><span class="hs-identifier hs-var">cv</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-603"></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Type
</span><a href="#local-6989586621681034893"><span class="hs-identifier hs-var">k1</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">Type
</span><a href="#local-6989586621681034892"><span class="hs-identifier hs-var">k2</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">Type
</span><a href="#local-6989586621681034891"><span class="hs-identifier hs-var">ty1</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">Type
</span><a href="#local-6989586621681034890"><span class="hs-identifier hs-var">ty2</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">TyCon -&gt; Role
</span><a href="GHC.Core.Coercion.html#eqTyConRole"><span class="hs-identifier hs-var">eqTyConRole</span></a></span><span> </span><span class="annot"><span class="annottext">TyCon
</span><a href="#local-6989586621681034894"><span class="hs-identifier hs-var">tc</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-604"></span><span> </span><span class="hs-glyph">|</span><span> </span><span class="annot"><span class="annottext">Bool
</span><a href="../../base-4.16.4.0/src/GHC-Base.html#otherwise"><span class="hs-identifier hs-var">otherwise</span></a></span><span>
</span><span id="line-605"></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">forall a. HasCallStack =&gt; String -&gt; SDoc -&gt; a
</span><a href="GHC.Utils.Panic.html#pprPanic"><span class="hs-identifier hs-var">pprPanic</span></a></span><span> </span><span class="annot"><span class="annottext">String
</span><span class="hs-string">&quot;coVarKindsTypesRole, non coercion variable&quot;</span></span><span>
</span><span id="line-606"></span><span>            </span><span class="hs-special">(</span><span class="annot"><span class="annottext">forall a. Outputable a =&gt; a -&gt; SDoc
</span><a href="GHC.Utils.Outputable.html#ppr"><span class="hs-identifier hs-var">ppr</span></a></span><span> </span><span class="annot"><span class="annottext">CoVar
</span><a href="#local-6989586621681034895"><span class="hs-identifier hs-var">cv</span></a></span><span> </span><span class="annot"><span class="annottext">SDoc -&gt; SDoc -&gt; SDoc
</span><a href="GHC.Utils.Outputable.html#%24%24"><span class="hs-operator hs-var">$$</span></a></span><span> </span><span class="annot"><span class="annottext">forall a. Outputable a =&gt; a -&gt; SDoc
</span><a href="GHC.Utils.Outputable.html#ppr"><span class="hs-identifier hs-var">ppr</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">CoVar -&gt; Type
</span><a href="GHC.Types.Var.html#varType"><span class="hs-identifier hs-var">varType</span></a></span><span> </span><span class="annot"><span class="annottext">CoVar
</span><a href="#local-6989586621681034895"><span class="hs-identifier hs-var">cv</span></a></span><span class="hs-special">)</span><span class="hs-special">)</span><span>
</span><span id="line-607"></span><span>
</span><span id="line-608"></span><span class="annot"><a href="GHC.Core.Coercion.html#coVarKind"><span class="hs-identifier hs-type">coVarKind</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><a href="GHC.Types.Var.html#CoVar"><span class="hs-identifier hs-type">CoVar</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="GHC.Core.TyCo.Rep.html#Type"><span class="hs-identifier hs-type">Type</span></a></span><span>
</span><span id="line-609"></span><span id="coVarKind"><span class="annot"><span class="annottext">coVarKind :: CoVar -&gt; Type
</span><a href="GHC.Core.Coercion.html#coVarKind"><span class="hs-identifier hs-var hs-var">coVarKind</span></a></span></span><span> </span><span id="local-6989586621681034885"><span class="annot"><span class="annottext">CoVar
</span><a href="#local-6989586621681034885"><span class="hs-identifier hs-var">cv</span></a></span></span><span>
</span><span id="line-610"></span><span>  </span><span class="hs-glyph">=</span><span> </span><span class="hs-identifier">ASSERT</span><span class="hs-special">(</span><span> </span><span class="hs-identifier">isCoVar</span><span> </span><span class="hs-identifier">cv</span><span> </span><span class="hs-special">)</span><span>
</span><span id="line-611"></span><span>    </span><span class="annot"><span class="annottext">CoVar -&gt; Type
</span><a href="GHC.Types.Var.html#varType"><span class="hs-identifier hs-var">varType</span></a></span><span> </span><span class="annot"><span class="annottext">CoVar
</span><a href="#local-6989586621681034885"><span class="hs-identifier hs-var">cv</span></a></span><span>
</span><span id="line-612"></span><span>
</span><span id="line-613"></span><span class="annot"><a href="GHC.Core.Coercion.html#coVarRole"><span class="hs-identifier hs-type">coVarRole</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><a href="GHC.Types.Var.html#CoVar"><span class="hs-identifier hs-type">CoVar</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="GHC.Core.Coercion.Axiom.html#Role"><span class="hs-identifier hs-type">Role</span></a></span><span>
</span><span id="line-614"></span><span id="coVarRole"><span class="annot"><span class="annottext">coVarRole :: CoVar -&gt; Role
</span><a href="GHC.Core.Coercion.html#coVarRole"><span class="hs-identifier hs-var hs-var">coVarRole</span></a></span></span><span> </span><span id="local-6989586621681034883"><span class="annot"><span class="annottext">CoVar
</span><a href="#local-6989586621681034883"><span class="hs-identifier hs-var">cv</span></a></span></span><span>
</span><span id="line-615"></span><span>  </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">TyCon -&gt; Role
</span><a href="GHC.Core.Coercion.html#eqTyConRole"><span class="hs-identifier hs-var">eqTyConRole</span></a></span><span> </span><span class="hs-special">(</span><span class="hs-keyword">case</span><span> </span><span class="annot"><span class="annottext">Type -&gt; Maybe TyCon
</span><a href="GHC.Core.Type.html#tyConAppTyCon_maybe"><span class="hs-identifier hs-var">tyConAppTyCon_maybe</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">CoVar -&gt; Type
</span><a href="GHC.Types.Var.html#varType"><span class="hs-identifier hs-var">varType</span></a></span><span> </span><span class="annot"><span class="annottext">CoVar
</span><a href="#local-6989586621681034883"><span class="hs-identifier hs-var">cv</span></a></span><span class="hs-special">)</span><span> </span><span class="hs-keyword">of</span><span>
</span><span id="line-616"></span><span>                   </span><span class="annot"><a href="../../base-4.16.4.0/src/GHC-Maybe.html#Just"><span class="hs-identifier hs-type">Just</span></a></span><span> </span><span id="local-6989586621681034881"><span class="annot"><span class="annottext">TyCon
</span><a href="#local-6989586621681034881"><span class="hs-identifier hs-var">tc0</span></a></span></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="annottext">TyCon
</span><a href="#local-6989586621681034881"><span class="hs-identifier hs-var">tc0</span></a></span><span>
</span><span id="line-617"></span><span>                   </span><span class="annot"><span class="annottext">Maybe TyCon
</span><a href="../../base-4.16.4.0/src/GHC-Maybe.html#Nothing"><span class="hs-identifier hs-var">Nothing</span></a></span><span>  </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="annottext">forall a. HasCallStack =&gt; String -&gt; SDoc -&gt; a
</span><a href="GHC.Utils.Panic.html#pprPanic"><span class="hs-identifier hs-var">pprPanic</span></a></span><span> </span><span class="annot"><span class="annottext">String
</span><span class="hs-string">&quot;coVarRole: not tyconapp&quot;</span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">forall a. Outputable a =&gt; a -&gt; SDoc
</span><a href="GHC.Utils.Outputable.html#ppr"><span class="hs-identifier hs-var">ppr</span></a></span><span> </span><span class="annot"><span class="annottext">CoVar
</span><a href="#local-6989586621681034883"><span class="hs-identifier hs-var">cv</span></a></span><span class="hs-special">)</span><span class="hs-special">)</span><span>
</span><span id="line-618"></span><span>
</span><span id="line-619"></span><span class="annot"><a href="GHC.Core.Coercion.html#eqTyConRole"><span class="hs-identifier hs-type">eqTyConRole</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><a href="GHC.Core.TyCon.html#TyCon"><span class="hs-identifier hs-type">TyCon</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="GHC.Core.Coercion.Axiom.html#Role"><span class="hs-identifier hs-type">Role</span></a></span><span>
</span><span id="line-620"></span><span class="hs-comment">-- Given (~#) or (~R#) return the Nominal or Representational respectively</span><span>
</span><span id="line-621"></span><span id="eqTyConRole"><span class="annot"><span class="annottext">eqTyConRole :: TyCon -&gt; Role
</span><a href="GHC.Core.Coercion.html#eqTyConRole"><span class="hs-identifier hs-var hs-var">eqTyConRole</span></a></span></span><span> </span><span id="local-6989586621681034880"><span class="annot"><span class="annottext">TyCon
</span><a href="#local-6989586621681034880"><span class="hs-identifier hs-var">tc</span></a></span></span><span>
</span><span id="line-622"></span><span>  </span><span class="hs-glyph">|</span><span> </span><span class="annot"><span class="annottext">TyCon
</span><a href="#local-6989586621681034880"><span class="hs-identifier hs-var">tc</span></a></span><span> </span><span class="annot"><span class="annottext">forall a. Uniquable a =&gt; a -&gt; Unique -&gt; Bool
</span><a href="GHC.Types.Unique.html#hasKey"><span class="hs-operator hs-var">`hasKey`</span></a></span><span> </span><span class="annot"><span class="annottext">Unique
</span><a href="GHC.Builtin.Names.html#eqPrimTyConKey"><span class="hs-identifier hs-var">eqPrimTyConKey</span></a></span><span>
</span><span id="line-623"></span><span>  </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">Role
</span><a href="GHC.Core.Coercion.Axiom.html#Nominal"><span class="hs-identifier hs-var">Nominal</span></a></span><span>
</span><span id="line-624"></span><span>  </span><span class="hs-glyph">|</span><span> </span><span class="annot"><span class="annottext">TyCon
</span><a href="#local-6989586621681034880"><span class="hs-identifier hs-var">tc</span></a></span><span> </span><span class="annot"><span class="annottext">forall a. Uniquable a =&gt; a -&gt; Unique -&gt; Bool
</span><a href="GHC.Types.Unique.html#hasKey"><span class="hs-operator hs-var">`hasKey`</span></a></span><span> </span><span class="annot"><span class="annottext">Unique
</span><a href="GHC.Builtin.Names.html#eqReprPrimTyConKey"><span class="hs-identifier hs-var">eqReprPrimTyConKey</span></a></span><span>
</span><span id="line-625"></span><span>  </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">Role
</span><a href="GHC.Core.Coercion.Axiom.html#Representational"><span class="hs-identifier hs-var">Representational</span></a></span><span>
</span><span id="line-626"></span><span>  </span><span class="hs-glyph">|</span><span> </span><span class="annot"><span class="annottext">Bool
</span><a href="../../base-4.16.4.0/src/GHC-Base.html#otherwise"><span class="hs-identifier hs-var">otherwise</span></a></span><span>
</span><span id="line-627"></span><span>  </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">forall a. HasCallStack =&gt; String -&gt; SDoc -&gt; a
</span><a href="GHC.Utils.Panic.html#pprPanic"><span class="hs-identifier hs-var">pprPanic</span></a></span><span> </span><span class="annot"><span class="annottext">String
</span><span class="hs-string">&quot;eqTyConRole: unknown tycon&quot;</span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">forall a. Outputable a =&gt; a -&gt; SDoc
</span><a href="GHC.Utils.Outputable.html#ppr"><span class="hs-identifier hs-var">ppr</span></a></span><span> </span><span class="annot"><span class="annottext">TyCon
</span><a href="#local-6989586621681034880"><span class="hs-identifier hs-var">tc</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-628"></span><span>
</span><span id="line-629"></span><span class="hs-comment">-- | Given a coercion @co1 :: (a :: TYPE r1) ~ (b :: TYPE r2)@,</span><span>
</span><span id="line-630"></span><span class="hs-comment">-- produce a coercion @rep_co :: r1 ~ r2@.</span><span>
</span><span id="line-631"></span><span class="annot"><a href="GHC.Core.Coercion.html#mkRuntimeRepCo"><span class="hs-identifier hs-type">mkRuntimeRepCo</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><a href="GHC.Utils.Misc.html#HasDebugCallStack"><span class="hs-identifier hs-type">HasDebugCallStack</span></a></span><span> </span><span class="hs-glyph">=&gt;</span><span> </span><span class="annot"><a href="GHC.Core.TyCo.Rep.html#Coercion"><span class="hs-identifier hs-type">Coercion</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="GHC.Core.TyCo.Rep.html#Coercion"><span class="hs-identifier hs-type">Coercion</span></a></span><span>
</span><span id="line-632"></span><span id="mkRuntimeRepCo"><span class="annot"><span class="annottext">mkRuntimeRepCo :: HasDebugCallStack =&gt; Coercion -&gt; Coercion
</span><a href="GHC.Core.Coercion.html#mkRuntimeRepCo"><span class="hs-identifier hs-var hs-var">mkRuntimeRepCo</span></a></span></span><span> </span><span id="local-6989586621681034874"><span class="annot"><span class="annottext">Coercion
</span><a href="#local-6989586621681034874"><span class="hs-identifier hs-var">co</span></a></span></span><span>
</span><span id="line-633"></span><span>  </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">HasDebugCallStack =&gt; Role -&gt; Int -&gt; Coercion -&gt; Coercion
</span><a href="GHC.Core.Coercion.html#mkNthCo"><span class="hs-identifier hs-var">mkNthCo</span></a></span><span> </span><span class="annot"><span class="annottext">Role
</span><a href="GHC.Core.Coercion.Axiom.html#Nominal"><span class="hs-identifier hs-var">Nominal</span></a></span><span> </span><span class="annot"><span class="annottext">Int
</span><span class="hs-number">0</span></span><span> </span><span class="annot"><span class="annottext">Coercion
</span><a href="#local-6989586621681034873"><span class="hs-identifier hs-var">kind_co</span></a></span><span>
</span><span id="line-634"></span><span>  </span><span class="hs-keyword">where</span><span>
</span><span id="line-635"></span><span>    </span><span id="local-6989586621681034873"><span class="annot"><span class="annottext">kind_co :: Coercion
</span><a href="#local-6989586621681034873"><span class="hs-identifier hs-var hs-var">kind_co</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">Coercion -&gt; Coercion
</span><a href="GHC.Core.Coercion.html#mkKindCo"><span class="hs-identifier hs-var">mkKindCo</span></a></span><span> </span><span class="annot"><span class="annottext">Coercion
</span><a href="#local-6989586621681034874"><span class="hs-identifier hs-var">co</span></a></span><span>  </span><span class="hs-comment">-- kind_co :: TYPE r1 ~ TYPE r2</span><span>
</span><span id="line-636"></span><span>                           </span><span class="hs-comment">-- (up to silliness with Constraint)</span><span>
</span><span id="line-637"></span><span>
</span><span id="line-638"></span><span class="annot"><a href="GHC.Core.Coercion.html#isReflCoVar_maybe"><span class="hs-identifier hs-type">isReflCoVar_maybe</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><a href="GHC.Types.Var.html#Var"><span class="hs-identifier hs-type">Var</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="../../base-4.16.4.0/src/GHC-Maybe.html#Maybe"><span class="hs-identifier hs-type">Maybe</span></a></span><span> </span><span class="annot"><a href="GHC.Core.TyCo.Rep.html#Coercion"><span class="hs-identifier hs-type">Coercion</span></a></span><span>
</span><span id="line-639"></span><span class="hs-comment">-- If cv :: t~t then isReflCoVar_maybe cv = Just (Refl t)</span><span>
</span><span id="line-640"></span><span class="hs-comment">-- Works on all kinds of Vars, not just CoVars</span><span>
</span><span id="line-641"></span><span id="isReflCoVar_maybe"><span class="annot"><span class="annottext">isReflCoVar_maybe :: CoVar -&gt; Maybe Coercion
</span><a href="GHC.Core.Coercion.html#isReflCoVar_maybe"><span class="hs-identifier hs-var hs-var">isReflCoVar_maybe</span></a></span></span><span> </span><span id="local-6989586621681034872"><span class="annot"><span class="annottext">CoVar
</span><a href="#local-6989586621681034872"><span class="hs-identifier hs-var">cv</span></a></span></span><span>
</span><span id="line-642"></span><span>  </span><span class="hs-glyph">|</span><span> </span><span class="annot"><span class="annottext">CoVar -&gt; Bool
</span><a href="GHC.Types.Var.html#isCoVar"><span class="hs-identifier hs-var">isCoVar</span></a></span><span> </span><span class="annot"><span class="annottext">CoVar
</span><a href="#local-6989586621681034872"><span class="hs-identifier hs-var">cv</span></a></span><span>
</span><span id="line-643"></span><span>  </span><span class="hs-special">,</span><span> </span><span class="annot"><a href="GHC.Data.Pair.html#Pair"><span class="hs-identifier hs-type">Pair</span></a></span><span> </span><span id="local-6989586621681034871"><span class="annot"><span class="annottext">Type
</span><a href="#local-6989586621681034871"><span class="hs-identifier hs-var">ty1</span></a></span></span><span> </span><span id="local-6989586621681034870"><span class="annot"><span class="annottext">Type
</span><a href="#local-6989586621681034870"><span class="hs-identifier hs-var">ty2</span></a></span></span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">HasDebugCallStack =&gt; CoVar -&gt; Pair Type
</span><a href="GHC.Core.Coercion.html#coVarTypes"><span class="hs-identifier hs-var">coVarTypes</span></a></span><span> </span><span class="annot"><span class="annottext">CoVar
</span><a href="#local-6989586621681034872"><span class="hs-identifier hs-var">cv</span></a></span><span>
</span><span id="line-644"></span><span>  </span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">Type
</span><a href="#local-6989586621681034871"><span class="hs-identifier hs-var">ty1</span></a></span><span> </span><span class="annot"><span class="annottext">Type -&gt; Type -&gt; Bool
</span><a href="GHC.Core.Type.html#eqType"><span class="hs-operator hs-var">`eqType`</span></a></span><span> </span><span class="annot"><span class="annottext">Type
</span><a href="#local-6989586621681034870"><span class="hs-identifier hs-var">ty2</span></a></span><span>
</span><span id="line-645"></span><span>  </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">forall a. a -&gt; Maybe a
</span><a href="../../base-4.16.4.0/src/GHC-Maybe.html#Just"><span class="hs-identifier hs-var">Just</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Role -&gt; Type -&gt; Coercion
</span><a href="GHC.Core.Coercion.html#mkReflCo"><span class="hs-identifier hs-var">mkReflCo</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">CoVar -&gt; Role
</span><a href="GHC.Core.Coercion.html#coVarRole"><span class="hs-identifier hs-var">coVarRole</span></a></span><span> </span><span class="annot"><span class="annottext">CoVar
</span><a href="#local-6989586621681034872"><span class="hs-identifier hs-var">cv</span></a></span><span class="hs-special">)</span><span> </span><span class="annot"><span class="annottext">Type
</span><a href="#local-6989586621681034871"><span class="hs-identifier hs-var">ty1</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-646"></span><span>  </span><span class="hs-glyph">|</span><span> </span><span class="annot"><span class="annottext">Bool
</span><a href="../../base-4.16.4.0/src/GHC-Base.html#otherwise"><span class="hs-identifier hs-var">otherwise</span></a></span><span>
</span><span id="line-647"></span><span>  </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">forall a. Maybe a
</span><a href="../../base-4.16.4.0/src/GHC-Maybe.html#Nothing"><span class="hs-identifier hs-var">Nothing</span></a></span><span>
</span><span id="line-648"></span><span>
</span><span id="line-649"></span><span class="hs-comment">-- | Tests if this coercion is obviously a generalized reflexive coercion.</span><span>
</span><span id="line-650"></span><span class="hs-comment">-- Guaranteed to work very quickly.</span><span>
</span><span id="line-651"></span><span class="annot"><a href="GHC.Core.Coercion.html#isGReflCo"><span class="hs-identifier hs-type">isGReflCo</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><a href="GHC.Core.TyCo.Rep.html#Coercion"><span class="hs-identifier hs-type">Coercion</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="hs-identifier hs-type">Bool</span></span><span>
</span><span id="line-652"></span><span id="isGReflCo"><span class="annot"><span class="annottext">isGReflCo :: Coercion -&gt; Bool
</span><a href="GHC.Core.Coercion.html#isGReflCo"><span class="hs-identifier hs-var hs-var">isGReflCo</span></a></span></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="GHC.Core.TyCo.Rep.html#GRefl"><span class="hs-identifier hs-type">GRefl</span></a></span><span class="hs-special">{</span><span class="hs-special">}</span><span class="hs-special">)</span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">Bool
</span><span class="hs-identifier hs-var">True</span></span><span>
</span><span id="line-653"></span><span class="annot"><a href="GHC.Core.Coercion.html#isGReflCo"><span class="hs-identifier hs-var">isGReflCo</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="GHC.Core.TyCo.Rep.html#Refl"><span class="hs-identifier hs-type">Refl</span></a></span><span class="hs-special">{</span><span class="hs-special">}</span><span class="hs-special">)</span><span>  </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">Bool
</span><span class="hs-identifier hs-var">True</span></span><span> </span><span class="hs-comment">-- Refl ty == GRefl N ty MRefl</span><span>
</span><span id="line-654"></span><span class="annot"><a href="GHC.Core.Coercion.html#isGReflCo"><span class="hs-identifier hs-var">isGReflCo</span></a></span><span> </span><span class="annot"><span class="annottext">Coercion
</span><span class="hs-identifier">_</span></span><span>         </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">Bool
</span><span class="hs-identifier hs-var">False</span></span><span>
</span><span id="line-655"></span><span>
</span><span id="line-656"></span><span class="hs-comment">-- | Tests if this coercion is obviously reflexive. Guaranteed to work</span><span>
</span><span id="line-657"></span><span class="hs-comment">-- very quickly. Sometimes a coercion can be reflexive, but not obviously</span><span>
</span><span id="line-658"></span><span class="hs-comment">-- so. c.f. 'isReflexiveCo'</span><span>
</span><span id="line-659"></span><span class="annot"><a href="GHC.Core.Coercion.html#isReflCo"><span class="hs-identifier hs-type">isReflCo</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><a href="GHC.Core.TyCo.Rep.html#Coercion"><span class="hs-identifier hs-type">Coercion</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="hs-identifier hs-type">Bool</span></span><span>
</span><span id="line-660"></span><span id="isReflCo"><span class="annot"><span class="annottext">isReflCo :: Coercion -&gt; Bool
</span><a href="GHC.Core.Coercion.html#isReflCo"><span class="hs-identifier hs-var hs-var">isReflCo</span></a></span></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="GHC.Core.TyCo.Rep.html#Refl"><span class="hs-identifier hs-type">Refl</span></a></span><span class="hs-special">{</span><span class="hs-special">}</span><span class="hs-special">)</span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">Bool
</span><span class="hs-identifier hs-var">True</span></span><span>
</span><span id="line-661"></span><span class="annot"><a href="GHC.Core.Coercion.html#isReflCo"><span class="hs-identifier hs-var">isReflCo</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="GHC.Core.TyCo.Rep.html#GRefl"><span class="hs-identifier hs-type">GRefl</span></a></span><span> </span><span class="annot"><span class="annottext">Role
</span><span class="hs-identifier">_</span></span><span> </span><span class="annot"><span class="annottext">Type
</span><span class="hs-identifier">_</span></span><span> </span><span id="local-6989586621681034868"><span class="annot"><span class="annottext">MCoercion
</span><a href="#local-6989586621681034868"><span class="hs-identifier hs-var">mco</span></a></span></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">|</span><span> </span><span class="annot"><span class="annottext">MCoercion -&gt; Bool
</span><a href="GHC.Core.Coercion.html#isGReflMCo"><span class="hs-identifier hs-var">isGReflMCo</span></a></span><span> </span><span class="annot"><span class="annottext">MCoercion
</span><a href="#local-6989586621681034868"><span class="hs-identifier hs-var">mco</span></a></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">Bool
</span><span class="hs-identifier hs-var">True</span></span><span>
</span><span id="line-662"></span><span class="annot"><a href="GHC.Core.Coercion.html#isReflCo"><span class="hs-identifier hs-var">isReflCo</span></a></span><span> </span><span class="annot"><span class="annottext">Coercion
</span><span class="hs-identifier">_</span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">Bool
</span><span class="hs-identifier hs-var">False</span></span><span>
</span><span id="line-663"></span><span>
</span><span id="line-664"></span><span class="hs-comment">-- | Returns the type coerced if this coercion is a generalized reflexive</span><span>
</span><span id="line-665"></span><span class="hs-comment">-- coercion. Guaranteed to work very quickly.</span><span>
</span><span id="line-666"></span><span class="annot"><a href="GHC.Core.Coercion.html#isGReflCo_maybe"><span class="hs-identifier hs-type">isGReflCo_maybe</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><a href="GHC.Core.TyCo.Rep.html#Coercion"><span class="hs-identifier hs-type">Coercion</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="../../base-4.16.4.0/src/GHC-Maybe.html#Maybe"><span class="hs-identifier hs-type">Maybe</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="GHC.Core.TyCo.Rep.html#Type"><span class="hs-identifier hs-type">Type</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><a href="GHC.Core.Coercion.Axiom.html#Role"><span class="hs-identifier hs-type">Role</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-667"></span><span id="isGReflCo_maybe"><span class="annot"><span class="annottext">isGReflCo_maybe :: Coercion -&gt; Maybe (Type, Role)
</span><a href="GHC.Core.Coercion.html#isGReflCo_maybe"><span class="hs-identifier hs-var hs-var">isGReflCo_maybe</span></a></span></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="GHC.Core.TyCo.Rep.html#GRefl"><span class="hs-identifier hs-type">GRefl</span></a></span><span> </span><span id="local-6989586621681034867"><span class="annot"><span class="annottext">Role
</span><a href="#local-6989586621681034867"><span class="hs-identifier hs-var">r</span></a></span></span><span> </span><span id="local-6989586621681034866"><span class="annot"><span class="annottext">Type
</span><a href="#local-6989586621681034866"><span class="hs-identifier hs-var">ty</span></a></span></span><span> </span><span class="annot"><span class="annottext">MCoercion
</span><span class="hs-identifier">_</span></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">forall a. a -&gt; Maybe a
</span><a href="../../base-4.16.4.0/src/GHC-Maybe.html#Just"><span class="hs-identifier hs-var">Just</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Type
</span><a href="#local-6989586621681034866"><span class="hs-identifier hs-var">ty</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">Role
</span><a href="#local-6989586621681034867"><span class="hs-identifier hs-var">r</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-668"></span><span class="annot"><a href="GHC.Core.Coercion.html#isGReflCo_maybe"><span class="hs-identifier hs-var">isGReflCo_maybe</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="GHC.Core.TyCo.Rep.html#Refl"><span class="hs-identifier hs-type">Refl</span></a></span><span> </span><span id="local-6989586621681034865"><span class="annot"><span class="annottext">Type
</span><a href="#local-6989586621681034865"><span class="hs-identifier hs-var">ty</span></a></span></span><span class="hs-special">)</span><span>      </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">forall a. a -&gt; Maybe a
</span><a href="../../base-4.16.4.0/src/GHC-Maybe.html#Just"><span class="hs-identifier hs-var">Just</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Type
</span><a href="#local-6989586621681034865"><span class="hs-identifier hs-var">ty</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">Role
</span><a href="GHC.Core.Coercion.Axiom.html#Nominal"><span class="hs-identifier hs-var">Nominal</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-669"></span><span class="annot"><a href="GHC.Core.Coercion.html#isGReflCo_maybe"><span class="hs-identifier hs-var">isGReflCo_maybe</span></a></span><span> </span><span class="annot"><span class="annottext">Coercion
</span><span class="hs-identifier">_</span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">forall a. Maybe a
</span><a href="../../base-4.16.4.0/src/GHC-Maybe.html#Nothing"><span class="hs-identifier hs-var">Nothing</span></a></span><span>
</span><span id="line-670"></span><span>
</span><span id="line-671"></span><span class="hs-comment">-- | Returns the type coerced if this coercion is reflexive. Guaranteed</span><span>
</span><span id="line-672"></span><span class="hs-comment">-- to work very quickly. Sometimes a coercion can be reflexive, but not</span><span>
</span><span id="line-673"></span><span class="hs-comment">-- obviously so. c.f. 'isReflexiveCo_maybe'</span><span>
</span><span id="line-674"></span><span class="annot"><a href="GHC.Core.Coercion.html#isReflCo_maybe"><span class="hs-identifier hs-type">isReflCo_maybe</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><a href="GHC.Core.TyCo.Rep.html#Coercion"><span class="hs-identifier hs-type">Coercion</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="../../base-4.16.4.0/src/GHC-Maybe.html#Maybe"><span class="hs-identifier hs-type">Maybe</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="GHC.Core.TyCo.Rep.html#Type"><span class="hs-identifier hs-type">Type</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><a href="GHC.Core.Coercion.Axiom.html#Role"><span class="hs-identifier hs-type">Role</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-675"></span><span id="isReflCo_maybe"><span class="annot"><span class="annottext">isReflCo_maybe :: Coercion -&gt; Maybe (Type, Role)
</span><a href="GHC.Core.Coercion.html#isReflCo_maybe"><span class="hs-identifier hs-var hs-var">isReflCo_maybe</span></a></span></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="GHC.Core.TyCo.Rep.html#Refl"><span class="hs-identifier hs-type">Refl</span></a></span><span> </span><span id="local-6989586621681034864"><span class="annot"><span class="annottext">Type
</span><a href="#local-6989586621681034864"><span class="hs-identifier hs-var">ty</span></a></span></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">forall a. a -&gt; Maybe a
</span><a href="../../base-4.16.4.0/src/GHC-Maybe.html#Just"><span class="hs-identifier hs-var">Just</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Type
</span><a href="#local-6989586621681034864"><span class="hs-identifier hs-var">ty</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">Role
</span><a href="GHC.Core.Coercion.Axiom.html#Nominal"><span class="hs-identifier hs-var">Nominal</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-676"></span><span class="annot"><a href="GHC.Core.Coercion.html#isReflCo_maybe"><span class="hs-identifier hs-var">isReflCo_maybe</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="GHC.Core.TyCo.Rep.html#GRefl"><span class="hs-identifier hs-type">GRefl</span></a></span><span> </span><span id="local-6989586621681034863"><span class="annot"><span class="annottext">Role
</span><a href="#local-6989586621681034863"><span class="hs-identifier hs-var">r</span></a></span></span><span> </span><span id="local-6989586621681034862"><span class="annot"><span class="annottext">Type
</span><a href="#local-6989586621681034862"><span class="hs-identifier hs-var">ty</span></a></span></span><span> </span><span id="local-6989586621681034861"><span class="annot"><span class="annottext">MCoercion
</span><a href="#local-6989586621681034861"><span class="hs-identifier hs-var">mco</span></a></span></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">|</span><span> </span><span class="annot"><span class="annottext">MCoercion -&gt; Bool
</span><a href="GHC.Core.Coercion.html#isGReflMCo"><span class="hs-identifier hs-var">isGReflMCo</span></a></span><span> </span><span class="annot"><span class="annottext">MCoercion
</span><a href="#local-6989586621681034861"><span class="hs-identifier hs-var">mco</span></a></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">forall a. a -&gt; Maybe a
</span><a href="../../base-4.16.4.0/src/GHC-Maybe.html#Just"><span class="hs-identifier hs-var">Just</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Type
</span><a href="#local-6989586621681034862"><span class="hs-identifier hs-var">ty</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">Role
</span><a href="#local-6989586621681034863"><span class="hs-identifier hs-var">r</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-677"></span><span class="annot"><a href="GHC.Core.Coercion.html#isReflCo_maybe"><span class="hs-identifier hs-var">isReflCo_maybe</span></a></span><span> </span><span class="annot"><span class="annottext">Coercion
</span><span class="hs-identifier">_</span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">forall a. Maybe a
</span><a href="../../base-4.16.4.0/src/GHC-Maybe.html#Nothing"><span class="hs-identifier hs-var">Nothing</span></a></span><span>
</span><span id="line-678"></span><span>
</span><span id="line-679"></span><span class="hs-comment">-- | Slowly checks if the coercion is reflexive. Don't call this in a loop,</span><span>
</span><span id="line-680"></span><span class="hs-comment">-- as it walks over the entire coercion.</span><span>
</span><span id="line-681"></span><span class="annot"><a href="GHC.Core.Coercion.html#isReflexiveCo"><span class="hs-identifier hs-type">isReflexiveCo</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><a href="GHC.Core.TyCo.Rep.html#Coercion"><span class="hs-identifier hs-type">Coercion</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="hs-identifier hs-type">Bool</span></span><span>
</span><span id="line-682"></span><span id="isReflexiveCo"><span class="annot"><span class="annottext">isReflexiveCo :: Coercion -&gt; Bool
</span><a href="GHC.Core.Coercion.html#isReflexiveCo"><span class="hs-identifier hs-var hs-var">isReflexiveCo</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">forall a. Maybe a -&gt; Bool
</span><a href="../../base-4.16.4.0/src/Data-Maybe.html#isJust"><span class="hs-identifier hs-var">isJust</span></a></span><span> </span><span class="annot"><span class="annottext">forall b c a. (b -&gt; c) -&gt; (a -&gt; b) -&gt; a -&gt; c
</span><a href="../../base-4.16.4.0/src/GHC-Base.html#."><span class="hs-operator hs-var">.</span></a></span><span> </span><span class="annot"><span class="annottext">Coercion -&gt; Maybe (Type, Role)
</span><a href="GHC.Core.Coercion.html#isReflexiveCo_maybe"><span class="hs-identifier hs-var">isReflexiveCo_maybe</span></a></span><span>
</span><span id="line-683"></span><span>
</span><span id="line-684"></span><span class="hs-comment">-- | Extracts the coerced type from a reflexive coercion. This potentially</span><span>
</span><span id="line-685"></span><span class="hs-comment">-- walks over the entire coercion, so avoid doing this in a loop.</span><span>
</span><span id="line-686"></span><span class="annot"><a href="GHC.Core.Coercion.html#isReflexiveCo_maybe"><span class="hs-identifier hs-type">isReflexiveCo_maybe</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><a href="GHC.Core.TyCo.Rep.html#Coercion"><span class="hs-identifier hs-type">Coercion</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="../../base-4.16.4.0/src/GHC-Maybe.html#Maybe"><span class="hs-identifier hs-type">Maybe</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="GHC.Core.TyCo.Rep.html#Type"><span class="hs-identifier hs-type">Type</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><a href="GHC.Core.Coercion.Axiom.html#Role"><span class="hs-identifier hs-type">Role</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-687"></span><span id="isReflexiveCo_maybe"><span class="annot"><span class="annottext">isReflexiveCo_maybe :: Coercion -&gt; Maybe (Type, Role)
</span><a href="GHC.Core.Coercion.html#isReflexiveCo_maybe"><span class="hs-identifier hs-var hs-var">isReflexiveCo_maybe</span></a></span></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="GHC.Core.TyCo.Rep.html#Refl"><span class="hs-identifier hs-type">Refl</span></a></span><span> </span><span id="local-6989586621681034858"><span class="annot"><span class="annottext">Type
</span><a href="#local-6989586621681034858"><span class="hs-identifier hs-var">ty</span></a></span></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">forall a. a -&gt; Maybe a
</span><a href="../../base-4.16.4.0/src/GHC-Maybe.html#Just"><span class="hs-identifier hs-var">Just</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Type
</span><a href="#local-6989586621681034858"><span class="hs-identifier hs-var">ty</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">Role
</span><a href="GHC.Core.Coercion.Axiom.html#Nominal"><span class="hs-identifier hs-var">Nominal</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-688"></span><span class="annot"><a href="GHC.Core.Coercion.html#isReflexiveCo_maybe"><span class="hs-identifier hs-var">isReflexiveCo_maybe</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="GHC.Core.TyCo.Rep.html#GRefl"><span class="hs-identifier hs-type">GRefl</span></a></span><span> </span><span id="local-6989586621681034857"><span class="annot"><span class="annottext">Role
</span><a href="#local-6989586621681034857"><span class="hs-identifier hs-var">r</span></a></span></span><span> </span><span id="local-6989586621681034856"><span class="annot"><span class="annottext">Type
</span><a href="#local-6989586621681034856"><span class="hs-identifier hs-var">ty</span></a></span></span><span> </span><span id="local-6989586621681034855"><span class="annot"><span class="annottext">MCoercion
</span><a href="#local-6989586621681034855"><span class="hs-identifier hs-var">mco</span></a></span></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">|</span><span> </span><span class="annot"><span class="annottext">MCoercion -&gt; Bool
</span><a href="GHC.Core.Coercion.html#isGReflMCo"><span class="hs-identifier hs-var">isGReflMCo</span></a></span><span> </span><span class="annot"><span class="annottext">MCoercion
</span><a href="#local-6989586621681034855"><span class="hs-identifier hs-var">mco</span></a></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">forall a. a -&gt; Maybe a
</span><a href="../../base-4.16.4.0/src/GHC-Maybe.html#Just"><span class="hs-identifier hs-var">Just</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Type
</span><a href="#local-6989586621681034856"><span class="hs-identifier hs-var">ty</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">Role
</span><a href="#local-6989586621681034857"><span class="hs-identifier hs-var">r</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-689"></span><span class="annot"><a href="GHC.Core.Coercion.html#isReflexiveCo_maybe"><span class="hs-identifier hs-var">isReflexiveCo_maybe</span></a></span><span> </span><span id="local-6989586621681034854"><span class="annot"><span class="annottext">Coercion
</span><a href="#local-6989586621681034854"><span class="hs-identifier hs-var">co</span></a></span></span><span>
</span><span id="line-690"></span><span>  </span><span class="hs-glyph">|</span><span> </span><span class="annot"><span class="annottext">Type
</span><a href="#local-6989586621681034853"><span class="hs-identifier hs-var">ty1</span></a></span><span> </span><span class="annot"><span class="annottext">Type -&gt; Type -&gt; Bool
</span><a href="GHC.Core.Type.html#eqType"><span class="hs-operator hs-var">`eqType`</span></a></span><span> </span><span class="annot"><span class="annottext">Type
</span><a href="#local-6989586621681034852"><span class="hs-identifier hs-var">ty2</span></a></span><span>
</span><span id="line-691"></span><span>  </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">forall a. a -&gt; Maybe a
</span><a href="../../base-4.16.4.0/src/GHC-Maybe.html#Just"><span class="hs-identifier hs-var">Just</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Type
</span><a href="#local-6989586621681034853"><span class="hs-identifier hs-var">ty1</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">Role
</span><a href="#local-6989586621681034851"><span class="hs-identifier hs-var">r</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-692"></span><span>  </span><span class="hs-glyph">|</span><span> </span><span class="annot"><span class="annottext">Bool
</span><a href="../../base-4.16.4.0/src/GHC-Base.html#otherwise"><span class="hs-identifier hs-var">otherwise</span></a></span><span>
</span><span id="line-693"></span><span>  </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">forall a. Maybe a
</span><a href="../../base-4.16.4.0/src/GHC-Maybe.html#Nothing"><span class="hs-identifier hs-var">Nothing</span></a></span><span>
</span><span id="line-694"></span><span>  </span><span class="hs-keyword">where</span><span> </span><span class="hs-special">(</span><span class="annot"><a href="GHC.Data.Pair.html#Pair"><span class="hs-identifier hs-type">Pair</span></a></span><span> </span><span id="local-6989586621681034853"><span class="annot"><span class="annottext">Type
</span><a href="#local-6989586621681034853"><span class="hs-identifier hs-var">ty1</span></a></span></span><span> </span><span id="local-6989586621681034852"><span class="annot"><span class="annottext">Type
</span><a href="#local-6989586621681034852"><span class="hs-identifier hs-var">ty2</span></a></span></span><span class="hs-special">,</span><span> </span><span id="local-6989586621681034851"><span class="annot"><span class="annottext">Role
</span><a href="#local-6989586621681034851"><span class="hs-identifier hs-var">r</span></a></span></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">Coercion -&gt; (Pair Type, Role)
</span><a href="GHC.Core.Coercion.html#coercionKindRole"><span class="hs-identifier hs-var">coercionKindRole</span></a></span><span> </span><span class="annot"><span class="annottext">Coercion
</span><a href="#local-6989586621681034854"><span class="hs-identifier hs-var">co</span></a></span><span>
</span><span id="line-695"></span><span>
</span><span id="line-696"></span><span>
</span><span id="line-697"></span><span class="hs-comment">{-
%************************************************************************
%*                                                                      *
            Building coercions
%*                                                                      *
%************************************************************************

These &quot;smart constructors&quot; maintain the invariants listed in the definition
of Coercion, and they perform very basic optimizations.

Note [Role twiddling functions]
~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~

There are a plethora of functions for twiddling roles:

mkSubCo: Requires a nominal input coercion and always produces a
representational output. This is used when you (the programmer) are sure you
know exactly that role you have and what you want.

downgradeRole_maybe: This function takes both the input role and the output role
as parameters. (The *output* role comes first!) It can only *downgrade* a
role -- that is, change it from N to R or P, or from R to P. This one-way
behavior is why there is the &quot;_maybe&quot;. If an upgrade is requested, this
function produces Nothing. This is used when you need to change the role of a
coercion, but you're not sure (as you're writing the code) of which roles are
involved.

This function could have been written using coercionRole to ascertain the role
of the input. But, that function is recursive, and the caller of downgradeRole_maybe
often knows the input role. So, this is more efficient.

downgradeRole: This is just like downgradeRole_maybe, but it panics if the
conversion isn't a downgrade.

setNominalRole_maybe: This is the only function that can *upgrade* a coercion.
The result (if it exists) is always Nominal. The input can be at any role. It
works on a &quot;best effort&quot; basis, as it should never be strictly necessary to
upgrade a coercion during compilation. It is currently only used within GHC in
splitAppCo_maybe. In order to be a proper inverse of mkAppCo, the second
coercion that splitAppCo_maybe returns must be nominal. But, it's conceivable
that splitAppCo_maybe is operating over a TyConAppCo that uses a
representational coercion. Hence the need for setNominalRole_maybe.
splitAppCo_maybe, in turn, is used only within coercion optimization -- thus,
it is not absolutely critical that setNominalRole_maybe be complete.

Note that setNominalRole_maybe will never upgrade a phantom UnivCo. Phantom
UnivCos are perfectly type-safe, whereas representational and nominal ones are
not. (Nominal ones are no worse than representational ones, so this function *will*
change a UnivCo Representational to a UnivCo Nominal.)

Conal Elliott also came across a need for this function while working with the
GHC API, as he was decomposing Core casts. The Core casts use representational
coercions, as they must, but his use case required nominal coercions (he was
building a GADT). So, that's why this function is exported from this module.

One might ask: shouldn't downgradeRole_maybe just use setNominalRole_maybe as
appropriate? I (Richard E.) have decided not to do this, because upgrading a
role is bizarre and a caller should have to ask for this behavior explicitly.

-}</span><span>
</span><span id="line-757"></span><span>
</span><span id="line-758"></span><span class="hs-comment">-- | Make a reflexive coercion</span><span>
</span><span id="line-759"></span><span class="annot"><a href="GHC.Core.Coercion.html#mkReflCo"><span class="hs-identifier hs-type">mkReflCo</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><a href="GHC.Core.Coercion.Axiom.html#Role"><span class="hs-identifier hs-type">Role</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="GHC.Core.TyCo.Rep.html#Type"><span class="hs-identifier hs-type">Type</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="GHC.Core.TyCo.Rep.html#Coercion"><span class="hs-identifier hs-type">Coercion</span></a></span><span>
</span><span id="line-760"></span><span id="mkReflCo"><span class="annot"><span class="annottext">mkReflCo :: Role -&gt; Type -&gt; Coercion
</span><a href="GHC.Core.Coercion.html#mkReflCo"><span class="hs-identifier hs-var hs-var">mkReflCo</span></a></span></span><span> </span><span class="annot"><span class="annottext">Role
</span><a href="GHC.Core.Coercion.Axiom.html#Nominal"><span class="hs-identifier hs-var">Nominal</span></a></span><span> </span><span id="local-6989586621681034850"><span class="annot"><span class="annottext">Type
</span><a href="#local-6989586621681034850"><span class="hs-identifier hs-var">ty</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">Type -&gt; Coercion
</span><a href="GHC.Core.TyCo.Rep.html#Refl"><span class="hs-identifier hs-var">Refl</span></a></span><span> </span><span class="annot"><span class="annottext">Type
</span><a href="#local-6989586621681034850"><span class="hs-identifier hs-var">ty</span></a></span><span>
</span><span id="line-761"></span><span class="annot"><a href="GHC.Core.Coercion.html#mkReflCo"><span class="hs-identifier hs-var">mkReflCo</span></a></span><span> </span><span id="local-6989586621681034849"><span class="annot"><span class="annottext">Role
</span><a href="#local-6989586621681034849"><span class="hs-identifier hs-var">r</span></a></span></span><span>       </span><span id="local-6989586621681034848"><span class="annot"><span class="annottext">Type
</span><a href="#local-6989586621681034848"><span class="hs-identifier hs-var">ty</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">Role -&gt; Type -&gt; MCoercion -&gt; Coercion
</span><a href="GHC.Core.TyCo.Rep.html#GRefl"><span class="hs-identifier hs-var">GRefl</span></a></span><span> </span><span class="annot"><span class="annottext">Role
</span><a href="#local-6989586621681034849"><span class="hs-identifier hs-var">r</span></a></span><span> </span><span class="annot"><span class="annottext">Type
</span><a href="#local-6989586621681034848"><span class="hs-identifier hs-var">ty</span></a></span><span> </span><span class="annot"><span class="annottext">MCoercion
</span><a href="GHC.Core.TyCo.Rep.html#MRefl"><span class="hs-identifier hs-var">MRefl</span></a></span><span>
</span><span id="line-762"></span><span>
</span><span id="line-763"></span><span class="hs-comment">-- | Make a representational reflexive coercion</span><span>
</span><span id="line-764"></span><span class="annot"><a href="GHC.Core.Coercion.html#mkRepReflCo"><span class="hs-identifier hs-type">mkRepReflCo</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><a href="GHC.Core.TyCo.Rep.html#Type"><span class="hs-identifier hs-type">Type</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="GHC.Core.TyCo.Rep.html#Coercion"><span class="hs-identifier hs-type">Coercion</span></a></span><span>
</span><span id="line-765"></span><span id="mkRepReflCo"><span class="annot"><span class="annottext">mkRepReflCo :: Type -&gt; Coercion
</span><a href="GHC.Core.Coercion.html#mkRepReflCo"><span class="hs-identifier hs-var hs-var">mkRepReflCo</span></a></span></span><span> </span><span id="local-6989586621681034847"><span class="annot"><span class="annottext">Type
</span><a href="#local-6989586621681034847"><span class="hs-identifier hs-var">ty</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">Role -&gt; Type -&gt; MCoercion -&gt; Coercion
</span><a href="GHC.Core.TyCo.Rep.html#GRefl"><span class="hs-identifier hs-var">GRefl</span></a></span><span> </span><span class="annot"><span class="annottext">Role
</span><a href="GHC.Core.Coercion.Axiom.html#Representational"><span class="hs-identifier hs-var">Representational</span></a></span><span> </span><span class="annot"><span class="annottext">Type
</span><a href="#local-6989586621681034847"><span class="hs-identifier hs-var">ty</span></a></span><span> </span><span class="annot"><span class="annottext">MCoercion
</span><a href="GHC.Core.TyCo.Rep.html#MRefl"><span class="hs-identifier hs-var">MRefl</span></a></span><span>
</span><span id="line-766"></span><span>
</span><span id="line-767"></span><span class="hs-comment">-- | Make a nominal reflexive coercion</span><span>
</span><span id="line-768"></span><span class="annot"><a href="GHC.Core.Coercion.html#mkNomReflCo"><span class="hs-identifier hs-type">mkNomReflCo</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><a href="GHC.Core.TyCo.Rep.html#Type"><span class="hs-identifier hs-type">Type</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="GHC.Core.TyCo.Rep.html#Coercion"><span class="hs-identifier hs-type">Coercion</span></a></span><span>
</span><span id="line-769"></span><span id="mkNomReflCo"><span class="annot"><span class="annottext">mkNomReflCo :: Type -&gt; Coercion
</span><a href="GHC.Core.Coercion.html#mkNomReflCo"><span class="hs-identifier hs-var hs-var">mkNomReflCo</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">Type -&gt; Coercion
</span><a href="GHC.Core.TyCo.Rep.html#Refl"><span class="hs-identifier hs-var">Refl</span></a></span><span>
</span><span id="line-770"></span><span>
</span><span id="line-771"></span><span class="hs-comment">-- | Apply a type constructor to a list of coercions. It is the</span><span>
</span><span id="line-772"></span><span class="hs-comment">-- caller's responsibility to get the roles correct on argument coercions.</span><span>
</span><span id="line-773"></span><span class="annot"><a href="GHC.Core.Coercion.html#mkTyConAppCo"><span class="hs-identifier hs-type">mkTyConAppCo</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><a href="GHC.Utils.Misc.html#HasDebugCallStack"><span class="hs-identifier hs-type">HasDebugCallStack</span></a></span><span> </span><span class="hs-glyph">=&gt;</span><span> </span><span class="annot"><a href="GHC.Core.Coercion.Axiom.html#Role"><span class="hs-identifier hs-type">Role</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="GHC.Core.TyCon.html#TyCon"><span class="hs-identifier hs-type">TyCon</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-special">[</span><span class="annot"><a href="GHC.Core.TyCo.Rep.html#Coercion"><span class="hs-identifier hs-type">Coercion</span></a></span><span class="hs-special">]</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="GHC.Core.TyCo.Rep.html#Coercion"><span class="hs-identifier hs-type">Coercion</span></a></span><span>
</span><span id="line-774"></span><span id="mkTyConAppCo"><span class="annot"><span class="annottext">mkTyConAppCo :: HasDebugCallStack =&gt; Role -&gt; TyCon -&gt; [Coercion] -&gt; Coercion
</span><a href="GHC.Core.Coercion.html#mkTyConAppCo"><span class="hs-identifier hs-var hs-var">mkTyConAppCo</span></a></span></span><span> </span><span id="local-6989586621681034841"><span class="annot"><span class="annottext">Role
</span><a href="#local-6989586621681034841"><span class="hs-identifier hs-var">r</span></a></span></span><span> </span><span id="local-6989586621681034840"><span class="annot"><span class="annottext">TyCon
</span><a href="#local-6989586621681034840"><span class="hs-identifier hs-var">tc</span></a></span></span><span> </span><span id="local-6989586621681034839"><span class="annot"><span class="annottext">[Coercion]
</span><a href="#local-6989586621681034839"><span class="hs-identifier hs-var">cos</span></a></span></span><span>
</span><span id="line-775"></span><span>  </span><span class="hs-glyph">|</span><span> </span><span class="hs-special">[</span><span id="local-6989586621681034838"><span class="annot"><span class="annottext">Coercion
</span><a href="#local-6989586621681034838"><span class="hs-identifier hs-var">w</span></a></span></span><span class="hs-special">,</span><span> </span><span id="local-6989586621681034837"><span class="annot"><span class="annottext">Coercion
</span><a href="#local-6989586621681034837"><span class="hs-identifier hs-var">_rep1</span></a></span></span><span class="hs-special">,</span><span> </span><span id="local-6989586621681034836"><span class="annot"><span class="annottext">Coercion
</span><a href="#local-6989586621681034836"><span class="hs-identifier hs-var">_rep2</span></a></span></span><span class="hs-special">,</span><span> </span><span id="local-6989586621681034835"><span class="annot"><span class="annottext">Coercion
</span><a href="#local-6989586621681034835"><span class="hs-identifier hs-var">co1</span></a></span></span><span class="hs-special">,</span><span> </span><span id="local-6989586621681034834"><span class="annot"><span class="annottext">Coercion
</span><a href="#local-6989586621681034834"><span class="hs-identifier hs-var">co2</span></a></span></span><span class="hs-special">]</span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">[Coercion]
</span><a href="#local-6989586621681034839"><span class="hs-identifier hs-var">cos</span></a></span><span>   </span><span class="hs-comment">-- See Note [Function coercions]</span><span>
</span><span id="line-776"></span><span>  </span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">TyCon -&gt; Bool
</span><a href="GHC.Core.TyCon.html#isFunTyCon"><span class="hs-identifier hs-var">isFunTyCon</span></a></span><span> </span><span class="annot"><span class="annottext">TyCon
</span><a href="#local-6989586621681034840"><span class="hs-identifier hs-var">tc</span></a></span><span>
</span><span id="line-777"></span><span>  </span><span class="hs-glyph">=</span><span> </span><span class="hs-comment">-- (a :: TYPE ra) -&gt; (b :: TYPE rb)  ~  (c :: TYPE rc) -&gt; (d :: TYPE rd)</span><span>
</span><span id="line-778"></span><span>    </span><span class="hs-comment">-- rep1 :: ra  ~  rc        rep2 :: rb  ~  rd</span><span>
</span><span id="line-779"></span><span>    </span><span class="hs-comment">-- co1  :: a   ~  c         co2  :: b   ~  d</span><span>
</span><span id="line-780"></span><span>    </span><span class="annot"><span class="annottext">Role -&gt; Coercion -&gt; Coercion -&gt; Coercion -&gt; Coercion
</span><a href="GHC.Core.Coercion.html#mkFunCo"><span class="hs-identifier hs-var">mkFunCo</span></a></span><span> </span><span class="annot"><span class="annottext">Role
</span><a href="#local-6989586621681034841"><span class="hs-identifier hs-var">r</span></a></span><span> </span><span class="annot"><span class="annottext">Coercion
</span><a href="#local-6989586621681034838"><span class="hs-identifier hs-var">w</span></a></span><span> </span><span class="annot"><span class="annottext">Coercion
</span><a href="#local-6989586621681034835"><span class="hs-identifier hs-var">co1</span></a></span><span> </span><span class="annot"><span class="annottext">Coercion
</span><a href="#local-6989586621681034834"><span class="hs-identifier hs-var">co2</span></a></span><span>
</span><span id="line-781"></span><span>
</span><span id="line-782"></span><span>               </span><span class="hs-comment">-- Expand type synonyms</span><span>
</span><span id="line-783"></span><span>  </span><span class="hs-glyph">|</span><span> </span><span class="annot"><a href="../../base-4.16.4.0/src/GHC-Maybe.html#Just"><span class="hs-identifier hs-type">Just</span></a></span><span> </span><span class="hs-special">(</span><span id="local-6989586621681034832"><span class="annot"><span class="annottext">[(CoVar, Coercion)]
</span><a href="#local-6989586621681034832"><span class="hs-identifier hs-var">tv_co_prs</span></a></span></span><span class="hs-special">,</span><span> </span><span id="local-6989586621681034831"><span class="annot"><span class="annottext">Type
</span><a href="#local-6989586621681034831"><span class="hs-identifier hs-var">rhs_ty</span></a></span></span><span class="hs-special">,</span><span> </span><span id="local-6989586621681034830"><span class="annot"><span class="annottext">[Coercion]
</span><a href="#local-6989586621681034830"><span class="hs-identifier hs-var">leftover_cos</span></a></span></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">forall tyco.
TyCon -&gt; [tyco] -&gt; Maybe ([(CoVar, tyco)], Type, [tyco])
</span><a href="GHC.Core.TyCon.html#expandSynTyCon_maybe"><span class="hs-identifier hs-var">expandSynTyCon_maybe</span></a></span><span> </span><span class="annot"><span class="annottext">TyCon
</span><a href="#local-6989586621681034840"><span class="hs-identifier hs-var">tc</span></a></span><span> </span><span class="annot"><span class="annottext">[Coercion]
</span><a href="#local-6989586621681034839"><span class="hs-identifier hs-var">cos</span></a></span><span>
</span><span id="line-784"></span><span>  </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">Coercion -&gt; [Coercion] -&gt; Coercion
</span><a href="GHC.Core.Coercion.html#mkAppCos"><span class="hs-identifier hs-var">mkAppCos</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">HasDebugCallStack =&gt; Role -&gt; LiftingContext -&gt; Type -&gt; Coercion
</span><a href="GHC.Core.Coercion.html#liftCoSubst"><span class="hs-identifier hs-var">liftCoSubst</span></a></span><span> </span><span class="annot"><span class="annottext">Role
</span><a href="#local-6989586621681034841"><span class="hs-identifier hs-var">r</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">[(CoVar, Coercion)] -&gt; LiftingContext
</span><a href="GHC.Core.Coercion.html#mkLiftingContext"><span class="hs-identifier hs-var">mkLiftingContext</span></a></span><span> </span><span class="annot"><span class="annottext">[(CoVar, Coercion)]
</span><a href="#local-6989586621681034832"><span class="hs-identifier hs-var">tv_co_prs</span></a></span><span class="hs-special">)</span><span> </span><span class="annot"><span class="annottext">Type
</span><a href="#local-6989586621681034831"><span class="hs-identifier hs-var">rhs_ty</span></a></span><span class="hs-special">)</span><span> </span><span class="annot"><span class="annottext">[Coercion]
</span><a href="#local-6989586621681034830"><span class="hs-identifier hs-var">leftover_cos</span></a></span><span>
</span><span id="line-785"></span><span>
</span><span id="line-786"></span><span>  </span><span class="hs-glyph">|</span><span> </span><span class="annot"><a href="../../base-4.16.4.0/src/GHC-Maybe.html#Just"><span class="hs-identifier hs-type">Just</span></a></span><span> </span><span id="local-6989586621681034827"><span class="annot"><span class="annottext">[(Type, Role)]
</span><a href="#local-6989586621681034827"><span class="hs-identifier hs-var">tys_roles</span></a></span></span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">forall (t :: * -&gt; *) (f :: * -&gt; *) a b.
(Traversable t, Applicative f) =&gt;
(a -&gt; f b) -&gt; t a -&gt; f (t b)
</span><a href="../../base-4.16.4.0/src/Data-Traversable.html#traverse"><span class="hs-identifier hs-var">traverse</span></a></span><span> </span><span class="annot"><span class="annottext">Coercion -&gt; Maybe (Type, Role)
</span><a href="GHC.Core.Coercion.html#isReflCo_maybe"><span class="hs-identifier hs-var">isReflCo_maybe</span></a></span><span> </span><span class="annot"><span class="annottext">[Coercion]
</span><a href="#local-6989586621681034839"><span class="hs-identifier hs-var">cos</span></a></span><span>
</span><span id="line-787"></span><span>  </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">Role -&gt; Type -&gt; Coercion
</span><a href="GHC.Core.Coercion.html#mkReflCo"><span class="hs-identifier hs-var">mkReflCo</span></a></span><span> </span><span class="annot"><span class="annottext">Role
</span><a href="#local-6989586621681034841"><span class="hs-identifier hs-var">r</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">TyCon -&gt; [Type] -&gt; Type
</span><a href="GHC.Core.Type.html#mkTyConApp"><span class="hs-identifier hs-var">mkTyConApp</span></a></span><span> </span><span class="annot"><span class="annottext">TyCon
</span><a href="#local-6989586621681034840"><span class="hs-identifier hs-var">tc</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">forall a b. (a -&gt; b) -&gt; [a] -&gt; [b]
</span><a href="../../base-4.16.4.0/src/GHC-Base.html#map"><span class="hs-identifier hs-var">map</span></a></span><span> </span><span class="annot"><span class="annottext">forall a b. (a, b) -&gt; a
</span><a href="../../base-4.16.4.0/src/Data-Tuple.html#fst"><span class="hs-identifier hs-var">fst</span></a></span><span> </span><span class="annot"><span class="annottext">[(Type, Role)]
</span><a href="#local-6989586621681034827"><span class="hs-identifier hs-var">tys_roles</span></a></span><span class="hs-special">)</span><span class="hs-special">)</span><span>
</span><span id="line-788"></span><span>  </span><span class="hs-comment">-- See Note [Refl invariant]</span><span>
</span><span id="line-789"></span><span>
</span><span id="line-790"></span><span>  </span><span class="hs-glyph">|</span><span> </span><span class="annot"><span class="annottext">Bool
</span><a href="../../base-4.16.4.0/src/GHC-Base.html#otherwise"><span class="hs-identifier hs-var">otherwise</span></a></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">Role -&gt; TyCon -&gt; [Coercion] -&gt; Coercion
</span><a href="GHC.Core.TyCo.Rep.html#TyConAppCo"><span class="hs-identifier hs-var">TyConAppCo</span></a></span><span> </span><span class="annot"><span class="annottext">Role
</span><a href="#local-6989586621681034841"><span class="hs-identifier hs-var">r</span></a></span><span> </span><span class="annot"><span class="annottext">TyCon
</span><a href="#local-6989586621681034840"><span class="hs-identifier hs-var">tc</span></a></span><span> </span><span class="annot"><span class="annottext">[Coercion]
</span><a href="#local-6989586621681034839"><span class="hs-identifier hs-var">cos</span></a></span><span>
</span><span id="line-791"></span><span>
</span><span id="line-792"></span><span class="hs-comment">-- | Build a function 'Coercion' from two other 'Coercion's. That is,</span><span>
</span><span id="line-793"></span><span class="hs-comment">-- given @co1 :: a ~ b@ and @co2 :: x ~ y@ produce @co :: (a -&gt; x) ~ (b -&gt; y)@.</span><span>
</span><span id="line-794"></span><span class="annot"><a href="GHC.Core.Coercion.html#mkFunCo"><span class="hs-identifier hs-type">mkFunCo</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><a href="GHC.Core.Coercion.Axiom.html#Role"><span class="hs-identifier hs-type">Role</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="GHC.Core.TyCo.Rep.html#CoercionN"><span class="hs-identifier hs-type">CoercionN</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="GHC.Core.TyCo.Rep.html#Coercion"><span class="hs-identifier hs-type">Coercion</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="GHC.Core.TyCo.Rep.html#Coercion"><span class="hs-identifier hs-type">Coercion</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="GHC.Core.TyCo.Rep.html#Coercion"><span class="hs-identifier hs-type">Coercion</span></a></span><span>
</span><span id="line-795"></span><span id="mkFunCo"><span class="annot"><span class="annottext">mkFunCo :: Role -&gt; Coercion -&gt; Coercion -&gt; Coercion -&gt; Coercion
</span><a href="GHC.Core.Coercion.html#mkFunCo"><span class="hs-identifier hs-var hs-var">mkFunCo</span></a></span></span><span> </span><span id="local-6989586621681034824"><span class="annot"><span class="annottext">Role
</span><a href="#local-6989586621681034824"><span class="hs-identifier hs-var">r</span></a></span></span><span> </span><span id="local-6989586621681034823"><span class="annot"><span class="annottext">Coercion
</span><a href="#local-6989586621681034823"><span class="hs-identifier hs-var">w</span></a></span></span><span> </span><span id="local-6989586621681034822"><span class="annot"><span class="annottext">Coercion
</span><a href="#local-6989586621681034822"><span class="hs-identifier hs-var">co1</span></a></span></span><span> </span><span id="local-6989586621681034821"><span class="annot"><span class="annottext">Coercion
</span><a href="#local-6989586621681034821"><span class="hs-identifier hs-var">co2</span></a></span></span><span>
</span><span id="line-796"></span><span>    </span><span class="hs-comment">-- See Note [Refl invariant]</span><span>
</span><span id="line-797"></span><span>  </span><span class="hs-glyph">|</span><span> </span><span class="annot"><a href="../../base-4.16.4.0/src/GHC-Maybe.html#Just"><span class="hs-identifier hs-type">Just</span></a></span><span> </span><span class="hs-special">(</span><span id="local-6989586621681034820"><span class="annot"><span class="annottext">Type
</span><a href="#local-6989586621681034820"><span class="hs-identifier hs-var">ty1</span></a></span></span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">Role
</span><span class="hs-identifier">_</span></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">Coercion -&gt; Maybe (Type, Role)
</span><a href="GHC.Core.Coercion.html#isReflCo_maybe"><span class="hs-identifier hs-var">isReflCo_maybe</span></a></span><span> </span><span class="annot"><span class="annottext">Coercion
</span><a href="#local-6989586621681034822"><span class="hs-identifier hs-var">co1</span></a></span><span>
</span><span id="line-798"></span><span>  </span><span class="hs-special">,</span><span> </span><span class="annot"><a href="../../base-4.16.4.0/src/GHC-Maybe.html#Just"><span class="hs-identifier hs-type">Just</span></a></span><span> </span><span class="hs-special">(</span><span id="local-6989586621681034819"><span class="annot"><span class="annottext">Type
</span><a href="#local-6989586621681034819"><span class="hs-identifier hs-var">ty2</span></a></span></span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">Role
</span><span class="hs-identifier">_</span></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">Coercion -&gt; Maybe (Type, Role)
</span><a href="GHC.Core.Coercion.html#isReflCo_maybe"><span class="hs-identifier hs-var">isReflCo_maybe</span></a></span><span> </span><span class="annot"><span class="annottext">Coercion
</span><a href="#local-6989586621681034821"><span class="hs-identifier hs-var">co2</span></a></span><span>
</span><span id="line-799"></span><span>  </span><span class="hs-special">,</span><span> </span><span class="annot"><a href="../../base-4.16.4.0/src/GHC-Maybe.html#Just"><span class="hs-identifier hs-type">Just</span></a></span><span> </span><span class="hs-special">(</span><span id="local-6989586621681034818"><span class="annot"><span class="annottext">Type
</span><a href="#local-6989586621681034818"><span class="hs-identifier hs-var">w</span></a></span></span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">Role
</span><span class="hs-identifier">_</span></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">Coercion -&gt; Maybe (Type, Role)
</span><a href="GHC.Core.Coercion.html#isReflCo_maybe"><span class="hs-identifier hs-var">isReflCo_maybe</span></a></span><span> </span><span class="annot"><span class="annottext">Coercion
</span><a href="#local-6989586621681034823"><span class="hs-identifier hs-var">w</span></a></span><span>
</span><span id="line-800"></span><span>  </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">Role -&gt; Type -&gt; Coercion
</span><a href="GHC.Core.Coercion.html#mkReflCo"><span class="hs-identifier hs-var">mkReflCo</span></a></span><span> </span><span class="annot"><span class="annottext">Role
</span><a href="#local-6989586621681034824"><span class="hs-identifier hs-var">r</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Type -&gt; Type -&gt; Type -&gt; Type
</span><a href="GHC.Core.TyCo.Rep.html#mkVisFunTy"><span class="hs-identifier hs-var">mkVisFunTy</span></a></span><span> </span><span class="annot"><span class="annottext">Type
</span><a href="#local-6989586621681034818"><span class="hs-identifier hs-var">w</span></a></span><span> </span><span class="annot"><span class="annottext">Type
</span><a href="#local-6989586621681034820"><span class="hs-identifier hs-var">ty1</span></a></span><span> </span><span class="annot"><span class="annottext">Type
</span><a href="#local-6989586621681034819"><span class="hs-identifier hs-var">ty2</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-801"></span><span>  </span><span class="hs-glyph">|</span><span> </span><span class="annot"><span class="annottext">Bool
</span><a href="../../base-4.16.4.0/src/GHC-Base.html#otherwise"><span class="hs-identifier hs-var">otherwise</span></a></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">Role -&gt; Coercion -&gt; Coercion -&gt; Coercion -&gt; Coercion
</span><a href="GHC.Core.TyCo.Rep.html#FunCo"><span class="hs-identifier hs-var">FunCo</span></a></span><span> </span><span class="annot"><span class="annottext">Role
</span><a href="#local-6989586621681034824"><span class="hs-identifier hs-var">r</span></a></span><span> </span><span class="annot"><span class="annottext">Coercion
</span><a href="#local-6989586621681034823"><span class="hs-identifier hs-var">w</span></a></span><span> </span><span class="annot"><span class="annottext">Coercion
</span><a href="#local-6989586621681034822"><span class="hs-identifier hs-var">co1</span></a></span><span> </span><span class="annot"><span class="annottext">Coercion
</span><a href="#local-6989586621681034821"><span class="hs-identifier hs-var">co2</span></a></span><span>
</span><span id="line-802"></span><span>
</span><span id="line-803"></span><span class="hs-comment">-- | Apply a 'Coercion' to another 'Coercion'.</span><span>
</span><span id="line-804"></span><span class="hs-comment">-- The second coercion must be Nominal, unless the first is Phantom.</span><span>
</span><span id="line-805"></span><span class="hs-comment">-- If the first is Phantom, then the second can be either Phantom or Nominal.</span><span>
</span><span id="line-806"></span><span class="annot"><a href="GHC.Core.Coercion.html#mkAppCo"><span class="hs-identifier hs-type">mkAppCo</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><a href="GHC.Core.TyCo.Rep.html#Coercion"><span class="hs-identifier hs-type">Coercion</span></a></span><span>     </span><span class="hs-comment">-- ^ :: t1 ~r t2</span><span>
</span><span id="line-807"></span><span>        </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="GHC.Core.TyCo.Rep.html#Coercion"><span class="hs-identifier hs-type">Coercion</span></a></span><span>     </span><span class="hs-comment">-- ^ :: s1 ~N s2, where s1 :: k1, s2 :: k2</span><span>
</span><span id="line-808"></span><span>        </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="GHC.Core.TyCo.Rep.html#Coercion"><span class="hs-identifier hs-type">Coercion</span></a></span><span>     </span><span class="hs-comment">-- ^ :: t1 s1 ~r t2 s2</span><span>
</span><span id="line-809"></span><span id="mkAppCo"><span class="annot"><span class="annottext">mkAppCo :: Coercion -&gt; Coercion -&gt; Coercion
</span><a href="GHC.Core.Coercion.html#mkAppCo"><span class="hs-identifier hs-var hs-var">mkAppCo</span></a></span></span><span> </span><span id="local-6989586621681034816"><span class="annot"><span class="annottext">Coercion
</span><a href="#local-6989586621681034816"><span class="hs-identifier hs-var">co</span></a></span></span><span> </span><span id="local-6989586621681034815"><span class="annot"><span class="annottext">Coercion
</span><a href="#local-6989586621681034815"><span class="hs-identifier hs-var">arg</span></a></span></span><span>
</span><span id="line-810"></span><span>  </span><span class="hs-glyph">|</span><span> </span><span class="annot"><a href="../../base-4.16.4.0/src/GHC-Maybe.html#Just"><span class="hs-identifier hs-type">Just</span></a></span><span> </span><span class="hs-special">(</span><span id="local-6989586621681034814"><span class="annot"><span class="annottext">Type
</span><a href="#local-6989586621681034814"><span class="hs-identifier hs-var">ty1</span></a></span></span><span class="hs-special">,</span><span> </span><span id="local-6989586621681034813"><span class="annot"><span class="annottext">Role
</span><a href="#local-6989586621681034813"><span class="hs-identifier hs-var">r</span></a></span></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">Coercion -&gt; Maybe (Type, Role)
</span><a href="GHC.Core.Coercion.html#isReflCo_maybe"><span class="hs-identifier hs-var">isReflCo_maybe</span></a></span><span> </span><span class="annot"><span class="annottext">Coercion
</span><a href="#local-6989586621681034816"><span class="hs-identifier hs-var">co</span></a></span><span>
</span><span id="line-811"></span><span>  </span><span class="hs-special">,</span><span> </span><span class="annot"><a href="../../base-4.16.4.0/src/GHC-Maybe.html#Just"><span class="hs-identifier hs-type">Just</span></a></span><span> </span><span class="hs-special">(</span><span id="local-6989586621681034812"><span class="annot"><span class="annottext">Type
</span><a href="#local-6989586621681034812"><span class="hs-identifier hs-var">ty2</span></a></span></span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">Role
</span><span class="hs-identifier">_</span></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">Coercion -&gt; Maybe (Type, Role)
</span><a href="GHC.Core.Coercion.html#isReflCo_maybe"><span class="hs-identifier hs-var">isReflCo_maybe</span></a></span><span> </span><span class="annot"><span class="annottext">Coercion
</span><a href="#local-6989586621681034815"><span class="hs-identifier hs-var">arg</span></a></span><span>
</span><span id="line-812"></span><span>  </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">Role -&gt; Type -&gt; Coercion
</span><a href="GHC.Core.Coercion.html#mkReflCo"><span class="hs-identifier hs-var">mkReflCo</span></a></span><span> </span><span class="annot"><span class="annottext">Role
</span><a href="#local-6989586621681034813"><span class="hs-identifier hs-var">r</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Type -&gt; Type -&gt; Type
</span><a href="GHC.Core.Type.html#mkAppTy"><span class="hs-identifier hs-var">mkAppTy</span></a></span><span> </span><span class="annot"><span class="annottext">Type
</span><a href="#local-6989586621681034814"><span class="hs-identifier hs-var">ty1</span></a></span><span> </span><span class="annot"><span class="annottext">Type
</span><a href="#local-6989586621681034812"><span class="hs-identifier hs-var">ty2</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-813"></span><span>
</span><span id="line-814"></span><span>  </span><span class="hs-glyph">|</span><span> </span><span class="annot"><a href="../../base-4.16.4.0/src/GHC-Maybe.html#Just"><span class="hs-identifier hs-type">Just</span></a></span><span> </span><span class="hs-special">(</span><span id="local-6989586621681034810"><span class="annot"><span class="annottext">Type
</span><a href="#local-6989586621681034810"><span class="hs-identifier hs-var">ty1</span></a></span></span><span class="hs-special">,</span><span> </span><span id="local-6989586621681034809"><span class="annot"><span class="annottext">Role
</span><a href="#local-6989586621681034809"><span class="hs-identifier hs-var">r</span></a></span></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">Coercion -&gt; Maybe (Type, Role)
</span><a href="GHC.Core.Coercion.html#isReflCo_maybe"><span class="hs-identifier hs-var">isReflCo_maybe</span></a></span><span> </span><span class="annot"><span class="annottext">Coercion
</span><a href="#local-6989586621681034816"><span class="hs-identifier hs-var">co</span></a></span><span>
</span><span id="line-815"></span><span>  </span><span class="hs-special">,</span><span> </span><span class="annot"><a href="../../base-4.16.4.0/src/GHC-Maybe.html#Just"><span class="hs-identifier hs-type">Just</span></a></span><span> </span><span class="hs-special">(</span><span id="local-6989586621681034808"><span class="annot"><span class="annottext">TyCon
</span><a href="#local-6989586621681034808"><span class="hs-identifier hs-var">tc</span></a></span></span><span class="hs-special">,</span><span> </span><span id="local-6989586621681034807"><span class="annot"><span class="annottext">[Type]
</span><a href="#local-6989586621681034807"><span class="hs-identifier hs-var">tys</span></a></span></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">HasDebugCallStack =&gt; Type -&gt; Maybe (TyCon, [Type])
</span><a href="GHC.Core.Type.html#splitTyConApp_maybe"><span class="hs-identifier hs-var">splitTyConApp_maybe</span></a></span><span> </span><span class="annot"><span class="annottext">Type
</span><a href="#local-6989586621681034810"><span class="hs-identifier hs-var">ty1</span></a></span><span>
</span><span id="line-816"></span><span>    </span><span class="hs-comment">-- Expand type synonyms; a TyConAppCo can't have a type synonym (#9102)</span><span>
</span><span id="line-817"></span><span>  </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">HasDebugCallStack =&gt; Role -&gt; TyCon -&gt; [Coercion] -&gt; Coercion
</span><a href="GHC.Core.Coercion.html#mkTyConAppCo"><span class="hs-identifier hs-var">mkTyConAppCo</span></a></span><span> </span><span class="annot"><span class="annottext">Role
</span><a href="#local-6989586621681034809"><span class="hs-identifier hs-var">r</span></a></span><span> </span><span class="annot"><span class="annottext">TyCon
</span><a href="#local-6989586621681034808"><span class="hs-identifier hs-var">tc</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">[Role] -&gt; [Type] -&gt; [Coercion]
</span><a href="#local-6989586621681034806"><span class="hs-identifier hs-var">zip_roles</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Role -&gt; TyCon -&gt; [Role]
</span><a href="GHC.Core.Coercion.html#tyConRolesX"><span class="hs-identifier hs-var">tyConRolesX</span></a></span><span> </span><span class="annot"><span class="annottext">Role
</span><a href="#local-6989586621681034809"><span class="hs-identifier hs-var">r</span></a></span><span> </span><span class="annot"><span class="annottext">TyCon
</span><a href="#local-6989586621681034808"><span class="hs-identifier hs-var">tc</span></a></span><span class="hs-special">)</span><span> </span><span class="annot"><span class="annottext">[Type]
</span><a href="#local-6989586621681034807"><span class="hs-identifier hs-var">tys</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-818"></span><span>  </span><span class="hs-keyword">where</span><span>
</span><span id="line-819"></span><span>    </span><span id="local-6989586621681034806"><span class="annot"><span class="annottext">zip_roles :: [Role] -&gt; [Type] -&gt; [Coercion]
</span><a href="#local-6989586621681034806"><span class="hs-identifier hs-var hs-var">zip_roles</span></a></span></span><span> </span><span class="hs-special">(</span><span id="local-6989586621681034805"><span class="annot"><span class="annottext">Role
</span><a href="#local-6989586621681034805"><span class="hs-identifier hs-var">r1</span></a></span></span><span class="annot"><span class="hs-glyph hs-type">:</span></span><span class="annot"><span class="annottext">[Role]
</span><span class="hs-identifier">_</span></span><span class="hs-special">)</span><span>  </span><span class="hs-special">[</span><span class="hs-special">]</span><span>            </span><span class="hs-glyph">=</span><span> </span><span class="hs-special">[</span><span class="annot"><span class="annottext">Role -&gt; Role -&gt; Coercion -&gt; Coercion
</span><a href="GHC.Core.Coercion.html#downgradeRole"><span class="hs-identifier hs-var">downgradeRole</span></a></span><span> </span><span class="annot"><span class="annottext">Role
</span><a href="#local-6989586621681034805"><span class="hs-identifier hs-var">r1</span></a></span><span> </span><span class="annot"><span class="annottext">Role
</span><a href="GHC.Core.Coercion.Axiom.html#Nominal"><span class="hs-identifier hs-var">Nominal</span></a></span><span> </span><span class="annot"><span class="annottext">Coercion
</span><a href="#local-6989586621681034815"><span class="hs-identifier hs-var">arg</span></a></span><span class="hs-special">]</span><span>
</span><span id="line-820"></span><span>    </span><span class="annot"><a href="#local-6989586621681034806"><span class="hs-identifier hs-var">zip_roles</span></a></span><span> </span><span class="hs-special">(</span><span id="local-6989586621681034804"><span class="annot"><span class="annottext">Role
</span><a href="#local-6989586621681034804"><span class="hs-identifier hs-var">r1</span></a></span></span><span class="annot"><span class="hs-glyph hs-type">:</span></span><span id="local-6989586621681034803"><span class="annot"><span class="annottext">[Role]
</span><a href="#local-6989586621681034803"><span class="hs-identifier hs-var">rs</span></a></span></span><span class="hs-special">)</span><span> </span><span class="hs-special">(</span><span id="local-6989586621681034802"><span class="annot"><span class="annottext">Type
</span><a href="#local-6989586621681034802"><span class="hs-identifier hs-var">ty1</span></a></span></span><span class="annot"><span class="hs-glyph hs-type">:</span></span><span id="local-6989586621681034801"><span class="annot"><span class="annottext">[Type]
</span><a href="#local-6989586621681034801"><span class="hs-identifier hs-var">tys</span></a></span></span><span class="hs-special">)</span><span>     </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">Role -&gt; Type -&gt; Coercion
</span><a href="GHC.Core.Coercion.html#mkReflCo"><span class="hs-identifier hs-var">mkReflCo</span></a></span><span> </span><span class="annot"><span class="annottext">Role
</span><a href="#local-6989586621681034804"><span class="hs-identifier hs-var">r1</span></a></span><span> </span><span class="annot"><span class="annottext">Type
</span><a href="#local-6989586621681034802"><span class="hs-identifier hs-var">ty1</span></a></span><span> </span><span class="annot"><span class="annottext">forall a. a -&gt; [a] -&gt; [a]
</span><span class="hs-glyph hs-var">:</span></span><span> </span><span class="annot"><span class="annottext">[Role] -&gt; [Type] -&gt; [Coercion]
</span><a href="#local-6989586621681034806"><span class="hs-identifier hs-var">zip_roles</span></a></span><span> </span><span class="annot"><span class="annottext">[Role]
</span><a href="#local-6989586621681034803"><span class="hs-identifier hs-var">rs</span></a></span><span> </span><span class="annot"><span class="annottext">[Type]
</span><a href="#local-6989586621681034801"><span class="hs-identifier hs-var">tys</span></a></span><span>
</span><span id="line-821"></span><span>    </span><span class="annot"><a href="#local-6989586621681034806"><span class="hs-identifier hs-var">zip_roles</span></a></span><span> </span><span class="annot"><span class="annottext">[Role]
</span><span class="hs-identifier">_</span></span><span>       </span><span class="annot"><span class="annottext">[Type]
</span><span class="hs-identifier">_</span></span><span>             </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">forall a. String -&gt; a
</span><a href="GHC.Utils.Panic.Plain.html#panic"><span class="hs-identifier hs-var">panic</span></a></span><span> </span><span class="annot"><span class="annottext">String
</span><span class="hs-string">&quot;zip_roles&quot;</span></span><span> </span><span class="hs-comment">-- but the roles are infinite...</span><span>
</span><span id="line-822"></span><span>
</span><span id="line-823"></span><span class="annot"><a href="GHC.Core.Coercion.html#mkAppCo"><span class="hs-identifier hs-var">mkAppCo</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="GHC.Core.TyCo.Rep.html#TyConAppCo"><span class="hs-identifier hs-type">TyConAppCo</span></a></span><span> </span><span id="local-6989586621681034799"><span class="annot"><span class="annottext">Role
</span><a href="#local-6989586621681034799"><span class="hs-identifier hs-var">r</span></a></span></span><span> </span><span id="local-6989586621681034798"><span class="annot"><span class="annottext">TyCon
</span><a href="#local-6989586621681034798"><span class="hs-identifier hs-var">tc</span></a></span></span><span> </span><span id="local-6989586621681034797"><span class="annot"><span class="annottext">[Coercion]
</span><a href="#local-6989586621681034797"><span class="hs-identifier hs-var">args</span></a></span></span><span class="hs-special">)</span><span> </span><span id="local-6989586621681034796"><span class="annot"><span class="annottext">Coercion
</span><a href="#local-6989586621681034796"><span class="hs-identifier hs-var">arg</span></a></span></span><span>
</span><span id="line-824"></span><span>  </span><span class="hs-glyph">=</span><span> </span><span class="hs-keyword">case</span><span> </span><span class="annot"><span class="annottext">Role
</span><a href="#local-6989586621681034799"><span class="hs-identifier hs-var">r</span></a></span><span> </span><span class="hs-keyword">of</span><span>
</span><span id="line-825"></span><span>      </span><span class="annot"><span class="annottext">Role
</span><a href="GHC.Core.Coercion.Axiom.html#Nominal"><span class="hs-identifier hs-var">Nominal</span></a></span><span>          </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="annottext">HasDebugCallStack =&gt; Role -&gt; TyCon -&gt; [Coercion] -&gt; Coercion
</span><a href="GHC.Core.Coercion.html#mkTyConAppCo"><span class="hs-identifier hs-var">mkTyConAppCo</span></a></span><span> </span><span class="annot"><span class="annottext">Role
</span><a href="GHC.Core.Coercion.Axiom.html#Nominal"><span class="hs-identifier hs-var">Nominal</span></a></span><span> </span><span class="annot"><span class="annottext">TyCon
</span><a href="#local-6989586621681034798"><span class="hs-identifier hs-var">tc</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">[Coercion]
</span><a href="#local-6989586621681034797"><span class="hs-identifier hs-var">args</span></a></span><span> </span><span class="annot"><span class="annottext">forall a. [a] -&gt; [a] -&gt; [a]
</span><a href="../../base-4.16.4.0/src/GHC-Base.html#%2B%2B"><span class="hs-operator hs-var">++</span></a></span><span> </span><span class="hs-special">[</span><span class="annot"><span class="annottext">Coercion
</span><a href="#local-6989586621681034796"><span class="hs-identifier hs-var">arg</span></a></span><span class="hs-special">]</span><span class="hs-special">)</span><span>
</span><span id="line-826"></span><span>      </span><span class="annot"><span class="annottext">Role
</span><a href="GHC.Core.Coercion.Axiom.html#Representational"><span class="hs-identifier hs-var">Representational</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="annottext">HasDebugCallStack =&gt; Role -&gt; TyCon -&gt; [Coercion] -&gt; Coercion
</span><a href="GHC.Core.Coercion.html#mkTyConAppCo"><span class="hs-identifier hs-var">mkTyConAppCo</span></a></span><span> </span><span class="annot"><span class="annottext">Role
</span><a href="GHC.Core.Coercion.Axiom.html#Representational"><span class="hs-identifier hs-var">Representational</span></a></span><span> </span><span class="annot"><span class="annottext">TyCon
</span><a href="#local-6989586621681034798"><span class="hs-identifier hs-var">tc</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">[Coercion]
</span><a href="#local-6989586621681034797"><span class="hs-identifier hs-var">args</span></a></span><span> </span><span class="annot"><span class="annottext">forall a. [a] -&gt; [a] -&gt; [a]
</span><a href="../../base-4.16.4.0/src/GHC-Base.html#%2B%2B"><span class="hs-operator hs-var">++</span></a></span><span> </span><span class="hs-special">[</span><span class="annot"><span class="annottext">Coercion
</span><a href="#local-6989586621681034795"><span class="hs-identifier hs-var">arg'</span></a></span><span class="hs-special">]</span><span class="hs-special">)</span><span>
</span><span id="line-827"></span><span>        </span><span class="hs-keyword">where</span><span> </span><span id="local-6989586621681034794"><span class="annot"><span class="annottext">new_role :: Role
</span><a href="#local-6989586621681034794"><span class="hs-identifier hs-var hs-var">new_role</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">TyCon -&gt; [Role]
</span><a href="GHC.Core.Coercion.html#tyConRolesRepresentational"><span class="hs-identifier hs-var">tyConRolesRepresentational</span></a></span><span> </span><span class="annot"><span class="annottext">TyCon
</span><a href="#local-6989586621681034798"><span class="hs-identifier hs-var">tc</span></a></span><span class="hs-special">)</span><span> </span><span class="annot"><span class="annottext">forall a. [a] -&gt; Int -&gt; a
</span><a href="../../base-4.16.4.0/src/GHC-List.html#%21%21"><span class="hs-operator hs-var">!!</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">forall (t :: * -&gt; *) a. Foldable t =&gt; t a -&gt; Int
</span><a href="../../base-4.16.4.0/src/Data-Foldable.html#length"><span class="hs-identifier hs-var">length</span></a></span><span> </span><span class="annot"><span class="annottext">[Coercion]
</span><a href="#local-6989586621681034797"><span class="hs-identifier hs-var">args</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-828"></span><span>              </span><span id="local-6989586621681034795"><span class="annot"><span class="annottext">arg' :: Coercion
</span><a href="#local-6989586621681034795"><span class="hs-identifier hs-var hs-var">arg'</span></a></span></span><span>     </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">Role -&gt; Role -&gt; Coercion -&gt; Coercion
</span><a href="GHC.Core.Coercion.html#downgradeRole"><span class="hs-identifier hs-var">downgradeRole</span></a></span><span> </span><span class="annot"><span class="annottext">Role
</span><a href="#local-6989586621681034794"><span class="hs-identifier hs-var">new_role</span></a></span><span> </span><span class="annot"><span class="annottext">Role
</span><a href="GHC.Core.Coercion.Axiom.html#Nominal"><span class="hs-identifier hs-var">Nominal</span></a></span><span> </span><span class="annot"><span class="annottext">Coercion
</span><a href="#local-6989586621681034796"><span class="hs-identifier hs-var">arg</span></a></span><span>
</span><span id="line-829"></span><span>      </span><span class="annot"><span class="annottext">Role
</span><a href="GHC.Core.Coercion.Axiom.html#Phantom"><span class="hs-identifier hs-var">Phantom</span></a></span><span>          </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="annottext">HasDebugCallStack =&gt; Role -&gt; TyCon -&gt; [Coercion] -&gt; Coercion
</span><a href="GHC.Core.Coercion.html#mkTyConAppCo"><span class="hs-identifier hs-var">mkTyConAppCo</span></a></span><span> </span><span class="annot"><span class="annottext">Role
</span><a href="GHC.Core.Coercion.Axiom.html#Phantom"><span class="hs-identifier hs-var">Phantom</span></a></span><span> </span><span class="annot"><span class="annottext">TyCon
</span><a href="#local-6989586621681034798"><span class="hs-identifier hs-var">tc</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">[Coercion]
</span><a href="#local-6989586621681034797"><span class="hs-identifier hs-var">args</span></a></span><span> </span><span class="annot"><span class="annottext">forall a. [a] -&gt; [a] -&gt; [a]
</span><a href="../../base-4.16.4.0/src/GHC-Base.html#%2B%2B"><span class="hs-operator hs-var">++</span></a></span><span> </span><span class="hs-special">[</span><span class="annot"><span class="annottext">Coercion -&gt; Coercion
</span><a href="GHC.Core.Coercion.html#toPhantomCo"><span class="hs-identifier hs-var">toPhantomCo</span></a></span><span> </span><span class="annot"><span class="annottext">Coercion
</span><a href="#local-6989586621681034796"><span class="hs-identifier hs-var">arg</span></a></span><span class="hs-special">]</span><span class="hs-special">)</span><span>
</span><span id="line-830"></span><span class="annot"><a href="GHC.Core.Coercion.html#mkAppCo"><span class="hs-identifier hs-var">mkAppCo</span></a></span><span> </span><span id="local-6989586621681034790"><span class="annot"><span class="annottext">Coercion
</span><a href="#local-6989586621681034790"><span class="hs-identifier hs-var">co</span></a></span></span><span> </span><span id="local-6989586621681034789"><span class="annot"><span class="annottext">Coercion
</span><a href="#local-6989586621681034789"><span class="hs-identifier hs-var">arg</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">Coercion -&gt; Coercion -&gt; Coercion
</span><a href="GHC.Core.TyCo.Rep.html#AppCo"><span class="hs-identifier hs-var">AppCo</span></a></span><span> </span><span class="annot"><span class="annottext">Coercion
</span><a href="#local-6989586621681034790"><span class="hs-identifier hs-var">co</span></a></span><span>  </span><span class="annot"><span class="annottext">Coercion
</span><a href="#local-6989586621681034789"><span class="hs-identifier hs-var">arg</span></a></span><span>
</span><span id="line-831"></span><span class="hs-comment">-- Note, mkAppCo is careful to maintain invariants regarding</span><span>
</span><span id="line-832"></span><span class="hs-comment">-- where Refl constructors appear; see the comments in the definition</span><span>
</span><span id="line-833"></span><span class="hs-comment">-- of Coercion and the Note [Refl invariant] in GHC.Core.TyCo.Rep.</span><span>
</span><span id="line-834"></span><span>
</span><span id="line-835"></span><span class="hs-comment">-- | Applies multiple 'Coercion's to another 'Coercion', from left to right.</span><span>
</span><span id="line-836"></span><span class="hs-comment">-- See also 'mkAppCo'.</span><span>
</span><span id="line-837"></span><span class="annot"><a href="GHC.Core.Coercion.html#mkAppCos"><span class="hs-identifier hs-type">mkAppCos</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><a href="GHC.Core.TyCo.Rep.html#Coercion"><span class="hs-identifier hs-type">Coercion</span></a></span><span>
</span><span id="line-838"></span><span>         </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-special">[</span><span class="annot"><a href="GHC.Core.TyCo.Rep.html#Coercion"><span class="hs-identifier hs-type">Coercion</span></a></span><span class="hs-special">]</span><span>
</span><span id="line-839"></span><span>         </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="GHC.Core.TyCo.Rep.html#Coercion"><span class="hs-identifier hs-type">Coercion</span></a></span><span>
</span><span id="line-840"></span><span id="mkAppCos"><span class="annot"><span class="annottext">mkAppCos :: Coercion -&gt; [Coercion] -&gt; Coercion
</span><a href="GHC.Core.Coercion.html#mkAppCos"><span class="hs-identifier hs-var hs-var">mkAppCos</span></a></span></span><span> </span><span id="local-6989586621681034788"><span class="annot"><span class="annottext">Coercion
</span><a href="#local-6989586621681034788"><span class="hs-identifier hs-var">co1</span></a></span></span><span> </span><span id="local-6989586621681034787"><span class="annot"><span class="annottext">[Coercion]
</span><a href="#local-6989586621681034787"><span class="hs-identifier hs-var">cos</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">forall (t :: * -&gt; *) b a.
Foldable t =&gt;
(b -&gt; a -&gt; b) -&gt; b -&gt; t a -&gt; b
</span><a href="../../base-4.16.4.0/src/Data-Foldable.html#foldl%27"><span class="hs-identifier hs-var">foldl'</span></a></span><span> </span><span class="annot"><span class="annottext">Coercion -&gt; Coercion -&gt; Coercion
</span><a href="GHC.Core.Coercion.html#mkAppCo"><span class="hs-identifier hs-var">mkAppCo</span></a></span><span> </span><span class="annot"><span class="annottext">Coercion
</span><a href="#local-6989586621681034788"><span class="hs-identifier hs-var">co1</span></a></span><span> </span><span class="annot"><span class="annottext">[Coercion]
</span><a href="#local-6989586621681034787"><span class="hs-identifier hs-var">cos</span></a></span><span>
</span><span id="line-841"></span><span>
</span><span id="line-842"></span><span class="hs-comment">{- Note [Unused coercion variable in ForAllCo]

See Note [Unused coercion variable in ForAllTy] in GHC.Core.TyCo.Rep for the
motivation for checking coercion variable in types.
To lift the design choice to (ForAllCo cv kind_co body_co), we have two options:

(1) In mkForAllCo, we check whether cv is a coercion variable
    and whether it is not used in body_co. If so we construct a FunCo.
(2) We don't do this check in mkForAllCo.
    In coercionKind, we use mkTyCoForAllTy to perform the check and construct
    a FunTy when necessary.

We chose (2) for two reasons:

* for a coercion, all that matters is its kind, So ForAllCo or FunCo does not
  make a difference.
* even if cv occurs in body_co, it is possible that cv does not occur in the kind
  of body_co. Therefore the check in coercionKind is inevitable.

The last wrinkle is that there are restrictions around the use of the cv in the
coercion, as described in Section 5.8.5.2 of Richard's thesis. The idea is that
we cannot prove that the type system is consistent with unrestricted use of this
cv; the consistency proof uses an untyped rewrite relation that works over types
with all coercions and casts removed. So, we can allow the cv to appear only in
positions that are erased. As an approximation of this (and keeping close to the
published theory), we currently allow the cv only within the type in a Refl node
and under a GRefl node (including in the Coercion stored in a GRefl). It's
possible other places are OK, too, but this is a safe approximation.

Sadly, with heterogeneous equality, this restriction might be able to be violated;
Richard's thesis is unable to prove that it isn't. Specifically, the liftCoSubst
function might create an invalid coercion. Because a violation of the
restriction might lead to a program that &quot;goes wrong&quot;, it is checked all the time,
even in a production compiler and without -dcore-list. We *have* proved that the
problem does not occur with homogeneous equality, so this check can be dropped
once ~# is made to be homogeneous.
-}</span><span>
</span><span id="line-879"></span><span>
</span><span id="line-880"></span><span>
</span><span id="line-881"></span><span class="hs-comment">-- | Make a Coercion from a tycovar, a kind coercion, and a body coercion.</span><span>
</span><span id="line-882"></span><span class="hs-comment">-- The kind of the tycovar should be the left-hand kind of the kind coercion.</span><span>
</span><span id="line-883"></span><span class="hs-comment">-- See Note [Unused coercion variable in ForAllCo]</span><span>
</span><span id="line-884"></span><span class="annot"><a href="GHC.Core.Coercion.html#mkForAllCo"><span class="hs-identifier hs-type">mkForAllCo</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><a href="GHC.Types.Var.html#TyCoVar"><span class="hs-identifier hs-type">TyCoVar</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="GHC.Core.TyCo.Rep.html#CoercionN"><span class="hs-identifier hs-type">CoercionN</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="GHC.Core.TyCo.Rep.html#Coercion"><span class="hs-identifier hs-type">Coercion</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="GHC.Core.TyCo.Rep.html#Coercion"><span class="hs-identifier hs-type">Coercion</span></a></span><span>
</span><span id="line-885"></span><span id="mkForAllCo"><span class="annot"><span class="annottext">mkForAllCo :: CoVar -&gt; Coercion -&gt; Coercion -&gt; Coercion
</span><a href="GHC.Core.Coercion.html#mkForAllCo"><span class="hs-identifier hs-var hs-var">mkForAllCo</span></a></span></span><span> </span><span id="local-6989586621681034785"><span class="annot"><span class="annottext">CoVar
</span><a href="#local-6989586621681034785"><span class="hs-identifier hs-var">v</span></a></span></span><span> </span><span id="local-6989586621681034784"><span class="annot"><span class="annottext">Coercion
</span><a href="#local-6989586621681034784"><span class="hs-identifier hs-var">kind_co</span></a></span></span><span> </span><span id="local-6989586621681034783"><span class="annot"><span class="annottext">Coercion
</span><a href="#local-6989586621681034783"><span class="hs-identifier hs-var">co</span></a></span></span><span>
</span><span id="line-886"></span><span>  </span><span class="hs-glyph">|</span><span> </span><span class="hs-identifier">ASSERT</span><span class="hs-special">(</span><span> </span><span class="hs-identifier">varType</span><span> </span><span class="hs-identifier">v</span><span> </span><span class="hs-special">`</span><span class="hs-identifier">eqType</span><span class="hs-special">`</span><span> </span><span class="hs-special">(</span><span class="hs-identifier">pFst</span><span> </span><span class="hs-operator">$</span><span> </span><span class="hs-identifier">coercionKind</span><span> </span><span class="hs-identifier">kind_co</span><span class="hs-special">)</span><span class="hs-special">)</span><span> </span><span class="hs-identifier">True</span><span>
</span><span id="line-887"></span><span>  </span><span class="hs-special">,</span><span> </span><span class="hs-identifier">ASSERT</span><span class="hs-special">(</span><span> </span><span class="hs-identifier">isTyVar</span><span> </span><span class="hs-identifier">v</span><span> </span><span class="hs-operator">||</span><span> </span><span class="hs-identifier">almostDevoidCoVarOfCo</span><span> </span><span class="hs-identifier">v</span><span> </span><span class="hs-identifier">co</span><span class="hs-special">)</span><span> </span><span class="hs-identifier">True</span><span>
</span><span id="line-888"></span><span>  </span><span class="hs-special">,</span><span> </span><span class="annot"><a href="../../base-4.16.4.0/src/GHC-Maybe.html#Just"><span class="hs-identifier hs-type">Just</span></a></span><span> </span><span class="hs-special">(</span><span id="local-6989586621681034780"><span class="annot"><span class="annottext">Type
</span><a href="#local-6989586621681034780"><span class="hs-identifier hs-var">ty</span></a></span></span><span class="hs-special">,</span><span> </span><span id="local-6989586621681034779"><span class="annot"><span class="annottext">Role
</span><a href="#local-6989586621681034779"><span class="hs-identifier hs-var">r</span></a></span></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">Coercion -&gt; Maybe (Type, Role)
</span><a href="GHC.Core.Coercion.html#isReflCo_maybe"><span class="hs-identifier hs-var">isReflCo_maybe</span></a></span><span> </span><span class="annot"><span class="annottext">Coercion
</span><a href="#local-6989586621681034783"><span class="hs-identifier hs-var">co</span></a></span><span>
</span><span id="line-889"></span><span>  </span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">Coercion -&gt; Bool
</span><a href="GHC.Core.Coercion.html#isGReflCo"><span class="hs-identifier hs-var">isGReflCo</span></a></span><span> </span><span class="annot"><span class="annottext">Coercion
</span><a href="#local-6989586621681034784"><span class="hs-identifier hs-var">kind_co</span></a></span><span>
</span><span id="line-890"></span><span>  </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">Role -&gt; Type -&gt; Coercion
</span><a href="GHC.Core.Coercion.html#mkReflCo"><span class="hs-identifier hs-var">mkReflCo</span></a></span><span> </span><span class="annot"><span class="annottext">Role
</span><a href="#local-6989586621681034779"><span class="hs-identifier hs-var">r</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">CoVar -&gt; Type -&gt; Type
</span><a href="GHC.Core.Type.html#mkTyCoInvForAllTy"><span class="hs-identifier hs-var">mkTyCoInvForAllTy</span></a></span><span> </span><span class="annot"><span class="annottext">CoVar
</span><a href="#local-6989586621681034785"><span class="hs-identifier hs-var">v</span></a></span><span> </span><span class="annot"><span class="annottext">Type
</span><a href="#local-6989586621681034780"><span class="hs-identifier hs-var">ty</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-891"></span><span>  </span><span class="hs-glyph">|</span><span> </span><span class="annot"><span class="annottext">Bool
</span><a href="../../base-4.16.4.0/src/GHC-Base.html#otherwise"><span class="hs-identifier hs-var">otherwise</span></a></span><span>
</span><span id="line-892"></span><span>  </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">CoVar -&gt; Coercion -&gt; Coercion -&gt; Coercion
</span><a href="GHC.Core.TyCo.Rep.html#ForAllCo"><span class="hs-identifier hs-var">ForAllCo</span></a></span><span> </span><span class="annot"><span class="annottext">CoVar
</span><a href="#local-6989586621681034785"><span class="hs-identifier hs-var">v</span></a></span><span> </span><span class="annot"><span class="annottext">Coercion
</span><a href="#local-6989586621681034784"><span class="hs-identifier hs-var">kind_co</span></a></span><span> </span><span class="annot"><span class="annottext">Coercion
</span><a href="#local-6989586621681034783"><span class="hs-identifier hs-var">co</span></a></span><span>
</span><span id="line-893"></span><span>
</span><span id="line-894"></span><span class="hs-comment">-- | Like 'mkForAllCo', but the inner coercion shouldn't be an obvious</span><span>
</span><span id="line-895"></span><span class="hs-comment">-- reflexive coercion. For example, it is guaranteed in 'mkForAllCos'.</span><span>
</span><span id="line-896"></span><span class="hs-comment">-- The kind of the tycovar should be the left-hand kind of the kind coercion.</span><span>
</span><span id="line-897"></span><span class="annot"><a href="GHC.Core.Coercion.html#mkForAllCo_NoRefl"><span class="hs-identifier hs-type">mkForAllCo_NoRefl</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><a href="GHC.Types.Var.html#TyCoVar"><span class="hs-identifier hs-type">TyCoVar</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="GHC.Core.TyCo.Rep.html#CoercionN"><span class="hs-identifier hs-type">CoercionN</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="GHC.Core.TyCo.Rep.html#Coercion"><span class="hs-identifier hs-type">Coercion</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="GHC.Core.TyCo.Rep.html#Coercion"><span class="hs-identifier hs-type">Coercion</span></a></span><span>
</span><span id="line-898"></span><span id="mkForAllCo_NoRefl"><span class="annot"><span class="annottext">mkForAllCo_NoRefl :: CoVar -&gt; Coercion -&gt; Coercion -&gt; Coercion
</span><a href="GHC.Core.Coercion.html#mkForAllCo_NoRefl"><span class="hs-identifier hs-var hs-var">mkForAllCo_NoRefl</span></a></span></span><span> </span><span id="local-6989586621681034776"><span class="annot"><span class="annottext">CoVar
</span><a href="#local-6989586621681034776"><span class="hs-identifier hs-var">v</span></a></span></span><span> </span><span id="local-6989586621681034775"><span class="annot"><span class="annottext">Coercion
</span><a href="#local-6989586621681034775"><span class="hs-identifier hs-var">kind_co</span></a></span></span><span> </span><span id="local-6989586621681034774"><span class="annot"><span class="annottext">Coercion
</span><a href="#local-6989586621681034774"><span class="hs-identifier hs-var">co</span></a></span></span><span>
</span><span id="line-899"></span><span>  </span><span class="hs-glyph">|</span><span> </span><span class="hs-identifier">ASSERT</span><span class="hs-special">(</span><span> </span><span class="hs-identifier">varType</span><span> </span><span class="hs-identifier">v</span><span> </span><span class="hs-special">`</span><span class="hs-identifier">eqType</span><span class="hs-special">`</span><span> </span><span class="hs-special">(</span><span class="hs-identifier">pFst</span><span> </span><span class="hs-operator">$</span><span> </span><span class="hs-identifier">coercionKind</span><span> </span><span class="hs-identifier">kind_co</span><span class="hs-special">)</span><span class="hs-special">)</span><span> </span><span class="hs-identifier">True</span><span>
</span><span id="line-900"></span><span>  </span><span class="hs-special">,</span><span> </span><span class="hs-identifier">ASSERT</span><span class="hs-special">(</span><span> </span><span class="hs-identifier">isTyVar</span><span> </span><span class="hs-identifier">v</span><span> </span><span class="hs-operator">||</span><span> </span><span class="hs-identifier">almostDevoidCoVarOfCo</span><span> </span><span class="hs-identifier">v</span><span> </span><span class="hs-identifier">co</span><span class="hs-special">)</span><span> </span><span class="hs-identifier">True</span><span>
</span><span id="line-901"></span><span>  </span><span class="hs-special">,</span><span> </span><span class="hs-identifier">ASSERT</span><span class="hs-special">(</span><span> </span><span class="hs-identifier">not</span><span> </span><span class="hs-special">(</span><span class="hs-identifier">isReflCo</span><span> </span><span class="hs-identifier">co</span><span class="hs-special">)</span><span class="hs-special">)</span><span> </span><span class="hs-identifier">True</span><span>
</span><span id="line-902"></span><span>  </span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">CoVar -&gt; Bool
</span><a href="GHC.Types.Var.html#isCoVar"><span class="hs-identifier hs-var">isCoVar</span></a></span><span> </span><span class="annot"><span class="annottext">CoVar
</span><a href="#local-6989586621681034776"><span class="hs-identifier hs-var">v</span></a></span><span>
</span><span id="line-903"></span><span>  </span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">Bool -&gt; Bool
</span><span class="hs-identifier hs-var">not</span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">CoVar
</span><a href="#local-6989586621681034776"><span class="hs-identifier hs-var">v</span></a></span><span> </span><span class="annot"><span class="annottext">CoVar -&gt; VarSet -&gt; Bool
</span><a href="GHC.Types.Var.Set.html#elemVarSet"><span class="hs-operator hs-var">`elemVarSet`</span></a></span><span> </span><span class="annot"><span class="annottext">Coercion -&gt; VarSet
</span><a href="GHC.Core.TyCo.FVs.html#tyCoVarsOfCo"><span class="hs-identifier hs-var">tyCoVarsOfCo</span></a></span><span> </span><span class="annot"><span class="annottext">Coercion
</span><a href="#local-6989586621681034774"><span class="hs-identifier hs-var">co</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-904"></span><span>  </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">Role -&gt; Coercion -&gt; Coercion -&gt; Coercion -&gt; Coercion
</span><a href="GHC.Core.TyCo.Rep.html#FunCo"><span class="hs-identifier hs-var">FunCo</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Coercion -&gt; Role
</span><a href="GHC.Core.Coercion.html#coercionRole"><span class="hs-identifier hs-var">coercionRole</span></a></span><span> </span><span class="annot"><span class="annottext">Coercion
</span><a href="#local-6989586621681034774"><span class="hs-identifier hs-var">co</span></a></span><span class="hs-special">)</span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Type -&gt; Coercion
</span><a href="GHC.Core.Coercion.html#multToCo"><span class="hs-identifier hs-var">multToCo</span></a></span><span> </span><span class="annot"><span class="annottext">Type
</span><a href="GHC.Core.Type.html#Many"><span class="hs-identifier hs-var">Many</span></a></span><span class="hs-special">)</span><span> </span><span class="annot"><span class="annottext">Coercion
</span><a href="#local-6989586621681034775"><span class="hs-identifier hs-var">kind_co</span></a></span><span> </span><span class="annot"><span class="annottext">Coercion
</span><a href="#local-6989586621681034774"><span class="hs-identifier hs-var">co</span></a></span><span>
</span><span id="line-905"></span><span>      </span><span class="hs-comment">-- Functions from coercions are always unrestricted</span><span>
</span><span id="line-906"></span><span>  </span><span class="hs-glyph">|</span><span> </span><span class="annot"><span class="annottext">Bool
</span><a href="../../base-4.16.4.0/src/GHC-Base.html#otherwise"><span class="hs-identifier hs-var">otherwise</span></a></span><span>
</span><span id="line-907"></span><span>  </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">CoVar -&gt; Coercion -&gt; Coercion -&gt; Coercion
</span><a href="GHC.Core.TyCo.Rep.html#ForAllCo"><span class="hs-identifier hs-var">ForAllCo</span></a></span><span> </span><span class="annot"><span class="annottext">CoVar
</span><a href="#local-6989586621681034776"><span class="hs-identifier hs-var">v</span></a></span><span> </span><span class="annot"><span class="annottext">Coercion
</span><a href="#local-6989586621681034775"><span class="hs-identifier hs-var">kind_co</span></a></span><span> </span><span class="annot"><span class="annottext">Coercion
</span><a href="#local-6989586621681034774"><span class="hs-identifier hs-var">co</span></a></span><span>
</span><span id="line-908"></span><span>
</span><span id="line-909"></span><span class="hs-comment">-- | Make nested ForAllCos</span><span>
</span><span id="line-910"></span><span class="annot"><a href="GHC.Core.Coercion.html#mkForAllCos"><span class="hs-identifier hs-type">mkForAllCos</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="hs-special">[</span><span class="hs-special">(</span><span class="annot"><a href="GHC.Types.Var.html#TyCoVar"><span class="hs-identifier hs-type">TyCoVar</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><a href="GHC.Core.TyCo.Rep.html#CoercionN"><span class="hs-identifier hs-type">CoercionN</span></a></span><span class="hs-special">)</span><span class="hs-special">]</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="GHC.Core.TyCo.Rep.html#Coercion"><span class="hs-identifier hs-type">Coercion</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="GHC.Core.TyCo.Rep.html#Coercion"><span class="hs-identifier hs-type">Coercion</span></a></span><span>
</span><span id="line-911"></span><span id="mkForAllCos"><span class="annot"><span class="annottext">mkForAllCos :: [(CoVar, Coercion)] -&gt; Coercion -&gt; Coercion
</span><a href="GHC.Core.Coercion.html#mkForAllCos"><span class="hs-identifier hs-var hs-var">mkForAllCos</span></a></span></span><span> </span><span id="local-6989586621681034771"><span class="annot"><span class="annottext">[(CoVar, Coercion)]
</span><a href="#local-6989586621681034771"><span class="hs-identifier hs-var">bndrs</span></a></span></span><span> </span><span id="local-6989586621681034770"><span class="annot"><span class="annottext">Coercion
</span><a href="#local-6989586621681034770"><span class="hs-identifier hs-var">co</span></a></span></span><span>
</span><span id="line-912"></span><span>  </span><span class="hs-glyph">|</span><span> </span><span class="annot"><a href="../../base-4.16.4.0/src/GHC-Maybe.html#Just"><span class="hs-identifier hs-type">Just</span></a></span><span> </span><span class="hs-special">(</span><span id="local-6989586621681034769"><span class="annot"><span class="annottext">Type
</span><a href="#local-6989586621681034769"><span class="hs-identifier hs-var">ty</span></a></span></span><span class="hs-special">,</span><span> </span><span id="local-6989586621681034768"><span class="annot"><span class="annottext">Role
</span><a href="#local-6989586621681034768"><span class="hs-identifier hs-var">r</span></a></span></span><span> </span><span class="hs-special">)</span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">Coercion -&gt; Maybe (Type, Role)
</span><a href="GHC.Core.Coercion.html#isReflCo_maybe"><span class="hs-identifier hs-var">isReflCo_maybe</span></a></span><span> </span><span class="annot"><span class="annottext">Coercion
</span><a href="#local-6989586621681034770"><span class="hs-identifier hs-var">co</span></a></span><span>
</span><span id="line-913"></span><span>  </span><span class="hs-glyph">=</span><span> </span><span class="hs-keyword">let</span><span> </span><span class="hs-special">(</span><span id="local-6989586621681034767"><span class="annot"><span class="annottext">[(CoVar, Coercion)]
</span><a href="#local-6989586621681034767"><span class="hs-identifier hs-var">refls_rev'd</span></a></span></span><span class="hs-special">,</span><span> </span><span id="local-6989586621681034766"><span class="annot"><span class="annottext">[(CoVar, Coercion)]
</span><a href="#local-6989586621681034766"><span class="hs-identifier hs-var">non_refls_rev'd</span></a></span></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">forall a. (a -&gt; Bool) -&gt; [a] -&gt; ([a], [a])
</span><a href="../../base-4.16.4.0/src/GHC-List.html#span"><span class="hs-identifier hs-var">span</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Coercion -&gt; Bool
</span><a href="GHC.Core.Coercion.html#isReflCo"><span class="hs-identifier hs-var">isReflCo</span></a></span><span> </span><span class="annot"><span class="annottext">forall b c a. (b -&gt; c) -&gt; (a -&gt; b) -&gt; a -&gt; c
</span><a href="../../base-4.16.4.0/src/GHC-Base.html#."><span class="hs-operator hs-var">.</span></a></span><span> </span><span class="annot"><span class="annottext">forall a b. (a, b) -&gt; b
</span><a href="../../base-4.16.4.0/src/Data-Tuple.html#snd"><span class="hs-identifier hs-var">snd</span></a></span><span class="hs-special">)</span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">forall a. [a] -&gt; [a]
</span><a href="../../base-4.16.4.0/src/GHC-List.html#reverse"><span class="hs-identifier hs-var">reverse</span></a></span><span> </span><span class="annot"><span class="annottext">[(CoVar, Coercion)]
</span><a href="#local-6989586621681034771"><span class="hs-identifier hs-var">bndrs</span></a></span><span class="hs-special">)</span><span> </span><span class="hs-keyword">in</span><span>
</span><span id="line-914"></span><span>    </span><span class="annot"><span class="annottext">forall (t :: * -&gt; *) b a.
Foldable t =&gt;
(b -&gt; a -&gt; b) -&gt; b -&gt; t a -&gt; b
</span><a href="../../base-4.16.4.0/src/Data-Foldable.html#foldl%27"><span class="hs-identifier hs-var">foldl'</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">forall a b c. (a -&gt; b -&gt; c) -&gt; b -&gt; a -&gt; c
</span><a href="../../base-4.16.4.0/src/GHC-Base.html#flip"><span class="hs-identifier hs-var">flip</span></a></span><span> </span><span class="annot"><span class="annottext">forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><a href="../../base-4.16.4.0/src/GHC-Base.html#%24"><span class="hs-operator hs-var">$</span></a></span><span> </span><span class="annot"><span class="annottext">forall a b c. (a -&gt; b -&gt; c) -&gt; (a, b) -&gt; c
</span><a href="../../base-4.16.4.0/src/Data-Tuple.html#uncurry"><span class="hs-identifier hs-var">uncurry</span></a></span><span> </span><span class="annot"><span class="annottext">CoVar -&gt; Coercion -&gt; Coercion -&gt; Coercion
</span><a href="GHC.Core.Coercion.html#mkForAllCo_NoRefl"><span class="hs-identifier hs-var">mkForAllCo_NoRefl</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-915"></span><span>           </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Role -&gt; Type -&gt; Coercion
</span><a href="GHC.Core.Coercion.html#mkReflCo"><span class="hs-identifier hs-var">mkReflCo</span></a></span><span> </span><span class="annot"><span class="annottext">Role
</span><a href="#local-6989586621681034768"><span class="hs-identifier hs-var">r</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">[CoVar] -&gt; Type -&gt; Type
</span><a href="GHC.Core.Type.html#mkTyCoInvForAllTys"><span class="hs-identifier hs-var">mkTyCoInvForAllTys</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">forall a. [a] -&gt; [a]
</span><a href="../../base-4.16.4.0/src/GHC-List.html#reverse"><span class="hs-identifier hs-var">reverse</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">forall a b. (a -&gt; b) -&gt; [a] -&gt; [b]
</span><a href="../../base-4.16.4.0/src/GHC-Base.html#map"><span class="hs-identifier hs-var">map</span></a></span><span> </span><span class="annot"><span class="annottext">forall a b. (a, b) -&gt; a
</span><a href="../../base-4.16.4.0/src/Data-Tuple.html#fst"><span class="hs-identifier hs-var">fst</span></a></span><span> </span><span class="annot"><span class="annottext">[(CoVar, Coercion)]
</span><a href="#local-6989586621681034767"><span class="hs-identifier hs-var">refls_rev'd</span></a></span><span class="hs-special">)</span><span class="hs-special">)</span><span> </span><span class="annot"><span class="annottext">Type
</span><a href="#local-6989586621681034769"><span class="hs-identifier hs-var">ty</span></a></span><span class="hs-special">)</span><span class="hs-special">)</span><span>
</span><span id="line-916"></span><span>           </span><span class="annot"><span class="annottext">[(CoVar, Coercion)]
</span><a href="#local-6989586621681034766"><span class="hs-identifier hs-var">non_refls_rev'd</span></a></span><span>
</span><span id="line-917"></span><span>  </span><span class="hs-glyph">|</span><span> </span><span class="annot"><span class="annottext">Bool
</span><a href="../../base-4.16.4.0/src/GHC-Base.html#otherwise"><span class="hs-identifier hs-var">otherwise</span></a></span><span>
</span><span id="line-918"></span><span>  </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">forall (t :: * -&gt; *) a b.
Foldable t =&gt;
(a -&gt; b -&gt; b) -&gt; b -&gt; t a -&gt; b
</span><a href="../../base-4.16.4.0/src/Data-Foldable.html#foldr"><span class="hs-identifier hs-var">foldr</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">forall a b c. (a -&gt; b -&gt; c) -&gt; (a, b) -&gt; c
</span><a href="../../base-4.16.4.0/src/Data-Tuple.html#uncurry"><span class="hs-identifier hs-var">uncurry</span></a></span><span> </span><span class="annot"><span class="annottext">CoVar -&gt; Coercion -&gt; Coercion -&gt; Coercion
</span><a href="GHC.Core.Coercion.html#mkForAllCo_NoRefl"><span class="hs-identifier hs-var">mkForAllCo_NoRefl</span></a></span><span class="hs-special">)</span><span> </span><span class="annot"><span class="annottext">Coercion
</span><a href="#local-6989586621681034770"><span class="hs-identifier hs-var">co</span></a></span><span> </span><span class="annot"><span class="annottext">[(CoVar, Coercion)]
</span><a href="#local-6989586621681034771"><span class="hs-identifier hs-var">bndrs</span></a></span><span>
</span><span id="line-919"></span><span>
</span><span id="line-920"></span><span class="hs-comment">-- | Make a Coercion quantified over a type/coercion variable;</span><span>
</span><span id="line-921"></span><span class="hs-comment">-- the variable has the same type in both sides of the coercion</span><span>
</span><span id="line-922"></span><span class="annot"><a href="GHC.Core.Coercion.html#mkHomoForAllCos"><span class="hs-identifier hs-type">mkHomoForAllCos</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="hs-special">[</span><span class="annot"><a href="GHC.Types.Var.html#TyCoVar"><span class="hs-identifier hs-type">TyCoVar</span></a></span><span class="hs-special">]</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="GHC.Core.TyCo.Rep.html#Coercion"><span class="hs-identifier hs-type">Coercion</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="GHC.Core.TyCo.Rep.html#Coercion"><span class="hs-identifier hs-type">Coercion</span></a></span><span>
</span><span id="line-923"></span><span id="mkHomoForAllCos"><span class="annot"><span class="annottext">mkHomoForAllCos :: [CoVar] -&gt; Coercion -&gt; Coercion
</span><a href="GHC.Core.Coercion.html#mkHomoForAllCos"><span class="hs-identifier hs-var hs-var">mkHomoForAllCos</span></a></span></span><span> </span><span id="local-6989586621681034761"><span class="annot"><span class="annottext">[CoVar]
</span><a href="#local-6989586621681034761"><span class="hs-identifier hs-var">vs</span></a></span></span><span> </span><span id="local-6989586621681034760"><span class="annot"><span class="annottext">Coercion
</span><a href="#local-6989586621681034760"><span class="hs-identifier hs-var">co</span></a></span></span><span>
</span><span id="line-924"></span><span>  </span><span class="hs-glyph">|</span><span> </span><span class="annot"><a href="../../base-4.16.4.0/src/GHC-Maybe.html#Just"><span class="hs-identifier hs-type">Just</span></a></span><span> </span><span class="hs-special">(</span><span id="local-6989586621681034759"><span class="annot"><span class="annottext">Type
</span><a href="#local-6989586621681034759"><span class="hs-identifier hs-var">ty</span></a></span></span><span class="hs-special">,</span><span> </span><span id="local-6989586621681034758"><span class="annot"><span class="annottext">Role
</span><a href="#local-6989586621681034758"><span class="hs-identifier hs-var">r</span></a></span></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">Coercion -&gt; Maybe (Type, Role)
</span><a href="GHC.Core.Coercion.html#isReflCo_maybe"><span class="hs-identifier hs-var">isReflCo_maybe</span></a></span><span> </span><span class="annot"><span class="annottext">Coercion
</span><a href="#local-6989586621681034760"><span class="hs-identifier hs-var">co</span></a></span><span>
</span><span id="line-925"></span><span>  </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">Role -&gt; Type -&gt; Coercion
</span><a href="GHC.Core.Coercion.html#mkReflCo"><span class="hs-identifier hs-var">mkReflCo</span></a></span><span> </span><span class="annot"><span class="annottext">Role
</span><a href="#local-6989586621681034758"><span class="hs-identifier hs-var">r</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">[CoVar] -&gt; Type -&gt; Type
</span><a href="GHC.Core.Type.html#mkTyCoInvForAllTys"><span class="hs-identifier hs-var">mkTyCoInvForAllTys</span></a></span><span> </span><span class="annot"><span class="annottext">[CoVar]
</span><a href="#local-6989586621681034761"><span class="hs-identifier hs-var">vs</span></a></span><span> </span><span class="annot"><span class="annottext">Type
</span><a href="#local-6989586621681034759"><span class="hs-identifier hs-var">ty</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-926"></span><span>  </span><span class="hs-glyph">|</span><span> </span><span class="annot"><span class="annottext">Bool
</span><a href="../../base-4.16.4.0/src/GHC-Base.html#otherwise"><span class="hs-identifier hs-var">otherwise</span></a></span><span>
</span><span id="line-927"></span><span>  </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">[CoVar] -&gt; Coercion -&gt; Coercion
</span><a href="GHC.Core.Coercion.html#mkHomoForAllCos_NoRefl"><span class="hs-identifier hs-var">mkHomoForAllCos_NoRefl</span></a></span><span> </span><span class="annot"><span class="annottext">[CoVar]
</span><a href="#local-6989586621681034761"><span class="hs-identifier hs-var">vs</span></a></span><span> </span><span class="annot"><span class="annottext">Coercion
</span><a href="#local-6989586621681034760"><span class="hs-identifier hs-var">co</span></a></span><span>
</span><span id="line-928"></span><span>
</span><span id="line-929"></span><span class="hs-comment">-- | Like 'mkHomoForAllCos', but the inner coercion shouldn't be an obvious</span><span>
</span><span id="line-930"></span><span class="hs-comment">-- reflexive coercion. For example, it is guaranteed in 'mkHomoForAllCos'.</span><span>
</span><span id="line-931"></span><span class="annot"><a href="GHC.Core.Coercion.html#mkHomoForAllCos_NoRefl"><span class="hs-identifier hs-type">mkHomoForAllCos_NoRefl</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="hs-special">[</span><span class="annot"><a href="GHC.Types.Var.html#TyCoVar"><span class="hs-identifier hs-type">TyCoVar</span></a></span><span class="hs-special">]</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="GHC.Core.TyCo.Rep.html#Coercion"><span class="hs-identifier hs-type">Coercion</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="GHC.Core.TyCo.Rep.html#Coercion"><span class="hs-identifier hs-type">Coercion</span></a></span><span>
</span><span id="line-932"></span><span id="mkHomoForAllCos_NoRefl"><span class="annot"><span class="annottext">mkHomoForAllCos_NoRefl :: [CoVar] -&gt; Coercion -&gt; Coercion
</span><a href="GHC.Core.Coercion.html#mkHomoForAllCos_NoRefl"><span class="hs-identifier hs-var hs-var">mkHomoForAllCos_NoRefl</span></a></span></span><span> </span><span id="local-6989586621681034756"><span class="annot"><span class="annottext">[CoVar]
</span><a href="#local-6989586621681034756"><span class="hs-identifier hs-var">vs</span></a></span></span><span> </span><span id="local-6989586621681034755"><span class="annot"><span class="annottext">Coercion
</span><a href="#local-6989586621681034755"><span class="hs-identifier hs-var">orig_co</span></a></span></span><span>
</span><span id="line-933"></span><span>  </span><span class="hs-glyph">=</span><span> </span><span class="hs-identifier">ASSERT</span><span class="hs-special">(</span><span> </span><span class="hs-identifier">not</span><span> </span><span class="hs-special">(</span><span class="hs-identifier">isReflCo</span><span> </span><span class="hs-identifier">orig_co</span><span class="hs-special">)</span><span class="hs-special">)</span><span>
</span><span id="line-934"></span><span>    </span><span class="annot"><span class="annottext">forall (t :: * -&gt; *) a b.
Foldable t =&gt;
(a -&gt; b -&gt; b) -&gt; b -&gt; t a -&gt; b
</span><a href="../../base-4.16.4.0/src/Data-Foldable.html#foldr"><span class="hs-identifier hs-var">foldr</span></a></span><span> </span><span class="annot"><span class="annottext">CoVar -&gt; Coercion -&gt; Coercion
</span><a href="#local-6989586621681034754"><span class="hs-identifier hs-var">go</span></a></span><span> </span><span class="annot"><span class="annottext">Coercion
</span><a href="#local-6989586621681034755"><span class="hs-identifier hs-var">orig_co</span></a></span><span> </span><span class="annot"><span class="annottext">[CoVar]
</span><a href="#local-6989586621681034756"><span class="hs-identifier hs-var">vs</span></a></span><span>
</span><span id="line-935"></span><span>  </span><span class="hs-keyword">where</span><span>
</span><span id="line-936"></span><span>    </span><span id="local-6989586621681034754"><span class="annot"><span class="annottext">go :: CoVar -&gt; Coercion -&gt; Coercion
</span><a href="#local-6989586621681034754"><span class="hs-identifier hs-var hs-var">go</span></a></span></span><span> </span><span id="local-6989586621681034753"><span class="annot"><span class="annottext">CoVar
</span><a href="#local-6989586621681034753"><span class="hs-identifier hs-var">v</span></a></span></span><span> </span><span id="local-6989586621681034752"><span class="annot"><span class="annottext">Coercion
</span><a href="#local-6989586621681034752"><span class="hs-identifier hs-var">co</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">CoVar -&gt; Coercion -&gt; Coercion -&gt; Coercion
</span><a href="GHC.Core.Coercion.html#mkForAllCo_NoRefl"><span class="hs-identifier hs-var">mkForAllCo_NoRefl</span></a></span><span> </span><span class="annot"><span class="annottext">CoVar
</span><a href="#local-6989586621681034753"><span class="hs-identifier hs-var">v</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Type -&gt; Coercion
</span><a href="GHC.Core.Coercion.html#mkNomReflCo"><span class="hs-identifier hs-var">mkNomReflCo</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">CoVar -&gt; Type
</span><a href="GHC.Types.Var.html#varType"><span class="hs-identifier hs-var">varType</span></a></span><span> </span><span class="annot"><span class="annottext">CoVar
</span><a href="#local-6989586621681034753"><span class="hs-identifier hs-var">v</span></a></span><span class="hs-special">)</span><span class="hs-special">)</span><span> </span><span class="annot"><span class="annottext">Coercion
</span><a href="#local-6989586621681034752"><span class="hs-identifier hs-var">co</span></a></span><span>
</span><span id="line-937"></span><span>
</span><span id="line-938"></span><span class="annot"><a href="GHC.Core.Coercion.html#mkCoVarCo"><span class="hs-identifier hs-type">mkCoVarCo</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><a href="GHC.Types.Var.html#CoVar"><span class="hs-identifier hs-type">CoVar</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="GHC.Core.TyCo.Rep.html#Coercion"><span class="hs-identifier hs-type">Coercion</span></a></span><span>
</span><span id="line-939"></span><span class="hs-comment">-- cv :: s ~# t</span><span>
</span><span id="line-940"></span><span class="hs-comment">-- See Note [mkCoVarCo]</span><span>
</span><span id="line-941"></span><span id="mkCoVarCo"><span class="annot"><span class="annottext">mkCoVarCo :: CoVar -&gt; Coercion
</span><a href="GHC.Core.Coercion.html#mkCoVarCo"><span class="hs-identifier hs-var hs-var">mkCoVarCo</span></a></span></span><span> </span><span id="local-6989586621681034751"><span class="annot"><span class="annottext">CoVar
</span><a href="#local-6989586621681034751"><span class="hs-identifier hs-var">cv</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">CoVar -&gt; Coercion
</span><a href="GHC.Core.TyCo.Rep.html#CoVarCo"><span class="hs-identifier hs-var">CoVarCo</span></a></span><span> </span><span class="annot"><span class="annottext">CoVar
</span><a href="#local-6989586621681034751"><span class="hs-identifier hs-var">cv</span></a></span><span>
</span><span id="line-942"></span><span>
</span><span id="line-943"></span><span class="annot"><a href="GHC.Core.Coercion.html#mkCoVarCos"><span class="hs-identifier hs-type">mkCoVarCos</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="hs-special">[</span><span class="annot"><a href="GHC.Types.Var.html#CoVar"><span class="hs-identifier hs-type">CoVar</span></a></span><span class="hs-special">]</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-special">[</span><span class="annot"><a href="GHC.Core.TyCo.Rep.html#Coercion"><span class="hs-identifier hs-type">Coercion</span></a></span><span class="hs-special">]</span><span>
</span><span id="line-944"></span><span id="mkCoVarCos"><span class="annot"><span class="annottext">mkCoVarCos :: [CoVar] -&gt; [Coercion]
</span><a href="GHC.Core.Coercion.html#mkCoVarCos"><span class="hs-identifier hs-var hs-var">mkCoVarCos</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">forall a b. (a -&gt; b) -&gt; [a] -&gt; [b]
</span><a href="../../base-4.16.4.0/src/GHC-Base.html#map"><span class="hs-identifier hs-var">map</span></a></span><span> </span><span class="annot"><span class="annottext">CoVar -&gt; Coercion
</span><a href="GHC.Core.Coercion.html#mkCoVarCo"><span class="hs-identifier hs-var">mkCoVarCo</span></a></span><span>
</span><span id="line-945"></span><span>
</span><span id="line-946"></span><span class="hs-comment">{- Note [mkCoVarCo]
~~~~~~~~~~~~~~~~~~~
In the past, mkCoVarCo optimised (c :: t~t) to (Refl t).  That is
valid (although see Note [Unbound RULE binders] in GHC.Core.Rules), but
it's a relatively expensive test and perhaps better done in
optCoercion.  Not a big deal either way.
-}</span><span>
</span><span id="line-953"></span><span>
</span><span id="line-954"></span><span class="hs-comment">-- | Extract a covar, if possible. This check is dirty. Be ashamed</span><span>
</span><span id="line-955"></span><span class="hs-comment">-- of yourself. (It's dirty because it cares about the structure of</span><span>
</span><span id="line-956"></span><span class="hs-comment">-- a coercion, which is morally reprehensible.)</span><span>
</span><span id="line-957"></span><span class="annot"><a href="GHC.Core.Coercion.html#isCoVar_maybe"><span class="hs-identifier hs-type">isCoVar_maybe</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><a href="GHC.Core.TyCo.Rep.html#Coercion"><span class="hs-identifier hs-type">Coercion</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="../../base-4.16.4.0/src/GHC-Maybe.html#Maybe"><span class="hs-identifier hs-type">Maybe</span></a></span><span> </span><span class="annot"><a href="GHC.Types.Var.html#CoVar"><span class="hs-identifier hs-type">CoVar</span></a></span><span>
</span><span id="line-958"></span><span id="isCoVar_maybe"><span class="annot"><span class="annottext">isCoVar_maybe :: Coercion -&gt; Maybe CoVar
</span><a href="GHC.Core.Coercion.html#isCoVar_maybe"><span class="hs-identifier hs-var hs-var">isCoVar_maybe</span></a></span></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="GHC.Core.TyCo.Rep.html#CoVarCo"><span class="hs-identifier hs-type">CoVarCo</span></a></span><span> </span><span id="local-6989586621681034750"><span class="annot"><span class="annottext">CoVar
</span><a href="#local-6989586621681034750"><span class="hs-identifier hs-var">cv</span></a></span></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">forall a. a -&gt; Maybe a
</span><a href="../../base-4.16.4.0/src/GHC-Maybe.html#Just"><span class="hs-identifier hs-var">Just</span></a></span><span> </span><span class="annot"><span class="annottext">CoVar
</span><a href="#local-6989586621681034750"><span class="hs-identifier hs-var">cv</span></a></span><span>
</span><span id="line-959"></span><span class="annot"><a href="GHC.Core.Coercion.html#isCoVar_maybe"><span class="hs-identifier hs-var">isCoVar_maybe</span></a></span><span> </span><span class="annot"><span class="annottext">Coercion
</span><span class="hs-identifier">_</span></span><span>            </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">forall a. Maybe a
</span><a href="../../base-4.16.4.0/src/GHC-Maybe.html#Nothing"><span class="hs-identifier hs-var">Nothing</span></a></span><span>
</span><span id="line-960"></span><span>
</span><span id="line-961"></span><span id="local-6989586621681035690"><span class="annot"><a href="GHC.Core.Coercion.html#mkAxInstCo"><span class="hs-identifier hs-type">mkAxInstCo</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><a href="GHC.Core.Coercion.Axiom.html#Role"><span class="hs-identifier hs-type">Role</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="GHC.Core.Coercion.Axiom.html#CoAxiom"><span class="hs-identifier hs-type">CoAxiom</span></a></span><span> </span><span class="annot"><a href="#local-6989586621681035690"><span class="hs-identifier hs-type">br</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="GHC.Core.Coercion.Axiom.html#BranchIndex"><span class="hs-identifier hs-type">BranchIndex</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-special">[</span><span class="annot"><a href="GHC.Core.TyCo.Rep.html#Type"><span class="hs-identifier hs-type">Type</span></a></span><span class="hs-special">]</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-special">[</span><span class="annot"><a href="GHC.Core.TyCo.Rep.html#Coercion"><span class="hs-identifier hs-type">Coercion</span></a></span><span class="hs-special">]</span><span>
</span><span id="line-962"></span><span>           </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="GHC.Core.TyCo.Rep.html#Coercion"><span class="hs-identifier hs-type">Coercion</span></a></span></span><span>
</span><span id="line-963"></span><span class="hs-comment">-- mkAxInstCo can legitimately be called over-staturated;</span><span>
</span><span id="line-964"></span><span class="hs-comment">-- i.e. with more type arguments than the coercion requires</span><span>
</span><span id="line-965"></span><span id="mkAxInstCo"><span class="annot"><span class="annottext">mkAxInstCo :: forall (br :: BranchFlag).
Role -&gt; CoAxiom br -&gt; Int -&gt; [Type] -&gt; [Coercion] -&gt; Coercion
</span><a href="GHC.Core.Coercion.html#mkAxInstCo"><span class="hs-identifier hs-var hs-var">mkAxInstCo</span></a></span></span><span> </span><span id="local-6989586621681034743"><span class="annot"><span class="annottext">Role
</span><a href="#local-6989586621681034743"><span class="hs-keyword hs-var">role</span></a></span></span><span> </span><span id="local-6989586621681034742"><span class="annot"><span class="annottext">CoAxiom br
</span><a href="#local-6989586621681034742"><span class="hs-identifier hs-var">ax</span></a></span></span><span> </span><span id="local-6989586621681034741"><span class="annot"><span class="annottext">Int
</span><a href="#local-6989586621681034741"><span class="hs-identifier hs-var">index</span></a></span></span><span> </span><span id="local-6989586621681034740"><span class="annot"><span class="annottext">[Type]
</span><a href="#local-6989586621681034740"><span class="hs-identifier hs-var">tys</span></a></span></span><span> </span><span id="local-6989586621681034739"><span class="annot"><span class="annottext">[Coercion]
</span><a href="#local-6989586621681034739"><span class="hs-identifier hs-var">cos</span></a></span></span><span>
</span><span id="line-966"></span><span>  </span><span class="hs-glyph">|</span><span> </span><span class="annot"><span class="annottext">Int
</span><a href="#local-6989586621681034738"><span class="hs-identifier hs-var">arity</span></a></span><span> </span><span class="annot"><span class="annottext">forall a. Eq a =&gt; a -&gt; a -&gt; Bool
</span><span class="hs-operator hs-var">==</span></span><span> </span><span class="annot"><span class="annottext">Int
</span><a href="#local-6989586621681034737"><span class="hs-identifier hs-var">n_tys</span></a></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">Role -&gt; Role -&gt; Coercion -&gt; Coercion
</span><a href="GHC.Core.Coercion.html#downgradeRole"><span class="hs-identifier hs-var">downgradeRole</span></a></span><span> </span><span class="annot"><span class="annottext">Role
</span><a href="#local-6989586621681034743"><span class="hs-keyword hs-var">role</span></a></span><span> </span><span class="annot"><span class="annottext">Role
</span><a href="#local-6989586621681034736"><span class="hs-identifier hs-var">ax_role</span></a></span><span> </span><span class="annot"><span class="annottext">forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><a href="../../base-4.16.4.0/src/GHC-Base.html#%24"><span class="hs-operator hs-var">$</span></a></span><span>
</span><span id="line-967"></span><span>                     </span><span class="annot"><span class="annottext">CoAxiom Branched -&gt; Int -&gt; [Coercion] -&gt; Coercion
</span><a href="GHC.Core.Coercion.html#mkAxiomInstCo"><span class="hs-identifier hs-var">mkAxiomInstCo</span></a></span><span> </span><span class="annot"><span class="annottext">CoAxiom Branched
</span><a href="#local-6989586621681034735"><span class="hs-identifier hs-var">ax_br</span></a></span><span> </span><span class="annot"><span class="annottext">Int
</span><a href="#local-6989586621681034741"><span class="hs-identifier hs-var">index</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">[Coercion]
</span><a href="#local-6989586621681034734"><span class="hs-identifier hs-var">rtys</span></a></span><span> </span><span class="annot"><span class="annottext">forall a. [a] -&gt; [a] -&gt; [a]
</span><a href="GHC.Utils.Misc.html#chkAppend"><span class="hs-operator hs-var">`chkAppend`</span></a></span><span> </span><span class="annot"><span class="annottext">[Coercion]
</span><a href="#local-6989586621681034739"><span class="hs-identifier hs-var">cos</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-968"></span><span>  </span><span class="hs-glyph">|</span><span> </span><span class="annot"><span class="annottext">Bool
</span><a href="../../base-4.16.4.0/src/GHC-Base.html#otherwise"><span class="hs-identifier hs-var">otherwise</span></a></span><span>      </span><span class="hs-glyph">=</span><span> </span><span class="hs-identifier">ASSERT</span><span class="hs-special">(</span><span> </span><span class="hs-identifier">arity</span><span> </span><span class="hs-operator">&lt;</span><span> </span><span class="hs-identifier">n_tys</span><span> </span><span class="hs-special">)</span><span>
</span><span id="line-969"></span><span>                     </span><span class="annot"><span class="annottext">Role -&gt; Role -&gt; Coercion -&gt; Coercion
</span><a href="GHC.Core.Coercion.html#downgradeRole"><span class="hs-identifier hs-var">downgradeRole</span></a></span><span> </span><span class="annot"><span class="annottext">Role
</span><a href="#local-6989586621681034743"><span class="hs-keyword hs-var">role</span></a></span><span> </span><span class="annot"><span class="annottext">Role
</span><a href="#local-6989586621681034736"><span class="hs-identifier hs-var">ax_role</span></a></span><span> </span><span class="annot"><span class="annottext">forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><a href="../../base-4.16.4.0/src/GHC-Base.html#%24"><span class="hs-operator hs-var">$</span></a></span><span>
</span><span id="line-970"></span><span>                     </span><span class="annot"><span class="annottext">Coercion -&gt; [Coercion] -&gt; Coercion
</span><a href="GHC.Core.Coercion.html#mkAppCos"><span class="hs-identifier hs-var">mkAppCos</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">CoAxiom Branched -&gt; Int -&gt; [Coercion] -&gt; Coercion
</span><a href="GHC.Core.Coercion.html#mkAxiomInstCo"><span class="hs-identifier hs-var">mkAxiomInstCo</span></a></span><span> </span><span class="annot"><span class="annottext">CoAxiom Branched
</span><a href="#local-6989586621681034735"><span class="hs-identifier hs-var">ax_br</span></a></span><span> </span><span class="annot"><span class="annottext">Int
</span><a href="#local-6989586621681034741"><span class="hs-identifier hs-var">index</span></a></span><span>
</span><span id="line-971"></span><span>                                             </span><span class="hs-special">(</span><span class="annot"><span class="annottext">[Coercion]
</span><a href="#local-6989586621681034731"><span class="hs-identifier hs-var">ax_args</span></a></span><span> </span><span class="annot"><span class="annottext">forall a. [a] -&gt; [a] -&gt; [a]
</span><a href="GHC.Utils.Misc.html#chkAppend"><span class="hs-operator hs-var">`chkAppend`</span></a></span><span> </span><span class="annot"><span class="annottext">[Coercion]
</span><a href="#local-6989586621681034739"><span class="hs-identifier hs-var">cos</span></a></span><span class="hs-special">)</span><span class="hs-special">)</span><span>
</span><span id="line-972"></span><span>                              </span><span class="annot"><span class="annottext">[Coercion]
</span><a href="#local-6989586621681034730"><span class="hs-identifier hs-var">leftover_args</span></a></span><span>
</span><span id="line-973"></span><span>  </span><span class="hs-keyword">where</span><span>
</span><span id="line-974"></span><span>    </span><span id="local-6989586621681034737"><span class="annot"><span class="annottext">n_tys :: Int
</span><a href="#local-6989586621681034737"><span class="hs-identifier hs-var hs-var">n_tys</span></a></span></span><span>         </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">forall (t :: * -&gt; *) a. Foldable t =&gt; t a -&gt; Int
</span><a href="../../base-4.16.4.0/src/Data-Foldable.html#length"><span class="hs-identifier hs-var">length</span></a></span><span> </span><span class="annot"><span class="annottext">[Type]
</span><a href="#local-6989586621681034740"><span class="hs-identifier hs-var">tys</span></a></span><span>
</span><span id="line-975"></span><span>    </span><span id="local-6989586621681034735"><span class="annot"><span class="annottext">ax_br :: CoAxiom Branched
</span><a href="#local-6989586621681034735"><span class="hs-identifier hs-var hs-var">ax_br</span></a></span></span><span>         </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">forall (br :: BranchFlag). CoAxiom br -&gt; CoAxiom Branched
</span><a href="GHC.Core.Coercion.Axiom.html#toBranchedAxiom"><span class="hs-identifier hs-var">toBranchedAxiom</span></a></span><span> </span><span class="annot"><span class="annottext">CoAxiom br
</span><a href="#local-6989586621681034742"><span class="hs-identifier hs-var">ax</span></a></span><span>
</span><span id="line-976"></span><span>    </span><span id="local-6989586621681034728"><span class="annot"><span class="annottext">branch :: CoAxBranch
</span><a href="#local-6989586621681034728"><span class="hs-identifier hs-var hs-var">branch</span></a></span></span><span>        </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">forall (br :: BranchFlag). CoAxiom br -&gt; Int -&gt; CoAxBranch
</span><a href="GHC.Core.Coercion.Axiom.html#coAxiomNthBranch"><span class="hs-identifier hs-var">coAxiomNthBranch</span></a></span><span> </span><span class="annot"><span class="annottext">CoAxiom Branched
</span><a href="#local-6989586621681034735"><span class="hs-identifier hs-var">ax_br</span></a></span><span> </span><span class="annot"><span class="annottext">Int
</span><a href="#local-6989586621681034741"><span class="hs-identifier hs-var">index</span></a></span><span>
</span><span id="line-977"></span><span>    </span><span id="local-6989586621681034726"><span class="annot"><span class="annottext">tvs :: [CoVar]
</span><a href="#local-6989586621681034726"><span class="hs-identifier hs-var hs-var">tvs</span></a></span></span><span>           </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">CoAxBranch -&gt; [CoVar]
</span><a href="GHC.Core.Coercion.Axiom.html#coAxBranchTyVars"><span class="hs-identifier hs-var">coAxBranchTyVars</span></a></span><span> </span><span class="annot"><span class="annottext">CoAxBranch
</span><a href="#local-6989586621681034728"><span class="hs-identifier hs-var">branch</span></a></span><span>
</span><span id="line-978"></span><span>    </span><span id="local-6989586621681034738"><span class="annot"><span class="annottext">arity :: Int
</span><a href="#local-6989586621681034738"><span class="hs-identifier hs-var hs-var">arity</span></a></span></span><span>         </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">forall (t :: * -&gt; *) a. Foldable t =&gt; t a -&gt; Int
</span><a href="../../base-4.16.4.0/src/Data-Foldable.html#length"><span class="hs-identifier hs-var">length</span></a></span><span> </span><span class="annot"><span class="annottext">[CoVar]
</span><a href="#local-6989586621681034726"><span class="hs-identifier hs-var">tvs</span></a></span><span>
</span><span id="line-979"></span><span>    </span><span id="local-6989586621681034724"><span class="annot"><span class="annottext">arg_roles :: [Role]
</span><a href="#local-6989586621681034724"><span class="hs-identifier hs-var hs-var">arg_roles</span></a></span></span><span>     </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">CoAxBranch -&gt; [Role]
</span><a href="GHC.Core.Coercion.Axiom.html#coAxBranchRoles"><span class="hs-identifier hs-var">coAxBranchRoles</span></a></span><span> </span><span class="annot"><span class="annottext">CoAxBranch
</span><a href="#local-6989586621681034728"><span class="hs-identifier hs-var">branch</span></a></span><span>
</span><span id="line-980"></span><span>    </span><span id="local-6989586621681034734"><span class="annot"><span class="annottext">rtys :: [Coercion]
</span><a href="#local-6989586621681034734"><span class="hs-identifier hs-var hs-var">rtys</span></a></span></span><span>          </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">forall a b c. (a -&gt; b -&gt; c) -&gt; [a] -&gt; [b] -&gt; [c]
</span><a href="../../base-4.16.4.0/src/GHC-List.html#zipWith"><span class="hs-identifier hs-var">zipWith</span></a></span><span> </span><span class="annot"><span class="annottext">Role -&gt; Type -&gt; Coercion
</span><a href="GHC.Core.Coercion.html#mkReflCo"><span class="hs-identifier hs-var">mkReflCo</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">[Role]
</span><a href="#local-6989586621681034724"><span class="hs-identifier hs-var">arg_roles</span></a></span><span> </span><span class="annot"><span class="annottext">forall a. [a] -&gt; [a] -&gt; [a]
</span><a href="../../base-4.16.4.0/src/GHC-Base.html#%2B%2B"><span class="hs-operator hs-var">++</span></a></span><span> </span><span class="annot"><span class="annottext">forall a. a -&gt; [a]
</span><a href="../../base-4.16.4.0/src/GHC-List.html#repeat"><span class="hs-identifier hs-var">repeat</span></a></span><span> </span><span class="annot"><span class="annottext">Role
</span><a href="GHC.Core.Coercion.Axiom.html#Nominal"><span class="hs-identifier hs-var">Nominal</span></a></span><span class="hs-special">)</span><span> </span><span class="annot"><span class="annottext">[Type]
</span><a href="#local-6989586621681034740"><span class="hs-identifier hs-var">tys</span></a></span><span>
</span><span id="line-981"></span><span>    </span><span class="hs-special">(</span><span id="local-6989586621681034731"><span class="annot"><span class="annottext">[Coercion]
</span><a href="#local-6989586621681034731"><span class="hs-identifier hs-var">ax_args</span></a></span></span><span class="hs-special">,</span><span> </span><span id="local-6989586621681034730"><span class="annot"><span class="annottext">[Coercion]
</span><a href="#local-6989586621681034730"><span class="hs-identifier hs-var">leftover_args</span></a></span></span><span class="hs-special">)</span><span>
</span><span id="line-982"></span><span>                  </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">forall a. Int -&gt; [a] -&gt; ([a], [a])
</span><a href="../../base-4.16.4.0/src/GHC-List.html#splitAt"><span class="hs-identifier hs-var">splitAt</span></a></span><span> </span><span class="annot"><span class="annottext">Int
</span><a href="#local-6989586621681034738"><span class="hs-identifier hs-var">arity</span></a></span><span> </span><span class="annot"><span class="annottext">[Coercion]
</span><a href="#local-6989586621681034734"><span class="hs-identifier hs-var">rtys</span></a></span><span>
</span><span id="line-983"></span><span>    </span><span id="local-6989586621681034736"><span class="annot"><span class="annottext">ax_role :: Role
</span><a href="#local-6989586621681034736"><span class="hs-identifier hs-var hs-var">ax_role</span></a></span></span><span>       </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">forall (br :: BranchFlag). CoAxiom br -&gt; Role
</span><a href="GHC.Core.Coercion.Axiom.html#coAxiomRole"><span class="hs-identifier hs-var">coAxiomRole</span></a></span><span> </span><span class="annot"><span class="annottext">CoAxiom br
</span><a href="#local-6989586621681034742"><span class="hs-identifier hs-var">ax</span></a></span><span>
</span><span id="line-984"></span><span>
</span><span id="line-985"></span><span class="hs-comment">-- worker function</span><span>
</span><span id="line-986"></span><span class="annot"><a href="GHC.Core.Coercion.html#mkAxiomInstCo"><span class="hs-identifier hs-type">mkAxiomInstCo</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><a href="GHC.Core.Coercion.Axiom.html#CoAxiom"><span class="hs-identifier hs-type">CoAxiom</span></a></span><span> </span><span class="annot"><a href="GHC.Core.Coercion.Axiom.html#Branched"><span class="hs-identifier hs-type">Branched</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="GHC.Core.Coercion.Axiom.html#BranchIndex"><span class="hs-identifier hs-type">BranchIndex</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-special">[</span><span class="annot"><a href="GHC.Core.TyCo.Rep.html#Coercion"><span class="hs-identifier hs-type">Coercion</span></a></span><span class="hs-special">]</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="GHC.Core.TyCo.Rep.html#Coercion"><span class="hs-identifier hs-type">Coercion</span></a></span><span>
</span><span id="line-987"></span><span id="mkAxiomInstCo"><span class="annot"><span class="annottext">mkAxiomInstCo :: CoAxiom Branched -&gt; Int -&gt; [Coercion] -&gt; Coercion
</span><a href="GHC.Core.Coercion.html#mkAxiomInstCo"><span class="hs-identifier hs-var hs-var">mkAxiomInstCo</span></a></span></span><span> </span><span id="local-6989586621681034719"><span class="annot"><span class="annottext">CoAxiom Branched
</span><a href="#local-6989586621681034719"><span class="hs-identifier hs-var">ax</span></a></span></span><span> </span><span id="local-6989586621681034718"><span class="annot"><span class="annottext">Int
</span><a href="#local-6989586621681034718"><span class="hs-identifier hs-var">index</span></a></span></span><span> </span><span id="local-6989586621681034717"><span class="annot"><span class="annottext">[Coercion]
</span><a href="#local-6989586621681034717"><span class="hs-identifier hs-var">args</span></a></span></span><span>
</span><span id="line-988"></span><span>  </span><span class="hs-glyph">=</span><span> </span><span class="hs-identifier">ASSERT</span><span class="hs-special">(</span><span> </span><span class="hs-identifier">args</span><span> </span><span class="hs-special">`</span><span class="hs-identifier">lengthIs</span><span class="hs-special">`</span><span> </span><span class="hs-identifier">coAxiomArity</span><span> </span><span class="hs-identifier">ax</span><span> </span><span class="hs-identifier">index</span><span> </span><span class="hs-special">)</span><span>
</span><span id="line-989"></span><span>    </span><span class="annot"><span class="annottext">CoAxiom Branched -&gt; Int -&gt; [Coercion] -&gt; Coercion
</span><a href="GHC.Core.TyCo.Rep.html#AxiomInstCo"><span class="hs-identifier hs-var">AxiomInstCo</span></a></span><span> </span><span class="annot"><span class="annottext">CoAxiom Branched
</span><a href="#local-6989586621681034719"><span class="hs-identifier hs-var">ax</span></a></span><span> </span><span class="annot"><span class="annottext">Int
</span><a href="#local-6989586621681034718"><span class="hs-identifier hs-var">index</span></a></span><span> </span><span class="annot"><span class="annottext">[Coercion]
</span><a href="#local-6989586621681034717"><span class="hs-identifier hs-var">args</span></a></span><span>
</span><span id="line-990"></span><span>
</span><span id="line-991"></span><span class="hs-comment">-- to be used only with unbranched axioms</span><span>
</span><span id="line-992"></span><span class="annot"><a href="GHC.Core.Coercion.html#mkUnbranchedAxInstCo"><span class="hs-identifier hs-type">mkUnbranchedAxInstCo</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><a href="GHC.Core.Coercion.Axiom.html#Role"><span class="hs-identifier hs-type">Role</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="GHC.Core.Coercion.Axiom.html#CoAxiom"><span class="hs-identifier hs-type">CoAxiom</span></a></span><span> </span><span class="annot"><a href="GHC.Core.Coercion.Axiom.html#Unbranched"><span class="hs-identifier hs-type">Unbranched</span></a></span><span>
</span><span id="line-993"></span><span>                     </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-special">[</span><span class="annot"><a href="GHC.Core.TyCo.Rep.html#Type"><span class="hs-identifier hs-type">Type</span></a></span><span class="hs-special">]</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-special">[</span><span class="annot"><a href="GHC.Core.TyCo.Rep.html#Coercion"><span class="hs-identifier hs-type">Coercion</span></a></span><span class="hs-special">]</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="GHC.Core.TyCo.Rep.html#Coercion"><span class="hs-identifier hs-type">Coercion</span></a></span><span>
</span><span id="line-994"></span><span id="mkUnbranchedAxInstCo"><span class="annot"><span class="annottext">mkUnbranchedAxInstCo :: Role -&gt; CoAxiom Unbranched -&gt; [Type] -&gt; [Coercion] -&gt; Coercion
</span><a href="GHC.Core.Coercion.html#mkUnbranchedAxInstCo"><span class="hs-identifier hs-var hs-var">mkUnbranchedAxInstCo</span></a></span></span><span> </span><span id="local-6989586621681034713"><span class="annot"><span class="annottext">Role
</span><a href="#local-6989586621681034713"><span class="hs-keyword hs-var">role</span></a></span></span><span> </span><span id="local-6989586621681034712"><span class="annot"><span class="annottext">CoAxiom Unbranched
</span><a href="#local-6989586621681034712"><span class="hs-identifier hs-var">ax</span></a></span></span><span> </span><span id="local-6989586621681034711"><span class="annot"><span class="annottext">[Type]
</span><a href="#local-6989586621681034711"><span class="hs-identifier hs-var">tys</span></a></span></span><span> </span><span id="local-6989586621681034710"><span class="annot"><span class="annottext">[Coercion]
</span><a href="#local-6989586621681034710"><span class="hs-identifier hs-var">cos</span></a></span></span><span>
</span><span id="line-995"></span><span>  </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">forall (br :: BranchFlag).
Role -&gt; CoAxiom br -&gt; Int -&gt; [Type] -&gt; [Coercion] -&gt; Coercion
</span><a href="GHC.Core.Coercion.html#mkAxInstCo"><span class="hs-identifier hs-var">mkAxInstCo</span></a></span><span> </span><span class="annot"><span class="annottext">Role
</span><a href="#local-6989586621681034713"><span class="hs-keyword hs-var">role</span></a></span><span> </span><span class="annot"><span class="annottext">CoAxiom Unbranched
</span><a href="#local-6989586621681034712"><span class="hs-identifier hs-var">ax</span></a></span><span> </span><span class="annot"><span class="annottext">Int
</span><span class="hs-number">0</span></span><span> </span><span class="annot"><span class="annottext">[Type]
</span><a href="#local-6989586621681034711"><span class="hs-identifier hs-var">tys</span></a></span><span> </span><span class="annot"><span class="annottext">[Coercion]
</span><a href="#local-6989586621681034710"><span class="hs-identifier hs-var">cos</span></a></span><span>
</span><span id="line-996"></span><span>
</span><span id="line-997"></span><span id="local-6989586621681035679"><span class="annot"><a href="GHC.Core.Coercion.html#mkAxInstRHS"><span class="hs-identifier hs-type">mkAxInstRHS</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><a href="GHC.Core.Coercion.Axiom.html#CoAxiom"><span class="hs-identifier hs-type">CoAxiom</span></a></span><span> </span><span class="annot"><a href="#local-6989586621681035679"><span class="hs-identifier hs-type">br</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="GHC.Core.Coercion.Axiom.html#BranchIndex"><span class="hs-identifier hs-type">BranchIndex</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-special">[</span><span class="annot"><a href="GHC.Core.TyCo.Rep.html#Type"><span class="hs-identifier hs-type">Type</span></a></span><span class="hs-special">]</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-special">[</span><span class="annot"><a href="GHC.Core.TyCo.Rep.html#Coercion"><span class="hs-identifier hs-type">Coercion</span></a></span><span class="hs-special">]</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="GHC.Core.TyCo.Rep.html#Type"><span class="hs-identifier hs-type">Type</span></a></span></span><span>
</span><span id="line-998"></span><span class="hs-comment">-- Instantiate the axiom with specified types,</span><span>
</span><span id="line-999"></span><span class="hs-comment">-- returning the instantiated RHS</span><span>
</span><span id="line-1000"></span><span class="hs-comment">-- A companion to mkAxInstCo:</span><span>
</span><span id="line-1001"></span><span class="hs-comment">--    mkAxInstRhs ax index tys = snd (coercionKind (mkAxInstCo ax index tys))</span><span>
</span><span id="line-1002"></span><span id="mkAxInstRHS"><span class="annot"><span class="annottext">mkAxInstRHS :: forall (br :: BranchFlag).
CoAxiom br -&gt; Int -&gt; [Type] -&gt; [Coercion] -&gt; Type
</span><a href="GHC.Core.Coercion.html#mkAxInstRHS"><span class="hs-identifier hs-var hs-var">mkAxInstRHS</span></a></span></span><span> </span><span id="local-6989586621681034707"><span class="annot"><span class="annottext">CoAxiom br
</span><a href="#local-6989586621681034707"><span class="hs-identifier hs-var">ax</span></a></span></span><span> </span><span id="local-6989586621681034706"><span class="annot"><span class="annottext">Int
</span><a href="#local-6989586621681034706"><span class="hs-identifier hs-var">index</span></a></span></span><span> </span><span id="local-6989586621681034705"><span class="annot"><span class="annottext">[Type]
</span><a href="#local-6989586621681034705"><span class="hs-identifier hs-var">tys</span></a></span></span><span> </span><span id="local-6989586621681034704"><span class="annot"><span class="annottext">[Coercion]
</span><a href="#local-6989586621681034704"><span class="hs-identifier hs-var">cos</span></a></span></span><span>
</span><span id="line-1003"></span><span>  </span><span class="hs-glyph">=</span><span> </span><span class="hs-identifier">ASSERT</span><span class="hs-special">(</span><span> </span><span class="hs-identifier">tvs</span><span> </span><span class="hs-special">`</span><span class="hs-identifier">equalLength</span><span class="hs-special">`</span><span> </span><span class="hs-identifier">tys1</span><span> </span><span class="hs-special">)</span><span>
</span><span id="line-1004"></span><span>    </span><span class="annot"><span class="annottext">Type -&gt; [Type] -&gt; Type
</span><a href="GHC.Core.Type.html#mkAppTys"><span class="hs-identifier hs-var">mkAppTys</span></a></span><span> </span><span class="annot"><span class="annottext">Type
</span><a href="#local-6989586621681034700"><span class="hs-identifier hs-var">rhs'</span></a></span><span> </span><span class="annot"><span class="annottext">[Type]
</span><a href="#local-6989586621681034699"><span class="hs-identifier hs-var">tys2</span></a></span><span>
</span><span id="line-1005"></span><span>  </span><span class="hs-keyword">where</span><span>
</span><span id="line-1006"></span><span>    </span><span id="local-6989586621681034698"><span class="annot"><span class="annottext">branch :: CoAxBranch
</span><a href="#local-6989586621681034698"><span class="hs-identifier hs-var hs-var">branch</span></a></span></span><span>       </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">forall (br :: BranchFlag). CoAxiom br -&gt; Int -&gt; CoAxBranch
</span><a href="GHC.Core.Coercion.Axiom.html#coAxiomNthBranch"><span class="hs-identifier hs-var">coAxiomNthBranch</span></a></span><span> </span><span class="annot"><span class="annottext">CoAxiom br
</span><a href="#local-6989586621681034707"><span class="hs-identifier hs-var">ax</span></a></span><span> </span><span class="annot"><span class="annottext">Int
</span><a href="#local-6989586621681034706"><span class="hs-identifier hs-var">index</span></a></span><span>
</span><span id="line-1007"></span><span>    </span><span id="local-6989586621681034703"><span class="annot"><span class="annottext">tvs :: [CoVar]
</span><a href="#local-6989586621681034703"><span class="hs-identifier hs-var hs-var">tvs</span></a></span></span><span>          </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">CoAxBranch -&gt; [CoVar]
</span><a href="GHC.Core.Coercion.Axiom.html#coAxBranchTyVars"><span class="hs-identifier hs-var">coAxBranchTyVars</span></a></span><span> </span><span class="annot"><span class="annottext">CoAxBranch
</span><a href="#local-6989586621681034698"><span class="hs-identifier hs-var">branch</span></a></span><span>
</span><span id="line-1008"></span><span>    </span><span id="local-6989586621681034697"><span class="annot"><span class="annottext">cvs :: [CoVar]
</span><a href="#local-6989586621681034697"><span class="hs-identifier hs-var hs-var">cvs</span></a></span></span><span>          </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">CoAxBranch -&gt; [CoVar]
</span><a href="GHC.Core.Coercion.Axiom.html#coAxBranchCoVars"><span class="hs-identifier hs-var">coAxBranchCoVars</span></a></span><span> </span><span class="annot"><span class="annottext">CoAxBranch
</span><a href="#local-6989586621681034698"><span class="hs-identifier hs-var">branch</span></a></span><span>
</span><span id="line-1009"></span><span>    </span><span class="hs-special">(</span><span id="local-6989586621681034701"><span class="annot"><span class="annottext">[Type]
</span><a href="#local-6989586621681034701"><span class="hs-identifier hs-var">tys1</span></a></span></span><span class="hs-special">,</span><span> </span><span id="local-6989586621681034699"><span class="annot"><span class="annottext">[Type]
</span><a href="#local-6989586621681034699"><span class="hs-identifier hs-var">tys2</span></a></span></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">forall b a. [b] -&gt; [a] -&gt; ([a], [a])
</span><a href="GHC.Utils.Misc.html#splitAtList"><span class="hs-identifier hs-var">splitAtList</span></a></span><span> </span><span class="annot"><span class="annottext">[CoVar]
</span><a href="#local-6989586621681034703"><span class="hs-identifier hs-var">tvs</span></a></span><span> </span><span class="annot"><span class="annottext">[Type]
</span><a href="#local-6989586621681034705"><span class="hs-identifier hs-var">tys</span></a></span><span>
</span><span id="line-1010"></span><span>    </span><span id="local-6989586621681034700"><span class="annot"><span class="annottext">rhs' :: Type
</span><a href="#local-6989586621681034700"><span class="hs-identifier hs-var hs-var">rhs'</span></a></span></span><span>         </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">HasCallStack =&gt; [CoVar] -&gt; [Type] -&gt; Type -&gt; Type
</span><a href="GHC.Core.TyCo.Subst.html#substTyWith"><span class="hs-identifier hs-var">substTyWith</span></a></span><span> </span><span class="annot"><span class="annottext">[CoVar]
</span><a href="#local-6989586621681034703"><span class="hs-identifier hs-var">tvs</span></a></span><span> </span><span class="annot"><span class="annottext">[Type]
</span><a href="#local-6989586621681034701"><span class="hs-identifier hs-var">tys1</span></a></span><span> </span><span class="annot"><span class="annottext">forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><a href="../../base-4.16.4.0/src/GHC-Base.html#%24"><span class="hs-operator hs-var">$</span></a></span><span>
</span><span id="line-1011"></span><span>                   </span><span class="annot"><span class="annottext">[CoVar] -&gt; [Coercion] -&gt; Type -&gt; Type
</span><a href="GHC.Core.TyCo.Subst.html#substTyWithCoVars"><span class="hs-identifier hs-var">substTyWithCoVars</span></a></span><span> </span><span class="annot"><span class="annottext">[CoVar]
</span><a href="#local-6989586621681034697"><span class="hs-identifier hs-var">cvs</span></a></span><span> </span><span class="annot"><span class="annottext">[Coercion]
</span><a href="#local-6989586621681034704"><span class="hs-identifier hs-var">cos</span></a></span><span> </span><span class="annot"><span class="annottext">forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><a href="../../base-4.16.4.0/src/GHC-Base.html#%24"><span class="hs-operator hs-var">$</span></a></span><span>
</span><span id="line-1012"></span><span>                   </span><span class="annot"><span class="annottext">CoAxBranch -&gt; Type
</span><a href="GHC.Core.Coercion.Axiom.html#coAxBranchRHS"><span class="hs-identifier hs-var">coAxBranchRHS</span></a></span><span> </span><span class="annot"><span class="annottext">CoAxBranch
</span><a href="#local-6989586621681034698"><span class="hs-identifier hs-var">branch</span></a></span><span>
</span><span id="line-1013"></span><span>
</span><span id="line-1014"></span><span class="annot"><a href="GHC.Core.Coercion.html#mkUnbranchedAxInstRHS"><span class="hs-identifier hs-type">mkUnbranchedAxInstRHS</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><a href="GHC.Core.Coercion.Axiom.html#CoAxiom"><span class="hs-identifier hs-type">CoAxiom</span></a></span><span> </span><span class="annot"><a href="GHC.Core.Coercion.Axiom.html#Unbranched"><span class="hs-identifier hs-type">Unbranched</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-special">[</span><span class="annot"><a href="GHC.Core.TyCo.Rep.html#Type"><span class="hs-identifier hs-type">Type</span></a></span><span class="hs-special">]</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-special">[</span><span class="annot"><a href="GHC.Core.TyCo.Rep.html#Coercion"><span class="hs-identifier hs-type">Coercion</span></a></span><span class="hs-special">]</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="GHC.Core.TyCo.Rep.html#Type"><span class="hs-identifier hs-type">Type</span></a></span><span>
</span><span id="line-1015"></span><span id="mkUnbranchedAxInstRHS"><span class="annot"><span class="annottext">mkUnbranchedAxInstRHS :: CoAxiom Unbranched -&gt; [Type] -&gt; [Coercion] -&gt; Type
</span><a href="GHC.Core.Coercion.html#mkUnbranchedAxInstRHS"><span class="hs-identifier hs-var hs-var">mkUnbranchedAxInstRHS</span></a></span></span><span> </span><span id="local-6989586621681034691"><span class="annot"><span class="annottext">CoAxiom Unbranched
</span><a href="#local-6989586621681034691"><span class="hs-identifier hs-var">ax</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">forall (br :: BranchFlag).
CoAxiom br -&gt; Int -&gt; [Type] -&gt; [Coercion] -&gt; Type
</span><a href="GHC.Core.Coercion.html#mkAxInstRHS"><span class="hs-identifier hs-var">mkAxInstRHS</span></a></span><span> </span><span class="annot"><span class="annottext">CoAxiom Unbranched
</span><a href="#local-6989586621681034691"><span class="hs-identifier hs-var">ax</span></a></span><span> </span><span class="annot"><span class="annottext">Int
</span><span class="hs-number">0</span></span><span>
</span><span id="line-1016"></span><span>
</span><span id="line-1017"></span><span class="hs-comment">-- | Return the left-hand type of the axiom, when the axiom is instantiated</span><span>
</span><span id="line-1018"></span><span class="hs-comment">-- at the types given.</span><span>
</span><span id="line-1019"></span><span id="local-6989586621681034690"><span class="annot"><a href="GHC.Core.Coercion.html#mkAxInstLHS"><span class="hs-identifier hs-type">mkAxInstLHS</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><a href="GHC.Core.Coercion.Axiom.html#CoAxiom"><span class="hs-identifier hs-type">CoAxiom</span></a></span><span> </span><span class="annot"><a href="#local-6989586621681034690"><span class="hs-identifier hs-type">br</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="GHC.Core.Coercion.Axiom.html#BranchIndex"><span class="hs-identifier hs-type">BranchIndex</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-special">[</span><span class="annot"><a href="GHC.Core.TyCo.Rep.html#Type"><span class="hs-identifier hs-type">Type</span></a></span><span class="hs-special">]</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-special">[</span><span class="annot"><a href="GHC.Core.TyCo.Rep.html#Coercion"><span class="hs-identifier hs-type">Coercion</span></a></span><span class="hs-special">]</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="GHC.Core.TyCo.Rep.html#Type"><span class="hs-identifier hs-type">Type</span></a></span></span><span>
</span><span id="line-1020"></span><span id="mkAxInstLHS"><span class="annot"><span class="annottext">mkAxInstLHS :: forall (br :: BranchFlag).
CoAxiom br -&gt; Int -&gt; [Type] -&gt; [Coercion] -&gt; Type
</span><a href="GHC.Core.Coercion.html#mkAxInstLHS"><span class="hs-identifier hs-var hs-var">mkAxInstLHS</span></a></span></span><span> </span><span id="local-6989586621681034689"><span class="annot"><span class="annottext">CoAxiom br
</span><a href="#local-6989586621681034689"><span class="hs-identifier hs-var">ax</span></a></span></span><span> </span><span id="local-6989586621681034688"><span class="annot"><span class="annottext">Int
</span><a href="#local-6989586621681034688"><span class="hs-identifier hs-var">index</span></a></span></span><span> </span><span id="local-6989586621681034687"><span class="annot"><span class="annottext">[Type]
</span><a href="#local-6989586621681034687"><span class="hs-identifier hs-var">tys</span></a></span></span><span> </span><span id="local-6989586621681034686"><span class="annot"><span class="annottext">[Coercion]
</span><a href="#local-6989586621681034686"><span class="hs-identifier hs-var">cos</span></a></span></span><span>
</span><span id="line-1021"></span><span>  </span><span class="hs-glyph">=</span><span> </span><span class="hs-identifier">ASSERT</span><span class="hs-special">(</span><span> </span><span class="hs-identifier">tvs</span><span> </span><span class="hs-special">`</span><span class="hs-identifier">equalLength</span><span class="hs-special">`</span><span> </span><span class="hs-identifier">tys1</span><span> </span><span class="hs-special">)</span><span>
</span><span id="line-1022"></span><span>    </span><span class="annot"><span class="annottext">TyCon -&gt; [Type] -&gt; Type
</span><a href="GHC.Core.Type.html#mkTyConApp"><span class="hs-identifier hs-var">mkTyConApp</span></a></span><span> </span><span class="annot"><span class="annottext">TyCon
</span><a href="#local-6989586621681034683"><span class="hs-identifier hs-var">fam_tc</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">[Type]
</span><a href="#local-6989586621681034682"><span class="hs-identifier hs-var">lhs_tys</span></a></span><span> </span><span class="annot"><span class="annottext">forall a. [a] -&gt; [a] -&gt; [a]
</span><a href="GHC.Utils.Misc.html#chkAppend"><span class="hs-operator hs-var">`chkAppend`</span></a></span><span> </span><span class="annot"><span class="annottext">[Type]
</span><a href="#local-6989586621681034681"><span class="hs-identifier hs-var">tys2</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-1023"></span><span>  </span><span class="hs-keyword">where</span><span>
</span><span id="line-1024"></span><span>    </span><span id="local-6989586621681034680"><span class="annot"><span class="annottext">branch :: CoAxBranch
</span><a href="#local-6989586621681034680"><span class="hs-identifier hs-var hs-var">branch</span></a></span></span><span>       </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">forall (br :: BranchFlag). CoAxiom br -&gt; Int -&gt; CoAxBranch
</span><a href="GHC.Core.Coercion.Axiom.html#coAxiomNthBranch"><span class="hs-identifier hs-var">coAxiomNthBranch</span></a></span><span> </span><span class="annot"><span class="annottext">CoAxiom br
</span><a href="#local-6989586621681034689"><span class="hs-identifier hs-var">ax</span></a></span><span> </span><span class="annot"><span class="annottext">Int
</span><a href="#local-6989586621681034688"><span class="hs-identifier hs-var">index</span></a></span><span>
</span><span id="line-1025"></span><span>    </span><span id="local-6989586621681034685"><span class="annot"><span class="annottext">tvs :: [CoVar]
</span><a href="#local-6989586621681034685"><span class="hs-identifier hs-var hs-var">tvs</span></a></span></span><span>          </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">CoAxBranch -&gt; [CoVar]
</span><a href="GHC.Core.Coercion.Axiom.html#coAxBranchTyVars"><span class="hs-identifier hs-var">coAxBranchTyVars</span></a></span><span> </span><span class="annot"><span class="annottext">CoAxBranch
</span><a href="#local-6989586621681034680"><span class="hs-identifier hs-var">branch</span></a></span><span>
</span><span id="line-1026"></span><span>    </span><span id="local-6989586621681034679"><span class="annot"><span class="annottext">cvs :: [CoVar]
</span><a href="#local-6989586621681034679"><span class="hs-identifier hs-var hs-var">cvs</span></a></span></span><span>          </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">CoAxBranch -&gt; [CoVar]
</span><a href="GHC.Core.Coercion.Axiom.html#coAxBranchCoVars"><span class="hs-identifier hs-var">coAxBranchCoVars</span></a></span><span> </span><span class="annot"><span class="annottext">CoAxBranch
</span><a href="#local-6989586621681034680"><span class="hs-identifier hs-var">branch</span></a></span><span>
</span><span id="line-1027"></span><span>    </span><span class="hs-special">(</span><span id="local-6989586621681034684"><span class="annot"><span class="annottext">[Type]
</span><a href="#local-6989586621681034684"><span class="hs-identifier hs-var">tys1</span></a></span></span><span class="hs-special">,</span><span> </span><span id="local-6989586621681034681"><span class="annot"><span class="annottext">[Type]
</span><a href="#local-6989586621681034681"><span class="hs-identifier hs-var">tys2</span></a></span></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">forall b a. [b] -&gt; [a] -&gt; ([a], [a])
</span><a href="GHC.Utils.Misc.html#splitAtList"><span class="hs-identifier hs-var">splitAtList</span></a></span><span> </span><span class="annot"><span class="annottext">[CoVar]
</span><a href="#local-6989586621681034685"><span class="hs-identifier hs-var">tvs</span></a></span><span> </span><span class="annot"><span class="annottext">[Type]
</span><a href="#local-6989586621681034687"><span class="hs-identifier hs-var">tys</span></a></span><span>
</span><span id="line-1028"></span><span>    </span><span id="local-6989586621681034682"><span class="annot"><span class="annottext">lhs_tys :: [Type]
</span><a href="#local-6989586621681034682"><span class="hs-identifier hs-var hs-var">lhs_tys</span></a></span></span><span>      </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">[CoVar] -&gt; [Type] -&gt; [Type] -&gt; [Type]
</span><a href="GHC.Core.TyCo.Subst.html#substTysWith"><span class="hs-identifier hs-var">substTysWith</span></a></span><span> </span><span class="annot"><span class="annottext">[CoVar]
</span><a href="#local-6989586621681034685"><span class="hs-identifier hs-var">tvs</span></a></span><span> </span><span class="annot"><span class="annottext">[Type]
</span><a href="#local-6989586621681034684"><span class="hs-identifier hs-var">tys1</span></a></span><span> </span><span class="annot"><span class="annottext">forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><a href="../../base-4.16.4.0/src/GHC-Base.html#%24"><span class="hs-operator hs-var">$</span></a></span><span>
</span><span id="line-1029"></span><span>                   </span><span class="annot"><span class="annottext">[CoVar] -&gt; [Coercion] -&gt; [Type] -&gt; [Type]
</span><a href="GHC.Core.TyCo.Subst.html#substTysWithCoVars"><span class="hs-identifier hs-var">substTysWithCoVars</span></a></span><span> </span><span class="annot"><span class="annottext">[CoVar]
</span><a href="#local-6989586621681034679"><span class="hs-identifier hs-var">cvs</span></a></span><span> </span><span class="annot"><span class="annottext">[Coercion]
</span><a href="#local-6989586621681034686"><span class="hs-identifier hs-var">cos</span></a></span><span> </span><span class="annot"><span class="annottext">forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><a href="../../base-4.16.4.0/src/GHC-Base.html#%24"><span class="hs-operator hs-var">$</span></a></span><span>
</span><span id="line-1030"></span><span>                   </span><span class="annot"><span class="annottext">CoAxBranch -&gt; [Type]
</span><a href="GHC.Core.Coercion.Axiom.html#coAxBranchLHS"><span class="hs-identifier hs-var">coAxBranchLHS</span></a></span><span> </span><span class="annot"><span class="annottext">CoAxBranch
</span><a href="#local-6989586621681034680"><span class="hs-identifier hs-var">branch</span></a></span><span>
</span><span id="line-1031"></span><span>    </span><span id="local-6989586621681034683"><span class="annot"><span class="annottext">fam_tc :: TyCon
</span><a href="#local-6989586621681034683"><span class="hs-identifier hs-var hs-var">fam_tc</span></a></span></span><span>       </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">forall (br :: BranchFlag). CoAxiom br -&gt; TyCon
</span><a href="GHC.Core.Coercion.Axiom.html#coAxiomTyCon"><span class="hs-identifier hs-var">coAxiomTyCon</span></a></span><span> </span><span class="annot"><span class="annottext">CoAxiom br
</span><a href="#local-6989586621681034689"><span class="hs-identifier hs-var">ax</span></a></span><span>
</span><span id="line-1032"></span><span>
</span><span id="line-1033"></span><span class="hs-comment">-- | Instantiate the left-hand side of an unbranched axiom</span><span>
</span><span id="line-1034"></span><span class="annot"><a href="GHC.Core.Coercion.html#mkUnbranchedAxInstLHS"><span class="hs-identifier hs-type">mkUnbranchedAxInstLHS</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><a href="GHC.Core.Coercion.Axiom.html#CoAxiom"><span class="hs-identifier hs-type">CoAxiom</span></a></span><span> </span><span class="annot"><a href="GHC.Core.Coercion.Axiom.html#Unbranched"><span class="hs-identifier hs-type">Unbranched</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-special">[</span><span class="annot"><a href="GHC.Core.TyCo.Rep.html#Type"><span class="hs-identifier hs-type">Type</span></a></span><span class="hs-special">]</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-special">[</span><span class="annot"><a href="GHC.Core.TyCo.Rep.html#Coercion"><span class="hs-identifier hs-type">Coercion</span></a></span><span class="hs-special">]</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="GHC.Core.TyCo.Rep.html#Type"><span class="hs-identifier hs-type">Type</span></a></span><span>
</span><span id="line-1035"></span><span id="mkUnbranchedAxInstLHS"><span class="annot"><span class="annottext">mkUnbranchedAxInstLHS :: CoAxiom Unbranched -&gt; [Type] -&gt; [Coercion] -&gt; Type
</span><a href="GHC.Core.Coercion.html#mkUnbranchedAxInstLHS"><span class="hs-identifier hs-var hs-var">mkUnbranchedAxInstLHS</span></a></span></span><span> </span><span id="local-6989586621681034674"><span class="annot"><span class="annottext">CoAxiom Unbranched
</span><a href="#local-6989586621681034674"><span class="hs-identifier hs-var">ax</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">forall (br :: BranchFlag).
CoAxiom br -&gt; Int -&gt; [Type] -&gt; [Coercion] -&gt; Type
</span><a href="GHC.Core.Coercion.html#mkAxInstLHS"><span class="hs-identifier hs-var">mkAxInstLHS</span></a></span><span> </span><span class="annot"><span class="annottext">CoAxiom Unbranched
</span><a href="#local-6989586621681034674"><span class="hs-identifier hs-var">ax</span></a></span><span> </span><span class="annot"><span class="annottext">Int
</span><span class="hs-number">0</span></span><span>
</span><span id="line-1036"></span><span>
</span><span id="line-1037"></span><span class="hs-comment">-- | Make a coercion from a coercion hole</span><span>
</span><span id="line-1038"></span><span class="annot"><a href="GHC.Core.Coercion.html#mkHoleCo"><span class="hs-identifier hs-type">mkHoleCo</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><a href="GHC.Core.TyCo.Rep.html#CoercionHole"><span class="hs-identifier hs-type">CoercionHole</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="GHC.Core.TyCo.Rep.html#Coercion"><span class="hs-identifier hs-type">Coercion</span></a></span><span>
</span><span id="line-1039"></span><span id="mkHoleCo"><span class="annot"><span class="annottext">mkHoleCo :: CoercionHole -&gt; Coercion
</span><a href="GHC.Core.Coercion.html#mkHoleCo"><span class="hs-identifier hs-var hs-var">mkHoleCo</span></a></span></span><span> </span><span id="local-6989586621681034673"><span class="annot"><span class="annottext">CoercionHole
</span><a href="#local-6989586621681034673"><span class="hs-identifier hs-var">h</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">CoercionHole -&gt; Coercion
</span><a href="GHC.Core.TyCo.Rep.html#HoleCo"><span class="hs-identifier hs-var">HoleCo</span></a></span><span> </span><span class="annot"><span class="annottext">CoercionHole
</span><a href="#local-6989586621681034673"><span class="hs-identifier hs-var">h</span></a></span><span>
</span><span id="line-1040"></span><span>
</span><span id="line-1041"></span><span class="hs-comment">-- | Make a universal coercion between two arbitrary types.</span><span>
</span><span id="line-1042"></span><span class="annot"><a href="GHC.Core.Coercion.html#mkUnivCo"><span class="hs-identifier hs-type">mkUnivCo</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><a href="GHC.Core.TyCo.Rep.html#UnivCoProvenance"><span class="hs-identifier hs-type">UnivCoProvenance</span></a></span><span>
</span><span id="line-1043"></span><span>         </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="GHC.Core.Coercion.Axiom.html#Role"><span class="hs-identifier hs-type">Role</span></a></span><span>       </span><span class="hs-comment">-- ^ role of the built coercion, &quot;r&quot;</span><span>
</span><span id="line-1044"></span><span>         </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="GHC.Core.TyCo.Rep.html#Type"><span class="hs-identifier hs-type">Type</span></a></span><span>       </span><span class="hs-comment">-- ^ t1 :: k1</span><span>
</span><span id="line-1045"></span><span>         </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="GHC.Core.TyCo.Rep.html#Type"><span class="hs-identifier hs-type">Type</span></a></span><span>       </span><span class="hs-comment">-- ^ t2 :: k2</span><span>
</span><span id="line-1046"></span><span>         </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="GHC.Core.TyCo.Rep.html#Coercion"><span class="hs-identifier hs-type">Coercion</span></a></span><span>   </span><span class="hs-comment">-- ^ :: t1 ~r t2</span><span>
</span><span id="line-1047"></span><span id="mkUnivCo"><span class="annot"><span class="annottext">mkUnivCo :: UnivCoProvenance -&gt; Role -&gt; Type -&gt; Type -&gt; Coercion
</span><a href="GHC.Core.Coercion.html#mkUnivCo"><span class="hs-identifier hs-var hs-var">mkUnivCo</span></a></span></span><span> </span><span id="local-6989586621681034671"><span class="annot"><span class="annottext">UnivCoProvenance
</span><a href="#local-6989586621681034671"><span class="hs-identifier hs-var">prov</span></a></span></span><span> </span><span id="local-6989586621681034670"><span class="annot"><span class="annottext">Role
</span><a href="#local-6989586621681034670"><span class="hs-keyword hs-var">role</span></a></span></span><span> </span><span id="local-6989586621681034669"><span class="annot"><span class="annottext">Type
</span><a href="#local-6989586621681034669"><span class="hs-identifier hs-var">ty1</span></a></span></span><span> </span><span id="local-6989586621681034668"><span class="annot"><span class="annottext">Type
</span><a href="#local-6989586621681034668"><span class="hs-identifier hs-var">ty2</span></a></span></span><span>
</span><span id="line-1048"></span><span>  </span><span class="hs-glyph">|</span><span> </span><span class="annot"><span class="annottext">Type
</span><a href="#local-6989586621681034669"><span class="hs-identifier hs-var">ty1</span></a></span><span> </span><span class="annot"><span class="annottext">Type -&gt; Type -&gt; Bool
</span><a href="GHC.Core.Type.html#eqType"><span class="hs-operator hs-var">`eqType`</span></a></span><span> </span><span class="annot"><span class="annottext">Type
</span><a href="#local-6989586621681034668"><span class="hs-identifier hs-var">ty2</span></a></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">Role -&gt; Type -&gt; Coercion
</span><a href="GHC.Core.Coercion.html#mkReflCo"><span class="hs-identifier hs-var">mkReflCo</span></a></span><span> </span><span class="annot"><span class="annottext">Role
</span><a href="#local-6989586621681034670"><span class="hs-keyword hs-var">role</span></a></span><span> </span><span class="annot"><span class="annottext">Type
</span><a href="#local-6989586621681034669"><span class="hs-identifier hs-var">ty1</span></a></span><span>
</span><span id="line-1049"></span><span>  </span><span class="hs-glyph">|</span><span> </span><span class="annot"><span class="annottext">Bool
</span><a href="../../base-4.16.4.0/src/GHC-Base.html#otherwise"><span class="hs-identifier hs-var">otherwise</span></a></span><span>        </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">UnivCoProvenance -&gt; Role -&gt; Type -&gt; Type -&gt; Coercion
</span><a href="GHC.Core.TyCo.Rep.html#UnivCo"><span class="hs-identifier hs-var">UnivCo</span></a></span><span> </span><span class="annot"><span class="annottext">UnivCoProvenance
</span><a href="#local-6989586621681034671"><span class="hs-identifier hs-var">prov</span></a></span><span> </span><span class="annot"><span class="annottext">Role
</span><a href="#local-6989586621681034670"><span class="hs-keyword hs-var">role</span></a></span><span> </span><span class="annot"><span class="annottext">Type
</span><a href="#local-6989586621681034669"><span class="hs-identifier hs-var">ty1</span></a></span><span> </span><span class="annot"><span class="annottext">Type
</span><a href="#local-6989586621681034668"><span class="hs-identifier hs-var">ty2</span></a></span><span>
</span><span id="line-1050"></span><span>
</span><span id="line-1051"></span><span class="hs-comment">-- | Create a symmetric version of the given 'Coercion' that asserts</span><span>
</span><span id="line-1052"></span><span class="hs-comment">--   equality between the same types but in the other &quot;direction&quot;, so</span><span>
</span><span id="line-1053"></span><span class="hs-comment">--   a kind of @t1 ~ t2@ becomes the kind @t2 ~ t1@.</span><span>
</span><span id="line-1054"></span><span class="annot"><a href="GHC.Core.Coercion.html#mkSymCo"><span class="hs-identifier hs-type">mkSymCo</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><a href="GHC.Core.TyCo.Rep.html#Coercion"><span class="hs-identifier hs-type">Coercion</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="GHC.Core.TyCo.Rep.html#Coercion"><span class="hs-identifier hs-type">Coercion</span></a></span><span>
</span><span id="line-1055"></span><span>
</span><span id="line-1056"></span><span class="hs-comment">-- Do a few simple optimizations, but don't bother pushing occurrences</span><span>
</span><span id="line-1057"></span><span class="hs-comment">-- of symmetry to the leaves; the optimizer will take care of that.</span><span>
</span><span id="line-1058"></span><span id="mkSymCo"><span class="annot"><span class="annottext">mkSymCo :: Coercion -&gt; Coercion
</span><a href="GHC.Core.Coercion.html#mkSymCo"><span class="hs-identifier hs-var hs-var">mkSymCo</span></a></span></span><span> </span><span id="local-6989586621681034666"><span class="annot"><span class="annottext">Coercion
</span><a href="#local-6989586621681034666"><span class="hs-identifier hs-var">co</span></a></span></span><span> </span><span class="hs-glyph">|</span><span> </span><span class="annot"><span class="annottext">Coercion -&gt; Bool
</span><a href="GHC.Core.Coercion.html#isReflCo"><span class="hs-identifier hs-var">isReflCo</span></a></span><span> </span><span class="annot"><span class="annottext">Coercion
</span><a href="#local-6989586621681034666"><span class="hs-identifier hs-var">co</span></a></span><span>          </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">Coercion
</span><a href="#local-6989586621681034666"><span class="hs-identifier hs-var">co</span></a></span><span>
</span><span id="line-1059"></span><span class="annot"><a href="GHC.Core.Coercion.html#mkSymCo"><span class="hs-identifier hs-var">mkSymCo</span></a></span><span>    </span><span class="hs-special">(</span><span class="annot"><a href="GHC.Core.TyCo.Rep.html#SymCo"><span class="hs-identifier hs-type">SymCo</span></a></span><span> </span><span id="local-6989586621681034664"><span class="annot"><span class="annottext">Coercion
</span><a href="#local-6989586621681034664"><span class="hs-identifier hs-var">co</span></a></span></span><span class="hs-special">)</span><span>             </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">Coercion
</span><a href="#local-6989586621681034664"><span class="hs-identifier hs-var">co</span></a></span><span>
</span><span id="line-1060"></span><span class="annot"><a href="GHC.Core.Coercion.html#mkSymCo"><span class="hs-identifier hs-var">mkSymCo</span></a></span><span>    </span><span class="hs-special">(</span><span class="annot"><a href="GHC.Core.TyCo.Rep.html#SubCo"><span class="hs-identifier hs-type">SubCo</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="GHC.Core.TyCo.Rep.html#SymCo"><span class="hs-identifier hs-type">SymCo</span></a></span><span> </span><span id="local-6989586621681034662"><span class="annot"><span class="annottext">Coercion
</span><a href="#local-6989586621681034662"><span class="hs-identifier hs-var">co</span></a></span></span><span class="hs-special">)</span><span class="hs-special">)</span><span>     </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">Coercion -&gt; Coercion
</span><a href="GHC.Core.TyCo.Rep.html#SubCo"><span class="hs-identifier hs-var">SubCo</span></a></span><span> </span><span class="annot"><span class="annottext">Coercion
</span><a href="#local-6989586621681034662"><span class="hs-identifier hs-var">co</span></a></span><span>
</span><span id="line-1061"></span><span class="annot"><a href="GHC.Core.Coercion.html#mkSymCo"><span class="hs-identifier hs-var">mkSymCo</span></a></span><span> </span><span id="local-6989586621681034661"><span class="annot"><span class="annottext">Coercion
</span><a href="#local-6989586621681034661"><span class="hs-identifier hs-var">co</span></a></span></span><span>                        </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">Coercion -&gt; Coercion
</span><a href="GHC.Core.TyCo.Rep.html#SymCo"><span class="hs-identifier hs-var">SymCo</span></a></span><span> </span><span class="annot"><span class="annottext">Coercion
</span><a href="#local-6989586621681034661"><span class="hs-identifier hs-var">co</span></a></span><span>
</span><span id="line-1062"></span><span>
</span><span id="line-1063"></span><span class="hs-comment">-- | Create a new 'Coercion' by composing the two given 'Coercion's transitively.</span><span>
</span><span id="line-1064"></span><span class="hs-comment">--   (co1 ; co2)</span><span>
</span><span id="line-1065"></span><span class="annot"><a href="GHC.Core.Coercion.html#mkTransCo"><span class="hs-identifier hs-type">mkTransCo</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><a href="GHC.Core.TyCo.Rep.html#Coercion"><span class="hs-identifier hs-type">Coercion</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="GHC.Core.TyCo.Rep.html#Coercion"><span class="hs-identifier hs-type">Coercion</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="GHC.Core.TyCo.Rep.html#Coercion"><span class="hs-identifier hs-type">Coercion</span></a></span><span>
</span><span id="line-1066"></span><span id="mkTransCo"><span class="annot"><span class="annottext">mkTransCo :: Coercion -&gt; Coercion -&gt; Coercion
</span><a href="GHC.Core.Coercion.html#mkTransCo"><span class="hs-identifier hs-var hs-var">mkTransCo</span></a></span></span><span> </span><span id="local-6989586621681034660"><span class="annot"><span class="annottext">Coercion
</span><a href="#local-6989586621681034660"><span class="hs-identifier hs-var">co1</span></a></span></span><span> </span><span id="local-6989586621681034659"><span class="annot"><span class="annottext">Coercion
</span><a href="#local-6989586621681034659"><span class="hs-identifier hs-var">co2</span></a></span></span><span> </span><span class="hs-glyph">|</span><span> </span><span class="annot"><span class="annottext">Coercion -&gt; Bool
</span><a href="GHC.Core.Coercion.html#isReflCo"><span class="hs-identifier hs-var">isReflCo</span></a></span><span> </span><span class="annot"><span class="annottext">Coercion
</span><a href="#local-6989586621681034660"><span class="hs-identifier hs-var">co1</span></a></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">Coercion
</span><a href="#local-6989586621681034659"><span class="hs-identifier hs-var">co2</span></a></span><span>
</span><span id="line-1067"></span><span>                  </span><span class="hs-glyph">|</span><span> </span><span class="annot"><span class="annottext">Coercion -&gt; Bool
</span><a href="GHC.Core.Coercion.html#isReflCo"><span class="hs-identifier hs-var">isReflCo</span></a></span><span> </span><span class="annot"><span class="annottext">Coercion
</span><a href="#local-6989586621681034659"><span class="hs-identifier hs-var">co2</span></a></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">Coercion
</span><a href="#local-6989586621681034660"><span class="hs-identifier hs-var">co1</span></a></span><span>
</span><span id="line-1068"></span><span class="annot"><a href="GHC.Core.Coercion.html#mkTransCo"><span class="hs-identifier hs-var">mkTransCo</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="GHC.Core.TyCo.Rep.html#GRefl"><span class="hs-identifier hs-type">GRefl</span></a></span><span> </span><span id="local-6989586621681034658"><span class="annot"><span class="annottext">Role
</span><a href="#local-6989586621681034658"><span class="hs-identifier hs-var">r</span></a></span></span><span> </span><span id="local-6989586621681034657"><span class="annot"><span class="annottext">Type
</span><a href="#local-6989586621681034657"><span class="hs-identifier hs-var">t1</span></a></span></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="GHC.Core.TyCo.Rep.html#MCo"><span class="hs-identifier hs-type">MCo</span></a></span><span> </span><span id="local-6989586621681034656"><span class="annot"><span class="annottext">Coercion
</span><a href="#local-6989586621681034656"><span class="hs-identifier hs-var">co1</span></a></span></span><span class="hs-special">)</span><span class="hs-special">)</span><span> </span><span class="hs-special">(</span><span class="annot"><a href="GHC.Core.TyCo.Rep.html#GRefl"><span class="hs-identifier hs-type">GRefl</span></a></span><span> </span><span class="annot"><span class="annottext">Role
</span><span class="hs-identifier">_</span></span><span> </span><span class="annot"><span class="annottext">Type
</span><span class="hs-identifier">_</span></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="GHC.Core.TyCo.Rep.html#MCo"><span class="hs-identifier hs-type">MCo</span></a></span><span> </span><span id="local-6989586621681034655"><span class="annot"><span class="annottext">Coercion
</span><a href="#local-6989586621681034655"><span class="hs-identifier hs-var">co2</span></a></span></span><span class="hs-special">)</span><span class="hs-special">)</span><span>
</span><span id="line-1069"></span><span>  </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">Role -&gt; Type -&gt; MCoercion -&gt; Coercion
</span><a href="GHC.Core.TyCo.Rep.html#GRefl"><span class="hs-identifier hs-var">GRefl</span></a></span><span> </span><span class="annot"><span class="annottext">Role
</span><a href="#local-6989586621681034658"><span class="hs-identifier hs-var">r</span></a></span><span> </span><span class="annot"><span class="annottext">Type
</span><a href="#local-6989586621681034657"><span class="hs-identifier hs-var">t1</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Coercion -&gt; MCoercion
</span><a href="GHC.Core.TyCo.Rep.html#MCo"><span class="hs-identifier hs-var">MCo</span></a></span><span> </span><span class="annot"><span class="annottext">forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><a href="../../base-4.16.4.0/src/GHC-Base.html#%24"><span class="hs-operator hs-var">$</span></a></span><span> </span><span class="annot"><span class="annottext">Coercion -&gt; Coercion -&gt; Coercion
</span><a href="GHC.Core.Coercion.html#mkTransCo"><span class="hs-identifier hs-var">mkTransCo</span></a></span><span> </span><span class="annot"><span class="annottext">Coercion
</span><a href="#local-6989586621681034656"><span class="hs-identifier hs-var">co1</span></a></span><span> </span><span class="annot"><span class="annottext">Coercion
</span><a href="#local-6989586621681034655"><span class="hs-identifier hs-var">co2</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-1070"></span><span class="annot"><a href="GHC.Core.Coercion.html#mkTransCo"><span class="hs-identifier hs-var">mkTransCo</span></a></span><span> </span><span id="local-6989586621681034654"><span class="annot"><span class="annottext">Coercion
</span><a href="#local-6989586621681034654"><span class="hs-identifier hs-var">co1</span></a></span></span><span> </span><span id="local-6989586621681034653"><span class="annot"><span class="annottext">Coercion
</span><a href="#local-6989586621681034653"><span class="hs-identifier hs-var">co2</span></a></span></span><span>                 </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">Coercion -&gt; Coercion -&gt; Coercion
</span><a href="GHC.Core.TyCo.Rep.html#TransCo"><span class="hs-identifier hs-var">TransCo</span></a></span><span> </span><span class="annot"><span class="annottext">Coercion
</span><a href="#local-6989586621681034654"><span class="hs-identifier hs-var">co1</span></a></span><span> </span><span class="annot"><span class="annottext">Coercion
</span><a href="#local-6989586621681034653"><span class="hs-identifier hs-var">co2</span></a></span><span>
</span><span id="line-1071"></span><span>
</span><span id="line-1072"></span><span class="annot"><a href="GHC.Core.Coercion.html#mkNthCo"><span class="hs-identifier hs-type">mkNthCo</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><a href="GHC.Utils.Misc.html#HasDebugCallStack"><span class="hs-identifier hs-type">HasDebugCallStack</span></a></span><span>
</span><span id="line-1073"></span><span>        </span><span class="hs-glyph">=&gt;</span><span> </span><span class="annot"><a href="GHC.Core.Coercion.Axiom.html#Role"><span class="hs-identifier hs-type">Role</span></a></span><span>  </span><span class="hs-comment">-- The role of the coercion you're creating</span><span>
</span><span id="line-1074"></span><span>        </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="hs-identifier hs-type">Int</span></span><span>   </span><span class="hs-comment">-- Zero-indexed</span><span>
</span><span id="line-1075"></span><span>        </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="GHC.Core.TyCo.Rep.html#Coercion"><span class="hs-identifier hs-type">Coercion</span></a></span><span>
</span><span id="line-1076"></span><span>        </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="GHC.Core.TyCo.Rep.html#Coercion"><span class="hs-identifier hs-type">Coercion</span></a></span><span>
</span><span id="line-1077"></span><span id="mkNthCo"><span class="annot"><span class="annottext">mkNthCo :: HasDebugCallStack =&gt; Role -&gt; Int -&gt; Coercion -&gt; Coercion
</span><a href="GHC.Core.Coercion.html#mkNthCo"><span class="hs-identifier hs-var hs-var">mkNthCo</span></a></span></span><span> </span><span id="local-6989586621681034606"><span class="annot"><span class="annottext">Role
</span><a href="#local-6989586621681034606"><span class="hs-identifier hs-var">r</span></a></span></span><span> </span><span id="local-6989586621681034605"><span class="annot"><span class="annottext">Int
</span><a href="#local-6989586621681034605"><span class="hs-identifier hs-var">n</span></a></span></span><span> </span><span id="local-6989586621681034604"><span class="annot"><span class="annottext">Coercion
</span><a href="#local-6989586621681034604"><span class="hs-identifier hs-var">co</span></a></span></span><span>
</span><span id="line-1078"></span><span>  </span><span class="hs-glyph">=</span><span> </span><span class="hs-identifier">ASSERT2</span><span class="hs-special">(</span><span> </span><span class="hs-identifier">good_call</span><span class="hs-special">,</span><span> </span><span class="hs-identifier">bad_call_msg</span><span> </span><span class="hs-special">)</span><span>
</span><span id="line-1079"></span><span>    </span><span class="annot"><span class="annottext">Int -&gt; Coercion -&gt; Coercion
</span><a href="#local-6989586621681034601"><span class="hs-identifier hs-var">go</span></a></span><span> </span><span class="annot"><span class="annottext">Int
</span><a href="#local-6989586621681034605"><span class="hs-identifier hs-var">n</span></a></span><span> </span><span class="annot"><span class="annottext">Coercion
</span><a href="#local-6989586621681034604"><span class="hs-identifier hs-var">co</span></a></span><span>
</span><span id="line-1080"></span><span>  </span><span class="hs-keyword">where</span><span>
</span><span id="line-1081"></span><span>    </span><span class="annot"><a href="GHC.Data.Pair.html#Pair"><span class="hs-identifier hs-type">Pair</span></a></span><span> </span><span id="local-6989586621681034600"><span class="annot"><span class="annottext">Type
</span><a href="#local-6989586621681034600"><span class="hs-identifier hs-var">ty1</span></a></span></span><span> </span><span id="local-6989586621681034599"><span class="annot"><span class="annottext">Type
</span><a href="#local-6989586621681034599"><span class="hs-identifier hs-var">ty2</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">Coercion -&gt; Pair Type
</span><a href="GHC.Core.Coercion.html#coercionKind"><span class="hs-identifier hs-var">coercionKind</span></a></span><span> </span><span class="annot"><span class="annottext">Coercion
</span><a href="#local-6989586621681034604"><span class="hs-identifier hs-var">co</span></a></span><span>
</span><span id="line-1082"></span><span>
</span><span id="line-1083"></span><span>    </span><span id="local-6989586621681034601"><span class="annot"><span class="annottext">go :: Int -&gt; Coercion -&gt; Coercion
</span><a href="#local-6989586621681034601"><span class="hs-identifier hs-var hs-var">go</span></a></span></span><span> </span><span class="annot"><span class="annottext">Int
</span><span class="hs-number">0</span></span><span> </span><span id="local-6989586621681034598"><span class="annot"><span class="annottext">Coercion
</span><a href="#local-6989586621681034598"><span class="hs-identifier hs-var">co</span></a></span></span><span>
</span><span id="line-1084"></span><span>      </span><span class="hs-glyph">|</span><span> </span><span class="annot"><a href="../../base-4.16.4.0/src/GHC-Maybe.html#Just"><span class="hs-identifier hs-type">Just</span></a></span><span> </span><span class="hs-special">(</span><span id="local-6989586621681034597"><span class="annot"><span class="annottext">Type
</span><a href="#local-6989586621681034597"><span class="hs-identifier hs-var">ty</span></a></span></span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">Role
</span><span class="hs-identifier">_</span></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">Coercion -&gt; Maybe (Type, Role)
</span><a href="GHC.Core.Coercion.html#isReflCo_maybe"><span class="hs-identifier hs-var">isReflCo_maybe</span></a></span><span> </span><span class="annot"><span class="annottext">Coercion
</span><a href="#local-6989586621681034598"><span class="hs-identifier hs-var">co</span></a></span><span>
</span><span id="line-1085"></span><span>      </span><span class="hs-special">,</span><span> </span><span class="annot"><a href="../../base-4.16.4.0/src/GHC-Maybe.html#Just"><span class="hs-identifier hs-type">Just</span></a></span><span> </span><span class="hs-special">(</span><span id="local-6989586621681034596"><span class="annot"><span class="annottext">CoVar
</span><a href="#local-6989586621681034596"><span class="hs-identifier hs-var">tv</span></a></span></span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">Type
</span><span class="hs-identifier">_</span></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">Type -&gt; Maybe (CoVar, Type)
</span><a href="GHC.Core.Type.html#splitForAllTyCoVar_maybe"><span class="hs-identifier hs-var">splitForAllTyCoVar_maybe</span></a></span><span> </span><span class="annot"><span class="annottext">Type
</span><a href="#local-6989586621681034597"><span class="hs-identifier hs-var">ty</span></a></span><span>
</span><span id="line-1086"></span><span>      </span><span class="hs-glyph">=</span><span> </span><span class="hs-comment">-- works for both tyvar and covar</span><span>
</span><span id="line-1087"></span><span>        </span><span class="hs-identifier">ASSERT</span><span class="hs-special">(</span><span> </span><span class="hs-identifier">r</span><span> </span><span class="hs-operator">==</span><span> </span><span class="hs-identifier">Nominal</span><span> </span><span class="hs-special">)</span><span>
</span><span id="line-1088"></span><span>        </span><span class="annot"><span class="annottext">Type -&gt; Coercion
</span><a href="GHC.Core.Coercion.html#mkNomReflCo"><span class="hs-identifier hs-var">mkNomReflCo</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">CoVar -&gt; Type
</span><a href="GHC.Types.Var.html#varType"><span class="hs-identifier hs-var">varType</span></a></span><span> </span><span class="annot"><span class="annottext">CoVar
</span><a href="#local-6989586621681034596"><span class="hs-identifier hs-var">tv</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-1089"></span><span>
</span><span id="line-1090"></span><span>    </span><span class="annot"><a href="#local-6989586621681034601"><span class="hs-identifier hs-var">go</span></a></span><span> </span><span id="local-6989586621681034595"><span class="annot"><span class="annottext">Int
</span><a href="#local-6989586621681034595"><span class="hs-identifier hs-var">n</span></a></span></span><span> </span><span id="local-6989586621681034594"><span class="annot"><span class="annottext">Coercion
</span><a href="#local-6989586621681034594"><span class="hs-identifier hs-var">co</span></a></span></span><span>
</span><span id="line-1091"></span><span>      </span><span class="hs-glyph">|</span><span> </span><span class="annot"><a href="../../base-4.16.4.0/src/GHC-Maybe.html#Just"><span class="hs-identifier hs-type">Just</span></a></span><span> </span><span class="hs-special">(</span><span id="local-6989586621681034593"><span class="annot"><span class="annottext">Type
</span><a href="#local-6989586621681034593"><span class="hs-identifier hs-var">ty</span></a></span></span><span class="hs-special">,</span><span> </span><span id="local-6989586621681034592"><span class="annot"><span class="annottext">Role
</span><a href="#local-6989586621681034592"><span class="hs-identifier hs-var">r0</span></a></span></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">Coercion -&gt; Maybe (Type, Role)
</span><a href="GHC.Core.Coercion.html#isReflCo_maybe"><span class="hs-identifier hs-var">isReflCo_maybe</span></a></span><span> </span><span class="annot"><span class="annottext">Coercion
</span><a href="#local-6989586621681034594"><span class="hs-identifier hs-var">co</span></a></span><span>
</span><span id="line-1092"></span><span>      </span><span class="hs-special">,</span><span> </span><span class="hs-keyword">let</span><span> </span><span id="local-6989586621681034591"><span class="annot"><span class="annottext">tc :: TyCon
</span><a href="#local-6989586621681034591"><span class="hs-identifier hs-var hs-var">tc</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">Type -&gt; TyCon
</span><a href="GHC.Core.Type.html#tyConAppTyCon"><span class="hs-identifier hs-var">tyConAppTyCon</span></a></span><span> </span><span class="annot"><span class="annottext">Type
</span><a href="#local-6989586621681034593"><span class="hs-identifier hs-var">ty</span></a></span><span>
</span><span id="line-1093"></span><span>      </span><span class="hs-glyph">=</span><span> </span><span class="hs-identifier">ASSERT2</span><span class="hs-special">(</span><span> </span><span class="hs-identifier">ok_tc_app</span><span> </span><span class="hs-identifier">ty</span><span> </span><span class="hs-identifier">n</span><span class="hs-special">,</span><span> </span><span class="hs-identifier">ppr</span><span> </span><span class="hs-identifier">n</span><span> </span><span class="hs-operator">$$</span><span> </span><span class="hs-identifier">ppr</span><span> </span><span class="hs-identifier">ty</span><span> </span><span class="hs-special">)</span><span>
</span><span id="line-1094"></span><span>        </span><span class="hs-identifier">ASSERT</span><span class="hs-special">(</span><span> </span><span class="hs-identifier">nthRole</span><span> </span><span class="hs-identifier">r0</span><span> </span><span class="hs-identifier">tc</span><span> </span><span class="hs-identifier">n</span><span> </span><span class="hs-operator">==</span><span> </span><span class="hs-identifier">r</span><span> </span><span class="hs-special">)</span><span>
</span><span id="line-1095"></span><span>        </span><span class="annot"><span class="annottext">Role -&gt; Type -&gt; Coercion
</span><a href="GHC.Core.Coercion.html#mkReflCo"><span class="hs-identifier hs-var">mkReflCo</span></a></span><span> </span><span class="annot"><span class="annottext">Role
</span><a href="#local-6989586621681034606"><span class="hs-identifier hs-var">r</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Int -&gt; Type -&gt; Type
</span><a href="GHC.Core.Type.html#tyConAppArgN"><span class="hs-identifier hs-var">tyConAppArgN</span></a></span><span> </span><span class="annot"><span class="annottext">Int
</span><a href="#local-6989586621681034595"><span class="hs-identifier hs-var">n</span></a></span><span> </span><span class="annot"><span class="annottext">Type
</span><a href="#local-6989586621681034593"><span class="hs-identifier hs-var">ty</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-1096"></span><span>      </span><span class="hs-keyword">where</span><span> </span><span class="annot"><a href="#local-6989586621681034589"><span class="hs-identifier hs-type">ok_tc_app</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><a href="GHC.Core.TyCo.Rep.html#Type"><span class="hs-identifier hs-type">Type</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="hs-identifier hs-type">Int</span></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="hs-identifier hs-type">Bool</span></span><span>
</span><span id="line-1097"></span><span>            </span><span id="local-6989586621681034589"><span class="annot"><span class="annottext">ok_tc_app :: Type -&gt; Int -&gt; Bool
</span><a href="#local-6989586621681034589"><span class="hs-identifier hs-var hs-var">ok_tc_app</span></a></span></span><span> </span><span id="local-6989586621681034587"><span class="annot"><span class="annottext">Type
</span><a href="#local-6989586621681034587"><span class="hs-identifier hs-var">ty</span></a></span></span><span> </span><span id="local-6989586621681034586"><span class="annot"><span class="annottext">Int
</span><a href="#local-6989586621681034586"><span class="hs-identifier hs-var">n</span></a></span></span><span>
</span><span id="line-1098"></span><span>              </span><span class="hs-glyph">|</span><span> </span><span class="annot"><a href="../../base-4.16.4.0/src/GHC-Maybe.html#Just"><span class="hs-identifier hs-type">Just</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">TyCon
</span><span class="hs-identifier">_</span></span><span class="hs-special">,</span><span> </span><span id="local-6989586621681034585"><span class="annot"><span class="annottext">[Type]
</span><a href="#local-6989586621681034585"><span class="hs-identifier hs-var">tys</span></a></span></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">HasDebugCallStack =&gt; Type -&gt; Maybe (TyCon, [Type])
</span><a href="GHC.Core.Type.html#splitTyConApp_maybe"><span class="hs-identifier hs-var">splitTyConApp_maybe</span></a></span><span> </span><span class="annot"><span class="annottext">Type
</span><a href="#local-6989586621681034587"><span class="hs-identifier hs-var">ty</span></a></span><span>
</span><span id="line-1099"></span><span>              </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">[Type]
</span><a href="#local-6989586621681034585"><span class="hs-identifier hs-var">tys</span></a></span><span> </span><span class="annot"><span class="annottext">forall a. [a] -&gt; Int -&gt; Bool
</span><a href="GHC.Utils.Misc.html#lengthExceeds"><span class="hs-operator hs-var">`lengthExceeds`</span></a></span><span> </span><span class="annot"><span class="annottext">Int
</span><a href="#local-6989586621681034586"><span class="hs-identifier hs-var">n</span></a></span><span>
</span><span id="line-1100"></span><span>              </span><span class="hs-glyph">|</span><span> </span><span class="annot"><span class="annottext">Type -&gt; Bool
</span><a href="GHC.Core.Type.html#isForAllTy"><span class="hs-identifier hs-var">isForAllTy</span></a></span><span> </span><span class="annot"><span class="annottext">Type
</span><a href="#local-6989586621681034587"><span class="hs-identifier hs-var">ty</span></a></span><span>  </span><span class="hs-comment">-- nth:0 pulls out a kind coercion from a hetero forall</span><span>
</span><span id="line-1101"></span><span>              </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">Int
</span><a href="#local-6989586621681034586"><span class="hs-identifier hs-var">n</span></a></span><span> </span><span class="annot"><span class="annottext">forall a. Eq a =&gt; a -&gt; a -&gt; Bool
</span><span class="hs-operator hs-var">==</span></span><span> </span><span class="annot"><span class="annottext">Int
</span><span class="hs-number">0</span></span><span>
</span><span id="line-1102"></span><span>              </span><span class="hs-glyph">|</span><span> </span><span class="annot"><span class="annottext">Bool
</span><a href="../../base-4.16.4.0/src/GHC-Base.html#otherwise"><span class="hs-identifier hs-var">otherwise</span></a></span><span>
</span><span id="line-1103"></span><span>              </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">Bool
</span><span class="hs-identifier hs-var">False</span></span><span>
</span><span id="line-1104"></span><span>
</span><span id="line-1105"></span><span>    </span><span class="annot"><a href="#local-6989586621681034601"><span class="hs-identifier hs-var">go</span></a></span><span> </span><span class="annot"><span class="annottext">Int
</span><span class="hs-number">0</span></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="GHC.Core.TyCo.Rep.html#ForAllCo"><span class="hs-identifier hs-type">ForAllCo</span></a></span><span> </span><span class="annot"><span class="annottext">CoVar
</span><span class="hs-identifier">_</span></span><span> </span><span id="local-6989586621681034583"><span class="annot"><span class="annottext">Coercion
</span><a href="#local-6989586621681034583"><span class="hs-identifier hs-var">kind_co</span></a></span></span><span> </span><span class="annot"><span class="annottext">Coercion
</span><span class="hs-identifier">_</span></span><span class="hs-special">)</span><span>
</span><span id="line-1106"></span><span>      </span><span class="hs-glyph">=</span><span> </span><span class="hs-identifier">ASSERT</span><span class="hs-special">(</span><span> </span><span class="hs-identifier">r</span><span> </span><span class="hs-operator">==</span><span> </span><span class="hs-identifier">Nominal</span><span> </span><span class="hs-special">)</span><span>
</span><span id="line-1107"></span><span>        </span><span class="annot"><span class="annottext">Coercion
</span><a href="#local-6989586621681034583"><span class="hs-identifier hs-var">kind_co</span></a></span><span>
</span><span id="line-1108"></span><span>      </span><span class="hs-comment">-- If co :: (forall a1:k1. t1) ~ (forall a2:k2. t2)</span><span>
</span><span id="line-1109"></span><span>      </span><span class="hs-comment">-- then (nth 0 co :: k1 ~N k2)</span><span>
</span><span id="line-1110"></span><span>      </span><span class="hs-comment">-- If co :: (forall a1:t1 ~ t2. t1) ~ (forall a2:t3 ~ t4. t2)</span><span>
</span><span id="line-1111"></span><span>      </span><span class="hs-comment">-- then (nth 0 co :: (t1 ~ t2) ~N (t3 ~ t4))</span><span>
</span><span id="line-1112"></span><span>
</span><span id="line-1113"></span><span>    </span><span class="annot"><a href="#local-6989586621681034601"><span class="hs-identifier hs-var">go</span></a></span><span> </span><span id="local-6989586621681034582"><span class="annot"><span class="annottext">Int
</span><a href="#local-6989586621681034582"><span class="hs-identifier hs-var">n</span></a></span></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="GHC.Core.TyCo.Rep.html#FunCo"><span class="hs-identifier hs-type">FunCo</span></a></span><span> </span><span class="annot"><span class="annottext">Role
</span><span class="hs-identifier">_</span></span><span> </span><span id="local-6989586621681034581"><span class="annot"><span class="annottext">Coercion
</span><a href="#local-6989586621681034581"><span class="hs-identifier hs-var">w</span></a></span></span><span> </span><span id="local-6989586621681034580"><span class="annot"><span class="annottext">Coercion
</span><a href="#local-6989586621681034580"><span class="hs-identifier hs-var">arg</span></a></span></span><span> </span><span id="local-6989586621681034579"><span class="annot"><span class="annottext">Coercion
</span><a href="#local-6989586621681034579"><span class="hs-identifier hs-var">res</span></a></span></span><span class="hs-special">)</span><span>
</span><span id="line-1114"></span><span>      </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">Int -&gt; Coercion -&gt; Coercion -&gt; Coercion -&gt; Coercion
</span><a href="GHC.Core.Coercion.html#mkNthCoFunCo"><span class="hs-identifier hs-var">mkNthCoFunCo</span></a></span><span> </span><span class="annot"><span class="annottext">Int
</span><a href="#local-6989586621681034582"><span class="hs-identifier hs-var">n</span></a></span><span> </span><span class="annot"><span class="annottext">Coercion
</span><a href="#local-6989586621681034581"><span class="hs-identifier hs-var">w</span></a></span><span> </span><span class="annot"><span class="annottext">Coercion
</span><a href="#local-6989586621681034580"><span class="hs-identifier hs-var">arg</span></a></span><span> </span><span class="annot"><span class="annottext">Coercion
</span><a href="#local-6989586621681034579"><span class="hs-identifier hs-var">res</span></a></span><span>
</span><span id="line-1115"></span><span>
</span><span id="line-1116"></span><span>    </span><span class="annot"><a href="#local-6989586621681034601"><span class="hs-identifier hs-var">go</span></a></span><span> </span><span id="local-6989586621681034578"><span class="annot"><span class="annottext">Int
</span><a href="#local-6989586621681034578"><span class="hs-identifier hs-var">n</span></a></span></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="GHC.Core.TyCo.Rep.html#TyConAppCo"><span class="hs-identifier hs-type">TyConAppCo</span></a></span><span> </span><span id="local-6989586621681034577"><span class="annot"><span class="annottext">Role
</span><a href="#local-6989586621681034577"><span class="hs-identifier hs-var">r0</span></a></span></span><span> </span><span id="local-6989586621681034576"><span class="annot"><span class="annottext">TyCon
</span><a href="#local-6989586621681034576"><span class="hs-identifier hs-var">tc</span></a></span></span><span> </span><span id="local-6989586621681034575"><span class="annot"><span class="annottext">[Coercion]
</span><a href="#local-6989586621681034575"><span class="hs-identifier hs-var">arg_cos</span></a></span></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-identifier">ASSERT2</span><span class="hs-special">(</span><span> </span><span class="hs-identifier">r</span><span> </span><span class="hs-operator">==</span><span> </span><span class="hs-identifier">nthRole</span><span> </span><span class="hs-identifier">r0</span><span> </span><span class="hs-identifier">tc</span><span> </span><span class="hs-identifier">n</span><span>
</span><span id="line-1117"></span><span>                                                    </span><span class="hs-special">,</span><span> </span><span class="hs-special">(</span><span class="hs-identifier">vcat</span><span> </span><span class="hs-special">[</span><span> </span><span class="hs-identifier">ppr</span><span> </span><span class="hs-identifier">tc</span><span>
</span><span id="line-1118"></span><span>                                                            </span><span class="hs-special">,</span><span> </span><span class="hs-identifier">ppr</span><span> </span><span class="hs-identifier">arg_cos</span><span>
</span><span id="line-1119"></span><span>                                                            </span><span class="hs-special">,</span><span> </span><span class="hs-identifier">ppr</span><span> </span><span class="hs-identifier">r0</span><span>
</span><span id="line-1120"></span><span>                                                            </span><span class="hs-special">,</span><span> </span><span class="hs-identifier">ppr</span><span> </span><span class="hs-identifier">n</span><span>
</span><span id="line-1121"></span><span>                                                            </span><span class="hs-special">,</span><span> </span><span class="hs-identifier">ppr</span><span> </span><span class="hs-identifier">r</span><span> </span><span class="hs-special">]</span><span class="hs-special">)</span><span> </span><span class="hs-special">)</span><span>
</span><span id="line-1122"></span><span>                                             </span><span class="annot"><span class="annottext">[Coercion]
</span><a href="#local-6989586621681034575"><span class="hs-identifier hs-var">arg_cos</span></a></span><span> </span><span class="annot"><span class="annottext">forall a. Outputable a =&gt; [a] -&gt; Int -&gt; a
</span><a href="GHC.Data.List.SetOps.html#getNth"><span class="hs-operator hs-var">`getNth`</span></a></span><span> </span><span class="annot"><span class="annottext">Int
</span><a href="#local-6989586621681034578"><span class="hs-identifier hs-var">n</span></a></span><span>
</span><span id="line-1123"></span><span>
</span><span id="line-1124"></span><span>    </span><span class="annot"><a href="#local-6989586621681034601"><span class="hs-identifier hs-var">go</span></a></span><span> </span><span id="local-6989586621681034573"><span class="annot"><span class="annottext">Int
</span><a href="#local-6989586621681034573"><span class="hs-identifier hs-var">n</span></a></span></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="GHC.Core.TyCo.Rep.html#SymCo"><span class="hs-identifier hs-type">SymCo</span></a></span><span> </span><span id="local-6989586621681034572"><span class="annot"><span class="annottext">Coercion
</span><a href="#local-6989586621681034572"><span class="hs-identifier hs-var">co</span></a></span></span><span class="hs-special">)</span><span>  </span><span class="hs-comment">-- Recurse, hoping to get to a TyConAppCo or FunCo</span><span>
</span><span id="line-1125"></span><span>      </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">Coercion -&gt; Coercion
</span><a href="GHC.Core.Coercion.html#mkSymCo"><span class="hs-identifier hs-var">mkSymCo</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Int -&gt; Coercion -&gt; Coercion
</span><a href="#local-6989586621681034601"><span class="hs-identifier hs-var">go</span></a></span><span> </span><span class="annot"><span class="annottext">Int
</span><a href="#local-6989586621681034573"><span class="hs-identifier hs-var">n</span></a></span><span> </span><span class="annot"><span class="annottext">Coercion
</span><a href="#local-6989586621681034572"><span class="hs-identifier hs-var">co</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-1126"></span><span>
</span><span id="line-1127"></span><span>    </span><span class="annot"><a href="#local-6989586621681034601"><span class="hs-identifier hs-var">go</span></a></span><span> </span><span id="local-6989586621681034571"><span class="annot"><span class="annottext">Int
</span><a href="#local-6989586621681034571"><span class="hs-identifier hs-var">n</span></a></span></span><span> </span><span id="local-6989586621681034570"><span class="annot"><span class="annottext">Coercion
</span><a href="#local-6989586621681034570"><span class="hs-identifier hs-var">co</span></a></span></span><span>
</span><span id="line-1128"></span><span>      </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">Role -&gt; Int -&gt; Coercion -&gt; Coercion
</span><a href="GHC.Core.TyCo.Rep.html#NthCo"><span class="hs-identifier hs-var">NthCo</span></a></span><span> </span><span class="annot"><span class="annottext">Role
</span><a href="#local-6989586621681034606"><span class="hs-identifier hs-var">r</span></a></span><span> </span><span class="annot"><span class="annottext">Int
</span><a href="#local-6989586621681034571"><span class="hs-identifier hs-var">n</span></a></span><span> </span><span class="annot"><span class="annottext">Coercion
</span><a href="#local-6989586621681034570"><span class="hs-identifier hs-var">co</span></a></span><span>
</span><span id="line-1129"></span><span>
</span><span id="line-1130"></span><span>    </span><span class="hs-comment">-- Assertion checking</span><span>
</span><span id="line-1131"></span><span>    </span><span id="local-6989586621681034602"><span class="annot"><span class="annottext">bad_call_msg :: SDoc
</span><a href="#local-6989586621681034602"><span class="hs-identifier hs-var hs-var">bad_call_msg</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">[SDoc] -&gt; SDoc
</span><a href="GHC.Utils.Outputable.html#vcat"><span class="hs-identifier hs-var">vcat</span></a></span><span> </span><span class="hs-special">[</span><span> </span><span class="annot"><span class="annottext">String -&gt; SDoc
</span><a href="GHC.Utils.Outputable.html#text"><span class="hs-identifier hs-var">text</span></a></span><span> </span><span class="annot"><span class="annottext">String
</span><span class="hs-string">&quot;Coercion =&quot;</span></span><span> </span><span class="annot"><span class="annottext">SDoc -&gt; SDoc -&gt; SDoc
</span><a href="GHC.Utils.Outputable.html#%3C%2B%3E"><span class="hs-operator hs-var">&lt;+&gt;</span></a></span><span> </span><span class="annot"><span class="annottext">forall a. Outputable a =&gt; a -&gt; SDoc
</span><a href="GHC.Utils.Outputable.html#ppr"><span class="hs-identifier hs-var">ppr</span></a></span><span> </span><span class="annot"><span class="annottext">Coercion
</span><a href="#local-6989586621681034604"><span class="hs-identifier hs-var">co</span></a></span><span>
</span><span id="line-1132"></span><span>                        </span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">String -&gt; SDoc
</span><a href="GHC.Utils.Outputable.html#text"><span class="hs-identifier hs-var">text</span></a></span><span> </span><span class="annot"><span class="annottext">String
</span><span class="hs-string">&quot;LHS ty =&quot;</span></span><span> </span><span class="annot"><span class="annottext">SDoc -&gt; SDoc -&gt; SDoc
</span><a href="GHC.Utils.Outputable.html#%3C%2B%3E"><span class="hs-operator hs-var">&lt;+&gt;</span></a></span><span> </span><span class="annot"><span class="annottext">forall a. Outputable a =&gt; a -&gt; SDoc
</span><a href="GHC.Utils.Outputable.html#ppr"><span class="hs-identifier hs-var">ppr</span></a></span><span> </span><span class="annot"><span class="annottext">Type
</span><a href="#local-6989586621681034600"><span class="hs-identifier hs-var">ty1</span></a></span><span>
</span><span id="line-1133"></span><span>                        </span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">String -&gt; SDoc
</span><a href="GHC.Utils.Outputable.html#text"><span class="hs-identifier hs-var">text</span></a></span><span> </span><span class="annot"><span class="annottext">String
</span><span class="hs-string">&quot;RHS ty =&quot;</span></span><span> </span><span class="annot"><span class="annottext">SDoc -&gt; SDoc -&gt; SDoc
</span><a href="GHC.Utils.Outputable.html#%3C%2B%3E"><span class="hs-operator hs-var">&lt;+&gt;</span></a></span><span> </span><span class="annot"><span class="annottext">forall a. Outputable a =&gt; a -&gt; SDoc
</span><a href="GHC.Utils.Outputable.html#ppr"><span class="hs-identifier hs-var">ppr</span></a></span><span> </span><span class="annot"><span class="annottext">Type
</span><a href="#local-6989586621681034599"><span class="hs-identifier hs-var">ty2</span></a></span><span>
</span><span id="line-1134"></span><span>                        </span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">String -&gt; SDoc
</span><a href="GHC.Utils.Outputable.html#text"><span class="hs-identifier hs-var">text</span></a></span><span> </span><span class="annot"><span class="annottext">String
</span><span class="hs-string">&quot;n =&quot;</span></span><span> </span><span class="annot"><span class="annottext">SDoc -&gt; SDoc -&gt; SDoc
</span><a href="GHC.Utils.Outputable.html#%3C%2B%3E"><span class="hs-operator hs-var">&lt;+&gt;</span></a></span><span> </span><span class="annot"><span class="annottext">forall a. Outputable a =&gt; a -&gt; SDoc
</span><a href="GHC.Utils.Outputable.html#ppr"><span class="hs-identifier hs-var">ppr</span></a></span><span> </span><span class="annot"><span class="annottext">Int
</span><a href="#local-6989586621681034605"><span class="hs-identifier hs-var">n</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">String -&gt; SDoc
</span><a href="GHC.Utils.Outputable.html#text"><span class="hs-identifier hs-var">text</span></a></span><span> </span><span class="annot"><span class="annottext">String
</span><span class="hs-string">&quot;r =&quot;</span></span><span> </span><span class="annot"><span class="annottext">SDoc -&gt; SDoc -&gt; SDoc
</span><a href="GHC.Utils.Outputable.html#%3C%2B%3E"><span class="hs-operator hs-var">&lt;+&gt;</span></a></span><span> </span><span class="annot"><span class="annottext">forall a. Outputable a =&gt; a -&gt; SDoc
</span><a href="GHC.Utils.Outputable.html#ppr"><span class="hs-identifier hs-var">ppr</span></a></span><span> </span><span class="annot"><span class="annottext">Role
</span><a href="#local-6989586621681034606"><span class="hs-identifier hs-var">r</span></a></span><span>
</span><span id="line-1135"></span><span>                        </span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">String -&gt; SDoc
</span><a href="GHC.Utils.Outputable.html#text"><span class="hs-identifier hs-var">text</span></a></span><span> </span><span class="annot"><span class="annottext">String
</span><span class="hs-string">&quot;coercion role =&quot;</span></span><span> </span><span class="annot"><span class="annottext">SDoc -&gt; SDoc -&gt; SDoc
</span><a href="GHC.Utils.Outputable.html#%3C%2B%3E"><span class="hs-operator hs-var">&lt;+&gt;</span></a></span><span> </span><span class="annot"><span class="annottext">forall a. Outputable a =&gt; a -&gt; SDoc
</span><a href="GHC.Utils.Outputable.html#ppr"><span class="hs-identifier hs-var">ppr</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Coercion -&gt; Role
</span><a href="GHC.Core.Coercion.html#coercionRole"><span class="hs-identifier hs-var">coercionRole</span></a></span><span> </span><span class="annot"><span class="annottext">Coercion
</span><a href="#local-6989586621681034604"><span class="hs-identifier hs-var">co</span></a></span><span class="hs-special">)</span><span> </span><span class="hs-special">]</span><span>
</span><span id="line-1136"></span><span>    </span><span id="local-6989586621681034603"><span class="annot"><span class="annottext">good_call :: Bool
</span><a href="#local-6989586621681034603"><span class="hs-identifier hs-var hs-var">good_call</span></a></span></span><span>
</span><span id="line-1137"></span><span>      </span><span class="hs-comment">-- If the Coercion passed in is between forall-types, then the Int must</span><span>
</span><span id="line-1138"></span><span>      </span><span class="hs-comment">-- be 0 and the role must be Nominal.</span><span>
</span><span id="line-1139"></span><span>      </span><span class="hs-glyph">|</span><span> </span><span class="annot"><a href="../../base-4.16.4.0/src/GHC-Maybe.html#Just"><span class="hs-identifier hs-type">Just</span></a></span><span> </span><span class="hs-special">(</span><span id="local-6989586621681034568"><span class="annot"><span class="annottext">CoVar
</span><a href="#local-6989586621681034568"><span class="hs-identifier hs-var">_tv1</span></a></span></span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">Type
</span><span class="hs-identifier">_</span></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">Type -&gt; Maybe (CoVar, Type)
</span><a href="GHC.Core.Type.html#splitForAllTyCoVar_maybe"><span class="hs-identifier hs-var">splitForAllTyCoVar_maybe</span></a></span><span> </span><span class="annot"><span class="annottext">Type
</span><a href="#local-6989586621681034600"><span class="hs-identifier hs-var">ty1</span></a></span><span>
</span><span id="line-1140"></span><span>      </span><span class="hs-special">,</span><span> </span><span class="annot"><a href="../../base-4.16.4.0/src/GHC-Maybe.html#Just"><span class="hs-identifier hs-type">Just</span></a></span><span> </span><span class="hs-special">(</span><span id="local-6989586621681034567"><span class="annot"><span class="annottext">CoVar
</span><a href="#local-6989586621681034567"><span class="hs-identifier hs-var">_tv2</span></a></span></span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">Type
</span><span class="hs-identifier">_</span></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">Type -&gt; Maybe (CoVar, Type)
</span><a href="GHC.Core.Type.html#splitForAllTyCoVar_maybe"><span class="hs-identifier hs-var">splitForAllTyCoVar_maybe</span></a></span><span> </span><span class="annot"><span class="annottext">Type
</span><a href="#local-6989586621681034599"><span class="hs-identifier hs-var">ty2</span></a></span><span>
</span><span id="line-1141"></span><span>      </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">Int
</span><a href="#local-6989586621681034605"><span class="hs-identifier hs-var">n</span></a></span><span> </span><span class="annot"><span class="annottext">forall a. Eq a =&gt; a -&gt; a -&gt; Bool
</span><span class="hs-operator hs-var">==</span></span><span> </span><span class="annot"><span class="annottext">Int
</span><span class="hs-number">0</span></span><span> </span><span class="annot"><span class="annottext">Bool -&gt; Bool -&gt; Bool
</span><span class="hs-operator hs-var">&amp;&amp;</span></span><span> </span><span class="annot"><span class="annottext">Role
</span><a href="#local-6989586621681034606"><span class="hs-identifier hs-var">r</span></a></span><span> </span><span class="annot"><span class="annottext">forall a. Eq a =&gt; a -&gt; a -&gt; Bool
</span><span class="hs-operator hs-var">==</span></span><span> </span><span class="annot"><span class="annottext">Role
</span><a href="GHC.Core.Coercion.Axiom.html#Nominal"><span class="hs-identifier hs-var">Nominal</span></a></span><span>
</span><span id="line-1142"></span><span>
</span><span id="line-1143"></span><span>      </span><span class="hs-comment">-- If the Coercion passed in is between T tys and T tys', then the Int</span><span>
</span><span id="line-1144"></span><span>      </span><span class="hs-comment">-- must be less than the length of tys/tys' (which must be the same</span><span>
</span><span id="line-1145"></span><span>      </span><span class="hs-comment">-- lengths).</span><span>
</span><span id="line-1146"></span><span>      </span><span class="hs-comment">--</span><span>
</span><span id="line-1147"></span><span>      </span><span class="hs-comment">-- If the role of the Coercion is nominal, then the role passed in must</span><span>
</span><span id="line-1148"></span><span>      </span><span class="hs-comment">-- be nominal. If the role of the Coercion is representational, then the</span><span>
</span><span id="line-1149"></span><span>      </span><span class="hs-comment">-- role passed in must be tyConRolesRepresentational T !! n. If the role</span><span>
</span><span id="line-1150"></span><span>      </span><span class="hs-comment">-- of the Coercion is Phantom, then the role passed in must be Phantom.</span><span>
</span><span id="line-1151"></span><span>      </span><span class="hs-comment">--</span><span>
</span><span id="line-1152"></span><span>      </span><span class="hs-comment">-- See also Note [NthCo Cached Roles] if you're wondering why it's</span><span>
</span><span id="line-1153"></span><span>      </span><span class="hs-comment">-- blaringly obvious that we should be *computing* this role instead of</span><span>
</span><span id="line-1154"></span><span>      </span><span class="hs-comment">-- passing it in.</span><span>
</span><span id="line-1155"></span><span>      </span><span class="hs-glyph">|</span><span> </span><span class="annot"><a href="../../base-4.16.4.0/src/GHC-Maybe.html#Just"><span class="hs-identifier hs-type">Just</span></a></span><span> </span><span class="hs-special">(</span><span id="local-6989586621681034566"><span class="annot"><span class="annottext">TyCon
</span><a href="#local-6989586621681034566"><span class="hs-identifier hs-var">tc1</span></a></span></span><span class="hs-special">,</span><span> </span><span id="local-6989586621681034565"><span class="annot"><span class="annottext">[Type]
</span><a href="#local-6989586621681034565"><span class="hs-identifier hs-var">tys1</span></a></span></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">HasDebugCallStack =&gt; Type -&gt; Maybe (TyCon, [Type])
</span><a href="GHC.Core.Type.html#splitTyConApp_maybe"><span class="hs-identifier hs-var">splitTyConApp_maybe</span></a></span><span> </span><span class="annot"><span class="annottext">Type
</span><a href="#local-6989586621681034600"><span class="hs-identifier hs-var">ty1</span></a></span><span>
</span><span id="line-1156"></span><span>      </span><span class="hs-special">,</span><span> </span><span class="annot"><a href="../../base-4.16.4.0/src/GHC-Maybe.html#Just"><span class="hs-identifier hs-type">Just</span></a></span><span> </span><span class="hs-special">(</span><span id="local-6989586621681034564"><span class="annot"><span class="annottext">TyCon
</span><a href="#local-6989586621681034564"><span class="hs-identifier hs-var">tc2</span></a></span></span><span class="hs-special">,</span><span> </span><span id="local-6989586621681034563"><span class="annot"><span class="annottext">[Type]
</span><a href="#local-6989586621681034563"><span class="hs-identifier hs-var">tys2</span></a></span></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">HasDebugCallStack =&gt; Type -&gt; Maybe (TyCon, [Type])
</span><a href="GHC.Core.Type.html#splitTyConApp_maybe"><span class="hs-identifier hs-var">splitTyConApp_maybe</span></a></span><span> </span><span class="annot"><span class="annottext">Type
</span><a href="#local-6989586621681034599"><span class="hs-identifier hs-var">ty2</span></a></span><span>
</span><span id="line-1157"></span><span>      </span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">TyCon
</span><a href="#local-6989586621681034566"><span class="hs-identifier hs-var">tc1</span></a></span><span> </span><span class="annot"><span class="annottext">forall a. Eq a =&gt; a -&gt; a -&gt; Bool
</span><span class="hs-operator hs-var">==</span></span><span> </span><span class="annot"><span class="annottext">TyCon
</span><a href="#local-6989586621681034564"><span class="hs-identifier hs-var">tc2</span></a></span><span>
</span><span id="line-1158"></span><span>      </span><span class="hs-glyph">=</span><span> </span><span class="hs-keyword">let</span><span> </span><span id="local-6989586621681034562"><span class="annot"><span class="annottext">len1 :: Int
</span><a href="#local-6989586621681034562"><span class="hs-identifier hs-var hs-var">len1</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">forall (t :: * -&gt; *) a. Foldable t =&gt; t a -&gt; Int
</span><a href="../../base-4.16.4.0/src/Data-Foldable.html#length"><span class="hs-identifier hs-var">length</span></a></span><span> </span><span class="annot"><span class="annottext">[Type]
</span><a href="#local-6989586621681034565"><span class="hs-identifier hs-var">tys1</span></a></span><span>
</span><span id="line-1159"></span><span>            </span><span id="local-6989586621681034561"><span class="annot"><span class="annottext">len2 :: Int
</span><a href="#local-6989586621681034561"><span class="hs-identifier hs-var hs-var">len2</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">forall (t :: * -&gt; *) a. Foldable t =&gt; t a -&gt; Int
</span><a href="../../base-4.16.4.0/src/Data-Foldable.html#length"><span class="hs-identifier hs-var">length</span></a></span><span> </span><span class="annot"><span class="annottext">[Type]
</span><a href="#local-6989586621681034563"><span class="hs-identifier hs-var">tys2</span></a></span><span>
</span><span id="line-1160"></span><span>            </span><span id="local-6989586621681034560"><span class="annot"><span class="annottext">good_role :: Bool
</span><a href="#local-6989586621681034560"><span class="hs-identifier hs-var hs-var">good_role</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-keyword">case</span><span> </span><span class="annot"><span class="annottext">Coercion -&gt; Role
</span><a href="GHC.Core.Coercion.html#coercionRole"><span class="hs-identifier hs-var">coercionRole</span></a></span><span> </span><span class="annot"><span class="annottext">Coercion
</span><a href="#local-6989586621681034604"><span class="hs-identifier hs-var">co</span></a></span><span> </span><span class="hs-keyword">of</span><span>
</span><span id="line-1161"></span><span>                          </span><span class="annot"><span class="annottext">Role
</span><a href="GHC.Core.Coercion.Axiom.html#Nominal"><span class="hs-identifier hs-var">Nominal</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="annottext">Role
</span><a href="#local-6989586621681034606"><span class="hs-identifier hs-var">r</span></a></span><span> </span><span class="annot"><span class="annottext">forall a. Eq a =&gt; a -&gt; a -&gt; Bool
</span><span class="hs-operator hs-var">==</span></span><span> </span><span class="annot"><span class="annottext">Role
</span><a href="GHC.Core.Coercion.Axiom.html#Nominal"><span class="hs-identifier hs-var">Nominal</span></a></span><span>
</span><span id="line-1162"></span><span>                          </span><span class="annot"><span class="annottext">Role
</span><a href="GHC.Core.Coercion.Axiom.html#Representational"><span class="hs-identifier hs-var">Representational</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="annottext">Role
</span><a href="#local-6989586621681034606"><span class="hs-identifier hs-var">r</span></a></span><span> </span><span class="annot"><span class="annottext">forall a. Eq a =&gt; a -&gt; a -&gt; Bool
</span><span class="hs-operator hs-var">==</span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">TyCon -&gt; [Role]
</span><a href="GHC.Core.Coercion.html#tyConRolesRepresentational"><span class="hs-identifier hs-var">tyConRolesRepresentational</span></a></span><span> </span><span class="annot"><span class="annottext">TyCon
</span><a href="#local-6989586621681034566"><span class="hs-identifier hs-var">tc1</span></a></span><span> </span><span class="annot"><span class="annottext">forall a. [a] -&gt; Int -&gt; a
</span><a href="../../base-4.16.4.0/src/GHC-List.html#%21%21"><span class="hs-operator hs-var">!!</span></a></span><span> </span><span class="annot"><span class="annottext">Int
</span><a href="#local-6989586621681034605"><span class="hs-identifier hs-var">n</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-1163"></span><span>                          </span><span class="annot"><span class="annottext">Role
</span><a href="GHC.Core.Coercion.Axiom.html#Phantom"><span class="hs-identifier hs-var">Phantom</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="annottext">Role
</span><a href="#local-6989586621681034606"><span class="hs-identifier hs-var">r</span></a></span><span> </span><span class="annot"><span class="annottext">forall a. Eq a =&gt; a -&gt; a -&gt; Bool
</span><span class="hs-operator hs-var">==</span></span><span> </span><span class="annot"><span class="annottext">Role
</span><a href="GHC.Core.Coercion.Axiom.html#Phantom"><span class="hs-identifier hs-var">Phantom</span></a></span><span>
</span><span id="line-1164"></span><span>        </span><span class="hs-keyword">in</span><span> </span><span class="annot"><span class="annottext">Int
</span><a href="#local-6989586621681034562"><span class="hs-identifier hs-var">len1</span></a></span><span> </span><span class="annot"><span class="annottext">forall a. Eq a =&gt; a -&gt; a -&gt; Bool
</span><span class="hs-operator hs-var">==</span></span><span> </span><span class="annot"><span class="annottext">Int
</span><a href="#local-6989586621681034561"><span class="hs-identifier hs-var">len2</span></a></span><span> </span><span class="annot"><span class="annottext">Bool -&gt; Bool -&gt; Bool
</span><span class="hs-operator hs-var">&amp;&amp;</span></span><span> </span><span class="annot"><span class="annottext">Int
</span><a href="#local-6989586621681034605"><span class="hs-identifier hs-var">n</span></a></span><span> </span><span class="annot"><span class="annottext">forall a. Ord a =&gt; a -&gt; a -&gt; Bool
</span><span class="hs-operator hs-var">&lt;</span></span><span> </span><span class="annot"><span class="annottext">Int
</span><a href="#local-6989586621681034562"><span class="hs-identifier hs-var">len1</span></a></span><span> </span><span class="annot"><span class="annottext">Bool -&gt; Bool -&gt; Bool
</span><span class="hs-operator hs-var">&amp;&amp;</span></span><span> </span><span class="annot"><span class="annottext">Bool
</span><a href="#local-6989586621681034560"><span class="hs-identifier hs-var">good_role</span></a></span><span>
</span><span id="line-1165"></span><span>
</span><span id="line-1166"></span><span>      </span><span class="hs-glyph">|</span><span> </span><span class="annot"><span class="annottext">Bool
</span><a href="../../base-4.16.4.0/src/GHC-Base.html#otherwise"><span class="hs-identifier hs-var">otherwise</span></a></span><span>
</span><span id="line-1167"></span><span>      </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">Bool
</span><span class="hs-identifier hs-var">True</span></span><span>
</span><span id="line-1168"></span><span>
</span><span id="line-1169"></span><span class="hs-comment">-- | Extract the nth field of a FunCo</span><span>
</span><span id="line-1170"></span><span class="annot"><a href="GHC.Core.Coercion.html#mkNthCoFunCo"><span class="hs-identifier hs-type">mkNthCoFunCo</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><span class="hs-identifier hs-type">Int</span></span><span>         </span><span class="hs-comment">-- ^ &quot;n&quot;</span><span>
</span><span id="line-1171"></span><span>             </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="GHC.Core.TyCo.Rep.html#CoercionN"><span class="hs-identifier hs-type">CoercionN</span></a></span><span>   </span><span class="hs-comment">-- ^ multiplicity coercion</span><span>
</span><span id="line-1172"></span><span>             </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="GHC.Core.TyCo.Rep.html#Coercion"><span class="hs-identifier hs-type">Coercion</span></a></span><span>    </span><span class="hs-comment">-- ^ argument coercion</span><span>
</span><span id="line-1173"></span><span>             </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="GHC.Core.TyCo.Rep.html#Coercion"><span class="hs-identifier hs-type">Coercion</span></a></span><span>    </span><span class="hs-comment">-- ^ result coercion</span><span>
</span><span id="line-1174"></span><span>             </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="GHC.Core.TyCo.Rep.html#Coercion"><span class="hs-identifier hs-type">Coercion</span></a></span><span>    </span><span class="hs-comment">-- ^ nth coercion from a FunCo</span><span>
</span><span id="line-1175"></span><span class="hs-comment">-- See Note [Function coercions]</span><span>
</span><span id="line-1176"></span><span class="hs-comment">-- If FunCo _ mult arg_co res_co ::   (s1:TYPE sk1 :mult-&gt; s2:TYPE sk2)</span><span>
</span><span id="line-1177"></span><span class="hs-comment">--                                  ~ (t1:TYPE tk1 :mult-&gt; t2:TYPE tk2)</span><span>
</span><span id="line-1178"></span><span class="hs-comment">-- Then we want to behave as if co was</span><span>
</span><span id="line-1179"></span><span class="hs-comment">--    TyConAppCo mult argk_co resk_co arg_co res_co</span><span>
</span><span id="line-1180"></span><span class="hs-comment">-- where</span><span>
</span><span id="line-1181"></span><span class="hs-comment">--    argk_co :: sk1 ~ tk1  =  mkNthCo 0 (mkKindCo arg_co)</span><span>
</span><span id="line-1182"></span><span class="hs-comment">--    resk_co :: sk2 ~ tk2  =  mkNthCo 0 (mkKindCo res_co)</span><span>
</span><span id="line-1183"></span><span class="hs-comment">--                             i.e. mkRuntimeRepCo</span><span>
</span><span id="line-1184"></span><span id="mkNthCoFunCo"><span class="annot"><span class="annottext">mkNthCoFunCo :: Int -&gt; Coercion -&gt; Coercion -&gt; Coercion -&gt; Coercion
</span><a href="GHC.Core.Coercion.html#mkNthCoFunCo"><span class="hs-identifier hs-var hs-var">mkNthCoFunCo</span></a></span></span><span> </span><span id="local-6989586621681034559"><span class="annot"><span class="annottext">Int
</span><a href="#local-6989586621681034559"><span class="hs-identifier hs-var">n</span></a></span></span><span> </span><span id="local-6989586621681034558"><span class="annot"><span class="annottext">Coercion
</span><a href="#local-6989586621681034558"><span class="hs-identifier hs-var">w</span></a></span></span><span> </span><span id="local-6989586621681034557"><span class="annot"><span class="annottext">Coercion
</span><a href="#local-6989586621681034557"><span class="hs-identifier hs-var">co1</span></a></span></span><span> </span><span id="local-6989586621681034556"><span class="annot"><span class="annottext">Coercion
</span><a href="#local-6989586621681034556"><span class="hs-identifier hs-var">co2</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-keyword">case</span><span> </span><span class="annot"><span class="annottext">Int
</span><a href="#local-6989586621681034559"><span class="hs-identifier hs-var">n</span></a></span><span> </span><span class="hs-keyword">of</span><span>
</span><span id="line-1185"></span><span>  </span><span class="annot"><span class="annottext">Int
</span><span class="hs-number">0</span></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="annottext">Coercion
</span><a href="#local-6989586621681034558"><span class="hs-identifier hs-var">w</span></a></span><span>
</span><span id="line-1186"></span><span>  </span><span class="annot"><span class="annottext">Int
</span><span class="hs-number">1</span></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="annottext">HasDebugCallStack =&gt; Coercion -&gt; Coercion
</span><a href="GHC.Core.Coercion.html#mkRuntimeRepCo"><span class="hs-identifier hs-var">mkRuntimeRepCo</span></a></span><span> </span><span class="annot"><span class="annottext">Coercion
</span><a href="#local-6989586621681034557"><span class="hs-identifier hs-var">co1</span></a></span><span>
</span><span id="line-1187"></span><span>  </span><span class="annot"><span class="annottext">Int
</span><span class="hs-number">2</span></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="annottext">HasDebugCallStack =&gt; Coercion -&gt; Coercion
</span><a href="GHC.Core.Coercion.html#mkRuntimeRepCo"><span class="hs-identifier hs-var">mkRuntimeRepCo</span></a></span><span> </span><span class="annot"><span class="annottext">Coercion
</span><a href="#local-6989586621681034556"><span class="hs-identifier hs-var">co2</span></a></span><span>
</span><span id="line-1188"></span><span>  </span><span class="annot"><span class="annottext">Int
</span><span class="hs-number">3</span></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="annottext">Coercion
</span><a href="#local-6989586621681034557"><span class="hs-identifier hs-var">co1</span></a></span><span>
</span><span id="line-1189"></span><span>  </span><span class="annot"><span class="annottext">Int
</span><span class="hs-number">4</span></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="annottext">Coercion
</span><a href="#local-6989586621681034556"><span class="hs-identifier hs-var">co2</span></a></span><span>
</span><span id="line-1190"></span><span>  </span><span class="annot"><span class="annottext">Int
</span><span class="hs-identifier">_</span></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="annottext">forall a. HasCallStack =&gt; String -&gt; SDoc -&gt; a
</span><a href="GHC.Utils.Panic.html#pprPanic"><span class="hs-identifier hs-var">pprPanic</span></a></span><span> </span><span class="annot"><span class="annottext">String
</span><span class="hs-string">&quot;mkNthCo(FunCo)&quot;</span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">forall a. Outputable a =&gt; a -&gt; SDoc
</span><a href="GHC.Utils.Outputable.html#ppr"><span class="hs-identifier hs-var">ppr</span></a></span><span> </span><span class="annot"><span class="annottext">Int
</span><a href="#local-6989586621681034559"><span class="hs-identifier hs-var">n</span></a></span><span> </span><span class="annot"><span class="annottext">SDoc -&gt; SDoc -&gt; SDoc
</span><a href="GHC.Utils.Outputable.html#%24%24"><span class="hs-operator hs-var">$$</span></a></span><span> </span><span class="annot"><span class="annottext">forall a. Outputable a =&gt; a -&gt; SDoc
</span><a href="GHC.Utils.Outputable.html#ppr"><span class="hs-identifier hs-var">ppr</span></a></span><span> </span><span class="annot"><span class="annottext">Coercion
</span><a href="#local-6989586621681034558"><span class="hs-identifier hs-var">w</span></a></span><span> </span><span class="annot"><span class="annottext">SDoc -&gt; SDoc -&gt; SDoc
</span><a href="GHC.Utils.Outputable.html#%24%24"><span class="hs-operator hs-var">$$</span></a></span><span> </span><span class="annot"><span class="annottext">forall a. Outputable a =&gt; a -&gt; SDoc
</span><a href="GHC.Utils.Outputable.html#ppr"><span class="hs-identifier hs-var">ppr</span></a></span><span> </span><span class="annot"><span class="annottext">Coercion
</span><a href="#local-6989586621681034557"><span class="hs-identifier hs-var">co1</span></a></span><span> </span><span class="annot"><span class="annottext">SDoc -&gt; SDoc -&gt; SDoc
</span><a href="GHC.Utils.Outputable.html#%24%24"><span class="hs-operator hs-var">$$</span></a></span><span> </span><span class="annot"><span class="annottext">forall a. Outputable a =&gt; a -&gt; SDoc
</span><a href="GHC.Utils.Outputable.html#ppr"><span class="hs-identifier hs-var">ppr</span></a></span><span> </span><span class="annot"><span class="annottext">Coercion
</span><a href="#local-6989586621681034556"><span class="hs-identifier hs-var">co2</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-1191"></span><span>
</span><span id="line-1192"></span><span class="hs-comment">-- | If you're about to call @mkNthCo r n co@, then @r@ should be</span><span>
</span><span id="line-1193"></span><span class="hs-comment">-- whatever @nthCoRole n co@ returns.</span><span>
</span><span id="line-1194"></span><span class="annot"><a href="GHC.Core.Coercion.html#nthCoRole"><span class="hs-identifier hs-type">nthCoRole</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><span class="hs-identifier hs-type">Int</span></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="GHC.Core.TyCo.Rep.html#Coercion"><span class="hs-identifier hs-type">Coercion</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="GHC.Core.Coercion.Axiom.html#Role"><span class="hs-identifier hs-type">Role</span></a></span><span>
</span><span id="line-1195"></span><span id="nthCoRole"><span class="annot"><span class="annottext">nthCoRole :: Int -&gt; Coercion -&gt; Role
</span><a href="GHC.Core.Coercion.html#nthCoRole"><span class="hs-identifier hs-var hs-var">nthCoRole</span></a></span></span><span> </span><span id="local-6989586621681034555"><span class="annot"><span class="annottext">Int
</span><a href="#local-6989586621681034555"><span class="hs-identifier hs-var">n</span></a></span></span><span> </span><span id="local-6989586621681034554"><span class="annot"><span class="annottext">Coercion
</span><a href="#local-6989586621681034554"><span class="hs-identifier hs-var">co</span></a></span></span><span>
</span><span id="line-1196"></span><span>  </span><span class="hs-glyph">|</span><span> </span><span class="annot"><a href="../../base-4.16.4.0/src/GHC-Maybe.html#Just"><span class="hs-identifier hs-type">Just</span></a></span><span> </span><span class="hs-special">(</span><span id="local-6989586621681034553"><span class="annot"><span class="annottext">TyCon
</span><a href="#local-6989586621681034553"><span class="hs-identifier hs-var">tc</span></a></span></span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">[Type]
</span><span class="hs-identifier">_</span></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">HasDebugCallStack =&gt; Type -&gt; Maybe (TyCon, [Type])
</span><a href="GHC.Core.Type.html#splitTyConApp_maybe"><span class="hs-identifier hs-var">splitTyConApp_maybe</span></a></span><span> </span><span class="annot"><span class="annottext">Type
</span><a href="#local-6989586621681034552"><span class="hs-identifier hs-var">lty</span></a></span><span>
</span><span id="line-1197"></span><span>  </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">Role -&gt; TyCon -&gt; Int -&gt; Role
</span><a href="GHC.Core.Coercion.html#nthRole"><span class="hs-identifier hs-var">nthRole</span></a></span><span> </span><span class="annot"><span class="annottext">Role
</span><a href="#local-6989586621681034551"><span class="hs-identifier hs-var">r</span></a></span><span> </span><span class="annot"><span class="annottext">TyCon
</span><a href="#local-6989586621681034553"><span class="hs-identifier hs-var">tc</span></a></span><span> </span><span class="annot"><span class="annottext">Int
</span><a href="#local-6989586621681034555"><span class="hs-identifier hs-var">n</span></a></span><span>
</span><span id="line-1198"></span><span>
</span><span id="line-1199"></span><span>  </span><span class="hs-glyph">|</span><span> </span><span class="annot"><a href="../../base-4.16.4.0/src/GHC-Maybe.html#Just"><span class="hs-identifier hs-type">Just</span></a></span><span> </span><span class="annot"><span class="annottext">(CoVar, Type)
</span><span class="hs-identifier">_</span></span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">Type -&gt; Maybe (CoVar, Type)
</span><a href="GHC.Core.Type.html#splitForAllTyCoVar_maybe"><span class="hs-identifier hs-var">splitForAllTyCoVar_maybe</span></a></span><span> </span><span class="annot"><span class="annottext">Type
</span><a href="#local-6989586621681034552"><span class="hs-identifier hs-var">lty</span></a></span><span>
</span><span id="line-1200"></span><span>  </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">Role
</span><a href="GHC.Core.Coercion.Axiom.html#Nominal"><span class="hs-identifier hs-var">Nominal</span></a></span><span>
</span><span id="line-1201"></span><span>
</span><span id="line-1202"></span><span>  </span><span class="hs-glyph">|</span><span> </span><span class="annot"><span class="annottext">Bool
</span><a href="../../base-4.16.4.0/src/GHC-Base.html#otherwise"><span class="hs-identifier hs-var">otherwise</span></a></span><span>
</span><span id="line-1203"></span><span>  </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">forall a. HasCallStack =&gt; String -&gt; SDoc -&gt; a
</span><a href="GHC.Utils.Panic.html#pprPanic"><span class="hs-identifier hs-var">pprPanic</span></a></span><span> </span><span class="annot"><span class="annottext">String
</span><span class="hs-string">&quot;nthCoRole&quot;</span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">forall a. Outputable a =&gt; a -&gt; SDoc
</span><a href="GHC.Utils.Outputable.html#ppr"><span class="hs-identifier hs-var">ppr</span></a></span><span> </span><span class="annot"><span class="annottext">Coercion
</span><a href="#local-6989586621681034554"><span class="hs-identifier hs-var">co</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-1204"></span><span>
</span><span id="line-1205"></span><span>  </span><span class="hs-keyword">where</span><span>
</span><span id="line-1206"></span><span>    </span><span id="local-6989586621681034552"><span class="annot"><span class="annottext">lty :: Type
</span><a href="#local-6989586621681034552"><span class="hs-identifier hs-var hs-var">lty</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">Coercion -&gt; Type
</span><a href="GHC.Core.Coercion.html#coercionLKind"><span class="hs-identifier hs-var">coercionLKind</span></a></span><span> </span><span class="annot"><span class="annottext">Coercion
</span><a href="#local-6989586621681034554"><span class="hs-identifier hs-var">co</span></a></span><span>
</span><span id="line-1207"></span><span>    </span><span id="local-6989586621681034551"><span class="annot"><span class="annottext">r :: Role
</span><a href="#local-6989586621681034551"><span class="hs-identifier hs-var hs-var">r</span></a></span></span><span>   </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">Coercion -&gt; Role
</span><a href="GHC.Core.Coercion.html#coercionRole"><span class="hs-identifier hs-var">coercionRole</span></a></span><span> </span><span class="annot"><span class="annottext">Coercion
</span><a href="#local-6989586621681034554"><span class="hs-identifier hs-var">co</span></a></span><span>
</span><span id="line-1208"></span><span>
</span><span id="line-1209"></span><span class="annot"><a href="GHC.Core.Coercion.html#mkLRCo"><span class="hs-identifier hs-type">mkLRCo</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><a href="GHC.Types.Basic.html#LeftOrRight"><span class="hs-identifier hs-type">LeftOrRight</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="GHC.Core.TyCo.Rep.html#Coercion"><span class="hs-identifier hs-type">Coercion</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="GHC.Core.TyCo.Rep.html#Coercion"><span class="hs-identifier hs-type">Coercion</span></a></span><span>
</span><span id="line-1210"></span><span id="mkLRCo"><span class="annot"><span class="annottext">mkLRCo :: LeftOrRight -&gt; Coercion -&gt; Coercion
</span><a href="GHC.Core.Coercion.html#mkLRCo"><span class="hs-identifier hs-var hs-var">mkLRCo</span></a></span></span><span> </span><span id="local-6989586621681034550"><span class="annot"><span class="annottext">LeftOrRight
</span><a href="#local-6989586621681034550"><span class="hs-identifier hs-var">lr</span></a></span></span><span> </span><span id="local-6989586621681034549"><span class="annot"><span class="annottext">Coercion
</span><a href="#local-6989586621681034549"><span class="hs-identifier hs-var">co</span></a></span></span><span>
</span><span id="line-1211"></span><span>  </span><span class="hs-glyph">|</span><span> </span><span class="annot"><a href="../../base-4.16.4.0/src/GHC-Maybe.html#Just"><span class="hs-identifier hs-type">Just</span></a></span><span> </span><span class="hs-special">(</span><span id="local-6989586621681034548"><span class="annot"><span class="annottext">Type
</span><a href="#local-6989586621681034548"><span class="hs-identifier hs-var">ty</span></a></span></span><span class="hs-special">,</span><span> </span><span id="local-6989586621681034547"><span class="annot"><span class="annottext">Role
</span><a href="#local-6989586621681034547"><span class="hs-identifier hs-var">eq</span></a></span></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">Coercion -&gt; Maybe (Type, Role)
</span><a href="GHC.Core.Coercion.html#isReflCo_maybe"><span class="hs-identifier hs-var">isReflCo_maybe</span></a></span><span> </span><span class="annot"><span class="annottext">Coercion
</span><a href="#local-6989586621681034549"><span class="hs-identifier hs-var">co</span></a></span><span>
</span><span id="line-1212"></span><span>  </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">Role -&gt; Type -&gt; Coercion
</span><a href="GHC.Core.Coercion.html#mkReflCo"><span class="hs-identifier hs-var">mkReflCo</span></a></span><span> </span><span class="annot"><span class="annottext">Role
</span><a href="#local-6989586621681034547"><span class="hs-identifier hs-var">eq</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">forall a. LeftOrRight -&gt; (a, a) -&gt; a
</span><a href="GHC.Types.Basic.html#pickLR"><span class="hs-identifier hs-var">pickLR</span></a></span><span> </span><span class="annot"><span class="annottext">LeftOrRight
</span><a href="#local-6989586621681034550"><span class="hs-identifier hs-var">lr</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Type -&gt; (Type, Type)
</span><a href="GHC.Core.Type.html#splitAppTy"><span class="hs-identifier hs-var">splitAppTy</span></a></span><span> </span><span class="annot"><span class="annottext">Type
</span><a href="#local-6989586621681034548"><span class="hs-identifier hs-var">ty</span></a></span><span class="hs-special">)</span><span class="hs-special">)</span><span>
</span><span id="line-1213"></span><span>  </span><span class="hs-glyph">|</span><span> </span><span class="annot"><span class="annottext">Bool
</span><a href="../../base-4.16.4.0/src/GHC-Base.html#otherwise"><span class="hs-identifier hs-var">otherwise</span></a></span><span>
</span><span id="line-1214"></span><span>  </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">LeftOrRight -&gt; Coercion -&gt; Coercion
</span><a href="GHC.Core.TyCo.Rep.html#LRCo"><span class="hs-identifier hs-var">LRCo</span></a></span><span> </span><span class="annot"><span class="annottext">LeftOrRight
</span><a href="#local-6989586621681034550"><span class="hs-identifier hs-var">lr</span></a></span><span> </span><span class="annot"><span class="annottext">Coercion
</span><a href="#local-6989586621681034549"><span class="hs-identifier hs-var">co</span></a></span><span>
</span><span id="line-1215"></span><span>
</span><span id="line-1216"></span><span class="hs-comment">-- | Instantiates a 'Coercion'.</span><span>
</span><span id="line-1217"></span><span class="annot"><a href="GHC.Core.Coercion.html#mkInstCo"><span class="hs-identifier hs-type">mkInstCo</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><a href="GHC.Core.TyCo.Rep.html#Coercion"><span class="hs-identifier hs-type">Coercion</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="GHC.Core.TyCo.Rep.html#Coercion"><span class="hs-identifier hs-type">Coercion</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="GHC.Core.TyCo.Rep.html#Coercion"><span class="hs-identifier hs-type">Coercion</span></a></span><span>
</span><span id="line-1218"></span><span id="mkInstCo"><span class="annot"><span class="annottext">mkInstCo :: Coercion -&gt; Coercion -&gt; Coercion
</span><a href="GHC.Core.Coercion.html#mkInstCo"><span class="hs-identifier hs-var hs-var">mkInstCo</span></a></span></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="GHC.Core.TyCo.Rep.html#ForAllCo"><span class="hs-identifier hs-type">ForAllCo</span></a></span><span> </span><span id="local-6989586621681034544"><span class="annot"><span class="annottext">CoVar
</span><a href="#local-6989586621681034544"><span class="hs-identifier hs-var">tcv</span></a></span></span><span> </span><span id="local-6989586621681034543"><span class="annot"><span class="annottext">Coercion
</span><a href="#local-6989586621681034543"><span class="hs-identifier hs-var">_kind_co</span></a></span></span><span> </span><span id="local-6989586621681034542"><span class="annot"><span class="annottext">Coercion
</span><a href="#local-6989586621681034542"><span class="hs-identifier hs-var">body_co</span></a></span></span><span class="hs-special">)</span><span> </span><span id="local-6989586621681034541"><span class="annot"><span class="annottext">Coercion
</span><a href="#local-6989586621681034541"><span class="hs-identifier hs-var">co</span></a></span></span><span>
</span><span id="line-1219"></span><span>  </span><span class="hs-glyph">|</span><span> </span><span class="annot"><a href="../../base-4.16.4.0/src/GHC-Maybe.html#Just"><span class="hs-identifier hs-type">Just</span></a></span><span> </span><span class="hs-special">(</span><span id="local-6989586621681034540"><span class="annot"><span class="annottext">Type
</span><a href="#local-6989586621681034540"><span class="hs-identifier hs-var">arg</span></a></span></span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">Role
</span><span class="hs-identifier">_</span></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">Coercion -&gt; Maybe (Type, Role)
</span><a href="GHC.Core.Coercion.html#isReflCo_maybe"><span class="hs-identifier hs-var">isReflCo_maybe</span></a></span><span> </span><span class="annot"><span class="annottext">Coercion
</span><a href="#local-6989586621681034541"><span class="hs-identifier hs-var">co</span></a></span><span>
</span><span id="line-1220"></span><span>      </span><span class="hs-comment">-- works for both tyvar and covar</span><span>
</span><span id="line-1221"></span><span>  </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">TCvSubst -&gt; Coercion -&gt; Coercion
</span><a href="GHC.Core.TyCo.Subst.html#substCoUnchecked"><span class="hs-identifier hs-var">substCoUnchecked</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">HasDebugCallStack =&gt; [CoVar] -&gt; [Type] -&gt; TCvSubst
</span><a href="GHC.Core.TyCo.Subst.html#zipTCvSubst"><span class="hs-identifier hs-var">zipTCvSubst</span></a></span><span> </span><span class="hs-special">[</span><span class="annot"><span class="annottext">CoVar
</span><a href="#local-6989586621681034544"><span class="hs-identifier hs-var">tcv</span></a></span><span class="hs-special">]</span><span> </span><span class="hs-special">[</span><span class="annot"><span class="annottext">Type
</span><a href="#local-6989586621681034540"><span class="hs-identifier hs-var">arg</span></a></span><span class="hs-special">]</span><span class="hs-special">)</span><span> </span><span class="annot"><span class="annottext">Coercion
</span><a href="#local-6989586621681034542"><span class="hs-identifier hs-var">body_co</span></a></span><span>
</span><span id="line-1222"></span><span class="annot"><a href="GHC.Core.Coercion.html#mkInstCo"><span class="hs-identifier hs-var">mkInstCo</span></a></span><span> </span><span id="local-6989586621681034537"><span class="annot"><span class="annottext">Coercion
</span><a href="#local-6989586621681034537"><span class="hs-identifier hs-var">co</span></a></span></span><span> </span><span id="local-6989586621681034536"><span class="annot"><span class="annottext">Coercion
</span><a href="#local-6989586621681034536"><span class="hs-identifier hs-var">arg</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">Coercion -&gt; Coercion -&gt; Coercion
</span><a href="GHC.Core.TyCo.Rep.html#InstCo"><span class="hs-identifier hs-var">InstCo</span></a></span><span> </span><span class="annot"><span class="annottext">Coercion
</span><a href="#local-6989586621681034537"><span class="hs-identifier hs-var">co</span></a></span><span> </span><span class="annot"><span class="annottext">Coercion
</span><a href="#local-6989586621681034536"><span class="hs-identifier hs-var">arg</span></a></span><span>
</span><span id="line-1223"></span><span>
</span><span id="line-1224"></span><span class="hs-comment">-- | Given @ty :: k1@, @co :: k1 ~ k2@,</span><span>
</span><span id="line-1225"></span><span class="hs-comment">-- produces @co' :: ty ~r (ty |&gt; co)@</span><span>
</span><span id="line-1226"></span><span class="annot"><a href="GHC.Core.Coercion.html#mkGReflRightCo"><span class="hs-identifier hs-type">mkGReflRightCo</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><a href="GHC.Core.Coercion.Axiom.html#Role"><span class="hs-identifier hs-type">Role</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="GHC.Core.TyCo.Rep.html#Type"><span class="hs-identifier hs-type">Type</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="GHC.Core.TyCo.Rep.html#CoercionN"><span class="hs-identifier hs-type">CoercionN</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="GHC.Core.TyCo.Rep.html#Coercion"><span class="hs-identifier hs-type">Coercion</span></a></span><span>
</span><span id="line-1227"></span><span id="mkGReflRightCo"><span class="annot"><span class="annottext">mkGReflRightCo :: Role -&gt; Type -&gt; Coercion -&gt; Coercion
</span><a href="GHC.Core.Coercion.html#mkGReflRightCo"><span class="hs-identifier hs-var hs-var">mkGReflRightCo</span></a></span></span><span> </span><span id="local-6989586621681034534"><span class="annot"><span class="annottext">Role
</span><a href="#local-6989586621681034534"><span class="hs-identifier hs-var">r</span></a></span></span><span> </span><span id="local-6989586621681034533"><span class="annot"><span class="annottext">Type
</span><a href="#local-6989586621681034533"><span class="hs-identifier hs-var">ty</span></a></span></span><span> </span><span id="local-6989586621681034532"><span class="annot"><span class="annottext">Coercion
</span><a href="#local-6989586621681034532"><span class="hs-identifier hs-var">co</span></a></span></span><span>
</span><span id="line-1228"></span><span>  </span><span class="hs-glyph">|</span><span> </span><span class="annot"><span class="annottext">Coercion -&gt; Bool
</span><a href="GHC.Core.Coercion.html#isGReflCo"><span class="hs-identifier hs-var">isGReflCo</span></a></span><span> </span><span class="annot"><span class="annottext">Coercion
</span><a href="#local-6989586621681034532"><span class="hs-identifier hs-var">co</span></a></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">Role -&gt; Type -&gt; Coercion
</span><a href="GHC.Core.Coercion.html#mkReflCo"><span class="hs-identifier hs-var">mkReflCo</span></a></span><span> </span><span class="annot"><span class="annottext">Role
</span><a href="#local-6989586621681034534"><span class="hs-identifier hs-var">r</span></a></span><span> </span><span class="annot"><span class="annottext">Type
</span><a href="#local-6989586621681034533"><span class="hs-identifier hs-var">ty</span></a></span><span>
</span><span id="line-1229"></span><span>    </span><span class="hs-comment">-- the kinds of @k1@ and @k2@ are the same, thus @isGReflCo@</span><span>
</span><span id="line-1230"></span><span>    </span><span class="hs-comment">-- instead of @isReflCo@</span><span>
</span><span id="line-1231"></span><span>  </span><span class="hs-glyph">|</span><span> </span><span class="annot"><span class="annottext">Bool
</span><a href="../../base-4.16.4.0/src/GHC-Base.html#otherwise"><span class="hs-identifier hs-var">otherwise</span></a></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">Role -&gt; Type -&gt; MCoercion -&gt; Coercion
</span><a href="GHC.Core.TyCo.Rep.html#GRefl"><span class="hs-identifier hs-var">GRefl</span></a></span><span> </span><span class="annot"><span class="annottext">Role
</span><a href="#local-6989586621681034534"><span class="hs-identifier hs-var">r</span></a></span><span> </span><span class="annot"><span class="annottext">Type
</span><a href="#local-6989586621681034533"><span class="hs-identifier hs-var">ty</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Coercion -&gt; MCoercion
</span><a href="GHC.Core.TyCo.Rep.html#MCo"><span class="hs-identifier hs-var">MCo</span></a></span><span> </span><span class="annot"><span class="annottext">Coercion
</span><a href="#local-6989586621681034532"><span class="hs-identifier hs-var">co</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-1232"></span><span>
</span><span id="line-1233"></span><span class="hs-comment">-- | Given @ty :: k1@, @co :: k1 ~ k2@,</span><span>
</span><span id="line-1234"></span><span class="hs-comment">-- produces @co' :: (ty |&gt; co) ~r ty@</span><span>
</span><span id="line-1235"></span><span class="annot"><a href="GHC.Core.Coercion.html#mkGReflLeftCo"><span class="hs-identifier hs-type">mkGReflLeftCo</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><a href="GHC.Core.Coercion.Axiom.html#Role"><span class="hs-identifier hs-type">Role</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="GHC.Core.TyCo.Rep.html#Type"><span class="hs-identifier hs-type">Type</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="GHC.Core.TyCo.Rep.html#CoercionN"><span class="hs-identifier hs-type">CoercionN</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="GHC.Core.TyCo.Rep.html#Coercion"><span class="hs-identifier hs-type">Coercion</span></a></span><span>
</span><span id="line-1236"></span><span id="mkGReflLeftCo"><span class="annot"><span class="annottext">mkGReflLeftCo :: Role -&gt; Type -&gt; Coercion -&gt; Coercion
</span><a href="GHC.Core.Coercion.html#mkGReflLeftCo"><span class="hs-identifier hs-var hs-var">mkGReflLeftCo</span></a></span></span><span> </span><span id="local-6989586621681034531"><span class="annot"><span class="annottext">Role
</span><a href="#local-6989586621681034531"><span class="hs-identifier hs-var">r</span></a></span></span><span> </span><span id="local-6989586621681034530"><span class="annot"><span class="annottext">Type
</span><a href="#local-6989586621681034530"><span class="hs-identifier hs-var">ty</span></a></span></span><span> </span><span id="local-6989586621681034529"><span class="annot"><span class="annottext">Coercion
</span><a href="#local-6989586621681034529"><span class="hs-identifier hs-var">co</span></a></span></span><span>
</span><span id="line-1237"></span><span>  </span><span class="hs-glyph">|</span><span> </span><span class="annot"><span class="annottext">Coercion -&gt; Bool
</span><a href="GHC.Core.Coercion.html#isGReflCo"><span class="hs-identifier hs-var">isGReflCo</span></a></span><span> </span><span class="annot"><span class="annottext">Coercion
</span><a href="#local-6989586621681034529"><span class="hs-identifier hs-var">co</span></a></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">Role -&gt; Type -&gt; Coercion
</span><a href="GHC.Core.Coercion.html#mkReflCo"><span class="hs-identifier hs-var">mkReflCo</span></a></span><span> </span><span class="annot"><span class="annottext">Role
</span><a href="#local-6989586621681034531"><span class="hs-identifier hs-var">r</span></a></span><span> </span><span class="annot"><span class="annottext">Type
</span><a href="#local-6989586621681034530"><span class="hs-identifier hs-var">ty</span></a></span><span>
</span><span id="line-1238"></span><span>    </span><span class="hs-comment">-- the kinds of @k1@ and @k2@ are the same, thus @isGReflCo@</span><span>
</span><span id="line-1239"></span><span>    </span><span class="hs-comment">-- instead of @isReflCo@</span><span>
</span><span id="line-1240"></span><span>  </span><span class="hs-glyph">|</span><span> </span><span class="annot"><span class="annottext">Bool
</span><a href="../../base-4.16.4.0/src/GHC-Base.html#otherwise"><span class="hs-identifier hs-var">otherwise</span></a></span><span>    </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">Coercion -&gt; Coercion
</span><a href="GHC.Core.Coercion.html#mkSymCo"><span class="hs-identifier hs-var">mkSymCo</span></a></span><span> </span><span class="annot"><span class="annottext">forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><a href="../../base-4.16.4.0/src/GHC-Base.html#%24"><span class="hs-operator hs-var">$</span></a></span><span> </span><span class="annot"><span class="annottext">Role -&gt; Type -&gt; MCoercion -&gt; Coercion
</span><a href="GHC.Core.TyCo.Rep.html#GRefl"><span class="hs-identifier hs-var">GRefl</span></a></span><span> </span><span class="annot"><span class="annottext">Role
</span><a href="#local-6989586621681034531"><span class="hs-identifier hs-var">r</span></a></span><span> </span><span class="annot"><span class="annottext">Type
</span><a href="#local-6989586621681034530"><span class="hs-identifier hs-var">ty</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Coercion -&gt; MCoercion
</span><a href="GHC.Core.TyCo.Rep.html#MCo"><span class="hs-identifier hs-var">MCo</span></a></span><span> </span><span class="annot"><span class="annottext">Coercion
</span><a href="#local-6989586621681034529"><span class="hs-identifier hs-var">co</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-1241"></span><span>
</span><span id="line-1242"></span><span class="hs-comment">-- | Given @ty :: k1@, @co :: k1 ~ k2@, @co2:: ty ~r ty'@,</span><span>
</span><span id="line-1243"></span><span class="hs-comment">-- produces @co' :: (ty |&gt; co) ~r ty'</span><span>
</span><span id="line-1244"></span><span class="hs-comment">-- It is not only a utility function, but it saves allocation when co</span><span>
</span><span id="line-1245"></span><span class="hs-comment">-- is a GRefl coercion.</span><span>
</span><span id="line-1246"></span><span class="annot"><a href="GHC.Core.Coercion.html#mkCoherenceLeftCo"><span class="hs-identifier hs-type">mkCoherenceLeftCo</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><a href="GHC.Core.Coercion.Axiom.html#Role"><span class="hs-identifier hs-type">Role</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="GHC.Core.TyCo.Rep.html#Type"><span class="hs-identifier hs-type">Type</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="GHC.Core.TyCo.Rep.html#CoercionN"><span class="hs-identifier hs-type">CoercionN</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="GHC.Core.TyCo.Rep.html#Coercion"><span class="hs-identifier hs-type">Coercion</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="GHC.Core.TyCo.Rep.html#Coercion"><span class="hs-identifier hs-type">Coercion</span></a></span><span>
</span><span id="line-1247"></span><span id="mkCoherenceLeftCo"><span class="annot"><span class="annottext">mkCoherenceLeftCo :: Role -&gt; Type -&gt; Coercion -&gt; Coercion -&gt; Coercion
</span><a href="GHC.Core.Coercion.html#mkCoherenceLeftCo"><span class="hs-identifier hs-var hs-var">mkCoherenceLeftCo</span></a></span></span><span> </span><span id="local-6989586621681034528"><span class="annot"><span class="annottext">Role
</span><a href="#local-6989586621681034528"><span class="hs-identifier hs-var">r</span></a></span></span><span> </span><span id="local-6989586621681034527"><span class="annot"><span class="annottext">Type
</span><a href="#local-6989586621681034527"><span class="hs-identifier hs-var">ty</span></a></span></span><span> </span><span id="local-6989586621681034526"><span class="annot"><span class="annottext">Coercion
</span><a href="#local-6989586621681034526"><span class="hs-identifier hs-var">co</span></a></span></span><span> </span><span id="local-6989586621681034525"><span class="annot"><span class="annottext">Coercion
</span><a href="#local-6989586621681034525"><span class="hs-identifier hs-var">co2</span></a></span></span><span>
</span><span id="line-1248"></span><span>  </span><span class="hs-glyph">|</span><span> </span><span class="annot"><span class="annottext">Coercion -&gt; Bool
</span><a href="GHC.Core.Coercion.html#isGReflCo"><span class="hs-identifier hs-var">isGReflCo</span></a></span><span> </span><span class="annot"><span class="annottext">Coercion
</span><a href="#local-6989586621681034526"><span class="hs-identifier hs-var">co</span></a></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">Coercion
</span><a href="#local-6989586621681034525"><span class="hs-identifier hs-var">co2</span></a></span><span>
</span><span id="line-1249"></span><span>  </span><span class="hs-glyph">|</span><span> </span><span class="annot"><span class="annottext">Bool
</span><a href="../../base-4.16.4.0/src/GHC-Base.html#otherwise"><span class="hs-identifier hs-var">otherwise</span></a></span><span>    </span><span class="hs-glyph">=</span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Coercion -&gt; Coercion
</span><a href="GHC.Core.Coercion.html#mkSymCo"><span class="hs-identifier hs-var">mkSymCo</span></a></span><span> </span><span class="annot"><span class="annottext">forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><a href="../../base-4.16.4.0/src/GHC-Base.html#%24"><span class="hs-operator hs-var">$</span></a></span><span> </span><span class="annot"><span class="annottext">Role -&gt; Type -&gt; MCoercion -&gt; Coercion
</span><a href="GHC.Core.TyCo.Rep.html#GRefl"><span class="hs-identifier hs-var">GRefl</span></a></span><span> </span><span class="annot"><span class="annottext">Role
</span><a href="#local-6989586621681034528"><span class="hs-identifier hs-var">r</span></a></span><span> </span><span class="annot"><span class="annottext">Type
</span><a href="#local-6989586621681034527"><span class="hs-identifier hs-var">ty</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Coercion -&gt; MCoercion
</span><a href="GHC.Core.TyCo.Rep.html#MCo"><span class="hs-identifier hs-var">MCo</span></a></span><span> </span><span class="annot"><span class="annottext">Coercion
</span><a href="#local-6989586621681034526"><span class="hs-identifier hs-var">co</span></a></span><span class="hs-special">)</span><span class="hs-special">)</span><span> </span><span class="annot"><span class="annottext">Coercion -&gt; Coercion -&gt; Coercion
</span><a href="GHC.Core.Coercion.html#mkTransCo"><span class="hs-operator hs-var">`mkTransCo`</span></a></span><span> </span><span class="annot"><span class="annottext">Coercion
</span><a href="#local-6989586621681034525"><span class="hs-identifier hs-var">co2</span></a></span><span>
</span><span id="line-1250"></span><span>
</span><span id="line-1251"></span><span class="hs-comment">-- | Given @ty :: k1@, @co :: k1 ~ k2@, @co2:: ty' ~r ty@,</span><span>
</span><span id="line-1252"></span><span class="hs-comment">-- produces @co' :: ty' ~r (ty |&gt; co)</span><span>
</span><span id="line-1253"></span><span class="hs-comment">-- It is not only a utility function, but it saves allocation when co</span><span>
</span><span id="line-1254"></span><span class="hs-comment">-- is a GRefl coercion.</span><span>
</span><span id="line-1255"></span><span class="annot"><a href="GHC.Core.Coercion.html#mkCoherenceRightCo"><span class="hs-identifier hs-type">mkCoherenceRightCo</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><a href="GHC.Core.Coercion.Axiom.html#Role"><span class="hs-identifier hs-type">Role</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="GHC.Core.TyCo.Rep.html#Type"><span class="hs-identifier hs-type">Type</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="GHC.Core.TyCo.Rep.html#CoercionN"><span class="hs-identifier hs-type">CoercionN</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="GHC.Core.TyCo.Rep.html#Coercion"><span class="hs-identifier hs-type">Coercion</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="GHC.Core.TyCo.Rep.html#Coercion"><span class="hs-identifier hs-type">Coercion</span></a></span><span>
</span><span id="line-1256"></span><span id="mkCoherenceRightCo"><span class="annot"><span class="annottext">mkCoherenceRightCo :: Role -&gt; Type -&gt; Coercion -&gt; Coercion -&gt; Coercion
</span><a href="GHC.Core.Coercion.html#mkCoherenceRightCo"><span class="hs-identifier hs-var hs-var">mkCoherenceRightCo</span></a></span></span><span> </span><span id="local-6989586621681034524"><span class="annot"><span class="annottext">Role
</span><a href="#local-6989586621681034524"><span class="hs-identifier hs-var">r</span></a></span></span><span> </span><span id="local-6989586621681034523"><span class="annot"><span class="annottext">Type
</span><a href="#local-6989586621681034523"><span class="hs-identifier hs-var">ty</span></a></span></span><span> </span><span id="local-6989586621681034522"><span class="annot"><span class="annottext">Coercion
</span><a href="#local-6989586621681034522"><span class="hs-identifier hs-var">co</span></a></span></span><span> </span><span id="local-6989586621681034521"><span class="annot"><span class="annottext">Coercion
</span><a href="#local-6989586621681034521"><span class="hs-identifier hs-var">co2</span></a></span></span><span>
</span><span id="line-1257"></span><span>  </span><span class="hs-glyph">|</span><span> </span><span class="annot"><span class="annottext">Coercion -&gt; Bool
</span><a href="GHC.Core.Coercion.html#isGReflCo"><span class="hs-identifier hs-var">isGReflCo</span></a></span><span> </span><span class="annot"><span class="annottext">Coercion
</span><a href="#local-6989586621681034522"><span class="hs-identifier hs-var">co</span></a></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">Coercion
</span><a href="#local-6989586621681034521"><span class="hs-identifier hs-var">co2</span></a></span><span>
</span><span id="line-1258"></span><span>  </span><span class="hs-glyph">|</span><span> </span><span class="annot"><span class="annottext">Bool
</span><a href="../../base-4.16.4.0/src/GHC-Base.html#otherwise"><span class="hs-identifier hs-var">otherwise</span></a></span><span>    </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">Coercion
</span><a href="#local-6989586621681034521"><span class="hs-identifier hs-var">co2</span></a></span><span> </span><span class="annot"><span class="annottext">Coercion -&gt; Coercion -&gt; Coercion
</span><a href="GHC.Core.Coercion.html#mkTransCo"><span class="hs-operator hs-var">`mkTransCo`</span></a></span><span> </span><span class="annot"><span class="annottext">Role -&gt; Type -&gt; MCoercion -&gt; Coercion
</span><a href="GHC.Core.TyCo.Rep.html#GRefl"><span class="hs-identifier hs-var">GRefl</span></a></span><span> </span><span class="annot"><span class="annottext">Role
</span><a href="#local-6989586621681034524"><span class="hs-identifier hs-var">r</span></a></span><span> </span><span class="annot"><span class="annottext">Type
</span><a href="#local-6989586621681034523"><span class="hs-identifier hs-var">ty</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Coercion -&gt; MCoercion
</span><a href="GHC.Core.TyCo.Rep.html#MCo"><span class="hs-identifier hs-var">MCo</span></a></span><span> </span><span class="annot"><span class="annottext">Coercion
</span><a href="#local-6989586621681034522"><span class="hs-identifier hs-var">co</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-1259"></span><span>
</span><span id="line-1260"></span><span class="hs-comment">-- | Given @co :: (a :: k) ~ (b :: k')@ produce @co' :: k ~ k'@.</span><span>
</span><span id="line-1261"></span><span class="annot"><a href="GHC.Core.Coercion.html#mkKindCo"><span class="hs-identifier hs-type">mkKindCo</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><a href="GHC.Core.TyCo.Rep.html#Coercion"><span class="hs-identifier hs-type">Coercion</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="GHC.Core.TyCo.Rep.html#Coercion"><span class="hs-identifier hs-type">Coercion</span></a></span><span>
</span><span id="line-1262"></span><span id="mkKindCo"><span class="annot"><span class="annottext">mkKindCo :: Coercion -&gt; Coercion
</span><a href="GHC.Core.Coercion.html#mkKindCo"><span class="hs-identifier hs-var hs-var">mkKindCo</span></a></span></span><span> </span><span id="local-6989586621681034520"><span class="annot"><span class="annottext">Coercion
</span><a href="#local-6989586621681034520"><span class="hs-identifier hs-var">co</span></a></span></span><span> </span><span class="hs-glyph">|</span><span> </span><span class="annot"><a href="../../base-4.16.4.0/src/GHC-Maybe.html#Just"><span class="hs-identifier hs-type">Just</span></a></span><span> </span><span class="hs-special">(</span><span id="local-6989586621681034519"><span class="annot"><span class="annottext">Type
</span><a href="#local-6989586621681034519"><span class="hs-identifier hs-var">ty</span></a></span></span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">Role
</span><span class="hs-identifier">_</span></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">Coercion -&gt; Maybe (Type, Role)
</span><a href="GHC.Core.Coercion.html#isReflCo_maybe"><span class="hs-identifier hs-var">isReflCo_maybe</span></a></span><span> </span><span class="annot"><span class="annottext">Coercion
</span><a href="#local-6989586621681034520"><span class="hs-identifier hs-var">co</span></a></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">Type -&gt; Coercion
</span><a href="GHC.Core.TyCo.Rep.html#Refl"><span class="hs-identifier hs-var">Refl</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">HasDebugCallStack =&gt; Type -&gt; Type
</span><a href="GHC.Core.Type.html#typeKind"><span class="hs-identifier hs-var">typeKind</span></a></span><span> </span><span class="annot"><span class="annottext">Type
</span><a href="#local-6989586621681034519"><span class="hs-identifier hs-var">ty</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-1263"></span><span class="annot"><a href="GHC.Core.Coercion.html#mkKindCo"><span class="hs-identifier hs-var">mkKindCo</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="GHC.Core.TyCo.Rep.html#GRefl"><span class="hs-identifier hs-type">GRefl</span></a></span><span> </span><span class="annot"><span class="annottext">Role
</span><span class="hs-identifier">_</span></span><span> </span><span class="annot"><span class="annottext">Type
</span><span class="hs-identifier">_</span></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="GHC.Core.TyCo.Rep.html#MCo"><span class="hs-identifier hs-type">MCo</span></a></span><span> </span><span id="local-6989586621681034517"><span class="annot"><span class="annottext">Coercion
</span><a href="#local-6989586621681034517"><span class="hs-identifier hs-var">co</span></a></span></span><span class="hs-special">)</span><span class="hs-special">)</span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">Coercion
</span><a href="#local-6989586621681034517"><span class="hs-identifier hs-var">co</span></a></span><span>
</span><span id="line-1264"></span><span class="annot"><a href="GHC.Core.Coercion.html#mkKindCo"><span class="hs-identifier hs-var">mkKindCo</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="GHC.Core.TyCo.Rep.html#UnivCo"><span class="hs-identifier hs-type">UnivCo</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="GHC.Core.TyCo.Rep.html#PhantomProv"><span class="hs-identifier hs-type">PhantomProv</span></a></span><span> </span><span id="local-6989586621681034515"><span class="annot"><span class="annottext">Coercion
</span><a href="#local-6989586621681034515"><span class="hs-identifier hs-var">h</span></a></span></span><span class="hs-special">)</span><span> </span><span class="annot"><span class="annottext">Role
</span><span class="hs-identifier">_</span></span><span> </span><span class="annot"><span class="annottext">Type
</span><span class="hs-identifier">_</span></span><span> </span><span class="annot"><span class="annottext">Type
</span><span class="hs-identifier">_</span></span><span class="hs-special">)</span><span>    </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">Coercion
</span><a href="#local-6989586621681034515"><span class="hs-identifier hs-var">h</span></a></span><span>
</span><span id="line-1265"></span><span class="annot"><a href="GHC.Core.Coercion.html#mkKindCo"><span class="hs-identifier hs-var">mkKindCo</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="GHC.Core.TyCo.Rep.html#UnivCo"><span class="hs-identifier hs-type">UnivCo</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="GHC.Core.TyCo.Rep.html#ProofIrrelProv"><span class="hs-identifier hs-type">ProofIrrelProv</span></a></span><span> </span><span id="local-6989586621681034513"><span class="annot"><span class="annottext">Coercion
</span><a href="#local-6989586621681034513"><span class="hs-identifier hs-var">h</span></a></span></span><span class="hs-special">)</span><span> </span><span class="annot"><span class="annottext">Role
</span><span class="hs-identifier">_</span></span><span> </span><span class="annot"><span class="annottext">Type
</span><span class="hs-identifier">_</span></span><span> </span><span class="annot"><span class="annottext">Type
</span><span class="hs-identifier">_</span></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">Coercion
</span><a href="#local-6989586621681034513"><span class="hs-identifier hs-var">h</span></a></span><span>
</span><span id="line-1266"></span><span class="annot"><a href="GHC.Core.Coercion.html#mkKindCo"><span class="hs-identifier hs-var">mkKindCo</span></a></span><span> </span><span id="local-6989586621681034512"><span class="annot"><span class="annottext">Coercion
</span><a href="#local-6989586621681034512"><span class="hs-identifier hs-var">co</span></a></span></span><span>
</span><span id="line-1267"></span><span>  </span><span class="hs-glyph">|</span><span> </span><span class="annot"><a href="GHC.Data.Pair.html#Pair"><span class="hs-identifier hs-type">Pair</span></a></span><span> </span><span id="local-6989586621681034511"><span class="annot"><span class="annottext">Type
</span><a href="#local-6989586621681034511"><span class="hs-identifier hs-var">ty1</span></a></span></span><span> </span><span id="local-6989586621681034510"><span class="annot"><span class="annottext">Type
</span><a href="#local-6989586621681034510"><span class="hs-identifier hs-var">ty2</span></a></span></span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">Coercion -&gt; Pair Type
</span><a href="GHC.Core.Coercion.html#coercionKind"><span class="hs-identifier hs-var">coercionKind</span></a></span><span> </span><span class="annot"><span class="annottext">Coercion
</span><a href="#local-6989586621681034512"><span class="hs-identifier hs-var">co</span></a></span><span>
</span><span id="line-1268"></span><span>       </span><span class="hs-comment">-- generally, calling coercionKind during coercion creation is a bad idea,</span><span>
</span><span id="line-1269"></span><span>       </span><span class="hs-comment">-- as it can lead to exponential behavior. But, we don't have nested mkKindCos,</span><span>
</span><span id="line-1270"></span><span>       </span><span class="hs-comment">-- so it's OK here.</span><span>
</span><span id="line-1271"></span><span>  </span><span class="hs-special">,</span><span> </span><span class="hs-keyword">let</span><span> </span><span id="local-6989586621681034509"><span class="annot"><span class="annottext">tk1 :: Type
</span><a href="#local-6989586621681034509"><span class="hs-identifier hs-var hs-var">tk1</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">HasDebugCallStack =&gt; Type -&gt; Type
</span><a href="GHC.Core.Type.html#typeKind"><span class="hs-identifier hs-var">typeKind</span></a></span><span> </span><span class="annot"><span class="annottext">Type
</span><a href="#local-6989586621681034511"><span class="hs-identifier hs-var">ty1</span></a></span><span>
</span><span id="line-1272"></span><span>        </span><span id="local-6989586621681034508"><span class="annot"><span class="annottext">tk2 :: Type
</span><a href="#local-6989586621681034508"><span class="hs-identifier hs-var hs-var">tk2</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">HasDebugCallStack =&gt; Type -&gt; Type
</span><a href="GHC.Core.Type.html#typeKind"><span class="hs-identifier hs-var">typeKind</span></a></span><span> </span><span class="annot"><span class="annottext">Type
</span><a href="#local-6989586621681034510"><span class="hs-identifier hs-var">ty2</span></a></span><span>
</span><span id="line-1273"></span><span>  </span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">Type
</span><a href="#local-6989586621681034509"><span class="hs-identifier hs-var">tk1</span></a></span><span> </span><span class="annot"><span class="annottext">Type -&gt; Type -&gt; Bool
</span><a href="GHC.Core.Type.html#eqType"><span class="hs-operator hs-var">`eqType`</span></a></span><span> </span><span class="annot"><span class="annottext">Type
</span><a href="#local-6989586621681034508"><span class="hs-identifier hs-var">tk2</span></a></span><span>
</span><span id="line-1274"></span><span>  </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">Type -&gt; Coercion
</span><a href="GHC.Core.TyCo.Rep.html#Refl"><span class="hs-identifier hs-var">Refl</span></a></span><span> </span><span class="annot"><span class="annottext">Type
</span><a href="#local-6989586621681034509"><span class="hs-identifier hs-var">tk1</span></a></span><span>
</span><span id="line-1275"></span><span>  </span><span class="hs-glyph">|</span><span> </span><span class="annot"><span class="annottext">Bool
</span><a href="../../base-4.16.4.0/src/GHC-Base.html#otherwise"><span class="hs-identifier hs-var">otherwise</span></a></span><span>
</span><span id="line-1276"></span><span>  </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">Coercion -&gt; Coercion
</span><a href="GHC.Core.TyCo.Rep.html#KindCo"><span class="hs-identifier hs-var">KindCo</span></a></span><span> </span><span class="annot"><span class="annottext">Coercion
</span><a href="#local-6989586621681034512"><span class="hs-identifier hs-var">co</span></a></span><span>
</span><span id="line-1277"></span><span>
</span><span id="line-1278"></span><span class="annot"><a href="GHC.Core.Coercion.html#mkSubCo"><span class="hs-identifier hs-type">mkSubCo</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><a href="GHC.Utils.Misc.html#HasDebugCallStack"><span class="hs-identifier hs-type">HasDebugCallStack</span></a></span><span> </span><span class="hs-glyph">=&gt;</span><span> </span><span class="annot"><a href="GHC.Core.TyCo.Rep.html#Coercion"><span class="hs-identifier hs-type">Coercion</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="GHC.Core.TyCo.Rep.html#Coercion"><span class="hs-identifier hs-type">Coercion</span></a></span><span>
</span><span id="line-1279"></span><span class="hs-comment">-- Input coercion is Nominal, result is Representational</span><span>
</span><span id="line-1280"></span><span class="hs-comment">-- see also Note [Role twiddling functions]</span><span>
</span><span id="line-1281"></span><span id="mkSubCo"><span class="annot"><span class="annottext">mkSubCo :: HasDebugCallStack =&gt; Coercion -&gt; Coercion
</span><a href="GHC.Core.Coercion.html#mkSubCo"><span class="hs-identifier hs-var hs-var">mkSubCo</span></a></span></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="GHC.Core.TyCo.Rep.html#Refl"><span class="hs-identifier hs-type">Refl</span></a></span><span> </span><span id="local-6989586621681034500"><span class="annot"><span class="annottext">Type
</span><a href="#local-6989586621681034500"><span class="hs-identifier hs-var">ty</span></a></span></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">Role -&gt; Type -&gt; MCoercion -&gt; Coercion
</span><a href="GHC.Core.TyCo.Rep.html#GRefl"><span class="hs-identifier hs-var">GRefl</span></a></span><span> </span><span class="annot"><span class="annottext">Role
</span><a href="GHC.Core.Coercion.Axiom.html#Representational"><span class="hs-identifier hs-var">Representational</span></a></span><span> </span><span class="annot"><span class="annottext">Type
</span><a href="#local-6989586621681034500"><span class="hs-identifier hs-var">ty</span></a></span><span> </span><span class="annot"><span class="annottext">MCoercion
</span><a href="GHC.Core.TyCo.Rep.html#MRefl"><span class="hs-identifier hs-var">MRefl</span></a></span><span>
</span><span id="line-1282"></span><span class="annot"><a href="GHC.Core.Coercion.html#mkSubCo"><span class="hs-identifier hs-var">mkSubCo</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="GHC.Core.TyCo.Rep.html#GRefl"><span class="hs-identifier hs-type">GRefl</span></a></span><span> </span><span class="annot"><span class="annottext">Role
</span><a href="GHC.Core.Coercion.Axiom.html#Nominal"><span class="hs-identifier hs-var">Nominal</span></a></span><span> </span><span id="local-6989586621681034499"><span class="annot"><span class="annottext">Type
</span><a href="#local-6989586621681034499"><span class="hs-identifier hs-var">ty</span></a></span></span><span> </span><span id="local-6989586621681034498"><span class="annot"><span class="annottext">MCoercion
</span><a href="#local-6989586621681034498"><span class="hs-identifier hs-var">co</span></a></span></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">Role -&gt; Type -&gt; MCoercion -&gt; Coercion
</span><a href="GHC.Core.TyCo.Rep.html#GRefl"><span class="hs-identifier hs-var">GRefl</span></a></span><span> </span><span class="annot"><span class="annottext">Role
</span><a href="GHC.Core.Coercion.Axiom.html#Representational"><span class="hs-identifier hs-var">Representational</span></a></span><span> </span><span class="annot"><span class="annottext">Type
</span><a href="#local-6989586621681034499"><span class="hs-identifier hs-var">ty</span></a></span><span> </span><span class="annot"><span class="annottext">MCoercion
</span><a href="#local-6989586621681034498"><span class="hs-identifier hs-var">co</span></a></span><span>
</span><span id="line-1283"></span><span class="annot"><a href="GHC.Core.Coercion.html#mkSubCo"><span class="hs-identifier hs-var">mkSubCo</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="GHC.Core.TyCo.Rep.html#TyConAppCo"><span class="hs-identifier hs-type">TyConAppCo</span></a></span><span> </span><span class="annot"><span class="annottext">Role
</span><a href="GHC.Core.Coercion.Axiom.html#Nominal"><span class="hs-identifier hs-var">Nominal</span></a></span><span> </span><span id="local-6989586621681034497"><span class="annot"><span class="annottext">TyCon
</span><a href="#local-6989586621681034497"><span class="hs-identifier hs-var">tc</span></a></span></span><span> </span><span id="local-6989586621681034496"><span class="annot"><span class="annottext">[Coercion]
</span><a href="#local-6989586621681034496"><span class="hs-identifier hs-var">cos</span></a></span></span><span class="hs-special">)</span><span>
</span><span id="line-1284"></span><span>  </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">Role -&gt; TyCon -&gt; [Coercion] -&gt; Coercion
</span><a href="GHC.Core.TyCo.Rep.html#TyConAppCo"><span class="hs-identifier hs-var">TyConAppCo</span></a></span><span> </span><span class="annot"><span class="annottext">Role
</span><a href="GHC.Core.Coercion.Axiom.html#Representational"><span class="hs-identifier hs-var">Representational</span></a></span><span> </span><span class="annot"><span class="annottext">TyCon
</span><a href="#local-6989586621681034497"><span class="hs-identifier hs-var">tc</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">TyCon -&gt; [Coercion] -&gt; [Coercion]
</span><a href="GHC.Core.Coercion.html#applyRoles"><span class="hs-identifier hs-var">applyRoles</span></a></span><span> </span><span class="annot"><span class="annottext">TyCon
</span><a href="#local-6989586621681034497"><span class="hs-identifier hs-var">tc</span></a></span><span> </span><span class="annot"><span class="annottext">[Coercion]
</span><a href="#local-6989586621681034496"><span class="hs-identifier hs-var">cos</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-1285"></span><span class="annot"><a href="GHC.Core.Coercion.html#mkSubCo"><span class="hs-identifier hs-var">mkSubCo</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="GHC.Core.TyCo.Rep.html#FunCo"><span class="hs-identifier hs-type">FunCo</span></a></span><span> </span><span class="annot"><span class="annottext">Role
</span><a href="GHC.Core.Coercion.Axiom.html#Nominal"><span class="hs-identifier hs-var">Nominal</span></a></span><span> </span><span id="local-6989586621681034494"><span class="annot"><span class="annottext">Coercion
</span><a href="#local-6989586621681034494"><span class="hs-identifier hs-var">w</span></a></span></span><span> </span><span id="local-6989586621681034493"><span class="annot"><span class="annottext">Coercion
</span><a href="#local-6989586621681034493"><span class="hs-identifier hs-var">arg</span></a></span></span><span> </span><span id="local-6989586621681034492"><span class="annot"><span class="annottext">Coercion
</span><a href="#local-6989586621681034492"><span class="hs-identifier hs-var">res</span></a></span></span><span class="hs-special">)</span><span>
</span><span id="line-1286"></span><span>  </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">Role -&gt; Coercion -&gt; Coercion -&gt; Coercion -&gt; Coercion
</span><a href="GHC.Core.TyCo.Rep.html#FunCo"><span class="hs-identifier hs-var">FunCo</span></a></span><span> </span><span class="annot"><span class="annottext">Role
</span><a href="GHC.Core.Coercion.Axiom.html#Representational"><span class="hs-identifier hs-var">Representational</span></a></span><span> </span><span class="annot"><span class="annottext">Coercion
</span><a href="#local-6989586621681034494"><span class="hs-identifier hs-var">w</span></a></span><span>
</span><span id="line-1287"></span><span>          </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Role -&gt; Role -&gt; Coercion -&gt; Coercion
</span><a href="GHC.Core.Coercion.html#downgradeRole"><span class="hs-identifier hs-var">downgradeRole</span></a></span><span> </span><span class="annot"><span class="annottext">Role
</span><a href="GHC.Core.Coercion.Axiom.html#Representational"><span class="hs-identifier hs-var">Representational</span></a></span><span> </span><span class="annot"><span class="annottext">Role
</span><a href="GHC.Core.Coercion.Axiom.html#Nominal"><span class="hs-identifier hs-var">Nominal</span></a></span><span> </span><span class="annot"><span class="annottext">Coercion
</span><a href="#local-6989586621681034493"><span class="hs-identifier hs-var">arg</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-1288"></span><span>          </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Role -&gt; Role -&gt; Coercion -&gt; Coercion
</span><a href="GHC.Core.Coercion.html#downgradeRole"><span class="hs-identifier hs-var">downgradeRole</span></a></span><span> </span><span class="annot"><span class="annottext">Role
</span><a href="GHC.Core.Coercion.Axiom.html#Representational"><span class="hs-identifier hs-var">Representational</span></a></span><span> </span><span class="annot"><span class="annottext">Role
</span><a href="GHC.Core.Coercion.Axiom.html#Nominal"><span class="hs-identifier hs-var">Nominal</span></a></span><span> </span><span class="annot"><span class="annottext">Coercion
</span><a href="#local-6989586621681034492"><span class="hs-identifier hs-var">res</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-1289"></span><span class="annot"><a href="GHC.Core.Coercion.html#mkSubCo"><span class="hs-identifier hs-var">mkSubCo</span></a></span><span> </span><span id="local-6989586621681034491"><span class="annot"><span class="annottext">Coercion
</span><a href="#local-6989586621681034491"><span class="hs-identifier hs-var">co</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-identifier">ASSERT2</span><span class="hs-special">(</span><span> </span><span class="hs-identifier">coercionRole</span><span> </span><span class="hs-identifier">co</span><span> </span><span class="hs-operator">==</span><span> </span><span class="hs-identifier">Nominal</span><span class="hs-special">,</span><span> </span><span class="hs-identifier">ppr</span><span> </span><span class="hs-identifier">co</span><span> </span><span class="hs-operator">&lt;+&gt;</span><span> </span><span class="hs-identifier">ppr</span><span> </span><span class="hs-special">(</span><span class="hs-identifier">coercionRole</span><span> </span><span class="hs-identifier">co</span><span class="hs-special">)</span><span> </span><span class="hs-special">)</span><span>
</span><span id="line-1290"></span><span>             </span><span class="annot"><span class="annottext">Coercion -&gt; Coercion
</span><a href="GHC.Core.TyCo.Rep.html#SubCo"><span class="hs-identifier hs-var">SubCo</span></a></span><span> </span><span class="annot"><span class="annottext">Coercion
</span><a href="#local-6989586621681034491"><span class="hs-identifier hs-var">co</span></a></span><span>
</span><span id="line-1291"></span><span>
</span><span id="line-1292"></span><span class="hs-comment">-- | Changes a role, but only a downgrade. See Note [Role twiddling functions]</span><span>
</span><span id="line-1293"></span><span class="annot"><a href="GHC.Core.Coercion.html#downgradeRole_maybe"><span class="hs-identifier hs-type">downgradeRole_maybe</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><a href="GHC.Core.Coercion.Axiom.html#Role"><span class="hs-identifier hs-type">Role</span></a></span><span>   </span><span class="hs-comment">-- ^ desired role</span><span>
</span><span id="line-1294"></span><span>                    </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="GHC.Core.Coercion.Axiom.html#Role"><span class="hs-identifier hs-type">Role</span></a></span><span>   </span><span class="hs-comment">-- ^ current role</span><span>
</span><span id="line-1295"></span><span>                    </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="GHC.Core.TyCo.Rep.html#Coercion"><span class="hs-identifier hs-type">Coercion</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="../../base-4.16.4.0/src/GHC-Maybe.html#Maybe"><span class="hs-identifier hs-type">Maybe</span></a></span><span> </span><span class="annot"><a href="GHC.Core.TyCo.Rep.html#Coercion"><span class="hs-identifier hs-type">Coercion</span></a></span><span>
</span><span id="line-1296"></span><span class="hs-comment">-- In (downgradeRole_maybe dr cr co) it's a precondition that</span><span>
</span><span id="line-1297"></span><span class="hs-comment">--                                   cr = coercionRole co</span><span>
</span><span id="line-1298"></span><span>
</span><span id="line-1299"></span><span id="downgradeRole_maybe"><span class="annot"><span class="annottext">downgradeRole_maybe :: Role -&gt; Role -&gt; Coercion -&gt; Maybe Coercion
</span><a href="GHC.Core.Coercion.html#downgradeRole_maybe"><span class="hs-identifier hs-var hs-var">downgradeRole_maybe</span></a></span></span><span> </span><span class="annot"><span class="annottext">Role
</span><a href="GHC.Core.Coercion.Axiom.html#Nominal"><span class="hs-identifier hs-var">Nominal</span></a></span><span>          </span><span class="annot"><span class="annottext">Role
</span><a href="GHC.Core.Coercion.Axiom.html#Nominal"><span class="hs-identifier hs-var">Nominal</span></a></span><span>          </span><span id="local-6989586621681034489"><span class="annot"><span class="annottext">Coercion
</span><a href="#local-6989586621681034489"><span class="hs-identifier hs-var">co</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">forall a. a -&gt; Maybe a
</span><a href="../../base-4.16.4.0/src/GHC-Maybe.html#Just"><span class="hs-identifier hs-var">Just</span></a></span><span> </span><span class="annot"><span class="annottext">Coercion
</span><a href="#local-6989586621681034489"><span class="hs-identifier hs-var">co</span></a></span><span>
</span><span id="line-1300"></span><span class="annot"><a href="GHC.Core.Coercion.html#downgradeRole_maybe"><span class="hs-identifier hs-var">downgradeRole_maybe</span></a></span><span> </span><span class="annot"><span class="annottext">Role
</span><a href="GHC.Core.Coercion.Axiom.html#Nominal"><span class="hs-identifier hs-var">Nominal</span></a></span><span>          </span><span class="annot"><span class="annottext">Role
</span><span class="hs-identifier">_</span></span><span>                </span><span class="annot"><span class="annottext">Coercion
</span><span class="hs-identifier">_</span></span><span>  </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">forall a. Maybe a
</span><a href="../../base-4.16.4.0/src/GHC-Maybe.html#Nothing"><span class="hs-identifier hs-var">Nothing</span></a></span><span>
</span><span id="line-1301"></span><span>
</span><span id="line-1302"></span><span class="annot"><a href="GHC.Core.Coercion.html#downgradeRole_maybe"><span class="hs-identifier hs-var">downgradeRole_maybe</span></a></span><span> </span><span class="annot"><span class="annottext">Role
</span><a href="GHC.Core.Coercion.Axiom.html#Representational"><span class="hs-identifier hs-var">Representational</span></a></span><span> </span><span class="annot"><span class="annottext">Role
</span><a href="GHC.Core.Coercion.Axiom.html#Nominal"><span class="hs-identifier hs-var">Nominal</span></a></span><span>          </span><span id="local-6989586621681034488"><span class="annot"><span class="annottext">Coercion
</span><a href="#local-6989586621681034488"><span class="hs-identifier hs-var">co</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">forall a. a -&gt; Maybe a
</span><a href="../../base-4.16.4.0/src/GHC-Maybe.html#Just"><span class="hs-identifier hs-var">Just</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">HasDebugCallStack =&gt; Coercion -&gt; Coercion
</span><a href="GHC.Core.Coercion.html#mkSubCo"><span class="hs-identifier hs-var">mkSubCo</span></a></span><span> </span><span class="annot"><span class="annottext">Coercion
</span><a href="#local-6989586621681034488"><span class="hs-identifier hs-var">co</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-1303"></span><span class="annot"><a href="GHC.Core.Coercion.html#downgradeRole_maybe"><span class="hs-identifier hs-var">downgradeRole_maybe</span></a></span><span> </span><span class="annot"><span class="annottext">Role
</span><a href="GHC.Core.Coercion.Axiom.html#Representational"><span class="hs-identifier hs-var">Representational</span></a></span><span> </span><span class="annot"><span class="annottext">Role
</span><a href="GHC.Core.Coercion.Axiom.html#Representational"><span class="hs-identifier hs-var">Representational</span></a></span><span> </span><span id="local-6989586621681034487"><span class="annot"><span class="annottext">Coercion
</span><a href="#local-6989586621681034487"><span class="hs-identifier hs-var">co</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">forall a. a -&gt; Maybe a
</span><a href="../../base-4.16.4.0/src/GHC-Maybe.html#Just"><span class="hs-identifier hs-var">Just</span></a></span><span> </span><span class="annot"><span class="annottext">Coercion
</span><a href="#local-6989586621681034487"><span class="hs-identifier hs-var">co</span></a></span><span>
</span><span id="line-1304"></span><span class="annot"><a href="GHC.Core.Coercion.html#downgradeRole_maybe"><span class="hs-identifier hs-var">downgradeRole_maybe</span></a></span><span> </span><span class="annot"><span class="annottext">Role
</span><a href="GHC.Core.Coercion.Axiom.html#Representational"><span class="hs-identifier hs-var">Representational</span></a></span><span> </span><span class="annot"><span class="annottext">Role
</span><a href="GHC.Core.Coercion.Axiom.html#Phantom"><span class="hs-identifier hs-var">Phantom</span></a></span><span>          </span><span class="annot"><span class="annottext">Coercion
</span><span class="hs-identifier">_</span></span><span>  </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">forall a. Maybe a
</span><a href="../../base-4.16.4.0/src/GHC-Maybe.html#Nothing"><span class="hs-identifier hs-var">Nothing</span></a></span><span>
</span><span id="line-1305"></span><span>
</span><span id="line-1306"></span><span class="annot"><a href="GHC.Core.Coercion.html#downgradeRole_maybe"><span class="hs-identifier hs-var">downgradeRole_maybe</span></a></span><span> </span><span class="annot"><span class="annottext">Role
</span><a href="GHC.Core.Coercion.Axiom.html#Phantom"><span class="hs-identifier hs-var">Phantom</span></a></span><span>          </span><span class="annot"><span class="annottext">Role
</span><a href="GHC.Core.Coercion.Axiom.html#Phantom"><span class="hs-identifier hs-var">Phantom</span></a></span><span>          </span><span id="local-6989586621681034486"><span class="annot"><span class="annottext">Coercion
</span><a href="#local-6989586621681034486"><span class="hs-identifier hs-var">co</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">forall a. a -&gt; Maybe a
</span><a href="../../base-4.16.4.0/src/GHC-Maybe.html#Just"><span class="hs-identifier hs-var">Just</span></a></span><span> </span><span class="annot"><span class="annottext">Coercion
</span><a href="#local-6989586621681034486"><span class="hs-identifier hs-var">co</span></a></span><span>
</span><span id="line-1307"></span><span class="annot"><a href="GHC.Core.Coercion.html#downgradeRole_maybe"><span class="hs-identifier hs-var">downgradeRole_maybe</span></a></span><span> </span><span class="annot"><span class="annottext">Role
</span><a href="GHC.Core.Coercion.Axiom.html#Phantom"><span class="hs-identifier hs-var">Phantom</span></a></span><span>          </span><span class="annot"><span class="annottext">Role
</span><span class="hs-identifier">_</span></span><span>                </span><span id="local-6989586621681034485"><span class="annot"><span class="annottext">Coercion
</span><a href="#local-6989586621681034485"><span class="hs-identifier hs-var">co</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">forall a. a -&gt; Maybe a
</span><a href="../../base-4.16.4.0/src/GHC-Maybe.html#Just"><span class="hs-identifier hs-var">Just</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Coercion -&gt; Coercion
</span><a href="GHC.Core.Coercion.html#toPhantomCo"><span class="hs-identifier hs-var">toPhantomCo</span></a></span><span> </span><span class="annot"><span class="annottext">Coercion
</span><a href="#local-6989586621681034485"><span class="hs-identifier hs-var">co</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-1308"></span><span>
</span><span id="line-1309"></span><span class="hs-comment">-- | Like 'downgradeRole_maybe', but panics if the change isn't a downgrade.</span><span>
</span><span id="line-1310"></span><span class="hs-comment">-- See Note [Role twiddling functions]</span><span>
</span><span id="line-1311"></span><span class="annot"><a href="GHC.Core.Coercion.html#downgradeRole"><span class="hs-identifier hs-type">downgradeRole</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><a href="GHC.Core.Coercion.Axiom.html#Role"><span class="hs-identifier hs-type">Role</span></a></span><span>  </span><span class="hs-comment">-- desired role</span><span>
</span><span id="line-1312"></span><span>              </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="GHC.Core.Coercion.Axiom.html#Role"><span class="hs-identifier hs-type">Role</span></a></span><span>  </span><span class="hs-comment">-- current role</span><span>
</span><span id="line-1313"></span><span>              </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="GHC.Core.TyCo.Rep.html#Coercion"><span class="hs-identifier hs-type">Coercion</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="GHC.Core.TyCo.Rep.html#Coercion"><span class="hs-identifier hs-type">Coercion</span></a></span><span>
</span><span id="line-1314"></span><span id="downgradeRole"><span class="annot"><span class="annottext">downgradeRole :: Role -&gt; Role -&gt; Coercion -&gt; Coercion
</span><a href="GHC.Core.Coercion.html#downgradeRole"><span class="hs-identifier hs-var hs-var">downgradeRole</span></a></span></span><span> </span><span id="local-6989586621681034484"><span class="annot"><span class="annottext">Role
</span><a href="#local-6989586621681034484"><span class="hs-identifier hs-var">r1</span></a></span></span><span> </span><span id="local-6989586621681034483"><span class="annot"><span class="annottext">Role
</span><a href="#local-6989586621681034483"><span class="hs-identifier hs-var">r2</span></a></span></span><span> </span><span id="local-6989586621681034482"><span class="annot"><span class="annottext">Coercion
</span><a href="#local-6989586621681034482"><span class="hs-identifier hs-var">co</span></a></span></span><span>
</span><span id="line-1315"></span><span>  </span><span class="hs-glyph">=</span><span> </span><span class="hs-keyword">case</span><span> </span><span class="annot"><span class="annottext">Role -&gt; Role -&gt; Coercion -&gt; Maybe Coercion
</span><a href="GHC.Core.Coercion.html#downgradeRole_maybe"><span class="hs-identifier hs-var">downgradeRole_maybe</span></a></span><span> </span><span class="annot"><span class="annottext">Role
</span><a href="#local-6989586621681034484"><span class="hs-identifier hs-var">r1</span></a></span><span> </span><span class="annot"><span class="annottext">Role
</span><a href="#local-6989586621681034483"><span class="hs-identifier hs-var">r2</span></a></span><span> </span><span class="annot"><span class="annottext">Coercion
</span><a href="#local-6989586621681034482"><span class="hs-identifier hs-var">co</span></a></span><span> </span><span class="hs-keyword">of</span><span>
</span><span id="line-1316"></span><span>      </span><span class="annot"><a href="../../base-4.16.4.0/src/GHC-Maybe.html#Just"><span class="hs-identifier hs-type">Just</span></a></span><span> </span><span id="local-6989586621681034481"><span class="annot"><span class="annottext">Coercion
</span><a href="#local-6989586621681034481"><span class="hs-identifier hs-var">co'</span></a></span></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="annottext">Coercion
</span><a href="#local-6989586621681034481"><span class="hs-identifier hs-var">co'</span></a></span><span>
</span><span id="line-1317"></span><span>      </span><span class="annot"><span class="annottext">Maybe Coercion
</span><a href="../../base-4.16.4.0/src/GHC-Maybe.html#Nothing"><span class="hs-identifier hs-var">Nothing</span></a></span><span>  </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="annottext">forall a. HasCallStack =&gt; String -&gt; SDoc -&gt; a
</span><a href="GHC.Utils.Panic.html#pprPanic"><span class="hs-identifier hs-var">pprPanic</span></a></span><span> </span><span class="annot"><span class="annottext">String
</span><span class="hs-string">&quot;downgradeRole&quot;</span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">forall a. Outputable a =&gt; a -&gt; SDoc
</span><a href="GHC.Utils.Outputable.html#ppr"><span class="hs-identifier hs-var">ppr</span></a></span><span> </span><span class="annot"><span class="annottext">Coercion
</span><a href="#local-6989586621681034482"><span class="hs-identifier hs-var">co</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-1318"></span><span>
</span><span id="line-1319"></span><span class="annot"><a href="GHC.Core.Coercion.html#mkAxiomRuleCo"><span class="hs-identifier hs-type">mkAxiomRuleCo</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><a href="GHC.Core.Coercion.Axiom.html#CoAxiomRule"><span class="hs-identifier hs-type">CoAxiomRule</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-special">[</span><span class="annot"><a href="GHC.Core.TyCo.Rep.html#Coercion"><span class="hs-identifier hs-type">Coercion</span></a></span><span class="hs-special">]</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="GHC.Core.TyCo.Rep.html#Coercion"><span class="hs-identifier hs-type">Coercion</span></a></span><span>
</span><span id="line-1320"></span><span id="mkAxiomRuleCo"><span class="annot"><span class="annottext">mkAxiomRuleCo :: CoAxiomRule -&gt; [Coercion] -&gt; Coercion
</span><a href="GHC.Core.Coercion.html#mkAxiomRuleCo"><span class="hs-identifier hs-var hs-var">mkAxiomRuleCo</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">CoAxiomRule -&gt; [Coercion] -&gt; Coercion
</span><a href="GHC.Core.TyCo.Rep.html#AxiomRuleCo"><span class="hs-identifier hs-var">AxiomRuleCo</span></a></span><span>
</span><span id="line-1321"></span><span>
</span><span id="line-1322"></span><span class="hs-comment">-- | Make a &quot;coercion between coercions&quot;.</span><span>
</span><span id="line-1323"></span><span class="annot"><a href="GHC.Core.Coercion.html#mkProofIrrelCo"><span class="hs-identifier hs-type">mkProofIrrelCo</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><a href="GHC.Core.Coercion.Axiom.html#Role"><span class="hs-identifier hs-type">Role</span></a></span><span>       </span><span class="hs-comment">-- ^ role of the created coercion, &quot;r&quot;</span><span>
</span><span id="line-1324"></span><span>               </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="GHC.Core.TyCo.Rep.html#Coercion"><span class="hs-identifier hs-type">Coercion</span></a></span><span>   </span><span class="hs-comment">-- ^ :: phi1 ~N phi2</span><span>
</span><span id="line-1325"></span><span>               </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="GHC.Core.TyCo.Rep.html#Coercion"><span class="hs-identifier hs-type">Coercion</span></a></span><span>   </span><span class="hs-comment">-- ^ g1 :: phi1</span><span>
</span><span id="line-1326"></span><span>               </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="GHC.Core.TyCo.Rep.html#Coercion"><span class="hs-identifier hs-type">Coercion</span></a></span><span>   </span><span class="hs-comment">-- ^ g2 :: phi2</span><span>
</span><span id="line-1327"></span><span>               </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="GHC.Core.TyCo.Rep.html#Coercion"><span class="hs-identifier hs-type">Coercion</span></a></span><span>   </span><span class="hs-comment">-- ^ :: g1 ~r g2</span><span>
</span><span id="line-1328"></span><span>
</span><span id="line-1329"></span><span class="hs-comment">-- if the two coercion prove the same fact, I just don't care what</span><span>
</span><span id="line-1330"></span><span class="hs-comment">-- the individual coercions are.</span><span>
</span><span id="line-1331"></span><span id="mkProofIrrelCo"><span class="annot"><span class="annottext">mkProofIrrelCo :: Role -&gt; Coercion -&gt; Coercion -&gt; Coercion -&gt; Coercion
</span><a href="GHC.Core.Coercion.html#mkProofIrrelCo"><span class="hs-identifier hs-var hs-var">mkProofIrrelCo</span></a></span></span><span> </span><span id="local-6989586621681034479"><span class="annot"><span class="annottext">Role
</span><a href="#local-6989586621681034479"><span class="hs-identifier hs-var">r</span></a></span></span><span> </span><span id="local-6989586621681034478"><span class="annot"><span class="annottext">Coercion
</span><a href="#local-6989586621681034478"><span class="hs-identifier hs-var">co</span></a></span></span><span> </span><span id="local-6989586621681034477"><span class="annot"><span class="annottext">Coercion
</span><a href="#local-6989586621681034477"><span class="hs-identifier hs-var">g</span></a></span></span><span>  </span><span class="annot"><span class="annottext">Coercion
</span><span class="hs-identifier">_</span></span><span> </span><span class="hs-glyph">|</span><span> </span><span class="annot"><span class="annottext">Coercion -&gt; Bool
</span><a href="GHC.Core.Coercion.html#isGReflCo"><span class="hs-identifier hs-var">isGReflCo</span></a></span><span> </span><span class="annot"><span class="annottext">Coercion
</span><a href="#local-6989586621681034478"><span class="hs-identifier hs-var">co</span></a></span><span>  </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">Role -&gt; Type -&gt; Coercion
</span><a href="GHC.Core.Coercion.html#mkReflCo"><span class="hs-identifier hs-var">mkReflCo</span></a></span><span> </span><span class="annot"><span class="annottext">Role
</span><a href="#local-6989586621681034479"><span class="hs-identifier hs-var">r</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Coercion -&gt; Type
</span><a href="GHC.Core.Type.html#mkCoercionTy"><span class="hs-identifier hs-var">mkCoercionTy</span></a></span><span> </span><span class="annot"><span class="annottext">Coercion
</span><a href="#local-6989586621681034477"><span class="hs-identifier hs-var">g</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-1332"></span><span>  </span><span class="hs-comment">-- kco is a kind coercion, thus @isGReflCo@ rather than @isReflCo@</span><span>
</span><span id="line-1333"></span><span class="annot"><a href="GHC.Core.Coercion.html#mkProofIrrelCo"><span class="hs-identifier hs-var">mkProofIrrelCo</span></a></span><span> </span><span id="local-6989586621681034475"><span class="annot"><span class="annottext">Role
</span><a href="#local-6989586621681034475"><span class="hs-identifier hs-var">r</span></a></span></span><span> </span><span id="local-6989586621681034474"><span class="annot"><span class="annottext">Coercion
</span><a href="#local-6989586621681034474"><span class="hs-identifier hs-var">kco</span></a></span></span><span>        </span><span id="local-6989586621681034473"><span class="annot"><span class="annottext">Coercion
</span><a href="#local-6989586621681034473"><span class="hs-identifier hs-var">g1</span></a></span></span><span> </span><span id="local-6989586621681034472"><span class="annot"><span class="annottext">Coercion
</span><a href="#local-6989586621681034472"><span class="hs-identifier hs-var">g2</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">UnivCoProvenance -&gt; Role -&gt; Type -&gt; Type -&gt; Coercion
</span><a href="GHC.Core.Coercion.html#mkUnivCo"><span class="hs-identifier hs-var">mkUnivCo</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Coercion -&gt; UnivCoProvenance
</span><a href="GHC.Core.TyCo.Rep.html#ProofIrrelProv"><span class="hs-identifier hs-var">ProofIrrelProv</span></a></span><span> </span><span class="annot"><span class="annottext">Coercion
</span><a href="#local-6989586621681034474"><span class="hs-identifier hs-var">kco</span></a></span><span class="hs-special">)</span><span> </span><span class="annot"><span class="annottext">Role
</span><a href="#local-6989586621681034475"><span class="hs-identifier hs-var">r</span></a></span><span>
</span><span id="line-1334"></span><span>                                             </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Coercion -&gt; Type
</span><a href="GHC.Core.Type.html#mkCoercionTy"><span class="hs-identifier hs-var">mkCoercionTy</span></a></span><span> </span><span class="annot"><span class="annottext">Coercion
</span><a href="#local-6989586621681034473"><span class="hs-identifier hs-var">g1</span></a></span><span class="hs-special">)</span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Coercion -&gt; Type
</span><a href="GHC.Core.Type.html#mkCoercionTy"><span class="hs-identifier hs-var">mkCoercionTy</span></a></span><span> </span><span class="annot"><span class="annottext">Coercion
</span><a href="#local-6989586621681034472"><span class="hs-identifier hs-var">g2</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-1335"></span><span>
</span><span id="line-1336"></span><span class="hs-comment">{-
%************************************************************************
%*                                                                      *
   Roles
%*                                                                      *
%************************************************************************
-}</span><span>
</span><span id="line-1343"></span><span>
</span><span id="line-1344"></span><span class="hs-comment">-- | Converts a coercion to be nominal, if possible.</span><span>
</span><span id="line-1345"></span><span class="hs-comment">-- See Note [Role twiddling functions]</span><span>
</span><span id="line-1346"></span><span class="annot"><a href="GHC.Core.Coercion.html#setNominalRole_maybe"><span class="hs-identifier hs-type">setNominalRole_maybe</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><a href="GHC.Core.Coercion.Axiom.html#Role"><span class="hs-identifier hs-type">Role</span></a></span><span> </span><span class="hs-comment">-- of input coercion</span><span>
</span><span id="line-1347"></span><span>                     </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="GHC.Core.TyCo.Rep.html#Coercion"><span class="hs-identifier hs-type">Coercion</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="../../base-4.16.4.0/src/GHC-Maybe.html#Maybe"><span class="hs-identifier hs-type">Maybe</span></a></span><span> </span><span class="annot"><a href="GHC.Core.TyCo.Rep.html#Coercion"><span class="hs-identifier hs-type">Coercion</span></a></span><span>
</span><span id="line-1348"></span><span id="setNominalRole_maybe"><span class="annot"><span class="annottext">setNominalRole_maybe :: Role -&gt; Coercion -&gt; Maybe Coercion
</span><a href="GHC.Core.Coercion.html#setNominalRole_maybe"><span class="hs-identifier hs-var hs-var">setNominalRole_maybe</span></a></span></span><span> </span><span id="local-6989586621681034471"><span class="annot"><span class="annottext">Role
</span><a href="#local-6989586621681034471"><span class="hs-identifier hs-var">r</span></a></span></span><span> </span><span id="local-6989586621681034470"><span class="annot"><span class="annottext">Coercion
</span><a href="#local-6989586621681034470"><span class="hs-identifier hs-var">co</span></a></span></span><span>
</span><span id="line-1349"></span><span>  </span><span class="hs-glyph">|</span><span> </span><span class="annot"><span class="annottext">Role
</span><a href="#local-6989586621681034471"><span class="hs-identifier hs-var">r</span></a></span><span> </span><span class="annot"><span class="annottext">forall a. Eq a =&gt; a -&gt; a -&gt; Bool
</span><span class="hs-operator hs-var">==</span></span><span> </span><span class="annot"><span class="annottext">Role
</span><a href="GHC.Core.Coercion.Axiom.html#Nominal"><span class="hs-identifier hs-var">Nominal</span></a></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">forall a. a -&gt; Maybe a
</span><a href="../../base-4.16.4.0/src/GHC-Maybe.html#Just"><span class="hs-identifier hs-var">Just</span></a></span><span> </span><span class="annot"><span class="annottext">Coercion
</span><a href="#local-6989586621681034470"><span class="hs-identifier hs-var">co</span></a></span><span>
</span><span id="line-1350"></span><span>  </span><span class="hs-glyph">|</span><span> </span><span class="annot"><span class="annottext">Bool
</span><a href="../../base-4.16.4.0/src/GHC-Base.html#otherwise"><span class="hs-identifier hs-var">otherwise</span></a></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">Coercion -&gt; Maybe Coercion
</span><a href="#local-6989586621681034469"><span class="hs-identifier hs-var">setNominalRole_maybe_helper</span></a></span><span> </span><span class="annot"><span class="annottext">Coercion
</span><a href="#local-6989586621681034470"><span class="hs-identifier hs-var">co</span></a></span><span>
</span><span id="line-1351"></span><span>  </span><span class="hs-keyword">where</span><span>
</span><span id="line-1352"></span><span>    </span><span id="local-6989586621681034469"><span class="annot"><span class="annottext">setNominalRole_maybe_helper :: Coercion -&gt; Maybe Coercion
</span><a href="#local-6989586621681034469"><span class="hs-identifier hs-var hs-var">setNominalRole_maybe_helper</span></a></span></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="GHC.Core.TyCo.Rep.html#SubCo"><span class="hs-identifier hs-type">SubCo</span></a></span><span> </span><span id="local-6989586621681034451"><span class="annot"><span class="annottext">Coercion
</span><a href="#local-6989586621681034451"><span class="hs-identifier hs-var">co</span></a></span></span><span class="hs-special">)</span><span>  </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">forall a. a -&gt; Maybe a
</span><a href="../../base-4.16.4.0/src/GHC-Maybe.html#Just"><span class="hs-identifier hs-var">Just</span></a></span><span> </span><span class="annot"><span class="annottext">Coercion
</span><a href="#local-6989586621681034451"><span class="hs-identifier hs-var">co</span></a></span><span>
</span><span id="line-1353"></span><span>    </span><span class="annot"><a href="#local-6989586621681034469"><span class="hs-identifier hs-var">setNominalRole_maybe_helper</span></a></span><span> </span><span id="local-6989586621681034450"><span class="annot"><span class="annottext">co :: Coercion
</span><a href="#local-6989586621681034450"><span class="hs-identifier hs-var">co</span></a></span></span><span class="hs-glyph">@</span><span class="hs-special">(</span><span class="annot"><a href="GHC.Core.TyCo.Rep.html#Refl"><span class="hs-identifier hs-type">Refl</span></a></span><span> </span><span class="annot"><span class="annottext">Type
</span><span class="hs-identifier">_</span></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">forall a. a -&gt; Maybe a
</span><a href="../../base-4.16.4.0/src/GHC-Maybe.html#Just"><span class="hs-identifier hs-var">Just</span></a></span><span> </span><span class="annot"><span class="annottext">Coercion
</span><a href="#local-6989586621681034450"><span class="hs-identifier hs-var">co</span></a></span><span>
</span><span id="line-1354"></span><span>    </span><span class="annot"><a href="#local-6989586621681034469"><span class="hs-identifier hs-var">setNominalRole_maybe_helper</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="GHC.Core.TyCo.Rep.html#GRefl"><span class="hs-identifier hs-type">GRefl</span></a></span><span> </span><span class="annot"><span class="annottext">Role
</span><span class="hs-identifier">_</span></span><span> </span><span id="local-6989586621681034449"><span class="annot"><span class="annottext">Type
</span><a href="#local-6989586621681034449"><span class="hs-identifier hs-var">ty</span></a></span></span><span> </span><span id="local-6989586621681034448"><span class="annot"><span class="annottext">MCoercion
</span><a href="#local-6989586621681034448"><span class="hs-identifier hs-var">co</span></a></span></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">forall a. a -&gt; Maybe a
</span><a href="../../base-4.16.4.0/src/GHC-Maybe.html#Just"><span class="hs-identifier hs-var">Just</span></a></span><span> </span><span class="annot"><span class="annottext">forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><a href="../../base-4.16.4.0/src/GHC-Base.html#%24"><span class="hs-operator hs-var">$</span></a></span><span> </span><span class="annot"><span class="annottext">Role -&gt; Type -&gt; MCoercion -&gt; Coercion
</span><a href="GHC.Core.TyCo.Rep.html#GRefl"><span class="hs-identifier hs-var">GRefl</span></a></span><span> </span><span class="annot"><span class="annottext">Role
</span><a href="GHC.Core.Coercion.Axiom.html#Nominal"><span class="hs-identifier hs-var">Nominal</span></a></span><span> </span><span class="annot"><span class="annottext">Type
</span><a href="#local-6989586621681034449"><span class="hs-identifier hs-var">ty</span></a></span><span> </span><span class="annot"><span class="annottext">MCoercion
</span><a href="#local-6989586621681034448"><span class="hs-identifier hs-var">co</span></a></span><span>
</span><span id="line-1355"></span><span>    </span><span class="annot"><a href="#local-6989586621681034469"><span class="hs-identifier hs-var">setNominalRole_maybe_helper</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="GHC.Core.TyCo.Rep.html#TyConAppCo"><span class="hs-identifier hs-type">TyConAppCo</span></a></span><span> </span><span class="annot"><span class="annottext">Role
</span><a href="GHC.Core.Coercion.Axiom.html#Representational"><span class="hs-identifier hs-var">Representational</span></a></span><span> </span><span id="local-6989586621681034447"><span class="annot"><span class="annottext">TyCon
</span><a href="#local-6989586621681034447"><span class="hs-identifier hs-var">tc</span></a></span></span><span> </span><span id="local-6989586621681034446"><span class="annot"><span class="annottext">[Coercion]
</span><a href="#local-6989586621681034446"><span class="hs-identifier hs-var">cos</span></a></span></span><span class="hs-special">)</span><span>
</span><span id="line-1356"></span><span>      </span><span class="hs-glyph">=</span><span> </span><span class="hs-keyword">do</span><span> </span><span class="hs-special">{</span><span> </span><span id="local-6989586621681034445"><span class="annot"><span class="annottext">[Coercion]
</span><a href="#local-6989586621681034445"><span class="hs-identifier hs-var">cos'</span></a></span></span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">forall (m :: * -&gt; *) a b c.
Applicative m =&gt;
(a -&gt; b -&gt; m c) -&gt; [a] -&gt; [b] -&gt; m [c]
</span><a href="../../base-4.16.4.0/src/Control-Monad.html#zipWithM"><span class="hs-identifier hs-var">zipWithM</span></a></span><span> </span><span class="annot"><span class="annottext">Role -&gt; Coercion -&gt; Maybe Coercion
</span><a href="GHC.Core.Coercion.html#setNominalRole_maybe"><span class="hs-identifier hs-var">setNominalRole_maybe</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Role -&gt; TyCon -&gt; [Role]
</span><a href="GHC.Core.Coercion.html#tyConRolesX"><span class="hs-identifier hs-var">tyConRolesX</span></a></span><span> </span><span class="annot"><span class="annottext">Role
</span><a href="GHC.Core.Coercion.Axiom.html#Representational"><span class="hs-identifier hs-var">Representational</span></a></span><span> </span><span class="annot"><span class="annottext">TyCon
</span><a href="#local-6989586621681034447"><span class="hs-identifier hs-var">tc</span></a></span><span class="hs-special">)</span><span> </span><span class="annot"><span class="annottext">[Coercion]
</span><a href="#local-6989586621681034446"><span class="hs-identifier hs-var">cos</span></a></span><span>
</span><span id="line-1357"></span><span>           </span><span class="hs-special">;</span><span> </span><span class="annot"><span class="annottext">forall (m :: * -&gt; *) a. Monad m =&gt; a -&gt; m a
</span><a href="../../base-4.16.4.0/src/GHC-Base.html#return"><span class="hs-identifier hs-var">return</span></a></span><span> </span><span class="annot"><span class="annottext">forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><a href="../../base-4.16.4.0/src/GHC-Base.html#%24"><span class="hs-operator hs-var">$</span></a></span><span> </span><span class="annot"><span class="annottext">Role -&gt; TyCon -&gt; [Coercion] -&gt; Coercion
</span><a href="GHC.Core.TyCo.Rep.html#TyConAppCo"><span class="hs-identifier hs-var">TyConAppCo</span></a></span><span> </span><span class="annot"><span class="annottext">Role
</span><a href="GHC.Core.Coercion.Axiom.html#Nominal"><span class="hs-identifier hs-var">Nominal</span></a></span><span> </span><span class="annot"><span class="annottext">TyCon
</span><a href="#local-6989586621681034447"><span class="hs-identifier hs-var">tc</span></a></span><span> </span><span class="annot"><span class="annottext">[Coercion]
</span><a href="#local-6989586621681034445"><span class="hs-identifier hs-var">cos'</span></a></span><span> </span><span class="hs-special">}</span><span>
</span><span id="line-1358"></span><span>    </span><span class="annot"><a href="#local-6989586621681034469"><span class="hs-identifier hs-var">setNominalRole_maybe_helper</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="GHC.Core.TyCo.Rep.html#FunCo"><span class="hs-identifier hs-type">FunCo</span></a></span><span> </span><span class="annot"><span class="annottext">Role
</span><a href="GHC.Core.Coercion.Axiom.html#Representational"><span class="hs-identifier hs-var">Representational</span></a></span><span> </span><span id="local-6989586621681034444"><span class="annot"><span class="annottext">Coercion
</span><a href="#local-6989586621681034444"><span class="hs-identifier hs-var">w</span></a></span></span><span> </span><span id="local-6989586621681034443"><span class="annot"><span class="annottext">Coercion
</span><a href="#local-6989586621681034443"><span class="hs-identifier hs-var">co1</span></a></span></span><span> </span><span id="local-6989586621681034442"><span class="annot"><span class="annottext">Coercion
</span><a href="#local-6989586621681034442"><span class="hs-identifier hs-var">co2</span></a></span></span><span class="hs-special">)</span><span>
</span><span id="line-1359"></span><span>      </span><span class="hs-glyph">=</span><span> </span><span class="hs-keyword">do</span><span> </span><span class="hs-special">{</span><span> </span><span id="local-6989586621681034441"><span class="annot"><span class="annottext">Coercion
</span><a href="#local-6989586621681034441"><span class="hs-identifier hs-var">co1'</span></a></span></span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">Role -&gt; Coercion -&gt; Maybe Coercion
</span><a href="GHC.Core.Coercion.html#setNominalRole_maybe"><span class="hs-identifier hs-var">setNominalRole_maybe</span></a></span><span> </span><span class="annot"><span class="annottext">Role
</span><a href="GHC.Core.Coercion.Axiom.html#Representational"><span class="hs-identifier hs-var">Representational</span></a></span><span> </span><span class="annot"><span class="annottext">Coercion
</span><a href="#local-6989586621681034443"><span class="hs-identifier hs-var">co1</span></a></span><span>
</span><span id="line-1360"></span><span>           </span><span class="hs-special">;</span><span> </span><span id="local-6989586621681034440"><span class="annot"><span class="annottext">Coercion
</span><a href="#local-6989586621681034440"><span class="hs-identifier hs-var">co2'</span></a></span></span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">Role -&gt; Coercion -&gt; Maybe Coercion
</span><a href="GHC.Core.Coercion.html#setNominalRole_maybe"><span class="hs-identifier hs-var">setNominalRole_maybe</span></a></span><span> </span><span class="annot"><span class="annottext">Role
</span><a href="GHC.Core.Coercion.Axiom.html#Representational"><span class="hs-identifier hs-var">Representational</span></a></span><span> </span><span class="annot"><span class="annottext">Coercion
</span><a href="#local-6989586621681034442"><span class="hs-identifier hs-var">co2</span></a></span><span>
</span><span id="line-1361"></span><span>           </span><span class="hs-special">;</span><span> </span><span class="annot"><span class="annottext">forall (m :: * -&gt; *) a. Monad m =&gt; a -&gt; m a
</span><a href="../../base-4.16.4.0/src/GHC-Base.html#return"><span class="hs-identifier hs-var">return</span></a></span><span> </span><span class="annot"><span class="annottext">forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><a href="../../base-4.16.4.0/src/GHC-Base.html#%24"><span class="hs-operator hs-var">$</span></a></span><span> </span><span class="annot"><span class="annottext">Role -&gt; Coercion -&gt; Coercion -&gt; Coercion -&gt; Coercion
</span><a href="GHC.Core.TyCo.Rep.html#FunCo"><span class="hs-identifier hs-var">FunCo</span></a></span><span> </span><span class="annot"><span class="annottext">Role
</span><a href="GHC.Core.Coercion.Axiom.html#Nominal"><span class="hs-identifier hs-var">Nominal</span></a></span><span> </span><span class="annot"><span class="annottext">Coercion
</span><a href="#local-6989586621681034444"><span class="hs-identifier hs-var">w</span></a></span><span> </span><span class="annot"><span class="annottext">Coercion
</span><a href="#local-6989586621681034441"><span class="hs-identifier hs-var">co1'</span></a></span><span> </span><span class="annot"><span class="annottext">Coercion
</span><a href="#local-6989586621681034440"><span class="hs-identifier hs-var">co2'</span></a></span><span>
</span><span id="line-1362"></span><span>           </span><span class="hs-special">}</span><span>
</span><span id="line-1363"></span><span>    </span><span class="annot"><a href="#local-6989586621681034469"><span class="hs-identifier hs-var">setNominalRole_maybe_helper</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="GHC.Core.TyCo.Rep.html#SymCo"><span class="hs-identifier hs-type">SymCo</span></a></span><span> </span><span id="local-6989586621681034439"><span class="annot"><span class="annottext">Coercion
</span><a href="#local-6989586621681034439"><span class="hs-identifier hs-var">co</span></a></span></span><span class="hs-special">)</span><span>
</span><span id="line-1364"></span><span>      </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">Coercion -&gt; Coercion
</span><a href="GHC.Core.TyCo.Rep.html#SymCo"><span class="hs-identifier hs-var">SymCo</span></a></span><span> </span><span class="annot"><span class="annottext">forall (f :: * -&gt; *) a b. Functor f =&gt; (a -&gt; b) -&gt; f a -&gt; f b
</span><a href="../../base-4.16.4.0/src/Data-Functor.html#%3C%24%3E"><span class="hs-operator hs-var">&lt;$&gt;</span></a></span><span> </span><span class="annot"><span class="annottext">Coercion -&gt; Maybe Coercion
</span><a href="#local-6989586621681034469"><span class="hs-identifier hs-var">setNominalRole_maybe_helper</span></a></span><span> </span><span class="annot"><span class="annottext">Coercion
</span><a href="#local-6989586621681034439"><span class="hs-identifier hs-var">co</span></a></span><span>
</span><span id="line-1365"></span><span>    </span><span class="annot"><a href="#local-6989586621681034469"><span class="hs-identifier hs-var">setNominalRole_maybe_helper</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="GHC.Core.TyCo.Rep.html#TransCo"><span class="hs-identifier hs-type">TransCo</span></a></span><span> </span><span id="local-6989586621681034437"><span class="annot"><span class="annottext">Coercion
</span><a href="#local-6989586621681034437"><span class="hs-identifier hs-var">co1</span></a></span></span><span> </span><span id="local-6989586621681034436"><span class="annot"><span class="annottext">Coercion
</span><a href="#local-6989586621681034436"><span class="hs-identifier hs-var">co2</span></a></span></span><span class="hs-special">)</span><span>
</span><span id="line-1366"></span><span>      </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">Coercion -&gt; Coercion -&gt; Coercion
</span><a href="GHC.Core.TyCo.Rep.html#TransCo"><span class="hs-identifier hs-var">TransCo</span></a></span><span> </span><span class="annot"><span class="annottext">forall (f :: * -&gt; *) a b. Functor f =&gt; (a -&gt; b) -&gt; f a -&gt; f b
</span><a href="../../base-4.16.4.0/src/Data-Functor.html#%3C%24%3E"><span class="hs-operator hs-var">&lt;$&gt;</span></a></span><span> </span><span class="annot"><span class="annottext">Coercion -&gt; Maybe Coercion
</span><a href="#local-6989586621681034469"><span class="hs-identifier hs-var">setNominalRole_maybe_helper</span></a></span><span> </span><span class="annot"><span class="annottext">Coercion
</span><a href="#local-6989586621681034437"><span class="hs-identifier hs-var">co1</span></a></span><span> </span><span class="annot"><span class="annottext">forall (f :: * -&gt; *) a b. Applicative f =&gt; f (a -&gt; b) -&gt; f a -&gt; f b
</span><a href="../../base-4.16.4.0/src/GHC-Base.html#%3C%2A%3E"><span class="hs-operator hs-var">&lt;*&gt;</span></a></span><span> </span><span class="annot"><span class="annottext">Coercion -&gt; Maybe Coercion
</span><a href="#local-6989586621681034469"><span class="hs-identifier hs-var">setNominalRole_maybe_helper</span></a></span><span> </span><span class="annot"><span class="annottext">Coercion
</span><a href="#local-6989586621681034436"><span class="hs-identifier hs-var">co2</span></a></span><span>
</span><span id="line-1367"></span><span>    </span><span class="annot"><a href="#local-6989586621681034469"><span class="hs-identifier hs-var">setNominalRole_maybe_helper</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="GHC.Core.TyCo.Rep.html#AppCo"><span class="hs-identifier hs-type">AppCo</span></a></span><span> </span><span id="local-6989586621681034435"><span class="annot"><span class="annottext">Coercion
</span><a href="#local-6989586621681034435"><span class="hs-identifier hs-var">co1</span></a></span></span><span> </span><span id="local-6989586621681034434"><span class="annot"><span class="annottext">Coercion
</span><a href="#local-6989586621681034434"><span class="hs-identifier hs-var">co2</span></a></span></span><span class="hs-special">)</span><span>
</span><span id="line-1368"></span><span>      </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">Coercion -&gt; Coercion -&gt; Coercion
</span><a href="GHC.Core.TyCo.Rep.html#AppCo"><span class="hs-identifier hs-var">AppCo</span></a></span><span> </span><span class="annot"><span class="annottext">forall (f :: * -&gt; *) a b. Functor f =&gt; (a -&gt; b) -&gt; f a -&gt; f b
</span><a href="../../base-4.16.4.0/src/Data-Functor.html#%3C%24%3E"><span class="hs-operator hs-var">&lt;$&gt;</span></a></span><span> </span><span class="annot"><span class="annottext">Coercion -&gt; Maybe Coercion
</span><a href="#local-6989586621681034469"><span class="hs-identifier hs-var">setNominalRole_maybe_helper</span></a></span><span> </span><span class="annot"><span class="annottext">Coercion
</span><a href="#local-6989586621681034435"><span class="hs-identifier hs-var">co1</span></a></span><span> </span><span class="annot"><span class="annottext">forall (f :: * -&gt; *) a b. Applicative f =&gt; f (a -&gt; b) -&gt; f a -&gt; f b
</span><a href="../../base-4.16.4.0/src/GHC-Base.html#%3C%2A%3E"><span class="hs-operator hs-var">&lt;*&gt;</span></a></span><span> </span><span class="annot"><span class="annottext">forall (f :: * -&gt; *) a. Applicative f =&gt; a -&gt; f a
</span><a href="../../base-4.16.4.0/src/GHC-Base.html#pure"><span class="hs-identifier hs-var">pure</span></a></span><span> </span><span class="annot"><span class="annottext">Coercion
</span><a href="#local-6989586621681034434"><span class="hs-identifier hs-var">co2</span></a></span><span>
</span><span id="line-1369"></span><span>    </span><span class="annot"><a href="#local-6989586621681034469"><span class="hs-identifier hs-var">setNominalRole_maybe_helper</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="GHC.Core.TyCo.Rep.html#ForAllCo"><span class="hs-identifier hs-type">ForAllCo</span></a></span><span> </span><span id="local-6989586621681034433"><span class="annot"><span class="annottext">CoVar
</span><a href="#local-6989586621681034433"><span class="hs-identifier hs-var">tv</span></a></span></span><span> </span><span id="local-6989586621681034432"><span class="annot"><span class="annottext">Coercion
</span><a href="#local-6989586621681034432"><span class="hs-identifier hs-var">kind_co</span></a></span></span><span> </span><span id="local-6989586621681034431"><span class="annot"><span class="annottext">Coercion
</span><a href="#local-6989586621681034431"><span class="hs-identifier hs-var">co</span></a></span></span><span class="hs-special">)</span><span>
</span><span id="line-1370"></span><span>      </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">CoVar -&gt; Coercion -&gt; Coercion -&gt; Coercion
</span><a href="GHC.Core.TyCo.Rep.html#ForAllCo"><span class="hs-identifier hs-var">ForAllCo</span></a></span><span> </span><span class="annot"><span class="annottext">CoVar
</span><a href="#local-6989586621681034433"><span class="hs-identifier hs-var">tv</span></a></span><span> </span><span class="annot"><span class="annottext">Coercion
</span><a href="#local-6989586621681034432"><span class="hs-identifier hs-var">kind_co</span></a></span><span> </span><span class="annot"><span class="annottext">forall (f :: * -&gt; *) a b. Functor f =&gt; (a -&gt; b) -&gt; f a -&gt; f b
</span><a href="../../base-4.16.4.0/src/Data-Functor.html#%3C%24%3E"><span class="hs-operator hs-var">&lt;$&gt;</span></a></span><span> </span><span class="annot"><span class="annottext">Coercion -&gt; Maybe Coercion
</span><a href="#local-6989586621681034469"><span class="hs-identifier hs-var">setNominalRole_maybe_helper</span></a></span><span> </span><span class="annot"><span class="annottext">Coercion
</span><a href="#local-6989586621681034431"><span class="hs-identifier hs-var">co</span></a></span><span>
</span><span id="line-1371"></span><span>    </span><span class="annot"><a href="#local-6989586621681034469"><span class="hs-identifier hs-var">setNominalRole_maybe_helper</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="GHC.Core.TyCo.Rep.html#NthCo"><span class="hs-identifier hs-type">NthCo</span></a></span><span> </span><span id="local-6989586621681034430"><span class="annot"><span class="annottext">Role
</span><a href="#local-6989586621681034430"><span class="hs-identifier hs-var">_r</span></a></span></span><span> </span><span id="local-6989586621681034429"><span class="annot"><span class="annottext">Int
</span><a href="#local-6989586621681034429"><span class="hs-identifier hs-var">n</span></a></span></span><span> </span><span id="local-6989586621681034428"><span class="annot"><span class="annottext">Coercion
</span><a href="#local-6989586621681034428"><span class="hs-identifier hs-var">co</span></a></span></span><span class="hs-special">)</span><span>
</span><span id="line-1372"></span><span>      </span><span class="hs-comment">-- NB, this case recurses via setNominalRole_maybe, not</span><span>
</span><span id="line-1373"></span><span>      </span><span class="hs-comment">-- setNominalRole_maybe_helper!</span><span>
</span><span id="line-1374"></span><span>      </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">Role -&gt; Int -&gt; Coercion -&gt; Coercion
</span><a href="GHC.Core.TyCo.Rep.html#NthCo"><span class="hs-identifier hs-var">NthCo</span></a></span><span> </span><span class="annot"><span class="annottext">Role
</span><a href="GHC.Core.Coercion.Axiom.html#Nominal"><span class="hs-identifier hs-var">Nominal</span></a></span><span> </span><span class="annot"><span class="annottext">Int
</span><a href="#local-6989586621681034429"><span class="hs-identifier hs-var">n</span></a></span><span> </span><span class="annot"><span class="annottext">forall (f :: * -&gt; *) a b. Functor f =&gt; (a -&gt; b) -&gt; f a -&gt; f b
</span><a href="../../base-4.16.4.0/src/Data-Functor.html#%3C%24%3E"><span class="hs-operator hs-var">&lt;$&gt;</span></a></span><span> </span><span class="annot"><span class="annottext">Role -&gt; Coercion -&gt; Maybe Coercion
</span><a href="GHC.Core.Coercion.html#setNominalRole_maybe"><span class="hs-identifier hs-var">setNominalRole_maybe</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Coercion -&gt; Role
</span><a href="GHC.Core.Coercion.html#coercionRole"><span class="hs-identifier hs-var">coercionRole</span></a></span><span> </span><span class="annot"><span class="annottext">Coercion
</span><a href="#local-6989586621681034428"><span class="hs-identifier hs-var">co</span></a></span><span class="hs-special">)</span><span> </span><span class="annot"><span class="annottext">Coercion
</span><a href="#local-6989586621681034428"><span class="hs-identifier hs-var">co</span></a></span><span>
</span><span id="line-1375"></span><span>    </span><span class="annot"><a href="#local-6989586621681034469"><span class="hs-identifier hs-var">setNominalRole_maybe_helper</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="GHC.Core.TyCo.Rep.html#InstCo"><span class="hs-identifier hs-type">InstCo</span></a></span><span> </span><span id="local-6989586621681034427"><span class="annot"><span class="annottext">Coercion
</span><a href="#local-6989586621681034427"><span class="hs-identifier hs-var">co</span></a></span></span><span> </span><span id="local-6989586621681034426"><span class="annot"><span class="annottext">Coercion
</span><a href="#local-6989586621681034426"><span class="hs-identifier hs-var">arg</span></a></span></span><span class="hs-special">)</span><span>
</span><span id="line-1376"></span><span>      </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">Coercion -&gt; Coercion -&gt; Coercion
</span><a href="GHC.Core.TyCo.Rep.html#InstCo"><span class="hs-identifier hs-var">InstCo</span></a></span><span> </span><span class="annot"><span class="annottext">forall (f :: * -&gt; *) a b. Functor f =&gt; (a -&gt; b) -&gt; f a -&gt; f b
</span><a href="../../base-4.16.4.0/src/Data-Functor.html#%3C%24%3E"><span class="hs-operator hs-var">&lt;$&gt;</span></a></span><span> </span><span class="annot"><span class="annottext">Coercion -&gt; Maybe Coercion
</span><a href="#local-6989586621681034469"><span class="hs-identifier hs-var">setNominalRole_maybe_helper</span></a></span><span> </span><span class="annot"><span class="annottext">Coercion
</span><a href="#local-6989586621681034427"><span class="hs-identifier hs-var">co</span></a></span><span> </span><span class="annot"><span class="annottext">forall (f :: * -&gt; *) a b. Applicative f =&gt; f (a -&gt; b) -&gt; f a -&gt; f b
</span><a href="../../base-4.16.4.0/src/GHC-Base.html#%3C%2A%3E"><span class="hs-operator hs-var">&lt;*&gt;</span></a></span><span> </span><span class="annot"><span class="annottext">forall (f :: * -&gt; *) a. Applicative f =&gt; a -&gt; f a
</span><a href="../../base-4.16.4.0/src/GHC-Base.html#pure"><span class="hs-identifier hs-var">pure</span></a></span><span> </span><span class="annot"><span class="annottext">Coercion
</span><a href="#local-6989586621681034426"><span class="hs-identifier hs-var">arg</span></a></span><span>
</span><span id="line-1377"></span><span>    </span><span class="annot"><a href="#local-6989586621681034469"><span class="hs-identifier hs-var">setNominalRole_maybe_helper</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="GHC.Core.TyCo.Rep.html#UnivCo"><span class="hs-identifier hs-type">UnivCo</span></a></span><span> </span><span id="local-6989586621681034425"><span class="annot"><span class="annottext">UnivCoProvenance
</span><a href="#local-6989586621681034425"><span class="hs-identifier hs-var">prov</span></a></span></span><span> </span><span class="annot"><span class="annottext">Role
</span><span class="hs-identifier">_</span></span><span> </span><span id="local-6989586621681034424"><span class="annot"><span class="annottext">Type
</span><a href="#local-6989586621681034424"><span class="hs-identifier hs-var">co1</span></a></span></span><span> </span><span id="local-6989586621681034423"><span class="annot"><span class="annottext">Type
</span><a href="#local-6989586621681034423"><span class="hs-identifier hs-var">co2</span></a></span></span><span class="hs-special">)</span><span>
</span><span id="line-1378"></span><span>      </span><span class="hs-glyph">|</span><span> </span><span class="hs-keyword">case</span><span> </span><span class="annot"><span class="annottext">UnivCoProvenance
</span><a href="#local-6989586621681034425"><span class="hs-identifier hs-var">prov</span></a></span><span> </span><span class="hs-keyword">of</span><span> </span><span class="annot"><a href="GHC.Core.TyCo.Rep.html#PhantomProv"><span class="hs-identifier hs-type">PhantomProv</span></a></span><span> </span><span class="annot"><span class="annottext">Coercion
</span><span class="hs-identifier">_</span></span><span>    </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="annottext">Bool
</span><span class="hs-identifier hs-var">False</span></span><span>  </span><span class="hs-comment">-- should always be phantom</span><span>
</span><span id="line-1379"></span><span>                     </span><span class="annot"><a href="GHC.Core.TyCo.Rep.html#ProofIrrelProv"><span class="hs-identifier hs-type">ProofIrrelProv</span></a></span><span> </span><span class="annot"><span class="annottext">Coercion
</span><span class="hs-identifier">_</span></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="annottext">Bool
</span><span class="hs-identifier hs-var">True</span></span><span>   </span><span class="hs-comment">-- it's always safe</span><span>
</span><span id="line-1380"></span><span>                     </span><span class="annot"><a href="GHC.Core.TyCo.Rep.html#PluginProv"><span class="hs-identifier hs-type">PluginProv</span></a></span><span> </span><span class="annot"><span class="annottext">String
</span><span class="hs-identifier">_</span></span><span>     </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="annottext">Bool
</span><span class="hs-identifier hs-var">False</span></span><span>  </span><span class="hs-comment">-- who knows? This choice is conservative.</span><span>
</span><span id="line-1381"></span><span>                     </span><span class="annot"><a href="GHC.Core.TyCo.Rep.html#CorePrepProv"><span class="hs-identifier hs-type">CorePrepProv</span></a></span><span> </span><span class="annot"><span class="annottext">Bool
</span><span class="hs-identifier">_</span></span><span>   </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="annottext">Bool
</span><span class="hs-identifier hs-var">True</span></span><span>
</span><span id="line-1382"></span><span>      </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">forall a. a -&gt; Maybe a
</span><a href="../../base-4.16.4.0/src/GHC-Maybe.html#Just"><span class="hs-identifier hs-var">Just</span></a></span><span> </span><span class="annot"><span class="annottext">forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><a href="../../base-4.16.4.0/src/GHC-Base.html#%24"><span class="hs-operator hs-var">$</span></a></span><span> </span><span class="annot"><span class="annottext">UnivCoProvenance -&gt; Role -&gt; Type -&gt; Type -&gt; Coercion
</span><a href="GHC.Core.TyCo.Rep.html#UnivCo"><span class="hs-identifier hs-var">UnivCo</span></a></span><span> </span><span class="annot"><span class="annottext">UnivCoProvenance
</span><a href="#local-6989586621681034425"><span class="hs-identifier hs-var">prov</span></a></span><span> </span><span class="annot"><span class="annottext">Role
</span><a href="GHC.Core.Coercion.Axiom.html#Nominal"><span class="hs-identifier hs-var">Nominal</span></a></span><span> </span><span class="annot"><span class="annottext">Type
</span><a href="#local-6989586621681034424"><span class="hs-identifier hs-var">co1</span></a></span><span> </span><span class="annot"><span class="annottext">Type
</span><a href="#local-6989586621681034423"><span class="hs-identifier hs-var">co2</span></a></span><span>
</span><span id="line-1383"></span><span>    </span><span class="annot"><a href="#local-6989586621681034469"><span class="hs-identifier hs-var">setNominalRole_maybe_helper</span></a></span><span> </span><span class="annot"><span class="annottext">Coercion
</span><span class="hs-identifier">_</span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">forall a. Maybe a
</span><a href="../../base-4.16.4.0/src/GHC-Maybe.html#Nothing"><span class="hs-identifier hs-var">Nothing</span></a></span><span>
</span><span id="line-1384"></span><span>
</span><span id="line-1385"></span><span class="hs-comment">-- | Make a phantom coercion between two types. The coercion passed</span><span>
</span><span id="line-1386"></span><span class="hs-comment">-- in must be a nominal coercion between the kinds of the</span><span>
</span><span id="line-1387"></span><span class="hs-comment">-- types.</span><span>
</span><span id="line-1388"></span><span class="annot"><a href="GHC.Core.Coercion.html#mkPhantomCo"><span class="hs-identifier hs-type">mkPhantomCo</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><a href="GHC.Core.TyCo.Rep.html#Coercion"><span class="hs-identifier hs-type">Coercion</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="GHC.Core.TyCo.Rep.html#Type"><span class="hs-identifier hs-type">Type</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="GHC.Core.TyCo.Rep.html#Type"><span class="hs-identifier hs-type">Type</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="GHC.Core.TyCo.Rep.html#Coercion"><span class="hs-identifier hs-type">Coercion</span></a></span><span>
</span><span id="line-1389"></span><span id="mkPhantomCo"><span class="annot"><span class="annottext">mkPhantomCo :: Coercion -&gt; Type -&gt; Type -&gt; Coercion
</span><a href="GHC.Core.Coercion.html#mkPhantomCo"><span class="hs-identifier hs-var hs-var">mkPhantomCo</span></a></span></span><span> </span><span id="local-6989586621681034420"><span class="annot"><span class="annottext">Coercion
</span><a href="#local-6989586621681034420"><span class="hs-identifier hs-var">h</span></a></span></span><span> </span><span id="local-6989586621681034419"><span class="annot"><span class="annottext">Type
</span><a href="#local-6989586621681034419"><span class="hs-identifier hs-var">t1</span></a></span></span><span> </span><span id="local-6989586621681034418"><span class="annot"><span class="annottext">Type
</span><a href="#local-6989586621681034418"><span class="hs-identifier hs-var">t2</span></a></span></span><span>
</span><span id="line-1390"></span><span>  </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">UnivCoProvenance -&gt; Role -&gt; Type -&gt; Type -&gt; Coercion
</span><a href="GHC.Core.Coercion.html#mkUnivCo"><span class="hs-identifier hs-var">mkUnivCo</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Coercion -&gt; UnivCoProvenance
</span><a href="GHC.Core.TyCo.Rep.html#PhantomProv"><span class="hs-identifier hs-var">PhantomProv</span></a></span><span> </span><span class="annot"><span class="annottext">Coercion
</span><a href="#local-6989586621681034420"><span class="hs-identifier hs-var">h</span></a></span><span class="hs-special">)</span><span> </span><span class="annot"><span class="annottext">Role
</span><a href="GHC.Core.Coercion.Axiom.html#Phantom"><span class="hs-identifier hs-var">Phantom</span></a></span><span> </span><span class="annot"><span class="annottext">Type
</span><a href="#local-6989586621681034419"><span class="hs-identifier hs-var">t1</span></a></span><span> </span><span class="annot"><span class="annottext">Type
</span><a href="#local-6989586621681034418"><span class="hs-identifier hs-var">t2</span></a></span><span>
</span><span id="line-1391"></span><span>
</span><span id="line-1392"></span><span class="hs-comment">-- takes any coercion and turns it into a Phantom coercion</span><span>
</span><span id="line-1393"></span><span class="annot"><a href="GHC.Core.Coercion.html#toPhantomCo"><span class="hs-identifier hs-type">toPhantomCo</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><a href="GHC.Core.TyCo.Rep.html#Coercion"><span class="hs-identifier hs-type">Coercion</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="GHC.Core.TyCo.Rep.html#Coercion"><span class="hs-identifier hs-type">Coercion</span></a></span><span>
</span><span id="line-1394"></span><span id="toPhantomCo"><span class="annot"><span class="annottext">toPhantomCo :: Coercion -&gt; Coercion
</span><a href="GHC.Core.Coercion.html#toPhantomCo"><span class="hs-identifier hs-var hs-var">toPhantomCo</span></a></span></span><span> </span><span id="local-6989586621681034417"><span class="annot"><span class="annottext">Coercion
</span><a href="#local-6989586621681034417"><span class="hs-identifier hs-var">co</span></a></span></span><span>
</span><span id="line-1395"></span><span>  </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">Coercion -&gt; Type -&gt; Type -&gt; Coercion
</span><a href="GHC.Core.Coercion.html#mkPhantomCo"><span class="hs-identifier hs-var">mkPhantomCo</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Coercion -&gt; Coercion
</span><a href="GHC.Core.Coercion.html#mkKindCo"><span class="hs-identifier hs-var">mkKindCo</span></a></span><span> </span><span class="annot"><span class="annottext">Coercion
</span><a href="#local-6989586621681034417"><span class="hs-identifier hs-var">co</span></a></span><span class="hs-special">)</span><span> </span><span class="annot"><span class="annottext">Type
</span><a href="#local-6989586621681034416"><span class="hs-identifier hs-var">ty1</span></a></span><span> </span><span class="annot"><span class="annottext">Type
</span><a href="#local-6989586621681034415"><span class="hs-identifier hs-var">ty2</span></a></span><span>
</span><span id="line-1396"></span><span>  </span><span class="hs-keyword">where</span><span> </span><span class="annot"><a href="GHC.Data.Pair.html#Pair"><span class="hs-identifier hs-type">Pair</span></a></span><span> </span><span id="local-6989586621681034416"><span class="annot"><span class="annottext">Type
</span><a href="#local-6989586621681034416"><span class="hs-identifier hs-var">ty1</span></a></span></span><span> </span><span id="local-6989586621681034415"><span class="annot"><span class="annottext">Type
</span><a href="#local-6989586621681034415"><span class="hs-identifier hs-var">ty2</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">Coercion -&gt; Pair Type
</span><a href="GHC.Core.Coercion.html#coercionKind"><span class="hs-identifier hs-var">coercionKind</span></a></span><span> </span><span class="annot"><span class="annottext">Coercion
</span><a href="#local-6989586621681034417"><span class="hs-identifier hs-var">co</span></a></span><span>
</span><span id="line-1397"></span><span>
</span><span id="line-1398"></span><span class="hs-comment">-- Convert args to a TyConAppCo Nominal to the same TyConAppCo Representational</span><span>
</span><span id="line-1399"></span><span class="annot"><a href="GHC.Core.Coercion.html#applyRoles"><span class="hs-identifier hs-type">applyRoles</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><a href="GHC.Core.TyCon.html#TyCon"><span class="hs-identifier hs-type">TyCon</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-special">[</span><span class="annot"><a href="GHC.Core.TyCo.Rep.html#Coercion"><span class="hs-identifier hs-type">Coercion</span></a></span><span class="hs-special">]</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-special">[</span><span class="annot"><a href="GHC.Core.TyCo.Rep.html#Coercion"><span class="hs-identifier hs-type">Coercion</span></a></span><span class="hs-special">]</span><span>
</span><span id="line-1400"></span><span id="applyRoles"><span class="annot"><span class="annottext">applyRoles :: TyCon -&gt; [Coercion] -&gt; [Coercion]
</span><a href="GHC.Core.Coercion.html#applyRoles"><span class="hs-identifier hs-var hs-var">applyRoles</span></a></span></span><span> </span><span id="local-6989586621681034414"><span class="annot"><span class="annottext">TyCon
</span><a href="#local-6989586621681034414"><span class="hs-identifier hs-var">tc</span></a></span></span><span> </span><span id="local-6989586621681034413"><span class="annot"><span class="annottext">[Coercion]
</span><a href="#local-6989586621681034413"><span class="hs-identifier hs-var">cos</span></a></span></span><span>
</span><span id="line-1401"></span><span>  </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">forall a b c. (a -&gt; b -&gt; c) -&gt; [a] -&gt; [b] -&gt; [c]
</span><a href="../../base-4.16.4.0/src/GHC-List.html#zipWith"><span class="hs-identifier hs-var">zipWith</span></a></span><span> </span><span class="hs-special">(</span><span class="hs-glyph">\</span><span id="local-6989586621681034412"><span class="annot"><span class="annottext">Role
</span><a href="#local-6989586621681034412"><span class="hs-identifier hs-var">r</span></a></span></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="annottext">Role -&gt; Role -&gt; Coercion -&gt; Coercion
</span><a href="GHC.Core.Coercion.html#downgradeRole"><span class="hs-identifier hs-var">downgradeRole</span></a></span><span> </span><span class="annot"><span class="annottext">Role
</span><a href="#local-6989586621681034412"><span class="hs-identifier hs-var">r</span></a></span><span> </span><span class="annot"><span class="annottext">Role
</span><a href="GHC.Core.Coercion.Axiom.html#Nominal"><span class="hs-identifier hs-var">Nominal</span></a></span><span class="hs-special">)</span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">TyCon -&gt; [Role]
</span><a href="GHC.Core.Coercion.html#tyConRolesRepresentational"><span class="hs-identifier hs-var">tyConRolesRepresentational</span></a></span><span> </span><span class="annot"><span class="annottext">TyCon
</span><a href="#local-6989586621681034414"><span class="hs-identifier hs-var">tc</span></a></span><span class="hs-special">)</span><span> </span><span class="annot"><span class="annottext">[Coercion]
</span><a href="#local-6989586621681034413"><span class="hs-identifier hs-var">cos</span></a></span><span>
</span><span id="line-1402"></span><span>
</span><span id="line-1403"></span><span class="hs-comment">-- the Role parameter is the Role of the TyConAppCo</span><span>
</span><span id="line-1404"></span><span class="hs-comment">-- defined here because this is intimately concerned with the implementation</span><span>
</span><span id="line-1405"></span><span class="hs-comment">-- of TyConAppCo</span><span>
</span><span id="line-1406"></span><span class="hs-comment">-- Always returns an infinite list (with a infinite tail of Nominal)</span><span>
</span><span id="line-1407"></span><span class="annot"><a href="GHC.Core.Coercion.html#tyConRolesX"><span class="hs-identifier hs-type">tyConRolesX</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><a href="GHC.Core.Coercion.Axiom.html#Role"><span class="hs-identifier hs-type">Role</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="GHC.Core.TyCon.html#TyCon"><span class="hs-identifier hs-type">TyCon</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-special">[</span><span class="annot"><a href="GHC.Core.Coercion.Axiom.html#Role"><span class="hs-identifier hs-type">Role</span></a></span><span class="hs-special">]</span><span>
</span><span id="line-1408"></span><span id="tyConRolesX"><span class="annot"><span class="annottext">tyConRolesX :: Role -&gt; TyCon -&gt; [Role]
</span><a href="GHC.Core.Coercion.html#tyConRolesX"><span class="hs-identifier hs-var hs-var">tyConRolesX</span></a></span></span><span> </span><span class="annot"><span class="annottext">Role
</span><a href="GHC.Core.Coercion.Axiom.html#Representational"><span class="hs-identifier hs-var">Representational</span></a></span><span> </span><span id="local-6989586621681034411"><span class="annot"><span class="annottext">TyCon
</span><a href="#local-6989586621681034411"><span class="hs-identifier hs-var">tc</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">TyCon -&gt; [Role]
</span><a href="GHC.Core.Coercion.html#tyConRolesRepresentational"><span class="hs-identifier hs-var">tyConRolesRepresentational</span></a></span><span> </span><span class="annot"><span class="annottext">TyCon
</span><a href="#local-6989586621681034411"><span class="hs-identifier hs-var">tc</span></a></span><span>
</span><span id="line-1409"></span><span class="annot"><a href="GHC.Core.Coercion.html#tyConRolesX"><span class="hs-identifier hs-var">tyConRolesX</span></a></span><span> </span><span id="local-6989586621681034410"><span class="annot"><span class="annottext">Role
</span><a href="#local-6989586621681034410"><span class="hs-keyword hs-var">role</span></a></span></span><span>             </span><span class="annot"><span class="annottext">TyCon
</span><span class="hs-identifier">_</span></span><span>  </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">forall a. a -&gt; [a]
</span><a href="../../base-4.16.4.0/src/GHC-List.html#repeat"><span class="hs-identifier hs-var">repeat</span></a></span><span> </span><span class="annot"><span class="annottext">Role
</span><a href="#local-6989586621681034410"><span class="hs-keyword hs-var">role</span></a></span><span>
</span><span id="line-1410"></span><span>
</span><span id="line-1411"></span><span class="hs-comment">-- Returns the roles of the parameters of a tycon, with an infinite tail</span><span>
</span><span id="line-1412"></span><span class="hs-comment">-- of Nominal</span><span>
</span><span id="line-1413"></span><span class="annot"><a href="GHC.Core.Coercion.html#tyConRolesRepresentational"><span class="hs-identifier hs-type">tyConRolesRepresentational</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><a href="GHC.Core.TyCon.html#TyCon"><span class="hs-identifier hs-type">TyCon</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-special">[</span><span class="annot"><a href="GHC.Core.Coercion.Axiom.html#Role"><span class="hs-identifier hs-type">Role</span></a></span><span class="hs-special">]</span><span>
</span><span id="line-1414"></span><span id="tyConRolesRepresentational"><span class="annot"><span class="annottext">tyConRolesRepresentational :: TyCon -&gt; [Role]
</span><a href="GHC.Core.Coercion.html#tyConRolesRepresentational"><span class="hs-identifier hs-var hs-var">tyConRolesRepresentational</span></a></span></span><span> </span><span id="local-6989586621681034409"><span class="annot"><span class="annottext">TyCon
</span><a href="#local-6989586621681034409"><span class="hs-identifier hs-var">tc</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">TyCon -&gt; [Role]
</span><a href="GHC.Core.TyCon.html#tyConRoles"><span class="hs-identifier hs-var">tyConRoles</span></a></span><span> </span><span class="annot"><span class="annottext">TyCon
</span><a href="#local-6989586621681034409"><span class="hs-identifier hs-var">tc</span></a></span><span> </span><span class="annot"><span class="annottext">forall a. [a] -&gt; [a] -&gt; [a]
</span><a href="../../base-4.16.4.0/src/GHC-Base.html#%2B%2B"><span class="hs-operator hs-var">++</span></a></span><span> </span><span class="annot"><span class="annottext">forall a. a -&gt; [a]
</span><a href="../../base-4.16.4.0/src/GHC-List.html#repeat"><span class="hs-identifier hs-var">repeat</span></a></span><span> </span><span class="annot"><span class="annottext">Role
</span><a href="GHC.Core.Coercion.Axiom.html#Nominal"><span class="hs-identifier hs-var">Nominal</span></a></span><span>
</span><span id="line-1415"></span><span>
</span><span id="line-1416"></span><span class="annot"><a href="GHC.Core.Coercion.html#nthRole"><span class="hs-identifier hs-type">nthRole</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><a href="GHC.Core.Coercion.Axiom.html#Role"><span class="hs-identifier hs-type">Role</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="GHC.Core.TyCon.html#TyCon"><span class="hs-identifier hs-type">TyCon</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="hs-identifier hs-type">Int</span></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="GHC.Core.Coercion.Axiom.html#Role"><span class="hs-identifier hs-type">Role</span></a></span><span>
</span><span id="line-1417"></span><span id="nthRole"><span class="annot"><span class="annottext">nthRole :: Role -&gt; TyCon -&gt; Int -&gt; Role
</span><a href="GHC.Core.Coercion.html#nthRole"><span class="hs-identifier hs-var hs-var">nthRole</span></a></span></span><span> </span><span class="annot"><span class="annottext">Role
</span><a href="GHC.Core.Coercion.Axiom.html#Nominal"><span class="hs-identifier hs-var">Nominal</span></a></span><span> </span><span class="annot"><span class="annottext">TyCon
</span><span class="hs-identifier">_</span></span><span> </span><span class="annot"><span class="annottext">Int
</span><span class="hs-identifier">_</span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">Role
</span><a href="GHC.Core.Coercion.Axiom.html#Nominal"><span class="hs-identifier hs-var">Nominal</span></a></span><span>
</span><span id="line-1418"></span><span class="annot"><a href="GHC.Core.Coercion.html#nthRole"><span class="hs-identifier hs-var">nthRole</span></a></span><span> </span><span class="annot"><span class="annottext">Role
</span><a href="GHC.Core.Coercion.Axiom.html#Phantom"><span class="hs-identifier hs-var">Phantom</span></a></span><span> </span><span class="annot"><span class="annottext">TyCon
</span><span class="hs-identifier">_</span></span><span> </span><span class="annot"><span class="annottext">Int
</span><span class="hs-identifier">_</span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">Role
</span><a href="GHC.Core.Coercion.Axiom.html#Phantom"><span class="hs-identifier hs-var">Phantom</span></a></span><span>
</span><span id="line-1419"></span><span class="annot"><a href="GHC.Core.Coercion.html#nthRole"><span class="hs-identifier hs-var">nthRole</span></a></span><span> </span><span class="annot"><span class="annottext">Role
</span><a href="GHC.Core.Coercion.Axiom.html#Representational"><span class="hs-identifier hs-var">Representational</span></a></span><span> </span><span id="local-6989586621681034407"><span class="annot"><span class="annottext">TyCon
</span><a href="#local-6989586621681034407"><span class="hs-identifier hs-var">tc</span></a></span></span><span> </span><span id="local-6989586621681034406"><span class="annot"><span class="annottext">Int
</span><a href="#local-6989586621681034406"><span class="hs-identifier hs-var">n</span></a></span></span><span>
</span><span id="line-1420"></span><span>  </span><span class="hs-glyph">=</span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">TyCon -&gt; [Role]
</span><a href="GHC.Core.Coercion.html#tyConRolesRepresentational"><span class="hs-identifier hs-var">tyConRolesRepresentational</span></a></span><span> </span><span class="annot"><span class="annottext">TyCon
</span><a href="#local-6989586621681034407"><span class="hs-identifier hs-var">tc</span></a></span><span class="hs-special">)</span><span> </span><span class="annot"><span class="annottext">forall a. Outputable a =&gt; [a] -&gt; Int -&gt; a
</span><a href="GHC.Data.List.SetOps.html#getNth"><span class="hs-operator hs-var">`getNth`</span></a></span><span> </span><span class="annot"><span class="annottext">Int
</span><a href="#local-6989586621681034406"><span class="hs-identifier hs-var">n</span></a></span><span>
</span><span id="line-1421"></span><span>
</span><span id="line-1422"></span><span class="annot"><a href="GHC.Core.Coercion.html#ltRole"><span class="hs-identifier hs-type">ltRole</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><a href="GHC.Core.Coercion.Axiom.html#Role"><span class="hs-identifier hs-type">Role</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="GHC.Core.Coercion.Axiom.html#Role"><span class="hs-identifier hs-type">Role</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="hs-identifier hs-type">Bool</span></span><span>
</span><span id="line-1423"></span><span class="hs-comment">-- Is one role &quot;less&quot; than another?</span><span>
</span><span id="line-1424"></span><span class="hs-comment">--     Nominal &lt; Representational &lt; Phantom</span><span>
</span><span id="line-1425"></span><span id="ltRole"><span class="annot"><span class="annottext">ltRole :: Role -&gt; Role -&gt; Bool
</span><a href="GHC.Core.Coercion.html#ltRole"><span class="hs-identifier hs-var hs-var">ltRole</span></a></span></span><span> </span><span class="annot"><span class="annottext">Role
</span><a href="GHC.Core.Coercion.Axiom.html#Phantom"><span class="hs-identifier hs-var">Phantom</span></a></span><span>          </span><span class="annot"><span class="annottext">Role
</span><span class="hs-identifier">_</span></span><span>       </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">Bool
</span><span class="hs-identifier hs-var">False</span></span><span>
</span><span id="line-1426"></span><span class="annot"><a href="GHC.Core.Coercion.html#ltRole"><span class="hs-identifier hs-var">ltRole</span></a></span><span> </span><span class="annot"><span class="annottext">Role
</span><a href="GHC.Core.Coercion.Axiom.html#Representational"><span class="hs-identifier hs-var">Representational</span></a></span><span> </span><span class="annot"><span class="annottext">Role
</span><a href="GHC.Core.Coercion.Axiom.html#Phantom"><span class="hs-identifier hs-var">Phantom</span></a></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">Bool
</span><span class="hs-identifier hs-var">True</span></span><span>
</span><span id="line-1427"></span><span class="annot"><a href="GHC.Core.Coercion.html#ltRole"><span class="hs-identifier hs-var">ltRole</span></a></span><span> </span><span class="annot"><span class="annottext">Role
</span><a href="GHC.Core.Coercion.Axiom.html#Representational"><span class="hs-identifier hs-var">Representational</span></a></span><span> </span><span class="annot"><span class="annottext">Role
</span><span class="hs-identifier">_</span></span><span>       </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">Bool
</span><span class="hs-identifier hs-var">False</span></span><span>
</span><span id="line-1428"></span><span class="annot"><a href="GHC.Core.Coercion.html#ltRole"><span class="hs-identifier hs-var">ltRole</span></a></span><span> </span><span class="annot"><span class="annottext">Role
</span><a href="GHC.Core.Coercion.Axiom.html#Nominal"><span class="hs-identifier hs-var">Nominal</span></a></span><span>          </span><span class="annot"><span class="annottext">Role
</span><a href="GHC.Core.Coercion.Axiom.html#Nominal"><span class="hs-identifier hs-var">Nominal</span></a></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">Bool
</span><span class="hs-identifier hs-var">False</span></span><span>
</span><span id="line-1429"></span><span class="annot"><a href="GHC.Core.Coercion.html#ltRole"><span class="hs-identifier hs-var">ltRole</span></a></span><span> </span><span class="annot"><span class="annottext">Role
</span><a href="GHC.Core.Coercion.Axiom.html#Nominal"><span class="hs-identifier hs-var">Nominal</span></a></span><span>          </span><span class="annot"><span class="annottext">Role
</span><span class="hs-identifier">_</span></span><span>       </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">Bool
</span><span class="hs-identifier hs-var">True</span></span><span>
</span><span id="line-1430"></span><span>
</span><span id="line-1431"></span><span class="hs-comment">-------------------------------</span><span>
</span><span id="line-1432"></span><span>
</span><span id="line-1433"></span><span class="hs-comment">-- | like mkKindCo, but aggressively &amp; recursively optimizes to avoid using</span><span>
</span><span id="line-1434"></span><span class="hs-comment">-- a KindCo constructor. The output role is nominal.</span><span>
</span><span id="line-1435"></span><span class="annot"><a href="GHC.Core.Coercion.html#promoteCoercion"><span class="hs-identifier hs-type">promoteCoercion</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><a href="GHC.Core.TyCo.Rep.html#Coercion"><span class="hs-identifier hs-type">Coercion</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="GHC.Core.TyCo.Rep.html#CoercionN"><span class="hs-identifier hs-type">CoercionN</span></a></span><span>
</span><span id="line-1436"></span><span>
</span><span id="line-1437"></span><span class="hs-comment">-- First cases handles anything that should yield refl.</span><span>
</span><span id="line-1438"></span><span id="promoteCoercion"><span class="annot"><span class="annottext">promoteCoercion :: Coercion -&gt; Coercion
</span><a href="GHC.Core.Coercion.html#promoteCoercion"><span class="hs-identifier hs-var hs-var">promoteCoercion</span></a></span></span><span> </span><span id="local-6989586621681034405"><span class="annot"><span class="annottext">Coercion
</span><a href="#local-6989586621681034405"><span class="hs-identifier hs-var">co</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-keyword">case</span><span> </span><span class="annot"><span class="annottext">Coercion
</span><a href="#local-6989586621681034405"><span class="hs-identifier hs-var">co</span></a></span><span> </span><span class="hs-keyword">of</span><span>
</span><span id="line-1439"></span><span>
</span><span id="line-1440"></span><span>    </span><span class="annot"><span class="annottext">Coercion
</span><span class="hs-identifier">_</span></span><span> </span><span class="hs-glyph">|</span><span> </span><span class="annot"><span class="annottext">Type
</span><a href="#local-6989586621681034404"><span class="hs-identifier hs-var">ki1</span></a></span><span> </span><span class="annot"><span class="annottext">Type -&gt; Type -&gt; Bool
</span><a href="GHC.Core.Type.html#eqType"><span class="hs-operator hs-var">`eqType`</span></a></span><span> </span><span class="annot"><span class="annottext">Type
</span><a href="#local-6989586621681034403"><span class="hs-identifier hs-var">ki2</span></a></span><span>
</span><span id="line-1441"></span><span>      </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="annottext">Type -&gt; Coercion
</span><a href="GHC.Core.Coercion.html#mkNomReflCo"><span class="hs-identifier hs-var">mkNomReflCo</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">HasDebugCallStack =&gt; Type -&gt; Type
</span><a href="GHC.Core.Type.html#typeKind"><span class="hs-identifier hs-var">typeKind</span></a></span><span> </span><span class="annot"><span class="annottext">Type
</span><a href="#local-6989586621681034402"><span class="hs-identifier hs-var">ty1</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-1442"></span><span>     </span><span class="hs-comment">-- no later branch should return refl</span><span>
</span><span id="line-1443"></span><span>     </span><span class="hs-comment">--    The ASSERT( False )s throughout</span><span>
</span><span id="line-1444"></span><span>     </span><span class="hs-comment">-- are these cases explicitly, but they should never fire.</span><span>
</span><span id="line-1445"></span><span>
</span><span id="line-1446"></span><span>    </span><span class="annot"><a href="GHC.Core.TyCo.Rep.html#Refl"><span class="hs-identifier hs-type">Refl</span></a></span><span> </span><span class="annot"><span class="annottext">Type
</span><span class="hs-identifier">_</span></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-identifier">ASSERT</span><span class="hs-special">(</span><span> </span><span class="hs-identifier">False</span><span> </span><span class="hs-special">)</span><span>
</span><span id="line-1447"></span><span>              </span><span class="annot"><span class="annottext">Type -&gt; Coercion
</span><a href="GHC.Core.Coercion.html#mkNomReflCo"><span class="hs-identifier hs-var">mkNomReflCo</span></a></span><span> </span><span class="annot"><span class="annottext">Type
</span><a href="#local-6989586621681034404"><span class="hs-identifier hs-var">ki1</span></a></span><span>
</span><span id="line-1448"></span><span>
</span><span id="line-1449"></span><span>    </span><span class="annot"><a href="GHC.Core.TyCo.Rep.html#GRefl"><span class="hs-identifier hs-type">GRefl</span></a></span><span> </span><span class="annot"><span class="annottext">Role
</span><span class="hs-identifier">_</span></span><span> </span><span class="annot"><span class="annottext">Type
</span><span class="hs-identifier">_</span></span><span> </span><span class="annot"><span class="annottext">MCoercion
</span><a href="GHC.Core.TyCo.Rep.html#MRefl"><span class="hs-identifier hs-var">MRefl</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-identifier">ASSERT</span><span class="hs-special">(</span><span> </span><span class="hs-identifier">False</span><span> </span><span class="hs-special">)</span><span>
</span><span id="line-1450"></span><span>                       </span><span class="annot"><span class="annottext">Type -&gt; Coercion
</span><a href="GHC.Core.Coercion.html#mkNomReflCo"><span class="hs-identifier hs-var">mkNomReflCo</span></a></span><span> </span><span class="annot"><span class="annottext">Type
</span><a href="#local-6989586621681034404"><span class="hs-identifier hs-var">ki1</span></a></span><span>
</span><span id="line-1451"></span><span>
</span><span id="line-1452"></span><span>    </span><span class="annot"><a href="GHC.Core.TyCo.Rep.html#GRefl"><span class="hs-identifier hs-type">GRefl</span></a></span><span> </span><span class="annot"><span class="annottext">Role
</span><span class="hs-identifier">_</span></span><span> </span><span class="annot"><span class="annottext">Type
</span><span class="hs-identifier">_</span></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="GHC.Core.TyCo.Rep.html#MCo"><span class="hs-identifier hs-type">MCo</span></a></span><span> </span><span id="local-6989586621681034401"><span class="annot"><span class="annottext">Coercion
</span><a href="#local-6989586621681034401"><span class="hs-identifier hs-var">co</span></a></span></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="annottext">Coercion
</span><a href="#local-6989586621681034401"><span class="hs-identifier hs-var">co</span></a></span><span>
</span><span id="line-1453"></span><span>
</span><span id="line-1454"></span><span>    </span><span class="annot"><a href="GHC.Core.TyCo.Rep.html#TyConAppCo"><span class="hs-identifier hs-type">TyConAppCo</span></a></span><span> </span><span class="annot"><span class="annottext">Role
</span><span class="hs-identifier">_</span></span><span> </span><span id="local-6989586621681034400"><span class="annot"><span class="annottext">TyCon
</span><a href="#local-6989586621681034400"><span class="hs-identifier hs-var">tc</span></a></span></span><span> </span><span id="local-6989586621681034399"><span class="annot"><span class="annottext">[Coercion]
</span><a href="#local-6989586621681034399"><span class="hs-identifier hs-var">args</span></a></span></span><span>
</span><span id="line-1455"></span><span>      </span><span class="hs-glyph">|</span><span> </span><span class="annot"><a href="../../base-4.16.4.0/src/GHC-Maybe.html#Just"><span class="hs-identifier hs-type">Just</span></a></span><span> </span><span id="local-6989586621681034398"><span class="annot"><span class="annottext">Coercion
</span><a href="#local-6989586621681034398"><span class="hs-identifier hs-var">co'</span></a></span></span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">Coercion -&gt; [Coercion] -&gt; Maybe Coercion
</span><a href="GHC.Core.Coercion.html#instCoercions"><span class="hs-identifier hs-var">instCoercions</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Type -&gt; Coercion
</span><a href="GHC.Core.Coercion.html#mkNomReflCo"><span class="hs-identifier hs-var">mkNomReflCo</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">TyCon -&gt; Type
</span><a href="GHC.Core.TyCon.html#tyConKind"><span class="hs-identifier hs-var">tyConKind</span></a></span><span> </span><span class="annot"><span class="annottext">TyCon
</span><a href="#local-6989586621681034400"><span class="hs-identifier hs-var">tc</span></a></span><span class="hs-special">)</span><span class="hs-special">)</span><span> </span><span class="annot"><span class="annottext">[Coercion]
</span><a href="#local-6989586621681034399"><span class="hs-identifier hs-var">args</span></a></span><span>
</span><span id="line-1456"></span><span>      </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="annottext">Coercion
</span><a href="#local-6989586621681034398"><span class="hs-identifier hs-var">co'</span></a></span><span>
</span><span id="line-1457"></span><span>      </span><span class="hs-glyph">|</span><span> </span><span class="annot"><span class="annottext">Bool
</span><a href="../../base-4.16.4.0/src/GHC-Base.html#otherwise"><span class="hs-identifier hs-var">otherwise</span></a></span><span>
</span><span id="line-1458"></span><span>      </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="annottext">Coercion -&gt; Coercion
</span><a href="GHC.Core.Coercion.html#mkKindCo"><span class="hs-identifier hs-var">mkKindCo</span></a></span><span> </span><span class="annot"><span class="annottext">Coercion
</span><a href="#local-6989586621681034405"><span class="hs-identifier hs-var">co</span></a></span><span>
</span><span id="line-1459"></span><span>
</span><span id="line-1460"></span><span>    </span><span class="annot"><a href="GHC.Core.TyCo.Rep.html#AppCo"><span class="hs-identifier hs-type">AppCo</span></a></span><span> </span><span id="local-6989586621681034395"><span class="annot"><span class="annottext">Coercion
</span><a href="#local-6989586621681034395"><span class="hs-identifier hs-var">co1</span></a></span></span><span> </span><span id="local-6989586621681034394"><span class="annot"><span class="annottext">Coercion
</span><a href="#local-6989586621681034394"><span class="hs-identifier hs-var">arg</span></a></span></span><span>
</span><span id="line-1461"></span><span>      </span><span class="hs-glyph">|</span><span> </span><span class="annot"><a href="../../base-4.16.4.0/src/GHC-Maybe.html#Just"><span class="hs-identifier hs-type">Just</span></a></span><span> </span><span id="local-6989586621681034393"><span class="annot"><span class="annottext">Coercion
</span><a href="#local-6989586621681034393"><span class="hs-identifier hs-var">co'</span></a></span></span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">Pair Type -&gt; Coercion -&gt; Coercion -&gt; Maybe Coercion
</span><a href="GHC.Core.Coercion.html#instCoercion"><span class="hs-identifier hs-var">instCoercion</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Coercion -&gt; Pair Type
</span><a href="GHC.Core.Coercion.html#coercionKind"><span class="hs-identifier hs-var">coercionKind</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Coercion -&gt; Coercion
</span><a href="GHC.Core.Coercion.html#mkKindCo"><span class="hs-identifier hs-var">mkKindCo</span></a></span><span> </span><span class="annot"><span class="annottext">Coercion
</span><a href="#local-6989586621681034395"><span class="hs-identifier hs-var">co1</span></a></span><span class="hs-special">)</span><span class="hs-special">)</span><span>
</span><span id="line-1462"></span><span>                                 </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Coercion -&gt; Coercion
</span><a href="GHC.Core.Coercion.html#promoteCoercion"><span class="hs-identifier hs-var">promoteCoercion</span></a></span><span> </span><span class="annot"><span class="annottext">Coercion
</span><a href="#local-6989586621681034395"><span class="hs-identifier hs-var">co1</span></a></span><span class="hs-special">)</span><span> </span><span class="annot"><span class="annottext">Coercion
</span><a href="#local-6989586621681034394"><span class="hs-identifier hs-var">arg</span></a></span><span>
</span><span id="line-1463"></span><span>      </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="annottext">Coercion
</span><a href="#local-6989586621681034393"><span class="hs-identifier hs-var">co'</span></a></span><span>
</span><span id="line-1464"></span><span>      </span><span class="hs-glyph">|</span><span> </span><span class="annot"><span class="annottext">Bool
</span><a href="../../base-4.16.4.0/src/GHC-Base.html#otherwise"><span class="hs-identifier hs-var">otherwise</span></a></span><span>
</span><span id="line-1465"></span><span>      </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="annottext">Coercion -&gt; Coercion
</span><a href="GHC.Core.Coercion.html#mkKindCo"><span class="hs-identifier hs-var">mkKindCo</span></a></span><span> </span><span class="annot"><span class="annottext">Coercion
</span><a href="#local-6989586621681034405"><span class="hs-identifier hs-var">co</span></a></span><span>
</span><span id="line-1466"></span><span>
</span><span id="line-1467"></span><span>    </span><span class="annot"><a href="GHC.Core.TyCo.Rep.html#ForAllCo"><span class="hs-identifier hs-type">ForAllCo</span></a></span><span> </span><span id="local-6989586621681034391"><span class="annot"><span class="annottext">CoVar
</span><a href="#local-6989586621681034391"><span class="hs-identifier hs-var">tv</span></a></span></span><span> </span><span class="annot"><span class="annottext">Coercion
</span><span class="hs-identifier">_</span></span><span> </span><span id="local-6989586621681034390"><span class="annot"><span class="annottext">Coercion
</span><a href="#local-6989586621681034390"><span class="hs-identifier hs-var">g</span></a></span></span><span>
</span><span id="line-1468"></span><span>      </span><span class="hs-glyph">|</span><span> </span><span class="annot"><span class="annottext">CoVar -&gt; Bool
</span><a href="GHC.Types.Var.html#isTyVar"><span class="hs-identifier hs-var">isTyVar</span></a></span><span> </span><span class="annot"><span class="annottext">CoVar
</span><a href="#local-6989586621681034391"><span class="hs-identifier hs-var">tv</span></a></span><span>
</span><span id="line-1469"></span><span>      </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="annottext">Coercion -&gt; Coercion
</span><a href="GHC.Core.Coercion.html#promoteCoercion"><span class="hs-identifier hs-var">promoteCoercion</span></a></span><span> </span><span class="annot"><span class="annottext">Coercion
</span><a href="#local-6989586621681034390"><span class="hs-identifier hs-var">g</span></a></span><span>
</span><span id="line-1470"></span><span>
</span><span id="line-1471"></span><span>    </span><span class="annot"><a href="GHC.Core.TyCo.Rep.html#ForAllCo"><span class="hs-identifier hs-type">ForAllCo</span></a></span><span> </span><span class="annot"><span class="annottext">CoVar
</span><span class="hs-identifier">_</span></span><span> </span><span class="annot"><span class="annottext">Coercion
</span><span class="hs-identifier">_</span></span><span> </span><span class="annot"><span class="annottext">Coercion
</span><span class="hs-identifier">_</span></span><span>
</span><span id="line-1472"></span><span>      </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-identifier">ASSERT</span><span class="hs-special">(</span><span> </span><span class="hs-identifier">False</span><span> </span><span class="hs-special">)</span><span>
</span><span id="line-1473"></span><span>         </span><span class="annot"><span class="annottext">Type -&gt; Coercion
</span><a href="GHC.Core.Coercion.html#mkNomReflCo"><span class="hs-identifier hs-var">mkNomReflCo</span></a></span><span> </span><span class="annot"><span class="annottext">Type
</span><a href="GHC.Builtin.Types.html#liftedTypeKind"><span class="hs-identifier hs-var">liftedTypeKind</span></a></span><span>
</span><span id="line-1474"></span><span>      </span><span class="hs-comment">-- See Note [Weird typing rule for ForAllTy] in GHC.Core.TyCo.Rep</span><span>
</span><span id="line-1475"></span><span>
</span><span id="line-1476"></span><span>    </span><span class="annot"><a href="GHC.Core.TyCo.Rep.html#FunCo"><span class="hs-identifier hs-type">FunCo</span></a></span><span> </span><span class="annot"><span class="annottext">Role
</span><span class="hs-identifier">_</span></span><span> </span><span class="annot"><span class="annottext">Coercion
</span><span class="hs-identifier">_</span></span><span> </span><span class="annot"><span class="annottext">Coercion
</span><span class="hs-identifier">_</span></span><span> </span><span class="annot"><span class="annottext">Coercion
</span><span class="hs-identifier">_</span></span><span>
</span><span id="line-1477"></span><span>      </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-identifier">ASSERT</span><span class="hs-special">(</span><span> </span><span class="hs-identifier">False</span><span> </span><span class="hs-special">)</span><span>
</span><span id="line-1478"></span><span>         </span><span class="annot"><span class="annottext">Type -&gt; Coercion
</span><a href="GHC.Core.Coercion.html#mkNomReflCo"><span class="hs-identifier hs-var">mkNomReflCo</span></a></span><span> </span><span class="annot"><span class="annottext">Type
</span><a href="GHC.Builtin.Types.html#liftedTypeKind"><span class="hs-identifier hs-var">liftedTypeKind</span></a></span><span>
</span><span id="line-1479"></span><span>
</span><span id="line-1480"></span><span>    </span><span class="annot"><a href="GHC.Core.TyCo.Rep.html#CoVarCo"><span class="hs-identifier hs-type">CoVarCo</span></a></span><span> </span><span class="hs-special">{</span><span class="hs-special">}</span><span>     </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="annottext">Coercion -&gt; Coercion
</span><a href="GHC.Core.Coercion.html#mkKindCo"><span class="hs-identifier hs-var">mkKindCo</span></a></span><span> </span><span class="annot"><span class="annottext">Coercion
</span><a href="#local-6989586621681034405"><span class="hs-identifier hs-var">co</span></a></span><span>
</span><span id="line-1481"></span><span>    </span><span class="annot"><a href="GHC.Core.TyCo.Rep.html#HoleCo"><span class="hs-identifier hs-type">HoleCo</span></a></span><span> </span><span class="hs-special">{</span><span class="hs-special">}</span><span>      </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="annottext">Coercion -&gt; Coercion
</span><a href="GHC.Core.Coercion.html#mkKindCo"><span class="hs-identifier hs-var">mkKindCo</span></a></span><span> </span><span class="annot"><span class="annottext">Coercion
</span><a href="#local-6989586621681034405"><span class="hs-identifier hs-var">co</span></a></span><span>
</span><span id="line-1482"></span><span>    </span><span class="annot"><a href="GHC.Core.TyCo.Rep.html#AxiomInstCo"><span class="hs-identifier hs-type">AxiomInstCo</span></a></span><span> </span><span class="hs-special">{</span><span class="hs-special">}</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="annottext">Coercion -&gt; Coercion
</span><a href="GHC.Core.Coercion.html#mkKindCo"><span class="hs-identifier hs-var">mkKindCo</span></a></span><span> </span><span class="annot"><span class="annottext">Coercion
</span><a href="#local-6989586621681034405"><span class="hs-identifier hs-var">co</span></a></span><span>
</span><span id="line-1483"></span><span>    </span><span class="annot"><a href="GHC.Core.TyCo.Rep.html#AxiomRuleCo"><span class="hs-identifier hs-type">AxiomRuleCo</span></a></span><span> </span><span class="hs-special">{</span><span class="hs-special">}</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="annottext">Coercion -&gt; Coercion
</span><a href="GHC.Core.Coercion.html#mkKindCo"><span class="hs-identifier hs-var">mkKindCo</span></a></span><span> </span><span class="annot"><span class="annottext">Coercion
</span><a href="#local-6989586621681034405"><span class="hs-identifier hs-var">co</span></a></span><span>
</span><span id="line-1484"></span><span>
</span><span id="line-1485"></span><span>    </span><span class="annot"><a href="GHC.Core.TyCo.Rep.html#UnivCo"><span class="hs-identifier hs-type">UnivCo</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="GHC.Core.TyCo.Rep.html#PhantomProv"><span class="hs-identifier hs-type">PhantomProv</span></a></span><span> </span><span id="local-6989586621681034388"><span class="annot"><span class="annottext">Coercion
</span><a href="#local-6989586621681034388"><span class="hs-identifier hs-var">kco</span></a></span></span><span class="hs-special">)</span><span>    </span><span class="annot"><span class="annottext">Role
</span><span class="hs-identifier">_</span></span><span> </span><span class="annot"><span class="annottext">Type
</span><span class="hs-identifier">_</span></span><span> </span><span class="annot"><span class="annottext">Type
</span><span class="hs-identifier">_</span></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="annottext">Coercion
</span><a href="#local-6989586621681034388"><span class="hs-identifier hs-var">kco</span></a></span><span>
</span><span id="line-1486"></span><span>    </span><span class="annot"><a href="GHC.Core.TyCo.Rep.html#UnivCo"><span class="hs-identifier hs-type">UnivCo</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="GHC.Core.TyCo.Rep.html#ProofIrrelProv"><span class="hs-identifier hs-type">ProofIrrelProv</span></a></span><span> </span><span id="local-6989586621681034387"><span class="annot"><span class="annottext">Coercion
</span><a href="#local-6989586621681034387"><span class="hs-identifier hs-var">kco</span></a></span></span><span class="hs-special">)</span><span> </span><span class="annot"><span class="annottext">Role
</span><span class="hs-identifier">_</span></span><span> </span><span class="annot"><span class="annottext">Type
</span><span class="hs-identifier">_</span></span><span> </span><span class="annot"><span class="annottext">Type
</span><span class="hs-identifier">_</span></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="annottext">Coercion
</span><a href="#local-6989586621681034387"><span class="hs-identifier hs-var">kco</span></a></span><span>
</span><span id="line-1487"></span><span>    </span><span class="annot"><a href="GHC.Core.TyCo.Rep.html#UnivCo"><span class="hs-identifier hs-type">UnivCo</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="GHC.Core.TyCo.Rep.html#PluginProv"><span class="hs-identifier hs-type">PluginProv</span></a></span><span> </span><span class="annot"><span class="annottext">String
</span><span class="hs-identifier">_</span></span><span class="hs-special">)</span><span>       </span><span class="annot"><span class="annottext">Role
</span><span class="hs-identifier">_</span></span><span> </span><span class="annot"><span class="annottext">Type
</span><span class="hs-identifier">_</span></span><span> </span><span class="annot"><span class="annottext">Type
</span><span class="hs-identifier">_</span></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="annottext">Coercion -&gt; Coercion
</span><a href="GHC.Core.Coercion.html#mkKindCo"><span class="hs-identifier hs-var">mkKindCo</span></a></span><span> </span><span class="annot"><span class="annottext">Coercion
</span><a href="#local-6989586621681034405"><span class="hs-identifier hs-var">co</span></a></span><span>
</span><span id="line-1488"></span><span>    </span><span class="annot"><a href="GHC.Core.TyCo.Rep.html#UnivCo"><span class="hs-identifier hs-type">UnivCo</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="GHC.Core.TyCo.Rep.html#CorePrepProv"><span class="hs-identifier hs-type">CorePrepProv</span></a></span><span> </span><span class="annot"><span class="annottext">Bool
</span><span class="hs-identifier">_</span></span><span class="hs-special">)</span><span>     </span><span class="annot"><span class="annottext">Role
</span><span class="hs-identifier">_</span></span><span> </span><span class="annot"><span class="annottext">Type
</span><span class="hs-identifier">_</span></span><span> </span><span class="annot"><span class="annottext">Type
</span><span class="hs-identifier">_</span></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="annottext">Coercion -&gt; Coercion
</span><a href="GHC.Core.Coercion.html#mkKindCo"><span class="hs-identifier hs-var">mkKindCo</span></a></span><span> </span><span class="annot"><span class="annottext">Coercion
</span><a href="#local-6989586621681034405"><span class="hs-identifier hs-var">co</span></a></span><span>
</span><span id="line-1489"></span><span>
</span><span id="line-1490"></span><span>    </span><span class="annot"><a href="GHC.Core.TyCo.Rep.html#SymCo"><span class="hs-identifier hs-type">SymCo</span></a></span><span> </span><span id="local-6989586621681034386"><span class="annot"><span class="annottext">Coercion
</span><a href="#local-6989586621681034386"><span class="hs-identifier hs-var">g</span></a></span></span><span>
</span><span id="line-1491"></span><span>      </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="annottext">Coercion -&gt; Coercion
</span><a href="GHC.Core.Coercion.html#mkSymCo"><span class="hs-identifier hs-var">mkSymCo</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Coercion -&gt; Coercion
</span><a href="GHC.Core.Coercion.html#promoteCoercion"><span class="hs-identifier hs-var">promoteCoercion</span></a></span><span> </span><span class="annot"><span class="annottext">Coercion
</span><a href="#local-6989586621681034386"><span class="hs-identifier hs-var">g</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-1492"></span><span>
</span><span id="line-1493"></span><span>    </span><span class="annot"><a href="GHC.Core.TyCo.Rep.html#TransCo"><span class="hs-identifier hs-type">TransCo</span></a></span><span> </span><span id="local-6989586621681034385"><span class="annot"><span class="annottext">Coercion
</span><a href="#local-6989586621681034385"><span class="hs-identifier hs-var">co1</span></a></span></span><span> </span><span id="local-6989586621681034384"><span class="annot"><span class="annottext">Coercion
</span><a href="#local-6989586621681034384"><span class="hs-identifier hs-var">co2</span></a></span></span><span>
</span><span id="line-1494"></span><span>      </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="annottext">Coercion -&gt; Coercion -&gt; Coercion
</span><a href="GHC.Core.Coercion.html#mkTransCo"><span class="hs-identifier hs-var">mkTransCo</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Coercion -&gt; Coercion
</span><a href="GHC.Core.Coercion.html#promoteCoercion"><span class="hs-identifier hs-var">promoteCoercion</span></a></span><span> </span><span class="annot"><span class="annottext">Coercion
</span><a href="#local-6989586621681034385"><span class="hs-identifier hs-var">co1</span></a></span><span class="hs-special">)</span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Coercion -&gt; Coercion
</span><a href="GHC.Core.Coercion.html#promoteCoercion"><span class="hs-identifier hs-var">promoteCoercion</span></a></span><span> </span><span class="annot"><span class="annottext">Coercion
</span><a href="#local-6989586621681034384"><span class="hs-identifier hs-var">co2</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-1495"></span><span>
</span><span id="line-1496"></span><span>    </span><span class="annot"><a href="GHC.Core.TyCo.Rep.html#NthCo"><span class="hs-identifier hs-type">NthCo</span></a></span><span> </span><span class="annot"><span class="annottext">Role
</span><span class="hs-identifier">_</span></span><span> </span><span id="local-6989586621681034383"><span class="annot"><span class="annottext">Int
</span><a href="#local-6989586621681034383"><span class="hs-identifier hs-var">n</span></a></span></span><span> </span><span id="local-6989586621681034382"><span class="annot"><span class="annottext">Coercion
</span><a href="#local-6989586621681034382"><span class="hs-identifier hs-var">co1</span></a></span></span><span>
</span><span id="line-1497"></span><span>      </span><span class="hs-glyph">|</span><span> </span><span class="annot"><a href="../../base-4.16.4.0/src/GHC-Maybe.html#Just"><span class="hs-identifier hs-type">Just</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">TyCon
</span><span class="hs-identifier">_</span></span><span class="hs-special">,</span><span> </span><span id="local-6989586621681034381"><span class="annot"><span class="annottext">[Coercion]
</span><a href="#local-6989586621681034381"><span class="hs-identifier hs-var">args</span></a></span></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">Coercion -&gt; Maybe (TyCon, [Coercion])
</span><a href="GHC.Core.Coercion.html#splitTyConAppCo_maybe"><span class="hs-identifier hs-var">splitTyConAppCo_maybe</span></a></span><span> </span><span class="annot"><span class="annottext">Coercion
</span><a href="#local-6989586621681034382"><span class="hs-identifier hs-var">co1</span></a></span><span>
</span><span id="line-1498"></span><span>      </span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">[Coercion]
</span><a href="#local-6989586621681034381"><span class="hs-identifier hs-var">args</span></a></span><span> </span><span class="annot"><span class="annottext">forall a. [a] -&gt; Int -&gt; Bool
</span><a href="GHC.Utils.Misc.html#lengthExceeds"><span class="hs-operator hs-var">`lengthExceeds`</span></a></span><span> </span><span class="annot"><span class="annottext">Int
</span><a href="#local-6989586621681034383"><span class="hs-identifier hs-var">n</span></a></span><span>
</span><span id="line-1499"></span><span>      </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="annottext">Coercion -&gt; Coercion
</span><a href="GHC.Core.Coercion.html#promoteCoercion"><span class="hs-identifier hs-var">promoteCoercion</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">[Coercion]
</span><a href="#local-6989586621681034381"><span class="hs-identifier hs-var">args</span></a></span><span> </span><span class="annot"><span class="annottext">forall a. [a] -&gt; Int -&gt; a
</span><a href="../../base-4.16.4.0/src/GHC-List.html#%21%21"><span class="hs-operator hs-var">!!</span></a></span><span> </span><span class="annot"><span class="annottext">Int
</span><a href="#local-6989586621681034383"><span class="hs-identifier hs-var">n</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-1500"></span><span>
</span><span id="line-1501"></span><span>      </span><span class="hs-glyph">|</span><span> </span><span class="annot"><a href="../../base-4.16.4.0/src/GHC-Maybe.html#Just"><span class="hs-identifier hs-type">Just</span></a></span><span> </span><span class="annot"><span class="annottext">(CoVar, Coercion, Coercion)
</span><span class="hs-identifier">_</span></span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">Coercion -&gt; Maybe (CoVar, Coercion, Coercion)
</span><a href="GHC.Core.Coercion.html#splitForAllCo_maybe"><span class="hs-identifier hs-var">splitForAllCo_maybe</span></a></span><span> </span><span class="annot"><span class="annottext">Coercion
</span><a href="#local-6989586621681034405"><span class="hs-identifier hs-var">co</span></a></span><span>
</span><span id="line-1502"></span><span>      </span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">Int
</span><a href="#local-6989586621681034383"><span class="hs-identifier hs-var">n</span></a></span><span> </span><span class="annot"><span class="annottext">forall a. Eq a =&gt; a -&gt; a -&gt; Bool
</span><span class="hs-operator hs-var">==</span></span><span> </span><span class="annot"><span class="annottext">Int
</span><span class="hs-number">0</span></span><span>
</span><span id="line-1503"></span><span>      </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-identifier">ASSERT</span><span class="hs-special">(</span><span> </span><span class="hs-identifier">False</span><span> </span><span class="hs-special">)</span><span> </span><span class="hs-identifier">mkNomReflCo</span><span> </span><span class="hs-identifier">liftedTypeKind</span><span>
</span><span id="line-1504"></span><span>
</span><span id="line-1505"></span><span>      </span><span class="hs-glyph">|</span><span> </span><span class="annot"><span class="annottext">Bool
</span><a href="../../base-4.16.4.0/src/GHC-Base.html#otherwise"><span class="hs-identifier hs-var">otherwise</span></a></span><span>
</span><span id="line-1506"></span><span>      </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="annottext">Coercion -&gt; Coercion
</span><a href="GHC.Core.Coercion.html#mkKindCo"><span class="hs-identifier hs-var">mkKindCo</span></a></span><span> </span><span class="annot"><span class="annottext">Coercion
</span><a href="#local-6989586621681034405"><span class="hs-identifier hs-var">co</span></a></span><span>
</span><span id="line-1507"></span><span>
</span><span id="line-1508"></span><span>    </span><span class="annot"><a href="GHC.Core.TyCo.Rep.html#LRCo"><span class="hs-identifier hs-type">LRCo</span></a></span><span> </span><span id="local-6989586621681034380"><span class="annot"><span class="annottext">LeftOrRight
</span><a href="#local-6989586621681034380"><span class="hs-identifier hs-var">lr</span></a></span></span><span> </span><span id="local-6989586621681034379"><span class="annot"><span class="annottext">Coercion
</span><a href="#local-6989586621681034379"><span class="hs-identifier hs-var">co1</span></a></span></span><span>
</span><span id="line-1509"></span><span>      </span><span class="hs-glyph">|</span><span> </span><span class="annot"><a href="../../base-4.16.4.0/src/GHC-Maybe.html#Just"><span class="hs-identifier hs-type">Just</span></a></span><span> </span><span class="hs-special">(</span><span id="local-6989586621681034378"><span class="annot"><span class="annottext">Coercion
</span><a href="#local-6989586621681034378"><span class="hs-identifier hs-var">lco</span></a></span></span><span class="hs-special">,</span><span> </span><span id="local-6989586621681034377"><span class="annot"><span class="annottext">Coercion
</span><a href="#local-6989586621681034377"><span class="hs-identifier hs-var">rco</span></a></span></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">Coercion -&gt; Maybe (Coercion, Coercion)
</span><a href="GHC.Core.Coercion.html#splitAppCo_maybe"><span class="hs-identifier hs-var">splitAppCo_maybe</span></a></span><span> </span><span class="annot"><span class="annottext">Coercion
</span><a href="#local-6989586621681034379"><span class="hs-identifier hs-var">co1</span></a></span><span>
</span><span id="line-1510"></span><span>      </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-keyword">case</span><span> </span><span class="annot"><span class="annottext">LeftOrRight
</span><a href="#local-6989586621681034380"><span class="hs-identifier hs-var">lr</span></a></span><span> </span><span class="hs-keyword">of</span><span>
</span><span id="line-1511"></span><span>           </span><span class="annot"><span class="annottext">LeftOrRight
</span><a href="GHC.Types.Basic.html#CLeft"><span class="hs-identifier hs-var">CLeft</span></a></span><span>  </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="annottext">Coercion -&gt; Coercion
</span><a href="GHC.Core.Coercion.html#promoteCoercion"><span class="hs-identifier hs-var">promoteCoercion</span></a></span><span> </span><span class="annot"><span class="annottext">Coercion
</span><a href="#local-6989586621681034378"><span class="hs-identifier hs-var">lco</span></a></span><span>
</span><span id="line-1512"></span><span>           </span><span class="annot"><span class="annottext">LeftOrRight
</span><a href="GHC.Types.Basic.html#CRight"><span class="hs-identifier hs-var">CRight</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="annottext">Coercion -&gt; Coercion
</span><a href="GHC.Core.Coercion.html#promoteCoercion"><span class="hs-identifier hs-var">promoteCoercion</span></a></span><span> </span><span class="annot"><span class="annottext">Coercion
</span><a href="#local-6989586621681034377"><span class="hs-identifier hs-var">rco</span></a></span><span>
</span><span id="line-1513"></span><span>
</span><span id="line-1514"></span><span>      </span><span class="hs-glyph">|</span><span> </span><span class="annot"><span class="annottext">Bool
</span><a href="../../base-4.16.4.0/src/GHC-Base.html#otherwise"><span class="hs-identifier hs-var">otherwise</span></a></span><span>
</span><span id="line-1515"></span><span>      </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="annottext">Coercion -&gt; Coercion
</span><a href="GHC.Core.Coercion.html#mkKindCo"><span class="hs-identifier hs-var">mkKindCo</span></a></span><span> </span><span class="annot"><span class="annottext">Coercion
</span><a href="#local-6989586621681034405"><span class="hs-identifier hs-var">co</span></a></span><span>
</span><span id="line-1516"></span><span>
</span><span id="line-1517"></span><span>    </span><span class="annot"><a href="GHC.Core.TyCo.Rep.html#InstCo"><span class="hs-identifier hs-type">InstCo</span></a></span><span> </span><span id="local-6989586621681034374"><span class="annot"><span class="annottext">Coercion
</span><a href="#local-6989586621681034374"><span class="hs-identifier hs-var">g</span></a></span></span><span> </span><span class="annot"><span class="annottext">Coercion
</span><span class="hs-identifier">_</span></span><span>
</span><span id="line-1518"></span><span>      </span><span class="hs-glyph">|</span><span> </span><span class="annot"><span class="annottext">Type -&gt; Bool
</span><a href="GHC.Core.Type.html#isForAllTy_ty"><span class="hs-identifier hs-var">isForAllTy_ty</span></a></span><span> </span><span class="annot"><span class="annottext">Type
</span><a href="#local-6989586621681034402"><span class="hs-identifier hs-var">ty1</span></a></span><span>
</span><span id="line-1519"></span><span>      </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-identifier">ASSERT</span><span class="hs-special">(</span><span> </span><span class="hs-identifier">isForAllTy_ty</span><span> </span><span class="hs-identifier">ty2</span><span> </span><span class="hs-special">)</span><span>
</span><span id="line-1520"></span><span>         </span><span class="annot"><span class="annottext">Coercion -&gt; Coercion
</span><a href="GHC.Core.Coercion.html#promoteCoercion"><span class="hs-identifier hs-var">promoteCoercion</span></a></span><span> </span><span class="annot"><span class="annottext">Coercion
</span><a href="#local-6989586621681034374"><span class="hs-identifier hs-var">g</span></a></span><span>
</span><span id="line-1521"></span><span>      </span><span class="hs-glyph">|</span><span> </span><span class="annot"><span class="annottext">Bool
</span><a href="../../base-4.16.4.0/src/GHC-Base.html#otherwise"><span class="hs-identifier hs-var">otherwise</span></a></span><span>
</span><span id="line-1522"></span><span>      </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-identifier">ASSERT</span><span class="hs-special">(</span><span> </span><span class="hs-identifier">False</span><span class="hs-special">)</span><span>
</span><span id="line-1523"></span><span>         </span><span class="annot"><span class="annottext">Type -&gt; Coercion
</span><a href="GHC.Core.Coercion.html#mkNomReflCo"><span class="hs-identifier hs-var">mkNomReflCo</span></a></span><span> </span><span class="annot"><span class="annottext">Type
</span><a href="GHC.Builtin.Types.html#liftedTypeKind"><span class="hs-identifier hs-var">liftedTypeKind</span></a></span><span>
</span><span id="line-1524"></span><span>           </span><span class="hs-comment">-- See Note [Weird typing rule for ForAllTy] in GHC.Core.TyCo.Rep</span><span>
</span><span id="line-1525"></span><span>
</span><span id="line-1526"></span><span>    </span><span class="annot"><a href="GHC.Core.TyCo.Rep.html#KindCo"><span class="hs-identifier hs-type">KindCo</span></a></span><span> </span><span class="annot"><span class="annottext">Coercion
</span><span class="hs-identifier">_</span></span><span>
</span><span id="line-1527"></span><span>      </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-identifier">ASSERT</span><span class="hs-special">(</span><span> </span><span class="hs-identifier">False</span><span> </span><span class="hs-special">)</span><span>
</span><span id="line-1528"></span><span>         </span><span class="annot"><span class="annottext">Type -&gt; Coercion
</span><a href="GHC.Core.Coercion.html#mkNomReflCo"><span class="hs-identifier hs-var">mkNomReflCo</span></a></span><span> </span><span class="annot"><span class="annottext">Type
</span><a href="GHC.Builtin.Types.html#liftedTypeKind"><span class="hs-identifier hs-var">liftedTypeKind</span></a></span><span>
</span><span id="line-1529"></span><span>
</span><span id="line-1530"></span><span>    </span><span class="annot"><a href="GHC.Core.TyCo.Rep.html#SubCo"><span class="hs-identifier hs-type">SubCo</span></a></span><span> </span><span id="local-6989586621681034371"><span class="annot"><span class="annottext">Coercion
</span><a href="#local-6989586621681034371"><span class="hs-identifier hs-var">g</span></a></span></span><span>
</span><span id="line-1531"></span><span>      </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="annottext">Coercion -&gt; Coercion
</span><a href="GHC.Core.Coercion.html#promoteCoercion"><span class="hs-identifier hs-var">promoteCoercion</span></a></span><span> </span><span class="annot"><span class="annottext">Coercion
</span><a href="#local-6989586621681034371"><span class="hs-identifier hs-var">g</span></a></span><span>
</span><span id="line-1532"></span><span>
</span><span id="line-1533"></span><span>  </span><span class="hs-keyword">where</span><span>
</span><span id="line-1534"></span><span>    </span><span class="annot"><a href="GHC.Data.Pair.html#Pair"><span class="hs-identifier hs-type">Pair</span></a></span><span> </span><span id="local-6989586621681034402"><span class="annot"><span class="annottext">Type
</span><a href="#local-6989586621681034402"><span class="hs-identifier hs-var">ty1</span></a></span></span><span> </span><span id="local-6989586621681034372"><span class="annot"><span class="annottext">Type
</span><a href="#local-6989586621681034372"><span class="hs-identifier hs-var">ty2</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">Coercion -&gt; Pair Type
</span><a href="GHC.Core.Coercion.html#coercionKind"><span class="hs-identifier hs-var">coercionKind</span></a></span><span> </span><span class="annot"><span class="annottext">Coercion
</span><a href="#local-6989586621681034405"><span class="hs-identifier hs-var">co</span></a></span><span>
</span><span id="line-1535"></span><span>    </span><span id="local-6989586621681034404"><span class="annot"><span class="annottext">ki1 :: Type
</span><a href="#local-6989586621681034404"><span class="hs-identifier hs-var hs-var">ki1</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">HasDebugCallStack =&gt; Type -&gt; Type
</span><a href="GHC.Core.Type.html#typeKind"><span class="hs-identifier hs-var">typeKind</span></a></span><span> </span><span class="annot"><span class="annottext">Type
</span><a href="#local-6989586621681034402"><span class="hs-identifier hs-var">ty1</span></a></span><span>
</span><span id="line-1536"></span><span>    </span><span id="local-6989586621681034403"><span class="annot"><span class="annottext">ki2 :: Type
</span><a href="#local-6989586621681034403"><span class="hs-identifier hs-var hs-var">ki2</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">HasDebugCallStack =&gt; Type -&gt; Type
</span><a href="GHC.Core.Type.html#typeKind"><span class="hs-identifier hs-var">typeKind</span></a></span><span> </span><span class="annot"><span class="annottext">Type
</span><a href="#local-6989586621681034372"><span class="hs-identifier hs-var">ty2</span></a></span><span>
</span><span id="line-1537"></span><span>
</span><span id="line-1538"></span><span class="hs-comment">-- | say @g = promoteCoercion h@. Then, @instCoercion g w@ yields @Just g'@,</span><span>
</span><span id="line-1539"></span><span class="hs-comment">-- where @g' = promoteCoercion (h w)@.</span><span>
</span><span id="line-1540"></span><span class="hs-comment">-- fails if this is not possible, if @g@ coerces between a forall and an -&gt;</span><span>
</span><span id="line-1541"></span><span class="hs-comment">-- or if second parameter has a representational role and can't be used</span><span>
</span><span id="line-1542"></span><span class="hs-comment">-- with an InstCo.</span><span>
</span><span id="line-1543"></span><span class="annot"><a href="GHC.Core.Coercion.html#instCoercion"><span class="hs-identifier hs-type">instCoercion</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><a href="GHC.Data.Pair.html#Pair"><span class="hs-identifier hs-type">Pair</span></a></span><span> </span><span class="annot"><a href="GHC.Core.TyCo.Rep.html#Type"><span class="hs-identifier hs-type">Type</span></a></span><span> </span><span class="hs-comment">-- g :: lty ~ rty</span><span>
</span><span id="line-1544"></span><span>             </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="GHC.Core.TyCo.Rep.html#CoercionN"><span class="hs-identifier hs-type">CoercionN</span></a></span><span>  </span><span class="hs-comment">-- ^  must be nominal</span><span>
</span><span id="line-1545"></span><span>             </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="GHC.Core.TyCo.Rep.html#Coercion"><span class="hs-identifier hs-type">Coercion</span></a></span><span>
</span><span id="line-1546"></span><span>             </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="../../base-4.16.4.0/src/GHC-Maybe.html#Maybe"><span class="hs-identifier hs-type">Maybe</span></a></span><span> </span><span class="annot"><a href="GHC.Core.TyCo.Rep.html#CoercionN"><span class="hs-identifier hs-type">CoercionN</span></a></span><span>
</span><span id="line-1547"></span><span id="instCoercion"><span class="annot"><span class="annottext">instCoercion :: Pair Type -&gt; Coercion -&gt; Coercion -&gt; Maybe Coercion
</span><a href="GHC.Core.Coercion.html#instCoercion"><span class="hs-identifier hs-var hs-var">instCoercion</span></a></span></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="GHC.Data.Pair.html#Pair"><span class="hs-identifier hs-type">Pair</span></a></span><span> </span><span id="local-6989586621681034370"><span class="annot"><span class="annottext">Type
</span><a href="#local-6989586621681034370"><span class="hs-identifier hs-var">lty</span></a></span></span><span> </span><span id="local-6989586621681034369"><span class="annot"><span class="annottext">Type
</span><a href="#local-6989586621681034369"><span class="hs-identifier hs-var">rty</span></a></span></span><span class="hs-special">)</span><span> </span><span id="local-6989586621681034368"><span class="annot"><span class="annottext">Coercion
</span><a href="#local-6989586621681034368"><span class="hs-identifier hs-var">g</span></a></span></span><span> </span><span id="local-6989586621681034367"><span class="annot"><span class="annottext">Coercion
</span><a href="#local-6989586621681034367"><span class="hs-identifier hs-var">w</span></a></span></span><span>
</span><span id="line-1548"></span><span>  </span><span class="hs-glyph">|</span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Type -&gt; Bool
</span><a href="GHC.Core.Type.html#isForAllTy_ty"><span class="hs-identifier hs-var">isForAllTy_ty</span></a></span><span> </span><span class="annot"><span class="annottext">Type
</span><a href="#local-6989586621681034370"><span class="hs-identifier hs-var">lty</span></a></span><span> </span><span class="annot"><span class="annottext">Bool -&gt; Bool -&gt; Bool
</span><span class="hs-operator hs-var">&amp;&amp;</span></span><span> </span><span class="annot"><span class="annottext">Type -&gt; Bool
</span><a href="GHC.Core.Type.html#isForAllTy_ty"><span class="hs-identifier hs-var">isForAllTy_ty</span></a></span><span> </span><span class="annot"><span class="annottext">Type
</span><a href="#local-6989586621681034369"><span class="hs-identifier hs-var">rty</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-1549"></span><span>  </span><span class="annot"><span class="annottext">Bool -&gt; Bool -&gt; Bool
</span><span class="hs-operator hs-var">||</span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Type -&gt; Bool
</span><a href="GHC.Core.Type.html#isForAllTy_co"><span class="hs-identifier hs-var">isForAllTy_co</span></a></span><span> </span><span class="annot"><span class="annottext">Type
</span><a href="#local-6989586621681034370"><span class="hs-identifier hs-var">lty</span></a></span><span> </span><span class="annot"><span class="annottext">Bool -&gt; Bool -&gt; Bool
</span><span class="hs-operator hs-var">&amp;&amp;</span></span><span> </span><span class="annot"><span class="annottext">Type -&gt; Bool
</span><a href="GHC.Core.Type.html#isForAllTy_co"><span class="hs-identifier hs-var">isForAllTy_co</span></a></span><span> </span><span class="annot"><span class="annottext">Type
</span><a href="#local-6989586621681034369"><span class="hs-identifier hs-var">rty</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-1550"></span><span>  </span><span class="hs-special">,</span><span> </span><span class="annot"><a href="../../base-4.16.4.0/src/GHC-Maybe.html#Just"><span class="hs-identifier hs-type">Just</span></a></span><span> </span><span id="local-6989586621681034365"><span class="annot"><span class="annottext">Coercion
</span><a href="#local-6989586621681034365"><span class="hs-identifier hs-var">w'</span></a></span></span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">Role -&gt; Coercion -&gt; Maybe Coercion
</span><a href="GHC.Core.Coercion.html#setNominalRole_maybe"><span class="hs-identifier hs-var">setNominalRole_maybe</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Coercion -&gt; Role
</span><a href="GHC.Core.Coercion.html#coercionRole"><span class="hs-identifier hs-var">coercionRole</span></a></span><span> </span><span class="annot"><span class="annottext">Coercion
</span><a href="#local-6989586621681034367"><span class="hs-identifier hs-var">w</span></a></span><span class="hs-special">)</span><span> </span><span class="annot"><span class="annottext">Coercion
</span><a href="#local-6989586621681034367"><span class="hs-identifier hs-var">w</span></a></span><span>
</span><span id="line-1551"></span><span>    </span><span class="hs-comment">-- g :: (forall t1. t2) ~ (forall t1. t3)</span><span>
</span><span id="line-1552"></span><span>    </span><span class="hs-comment">-- w :: s1 ~ s2</span><span>
</span><span id="line-1553"></span><span>    </span><span class="hs-comment">-- returns mkInstCo g w' :: t2 [t1 |-&gt; s1 ] ~ t3 [t1 |-&gt; s2]</span><span>
</span><span id="line-1554"></span><span>  </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">forall a. a -&gt; Maybe a
</span><a href="../../base-4.16.4.0/src/GHC-Maybe.html#Just"><span class="hs-identifier hs-var">Just</span></a></span><span> </span><span class="annot"><span class="annottext">forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><a href="../../base-4.16.4.0/src/GHC-Base.html#%24"><span class="hs-operator hs-var">$</span></a></span><span> </span><span class="annot"><span class="annottext">Coercion -&gt; Coercion -&gt; Coercion
</span><a href="GHC.Core.Coercion.html#mkInstCo"><span class="hs-identifier hs-var">mkInstCo</span></a></span><span> </span><span class="annot"><span class="annottext">Coercion
</span><a href="#local-6989586621681034368"><span class="hs-identifier hs-var">g</span></a></span><span> </span><span class="annot"><span class="annottext">Coercion
</span><a href="#local-6989586621681034365"><span class="hs-identifier hs-var">w'</span></a></span><span>
</span><span id="line-1555"></span><span>  </span><span class="hs-glyph">|</span><span> </span><span class="annot"><span class="annottext">Type -&gt; Bool
</span><a href="GHC.Core.Type.html#isFunTy"><span class="hs-identifier hs-var">isFunTy</span></a></span><span> </span><span class="annot"><span class="annottext">Type
</span><a href="#local-6989586621681034370"><span class="hs-identifier hs-var">lty</span></a></span><span> </span><span class="annot"><span class="annottext">Bool -&gt; Bool -&gt; Bool
</span><span class="hs-operator hs-var">&amp;&amp;</span></span><span> </span><span class="annot"><span class="annottext">Type -&gt; Bool
</span><a href="GHC.Core.Type.html#isFunTy"><span class="hs-identifier hs-var">isFunTy</span></a></span><span> </span><span class="annot"><span class="annottext">Type
</span><a href="#local-6989586621681034369"><span class="hs-identifier hs-var">rty</span></a></span><span>
</span><span id="line-1556"></span><span>    </span><span class="hs-comment">-- g :: (t1 -&gt; t2) ~ (t3 -&gt; t4)</span><span>
</span><span id="line-1557"></span><span>    </span><span class="hs-comment">-- returns t2 ~ t4</span><span>
</span><span id="line-1558"></span><span>  </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">forall a. a -&gt; Maybe a
</span><a href="../../base-4.16.4.0/src/GHC-Maybe.html#Just"><span class="hs-identifier hs-var">Just</span></a></span><span> </span><span class="annot"><span class="annottext">forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><a href="../../base-4.16.4.0/src/GHC-Base.html#%24"><span class="hs-operator hs-var">$</span></a></span><span> </span><span class="annot"><span class="annottext">HasDebugCallStack =&gt; Role -&gt; Int -&gt; Coercion -&gt; Coercion
</span><a href="GHC.Core.Coercion.html#mkNthCo"><span class="hs-identifier hs-var">mkNthCo</span></a></span><span> </span><span class="annot"><span class="annottext">Role
</span><a href="GHC.Core.Coercion.Axiom.html#Nominal"><span class="hs-identifier hs-var">Nominal</span></a></span><span> </span><span class="annot"><span class="annottext">Int
</span><span class="hs-number">4</span></span><span> </span><span class="annot"><span class="annottext">Coercion
</span><a href="#local-6989586621681034368"><span class="hs-identifier hs-var">g</span></a></span><span> </span><span class="hs-comment">-- extract result type, which is the 5th argument to (-&gt;)</span><span>
</span><span id="line-1559"></span><span>  </span><span class="hs-glyph">|</span><span> </span><span class="annot"><span class="annottext">Bool
</span><a href="../../base-4.16.4.0/src/GHC-Base.html#otherwise"><span class="hs-identifier hs-var">otherwise</span></a></span><span> </span><span class="hs-comment">-- one forall, one funty...</span><span>
</span><span id="line-1560"></span><span>  </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">forall a. Maybe a
</span><a href="../../base-4.16.4.0/src/GHC-Maybe.html#Nothing"><span class="hs-identifier hs-var">Nothing</span></a></span><span>
</span><span id="line-1561"></span><span>
</span><span id="line-1562"></span><span class="hs-comment">-- | Repeated use of 'instCoercion'</span><span>
</span><span id="line-1563"></span><span class="annot"><a href="GHC.Core.Coercion.html#instCoercions"><span class="hs-identifier hs-type">instCoercions</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><a href="GHC.Core.TyCo.Rep.html#CoercionN"><span class="hs-identifier hs-type">CoercionN</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-special">[</span><span class="annot"><a href="GHC.Core.TyCo.Rep.html#Coercion"><span class="hs-identifier hs-type">Coercion</span></a></span><span class="hs-special">]</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="../../base-4.16.4.0/src/GHC-Maybe.html#Maybe"><span class="hs-identifier hs-type">Maybe</span></a></span><span> </span><span class="annot"><a href="GHC.Core.TyCo.Rep.html#CoercionN"><span class="hs-identifier hs-type">CoercionN</span></a></span><span>
</span><span id="line-1564"></span><span id="instCoercions"><span class="annot"><span class="annottext">instCoercions :: Coercion -&gt; [Coercion] -&gt; Maybe Coercion
</span><a href="GHC.Core.Coercion.html#instCoercions"><span class="hs-identifier hs-var hs-var">instCoercions</span></a></span></span><span> </span><span id="local-6989586621681034364"><span class="annot"><span class="annottext">Coercion
</span><a href="#local-6989586621681034364"><span class="hs-identifier hs-var">g</span></a></span></span><span> </span><span id="local-6989586621681034363"><span class="annot"><span class="annottext">[Coercion]
</span><a href="#local-6989586621681034363"><span class="hs-identifier hs-var">ws</span></a></span></span><span>
</span><span id="line-1565"></span><span>  </span><span class="hs-glyph">=</span><span> </span><span class="hs-keyword">let</span><span> </span><span id="local-6989586621681034362"><span class="annot"><span class="annottext">arg_ty_pairs :: [Pair Type]
</span><a href="#local-6989586621681034362"><span class="hs-identifier hs-var hs-var">arg_ty_pairs</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">forall a b. (a -&gt; b) -&gt; [a] -&gt; [b]
</span><a href="../../base-4.16.4.0/src/GHC-Base.html#map"><span class="hs-identifier hs-var">map</span></a></span><span> </span><span class="annot"><span class="annottext">Coercion -&gt; Pair Type
</span><a href="GHC.Core.Coercion.html#coercionKind"><span class="hs-identifier hs-var">coercionKind</span></a></span><span> </span><span class="annot"><span class="annottext">[Coercion]
</span><a href="#local-6989586621681034363"><span class="hs-identifier hs-var">ws</span></a></span><span> </span><span class="hs-keyword">in</span><span>
</span><span id="line-1566"></span><span>    </span><span class="annot"><span class="annottext">forall a b. (a, b) -&gt; b
</span><a href="../../base-4.16.4.0/src/Data-Tuple.html#snd"><span class="hs-identifier hs-var">snd</span></a></span><span> </span><span class="annot"><span class="annottext">forall (f :: * -&gt; *) a b. Functor f =&gt; (a -&gt; b) -&gt; f a -&gt; f b
</span><a href="../../base-4.16.4.0/src/Data-Functor.html#%3C%24%3E"><span class="hs-operator hs-var">&lt;$&gt;</span></a></span><span> </span><span class="annot"><span class="annottext">forall (t :: * -&gt; *) (m :: * -&gt; *) b a.
(Foldable t, Monad m) =&gt;
(b -&gt; a -&gt; m b) -&gt; b -&gt; t a -&gt; m b
</span><a href="../../base-4.16.4.0/src/Control-Monad.html#foldM"><span class="hs-identifier hs-var">foldM</span></a></span><span> </span><span class="annot"><span class="annottext">(Pair Type, Coercion)
-&gt; (Pair Type, Coercion) -&gt; Maybe (Pair Type, Coercion)
</span><a href="#local-6989586621681034361"><span class="hs-identifier hs-var">go</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Coercion -&gt; Pair Type
</span><a href="GHC.Core.Coercion.html#coercionKind"><span class="hs-identifier hs-var">coercionKind</span></a></span><span> </span><span class="annot"><span class="annottext">Coercion
</span><a href="#local-6989586621681034364"><span class="hs-identifier hs-var">g</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">Coercion
</span><a href="#local-6989586621681034364"><span class="hs-identifier hs-var">g</span></a></span><span class="hs-special">)</span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">forall a b. [a] -&gt; [b] -&gt; [(a, b)]
</span><a href="../../base-4.16.4.0/src/GHC-List.html#zip"><span class="hs-identifier hs-var">zip</span></a></span><span> </span><span class="annot"><span class="annottext">[Pair Type]
</span><a href="#local-6989586621681034362"><span class="hs-identifier hs-var">arg_ty_pairs</span></a></span><span> </span><span class="annot"><span class="annottext">[Coercion]
</span><a href="#local-6989586621681034363"><span class="hs-identifier hs-var">ws</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-1567"></span><span>  </span><span class="hs-keyword">where</span><span>
</span><span id="line-1568"></span><span>    </span><span class="annot"><a href="#local-6989586621681034361"><span class="hs-identifier hs-type">go</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="hs-special">(</span><span class="annot"><a href="GHC.Data.Pair.html#Pair"><span class="hs-identifier hs-type">Pair</span></a></span><span> </span><span class="annot"><a href="GHC.Core.TyCo.Rep.html#Type"><span class="hs-identifier hs-type">Type</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><a href="GHC.Core.TyCo.Rep.html#Coercion"><span class="hs-identifier hs-type">Coercion</span></a></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-special">(</span><span class="annot"><a href="GHC.Data.Pair.html#Pair"><span class="hs-identifier hs-type">Pair</span></a></span><span> </span><span class="annot"><a href="GHC.Core.TyCo.Rep.html#Type"><span class="hs-identifier hs-type">Type</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><a href="GHC.Core.TyCo.Rep.html#Coercion"><span class="hs-identifier hs-type">Coercion</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-1569"></span><span>       </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="../../base-4.16.4.0/src/GHC-Maybe.html#Maybe"><span class="hs-identifier hs-type">Maybe</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="GHC.Data.Pair.html#Pair"><span class="hs-identifier hs-type">Pair</span></a></span><span> </span><span class="annot"><a href="GHC.Core.TyCo.Rep.html#Type"><span class="hs-identifier hs-type">Type</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><a href="GHC.Core.TyCo.Rep.html#Coercion"><span class="hs-identifier hs-type">Coercion</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-1570"></span><span>    </span><span id="local-6989586621681034361"><span class="annot"><span class="annottext">go :: (Pair Type, Coercion)
-&gt; (Pair Type, Coercion) -&gt; Maybe (Pair Type, Coercion)
</span><a href="#local-6989586621681034361"><span class="hs-identifier hs-var hs-var">go</span></a></span></span><span> </span><span class="hs-special">(</span><span id="local-6989586621681034360"><span class="annot"><span class="annottext">Pair Type
</span><a href="#local-6989586621681034360"><span class="hs-identifier hs-var">g_tys</span></a></span></span><span class="hs-special">,</span><span> </span><span id="local-6989586621681034359"><span class="annot"><span class="annottext">Coercion
</span><a href="#local-6989586621681034359"><span class="hs-identifier hs-var">g</span></a></span></span><span class="hs-special">)</span><span> </span><span class="hs-special">(</span><span id="local-6989586621681034358"><span class="annot"><span class="annottext">Pair Type
</span><a href="#local-6989586621681034358"><span class="hs-identifier hs-var">w_tys</span></a></span></span><span class="hs-special">,</span><span> </span><span id="local-6989586621681034357"><span class="annot"><span class="annottext">Coercion
</span><a href="#local-6989586621681034357"><span class="hs-identifier hs-var">w</span></a></span></span><span class="hs-special">)</span><span>
</span><span id="line-1571"></span><span>      </span><span class="hs-glyph">=</span><span> </span><span class="hs-keyword">do</span><span> </span><span class="hs-special">{</span><span> </span><span id="local-6989586621681034356"><span class="annot"><span class="annottext">Coercion
</span><a href="#local-6989586621681034356"><span class="hs-identifier hs-var">g'</span></a></span></span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">Pair Type -&gt; Coercion -&gt; Coercion -&gt; Maybe Coercion
</span><a href="GHC.Core.Coercion.html#instCoercion"><span class="hs-identifier hs-var">instCoercion</span></a></span><span> </span><span class="annot"><span class="annottext">Pair Type
</span><a href="#local-6989586621681034360"><span class="hs-identifier hs-var">g_tys</span></a></span><span> </span><span class="annot"><span class="annottext">Coercion
</span><a href="#local-6989586621681034359"><span class="hs-identifier hs-var">g</span></a></span><span> </span><span class="annot"><span class="annottext">Coercion
</span><a href="#local-6989586621681034357"><span class="hs-identifier hs-var">w</span></a></span><span>
</span><span id="line-1572"></span><span>           </span><span class="hs-special">;</span><span> </span><span class="annot"><span class="annottext">forall (m :: * -&gt; *) a. Monad m =&gt; a -&gt; m a
</span><a href="../../base-4.16.4.0/src/GHC-Base.html#return"><span class="hs-identifier hs-var">return</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">HasDebugCallStack =&gt; Type -&gt; Type -&gt; Type
</span><a href="GHC.Core.Type.html#piResultTy"><span class="hs-identifier hs-var">piResultTy</span></a></span><span> </span><span class="annot"><span class="annottext">forall (f :: * -&gt; *) a b. Functor f =&gt; (a -&gt; b) -&gt; f a -&gt; f b
</span><a href="../../base-4.16.4.0/src/Data-Functor.html#%3C%24%3E"><span class="hs-operator hs-var">&lt;$&gt;</span></a></span><span> </span><span class="annot"><span class="annottext">Pair Type
</span><a href="#local-6989586621681034360"><span class="hs-identifier hs-var">g_tys</span></a></span><span> </span><span class="annot"><span class="annottext">forall (f :: * -&gt; *) a b. Applicative f =&gt; f (a -&gt; b) -&gt; f a -&gt; f b
</span><a href="../../base-4.16.4.0/src/GHC-Base.html#%3C%2A%3E"><span class="hs-operator hs-var">&lt;*&gt;</span></a></span><span> </span><span class="annot"><span class="annottext">Pair Type
</span><a href="#local-6989586621681034358"><span class="hs-identifier hs-var">w_tys</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">Coercion
</span><a href="#local-6989586621681034356"><span class="hs-identifier hs-var">g'</span></a></span><span class="hs-special">)</span><span> </span><span class="hs-special">}</span><span>
</span><span id="line-1573"></span><span>
</span><span id="line-1574"></span><span class="hs-comment">-- | Creates a new coercion with both of its types casted by different casts</span><span>
</span><span id="line-1575"></span><span class="hs-comment">-- @castCoercionKind2 g r t1 t2 h1 h2@, where @g :: t1 ~r t2@,</span><span>
</span><span id="line-1576"></span><span class="hs-comment">-- has type @(t1 |&gt; h1) ~r (t2 |&gt; h2)@.</span><span>
</span><span id="line-1577"></span><span class="hs-comment">-- @h1@ and @h2@ must be nominal.</span><span>
</span><span id="line-1578"></span><span class="annot"><a href="GHC.Core.Coercion.html#castCoercionKind2"><span class="hs-identifier hs-type">castCoercionKind2</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><a href="GHC.Core.TyCo.Rep.html#Coercion"><span class="hs-identifier hs-type">Coercion</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="GHC.Core.Coercion.Axiom.html#Role"><span class="hs-identifier hs-type">Role</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="GHC.Core.TyCo.Rep.html#Type"><span class="hs-identifier hs-type">Type</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="GHC.Core.TyCo.Rep.html#Type"><span class="hs-identifier hs-type">Type</span></a></span><span>
</span><span id="line-1579"></span><span>                 </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="GHC.Core.TyCo.Rep.html#CoercionN"><span class="hs-identifier hs-type">CoercionN</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="GHC.Core.TyCo.Rep.html#CoercionN"><span class="hs-identifier hs-type">CoercionN</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="GHC.Core.TyCo.Rep.html#Coercion"><span class="hs-identifier hs-type">Coercion</span></a></span><span>
</span><span id="line-1580"></span><span id="castCoercionKind2"><span class="annot"><span class="annottext">castCoercionKind2 :: Coercion
-&gt; Role -&gt; Type -&gt; Type -&gt; Coercion -&gt; Coercion -&gt; Coercion
</span><a href="GHC.Core.Coercion.html#castCoercionKind2"><span class="hs-identifier hs-var hs-var">castCoercionKind2</span></a></span></span><span> </span><span id="local-6989586621681034354"><span class="annot"><span class="annottext">Coercion
</span><a href="#local-6989586621681034354"><span class="hs-identifier hs-var">g</span></a></span></span><span> </span><span id="local-6989586621681034353"><span class="annot"><span class="annottext">Role
</span><a href="#local-6989586621681034353"><span class="hs-identifier hs-var">r</span></a></span></span><span> </span><span id="local-6989586621681034352"><span class="annot"><span class="annottext">Type
</span><a href="#local-6989586621681034352"><span class="hs-identifier hs-var">t1</span></a></span></span><span> </span><span id="local-6989586621681034351"><span class="annot"><span class="annottext">Type
</span><a href="#local-6989586621681034351"><span class="hs-identifier hs-var">t2</span></a></span></span><span> </span><span id="local-6989586621681034350"><span class="annot"><span class="annottext">Coercion
</span><a href="#local-6989586621681034350"><span class="hs-identifier hs-var">h1</span></a></span></span><span> </span><span id="local-6989586621681034349"><span class="annot"><span class="annottext">Coercion
</span><a href="#local-6989586621681034349"><span class="hs-identifier hs-var">h2</span></a></span></span><span>
</span><span id="line-1581"></span><span>  </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">Role -&gt; Type -&gt; Coercion -&gt; Coercion -&gt; Coercion
</span><a href="GHC.Core.Coercion.html#mkCoherenceRightCo"><span class="hs-identifier hs-var">mkCoherenceRightCo</span></a></span><span> </span><span class="annot"><span class="annottext">Role
</span><a href="#local-6989586621681034353"><span class="hs-identifier hs-var">r</span></a></span><span> </span><span class="annot"><span class="annottext">Type
</span><a href="#local-6989586621681034351"><span class="hs-identifier hs-var">t2</span></a></span><span> </span><span class="annot"><span class="annottext">Coercion
</span><a href="#local-6989586621681034349"><span class="hs-identifier hs-var">h2</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Role -&gt; Type -&gt; Coercion -&gt; Coercion -&gt; Coercion
</span><a href="GHC.Core.Coercion.html#mkCoherenceLeftCo"><span class="hs-identifier hs-var">mkCoherenceLeftCo</span></a></span><span> </span><span class="annot"><span class="annottext">Role
</span><a href="#local-6989586621681034353"><span class="hs-identifier hs-var">r</span></a></span><span> </span><span class="annot"><span class="annottext">Type
</span><a href="#local-6989586621681034352"><span class="hs-identifier hs-var">t1</span></a></span><span> </span><span class="annot"><span class="annottext">Coercion
</span><a href="#local-6989586621681034350"><span class="hs-identifier hs-var">h1</span></a></span><span> </span><span class="annot"><span class="annottext">Coercion
</span><a href="#local-6989586621681034354"><span class="hs-identifier hs-var">g</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-1582"></span><span>
</span><span id="line-1583"></span><span class="hs-comment">-- | @castCoercionKind1 g r t1 t2 h@ = @coercionKind g r t1 t2 h h@</span><span>
</span><span id="line-1584"></span><span class="hs-comment">-- That is, it's a specialised form of castCoercionKind, where the two</span><span>
</span><span id="line-1585"></span><span class="hs-comment">--          kind coercions are identical</span><span>
</span><span id="line-1586"></span><span class="hs-comment">-- @castCoercionKind1 g r t1 t2 h@, where @g :: t1 ~r t2@,</span><span>
</span><span id="line-1587"></span><span class="hs-comment">-- has type @(t1 |&gt; h) ~r (t2 |&gt; h)@.</span><span>
</span><span id="line-1588"></span><span class="hs-comment">-- @h@ must be nominal.</span><span>
</span><span id="line-1589"></span><span class="hs-comment">-- See Note [castCoercionKind1]</span><span>
</span><span id="line-1590"></span><span class="annot"><a href="GHC.Core.Coercion.html#castCoercionKind1"><span class="hs-identifier hs-type">castCoercionKind1</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><a href="GHC.Core.TyCo.Rep.html#Coercion"><span class="hs-identifier hs-type">Coercion</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="GHC.Core.Coercion.Axiom.html#Role"><span class="hs-identifier hs-type">Role</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="GHC.Core.TyCo.Rep.html#Type"><span class="hs-identifier hs-type">Type</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="GHC.Core.TyCo.Rep.html#Type"><span class="hs-identifier hs-type">Type</span></a></span><span>
</span><span id="line-1591"></span><span>                  </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="GHC.Core.TyCo.Rep.html#CoercionN"><span class="hs-identifier hs-type">CoercionN</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="GHC.Core.TyCo.Rep.html#Coercion"><span class="hs-identifier hs-type">Coercion</span></a></span><span>
</span><span id="line-1592"></span><span id="castCoercionKind1"><span class="annot"><span class="annottext">castCoercionKind1 :: Coercion -&gt; Role -&gt; Type -&gt; Type -&gt; Coercion -&gt; Coercion
</span><a href="GHC.Core.Coercion.html#castCoercionKind1"><span class="hs-identifier hs-var hs-var">castCoercionKind1</span></a></span></span><span> </span><span id="local-6989586621681034348"><span class="annot"><span class="annottext">Coercion
</span><a href="#local-6989586621681034348"><span class="hs-identifier hs-var">g</span></a></span></span><span> </span><span id="local-6989586621681034347"><span class="annot"><span class="annottext">Role
</span><a href="#local-6989586621681034347"><span class="hs-identifier hs-var">r</span></a></span></span><span> </span><span id="local-6989586621681034346"><span class="annot"><span class="annottext">Type
</span><a href="#local-6989586621681034346"><span class="hs-identifier hs-var">t1</span></a></span></span><span> </span><span id="local-6989586621681034345"><span class="annot"><span class="annottext">Type
</span><a href="#local-6989586621681034345"><span class="hs-identifier hs-var">t2</span></a></span></span><span> </span><span id="local-6989586621681034344"><span class="annot"><span class="annottext">Coercion
</span><a href="#local-6989586621681034344"><span class="hs-identifier hs-var">h</span></a></span></span><span>
</span><span id="line-1593"></span><span>  </span><span class="hs-glyph">=</span><span> </span><span class="hs-keyword">case</span><span> </span><span class="annot"><span class="annottext">Coercion
</span><a href="#local-6989586621681034348"><span class="hs-identifier hs-var">g</span></a></span><span> </span><span class="hs-keyword">of</span><span>
</span><span id="line-1594"></span><span>      </span><span class="annot"><a href="GHC.Core.TyCo.Rep.html#Refl"><span class="hs-identifier hs-type">Refl</span></a></span><span> </span><span class="hs-special">{</span><span class="hs-special">}</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-identifier">ASSERT</span><span class="hs-special">(</span><span> </span><span class="hs-identifier">r</span><span> </span><span class="hs-operator">==</span><span> </span><span class="hs-identifier">Nominal</span><span> </span><span class="hs-special">)</span><span> </span><span class="hs-comment">-- Refl is always Nominal</span><span>
</span><span id="line-1595"></span><span>                 </span><span class="annot"><span class="annottext">Type -&gt; Coercion
</span><a href="GHC.Core.Coercion.html#mkNomReflCo"><span class="hs-identifier hs-var">mkNomReflCo</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Type -&gt; Coercion -&gt; Type
</span><a href="GHC.Core.Type.html#mkCastTy"><span class="hs-identifier hs-var">mkCastTy</span></a></span><span> </span><span class="annot"><span class="annottext">Type
</span><a href="#local-6989586621681034345"><span class="hs-identifier hs-var">t2</span></a></span><span> </span><span class="annot"><span class="annottext">Coercion
</span><a href="#local-6989586621681034344"><span class="hs-identifier hs-var">h</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-1596"></span><span>      </span><span class="annot"><a href="GHC.Core.TyCo.Rep.html#GRefl"><span class="hs-identifier hs-type">GRefl</span></a></span><span> </span><span class="annot"><span class="annottext">Role
</span><span class="hs-identifier">_</span></span><span> </span><span class="annot"><span class="annottext">Type
</span><span class="hs-identifier">_</span></span><span> </span><span id="local-6989586621681034343"><span class="annot"><span class="annottext">MCoercion
</span><a href="#local-6989586621681034343"><span class="hs-identifier hs-var">mco</span></a></span></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-keyword">case</span><span> </span><span class="annot"><span class="annottext">MCoercion
</span><a href="#local-6989586621681034343"><span class="hs-identifier hs-var">mco</span></a></span><span> </span><span class="hs-keyword">of</span><span>
</span><span id="line-1597"></span><span>           </span><span class="annot"><span class="annottext">MCoercion
</span><a href="GHC.Core.TyCo.Rep.html#MRefl"><span class="hs-identifier hs-var">MRefl</span></a></span><span>       </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="annottext">Role -&gt; Type -&gt; Coercion
</span><a href="GHC.Core.Coercion.html#mkReflCo"><span class="hs-identifier hs-var">mkReflCo</span></a></span><span> </span><span class="annot"><span class="annottext">Role
</span><a href="#local-6989586621681034347"><span class="hs-identifier hs-var">r</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Type -&gt; Coercion -&gt; Type
</span><a href="GHC.Core.Type.html#mkCastTy"><span class="hs-identifier hs-var">mkCastTy</span></a></span><span> </span><span class="annot"><span class="annottext">Type
</span><a href="#local-6989586621681034345"><span class="hs-identifier hs-var">t2</span></a></span><span> </span><span class="annot"><span class="annottext">Coercion
</span><a href="#local-6989586621681034344"><span class="hs-identifier hs-var">h</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-1598"></span><span>           </span><span class="annot"><a href="GHC.Core.TyCo.Rep.html#MCo"><span class="hs-identifier hs-type">MCo</span></a></span><span> </span><span id="local-6989586621681034342"><span class="annot"><span class="annottext">Coercion
</span><a href="#local-6989586621681034342"><span class="hs-identifier hs-var">kind_co</span></a></span></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="annottext">Role -&gt; Type -&gt; MCoercion -&gt; Coercion
</span><a href="GHC.Core.TyCo.Rep.html#GRefl"><span class="hs-identifier hs-var">GRefl</span></a></span><span> </span><span class="annot"><span class="annottext">Role
</span><a href="#local-6989586621681034347"><span class="hs-identifier hs-var">r</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Type -&gt; Coercion -&gt; Type
</span><a href="GHC.Core.Type.html#mkCastTy"><span class="hs-identifier hs-var">mkCastTy</span></a></span><span> </span><span class="annot"><span class="annottext">Type
</span><a href="#local-6989586621681034346"><span class="hs-identifier hs-var">t1</span></a></span><span> </span><span class="annot"><span class="annottext">Coercion
</span><a href="#local-6989586621681034344"><span class="hs-identifier hs-var">h</span></a></span><span class="hs-special">)</span><span> </span><span class="annot"><span class="annottext">forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><a href="../../base-4.16.4.0/src/GHC-Base.html#%24"><span class="hs-operator hs-var">$</span></a></span><span>
</span><span id="line-1599"></span><span>                          </span><span class="annot"><span class="annottext">Coercion -&gt; MCoercion
</span><a href="GHC.Core.TyCo.Rep.html#MCo"><span class="hs-identifier hs-var">MCo</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Coercion -&gt; Coercion
</span><a href="GHC.Core.Coercion.html#mkSymCo"><span class="hs-identifier hs-var">mkSymCo</span></a></span><span> </span><span class="annot"><span class="annottext">Coercion
</span><a href="#local-6989586621681034344"><span class="hs-identifier hs-var">h</span></a></span><span> </span><span class="annot"><span class="annottext">Coercion -&gt; Coercion -&gt; Coercion
</span><a href="GHC.Core.Coercion.html#mkTransCo"><span class="hs-operator hs-var">`mkTransCo`</span></a></span><span> </span><span class="annot"><span class="annottext">Coercion
</span><a href="#local-6989586621681034342"><span class="hs-identifier hs-var">kind_co</span></a></span><span> </span><span class="annot"><span class="annottext">Coercion -&gt; Coercion -&gt; Coercion
</span><a href="GHC.Core.Coercion.html#mkTransCo"><span class="hs-operator hs-var">`mkTransCo`</span></a></span><span> </span><span class="annot"><span class="annottext">Coercion
</span><a href="#local-6989586621681034344"><span class="hs-identifier hs-var">h</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-1600"></span><span>      </span><span class="annot"><span class="annottext">Coercion
</span><span class="hs-identifier">_</span></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="annottext">Coercion
-&gt; Role -&gt; Type -&gt; Type -&gt; Coercion -&gt; Coercion -&gt; Coercion
</span><a href="GHC.Core.Coercion.html#castCoercionKind2"><span class="hs-identifier hs-var">castCoercionKind2</span></a></span><span> </span><span class="annot"><span class="annottext">Coercion
</span><a href="#local-6989586621681034348"><span class="hs-identifier hs-var">g</span></a></span><span> </span><span class="annot"><span class="annottext">Role
</span><a href="#local-6989586621681034347"><span class="hs-identifier hs-var">r</span></a></span><span> </span><span class="annot"><span class="annottext">Type
</span><a href="#local-6989586621681034346"><span class="hs-identifier hs-var">t1</span></a></span><span> </span><span class="annot"><span class="annottext">Type
</span><a href="#local-6989586621681034345"><span class="hs-identifier hs-var">t2</span></a></span><span> </span><span class="annot"><span class="annottext">Coercion
</span><a href="#local-6989586621681034344"><span class="hs-identifier hs-var">h</span></a></span><span> </span><span class="annot"><span class="annottext">Coercion
</span><a href="#local-6989586621681034344"><span class="hs-identifier hs-var">h</span></a></span><span>
</span><span id="line-1601"></span><span>
</span><span id="line-1602"></span><span class="hs-comment">-- | Creates a new coercion with both of its types casted by different casts</span><span>
</span><span id="line-1603"></span><span class="hs-comment">-- @castCoercionKind g h1 h2@, where @g :: t1 ~r t2@,</span><span>
</span><span id="line-1604"></span><span class="hs-comment">-- has type @(t1 |&gt; h1) ~r (t2 |&gt; h2)@.</span><span>
</span><span id="line-1605"></span><span class="hs-comment">-- @h1@ and @h2@ must be nominal.</span><span>
</span><span id="line-1606"></span><span class="hs-comment">-- It calls @coercionKindRole@, so it's quite inefficient (which 'I' stands for)</span><span>
</span><span id="line-1607"></span><span class="hs-comment">-- Use @castCoercionKind2@ instead if @t1@, @t2@, and @r@ are known beforehand.</span><span>
</span><span id="line-1608"></span><span class="annot"><a href="GHC.Core.Coercion.html#castCoercionKind"><span class="hs-identifier hs-type">castCoercionKind</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><a href="GHC.Core.TyCo.Rep.html#Coercion"><span class="hs-identifier hs-type">Coercion</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="GHC.Core.TyCo.Rep.html#CoercionN"><span class="hs-identifier hs-type">CoercionN</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="GHC.Core.TyCo.Rep.html#CoercionN"><span class="hs-identifier hs-type">CoercionN</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="GHC.Core.TyCo.Rep.html#Coercion"><span class="hs-identifier hs-type">Coercion</span></a></span><span>
</span><span id="line-1609"></span><span id="castCoercionKind"><span class="annot"><span class="annottext">castCoercionKind :: Coercion -&gt; Coercion -&gt; Coercion -&gt; Coercion
</span><a href="GHC.Core.Coercion.html#castCoercionKind"><span class="hs-identifier hs-var hs-var">castCoercionKind</span></a></span></span><span> </span><span id="local-6989586621681034341"><span class="annot"><span class="annottext">Coercion
</span><a href="#local-6989586621681034341"><span class="hs-identifier hs-var">g</span></a></span></span><span> </span><span id="local-6989586621681034340"><span class="annot"><span class="annottext">Coercion
</span><a href="#local-6989586621681034340"><span class="hs-identifier hs-var">h1</span></a></span></span><span> </span><span id="local-6989586621681034339"><span class="annot"><span class="annottext">Coercion
</span><a href="#local-6989586621681034339"><span class="hs-identifier hs-var">h2</span></a></span></span><span>
</span><span id="line-1610"></span><span>  </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">Coercion
-&gt; Role -&gt; Type -&gt; Type -&gt; Coercion -&gt; Coercion -&gt; Coercion
</span><a href="GHC.Core.Coercion.html#castCoercionKind2"><span class="hs-identifier hs-var">castCoercionKind2</span></a></span><span> </span><span class="annot"><span class="annottext">Coercion
</span><a href="#local-6989586621681034341"><span class="hs-identifier hs-var">g</span></a></span><span> </span><span class="annot"><span class="annottext">Role
</span><a href="#local-6989586621681034338"><span class="hs-identifier hs-var">r</span></a></span><span> </span><span class="annot"><span class="annottext">Type
</span><a href="#local-6989586621681034337"><span class="hs-identifier hs-var">t1</span></a></span><span> </span><span class="annot"><span class="annottext">Type
</span><a href="#local-6989586621681034336"><span class="hs-identifier hs-var">t2</span></a></span><span> </span><span class="annot"><span class="annottext">Coercion
</span><a href="#local-6989586621681034340"><span class="hs-identifier hs-var">h1</span></a></span><span> </span><span class="annot"><span class="annottext">Coercion
</span><a href="#local-6989586621681034339"><span class="hs-identifier hs-var">h2</span></a></span><span>
</span><span id="line-1611"></span><span>  </span><span class="hs-keyword">where</span><span>
</span><span id="line-1612"></span><span>    </span><span class="hs-special">(</span><span class="annot"><a href="GHC.Data.Pair.html#Pair"><span class="hs-identifier hs-type">Pair</span></a></span><span> </span><span id="local-6989586621681034337"><span class="annot"><span class="annottext">Type
</span><a href="#local-6989586621681034337"><span class="hs-identifier hs-var">t1</span></a></span></span><span> </span><span id="local-6989586621681034336"><span class="annot"><span class="annottext">Type
</span><a href="#local-6989586621681034336"><span class="hs-identifier hs-var">t2</span></a></span></span><span class="hs-special">,</span><span> </span><span id="local-6989586621681034338"><span class="annot"><span class="annottext">Role
</span><a href="#local-6989586621681034338"><span class="hs-identifier hs-var">r</span></a></span></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">Coercion -&gt; (Pair Type, Role)
</span><a href="GHC.Core.Coercion.html#coercionKindRole"><span class="hs-identifier hs-var">coercionKindRole</span></a></span><span> </span><span class="annot"><span class="annottext">Coercion
</span><a href="#local-6989586621681034341"><span class="hs-identifier hs-var">g</span></a></span><span>
</span><span id="line-1613"></span><span>
</span><span id="line-1614"></span><span class="annot"><a href="GHC.Core.Coercion.html#mkFamilyTyConAppCo"><span class="hs-identifier hs-type">mkFamilyTyConAppCo</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><a href="GHC.Core.TyCon.html#TyCon"><span class="hs-identifier hs-type">TyCon</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-special">[</span><span class="annot"><a href="GHC.Core.TyCo.Rep.html#CoercionN"><span class="hs-identifier hs-type">CoercionN</span></a></span><span class="hs-special">]</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="GHC.Core.TyCo.Rep.html#CoercionN"><span class="hs-identifier hs-type">CoercionN</span></a></span><span>
</span><span id="line-1615"></span><span class="hs-comment">-- ^ Given a family instance 'TyCon' and its arg 'Coercion's, return the</span><span>
</span><span id="line-1616"></span><span class="hs-comment">-- corresponding family 'Coercion'.  E.g:</span><span>
</span><span id="line-1617"></span><span class="hs-comment">--</span><span>
</span><span id="line-1618"></span><span class="hs-comment">-- &gt; data family T a</span><span>
</span><span id="line-1619"></span><span class="hs-comment">-- &gt; data instance T (Maybe b) = MkT b</span><span>
</span><span id="line-1620"></span><span class="hs-comment">--</span><span>
</span><span id="line-1621"></span><span class="hs-comment">-- Where the instance 'TyCon' is :RTL, so:</span><span>
</span><span id="line-1622"></span><span class="hs-comment">--</span><span>
</span><span id="line-1623"></span><span class="hs-comment">-- &gt; mkFamilyTyConAppCo :RTL (co :: a ~# Int) = T (Maybe a) ~# T (Maybe Int)</span><span>
</span><span id="line-1624"></span><span class="hs-comment">--</span><span>
</span><span id="line-1625"></span><span class="hs-comment">-- cf. 'mkFamilyTyConApp'</span><span>
</span><span id="line-1626"></span><span id="mkFamilyTyConAppCo"><span class="annot"><span class="annottext">mkFamilyTyConAppCo :: TyCon -&gt; [Coercion] -&gt; Coercion
</span><a href="GHC.Core.Coercion.html#mkFamilyTyConAppCo"><span class="hs-identifier hs-var hs-var">mkFamilyTyConAppCo</span></a></span></span><span> </span><span id="local-6989586621681034335"><span class="annot"><span class="annottext">TyCon
</span><a href="#local-6989586621681034335"><span class="hs-identifier hs-var">tc</span></a></span></span><span> </span><span id="local-6989586621681034334"><span class="annot"><span class="annottext">[Coercion]
</span><a href="#local-6989586621681034334"><span class="hs-identifier hs-var">cos</span></a></span></span><span>
</span><span id="line-1627"></span><span>  </span><span class="hs-glyph">|</span><span> </span><span class="annot"><a href="../../base-4.16.4.0/src/GHC-Maybe.html#Just"><span class="hs-identifier hs-type">Just</span></a></span><span> </span><span class="hs-special">(</span><span id="local-6989586621681034333"><span class="annot"><span class="annottext">TyCon
</span><a href="#local-6989586621681034333"><span class="hs-identifier hs-var">fam_tc</span></a></span></span><span class="hs-special">,</span><span> </span><span id="local-6989586621681034332"><span class="annot"><span class="annottext">[Type]
</span><a href="#local-6989586621681034332"><span class="hs-identifier hs-var">fam_tys</span></a></span></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">TyCon -&gt; Maybe (TyCon, [Type])
</span><a href="GHC.Core.TyCon.html#tyConFamInst_maybe"><span class="hs-identifier hs-var">tyConFamInst_maybe</span></a></span><span> </span><span class="annot"><span class="annottext">TyCon
</span><a href="#local-6989586621681034335"><span class="hs-identifier hs-var">tc</span></a></span><span>
</span><span id="line-1628"></span><span>  </span><span class="hs-special">,</span><span> </span><span class="hs-keyword">let</span><span> </span><span id="local-6989586621681034330"><span class="annot"><span class="annottext">tvs :: [CoVar]
</span><a href="#local-6989586621681034330"><span class="hs-identifier hs-var hs-var">tvs</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">TyCon -&gt; [CoVar]
</span><a href="GHC.Core.TyCon.html#tyConTyVars"><span class="hs-identifier hs-var">tyConTyVars</span></a></span><span> </span><span class="annot"><span class="annottext">TyCon
</span><a href="#local-6989586621681034335"><span class="hs-identifier hs-var">tc</span></a></span><span>
</span><span id="line-1629"></span><span>        </span><span id="local-6989586621681034328"><span class="annot"><span class="annottext">fam_cos :: [Coercion]
</span><a href="#local-6989586621681034328"><span class="hs-identifier hs-var hs-var">fam_cos</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-identifier">ASSERT2</span><span class="hs-special">(</span><span> </span><span class="hs-identifier">tvs</span><span> </span><span class="hs-special">`</span><span class="hs-identifier">equalLength</span><span class="hs-special">`</span><span> </span><span class="hs-identifier">cos</span><span class="hs-special">,</span><span> </span><span class="hs-identifier">ppr</span><span> </span><span class="hs-identifier">tc</span><span> </span><span class="hs-operator">&lt;+&gt;</span><span> </span><span class="hs-identifier">ppr</span><span> </span><span class="hs-identifier">cos</span><span> </span><span class="hs-special">)</span><span>
</span><span id="line-1630"></span><span>                  </span><span class="annot"><span class="annottext">forall a b. (a -&gt; b) -&gt; [a] -&gt; [b]
</span><a href="../../base-4.16.4.0/src/GHC-Base.html#map"><span class="hs-identifier hs-var">map</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Role -&gt; [CoVar] -&gt; [Coercion] -&gt; Type -&gt; Coercion
</span><a href="GHC.Core.Coercion.html#liftCoSubstWith"><span class="hs-identifier hs-var">liftCoSubstWith</span></a></span><span> </span><span class="annot"><span class="annottext">Role
</span><a href="GHC.Core.Coercion.Axiom.html#Nominal"><span class="hs-identifier hs-var">Nominal</span></a></span><span> </span><span class="annot"><span class="annottext">[CoVar]
</span><a href="#local-6989586621681034330"><span class="hs-identifier hs-var">tvs</span></a></span><span> </span><span class="annot"><span class="annottext">[Coercion]
</span><a href="#local-6989586621681034334"><span class="hs-identifier hs-var">cos</span></a></span><span class="hs-special">)</span><span> </span><span class="annot"><span class="annottext">[Type]
</span><a href="#local-6989586621681034332"><span class="hs-identifier hs-var">fam_tys</span></a></span><span>
</span><span id="line-1631"></span><span>  </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">HasDebugCallStack =&gt; Role -&gt; TyCon -&gt; [Coercion] -&gt; Coercion
</span><a href="GHC.Core.Coercion.html#mkTyConAppCo"><span class="hs-identifier hs-var">mkTyConAppCo</span></a></span><span> </span><span class="annot"><span class="annottext">Role
</span><a href="GHC.Core.Coercion.Axiom.html#Nominal"><span class="hs-identifier hs-var">Nominal</span></a></span><span> </span><span class="annot"><span class="annottext">TyCon
</span><a href="#local-6989586621681034333"><span class="hs-identifier hs-var">fam_tc</span></a></span><span> </span><span class="annot"><span class="annottext">[Coercion]
</span><a href="#local-6989586621681034328"><span class="hs-identifier hs-var">fam_cos</span></a></span><span>
</span><span id="line-1632"></span><span>  </span><span class="hs-glyph">|</span><span> </span><span class="annot"><span class="annottext">Bool
</span><a href="../../base-4.16.4.0/src/GHC-Base.html#otherwise"><span class="hs-identifier hs-var">otherwise</span></a></span><span>
</span><span id="line-1633"></span><span>  </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">HasDebugCallStack =&gt; Role -&gt; TyCon -&gt; [Coercion] -&gt; Coercion
</span><a href="GHC.Core.Coercion.html#mkTyConAppCo"><span class="hs-identifier hs-var">mkTyConAppCo</span></a></span><span> </span><span class="annot"><span class="annottext">Role
</span><a href="GHC.Core.Coercion.Axiom.html#Nominal"><span class="hs-identifier hs-var">Nominal</span></a></span><span> </span><span class="annot"><span class="annottext">TyCon
</span><a href="#local-6989586621681034335"><span class="hs-identifier hs-var">tc</span></a></span><span> </span><span class="annot"><span class="annottext">[Coercion]
</span><a href="#local-6989586621681034334"><span class="hs-identifier hs-var">cos</span></a></span><span>
</span><span id="line-1634"></span><span>
</span><span id="line-1635"></span><span class="hs-comment">-- See note [Newtype coercions] in GHC.Core.TyCon</span><span>
</span><span id="line-1636"></span><span>
</span><span id="line-1637"></span><span class="annot"><a href="GHC.Core.Coercion.html#mkPiCos"><span class="hs-identifier hs-type">mkPiCos</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><a href="GHC.Core.Coercion.Axiom.html#Role"><span class="hs-identifier hs-type">Role</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-special">[</span><span class="annot"><a href="GHC.Types.Var.html#Var"><span class="hs-identifier hs-type">Var</span></a></span><span class="hs-special">]</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="GHC.Core.TyCo.Rep.html#Coercion"><span class="hs-identifier hs-type">Coercion</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="GHC.Core.TyCo.Rep.html#Coercion"><span class="hs-identifier hs-type">Coercion</span></a></span><span>
</span><span id="line-1638"></span><span id="mkPiCos"><span class="annot"><span class="annottext">mkPiCos :: Role -&gt; [CoVar] -&gt; Coercion -&gt; Coercion
</span><a href="GHC.Core.Coercion.html#mkPiCos"><span class="hs-identifier hs-var hs-var">mkPiCos</span></a></span></span><span> </span><span id="local-6989586621681034327"><span class="annot"><span class="annottext">Role
</span><a href="#local-6989586621681034327"><span class="hs-identifier hs-var">r</span></a></span></span><span> </span><span id="local-6989586621681034326"><span class="annot"><span class="annottext">[CoVar]
</span><a href="#local-6989586621681034326"><span class="hs-identifier hs-var">vs</span></a></span></span><span> </span><span id="local-6989586621681034325"><span class="annot"><span class="annottext">Coercion
</span><a href="#local-6989586621681034325"><span class="hs-identifier hs-var">co</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">forall (t :: * -&gt; *) a b.
Foldable t =&gt;
(a -&gt; b -&gt; b) -&gt; b -&gt; t a -&gt; b
</span><a href="../../base-4.16.4.0/src/Data-Foldable.html#foldr"><span class="hs-identifier hs-var">foldr</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Role -&gt; CoVar -&gt; Coercion -&gt; Coercion
</span><a href="GHC.Core.Coercion.html#mkPiCo"><span class="hs-identifier hs-var">mkPiCo</span></a></span><span> </span><span class="annot"><span class="annottext">Role
</span><a href="#local-6989586621681034327"><span class="hs-identifier hs-var">r</span></a></span><span class="hs-special">)</span><span> </span><span class="annot"><span class="annottext">Coercion
</span><a href="#local-6989586621681034325"><span class="hs-identifier hs-var">co</span></a></span><span> </span><span class="annot"><span class="annottext">[CoVar]
</span><a href="#local-6989586621681034326"><span class="hs-identifier hs-var">vs</span></a></span><span>
</span><span id="line-1639"></span><span>
</span><span id="line-1640"></span><span class="hs-comment">-- | Make a forall 'Coercion', where both types related by the coercion</span><span>
</span><span id="line-1641"></span><span class="hs-comment">-- are quantified over the same variable.</span><span>
</span><span id="line-1642"></span><span class="annot"><a href="GHC.Core.Coercion.html#mkPiCo"><span class="hs-identifier hs-type">mkPiCo</span></a></span><span>  </span><span class="hs-glyph">::</span><span> </span><span class="annot"><a href="GHC.Core.Coercion.Axiom.html#Role"><span class="hs-identifier hs-type">Role</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="GHC.Types.Var.html#Var"><span class="hs-identifier hs-type">Var</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="GHC.Core.TyCo.Rep.html#Coercion"><span class="hs-identifier hs-type">Coercion</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="GHC.Core.TyCo.Rep.html#Coercion"><span class="hs-identifier hs-type">Coercion</span></a></span><span>
</span><span id="line-1643"></span><span id="mkPiCo"><span class="annot"><span class="annottext">mkPiCo :: Role -&gt; CoVar -&gt; Coercion -&gt; Coercion
</span><a href="GHC.Core.Coercion.html#mkPiCo"><span class="hs-identifier hs-var hs-var">mkPiCo</span></a></span></span><span> </span><span id="local-6989586621681034324"><span class="annot"><span class="annottext">Role
</span><a href="#local-6989586621681034324"><span class="hs-identifier hs-var">r</span></a></span></span><span> </span><span id="local-6989586621681034323"><span class="annot"><span class="annottext">CoVar
</span><a href="#local-6989586621681034323"><span class="hs-identifier hs-var">v</span></a></span></span><span> </span><span id="local-6989586621681034322"><span class="annot"><span class="annottext">Coercion
</span><a href="#local-6989586621681034322"><span class="hs-identifier hs-var">co</span></a></span></span><span> </span><span class="hs-glyph">|</span><span> </span><span class="annot"><span class="annottext">CoVar -&gt; Bool
</span><a href="GHC.Types.Var.html#isTyVar"><span class="hs-identifier hs-var">isTyVar</span></a></span><span> </span><span class="annot"><span class="annottext">CoVar
</span><a href="#local-6989586621681034323"><span class="hs-identifier hs-var">v</span></a></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">[CoVar] -&gt; Coercion -&gt; Coercion
</span><a href="GHC.Core.Coercion.html#mkHomoForAllCos"><span class="hs-identifier hs-var">mkHomoForAllCos</span></a></span><span> </span><span class="hs-special">[</span><span class="annot"><span class="annottext">CoVar
</span><a href="#local-6989586621681034323"><span class="hs-identifier hs-var">v</span></a></span><span class="hs-special">]</span><span> </span><span class="annot"><span class="annottext">Coercion
</span><a href="#local-6989586621681034322"><span class="hs-identifier hs-var">co</span></a></span><span>
</span><span id="line-1644"></span><span>              </span><span class="hs-glyph">|</span><span> </span><span class="annot"><span class="annottext">CoVar -&gt; Bool
</span><a href="GHC.Types.Var.html#isCoVar"><span class="hs-identifier hs-var">isCoVar</span></a></span><span> </span><span class="annot"><span class="annottext">CoVar
</span><a href="#local-6989586621681034323"><span class="hs-identifier hs-var">v</span></a></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-identifier">ASSERT</span><span class="hs-special">(</span><span> </span><span class="hs-identifier">not</span><span> </span><span class="hs-special">(</span><span class="hs-identifier">v</span><span> </span><span class="hs-special">`</span><span class="hs-identifier">elemVarSet</span><span class="hs-special">`</span><span> </span><span class="hs-identifier">tyCoVarsOfCo</span><span> </span><span class="hs-identifier">co</span><span class="hs-special">)</span><span> </span><span class="hs-special">)</span><span>
</span><span id="line-1645"></span><span>                  </span><span class="hs-comment">-- We didn't call mkForAllCo here because if v does not appear</span><span>
</span><span id="line-1646"></span><span>                  </span><span class="hs-comment">-- in co, the argement coercion will be nominal. But here we</span><span>
</span><span id="line-1647"></span><span>                  </span><span class="hs-comment">-- want it to be r. It is only called in 'mkPiCos', which is</span><span>
</span><span id="line-1648"></span><span>                  </span><span class="hs-comment">-- only used in GHC.Core.Opt.Simplify.Utils, where we are sure for</span><span>
</span><span id="line-1649"></span><span>                  </span><span class="hs-comment">-- now (Aug 2018) v won't occur in co.</span><span>
</span><span id="line-1650"></span><span>                            </span><span class="annot"><span class="annottext">Role -&gt; Scaled Type -&gt; Coercion -&gt; Coercion
</span><a href="GHC.Core.Coercion.html#mkFunResCo"><span class="hs-identifier hs-var">mkFunResCo</span></a></span><span> </span><span class="annot"><span class="annottext">Role
</span><a href="#local-6989586621681034324"><span class="hs-identifier hs-var">r</span></a></span><span> </span><span class="annot"><span class="annottext">Scaled Type
</span><a href="#local-6989586621681034321"><span class="hs-identifier hs-var">scaled_ty</span></a></span><span> </span><span class="annot"><span class="annottext">Coercion
</span><a href="#local-6989586621681034322"><span class="hs-identifier hs-var">co</span></a></span><span>
</span><span id="line-1651"></span><span>              </span><span class="hs-glyph">|</span><span> </span><span class="annot"><span class="annottext">Bool
</span><a href="../../base-4.16.4.0/src/GHC-Base.html#otherwise"><span class="hs-identifier hs-var">otherwise</span></a></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">Role -&gt; Scaled Type -&gt; Coercion -&gt; Coercion
</span><a href="GHC.Core.Coercion.html#mkFunResCo"><span class="hs-identifier hs-var">mkFunResCo</span></a></span><span> </span><span class="annot"><span class="annottext">Role
</span><a href="#local-6989586621681034324"><span class="hs-identifier hs-var">r</span></a></span><span> </span><span class="annot"><span class="annottext">Scaled Type
</span><a href="#local-6989586621681034321"><span class="hs-identifier hs-var">scaled_ty</span></a></span><span> </span><span class="annot"><span class="annottext">Coercion
</span><a href="#local-6989586621681034322"><span class="hs-identifier hs-var">co</span></a></span><span>
</span><span id="line-1652"></span><span>              </span><span class="hs-keyword">where</span><span>
</span><span id="line-1653"></span><span>                </span><span id="local-6989586621681034321"><span class="annot"><span class="annottext">scaled_ty :: Scaled Type
</span><a href="#local-6989586621681034321"><span class="hs-identifier hs-var hs-var">scaled_ty</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">forall a. Type -&gt; a -&gt; Scaled a
</span><a href="GHC.Core.TyCo.Rep.html#Scaled"><span class="hs-identifier hs-var">Scaled</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">CoVar -&gt; Type
</span><a href="GHC.Types.Var.html#varMult"><span class="hs-identifier hs-var">varMult</span></a></span><span> </span><span class="annot"><span class="annottext">CoVar
</span><a href="#local-6989586621681034323"><span class="hs-identifier hs-var">v</span></a></span><span class="hs-special">)</span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">CoVar -&gt; Type
</span><a href="GHC.Types.Var.html#varType"><span class="hs-identifier hs-var">varType</span></a></span><span> </span><span class="annot"><span class="annottext">CoVar
</span><a href="#local-6989586621681034323"><span class="hs-identifier hs-var">v</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-1654"></span><span>
</span><span id="line-1655"></span><span class="annot"><a href="GHC.Core.Coercion.html#mkFunResCo"><span class="hs-identifier hs-type">mkFunResCo</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><a href="GHC.Core.Coercion.Axiom.html#Role"><span class="hs-identifier hs-type">Role</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="GHC.Core.TyCo.Rep.html#Scaled"><span class="hs-identifier hs-type">Scaled</span></a></span><span> </span><span class="annot"><a href="GHC.Core.TyCo.Rep.html#Type"><span class="hs-identifier hs-type">Type</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="GHC.Core.TyCo.Rep.html#Coercion"><span class="hs-identifier hs-type">Coercion</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="GHC.Core.TyCo.Rep.html#Coercion"><span class="hs-identifier hs-type">Coercion</span></a></span><span>
</span><span id="line-1656"></span><span class="hs-comment">-- Given res_co :: res1 -&gt; res2,</span><span>
</span><span id="line-1657"></span><span class="hs-comment">--   mkFunResCo r m arg res_co :: (arg -&gt; res1) ~r (arg -&gt; res2)</span><span>
</span><span id="line-1658"></span><span class="hs-comment">-- Reflexive in the multiplicity argument</span><span>
</span><span id="line-1659"></span><span id="mkFunResCo"><span class="annot"><span class="annottext">mkFunResCo :: Role -&gt; Scaled Type -&gt; Coercion -&gt; Coercion
</span><a href="GHC.Core.Coercion.html#mkFunResCo"><span class="hs-identifier hs-var hs-var">mkFunResCo</span></a></span></span><span> </span><span id="local-6989586621681034318"><span class="annot"><span class="annottext">Role
</span><a href="#local-6989586621681034318"><span class="hs-keyword hs-var">role</span></a></span></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="GHC.Core.TyCo.Rep.html#Scaled"><span class="hs-identifier hs-type">Scaled</span></a></span><span> </span><span id="local-6989586621681034317"><span class="annot"><span class="annottext">Type
</span><a href="#local-6989586621681034317"><span class="hs-identifier hs-var">mult</span></a></span></span><span> </span><span id="local-6989586621681034316"><span class="annot"><span class="annottext">Type
</span><a href="#local-6989586621681034316"><span class="hs-identifier hs-var">arg_ty</span></a></span></span><span class="hs-special">)</span><span> </span><span id="local-6989586621681034315"><span class="annot"><span class="annottext">Coercion
</span><a href="#local-6989586621681034315"><span class="hs-identifier hs-var">res_co</span></a></span></span><span>
</span><span id="line-1660"></span><span>  </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">Role -&gt; Coercion -&gt; Coercion -&gt; Coercion -&gt; Coercion
</span><a href="GHC.Core.Coercion.html#mkFunCo"><span class="hs-identifier hs-var">mkFunCo</span></a></span><span> </span><span class="annot"><span class="annottext">Role
</span><a href="#local-6989586621681034318"><span class="hs-keyword hs-var">role</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Type -&gt; Coercion
</span><a href="GHC.Core.Coercion.html#multToCo"><span class="hs-identifier hs-var">multToCo</span></a></span><span> </span><span class="annot"><span class="annottext">Type
</span><a href="#local-6989586621681034317"><span class="hs-identifier hs-var">mult</span></a></span><span class="hs-special">)</span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Role -&gt; Type -&gt; Coercion
</span><a href="GHC.Core.Coercion.html#mkReflCo"><span class="hs-identifier hs-var">mkReflCo</span></a></span><span> </span><span class="annot"><span class="annottext">Role
</span><a href="#local-6989586621681034318"><span class="hs-keyword hs-var">role</span></a></span><span> </span><span class="annot"><span class="annottext">Type
</span><a href="#local-6989586621681034316"><span class="hs-identifier hs-var">arg_ty</span></a></span><span class="hs-special">)</span><span> </span><span class="annot"><span class="annottext">Coercion
</span><a href="#local-6989586621681034315"><span class="hs-identifier hs-var">res_co</span></a></span><span>
</span><span id="line-1661"></span><span>
</span><span id="line-1662"></span><span class="hs-comment">-- mkCoCast (c :: s1 ~?r t1) (g :: (s1 ~?r t1) ~#R (s2 ~?r t2)) :: s2 ~?r t2</span><span>
</span><span id="line-1663"></span><span class="hs-comment">-- The first coercion might be lifted or unlifted; thus the ~? above</span><span>
</span><span id="line-1664"></span><span class="hs-comment">-- Lifted and unlifted equalities take different numbers of arguments,</span><span>
</span><span id="line-1665"></span><span class="hs-comment">-- so we have to make sure to supply the right parameter to decomposeCo.</span><span>
</span><span id="line-1666"></span><span class="hs-comment">-- Also, note that the role of the first coercion is the same as the role of</span><span>
</span><span id="line-1667"></span><span class="hs-comment">-- the equalities related by the second coercion. The second coercion is</span><span>
</span><span id="line-1668"></span><span class="hs-comment">-- itself always representational.</span><span>
</span><span id="line-1669"></span><span class="annot"><a href="GHC.Core.Coercion.html#mkCoCast"><span class="hs-identifier hs-type">mkCoCast</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><a href="GHC.Core.TyCo.Rep.html#Coercion"><span class="hs-identifier hs-type">Coercion</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="GHC.Core.TyCo.Rep.html#CoercionR"><span class="hs-identifier hs-type">CoercionR</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="GHC.Core.TyCo.Rep.html#Coercion"><span class="hs-identifier hs-type">Coercion</span></a></span><span>
</span><span id="line-1670"></span><span id="mkCoCast"><span class="annot"><span class="annottext">mkCoCast :: Coercion -&gt; Coercion -&gt; Coercion
</span><a href="GHC.Core.Coercion.html#mkCoCast"><span class="hs-identifier hs-var hs-var">mkCoCast</span></a></span></span><span> </span><span id="local-6989586621681034314"><span class="annot"><span class="annottext">Coercion
</span><a href="#local-6989586621681034314"><span class="hs-identifier hs-var">c</span></a></span></span><span> </span><span id="local-6989586621681034313"><span class="annot"><span class="annottext">Coercion
</span><a href="#local-6989586621681034313"><span class="hs-identifier hs-var">g</span></a></span></span><span>
</span><span id="line-1671"></span><span>  </span><span class="hs-glyph">|</span><span> </span><span class="hs-special">(</span><span id="local-6989586621681034312"><span class="annot"><span class="annottext">Coercion
</span><a href="#local-6989586621681034312"><span class="hs-identifier hs-var">g2</span></a></span></span><span class="annot"><span class="hs-glyph hs-type">:</span></span><span id="local-6989586621681034311"><span class="annot"><span class="annottext">Coercion
</span><a href="#local-6989586621681034311"><span class="hs-identifier hs-var">g1</span></a></span></span><span class="annot"><span class="hs-glyph hs-type">:</span></span><span class="annot"><span class="annottext">[Coercion]
</span><span class="hs-identifier">_</span></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">forall a. [a] -&gt; [a]
</span><a href="../../base-4.16.4.0/src/GHC-List.html#reverse"><span class="hs-identifier hs-var">reverse</span></a></span><span> </span><span class="annot"><span class="annottext">[Coercion]
</span><a href="#local-6989586621681034310"><span class="hs-identifier hs-var">co_list</span></a></span><span>
</span><span id="line-1672"></span><span>  </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">Coercion -&gt; Coercion
</span><a href="GHC.Core.Coercion.html#mkSymCo"><span class="hs-identifier hs-var">mkSymCo</span></a></span><span> </span><span class="annot"><span class="annottext">Coercion
</span><a href="#local-6989586621681034311"><span class="hs-identifier hs-var">g1</span></a></span><span> </span><span class="annot"><span class="annottext">Coercion -&gt; Coercion -&gt; Coercion
</span><a href="GHC.Core.Coercion.html#mkTransCo"><span class="hs-operator hs-var">`mkTransCo`</span></a></span><span> </span><span class="annot"><span class="annottext">Coercion
</span><a href="#local-6989586621681034314"><span class="hs-identifier hs-var">c</span></a></span><span> </span><span class="annot"><span class="annottext">Coercion -&gt; Coercion -&gt; Coercion
</span><a href="GHC.Core.Coercion.html#mkTransCo"><span class="hs-operator hs-var">`mkTransCo`</span></a></span><span> </span><span class="annot"><span class="annottext">Coercion
</span><a href="#local-6989586621681034312"><span class="hs-identifier hs-var">g2</span></a></span><span>
</span><span id="line-1673"></span><span>
</span><span id="line-1674"></span><span>  </span><span class="hs-glyph">|</span><span> </span><span class="annot"><span class="annottext">Bool
</span><a href="../../base-4.16.4.0/src/GHC-Base.html#otherwise"><span class="hs-identifier hs-var">otherwise</span></a></span><span>
</span><span id="line-1675"></span><span>  </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">forall a. HasCallStack =&gt; String -&gt; SDoc -&gt; a
</span><a href="GHC.Utils.Panic.html#pprPanic"><span class="hs-identifier hs-var">pprPanic</span></a></span><span> </span><span class="annot"><span class="annottext">String
</span><span class="hs-string">&quot;mkCoCast&quot;</span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">forall a. Outputable a =&gt; a -&gt; SDoc
</span><a href="GHC.Utils.Outputable.html#ppr"><span class="hs-identifier hs-var">ppr</span></a></span><span> </span><span class="annot"><span class="annottext">Coercion
</span><a href="#local-6989586621681034313"><span class="hs-identifier hs-var">g</span></a></span><span> </span><span class="annot"><span class="annottext">SDoc -&gt; SDoc -&gt; SDoc
</span><a href="GHC.Utils.Outputable.html#%24%24"><span class="hs-operator hs-var">$$</span></a></span><span> </span><span class="annot"><span class="annottext">forall a. Outputable a =&gt; a -&gt; SDoc
</span><a href="GHC.Utils.Outputable.html#ppr"><span class="hs-identifier hs-var">ppr</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Coercion -&gt; Pair Type
</span><a href="GHC.Core.Coercion.html#coercionKind"><span class="hs-identifier hs-var">coercionKind</span></a></span><span> </span><span class="annot"><span class="annottext">Coercion
</span><a href="#local-6989586621681034313"><span class="hs-identifier hs-var">g</span></a></span><span class="hs-special">)</span><span class="hs-special">)</span><span>
</span><span id="line-1676"></span><span>  </span><span class="hs-keyword">where</span><span>
</span><span id="line-1677"></span><span>    </span><span class="hs-comment">-- g  :: (s1 ~# t1) ~# (s2 ~# t2)</span><span>
</span><span id="line-1678"></span><span>    </span><span class="hs-comment">-- g1 :: s1 ~# s2</span><span>
</span><span id="line-1679"></span><span>    </span><span class="hs-comment">-- g2 :: t1 ~# t2</span><span>
</span><span id="line-1680"></span><span>    </span><span class="hs-special">(</span><span id="local-6989586621681034309"><span class="annot"><span class="annottext">TyCon
</span><a href="#local-6989586621681034309"><span class="hs-identifier hs-var">tc</span></a></span></span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">[Type]
</span><span class="hs-identifier">_</span></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">Type -&gt; (TyCon, [Type])
</span><a href="GHC.Core.Type.html#splitTyConApp"><span class="hs-identifier hs-var">splitTyConApp</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Coercion -&gt; Type
</span><a href="GHC.Core.Coercion.html#coercionLKind"><span class="hs-identifier hs-var">coercionLKind</span></a></span><span> </span><span class="annot"><span class="annottext">Coercion
</span><a href="#local-6989586621681034313"><span class="hs-identifier hs-var">g</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-1681"></span><span>    </span><span id="local-6989586621681034310"><span class="annot"><span class="annottext">co_list :: [Coercion]
</span><a href="#local-6989586621681034310"><span class="hs-identifier hs-var hs-var">co_list</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">Int -&gt; Coercion -&gt; [Role] -&gt; [Coercion]
</span><a href="GHC.Core.Coercion.html#decomposeCo"><span class="hs-identifier hs-var">decomposeCo</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">TyCon -&gt; Int
</span><a href="GHC.Core.TyCon.html#tyConArity"><span class="hs-identifier hs-var">tyConArity</span></a></span><span> </span><span class="annot"><span class="annottext">TyCon
</span><a href="#local-6989586621681034309"><span class="hs-identifier hs-var">tc</span></a></span><span class="hs-special">)</span><span> </span><span class="annot"><span class="annottext">Coercion
</span><a href="#local-6989586621681034313"><span class="hs-identifier hs-var">g</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">TyCon -&gt; [Role]
</span><a href="GHC.Core.Coercion.html#tyConRolesRepresentational"><span class="hs-identifier hs-var">tyConRolesRepresentational</span></a></span><span> </span><span class="annot"><span class="annottext">TyCon
</span><a href="#local-6989586621681034309"><span class="hs-identifier hs-var">tc</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-1682"></span><span>
</span><span id="line-1683"></span><span class="hs-comment">{- Note [castCoercionKind1]
~~~~~~~~~~~~~~~~~~~~~~~~~~~
castCoercionKind1 deals with the very important special case of castCoercionKind2
where the two kind coercions are identical.  In that case we can exploit the
situation where the main coercion is reflexive, via the special cases for Refl
and GRefl.

This is important when rewriting  (ty |&gt; co). We rewrite ty, yielding
   fco :: ty ~ ty'
and now we want a coercion xco between
   xco :: (ty |&gt; co) ~ (ty' |&gt; co)
That's exactly what castCoercionKind1 does.  And it's very very common for
fco to be Refl.  In that case we do NOT want to get some terrible composition
of mkLeftCoherenceCo and mkRightCoherenceCo, which is what castCoercionKind2
has to do in its full generality.  See #18413.
-}</span><span>
</span><span id="line-1699"></span><span>
</span><span id="line-1700"></span><span class="hs-comment">{-
%************************************************************************
%*                                                                      *
            Newtypes
%*                                                                      *
%************************************************************************
-}</span><span>
</span><span id="line-1707"></span><span>
</span><span id="line-1708"></span><span class="hs-comment">-- | If @co :: T ts ~ rep_ty@ then:</span><span>
</span><span id="line-1709"></span><span class="hs-comment">--</span><span>
</span><span id="line-1710"></span><span class="hs-comment">-- &gt; instNewTyCon_maybe T ts = Just (rep_ty, co)</span><span>
</span><span id="line-1711"></span><span class="hs-comment">--</span><span>
</span><span id="line-1712"></span><span class="hs-comment">-- Checks for a newtype, and for being saturated</span><span>
</span><span id="line-1713"></span><span class="annot"><a href="GHC.Core.Coercion.html#instNewTyCon_maybe"><span class="hs-identifier hs-type">instNewTyCon_maybe</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><a href="GHC.Core.TyCon.html#TyCon"><span class="hs-identifier hs-type">TyCon</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-special">[</span><span class="annot"><a href="GHC.Core.TyCo.Rep.html#Type"><span class="hs-identifier hs-type">Type</span></a></span><span class="hs-special">]</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="../../base-4.16.4.0/src/GHC-Maybe.html#Maybe"><span class="hs-identifier hs-type">Maybe</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="GHC.Core.TyCo.Rep.html#Type"><span class="hs-identifier hs-type">Type</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><a href="GHC.Core.TyCo.Rep.html#Coercion"><span class="hs-identifier hs-type">Coercion</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-1714"></span><span id="instNewTyCon_maybe"><span class="annot"><span class="annottext">instNewTyCon_maybe :: TyCon -&gt; [Type] -&gt; Maybe (Type, Coercion)
</span><a href="GHC.Core.Coercion.html#instNewTyCon_maybe"><span class="hs-identifier hs-var hs-var">instNewTyCon_maybe</span></a></span></span><span> </span><span id="local-6989586621681034307"><span class="annot"><span class="annottext">TyCon
</span><a href="#local-6989586621681034307"><span class="hs-identifier hs-var">tc</span></a></span></span><span> </span><span id="local-6989586621681034306"><span class="annot"><span class="annottext">[Type]
</span><a href="#local-6989586621681034306"><span class="hs-identifier hs-var">tys</span></a></span></span><span>
</span><span id="line-1715"></span><span>  </span><span class="hs-glyph">|</span><span> </span><span class="annot"><a href="../../base-4.16.4.0/src/GHC-Maybe.html#Just"><span class="hs-identifier hs-type">Just</span></a></span><span> </span><span class="hs-special">(</span><span id="local-6989586621681034305"><span class="annot"><span class="annottext">[CoVar]
</span><a href="#local-6989586621681034305"><span class="hs-identifier hs-var">tvs</span></a></span></span><span class="hs-special">,</span><span> </span><span id="local-6989586621681034304"><span class="annot"><span class="annottext">Type
</span><a href="#local-6989586621681034304"><span class="hs-identifier hs-var">ty</span></a></span></span><span class="hs-special">,</span><span> </span><span id="local-6989586621681034303"><span class="annot"><span class="annottext">CoAxiom Unbranched
</span><a href="#local-6989586621681034303"><span class="hs-identifier hs-var">co_tc</span></a></span></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">TyCon -&gt; Maybe ([CoVar], Type, CoAxiom Unbranched)
</span><a href="GHC.Core.TyCon.html#unwrapNewTyConEtad_maybe"><span class="hs-identifier hs-var">unwrapNewTyConEtad_maybe</span></a></span><span> </span><span class="annot"><span class="annottext">TyCon
</span><a href="#local-6989586621681034307"><span class="hs-identifier hs-var">tc</span></a></span><span>  </span><span class="hs-comment">-- Check for newtype</span><span>
</span><span id="line-1716"></span><span>  </span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">[CoVar]
</span><a href="#local-6989586621681034305"><span class="hs-identifier hs-var">tvs</span></a></span><span> </span><span class="annot"><span class="annottext">forall a b. [a] -&gt; [b] -&gt; Bool
</span><a href="GHC.Utils.Misc.html#leLength"><span class="hs-operator hs-var">`leLength`</span></a></span><span> </span><span class="annot"><span class="annottext">[Type]
</span><a href="#local-6989586621681034306"><span class="hs-identifier hs-var">tys</span></a></span><span>                                    </span><span class="hs-comment">-- Check saturated enough</span><span>
</span><span id="line-1717"></span><span>  </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">forall a. a -&gt; Maybe a
</span><a href="../../base-4.16.4.0/src/GHC-Maybe.html#Just"><span class="hs-identifier hs-var">Just</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">[CoVar] -&gt; Type -&gt; [Type] -&gt; Type
</span><a href="GHC.Core.Type.html#applyTysX"><span class="hs-identifier hs-var">applyTysX</span></a></span><span> </span><span class="annot"><span class="annottext">[CoVar]
</span><a href="#local-6989586621681034305"><span class="hs-identifier hs-var">tvs</span></a></span><span> </span><span class="annot"><span class="annottext">Type
</span><a href="#local-6989586621681034304"><span class="hs-identifier hs-var">ty</span></a></span><span> </span><span class="annot"><span class="annottext">[Type]
</span><a href="#local-6989586621681034306"><span class="hs-identifier hs-var">tys</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">Role -&gt; CoAxiom Unbranched -&gt; [Type] -&gt; [Coercion] -&gt; Coercion
</span><a href="GHC.Core.Coercion.html#mkUnbranchedAxInstCo"><span class="hs-identifier hs-var">mkUnbranchedAxInstCo</span></a></span><span> </span><span class="annot"><span class="annottext">Role
</span><a href="GHC.Core.Coercion.Axiom.html#Representational"><span class="hs-identifier hs-var">Representational</span></a></span><span> </span><span class="annot"><span class="annottext">CoAxiom Unbranched
</span><a href="#local-6989586621681034303"><span class="hs-identifier hs-var">co_tc</span></a></span><span> </span><span class="annot"><span class="annottext">[Type]
</span><a href="#local-6989586621681034306"><span class="hs-identifier hs-var">tys</span></a></span><span> </span><span class="hs-special">[</span><span class="hs-special">]</span><span class="hs-special">)</span><span>
</span><span id="line-1718"></span><span>  </span><span class="hs-glyph">|</span><span> </span><span class="annot"><span class="annottext">Bool
</span><a href="../../base-4.16.4.0/src/GHC-Base.html#otherwise"><span class="hs-identifier hs-var">otherwise</span></a></span><span>
</span><span id="line-1719"></span><span>  </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">forall a. Maybe a
</span><a href="../../base-4.16.4.0/src/GHC-Maybe.html#Nothing"><span class="hs-identifier hs-var">Nothing</span></a></span><span>
</span><span id="line-1720"></span><span>
</span><span id="line-1721"></span><span class="hs-comment">{-
************************************************************************
*                                                                      *
         Type normalisation
*                                                                      *
************************************************************************
-}</span><span>
</span><span id="line-1728"></span><span>
</span><span id="line-1729"></span><span class="hs-comment">-- | A function to check if we can reduce a type by one step. Used</span><span>
</span><span id="line-1730"></span><span class="hs-comment">-- with 'topNormaliseTypeX'.</span><span>
</span><span id="line-1731"></span><span class="hs-keyword">type</span><span> </span><span id="NormaliseStepper"><span class="annot"><a href="GHC.Core.Coercion.html#NormaliseStepper"><span class="hs-identifier hs-var">NormaliseStepper</span></a></span></span><span> </span><span id="local-6989586621681034299"><span class="annot"><a href="#local-6989586621681034299"><span class="hs-identifier hs-type">ev</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><a href="GHC.Core.TyCon.RecWalk.html#RecTcChecker"><span class="hs-identifier hs-type">RecTcChecker</span></a></span><span>
</span><span id="line-1732"></span><span>                         </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="GHC.Core.TyCon.html#TyCon"><span class="hs-identifier hs-type">TyCon</span></a></span><span>     </span><span class="hs-comment">-- tc</span><span>
</span><span id="line-1733"></span><span>                         </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-special">[</span><span class="annot"><a href="GHC.Core.TyCo.Rep.html#Type"><span class="hs-identifier hs-type">Type</span></a></span><span class="hs-special">]</span><span>    </span><span class="hs-comment">-- tys</span><span>
</span><span id="line-1734"></span><span>                         </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="GHC.Core.Coercion.html#NormaliseStepResult"><span class="hs-identifier hs-type">NormaliseStepResult</span></a></span><span> </span><span class="annot"><a href="#local-6989586621681034299"><span class="hs-identifier hs-type">ev</span></a></span><span>
</span><span id="line-1735"></span><span>
</span><span id="line-1736"></span><span class="hs-comment">-- | The result of stepping in a normalisation function.</span><span>
</span><span id="line-1737"></span><span class="hs-comment">-- See 'topNormaliseTypeX'.</span><span>
</span><span id="line-1738"></span><span class="hs-keyword">data</span><span> </span><span id="NormaliseStepResult"><span class="annot"><a href="GHC.Core.Coercion.html#NormaliseStepResult"><span class="hs-identifier hs-var">NormaliseStepResult</span></a></span></span><span> </span><span id="local-6989586621681035642"><span class="annot"><a href="#local-6989586621681035642"><span class="hs-identifier hs-type">ev</span></a></span></span><span>
</span><span id="line-1739"></span><span>  </span><span class="hs-glyph">=</span><span> </span><span id="NS_Done"><span class="annot"><a href="GHC.Core.Coercion.html#NS_Done"><span class="hs-identifier hs-var">NS_Done</span></a></span></span><span>   </span><span class="hs-comment">-- ^ Nothing more to do</span><span>
</span><span id="line-1740"></span><span>  </span><span class="hs-glyph">|</span><span> </span><span id="NS_Abort"><span class="annot"><a href="GHC.Core.Coercion.html#NS_Abort"><span class="hs-identifier hs-var">NS_Abort</span></a></span></span><span>  </span><span class="hs-comment">-- ^ Utter failure. The outer function should fail too.</span><span>
</span><span id="line-1741"></span><span>  </span><span class="hs-glyph">|</span><span> </span><span id="NS_Step"><span class="annot"><a href="GHC.Core.Coercion.html#NS_Step"><span class="hs-identifier hs-var">NS_Step</span></a></span></span><span> </span><span class="annot"><a href="GHC.Core.TyCon.RecWalk.html#RecTcChecker"><span class="hs-identifier hs-type">RecTcChecker</span></a></span><span> </span><span class="annot"><a href="GHC.Core.TyCo.Rep.html#Type"><span class="hs-identifier hs-type">Type</span></a></span><span> </span><span class="annot"><a href="#local-6989586621681035642"><span class="hs-identifier hs-type">ev</span></a></span><span>    </span><span class="hs-comment">-- ^ We stepped, yielding new bits;</span><span>
</span><span id="line-1742"></span><span>                                    </span><span class="hs-comment">-- ^ ev is evidence;</span><span>
</span><span id="line-1743"></span><span>                                    </span><span class="hs-comment">-- Usually a co :: old type ~ new type</span><span>
</span><span id="line-1744"></span><span>
</span><span id="line-1745"></span><span class="hs-keyword">instance</span><span> </span><span id="local-6989586621681035648"><span class="annot"><a href="GHC.Utils.Outputable.html#Outputable"><span class="hs-identifier hs-type">Outputable</span></a></span><span> </span><span class="annot"><a href="#local-6989586621681035648"><span class="hs-identifier hs-type">ev</span></a></span><span> </span><span class="hs-glyph">=&gt;</span><span> </span><span class="annot"><a href="GHC.Utils.Outputable.html#Outputable"><span class="hs-identifier hs-type">Outputable</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="GHC.Core.Coercion.html#NormaliseStepResult"><span class="hs-identifier hs-type">NormaliseStepResult</span></a></span><span> </span><span class="annot"><a href="#local-6989586621681035648"><span class="hs-identifier hs-type">ev</span></a></span><span class="hs-special">)</span></span><span> </span><span class="hs-keyword">where</span><span>
</span><span id="line-1746"></span><span>  </span><span id="local-6989586621681034289"><span class="annot"><span class="annottext">ppr :: NormaliseStepResult ev -&gt; SDoc
</span><a href="#local-6989586621681034289"><span class="hs-identifier hs-var hs-var hs-var hs-var">ppr</span></a></span></span><span> </span><span class="annot"><span class="annottext">NormaliseStepResult ev
</span><a href="GHC.Core.Coercion.html#NS_Done"><span class="hs-identifier hs-var">NS_Done</span></a></span><span>           </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">String -&gt; SDoc
</span><a href="GHC.Utils.Outputable.html#text"><span class="hs-identifier hs-var">text</span></a></span><span> </span><span class="annot"><span class="annottext">String
</span><span class="hs-string">&quot;NS_Done&quot;</span></span><span>
</span><span id="line-1747"></span><span>  </span><span class="annot"><a href="GHC.Utils.Outputable.html#ppr"><span class="hs-identifier hs-var">ppr</span></a></span><span> </span><span class="annot"><span class="annottext">NormaliseStepResult ev
</span><a href="GHC.Core.Coercion.html#NS_Abort"><span class="hs-identifier hs-var">NS_Abort</span></a></span><span>          </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">String -&gt; SDoc
</span><a href="GHC.Utils.Outputable.html#text"><span class="hs-identifier hs-var">text</span></a></span><span> </span><span class="annot"><span class="annottext">String
</span><span class="hs-string">&quot;NS_Abort&quot;</span></span><span>
</span><span id="line-1748"></span><span>  </span><span class="annot"><a href="GHC.Utils.Outputable.html#ppr"><span class="hs-identifier hs-var">ppr</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="GHC.Core.Coercion.html#NS_Step"><span class="hs-identifier hs-type">NS_Step</span></a></span><span> </span><span class="annot"><span class="annottext">RecTcChecker
</span><span class="hs-identifier">_</span></span><span> </span><span id="local-6989586621681034288"><span class="annot"><span class="annottext">Type
</span><a href="#local-6989586621681034288"><span class="hs-identifier hs-var">ty</span></a></span></span><span> </span><span id="local-6989586621681034287"><span class="annot"><span class="annottext">ev
</span><a href="#local-6989586621681034287"><span class="hs-identifier hs-var">ev</span></a></span></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">[SDoc] -&gt; SDoc
</span><a href="GHC.Utils.Outputable.html#sep"><span class="hs-identifier hs-var">sep</span></a></span><span> </span><span class="hs-special">[</span><span class="annot"><span class="annottext">String -&gt; SDoc
</span><a href="GHC.Utils.Outputable.html#text"><span class="hs-identifier hs-var">text</span></a></span><span> </span><span class="annot"><span class="annottext">String
</span><span class="hs-string">&quot;NS_Step&quot;</span></span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">forall a. Outputable a =&gt; a -&gt; SDoc
</span><a href="GHC.Utils.Outputable.html#ppr"><span class="hs-identifier hs-var">ppr</span></a></span><span> </span><span class="annot"><span class="annottext">Type
</span><a href="#local-6989586621681034288"><span class="hs-identifier hs-var">ty</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">forall a. Outputable a =&gt; a -&gt; SDoc
</span><a href="GHC.Utils.Outputable.html#ppr"><span class="hs-identifier hs-var">ppr</span></a></span><span> </span><span class="annot"><span class="annottext">ev
</span><a href="#local-6989586621681034287"><span class="hs-identifier hs-var">ev</span></a></span><span class="hs-special">]</span><span>
</span><span id="line-1749"></span><span>
</span><span id="line-1750"></span><span id="local-6989586621681035645"><span id="local-6989586621681035646"><span class="annot"><a href="GHC.Core.Coercion.html#mapStepResult"><span class="hs-identifier hs-type">mapStepResult</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="hs-special">(</span><span class="annot"><a href="#local-6989586621681035646"><span class="hs-identifier hs-type">ev1</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="#local-6989586621681035645"><span class="hs-identifier hs-type">ev2</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-1751"></span><span>              </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="GHC.Core.Coercion.html#NormaliseStepResult"><span class="hs-identifier hs-type">NormaliseStepResult</span></a></span><span> </span><span class="annot"><a href="#local-6989586621681035646"><span class="hs-identifier hs-type">ev1</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="GHC.Core.Coercion.html#NormaliseStepResult"><span class="hs-identifier hs-type">NormaliseStepResult</span></a></span><span> </span><span class="annot"><a href="#local-6989586621681035645"><span class="hs-identifier hs-type">ev2</span></a></span></span></span><span>
</span><span id="line-1752"></span><span id="mapStepResult"><span class="annot"><span class="annottext">mapStepResult :: forall ev1 ev2.
(ev1 -&gt; ev2) -&gt; NormaliseStepResult ev1 -&gt; NormaliseStepResult ev2
</span><a href="GHC.Core.Coercion.html#mapStepResult"><span class="hs-identifier hs-var hs-var">mapStepResult</span></a></span></span><span> </span><span id="local-6989586621681034285"><span class="annot"><span class="annottext">ev1 -&gt; ev2
</span><a href="#local-6989586621681034285"><span class="hs-identifier hs-var">f</span></a></span></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="GHC.Core.Coercion.html#NS_Step"><span class="hs-identifier hs-type">NS_Step</span></a></span><span> </span><span id="local-6989586621681034284"><span class="annot"><span class="annottext">RecTcChecker
</span><a href="#local-6989586621681034284"><span class="hs-identifier hs-var">rec_nts</span></a></span></span><span> </span><span id="local-6989586621681034283"><span class="annot"><span class="annottext">Type
</span><a href="#local-6989586621681034283"><span class="hs-identifier hs-var">ty</span></a></span></span><span> </span><span id="local-6989586621681034282"><span class="annot"><span class="annottext">ev1
</span><a href="#local-6989586621681034282"><span class="hs-identifier hs-var">ev</span></a></span></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">forall ev. RecTcChecker -&gt; Type -&gt; ev -&gt; NormaliseStepResult ev
</span><a href="GHC.Core.Coercion.html#NS_Step"><span class="hs-identifier hs-var">NS_Step</span></a></span><span> </span><span class="annot"><span class="annottext">RecTcChecker
</span><a href="#local-6989586621681034284"><span class="hs-identifier hs-var">rec_nts</span></a></span><span> </span><span class="annot"><span class="annottext">Type
</span><a href="#local-6989586621681034283"><span class="hs-identifier hs-var">ty</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">ev1 -&gt; ev2
</span><a href="#local-6989586621681034285"><span class="hs-identifier hs-var">f</span></a></span><span> </span><span class="annot"><span class="annottext">ev1
</span><a href="#local-6989586621681034282"><span class="hs-identifier hs-var">ev</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-1753"></span><span class="annot"><a href="GHC.Core.Coercion.html#mapStepResult"><span class="hs-identifier hs-var">mapStepResult</span></a></span><span> </span><span class="annot"><span class="annottext">ev1 -&gt; ev2
</span><span class="hs-identifier">_</span></span><span> </span><span class="annot"><span class="annottext">NormaliseStepResult ev1
</span><a href="GHC.Core.Coercion.html#NS_Done"><span class="hs-identifier hs-var">NS_Done</span></a></span><span>                 </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">forall ev. NormaliseStepResult ev
</span><a href="GHC.Core.Coercion.html#NS_Done"><span class="hs-identifier hs-var">NS_Done</span></a></span><span>
</span><span id="line-1754"></span><span class="annot"><a href="GHC.Core.Coercion.html#mapStepResult"><span class="hs-identifier hs-var">mapStepResult</span></a></span><span> </span><span class="annot"><span class="annottext">ev1 -&gt; ev2
</span><span class="hs-identifier">_</span></span><span> </span><span class="annot"><span class="annottext">NormaliseStepResult ev1
</span><a href="GHC.Core.Coercion.html#NS_Abort"><span class="hs-identifier hs-var">NS_Abort</span></a></span><span>                </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">forall ev. NormaliseStepResult ev
</span><a href="GHC.Core.Coercion.html#NS_Abort"><span class="hs-identifier hs-var">NS_Abort</span></a></span><span>
</span><span id="line-1755"></span><span>
</span><span id="line-1756"></span><span class="hs-comment">-- | Try one stepper and then try the next, if the first doesn't make</span><span>
</span><span id="line-1757"></span><span class="hs-comment">-- progress.</span><span>
</span><span id="line-1758"></span><span class="hs-comment">-- So if it returns NS_Done, it means that both steppers are satisfied</span><span>
</span><span id="line-1759"></span><span id="local-6989586621681035641"><span class="annot"><a href="GHC.Core.Coercion.html#composeSteppers"><span class="hs-identifier hs-type">composeSteppers</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><a href="GHC.Core.Coercion.html#NormaliseStepper"><span class="hs-identifier hs-type">NormaliseStepper</span></a></span><span> </span><span class="annot"><a href="#local-6989586621681035641"><span class="hs-identifier hs-type">ev</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="GHC.Core.Coercion.html#NormaliseStepper"><span class="hs-identifier hs-type">NormaliseStepper</span></a></span><span> </span><span class="annot"><a href="#local-6989586621681035641"><span class="hs-identifier hs-type">ev</span></a></span><span>
</span><span id="line-1760"></span><span>                </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="GHC.Core.Coercion.html#NormaliseStepper"><span class="hs-identifier hs-type">NormaliseStepper</span></a></span><span> </span><span class="annot"><a href="#local-6989586621681035641"><span class="hs-identifier hs-type">ev</span></a></span></span><span>
</span><span id="line-1761"></span><span id="composeSteppers"><span class="annot"><span class="annottext">composeSteppers :: forall ev.
NormaliseStepper ev -&gt; NormaliseStepper ev -&gt; NormaliseStepper ev
</span><a href="GHC.Core.Coercion.html#composeSteppers"><span class="hs-identifier hs-var hs-var">composeSteppers</span></a></span></span><span> </span><span id="local-6989586621681034281"><span class="annot"><span class="annottext">NormaliseStepper ev
</span><a href="#local-6989586621681034281"><span class="hs-identifier hs-var">step1</span></a></span></span><span> </span><span id="local-6989586621681034280"><span class="annot"><span class="annottext">NormaliseStepper ev
</span><a href="#local-6989586621681034280"><span class="hs-identifier hs-var">step2</span></a></span></span><span> </span><span id="local-6989586621681034279"><span class="annot"><span class="annottext">RecTcChecker
</span><a href="#local-6989586621681034279"><span class="hs-identifier hs-var">rec_nts</span></a></span></span><span> </span><span id="local-6989586621681034278"><span class="annot"><span class="annottext">TyCon
</span><a href="#local-6989586621681034278"><span class="hs-identifier hs-var">tc</span></a></span></span><span> </span><span id="local-6989586621681034277"><span class="annot"><span class="annottext">[Type]
</span><a href="#local-6989586621681034277"><span class="hs-identifier hs-var">tys</span></a></span></span><span>
</span><span id="line-1762"></span><span>  </span><span class="hs-glyph">=</span><span> </span><span class="hs-keyword">case</span><span> </span><span class="annot"><span class="annottext">NormaliseStepper ev
</span><a href="#local-6989586621681034281"><span class="hs-identifier hs-var">step1</span></a></span><span> </span><span class="annot"><span class="annottext">RecTcChecker
</span><a href="#local-6989586621681034279"><span class="hs-identifier hs-var">rec_nts</span></a></span><span> </span><span class="annot"><span class="annottext">TyCon
</span><a href="#local-6989586621681034278"><span class="hs-identifier hs-var">tc</span></a></span><span> </span><span class="annot"><span class="annottext">[Type]
</span><a href="#local-6989586621681034277"><span class="hs-identifier hs-var">tys</span></a></span><span> </span><span class="hs-keyword">of</span><span>
</span><span id="line-1763"></span><span>      </span><span id="local-6989586621681034276"><span class="annot"><span class="annottext">success :: NormaliseStepResult ev
</span><a href="#local-6989586621681034276"><span class="hs-identifier hs-var">success</span></a></span></span><span class="hs-glyph">@</span><span class="hs-special">(</span><span class="annot"><a href="GHC.Core.Coercion.html#NS_Step"><span class="hs-identifier hs-type">NS_Step</span></a></span><span> </span><span class="hs-special">{</span><span class="hs-special">}</span><span class="hs-special">)</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="annottext">NormaliseStepResult ev
</span><a href="#local-6989586621681034276"><span class="hs-identifier hs-var">success</span></a></span><span>
</span><span id="line-1764"></span><span>      </span><span class="annot"><span class="annottext">NormaliseStepResult ev
</span><a href="GHC.Core.Coercion.html#NS_Done"><span class="hs-identifier hs-var">NS_Done</span></a></span><span>              </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="annottext">NormaliseStepper ev
</span><a href="#local-6989586621681034280"><span class="hs-identifier hs-var">step2</span></a></span><span> </span><span class="annot"><span class="annottext">RecTcChecker
</span><a href="#local-6989586621681034279"><span class="hs-identifier hs-var">rec_nts</span></a></span><span> </span><span class="annot"><span class="annottext">TyCon
</span><a href="#local-6989586621681034278"><span class="hs-identifier hs-var">tc</span></a></span><span> </span><span class="annot"><span class="annottext">[Type]
</span><a href="#local-6989586621681034277"><span class="hs-identifier hs-var">tys</span></a></span><span>
</span><span id="line-1765"></span><span>      </span><span class="annot"><span class="annottext">NormaliseStepResult ev
</span><a href="GHC.Core.Coercion.html#NS_Abort"><span class="hs-identifier hs-var">NS_Abort</span></a></span><span>             </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="annottext">forall ev. NormaliseStepResult ev
</span><a href="GHC.Core.Coercion.html#NS_Abort"><span class="hs-identifier hs-var">NS_Abort</span></a></span><span>
</span><span id="line-1766"></span><span>
</span><span id="line-1767"></span><span class="hs-comment">-- | A 'NormaliseStepper' that unwraps newtypes, careful not to fall into</span><span>
</span><span id="line-1768"></span><span class="hs-comment">-- a loop. If it would fall into a loop, it produces 'NS_Abort'.</span><span>
</span><span id="line-1769"></span><span class="annot"><a href="GHC.Core.Coercion.html#unwrapNewTypeStepper"><span class="hs-identifier hs-type">unwrapNewTypeStepper</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><a href="GHC.Core.Coercion.html#NormaliseStepper"><span class="hs-identifier hs-type">NormaliseStepper</span></a></span><span> </span><span class="annot"><a href="GHC.Core.TyCo.Rep.html#Coercion"><span class="hs-identifier hs-type">Coercion</span></a></span><span>
</span><span id="line-1770"></span><span id="unwrapNewTypeStepper"><span class="annot"><span class="annottext">unwrapNewTypeStepper :: NormaliseStepper Coercion
</span><a href="GHC.Core.Coercion.html#unwrapNewTypeStepper"><span class="hs-identifier hs-var hs-var">unwrapNewTypeStepper</span></a></span></span><span> </span><span id="local-6989586621681034275"><span class="annot"><span class="annottext">RecTcChecker
</span><a href="#local-6989586621681034275"><span class="hs-identifier hs-var">rec_nts</span></a></span></span><span> </span><span id="local-6989586621681034274"><span class="annot"><span class="annottext">TyCon
</span><a href="#local-6989586621681034274"><span class="hs-identifier hs-var">tc</span></a></span></span><span> </span><span id="local-6989586621681034273"><span class="annot"><span class="annottext">[Type]
</span><a href="#local-6989586621681034273"><span class="hs-identifier hs-var">tys</span></a></span></span><span>
</span><span id="line-1771"></span><span>  </span><span class="hs-glyph">|</span><span> </span><span class="annot"><a href="../../base-4.16.4.0/src/GHC-Maybe.html#Just"><span class="hs-identifier hs-type">Just</span></a></span><span> </span><span class="hs-special">(</span><span id="local-6989586621681034272"><span class="annot"><span class="annottext">Type
</span><a href="#local-6989586621681034272"><span class="hs-identifier hs-var">ty'</span></a></span></span><span class="hs-special">,</span><span> </span><span id="local-6989586621681034271"><span class="annot"><span class="annottext">Coercion
</span><a href="#local-6989586621681034271"><span class="hs-identifier hs-var">co</span></a></span></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">TyCon -&gt; [Type] -&gt; Maybe (Type, Coercion)
</span><a href="GHC.Core.Coercion.html#instNewTyCon_maybe"><span class="hs-identifier hs-var">instNewTyCon_maybe</span></a></span><span> </span><span class="annot"><span class="annottext">TyCon
</span><a href="#local-6989586621681034274"><span class="hs-identifier hs-var">tc</span></a></span><span> </span><span class="annot"><span class="annottext">[Type]
</span><a href="#local-6989586621681034273"><span class="hs-identifier hs-var">tys</span></a></span><span>
</span><span id="line-1772"></span><span>  </span><span class="hs-glyph">=</span><span> </span><span class="hs-keyword">case</span><span> </span><span class="annot"><span class="annottext">RecTcChecker -&gt; TyCon -&gt; Maybe RecTcChecker
</span><a href="GHC.Core.TyCon.RecWalk.html#checkRecTc"><span class="hs-identifier hs-var">checkRecTc</span></a></span><span> </span><span class="annot"><span class="annottext">RecTcChecker
</span><a href="#local-6989586621681034275"><span class="hs-identifier hs-var">rec_nts</span></a></span><span> </span><span class="annot"><span class="annottext">TyCon
</span><a href="#local-6989586621681034274"><span class="hs-identifier hs-var">tc</span></a></span><span> </span><span class="hs-keyword">of</span><span>
</span><span id="line-1773"></span><span>      </span><span class="annot"><a href="../../base-4.16.4.0/src/GHC-Maybe.html#Just"><span class="hs-identifier hs-type">Just</span></a></span><span> </span><span id="local-6989586621681034269"><span class="annot"><span class="annottext">RecTcChecker
</span><a href="#local-6989586621681034269"><span class="hs-identifier hs-var">rec_nts'</span></a></span></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="annottext">forall ev. RecTcChecker -&gt; Type -&gt; ev -&gt; NormaliseStepResult ev
</span><a href="GHC.Core.Coercion.html#NS_Step"><span class="hs-identifier hs-var">NS_Step</span></a></span><span> </span><span class="annot"><span class="annottext">RecTcChecker
</span><a href="#local-6989586621681034269"><span class="hs-identifier hs-var">rec_nts'</span></a></span><span> </span><span class="annot"><span class="annottext">Type
</span><a href="#local-6989586621681034272"><span class="hs-identifier hs-var">ty'</span></a></span><span> </span><span class="annot"><span class="annottext">Coercion
</span><a href="#local-6989586621681034271"><span class="hs-identifier hs-var">co</span></a></span><span>
</span><span id="line-1774"></span><span>      </span><span class="annot"><span class="annottext">Maybe RecTcChecker
</span><a href="../../base-4.16.4.0/src/GHC-Maybe.html#Nothing"><span class="hs-identifier hs-var">Nothing</span></a></span><span>       </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="annottext">forall ev. NormaliseStepResult ev
</span><a href="GHC.Core.Coercion.html#NS_Abort"><span class="hs-identifier hs-var">NS_Abort</span></a></span><span>
</span><span id="line-1775"></span><span>
</span><span id="line-1776"></span><span>  </span><span class="hs-glyph">|</span><span> </span><span class="annot"><span class="annottext">Bool
</span><a href="../../base-4.16.4.0/src/GHC-Base.html#otherwise"><span class="hs-identifier hs-var">otherwise</span></a></span><span>
</span><span id="line-1777"></span><span>  </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">forall ev. NormaliseStepResult ev
</span><a href="GHC.Core.Coercion.html#NS_Done"><span class="hs-identifier hs-var">NS_Done</span></a></span><span>
</span><span id="line-1778"></span><span>
</span><span id="line-1779"></span><span class="hs-comment">-- | A general function for normalising the top-level of a type. It continues</span><span>
</span><span id="line-1780"></span><span class="hs-comment">-- to use the provided 'NormaliseStepper' until that function fails, and then</span><span>
</span><span id="line-1781"></span><span class="hs-comment">-- this function returns. The roles of the coercions produced by the</span><span>
</span><span id="line-1782"></span><span class="hs-comment">-- 'NormaliseStepper' must all be the same, which is the role returned from</span><span>
</span><span id="line-1783"></span><span class="hs-comment">-- the call to 'topNormaliseTypeX'.</span><span>
</span><span id="line-1784"></span><span class="hs-comment">--</span><span>
</span><span id="line-1785"></span><span class="hs-comment">-- Typically ev is Coercion.</span><span>
</span><span id="line-1786"></span><span class="hs-comment">--</span><span>
</span><span id="line-1787"></span><span class="hs-comment">-- If topNormaliseTypeX step plus ty = Just (ev, ty')</span><span>
</span><span id="line-1788"></span><span class="hs-comment">-- then ty ~ev1~ t1 ~ev2~ t2 ... ~evn~ ty'</span><span>
</span><span id="line-1789"></span><span class="hs-comment">-- and ev = ev1 `plus` ev2 `plus` ... `plus` evn</span><span>
</span><span id="line-1790"></span><span class="hs-comment">-- If it returns Nothing then no newtype unwrapping could happen</span><span>
</span><span id="line-1791"></span><span id="local-6989586621681035638"><span class="annot"><a href="GHC.Core.Coercion.html#topNormaliseTypeX"><span class="hs-identifier hs-type">topNormaliseTypeX</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><a href="GHC.Core.Coercion.html#NormaliseStepper"><span class="hs-identifier hs-type">NormaliseStepper</span></a></span><span> </span><span class="annot"><a href="#local-6989586621681035638"><span class="hs-identifier hs-type">ev</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-special">(</span><span class="annot"><a href="#local-6989586621681035638"><span class="hs-identifier hs-type">ev</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="#local-6989586621681035638"><span class="hs-identifier hs-type">ev</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="#local-6989586621681035638"><span class="hs-identifier hs-type">ev</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-1792"></span><span>                  </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="GHC.Core.TyCo.Rep.html#Type"><span class="hs-identifier hs-type">Type</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="../../base-4.16.4.0/src/GHC-Maybe.html#Maybe"><span class="hs-identifier hs-type">Maybe</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="#local-6989586621681035638"><span class="hs-identifier hs-type">ev</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><a href="GHC.Core.TyCo.Rep.html#Type"><span class="hs-identifier hs-type">Type</span></a></span><span class="hs-special">)</span></span><span>
</span><span id="line-1793"></span><span id="topNormaliseTypeX"><span class="annot"><span class="annottext">topNormaliseTypeX :: forall ev.
NormaliseStepper ev -&gt; (ev -&gt; ev -&gt; ev) -&gt; Type -&gt; Maybe (ev, Type)
</span><a href="GHC.Core.Coercion.html#topNormaliseTypeX"><span class="hs-identifier hs-var hs-var">topNormaliseTypeX</span></a></span></span><span> </span><span id="local-6989586621681034266"><span class="annot"><span class="annottext">NormaliseStepper ev
</span><a href="#local-6989586621681034266"><span class="hs-identifier hs-var">stepper</span></a></span></span><span> </span><span id="local-6989586621681034265"><span class="annot"><span class="annottext">ev -&gt; ev -&gt; ev
</span><a href="#local-6989586621681034265"><span class="hs-identifier hs-var">plus</span></a></span></span><span> </span><span id="local-6989586621681034264"><span class="annot"><span class="annottext">Type
</span><a href="#local-6989586621681034264"><span class="hs-identifier hs-var">ty</span></a></span></span><span>
</span><span id="line-1794"></span><span> </span><span class="hs-glyph">|</span><span> </span><span class="annot"><a href="../../base-4.16.4.0/src/GHC-Maybe.html#Just"><span class="hs-identifier hs-type">Just</span></a></span><span> </span><span class="hs-special">(</span><span id="local-6989586621681034263"><span class="annot"><span class="annottext">TyCon
</span><a href="#local-6989586621681034263"><span class="hs-identifier hs-var">tc</span></a></span></span><span class="hs-special">,</span><span> </span><span id="local-6989586621681034262"><span class="annot"><span class="annottext">[Type]
</span><a href="#local-6989586621681034262"><span class="hs-identifier hs-var">tys</span></a></span></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">HasDebugCallStack =&gt; Type -&gt; Maybe (TyCon, [Type])
</span><a href="GHC.Core.Type.html#splitTyConApp_maybe"><span class="hs-identifier hs-var">splitTyConApp_maybe</span></a></span><span> </span><span class="annot"><span class="annottext">Type
</span><a href="#local-6989586621681034264"><span class="hs-identifier hs-var">ty</span></a></span><span>
</span><span id="line-1795"></span><span> </span><span class="hs-special">,</span><span> </span><span class="annot"><a href="GHC.Core.Coercion.html#NS_Step"><span class="hs-identifier hs-type">NS_Step</span></a></span><span> </span><span id="local-6989586621681034261"><span class="annot"><span class="annottext">RecTcChecker
</span><a href="#local-6989586621681034261"><span class="hs-identifier hs-var">rec_nts</span></a></span></span><span> </span><span id="local-6989586621681034260"><span class="annot"><span class="annottext">Type
</span><a href="#local-6989586621681034260"><span class="hs-identifier hs-var">ty'</span></a></span></span><span> </span><span id="local-6989586621681034259"><span class="annot"><span class="annottext">ev
</span><a href="#local-6989586621681034259"><span class="hs-identifier hs-var">ev</span></a></span></span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">NormaliseStepper ev
</span><a href="#local-6989586621681034266"><span class="hs-identifier hs-var">stepper</span></a></span><span> </span><span class="annot"><span class="annottext">RecTcChecker
</span><a href="GHC.Core.TyCon.RecWalk.html#initRecTc"><span class="hs-identifier hs-var">initRecTc</span></a></span><span> </span><span class="annot"><span class="annottext">TyCon
</span><a href="#local-6989586621681034263"><span class="hs-identifier hs-var">tc</span></a></span><span> </span><span class="annot"><span class="annottext">[Type]
</span><a href="#local-6989586621681034262"><span class="hs-identifier hs-var">tys</span></a></span><span>
</span><span id="line-1796"></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">RecTcChecker -&gt; ev -&gt; Type -&gt; Maybe (ev, Type)
</span><a href="#local-6989586621681034257"><span class="hs-identifier hs-var">go</span></a></span><span> </span><span class="annot"><span class="annottext">RecTcChecker
</span><a href="#local-6989586621681034261"><span class="hs-identifier hs-var">rec_nts</span></a></span><span> </span><span class="annot"><span class="annottext">ev
</span><a href="#local-6989586621681034259"><span class="hs-identifier hs-var">ev</span></a></span><span> </span><span class="annot"><span class="annottext">Type
</span><a href="#local-6989586621681034260"><span class="hs-identifier hs-var">ty'</span></a></span><span>
</span><span id="line-1797"></span><span> </span><span class="hs-glyph">|</span><span> </span><span class="annot"><span class="annottext">Bool
</span><a href="../../base-4.16.4.0/src/GHC-Base.html#otherwise"><span class="hs-identifier hs-var">otherwise</span></a></span><span>
</span><span id="line-1798"></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">forall a. Maybe a
</span><a href="../../base-4.16.4.0/src/GHC-Maybe.html#Nothing"><span class="hs-identifier hs-var">Nothing</span></a></span><span>
</span><span id="line-1799"></span><span> </span><span class="hs-keyword">where</span><span>
</span><span id="line-1800"></span><span>    </span><span id="local-6989586621681034257"><span class="annot"><span class="annottext">go :: RecTcChecker -&gt; ev -&gt; Type -&gt; Maybe (ev, Type)
</span><a href="#local-6989586621681034257"><span class="hs-identifier hs-var hs-var">go</span></a></span></span><span> </span><span id="local-6989586621681034256"><span class="annot"><span class="annottext">RecTcChecker
</span><a href="#local-6989586621681034256"><span class="hs-identifier hs-var">rec_nts</span></a></span></span><span> </span><span id="local-6989586621681034255"><span class="annot"><span class="annottext">ev
</span><a href="#local-6989586621681034255"><span class="hs-identifier hs-var">ev</span></a></span></span><span> </span><span id="local-6989586621681034254"><span class="annot"><span class="annottext">Type
</span><a href="#local-6989586621681034254"><span class="hs-identifier hs-var">ty</span></a></span></span><span>
</span><span id="line-1801"></span><span>      </span><span class="hs-glyph">|</span><span> </span><span class="annot"><a href="../../base-4.16.4.0/src/GHC-Maybe.html#Just"><span class="hs-identifier hs-type">Just</span></a></span><span> </span><span class="hs-special">(</span><span id="local-6989586621681034253"><span class="annot"><span class="annottext">TyCon
</span><a href="#local-6989586621681034253"><span class="hs-identifier hs-var">tc</span></a></span></span><span class="hs-special">,</span><span> </span><span id="local-6989586621681034252"><span class="annot"><span class="annottext">[Type]
</span><a href="#local-6989586621681034252"><span class="hs-identifier hs-var">tys</span></a></span></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">HasDebugCallStack =&gt; Type -&gt; Maybe (TyCon, [Type])
</span><a href="GHC.Core.Type.html#splitTyConApp_maybe"><span class="hs-identifier hs-var">splitTyConApp_maybe</span></a></span><span> </span><span class="annot"><span class="annottext">Type
</span><a href="#local-6989586621681034254"><span class="hs-identifier hs-var">ty</span></a></span><span>
</span><span id="line-1802"></span><span>      </span><span class="hs-glyph">=</span><span> </span><span class="hs-keyword">case</span><span> </span><span class="annot"><span class="annottext">NormaliseStepper ev
</span><a href="#local-6989586621681034266"><span class="hs-identifier hs-var">stepper</span></a></span><span> </span><span class="annot"><span class="annottext">RecTcChecker
</span><a href="#local-6989586621681034256"><span class="hs-identifier hs-var">rec_nts</span></a></span><span> </span><span class="annot"><span class="annottext">TyCon
</span><a href="#local-6989586621681034253"><span class="hs-identifier hs-var">tc</span></a></span><span> </span><span class="annot"><span class="annottext">[Type]
</span><a href="#local-6989586621681034252"><span class="hs-identifier hs-var">tys</span></a></span><span> </span><span class="hs-keyword">of</span><span>
</span><span id="line-1803"></span><span>          </span><span class="annot"><a href="GHC.Core.Coercion.html#NS_Step"><span class="hs-identifier hs-type">NS_Step</span></a></span><span> </span><span id="local-6989586621681034251"><span class="annot"><span class="annottext">RecTcChecker
</span><a href="#local-6989586621681034251"><span class="hs-identifier hs-var">rec_nts'</span></a></span></span><span> </span><span id="local-6989586621681034250"><span class="annot"><span class="annottext">Type
</span><a href="#local-6989586621681034250"><span class="hs-identifier hs-var">ty'</span></a></span></span><span> </span><span id="local-6989586621681034249"><span class="annot"><span class="annottext">ev
</span><a href="#local-6989586621681034249"><span class="hs-identifier hs-var">ev'</span></a></span></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="annottext">RecTcChecker -&gt; ev -&gt; Type -&gt; Maybe (ev, Type)
</span><a href="#local-6989586621681034257"><span class="hs-identifier hs-var">go</span></a></span><span> </span><span class="annot"><span class="annottext">RecTcChecker
</span><a href="#local-6989586621681034251"><span class="hs-identifier hs-var">rec_nts'</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">ev
</span><a href="#local-6989586621681034255"><span class="hs-identifier hs-var">ev</span></a></span><span> </span><span class="annot"><span class="annottext">ev -&gt; ev -&gt; ev
</span><a href="#local-6989586621681034265"><span class="hs-operator hs-var">`plus`</span></a></span><span> </span><span class="annot"><span class="annottext">ev
</span><a href="#local-6989586621681034249"><span class="hs-identifier hs-var">ev'</span></a></span><span class="hs-special">)</span><span> </span><span class="annot"><span class="annottext">Type
</span><a href="#local-6989586621681034250"><span class="hs-identifier hs-var">ty'</span></a></span><span>
</span><span id="line-1804"></span><span>          </span><span class="annot"><span class="annottext">NormaliseStepResult ev
</span><a href="GHC.Core.Coercion.html#NS_Done"><span class="hs-identifier hs-var">NS_Done</span></a></span><span>  </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="annottext">forall a. a -&gt; Maybe a
</span><a href="../../base-4.16.4.0/src/GHC-Maybe.html#Just"><span class="hs-identifier hs-var">Just</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">ev
</span><a href="#local-6989586621681034255"><span class="hs-identifier hs-var">ev</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">Type
</span><a href="#local-6989586621681034254"><span class="hs-identifier hs-var">ty</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-1805"></span><span>          </span><span class="annot"><span class="annottext">NormaliseStepResult ev
</span><a href="GHC.Core.Coercion.html#NS_Abort"><span class="hs-identifier hs-var">NS_Abort</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="annottext">forall a. Maybe a
</span><a href="../../base-4.16.4.0/src/GHC-Maybe.html#Nothing"><span class="hs-identifier hs-var">Nothing</span></a></span><span>
</span><span id="line-1806"></span><span>
</span><span id="line-1807"></span><span>      </span><span class="hs-glyph">|</span><span> </span><span class="annot"><span class="annottext">Bool
</span><a href="../../base-4.16.4.0/src/GHC-Base.html#otherwise"><span class="hs-identifier hs-var">otherwise</span></a></span><span>
</span><span id="line-1808"></span><span>      </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">forall a. a -&gt; Maybe a
</span><a href="../../base-4.16.4.0/src/GHC-Maybe.html#Just"><span class="hs-identifier hs-var">Just</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">ev
</span><a href="#local-6989586621681034255"><span class="hs-identifier hs-var">ev</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">Type
</span><a href="#local-6989586621681034254"><span class="hs-identifier hs-var">ty</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-1809"></span><span>
</span><span id="line-1810"></span><span class="annot"><a href="GHC.Core.Coercion.html#topNormaliseNewType_maybe"><span class="hs-identifier hs-type">topNormaliseNewType_maybe</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><a href="GHC.Core.TyCo.Rep.html#Type"><span class="hs-identifier hs-type">Type</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="../../base-4.16.4.0/src/GHC-Maybe.html#Maybe"><span class="hs-identifier hs-type">Maybe</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="GHC.Core.TyCo.Rep.html#Coercion"><span class="hs-identifier hs-type">Coercion</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><a href="GHC.Core.TyCo.Rep.html#Type"><span class="hs-identifier hs-type">Type</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-1811"></span><span class="hs-comment">-- ^ Sometimes we want to look through a @newtype@ and get its associated coercion.</span><span>
</span><span id="line-1812"></span><span class="hs-comment">-- This function strips off @newtype@ layers enough to reveal something that isn't</span><span>
</span><span id="line-1813"></span><span class="hs-comment">-- a @newtype@.  Specifically, here's the invariant:</span><span>
</span><span id="line-1814"></span><span class="hs-comment">--</span><span>
</span><span id="line-1815"></span><span class="hs-comment">-- &gt; topNormaliseNewType_maybe rec_nts ty = Just (co, ty')</span><span>
</span><span id="line-1816"></span><span class="hs-comment">--</span><span>
</span><span id="line-1817"></span><span class="hs-comment">-- then (a)  @co : ty ~ ty'@.</span><span>
</span><span id="line-1818"></span><span class="hs-comment">--      (b)  ty' is not a newtype.</span><span>
</span><span id="line-1819"></span><span class="hs-comment">--</span><span>
</span><span id="line-1820"></span><span class="hs-comment">-- The function returns @Nothing@ for non-@newtypes@,</span><span>
</span><span id="line-1821"></span><span class="hs-comment">-- or unsaturated applications</span><span>
</span><span id="line-1822"></span><span class="hs-comment">--</span><span>
</span><span id="line-1823"></span><span class="hs-comment">-- This function does *not* look through type families, because it has no access to</span><span>
</span><span id="line-1824"></span><span class="hs-comment">-- the type family environment. If you do have that at hand, consider to use</span><span>
</span><span id="line-1825"></span><span class="hs-comment">-- topNormaliseType_maybe, which should be a drop-in replacement for</span><span>
</span><span id="line-1826"></span><span class="hs-comment">-- topNormaliseNewType_maybe</span><span>
</span><span id="line-1827"></span><span class="hs-comment">-- If topNormliseNewType_maybe ty = Just (co, ty'), then co : ty ~R ty'</span><span>
</span><span id="line-1828"></span><span id="topNormaliseNewType_maybe"><span class="annot"><span class="annottext">topNormaliseNewType_maybe :: Type -&gt; Maybe (Coercion, Type)
</span><a href="GHC.Core.Coercion.html#topNormaliseNewType_maybe"><span class="hs-identifier hs-var hs-var">topNormaliseNewType_maybe</span></a></span></span><span> </span><span id="local-6989586621681034248"><span class="annot"><span class="annottext">Type
</span><a href="#local-6989586621681034248"><span class="hs-identifier hs-var">ty</span></a></span></span><span>
</span><span id="line-1829"></span><span>  </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">forall ev.
NormaliseStepper ev -&gt; (ev -&gt; ev -&gt; ev) -&gt; Type -&gt; Maybe (ev, Type)
</span><a href="GHC.Core.Coercion.html#topNormaliseTypeX"><span class="hs-identifier hs-var">topNormaliseTypeX</span></a></span><span> </span><span class="annot"><span class="annottext">NormaliseStepper Coercion
</span><a href="GHC.Core.Coercion.html#unwrapNewTypeStepper"><span class="hs-identifier hs-var">unwrapNewTypeStepper</span></a></span><span> </span><span class="annot"><span class="annottext">Coercion -&gt; Coercion -&gt; Coercion
</span><a href="GHC.Core.Coercion.html#mkTransCo"><span class="hs-identifier hs-var">mkTransCo</span></a></span><span> </span><span class="annot"><span class="annottext">Type
</span><a href="#local-6989586621681034248"><span class="hs-identifier hs-var">ty</span></a></span><span>
</span><span id="line-1830"></span><span>
</span><span id="line-1831"></span><span class="hs-comment">{-
%************************************************************************
%*                                                                      *
                   Comparison of coercions
%*                                                                      *
%************************************************************************
-}</span><span>
</span><span id="line-1838"></span><span>
</span><span id="line-1839"></span><span class="hs-comment">-- | Syntactic equality of coercions</span><span>
</span><span id="line-1840"></span><span class="annot"><a href="GHC.Core.Coercion.html#eqCoercion"><span class="hs-identifier hs-type">eqCoercion</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><a href="GHC.Core.TyCo.Rep.html#Coercion"><span class="hs-identifier hs-type">Coercion</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="GHC.Core.TyCo.Rep.html#Coercion"><span class="hs-identifier hs-type">Coercion</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="hs-identifier hs-type">Bool</span></span><span>
</span><span id="line-1841"></span><span id="eqCoercion"><span class="annot"><span class="annottext">eqCoercion :: Coercion -&gt; Coercion -&gt; Bool
</span><a href="GHC.Core.Coercion.html#eqCoercion"><span class="hs-identifier hs-var hs-var">eqCoercion</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">Type -&gt; Type -&gt; Bool
</span><a href="GHC.Core.Type.html#eqType"><span class="hs-identifier hs-var">eqType</span></a></span><span> </span><span class="annot"><span class="annottext">forall b c a. (b -&gt; b -&gt; c) -&gt; (a -&gt; b) -&gt; a -&gt; a -&gt; c
</span><a href="../../base-4.16.4.0/src/Data-Function.html#on"><span class="hs-operator hs-var">`on`</span></a></span><span> </span><span class="annot"><span class="annottext">Coercion -&gt; Type
</span><a href="GHC.Core.Coercion.html#coercionType"><span class="hs-identifier hs-var">coercionType</span></a></span><span>
</span><span id="line-1842"></span><span>
</span><span id="line-1843"></span><span class="hs-comment">-- | Compare two 'Coercion's, with respect to an RnEnv2</span><span>
</span><span id="line-1844"></span><span class="annot"><a href="GHC.Core.Coercion.html#eqCoercionX"><span class="hs-identifier hs-type">eqCoercionX</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><a href="GHC.Types.Var.Env.html#RnEnv2"><span class="hs-identifier hs-type">RnEnv2</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="GHC.Core.TyCo.Rep.html#Coercion"><span class="hs-identifier hs-type">Coercion</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="GHC.Core.TyCo.Rep.html#Coercion"><span class="hs-identifier hs-type">Coercion</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="hs-identifier hs-type">Bool</span></span><span>
</span><span id="line-1845"></span><span id="eqCoercionX"><span class="annot"><span class="annottext">eqCoercionX :: RnEnv2 -&gt; Coercion -&gt; Coercion -&gt; Bool
</span><a href="GHC.Core.Coercion.html#eqCoercionX"><span class="hs-identifier hs-var hs-var">eqCoercionX</span></a></span></span><span> </span><span id="local-6989586621681034247"><span class="annot"><span class="annottext">RnEnv2
</span><a href="#local-6989586621681034247"><span class="hs-identifier hs-var">env</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">RnEnv2 -&gt; Type -&gt; Type -&gt; Bool
</span><a href="GHC.Core.Type.html#eqTypeX"><span class="hs-identifier hs-var">eqTypeX</span></a></span><span> </span><span class="annot"><span class="annottext">RnEnv2
</span><a href="#local-6989586621681034247"><span class="hs-identifier hs-var">env</span></a></span><span> </span><span class="annot"><span class="annottext">forall b c a. (b -&gt; b -&gt; c) -&gt; (a -&gt; b) -&gt; a -&gt; a -&gt; c
</span><a href="../../base-4.16.4.0/src/Data-Function.html#on"><span class="hs-operator hs-var">`on`</span></a></span><span> </span><span class="annot"><span class="annottext">Coercion -&gt; Type
</span><a href="GHC.Core.Coercion.html#coercionType"><span class="hs-identifier hs-var">coercionType</span></a></span><span>
</span><span id="line-1846"></span><span>
</span><span id="line-1847"></span><span class="hs-comment">{-
%************************************************************************
%*                                                                      *
                   &quot;Lifting&quot; substitution
           [(TyCoVar,Coercion)] -&gt; Type -&gt; Coercion
%*                                                                      *
%************************************************************************

Note [Lifting coercions over types: liftCoSubst]
~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~
The KPUSH rule deals with this situation
   data T a = K (a -&gt; Maybe a)
   g :: T t1 ~ T t2
   x :: t1 -&gt; Maybe t1

   case (K @t1 x) |&gt; g of
     K (y:t2 -&gt; Maybe t2) -&gt; rhs

We want to push the coercion inside the constructor application.
So we do this

   g' :: t1~t2  =  Nth 0 g

   case K @t2 (x |&gt; g' -&gt; Maybe g') of
     K (y:t2 -&gt; Maybe t2) -&gt; rhs

The crucial operation is that we
  * take the type of K's argument: a -&gt; Maybe a
  * and substitute g' for a
thus giving *coercion*.  This is what liftCoSubst does.

In the presence of kind coercions, this is a bit
of a hairy operation. So, we refer you to the paper introducing kind coercions,
available at www.cis.upenn.edu/~sweirich/papers/fckinds-extended.pdf

Note [extendLiftingContextEx]
~~~~~~~~~~~~~~~~~~~~~~~~~~~
Consider we have datatype
  K :: \/k. \/a::k. P -&gt; T k  -- P be some type
  g :: T k1 ~ T k2

  case (K @k1 @t1 x) |&gt; g of
    K y -&gt; rhs

We want to push the coercion inside the constructor application.
We first get the coercion mapped by the universal type variable k:
   lc = k |-&gt; Nth 0 g :: k1~k2

Here, the important point is that the kind of a is coerced, and P might be
dependent on the existential type variable a.
Thus we first get the coercion of a's kind
   g2 = liftCoSubst lc k :: k1 ~ k2

Then we store a new mapping into the lifting context
   lc2 = a |-&gt; (t1 ~ t1 |&gt; g2), lc

So later when we can correctly deal with the argument type P
   liftCoSubst lc2 P :: P [k|-&gt;k1][a|-&gt;t1] ~ P[k|-&gt;k2][a |-&gt; (t1|&gt;g2)]

This is exactly what extendLiftingContextEx does.
* For each (tyvar:k, ty) pair, we product the mapping
    tyvar |-&gt; (ty ~ ty |&gt; (liftCoSubst lc k))
* For each (covar:s1~s2, ty) pair, we produce the mapping
    covar |-&gt; (co ~ co')
    co' = Sym (liftCoSubst lc s1) ;; covar ;; liftCoSubst lc s2 :: s1'~s2'

This follows the lifting context extension definition in the
&quot;FC with Explicit Kind Equality&quot; paper.
-}</span><span>
</span><span id="line-1916"></span><span>
</span><span id="line-1917"></span><span class="hs-comment">-- ----------------------------------------------------</span><span>
</span><span id="line-1918"></span><span class="hs-comment">-- See Note [Lifting coercions over types: liftCoSubst]</span><span>
</span><span id="line-1919"></span><span class="hs-comment">-- ----------------------------------------------------</span><span>
</span><span id="line-1920"></span><span>
</span><span id="line-1921"></span><span class="hs-keyword">data</span><span> </span><span id="LiftingContext"><span class="annot"><a href="GHC.Core.Coercion.html#LiftingContext"><span class="hs-identifier hs-var">LiftingContext</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span id="LC"><span class="annot"><a href="GHC.Core.Coercion.html#LC"><span class="hs-identifier hs-var">LC</span></a></span></span><span> </span><span class="annot"><a href="GHC.Core.TyCo.Subst.html#TCvSubst"><span class="hs-identifier hs-type">TCvSubst</span></a></span><span> </span><span class="annot"><a href="GHC.Core.Coercion.html#LiftCoEnv"><span class="hs-identifier hs-type">LiftCoEnv</span></a></span><span>
</span><span id="line-1922"></span><span>  </span><span class="hs-comment">-- in optCoercion, we need to lift when optimizing InstCo.</span><span>
</span><span id="line-1923"></span><span>  </span><span class="hs-comment">-- See Note [Optimising InstCo] in GHC.Core.Coercion.Opt</span><span>
</span><span id="line-1924"></span><span>  </span><span class="hs-comment">-- We thus propagate the substitution from GHC.Core.Coercion.Opt here.</span><span>
</span><span id="line-1925"></span><span>
</span><span id="line-1926"></span><span class="hs-keyword">instance</span><span> </span><span class="annot"><a href="GHC.Utils.Outputable.html#Outputable"><span class="hs-identifier hs-type">Outputable</span></a></span><span> </span><span class="annot"><a href="GHC.Core.Coercion.html#LiftingContext"><span class="hs-identifier hs-type">LiftingContext</span></a></span><span> </span><span class="hs-keyword">where</span><span>
</span><span id="line-1927"></span><span>  </span><span id="local-6989586621681034240"><span class="annot"><span class="annottext">ppr :: LiftingContext -&gt; SDoc
</span><a href="#local-6989586621681034240"><span class="hs-identifier hs-var hs-var hs-var hs-var">ppr</span></a></span></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="GHC.Core.Coercion.html#LC"><span class="hs-identifier hs-type">LC</span></a></span><span> </span><span class="annot"><span class="annottext">TCvSubst
</span><span class="hs-identifier">_</span></span><span> </span><span id="local-6989586621681034239"><span class="annot"><span class="annottext">LiftCoEnv
</span><a href="#local-6989586621681034239"><span class="hs-identifier hs-var">env</span></a></span></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">SDoc -&gt; Int -&gt; SDoc -&gt; SDoc
</span><a href="GHC.Utils.Outputable.html#hang"><span class="hs-identifier hs-var">hang</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">String -&gt; SDoc
</span><a href="GHC.Utils.Outputable.html#text"><span class="hs-identifier hs-var">text</span></a></span><span> </span><span class="annot"><span class="annottext">String
</span><span class="hs-string">&quot;LiftingContext:&quot;</span></span><span class="hs-special">)</span><span> </span><span class="annot"><span class="annottext">Int
</span><span class="hs-number">2</span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">forall a. Outputable a =&gt; a -&gt; SDoc
</span><a href="GHC.Utils.Outputable.html#ppr"><span class="hs-identifier hs-var">ppr</span></a></span><span> </span><span class="annot"><span class="annottext">LiftCoEnv
</span><a href="#local-6989586621681034239"><span class="hs-identifier hs-var">env</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-1928"></span><span>
</span><span id="line-1929"></span><span class="hs-keyword">type</span><span> </span><span id="LiftCoEnv"><span class="annot"><a href="GHC.Core.Coercion.html#LiftCoEnv"><span class="hs-identifier hs-var">LiftCoEnv</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><a href="GHC.Types.Var.Env.html#VarEnv"><span class="hs-identifier hs-type">VarEnv</span></a></span><span> </span><span class="annot"><a href="GHC.Core.TyCo.Rep.html#Coercion"><span class="hs-identifier hs-type">Coercion</span></a></span><span>
</span><span id="line-1930"></span><span>     </span><span class="hs-comment">-- Maps *type variables* to *coercions*.</span><span>
</span><span id="line-1931"></span><span>     </span><span class="hs-comment">-- That's the whole point of this function!</span><span>
</span><span id="line-1932"></span><span>     </span><span class="hs-comment">-- Also maps coercion variables to ProofIrrelCos.</span><span>
</span><span id="line-1933"></span><span>
</span><span id="line-1934"></span><span class="hs-comment">-- like liftCoSubstWith, but allows for existentially-bound types as well</span><span>
</span><span id="line-1935"></span><span class="annot"><a href="GHC.Core.Coercion.html#liftCoSubstWithEx"><span class="hs-identifier hs-type">liftCoSubstWithEx</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><a href="GHC.Core.Coercion.Axiom.html#Role"><span class="hs-identifier hs-type">Role</span></a></span><span>          </span><span class="hs-comment">-- desired role for output coercion</span><span>
</span><span id="line-1936"></span><span>                  </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-special">[</span><span class="annot"><a href="GHC.Types.Var.html#TyVar"><span class="hs-identifier hs-type">TyVar</span></a></span><span class="hs-special">]</span><span>       </span><span class="hs-comment">-- universally quantified tyvars</span><span>
</span><span id="line-1937"></span><span>                  </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-special">[</span><span class="annot"><a href="GHC.Core.TyCo.Rep.html#Coercion"><span class="hs-identifier hs-type">Coercion</span></a></span><span class="hs-special">]</span><span>    </span><span class="hs-comment">-- coercions to substitute for those</span><span>
</span><span id="line-1938"></span><span>                  </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-special">[</span><span class="annot"><a href="GHC.Types.Var.html#TyCoVar"><span class="hs-identifier hs-type">TyCoVar</span></a></span><span class="hs-special">]</span><span>     </span><span class="hs-comment">-- existentially quantified tycovars</span><span>
</span><span id="line-1939"></span><span>                  </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-special">[</span><span class="annot"><a href="GHC.Core.TyCo.Rep.html#Type"><span class="hs-identifier hs-type">Type</span></a></span><span class="hs-special">]</span><span>        </span><span class="hs-comment">-- types and coercions to be bound to ex vars</span><span>
</span><span id="line-1940"></span><span>                  </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-special">(</span><span class="annot"><a href="GHC.Core.TyCo.Rep.html#Type"><span class="hs-identifier hs-type">Type</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="GHC.Core.TyCo.Rep.html#Coercion"><span class="hs-identifier hs-type">Coercion</span></a></span><span class="hs-special">,</span><span> </span><span class="hs-special">[</span><span class="annot"><a href="GHC.Core.TyCo.Rep.html#Type"><span class="hs-identifier hs-type">Type</span></a></span><span class="hs-special">]</span><span class="hs-special">)</span><span> </span><span class="hs-comment">-- (lifting function, converted ex args)</span><span>
</span><span id="line-1941"></span><span id="liftCoSubstWithEx"><span class="annot"><span class="annottext">liftCoSubstWithEx :: Role
-&gt; [CoVar]
-&gt; [Coercion]
-&gt; [CoVar]
-&gt; [Type]
-&gt; (Type -&gt; Coercion, [Type])
</span><a href="GHC.Core.Coercion.html#liftCoSubstWithEx"><span class="hs-identifier hs-var hs-var">liftCoSubstWithEx</span></a></span></span><span> </span><span id="local-6989586621681034238"><span class="annot"><span class="annottext">Role
</span><a href="#local-6989586621681034238"><span class="hs-keyword hs-var">role</span></a></span></span><span> </span><span id="local-6989586621681034237"><span class="annot"><span class="annottext">[CoVar]
</span><a href="#local-6989586621681034237"><span class="hs-identifier hs-var">univs</span></a></span></span><span> </span><span id="local-6989586621681034236"><span class="annot"><span class="annottext">[Coercion]
</span><a href="#local-6989586621681034236"><span class="hs-identifier hs-var">omegas</span></a></span></span><span> </span><span id="local-6989586621681034235"><span class="annot"><span class="annottext">[CoVar]
</span><a href="#local-6989586621681034235"><span class="hs-identifier hs-var">exs</span></a></span></span><span> </span><span id="local-6989586621681034234"><span class="annot"><span class="annottext">[Type]
</span><a href="#local-6989586621681034234"><span class="hs-identifier hs-var">rhos</span></a></span></span><span>
</span><span id="line-1942"></span><span>  </span><span class="hs-glyph">=</span><span> </span><span class="hs-keyword">let</span><span> </span><span id="local-6989586621681034233"><span class="annot"><span class="annottext">theta :: LiftingContext
</span><a href="#local-6989586621681034233"><span class="hs-identifier hs-var hs-var">theta</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">[(CoVar, Coercion)] -&gt; LiftingContext
</span><a href="GHC.Core.Coercion.html#mkLiftingContext"><span class="hs-identifier hs-var">mkLiftingContext</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">forall a b. String -&gt; [a] -&gt; [b] -&gt; [(a, b)]
</span><a href="GHC.Utils.Misc.html#zipEqual"><span class="hs-identifier hs-var">zipEqual</span></a></span><span> </span><span class="annot"><span class="annottext">String
</span><span class="hs-string">&quot;liftCoSubstWithExU&quot;</span></span><span> </span><span class="annot"><span class="annottext">[CoVar]
</span><a href="#local-6989586621681034237"><span class="hs-identifier hs-var">univs</span></a></span><span> </span><span class="annot"><span class="annottext">[Coercion]
</span><a href="#local-6989586621681034236"><span class="hs-identifier hs-var">omegas</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-1943"></span><span>        </span><span id="local-6989586621681034231"><span class="annot"><span class="annottext">psi :: LiftingContext
</span><a href="#local-6989586621681034231"><span class="hs-identifier hs-var hs-var">psi</span></a></span></span><span>   </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">LiftingContext -&gt; [(CoVar, Type)] -&gt; LiftingContext
</span><a href="GHC.Core.Coercion.html#extendLiftingContextEx"><span class="hs-identifier hs-var">extendLiftingContextEx</span></a></span><span> </span><span class="annot"><span class="annottext">LiftingContext
</span><a href="#local-6989586621681034233"><span class="hs-identifier hs-var">theta</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">forall a b. String -&gt; [a] -&gt; [b] -&gt; [(a, b)]
</span><a href="GHC.Utils.Misc.html#zipEqual"><span class="hs-identifier hs-var">zipEqual</span></a></span><span> </span><span class="annot"><span class="annottext">String
</span><span class="hs-string">&quot;liftCoSubstWithExX&quot;</span></span><span> </span><span class="annot"><span class="annottext">[CoVar]
</span><a href="#local-6989586621681034235"><span class="hs-identifier hs-var">exs</span></a></span><span> </span><span class="annot"><span class="annottext">[Type]
</span><a href="#local-6989586621681034234"><span class="hs-identifier hs-var">rhos</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-1944"></span><span>    </span><span class="hs-keyword">in</span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">LiftingContext -&gt; Role -&gt; Type -&gt; Coercion
</span><a href="GHC.Core.Coercion.html#ty_co_subst"><span class="hs-identifier hs-var">ty_co_subst</span></a></span><span> </span><span class="annot"><span class="annottext">LiftingContext
</span><a href="#local-6989586621681034231"><span class="hs-identifier hs-var">psi</span></a></span><span> </span><span class="annot"><span class="annottext">Role
</span><a href="#local-6989586621681034238"><span class="hs-keyword hs-var">role</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">HasCallStack =&gt; TCvSubst -&gt; [Type] -&gt; [Type]
</span><a href="GHC.Core.TyCo.Subst.html#substTys"><span class="hs-identifier hs-var">substTys</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">LiftingContext -&gt; TCvSubst
</span><a href="GHC.Core.Coercion.html#lcSubstRight"><span class="hs-identifier hs-var">lcSubstRight</span></a></span><span> </span><span class="annot"><span class="annottext">LiftingContext
</span><a href="#local-6989586621681034231"><span class="hs-identifier hs-var">psi</span></a></span><span class="hs-special">)</span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">[CoVar] -&gt; [Type]
</span><a href="GHC.Core.TyCo.Rep.html#mkTyCoVarTys"><span class="hs-identifier hs-var">mkTyCoVarTys</span></a></span><span> </span><span class="annot"><span class="annottext">[CoVar]
</span><a href="#local-6989586621681034235"><span class="hs-identifier hs-var">exs</span></a></span><span class="hs-special">)</span><span class="hs-special">)</span><span>
</span><span id="line-1945"></span><span>
</span><span id="line-1946"></span><span class="annot"><a href="GHC.Core.Coercion.html#liftCoSubstWith"><span class="hs-identifier hs-type">liftCoSubstWith</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><a href="GHC.Core.Coercion.Axiom.html#Role"><span class="hs-identifier hs-type">Role</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-special">[</span><span class="annot"><a href="GHC.Types.Var.html#TyCoVar"><span class="hs-identifier hs-type">TyCoVar</span></a></span><span class="hs-special">]</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-special">[</span><span class="annot"><a href="GHC.Core.TyCo.Rep.html#Coercion"><span class="hs-identifier hs-type">Coercion</span></a></span><span class="hs-special">]</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="GHC.Core.TyCo.Rep.html#Type"><span class="hs-identifier hs-type">Type</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="GHC.Core.TyCo.Rep.html#Coercion"><span class="hs-identifier hs-type">Coercion</span></a></span><span>
</span><span id="line-1947"></span><span id="liftCoSubstWith"><span class="annot"><span class="annottext">liftCoSubstWith :: Role -&gt; [CoVar] -&gt; [Coercion] -&gt; Type -&gt; Coercion
</span><a href="GHC.Core.Coercion.html#liftCoSubstWith"><span class="hs-identifier hs-var hs-var">liftCoSubstWith</span></a></span></span><span> </span><span id="local-6989586621681034226"><span class="annot"><span class="annottext">Role
</span><a href="#local-6989586621681034226"><span class="hs-identifier hs-var">r</span></a></span></span><span> </span><span id="local-6989586621681034225"><span class="annot"><span class="annottext">[CoVar]
</span><a href="#local-6989586621681034225"><span class="hs-identifier hs-var">tvs</span></a></span></span><span> </span><span id="local-6989586621681034224"><span class="annot"><span class="annottext">[Coercion]
</span><a href="#local-6989586621681034224"><span class="hs-identifier hs-var">cos</span></a></span></span><span> </span><span id="local-6989586621681034223"><span class="annot"><span class="annottext">Type
</span><a href="#local-6989586621681034223"><span class="hs-identifier hs-var">ty</span></a></span></span><span>
</span><span id="line-1948"></span><span>  </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">HasDebugCallStack =&gt; Role -&gt; LiftingContext -&gt; Type -&gt; Coercion
</span><a href="GHC.Core.Coercion.html#liftCoSubst"><span class="hs-identifier hs-var">liftCoSubst</span></a></span><span> </span><span class="annot"><span class="annottext">Role
</span><a href="#local-6989586621681034226"><span class="hs-identifier hs-var">r</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">[(CoVar, Coercion)] -&gt; LiftingContext
</span><a href="GHC.Core.Coercion.html#mkLiftingContext"><span class="hs-identifier hs-var">mkLiftingContext</span></a></span><span> </span><span class="annot"><span class="annottext">forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><a href="../../base-4.16.4.0/src/GHC-Base.html#%24"><span class="hs-operator hs-var">$</span></a></span><span> </span><span class="annot"><span class="annottext">forall a b. String -&gt; [a] -&gt; [b] -&gt; [(a, b)]
</span><a href="GHC.Utils.Misc.html#zipEqual"><span class="hs-identifier hs-var">zipEqual</span></a></span><span> </span><span class="annot"><span class="annottext">String
</span><span class="hs-string">&quot;liftCoSubstWith&quot;</span></span><span> </span><span class="annot"><span class="annottext">[CoVar]
</span><a href="#local-6989586621681034225"><span class="hs-identifier hs-var">tvs</span></a></span><span> </span><span class="annot"><span class="annottext">[Coercion]
</span><a href="#local-6989586621681034224"><span class="hs-identifier hs-var">cos</span></a></span><span class="hs-special">)</span><span> </span><span class="annot"><span class="annottext">Type
</span><a href="#local-6989586621681034223"><span class="hs-identifier hs-var">ty</span></a></span><span>
</span><span id="line-1949"></span><span>
</span><span id="line-1950"></span><span class="hs-comment">-- | @liftCoSubst role lc ty@ produces a coercion (at role @role@)</span><span>
</span><span id="line-1951"></span><span class="hs-comment">-- that coerces between @lc_left(ty)@ and @lc_right(ty)@, where</span><span>
</span><span id="line-1952"></span><span class="hs-comment">-- @lc_left@ is a substitution mapping type variables to the left-hand</span><span>
</span><span id="line-1953"></span><span class="hs-comment">-- types of the mapped coercions in @lc@, and similar for @lc_right@.</span><span>
</span><span id="line-1954"></span><span class="annot"><a href="GHC.Core.Coercion.html#liftCoSubst"><span class="hs-identifier hs-type">liftCoSubst</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><a href="GHC.Utils.Misc.html#HasDebugCallStack"><span class="hs-identifier hs-type">HasDebugCallStack</span></a></span><span> </span><span class="hs-glyph">=&gt;</span><span> </span><span class="annot"><a href="GHC.Core.Coercion.Axiom.html#Role"><span class="hs-identifier hs-type">Role</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="GHC.Core.Coercion.html#LiftingContext"><span class="hs-identifier hs-type">LiftingContext</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="GHC.Core.TyCo.Rep.html#Type"><span class="hs-identifier hs-type">Type</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="GHC.Core.TyCo.Rep.html#Coercion"><span class="hs-identifier hs-type">Coercion</span></a></span><span>
</span><span id="line-1955"></span><span class="hs-pragma">{-# INLINE</span><span> </span><span class="annot"><a href="GHC.Core.Coercion.html#liftCoSubst"><span class="hs-pragma hs-type">liftCoSubst</span></a></span><span> </span><span class="hs-pragma">#-}</span><span>
</span><span id="line-1956"></span><span class="hs-comment">-- Inlining this function is worth 2% of allocation in T9872d,</span><span>
</span><span id="line-1957"></span><span id="liftCoSubst"><span class="annot"><span class="annottext">liftCoSubst :: HasDebugCallStack =&gt; Role -&gt; LiftingContext -&gt; Type -&gt; Coercion
</span><a href="GHC.Core.Coercion.html#liftCoSubst"><span class="hs-identifier hs-var hs-var">liftCoSubst</span></a></span></span><span> </span><span id="local-6989586621681034219"><span class="annot"><span class="annottext">Role
</span><a href="#local-6989586621681034219"><span class="hs-identifier hs-var">r</span></a></span></span><span> </span><span id="local-6989586621681034218"><span class="annot"><span class="annottext">lc :: LiftingContext
</span><a href="#local-6989586621681034218"><span class="hs-identifier hs-var">lc</span></a></span></span><span class="hs-glyph">@</span><span class="hs-special">(</span><span class="annot"><a href="GHC.Core.Coercion.html#LC"><span class="hs-identifier hs-type">LC</span></a></span><span> </span><span id="local-6989586621681034217"><span class="annot"><span class="annottext">TCvSubst
</span><a href="#local-6989586621681034217"><span class="hs-identifier hs-var">subst</span></a></span></span><span> </span><span id="local-6989586621681034216"><span class="annot"><span class="annottext">LiftCoEnv
</span><a href="#local-6989586621681034216"><span class="hs-identifier hs-var">env</span></a></span></span><span class="hs-special">)</span><span> </span><span id="local-6989586621681034215"><span class="annot"><span class="annottext">Type
</span><a href="#local-6989586621681034215"><span class="hs-identifier hs-var">ty</span></a></span></span><span>
</span><span id="line-1958"></span><span>  </span><span class="hs-glyph">|</span><span> </span><span class="annot"><span class="annottext">forall a. VarEnv a -&gt; Bool
</span><a href="GHC.Types.Var.Env.html#isEmptyVarEnv"><span class="hs-identifier hs-var">isEmptyVarEnv</span></a></span><span> </span><span class="annot"><span class="annottext">LiftCoEnv
</span><a href="#local-6989586621681034216"><span class="hs-identifier hs-var">env</span></a></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">Role -&gt; Type -&gt; Coercion
</span><a href="GHC.Core.Coercion.html#mkReflCo"><span class="hs-identifier hs-var">mkReflCo</span></a></span><span> </span><span class="annot"><span class="annottext">Role
</span><a href="#local-6989586621681034219"><span class="hs-identifier hs-var">r</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">HasCallStack =&gt; TCvSubst -&gt; Type -&gt; Type
</span><a href="GHC.Core.TyCo.Subst.html#substTy"><span class="hs-identifier hs-var">substTy</span></a></span><span> </span><span class="annot"><span class="annottext">TCvSubst
</span><a href="#local-6989586621681034217"><span class="hs-identifier hs-var">subst</span></a></span><span> </span><span class="annot"><span class="annottext">Type
</span><a href="#local-6989586621681034215"><span class="hs-identifier hs-var">ty</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-1959"></span><span>  </span><span class="hs-glyph">|</span><span> </span><span class="annot"><span class="annottext">Bool
</span><a href="../../base-4.16.4.0/src/GHC-Base.html#otherwise"><span class="hs-identifier hs-var">otherwise</span></a></span><span>         </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">LiftingContext -&gt; Role -&gt; Type -&gt; Coercion
</span><a href="GHC.Core.Coercion.html#ty_co_subst"><span class="hs-identifier hs-var">ty_co_subst</span></a></span><span> </span><span class="annot"><span class="annottext">LiftingContext
</span><a href="#local-6989586621681034218"><span class="hs-identifier hs-var">lc</span></a></span><span> </span><span class="annot"><span class="annottext">Role
</span><a href="#local-6989586621681034219"><span class="hs-identifier hs-var">r</span></a></span><span> </span><span class="annot"><span class="annottext">Type
</span><a href="#local-6989586621681034215"><span class="hs-identifier hs-var">ty</span></a></span><span>
</span><span id="line-1960"></span><span>
</span><span id="line-1961"></span><span class="annot"><a href="GHC.Core.Coercion.html#emptyLiftingContext"><span class="hs-identifier hs-type">emptyLiftingContext</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><a href="GHC.Types.Var.Env.html#InScopeSet"><span class="hs-identifier hs-type">InScopeSet</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="GHC.Core.Coercion.html#LiftingContext"><span class="hs-identifier hs-type">LiftingContext</span></a></span><span>
</span><span id="line-1962"></span><span id="emptyLiftingContext"><span class="annot"><span class="annottext">emptyLiftingContext :: InScopeSet -&gt; LiftingContext
</span><a href="GHC.Core.Coercion.html#emptyLiftingContext"><span class="hs-identifier hs-var hs-var">emptyLiftingContext</span></a></span></span><span> </span><span id="local-6989586621681034213"><span class="annot"><span class="annottext">InScopeSet
</span><a href="#local-6989586621681034213"><span class="hs-identifier hs-var">in_scope</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">TCvSubst -&gt; LiftCoEnv -&gt; LiftingContext
</span><a href="GHC.Core.Coercion.html#LC"><span class="hs-identifier hs-var">LC</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">InScopeSet -&gt; TCvSubst
</span><a href="GHC.Core.TyCo.Subst.html#mkEmptyTCvSubst"><span class="hs-identifier hs-var">mkEmptyTCvSubst</span></a></span><span> </span><span class="annot"><span class="annottext">InScopeSet
</span><a href="#local-6989586621681034213"><span class="hs-identifier hs-var">in_scope</span></a></span><span class="hs-special">)</span><span> </span><span class="annot"><span class="annottext">forall a. VarEnv a
</span><a href="GHC.Types.Var.Env.html#emptyVarEnv"><span class="hs-identifier hs-var">emptyVarEnv</span></a></span><span>
</span><span id="line-1963"></span><span>
</span><span id="line-1964"></span><span class="annot"><a href="GHC.Core.Coercion.html#mkLiftingContext"><span class="hs-identifier hs-type">mkLiftingContext</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="hs-special">[</span><span class="hs-special">(</span><span class="annot"><a href="GHC.Types.Var.html#TyCoVar"><span class="hs-identifier hs-type">TyCoVar</span></a></span><span class="hs-special">,</span><span class="annot"><a href="GHC.Core.TyCo.Rep.html#Coercion"><span class="hs-identifier hs-type">Coercion</span></a></span><span class="hs-special">)</span><span class="hs-special">]</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="GHC.Core.Coercion.html#LiftingContext"><span class="hs-identifier hs-type">LiftingContext</span></a></span><span>
</span><span id="line-1965"></span><span id="mkLiftingContext"><span class="annot"><span class="annottext">mkLiftingContext :: [(CoVar, Coercion)] -&gt; LiftingContext
</span><a href="GHC.Core.Coercion.html#mkLiftingContext"><span class="hs-identifier hs-var hs-var">mkLiftingContext</span></a></span></span><span> </span><span id="local-6989586621681034211"><span class="annot"><span class="annottext">[(CoVar, Coercion)]
</span><a href="#local-6989586621681034211"><span class="hs-identifier hs-var">pairs</span></a></span></span><span>
</span><span id="line-1966"></span><span>  </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">TCvSubst -&gt; LiftCoEnv -&gt; LiftingContext
</span><a href="GHC.Core.Coercion.html#LC"><span class="hs-identifier hs-var">LC</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">InScopeSet -&gt; TCvSubst
</span><a href="GHC.Core.TyCo.Subst.html#mkEmptyTCvSubst"><span class="hs-identifier hs-var">mkEmptyTCvSubst</span></a></span><span> </span><span class="annot"><span class="annottext">forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><a href="../../base-4.16.4.0/src/GHC-Base.html#%24"><span class="hs-operator hs-var">$</span></a></span><span> </span><span class="annot"><span class="annottext">VarSet -&gt; InScopeSet
</span><a href="GHC.Types.Var.Env.html#mkInScopeSet"><span class="hs-identifier hs-var">mkInScopeSet</span></a></span><span> </span><span class="annot"><span class="annottext">forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><a href="../../base-4.16.4.0/src/GHC-Base.html#%24"><span class="hs-operator hs-var">$</span></a></span><span> </span><span class="annot"><span class="annottext">[Coercion] -&gt; VarSet
</span><a href="GHC.Core.TyCo.FVs.html#tyCoVarsOfCos"><span class="hs-identifier hs-var">tyCoVarsOfCos</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">forall a b. (a -&gt; b) -&gt; [a] -&gt; [b]
</span><a href="../../base-4.16.4.0/src/GHC-Base.html#map"><span class="hs-identifier hs-var">map</span></a></span><span> </span><span class="annot"><span class="annottext">forall a b. (a, b) -&gt; b
</span><a href="../../base-4.16.4.0/src/Data-Tuple.html#snd"><span class="hs-identifier hs-var">snd</span></a></span><span> </span><span class="annot"><span class="annottext">[(CoVar, Coercion)]
</span><a href="#local-6989586621681034211"><span class="hs-identifier hs-var">pairs</span></a></span><span class="hs-special">)</span><span class="hs-special">)</span><span>
</span><span id="line-1967"></span><span>       </span><span class="hs-special">(</span><span class="annot"><span class="annottext">forall a. [(CoVar, a)] -&gt; VarEnv a
</span><a href="GHC.Types.Var.Env.html#mkVarEnv"><span class="hs-identifier hs-var">mkVarEnv</span></a></span><span> </span><span class="annot"><span class="annottext">[(CoVar, Coercion)]
</span><a href="#local-6989586621681034211"><span class="hs-identifier hs-var">pairs</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-1968"></span><span>
</span><span id="line-1969"></span><span class="annot"><a href="GHC.Core.Coercion.html#mkSubstLiftingContext"><span class="hs-identifier hs-type">mkSubstLiftingContext</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><a href="GHC.Core.TyCo.Subst.html#TCvSubst"><span class="hs-identifier hs-type">TCvSubst</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="GHC.Core.Coercion.html#LiftingContext"><span class="hs-identifier hs-type">LiftingContext</span></a></span><span>
</span><span id="line-1970"></span><span id="mkSubstLiftingContext"><span class="annot"><span class="annottext">mkSubstLiftingContext :: TCvSubst -&gt; LiftingContext
</span><a href="GHC.Core.Coercion.html#mkSubstLiftingContext"><span class="hs-identifier hs-var hs-var">mkSubstLiftingContext</span></a></span></span><span> </span><span id="local-6989586621681034209"><span class="annot"><span class="annottext">TCvSubst
</span><a href="#local-6989586621681034209"><span class="hs-identifier hs-var">subst</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">TCvSubst -&gt; LiftCoEnv -&gt; LiftingContext
</span><a href="GHC.Core.Coercion.html#LC"><span class="hs-identifier hs-var">LC</span></a></span><span> </span><span class="annot"><span class="annottext">TCvSubst
</span><a href="#local-6989586621681034209"><span class="hs-identifier hs-var">subst</span></a></span><span> </span><span class="annot"><span class="annottext">forall a. VarEnv a
</span><a href="GHC.Types.Var.Env.html#emptyVarEnv"><span class="hs-identifier hs-var">emptyVarEnv</span></a></span><span>
</span><span id="line-1971"></span><span>
</span><span id="line-1972"></span><span class="hs-comment">-- | Extend a lifting context with a new mapping.</span><span>
</span><span id="line-1973"></span><span class="annot"><a href="GHC.Core.Coercion.html#extendLiftingContext"><span class="hs-identifier hs-type">extendLiftingContext</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><a href="GHC.Core.Coercion.html#LiftingContext"><span class="hs-identifier hs-type">LiftingContext</span></a></span><span>  </span><span class="hs-comment">-- ^ original LC</span><span>
</span><span id="line-1974"></span><span>                     </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="GHC.Types.Var.html#TyCoVar"><span class="hs-identifier hs-type">TyCoVar</span></a></span><span>         </span><span class="hs-comment">-- ^ new variable to map...</span><span>
</span><span id="line-1975"></span><span>                     </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="GHC.Core.TyCo.Rep.html#Coercion"><span class="hs-identifier hs-type">Coercion</span></a></span><span>        </span><span class="hs-comment">-- ^ ...to this lifted version</span><span>
</span><span id="line-1976"></span><span>                     </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="GHC.Core.Coercion.html#LiftingContext"><span class="hs-identifier hs-type">LiftingContext</span></a></span><span>
</span><span id="line-1977"></span><span>    </span><span class="hs-comment">-- mappings to reflexive coercions are just substitutions</span><span>
</span><span id="line-1978"></span><span id="extendLiftingContext"><span class="annot"><span class="annottext">extendLiftingContext :: LiftingContext -&gt; CoVar -&gt; Coercion -&gt; LiftingContext
</span><a href="GHC.Core.Coercion.html#extendLiftingContext"><span class="hs-identifier hs-var hs-var">extendLiftingContext</span></a></span></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="GHC.Core.Coercion.html#LC"><span class="hs-identifier hs-type">LC</span></a></span><span> </span><span id="local-6989586621681034208"><span class="annot"><span class="annottext">TCvSubst
</span><a href="#local-6989586621681034208"><span class="hs-identifier hs-var">subst</span></a></span></span><span> </span><span id="local-6989586621681034207"><span class="annot"><span class="annottext">LiftCoEnv
</span><a href="#local-6989586621681034207"><span class="hs-identifier hs-var">env</span></a></span></span><span class="hs-special">)</span><span> </span><span id="local-6989586621681034206"><span class="annot"><span class="annottext">CoVar
</span><a href="#local-6989586621681034206"><span class="hs-identifier hs-var">tv</span></a></span></span><span> </span><span id="local-6989586621681034205"><span class="annot"><span class="annottext">Coercion
</span><a href="#local-6989586621681034205"><span class="hs-identifier hs-var">arg</span></a></span></span><span>
</span><span id="line-1979"></span><span>  </span><span class="hs-glyph">|</span><span> </span><span class="annot"><a href="../../base-4.16.4.0/src/GHC-Maybe.html#Just"><span class="hs-identifier hs-type">Just</span></a></span><span> </span><span class="hs-special">(</span><span id="local-6989586621681034204"><span class="annot"><span class="annottext">Type
</span><a href="#local-6989586621681034204"><span class="hs-identifier hs-var">ty</span></a></span></span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">Role
</span><span class="hs-identifier">_</span></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">Coercion -&gt; Maybe (Type, Role)
</span><a href="GHC.Core.Coercion.html#isReflCo_maybe"><span class="hs-identifier hs-var">isReflCo_maybe</span></a></span><span> </span><span class="annot"><span class="annottext">Coercion
</span><a href="#local-6989586621681034205"><span class="hs-identifier hs-var">arg</span></a></span><span>
</span><span id="line-1980"></span><span>  </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">TCvSubst -&gt; LiftCoEnv -&gt; LiftingContext
</span><a href="GHC.Core.Coercion.html#LC"><span class="hs-identifier hs-var">LC</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">TCvSubst -&gt; CoVar -&gt; Type -&gt; TCvSubst
</span><a href="GHC.Core.TyCo.Subst.html#extendTCvSubst"><span class="hs-identifier hs-var">extendTCvSubst</span></a></span><span> </span><span class="annot"><span class="annottext">TCvSubst
</span><a href="#local-6989586621681034208"><span class="hs-identifier hs-var">subst</span></a></span><span> </span><span class="annot"><span class="annottext">CoVar
</span><a href="#local-6989586621681034206"><span class="hs-identifier hs-var">tv</span></a></span><span> </span><span class="annot"><span class="annottext">Type
</span><a href="#local-6989586621681034204"><span class="hs-identifier hs-var">ty</span></a></span><span class="hs-special">)</span><span> </span><span class="annot"><span class="annottext">LiftCoEnv
</span><a href="#local-6989586621681034207"><span class="hs-identifier hs-var">env</span></a></span><span>
</span><span id="line-1981"></span><span>  </span><span class="hs-glyph">|</span><span> </span><span class="annot"><span class="annottext">Bool
</span><a href="../../base-4.16.4.0/src/GHC-Base.html#otherwise"><span class="hs-identifier hs-var">otherwise</span></a></span><span>
</span><span id="line-1982"></span><span>  </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">TCvSubst -&gt; LiftCoEnv -&gt; LiftingContext
</span><a href="GHC.Core.Coercion.html#LC"><span class="hs-identifier hs-var">LC</span></a></span><span> </span><span class="annot"><span class="annottext">TCvSubst
</span><a href="#local-6989586621681034208"><span class="hs-identifier hs-var">subst</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">forall a. VarEnv a -&gt; CoVar -&gt; a -&gt; VarEnv a
</span><a href="GHC.Types.Var.Env.html#extendVarEnv"><span class="hs-identifier hs-var">extendVarEnv</span></a></span><span> </span><span class="annot"><span class="annottext">LiftCoEnv
</span><a href="#local-6989586621681034207"><span class="hs-identifier hs-var">env</span></a></span><span> </span><span class="annot"><span class="annottext">CoVar
</span><a href="#local-6989586621681034206"><span class="hs-identifier hs-var">tv</span></a></span><span> </span><span class="annot"><span class="annottext">Coercion
</span><a href="#local-6989586621681034205"><span class="hs-identifier hs-var">arg</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-1983"></span><span>
</span><span id="line-1984"></span><span class="hs-comment">-- | Extend a lifting context with a new mapping, and extend the in-scope set</span><span>
</span><span id="line-1985"></span><span class="annot"><a href="GHC.Core.Coercion.html#extendLiftingContextAndInScope"><span class="hs-identifier hs-type">extendLiftingContextAndInScope</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><a href="GHC.Core.Coercion.html#LiftingContext"><span class="hs-identifier hs-type">LiftingContext</span></a></span><span>  </span><span class="hs-comment">-- ^ Original LC</span><span>
</span><span id="line-1986"></span><span>                               </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="GHC.Types.Var.html#TyCoVar"><span class="hs-identifier hs-type">TyCoVar</span></a></span><span>         </span><span class="hs-comment">-- ^ new variable to map...</span><span>
</span><span id="line-1987"></span><span>                               </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="GHC.Core.TyCo.Rep.html#Coercion"><span class="hs-identifier hs-type">Coercion</span></a></span><span>        </span><span class="hs-comment">-- ^ to this coercion</span><span>
</span><span id="line-1988"></span><span>                               </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="GHC.Core.Coercion.html#LiftingContext"><span class="hs-identifier hs-type">LiftingContext</span></a></span><span>
</span><span id="line-1989"></span><span id="extendLiftingContextAndInScope"><span class="annot"><span class="annottext">extendLiftingContextAndInScope :: LiftingContext -&gt; CoVar -&gt; Coercion -&gt; LiftingContext
</span><a href="GHC.Core.Coercion.html#extendLiftingContextAndInScope"><span class="hs-identifier hs-var hs-var">extendLiftingContextAndInScope</span></a></span></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="GHC.Core.Coercion.html#LC"><span class="hs-identifier hs-type">LC</span></a></span><span> </span><span id="local-6989586621681034203"><span class="annot"><span class="annottext">TCvSubst
</span><a href="#local-6989586621681034203"><span class="hs-identifier hs-var">subst</span></a></span></span><span> </span><span id="local-6989586621681034202"><span class="annot"><span class="annottext">LiftCoEnv
</span><a href="#local-6989586621681034202"><span class="hs-identifier hs-var">env</span></a></span></span><span class="hs-special">)</span><span> </span><span id="local-6989586621681034201"><span class="annot"><span class="annottext">CoVar
</span><a href="#local-6989586621681034201"><span class="hs-identifier hs-var">tv</span></a></span></span><span> </span><span id="local-6989586621681034200"><span class="annot"><span class="annottext">Coercion
</span><a href="#local-6989586621681034200"><span class="hs-identifier hs-var">co</span></a></span></span><span>
</span><span id="line-1990"></span><span>  </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">LiftingContext -&gt; CoVar -&gt; Coercion -&gt; LiftingContext
</span><a href="GHC.Core.Coercion.html#extendLiftingContext"><span class="hs-identifier hs-var">extendLiftingContext</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">TCvSubst -&gt; LiftCoEnv -&gt; LiftingContext
</span><a href="GHC.Core.Coercion.html#LC"><span class="hs-identifier hs-var">LC</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">TCvSubst -&gt; VarSet -&gt; TCvSubst
</span><a href="GHC.Core.TyCo.Subst.html#extendTCvInScopeSet"><span class="hs-identifier hs-var">extendTCvInScopeSet</span></a></span><span> </span><span class="annot"><span class="annottext">TCvSubst
</span><a href="#local-6989586621681034203"><span class="hs-identifier hs-var">subst</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Coercion -&gt; VarSet
</span><a href="GHC.Core.TyCo.FVs.html#tyCoVarsOfCo"><span class="hs-identifier hs-var">tyCoVarsOfCo</span></a></span><span> </span><span class="annot"><span class="annottext">Coercion
</span><a href="#local-6989586621681034200"><span class="hs-identifier hs-var">co</span></a></span><span class="hs-special">)</span><span class="hs-special">)</span><span> </span><span class="annot"><span class="annottext">LiftCoEnv
</span><a href="#local-6989586621681034202"><span class="hs-identifier hs-var">env</span></a></span><span class="hs-special">)</span><span> </span><span class="annot"><span class="annottext">CoVar
</span><a href="#local-6989586621681034201"><span class="hs-identifier hs-var">tv</span></a></span><span> </span><span class="annot"><span class="annottext">Coercion
</span><a href="#local-6989586621681034200"><span class="hs-identifier hs-var">co</span></a></span><span>
</span><span id="line-1991"></span><span>
</span><span id="line-1992"></span><span class="hs-comment">-- | Extend a lifting context with existential-variable bindings.</span><span>
</span><span id="line-1993"></span><span class="hs-comment">-- See Note [extendLiftingContextEx]</span><span>
</span><span id="line-1994"></span><span class="annot"><a href="GHC.Core.Coercion.html#extendLiftingContextEx"><span class="hs-identifier hs-type">extendLiftingContextEx</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><a href="GHC.Core.Coercion.html#LiftingContext"><span class="hs-identifier hs-type">LiftingContext</span></a></span><span>    </span><span class="hs-comment">-- ^ original lifting context</span><span>
</span><span id="line-1995"></span><span>                       </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-special">[</span><span class="hs-special">(</span><span class="annot"><a href="GHC.Types.Var.html#TyCoVar"><span class="hs-identifier hs-type">TyCoVar</span></a></span><span class="hs-special">,</span><span class="annot"><a href="GHC.Core.TyCo.Rep.html#Type"><span class="hs-identifier hs-type">Type</span></a></span><span class="hs-special">)</span><span class="hs-special">]</span><span>  </span><span class="hs-comment">-- ^ ex. var / value pairs</span><span>
</span><span id="line-1996"></span><span>                       </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="GHC.Core.Coercion.html#LiftingContext"><span class="hs-identifier hs-type">LiftingContext</span></a></span><span>
</span><span id="line-1997"></span><span class="hs-comment">-- Note that this is more involved than extendLiftingContext. That function</span><span>
</span><span id="line-1998"></span><span class="hs-comment">-- takes a coercion to extend with, so it's assumed that the caller has taken</span><span>
</span><span id="line-1999"></span><span class="hs-comment">-- into account any of the kind-changing stuff worried about here.</span><span>
</span><span id="line-2000"></span><span id="extendLiftingContextEx"><span class="annot"><span class="annottext">extendLiftingContextEx :: LiftingContext -&gt; [(CoVar, Type)] -&gt; LiftingContext
</span><a href="GHC.Core.Coercion.html#extendLiftingContextEx"><span class="hs-identifier hs-var hs-var">extendLiftingContextEx</span></a></span></span><span> </span><span id="local-6989586621681034198"><span class="annot"><span class="annottext">LiftingContext
</span><a href="#local-6989586621681034198"><span class="hs-identifier hs-var">lc</span></a></span></span><span> </span><span class="hs-special">[</span><span class="hs-special">]</span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">LiftingContext
</span><a href="#local-6989586621681034198"><span class="hs-identifier hs-var">lc</span></a></span><span>
</span><span id="line-2001"></span><span class="annot"><a href="GHC.Core.Coercion.html#extendLiftingContextEx"><span class="hs-identifier hs-var">extendLiftingContextEx</span></a></span><span> </span><span id="local-6989586621681034197"><span class="annot"><span class="annottext">lc :: LiftingContext
</span><a href="#local-6989586621681034197"><span class="hs-identifier hs-var">lc</span></a></span></span><span class="hs-glyph">@</span><span class="hs-special">(</span><span class="annot"><a href="GHC.Core.Coercion.html#LC"><span class="hs-identifier hs-type">LC</span></a></span><span> </span><span id="local-6989586621681034196"><span class="annot"><span class="annottext">TCvSubst
</span><a href="#local-6989586621681034196"><span class="hs-identifier hs-var">subst</span></a></span></span><span> </span><span id="local-6989586621681034195"><span class="annot"><span class="annottext">LiftCoEnv
</span><a href="#local-6989586621681034195"><span class="hs-identifier hs-var">env</span></a></span></span><span class="hs-special">)</span><span> </span><span class="hs-special">(</span><span class="hs-special">(</span><span id="local-6989586621681034194"><span class="annot"><span class="annottext">CoVar
</span><a href="#local-6989586621681034194"><span class="hs-identifier hs-var">v</span></a></span></span><span class="hs-special">,</span><span id="local-6989586621681034193"><span class="annot"><span class="annottext">Type
</span><a href="#local-6989586621681034193"><span class="hs-identifier hs-var">ty</span></a></span></span><span class="hs-special">)</span><span class="annot"><span class="hs-glyph hs-type">:</span></span><span id="local-6989586621681034192"><span class="annot"><span class="annottext">[(CoVar, Type)]
</span><a href="#local-6989586621681034192"><span class="hs-identifier hs-var">rest</span></a></span></span><span class="hs-special">)</span><span>
</span><span id="line-2002"></span><span class="hs-comment">-- This function adds bindings for *Nominal* coercions. Why? Because it</span><span>
</span><span id="line-2003"></span><span class="hs-comment">-- works with existentially bound variables, which are considered to have</span><span>
</span><span id="line-2004"></span><span class="hs-comment">-- nominal roles.</span><span>
</span><span id="line-2005"></span><span>  </span><span class="hs-glyph">|</span><span> </span><span class="annot"><span class="annottext">CoVar -&gt; Bool
</span><a href="GHC.Types.Var.html#isTyVar"><span class="hs-identifier hs-var">isTyVar</span></a></span><span> </span><span class="annot"><span class="annottext">CoVar
</span><a href="#local-6989586621681034194"><span class="hs-identifier hs-var">v</span></a></span><span>
</span><span id="line-2006"></span><span>  </span><span class="hs-glyph">=</span><span> </span><span class="hs-keyword">let</span><span> </span><span id="local-6989586621681034191"><span class="annot"><span class="annottext">lc' :: LiftingContext
</span><a href="#local-6989586621681034191"><span class="hs-identifier hs-var hs-var">lc'</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">TCvSubst -&gt; LiftCoEnv -&gt; LiftingContext
</span><a href="GHC.Core.Coercion.html#LC"><span class="hs-identifier hs-var">LC</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">TCvSubst
</span><a href="#local-6989586621681034196"><span class="hs-identifier hs-var">subst</span></a></span><span> </span><span class="annot"><span class="annottext">TCvSubst -&gt; VarSet -&gt; TCvSubst
</span><a href="GHC.Core.TyCo.Subst.html#extendTCvInScopeSet"><span class="hs-operator hs-var">`extendTCvInScopeSet`</span></a></span><span> </span><span class="annot"><span class="annottext">Type -&gt; VarSet
</span><a href="GHC.Core.TyCo.FVs.html#tyCoVarsOfType"><span class="hs-identifier hs-var">tyCoVarsOfType</span></a></span><span> </span><span class="annot"><span class="annottext">Type
</span><a href="#local-6989586621681034193"><span class="hs-identifier hs-var">ty</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-2007"></span><span>                 </span><span class="hs-special">(</span><span class="annot"><span class="annottext">forall a. VarEnv a -&gt; CoVar -&gt; a -&gt; VarEnv a
</span><a href="GHC.Types.Var.Env.html#extendVarEnv"><span class="hs-identifier hs-var">extendVarEnv</span></a></span><span> </span><span class="annot"><span class="annottext">LiftCoEnv
</span><a href="#local-6989586621681034195"><span class="hs-identifier hs-var">env</span></a></span><span> </span><span class="annot"><span class="annottext">CoVar
</span><a href="#local-6989586621681034194"><span class="hs-identifier hs-var">v</span></a></span><span> </span><span class="annot"><span class="annottext">forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><a href="../../base-4.16.4.0/src/GHC-Base.html#%24"><span class="hs-operator hs-var">$</span></a></span><span>
</span><span id="line-2008"></span><span>                  </span><span class="annot"><span class="annottext">Role -&gt; Type -&gt; Coercion -&gt; Coercion
</span><a href="GHC.Core.Coercion.html#mkGReflRightCo"><span class="hs-identifier hs-var">mkGReflRightCo</span></a></span><span> </span><span class="annot"><span class="annottext">Role
</span><a href="GHC.Core.Coercion.Axiom.html#Nominal"><span class="hs-identifier hs-var">Nominal</span></a></span><span>
</span><span id="line-2009"></span><span>                                 </span><span class="annot"><span class="annottext">Type
</span><a href="#local-6989586621681034193"><span class="hs-identifier hs-var">ty</span></a></span><span>
</span><span id="line-2010"></span><span>                                 </span><span class="hs-special">(</span><span class="annot"><span class="annottext">LiftingContext -&gt; Role -&gt; Type -&gt; Coercion
</span><a href="GHC.Core.Coercion.html#ty_co_subst"><span class="hs-identifier hs-var">ty_co_subst</span></a></span><span> </span><span class="annot"><span class="annottext">LiftingContext
</span><a href="#local-6989586621681034197"><span class="hs-identifier hs-var">lc</span></a></span><span> </span><span class="annot"><span class="annottext">Role
</span><a href="GHC.Core.Coercion.Axiom.html#Nominal"><span class="hs-identifier hs-var">Nominal</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">CoVar -&gt; Type
</span><a href="GHC.Types.Var.html#tyVarKind"><span class="hs-identifier hs-var">tyVarKind</span></a></span><span> </span><span class="annot"><span class="annottext">CoVar
</span><a href="#local-6989586621681034194"><span class="hs-identifier hs-var">v</span></a></span><span class="hs-special">)</span><span class="hs-special">)</span><span class="hs-special">)</span><span>
</span><span id="line-2011"></span><span>    </span><span class="hs-keyword">in</span><span> </span><span class="annot"><span class="annottext">LiftingContext -&gt; [(CoVar, Type)] -&gt; LiftingContext
</span><a href="GHC.Core.Coercion.html#extendLiftingContextEx"><span class="hs-identifier hs-var">extendLiftingContextEx</span></a></span><span> </span><span class="annot"><span class="annottext">LiftingContext
</span><a href="#local-6989586621681034191"><span class="hs-identifier hs-var">lc'</span></a></span><span> </span><span class="annot"><span class="annottext">[(CoVar, Type)]
</span><a href="#local-6989586621681034192"><span class="hs-identifier hs-var">rest</span></a></span><span>
</span><span id="line-2012"></span><span>  </span><span class="hs-glyph">|</span><span> </span><span class="annot"><a href="GHC.Core.TyCo.Rep.html#CoercionTy"><span class="hs-identifier hs-type">CoercionTy</span></a></span><span> </span><span id="local-6989586621681034187"><span class="annot"><span class="annottext">Coercion
</span><a href="#local-6989586621681034187"><span class="hs-identifier hs-var">co</span></a></span></span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">Type
</span><a href="#local-6989586621681034193"><span class="hs-identifier hs-var">ty</span></a></span><span>
</span><span id="line-2013"></span><span>  </span><span class="hs-glyph">=</span><span> </span><span class="hs-comment">-- co      :: s1 ~r s2</span><span>
</span><span id="line-2014"></span><span>    </span><span class="hs-comment">-- lift_s1 :: s1 ~r s1'</span><span>
</span><span id="line-2015"></span><span>    </span><span class="hs-comment">-- lift_s2 :: s2 ~r s2'</span><span>
</span><span id="line-2016"></span><span>    </span><span class="hs-comment">-- kco     :: (s1 ~r s2) ~N (s1' ~r s2')</span><span>
</span><span id="line-2017"></span><span>    </span><span class="hs-identifier">ASSERT</span><span class="hs-special">(</span><span> </span><span class="hs-identifier">isCoVar</span><span> </span><span class="hs-identifier">v</span><span> </span><span class="hs-special">)</span><span>
</span><span id="line-2018"></span><span>    </span><span class="hs-keyword">let</span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Type
</span><span class="hs-identifier">_</span></span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">Type
</span><span class="hs-identifier">_</span></span><span class="hs-special">,</span><span> </span><span id="local-6989586621681034186"><span class="annot"><span class="annottext">Type
</span><a href="#local-6989586621681034186"><span class="hs-identifier hs-var">s1</span></a></span></span><span class="hs-special">,</span><span> </span><span id="local-6989586621681034185"><span class="annot"><span class="annottext">Type
</span><a href="#local-6989586621681034185"><span class="hs-identifier hs-var">s2</span></a></span></span><span class="hs-special">,</span><span> </span><span id="local-6989586621681034184"><span class="annot"><span class="annottext">Role
</span><a href="#local-6989586621681034184"><span class="hs-identifier hs-var">r</span></a></span></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">HasDebugCallStack =&gt; CoVar -&gt; (Type, Type, Type, Type, Role)
</span><a href="GHC.Core.Coercion.html#coVarKindsTypesRole"><span class="hs-identifier hs-var">coVarKindsTypesRole</span></a></span><span> </span><span class="annot"><span class="annottext">CoVar
</span><a href="#local-6989586621681034194"><span class="hs-identifier hs-var">v</span></a></span><span>
</span><span id="line-2019"></span><span>        </span><span id="local-6989586621681034183"><span class="annot"><span class="annottext">lift_s1 :: Coercion
</span><a href="#local-6989586621681034183"><span class="hs-identifier hs-var hs-var">lift_s1</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">LiftingContext -&gt; Role -&gt; Type -&gt; Coercion
</span><a href="GHC.Core.Coercion.html#ty_co_subst"><span class="hs-identifier hs-var">ty_co_subst</span></a></span><span> </span><span class="annot"><span class="annottext">LiftingContext
</span><a href="#local-6989586621681034197"><span class="hs-identifier hs-var">lc</span></a></span><span> </span><span class="annot"><span class="annottext">Role
</span><a href="#local-6989586621681034184"><span class="hs-identifier hs-var">r</span></a></span><span> </span><span class="annot"><span class="annottext">Type
</span><a href="#local-6989586621681034186"><span class="hs-identifier hs-var">s1</span></a></span><span>
</span><span id="line-2020"></span><span>        </span><span id="local-6989586621681034182"><span class="annot"><span class="annottext">lift_s2 :: Coercion
</span><a href="#local-6989586621681034182"><span class="hs-identifier hs-var hs-var">lift_s2</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">LiftingContext -&gt; Role -&gt; Type -&gt; Coercion
</span><a href="GHC.Core.Coercion.html#ty_co_subst"><span class="hs-identifier hs-var">ty_co_subst</span></a></span><span> </span><span class="annot"><span class="annottext">LiftingContext
</span><a href="#local-6989586621681034197"><span class="hs-identifier hs-var">lc</span></a></span><span> </span><span class="annot"><span class="annottext">Role
</span><a href="#local-6989586621681034184"><span class="hs-identifier hs-var">r</span></a></span><span> </span><span class="annot"><span class="annottext">Type
</span><a href="#local-6989586621681034185"><span class="hs-identifier hs-var">s2</span></a></span><span>
</span><span id="line-2021"></span><span>        </span><span id="local-6989586621681034181"><span class="annot"><span class="annottext">kco :: Coercion
</span><a href="#local-6989586621681034181"><span class="hs-identifier hs-var hs-var">kco</span></a></span></span><span>     </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">HasDebugCallStack =&gt; Role -&gt; TyCon -&gt; [Coercion] -&gt; Coercion
</span><a href="GHC.Core.Coercion.html#mkTyConAppCo"><span class="hs-identifier hs-var">mkTyConAppCo</span></a></span><span> </span><span class="annot"><span class="annottext">Role
</span><a href="GHC.Core.Coercion.Axiom.html#Nominal"><span class="hs-identifier hs-var">Nominal</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Role -&gt; TyCon
</span><a href="GHC.Builtin.Types.Prim.html#equalityTyCon"><span class="hs-identifier hs-var">equalityTyCon</span></a></span><span> </span><span class="annot"><span class="annottext">Role
</span><a href="#local-6989586621681034184"><span class="hs-identifier hs-var">r</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-2022"></span><span>                               </span><span class="hs-special">[</span><span> </span><span class="annot"><span class="annottext">Coercion -&gt; Coercion
</span><a href="GHC.Core.Coercion.html#mkKindCo"><span class="hs-identifier hs-var">mkKindCo</span></a></span><span> </span><span class="annot"><span class="annottext">Coercion
</span><a href="#local-6989586621681034183"><span class="hs-identifier hs-var">lift_s1</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">Coercion -&gt; Coercion
</span><a href="GHC.Core.Coercion.html#mkKindCo"><span class="hs-identifier hs-var">mkKindCo</span></a></span><span> </span><span class="annot"><span class="annottext">Coercion
</span><a href="#local-6989586621681034182"><span class="hs-identifier hs-var">lift_s2</span></a></span><span>
</span><span id="line-2023"></span><span>                               </span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">Coercion
</span><a href="#local-6989586621681034183"><span class="hs-identifier hs-var">lift_s1</span></a></span><span>         </span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">Coercion
</span><a href="#local-6989586621681034182"><span class="hs-identifier hs-var">lift_s2</span></a></span><span>          </span><span class="hs-special">]</span><span>
</span><span id="line-2024"></span><span>        </span><span id="local-6989586621681034179"><span class="annot"><span class="annottext">lc' :: LiftingContext
</span><a href="#local-6989586621681034179"><span class="hs-identifier hs-var hs-var">lc'</span></a></span></span><span>     </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">TCvSubst -&gt; LiftCoEnv -&gt; LiftingContext
</span><a href="GHC.Core.Coercion.html#LC"><span class="hs-identifier hs-var">LC</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">TCvSubst
</span><a href="#local-6989586621681034196"><span class="hs-identifier hs-var">subst</span></a></span><span> </span><span class="annot"><span class="annottext">TCvSubst -&gt; VarSet -&gt; TCvSubst
</span><a href="GHC.Core.TyCo.Subst.html#extendTCvInScopeSet"><span class="hs-operator hs-var">`extendTCvInScopeSet`</span></a></span><span> </span><span class="annot"><span class="annottext">Coercion -&gt; VarSet
</span><a href="GHC.Core.TyCo.FVs.html#tyCoVarsOfCo"><span class="hs-identifier hs-var">tyCoVarsOfCo</span></a></span><span> </span><span class="annot"><span class="annottext">Coercion
</span><a href="#local-6989586621681034187"><span class="hs-identifier hs-var">co</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-2025"></span><span>                     </span><span class="hs-special">(</span><span class="annot"><span class="annottext">forall a. VarEnv a -&gt; CoVar -&gt; a -&gt; VarEnv a
</span><a href="GHC.Types.Var.Env.html#extendVarEnv"><span class="hs-identifier hs-var">extendVarEnv</span></a></span><span> </span><span class="annot"><span class="annottext">LiftCoEnv
</span><a href="#local-6989586621681034195"><span class="hs-identifier hs-var">env</span></a></span><span> </span><span class="annot"><span class="annottext">CoVar
</span><a href="#local-6989586621681034194"><span class="hs-identifier hs-var">v</span></a></span><span>
</span><span id="line-2026"></span><span>                        </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Role -&gt; Coercion -&gt; Coercion -&gt; Coercion -&gt; Coercion
</span><a href="GHC.Core.Coercion.html#mkProofIrrelCo"><span class="hs-identifier hs-var">mkProofIrrelCo</span></a></span><span> </span><span class="annot"><span class="annottext">Role
</span><a href="GHC.Core.Coercion.Axiom.html#Nominal"><span class="hs-identifier hs-var">Nominal</span></a></span><span> </span><span class="annot"><span class="annottext">Coercion
</span><a href="#local-6989586621681034181"><span class="hs-identifier hs-var">kco</span></a></span><span> </span><span class="annot"><span class="annottext">Coercion
</span><a href="#local-6989586621681034187"><span class="hs-identifier hs-var">co</span></a></span><span> </span><span class="annot"><span class="annottext">forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><a href="../../base-4.16.4.0/src/GHC-Base.html#%24"><span class="hs-operator hs-var">$</span></a></span><span>
</span><span id="line-2027"></span><span>                          </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Coercion -&gt; Coercion
</span><a href="GHC.Core.Coercion.html#mkSymCo"><span class="hs-identifier hs-var">mkSymCo</span></a></span><span> </span><span class="annot"><span class="annottext">Coercion
</span><a href="#local-6989586621681034183"><span class="hs-identifier hs-var">lift_s1</span></a></span><span class="hs-special">)</span><span> </span><span class="annot"><span class="annottext">Coercion -&gt; Coercion -&gt; Coercion
</span><a href="GHC.Core.Coercion.html#mkTransCo"><span class="hs-operator hs-var">`mkTransCo`</span></a></span><span> </span><span class="annot"><span class="annottext">Coercion
</span><a href="#local-6989586621681034187"><span class="hs-identifier hs-var">co</span></a></span><span> </span><span class="annot"><span class="annottext">Coercion -&gt; Coercion -&gt; Coercion
</span><a href="GHC.Core.Coercion.html#mkTransCo"><span class="hs-operator hs-var">`mkTransCo`</span></a></span><span> </span><span class="annot"><span class="annottext">Coercion
</span><a href="#local-6989586621681034182"><span class="hs-identifier hs-var">lift_s2</span></a></span><span class="hs-special">)</span><span class="hs-special">)</span><span>
</span><span id="line-2028"></span><span>    </span><span class="hs-keyword">in</span><span> </span><span class="annot"><span class="annottext">LiftingContext -&gt; [(CoVar, Type)] -&gt; LiftingContext
</span><a href="GHC.Core.Coercion.html#extendLiftingContextEx"><span class="hs-identifier hs-var">extendLiftingContextEx</span></a></span><span> </span><span class="annot"><span class="annottext">LiftingContext
</span><a href="#local-6989586621681034179"><span class="hs-identifier hs-var">lc'</span></a></span><span> </span><span class="annot"><span class="annottext">[(CoVar, Type)]
</span><a href="#local-6989586621681034192"><span class="hs-identifier hs-var">rest</span></a></span><span>
</span><span id="line-2029"></span><span>  </span><span class="hs-glyph">|</span><span> </span><span class="annot"><span class="annottext">Bool
</span><a href="../../base-4.16.4.0/src/GHC-Base.html#otherwise"><span class="hs-identifier hs-var">otherwise</span></a></span><span>
</span><span id="line-2030"></span><span>  </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">forall a. HasCallStack =&gt; String -&gt; SDoc -&gt; a
</span><a href="GHC.Utils.Panic.html#pprPanic"><span class="hs-identifier hs-var">pprPanic</span></a></span><span> </span><span class="annot"><span class="annottext">String
</span><span class="hs-string">&quot;extendLiftingContextEx&quot;</span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">forall a. Outputable a =&gt; a -&gt; SDoc
</span><a href="GHC.Utils.Outputable.html#ppr"><span class="hs-identifier hs-var">ppr</span></a></span><span> </span><span class="annot"><span class="annottext">CoVar
</span><a href="#local-6989586621681034194"><span class="hs-identifier hs-var">v</span></a></span><span> </span><span class="annot"><span class="annottext">SDoc -&gt; SDoc -&gt; SDoc
</span><a href="GHC.Utils.Outputable.html#%3C%2B%3E"><span class="hs-operator hs-var">&lt;+&gt;</span></a></span><span> </span><span class="annot"><span class="annottext">String -&gt; SDoc
</span><a href="GHC.Utils.Outputable.html#text"><span class="hs-identifier hs-var">text</span></a></span><span> </span><span class="annot"><span class="annottext">String
</span><span class="hs-string">&quot;|-&gt;&quot;</span></span><span> </span><span class="annot"><span class="annottext">SDoc -&gt; SDoc -&gt; SDoc
</span><a href="GHC.Utils.Outputable.html#%3C%2B%3E"><span class="hs-operator hs-var">&lt;+&gt;</span></a></span><span> </span><span class="annot"><span class="annottext">forall a. Outputable a =&gt; a -&gt; SDoc
</span><a href="GHC.Utils.Outputable.html#ppr"><span class="hs-identifier hs-var">ppr</span></a></span><span> </span><span class="annot"><span class="annottext">Type
</span><a href="#local-6989586621681034193"><span class="hs-identifier hs-var">ty</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-2031"></span><span>
</span><span id="line-2032"></span><span>
</span><span id="line-2033"></span><span class="hs-comment">-- | Erase the environments in a lifting context</span><span>
</span><span id="line-2034"></span><span class="annot"><a href="GHC.Core.Coercion.html#zapLiftingContext"><span class="hs-identifier hs-type">zapLiftingContext</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><a href="GHC.Core.Coercion.html#LiftingContext"><span class="hs-identifier hs-type">LiftingContext</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="GHC.Core.Coercion.html#LiftingContext"><span class="hs-identifier hs-type">LiftingContext</span></a></span><span>
</span><span id="line-2035"></span><span id="zapLiftingContext"><span class="annot"><span class="annottext">zapLiftingContext :: LiftingContext -&gt; LiftingContext
</span><a href="GHC.Core.Coercion.html#zapLiftingContext"><span class="hs-identifier hs-var hs-var">zapLiftingContext</span></a></span></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="GHC.Core.Coercion.html#LC"><span class="hs-identifier hs-type">LC</span></a></span><span> </span><span id="local-6989586621681034178"><span class="annot"><span class="annottext">TCvSubst
</span><a href="#local-6989586621681034178"><span class="hs-identifier hs-var">subst</span></a></span></span><span> </span><span class="annot"><span class="annottext">LiftCoEnv
</span><span class="hs-identifier">_</span></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">TCvSubst -&gt; LiftCoEnv -&gt; LiftingContext
</span><a href="GHC.Core.Coercion.html#LC"><span class="hs-identifier hs-var">LC</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">TCvSubst -&gt; TCvSubst
</span><a href="GHC.Core.TyCo.Subst.html#zapTCvSubst"><span class="hs-identifier hs-var">zapTCvSubst</span></a></span><span> </span><span class="annot"><span class="annottext">TCvSubst
</span><a href="#local-6989586621681034178"><span class="hs-identifier hs-var">subst</span></a></span><span class="hs-special">)</span><span> </span><span class="annot"><span class="annottext">forall a. VarEnv a
</span><a href="GHC.Types.Var.Env.html#emptyVarEnv"><span class="hs-identifier hs-var">emptyVarEnv</span></a></span><span>
</span><span id="line-2036"></span><span>
</span><span id="line-2037"></span><span class="hs-comment">-- | Like 'substForAllCoBndr', but works on a lifting context</span><span>
</span><span id="line-2038"></span><span class="annot"><a href="GHC.Core.Coercion.html#substForAllCoBndrUsingLC"><span class="hs-identifier hs-type">substForAllCoBndrUsingLC</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><span class="hs-identifier hs-type">Bool</span></span><span>
</span><span id="line-2039"></span><span>                            </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-special">(</span><span class="annot"><a href="GHC.Core.TyCo.Rep.html#Coercion"><span class="hs-identifier hs-type">Coercion</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="GHC.Core.TyCo.Rep.html#Coercion"><span class="hs-identifier hs-type">Coercion</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-2040"></span><span>                            </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="GHC.Core.Coercion.html#LiftingContext"><span class="hs-identifier hs-type">LiftingContext</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="GHC.Types.Var.html#TyCoVar"><span class="hs-identifier hs-type">TyCoVar</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="GHC.Core.TyCo.Rep.html#Coercion"><span class="hs-identifier hs-type">Coercion</span></a></span><span>
</span><span id="line-2041"></span><span>                            </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-special">(</span><span class="annot"><a href="GHC.Core.Coercion.html#LiftingContext"><span class="hs-identifier hs-type">LiftingContext</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><a href="GHC.Types.Var.html#TyCoVar"><span class="hs-identifier hs-type">TyCoVar</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><a href="GHC.Core.TyCo.Rep.html#Coercion"><span class="hs-identifier hs-type">Coercion</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-2042"></span><span id="substForAllCoBndrUsingLC"><span class="annot"><span class="annottext">substForAllCoBndrUsingLC :: Bool
-&gt; (Coercion -&gt; Coercion)
-&gt; LiftingContext
-&gt; CoVar
-&gt; Coercion
-&gt; (LiftingContext, CoVar, Coercion)
</span><a href="GHC.Core.Coercion.html#substForAllCoBndrUsingLC"><span class="hs-identifier hs-var hs-var">substForAllCoBndrUsingLC</span></a></span></span><span> </span><span id="local-6989586621681034177"><span class="annot"><span class="annottext">Bool
</span><a href="#local-6989586621681034177"><span class="hs-identifier hs-var">sym</span></a></span></span><span> </span><span id="local-6989586621681034176"><span class="annot"><span class="annottext">Coercion -&gt; Coercion
</span><a href="#local-6989586621681034176"><span class="hs-identifier hs-var">sco</span></a></span></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="GHC.Core.Coercion.html#LC"><span class="hs-identifier hs-type">LC</span></a></span><span> </span><span id="local-6989586621681034175"><span class="annot"><span class="annottext">TCvSubst
</span><a href="#local-6989586621681034175"><span class="hs-identifier hs-var">subst</span></a></span></span><span> </span><span id="local-6989586621681034174"><span class="annot"><span class="annottext">LiftCoEnv
</span><a href="#local-6989586621681034174"><span class="hs-identifier hs-var">lc_env</span></a></span></span><span class="hs-special">)</span><span> </span><span id="local-6989586621681034173"><span class="annot"><span class="annottext">CoVar
</span><a href="#local-6989586621681034173"><span class="hs-identifier hs-var">tv</span></a></span></span><span> </span><span id="local-6989586621681034172"><span class="annot"><span class="annottext">Coercion
</span><a href="#local-6989586621681034172"><span class="hs-identifier hs-var">co</span></a></span></span><span>
</span><span id="line-2043"></span><span>  </span><span class="hs-glyph">=</span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">TCvSubst -&gt; LiftCoEnv -&gt; LiftingContext
</span><a href="GHC.Core.Coercion.html#LC"><span class="hs-identifier hs-var">LC</span></a></span><span> </span><span class="annot"><span class="annottext">TCvSubst
</span><a href="#local-6989586621681034171"><span class="hs-identifier hs-var">subst'</span></a></span><span> </span><span class="annot"><span class="annottext">LiftCoEnv
</span><a href="#local-6989586621681034174"><span class="hs-identifier hs-var">lc_env</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">CoVar
</span><a href="#local-6989586621681034170"><span class="hs-identifier hs-var">tv'</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">Coercion
</span><a href="#local-6989586621681034169"><span class="hs-identifier hs-var">co'</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-2044"></span><span>  </span><span class="hs-keyword">where</span><span>
</span><span id="line-2045"></span><span>    </span><span class="hs-special">(</span><span id="local-6989586621681034171"><span class="annot"><span class="annottext">TCvSubst
</span><a href="#local-6989586621681034171"><span class="hs-identifier hs-var">subst'</span></a></span></span><span class="hs-special">,</span><span> </span><span id="local-6989586621681034170"><span class="annot"><span class="annottext">CoVar
</span><a href="#local-6989586621681034170"><span class="hs-identifier hs-var">tv'</span></a></span></span><span class="hs-special">,</span><span> </span><span id="local-6989586621681034169"><span class="annot"><span class="annottext">Coercion
</span><a href="#local-6989586621681034169"><span class="hs-identifier hs-var">co'</span></a></span></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">Bool
-&gt; (Coercion -&gt; Coercion)
-&gt; TCvSubst
-&gt; CoVar
-&gt; Coercion
-&gt; (TCvSubst, CoVar, Coercion)
</span><a href="GHC.Core.TyCo.Subst.html#substForAllCoBndrUsing"><span class="hs-identifier hs-var">substForAllCoBndrUsing</span></a></span><span> </span><span class="annot"><span class="annottext">Bool
</span><a href="#local-6989586621681034177"><span class="hs-identifier hs-var">sym</span></a></span><span> </span><span class="annot"><span class="annottext">Coercion -&gt; Coercion
</span><a href="#local-6989586621681034176"><span class="hs-identifier hs-var">sco</span></a></span><span> </span><span class="annot"><span class="annottext">TCvSubst
</span><a href="#local-6989586621681034175"><span class="hs-identifier hs-var">subst</span></a></span><span> </span><span class="annot"><span class="annottext">CoVar
</span><a href="#local-6989586621681034173"><span class="hs-identifier hs-var">tv</span></a></span><span> </span><span class="annot"><span class="annottext">Coercion
</span><a href="#local-6989586621681034172"><span class="hs-identifier hs-var">co</span></a></span><span>
</span><span id="line-2046"></span><span>
</span><span id="line-2047"></span><span class="hs-comment">-- | The \&quot;lifting\&quot; operation which substitutes coercions for type</span><span>
</span><span id="line-2048"></span><span class="hs-comment">--   variables in a type to produce a coercion.</span><span>
</span><span id="line-2049"></span><span class="hs-comment">--</span><span>
</span><span id="line-2050"></span><span class="hs-comment">--   For the inverse operation, see 'liftCoMatch'</span><span>
</span><span id="line-2051"></span><span class="annot"><a href="GHC.Core.Coercion.html#ty_co_subst"><span class="hs-identifier hs-type">ty_co_subst</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><a href="GHC.Core.Coercion.html#LiftingContext"><span class="hs-identifier hs-type">LiftingContext</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="GHC.Core.Coercion.Axiom.html#Role"><span class="hs-identifier hs-type">Role</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="GHC.Core.TyCo.Rep.html#Type"><span class="hs-identifier hs-type">Type</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="GHC.Core.TyCo.Rep.html#Coercion"><span class="hs-identifier hs-type">Coercion</span></a></span><span>
</span><span id="line-2052"></span><span id="ty_co_subst"><span class="annot"><span class="annottext">ty_co_subst :: LiftingContext -&gt; Role -&gt; Type -&gt; Coercion
</span><a href="GHC.Core.Coercion.html#ty_co_subst"><span class="hs-identifier hs-var hs-var">ty_co_subst</span></a></span></span><span> </span><span class="hs-glyph">!</span><span id="local-6989586621681034167"><span class="annot"><span class="annottext">LiftingContext
</span><a href="#local-6989586621681034167"><span class="hs-identifier hs-var">lc</span></a></span></span><span> </span><span id="local-6989586621681034166"><span class="annot"><span class="annottext">Role
</span><a href="#local-6989586621681034166"><span class="hs-keyword hs-var">role</span></a></span></span><span> </span><span id="local-6989586621681034165"><span class="annot"><span class="annottext">Type
</span><a href="#local-6989586621681034165"><span class="hs-identifier hs-var">ty</span></a></span></span><span>
</span><span id="line-2053"></span><span>    </span><span class="hs-comment">-- !lc: making this function strict in lc allows callers to</span><span>
</span><span id="line-2054"></span><span>    </span><span class="hs-comment">-- pass its two components separately, rather than boxing them</span><span>
</span><span id="line-2055"></span><span>  </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">Role -&gt; Type -&gt; Coercion
</span><a href="#local-6989586621681034164"><span class="hs-identifier hs-var">go</span></a></span><span> </span><span class="annot"><span class="annottext">Role
</span><a href="#local-6989586621681034166"><span class="hs-keyword hs-var">role</span></a></span><span> </span><span class="annot"><span class="annottext">Type
</span><a href="#local-6989586621681034165"><span class="hs-identifier hs-var">ty</span></a></span><span>
</span><span id="line-2056"></span><span>  </span><span class="hs-keyword">where</span><span>
</span><span id="line-2057"></span><span>    </span><span class="annot"><a href="#local-6989586621681034164"><span class="hs-identifier hs-type">go</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><a href="GHC.Core.Coercion.Axiom.html#Role"><span class="hs-identifier hs-type">Role</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="GHC.Core.TyCo.Rep.html#Type"><span class="hs-identifier hs-type">Type</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="GHC.Core.TyCo.Rep.html#Coercion"><span class="hs-identifier hs-type">Coercion</span></a></span><span>
</span><span id="line-2058"></span><span>    </span><span id="local-6989586621681034164"><span class="annot"><span class="annottext">go :: Role -&gt; Type -&gt; Coercion
</span><a href="#local-6989586621681034164"><span class="hs-identifier hs-var hs-var">go</span></a></span></span><span> </span><span id="local-6989586621681034163"><span class="annot"><span class="annottext">Role
</span><a href="#local-6989586621681034163"><span class="hs-identifier hs-var">r</span></a></span></span><span> </span><span id="local-6989586621681034162"><span class="annot"><span class="annottext">Type
</span><a href="#local-6989586621681034162"><span class="hs-identifier hs-var">ty</span></a></span></span><span>                </span><span class="hs-glyph">|</span><span> </span><span class="annot"><a href="../../base-4.16.4.0/src/GHC-Maybe.html#Just"><span class="hs-identifier hs-type">Just</span></a></span><span> </span><span id="local-6989586621681034161"><span class="annot"><span class="annottext">Type
</span><a href="#local-6989586621681034161"><span class="hs-identifier hs-var">ty'</span></a></span></span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">Type -&gt; Maybe Type
</span><a href="GHC.Core.Type.html#coreView"><span class="hs-identifier hs-var">coreView</span></a></span><span> </span><span class="annot"><span class="annottext">Type
</span><a href="#local-6989586621681034162"><span class="hs-identifier hs-var">ty</span></a></span><span>
</span><span id="line-2059"></span><span>                           </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">Role -&gt; Type -&gt; Coercion
</span><a href="#local-6989586621681034164"><span class="hs-identifier hs-var">go</span></a></span><span> </span><span class="annot"><span class="annottext">Role
</span><a href="#local-6989586621681034163"><span class="hs-identifier hs-var">r</span></a></span><span> </span><span class="annot"><span class="annottext">Type
</span><a href="#local-6989586621681034161"><span class="hs-identifier hs-var">ty'</span></a></span><span>
</span><span id="line-2060"></span><span>    </span><span class="annot"><a href="#local-6989586621681034164"><span class="hs-identifier hs-var">go</span></a></span><span> </span><span class="annot"><span class="annottext">Role
</span><a href="GHC.Core.Coercion.Axiom.html#Phantom"><span class="hs-identifier hs-var">Phantom</span></a></span><span> </span><span id="local-6989586621681034159"><span class="annot"><span class="annottext">Type
</span><a href="#local-6989586621681034159"><span class="hs-identifier hs-var">ty</span></a></span></span><span>          </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">Type -&gt; Coercion
</span><a href="#local-6989586621681034158"><span class="hs-identifier hs-var">lift_phantom</span></a></span><span> </span><span class="annot"><span class="annottext">Type
</span><a href="#local-6989586621681034159"><span class="hs-identifier hs-var">ty</span></a></span><span>
</span><span id="line-2061"></span><span>    </span><span class="annot"><a href="#local-6989586621681034164"><span class="hs-identifier hs-var">go</span></a></span><span> </span><span id="local-6989586621681034157"><span class="annot"><span class="annottext">Role
</span><a href="#local-6989586621681034157"><span class="hs-identifier hs-var">r</span></a></span></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="GHC.Core.TyCo.Rep.html#TyVarTy"><span class="hs-identifier hs-type">TyVarTy</span></a></span><span> </span><span id="local-6989586621681034155"><span class="annot"><span class="annottext">CoVar
</span><a href="#local-6989586621681034155"><span class="hs-identifier hs-var">tv</span></a></span></span><span class="hs-special">)</span><span>      </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">forall a. HasCallStack =&gt; String -&gt; Maybe a -&gt; a
</span><a href="GHC.Data.Maybe.html#expectJust"><span class="hs-identifier hs-var">expectJust</span></a></span><span> </span><span class="annot"><span class="annottext">String
</span><span class="hs-string">&quot;ty_co_subst bad roles&quot;</span></span><span> </span><span class="annot"><span class="annottext">forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><a href="../../base-4.16.4.0/src/GHC-Base.html#%24"><span class="hs-operator hs-var">$</span></a></span><span>
</span><span id="line-2062"></span><span>                             </span><span class="annot"><span class="annottext">LiftingContext -&gt; Role -&gt; CoVar -&gt; Maybe Coercion
</span><a href="GHC.Core.Coercion.html#liftCoSubstTyVar"><span class="hs-identifier hs-var">liftCoSubstTyVar</span></a></span><span> </span><span class="annot"><span class="annottext">LiftingContext
</span><a href="#local-6989586621681034167"><span class="hs-identifier hs-var">lc</span></a></span><span> </span><span class="annot"><span class="annottext">Role
</span><a href="#local-6989586621681034157"><span class="hs-identifier hs-var">r</span></a></span><span> </span><span class="annot"><span class="annottext">CoVar
</span><a href="#local-6989586621681034155"><span class="hs-identifier hs-var">tv</span></a></span><span>
</span><span id="line-2063"></span><span>    </span><span class="annot"><a href="#local-6989586621681034164"><span class="hs-identifier hs-var">go</span></a></span><span> </span><span id="local-6989586621681034153"><span class="annot"><span class="annottext">Role
</span><a href="#local-6989586621681034153"><span class="hs-identifier hs-var">r</span></a></span></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="GHC.Core.TyCo.Rep.html#AppTy"><span class="hs-identifier hs-type">AppTy</span></a></span><span> </span><span id="local-6989586621681034151"><span class="annot"><span class="annottext">Type
</span><a href="#local-6989586621681034151"><span class="hs-identifier hs-var">ty1</span></a></span></span><span> </span><span id="local-6989586621681034150"><span class="annot"><span class="annottext">Type
</span><a href="#local-6989586621681034150"><span class="hs-identifier hs-var">ty2</span></a></span></span><span class="hs-special">)</span><span>   </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">Coercion -&gt; Coercion -&gt; Coercion
</span><a href="GHC.Core.Coercion.html#mkAppCo"><span class="hs-identifier hs-var">mkAppCo</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Role -&gt; Type -&gt; Coercion
</span><a href="#local-6989586621681034164"><span class="hs-identifier hs-var">go</span></a></span><span> </span><span class="annot"><span class="annottext">Role
</span><a href="#local-6989586621681034153"><span class="hs-identifier hs-var">r</span></a></span><span> </span><span class="annot"><span class="annottext">Type
</span><a href="#local-6989586621681034151"><span class="hs-identifier hs-var">ty1</span></a></span><span class="hs-special">)</span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Role -&gt; Type -&gt; Coercion
</span><a href="#local-6989586621681034164"><span class="hs-identifier hs-var">go</span></a></span><span> </span><span class="annot"><span class="annottext">Role
</span><a href="GHC.Core.Coercion.Axiom.html#Nominal"><span class="hs-identifier hs-var">Nominal</span></a></span><span> </span><span class="annot"><span class="annottext">Type
</span><a href="#local-6989586621681034150"><span class="hs-identifier hs-var">ty2</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-2064"></span><span>    </span><span class="annot"><a href="#local-6989586621681034164"><span class="hs-identifier hs-var">go</span></a></span><span> </span><span id="local-6989586621681034149"><span class="annot"><span class="annottext">Role
</span><a href="#local-6989586621681034149"><span class="hs-identifier hs-var">r</span></a></span></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="GHC.Core.TyCo.Rep.html#TyConApp"><span class="hs-identifier hs-type">TyConApp</span></a></span><span> </span><span id="local-6989586621681034147"><span class="annot"><span class="annottext">TyCon
</span><a href="#local-6989586621681034147"><span class="hs-identifier hs-var">tc</span></a></span></span><span> </span><span id="local-6989586621681034146"><span class="annot"><span class="annottext">[Type]
</span><a href="#local-6989586621681034146"><span class="hs-identifier hs-var">tys</span></a></span></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">HasDebugCallStack =&gt; Role -&gt; TyCon -&gt; [Coercion] -&gt; Coercion
</span><a href="GHC.Core.Coercion.html#mkTyConAppCo"><span class="hs-identifier hs-var">mkTyConAppCo</span></a></span><span> </span><span class="annot"><span class="annottext">Role
</span><a href="#local-6989586621681034149"><span class="hs-identifier hs-var">r</span></a></span><span> </span><span class="annot"><span class="annottext">TyCon
</span><a href="#local-6989586621681034147"><span class="hs-identifier hs-var">tc</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">forall a b c. (a -&gt; b -&gt; c) -&gt; [a] -&gt; [b] -&gt; [c]
</span><a href="../../base-4.16.4.0/src/GHC-List.html#zipWith"><span class="hs-identifier hs-var">zipWith</span></a></span><span> </span><span class="annot"><span class="annottext">Role -&gt; Type -&gt; Coercion
</span><a href="#local-6989586621681034164"><span class="hs-identifier hs-var">go</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Role -&gt; TyCon -&gt; [Role]
</span><a href="GHC.Core.Coercion.html#tyConRolesX"><span class="hs-identifier hs-var">tyConRolesX</span></a></span><span> </span><span class="annot"><span class="annottext">Role
</span><a href="#local-6989586621681034149"><span class="hs-identifier hs-var">r</span></a></span><span> </span><span class="annot"><span class="annottext">TyCon
</span><a href="#local-6989586621681034147"><span class="hs-identifier hs-var">tc</span></a></span><span class="hs-special">)</span><span> </span><span class="annot"><span class="annottext">[Type]
</span><a href="#local-6989586621681034146"><span class="hs-identifier hs-var">tys</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-2065"></span><span>    </span><span class="annot"><a href="#local-6989586621681034164"><span class="hs-identifier hs-var">go</span></a></span><span> </span><span id="local-6989586621681034145"><span class="annot"><span class="annottext">Role
</span><a href="#local-6989586621681034145"><span class="hs-identifier hs-var">r</span></a></span></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="GHC.Core.TyCo.Rep.html#FunTy"><span class="hs-identifier hs-type">FunTy</span></a></span><span> </span><span class="annot"><span class="annottext">AnonArgFlag
</span><span class="hs-identifier">_</span></span><span> </span><span id="local-6989586621681034143"><span class="annot"><span class="annottext">Type
</span><a href="#local-6989586621681034143"><span class="hs-identifier hs-var">w</span></a></span></span><span> </span><span id="local-6989586621681034142"><span class="annot"><span class="annottext">Type
</span><a href="#local-6989586621681034142"><span class="hs-identifier hs-var">ty1</span></a></span></span><span> </span><span id="local-6989586621681034141"><span class="annot"><span class="annottext">Type
</span><a href="#local-6989586621681034141"><span class="hs-identifier hs-var">ty2</span></a></span></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">Role -&gt; Coercion -&gt; Coercion -&gt; Coercion -&gt; Coercion
</span><a href="GHC.Core.Coercion.html#mkFunCo"><span class="hs-identifier hs-var">mkFunCo</span></a></span><span> </span><span class="annot"><span class="annottext">Role
</span><a href="#local-6989586621681034145"><span class="hs-identifier hs-var">r</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Role -&gt; Type -&gt; Coercion
</span><a href="#local-6989586621681034164"><span class="hs-identifier hs-var">go</span></a></span><span> </span><span class="annot"><span class="annottext">Role
</span><a href="GHC.Core.Coercion.Axiom.html#Nominal"><span class="hs-identifier hs-var">Nominal</span></a></span><span> </span><span class="annot"><span class="annottext">Type
</span><a href="#local-6989586621681034143"><span class="hs-identifier hs-var">w</span></a></span><span class="hs-special">)</span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Role -&gt; Type -&gt; Coercion
</span><a href="#local-6989586621681034164"><span class="hs-identifier hs-var">go</span></a></span><span> </span><span class="annot"><span class="annottext">Role
</span><a href="#local-6989586621681034145"><span class="hs-identifier hs-var">r</span></a></span><span> </span><span class="annot"><span class="annottext">Type
</span><a href="#local-6989586621681034142"><span class="hs-identifier hs-var">ty1</span></a></span><span class="hs-special">)</span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Role -&gt; Type -&gt; Coercion
</span><a href="#local-6989586621681034164"><span class="hs-identifier hs-var">go</span></a></span><span> </span><span class="annot"><span class="annottext">Role
</span><a href="#local-6989586621681034145"><span class="hs-identifier hs-var">r</span></a></span><span> </span><span class="annot"><span class="annottext">Type
</span><a href="#local-6989586621681034141"><span class="hs-identifier hs-var">ty2</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-2066"></span><span>    </span><span class="annot"><a href="#local-6989586621681034164"><span class="hs-identifier hs-var">go</span></a></span><span> </span><span id="local-6989586621681034140"><span class="annot"><span class="annottext">Role
</span><a href="#local-6989586621681034140"><span class="hs-identifier hs-var">r</span></a></span></span><span> </span><span id="local-6989586621681034139"><span class="annot"><span class="annottext">t :: Type
</span><a href="#local-6989586621681034139"><span class="hs-identifier hs-var">t</span></a></span></span><span class="hs-glyph">@</span><span class="hs-special">(</span><span class="annot"><a href="GHC.Core.TyCo.Rep.html#ForAllTy"><span class="hs-identifier hs-type">ForAllTy</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="GHC.Types.Var.html#Bndr"><span class="hs-identifier hs-type">Bndr</span></a></span><span> </span><span id="local-6989586621681034136"><span class="annot"><span class="annottext">CoVar
</span><a href="#local-6989586621681034136"><span class="hs-identifier hs-var">v</span></a></span></span><span> </span><span class="annot"><span class="annottext">ArgFlag
</span><span class="hs-identifier">_</span></span><span class="hs-special">)</span><span> </span><span id="local-6989586621681034135"><span class="annot"><span class="annottext">Type
</span><a href="#local-6989586621681034135"><span class="hs-identifier hs-var">ty</span></a></span></span><span class="hs-special">)</span><span>
</span><span id="line-2067"></span><span>       </span><span class="hs-glyph">=</span><span> </span><span class="hs-keyword">let</span><span> </span><span class="hs-special">(</span><span id="local-6989586621681034134"><span class="annot"><span class="annottext">LiftingContext
</span><a href="#local-6989586621681034134"><span class="hs-identifier hs-var">lc'</span></a></span></span><span class="hs-special">,</span><span> </span><span id="local-6989586621681034133"><span class="annot"><span class="annottext">CoVar
</span><a href="#local-6989586621681034133"><span class="hs-identifier hs-var">v'</span></a></span></span><span class="hs-special">,</span><span> </span><span id="local-6989586621681034132"><span class="annot"><span class="annottext">Coercion
</span><a href="#local-6989586621681034132"><span class="hs-identifier hs-var">h</span></a></span></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">LiftingContext -&gt; CoVar -&gt; (LiftingContext, CoVar, Coercion)
</span><a href="GHC.Core.Coercion.html#liftCoSubstVarBndr"><span class="hs-identifier hs-var">liftCoSubstVarBndr</span></a></span><span> </span><span class="annot"><span class="annottext">LiftingContext
</span><a href="#local-6989586621681034167"><span class="hs-identifier hs-var">lc</span></a></span><span> </span><span class="annot"><span class="annottext">CoVar
</span><a href="#local-6989586621681034136"><span class="hs-identifier hs-var">v</span></a></span><span>
</span><span id="line-2068"></span><span>             </span><span id="local-6989586621681034130"><span class="annot"><span class="annottext">body_co :: Coercion
</span><a href="#local-6989586621681034130"><span class="hs-identifier hs-var hs-var">body_co</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">LiftingContext -&gt; Role -&gt; Type -&gt; Coercion
</span><a href="GHC.Core.Coercion.html#ty_co_subst"><span class="hs-identifier hs-var">ty_co_subst</span></a></span><span> </span><span class="annot"><span class="annottext">LiftingContext
</span><a href="#local-6989586621681034134"><span class="hs-identifier hs-var">lc'</span></a></span><span> </span><span class="annot"><span class="annottext">Role
</span><a href="#local-6989586621681034140"><span class="hs-identifier hs-var">r</span></a></span><span> </span><span class="annot"><span class="annottext">Type
</span><a href="#local-6989586621681034135"><span class="hs-identifier hs-var">ty</span></a></span><span> </span><span class="hs-keyword">in</span><span>
</span><span id="line-2069"></span><span>         </span><span class="hs-keyword">if</span><span> </span><span class="annot"><span class="annottext">CoVar -&gt; Bool
</span><a href="GHC.Types.Var.html#isTyVar"><span class="hs-identifier hs-var">isTyVar</span></a></span><span> </span><span class="annot"><span class="annottext">CoVar
</span><a href="#local-6989586621681034133"><span class="hs-identifier hs-var">v'</span></a></span><span> </span><span class="annot"><span class="annottext">Bool -&gt; Bool -&gt; Bool
</span><span class="hs-operator hs-var">||</span></span><span> </span><span class="annot"><span class="annottext">CoVar -&gt; Coercion -&gt; Bool
</span><a href="GHC.Core.TyCo.FVs.html#almostDevoidCoVarOfCo"><span class="hs-identifier hs-var">almostDevoidCoVarOfCo</span></a></span><span> </span><span class="annot"><span class="annottext">CoVar
</span><a href="#local-6989586621681034133"><span class="hs-identifier hs-var">v'</span></a></span><span> </span><span class="annot"><span class="annottext">Coercion
</span><a href="#local-6989586621681034130"><span class="hs-identifier hs-var">body_co</span></a></span><span>
</span><span id="line-2070"></span><span>           </span><span class="hs-comment">-- Lifting a ForAllTy over a coercion variable could fail as ForAllCo</span><span>
</span><span id="line-2071"></span><span>           </span><span class="hs-comment">-- imposes an extra restriction on where a covar can appear. See last</span><span>
</span><span id="line-2072"></span><span>           </span><span class="hs-comment">-- wrinkle in Note [Unused coercion variable in ForAllCo].</span><span>
</span><span id="line-2073"></span><span>           </span><span class="hs-comment">-- We specifically check for this and panic because we know that</span><span>
</span><span id="line-2074"></span><span>           </span><span class="hs-comment">-- there's a hole in the type system here, and we'd rather panic than</span><span>
</span><span id="line-2075"></span><span>           </span><span class="hs-comment">-- fall into it.</span><span>
</span><span id="line-2076"></span><span>         </span><span class="hs-keyword">then</span><span> </span><span class="annot"><span class="annottext">CoVar -&gt; Coercion -&gt; Coercion -&gt; Coercion
</span><a href="GHC.Core.Coercion.html#mkForAllCo"><span class="hs-identifier hs-var">mkForAllCo</span></a></span><span> </span><span class="annot"><span class="annottext">CoVar
</span><a href="#local-6989586621681034133"><span class="hs-identifier hs-var">v'</span></a></span><span> </span><span class="annot"><span class="annottext">Coercion
</span><a href="#local-6989586621681034132"><span class="hs-identifier hs-var">h</span></a></span><span> </span><span class="annot"><span class="annottext">Coercion
</span><a href="#local-6989586621681034130"><span class="hs-identifier hs-var">body_co</span></a></span><span>
</span><span id="line-2077"></span><span>         </span><span class="hs-keyword">else</span><span> </span><span class="annot"><span class="annottext">forall a. HasCallStack =&gt; String -&gt; SDoc -&gt; a
</span><a href="GHC.Utils.Panic.html#pprPanic"><span class="hs-identifier hs-var">pprPanic</span></a></span><span> </span><span class="annot"><span class="annottext">String
</span><span class="hs-string">&quot;ty_co_subst: covar is not almost devoid&quot;</span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">forall a. Outputable a =&gt; a -&gt; SDoc
</span><a href="GHC.Utils.Outputable.html#ppr"><span class="hs-identifier hs-var">ppr</span></a></span><span> </span><span class="annot"><span class="annottext">Type
</span><a href="#local-6989586621681034139"><span class="hs-identifier hs-var">t</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-2078"></span><span>    </span><span class="annot"><a href="#local-6989586621681034164"><span class="hs-identifier hs-var">go</span></a></span><span> </span><span id="local-6989586621681034129"><span class="annot"><span class="annottext">Role
</span><a href="#local-6989586621681034129"><span class="hs-identifier hs-var">r</span></a></span></span><span> </span><span id="local-6989586621681034128"><span class="annot"><span class="annottext">ty :: Type
</span><a href="#local-6989586621681034128"><span class="hs-identifier hs-var">ty</span></a></span></span><span class="hs-glyph">@</span><span class="hs-special">(</span><span class="annot"><a href="GHC.Core.TyCo.Rep.html#LitTy"><span class="hs-identifier hs-type">LitTy</span></a></span><span> </span><span class="hs-special">{</span><span class="hs-special">}</span><span class="hs-special">)</span><span>     </span><span class="hs-glyph">=</span><span> </span><span class="hs-identifier">ASSERT</span><span class="hs-special">(</span><span> </span><span class="hs-identifier">r</span><span> </span><span class="hs-operator">==</span><span> </span><span class="hs-identifier">Nominal</span><span> </span><span class="hs-special">)</span><span>
</span><span id="line-2079"></span><span>                             </span><span class="annot"><span class="annottext">Type -&gt; Coercion
</span><a href="GHC.Core.Coercion.html#mkNomReflCo"><span class="hs-identifier hs-var">mkNomReflCo</span></a></span><span> </span><span class="annot"><span class="annottext">Type
</span><a href="#local-6989586621681034128"><span class="hs-identifier hs-var">ty</span></a></span><span>
</span><span id="line-2080"></span><span>    </span><span class="annot"><a href="#local-6989586621681034164"><span class="hs-identifier hs-var">go</span></a></span><span> </span><span id="local-6989586621681034126"><span class="annot"><span class="annottext">Role
</span><a href="#local-6989586621681034126"><span class="hs-identifier hs-var">r</span></a></span></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="GHC.Core.TyCo.Rep.html#CastTy"><span class="hs-identifier hs-type">CastTy</span></a></span><span> </span><span id="local-6989586621681034125"><span class="annot"><span class="annottext">Type
</span><a href="#local-6989586621681034125"><span class="hs-identifier hs-var">ty</span></a></span></span><span> </span><span id="local-6989586621681034124"><span class="annot"><span class="annottext">Coercion
</span><a href="#local-6989586621681034124"><span class="hs-identifier hs-var">co</span></a></span></span><span class="hs-special">)</span><span>    </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">Coercion -&gt; Coercion -&gt; Coercion -&gt; Coercion
</span><a href="GHC.Core.Coercion.html#castCoercionKind"><span class="hs-identifier hs-var">castCoercionKind</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Role -&gt; Type -&gt; Coercion
</span><a href="#local-6989586621681034164"><span class="hs-identifier hs-var">go</span></a></span><span> </span><span class="annot"><span class="annottext">Role
</span><a href="#local-6989586621681034126"><span class="hs-identifier hs-var">r</span></a></span><span> </span><span class="annot"><span class="annottext">Type
</span><a href="#local-6989586621681034125"><span class="hs-identifier hs-var">ty</span></a></span><span class="hs-special">)</span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">LiftingContext -&gt; Coercion -&gt; Coercion
</span><a href="GHC.Core.Coercion.html#substLeftCo"><span class="hs-identifier hs-var">substLeftCo</span></a></span><span> </span><span class="annot"><span class="annottext">LiftingContext
</span><a href="#local-6989586621681034167"><span class="hs-identifier hs-var">lc</span></a></span><span> </span><span class="annot"><span class="annottext">Coercion
</span><a href="#local-6989586621681034124"><span class="hs-identifier hs-var">co</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-2081"></span><span>                                                        </span><span class="hs-special">(</span><span class="annot"><span class="annottext">LiftingContext -&gt; Coercion -&gt; Coercion
</span><a href="GHC.Core.Coercion.html#substRightCo"><span class="hs-identifier hs-var">substRightCo</span></a></span><span> </span><span class="annot"><span class="annottext">LiftingContext
</span><a href="#local-6989586621681034167"><span class="hs-identifier hs-var">lc</span></a></span><span> </span><span class="annot"><span class="annottext">Coercion
</span><a href="#local-6989586621681034124"><span class="hs-identifier hs-var">co</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-2082"></span><span>    </span><span class="annot"><a href="#local-6989586621681034164"><span class="hs-identifier hs-var">go</span></a></span><span> </span><span id="local-6989586621681034123"><span class="annot"><span class="annottext">Role
</span><a href="#local-6989586621681034123"><span class="hs-identifier hs-var">r</span></a></span></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="GHC.Core.TyCo.Rep.html#CoercionTy"><span class="hs-identifier hs-type">CoercionTy</span></a></span><span> </span><span id="local-6989586621681034122"><span class="annot"><span class="annottext">Coercion
</span><a href="#local-6989586621681034122"><span class="hs-identifier hs-var">co</span></a></span></span><span class="hs-special">)</span><span>   </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">Role -&gt; Coercion -&gt; Coercion -&gt; Coercion -&gt; Coercion
</span><a href="GHC.Core.Coercion.html#mkProofIrrelCo"><span class="hs-identifier hs-var">mkProofIrrelCo</span></a></span><span> </span><span class="annot"><span class="annottext">Role
</span><a href="#local-6989586621681034123"><span class="hs-identifier hs-var">r</span></a></span><span> </span><span class="annot"><span class="annottext">Coercion
</span><a href="#local-6989586621681034121"><span class="hs-identifier hs-var">kco</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">LiftingContext -&gt; Coercion -&gt; Coercion
</span><a href="GHC.Core.Coercion.html#substLeftCo"><span class="hs-identifier hs-var">substLeftCo</span></a></span><span> </span><span class="annot"><span class="annottext">LiftingContext
</span><a href="#local-6989586621681034167"><span class="hs-identifier hs-var">lc</span></a></span><span> </span><span class="annot"><span class="annottext">Coercion
</span><a href="#local-6989586621681034122"><span class="hs-identifier hs-var">co</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-2083"></span><span>                                                  </span><span class="hs-special">(</span><span class="annot"><span class="annottext">LiftingContext -&gt; Coercion -&gt; Coercion
</span><a href="GHC.Core.Coercion.html#substRightCo"><span class="hs-identifier hs-var">substRightCo</span></a></span><span> </span><span class="annot"><span class="annottext">LiftingContext
</span><a href="#local-6989586621681034167"><span class="hs-identifier hs-var">lc</span></a></span><span> </span><span class="annot"><span class="annottext">Coercion
</span><a href="#local-6989586621681034122"><span class="hs-identifier hs-var">co</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-2084"></span><span>      </span><span class="hs-keyword">where</span><span> </span><span id="local-6989586621681034121"><span class="annot"><span class="annottext">kco :: Coercion
</span><a href="#local-6989586621681034121"><span class="hs-identifier hs-var hs-var">kco</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">Role -&gt; Type -&gt; Coercion
</span><a href="#local-6989586621681034164"><span class="hs-identifier hs-var">go</span></a></span><span> </span><span class="annot"><span class="annottext">Role
</span><a href="GHC.Core.Coercion.Axiom.html#Nominal"><span class="hs-identifier hs-var">Nominal</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Coercion -&gt; Type
</span><a href="GHC.Core.Coercion.html#coercionType"><span class="hs-identifier hs-var">coercionType</span></a></span><span> </span><span class="annot"><span class="annottext">Coercion
</span><a href="#local-6989586621681034122"><span class="hs-identifier hs-var">co</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-2085"></span><span>
</span><span id="line-2086"></span><span>    </span><span id="local-6989586621681034158"><span class="annot"><span class="annottext">lift_phantom :: Type -&gt; Coercion
</span><a href="#local-6989586621681034158"><span class="hs-identifier hs-var hs-var">lift_phantom</span></a></span></span><span> </span><span id="local-6989586621681034120"><span class="annot"><span class="annottext">Type
</span><a href="#local-6989586621681034120"><span class="hs-identifier hs-var">ty</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">Coercion -&gt; Type -&gt; Type -&gt; Coercion
</span><a href="GHC.Core.Coercion.html#mkPhantomCo"><span class="hs-identifier hs-var">mkPhantomCo</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Role -&gt; Type -&gt; Coercion
</span><a href="#local-6989586621681034164"><span class="hs-identifier hs-var">go</span></a></span><span> </span><span class="annot"><span class="annottext">Role
</span><a href="GHC.Core.Coercion.Axiom.html#Nominal"><span class="hs-identifier hs-var">Nominal</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">HasDebugCallStack =&gt; Type -&gt; Type
</span><a href="GHC.Core.Type.html#typeKind"><span class="hs-identifier hs-var">typeKind</span></a></span><span> </span><span class="annot"><span class="annottext">Type
</span><a href="#local-6989586621681034120"><span class="hs-identifier hs-var">ty</span></a></span><span class="hs-special">)</span><span class="hs-special">)</span><span>
</span><span id="line-2087"></span><span>                                  </span><span class="hs-special">(</span><span class="annot"><span class="annottext">HasCallStack =&gt; TCvSubst -&gt; Type -&gt; Type
</span><a href="GHC.Core.TyCo.Subst.html#substTy"><span class="hs-identifier hs-var">substTy</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">LiftingContext -&gt; TCvSubst
</span><a href="GHC.Core.Coercion.html#lcSubstLeft"><span class="hs-identifier hs-var">lcSubstLeft</span></a></span><span>  </span><span class="annot"><span class="annottext">LiftingContext
</span><a href="#local-6989586621681034167"><span class="hs-identifier hs-var">lc</span></a></span><span class="hs-special">)</span><span> </span><span class="annot"><span class="annottext">Type
</span><a href="#local-6989586621681034120"><span class="hs-identifier hs-var">ty</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-2088"></span><span>                                  </span><span class="hs-special">(</span><span class="annot"><span class="annottext">HasCallStack =&gt; TCvSubst -&gt; Type -&gt; Type
</span><a href="GHC.Core.TyCo.Subst.html#substTy"><span class="hs-identifier hs-var">substTy</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">LiftingContext -&gt; TCvSubst
</span><a href="GHC.Core.Coercion.html#lcSubstRight"><span class="hs-identifier hs-var">lcSubstRight</span></a></span><span> </span><span class="annot"><span class="annottext">LiftingContext
</span><a href="#local-6989586621681034167"><span class="hs-identifier hs-var">lc</span></a></span><span class="hs-special">)</span><span> </span><span class="annot"><span class="annottext">Type
</span><a href="#local-6989586621681034120"><span class="hs-identifier hs-var">ty</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-2089"></span><span>
</span><span id="line-2090"></span><span class="hs-comment">{-
Note [liftCoSubstTyVar]
~~~~~~~~~~~~~~~~~~~~~~~~~
This function can fail if a coercion in the environment is of too low a role.

liftCoSubstTyVar is called from two places: in liftCoSubst (naturally), and
also in matchAxiom in GHC.Core.Coercion.Opt. From liftCoSubst, the so-called lifting
lemma guarantees that the roles work out. If we fail in this
case, we really should panic -- something is deeply wrong. But, in matchAxiom,
failing is fine. matchAxiom is trying to find a set of coercions
that match, but it may fail, and this is healthy behavior.
-}</span><span>
</span><span id="line-2102"></span><span>
</span><span id="line-2103"></span><span class="hs-comment">-- See Note [liftCoSubstTyVar]</span><span>
</span><span id="line-2104"></span><span class="annot"><a href="GHC.Core.Coercion.html#liftCoSubstTyVar"><span class="hs-identifier hs-type">liftCoSubstTyVar</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><a href="GHC.Core.Coercion.html#LiftingContext"><span class="hs-identifier hs-type">LiftingContext</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="GHC.Core.Coercion.Axiom.html#Role"><span class="hs-identifier hs-type">Role</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="GHC.Types.Var.html#TyVar"><span class="hs-identifier hs-type">TyVar</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="../../base-4.16.4.0/src/GHC-Maybe.html#Maybe"><span class="hs-identifier hs-type">Maybe</span></a></span><span> </span><span class="annot"><a href="GHC.Core.TyCo.Rep.html#Coercion"><span class="hs-identifier hs-type">Coercion</span></a></span><span>
</span><span id="line-2105"></span><span id="liftCoSubstTyVar"><span class="annot"><span class="annottext">liftCoSubstTyVar :: LiftingContext -&gt; Role -&gt; CoVar -&gt; Maybe Coercion
</span><a href="GHC.Core.Coercion.html#liftCoSubstTyVar"><span class="hs-identifier hs-var hs-var">liftCoSubstTyVar</span></a></span></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="GHC.Core.Coercion.html#LC"><span class="hs-identifier hs-type">LC</span></a></span><span> </span><span id="local-6989586621681034119"><span class="annot"><span class="annottext">TCvSubst
</span><a href="#local-6989586621681034119"><span class="hs-identifier hs-var">subst</span></a></span></span><span> </span><span id="local-6989586621681034118"><span class="annot"><span class="annottext">LiftCoEnv
</span><a href="#local-6989586621681034118"><span class="hs-identifier hs-var">env</span></a></span></span><span class="hs-special">)</span><span> </span><span id="local-6989586621681034117"><span class="annot"><span class="annottext">Role
</span><a href="#local-6989586621681034117"><span class="hs-identifier hs-var">r</span></a></span></span><span> </span><span id="local-6989586621681034116"><span class="annot"><span class="annottext">CoVar
</span><a href="#local-6989586621681034116"><span class="hs-identifier hs-var">v</span></a></span></span><span>
</span><span id="line-2106"></span><span>  </span><span class="hs-glyph">|</span><span> </span><span class="annot"><a href="../../base-4.16.4.0/src/GHC-Maybe.html#Just"><span class="hs-identifier hs-type">Just</span></a></span><span> </span><span id="local-6989586621681034115"><span class="annot"><span class="annottext">Coercion
</span><a href="#local-6989586621681034115"><span class="hs-identifier hs-var">co_arg</span></a></span></span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">forall a. VarEnv a -&gt; CoVar -&gt; Maybe a
</span><a href="GHC.Types.Var.Env.html#lookupVarEnv"><span class="hs-identifier hs-var">lookupVarEnv</span></a></span><span> </span><span class="annot"><span class="annottext">LiftCoEnv
</span><a href="#local-6989586621681034118"><span class="hs-identifier hs-var">env</span></a></span><span> </span><span class="annot"><span class="annottext">CoVar
</span><a href="#local-6989586621681034116"><span class="hs-identifier hs-var">v</span></a></span><span>
</span><span id="line-2107"></span><span>  </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">Role -&gt; Role -&gt; Coercion -&gt; Maybe Coercion
</span><a href="GHC.Core.Coercion.html#downgradeRole_maybe"><span class="hs-identifier hs-var">downgradeRole_maybe</span></a></span><span> </span><span class="annot"><span class="annottext">Role
</span><a href="#local-6989586621681034117"><span class="hs-identifier hs-var">r</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Coercion -&gt; Role
</span><a href="GHC.Core.Coercion.html#coercionRole"><span class="hs-identifier hs-var">coercionRole</span></a></span><span> </span><span class="annot"><span class="annottext">Coercion
</span><a href="#local-6989586621681034115"><span class="hs-identifier hs-var">co_arg</span></a></span><span class="hs-special">)</span><span> </span><span class="annot"><span class="annottext">Coercion
</span><a href="#local-6989586621681034115"><span class="hs-identifier hs-var">co_arg</span></a></span><span>
</span><span id="line-2108"></span><span>
</span><span id="line-2109"></span><span>  </span><span class="hs-glyph">|</span><span> </span><span class="annot"><span class="annottext">Bool
</span><a href="../../base-4.16.4.0/src/GHC-Base.html#otherwise"><span class="hs-identifier hs-var">otherwise</span></a></span><span>
</span><span id="line-2110"></span><span>  </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">forall a. a -&gt; Maybe a
</span><a href="../../base-4.16.4.0/src/GHC-Maybe.html#Just"><span class="hs-identifier hs-var">Just</span></a></span><span> </span><span class="annot"><span class="annottext">forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><a href="../../base-4.16.4.0/src/GHC-Base.html#%24"><span class="hs-operator hs-var">$</span></a></span><span> </span><span class="annot"><span class="annottext">Role -&gt; Type -&gt; Coercion
</span><a href="GHC.Core.Coercion.html#mkReflCo"><span class="hs-identifier hs-var">mkReflCo</span></a></span><span> </span><span class="annot"><span class="annottext">Role
</span><a href="#local-6989586621681034117"><span class="hs-identifier hs-var">r</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">TCvSubst -&gt; CoVar -&gt; Type
</span><a href="GHC.Core.TyCo.Subst.html#substTyVar"><span class="hs-identifier hs-var">substTyVar</span></a></span><span> </span><span class="annot"><span class="annottext">TCvSubst
</span><a href="#local-6989586621681034119"><span class="hs-identifier hs-var">subst</span></a></span><span> </span><span class="annot"><span class="annottext">CoVar
</span><a href="#local-6989586621681034116"><span class="hs-identifier hs-var">v</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-2111"></span><span>
</span><span id="line-2112"></span><span class="hs-comment">{- Note [liftCoSubstVarBndr]

callback:
  We want 'liftCoSubstVarBndrUsing' to be general enough to be reused in
  FamInstEnv, therefore the input arg 'fun' returns a pair with polymorphic type
  in snd.
  However in 'liftCoSubstVarBndr', we don't need the snd, so we use unit and
  ignore the fourth component of the return value.

liftCoSubstTyVarBndrUsing:
  Given
    forall tv:k. t
  We want to get
    forall (tv:k1) (kind_co :: k1 ~ k2) body_co

  We lift the kind k to get the kind_co
    kind_co = ty_co_subst k :: k1 ~ k2

  Now in the LiftingContext, we add the new mapping
    tv |-&gt; (tv :: k1) ~ ((tv |&gt; kind_co) :: k2)

liftCoSubstCoVarBndrUsing:
  Given
    forall cv:(s1 ~ s2). t
  We want to get
    forall (cv:s1'~s2') (kind_co :: (s1'~s2') ~ (t1 ~ t2)) body_co

  We lift s1 and s2 respectively to get
    eta1 :: s1' ~ t1
    eta2 :: s2' ~ t2
  And
    kind_co = TyConAppCo Nominal (~#) eta1 eta2

  Now in the liftingContext, we add the new mapping
    cv |-&gt; (cv :: s1' ~ s2') ~ ((sym eta1;cv;eta2) :: t1 ~ t2)
-}</span><span>
</span><span id="line-2148"></span><span>
</span><span id="line-2149"></span><span class="hs-comment">-- See Note [liftCoSubstVarBndr]</span><span>
</span><span id="line-2150"></span><span class="annot"><a href="GHC.Core.Coercion.html#liftCoSubstVarBndr"><span class="hs-identifier hs-type">liftCoSubstVarBndr</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><a href="GHC.Core.Coercion.html#LiftingContext"><span class="hs-identifier hs-type">LiftingContext</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="GHC.Types.Var.html#TyCoVar"><span class="hs-identifier hs-type">TyCoVar</span></a></span><span>
</span><span id="line-2151"></span><span>                   </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-special">(</span><span class="annot"><a href="GHC.Core.Coercion.html#LiftingContext"><span class="hs-identifier hs-type">LiftingContext</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><a href="GHC.Types.Var.html#TyCoVar"><span class="hs-identifier hs-type">TyCoVar</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><a href="GHC.Core.TyCo.Rep.html#Coercion"><span class="hs-identifier hs-type">Coercion</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-2152"></span><span id="liftCoSubstVarBndr"><span class="annot"><span class="annottext">liftCoSubstVarBndr :: LiftingContext -&gt; CoVar -&gt; (LiftingContext, CoVar, Coercion)
</span><a href="GHC.Core.Coercion.html#liftCoSubstVarBndr"><span class="hs-identifier hs-var hs-var">liftCoSubstVarBndr</span></a></span></span><span> </span><span id="local-6989586621681034112"><span class="annot"><span class="annottext">LiftingContext
</span><a href="#local-6989586621681034112"><span class="hs-identifier hs-var">lc</span></a></span></span><span> </span><span id="local-6989586621681034111"><span class="annot"><span class="annottext">CoVar
</span><a href="#local-6989586621681034111"><span class="hs-identifier hs-var">tv</span></a></span></span><span>
</span><span id="line-2153"></span><span>  </span><span class="hs-glyph">=</span><span> </span><span class="hs-keyword">let</span><span> </span><span class="hs-special">(</span><span id="local-6989586621681034110"><span class="annot"><span class="annottext">LiftingContext
</span><a href="#local-6989586621681034110"><span class="hs-identifier hs-var">lc'</span></a></span></span><span class="hs-special">,</span><span> </span><span id="local-6989586621681034109"><span class="annot"><span class="annottext">CoVar
</span><a href="#local-6989586621681034109"><span class="hs-identifier hs-var">tv'</span></a></span></span><span class="hs-special">,</span><span> </span><span id="local-6989586621681034108"><span class="annot"><span class="annottext">Coercion
</span><a href="#local-6989586621681034108"><span class="hs-identifier hs-var">h</span></a></span></span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">()
</span><span class="hs-identifier">_</span></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">forall a.
(LiftingContext -&gt; Type -&gt; (Coercion, a))
-&gt; LiftingContext -&gt; CoVar -&gt; (LiftingContext, CoVar, Coercion, a)
</span><a href="GHC.Core.Coercion.html#liftCoSubstVarBndrUsing"><span class="hs-identifier hs-var">liftCoSubstVarBndrUsing</span></a></span><span> </span><span class="annot"><span class="annottext">LiftingContext -&gt; Type -&gt; (Coercion, ())
</span><a href="#local-6989586621681034107"><span class="hs-identifier hs-var">callback</span></a></span><span> </span><span class="annot"><span class="annottext">LiftingContext
</span><a href="#local-6989586621681034112"><span class="hs-identifier hs-var">lc</span></a></span><span> </span><span class="annot"><span class="annottext">CoVar
</span><a href="#local-6989586621681034111"><span class="hs-identifier hs-var">tv</span></a></span><span> </span><span class="hs-keyword">in</span><span>
</span><span id="line-2154"></span><span>    </span><span class="hs-special">(</span><span class="annot"><span class="annottext">LiftingContext
</span><a href="#local-6989586621681034110"><span class="hs-identifier hs-var">lc'</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">CoVar
</span><a href="#local-6989586621681034109"><span class="hs-identifier hs-var">tv'</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">Coercion
</span><a href="#local-6989586621681034108"><span class="hs-identifier hs-var">h</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-2155"></span><span>  </span><span class="hs-keyword">where</span><span>
</span><span id="line-2156"></span><span>    </span><span id="local-6989586621681034107"><span class="annot"><span class="annottext">callback :: LiftingContext -&gt; Type -&gt; (Coercion, ())
</span><a href="#local-6989586621681034107"><span class="hs-identifier hs-var hs-var">callback</span></a></span></span><span> </span><span id="local-6989586621681034106"><span class="annot"><span class="annottext">LiftingContext
</span><a href="#local-6989586621681034106"><span class="hs-identifier hs-var">lc'</span></a></span></span><span> </span><span id="local-6989586621681034105"><span class="annot"><span class="annottext">Type
</span><a href="#local-6989586621681034105"><span class="hs-identifier hs-var">ty'</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">LiftingContext -&gt; Role -&gt; Type -&gt; Coercion
</span><a href="GHC.Core.Coercion.html#ty_co_subst"><span class="hs-identifier hs-var">ty_co_subst</span></a></span><span> </span><span class="annot"><span class="annottext">LiftingContext
</span><a href="#local-6989586621681034106"><span class="hs-identifier hs-var">lc'</span></a></span><span> </span><span class="annot"><span class="annottext">Role
</span><a href="GHC.Core.Coercion.Axiom.html#Nominal"><span class="hs-identifier hs-var">Nominal</span></a></span><span> </span><span class="annot"><span class="annottext">Type
</span><a href="#local-6989586621681034105"><span class="hs-identifier hs-var">ty'</span></a></span><span class="hs-special">,</span><span> </span><span class="hs-special">(</span><span class="hs-special">)</span><span class="hs-special">)</span><span>
</span><span id="line-2157"></span><span>
</span><span id="line-2158"></span><span class="hs-comment">-- the callback must produce a nominal coercion</span><span>
</span><span id="line-2159"></span><span id="local-6989586621681035620"><span class="annot"><a href="GHC.Core.Coercion.html#liftCoSubstVarBndrUsing"><span class="hs-identifier hs-type">liftCoSubstVarBndrUsing</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="hs-special">(</span><span class="annot"><a href="GHC.Core.Coercion.html#LiftingContext"><span class="hs-identifier hs-type">LiftingContext</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="GHC.Core.TyCo.Rep.html#Type"><span class="hs-identifier hs-type">Type</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-special">(</span><span class="annot"><a href="GHC.Core.TyCo.Rep.html#CoercionN"><span class="hs-identifier hs-type">CoercionN</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><a href="#local-6989586621681035620"><span class="hs-identifier hs-type">a</span></a></span><span class="hs-special">)</span><span class="hs-special">)</span><span>
</span><span id="line-2160"></span><span>                           </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="GHC.Core.Coercion.html#LiftingContext"><span class="hs-identifier hs-type">LiftingContext</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="GHC.Types.Var.html#TyCoVar"><span class="hs-identifier hs-type">TyCoVar</span></a></span><span>
</span><span id="line-2161"></span><span>                           </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-special">(</span><span class="annot"><a href="GHC.Core.Coercion.html#LiftingContext"><span class="hs-identifier hs-type">LiftingContext</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><a href="GHC.Types.Var.html#TyCoVar"><span class="hs-identifier hs-type">TyCoVar</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><a href="GHC.Core.TyCo.Rep.html#CoercionN"><span class="hs-identifier hs-type">CoercionN</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><a href="#local-6989586621681035620"><span class="hs-identifier hs-type">a</span></a></span><span class="hs-special">)</span></span><span>
</span><span id="line-2162"></span><span id="liftCoSubstVarBndrUsing"><span class="annot"><span class="annottext">liftCoSubstVarBndrUsing :: forall a.
(LiftingContext -&gt; Type -&gt; (Coercion, a))
-&gt; LiftingContext -&gt; CoVar -&gt; (LiftingContext, CoVar, Coercion, a)
</span><a href="GHC.Core.Coercion.html#liftCoSubstVarBndrUsing"><span class="hs-identifier hs-var hs-var">liftCoSubstVarBndrUsing</span></a></span></span><span> </span><span id="local-6989586621681034104"><span class="annot"><span class="annottext">LiftingContext -&gt; Type -&gt; (Coercion, a)
</span><a href="#local-6989586621681034104"><span class="hs-identifier hs-var">fun</span></a></span></span><span> </span><span id="local-6989586621681034103"><span class="annot"><span class="annottext">LiftingContext
</span><a href="#local-6989586621681034103"><span class="hs-identifier hs-var">lc</span></a></span></span><span> </span><span id="local-6989586621681034102"><span class="annot"><span class="annottext">CoVar
</span><a href="#local-6989586621681034102"><span class="hs-identifier hs-var">old_var</span></a></span></span><span>
</span><span id="line-2163"></span><span>  </span><span class="hs-glyph">|</span><span> </span><span class="annot"><span class="annottext">CoVar -&gt; Bool
</span><a href="GHC.Types.Var.html#isTyVar"><span class="hs-identifier hs-var">isTyVar</span></a></span><span> </span><span class="annot"><span class="annottext">CoVar
</span><a href="#local-6989586621681034102"><span class="hs-identifier hs-var">old_var</span></a></span><span>
</span><span id="line-2164"></span><span>  </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">forall a.
(LiftingContext -&gt; Type -&gt; (Coercion, a))
-&gt; LiftingContext -&gt; CoVar -&gt; (LiftingContext, CoVar, Coercion, a)
</span><a href="GHC.Core.Coercion.html#liftCoSubstTyVarBndrUsing"><span class="hs-identifier hs-var">liftCoSubstTyVarBndrUsing</span></a></span><span> </span><span class="annot"><span class="annottext">LiftingContext -&gt; Type -&gt; (Coercion, a)
</span><a href="#local-6989586621681034104"><span class="hs-identifier hs-var">fun</span></a></span><span> </span><span class="annot"><span class="annottext">LiftingContext
</span><a href="#local-6989586621681034103"><span class="hs-identifier hs-var">lc</span></a></span><span> </span><span class="annot"><span class="annottext">CoVar
</span><a href="#local-6989586621681034102"><span class="hs-identifier hs-var">old_var</span></a></span><span>
</span><span id="line-2165"></span><span>  </span><span class="hs-glyph">|</span><span> </span><span class="annot"><span class="annottext">Bool
</span><a href="../../base-4.16.4.0/src/GHC-Base.html#otherwise"><span class="hs-identifier hs-var">otherwise</span></a></span><span>
</span><span id="line-2166"></span><span>  </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">forall a.
(LiftingContext -&gt; Type -&gt; (Coercion, a))
-&gt; LiftingContext -&gt; CoVar -&gt; (LiftingContext, CoVar, Coercion, a)
</span><a href="GHC.Core.Coercion.html#liftCoSubstCoVarBndrUsing"><span class="hs-identifier hs-var">liftCoSubstCoVarBndrUsing</span></a></span><span> </span><span class="annot"><span class="annottext">LiftingContext -&gt; Type -&gt; (Coercion, a)
</span><a href="#local-6989586621681034104"><span class="hs-identifier hs-var">fun</span></a></span><span> </span><span class="annot"><span class="annottext">LiftingContext
</span><a href="#local-6989586621681034103"><span class="hs-identifier hs-var">lc</span></a></span><span> </span><span class="annot"><span class="annottext">CoVar
</span><a href="#local-6989586621681034102"><span class="hs-identifier hs-var">old_var</span></a></span><span>
</span><span id="line-2167"></span><span>
</span><span id="line-2168"></span><span class="hs-comment">-- Works for tyvar binder</span><span>
</span><span id="line-2169"></span><span id="local-6989586621681034099"><span class="annot"><a href="GHC.Core.Coercion.html#liftCoSubstTyVarBndrUsing"><span class="hs-identifier hs-type">liftCoSubstTyVarBndrUsing</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="hs-special">(</span><span class="annot"><a href="GHC.Core.Coercion.html#LiftingContext"><span class="hs-identifier hs-type">LiftingContext</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="GHC.Core.TyCo.Rep.html#Type"><span class="hs-identifier hs-type">Type</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-special">(</span><span class="annot"><a href="GHC.Core.TyCo.Rep.html#CoercionN"><span class="hs-identifier hs-type">CoercionN</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><a href="#local-6989586621681034099"><span class="hs-identifier hs-type">a</span></a></span><span class="hs-special">)</span><span class="hs-special">)</span><span>
</span><span id="line-2170"></span><span>                           </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="GHC.Core.Coercion.html#LiftingContext"><span class="hs-identifier hs-type">LiftingContext</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="GHC.Types.Var.html#TyVar"><span class="hs-identifier hs-type">TyVar</span></a></span><span>
</span><span id="line-2171"></span><span>                           </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-special">(</span><span class="annot"><a href="GHC.Core.Coercion.html#LiftingContext"><span class="hs-identifier hs-type">LiftingContext</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><a href="GHC.Types.Var.html#TyVar"><span class="hs-identifier hs-type">TyVar</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><a href="GHC.Core.TyCo.Rep.html#CoercionN"><span class="hs-identifier hs-type">CoercionN</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><a href="#local-6989586621681034099"><span class="hs-identifier hs-type">a</span></a></span><span class="hs-special">)</span></span><span>
</span><span id="line-2172"></span><span id="liftCoSubstTyVarBndrUsing"><span class="annot"><span class="annottext">liftCoSubstTyVarBndrUsing :: forall a.
(LiftingContext -&gt; Type -&gt; (Coercion, a))
-&gt; LiftingContext -&gt; CoVar -&gt; (LiftingContext, CoVar, Coercion, a)
</span><a href="GHC.Core.Coercion.html#liftCoSubstTyVarBndrUsing"><span class="hs-identifier hs-var hs-var">liftCoSubstTyVarBndrUsing</span></a></span></span><span> </span><span id="local-6989586621681034098"><span class="annot"><span class="annottext">LiftingContext -&gt; Type -&gt; (Coercion, a)
</span><a href="#local-6989586621681034098"><span class="hs-identifier hs-var">fun</span></a></span></span><span> </span><span id="local-6989586621681034097"><span class="annot"><span class="annottext">lc :: LiftingContext
</span><a href="#local-6989586621681034097"><span class="hs-identifier hs-var">lc</span></a></span></span><span class="hs-glyph">@</span><span class="hs-special">(</span><span class="annot"><a href="GHC.Core.Coercion.html#LC"><span class="hs-identifier hs-type">LC</span></a></span><span> </span><span id="local-6989586621681034096"><span class="annot"><span class="annottext">TCvSubst
</span><a href="#local-6989586621681034096"><span class="hs-identifier hs-var">subst</span></a></span></span><span> </span><span id="local-6989586621681034095"><span class="annot"><span class="annottext">LiftCoEnv
</span><a href="#local-6989586621681034095"><span class="hs-identifier hs-var">cenv</span></a></span></span><span class="hs-special">)</span><span> </span><span id="local-6989586621681034094"><span class="annot"><span class="annottext">CoVar
</span><a href="#local-6989586621681034094"><span class="hs-identifier hs-var">old_var</span></a></span></span><span>
</span><span id="line-2173"></span><span>  </span><span class="hs-glyph">=</span><span> </span><span class="hs-identifier">ASSERT</span><span class="hs-special">(</span><span> </span><span class="hs-identifier">isTyVar</span><span> </span><span class="hs-identifier">old_var</span><span> </span><span class="hs-special">)</span><span>
</span><span id="line-2174"></span><span>    </span><span class="hs-special">(</span><span> </span><span class="annot"><span class="annottext">TCvSubst -&gt; LiftCoEnv -&gt; LiftingContext
</span><a href="GHC.Core.Coercion.html#LC"><span class="hs-identifier hs-var">LC</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">TCvSubst
</span><a href="#local-6989586621681034096"><span class="hs-identifier hs-var">subst</span></a></span><span> </span><span class="annot"><span class="annottext">TCvSubst -&gt; CoVar -&gt; TCvSubst
</span><a href="GHC.Core.TyCo.Subst.html#extendTCvInScope"><span class="hs-operator hs-var">`extendTCvInScope`</span></a></span><span> </span><span class="annot"><span class="annottext">CoVar
</span><a href="#local-6989586621681034092"><span class="hs-identifier hs-var">new_var</span></a></span><span class="hs-special">)</span><span> </span><span class="annot"><span class="annottext">LiftCoEnv
</span><a href="#local-6989586621681034091"><span class="hs-identifier hs-var">new_cenv</span></a></span><span>
</span><span id="line-2175"></span><span>    </span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">CoVar
</span><a href="#local-6989586621681034092"><span class="hs-identifier hs-var">new_var</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">Coercion
</span><a href="#local-6989586621681034090"><span class="hs-identifier hs-var">eta</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">a
</span><a href="#local-6989586621681034089"><span class="hs-identifier hs-var">stuff</span></a></span><span> </span><span class="hs-special">)</span><span>
</span><span id="line-2176"></span><span>  </span><span class="hs-keyword">where</span><span>
</span><span id="line-2177"></span><span>    </span><span id="local-6989586621681034088"><span class="annot"><span class="annottext">old_kind :: Type
</span><a href="#local-6989586621681034088"><span class="hs-identifier hs-var hs-var">old_kind</span></a></span></span><span>     </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">CoVar -&gt; Type
</span><a href="GHC.Types.Var.html#tyVarKind"><span class="hs-identifier hs-var">tyVarKind</span></a></span><span> </span><span class="annot"><span class="annottext">CoVar
</span><a href="#local-6989586621681034094"><span class="hs-identifier hs-var">old_var</span></a></span><span>
</span><span id="line-2178"></span><span>    </span><span class="hs-special">(</span><span id="local-6989586621681034090"><span class="annot"><span class="annottext">Coercion
</span><a href="#local-6989586621681034090"><span class="hs-identifier hs-var">eta</span></a></span></span><span class="hs-special">,</span><span> </span><span id="local-6989586621681034089"><span class="annot"><span class="annottext">a
</span><a href="#local-6989586621681034089"><span class="hs-identifier hs-var">stuff</span></a></span></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">LiftingContext -&gt; Type -&gt; (Coercion, a)
</span><a href="#local-6989586621681034098"><span class="hs-identifier hs-var">fun</span></a></span><span> </span><span class="annot"><span class="annottext">LiftingContext
</span><a href="#local-6989586621681034097"><span class="hs-identifier hs-var">lc</span></a></span><span> </span><span class="annot"><span class="annottext">Type
</span><a href="#local-6989586621681034088"><span class="hs-identifier hs-var">old_kind</span></a></span><span>
</span><span id="line-2179"></span><span>    </span><span id="local-6989586621681034087"><span class="annot"><span class="annottext">k1 :: Type
</span><a href="#local-6989586621681034087"><span class="hs-identifier hs-var hs-var">k1</span></a></span></span><span>           </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">Coercion -&gt; Type
</span><a href="GHC.Core.Coercion.html#coercionLKind"><span class="hs-identifier hs-var">coercionLKind</span></a></span><span> </span><span class="annot"><span class="annottext">Coercion
</span><a href="#local-6989586621681034090"><span class="hs-identifier hs-var">eta</span></a></span><span>
</span><span id="line-2180"></span><span>    </span><span id="local-6989586621681034092"><span class="annot"><span class="annottext">new_var :: CoVar
</span><a href="#local-6989586621681034092"><span class="hs-identifier hs-var hs-var">new_var</span></a></span></span><span>      </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">InScopeSet -&gt; CoVar -&gt; CoVar
</span><a href="GHC.Types.Var.Env.html#uniqAway"><span class="hs-identifier hs-var">uniqAway</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">TCvSubst -&gt; InScopeSet
</span><a href="GHC.Core.TyCo.Subst.html#getTCvInScope"><span class="hs-identifier hs-var">getTCvInScope</span></a></span><span> </span><span class="annot"><span class="annottext">TCvSubst
</span><a href="#local-6989586621681034096"><span class="hs-identifier hs-var">subst</span></a></span><span class="hs-special">)</span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">CoVar -&gt; Type -&gt; CoVar
</span><a href="GHC.Types.Var.html#setVarType"><span class="hs-identifier hs-var">setVarType</span></a></span><span> </span><span class="annot"><span class="annottext">CoVar
</span><a href="#local-6989586621681034094"><span class="hs-identifier hs-var">old_var</span></a></span><span> </span><span class="annot"><span class="annottext">Type
</span><a href="#local-6989586621681034087"><span class="hs-identifier hs-var">k1</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-2181"></span><span>
</span><span id="line-2182"></span><span>    </span><span id="local-6989586621681034083"><span class="annot"><span class="annottext">lifted :: Coercion
</span><a href="#local-6989586621681034083"><span class="hs-identifier hs-var hs-var">lifted</span></a></span></span><span>   </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">Role -&gt; Type -&gt; Coercion -&gt; Coercion
</span><a href="GHC.Core.Coercion.html#mkGReflRightCo"><span class="hs-identifier hs-var">mkGReflRightCo</span></a></span><span> </span><span class="annot"><span class="annottext">Role
</span><a href="GHC.Core.Coercion.Axiom.html#Nominal"><span class="hs-identifier hs-var">Nominal</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">CoVar -&gt; Type
</span><a href="GHC.Core.TyCo.Rep.html#TyVarTy"><span class="hs-identifier hs-var">TyVarTy</span></a></span><span> </span><span class="annot"><span class="annottext">CoVar
</span><a href="#local-6989586621681034092"><span class="hs-identifier hs-var">new_var</span></a></span><span class="hs-special">)</span><span> </span><span class="annot"><span class="annottext">Coercion
</span><a href="#local-6989586621681034090"><span class="hs-identifier hs-var">eta</span></a></span><span>
</span><span id="line-2183"></span><span>               </span><span class="hs-comment">-- :: new_var ~ new_var |&gt; eta</span><span>
</span><span id="line-2184"></span><span>    </span><span id="local-6989586621681034091"><span class="annot"><span class="annottext">new_cenv :: LiftCoEnv
</span><a href="#local-6989586621681034091"><span class="hs-identifier hs-var hs-var">new_cenv</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">forall a. VarEnv a -&gt; CoVar -&gt; a -&gt; VarEnv a
</span><a href="GHC.Types.Var.Env.html#extendVarEnv"><span class="hs-identifier hs-var">extendVarEnv</span></a></span><span> </span><span class="annot"><span class="annottext">LiftCoEnv
</span><a href="#local-6989586621681034095"><span class="hs-identifier hs-var">cenv</span></a></span><span> </span><span class="annot"><span class="annottext">CoVar
</span><a href="#local-6989586621681034094"><span class="hs-identifier hs-var">old_var</span></a></span><span> </span><span class="annot"><span class="annottext">Coercion
</span><a href="#local-6989586621681034083"><span class="hs-identifier hs-var">lifted</span></a></span><span>
</span><span id="line-2185"></span><span>
</span><span id="line-2186"></span><span class="hs-comment">-- Works for covar binder</span><span>
</span><span id="line-2187"></span><span id="local-6989586621681034082"><span class="annot"><a href="GHC.Core.Coercion.html#liftCoSubstCoVarBndrUsing"><span class="hs-identifier hs-type">liftCoSubstCoVarBndrUsing</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="hs-special">(</span><span class="annot"><a href="GHC.Core.Coercion.html#LiftingContext"><span class="hs-identifier hs-type">LiftingContext</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="GHC.Core.TyCo.Rep.html#Type"><span class="hs-identifier hs-type">Type</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-special">(</span><span class="annot"><a href="GHC.Core.TyCo.Rep.html#CoercionN"><span class="hs-identifier hs-type">CoercionN</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><a href="#local-6989586621681034082"><span class="hs-identifier hs-type">a</span></a></span><span class="hs-special">)</span><span class="hs-special">)</span><span>
</span><span id="line-2188"></span><span>                           </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="GHC.Core.Coercion.html#LiftingContext"><span class="hs-identifier hs-type">LiftingContext</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="GHC.Types.Var.html#CoVar"><span class="hs-identifier hs-type">CoVar</span></a></span><span>
</span><span id="line-2189"></span><span>                           </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-special">(</span><span class="annot"><a href="GHC.Core.Coercion.html#LiftingContext"><span class="hs-identifier hs-type">LiftingContext</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><a href="GHC.Types.Var.html#CoVar"><span class="hs-identifier hs-type">CoVar</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><a href="GHC.Core.TyCo.Rep.html#CoercionN"><span class="hs-identifier hs-type">CoercionN</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><a href="#local-6989586621681034082"><span class="hs-identifier hs-type">a</span></a></span><span class="hs-special">)</span></span><span>
</span><span id="line-2190"></span><span id="liftCoSubstCoVarBndrUsing"><span class="annot"><span class="annottext">liftCoSubstCoVarBndrUsing :: forall a.
(LiftingContext -&gt; Type -&gt; (Coercion, a))
-&gt; LiftingContext -&gt; CoVar -&gt; (LiftingContext, CoVar, Coercion, a)
</span><a href="GHC.Core.Coercion.html#liftCoSubstCoVarBndrUsing"><span class="hs-identifier hs-var hs-var">liftCoSubstCoVarBndrUsing</span></a></span></span><span> </span><span id="local-6989586621681034078"><span class="annot"><span class="annottext">LiftingContext -&gt; Type -&gt; (Coercion, a)
</span><a href="#local-6989586621681034078"><span class="hs-identifier hs-var">fun</span></a></span></span><span> </span><span id="local-6989586621681034077"><span class="annot"><span class="annottext">lc :: LiftingContext
</span><a href="#local-6989586621681034077"><span class="hs-identifier hs-var">lc</span></a></span></span><span class="hs-glyph">@</span><span class="hs-special">(</span><span class="annot"><a href="GHC.Core.Coercion.html#LC"><span class="hs-identifier hs-type">LC</span></a></span><span> </span><span id="local-6989586621681034076"><span class="annot"><span class="annottext">TCvSubst
</span><a href="#local-6989586621681034076"><span class="hs-identifier hs-var">subst</span></a></span></span><span> </span><span id="local-6989586621681034075"><span class="annot"><span class="annottext">LiftCoEnv
</span><a href="#local-6989586621681034075"><span class="hs-identifier hs-var">cenv</span></a></span></span><span class="hs-special">)</span><span> </span><span id="local-6989586621681034074"><span class="annot"><span class="annottext">CoVar
</span><a href="#local-6989586621681034074"><span class="hs-identifier hs-var">old_var</span></a></span></span><span>
</span><span id="line-2191"></span><span>  </span><span class="hs-glyph">=</span><span> </span><span class="hs-identifier">ASSERT</span><span class="hs-special">(</span><span> </span><span class="hs-identifier">isCoVar</span><span> </span><span class="hs-identifier">old_var</span><span> </span><span class="hs-special">)</span><span>
</span><span id="line-2192"></span><span>    </span><span class="hs-special">(</span><span> </span><span class="annot"><span class="annottext">TCvSubst -&gt; LiftCoEnv -&gt; LiftingContext
</span><a href="GHC.Core.Coercion.html#LC"><span class="hs-identifier hs-var">LC</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">TCvSubst
</span><a href="#local-6989586621681034076"><span class="hs-identifier hs-var">subst</span></a></span><span> </span><span class="annot"><span class="annottext">TCvSubst -&gt; CoVar -&gt; TCvSubst
</span><a href="GHC.Core.TyCo.Subst.html#extendTCvInScope"><span class="hs-operator hs-var">`extendTCvInScope`</span></a></span><span> </span><span class="annot"><span class="annottext">CoVar
</span><a href="#local-6989586621681034073"><span class="hs-identifier hs-var">new_var</span></a></span><span class="hs-special">)</span><span> </span><span class="annot"><span class="annottext">LiftCoEnv
</span><a href="#local-6989586621681034072"><span class="hs-identifier hs-var">new_cenv</span></a></span><span>
</span><span id="line-2193"></span><span>    </span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">CoVar
</span><a href="#local-6989586621681034073"><span class="hs-identifier hs-var">new_var</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">Coercion
</span><a href="#local-6989586621681034071"><span class="hs-identifier hs-var">kind_co</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">a
</span><a href="#local-6989586621681034070"><span class="hs-identifier hs-var">stuff</span></a></span><span> </span><span class="hs-special">)</span><span>
</span><span id="line-2194"></span><span>  </span><span class="hs-keyword">where</span><span>
</span><span id="line-2195"></span><span>    </span><span id="local-6989586621681034069"><span class="annot"><span class="annottext">old_kind :: Type
</span><a href="#local-6989586621681034069"><span class="hs-identifier hs-var hs-var">old_kind</span></a></span></span><span>     </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">CoVar -&gt; Type
</span><a href="GHC.Core.Coercion.html#coVarKind"><span class="hs-identifier hs-var">coVarKind</span></a></span><span> </span><span class="annot"><span class="annottext">CoVar
</span><a href="#local-6989586621681034074"><span class="hs-identifier hs-var">old_var</span></a></span><span>
</span><span id="line-2196"></span><span>    </span><span class="hs-special">(</span><span id="local-6989586621681034068"><span class="annot"><span class="annottext">Coercion
</span><a href="#local-6989586621681034068"><span class="hs-identifier hs-var">eta</span></a></span></span><span class="hs-special">,</span><span> </span><span id="local-6989586621681034070"><span class="annot"><span class="annottext">a
</span><a href="#local-6989586621681034070"><span class="hs-identifier hs-var">stuff</span></a></span></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">LiftingContext -&gt; Type -&gt; (Coercion, a)
</span><a href="#local-6989586621681034078"><span class="hs-identifier hs-var">fun</span></a></span><span> </span><span class="annot"><span class="annottext">LiftingContext
</span><a href="#local-6989586621681034077"><span class="hs-identifier hs-var">lc</span></a></span><span> </span><span class="annot"><span class="annottext">Type
</span><a href="#local-6989586621681034069"><span class="hs-identifier hs-var">old_kind</span></a></span><span>
</span><span id="line-2197"></span><span>    </span><span id="local-6989586621681034067"><span class="annot"><span class="annottext">k1 :: Type
</span><a href="#local-6989586621681034067"><span class="hs-identifier hs-var hs-var">k1</span></a></span></span><span>           </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">Coercion -&gt; Type
</span><a href="GHC.Core.Coercion.html#coercionLKind"><span class="hs-identifier hs-var">coercionLKind</span></a></span><span> </span><span class="annot"><span class="annottext">Coercion
</span><a href="#local-6989586621681034068"><span class="hs-identifier hs-var">eta</span></a></span><span>
</span><span id="line-2198"></span><span>    </span><span id="local-6989586621681034073"><span class="annot"><span class="annottext">new_var :: CoVar
</span><a href="#local-6989586621681034073"><span class="hs-identifier hs-var hs-var">new_var</span></a></span></span><span>      </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">InScopeSet -&gt; CoVar -&gt; CoVar
</span><a href="GHC.Types.Var.Env.html#uniqAway"><span class="hs-identifier hs-var">uniqAway</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">TCvSubst -&gt; InScopeSet
</span><a href="GHC.Core.TyCo.Subst.html#getTCvInScope"><span class="hs-identifier hs-var">getTCvInScope</span></a></span><span> </span><span class="annot"><span class="annottext">TCvSubst
</span><a href="#local-6989586621681034076"><span class="hs-identifier hs-var">subst</span></a></span><span class="hs-special">)</span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">CoVar -&gt; Type -&gt; CoVar
</span><a href="GHC.Types.Var.html#setVarType"><span class="hs-identifier hs-var">setVarType</span></a></span><span> </span><span class="annot"><span class="annottext">CoVar
</span><a href="#local-6989586621681034074"><span class="hs-identifier hs-var">old_var</span></a></span><span> </span><span class="annot"><span class="annottext">Type
</span><a href="#local-6989586621681034067"><span class="hs-identifier hs-var">k1</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-2199"></span><span>
</span><span id="line-2200"></span><span>    </span><span class="hs-comment">-- old_var :: s1  ~r s2</span><span>
</span><span id="line-2201"></span><span>    </span><span class="hs-comment">-- eta     :: (s1' ~r s2') ~N (t1 ~r t2)</span><span>
</span><span id="line-2202"></span><span>    </span><span class="hs-comment">-- eta1    :: s1' ~r t1</span><span>
</span><span id="line-2203"></span><span>    </span><span class="hs-comment">-- eta2    :: s2' ~r t2</span><span>
</span><span id="line-2204"></span><span>    </span><span class="hs-comment">-- co1     :: s1' ~r s2'</span><span>
</span><span id="line-2205"></span><span>    </span><span class="hs-comment">-- co2     :: t1  ~r t2</span><span>
</span><span id="line-2206"></span><span>    </span><span class="hs-comment">-- kind_co :: (s1' ~r s2') ~N (t1 ~r t2)</span><span>
</span><span id="line-2207"></span><span>    </span><span class="hs-comment">-- lifted  :: co1 ~N co2</span><span>
</span><span id="line-2208"></span><span>
</span><span id="line-2209"></span><span>    </span><span id="local-6989586621681034066"><span class="annot"><span class="annottext">role :: Role
</span><a href="#local-6989586621681034066"><span class="hs-keyword hs-var hs-var">role</span></a></span></span><span>   </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">CoVar -&gt; Role
</span><a href="GHC.Core.Coercion.html#coVarRole"><span class="hs-identifier hs-var">coVarRole</span></a></span><span> </span><span class="annot"><span class="annottext">CoVar
</span><a href="#local-6989586621681034074"><span class="hs-identifier hs-var">old_var</span></a></span><span>
</span><span id="line-2210"></span><span>    </span><span id="local-6989586621681034065"><span class="annot"><span class="annottext">eta' :: Coercion
</span><a href="#local-6989586621681034065"><span class="hs-identifier hs-var hs-var">eta'</span></a></span></span><span>   </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">Role -&gt; Role -&gt; Coercion -&gt; Coercion
</span><a href="GHC.Core.Coercion.html#downgradeRole"><span class="hs-identifier hs-var">downgradeRole</span></a></span><span> </span><span class="annot"><span class="annottext">Role
</span><a href="#local-6989586621681034066"><span class="hs-keyword hs-var">role</span></a></span><span> </span><span class="annot"><span class="annottext">Role
</span><a href="GHC.Core.Coercion.Axiom.html#Nominal"><span class="hs-identifier hs-var">Nominal</span></a></span><span> </span><span class="annot"><span class="annottext">Coercion
</span><a href="#local-6989586621681034068"><span class="hs-identifier hs-var">eta</span></a></span><span>
</span><span id="line-2211"></span><span>    </span><span id="local-6989586621681034064"><span class="annot"><span class="annottext">eta1 :: Coercion
</span><a href="#local-6989586621681034064"><span class="hs-identifier hs-var hs-var">eta1</span></a></span></span><span>   </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">HasDebugCallStack =&gt; Role -&gt; Int -&gt; Coercion -&gt; Coercion
</span><a href="GHC.Core.Coercion.html#mkNthCo"><span class="hs-identifier hs-var">mkNthCo</span></a></span><span> </span><span class="annot"><span class="annottext">Role
</span><a href="#local-6989586621681034066"><span class="hs-keyword hs-var">role</span></a></span><span> </span><span class="annot"><span class="annottext">Int
</span><span class="hs-number">2</span></span><span> </span><span class="annot"><span class="annottext">Coercion
</span><a href="#local-6989586621681034065"><span class="hs-identifier hs-var">eta'</span></a></span><span>
</span><span id="line-2212"></span><span>    </span><span id="local-6989586621681034063"><span class="annot"><span class="annottext">eta2 :: Coercion
</span><a href="#local-6989586621681034063"><span class="hs-identifier hs-var hs-var">eta2</span></a></span></span><span>   </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">HasDebugCallStack =&gt; Role -&gt; Int -&gt; Coercion -&gt; Coercion
</span><a href="GHC.Core.Coercion.html#mkNthCo"><span class="hs-identifier hs-var">mkNthCo</span></a></span><span> </span><span class="annot"><span class="annottext">Role
</span><a href="#local-6989586621681034066"><span class="hs-keyword hs-var">role</span></a></span><span> </span><span class="annot"><span class="annottext">Int
</span><span class="hs-number">3</span></span><span> </span><span class="annot"><span class="annottext">Coercion
</span><a href="#local-6989586621681034065"><span class="hs-identifier hs-var">eta'</span></a></span><span>
</span><span id="line-2213"></span><span>
</span><span id="line-2214"></span><span>    </span><span id="local-6989586621681034062"><span class="annot"><span class="annottext">co1 :: Coercion
</span><a href="#local-6989586621681034062"><span class="hs-identifier hs-var hs-var">co1</span></a></span></span><span>     </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">CoVar -&gt; Coercion
</span><a href="GHC.Core.Coercion.html#mkCoVarCo"><span class="hs-identifier hs-var">mkCoVarCo</span></a></span><span> </span><span class="annot"><span class="annottext">CoVar
</span><a href="#local-6989586621681034073"><span class="hs-identifier hs-var">new_var</span></a></span><span>
</span><span id="line-2215"></span><span>    </span><span id="local-6989586621681034061"><span class="annot"><span class="annottext">co2 :: Coercion
</span><a href="#local-6989586621681034061"><span class="hs-identifier hs-var hs-var">co2</span></a></span></span><span>     </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">Coercion -&gt; Coercion
</span><a href="GHC.Core.Coercion.html#mkSymCo"><span class="hs-identifier hs-var">mkSymCo</span></a></span><span> </span><span class="annot"><span class="annottext">Coercion
</span><a href="#local-6989586621681034064"><span class="hs-identifier hs-var">eta1</span></a></span><span> </span><span class="annot"><span class="annottext">Coercion -&gt; Coercion -&gt; Coercion
</span><a href="GHC.Core.Coercion.html#mkTransCo"><span class="hs-operator hs-var">`mkTransCo`</span></a></span><span> </span><span class="annot"><span class="annottext">Coercion
</span><a href="#local-6989586621681034062"><span class="hs-identifier hs-var">co1</span></a></span><span> </span><span class="annot"><span class="annottext">Coercion -&gt; Coercion -&gt; Coercion
</span><a href="GHC.Core.Coercion.html#mkTransCo"><span class="hs-operator hs-var">`mkTransCo`</span></a></span><span> </span><span class="annot"><span class="annottext">Coercion
</span><a href="#local-6989586621681034063"><span class="hs-identifier hs-var">eta2</span></a></span><span>
</span><span id="line-2216"></span><span>    </span><span id="local-6989586621681034071"><span class="annot"><span class="annottext">kind_co :: Coercion
</span><a href="#local-6989586621681034071"><span class="hs-identifier hs-var hs-var">kind_co</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">HasDebugCallStack =&gt; Role -&gt; TyCon -&gt; [Coercion] -&gt; Coercion
</span><a href="GHC.Core.Coercion.html#mkTyConAppCo"><span class="hs-identifier hs-var">mkTyConAppCo</span></a></span><span> </span><span class="annot"><span class="annottext">Role
</span><a href="GHC.Core.Coercion.Axiom.html#Nominal"><span class="hs-identifier hs-var">Nominal</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Role -&gt; TyCon
</span><a href="GHC.Builtin.Types.Prim.html#equalityTyCon"><span class="hs-identifier hs-var">equalityTyCon</span></a></span><span> </span><span class="annot"><span class="annottext">Role
</span><a href="#local-6989586621681034066"><span class="hs-keyword hs-var">role</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-2217"></span><span>                           </span><span class="hs-special">[</span><span> </span><span class="annot"><span class="annottext">Coercion -&gt; Coercion
</span><a href="GHC.Core.Coercion.html#mkKindCo"><span class="hs-identifier hs-var">mkKindCo</span></a></span><span> </span><span class="annot"><span class="annottext">Coercion
</span><a href="#local-6989586621681034062"><span class="hs-identifier hs-var">co1</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">Coercion -&gt; Coercion
</span><a href="GHC.Core.Coercion.html#mkKindCo"><span class="hs-identifier hs-var">mkKindCo</span></a></span><span> </span><span class="annot"><span class="annottext">Coercion
</span><a href="#local-6989586621681034061"><span class="hs-identifier hs-var">co2</span></a></span><span>
</span><span id="line-2218"></span><span>                           </span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">Coercion
</span><a href="#local-6989586621681034062"><span class="hs-identifier hs-var">co1</span></a></span><span>         </span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">Coercion
</span><a href="#local-6989586621681034061"><span class="hs-identifier hs-var">co2</span></a></span><span>          </span><span class="hs-special">]</span><span>
</span><span id="line-2219"></span><span>    </span><span id="local-6989586621681034060"><span class="annot"><span class="annottext">lifted :: Coercion
</span><a href="#local-6989586621681034060"><span class="hs-identifier hs-var hs-var">lifted</span></a></span></span><span>  </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">Role -&gt; Coercion -&gt; Coercion -&gt; Coercion -&gt; Coercion
</span><a href="GHC.Core.Coercion.html#mkProofIrrelCo"><span class="hs-identifier hs-var">mkProofIrrelCo</span></a></span><span> </span><span class="annot"><span class="annottext">Role
</span><a href="GHC.Core.Coercion.Axiom.html#Nominal"><span class="hs-identifier hs-var">Nominal</span></a></span><span> </span><span class="annot"><span class="annottext">Coercion
</span><a href="#local-6989586621681034071"><span class="hs-identifier hs-var">kind_co</span></a></span><span> </span><span class="annot"><span class="annottext">Coercion
</span><a href="#local-6989586621681034062"><span class="hs-identifier hs-var">co1</span></a></span><span> </span><span class="annot"><span class="annottext">Coercion
</span><a href="#local-6989586621681034061"><span class="hs-identifier hs-var">co2</span></a></span><span>
</span><span id="line-2220"></span><span>
</span><span id="line-2221"></span><span>    </span><span id="local-6989586621681034072"><span class="annot"><span class="annottext">new_cenv :: LiftCoEnv
</span><a href="#local-6989586621681034072"><span class="hs-identifier hs-var hs-var">new_cenv</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">forall a. VarEnv a -&gt; CoVar -&gt; a -&gt; VarEnv a
</span><a href="GHC.Types.Var.Env.html#extendVarEnv"><span class="hs-identifier hs-var">extendVarEnv</span></a></span><span> </span><span class="annot"><span class="annottext">LiftCoEnv
</span><a href="#local-6989586621681034075"><span class="hs-identifier hs-var">cenv</span></a></span><span> </span><span class="annot"><span class="annottext">CoVar
</span><a href="#local-6989586621681034074"><span class="hs-identifier hs-var">old_var</span></a></span><span> </span><span class="annot"><span class="annottext">Coercion
</span><a href="#local-6989586621681034060"><span class="hs-identifier hs-var">lifted</span></a></span><span>
</span><span id="line-2222"></span><span>
</span><span id="line-2223"></span><span class="hs-comment">-- | Is a var in the domain of a lifting context?</span><span>
</span><span id="line-2224"></span><span class="annot"><a href="GHC.Core.Coercion.html#isMappedByLC"><span class="hs-identifier hs-type">isMappedByLC</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><a href="GHC.Types.Var.html#TyCoVar"><span class="hs-identifier hs-type">TyCoVar</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="GHC.Core.Coercion.html#LiftingContext"><span class="hs-identifier hs-type">LiftingContext</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="hs-identifier hs-type">Bool</span></span><span>
</span><span id="line-2225"></span><span id="isMappedByLC"><span class="annot"><span class="annottext">isMappedByLC :: CoVar -&gt; LiftingContext -&gt; Bool
</span><a href="GHC.Core.Coercion.html#isMappedByLC"><span class="hs-identifier hs-var hs-var">isMappedByLC</span></a></span></span><span> </span><span id="local-6989586621681034059"><span class="annot"><span class="annottext">CoVar
</span><a href="#local-6989586621681034059"><span class="hs-identifier hs-var">tv</span></a></span></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="GHC.Core.Coercion.html#LC"><span class="hs-identifier hs-type">LC</span></a></span><span> </span><span class="annot"><span class="annottext">TCvSubst
</span><span class="hs-identifier">_</span></span><span> </span><span id="local-6989586621681034058"><span class="annot"><span class="annottext">LiftCoEnv
</span><a href="#local-6989586621681034058"><span class="hs-identifier hs-var">env</span></a></span></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">CoVar
</span><a href="#local-6989586621681034059"><span class="hs-identifier hs-var">tv</span></a></span><span> </span><span class="annot"><span class="annottext">forall a. CoVar -&gt; VarEnv a -&gt; Bool
</span><a href="GHC.Types.Var.Env.html#elemVarEnv"><span class="hs-operator hs-var">`elemVarEnv`</span></a></span><span> </span><span class="annot"><span class="annottext">LiftCoEnv
</span><a href="#local-6989586621681034058"><span class="hs-identifier hs-var">env</span></a></span><span>
</span><span id="line-2226"></span><span>
</span><span id="line-2227"></span><span class="hs-comment">-- If [a |-&gt; g] is in the substitution and g :: t1 ~ t2, substitute a for t1</span><span>
</span><span id="line-2228"></span><span class="hs-comment">-- If [a |-&gt; (g1, g2)] is in the substitution, substitute a for g1</span><span>
</span><span id="line-2229"></span><span class="annot"><a href="GHC.Core.Coercion.html#substLeftCo"><span class="hs-identifier hs-type">substLeftCo</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><a href="GHC.Core.Coercion.html#LiftingContext"><span class="hs-identifier hs-type">LiftingContext</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="GHC.Core.TyCo.Rep.html#Coercion"><span class="hs-identifier hs-type">Coercion</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="GHC.Core.TyCo.Rep.html#Coercion"><span class="hs-identifier hs-type">Coercion</span></a></span><span>
</span><span id="line-2230"></span><span id="substLeftCo"><span class="annot"><span class="annottext">substLeftCo :: LiftingContext -&gt; Coercion -&gt; Coercion
</span><a href="GHC.Core.Coercion.html#substLeftCo"><span class="hs-identifier hs-var hs-var">substLeftCo</span></a></span></span><span> </span><span id="local-6989586621681034056"><span class="annot"><span class="annottext">LiftingContext
</span><a href="#local-6989586621681034056"><span class="hs-identifier hs-var">lc</span></a></span></span><span> </span><span id="local-6989586621681034055"><span class="annot"><span class="annottext">Coercion
</span><a href="#local-6989586621681034055"><span class="hs-identifier hs-var">co</span></a></span></span><span>
</span><span id="line-2231"></span><span>  </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">HasCallStack =&gt; TCvSubst -&gt; Coercion -&gt; Coercion
</span><a href="GHC.Core.TyCo.Subst.html#substCo"><span class="hs-identifier hs-var">substCo</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">LiftingContext -&gt; TCvSubst
</span><a href="GHC.Core.Coercion.html#lcSubstLeft"><span class="hs-identifier hs-var">lcSubstLeft</span></a></span><span> </span><span class="annot"><span class="annottext">LiftingContext
</span><a href="#local-6989586621681034056"><span class="hs-identifier hs-var">lc</span></a></span><span class="hs-special">)</span><span> </span><span class="annot"><span class="annottext">Coercion
</span><a href="#local-6989586621681034055"><span class="hs-identifier hs-var">co</span></a></span><span>
</span><span id="line-2232"></span><span>
</span><span id="line-2233"></span><span class="hs-comment">-- Ditto, but for t2 and g2</span><span>
</span><span id="line-2234"></span><span class="annot"><a href="GHC.Core.Coercion.html#substRightCo"><span class="hs-identifier hs-type">substRightCo</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><a href="GHC.Core.Coercion.html#LiftingContext"><span class="hs-identifier hs-type">LiftingContext</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="GHC.Core.TyCo.Rep.html#Coercion"><span class="hs-identifier hs-type">Coercion</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="GHC.Core.TyCo.Rep.html#Coercion"><span class="hs-identifier hs-type">Coercion</span></a></span><span>
</span><span id="line-2235"></span><span id="substRightCo"><span class="annot"><span class="annottext">substRightCo :: LiftingContext -&gt; Coercion -&gt; Coercion
</span><a href="GHC.Core.Coercion.html#substRightCo"><span class="hs-identifier hs-var hs-var">substRightCo</span></a></span></span><span> </span><span id="local-6989586621681034054"><span class="annot"><span class="annottext">LiftingContext
</span><a href="#local-6989586621681034054"><span class="hs-identifier hs-var">lc</span></a></span></span><span> </span><span id="local-6989586621681034053"><span class="annot"><span class="annottext">Coercion
</span><a href="#local-6989586621681034053"><span class="hs-identifier hs-var">co</span></a></span></span><span>
</span><span id="line-2236"></span><span>  </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">HasCallStack =&gt; TCvSubst -&gt; Coercion -&gt; Coercion
</span><a href="GHC.Core.TyCo.Subst.html#substCo"><span class="hs-identifier hs-var">substCo</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">LiftingContext -&gt; TCvSubst
</span><a href="GHC.Core.Coercion.html#lcSubstRight"><span class="hs-identifier hs-var">lcSubstRight</span></a></span><span> </span><span class="annot"><span class="annottext">LiftingContext
</span><a href="#local-6989586621681034054"><span class="hs-identifier hs-var">lc</span></a></span><span class="hs-special">)</span><span> </span><span class="annot"><span class="annottext">Coercion
</span><a href="#local-6989586621681034053"><span class="hs-identifier hs-var">co</span></a></span><span>
</span><span id="line-2237"></span><span>
</span><span id="line-2238"></span><span class="hs-comment">-- | Apply &quot;sym&quot; to all coercions in a 'LiftCoEnv'</span><span>
</span><span id="line-2239"></span><span class="annot"><a href="GHC.Core.Coercion.html#swapLiftCoEnv"><span class="hs-identifier hs-type">swapLiftCoEnv</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><a href="GHC.Core.Coercion.html#LiftCoEnv"><span class="hs-identifier hs-type">LiftCoEnv</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="GHC.Core.Coercion.html#LiftCoEnv"><span class="hs-identifier hs-type">LiftCoEnv</span></a></span><span>
</span><span id="line-2240"></span><span id="swapLiftCoEnv"><span class="annot"><span class="annottext">swapLiftCoEnv :: LiftCoEnv -&gt; LiftCoEnv
</span><a href="GHC.Core.Coercion.html#swapLiftCoEnv"><span class="hs-identifier hs-var hs-var">swapLiftCoEnv</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">forall a b. (a -&gt; b) -&gt; VarEnv a -&gt; VarEnv b
</span><a href="GHC.Types.Var.Env.html#mapVarEnv"><span class="hs-identifier hs-var">mapVarEnv</span></a></span><span> </span><span class="annot"><span class="annottext">Coercion -&gt; Coercion
</span><a href="GHC.Core.Coercion.html#mkSymCo"><span class="hs-identifier hs-var">mkSymCo</span></a></span><span>
</span><span id="line-2241"></span><span>
</span><span id="line-2242"></span><span class="annot"><a href="GHC.Core.Coercion.html#lcSubstLeft"><span class="hs-identifier hs-type">lcSubstLeft</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><a href="GHC.Core.Coercion.html#LiftingContext"><span class="hs-identifier hs-type">LiftingContext</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="GHC.Core.TyCo.Subst.html#TCvSubst"><span class="hs-identifier hs-type">TCvSubst</span></a></span><span>
</span><span id="line-2243"></span><span id="lcSubstLeft"><span class="annot"><span class="annottext">lcSubstLeft :: LiftingContext -&gt; TCvSubst
</span><a href="GHC.Core.Coercion.html#lcSubstLeft"><span class="hs-identifier hs-var hs-var">lcSubstLeft</span></a></span></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="GHC.Core.Coercion.html#LC"><span class="hs-identifier hs-type">LC</span></a></span><span> </span><span id="local-6989586621681034051"><span class="annot"><span class="annottext">TCvSubst
</span><a href="#local-6989586621681034051"><span class="hs-identifier hs-var">subst</span></a></span></span><span> </span><span id="local-6989586621681034050"><span class="annot"><span class="annottext">LiftCoEnv
</span><a href="#local-6989586621681034050"><span class="hs-identifier hs-var">lc_env</span></a></span></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">TCvSubst -&gt; LiftCoEnv -&gt; TCvSubst
</span><a href="GHC.Core.Coercion.html#liftEnvSubstLeft"><span class="hs-identifier hs-var">liftEnvSubstLeft</span></a></span><span> </span><span class="annot"><span class="annottext">TCvSubst
</span><a href="#local-6989586621681034051"><span class="hs-identifier hs-var">subst</span></a></span><span> </span><span class="annot"><span class="annottext">LiftCoEnv
</span><a href="#local-6989586621681034050"><span class="hs-identifier hs-var">lc_env</span></a></span><span>
</span><span id="line-2244"></span><span>
</span><span id="line-2245"></span><span class="annot"><a href="GHC.Core.Coercion.html#lcSubstRight"><span class="hs-identifier hs-type">lcSubstRight</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><a href="GHC.Core.Coercion.html#LiftingContext"><span class="hs-identifier hs-type">LiftingContext</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="GHC.Core.TyCo.Subst.html#TCvSubst"><span class="hs-identifier hs-type">TCvSubst</span></a></span><span>
</span><span id="line-2246"></span><span id="lcSubstRight"><span class="annot"><span class="annottext">lcSubstRight :: LiftingContext -&gt; TCvSubst
</span><a href="GHC.Core.Coercion.html#lcSubstRight"><span class="hs-identifier hs-var hs-var">lcSubstRight</span></a></span></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="GHC.Core.Coercion.html#LC"><span class="hs-identifier hs-type">LC</span></a></span><span> </span><span id="local-6989586621681034049"><span class="annot"><span class="annottext">TCvSubst
</span><a href="#local-6989586621681034049"><span class="hs-identifier hs-var">subst</span></a></span></span><span> </span><span id="local-6989586621681034048"><span class="annot"><span class="annottext">LiftCoEnv
</span><a href="#local-6989586621681034048"><span class="hs-identifier hs-var">lc_env</span></a></span></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">TCvSubst -&gt; LiftCoEnv -&gt; TCvSubst
</span><a href="GHC.Core.Coercion.html#liftEnvSubstRight"><span class="hs-identifier hs-var">liftEnvSubstRight</span></a></span><span> </span><span class="annot"><span class="annottext">TCvSubst
</span><a href="#local-6989586621681034049"><span class="hs-identifier hs-var">subst</span></a></span><span> </span><span class="annot"><span class="annottext">LiftCoEnv
</span><a href="#local-6989586621681034048"><span class="hs-identifier hs-var">lc_env</span></a></span><span>
</span><span id="line-2247"></span><span>
</span><span id="line-2248"></span><span class="annot"><a href="GHC.Core.Coercion.html#liftEnvSubstLeft"><span class="hs-identifier hs-type">liftEnvSubstLeft</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><a href="GHC.Core.TyCo.Subst.html#TCvSubst"><span class="hs-identifier hs-type">TCvSubst</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="GHC.Core.Coercion.html#LiftCoEnv"><span class="hs-identifier hs-type">LiftCoEnv</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="GHC.Core.TyCo.Subst.html#TCvSubst"><span class="hs-identifier hs-type">TCvSubst</span></a></span><span>
</span><span id="line-2249"></span><span id="liftEnvSubstLeft"><span class="annot"><span class="annottext">liftEnvSubstLeft :: TCvSubst -&gt; LiftCoEnv -&gt; TCvSubst
</span><a href="GHC.Core.Coercion.html#liftEnvSubstLeft"><span class="hs-identifier hs-var hs-var">liftEnvSubstLeft</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">(forall a. Pair a -&gt; a) -&gt; TCvSubst -&gt; LiftCoEnv -&gt; TCvSubst
</span><a href="GHC.Core.Coercion.html#liftEnvSubst"><span class="hs-identifier hs-var">liftEnvSubst</span></a></span><span> </span><span class="annot"><span class="annottext">forall a. Pair a -&gt; a
</span><a href="GHC.Data.Pair.html#pFst"><span class="hs-identifier hs-var">pFst</span></a></span><span>
</span><span id="line-2250"></span><span>
</span><span id="line-2251"></span><span class="annot"><a href="GHC.Core.Coercion.html#liftEnvSubstRight"><span class="hs-identifier hs-type">liftEnvSubstRight</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><a href="GHC.Core.TyCo.Subst.html#TCvSubst"><span class="hs-identifier hs-type">TCvSubst</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="GHC.Core.Coercion.html#LiftCoEnv"><span class="hs-identifier hs-type">LiftCoEnv</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="GHC.Core.TyCo.Subst.html#TCvSubst"><span class="hs-identifier hs-type">TCvSubst</span></a></span><span>
</span><span id="line-2252"></span><span id="liftEnvSubstRight"><span class="annot"><span class="annottext">liftEnvSubstRight :: TCvSubst -&gt; LiftCoEnv -&gt; TCvSubst
</span><a href="GHC.Core.Coercion.html#liftEnvSubstRight"><span class="hs-identifier hs-var hs-var">liftEnvSubstRight</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">(forall a. Pair a -&gt; a) -&gt; TCvSubst -&gt; LiftCoEnv -&gt; TCvSubst
</span><a href="GHC.Core.Coercion.html#liftEnvSubst"><span class="hs-identifier hs-var">liftEnvSubst</span></a></span><span> </span><span class="annot"><span class="annottext">forall a. Pair a -&gt; a
</span><a href="GHC.Data.Pair.html#pSnd"><span class="hs-identifier hs-var">pSnd</span></a></span><span>
</span><span id="line-2253"></span><span>
</span><span id="line-2254"></span><span class="annot"><a href="GHC.Core.Coercion.html#liftEnvSubst"><span class="hs-identifier hs-type">liftEnvSubst</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="hs-special">(</span><span class="hs-keyword">forall</span><span> </span><span id="local-6989586621681034045"><span class="annot"><a href="#local-6989586621681034045"><span class="hs-identifier hs-type">a</span></a></span></span><span class="hs-operator">.</span><span> </span><span class="annot"><a href="GHC.Data.Pair.html#Pair"><span class="hs-identifier hs-type">Pair</span></a></span><span> </span><span class="annot"><a href="#local-6989586621681034045"><span class="hs-identifier hs-type">a</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="#local-6989586621681034045"><span class="hs-identifier hs-type">a</span></a></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="GHC.Core.TyCo.Subst.html#TCvSubst"><span class="hs-identifier hs-type">TCvSubst</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="GHC.Core.Coercion.html#LiftCoEnv"><span class="hs-identifier hs-type">LiftCoEnv</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="GHC.Core.TyCo.Subst.html#TCvSubst"><span class="hs-identifier hs-type">TCvSubst</span></a></span><span>
</span><span id="line-2255"></span><span id="liftEnvSubst"><span class="annot"><span class="annottext">liftEnvSubst :: (forall a. Pair a -&gt; a) -&gt; TCvSubst -&gt; LiftCoEnv -&gt; TCvSubst
</span><a href="GHC.Core.Coercion.html#liftEnvSubst"><span class="hs-identifier hs-var hs-var">liftEnvSubst</span></a></span></span><span> </span><span id="local-6989586621681034044"><span class="annot"><span class="annottext">forall a. Pair a -&gt; a
</span><a href="#local-6989586621681034044"><span class="hs-identifier hs-var">selector</span></a></span></span><span> </span><span id="local-6989586621681034043"><span class="annot"><span class="annottext">TCvSubst
</span><a href="#local-6989586621681034043"><span class="hs-identifier hs-var">subst</span></a></span></span><span> </span><span id="local-6989586621681034042"><span class="annot"><span class="annottext">LiftCoEnv
</span><a href="#local-6989586621681034042"><span class="hs-identifier hs-var">lc_env</span></a></span></span><span>
</span><span id="line-2256"></span><span>  </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">TCvSubst -&gt; TCvSubst -&gt; TCvSubst
</span><a href="GHC.Core.TyCo.Subst.html#composeTCvSubst"><span class="hs-identifier hs-var">composeTCvSubst</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">InScopeSet -&gt; TvSubstEnv -&gt; LiftCoEnv -&gt; TCvSubst
</span><a href="GHC.Core.TyCo.Subst.html#TCvSubst"><span class="hs-identifier hs-var">TCvSubst</span></a></span><span> </span><span class="annot"><span class="annottext">InScopeSet
</span><a href="GHC.Types.Var.Env.html#emptyInScopeSet"><span class="hs-identifier hs-var">emptyInScopeSet</span></a></span><span> </span><span class="annot"><span class="annottext">TvSubstEnv
</span><a href="#local-6989586621681034038"><span class="hs-identifier hs-var">tenv</span></a></span><span> </span><span class="annot"><span class="annottext">LiftCoEnv
</span><a href="#local-6989586621681034037"><span class="hs-identifier hs-var">cenv</span></a></span><span class="hs-special">)</span><span> </span><span class="annot"><span class="annottext">TCvSubst
</span><a href="#local-6989586621681034043"><span class="hs-identifier hs-var">subst</span></a></span><span>
</span><span id="line-2257"></span><span>  </span><span class="hs-keyword">where</span><span>
</span><span id="line-2258"></span><span>    </span><span id="local-6989586621681034036"><span class="annot"><span class="annottext">pairs :: [(Unique, Coercion)]
</span><a href="#local-6989586621681034036"><span class="hs-identifier hs-var hs-var">pairs</span></a></span></span><span>            </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">forall key elt. UniqFM key elt -&gt; [(Unique, elt)]
</span><a href="GHC.Types.Unique.FM.html#nonDetUFMToList"><span class="hs-identifier hs-var">nonDetUFMToList</span></a></span><span> </span><span class="annot"><span class="annottext">LiftCoEnv
</span><a href="#local-6989586621681034042"><span class="hs-identifier hs-var">lc_env</span></a></span><span>
</span><span id="line-2259"></span><span>                       </span><span class="hs-comment">-- It's OK to use nonDetUFMToList here because we</span><span>
</span><span id="line-2260"></span><span>                       </span><span class="hs-comment">-- immediately forget the ordering by creating</span><span>
</span><span id="line-2261"></span><span>                       </span><span class="hs-comment">-- a VarEnv</span><span>
</span><span id="line-2262"></span><span>    </span><span class="hs-special">(</span><span id="local-6989586621681034034"><span class="annot"><span class="annottext">[(Unique, Type)]
</span><a href="#local-6989586621681034034"><span class="hs-identifier hs-var">tpairs</span></a></span></span><span class="hs-special">,</span><span> </span><span id="local-6989586621681034033"><span class="annot"><span class="annottext">[(Unique, Coercion)]
</span><a href="#local-6989586621681034033"><span class="hs-identifier hs-var">cpairs</span></a></span></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">forall a b c. (a -&gt; Either b c) -&gt; [a] -&gt; ([b], [c])
</span><a href="GHC.Utils.Misc.html#partitionWith"><span class="hs-identifier hs-var">partitionWith</span></a></span><span> </span><span class="annot"><span class="annottext">(Unique, Coercion) -&gt; Either (Unique, Type) (Unique, Coercion)
</span><a href="#local-6989586621681034031"><span class="hs-identifier hs-var">ty_or_co</span></a></span><span> </span><span class="annot"><span class="annottext">[(Unique, Coercion)]
</span><a href="#local-6989586621681034036"><span class="hs-identifier hs-var">pairs</span></a></span><span>
</span><span id="line-2263"></span><span>    </span><span id="local-6989586621681034038"><span class="annot"><span class="annottext">tenv :: TvSubstEnv
</span><a href="#local-6989586621681034038"><span class="hs-identifier hs-var hs-var">tenv</span></a></span></span><span>             </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">forall a. [(Unique, a)] -&gt; VarEnv a
</span><a href="GHC.Types.Var.Env.html#mkVarEnv_Directly"><span class="hs-identifier hs-var">mkVarEnv_Directly</span></a></span><span> </span><span class="annot"><span class="annottext">[(Unique, Type)]
</span><a href="#local-6989586621681034034"><span class="hs-identifier hs-var">tpairs</span></a></span><span>
</span><span id="line-2264"></span><span>    </span><span id="local-6989586621681034037"><span class="annot"><span class="annottext">cenv :: LiftCoEnv
</span><a href="#local-6989586621681034037"><span class="hs-identifier hs-var hs-var">cenv</span></a></span></span><span>             </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">forall a. [(Unique, a)] -&gt; VarEnv a
</span><a href="GHC.Types.Var.Env.html#mkVarEnv_Directly"><span class="hs-identifier hs-var">mkVarEnv_Directly</span></a></span><span> </span><span class="annot"><span class="annottext">[(Unique, Coercion)]
</span><a href="#local-6989586621681034033"><span class="hs-identifier hs-var">cpairs</span></a></span><span>
</span><span id="line-2265"></span><span>
</span><span id="line-2266"></span><span>    </span><span class="annot"><a href="#local-6989586621681034031"><span class="hs-identifier hs-type">ty_or_co</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="hs-special">(</span><span class="annot"><a href="GHC.Types.Unique.html#Unique"><span class="hs-identifier hs-type">Unique</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><a href="GHC.Core.TyCo.Rep.html#Coercion"><span class="hs-identifier hs-type">Coercion</span></a></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="../../base-4.16.4.0/src/Data-Either.html#Either"><span class="hs-identifier hs-type">Either</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="GHC.Types.Unique.html#Unique"><span class="hs-identifier hs-type">Unique</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><a href="GHC.Core.TyCo.Rep.html#Type"><span class="hs-identifier hs-type">Type</span></a></span><span class="hs-special">)</span><span> </span><span class="hs-special">(</span><span class="annot"><a href="GHC.Types.Unique.html#Unique"><span class="hs-identifier hs-type">Unique</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><a href="GHC.Core.TyCo.Rep.html#Coercion"><span class="hs-identifier hs-type">Coercion</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-2267"></span><span>    </span><span id="local-6989586621681034031"><span class="annot"><span class="annottext">ty_or_co :: (Unique, Coercion) -&gt; Either (Unique, Type) (Unique, Coercion)
</span><a href="#local-6989586621681034031"><span class="hs-identifier hs-var hs-var">ty_or_co</span></a></span></span><span> </span><span class="hs-special">(</span><span id="local-6989586621681034029"><span class="annot"><span class="annottext">Unique
</span><a href="#local-6989586621681034029"><span class="hs-identifier hs-var">u</span></a></span></span><span class="hs-special">,</span><span> </span><span id="local-6989586621681034028"><span class="annot"><span class="annottext">Coercion
</span><a href="#local-6989586621681034028"><span class="hs-identifier hs-var">co</span></a></span></span><span class="hs-special">)</span><span>
</span><span id="line-2268"></span><span>      </span><span class="hs-glyph">|</span><span> </span><span class="annot"><a href="../../base-4.16.4.0/src/GHC-Maybe.html#Just"><span class="hs-identifier hs-type">Just</span></a></span><span> </span><span id="local-6989586621681034027"><span class="annot"><span class="annottext">Coercion
</span><a href="#local-6989586621681034027"><span class="hs-identifier hs-var">equality_co</span></a></span></span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">Type -&gt; Maybe Coercion
</span><a href="GHC.Core.Type.html#isCoercionTy_maybe"><span class="hs-identifier hs-var">isCoercionTy_maybe</span></a></span><span> </span><span class="annot"><span class="annottext">Type
</span><a href="#local-6989586621681034025"><span class="hs-identifier hs-var">equality_ty</span></a></span><span>
</span><span id="line-2269"></span><span>      </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">forall a b. b -&gt; Either a b
</span><a href="../../base-4.16.4.0/src/Data-Either.html#Right"><span class="hs-identifier hs-var">Right</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Unique
</span><a href="#local-6989586621681034029"><span class="hs-identifier hs-var">u</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">Coercion
</span><a href="#local-6989586621681034027"><span class="hs-identifier hs-var">equality_co</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-2270"></span><span>      </span><span class="hs-glyph">|</span><span> </span><span class="annot"><span class="annottext">Bool
</span><a href="../../base-4.16.4.0/src/GHC-Base.html#otherwise"><span class="hs-identifier hs-var">otherwise</span></a></span><span>
</span><span id="line-2271"></span><span>      </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">forall a b. a -&gt; Either a b
</span><a href="../../base-4.16.4.0/src/Data-Either.html#Left"><span class="hs-identifier hs-var">Left</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Unique
</span><a href="#local-6989586621681034029"><span class="hs-identifier hs-var">u</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">Type
</span><a href="#local-6989586621681034025"><span class="hs-identifier hs-var">equality_ty</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-2272"></span><span>      </span><span class="hs-keyword">where</span><span>
</span><span id="line-2273"></span><span>        </span><span id="local-6989586621681034025"><span class="annot"><span class="annottext">equality_ty :: Type
</span><a href="#local-6989586621681034025"><span class="hs-identifier hs-var hs-var">equality_ty</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">forall a. Pair a -&gt; a
</span><a href="#local-6989586621681034044"><span class="hs-identifier hs-var">selector</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Coercion -&gt; Pair Type
</span><a href="GHC.Core.Coercion.html#coercionKind"><span class="hs-identifier hs-var">coercionKind</span></a></span><span> </span><span class="annot"><span class="annottext">Coercion
</span><a href="#local-6989586621681034028"><span class="hs-identifier hs-var">co</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-2274"></span><span>
</span><span id="line-2275"></span><span class="hs-comment">-- | Extract the underlying substitution from the LiftingContext</span><span>
</span><span id="line-2276"></span><span class="annot"><a href="GHC.Core.Coercion.html#lcTCvSubst"><span class="hs-identifier hs-type">lcTCvSubst</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><a href="GHC.Core.Coercion.html#LiftingContext"><span class="hs-identifier hs-type">LiftingContext</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="GHC.Core.TyCo.Subst.html#TCvSubst"><span class="hs-identifier hs-type">TCvSubst</span></a></span><span>
</span><span id="line-2277"></span><span id="lcTCvSubst"><span class="annot"><span class="annottext">lcTCvSubst :: LiftingContext -&gt; TCvSubst
</span><a href="GHC.Core.Coercion.html#lcTCvSubst"><span class="hs-identifier hs-var hs-var">lcTCvSubst</span></a></span></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="GHC.Core.Coercion.html#LC"><span class="hs-identifier hs-type">LC</span></a></span><span> </span><span id="local-6989586621681034024"><span class="annot"><span class="annottext">TCvSubst
</span><a href="#local-6989586621681034024"><span class="hs-identifier hs-var">subst</span></a></span></span><span> </span><span class="annot"><span class="annottext">LiftCoEnv
</span><span class="hs-identifier">_</span></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">TCvSubst
</span><a href="#local-6989586621681034024"><span class="hs-identifier hs-var">subst</span></a></span><span>
</span><span id="line-2278"></span><span>
</span><span id="line-2279"></span><span class="hs-comment">-- | Get the 'InScopeSet' from a 'LiftingContext'</span><span>
</span><span id="line-2280"></span><span class="annot"><a href="GHC.Core.Coercion.html#lcInScopeSet"><span class="hs-identifier hs-type">lcInScopeSet</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><a href="GHC.Core.Coercion.html#LiftingContext"><span class="hs-identifier hs-type">LiftingContext</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="GHC.Types.Var.Env.html#InScopeSet"><span class="hs-identifier hs-type">InScopeSet</span></a></span><span>
</span><span id="line-2281"></span><span id="lcInScopeSet"><span class="annot"><span class="annottext">lcInScopeSet :: LiftingContext -&gt; InScopeSet
</span><a href="GHC.Core.Coercion.html#lcInScopeSet"><span class="hs-identifier hs-var hs-var">lcInScopeSet</span></a></span></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="GHC.Core.Coercion.html#LC"><span class="hs-identifier hs-type">LC</span></a></span><span> </span><span id="local-6989586621681034023"><span class="annot"><span class="annottext">TCvSubst
</span><a href="#local-6989586621681034023"><span class="hs-identifier hs-var">subst</span></a></span></span><span> </span><span class="annot"><span class="annottext">LiftCoEnv
</span><span class="hs-identifier">_</span></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">TCvSubst -&gt; InScopeSet
</span><a href="GHC.Core.TyCo.Subst.html#getTCvInScope"><span class="hs-identifier hs-var">getTCvInScope</span></a></span><span> </span><span class="annot"><span class="annottext">TCvSubst
</span><a href="#local-6989586621681034023"><span class="hs-identifier hs-var">subst</span></a></span><span>
</span><span id="line-2282"></span><span>
</span><span id="line-2283"></span><span class="hs-comment">{-
%************************************************************************
%*                                                                      *
            Sequencing on coercions
%*                                                                      *
%************************************************************************
-}</span><span>
</span><span id="line-2290"></span><span>
</span><span id="line-2291"></span><span class="annot"><a href="GHC.Core.Coercion.html#seqMCo"><span class="hs-identifier hs-type">seqMCo</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><a href="GHC.Core.TyCo.Rep.html#MCoercion"><span class="hs-identifier hs-type">MCoercion</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-special">(</span><span class="hs-special">)</span><span>
</span><span id="line-2292"></span><span id="seqMCo"><span class="annot"><span class="annottext">seqMCo :: MCoercion -&gt; ()
</span><a href="GHC.Core.Coercion.html#seqMCo"><span class="hs-identifier hs-var hs-var">seqMCo</span></a></span></span><span> </span><span class="annot"><span class="annottext">MCoercion
</span><a href="GHC.Core.TyCo.Rep.html#MRefl"><span class="hs-identifier hs-var">MRefl</span></a></span><span>    </span><span class="hs-glyph">=</span><span> </span><span class="hs-special">(</span><span class="hs-special">)</span><span>
</span><span id="line-2293"></span><span class="annot"><a href="GHC.Core.Coercion.html#seqMCo"><span class="hs-identifier hs-var">seqMCo</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="GHC.Core.TyCo.Rep.html#MCo"><span class="hs-identifier hs-type">MCo</span></a></span><span> </span><span id="local-6989586621681034021"><span class="annot"><span class="annottext">Coercion
</span><a href="#local-6989586621681034021"><span class="hs-identifier hs-var">co</span></a></span></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">Coercion -&gt; ()
</span><a href="GHC.Core.Coercion.html#seqCo"><span class="hs-identifier hs-var">seqCo</span></a></span><span> </span><span class="annot"><span class="annottext">Coercion
</span><a href="#local-6989586621681034021"><span class="hs-identifier hs-var">co</span></a></span><span>
</span><span id="line-2294"></span><span>
</span><span id="line-2295"></span><span class="annot"><a href="GHC.Core.Coercion.html#seqCo"><span class="hs-identifier hs-type">seqCo</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><a href="GHC.Core.TyCo.Rep.html#Coercion"><span class="hs-identifier hs-type">Coercion</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-special">(</span><span class="hs-special">)</span><span>
</span><span id="line-2296"></span><span id="seqCo"><span class="annot"><span class="annottext">seqCo :: Coercion -&gt; ()
</span><a href="GHC.Core.Coercion.html#seqCo"><span class="hs-identifier hs-var hs-var">seqCo</span></a></span></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="GHC.Core.TyCo.Rep.html#Refl"><span class="hs-identifier hs-type">Refl</span></a></span><span> </span><span id="local-6989586621681034020"><span class="annot"><span class="annottext">Type
</span><a href="#local-6989586621681034020"><span class="hs-identifier hs-var">ty</span></a></span></span><span class="hs-special">)</span><span>                 </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">Type -&gt; ()
</span><a href="GHC.Core.Type.html#seqType"><span class="hs-identifier hs-var">seqType</span></a></span><span> </span><span class="annot"><span class="annottext">Type
</span><a href="#local-6989586621681034020"><span class="hs-identifier hs-var">ty</span></a></span><span>
</span><span id="line-2297"></span><span class="annot"><a href="GHC.Core.Coercion.html#seqCo"><span class="hs-identifier hs-var">seqCo</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="GHC.Core.TyCo.Rep.html#GRefl"><span class="hs-identifier hs-type">GRefl</span></a></span><span> </span><span id="local-6989586621681034018"><span class="annot"><span class="annottext">Role
</span><a href="#local-6989586621681034018"><span class="hs-identifier hs-var">r</span></a></span></span><span> </span><span id="local-6989586621681034017"><span class="annot"><span class="annottext">Type
</span><a href="#local-6989586621681034017"><span class="hs-identifier hs-var">ty</span></a></span></span><span> </span><span id="local-6989586621681034016"><span class="annot"><span class="annottext">MCoercion
</span><a href="#local-6989586621681034016"><span class="hs-identifier hs-var">mco</span></a></span></span><span class="hs-special">)</span><span>          </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">Role
</span><a href="#local-6989586621681034018"><span class="hs-identifier hs-var">r</span></a></span><span> </span><span class="annot"><span class="annottext">seq :: forall a b. a -&gt; b -&gt; b
</span><span class="hs-operator hs-type">`seq`</span></span><span> </span><span class="annot"><span class="annottext">Type -&gt; ()
</span><a href="GHC.Core.Type.html#seqType"><span class="hs-identifier hs-var">seqType</span></a></span><span> </span><span class="annot"><span class="annottext">Type
</span><a href="#local-6989586621681034017"><span class="hs-identifier hs-var">ty</span></a></span><span> </span><span class="annot"><span class="annottext">seq :: forall a b. a -&gt; b -&gt; b
</span><span class="hs-operator hs-type">`seq`</span></span><span> </span><span class="annot"><span class="annottext">MCoercion -&gt; ()
</span><a href="GHC.Core.Coercion.html#seqMCo"><span class="hs-identifier hs-var">seqMCo</span></a></span><span> </span><span class="annot"><span class="annottext">MCoercion
</span><a href="#local-6989586621681034016"><span class="hs-identifier hs-var">mco</span></a></span><span>
</span><span id="line-2298"></span><span class="annot"><a href="GHC.Core.Coercion.html#seqCo"><span class="hs-identifier hs-var">seqCo</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="GHC.Core.TyCo.Rep.html#TyConAppCo"><span class="hs-identifier hs-type">TyConAppCo</span></a></span><span> </span><span id="local-6989586621681034015"><span class="annot"><span class="annottext">Role
</span><a href="#local-6989586621681034015"><span class="hs-identifier hs-var">r</span></a></span></span><span> </span><span id="local-6989586621681034014"><span class="annot"><span class="annottext">TyCon
</span><a href="#local-6989586621681034014"><span class="hs-identifier hs-var">tc</span></a></span></span><span> </span><span id="local-6989586621681034013"><span class="annot"><span class="annottext">[Coercion]
</span><a href="#local-6989586621681034013"><span class="hs-identifier hs-var">cos</span></a></span></span><span class="hs-special">)</span><span>     </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">Role
</span><a href="#local-6989586621681034015"><span class="hs-identifier hs-var">r</span></a></span><span> </span><span class="annot"><span class="annottext">seq :: forall a b. a -&gt; b -&gt; b
</span><span class="hs-operator hs-type">`seq`</span></span><span> </span><span class="annot"><span class="annottext">TyCon
</span><a href="#local-6989586621681034014"><span class="hs-identifier hs-var">tc</span></a></span><span> </span><span class="annot"><span class="annottext">seq :: forall a b. a -&gt; b -&gt; b
</span><span class="hs-operator hs-type">`seq`</span></span><span> </span><span class="annot"><span class="annottext">[Coercion] -&gt; ()
</span><a href="GHC.Core.Coercion.html#seqCos"><span class="hs-identifier hs-var">seqCos</span></a></span><span> </span><span class="annot"><span class="annottext">[Coercion]
</span><a href="#local-6989586621681034013"><span class="hs-identifier hs-var">cos</span></a></span><span>
</span><span id="line-2299"></span><span class="annot"><a href="GHC.Core.Coercion.html#seqCo"><span class="hs-identifier hs-var">seqCo</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="GHC.Core.TyCo.Rep.html#AppCo"><span class="hs-identifier hs-type">AppCo</span></a></span><span> </span><span id="local-6989586621681034011"><span class="annot"><span class="annottext">Coercion
</span><a href="#local-6989586621681034011"><span class="hs-identifier hs-var">co1</span></a></span></span><span> </span><span id="local-6989586621681034010"><span class="annot"><span class="annottext">Coercion
</span><a href="#local-6989586621681034010"><span class="hs-identifier hs-var">co2</span></a></span></span><span class="hs-special">)</span><span>           </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">Coercion -&gt; ()
</span><a href="GHC.Core.Coercion.html#seqCo"><span class="hs-identifier hs-var">seqCo</span></a></span><span> </span><span class="annot"><span class="annottext">Coercion
</span><a href="#local-6989586621681034011"><span class="hs-identifier hs-var">co1</span></a></span><span> </span><span class="annot"><span class="annottext">seq :: forall a b. a -&gt; b -&gt; b
</span><span class="hs-operator hs-type">`seq`</span></span><span> </span><span class="annot"><span class="annottext">Coercion -&gt; ()
</span><a href="GHC.Core.Coercion.html#seqCo"><span class="hs-identifier hs-var">seqCo</span></a></span><span> </span><span class="annot"><span class="annottext">Coercion
</span><a href="#local-6989586621681034010"><span class="hs-identifier hs-var">co2</span></a></span><span>
</span><span id="line-2300"></span><span class="annot"><a href="GHC.Core.Coercion.html#seqCo"><span class="hs-identifier hs-var">seqCo</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="GHC.Core.TyCo.Rep.html#ForAllCo"><span class="hs-identifier hs-type">ForAllCo</span></a></span><span> </span><span id="local-6989586621681034009"><span class="annot"><span class="annottext">CoVar
</span><a href="#local-6989586621681034009"><span class="hs-identifier hs-var">tv</span></a></span></span><span> </span><span id="local-6989586621681034008"><span class="annot"><span class="annottext">Coercion
</span><a href="#local-6989586621681034008"><span class="hs-identifier hs-var">k</span></a></span></span><span> </span><span id="local-6989586621681034007"><span class="annot"><span class="annottext">Coercion
</span><a href="#local-6989586621681034007"><span class="hs-identifier hs-var">co</span></a></span></span><span class="hs-special">)</span><span>        </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">Type -&gt; ()
</span><a href="GHC.Core.Type.html#seqType"><span class="hs-identifier hs-var">seqType</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">CoVar -&gt; Type
</span><a href="GHC.Types.Var.html#varType"><span class="hs-identifier hs-var">varType</span></a></span><span> </span><span class="annot"><span class="annottext">CoVar
</span><a href="#local-6989586621681034009"><span class="hs-identifier hs-var">tv</span></a></span><span class="hs-special">)</span><span> </span><span class="annot"><span class="annottext">seq :: forall a b. a -&gt; b -&gt; b
</span><span class="hs-operator hs-type">`seq`</span></span><span> </span><span class="annot"><span class="annottext">Coercion -&gt; ()
</span><a href="GHC.Core.Coercion.html#seqCo"><span class="hs-identifier hs-var">seqCo</span></a></span><span> </span><span class="annot"><span class="annottext">Coercion
</span><a href="#local-6989586621681034008"><span class="hs-identifier hs-var">k</span></a></span><span>
</span><span id="line-2301"></span><span>                                                       </span><span class="annot"><span class="annottext">seq :: forall a b. a -&gt; b -&gt; b
</span><span class="hs-operator hs-type">`seq`</span></span><span> </span><span class="annot"><span class="annottext">Coercion -&gt; ()
</span><a href="GHC.Core.Coercion.html#seqCo"><span class="hs-identifier hs-var">seqCo</span></a></span><span> </span><span class="annot"><span class="annottext">Coercion
</span><a href="#local-6989586621681034007"><span class="hs-identifier hs-var">co</span></a></span><span>
</span><span id="line-2302"></span><span class="annot"><a href="GHC.Core.Coercion.html#seqCo"><span class="hs-identifier hs-var">seqCo</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="GHC.Core.TyCo.Rep.html#FunCo"><span class="hs-identifier hs-type">FunCo</span></a></span><span> </span><span id="local-6989586621681034006"><span class="annot"><span class="annottext">Role
</span><a href="#local-6989586621681034006"><span class="hs-identifier hs-var">r</span></a></span></span><span> </span><span id="local-6989586621681034005"><span class="annot"><span class="annottext">Coercion
</span><a href="#local-6989586621681034005"><span class="hs-identifier hs-var">w</span></a></span></span><span> </span><span id="local-6989586621681034004"><span class="annot"><span class="annottext">Coercion
</span><a href="#local-6989586621681034004"><span class="hs-identifier hs-var">co1</span></a></span></span><span> </span><span id="local-6989586621681034003"><span class="annot"><span class="annottext">Coercion
</span><a href="#local-6989586621681034003"><span class="hs-identifier hs-var">co2</span></a></span></span><span class="hs-special">)</span><span>       </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">Role
</span><a href="#local-6989586621681034006"><span class="hs-identifier hs-var">r</span></a></span><span> </span><span class="annot"><span class="annottext">seq :: forall a b. a -&gt; b -&gt; b
</span><span class="hs-operator hs-type">`seq`</span></span><span> </span><span class="annot"><span class="annottext">Coercion -&gt; ()
</span><a href="GHC.Core.Coercion.html#seqCo"><span class="hs-identifier hs-var">seqCo</span></a></span><span> </span><span class="annot"><span class="annottext">Coercion
</span><a href="#local-6989586621681034005"><span class="hs-identifier hs-var">w</span></a></span><span> </span><span class="annot"><span class="annottext">seq :: forall a b. a -&gt; b -&gt; b
</span><span class="hs-operator hs-type">`seq`</span></span><span> </span><span class="annot"><span class="annottext">Coercion -&gt; ()
</span><a href="GHC.Core.Coercion.html#seqCo"><span class="hs-identifier hs-var">seqCo</span></a></span><span> </span><span class="annot"><span class="annottext">Coercion
</span><a href="#local-6989586621681034004"><span class="hs-identifier hs-var">co1</span></a></span><span> </span><span class="annot"><span class="annottext">seq :: forall a b. a -&gt; b -&gt; b
</span><span class="hs-operator hs-type">`seq`</span></span><span> </span><span class="annot"><span class="annottext">Coercion -&gt; ()
</span><a href="GHC.Core.Coercion.html#seqCo"><span class="hs-identifier hs-var">seqCo</span></a></span><span> </span><span class="annot"><span class="annottext">Coercion
</span><a href="#local-6989586621681034003"><span class="hs-identifier hs-var">co2</span></a></span><span>
</span><span id="line-2303"></span><span class="annot"><a href="GHC.Core.Coercion.html#seqCo"><span class="hs-identifier hs-var">seqCo</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="GHC.Core.TyCo.Rep.html#CoVarCo"><span class="hs-identifier hs-type">CoVarCo</span></a></span><span> </span><span id="local-6989586621681034002"><span class="annot"><span class="annottext">CoVar
</span><a href="#local-6989586621681034002"><span class="hs-identifier hs-var">cv</span></a></span></span><span class="hs-special">)</span><span>              </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">CoVar
</span><a href="#local-6989586621681034002"><span class="hs-identifier hs-var">cv</span></a></span><span> </span><span class="annot"><span class="annottext">seq :: forall a b. a -&gt; b -&gt; b
</span><span class="hs-operator hs-type">`seq`</span></span><span> </span><span class="hs-special">(</span><span class="hs-special">)</span><span>
</span><span id="line-2304"></span><span class="annot"><a href="GHC.Core.Coercion.html#seqCo"><span class="hs-identifier hs-var">seqCo</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="GHC.Core.TyCo.Rep.html#HoleCo"><span class="hs-identifier hs-type">HoleCo</span></a></span><span> </span><span id="local-6989586621681034001"><span class="annot"><span class="annottext">CoercionHole
</span><a href="#local-6989586621681034001"><span class="hs-identifier hs-var">h</span></a></span></span><span class="hs-special">)</span><span>                </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">CoercionHole -&gt; CoVar
</span><a href="GHC.Core.TyCo.Rep.html#coHoleCoVar"><span class="hs-identifier hs-var">coHoleCoVar</span></a></span><span> </span><span class="annot"><span class="annottext">CoercionHole
</span><a href="#local-6989586621681034001"><span class="hs-identifier hs-var">h</span></a></span><span> </span><span class="annot"><span class="annottext">seq :: forall a b. a -&gt; b -&gt; b
</span><span class="hs-operator hs-type">`seq`</span></span><span> </span><span class="hs-special">(</span><span class="hs-special">)</span><span>
</span><span id="line-2305"></span><span class="annot"><a href="GHC.Core.Coercion.html#seqCo"><span class="hs-identifier hs-var">seqCo</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="GHC.Core.TyCo.Rep.html#AxiomInstCo"><span class="hs-identifier hs-type">AxiomInstCo</span></a></span><span> </span><span id="local-6989586621681034000"><span class="annot"><span class="annottext">CoAxiom Branched
</span><a href="#local-6989586621681034000"><span class="hs-identifier hs-var">con</span></a></span></span><span> </span><span id="local-6989586621681033999"><span class="annot"><span class="annottext">Int
</span><a href="#local-6989586621681033999"><span class="hs-identifier hs-var">ind</span></a></span></span><span> </span><span id="local-6989586621681033998"><span class="annot"><span class="annottext">[Coercion]
</span><a href="#local-6989586621681033998"><span class="hs-identifier hs-var">cos</span></a></span></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">CoAxiom Branched
</span><a href="#local-6989586621681034000"><span class="hs-identifier hs-var">con</span></a></span><span> </span><span class="annot"><span class="annottext">seq :: forall a b. a -&gt; b -&gt; b
</span><span class="hs-operator hs-type">`seq`</span></span><span> </span><span class="annot"><span class="annottext">Int
</span><a href="#local-6989586621681033999"><span class="hs-identifier hs-var">ind</span></a></span><span> </span><span class="annot"><span class="annottext">seq :: forall a b. a -&gt; b -&gt; b
</span><span class="hs-operator hs-type">`seq`</span></span><span> </span><span class="annot"><span class="annottext">[Coercion] -&gt; ()
</span><a href="GHC.Core.Coercion.html#seqCos"><span class="hs-identifier hs-var">seqCos</span></a></span><span> </span><span class="annot"><span class="annottext">[Coercion]
</span><a href="#local-6989586621681033998"><span class="hs-identifier hs-var">cos</span></a></span><span>
</span><span id="line-2306"></span><span class="annot"><a href="GHC.Core.Coercion.html#seqCo"><span class="hs-identifier hs-var">seqCo</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="GHC.Core.TyCo.Rep.html#UnivCo"><span class="hs-identifier hs-type">UnivCo</span></a></span><span> </span><span id="local-6989586621681033997"><span class="annot"><span class="annottext">UnivCoProvenance
</span><a href="#local-6989586621681033997"><span class="hs-identifier hs-var">p</span></a></span></span><span> </span><span id="local-6989586621681033996"><span class="annot"><span class="annottext">Role
</span><a href="#local-6989586621681033996"><span class="hs-identifier hs-var">r</span></a></span></span><span> </span><span id="local-6989586621681033995"><span class="annot"><span class="annottext">Type
</span><a href="#local-6989586621681033995"><span class="hs-identifier hs-var">t1</span></a></span></span><span> </span><span id="local-6989586621681033994"><span class="annot"><span class="annottext">Type
</span><a href="#local-6989586621681033994"><span class="hs-identifier hs-var">t2</span></a></span></span><span class="hs-special">)</span><span>
</span><span id="line-2307"></span><span>  </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">UnivCoProvenance -&gt; ()
</span><a href="GHC.Core.Coercion.html#seqProv"><span class="hs-identifier hs-var">seqProv</span></a></span><span> </span><span class="annot"><span class="annottext">UnivCoProvenance
</span><a href="#local-6989586621681033997"><span class="hs-identifier hs-var">p</span></a></span><span> </span><span class="annot"><span class="annottext">seq :: forall a b. a -&gt; b -&gt; b
</span><span class="hs-operator hs-type">`seq`</span></span><span> </span><span class="annot"><span class="annottext">Role
</span><a href="#local-6989586621681033996"><span class="hs-identifier hs-var">r</span></a></span><span> </span><span class="annot"><span class="annottext">seq :: forall a b. a -&gt; b -&gt; b
</span><span class="hs-operator hs-type">`seq`</span></span><span> </span><span class="annot"><span class="annottext">Type -&gt; ()
</span><a href="GHC.Core.Type.html#seqType"><span class="hs-identifier hs-var">seqType</span></a></span><span> </span><span class="annot"><span class="annottext">Type
</span><a href="#local-6989586621681033995"><span class="hs-identifier hs-var">t1</span></a></span><span> </span><span class="annot"><span class="annottext">seq :: forall a b. a -&gt; b -&gt; b
</span><span class="hs-operator hs-type">`seq`</span></span><span> </span><span class="annot"><span class="annottext">Type -&gt; ()
</span><a href="GHC.Core.Type.html#seqType"><span class="hs-identifier hs-var">seqType</span></a></span><span> </span><span class="annot"><span class="annottext">Type
</span><a href="#local-6989586621681033994"><span class="hs-identifier hs-var">t2</span></a></span><span>
</span><span id="line-2308"></span><span class="annot"><a href="GHC.Core.Coercion.html#seqCo"><span class="hs-identifier hs-var">seqCo</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="GHC.Core.TyCo.Rep.html#SymCo"><span class="hs-identifier hs-type">SymCo</span></a></span><span> </span><span id="local-6989586621681033992"><span class="annot"><span class="annottext">Coercion
</span><a href="#local-6989586621681033992"><span class="hs-identifier hs-var">co</span></a></span></span><span class="hs-special">)</span><span>                </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">Coercion -&gt; ()
</span><a href="GHC.Core.Coercion.html#seqCo"><span class="hs-identifier hs-var">seqCo</span></a></span><span> </span><span class="annot"><span class="annottext">Coercion
</span><a href="#local-6989586621681033992"><span class="hs-identifier hs-var">co</span></a></span><span>
</span><span id="line-2309"></span><span class="annot"><a href="GHC.Core.Coercion.html#seqCo"><span class="hs-identifier hs-var">seqCo</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="GHC.Core.TyCo.Rep.html#TransCo"><span class="hs-identifier hs-type">TransCo</span></a></span><span> </span><span id="local-6989586621681033991"><span class="annot"><span class="annottext">Coercion
</span><a href="#local-6989586621681033991"><span class="hs-identifier hs-var">co1</span></a></span></span><span> </span><span id="local-6989586621681033990"><span class="annot"><span class="annottext">Coercion
</span><a href="#local-6989586621681033990"><span class="hs-identifier hs-var">co2</span></a></span></span><span class="hs-special">)</span><span>         </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">Coercion -&gt; ()
</span><a href="GHC.Core.Coercion.html#seqCo"><span class="hs-identifier hs-var">seqCo</span></a></span><span> </span><span class="annot"><span class="annottext">Coercion
</span><a href="#local-6989586621681033991"><span class="hs-identifier hs-var">co1</span></a></span><span> </span><span class="annot"><span class="annottext">seq :: forall a b. a -&gt; b -&gt; b
</span><span class="hs-operator hs-type">`seq`</span></span><span> </span><span class="annot"><span class="annottext">Coercion -&gt; ()
</span><a href="GHC.Core.Coercion.html#seqCo"><span class="hs-identifier hs-var">seqCo</span></a></span><span> </span><span class="annot"><span class="annottext">Coercion
</span><a href="#local-6989586621681033990"><span class="hs-identifier hs-var">co2</span></a></span><span>
</span><span id="line-2310"></span><span class="annot"><a href="GHC.Core.Coercion.html#seqCo"><span class="hs-identifier hs-var">seqCo</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="GHC.Core.TyCo.Rep.html#NthCo"><span class="hs-identifier hs-type">NthCo</span></a></span><span> </span><span id="local-6989586621681033989"><span class="annot"><span class="annottext">Role
</span><a href="#local-6989586621681033989"><span class="hs-identifier hs-var">r</span></a></span></span><span> </span><span id="local-6989586621681033988"><span class="annot"><span class="annottext">Int
</span><a href="#local-6989586621681033988"><span class="hs-identifier hs-var">n</span></a></span></span><span> </span><span id="local-6989586621681033987"><span class="annot"><span class="annottext">Coercion
</span><a href="#local-6989586621681033987"><span class="hs-identifier hs-var">co</span></a></span></span><span class="hs-special">)</span><span>            </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">Role
</span><a href="#local-6989586621681033989"><span class="hs-identifier hs-var">r</span></a></span><span> </span><span class="annot"><span class="annottext">seq :: forall a b. a -&gt; b -&gt; b
</span><span class="hs-operator hs-type">`seq`</span></span><span> </span><span class="annot"><span class="annottext">Int
</span><a href="#local-6989586621681033988"><span class="hs-identifier hs-var">n</span></a></span><span> </span><span class="annot"><span class="annottext">seq :: forall a b. a -&gt; b -&gt; b
</span><span class="hs-operator hs-type">`seq`</span></span><span> </span><span class="annot"><span class="annottext">Coercion -&gt; ()
</span><a href="GHC.Core.Coercion.html#seqCo"><span class="hs-identifier hs-var">seqCo</span></a></span><span> </span><span class="annot"><span class="annottext">Coercion
</span><a href="#local-6989586621681033987"><span class="hs-identifier hs-var">co</span></a></span><span>
</span><span id="line-2311"></span><span class="annot"><a href="GHC.Core.Coercion.html#seqCo"><span class="hs-identifier hs-var">seqCo</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="GHC.Core.TyCo.Rep.html#LRCo"><span class="hs-identifier hs-type">LRCo</span></a></span><span> </span><span id="local-6989586621681033986"><span class="annot"><span class="annottext">LeftOrRight
</span><a href="#local-6989586621681033986"><span class="hs-identifier hs-var">lr</span></a></span></span><span> </span><span id="local-6989586621681033985"><span class="annot"><span class="annottext">Coercion
</span><a href="#local-6989586621681033985"><span class="hs-identifier hs-var">co</span></a></span></span><span class="hs-special">)</span><span>              </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">LeftOrRight
</span><a href="#local-6989586621681033986"><span class="hs-identifier hs-var">lr</span></a></span><span> </span><span class="annot"><span class="annottext">seq :: forall a b. a -&gt; b -&gt; b
</span><span class="hs-operator hs-type">`seq`</span></span><span> </span><span class="annot"><span class="annottext">Coercion -&gt; ()
</span><a href="GHC.Core.Coercion.html#seqCo"><span class="hs-identifier hs-var">seqCo</span></a></span><span> </span><span class="annot"><span class="annottext">Coercion
</span><a href="#local-6989586621681033985"><span class="hs-identifier hs-var">co</span></a></span><span>
</span><span id="line-2312"></span><span class="annot"><a href="GHC.Core.Coercion.html#seqCo"><span class="hs-identifier hs-var">seqCo</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="GHC.Core.TyCo.Rep.html#InstCo"><span class="hs-identifier hs-type">InstCo</span></a></span><span> </span><span id="local-6989586621681033984"><span class="annot"><span class="annottext">Coercion
</span><a href="#local-6989586621681033984"><span class="hs-identifier hs-var">co</span></a></span></span><span> </span><span id="local-6989586621681033983"><span class="annot"><span class="annottext">Coercion
</span><a href="#local-6989586621681033983"><span class="hs-identifier hs-var">arg</span></a></span></span><span class="hs-special">)</span><span>           </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">Coercion -&gt; ()
</span><a href="GHC.Core.Coercion.html#seqCo"><span class="hs-identifier hs-var">seqCo</span></a></span><span> </span><span class="annot"><span class="annottext">Coercion
</span><a href="#local-6989586621681033984"><span class="hs-identifier hs-var">co</span></a></span><span> </span><span class="annot"><span class="annottext">seq :: forall a b. a -&gt; b -&gt; b
</span><span class="hs-operator hs-type">`seq`</span></span><span> </span><span class="annot"><span class="annottext">Coercion -&gt; ()
</span><a href="GHC.Core.Coercion.html#seqCo"><span class="hs-identifier hs-var">seqCo</span></a></span><span> </span><span class="annot"><span class="annottext">Coercion
</span><a href="#local-6989586621681033983"><span class="hs-identifier hs-var">arg</span></a></span><span>
</span><span id="line-2313"></span><span class="annot"><a href="GHC.Core.Coercion.html#seqCo"><span class="hs-identifier hs-var">seqCo</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="GHC.Core.TyCo.Rep.html#KindCo"><span class="hs-identifier hs-type">KindCo</span></a></span><span> </span><span id="local-6989586621681033982"><span class="annot"><span class="annottext">Coercion
</span><a href="#local-6989586621681033982"><span class="hs-identifier hs-var">co</span></a></span></span><span class="hs-special">)</span><span>               </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">Coercion -&gt; ()
</span><a href="GHC.Core.Coercion.html#seqCo"><span class="hs-identifier hs-var">seqCo</span></a></span><span> </span><span class="annot"><span class="annottext">Coercion
</span><a href="#local-6989586621681033982"><span class="hs-identifier hs-var">co</span></a></span><span>
</span><span id="line-2314"></span><span class="annot"><a href="GHC.Core.Coercion.html#seqCo"><span class="hs-identifier hs-var">seqCo</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="GHC.Core.TyCo.Rep.html#SubCo"><span class="hs-identifier hs-type">SubCo</span></a></span><span> </span><span id="local-6989586621681033981"><span class="annot"><span class="annottext">Coercion
</span><a href="#local-6989586621681033981"><span class="hs-identifier hs-var">co</span></a></span></span><span class="hs-special">)</span><span>                </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">Coercion -&gt; ()
</span><a href="GHC.Core.Coercion.html#seqCo"><span class="hs-identifier hs-var">seqCo</span></a></span><span> </span><span class="annot"><span class="annottext">Coercion
</span><a href="#local-6989586621681033981"><span class="hs-identifier hs-var">co</span></a></span><span>
</span><span id="line-2315"></span><span class="annot"><a href="GHC.Core.Coercion.html#seqCo"><span class="hs-identifier hs-var">seqCo</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="GHC.Core.TyCo.Rep.html#AxiomRuleCo"><span class="hs-identifier hs-type">AxiomRuleCo</span></a></span><span> </span><span class="annot"><span class="annottext">CoAxiomRule
</span><span class="hs-identifier">_</span></span><span> </span><span id="local-6989586621681033980"><span class="annot"><span class="annottext">[Coercion]
</span><a href="#local-6989586621681033980"><span class="hs-identifier hs-var">cs</span></a></span></span><span class="hs-special">)</span><span>        </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">[Coercion] -&gt; ()
</span><a href="GHC.Core.Coercion.html#seqCos"><span class="hs-identifier hs-var">seqCos</span></a></span><span> </span><span class="annot"><span class="annottext">[Coercion]
</span><a href="#local-6989586621681033980"><span class="hs-identifier hs-var">cs</span></a></span><span>
</span><span id="line-2316"></span><span>
</span><span id="line-2317"></span><span class="annot"><a href="GHC.Core.Coercion.html#seqProv"><span class="hs-identifier hs-type">seqProv</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><a href="GHC.Core.TyCo.Rep.html#UnivCoProvenance"><span class="hs-identifier hs-type">UnivCoProvenance</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-special">(</span><span class="hs-special">)</span><span>
</span><span id="line-2318"></span><span id="seqProv"><span class="annot"><span class="annottext">seqProv :: UnivCoProvenance -&gt; ()
</span><a href="GHC.Core.Coercion.html#seqProv"><span class="hs-identifier hs-var hs-var">seqProv</span></a></span></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="GHC.Core.TyCo.Rep.html#PhantomProv"><span class="hs-identifier hs-type">PhantomProv</span></a></span><span> </span><span id="local-6989586621681033979"><span class="annot"><span class="annottext">Coercion
</span><a href="#local-6989586621681033979"><span class="hs-identifier hs-var">co</span></a></span></span><span class="hs-special">)</span><span>    </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">Coercion -&gt; ()
</span><a href="GHC.Core.Coercion.html#seqCo"><span class="hs-identifier hs-var">seqCo</span></a></span><span> </span><span class="annot"><span class="annottext">Coercion
</span><a href="#local-6989586621681033979"><span class="hs-identifier hs-var">co</span></a></span><span>
</span><span id="line-2319"></span><span class="annot"><a href="GHC.Core.Coercion.html#seqProv"><span class="hs-identifier hs-var">seqProv</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="GHC.Core.TyCo.Rep.html#ProofIrrelProv"><span class="hs-identifier hs-type">ProofIrrelProv</span></a></span><span> </span><span id="local-6989586621681033978"><span class="annot"><span class="annottext">Coercion
</span><a href="#local-6989586621681033978"><span class="hs-identifier hs-var">co</span></a></span></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">Coercion -&gt; ()
</span><a href="GHC.Core.Coercion.html#seqCo"><span class="hs-identifier hs-var">seqCo</span></a></span><span> </span><span class="annot"><span class="annottext">Coercion
</span><a href="#local-6989586621681033978"><span class="hs-identifier hs-var">co</span></a></span><span>
</span><span id="line-2320"></span><span class="annot"><a href="GHC.Core.Coercion.html#seqProv"><span class="hs-identifier hs-var">seqProv</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="GHC.Core.TyCo.Rep.html#PluginProv"><span class="hs-identifier hs-type">PluginProv</span></a></span><span> </span><span class="annot"><span class="annottext">String
</span><span class="hs-identifier">_</span></span><span class="hs-special">)</span><span>      </span><span class="hs-glyph">=</span><span> </span><span class="hs-special">(</span><span class="hs-special">)</span><span>
</span><span id="line-2321"></span><span class="annot"><a href="GHC.Core.Coercion.html#seqProv"><span class="hs-identifier hs-var">seqProv</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="GHC.Core.TyCo.Rep.html#CorePrepProv"><span class="hs-identifier hs-type">CorePrepProv</span></a></span><span> </span><span class="annot"><span class="annottext">Bool
</span><span class="hs-identifier">_</span></span><span class="hs-special">)</span><span>    </span><span class="hs-glyph">=</span><span> </span><span class="hs-special">(</span><span class="hs-special">)</span><span>
</span><span id="line-2322"></span><span>
</span><span id="line-2323"></span><span class="annot"><a href="GHC.Core.Coercion.html#seqCos"><span class="hs-identifier hs-type">seqCos</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="hs-special">[</span><span class="annot"><a href="GHC.Core.TyCo.Rep.html#Coercion"><span class="hs-identifier hs-type">Coercion</span></a></span><span class="hs-special">]</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-special">(</span><span class="hs-special">)</span><span>
</span><span id="line-2324"></span><span id="seqCos"><span class="annot"><span class="annottext">seqCos :: [Coercion] -&gt; ()
</span><a href="GHC.Core.Coercion.html#seqCos"><span class="hs-identifier hs-var hs-var">seqCos</span></a></span></span><span> </span><span class="hs-special">[</span><span class="hs-special">]</span><span>       </span><span class="hs-glyph">=</span><span> </span><span class="hs-special">(</span><span class="hs-special">)</span><span>
</span><span id="line-2325"></span><span class="annot"><a href="GHC.Core.Coercion.html#seqCos"><span class="hs-identifier hs-var">seqCos</span></a></span><span> </span><span class="hs-special">(</span><span id="local-6989586621681033977"><span class="annot"><span class="annottext">Coercion
</span><a href="#local-6989586621681033977"><span class="hs-identifier hs-var">co</span></a></span></span><span class="annot"><span class="hs-glyph hs-type">:</span></span><span id="local-6989586621681033976"><span class="annot"><span class="annottext">[Coercion]
</span><a href="#local-6989586621681033976"><span class="hs-identifier hs-var">cos</span></a></span></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">Coercion -&gt; ()
</span><a href="GHC.Core.Coercion.html#seqCo"><span class="hs-identifier hs-var">seqCo</span></a></span><span> </span><span class="annot"><span class="annottext">Coercion
</span><a href="#local-6989586621681033977"><span class="hs-identifier hs-var">co</span></a></span><span> </span><span class="annot"><span class="annottext">seq :: forall a b. a -&gt; b -&gt; b
</span><span class="hs-operator hs-type">`seq`</span></span><span> </span><span class="annot"><span class="annottext">[Coercion] -&gt; ()
</span><a href="GHC.Core.Coercion.html#seqCos"><span class="hs-identifier hs-var">seqCos</span></a></span><span> </span><span class="annot"><span class="annottext">[Coercion]
</span><a href="#local-6989586621681033976"><span class="hs-identifier hs-var">cos</span></a></span><span>
</span><span id="line-2326"></span><span>
</span><span id="line-2327"></span><span class="hs-comment">{-
%************************************************************************
%*                                                                      *
             The kind of a type, and of a coercion
%*                                                                      *
%************************************************************************
-}</span><span>
</span><span id="line-2334"></span><span>
</span><span id="line-2335"></span><span class="hs-comment">-- | Apply 'coercionKind' to multiple 'Coercion's</span><span>
</span><span id="line-2336"></span><span class="annot"><a href="GHC.Core.Coercion.html#coercionKinds"><span class="hs-identifier hs-type">coercionKinds</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="hs-special">[</span><span class="annot"><a href="GHC.Core.TyCo.Rep.html#Coercion"><span class="hs-identifier hs-type">Coercion</span></a></span><span class="hs-special">]</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="GHC.Data.Pair.html#Pair"><span class="hs-identifier hs-type">Pair</span></a></span><span> </span><span class="hs-special">[</span><span class="annot"><a href="GHC.Core.TyCo.Rep.html#Type"><span class="hs-identifier hs-type">Type</span></a></span><span class="hs-special">]</span><span>
</span><span id="line-2337"></span><span id="coercionKinds"><span class="annot"><span class="annottext">coercionKinds :: [Coercion] -&gt; Pair [Type]
</span><a href="GHC.Core.Coercion.html#coercionKinds"><span class="hs-identifier hs-var hs-var">coercionKinds</span></a></span></span><span> </span><span id="local-6989586621681033975"><span class="annot"><span class="annottext">[Coercion]
</span><a href="#local-6989586621681033975"><span class="hs-identifier hs-var">tys</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">forall (t :: * -&gt; *) (f :: * -&gt; *) a.
(Traversable t, Applicative f) =&gt;
t (f a) -&gt; f (t a)
</span><a href="../../base-4.16.4.0/src/Data-Traversable.html#sequenceA"><span class="hs-identifier hs-var">sequenceA</span></a></span><span> </span><span class="annot"><span class="annottext">forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><a href="../../base-4.16.4.0/src/GHC-Base.html#%24"><span class="hs-operator hs-var">$</span></a></span><span> </span><span class="annot"><span class="annottext">forall a b. (a -&gt; b) -&gt; [a] -&gt; [b]
</span><a href="../../base-4.16.4.0/src/GHC-Base.html#map"><span class="hs-identifier hs-var">map</span></a></span><span> </span><span class="annot"><span class="annottext">Coercion -&gt; Pair Type
</span><a href="GHC.Core.Coercion.html#coercionKind"><span class="hs-identifier hs-var">coercionKind</span></a></span><span> </span><span class="annot"><span class="annottext">[Coercion]
</span><a href="#local-6989586621681033975"><span class="hs-identifier hs-var">tys</span></a></span><span>
</span><span id="line-2338"></span><span>
</span><span id="line-2339"></span><span class="hs-comment">-- | Get a coercion's kind and role.</span><span>
</span><span id="line-2340"></span><span class="annot"><a href="GHC.Core.Coercion.html#coercionKindRole"><span class="hs-identifier hs-type">coercionKindRole</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><a href="GHC.Core.TyCo.Rep.html#Coercion"><span class="hs-identifier hs-type">Coercion</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-special">(</span><span class="annot"><a href="GHC.Data.Pair.html#Pair"><span class="hs-identifier hs-type">Pair</span></a></span><span> </span><span class="annot"><a href="GHC.Core.TyCo.Rep.html#Type"><span class="hs-identifier hs-type">Type</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><a href="GHC.Core.Coercion.Axiom.html#Role"><span class="hs-identifier hs-type">Role</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-2341"></span><span id="coercionKindRole"><span class="annot"><span class="annottext">coercionKindRole :: Coercion -&gt; (Pair Type, Role)
</span><a href="GHC.Core.Coercion.html#coercionKindRole"><span class="hs-identifier hs-var hs-var">coercionKindRole</span></a></span></span><span> </span><span id="local-6989586621681033973"><span class="annot"><span class="annottext">Coercion
</span><a href="#local-6989586621681033973"><span class="hs-identifier hs-var">co</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Coercion -&gt; Pair Type
</span><a href="GHC.Core.Coercion.html#coercionKind"><span class="hs-identifier hs-var">coercionKind</span></a></span><span> </span><span class="annot"><span class="annottext">Coercion
</span><a href="#local-6989586621681033973"><span class="hs-identifier hs-var">co</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">Coercion -&gt; Role
</span><a href="GHC.Core.Coercion.html#coercionRole"><span class="hs-identifier hs-var">coercionRole</span></a></span><span> </span><span class="annot"><span class="annottext">Coercion
</span><a href="#local-6989586621681033973"><span class="hs-identifier hs-var">co</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-2342"></span><span>
</span><span id="line-2343"></span><span class="annot"><a href="GHC.Core.Coercion.html#coercionType"><span class="hs-identifier hs-type">coercionType</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><a href="GHC.Core.TyCo.Rep.html#Coercion"><span class="hs-identifier hs-type">Coercion</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="GHC.Core.TyCo.Rep.html#Type"><span class="hs-identifier hs-type">Type</span></a></span><span>
</span><span id="line-2344"></span><span id="coercionType"><span class="annot"><span class="annottext">coercionType :: Coercion -&gt; Type
</span><a href="GHC.Core.Coercion.html#coercionType"><span class="hs-identifier hs-var hs-var">coercionType</span></a></span></span><span> </span><span id="local-6989586621681033972"><span class="annot"><span class="annottext">Coercion
</span><a href="#local-6989586621681033972"><span class="hs-identifier hs-var">co</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-keyword">case</span><span> </span><span class="annot"><span class="annottext">Coercion -&gt; (Pair Type, Role)
</span><a href="GHC.Core.Coercion.html#coercionKindRole"><span class="hs-identifier hs-var">coercionKindRole</span></a></span><span> </span><span class="annot"><span class="annottext">Coercion
</span><a href="#local-6989586621681033972"><span class="hs-identifier hs-var">co</span></a></span><span> </span><span class="hs-keyword">of</span><span>
</span><span id="line-2345"></span><span>  </span><span class="hs-special">(</span><span class="annot"><a href="GHC.Data.Pair.html#Pair"><span class="hs-identifier hs-type">Pair</span></a></span><span> </span><span id="local-6989586621681033971"><span class="annot"><span class="annottext">Type
</span><a href="#local-6989586621681033971"><span class="hs-identifier hs-var">ty1</span></a></span></span><span> </span><span id="local-6989586621681033970"><span class="annot"><span class="annottext">Type
</span><a href="#local-6989586621681033970"><span class="hs-identifier hs-var">ty2</span></a></span></span><span class="hs-special">,</span><span> </span><span id="local-6989586621681033969"><span class="annot"><span class="annottext">Role
</span><a href="#local-6989586621681033969"><span class="hs-identifier hs-var">r</span></a></span></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="annottext">Role -&gt; Type -&gt; Type -&gt; Type
</span><a href="GHC.Core.Coercion.html#mkCoercionType"><span class="hs-identifier hs-var">mkCoercionType</span></a></span><span> </span><span class="annot"><span class="annottext">Role
</span><a href="#local-6989586621681033969"><span class="hs-identifier hs-var">r</span></a></span><span> </span><span class="annot"><span class="annottext">Type
</span><a href="#local-6989586621681033971"><span class="hs-identifier hs-var">ty1</span></a></span><span> </span><span class="annot"><span class="annottext">Type
</span><a href="#local-6989586621681033970"><span class="hs-identifier hs-var">ty2</span></a></span><span>
</span><span id="line-2346"></span><span>
</span><span id="line-2347"></span><span class="hs-comment">------------------</span><span>
</span><span id="line-2348"></span><span class="hs-comment">-- | If it is the case that</span><span>
</span><span id="line-2349"></span><span class="hs-comment">--</span><span>
</span><span id="line-2350"></span><span class="hs-comment">-- &gt; c :: (t1 ~ t2)</span><span>
</span><span id="line-2351"></span><span class="hs-comment">--</span><span>
</span><span id="line-2352"></span><span class="hs-comment">-- i.e. the kind of @c@ relates @t1@ and @t2@, then @coercionKind c = Pair t1 t2@.</span><span>
</span><span id="line-2353"></span><span>
</span><span id="line-2354"></span><span class="annot"><a href="GHC.Core.Coercion.html#coercionKind"><span class="hs-identifier hs-type">coercionKind</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><a href="GHC.Core.TyCo.Rep.html#Coercion"><span class="hs-identifier hs-type">Coercion</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="GHC.Data.Pair.html#Pair"><span class="hs-identifier hs-type">Pair</span></a></span><span> </span><span class="annot"><a href="GHC.Core.TyCo.Rep.html#Type"><span class="hs-identifier hs-type">Type</span></a></span><span>
</span><span id="line-2355"></span><span id="coercionKind"><span class="annot"><span class="annottext">coercionKind :: Coercion -&gt; Pair Type
</span><a href="GHC.Core.Coercion.html#coercionKind"><span class="hs-identifier hs-var hs-var">coercionKind</span></a></span></span><span> </span><span id="local-6989586621681033968"><span class="annot"><span class="annottext">Coercion
</span><a href="#local-6989586621681033968"><span class="hs-identifier hs-var">co</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">forall a. a -&gt; a -&gt; Pair a
</span><a href="GHC.Data.Pair.html#Pair"><span class="hs-identifier hs-var">Pair</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Coercion -&gt; Type
</span><a href="GHC.Core.Coercion.html#coercionLKind"><span class="hs-identifier hs-var">coercionLKind</span></a></span><span> </span><span class="annot"><span class="annottext">Coercion
</span><a href="#local-6989586621681033968"><span class="hs-identifier hs-var">co</span></a></span><span class="hs-special">)</span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Coercion -&gt; Type
</span><a href="GHC.Core.Coercion.html#coercionRKind"><span class="hs-identifier hs-var">coercionRKind</span></a></span><span> </span><span class="annot"><span class="annottext">Coercion
</span><a href="#local-6989586621681033968"><span class="hs-identifier hs-var">co</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-2356"></span><span>
</span><span id="line-2357"></span><span class="annot"><a href="GHC.Core.Coercion.html#coercionLKind"><span class="hs-identifier hs-type">coercionLKind</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><a href="GHC.Core.TyCo.Rep.html#Coercion"><span class="hs-identifier hs-type">Coercion</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="GHC.Core.TyCo.Rep.html#Type"><span class="hs-identifier hs-type">Type</span></a></span><span>
</span><span id="line-2358"></span><span id="coercionLKind"><span class="annot"><span class="annottext">coercionLKind :: Coercion -&gt; Type
</span><a href="GHC.Core.Coercion.html#coercionLKind"><span class="hs-identifier hs-var hs-var">coercionLKind</span></a></span></span><span> </span><span id="local-6989586621681033967"><span class="annot"><span class="annottext">Coercion
</span><a href="#local-6989586621681033967"><span class="hs-identifier hs-var">co</span></a></span></span><span>
</span><span id="line-2359"></span><span>  </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">Coercion -&gt; Type
</span><a href="#local-6989586621681033966"><span class="hs-identifier hs-var">go</span></a></span><span> </span><span class="annot"><span class="annottext">Coercion
</span><a href="#local-6989586621681033967"><span class="hs-identifier hs-var">co</span></a></span><span>
</span><span id="line-2360"></span><span>  </span><span class="hs-keyword">where</span><span>
</span><span id="line-2361"></span><span>    </span><span id="local-6989586621681033966"><span class="annot"><span class="annottext">go :: Coercion -&gt; Type
</span><a href="#local-6989586621681033966"><span class="hs-identifier hs-var hs-var">go</span></a></span></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="GHC.Core.TyCo.Rep.html#Refl"><span class="hs-identifier hs-type">Refl</span></a></span><span> </span><span id="local-6989586621681033960"><span class="annot"><span class="annottext">Type
</span><a href="#local-6989586621681033960"><span class="hs-identifier hs-var">ty</span></a></span></span><span class="hs-special">)</span><span>                </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">Type
</span><a href="#local-6989586621681033960"><span class="hs-identifier hs-var">ty</span></a></span><span>
</span><span id="line-2362"></span><span>    </span><span class="annot"><a href="#local-6989586621681033966"><span class="hs-identifier hs-var">go</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="GHC.Core.TyCo.Rep.html#GRefl"><span class="hs-identifier hs-type">GRefl</span></a></span><span> </span><span class="annot"><span class="annottext">Role
</span><span class="hs-identifier">_</span></span><span> </span><span id="local-6989586621681033959"><span class="annot"><span class="annottext">Type
</span><a href="#local-6989586621681033959"><span class="hs-identifier hs-var">ty</span></a></span></span><span> </span><span class="annot"><span class="annottext">MCoercion
</span><span class="hs-identifier">_</span></span><span class="hs-special">)</span><span>           </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">Type
</span><a href="#local-6989586621681033959"><span class="hs-identifier hs-var">ty</span></a></span><span>
</span><span id="line-2363"></span><span>    </span><span class="annot"><a href="#local-6989586621681033966"><span class="hs-identifier hs-var">go</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="GHC.Core.TyCo.Rep.html#TyConAppCo"><span class="hs-identifier hs-type">TyConAppCo</span></a></span><span> </span><span class="annot"><span class="annottext">Role
</span><span class="hs-identifier">_</span></span><span> </span><span id="local-6989586621681033958"><span class="annot"><span class="annottext">TyCon
</span><a href="#local-6989586621681033958"><span class="hs-identifier hs-var">tc</span></a></span></span><span> </span><span id="local-6989586621681033957"><span class="annot"><span class="annottext">[Coercion]
</span><a href="#local-6989586621681033957"><span class="hs-identifier hs-var">cos</span></a></span></span><span class="hs-special">)</span><span>    </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">TyCon -&gt; [Type] -&gt; Type
</span><a href="GHC.Core.Type.html#mkTyConApp"><span class="hs-identifier hs-var">mkTyConApp</span></a></span><span> </span><span class="annot"><span class="annottext">TyCon
</span><a href="#local-6989586621681033958"><span class="hs-identifier hs-var">tc</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">forall a b. (a -&gt; b) -&gt; [a] -&gt; [b]
</span><a href="../../base-4.16.4.0/src/GHC-Base.html#map"><span class="hs-identifier hs-var">map</span></a></span><span> </span><span class="annot"><span class="annottext">Coercion -&gt; Type
</span><a href="#local-6989586621681033966"><span class="hs-identifier hs-var">go</span></a></span><span> </span><span class="annot"><span class="annottext">[Coercion]
</span><a href="#local-6989586621681033957"><span class="hs-identifier hs-var">cos</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-2364"></span><span>    </span><span class="annot"><a href="#local-6989586621681033966"><span class="hs-identifier hs-var">go</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="GHC.Core.TyCo.Rep.html#AppCo"><span class="hs-identifier hs-type">AppCo</span></a></span><span> </span><span id="local-6989586621681033956"><span class="annot"><span class="annottext">Coercion
</span><a href="#local-6989586621681033956"><span class="hs-identifier hs-var">co1</span></a></span></span><span> </span><span id="local-6989586621681033955"><span class="annot"><span class="annottext">Coercion
</span><a href="#local-6989586621681033955"><span class="hs-identifier hs-var">co2</span></a></span></span><span class="hs-special">)</span><span>          </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">Type -&gt; Type -&gt; Type
</span><a href="GHC.Core.Type.html#mkAppTy"><span class="hs-identifier hs-var">mkAppTy</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Coercion -&gt; Type
</span><a href="#local-6989586621681033966"><span class="hs-identifier hs-var">go</span></a></span><span> </span><span class="annot"><span class="annottext">Coercion
</span><a href="#local-6989586621681033956"><span class="hs-identifier hs-var">co1</span></a></span><span class="hs-special">)</span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Coercion -&gt; Type
</span><a href="#local-6989586621681033966"><span class="hs-identifier hs-var">go</span></a></span><span> </span><span class="annot"><span class="annottext">Coercion
</span><a href="#local-6989586621681033955"><span class="hs-identifier hs-var">co2</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-2365"></span><span>    </span><span class="annot"><a href="#local-6989586621681033966"><span class="hs-identifier hs-var">go</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="GHC.Core.TyCo.Rep.html#ForAllCo"><span class="hs-identifier hs-type">ForAllCo</span></a></span><span> </span><span id="local-6989586621681033954"><span class="annot"><span class="annottext">CoVar
</span><a href="#local-6989586621681033954"><span class="hs-identifier hs-var">tv1</span></a></span></span><span> </span><span class="annot"><span class="annottext">Coercion
</span><span class="hs-identifier">_</span></span><span> </span><span id="local-6989586621681033953"><span class="annot"><span class="annottext">Coercion
</span><a href="#local-6989586621681033953"><span class="hs-identifier hs-var">co1</span></a></span></span><span class="hs-special">)</span><span>     </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">CoVar -&gt; Type -&gt; Type
</span><a href="GHC.Core.Type.html#mkTyCoInvForAllTy"><span class="hs-identifier hs-var">mkTyCoInvForAllTy</span></a></span><span> </span><span class="annot"><span class="annottext">CoVar
</span><a href="#local-6989586621681033954"><span class="hs-identifier hs-var">tv1</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Coercion -&gt; Type
</span><a href="#local-6989586621681033966"><span class="hs-identifier hs-var">go</span></a></span><span> </span><span class="annot"><span class="annottext">Coercion
</span><a href="#local-6989586621681033953"><span class="hs-identifier hs-var">co1</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-2366"></span><span>    </span><span class="annot"><a href="#local-6989586621681033966"><span class="hs-identifier hs-var">go</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="GHC.Core.TyCo.Rep.html#FunCo"><span class="hs-identifier hs-type">FunCo</span></a></span><span> </span><span class="annot"><span class="annottext">Role
</span><span class="hs-identifier">_</span></span><span> </span><span id="local-6989586621681033952"><span class="annot"><span class="annottext">Coercion
</span><a href="#local-6989586621681033952"><span class="hs-identifier hs-var">w</span></a></span></span><span> </span><span id="local-6989586621681033951"><span class="annot"><span class="annottext">Coercion
</span><a href="#local-6989586621681033951"><span class="hs-identifier hs-var">co1</span></a></span></span><span> </span><span id="local-6989586621681033950"><span class="annot"><span class="annottext">Coercion
</span><a href="#local-6989586621681033950"><span class="hs-identifier hs-var">co2</span></a></span></span><span class="hs-special">)</span><span>      </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">Type -&gt; Type -&gt; Type -&gt; Type
</span><a href="GHC.Core.Utils.html#mkFunctionType"><span class="hs-identifier hs-var">mkFunctionType</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Coercion -&gt; Type
</span><a href="#local-6989586621681033966"><span class="hs-identifier hs-var">go</span></a></span><span> </span><span class="annot"><span class="annottext">Coercion
</span><a href="#local-6989586621681033952"><span class="hs-identifier hs-var">w</span></a></span><span class="hs-special">)</span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Coercion -&gt; Type
</span><a href="#local-6989586621681033966"><span class="hs-identifier hs-var">go</span></a></span><span> </span><span class="annot"><span class="annottext">Coercion
</span><a href="#local-6989586621681033951"><span class="hs-identifier hs-var">co1</span></a></span><span class="hs-special">)</span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Coercion -&gt; Type
</span><a href="#local-6989586621681033966"><span class="hs-identifier hs-var">go</span></a></span><span> </span><span class="annot"><span class="annottext">Coercion
</span><a href="#local-6989586621681033950"><span class="hs-identifier hs-var">co2</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-2367"></span><span>    </span><span class="annot"><a href="#local-6989586621681033966"><span class="hs-identifier hs-var">go</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="GHC.Core.TyCo.Rep.html#CoVarCo"><span class="hs-identifier hs-type">CoVarCo</span></a></span><span> </span><span id="local-6989586621681033949"><span class="annot"><span class="annottext">CoVar
</span><a href="#local-6989586621681033949"><span class="hs-identifier hs-var">cv</span></a></span></span><span class="hs-special">)</span><span>             </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">HasDebugCallStack =&gt; CoVar -&gt; Type
</span><a href="GHC.Core.Coercion.html#coVarLType"><span class="hs-identifier hs-var">coVarLType</span></a></span><span> </span><span class="annot"><span class="annottext">CoVar
</span><a href="#local-6989586621681033949"><span class="hs-identifier hs-var">cv</span></a></span><span>
</span><span id="line-2368"></span><span>    </span><span class="annot"><a href="#local-6989586621681033966"><span class="hs-identifier hs-var">go</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="GHC.Core.TyCo.Rep.html#HoleCo"><span class="hs-identifier hs-type">HoleCo</span></a></span><span> </span><span id="local-6989586621681033948"><span class="annot"><span class="annottext">CoercionHole
</span><a href="#local-6989586621681033948"><span class="hs-identifier hs-var">h</span></a></span></span><span class="hs-special">)</span><span>               </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">HasDebugCallStack =&gt; CoVar -&gt; Type
</span><a href="GHC.Core.Coercion.html#coVarLType"><span class="hs-identifier hs-var">coVarLType</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">CoercionHole -&gt; CoVar
</span><a href="GHC.Core.TyCo.Rep.html#coHoleCoVar"><span class="hs-identifier hs-var">coHoleCoVar</span></a></span><span> </span><span class="annot"><span class="annottext">CoercionHole
</span><a href="#local-6989586621681033948"><span class="hs-identifier hs-var">h</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-2369"></span><span>    </span><span class="annot"><a href="#local-6989586621681033966"><span class="hs-identifier hs-var">go</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="GHC.Core.TyCo.Rep.html#UnivCo"><span class="hs-identifier hs-type">UnivCo</span></a></span><span> </span><span class="annot"><span class="annottext">UnivCoProvenance
</span><span class="hs-identifier">_</span></span><span> </span><span class="annot"><span class="annottext">Role
</span><span class="hs-identifier">_</span></span><span> </span><span id="local-6989586621681033947"><span class="annot"><span class="annottext">Type
</span><a href="#local-6989586621681033947"><span class="hs-identifier hs-var">ty1</span></a></span></span><span> </span><span class="annot"><span class="annottext">Type
</span><span class="hs-identifier">_</span></span><span class="hs-special">)</span><span>       </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">Type
</span><a href="#local-6989586621681033947"><span class="hs-identifier hs-var">ty1</span></a></span><span>
</span><span id="line-2370"></span><span>    </span><span class="annot"><a href="#local-6989586621681033966"><span class="hs-identifier hs-var">go</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="GHC.Core.TyCo.Rep.html#SymCo"><span class="hs-identifier hs-type">SymCo</span></a></span><span> </span><span id="local-6989586621681033946"><span class="annot"><span class="annottext">Coercion
</span><a href="#local-6989586621681033946"><span class="hs-identifier hs-var">co</span></a></span></span><span class="hs-special">)</span><span>               </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">Coercion -&gt; Type
</span><a href="GHC.Core.Coercion.html#coercionRKind"><span class="hs-identifier hs-var">coercionRKind</span></a></span><span> </span><span class="annot"><span class="annottext">Coercion
</span><a href="#local-6989586621681033946"><span class="hs-identifier hs-var">co</span></a></span><span>
</span><span id="line-2371"></span><span>    </span><span class="annot"><a href="#local-6989586621681033966"><span class="hs-identifier hs-var">go</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="GHC.Core.TyCo.Rep.html#TransCo"><span class="hs-identifier hs-type">TransCo</span></a></span><span> </span><span id="local-6989586621681033945"><span class="annot"><span class="annottext">Coercion
</span><a href="#local-6989586621681033945"><span class="hs-identifier hs-var">co1</span></a></span></span><span> </span><span class="annot"><span class="annottext">Coercion
</span><span class="hs-identifier">_</span></span><span class="hs-special">)</span><span>          </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">Coercion -&gt; Type
</span><a href="#local-6989586621681033966"><span class="hs-identifier hs-var">go</span></a></span><span> </span><span class="annot"><span class="annottext">Coercion
</span><a href="#local-6989586621681033945"><span class="hs-identifier hs-var">co1</span></a></span><span>
</span><span id="line-2372"></span><span>    </span><span class="annot"><a href="#local-6989586621681033966"><span class="hs-identifier hs-var">go</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="GHC.Core.TyCo.Rep.html#LRCo"><span class="hs-identifier hs-type">LRCo</span></a></span><span> </span><span id="local-6989586621681033944"><span class="annot"><span class="annottext">LeftOrRight
</span><a href="#local-6989586621681033944"><span class="hs-identifier hs-var">lr</span></a></span></span><span> </span><span id="local-6989586621681033943"><span class="annot"><span class="annottext">Coercion
</span><a href="#local-6989586621681033943"><span class="hs-identifier hs-var">co</span></a></span></span><span class="hs-special">)</span><span>             </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">forall a. LeftOrRight -&gt; (a, a) -&gt; a
</span><a href="GHC.Types.Basic.html#pickLR"><span class="hs-identifier hs-var">pickLR</span></a></span><span> </span><span class="annot"><span class="annottext">LeftOrRight
</span><a href="#local-6989586621681033944"><span class="hs-identifier hs-var">lr</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Type -&gt; (Type, Type)
</span><a href="GHC.Core.Type.html#splitAppTy"><span class="hs-identifier hs-var">splitAppTy</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Coercion -&gt; Type
</span><a href="#local-6989586621681033966"><span class="hs-identifier hs-var">go</span></a></span><span> </span><span class="annot"><span class="annottext">Coercion
</span><a href="#local-6989586621681033943"><span class="hs-identifier hs-var">co</span></a></span><span class="hs-special">)</span><span class="hs-special">)</span><span>
</span><span id="line-2373"></span><span>    </span><span class="annot"><a href="#local-6989586621681033966"><span class="hs-identifier hs-var">go</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="GHC.Core.TyCo.Rep.html#InstCo"><span class="hs-identifier hs-type">InstCo</span></a></span><span> </span><span id="local-6989586621681033942"><span class="annot"><span class="annottext">Coercion
</span><a href="#local-6989586621681033942"><span class="hs-identifier hs-var">aco</span></a></span></span><span> </span><span id="local-6989586621681033941"><span class="annot"><span class="annottext">Coercion
</span><a href="#local-6989586621681033941"><span class="hs-identifier hs-var">arg</span></a></span></span><span class="hs-special">)</span><span>         </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">Coercion -&gt; [Type] -&gt; Type
</span><a href="#local-6989586621681033940"><span class="hs-identifier hs-var">go_app</span></a></span><span> </span><span class="annot"><span class="annottext">Coercion
</span><a href="#local-6989586621681033942"><span class="hs-identifier hs-var">aco</span></a></span><span> </span><span class="hs-special">[</span><span class="annot"><span class="annottext">Coercion -&gt; Type
</span><a href="#local-6989586621681033966"><span class="hs-identifier hs-var">go</span></a></span><span> </span><span class="annot"><span class="annottext">Coercion
</span><a href="#local-6989586621681033941"><span class="hs-identifier hs-var">arg</span></a></span><span class="hs-special">]</span><span>
</span><span id="line-2374"></span><span>    </span><span class="annot"><a href="#local-6989586621681033966"><span class="hs-identifier hs-var">go</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="GHC.Core.TyCo.Rep.html#KindCo"><span class="hs-identifier hs-type">KindCo</span></a></span><span> </span><span id="local-6989586621681033939"><span class="annot"><span class="annottext">Coercion
</span><a href="#local-6989586621681033939"><span class="hs-identifier hs-var">co</span></a></span></span><span class="hs-special">)</span><span>              </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">HasDebugCallStack =&gt; Type -&gt; Type
</span><a href="GHC.Core.Type.html#typeKind"><span class="hs-identifier hs-var">typeKind</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Coercion -&gt; Type
</span><a href="#local-6989586621681033966"><span class="hs-identifier hs-var">go</span></a></span><span> </span><span class="annot"><span class="annottext">Coercion
</span><a href="#local-6989586621681033939"><span class="hs-identifier hs-var">co</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-2375"></span><span>    </span><span class="annot"><a href="#local-6989586621681033966"><span class="hs-identifier hs-var">go</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="GHC.Core.TyCo.Rep.html#SubCo"><span class="hs-identifier hs-type">SubCo</span></a></span><span> </span><span id="local-6989586621681033938"><span class="annot"><span class="annottext">Coercion
</span><a href="#local-6989586621681033938"><span class="hs-identifier hs-var">co</span></a></span></span><span class="hs-special">)</span><span>               </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">Coercion -&gt; Type
</span><a href="#local-6989586621681033966"><span class="hs-identifier hs-var">go</span></a></span><span> </span><span class="annot"><span class="annottext">Coercion
</span><a href="#local-6989586621681033938"><span class="hs-identifier hs-var">co</span></a></span><span>
</span><span id="line-2376"></span><span>    </span><span class="annot"><a href="#local-6989586621681033966"><span class="hs-identifier hs-var">go</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="GHC.Core.TyCo.Rep.html#NthCo"><span class="hs-identifier hs-type">NthCo</span></a></span><span> </span><span class="annot"><span class="annottext">Role
</span><span class="hs-identifier">_</span></span><span> </span><span id="local-6989586621681033937"><span class="annot"><span class="annottext">Int
</span><a href="#local-6989586621681033937"><span class="hs-identifier hs-var">d</span></a></span></span><span> </span><span id="local-6989586621681033936"><span class="annot"><span class="annottext">Coercion
</span><a href="#local-6989586621681033936"><span class="hs-identifier hs-var">co</span></a></span></span><span class="hs-special">)</span><span>           </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">Int -&gt; Type -&gt; Type
</span><a href="GHC.Core.Coercion.html#go_nth"><span class="hs-identifier hs-var">go_nth</span></a></span><span> </span><span class="annot"><span class="annottext">Int
</span><a href="#local-6989586621681033937"><span class="hs-identifier hs-var">d</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Coercion -&gt; Type
</span><a href="#local-6989586621681033966"><span class="hs-identifier hs-var">go</span></a></span><span> </span><span class="annot"><span class="annottext">Coercion
</span><a href="#local-6989586621681033936"><span class="hs-identifier hs-var">co</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-2377"></span><span>    </span><span class="annot"><a href="#local-6989586621681033966"><span class="hs-identifier hs-var">go</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="GHC.Core.TyCo.Rep.html#AxiomInstCo"><span class="hs-identifier hs-type">AxiomInstCo</span></a></span><span> </span><span id="local-6989586621681033934"><span class="annot"><span class="annottext">CoAxiom Branched
</span><a href="#local-6989586621681033934"><span class="hs-identifier hs-var">ax</span></a></span></span><span> </span><span id="local-6989586621681033933"><span class="annot"><span class="annottext">Int
</span><a href="#local-6989586621681033933"><span class="hs-identifier hs-var">ind</span></a></span></span><span> </span><span id="local-6989586621681033932"><span class="annot"><span class="annottext">[Coercion]
</span><a href="#local-6989586621681033932"><span class="hs-identifier hs-var">cos</span></a></span></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">forall {br :: BranchFlag}. CoAxiom br -&gt; Int -&gt; [Type] -&gt; Type
</span><a href="#local-6989586621681033931"><span class="hs-identifier hs-var">go_ax_inst</span></a></span><span> </span><span class="annot"><span class="annottext">CoAxiom Branched
</span><a href="#local-6989586621681033934"><span class="hs-identifier hs-var">ax</span></a></span><span> </span><span class="annot"><span class="annottext">Int
</span><a href="#local-6989586621681033933"><span class="hs-identifier hs-var">ind</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">forall a b. (a -&gt; b) -&gt; [a] -&gt; [b]
</span><a href="../../base-4.16.4.0/src/GHC-Base.html#map"><span class="hs-identifier hs-var">map</span></a></span><span> </span><span class="annot"><span class="annottext">Coercion -&gt; Type
</span><a href="#local-6989586621681033966"><span class="hs-identifier hs-var">go</span></a></span><span> </span><span class="annot"><span class="annottext">[Coercion]
</span><a href="#local-6989586621681033932"><span class="hs-identifier hs-var">cos</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-2378"></span><span>    </span><span class="annot"><a href="#local-6989586621681033966"><span class="hs-identifier hs-var">go</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="GHC.Core.TyCo.Rep.html#AxiomRuleCo"><span class="hs-identifier hs-type">AxiomRuleCo</span></a></span><span> </span><span id="local-6989586621681033930"><span class="annot"><span class="annottext">CoAxiomRule
</span><a href="#local-6989586621681033930"><span class="hs-identifier hs-var">ax</span></a></span></span><span> </span><span id="local-6989586621681033929"><span class="annot"><span class="annottext">[Coercion]
</span><a href="#local-6989586621681033929"><span class="hs-identifier hs-var">cos</span></a></span></span><span class="hs-special">)</span><span>     </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">forall a. Pair a -&gt; a
</span><a href="GHC.Data.Pair.html#pFst"><span class="hs-identifier hs-var">pFst</span></a></span><span> </span><span class="annot"><span class="annottext">forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><a href="../../base-4.16.4.0/src/GHC-Base.html#%24"><span class="hs-operator hs-var">$</span></a></span><span> </span><span class="annot"><span class="annottext">forall a. HasCallStack =&gt; String -&gt; Maybe a -&gt; a
</span><a href="GHC.Data.Maybe.html#expectJust"><span class="hs-identifier hs-var">expectJust</span></a></span><span> </span><span class="annot"><span class="annottext">String
</span><span class="hs-string">&quot;coercionKind&quot;</span></span><span> </span><span class="annot"><span class="annottext">forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><a href="../../base-4.16.4.0/src/GHC-Base.html#%24"><span class="hs-operator hs-var">$</span></a></span><span>
</span><span id="line-2379"></span><span>                                  </span><span class="annot"><span class="annottext">CoAxiomRule -&gt; [Pair Type] -&gt; Maybe (Pair Type)
</span><a href="GHC.Core.Coercion.Axiom.html#coaxrProves"><span class="hs-identifier hs-var">coaxrProves</span></a></span><span> </span><span class="annot"><span class="annottext">CoAxiomRule
</span><a href="#local-6989586621681033930"><span class="hs-identifier hs-var">ax</span></a></span><span> </span><span class="annot"><span class="annottext">forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><a href="../../base-4.16.4.0/src/GHC-Base.html#%24"><span class="hs-operator hs-var">$</span></a></span><span> </span><span class="annot"><span class="annottext">forall a b. (a -&gt; b) -&gt; [a] -&gt; [b]
</span><a href="../../base-4.16.4.0/src/GHC-Base.html#map"><span class="hs-identifier hs-var">map</span></a></span><span> </span><span class="annot"><span class="annottext">Coercion -&gt; Pair Type
</span><a href="GHC.Core.Coercion.html#coercionKind"><span class="hs-identifier hs-var">coercionKind</span></a></span><span> </span><span class="annot"><span class="annottext">[Coercion]
</span><a href="#local-6989586621681033929"><span class="hs-identifier hs-var">cos</span></a></span><span>
</span><span id="line-2380"></span><span>
</span><span id="line-2381"></span><span>    </span><span id="local-6989586621681033931"><span class="annot"><span class="annottext">go_ax_inst :: CoAxiom br -&gt; Int -&gt; [Type] -&gt; Type
</span><a href="#local-6989586621681033931"><span class="hs-identifier hs-var hs-var">go_ax_inst</span></a></span></span><span> </span><span id="local-6989586621681033925"><span class="annot"><span class="annottext">CoAxiom br
</span><a href="#local-6989586621681033925"><span class="hs-identifier hs-var">ax</span></a></span></span><span> </span><span id="local-6989586621681033924"><span class="annot"><span class="annottext">Int
</span><a href="#local-6989586621681033924"><span class="hs-identifier hs-var">ind</span></a></span></span><span> </span><span id="local-6989586621681033923"><span class="annot"><span class="annottext">[Type]
</span><a href="#local-6989586621681033923"><span class="hs-identifier hs-var">tys</span></a></span></span><span>
</span><span id="line-2382"></span><span>      </span><span class="hs-glyph">|</span><span> </span><span class="annot"><a href="GHC.Core.Coercion.Axiom.html#CoAxBranch"><span class="hs-identifier hs-type">CoAxBranch</span></a></span><span> </span><span class="hs-special">{</span><span> </span><span class="annot"><span class="annottext">cab_tvs :: CoAxBranch -&gt; [CoVar]
</span><a href="GHC.Core.Coercion.Axiom.html#cab_tvs"><span class="hs-identifier hs-var">cab_tvs</span></a></span><span> </span><span class="hs-glyph">=</span><span> </span><span id="local-6989586621681033922"><span class="annot"><span class="annottext">[CoVar]
</span><a href="#local-6989586621681033922"><span class="hs-identifier hs-var">tvs</span></a></span></span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">cab_cvs :: CoAxBranch -&gt; [CoVar]
</span><a href="GHC.Core.Coercion.Axiom.html#cab_cvs"><span class="hs-identifier hs-var">cab_cvs</span></a></span><span> </span><span class="hs-glyph">=</span><span> </span><span id="local-6989586621681033920"><span class="annot"><span class="annottext">[CoVar]
</span><a href="#local-6989586621681033920"><span class="hs-identifier hs-var">cvs</span></a></span></span><span>
</span><span id="line-2383"></span><span>                   </span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">cab_lhs :: CoAxBranch -&gt; [Type]
</span><a href="GHC.Core.Coercion.Axiom.html#cab_lhs"><span class="hs-identifier hs-var">cab_lhs</span></a></span><span> </span><span class="hs-glyph">=</span><span> </span><span id="local-6989586621681033919"><span class="annot"><span class="annottext">[Type]
</span><a href="#local-6989586621681033919"><span class="hs-identifier hs-var">lhs</span></a></span></span><span> </span><span class="hs-special">}</span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">forall (br :: BranchFlag). CoAxiom br -&gt; Int -&gt; CoAxBranch
</span><a href="GHC.Core.Coercion.Axiom.html#coAxiomNthBranch"><span class="hs-identifier hs-var">coAxiomNthBranch</span></a></span><span> </span><span class="annot"><span class="annottext">CoAxiom br
</span><a href="#local-6989586621681033925"><span class="hs-identifier hs-var">ax</span></a></span><span> </span><span class="annot"><span class="annottext">Int
</span><a href="#local-6989586621681033924"><span class="hs-identifier hs-var">ind</span></a></span><span>
</span><span id="line-2384"></span><span>      </span><span class="hs-special">,</span><span> </span><span class="hs-keyword">let</span><span> </span><span class="hs-special">(</span><span id="local-6989586621681033918"><span class="annot"><span class="annottext">[Type]
</span><a href="#local-6989586621681033918"><span class="hs-identifier hs-var">tys1</span></a></span></span><span class="hs-special">,</span><span> </span><span id="local-6989586621681033917"><span class="annot"><span class="annottext">[Type]
</span><a href="#local-6989586621681033917"><span class="hs-identifier hs-var">cotys1</span></a></span></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">forall b a. [b] -&gt; [a] -&gt; ([a], [a])
</span><a href="GHC.Utils.Misc.html#splitAtList"><span class="hs-identifier hs-var">splitAtList</span></a></span><span> </span><span class="annot"><span class="annottext">[CoVar]
</span><a href="#local-6989586621681033922"><span class="hs-identifier hs-var">tvs</span></a></span><span> </span><span class="annot"><span class="annottext">[Type]
</span><a href="#local-6989586621681033923"><span class="hs-identifier hs-var">tys</span></a></span><span>
</span><span id="line-2385"></span><span>            </span><span id="local-6989586621681033916"><span class="annot"><span class="annottext">cos1 :: [Coercion]
</span><a href="#local-6989586621681033916"><span class="hs-identifier hs-var hs-var">cos1</span></a></span></span><span>           </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">forall a b. (a -&gt; b) -&gt; [a] -&gt; [b]
</span><a href="../../base-4.16.4.0/src/GHC-Base.html#map"><span class="hs-identifier hs-var">map</span></a></span><span> </span><span class="annot"><span class="annottext">Type -&gt; Coercion
</span><a href="GHC.Core.Type.html#stripCoercionTy"><span class="hs-identifier hs-var">stripCoercionTy</span></a></span><span> </span><span class="annot"><span class="annottext">[Type]
</span><a href="#local-6989586621681033917"><span class="hs-identifier hs-var">cotys1</span></a></span><span>
</span><span id="line-2386"></span><span>      </span><span class="hs-glyph">=</span><span> </span><span class="hs-identifier">ASSERT</span><span class="hs-special">(</span><span> </span><span class="hs-identifier">tys</span><span> </span><span class="hs-special">`</span><span class="hs-identifier">equalLength</span><span class="hs-special">`</span><span> </span><span class="hs-special">(</span><span class="hs-identifier">tvs</span><span> </span><span class="hs-operator">++</span><span> </span><span class="hs-identifier">cvs</span><span class="hs-special">)</span><span> </span><span class="hs-special">)</span><span>
</span><span id="line-2387"></span><span>                  </span><span class="hs-comment">-- Invariant of AxiomInstCo: cos should</span><span>
</span><span id="line-2388"></span><span>                  </span><span class="hs-comment">-- exactly saturate the axiom branch</span><span>
</span><span id="line-2389"></span><span>        </span><span class="annot"><span class="annottext">HasCallStack =&gt; [CoVar] -&gt; [Type] -&gt; Type -&gt; Type
</span><a href="GHC.Core.TyCo.Subst.html#substTyWith"><span class="hs-identifier hs-var">substTyWith</span></a></span><span> </span><span class="annot"><span class="annottext">[CoVar]
</span><a href="#local-6989586621681033922"><span class="hs-identifier hs-var">tvs</span></a></span><span> </span><span class="annot"><span class="annottext">[Type]
</span><a href="#local-6989586621681033918"><span class="hs-identifier hs-var">tys1</span></a></span><span>       </span><span class="annot"><span class="annottext">forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><a href="../../base-4.16.4.0/src/GHC-Base.html#%24"><span class="hs-operator hs-var">$</span></a></span><span>
</span><span id="line-2390"></span><span>        </span><span class="annot"><span class="annottext">[CoVar] -&gt; [Coercion] -&gt; Type -&gt; Type
</span><a href="GHC.Core.TyCo.Subst.html#substTyWithCoVars"><span class="hs-identifier hs-var">substTyWithCoVars</span></a></span><span> </span><span class="annot"><span class="annottext">[CoVar]
</span><a href="#local-6989586621681033920"><span class="hs-identifier hs-var">cvs</span></a></span><span> </span><span class="annot"><span class="annottext">[Coercion]
</span><a href="#local-6989586621681033916"><span class="hs-identifier hs-var">cos1</span></a></span><span> </span><span class="annot"><span class="annottext">forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><a href="../../base-4.16.4.0/src/GHC-Base.html#%24"><span class="hs-operator hs-var">$</span></a></span><span>
</span><span id="line-2391"></span><span>        </span><span class="annot"><span class="annottext">TyCon -&gt; [Type] -&gt; Type
</span><a href="GHC.Core.Type.html#mkTyConApp"><span class="hs-identifier hs-var">mkTyConApp</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">forall (br :: BranchFlag). CoAxiom br -&gt; TyCon
</span><a href="GHC.Core.Coercion.Axiom.html#coAxiomTyCon"><span class="hs-identifier hs-var">coAxiomTyCon</span></a></span><span> </span><span class="annot"><span class="annottext">CoAxiom br
</span><a href="#local-6989586621681033925"><span class="hs-identifier hs-var">ax</span></a></span><span class="hs-special">)</span><span> </span><span class="annot"><span class="annottext">[Type]
</span><a href="#local-6989586621681033919"><span class="hs-identifier hs-var">lhs</span></a></span><span>
</span><span id="line-2392"></span><span>
</span><span id="line-2393"></span><span>    </span><span class="annot"><a href="#local-6989586621681033940"><span class="hs-identifier hs-type">go_app</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><a href="GHC.Core.TyCo.Rep.html#Coercion"><span class="hs-identifier hs-type">Coercion</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-special">[</span><span class="annot"><a href="GHC.Core.TyCo.Rep.html#Type"><span class="hs-identifier hs-type">Type</span></a></span><span class="hs-special">]</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="GHC.Core.TyCo.Rep.html#Type"><span class="hs-identifier hs-type">Type</span></a></span><span>
</span><span id="line-2394"></span><span>    </span><span class="hs-comment">-- Collect up all the arguments and apply all at once</span><span>
</span><span id="line-2395"></span><span>    </span><span class="hs-comment">-- See Note [Nested InstCos]</span><span>
</span><span id="line-2396"></span><span>    </span><span id="local-6989586621681033940"><span class="annot"><span class="annottext">go_app :: Coercion -&gt; [Type] -&gt; Type
</span><a href="#local-6989586621681033940"><span class="hs-identifier hs-var hs-var">go_app</span></a></span></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="GHC.Core.TyCo.Rep.html#InstCo"><span class="hs-identifier hs-type">InstCo</span></a></span><span> </span><span id="local-6989586621681033914"><span class="annot"><span class="annottext">Coercion
</span><a href="#local-6989586621681033914"><span class="hs-identifier hs-var">co</span></a></span></span><span> </span><span id="local-6989586621681033913"><span class="annot"><span class="annottext">Coercion
</span><a href="#local-6989586621681033913"><span class="hs-identifier hs-var">arg</span></a></span></span><span class="hs-special">)</span><span> </span><span id="local-6989586621681033912"><span class="annot"><span class="annottext">[Type]
</span><a href="#local-6989586621681033912"><span class="hs-identifier hs-var">args</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">Coercion -&gt; [Type] -&gt; Type
</span><a href="#local-6989586621681033940"><span class="hs-identifier hs-var">go_app</span></a></span><span> </span><span class="annot"><span class="annottext">Coercion
</span><a href="#local-6989586621681033914"><span class="hs-identifier hs-var">co</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Coercion -&gt; Type
</span><a href="#local-6989586621681033966"><span class="hs-identifier hs-var">go</span></a></span><span> </span><span class="annot"><span class="annottext">Coercion
</span><a href="#local-6989586621681033913"><span class="hs-identifier hs-var">arg</span></a></span><span class="annot"><span class="annottext">forall a. a -&gt; [a] -&gt; [a]
</span><span class="hs-glyph hs-var">:</span></span><span class="annot"><span class="annottext">[Type]
</span><a href="#local-6989586621681033912"><span class="hs-identifier hs-var">args</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-2397"></span><span>    </span><span class="annot"><a href="#local-6989586621681033940"><span class="hs-identifier hs-var">go_app</span></a></span><span> </span><span id="local-6989586621681033911"><span class="annot"><span class="annottext">Coercion
</span><a href="#local-6989586621681033911"><span class="hs-identifier hs-var">co</span></a></span></span><span>              </span><span id="local-6989586621681033910"><span class="annot"><span class="annottext">[Type]
</span><a href="#local-6989586621681033910"><span class="hs-identifier hs-var">args</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">HasDebugCallStack =&gt; Type -&gt; [Type] -&gt; Type
</span><a href="GHC.Core.Type.html#piResultTys"><span class="hs-identifier hs-var">piResultTys</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Coercion -&gt; Type
</span><a href="#local-6989586621681033966"><span class="hs-identifier hs-var">go</span></a></span><span> </span><span class="annot"><span class="annottext">Coercion
</span><a href="#local-6989586621681033911"><span class="hs-identifier hs-var">co</span></a></span><span class="hs-special">)</span><span> </span><span class="annot"><span class="annottext">[Type]
</span><a href="#local-6989586621681033910"><span class="hs-identifier hs-var">args</span></a></span><span>
</span><span id="line-2398"></span><span>
</span><span id="line-2399"></span><span class="annot"><a href="GHC.Core.Coercion.html#go_nth"><span class="hs-identifier hs-type">go_nth</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><span class="hs-identifier hs-type">Int</span></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="GHC.Core.TyCo.Rep.html#Type"><span class="hs-identifier hs-type">Type</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="GHC.Core.TyCo.Rep.html#Type"><span class="hs-identifier hs-type">Type</span></a></span><span>
</span><span id="line-2400"></span><span id="go_nth"><span class="annot"><span class="annottext">go_nth :: Int -&gt; Type -&gt; Type
</span><a href="GHC.Core.Coercion.html#go_nth"><span class="hs-identifier hs-var hs-var">go_nth</span></a></span></span><span> </span><span id="local-6989586621681033908"><span class="annot"><span class="annottext">Int
</span><a href="#local-6989586621681033908"><span class="hs-identifier hs-var">d</span></a></span></span><span> </span><span id="local-6989586621681033907"><span class="annot"><span class="annottext">Type
</span><a href="#local-6989586621681033907"><span class="hs-identifier hs-var">ty</span></a></span></span><span>
</span><span id="line-2401"></span><span>  </span><span class="hs-glyph">|</span><span> </span><span class="annot"><a href="../../base-4.16.4.0/src/GHC-Maybe.html#Just"><span class="hs-identifier hs-type">Just</span></a></span><span> </span><span id="local-6989586621681033906"><span class="annot"><span class="annottext">[Type]
</span><a href="#local-6989586621681033906"><span class="hs-identifier hs-var">args</span></a></span></span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">Type -&gt; Maybe [Type]
</span><a href="GHC.Core.Type.html#tyConAppArgs_maybe"><span class="hs-identifier hs-var">tyConAppArgs_maybe</span></a></span><span> </span><span class="annot"><span class="annottext">Type
</span><a href="#local-6989586621681033907"><span class="hs-identifier hs-var">ty</span></a></span><span>
</span><span id="line-2402"></span><span>  </span><span class="hs-glyph">=</span><span> </span><span class="hs-identifier">ASSERT</span><span class="hs-special">(</span><span> </span><span class="hs-identifier">args</span><span> </span><span class="hs-special">`</span><span class="hs-identifier">lengthExceeds</span><span class="hs-special">`</span><span> </span><span class="hs-identifier">d</span><span> </span><span class="hs-special">)</span><span>
</span><span id="line-2403"></span><span>    </span><span class="annot"><span class="annottext">[Type]
</span><a href="#local-6989586621681033906"><span class="hs-identifier hs-var">args</span></a></span><span> </span><span class="annot"><span class="annottext">forall a. Outputable a =&gt; [a] -&gt; Int -&gt; a
</span><a href="GHC.Data.List.SetOps.html#getNth"><span class="hs-operator hs-var">`getNth`</span></a></span><span> </span><span class="annot"><span class="annottext">Int
</span><a href="#local-6989586621681033908"><span class="hs-identifier hs-var">d</span></a></span><span>
</span><span id="line-2404"></span><span>
</span><span id="line-2405"></span><span>  </span><span class="hs-glyph">|</span><span> </span><span class="annot"><span class="annottext">Int
</span><a href="#local-6989586621681033908"><span class="hs-identifier hs-var">d</span></a></span><span> </span><span class="annot"><span class="annottext">forall a. Eq a =&gt; a -&gt; a -&gt; Bool
</span><span class="hs-operator hs-var">==</span></span><span> </span><span class="annot"><span class="annottext">Int
</span><span class="hs-number">0</span></span><span>
</span><span id="line-2406"></span><span>  </span><span class="hs-special">,</span><span> </span><span class="annot"><a href="../../base-4.16.4.0/src/GHC-Maybe.html#Just"><span class="hs-identifier hs-type">Just</span></a></span><span> </span><span class="hs-special">(</span><span id="local-6989586621681033904"><span class="annot"><span class="annottext">CoVar
</span><a href="#local-6989586621681033904"><span class="hs-identifier hs-var">tv</span></a></span></span><span class="hs-special">,</span><span class="annot"><span class="annottext">Type
</span><span class="hs-identifier">_</span></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">Type -&gt; Maybe (CoVar, Type)
</span><a href="GHC.Core.Type.html#splitForAllTyCoVar_maybe"><span class="hs-identifier hs-var">splitForAllTyCoVar_maybe</span></a></span><span> </span><span class="annot"><span class="annottext">Type
</span><a href="#local-6989586621681033907"><span class="hs-identifier hs-var">ty</span></a></span><span>
</span><span id="line-2407"></span><span>  </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">CoVar -&gt; Type
</span><a href="GHC.Types.Var.html#tyVarKind"><span class="hs-identifier hs-var">tyVarKind</span></a></span><span> </span><span class="annot"><span class="annottext">CoVar
</span><a href="#local-6989586621681033904"><span class="hs-identifier hs-var">tv</span></a></span><span>
</span><span id="line-2408"></span><span>
</span><span id="line-2409"></span><span>  </span><span class="hs-glyph">|</span><span> </span><span class="annot"><span class="annottext">Bool
</span><a href="../../base-4.16.4.0/src/GHC-Base.html#otherwise"><span class="hs-identifier hs-var">otherwise</span></a></span><span>
</span><span id="line-2410"></span><span>  </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">forall a. HasCallStack =&gt; String -&gt; SDoc -&gt; a
</span><a href="GHC.Utils.Panic.html#pprPanic"><span class="hs-identifier hs-var">pprPanic</span></a></span><span> </span><span class="annot"><span class="annottext">String
</span><span class="hs-string">&quot;coercionLKind:nth&quot;</span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">forall a. Outputable a =&gt; a -&gt; SDoc
</span><a href="GHC.Utils.Outputable.html#ppr"><span class="hs-identifier hs-var">ppr</span></a></span><span> </span><span class="annot"><span class="annottext">Int
</span><a href="#local-6989586621681033908"><span class="hs-identifier hs-var">d</span></a></span><span> </span><span class="annot"><span class="annottext">SDoc -&gt; SDoc -&gt; SDoc
</span><a href="GHC.Utils.Outputable.html#%3C%2B%3E"><span class="hs-operator hs-var">&lt;+&gt;</span></a></span><span> </span><span class="annot"><span class="annottext">forall a. Outputable a =&gt; a -&gt; SDoc
</span><a href="GHC.Utils.Outputable.html#ppr"><span class="hs-identifier hs-var">ppr</span></a></span><span> </span><span class="annot"><span class="annottext">Type
</span><a href="#local-6989586621681033907"><span class="hs-identifier hs-var">ty</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-2411"></span><span>
</span><span id="line-2412"></span><span class="annot"><a href="GHC.Core.Coercion.html#coercionRKind"><span class="hs-identifier hs-type">coercionRKind</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><a href="GHC.Core.TyCo.Rep.html#Coercion"><span class="hs-identifier hs-type">Coercion</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="GHC.Core.TyCo.Rep.html#Type"><span class="hs-identifier hs-type">Type</span></a></span><span>
</span><span id="line-2413"></span><span id="coercionRKind"><span class="annot"><span class="annottext">coercionRKind :: Coercion -&gt; Type
</span><a href="GHC.Core.Coercion.html#coercionRKind"><span class="hs-identifier hs-var hs-var">coercionRKind</span></a></span></span><span> </span><span id="local-6989586621681033903"><span class="annot"><span class="annottext">Coercion
</span><a href="#local-6989586621681033903"><span class="hs-identifier hs-var">co</span></a></span></span><span>
</span><span id="line-2414"></span><span>  </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">Coercion -&gt; Type
</span><a href="#local-6989586621681033902"><span class="hs-identifier hs-var">go</span></a></span><span> </span><span class="annot"><span class="annottext">Coercion
</span><a href="#local-6989586621681033903"><span class="hs-identifier hs-var">co</span></a></span><span>
</span><span id="line-2415"></span><span>  </span><span class="hs-keyword">where</span><span>
</span><span id="line-2416"></span><span>    </span><span id="local-6989586621681033902"><span class="annot"><span class="annottext">go :: Coercion -&gt; Type
</span><a href="#local-6989586621681033902"><span class="hs-identifier hs-var hs-var">go</span></a></span></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="GHC.Core.TyCo.Rep.html#Refl"><span class="hs-identifier hs-type">Refl</span></a></span><span> </span><span id="local-6989586621681033888"><span class="annot"><span class="annottext">Type
</span><a href="#local-6989586621681033888"><span class="hs-identifier hs-var">ty</span></a></span></span><span class="hs-special">)</span><span>                </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">Type
</span><a href="#local-6989586621681033888"><span class="hs-identifier hs-var">ty</span></a></span><span>
</span><span id="line-2417"></span><span>    </span><span class="annot"><a href="#local-6989586621681033902"><span class="hs-identifier hs-var">go</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="GHC.Core.TyCo.Rep.html#GRefl"><span class="hs-identifier hs-type">GRefl</span></a></span><span> </span><span class="annot"><span class="annottext">Role
</span><span class="hs-identifier">_</span></span><span> </span><span id="local-6989586621681033887"><span class="annot"><span class="annottext">Type
</span><a href="#local-6989586621681033887"><span class="hs-identifier hs-var">ty</span></a></span></span><span> </span><span class="annot"><span class="annottext">MCoercion
</span><a href="GHC.Core.TyCo.Rep.html#MRefl"><span class="hs-identifier hs-var">MRefl</span></a></span><span class="hs-special">)</span><span>       </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">Type
</span><a href="#local-6989586621681033887"><span class="hs-identifier hs-var">ty</span></a></span><span>
</span><span id="line-2418"></span><span>    </span><span class="annot"><a href="#local-6989586621681033902"><span class="hs-identifier hs-var">go</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="GHC.Core.TyCo.Rep.html#GRefl"><span class="hs-identifier hs-type">GRefl</span></a></span><span> </span><span class="annot"><span class="annottext">Role
</span><span class="hs-identifier">_</span></span><span> </span><span id="local-6989586621681033886"><span class="annot"><span class="annottext">Type
</span><a href="#local-6989586621681033886"><span class="hs-identifier hs-var">ty</span></a></span></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="GHC.Core.TyCo.Rep.html#MCo"><span class="hs-identifier hs-type">MCo</span></a></span><span> </span><span id="local-6989586621681033885"><span class="annot"><span class="annottext">Coercion
</span><a href="#local-6989586621681033885"><span class="hs-identifier hs-var">co1</span></a></span></span><span class="hs-special">)</span><span class="hs-special">)</span><span>   </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">Type -&gt; Coercion -&gt; Type
</span><a href="GHC.Core.Type.html#mkCastTy"><span class="hs-identifier hs-var">mkCastTy</span></a></span><span> </span><span class="annot"><span class="annottext">Type
</span><a href="#local-6989586621681033886"><span class="hs-identifier hs-var">ty</span></a></span><span> </span><span class="annot"><span class="annottext">Coercion
</span><a href="#local-6989586621681033885"><span class="hs-identifier hs-var">co1</span></a></span><span>
</span><span id="line-2419"></span><span>    </span><span class="annot"><a href="#local-6989586621681033902"><span class="hs-identifier hs-var">go</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="GHC.Core.TyCo.Rep.html#TyConAppCo"><span class="hs-identifier hs-type">TyConAppCo</span></a></span><span> </span><span class="annot"><span class="annottext">Role
</span><span class="hs-identifier">_</span></span><span> </span><span id="local-6989586621681033884"><span class="annot"><span class="annottext">TyCon
</span><a href="#local-6989586621681033884"><span class="hs-identifier hs-var">tc</span></a></span></span><span> </span><span id="local-6989586621681033883"><span class="annot"><span class="annottext">[Coercion]
</span><a href="#local-6989586621681033883"><span class="hs-identifier hs-var">cos</span></a></span></span><span class="hs-special">)</span><span>    </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">TyCon -&gt; [Type] -&gt; Type
</span><a href="GHC.Core.Type.html#mkTyConApp"><span class="hs-identifier hs-var">mkTyConApp</span></a></span><span> </span><span class="annot"><span class="annottext">TyCon
</span><a href="#local-6989586621681033884"><span class="hs-identifier hs-var">tc</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">forall a b. (a -&gt; b) -&gt; [a] -&gt; [b]
</span><a href="../../base-4.16.4.0/src/GHC-Base.html#map"><span class="hs-identifier hs-var">map</span></a></span><span> </span><span class="annot"><span class="annottext">Coercion -&gt; Type
</span><a href="#local-6989586621681033902"><span class="hs-identifier hs-var">go</span></a></span><span> </span><span class="annot"><span class="annottext">[Coercion]
</span><a href="#local-6989586621681033883"><span class="hs-identifier hs-var">cos</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-2420"></span><span>    </span><span class="annot"><a href="#local-6989586621681033902"><span class="hs-identifier hs-var">go</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="GHC.Core.TyCo.Rep.html#AppCo"><span class="hs-identifier hs-type">AppCo</span></a></span><span> </span><span id="local-6989586621681033882"><span class="annot"><span class="annottext">Coercion
</span><a href="#local-6989586621681033882"><span class="hs-identifier hs-var">co1</span></a></span></span><span> </span><span id="local-6989586621681033881"><span class="annot"><span class="annottext">Coercion
</span><a href="#local-6989586621681033881"><span class="hs-identifier hs-var">co2</span></a></span></span><span class="hs-special">)</span><span>          </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">Type -&gt; Type -&gt; Type
</span><a href="GHC.Core.Type.html#mkAppTy"><span class="hs-identifier hs-var">mkAppTy</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Coercion -&gt; Type
</span><a href="#local-6989586621681033902"><span class="hs-identifier hs-var">go</span></a></span><span> </span><span class="annot"><span class="annottext">Coercion
</span><a href="#local-6989586621681033882"><span class="hs-identifier hs-var">co1</span></a></span><span class="hs-special">)</span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Coercion -&gt; Type
</span><a href="#local-6989586621681033902"><span class="hs-identifier hs-var">go</span></a></span><span> </span><span class="annot"><span class="annottext">Coercion
</span><a href="#local-6989586621681033881"><span class="hs-identifier hs-var">co2</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-2421"></span><span>    </span><span class="annot"><a href="#local-6989586621681033902"><span class="hs-identifier hs-var">go</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="GHC.Core.TyCo.Rep.html#CoVarCo"><span class="hs-identifier hs-type">CoVarCo</span></a></span><span> </span><span id="local-6989586621681033880"><span class="annot"><span class="annottext">CoVar
</span><a href="#local-6989586621681033880"><span class="hs-identifier hs-var">cv</span></a></span></span><span class="hs-special">)</span><span>             </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">HasDebugCallStack =&gt; CoVar -&gt; Type
</span><a href="GHC.Core.Coercion.html#coVarRType"><span class="hs-identifier hs-var">coVarRType</span></a></span><span> </span><span class="annot"><span class="annottext">CoVar
</span><a href="#local-6989586621681033880"><span class="hs-identifier hs-var">cv</span></a></span><span>
</span><span id="line-2422"></span><span>    </span><span class="annot"><a href="#local-6989586621681033902"><span class="hs-identifier hs-var">go</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="GHC.Core.TyCo.Rep.html#HoleCo"><span class="hs-identifier hs-type">HoleCo</span></a></span><span> </span><span id="local-6989586621681033879"><span class="annot"><span class="annottext">CoercionHole
</span><a href="#local-6989586621681033879"><span class="hs-identifier hs-var">h</span></a></span></span><span class="hs-special">)</span><span>               </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">HasDebugCallStack =&gt; CoVar -&gt; Type
</span><a href="GHC.Core.Coercion.html#coVarRType"><span class="hs-identifier hs-var">coVarRType</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">CoercionHole -&gt; CoVar
</span><a href="GHC.Core.TyCo.Rep.html#coHoleCoVar"><span class="hs-identifier hs-var">coHoleCoVar</span></a></span><span> </span><span class="annot"><span class="annottext">CoercionHole
</span><a href="#local-6989586621681033879"><span class="hs-identifier hs-var">h</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-2423"></span><span>    </span><span class="annot"><a href="#local-6989586621681033902"><span class="hs-identifier hs-var">go</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="GHC.Core.TyCo.Rep.html#FunCo"><span class="hs-identifier hs-type">FunCo</span></a></span><span> </span><span class="annot"><span class="annottext">Role
</span><span class="hs-identifier">_</span></span><span> </span><span id="local-6989586621681033878"><span class="annot"><span class="annottext">Coercion
</span><a href="#local-6989586621681033878"><span class="hs-identifier hs-var">w</span></a></span></span><span> </span><span id="local-6989586621681033877"><span class="annot"><span class="annottext">Coercion
</span><a href="#local-6989586621681033877"><span class="hs-identifier hs-var">co1</span></a></span></span><span> </span><span id="local-6989586621681033876"><span class="annot"><span class="annottext">Coercion
</span><a href="#local-6989586621681033876"><span class="hs-identifier hs-var">co2</span></a></span></span><span class="hs-special">)</span><span>      </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">Type -&gt; Type -&gt; Type -&gt; Type
</span><a href="GHC.Core.Utils.html#mkFunctionType"><span class="hs-identifier hs-var">mkFunctionType</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Coercion -&gt; Type
</span><a href="#local-6989586621681033902"><span class="hs-identifier hs-var">go</span></a></span><span> </span><span class="annot"><span class="annottext">Coercion
</span><a href="#local-6989586621681033878"><span class="hs-identifier hs-var">w</span></a></span><span class="hs-special">)</span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Coercion -&gt; Type
</span><a href="#local-6989586621681033902"><span class="hs-identifier hs-var">go</span></a></span><span> </span><span class="annot"><span class="annottext">Coercion
</span><a href="#local-6989586621681033877"><span class="hs-identifier hs-var">co1</span></a></span><span class="hs-special">)</span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Coercion -&gt; Type
</span><a href="#local-6989586621681033902"><span class="hs-identifier hs-var">go</span></a></span><span> </span><span class="annot"><span class="annottext">Coercion
</span><a href="#local-6989586621681033876"><span class="hs-identifier hs-var">co2</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-2424"></span><span>    </span><span class="annot"><a href="#local-6989586621681033902"><span class="hs-identifier hs-var">go</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="GHC.Core.TyCo.Rep.html#UnivCo"><span class="hs-identifier hs-type">UnivCo</span></a></span><span> </span><span class="annot"><span class="annottext">UnivCoProvenance
</span><span class="hs-identifier">_</span></span><span> </span><span class="annot"><span class="annottext">Role
</span><span class="hs-identifier">_</span></span><span> </span><span class="annot"><span class="annottext">Type
</span><span class="hs-identifier">_</span></span><span> </span><span id="local-6989586621681033875"><span class="annot"><span class="annottext">Type
</span><a href="#local-6989586621681033875"><span class="hs-identifier hs-var">ty2</span></a></span></span><span class="hs-special">)</span><span>       </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">Type
</span><a href="#local-6989586621681033875"><span class="hs-identifier hs-var">ty2</span></a></span><span>
</span><span id="line-2425"></span><span>    </span><span class="annot"><a href="#local-6989586621681033902"><span class="hs-identifier hs-var">go</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="GHC.Core.TyCo.Rep.html#SymCo"><span class="hs-identifier hs-type">SymCo</span></a></span><span> </span><span id="local-6989586621681033874"><span class="annot"><span class="annottext">Coercion
</span><a href="#local-6989586621681033874"><span class="hs-identifier hs-var">co</span></a></span></span><span class="hs-special">)</span><span>               </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">Coercion -&gt; Type
</span><a href="GHC.Core.Coercion.html#coercionLKind"><span class="hs-identifier hs-var">coercionLKind</span></a></span><span> </span><span class="annot"><span class="annottext">Coercion
</span><a href="#local-6989586621681033874"><span class="hs-identifier hs-var">co</span></a></span><span>
</span><span id="line-2426"></span><span>    </span><span class="annot"><a href="#local-6989586621681033902"><span class="hs-identifier hs-var">go</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="GHC.Core.TyCo.Rep.html#TransCo"><span class="hs-identifier hs-type">TransCo</span></a></span><span> </span><span class="annot"><span class="annottext">Coercion
</span><span class="hs-identifier">_</span></span><span> </span><span id="local-6989586621681033873"><span class="annot"><span class="annottext">Coercion
</span><a href="#local-6989586621681033873"><span class="hs-identifier hs-var">co2</span></a></span></span><span class="hs-special">)</span><span>          </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">Coercion -&gt; Type
</span><a href="#local-6989586621681033902"><span class="hs-identifier hs-var">go</span></a></span><span> </span><span class="annot"><span class="annottext">Coercion
</span><a href="#local-6989586621681033873"><span class="hs-identifier hs-var">co2</span></a></span><span>
</span><span id="line-2427"></span><span>    </span><span class="annot"><a href="#local-6989586621681033902"><span class="hs-identifier hs-var">go</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="GHC.Core.TyCo.Rep.html#LRCo"><span class="hs-identifier hs-type">LRCo</span></a></span><span> </span><span id="local-6989586621681033872"><span class="annot"><span class="annottext">LeftOrRight
</span><a href="#local-6989586621681033872"><span class="hs-identifier hs-var">lr</span></a></span></span><span> </span><span id="local-6989586621681033871"><span class="annot"><span class="annottext">Coercion
</span><a href="#local-6989586621681033871"><span class="hs-identifier hs-var">co</span></a></span></span><span class="hs-special">)</span><span>             </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">forall a. LeftOrRight -&gt; (a, a) -&gt; a
</span><a href="GHC.Types.Basic.html#pickLR"><span class="hs-identifier hs-var">pickLR</span></a></span><span> </span><span class="annot"><span class="annottext">LeftOrRight
</span><a href="#local-6989586621681033872"><span class="hs-identifier hs-var">lr</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Type -&gt; (Type, Type)
</span><a href="GHC.Core.Type.html#splitAppTy"><span class="hs-identifier hs-var">splitAppTy</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Coercion -&gt; Type
</span><a href="#local-6989586621681033902"><span class="hs-identifier hs-var">go</span></a></span><span> </span><span class="annot"><span class="annottext">Coercion
</span><a href="#local-6989586621681033871"><span class="hs-identifier hs-var">co</span></a></span><span class="hs-special">)</span><span class="hs-special">)</span><span>
</span><span id="line-2428"></span><span>    </span><span class="annot"><a href="#local-6989586621681033902"><span class="hs-identifier hs-var">go</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="GHC.Core.TyCo.Rep.html#InstCo"><span class="hs-identifier hs-type">InstCo</span></a></span><span> </span><span id="local-6989586621681033870"><span class="annot"><span class="annottext">Coercion
</span><a href="#local-6989586621681033870"><span class="hs-identifier hs-var">aco</span></a></span></span><span> </span><span id="local-6989586621681033869"><span class="annot"><span class="annottext">Coercion
</span><a href="#local-6989586621681033869"><span class="hs-identifier hs-var">arg</span></a></span></span><span class="hs-special">)</span><span>         </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">Coercion -&gt; [Type] -&gt; Type
</span><a href="#local-6989586621681033868"><span class="hs-identifier hs-var">go_app</span></a></span><span> </span><span class="annot"><span class="annottext">Coercion
</span><a href="#local-6989586621681033870"><span class="hs-identifier hs-var">aco</span></a></span><span> </span><span class="hs-special">[</span><span class="annot"><span class="annottext">Coercion -&gt; Type
</span><a href="#local-6989586621681033902"><span class="hs-identifier hs-var">go</span></a></span><span> </span><span class="annot"><span class="annottext">Coercion
</span><a href="#local-6989586621681033869"><span class="hs-identifier hs-var">arg</span></a></span><span class="hs-special">]</span><span>
</span><span id="line-2429"></span><span>    </span><span class="annot"><a href="#local-6989586621681033902"><span class="hs-identifier hs-var">go</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="GHC.Core.TyCo.Rep.html#KindCo"><span class="hs-identifier hs-type">KindCo</span></a></span><span> </span><span id="local-6989586621681033867"><span class="annot"><span class="annottext">Coercion
</span><a href="#local-6989586621681033867"><span class="hs-identifier hs-var">co</span></a></span></span><span class="hs-special">)</span><span>              </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">HasDebugCallStack =&gt; Type -&gt; Type
</span><a href="GHC.Core.Type.html#typeKind"><span class="hs-identifier hs-var">typeKind</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Coercion -&gt; Type
</span><a href="#local-6989586621681033902"><span class="hs-identifier hs-var">go</span></a></span><span> </span><span class="annot"><span class="annottext">Coercion
</span><a href="#local-6989586621681033867"><span class="hs-identifier hs-var">co</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-2430"></span><span>    </span><span class="annot"><a href="#local-6989586621681033902"><span class="hs-identifier hs-var">go</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="GHC.Core.TyCo.Rep.html#SubCo"><span class="hs-identifier hs-type">SubCo</span></a></span><span> </span><span id="local-6989586621681033866"><span class="annot"><span class="annottext">Coercion
</span><a href="#local-6989586621681033866"><span class="hs-identifier hs-var">co</span></a></span></span><span class="hs-special">)</span><span>               </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">Coercion -&gt; Type
</span><a href="#local-6989586621681033902"><span class="hs-identifier hs-var">go</span></a></span><span> </span><span class="annot"><span class="annottext">Coercion
</span><a href="#local-6989586621681033866"><span class="hs-identifier hs-var">co</span></a></span><span>
</span><span id="line-2431"></span><span>    </span><span class="annot"><a href="#local-6989586621681033902"><span class="hs-identifier hs-var">go</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="GHC.Core.TyCo.Rep.html#NthCo"><span class="hs-identifier hs-type">NthCo</span></a></span><span> </span><span class="annot"><span class="annottext">Role
</span><span class="hs-identifier">_</span></span><span> </span><span id="local-6989586621681033865"><span class="annot"><span class="annottext">Int
</span><a href="#local-6989586621681033865"><span class="hs-identifier hs-var">d</span></a></span></span><span> </span><span id="local-6989586621681033864"><span class="annot"><span class="annottext">Coercion
</span><a href="#local-6989586621681033864"><span class="hs-identifier hs-var">co</span></a></span></span><span class="hs-special">)</span><span>           </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">Int -&gt; Type -&gt; Type
</span><a href="GHC.Core.Coercion.html#go_nth"><span class="hs-identifier hs-var">go_nth</span></a></span><span> </span><span class="annot"><span class="annottext">Int
</span><a href="#local-6989586621681033865"><span class="hs-identifier hs-var">d</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Coercion -&gt; Type
</span><a href="#local-6989586621681033902"><span class="hs-identifier hs-var">go</span></a></span><span> </span><span class="annot"><span class="annottext">Coercion
</span><a href="#local-6989586621681033864"><span class="hs-identifier hs-var">co</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-2432"></span><span>    </span><span class="annot"><a href="#local-6989586621681033902"><span class="hs-identifier hs-var">go</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="GHC.Core.TyCo.Rep.html#AxiomInstCo"><span class="hs-identifier hs-type">AxiomInstCo</span></a></span><span> </span><span id="local-6989586621681033863"><span class="annot"><span class="annottext">CoAxiom Branched
</span><a href="#local-6989586621681033863"><span class="hs-identifier hs-var">ax</span></a></span></span><span> </span><span id="local-6989586621681033862"><span class="annot"><span class="annottext">Int
</span><a href="#local-6989586621681033862"><span class="hs-identifier hs-var">ind</span></a></span></span><span> </span><span id="local-6989586621681033861"><span class="annot"><span class="annottext">[Coercion]
</span><a href="#local-6989586621681033861"><span class="hs-identifier hs-var">cos</span></a></span></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">forall {br :: BranchFlag}. CoAxiom br -&gt; Int -&gt; [Type] -&gt; Type
</span><a href="#local-6989586621681033860"><span class="hs-identifier hs-var">go_ax_inst</span></a></span><span> </span><span class="annot"><span class="annottext">CoAxiom Branched
</span><a href="#local-6989586621681033863"><span class="hs-identifier hs-var">ax</span></a></span><span> </span><span class="annot"><span class="annottext">Int
</span><a href="#local-6989586621681033862"><span class="hs-identifier hs-var">ind</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">forall a b. (a -&gt; b) -&gt; [a] -&gt; [b]
</span><a href="../../base-4.16.4.0/src/GHC-Base.html#map"><span class="hs-identifier hs-var">map</span></a></span><span> </span><span class="annot"><span class="annottext">Coercion -&gt; Type
</span><a href="#local-6989586621681033902"><span class="hs-identifier hs-var">go</span></a></span><span> </span><span class="annot"><span class="annottext">[Coercion]
</span><a href="#local-6989586621681033861"><span class="hs-identifier hs-var">cos</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-2433"></span><span>    </span><span class="annot"><a href="#local-6989586621681033902"><span class="hs-identifier hs-var">go</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="GHC.Core.TyCo.Rep.html#AxiomRuleCo"><span class="hs-identifier hs-type">AxiomRuleCo</span></a></span><span> </span><span id="local-6989586621681033859"><span class="annot"><span class="annottext">CoAxiomRule
</span><a href="#local-6989586621681033859"><span class="hs-identifier hs-var">ax</span></a></span></span><span> </span><span id="local-6989586621681033858"><span class="annot"><span class="annottext">[Coercion]
</span><a href="#local-6989586621681033858"><span class="hs-identifier hs-var">cos</span></a></span></span><span class="hs-special">)</span><span>     </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">forall a. Pair a -&gt; a
</span><a href="GHC.Data.Pair.html#pSnd"><span class="hs-identifier hs-var">pSnd</span></a></span><span> </span><span class="annot"><span class="annottext">forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><a href="../../base-4.16.4.0/src/GHC-Base.html#%24"><span class="hs-operator hs-var">$</span></a></span><span> </span><span class="annot"><span class="annottext">forall a. HasCallStack =&gt; String -&gt; Maybe a -&gt; a
</span><a href="GHC.Data.Maybe.html#expectJust"><span class="hs-identifier hs-var">expectJust</span></a></span><span> </span><span class="annot"><span class="annottext">String
</span><span class="hs-string">&quot;coercionKind&quot;</span></span><span> </span><span class="annot"><span class="annottext">forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><a href="../../base-4.16.4.0/src/GHC-Base.html#%24"><span class="hs-operator hs-var">$</span></a></span><span>
</span><span id="line-2434"></span><span>                                  </span><span class="annot"><span class="annottext">CoAxiomRule -&gt; [Pair Type] -&gt; Maybe (Pair Type)
</span><a href="GHC.Core.Coercion.Axiom.html#coaxrProves"><span class="hs-identifier hs-var">coaxrProves</span></a></span><span> </span><span class="annot"><span class="annottext">CoAxiomRule
</span><a href="#local-6989586621681033859"><span class="hs-identifier hs-var">ax</span></a></span><span> </span><span class="annot"><span class="annottext">forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><a href="../../base-4.16.4.0/src/GHC-Base.html#%24"><span class="hs-operator hs-var">$</span></a></span><span> </span><span class="annot"><span class="annottext">forall a b. (a -&gt; b) -&gt; [a] -&gt; [b]
</span><a href="../../base-4.16.4.0/src/GHC-Base.html#map"><span class="hs-identifier hs-var">map</span></a></span><span> </span><span class="annot"><span class="annottext">Coercion -&gt; Pair Type
</span><a href="GHC.Core.Coercion.html#coercionKind"><span class="hs-identifier hs-var">coercionKind</span></a></span><span> </span><span class="annot"><span class="annottext">[Coercion]
</span><a href="#local-6989586621681033858"><span class="hs-identifier hs-var">cos</span></a></span><span>
</span><span id="line-2435"></span><span>
</span><span id="line-2436"></span><span>    </span><span class="annot"><a href="#local-6989586621681033902"><span class="hs-identifier hs-var">go</span></a></span><span> </span><span id="local-6989586621681033857"><span class="annot"><span class="annottext">co :: Coercion
</span><a href="#local-6989586621681033857"><span class="hs-identifier hs-var">co</span></a></span></span><span class="hs-glyph">@</span><span class="hs-special">(</span><span class="annot"><a href="GHC.Core.TyCo.Rep.html#ForAllCo"><span class="hs-identifier hs-type">ForAllCo</span></a></span><span> </span><span id="local-6989586621681033856"><span class="annot"><span class="annottext">CoVar
</span><a href="#local-6989586621681033856"><span class="hs-identifier hs-var">tv1</span></a></span></span><span> </span><span id="local-6989586621681033855"><span class="annot"><span class="annottext">Coercion
</span><a href="#local-6989586621681033855"><span class="hs-identifier hs-var">k_co</span></a></span></span><span> </span><span id="local-6989586621681033854"><span class="annot"><span class="annottext">Coercion
</span><a href="#local-6989586621681033854"><span class="hs-identifier hs-var">co1</span></a></span></span><span class="hs-special">)</span><span> </span><span class="hs-comment">-- works for both tyvar and covar</span><span>
</span><span id="line-2437"></span><span>       </span><span class="hs-glyph">|</span><span> </span><span class="annot"><span class="annottext">Coercion -&gt; Bool
</span><a href="GHC.Core.Coercion.html#isGReflCo"><span class="hs-identifier hs-var">isGReflCo</span></a></span><span> </span><span class="annot"><span class="annottext">Coercion
</span><a href="#local-6989586621681033855"><span class="hs-identifier hs-var">k_co</span></a></span><span>           </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">CoVar -&gt; Type -&gt; Type
</span><a href="GHC.Core.Type.html#mkTyCoInvForAllTy"><span class="hs-identifier hs-var">mkTyCoInvForAllTy</span></a></span><span> </span><span class="annot"><span class="annottext">CoVar
</span><a href="#local-6989586621681033856"><span class="hs-identifier hs-var">tv1</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Coercion -&gt; Type
</span><a href="#local-6989586621681033902"><span class="hs-identifier hs-var">go</span></a></span><span> </span><span class="annot"><span class="annottext">Coercion
</span><a href="#local-6989586621681033854"><span class="hs-identifier hs-var">co1</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-2438"></span><span>         </span><span class="hs-comment">-- kind_co always has kind @Type@, thus @isGReflCo@</span><span>
</span><span id="line-2439"></span><span>       </span><span class="hs-glyph">|</span><span> </span><span class="annot"><span class="annottext">Bool
</span><a href="../../base-4.16.4.0/src/GHC-Base.html#otherwise"><span class="hs-identifier hs-var">otherwise</span></a></span><span>                </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">TCvSubst -&gt; Coercion -&gt; Type
</span><a href="#local-6989586621681033853"><span class="hs-identifier hs-var">go_forall</span></a></span><span> </span><span class="annot"><span class="annottext">TCvSubst
</span><a href="#local-6989586621681033852"><span class="hs-identifier hs-var">empty_subst</span></a></span><span> </span><span class="annot"><span class="annottext">Coercion
</span><a href="#local-6989586621681033857"><span class="hs-identifier hs-var">co</span></a></span><span>
</span><span id="line-2440"></span><span>       </span><span class="hs-keyword">where</span><span>
</span><span id="line-2441"></span><span>         </span><span id="local-6989586621681033852"><span class="annot"><span class="annottext">empty_subst :: TCvSubst
</span><a href="#local-6989586621681033852"><span class="hs-identifier hs-var hs-var">empty_subst</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">InScopeSet -&gt; TCvSubst
</span><a href="GHC.Core.TyCo.Subst.html#mkEmptyTCvSubst"><span class="hs-identifier hs-var">mkEmptyTCvSubst</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">VarSet -&gt; InScopeSet
</span><a href="GHC.Types.Var.Env.html#mkInScopeSet"><span class="hs-identifier hs-var">mkInScopeSet</span></a></span><span> </span><span class="annot"><span class="annottext">forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><a href="../../base-4.16.4.0/src/GHC-Base.html#%24"><span class="hs-operator hs-var">$</span></a></span><span> </span><span class="annot"><span class="annottext">Coercion -&gt; VarSet
</span><a href="GHC.Core.TyCo.FVs.html#tyCoVarsOfCo"><span class="hs-identifier hs-var">tyCoVarsOfCo</span></a></span><span> </span><span class="annot"><span class="annottext">Coercion
</span><a href="#local-6989586621681033857"><span class="hs-identifier hs-var">co</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-2442"></span><span>
</span><span id="line-2443"></span><span>    </span><span id="local-6989586621681033860"><span class="annot"><span class="annottext">go_ax_inst :: CoAxiom br -&gt; Int -&gt; [Type] -&gt; Type
</span><a href="#local-6989586621681033860"><span class="hs-identifier hs-var hs-var">go_ax_inst</span></a></span></span><span> </span><span id="local-6989586621681033849"><span class="annot"><span class="annottext">CoAxiom br
</span><a href="#local-6989586621681033849"><span class="hs-identifier hs-var">ax</span></a></span></span><span> </span><span id="local-6989586621681033848"><span class="annot"><span class="annottext">Int
</span><a href="#local-6989586621681033848"><span class="hs-identifier hs-var">ind</span></a></span></span><span> </span><span id="local-6989586621681033847"><span class="annot"><span class="annottext">[Type]
</span><a href="#local-6989586621681033847"><span class="hs-identifier hs-var">tys</span></a></span></span><span>
</span><span id="line-2444"></span><span>      </span><span class="hs-glyph">|</span><span> </span><span class="annot"><a href="GHC.Core.Coercion.Axiom.html#CoAxBranch"><span class="hs-identifier hs-type">CoAxBranch</span></a></span><span> </span><span class="hs-special">{</span><span> </span><span class="annot"><span class="annottext">cab_tvs :: CoAxBranch -&gt; [CoVar]
</span><a href="GHC.Core.Coercion.Axiom.html#cab_tvs"><span class="hs-identifier hs-var">cab_tvs</span></a></span><span> </span><span class="hs-glyph">=</span><span> </span><span id="local-6989586621681033846"><span class="annot"><span class="annottext">[CoVar]
</span><a href="#local-6989586621681033846"><span class="hs-identifier hs-var">tvs</span></a></span></span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">cab_cvs :: CoAxBranch -&gt; [CoVar]
</span><a href="GHC.Core.Coercion.Axiom.html#cab_cvs"><span class="hs-identifier hs-var">cab_cvs</span></a></span><span> </span><span class="hs-glyph">=</span><span> </span><span id="local-6989586621681033845"><span class="annot"><span class="annottext">[CoVar]
</span><a href="#local-6989586621681033845"><span class="hs-identifier hs-var">cvs</span></a></span></span><span>
</span><span id="line-2445"></span><span>                   </span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">cab_rhs :: CoAxBranch -&gt; Type
</span><a href="GHC.Core.Coercion.Axiom.html#cab_rhs"><span class="hs-identifier hs-var">cab_rhs</span></a></span><span> </span><span class="hs-glyph">=</span><span> </span><span id="local-6989586621681033844"><span class="annot"><span class="annottext">Type
</span><a href="#local-6989586621681033844"><span class="hs-identifier hs-var">rhs</span></a></span></span><span> </span><span class="hs-special">}</span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">forall (br :: BranchFlag). CoAxiom br -&gt; Int -&gt; CoAxBranch
</span><a href="GHC.Core.Coercion.Axiom.html#coAxiomNthBranch"><span class="hs-identifier hs-var">coAxiomNthBranch</span></a></span><span> </span><span class="annot"><span class="annottext">CoAxiom br
</span><a href="#local-6989586621681033849"><span class="hs-identifier hs-var">ax</span></a></span><span> </span><span class="annot"><span class="annottext">Int
</span><a href="#local-6989586621681033848"><span class="hs-identifier hs-var">ind</span></a></span><span>
</span><span id="line-2446"></span><span>      </span><span class="hs-special">,</span><span> </span><span class="hs-keyword">let</span><span> </span><span class="hs-special">(</span><span id="local-6989586621681033843"><span class="annot"><span class="annottext">[Type]
</span><a href="#local-6989586621681033843"><span class="hs-identifier hs-var">tys2</span></a></span></span><span class="hs-special">,</span><span> </span><span id="local-6989586621681033842"><span class="annot"><span class="annottext">[Type]
</span><a href="#local-6989586621681033842"><span class="hs-identifier hs-var">cotys2</span></a></span></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">forall b a. [b] -&gt; [a] -&gt; ([a], [a])
</span><a href="GHC.Utils.Misc.html#splitAtList"><span class="hs-identifier hs-var">splitAtList</span></a></span><span> </span><span class="annot"><span class="annottext">[CoVar]
</span><a href="#local-6989586621681033846"><span class="hs-identifier hs-var">tvs</span></a></span><span> </span><span class="annot"><span class="annottext">[Type]
</span><a href="#local-6989586621681033847"><span class="hs-identifier hs-var">tys</span></a></span><span>
</span><span id="line-2447"></span><span>            </span><span id="local-6989586621681033841"><span class="annot"><span class="annottext">cos2 :: [Coercion]
</span><a href="#local-6989586621681033841"><span class="hs-identifier hs-var hs-var">cos2</span></a></span></span><span>           </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">forall a b. (a -&gt; b) -&gt; [a] -&gt; [b]
</span><a href="../../base-4.16.4.0/src/GHC-Base.html#map"><span class="hs-identifier hs-var">map</span></a></span><span> </span><span class="annot"><span class="annottext">Type -&gt; Coercion
</span><a href="GHC.Core.Type.html#stripCoercionTy"><span class="hs-identifier hs-var">stripCoercionTy</span></a></span><span> </span><span class="annot"><span class="annottext">[Type]
</span><a href="#local-6989586621681033842"><span class="hs-identifier hs-var">cotys2</span></a></span><span>
</span><span id="line-2448"></span><span>      </span><span class="hs-glyph">=</span><span> </span><span class="hs-identifier">ASSERT</span><span class="hs-special">(</span><span> </span><span class="hs-identifier">tys</span><span> </span><span class="hs-special">`</span><span class="hs-identifier">equalLength</span><span class="hs-special">`</span><span> </span><span class="hs-special">(</span><span class="hs-identifier">tvs</span><span> </span><span class="hs-operator">++</span><span> </span><span class="hs-identifier">cvs</span><span class="hs-special">)</span><span> </span><span class="hs-special">)</span><span>
</span><span id="line-2449"></span><span>                  </span><span class="hs-comment">-- Invariant of AxiomInstCo: cos should</span><span>
</span><span id="line-2450"></span><span>                  </span><span class="hs-comment">-- exactly saturate the axiom branch</span><span>
</span><span id="line-2451"></span><span>        </span><span class="annot"><span class="annottext">HasCallStack =&gt; [CoVar] -&gt; [Type] -&gt; Type -&gt; Type
</span><a href="GHC.Core.TyCo.Subst.html#substTyWith"><span class="hs-identifier hs-var">substTyWith</span></a></span><span> </span><span class="annot"><span class="annottext">[CoVar]
</span><a href="#local-6989586621681033846"><span class="hs-identifier hs-var">tvs</span></a></span><span> </span><span class="annot"><span class="annottext">[Type]
</span><a href="#local-6989586621681033843"><span class="hs-identifier hs-var">tys2</span></a></span><span> </span><span class="annot"><span class="annottext">forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><a href="../../base-4.16.4.0/src/GHC-Base.html#%24"><span class="hs-operator hs-var">$</span></a></span><span>
</span><span id="line-2452"></span><span>        </span><span class="annot"><span class="annottext">[CoVar] -&gt; [Coercion] -&gt; Type -&gt; Type
</span><a href="GHC.Core.TyCo.Subst.html#substTyWithCoVars"><span class="hs-identifier hs-var">substTyWithCoVars</span></a></span><span> </span><span class="annot"><span class="annottext">[CoVar]
</span><a href="#local-6989586621681033845"><span class="hs-identifier hs-var">cvs</span></a></span><span> </span><span class="annot"><span class="annottext">[Coercion]
</span><a href="#local-6989586621681033841"><span class="hs-identifier hs-var">cos2</span></a></span><span> </span><span class="annot"><span class="annottext">Type
</span><a href="#local-6989586621681033844"><span class="hs-identifier hs-var">rhs</span></a></span><span>
</span><span id="line-2453"></span><span>
</span><span id="line-2454"></span><span>    </span><span class="annot"><a href="#local-6989586621681033868"><span class="hs-identifier hs-type">go_app</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><a href="GHC.Core.TyCo.Rep.html#Coercion"><span class="hs-identifier hs-type">Coercion</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-special">[</span><span class="annot"><a href="GHC.Core.TyCo.Rep.html#Type"><span class="hs-identifier hs-type">Type</span></a></span><span class="hs-special">]</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="GHC.Core.TyCo.Rep.html#Type"><span class="hs-identifier hs-type">Type</span></a></span><span>
</span><span id="line-2455"></span><span>    </span><span class="hs-comment">-- Collect up all the arguments and apply all at once</span><span>
</span><span id="line-2456"></span><span>    </span><span class="hs-comment">-- See Note [Nested InstCos]</span><span>
</span><span id="line-2457"></span><span>    </span><span id="local-6989586621681033868"><span class="annot"><span class="annottext">go_app :: Coercion -&gt; [Type] -&gt; Type
</span><a href="#local-6989586621681033868"><span class="hs-identifier hs-var hs-var">go_app</span></a></span></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="GHC.Core.TyCo.Rep.html#InstCo"><span class="hs-identifier hs-type">InstCo</span></a></span><span> </span><span id="local-6989586621681033840"><span class="annot"><span class="annottext">Coercion
</span><a href="#local-6989586621681033840"><span class="hs-identifier hs-var">co</span></a></span></span><span> </span><span id="local-6989586621681033839"><span class="annot"><span class="annottext">Coercion
</span><a href="#local-6989586621681033839"><span class="hs-identifier hs-var">arg</span></a></span></span><span class="hs-special">)</span><span> </span><span id="local-6989586621681033838"><span class="annot"><span class="annottext">[Type]
</span><a href="#local-6989586621681033838"><span class="hs-identifier hs-var">args</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">Coercion -&gt; [Type] -&gt; Type
</span><a href="#local-6989586621681033868"><span class="hs-identifier hs-var">go_app</span></a></span><span> </span><span class="annot"><span class="annottext">Coercion
</span><a href="#local-6989586621681033840"><span class="hs-identifier hs-var">co</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Coercion -&gt; Type
</span><a href="#local-6989586621681033902"><span class="hs-identifier hs-var">go</span></a></span><span> </span><span class="annot"><span class="annottext">Coercion
</span><a href="#local-6989586621681033839"><span class="hs-identifier hs-var">arg</span></a></span><span class="annot"><span class="annottext">forall a. a -&gt; [a] -&gt; [a]
</span><span class="hs-glyph hs-var">:</span></span><span class="annot"><span class="annottext">[Type]
</span><a href="#local-6989586621681033838"><span class="hs-identifier hs-var">args</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-2458"></span><span>    </span><span class="annot"><a href="#local-6989586621681033868"><span class="hs-identifier hs-var">go_app</span></a></span><span> </span><span id="local-6989586621681033837"><span class="annot"><span class="annottext">Coercion
</span><a href="#local-6989586621681033837"><span class="hs-identifier hs-var">co</span></a></span></span><span>              </span><span id="local-6989586621681033836"><span class="annot"><span class="annottext">[Type]
</span><a href="#local-6989586621681033836"><span class="hs-identifier hs-var">args</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">HasDebugCallStack =&gt; Type -&gt; [Type] -&gt; Type
</span><a href="GHC.Core.Type.html#piResultTys"><span class="hs-identifier hs-var">piResultTys</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Coercion -&gt; Type
</span><a href="#local-6989586621681033902"><span class="hs-identifier hs-var">go</span></a></span><span> </span><span class="annot"><span class="annottext">Coercion
</span><a href="#local-6989586621681033837"><span class="hs-identifier hs-var">co</span></a></span><span class="hs-special">)</span><span> </span><span class="annot"><span class="annottext">[Type]
</span><a href="#local-6989586621681033836"><span class="hs-identifier hs-var">args</span></a></span><span>
</span><span id="line-2459"></span><span>
</span><span id="line-2460"></span><span>    </span><span id="local-6989586621681033853"><span class="annot"><span class="annottext">go_forall :: TCvSubst -&gt; Coercion -&gt; Type
</span><a href="#local-6989586621681033853"><span class="hs-identifier hs-var hs-var">go_forall</span></a></span></span><span> </span><span id="local-6989586621681033835"><span class="annot"><span class="annottext">TCvSubst
</span><a href="#local-6989586621681033835"><span class="hs-identifier hs-var">subst</span></a></span></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="GHC.Core.TyCo.Rep.html#ForAllCo"><span class="hs-identifier hs-type">ForAllCo</span></a></span><span> </span><span id="local-6989586621681033834"><span class="annot"><span class="annottext">CoVar
</span><a href="#local-6989586621681033834"><span class="hs-identifier hs-var">tv1</span></a></span></span><span> </span><span id="local-6989586621681033833"><span class="annot"><span class="annottext">Coercion
</span><a href="#local-6989586621681033833"><span class="hs-identifier hs-var">k_co</span></a></span></span><span> </span><span id="local-6989586621681033832"><span class="annot"><span class="annottext">Coercion
</span><a href="#local-6989586621681033832"><span class="hs-identifier hs-var">co</span></a></span></span><span class="hs-special">)</span><span>
</span><span id="line-2461"></span><span>      </span><span class="hs-comment">-- See Note [Nested ForAllCos]</span><span>
</span><span id="line-2462"></span><span>      </span><span class="hs-glyph">|</span><span> </span><span class="annot"><span class="annottext">CoVar -&gt; Bool
</span><a href="GHC.Types.Var.html#isTyVar"><span class="hs-identifier hs-var">isTyVar</span></a></span><span> </span><span class="annot"><span class="annottext">CoVar
</span><a href="#local-6989586621681033834"><span class="hs-identifier hs-var">tv1</span></a></span><span>
</span><span id="line-2463"></span><span>      </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">CoVar -&gt; Type -&gt; Type
</span><a href="GHC.Core.Type.html#mkInfForAllTy"><span class="hs-identifier hs-var">mkInfForAllTy</span></a></span><span> </span><span class="annot"><span class="annottext">CoVar
</span><a href="#local-6989586621681033830"><span class="hs-identifier hs-var">tv2</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">TCvSubst -&gt; Coercion -&gt; Type
</span><a href="#local-6989586621681033853"><span class="hs-identifier hs-var">go_forall</span></a></span><span> </span><span class="annot"><span class="annottext">TCvSubst
</span><a href="#local-6989586621681033829"><span class="hs-identifier hs-var">subst'</span></a></span><span> </span><span class="annot"><span class="annottext">Coercion
</span><a href="#local-6989586621681033832"><span class="hs-identifier hs-var">co</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-2464"></span><span>      </span><span class="hs-keyword">where</span><span>
</span><span id="line-2465"></span><span>        </span><span id="local-6989586621681033828"><span class="annot"><span class="annottext">k2 :: Type
</span><a href="#local-6989586621681033828"><span class="hs-identifier hs-var hs-var">k2</span></a></span></span><span>  </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">Coercion -&gt; Type
</span><a href="GHC.Core.Coercion.html#coercionRKind"><span class="hs-identifier hs-var">coercionRKind</span></a></span><span> </span><span class="annot"><span class="annottext">Coercion
</span><a href="#local-6989586621681033833"><span class="hs-identifier hs-var">k_co</span></a></span><span>
</span><span id="line-2466"></span><span>        </span><span id="local-6989586621681033830"><span class="annot"><span class="annottext">tv2 :: CoVar
</span><a href="#local-6989586621681033830"><span class="hs-identifier hs-var hs-var">tv2</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">CoVar -&gt; Type -&gt; CoVar
</span><a href="GHC.Types.Var.html#setTyVarKind"><span class="hs-identifier hs-var">setTyVarKind</span></a></span><span> </span><span class="annot"><span class="annottext">CoVar
</span><a href="#local-6989586621681033834"><span class="hs-identifier hs-var">tv1</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">HasCallStack =&gt; TCvSubst -&gt; Type -&gt; Type
</span><a href="GHC.Core.TyCo.Subst.html#substTy"><span class="hs-identifier hs-var">substTy</span></a></span><span> </span><span class="annot"><span class="annottext">TCvSubst
</span><a href="#local-6989586621681033835"><span class="hs-identifier hs-var">subst</span></a></span><span> </span><span class="annot"><span class="annottext">Type
</span><a href="#local-6989586621681033828"><span class="hs-identifier hs-var">k2</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-2467"></span><span>        </span><span id="local-6989586621681033829"><span class="annot"><span class="annottext">subst' :: TCvSubst
</span><a href="#local-6989586621681033829"><span class="hs-identifier hs-var hs-var">subst'</span></a></span></span><span> </span><span class="hs-glyph">|</span><span> </span><span class="annot"><span class="annottext">Coercion -&gt; Bool
</span><a href="GHC.Core.Coercion.html#isGReflCo"><span class="hs-identifier hs-var">isGReflCo</span></a></span><span> </span><span class="annot"><span class="annottext">Coercion
</span><a href="#local-6989586621681033833"><span class="hs-identifier hs-var">k_co</span></a></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">TCvSubst -&gt; CoVar -&gt; TCvSubst
</span><a href="GHC.Core.TyCo.Subst.html#extendTCvInScope"><span class="hs-identifier hs-var">extendTCvInScope</span></a></span><span> </span><span class="annot"><span class="annottext">TCvSubst
</span><a href="#local-6989586621681033835"><span class="hs-identifier hs-var">subst</span></a></span><span> </span><span class="annot"><span class="annottext">CoVar
</span><a href="#local-6989586621681033834"><span class="hs-identifier hs-var">tv1</span></a></span><span>
</span><span id="line-2468"></span><span>                 </span><span class="hs-comment">-- kind_co always has kind @Type@, thus @isGReflCo@</span><span>
</span><span id="line-2469"></span><span>               </span><span class="hs-glyph">|</span><span> </span><span class="annot"><span class="annottext">Bool
</span><a href="../../base-4.16.4.0/src/GHC-Base.html#otherwise"><span class="hs-identifier hs-var">otherwise</span></a></span><span>      </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">TCvSubst -&gt; CoVar -&gt; Type -&gt; TCvSubst
</span><a href="GHC.Core.TyCo.Subst.html#extendTvSubst"><span class="hs-identifier hs-var">extendTvSubst</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">TCvSubst -&gt; CoVar -&gt; TCvSubst
</span><a href="GHC.Core.TyCo.Subst.html#extendTCvInScope"><span class="hs-identifier hs-var">extendTCvInScope</span></a></span><span> </span><span class="annot"><span class="annottext">TCvSubst
</span><a href="#local-6989586621681033835"><span class="hs-identifier hs-var">subst</span></a></span><span> </span><span class="annot"><span class="annottext">CoVar
</span><a href="#local-6989586621681033830"><span class="hs-identifier hs-var">tv2</span></a></span><span class="hs-special">)</span><span> </span><span class="annot"><span class="annottext">CoVar
</span><a href="#local-6989586621681033834"><span class="hs-identifier hs-var">tv1</span></a></span><span> </span><span class="annot"><span class="annottext">forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><a href="../../base-4.16.4.0/src/GHC-Base.html#%24"><span class="hs-operator hs-var">$</span></a></span><span>
</span><span id="line-2470"></span><span>                                  </span><span class="annot"><span class="annottext">CoVar -&gt; Type
</span><a href="GHC.Core.TyCo.Rep.html#TyVarTy"><span class="hs-identifier hs-var">TyVarTy</span></a></span><span> </span><span class="annot"><span class="annottext">CoVar
</span><a href="#local-6989586621681033830"><span class="hs-identifier hs-var">tv2</span></a></span><span> </span><span class="annot"><span class="annottext">Type -&gt; Coercion -&gt; Type
</span><a href="GHC.Core.Type.html#mkCastTy"><span class="hs-operator hs-var">`mkCastTy`</span></a></span><span> </span><span class="annot"><span class="annottext">Coercion -&gt; Coercion
</span><a href="GHC.Core.Coercion.html#mkSymCo"><span class="hs-identifier hs-var">mkSymCo</span></a></span><span> </span><span class="annot"><span class="annottext">Coercion
</span><a href="#local-6989586621681033833"><span class="hs-identifier hs-var">k_co</span></a></span><span>
</span><span id="line-2471"></span><span>
</span><span id="line-2472"></span><span>    </span><span class="annot"><a href="#local-6989586621681033853"><span class="hs-identifier hs-var">go_forall</span></a></span><span> </span><span id="local-6989586621681033825"><span class="annot"><span class="annottext">TCvSubst
</span><a href="#local-6989586621681033825"><span class="hs-identifier hs-var">subst</span></a></span></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="GHC.Core.TyCo.Rep.html#ForAllCo"><span class="hs-identifier hs-type">ForAllCo</span></a></span><span> </span><span id="local-6989586621681033824"><span class="annot"><span class="annottext">CoVar
</span><a href="#local-6989586621681033824"><span class="hs-identifier hs-var">cv1</span></a></span></span><span> </span><span id="local-6989586621681033823"><span class="annot"><span class="annottext">Coercion
</span><a href="#local-6989586621681033823"><span class="hs-identifier hs-var">k_co</span></a></span></span><span> </span><span id="local-6989586621681033822"><span class="annot"><span class="annottext">Coercion
</span><a href="#local-6989586621681033822"><span class="hs-identifier hs-var">co</span></a></span></span><span class="hs-special">)</span><span>
</span><span id="line-2473"></span><span>      </span><span class="hs-glyph">|</span><span> </span><span class="annot"><span class="annottext">CoVar -&gt; Bool
</span><a href="GHC.Types.Var.html#isCoVar"><span class="hs-identifier hs-var">isCoVar</span></a></span><span> </span><span class="annot"><span class="annottext">CoVar
</span><a href="#local-6989586621681033824"><span class="hs-identifier hs-var">cv1</span></a></span><span>
</span><span id="line-2474"></span><span>      </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">CoVar -&gt; Type -&gt; Type
</span><a href="GHC.Core.Type.html#mkTyCoInvForAllTy"><span class="hs-identifier hs-var">mkTyCoInvForAllTy</span></a></span><span> </span><span class="annot"><span class="annottext">CoVar
</span><a href="#local-6989586621681033821"><span class="hs-identifier hs-var">cv2</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">TCvSubst -&gt; Coercion -&gt; Type
</span><a href="#local-6989586621681033853"><span class="hs-identifier hs-var">go_forall</span></a></span><span> </span><span class="annot"><span class="annottext">TCvSubst
</span><a href="#local-6989586621681033820"><span class="hs-identifier hs-var">subst'</span></a></span><span> </span><span class="annot"><span class="annottext">Coercion
</span><a href="#local-6989586621681033822"><span class="hs-identifier hs-var">co</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-2475"></span><span>      </span><span class="hs-keyword">where</span><span>
</span><span id="line-2476"></span><span>        </span><span id="local-6989586621681033819"><span class="annot"><span class="annottext">k2 :: Type
</span><a href="#local-6989586621681033819"><span class="hs-identifier hs-var hs-var">k2</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">Coercion -&gt; Type
</span><a href="GHC.Core.Coercion.html#coercionRKind"><span class="hs-identifier hs-var">coercionRKind</span></a></span><span> </span><span class="annot"><span class="annottext">Coercion
</span><a href="#local-6989586621681033823"><span class="hs-identifier hs-var">k_co</span></a></span><span>
</span><span id="line-2477"></span><span>        </span><span id="local-6989586621681033818"><span class="annot"><span class="annottext">r :: Role
</span><a href="#local-6989586621681033818"><span class="hs-identifier hs-var hs-var">r</span></a></span></span><span>         </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">CoVar -&gt; Role
</span><a href="GHC.Core.Coercion.html#coVarRole"><span class="hs-identifier hs-var">coVarRole</span></a></span><span> </span><span class="annot"><span class="annottext">CoVar
</span><a href="#local-6989586621681033824"><span class="hs-identifier hs-var">cv1</span></a></span><span>
</span><span id="line-2478"></span><span>        </span><span id="local-6989586621681033817"><span class="annot"><span class="annottext">eta1 :: Coercion
</span><a href="#local-6989586621681033817"><span class="hs-identifier hs-var hs-var">eta1</span></a></span></span><span>      </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">HasDebugCallStack =&gt; Role -&gt; Int -&gt; Coercion -&gt; Coercion
</span><a href="GHC.Core.Coercion.html#mkNthCo"><span class="hs-identifier hs-var">mkNthCo</span></a></span><span> </span><span class="annot"><span class="annottext">Role
</span><a href="#local-6989586621681033818"><span class="hs-identifier hs-var">r</span></a></span><span> </span><span class="annot"><span class="annottext">Int
</span><span class="hs-number">2</span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Role -&gt; Role -&gt; Coercion -&gt; Coercion
</span><a href="GHC.Core.Coercion.html#downgradeRole"><span class="hs-identifier hs-var">downgradeRole</span></a></span><span> </span><span class="annot"><span class="annottext">Role
</span><a href="#local-6989586621681033818"><span class="hs-identifier hs-var">r</span></a></span><span> </span><span class="annot"><span class="annottext">Role
</span><a href="GHC.Core.Coercion.Axiom.html#Nominal"><span class="hs-identifier hs-var">Nominal</span></a></span><span> </span><span class="annot"><span class="annottext">Coercion
</span><a href="#local-6989586621681033823"><span class="hs-identifier hs-var">k_co</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-2479"></span><span>        </span><span id="local-6989586621681033816"><span class="annot"><span class="annottext">eta2 :: Coercion
</span><a href="#local-6989586621681033816"><span class="hs-identifier hs-var hs-var">eta2</span></a></span></span><span>      </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">HasDebugCallStack =&gt; Role -&gt; Int -&gt; Coercion -&gt; Coercion
</span><a href="GHC.Core.Coercion.html#mkNthCo"><span class="hs-identifier hs-var">mkNthCo</span></a></span><span> </span><span class="annot"><span class="annottext">Role
</span><a href="#local-6989586621681033818"><span class="hs-identifier hs-var">r</span></a></span><span> </span><span class="annot"><span class="annottext">Int
</span><span class="hs-number">3</span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Role -&gt; Role -&gt; Coercion -&gt; Coercion
</span><a href="GHC.Core.Coercion.html#downgradeRole"><span class="hs-identifier hs-var">downgradeRole</span></a></span><span> </span><span class="annot"><span class="annottext">Role
</span><a href="#local-6989586621681033818"><span class="hs-identifier hs-var">r</span></a></span><span> </span><span class="annot"><span class="annottext">Role
</span><a href="GHC.Core.Coercion.Axiom.html#Nominal"><span class="hs-identifier hs-var">Nominal</span></a></span><span> </span><span class="annot"><span class="annottext">Coercion
</span><a href="#local-6989586621681033823"><span class="hs-identifier hs-var">k_co</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-2480"></span><span>
</span><span id="line-2481"></span><span>        </span><span class="hs-comment">-- k_co :: (t1 ~r t2) ~N (s1 ~r s2)</span><span>
</span><span id="line-2482"></span><span>        </span><span class="hs-comment">-- k1    = t1 ~r t2</span><span>
</span><span id="line-2483"></span><span>        </span><span class="hs-comment">-- k2    = s1 ~r s2</span><span>
</span><span id="line-2484"></span><span>        </span><span class="hs-comment">-- cv1  :: t1 ~r t2</span><span>
</span><span id="line-2485"></span><span>        </span><span class="hs-comment">-- cv2  :: s1 ~r s2</span><span>
</span><span id="line-2486"></span><span>        </span><span class="hs-comment">-- eta1 :: t1 ~r s1</span><span>
</span><span id="line-2487"></span><span>        </span><span class="hs-comment">-- eta2 :: t2 ~r s2</span><span>
</span><span id="line-2488"></span><span>        </span><span class="hs-comment">-- n_subst  = (eta1 ; cv2 ; sym eta2) :: t1 ~r t2</span><span>
</span><span id="line-2489"></span><span>
</span><span id="line-2490"></span><span>        </span><span id="local-6989586621681033821"><span class="annot"><span class="annottext">cv2 :: CoVar
</span><a href="#local-6989586621681033821"><span class="hs-identifier hs-var hs-var">cv2</span></a></span></span><span>     </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">CoVar -&gt; Type -&gt; CoVar
</span><a href="GHC.Types.Var.html#setVarType"><span class="hs-identifier hs-var">setVarType</span></a></span><span> </span><span class="annot"><span class="annottext">CoVar
</span><a href="#local-6989586621681033824"><span class="hs-identifier hs-var">cv1</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">HasCallStack =&gt; TCvSubst -&gt; Type -&gt; Type
</span><a href="GHC.Core.TyCo.Subst.html#substTy"><span class="hs-identifier hs-var">substTy</span></a></span><span> </span><span class="annot"><span class="annottext">TCvSubst
</span><a href="#local-6989586621681033825"><span class="hs-identifier hs-var">subst</span></a></span><span> </span><span class="annot"><span class="annottext">Type
</span><a href="#local-6989586621681033819"><span class="hs-identifier hs-var">k2</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-2491"></span><span>        </span><span id="local-6989586621681033815"><span class="annot"><span class="annottext">n_subst :: Coercion
</span><a href="#local-6989586621681033815"><span class="hs-identifier hs-var hs-var">n_subst</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">Coercion
</span><a href="#local-6989586621681033817"><span class="hs-identifier hs-var">eta1</span></a></span><span> </span><span class="annot"><span class="annottext">Coercion -&gt; Coercion -&gt; Coercion
</span><a href="GHC.Core.Coercion.html#mkTransCo"><span class="hs-operator hs-var">`mkTransCo`</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">CoVar -&gt; Coercion
</span><a href="GHC.Core.Coercion.html#mkCoVarCo"><span class="hs-identifier hs-var">mkCoVarCo</span></a></span><span> </span><span class="annot"><span class="annottext">CoVar
</span><a href="#local-6989586621681033821"><span class="hs-identifier hs-var">cv2</span></a></span><span class="hs-special">)</span><span> </span><span class="annot"><span class="annottext">Coercion -&gt; Coercion -&gt; Coercion
</span><a href="GHC.Core.Coercion.html#mkTransCo"><span class="hs-operator hs-var">`mkTransCo`</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Coercion -&gt; Coercion
</span><a href="GHC.Core.Coercion.html#mkSymCo"><span class="hs-identifier hs-var">mkSymCo</span></a></span><span> </span><span class="annot"><span class="annottext">Coercion
</span><a href="#local-6989586621681033816"><span class="hs-identifier hs-var">eta2</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-2492"></span><span>        </span><span id="local-6989586621681033820"><span class="annot"><span class="annottext">subst' :: TCvSubst
</span><a href="#local-6989586621681033820"><span class="hs-identifier hs-var hs-var">subst'</span></a></span></span><span>  </span><span class="hs-glyph">|</span><span> </span><span class="annot"><span class="annottext">Coercion -&gt; Bool
</span><a href="GHC.Core.Coercion.html#isReflCo"><span class="hs-identifier hs-var">isReflCo</span></a></span><span> </span><span class="annot"><span class="annottext">Coercion
</span><a href="#local-6989586621681033823"><span class="hs-identifier hs-var">k_co</span></a></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">TCvSubst -&gt; CoVar -&gt; TCvSubst
</span><a href="GHC.Core.TyCo.Subst.html#extendTCvInScope"><span class="hs-identifier hs-var">extendTCvInScope</span></a></span><span> </span><span class="annot"><span class="annottext">TCvSubst
</span><a href="#local-6989586621681033825"><span class="hs-identifier hs-var">subst</span></a></span><span> </span><span class="annot"><span class="annottext">CoVar
</span><a href="#local-6989586621681033824"><span class="hs-identifier hs-var">cv1</span></a></span><span>
</span><span id="line-2493"></span><span>                </span><span class="hs-glyph">|</span><span> </span><span class="annot"><span class="annottext">Bool
</span><a href="../../base-4.16.4.0/src/GHC-Base.html#otherwise"><span class="hs-identifier hs-var">otherwise</span></a></span><span>     </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">TCvSubst -&gt; CoVar -&gt; Coercion -&gt; TCvSubst
</span><a href="GHC.Core.TyCo.Subst.html#extendCvSubst"><span class="hs-identifier hs-var">extendCvSubst</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">TCvSubst -&gt; CoVar -&gt; TCvSubst
</span><a href="GHC.Core.TyCo.Subst.html#extendTCvInScope"><span class="hs-identifier hs-var">extendTCvInScope</span></a></span><span> </span><span class="annot"><span class="annottext">TCvSubst
</span><a href="#local-6989586621681033825"><span class="hs-identifier hs-var">subst</span></a></span><span> </span><span class="annot"><span class="annottext">CoVar
</span><a href="#local-6989586621681033821"><span class="hs-identifier hs-var">cv2</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-2494"></span><span>                                                </span><span class="annot"><span class="annottext">CoVar
</span><a href="#local-6989586621681033824"><span class="hs-identifier hs-var">cv1</span></a></span><span> </span><span class="annot"><span class="annottext">Coercion
</span><a href="#local-6989586621681033815"><span class="hs-identifier hs-var">n_subst</span></a></span><span>
</span><span id="line-2495"></span><span>
</span><span id="line-2496"></span><span>    </span><span class="annot"><a href="#local-6989586621681033853"><span class="hs-identifier hs-var">go_forall</span></a></span><span> </span><span id="local-6989586621681033813"><span class="annot"><span class="annottext">TCvSubst
</span><a href="#local-6989586621681033813"><span class="hs-identifier hs-var">subst</span></a></span></span><span> </span><span id="local-6989586621681033812"><span class="annot"><span class="annottext">Coercion
</span><a href="#local-6989586621681033812"><span class="hs-identifier hs-var">other_co</span></a></span></span><span>
</span><span id="line-2497"></span><span>      </span><span class="hs-comment">-- when other_co is not a ForAllCo</span><span>
</span><span id="line-2498"></span><span>      </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">HasCallStack =&gt; TCvSubst -&gt; Type -&gt; Type
</span><a href="GHC.Core.TyCo.Subst.html#substTy"><span class="hs-identifier hs-var">substTy</span></a></span><span> </span><span class="annot"><span class="annottext">TCvSubst
</span><a href="#local-6989586621681033813"><span class="hs-identifier hs-var">subst</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Coercion -&gt; Type
</span><a href="#local-6989586621681033902"><span class="hs-identifier hs-var">go</span></a></span><span> </span><span class="annot"><span class="annottext">Coercion
</span><a href="#local-6989586621681033812"><span class="hs-identifier hs-var">other_co</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-2499"></span><span>
</span><span id="line-2500"></span><span class="hs-comment">{-

Note [Nested ForAllCos]
~~~~~~~~~~~~~~~~~~~~~~~

Suppose we need `coercionKind (ForAllCo a1 (ForAllCo a2 ... (ForAllCo an
co)...) )`.   We do not want to perform `n` single-type-variable
substitutions over the kind of `co`; rather we want to do one substitution
which substitutes for all of `a1`, `a2` ... simultaneously.  If we do one
at a time we get the performance hole reported in #11735.

Solution: gather up the type variables for nested `ForAllCos`, and
substitute for them all at once.  Remarkably, for #11735 this single
change reduces /total/ compile time by a factor of more than ten.

-}</span><span>
</span><span id="line-2516"></span><span>
</span><span id="line-2517"></span><span class="hs-comment">-- | Retrieve the role from a coercion.</span><span>
</span><span id="line-2518"></span><span class="annot"><a href="GHC.Core.Coercion.html#coercionRole"><span class="hs-identifier hs-type">coercionRole</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><a href="GHC.Core.TyCo.Rep.html#Coercion"><span class="hs-identifier hs-type">Coercion</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="GHC.Core.Coercion.Axiom.html#Role"><span class="hs-identifier hs-type">Role</span></a></span><span>
</span><span id="line-2519"></span><span id="coercionRole"><span class="annot"><span class="annottext">coercionRole :: Coercion -&gt; Role
</span><a href="GHC.Core.Coercion.html#coercionRole"><span class="hs-identifier hs-var hs-var">coercionRole</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">Coercion -&gt; Role
</span><a href="#local-6989586621681033811"><span class="hs-identifier hs-var">go</span></a></span><span>
</span><span id="line-2520"></span><span>  </span><span class="hs-keyword">where</span><span>
</span><span id="line-2521"></span><span>    </span><span id="local-6989586621681033811"><span class="annot"><span class="annottext">go :: Coercion -&gt; Role
</span><a href="#local-6989586621681033811"><span class="hs-identifier hs-var hs-var">go</span></a></span></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="GHC.Core.TyCo.Rep.html#Refl"><span class="hs-identifier hs-type">Refl</span></a></span><span> </span><span class="annot"><span class="annottext">Type
</span><span class="hs-identifier">_</span></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">Role
</span><a href="GHC.Core.Coercion.Axiom.html#Nominal"><span class="hs-identifier hs-var">Nominal</span></a></span><span>
</span><span id="line-2522"></span><span>    </span><span class="annot"><a href="#local-6989586621681033811"><span class="hs-identifier hs-var">go</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="GHC.Core.TyCo.Rep.html#GRefl"><span class="hs-identifier hs-type">GRefl</span></a></span><span> </span><span id="local-6989586621681033810"><span class="annot"><span class="annottext">Role
</span><a href="#local-6989586621681033810"><span class="hs-identifier hs-var">r</span></a></span></span><span> </span><span class="annot"><span class="annottext">Type
</span><span class="hs-identifier">_</span></span><span> </span><span class="annot"><span class="annottext">MCoercion
</span><span class="hs-identifier">_</span></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">Role
</span><a href="#local-6989586621681033810"><span class="hs-identifier hs-var">r</span></a></span><span>
</span><span id="line-2523"></span><span>    </span><span class="annot"><a href="#local-6989586621681033811"><span class="hs-identifier hs-var">go</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="GHC.Core.TyCo.Rep.html#TyConAppCo"><span class="hs-identifier hs-type">TyConAppCo</span></a></span><span> </span><span id="local-6989586621681033809"><span class="annot"><span class="annottext">Role
</span><a href="#local-6989586621681033809"><span class="hs-identifier hs-var">r</span></a></span></span><span> </span><span class="annot"><span class="annottext">TyCon
</span><span class="hs-identifier">_</span></span><span> </span><span class="annot"><span class="annottext">[Coercion]
</span><span class="hs-identifier">_</span></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">Role
</span><a href="#local-6989586621681033809"><span class="hs-identifier hs-var">r</span></a></span><span>
</span><span id="line-2524"></span><span>    </span><span class="annot"><a href="#local-6989586621681033811"><span class="hs-identifier hs-var">go</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="GHC.Core.TyCo.Rep.html#AppCo"><span class="hs-identifier hs-type">AppCo</span></a></span><span> </span><span id="local-6989586621681033808"><span class="annot"><span class="annottext">Coercion
</span><a href="#local-6989586621681033808"><span class="hs-identifier hs-var">co1</span></a></span></span><span> </span><span class="annot"><span class="annottext">Coercion
</span><span class="hs-identifier">_</span></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">Coercion -&gt; Role
</span><a href="#local-6989586621681033811"><span class="hs-identifier hs-var">go</span></a></span><span> </span><span class="annot"><span class="annottext">Coercion
</span><a href="#local-6989586621681033808"><span class="hs-identifier hs-var">co1</span></a></span><span>
</span><span id="line-2525"></span><span>    </span><span class="annot"><a href="#local-6989586621681033811"><span class="hs-identifier hs-var">go</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="GHC.Core.TyCo.Rep.html#ForAllCo"><span class="hs-identifier hs-type">ForAllCo</span></a></span><span> </span><span class="annot"><span class="annottext">CoVar
</span><span class="hs-identifier">_</span></span><span> </span><span class="annot"><span class="annottext">Coercion
</span><span class="hs-identifier">_</span></span><span> </span><span id="local-6989586621681033807"><span class="annot"><span class="annottext">Coercion
</span><a href="#local-6989586621681033807"><span class="hs-identifier hs-var">co</span></a></span></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">Coercion -&gt; Role
</span><a href="#local-6989586621681033811"><span class="hs-identifier hs-var">go</span></a></span><span> </span><span class="annot"><span class="annottext">Coercion
</span><a href="#local-6989586621681033807"><span class="hs-identifier hs-var">co</span></a></span><span>
</span><span id="line-2526"></span><span>    </span><span class="annot"><a href="#local-6989586621681033811"><span class="hs-identifier hs-var">go</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="GHC.Core.TyCo.Rep.html#FunCo"><span class="hs-identifier hs-type">FunCo</span></a></span><span> </span><span id="local-6989586621681033806"><span class="annot"><span class="annottext">Role
</span><a href="#local-6989586621681033806"><span class="hs-identifier hs-var">r</span></a></span></span><span> </span><span class="annot"><span class="annottext">Coercion
</span><span class="hs-identifier">_</span></span><span> </span><span class="annot"><span class="annottext">Coercion
</span><span class="hs-identifier">_</span></span><span> </span><span class="annot"><span class="annottext">Coercion
</span><span class="hs-identifier">_</span></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">Role
</span><a href="#local-6989586621681033806"><span class="hs-identifier hs-var">r</span></a></span><span>
</span><span id="line-2527"></span><span>    </span><span class="annot"><a href="#local-6989586621681033811"><span class="hs-identifier hs-var">go</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="GHC.Core.TyCo.Rep.html#CoVarCo"><span class="hs-identifier hs-type">CoVarCo</span></a></span><span> </span><span id="local-6989586621681033805"><span class="annot"><span class="annottext">CoVar
</span><a href="#local-6989586621681033805"><span class="hs-identifier hs-var">cv</span></a></span></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">CoVar -&gt; Role
</span><a href="GHC.Core.Coercion.html#coVarRole"><span class="hs-identifier hs-var">coVarRole</span></a></span><span> </span><span class="annot"><span class="annottext">CoVar
</span><a href="#local-6989586621681033805"><span class="hs-identifier hs-var">cv</span></a></span><span>
</span><span id="line-2528"></span><span>    </span><span class="annot"><a href="#local-6989586621681033811"><span class="hs-identifier hs-var">go</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="GHC.Core.TyCo.Rep.html#HoleCo"><span class="hs-identifier hs-type">HoleCo</span></a></span><span> </span><span id="local-6989586621681033804"><span class="annot"><span class="annottext">CoercionHole
</span><a href="#local-6989586621681033804"><span class="hs-identifier hs-var">h</span></a></span></span><span class="hs-special">)</span><span>   </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">CoVar -&gt; Role
</span><a href="GHC.Core.Coercion.html#coVarRole"><span class="hs-identifier hs-var">coVarRole</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">CoercionHole -&gt; CoVar
</span><a href="GHC.Core.TyCo.Rep.html#coHoleCoVar"><span class="hs-identifier hs-var">coHoleCoVar</span></a></span><span> </span><span class="annot"><span class="annottext">CoercionHole
</span><a href="#local-6989586621681033804"><span class="hs-identifier hs-var">h</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-2529"></span><span>    </span><span class="annot"><a href="#local-6989586621681033811"><span class="hs-identifier hs-var">go</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="GHC.Core.TyCo.Rep.html#AxiomInstCo"><span class="hs-identifier hs-type">AxiomInstCo</span></a></span><span> </span><span id="local-6989586621681033803"><span class="annot"><span class="annottext">CoAxiom Branched
</span><a href="#local-6989586621681033803"><span class="hs-identifier hs-var">ax</span></a></span></span><span> </span><span class="annot"><span class="annottext">Int
</span><span class="hs-identifier">_</span></span><span> </span><span class="annot"><span class="annottext">[Coercion]
</span><span class="hs-identifier">_</span></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">forall (br :: BranchFlag). CoAxiom br -&gt; Role
</span><a href="GHC.Core.Coercion.Axiom.html#coAxiomRole"><span class="hs-identifier hs-var">coAxiomRole</span></a></span><span> </span><span class="annot"><span class="annottext">CoAxiom Branched
</span><a href="#local-6989586621681033803"><span class="hs-identifier hs-var">ax</span></a></span><span>
</span><span id="line-2530"></span><span>    </span><span class="annot"><a href="#local-6989586621681033811"><span class="hs-identifier hs-var">go</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="GHC.Core.TyCo.Rep.html#UnivCo"><span class="hs-identifier hs-type">UnivCo</span></a></span><span> </span><span class="annot"><span class="annottext">UnivCoProvenance
</span><span class="hs-identifier">_</span></span><span> </span><span id="local-6989586621681033802"><span class="annot"><span class="annottext">Role
</span><a href="#local-6989586621681033802"><span class="hs-identifier hs-var">r</span></a></span></span><span> </span><span class="annot"><span class="annottext">Type
</span><span class="hs-identifier">_</span></span><span> </span><span class="annot"><span class="annottext">Type
</span><span class="hs-identifier">_</span></span><span class="hs-special">)</span><span>  </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">Role
</span><a href="#local-6989586621681033802"><span class="hs-identifier hs-var">r</span></a></span><span>
</span><span id="line-2531"></span><span>    </span><span class="annot"><a href="#local-6989586621681033811"><span class="hs-identifier hs-var">go</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="GHC.Core.TyCo.Rep.html#SymCo"><span class="hs-identifier hs-type">SymCo</span></a></span><span> </span><span id="local-6989586621681033801"><span class="annot"><span class="annottext">Coercion
</span><a href="#local-6989586621681033801"><span class="hs-identifier hs-var">co</span></a></span></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">Coercion -&gt; Role
</span><a href="#local-6989586621681033811"><span class="hs-identifier hs-var">go</span></a></span><span> </span><span class="annot"><span class="annottext">Coercion
</span><a href="#local-6989586621681033801"><span class="hs-identifier hs-var">co</span></a></span><span>
</span><span id="line-2532"></span><span>    </span><span class="annot"><a href="#local-6989586621681033811"><span class="hs-identifier hs-var">go</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="GHC.Core.TyCo.Rep.html#TransCo"><span class="hs-identifier hs-type">TransCo</span></a></span><span> </span><span id="local-6989586621681033800"><span class="annot"><span class="annottext">Coercion
</span><a href="#local-6989586621681033800"><span class="hs-identifier hs-var">co1</span></a></span></span><span> </span><span id="local-6989586621681033799"><span class="annot"><span class="annottext">Coercion
</span><a href="#local-6989586621681033799"><span class="hs-identifier hs-var">_co2</span></a></span></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">Coercion -&gt; Role
</span><a href="#local-6989586621681033811"><span class="hs-identifier hs-var">go</span></a></span><span> </span><span class="annot"><span class="annottext">Coercion
</span><a href="#local-6989586621681033800"><span class="hs-identifier hs-var">co1</span></a></span><span>
</span><span id="line-2533"></span><span>    </span><span class="annot"><a href="#local-6989586621681033811"><span class="hs-identifier hs-var">go</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="GHC.Core.TyCo.Rep.html#NthCo"><span class="hs-identifier hs-type">NthCo</span></a></span><span> </span><span id="local-6989586621681033798"><span class="annot"><span class="annottext">Role
</span><a href="#local-6989586621681033798"><span class="hs-identifier hs-var">r</span></a></span></span><span> </span><span id="local-6989586621681033797"><span class="annot"><span class="annottext">Int
</span><a href="#local-6989586621681033797"><span class="hs-identifier hs-var">_d</span></a></span></span><span> </span><span id="local-6989586621681033796"><span class="annot"><span class="annottext">Coercion
</span><a href="#local-6989586621681033796"><span class="hs-identifier hs-var">_co</span></a></span></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">Role
</span><a href="#local-6989586621681033798"><span class="hs-identifier hs-var">r</span></a></span><span>
</span><span id="line-2534"></span><span>    </span><span class="annot"><a href="#local-6989586621681033811"><span class="hs-identifier hs-var">go</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="GHC.Core.TyCo.Rep.html#LRCo"><span class="hs-identifier hs-type">LRCo</span></a></span><span> </span><span class="hs-special">{</span><span class="hs-special">}</span><span class="hs-special">)</span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">Role
</span><a href="GHC.Core.Coercion.Axiom.html#Nominal"><span class="hs-identifier hs-var">Nominal</span></a></span><span>
</span><span id="line-2535"></span><span>    </span><span class="annot"><a href="#local-6989586621681033811"><span class="hs-identifier hs-var">go</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="GHC.Core.TyCo.Rep.html#InstCo"><span class="hs-identifier hs-type">InstCo</span></a></span><span> </span><span id="local-6989586621681033795"><span class="annot"><span class="annottext">Coercion
</span><a href="#local-6989586621681033795"><span class="hs-identifier hs-var">co</span></a></span></span><span> </span><span class="annot"><span class="annottext">Coercion
</span><span class="hs-identifier">_</span></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">Coercion -&gt; Role
</span><a href="#local-6989586621681033811"><span class="hs-identifier hs-var">go</span></a></span><span> </span><span class="annot"><span class="annottext">Coercion
</span><a href="#local-6989586621681033795"><span class="hs-identifier hs-var">co</span></a></span><span>
</span><span id="line-2536"></span><span>    </span><span class="annot"><a href="#local-6989586621681033811"><span class="hs-identifier hs-var">go</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="GHC.Core.TyCo.Rep.html#KindCo"><span class="hs-identifier hs-type">KindCo</span></a></span><span> </span><span class="hs-special">{</span><span class="hs-special">}</span><span class="hs-special">)</span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">Role
</span><a href="GHC.Core.Coercion.Axiom.html#Nominal"><span class="hs-identifier hs-var">Nominal</span></a></span><span>
</span><span id="line-2537"></span><span>    </span><span class="annot"><a href="#local-6989586621681033811"><span class="hs-identifier hs-var">go</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="GHC.Core.TyCo.Rep.html#SubCo"><span class="hs-identifier hs-type">SubCo</span></a></span><span> </span><span class="annot"><span class="annottext">Coercion
</span><span class="hs-identifier">_</span></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">Role
</span><a href="GHC.Core.Coercion.Axiom.html#Representational"><span class="hs-identifier hs-var">Representational</span></a></span><span>
</span><span id="line-2538"></span><span>    </span><span class="annot"><a href="#local-6989586621681033811"><span class="hs-identifier hs-var">go</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="GHC.Core.TyCo.Rep.html#AxiomRuleCo"><span class="hs-identifier hs-type">AxiomRuleCo</span></a></span><span> </span><span id="local-6989586621681033794"><span class="annot"><span class="annottext">CoAxiomRule
</span><a href="#local-6989586621681033794"><span class="hs-identifier hs-var">ax</span></a></span></span><span> </span><span class="annot"><span class="annottext">[Coercion]
</span><span class="hs-identifier">_</span></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">CoAxiomRule -&gt; Role
</span><a href="GHC.Core.Coercion.Axiom.html#coaxrRole"><span class="hs-identifier hs-var">coaxrRole</span></a></span><span> </span><span class="annot"><span class="annottext">CoAxiomRule
</span><a href="#local-6989586621681033794"><span class="hs-identifier hs-var">ax</span></a></span><span>
</span><span id="line-2539"></span><span>
</span><span id="line-2540"></span><span class="hs-comment">{-
Note [Nested InstCos]
~~~~~~~~~~~~~~~~~~~~~
In #5631 we found that 70% of the entire compilation time was
being spent in coercionKind!  The reason was that we had
   (g @ ty1 @ ty2 .. @ ty100)    -- The &quot;@s&quot; are InstCos
where
   g :: forall a1 a2 .. a100. phi
If we deal with the InstCos one at a time, we'll do this:
   1.  Find the kind of (g @ ty1 .. @ ty99) : forall a100. phi'
   2.  Substitute phi'[ ty100/a100 ], a single tyvar-&gt;type subst
But this is a *quadratic* algorithm, and the blew up #5631.
So it's very important to do the substitution simultaneously;
cf Type.piResultTys (which in fact we call here).

-}</span><span>
</span><span id="line-2556"></span><span>
</span><span id="line-2557"></span><span class="hs-comment">-- | Makes a coercion type from two types: the types whose equality</span><span>
</span><span id="line-2558"></span><span class="hs-comment">-- is proven by the relevant 'Coercion'</span><span>
</span><span id="line-2559"></span><span class="annot"><a href="GHC.Core.Coercion.html#mkCoercionType"><span class="hs-identifier hs-type">mkCoercionType</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><a href="GHC.Core.Coercion.Axiom.html#Role"><span class="hs-identifier hs-type">Role</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="GHC.Core.TyCo.Rep.html#Type"><span class="hs-identifier hs-type">Type</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="GHC.Core.TyCo.Rep.html#Type"><span class="hs-identifier hs-type">Type</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="GHC.Core.TyCo.Rep.html#Type"><span class="hs-identifier hs-type">Type</span></a></span><span>
</span><span id="line-2560"></span><span id="mkCoercionType"><span class="annot"><span class="annottext">mkCoercionType :: Role -&gt; Type -&gt; Type -&gt; Type
</span><a href="GHC.Core.Coercion.html#mkCoercionType"><span class="hs-identifier hs-var hs-var">mkCoercionType</span></a></span></span><span> </span><span class="annot"><span class="annottext">Role
</span><a href="GHC.Core.Coercion.Axiom.html#Nominal"><span class="hs-identifier hs-var">Nominal</span></a></span><span>          </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">Type -&gt; Type -&gt; Type
</span><a href="GHC.Core.Coercion.html#mkPrimEqPred"><span class="hs-identifier hs-var">mkPrimEqPred</span></a></span><span>
</span><span id="line-2561"></span><span class="annot"><a href="GHC.Core.Coercion.html#mkCoercionType"><span class="hs-identifier hs-var">mkCoercionType</span></a></span><span> </span><span class="annot"><span class="annottext">Role
</span><a href="GHC.Core.Coercion.Axiom.html#Representational"><span class="hs-identifier hs-var">Representational</span></a></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">Type -&gt; Type -&gt; Type
</span><a href="GHC.Core.Coercion.html#mkReprPrimEqPred"><span class="hs-identifier hs-var">mkReprPrimEqPred</span></a></span><span>
</span><span id="line-2562"></span><span class="annot"><a href="GHC.Core.Coercion.html#mkCoercionType"><span class="hs-identifier hs-var">mkCoercionType</span></a></span><span> </span><span class="annot"><span class="annottext">Role
</span><a href="GHC.Core.Coercion.Axiom.html#Phantom"><span class="hs-identifier hs-var">Phantom</span></a></span><span>          </span><span class="hs-glyph">=</span><span> </span><span class="hs-glyph">\</span><span id="local-6989586621681033792"><span class="annot"><span class="annottext">Type
</span><a href="#local-6989586621681033792"><span class="hs-identifier hs-var">ty1</span></a></span></span><span> </span><span id="local-6989586621681033791"><span class="annot"><span class="annottext">Type
</span><a href="#local-6989586621681033791"><span class="hs-identifier hs-var">ty2</span></a></span></span><span> </span><span class="hs-glyph">-&gt;</span><span>
</span><span id="line-2563"></span><span>  </span><span class="hs-keyword">let</span><span> </span><span id="local-6989586621681033790"><span class="annot"><span class="annottext">ki1 :: Type
</span><a href="#local-6989586621681033790"><span class="hs-identifier hs-var hs-var">ki1</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">HasDebugCallStack =&gt; Type -&gt; Type
</span><a href="GHC.Core.Type.html#typeKind"><span class="hs-identifier hs-var">typeKind</span></a></span><span> </span><span class="annot"><span class="annottext">Type
</span><a href="#local-6989586621681033792"><span class="hs-identifier hs-var">ty1</span></a></span><span>
</span><span id="line-2564"></span><span>      </span><span id="local-6989586621681033789"><span class="annot"><span class="annottext">ki2 :: Type
</span><a href="#local-6989586621681033789"><span class="hs-identifier hs-var hs-var">ki2</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">HasDebugCallStack =&gt; Type -&gt; Type
</span><a href="GHC.Core.Type.html#typeKind"><span class="hs-identifier hs-var">typeKind</span></a></span><span> </span><span class="annot"><span class="annottext">Type
</span><a href="#local-6989586621681033791"><span class="hs-identifier hs-var">ty2</span></a></span><span>
</span><span id="line-2565"></span><span>  </span><span class="hs-keyword">in</span><span>
</span><span id="line-2566"></span><span>  </span><span class="annot"><span class="annottext">TyCon -&gt; [Type] -&gt; Type
</span><a href="GHC.Core.TyCo.Rep.html#TyConApp"><span class="hs-identifier hs-var">TyConApp</span></a></span><span> </span><span class="annot"><span class="annottext">TyCon
</span><a href="GHC.Builtin.Types.Prim.html#eqPhantPrimTyCon"><span class="hs-identifier hs-var">eqPhantPrimTyCon</span></a></span><span> </span><span class="hs-special">[</span><span class="annot"><span class="annottext">Type
</span><a href="#local-6989586621681033790"><span class="hs-identifier hs-var">ki1</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">Type
</span><a href="#local-6989586621681033789"><span class="hs-identifier hs-var">ki2</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">Type
</span><a href="#local-6989586621681033792"><span class="hs-identifier hs-var">ty1</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">Type
</span><a href="#local-6989586621681033791"><span class="hs-identifier hs-var">ty2</span></a></span><span class="hs-special">]</span><span>
</span><span id="line-2567"></span><span>
</span><span id="line-2568"></span><span class="annot"><a href="GHC.Core.Coercion.html#mkHeteroCoercionType"><span class="hs-identifier hs-type">mkHeteroCoercionType</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><a href="GHC.Core.Coercion.Axiom.html#Role"><span class="hs-identifier hs-type">Role</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="GHC.Core.TyCo.Rep.html#Kind"><span class="hs-identifier hs-type">Kind</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="GHC.Core.TyCo.Rep.html#Kind"><span class="hs-identifier hs-type">Kind</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="GHC.Core.TyCo.Rep.html#Type"><span class="hs-identifier hs-type">Type</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="GHC.Core.TyCo.Rep.html#Type"><span class="hs-identifier hs-type">Type</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="GHC.Core.TyCo.Rep.html#Type"><span class="hs-identifier hs-type">Type</span></a></span><span>
</span><span id="line-2569"></span><span id="mkHeteroCoercionType"><span class="annot"><span class="annottext">mkHeteroCoercionType :: Role -&gt; Type -&gt; Type -&gt; Type -&gt; Type -&gt; Type
</span><a href="GHC.Core.Coercion.html#mkHeteroCoercionType"><span class="hs-identifier hs-var hs-var">mkHeteroCoercionType</span></a></span></span><span> </span><span class="annot"><span class="annottext">Role
</span><a href="GHC.Core.Coercion.Axiom.html#Nominal"><span class="hs-identifier hs-var">Nominal</span></a></span><span>          </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">Type -&gt; Type -&gt; Type -&gt; Type -&gt; Type
</span><a href="GHC.Core.Coercion.html#mkHeteroPrimEqPred"><span class="hs-identifier hs-var">mkHeteroPrimEqPred</span></a></span><span>
</span><span id="line-2570"></span><span class="annot"><a href="GHC.Core.Coercion.html#mkHeteroCoercionType"><span class="hs-identifier hs-var">mkHeteroCoercionType</span></a></span><span> </span><span class="annot"><span class="annottext">Role
</span><a href="GHC.Core.Coercion.Axiom.html#Representational"><span class="hs-identifier hs-var">Representational</span></a></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">Type -&gt; Type -&gt; Type -&gt; Type -&gt; Type
</span><a href="GHC.Core.Coercion.html#mkHeteroReprPrimEqPred"><span class="hs-identifier hs-var">mkHeteroReprPrimEqPred</span></a></span><span>
</span><span id="line-2571"></span><span class="annot"><a href="GHC.Core.Coercion.html#mkHeteroCoercionType"><span class="hs-identifier hs-var">mkHeteroCoercionType</span></a></span><span> </span><span class="annot"><span class="annottext">Role
</span><a href="GHC.Core.Coercion.Axiom.html#Phantom"><span class="hs-identifier hs-var">Phantom</span></a></span><span>          </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">forall a. String -&gt; a
</span><a href="GHC.Utils.Panic.Plain.html#panic"><span class="hs-identifier hs-var">panic</span></a></span><span> </span><span class="annot"><span class="annottext">String
</span><span class="hs-string">&quot;mkHeteroCoercionType&quot;</span></span><span>
</span><span id="line-2572"></span><span>
</span><span id="line-2573"></span><span class="hs-comment">-- | Creates a primitive type equality predicate.</span><span>
</span><span id="line-2574"></span><span class="hs-comment">-- Invariant: the types are not Coercions</span><span>
</span><span id="line-2575"></span><span class="annot"><a href="GHC.Core.Coercion.html#mkPrimEqPred"><span class="hs-identifier hs-type">mkPrimEqPred</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><a href="GHC.Core.TyCo.Rep.html#Type"><span class="hs-identifier hs-type">Type</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="GHC.Core.TyCo.Rep.html#Type"><span class="hs-identifier hs-type">Type</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="GHC.Core.TyCo.Rep.html#Type"><span class="hs-identifier hs-type">Type</span></a></span><span>
</span><span id="line-2576"></span><span id="mkPrimEqPred"><span class="annot"><span class="annottext">mkPrimEqPred :: Type -&gt; Type -&gt; Type
</span><a href="GHC.Core.Coercion.html#mkPrimEqPred"><span class="hs-identifier hs-var hs-var">mkPrimEqPred</span></a></span></span><span> </span><span id="local-6989586621681033787"><span class="annot"><span class="annottext">Type
</span><a href="#local-6989586621681033787"><span class="hs-identifier hs-var">ty1</span></a></span></span><span> </span><span id="local-6989586621681033786"><span class="annot"><span class="annottext">Type
</span><a href="#local-6989586621681033786"><span class="hs-identifier hs-var">ty2</span></a></span></span><span>
</span><span id="line-2577"></span><span>  </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">TyCon -&gt; [Type] -&gt; Type
</span><a href="GHC.Core.Type.html#mkTyConApp"><span class="hs-identifier hs-var">mkTyConApp</span></a></span><span> </span><span class="annot"><span class="annottext">TyCon
</span><a href="GHC.Builtin.Types.Prim.html#eqPrimTyCon"><span class="hs-identifier hs-var">eqPrimTyCon</span></a></span><span> </span><span class="hs-special">[</span><span class="annot"><span class="annottext">Type
</span><a href="#local-6989586621681033784"><span class="hs-identifier hs-var">k1</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">Type
</span><a href="#local-6989586621681033783"><span class="hs-identifier hs-var">k2</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">Type
</span><a href="#local-6989586621681033787"><span class="hs-identifier hs-var">ty1</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">Type
</span><a href="#local-6989586621681033786"><span class="hs-identifier hs-var">ty2</span></a></span><span class="hs-special">]</span><span>
</span><span id="line-2578"></span><span>  </span><span class="hs-keyword">where</span><span>
</span><span id="line-2579"></span><span>    </span><span id="local-6989586621681033784"><span class="annot"><span class="annottext">k1 :: Type
</span><a href="#local-6989586621681033784"><span class="hs-identifier hs-var hs-var">k1</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">HasDebugCallStack =&gt; Type -&gt; Type
</span><a href="GHC.Core.Type.html#typeKind"><span class="hs-identifier hs-var">typeKind</span></a></span><span> </span><span class="annot"><span class="annottext">Type
</span><a href="#local-6989586621681033787"><span class="hs-identifier hs-var">ty1</span></a></span><span>
</span><span id="line-2580"></span><span>    </span><span id="local-6989586621681033783"><span class="annot"><span class="annottext">k2 :: Type
</span><a href="#local-6989586621681033783"><span class="hs-identifier hs-var hs-var">k2</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">HasDebugCallStack =&gt; Type -&gt; Type
</span><a href="GHC.Core.Type.html#typeKind"><span class="hs-identifier hs-var">typeKind</span></a></span><span> </span><span class="annot"><span class="annottext">Type
</span><a href="#local-6989586621681033786"><span class="hs-identifier hs-var">ty2</span></a></span><span>
</span><span id="line-2581"></span><span>
</span><span id="line-2582"></span><span class="hs-comment">-- | Makes a lifted equality predicate at the given role</span><span>
</span><span id="line-2583"></span><span class="annot"><a href="GHC.Core.Coercion.html#mkPrimEqPredRole"><span class="hs-identifier hs-type">mkPrimEqPredRole</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><a href="GHC.Core.Coercion.Axiom.html#Role"><span class="hs-identifier hs-type">Role</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="GHC.Core.TyCo.Rep.html#Type"><span class="hs-identifier hs-type">Type</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="GHC.Core.TyCo.Rep.html#Type"><span class="hs-identifier hs-type">Type</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="GHC.Core.TyCo.Rep.html#PredType"><span class="hs-identifier hs-type">PredType</span></a></span><span>
</span><span id="line-2584"></span><span id="mkPrimEqPredRole"><span class="annot"><span class="annottext">mkPrimEqPredRole :: Role -&gt; Type -&gt; Type -&gt; Type
</span><a href="GHC.Core.Coercion.html#mkPrimEqPredRole"><span class="hs-identifier hs-var hs-var">mkPrimEqPredRole</span></a></span></span><span> </span><span class="annot"><span class="annottext">Role
</span><a href="GHC.Core.Coercion.Axiom.html#Nominal"><span class="hs-identifier hs-var">Nominal</span></a></span><span>          </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">Type -&gt; Type -&gt; Type
</span><a href="GHC.Core.Coercion.html#mkPrimEqPred"><span class="hs-identifier hs-var">mkPrimEqPred</span></a></span><span>
</span><span id="line-2585"></span><span class="annot"><a href="GHC.Core.Coercion.html#mkPrimEqPredRole"><span class="hs-identifier hs-var">mkPrimEqPredRole</span></a></span><span> </span><span class="annot"><span class="annottext">Role
</span><a href="GHC.Core.Coercion.Axiom.html#Representational"><span class="hs-identifier hs-var">Representational</span></a></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">Type -&gt; Type -&gt; Type
</span><a href="GHC.Core.Coercion.html#mkReprPrimEqPred"><span class="hs-identifier hs-var">mkReprPrimEqPred</span></a></span><span>
</span><span id="line-2586"></span><span class="annot"><a href="GHC.Core.Coercion.html#mkPrimEqPredRole"><span class="hs-identifier hs-var">mkPrimEqPredRole</span></a></span><span> </span><span class="annot"><span class="annottext">Role
</span><a href="GHC.Core.Coercion.Axiom.html#Phantom"><span class="hs-identifier hs-var">Phantom</span></a></span><span>          </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">forall a. String -&gt; a
</span><a href="GHC.Utils.Panic.Plain.html#panic"><span class="hs-identifier hs-var">panic</span></a></span><span> </span><span class="annot"><span class="annottext">String
</span><span class="hs-string">&quot;mkPrimEqPredRole phantom&quot;</span></span><span>
</span><span id="line-2587"></span><span>
</span><span id="line-2588"></span><span class="hs-comment">-- | Creates a primitive type equality predicate with explicit kinds</span><span>
</span><span id="line-2589"></span><span class="annot"><a href="GHC.Core.Coercion.html#mkHeteroPrimEqPred"><span class="hs-identifier hs-type">mkHeteroPrimEqPred</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><a href="GHC.Core.TyCo.Rep.html#Kind"><span class="hs-identifier hs-type">Kind</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="GHC.Core.TyCo.Rep.html#Kind"><span class="hs-identifier hs-type">Kind</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="GHC.Core.TyCo.Rep.html#Type"><span class="hs-identifier hs-type">Type</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="GHC.Core.TyCo.Rep.html#Type"><span class="hs-identifier hs-type">Type</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="GHC.Core.TyCo.Rep.html#Type"><span class="hs-identifier hs-type">Type</span></a></span><span>
</span><span id="line-2590"></span><span id="mkHeteroPrimEqPred"><span class="annot"><span class="annottext">mkHeteroPrimEqPred :: Type -&gt; Type -&gt; Type -&gt; Type -&gt; Type
</span><a href="GHC.Core.Coercion.html#mkHeteroPrimEqPred"><span class="hs-identifier hs-var hs-var">mkHeteroPrimEqPred</span></a></span></span><span> </span><span id="local-6989586621681033781"><span class="annot"><span class="annottext">Type
</span><a href="#local-6989586621681033781"><span class="hs-identifier hs-var">k1</span></a></span></span><span> </span><span id="local-6989586621681033780"><span class="annot"><span class="annottext">Type
</span><a href="#local-6989586621681033780"><span class="hs-identifier hs-var">k2</span></a></span></span><span> </span><span id="local-6989586621681033779"><span class="annot"><span class="annottext">Type
</span><a href="#local-6989586621681033779"><span class="hs-identifier hs-var">ty1</span></a></span></span><span> </span><span id="local-6989586621681033778"><span class="annot"><span class="annottext">Type
</span><a href="#local-6989586621681033778"><span class="hs-identifier hs-var">ty2</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">TyCon -&gt; [Type] -&gt; Type
</span><a href="GHC.Core.Type.html#mkTyConApp"><span class="hs-identifier hs-var">mkTyConApp</span></a></span><span> </span><span class="annot"><span class="annottext">TyCon
</span><a href="GHC.Builtin.Types.Prim.html#eqPrimTyCon"><span class="hs-identifier hs-var">eqPrimTyCon</span></a></span><span> </span><span class="hs-special">[</span><span class="annot"><span class="annottext">Type
</span><a href="#local-6989586621681033781"><span class="hs-identifier hs-var">k1</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">Type
</span><a href="#local-6989586621681033780"><span class="hs-identifier hs-var">k2</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">Type
</span><a href="#local-6989586621681033779"><span class="hs-identifier hs-var">ty1</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">Type
</span><a href="#local-6989586621681033778"><span class="hs-identifier hs-var">ty2</span></a></span><span class="hs-special">]</span><span>
</span><span id="line-2591"></span><span>
</span><span id="line-2592"></span><span class="hs-comment">-- | Creates a primitive representational type equality predicate</span><span>
</span><span id="line-2593"></span><span class="hs-comment">-- with explicit kinds</span><span>
</span><span id="line-2594"></span><span class="annot"><a href="GHC.Core.Coercion.html#mkHeteroReprPrimEqPred"><span class="hs-identifier hs-type">mkHeteroReprPrimEqPred</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><a href="GHC.Core.TyCo.Rep.html#Kind"><span class="hs-identifier hs-type">Kind</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="GHC.Core.TyCo.Rep.html#Kind"><span class="hs-identifier hs-type">Kind</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="GHC.Core.TyCo.Rep.html#Type"><span class="hs-identifier hs-type">Type</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="GHC.Core.TyCo.Rep.html#Type"><span class="hs-identifier hs-type">Type</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="GHC.Core.TyCo.Rep.html#Type"><span class="hs-identifier hs-type">Type</span></a></span><span>
</span><span id="line-2595"></span><span id="mkHeteroReprPrimEqPred"><span class="annot"><span class="annottext">mkHeteroReprPrimEqPred :: Type -&gt; Type -&gt; Type -&gt; Type -&gt; Type
</span><a href="GHC.Core.Coercion.html#mkHeteroReprPrimEqPred"><span class="hs-identifier hs-var hs-var">mkHeteroReprPrimEqPred</span></a></span></span><span> </span><span id="local-6989586621681033777"><span class="annot"><span class="annottext">Type
</span><a href="#local-6989586621681033777"><span class="hs-identifier hs-var">k1</span></a></span></span><span> </span><span id="local-6989586621681033776"><span class="annot"><span class="annottext">Type
</span><a href="#local-6989586621681033776"><span class="hs-identifier hs-var">k2</span></a></span></span><span> </span><span id="local-6989586621681033775"><span class="annot"><span class="annottext">Type
</span><a href="#local-6989586621681033775"><span class="hs-identifier hs-var">ty1</span></a></span></span><span> </span><span id="local-6989586621681033774"><span class="annot"><span class="annottext">Type
</span><a href="#local-6989586621681033774"><span class="hs-identifier hs-var">ty2</span></a></span></span><span>
</span><span id="line-2596"></span><span>  </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">TyCon -&gt; [Type] -&gt; Type
</span><a href="GHC.Core.Type.html#mkTyConApp"><span class="hs-identifier hs-var">mkTyConApp</span></a></span><span> </span><span class="annot"><span class="annottext">TyCon
</span><a href="GHC.Builtin.Types.Prim.html#eqReprPrimTyCon"><span class="hs-identifier hs-var">eqReprPrimTyCon</span></a></span><span> </span><span class="hs-special">[</span><span class="annot"><span class="annottext">Type
</span><a href="#local-6989586621681033777"><span class="hs-identifier hs-var">k1</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">Type
</span><a href="#local-6989586621681033776"><span class="hs-identifier hs-var">k2</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">Type
</span><a href="#local-6989586621681033775"><span class="hs-identifier hs-var">ty1</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">Type
</span><a href="#local-6989586621681033774"><span class="hs-identifier hs-var">ty2</span></a></span><span class="hs-special">]</span><span>
</span><span id="line-2597"></span><span>
</span><span id="line-2598"></span><span class="annot"><a href="GHC.Core.Coercion.html#mkReprPrimEqPred"><span class="hs-identifier hs-type">mkReprPrimEqPred</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><a href="GHC.Core.TyCo.Rep.html#Type"><span class="hs-identifier hs-type">Type</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="GHC.Core.TyCo.Rep.html#Type"><span class="hs-identifier hs-type">Type</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="GHC.Core.TyCo.Rep.html#Type"><span class="hs-identifier hs-type">Type</span></a></span><span>
</span><span id="line-2599"></span><span id="mkReprPrimEqPred"><span class="annot"><span class="annottext">mkReprPrimEqPred :: Type -&gt; Type -&gt; Type
</span><a href="GHC.Core.Coercion.html#mkReprPrimEqPred"><span class="hs-identifier hs-var hs-var">mkReprPrimEqPred</span></a></span></span><span> </span><span id="local-6989586621681033772"><span class="annot"><span class="annottext">Type
</span><a href="#local-6989586621681033772"><span class="hs-identifier hs-var">ty1</span></a></span></span><span>  </span><span id="local-6989586621681033771"><span class="annot"><span class="annottext">Type
</span><a href="#local-6989586621681033771"><span class="hs-identifier hs-var">ty2</span></a></span></span><span>
</span><span id="line-2600"></span><span>  </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">TyCon -&gt; [Type] -&gt; Type
</span><a href="GHC.Core.Type.html#mkTyConApp"><span class="hs-identifier hs-var">mkTyConApp</span></a></span><span> </span><span class="annot"><span class="annottext">TyCon
</span><a href="GHC.Builtin.Types.Prim.html#eqReprPrimTyCon"><span class="hs-identifier hs-var">eqReprPrimTyCon</span></a></span><span> </span><span class="hs-special">[</span><span class="annot"><span class="annottext">Type
</span><a href="#local-6989586621681033770"><span class="hs-identifier hs-var">k1</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">Type
</span><a href="#local-6989586621681033769"><span class="hs-identifier hs-var">k2</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">Type
</span><a href="#local-6989586621681033772"><span class="hs-identifier hs-var">ty1</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">Type
</span><a href="#local-6989586621681033771"><span class="hs-identifier hs-var">ty2</span></a></span><span class="hs-special">]</span><span>
</span><span id="line-2601"></span><span>  </span><span class="hs-keyword">where</span><span>
</span><span id="line-2602"></span><span>    </span><span id="local-6989586621681033770"><span class="annot"><span class="annottext">k1 :: Type
</span><a href="#local-6989586621681033770"><span class="hs-identifier hs-var hs-var">k1</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">HasDebugCallStack =&gt; Type -&gt; Type
</span><a href="GHC.Core.Type.html#typeKind"><span class="hs-identifier hs-var">typeKind</span></a></span><span> </span><span class="annot"><span class="annottext">Type
</span><a href="#local-6989586621681033772"><span class="hs-identifier hs-var">ty1</span></a></span><span>
</span><span id="line-2603"></span><span>    </span><span id="local-6989586621681033769"><span class="annot"><span class="annottext">k2 :: Type
</span><a href="#local-6989586621681033769"><span class="hs-identifier hs-var hs-var">k2</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">HasDebugCallStack =&gt; Type -&gt; Type
</span><a href="GHC.Core.Type.html#typeKind"><span class="hs-identifier hs-var">typeKind</span></a></span><span> </span><span class="annot"><span class="annottext">Type
</span><a href="#local-6989586621681033771"><span class="hs-identifier hs-var">ty2</span></a></span><span>
</span><span id="line-2604"></span><span>
</span><span id="line-2605"></span><span class="hs-comment">-- | Assuming that two types are the same, ignoring coercions, find</span><span>
</span><span id="line-2606"></span><span class="hs-comment">-- a nominal coercion between the types. This is useful when optimizing</span><span>
</span><span id="line-2607"></span><span class="hs-comment">-- transitivity over coercion applications, where splitting two</span><span>
</span><span id="line-2608"></span><span class="hs-comment">-- AppCos might yield different kinds. See Note [EtaAppCo] in</span><span>
</span><span id="line-2609"></span><span class="hs-comment">-- &quot;GHC.Core.Coercion.Opt&quot;.</span><span>
</span><span id="line-2610"></span><span class="annot"><a href="GHC.Core.Coercion.html#buildCoercion"><span class="hs-identifier hs-type">buildCoercion</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><a href="GHC.Core.TyCo.Rep.html#Type"><span class="hs-identifier hs-type">Type</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="GHC.Core.TyCo.Rep.html#Type"><span class="hs-identifier hs-type">Type</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="GHC.Core.TyCo.Rep.html#CoercionN"><span class="hs-identifier hs-type">CoercionN</span></a></span><span>
</span><span id="line-2611"></span><span id="buildCoercion"><span class="annot"><span class="annottext">buildCoercion :: Type -&gt; Type -&gt; Coercion
</span><a href="GHC.Core.Coercion.html#buildCoercion"><span class="hs-identifier hs-var hs-var">buildCoercion</span></a></span></span><span> </span><span id="local-6989586621681033768"><span class="annot"><span class="annottext">Type
</span><a href="#local-6989586621681033768"><span class="hs-identifier hs-var">orig_ty1</span></a></span></span><span> </span><span id="local-6989586621681033767"><span class="annot"><span class="annottext">Type
</span><a href="#local-6989586621681033767"><span class="hs-identifier hs-var">orig_ty2</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">Type -&gt; Type -&gt; Coercion
</span><a href="#local-6989586621681033766"><span class="hs-identifier hs-var">go</span></a></span><span> </span><span class="annot"><span class="annottext">Type
</span><a href="#local-6989586621681033768"><span class="hs-identifier hs-var">orig_ty1</span></a></span><span> </span><span class="annot"><span class="annottext">Type
</span><a href="#local-6989586621681033767"><span class="hs-identifier hs-var">orig_ty2</span></a></span><span>
</span><span id="line-2612"></span><span>  </span><span class="hs-keyword">where</span><span>
</span><span id="line-2613"></span><span>    </span><span id="local-6989586621681033766"><span class="annot"><span class="annottext">go :: Type -&gt; Type -&gt; Coercion
</span><a href="#local-6989586621681033766"><span class="hs-identifier hs-var hs-var">go</span></a></span></span><span> </span><span id="local-6989586621681033765"><span class="annot"><span class="annottext">Type
</span><a href="#local-6989586621681033765"><span class="hs-identifier hs-var">ty1</span></a></span></span><span> </span><span id="local-6989586621681033764"><span class="annot"><span class="annottext">Type
</span><a href="#local-6989586621681033764"><span class="hs-identifier hs-var">ty2</span></a></span></span><span> </span><span class="hs-glyph">|</span><span> </span><span class="annot"><a href="../../base-4.16.4.0/src/GHC-Maybe.html#Just"><span class="hs-identifier hs-type">Just</span></a></span><span> </span><span id="local-6989586621681033763"><span class="annot"><span class="annottext">Type
</span><a href="#local-6989586621681033763"><span class="hs-identifier hs-var">ty1'</span></a></span></span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">Type -&gt; Maybe Type
</span><a href="GHC.Core.Type.html#coreView"><span class="hs-identifier hs-var">coreView</span></a></span><span> </span><span class="annot"><span class="annottext">Type
</span><a href="#local-6989586621681033765"><span class="hs-identifier hs-var">ty1</span></a></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">Type -&gt; Type -&gt; Coercion
</span><a href="#local-6989586621681033766"><span class="hs-identifier hs-var">go</span></a></span><span> </span><span class="annot"><span class="annottext">Type
</span><a href="#local-6989586621681033763"><span class="hs-identifier hs-var">ty1'</span></a></span><span> </span><span class="annot"><span class="annottext">Type
</span><a href="#local-6989586621681033764"><span class="hs-identifier hs-var">ty2</span></a></span><span>
</span><span id="line-2614"></span><span>               </span><span class="hs-glyph">|</span><span> </span><span class="annot"><a href="../../base-4.16.4.0/src/GHC-Maybe.html#Just"><span class="hs-identifier hs-type">Just</span></a></span><span> </span><span id="local-6989586621681033762"><span class="annot"><span class="annottext">Type
</span><a href="#local-6989586621681033762"><span class="hs-identifier hs-var">ty2'</span></a></span></span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">Type -&gt; Maybe Type
</span><a href="GHC.Core.Type.html#coreView"><span class="hs-identifier hs-var">coreView</span></a></span><span> </span><span class="annot"><span class="annottext">Type
</span><a href="#local-6989586621681033764"><span class="hs-identifier hs-var">ty2</span></a></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">Type -&gt; Type -&gt; Coercion
</span><a href="#local-6989586621681033766"><span class="hs-identifier hs-var">go</span></a></span><span> </span><span class="annot"><span class="annottext">Type
</span><a href="#local-6989586621681033765"><span class="hs-identifier hs-var">ty1</span></a></span><span> </span><span class="annot"><span class="annottext">Type
</span><a href="#local-6989586621681033762"><span class="hs-identifier hs-var">ty2'</span></a></span><span>
</span><span id="line-2615"></span><span>
</span><span id="line-2616"></span><span>    </span><span class="annot"><a href="#local-6989586621681033766"><span class="hs-identifier hs-var">go</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="GHC.Core.TyCo.Rep.html#CastTy"><span class="hs-identifier hs-type">CastTy</span></a></span><span> </span><span id="local-6989586621681033761"><span class="annot"><span class="annottext">Type
</span><a href="#local-6989586621681033761"><span class="hs-identifier hs-var">ty1</span></a></span></span><span> </span><span id="local-6989586621681033760"><span class="annot"><span class="annottext">Coercion
</span><a href="#local-6989586621681033760"><span class="hs-identifier hs-var">co</span></a></span></span><span class="hs-special">)</span><span> </span><span id="local-6989586621681033759"><span class="annot"><span class="annottext">Type
</span><a href="#local-6989586621681033759"><span class="hs-identifier hs-var">ty2</span></a></span></span><span>
</span><span id="line-2617"></span><span>      </span><span class="hs-glyph">=</span><span> </span><span class="hs-keyword">let</span><span> </span><span id="local-6989586621681033758"><span class="annot"><span class="annottext">co' :: Coercion
</span><a href="#local-6989586621681033758"><span class="hs-identifier hs-var hs-var">co'</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">Type -&gt; Type -&gt; Coercion
</span><a href="#local-6989586621681033766"><span class="hs-identifier hs-var">go</span></a></span><span> </span><span class="annot"><span class="annottext">Type
</span><a href="#local-6989586621681033761"><span class="hs-identifier hs-var">ty1</span></a></span><span> </span><span class="annot"><span class="annottext">Type
</span><a href="#local-6989586621681033759"><span class="hs-identifier hs-var">ty2</span></a></span><span>
</span><span id="line-2618"></span><span>            </span><span id="local-6989586621681033757"><span class="annot"><span class="annottext">r :: Role
</span><a href="#local-6989586621681033757"><span class="hs-identifier hs-var hs-var">r</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">Coercion -&gt; Role
</span><a href="GHC.Core.Coercion.html#coercionRole"><span class="hs-identifier hs-var">coercionRole</span></a></span><span> </span><span class="annot"><span class="annottext">Coercion
</span><a href="#local-6989586621681033758"><span class="hs-identifier hs-var">co'</span></a></span><span>
</span><span id="line-2619"></span><span>        </span><span class="hs-keyword">in</span><span>  </span><span class="annot"><span class="annottext">Role -&gt; Type -&gt; Coercion -&gt; Coercion -&gt; Coercion
</span><a href="GHC.Core.Coercion.html#mkCoherenceLeftCo"><span class="hs-identifier hs-var">mkCoherenceLeftCo</span></a></span><span> </span><span class="annot"><span class="annottext">Role
</span><a href="#local-6989586621681033757"><span class="hs-identifier hs-var">r</span></a></span><span> </span><span class="annot"><span class="annottext">Type
</span><a href="#local-6989586621681033761"><span class="hs-identifier hs-var">ty1</span></a></span><span> </span><span class="annot"><span class="annottext">Coercion
</span><a href="#local-6989586621681033760"><span class="hs-identifier hs-var">co</span></a></span><span> </span><span class="annot"><span class="annottext">Coercion
</span><a href="#local-6989586621681033758"><span class="hs-identifier hs-var">co'</span></a></span><span>
</span><span id="line-2620"></span><span>
</span><span id="line-2621"></span><span>    </span><span class="annot"><a href="#local-6989586621681033766"><span class="hs-identifier hs-var">go</span></a></span><span> </span><span id="local-6989586621681033756"><span class="annot"><span class="annottext">Type
</span><a href="#local-6989586621681033756"><span class="hs-identifier hs-var">ty1</span></a></span></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="GHC.Core.TyCo.Rep.html#CastTy"><span class="hs-identifier hs-type">CastTy</span></a></span><span> </span><span id="local-6989586621681033755"><span class="annot"><span class="annottext">Type
</span><a href="#local-6989586621681033755"><span class="hs-identifier hs-var">ty2</span></a></span></span><span> </span><span id="local-6989586621681033754"><span class="annot"><span class="annottext">Coercion
</span><a href="#local-6989586621681033754"><span class="hs-identifier hs-var">co</span></a></span></span><span class="hs-special">)</span><span>
</span><span id="line-2622"></span><span>      </span><span class="hs-glyph">=</span><span> </span><span class="hs-keyword">let</span><span> </span><span id="local-6989586621681033753"><span class="annot"><span class="annottext">co' :: Coercion
</span><a href="#local-6989586621681033753"><span class="hs-identifier hs-var hs-var">co'</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">Type -&gt; Type -&gt; Coercion
</span><a href="#local-6989586621681033766"><span class="hs-identifier hs-var">go</span></a></span><span> </span><span class="annot"><span class="annottext">Type
</span><a href="#local-6989586621681033756"><span class="hs-identifier hs-var">ty1</span></a></span><span> </span><span class="annot"><span class="annottext">Type
</span><a href="#local-6989586621681033755"><span class="hs-identifier hs-var">ty2</span></a></span><span>
</span><span id="line-2623"></span><span>            </span><span id="local-6989586621681033752"><span class="annot"><span class="annottext">r :: Role
</span><a href="#local-6989586621681033752"><span class="hs-identifier hs-var hs-var">r</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">Coercion -&gt; Role
</span><a href="GHC.Core.Coercion.html#coercionRole"><span class="hs-identifier hs-var">coercionRole</span></a></span><span> </span><span class="annot"><span class="annottext">Coercion
</span><a href="#local-6989586621681033753"><span class="hs-identifier hs-var">co'</span></a></span><span>
</span><span id="line-2624"></span><span>        </span><span class="hs-keyword">in</span><span>  </span><span class="annot"><span class="annottext">Role -&gt; Type -&gt; Coercion -&gt; Coercion -&gt; Coercion
</span><a href="GHC.Core.Coercion.html#mkCoherenceRightCo"><span class="hs-identifier hs-var">mkCoherenceRightCo</span></a></span><span> </span><span class="annot"><span class="annottext">Role
</span><a href="#local-6989586621681033752"><span class="hs-identifier hs-var">r</span></a></span><span> </span><span class="annot"><span class="annottext">Type
</span><a href="#local-6989586621681033755"><span class="hs-identifier hs-var">ty2</span></a></span><span> </span><span class="annot"><span class="annottext">Coercion
</span><a href="#local-6989586621681033754"><span class="hs-identifier hs-var">co</span></a></span><span> </span><span class="annot"><span class="annottext">Coercion
</span><a href="#local-6989586621681033753"><span class="hs-identifier hs-var">co'</span></a></span><span>
</span><span id="line-2625"></span><span>
</span><span id="line-2626"></span><span>    </span><span class="annot"><a href="#local-6989586621681033766"><span class="hs-identifier hs-var">go</span></a></span><span> </span><span id="local-6989586621681033751"><span class="annot"><span class="annottext">ty1 :: Type
</span><a href="#local-6989586621681033751"><span class="hs-identifier hs-var">ty1</span></a></span></span><span class="hs-glyph">@</span><span class="hs-special">(</span><span class="annot"><a href="GHC.Core.TyCo.Rep.html#TyVarTy"><span class="hs-identifier hs-type">TyVarTy</span></a></span><span> </span><span id="local-6989586621681033750"><span class="annot"><span class="annottext">CoVar
</span><a href="#local-6989586621681033750"><span class="hs-identifier hs-var">tv1</span></a></span></span><span class="hs-special">)</span><span> </span><span id="local-6989586621681033749"><span class="annot"><span class="annottext">Type
</span><a href="#local-6989586621681033749"><span class="hs-identifier hs-var">_tyvarty</span></a></span></span><span>
</span><span id="line-2627"></span><span>      </span><span class="hs-glyph">=</span><span> </span><span class="hs-identifier">ASSERT</span><span class="hs-special">(</span><span> </span><span class="hs-keyword">case</span><span> </span><span class="hs-identifier">_tyvarty</span><span> </span><span class="hs-keyword">of</span><span>
</span><span id="line-2628"></span><span>                  </span><span class="hs-special">{</span><span> </span><span class="hs-identifier">TyVarTy</span><span> </span><span class="hs-identifier">tv2</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-identifier">tv1</span><span> </span><span class="hs-operator">==</span><span> </span><span class="hs-identifier">tv2</span><span>
</span><span id="line-2629"></span><span>                  </span><span class="hs-special">;</span><span> </span><span class="hs-identifier">_</span><span>           </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-identifier">False</span><span>      </span><span class="hs-special">}</span><span> </span><span class="hs-special">)</span><span>
</span><span id="line-2630"></span><span>        </span><span class="annot"><span class="annottext">Type -&gt; Coercion
</span><a href="GHC.Core.Coercion.html#mkNomReflCo"><span class="hs-identifier hs-var">mkNomReflCo</span></a></span><span> </span><span class="annot"><span class="annottext">Type
</span><a href="#local-6989586621681033751"><span class="hs-identifier hs-var">ty1</span></a></span><span>
</span><span id="line-2631"></span><span>
</span><span id="line-2632"></span><span>    </span><span class="annot"><a href="#local-6989586621681033766"><span class="hs-identifier hs-var">go</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="GHC.Core.TyCo.Rep.html#FunTy"><span class="hs-identifier hs-type">FunTy</span></a></span><span> </span><span class="hs-special">{</span><span> </span><span class="annot"><span class="annottext">ft_mult :: Type -&gt; Type
</span><a href="GHC.Core.TyCo.Rep.html#ft_mult"><span class="hs-identifier hs-var">ft_mult</span></a></span><span> </span><span class="hs-glyph">=</span><span> </span><span id="local-6989586621681033746"><span class="annot"><span class="annottext">Type
</span><a href="#local-6989586621681033746"><span class="hs-identifier hs-var">w1</span></a></span></span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">ft_arg :: Type -&gt; Type
</span><a href="GHC.Core.TyCo.Rep.html#ft_arg"><span class="hs-identifier hs-var">ft_arg</span></a></span><span> </span><span class="hs-glyph">=</span><span> </span><span id="local-6989586621681033744"><span class="annot"><span class="annottext">Type
</span><a href="#local-6989586621681033744"><span class="hs-identifier hs-var">arg1</span></a></span></span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">ft_res :: Type -&gt; Type
</span><a href="GHC.Core.TyCo.Rep.html#ft_res"><span class="hs-identifier hs-var">ft_res</span></a></span><span> </span><span class="hs-glyph">=</span><span> </span><span id="local-6989586621681033742"><span class="annot"><span class="annottext">Type
</span><a href="#local-6989586621681033742"><span class="hs-identifier hs-var">res1</span></a></span></span><span> </span><span class="hs-special">}</span><span class="hs-special">)</span><span>
</span><span id="line-2633"></span><span>       </span><span class="hs-special">(</span><span class="annot"><a href="GHC.Core.TyCo.Rep.html#FunTy"><span class="hs-identifier hs-type">FunTy</span></a></span><span> </span><span class="hs-special">{</span><span> </span><span class="annot"><span class="annottext">ft_mult :: Type -&gt; Type
</span><a href="GHC.Core.TyCo.Rep.html#ft_mult"><span class="hs-identifier hs-var">ft_mult</span></a></span><span> </span><span class="hs-glyph">=</span><span> </span><span id="local-6989586621681033741"><span class="annot"><span class="annottext">Type
</span><a href="#local-6989586621681033741"><span class="hs-identifier hs-var">w2</span></a></span></span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">ft_arg :: Type -&gt; Type
</span><a href="GHC.Core.TyCo.Rep.html#ft_arg"><span class="hs-identifier hs-var">ft_arg</span></a></span><span> </span><span class="hs-glyph">=</span><span> </span><span id="local-6989586621681033740"><span class="annot"><span class="annottext">Type
</span><a href="#local-6989586621681033740"><span class="hs-identifier hs-var">arg2</span></a></span></span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">ft_res :: Type -&gt; Type
</span><a href="GHC.Core.TyCo.Rep.html#ft_res"><span class="hs-identifier hs-var">ft_res</span></a></span><span> </span><span class="hs-glyph">=</span><span> </span><span id="local-6989586621681033739"><span class="annot"><span class="annottext">Type
</span><a href="#local-6989586621681033739"><span class="hs-identifier hs-var">res2</span></a></span></span><span> </span><span class="hs-special">}</span><span class="hs-special">)</span><span>
</span><span id="line-2634"></span><span>      </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">Role -&gt; Coercion -&gt; Coercion -&gt; Coercion -&gt; Coercion
</span><a href="GHC.Core.Coercion.html#mkFunCo"><span class="hs-identifier hs-var">mkFunCo</span></a></span><span> </span><span class="annot"><span class="annottext">Role
</span><a href="GHC.Core.Coercion.Axiom.html#Nominal"><span class="hs-identifier hs-var">Nominal</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Type -&gt; Type -&gt; Coercion
</span><a href="#local-6989586621681033766"><span class="hs-identifier hs-var">go</span></a></span><span> </span><span class="annot"><span class="annottext">Type
</span><a href="#local-6989586621681033746"><span class="hs-identifier hs-var">w1</span></a></span><span> </span><span class="annot"><span class="annottext">Type
</span><a href="#local-6989586621681033741"><span class="hs-identifier hs-var">w2</span></a></span><span class="hs-special">)</span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Type -&gt; Type -&gt; Coercion
</span><a href="#local-6989586621681033766"><span class="hs-identifier hs-var">go</span></a></span><span> </span><span class="annot"><span class="annottext">Type
</span><a href="#local-6989586621681033744"><span class="hs-identifier hs-var">arg1</span></a></span><span> </span><span class="annot"><span class="annottext">Type
</span><a href="#local-6989586621681033740"><span class="hs-identifier hs-var">arg2</span></a></span><span class="hs-special">)</span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Type -&gt; Type -&gt; Coercion
</span><a href="#local-6989586621681033766"><span class="hs-identifier hs-var">go</span></a></span><span> </span><span class="annot"><span class="annottext">Type
</span><a href="#local-6989586621681033742"><span class="hs-identifier hs-var">res1</span></a></span><span> </span><span class="annot"><span class="annottext">Type
</span><a href="#local-6989586621681033739"><span class="hs-identifier hs-var">res2</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-2635"></span><span>
</span><span id="line-2636"></span><span>    </span><span class="annot"><a href="#local-6989586621681033766"><span class="hs-identifier hs-var">go</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="GHC.Core.TyCo.Rep.html#TyConApp"><span class="hs-identifier hs-type">TyConApp</span></a></span><span> </span><span id="local-6989586621681033738"><span class="annot"><span class="annottext">TyCon
</span><a href="#local-6989586621681033738"><span class="hs-identifier hs-var">tc1</span></a></span></span><span> </span><span id="local-6989586621681033737"><span class="annot"><span class="annottext">[Type]
</span><a href="#local-6989586621681033737"><span class="hs-identifier hs-var">args1</span></a></span></span><span class="hs-special">)</span><span> </span><span class="hs-special">(</span><span class="annot"><a href="GHC.Core.TyCo.Rep.html#TyConApp"><span class="hs-identifier hs-type">TyConApp</span></a></span><span> </span><span id="local-6989586621681033736"><span class="annot"><span class="annottext">TyCon
</span><a href="#local-6989586621681033736"><span class="hs-identifier hs-var">tc2</span></a></span></span><span> </span><span id="local-6989586621681033735"><span class="annot"><span class="annottext">[Type]
</span><a href="#local-6989586621681033735"><span class="hs-identifier hs-var">args2</span></a></span></span><span class="hs-special">)</span><span>
</span><span id="line-2637"></span><span>      </span><span class="hs-glyph">=</span><span> </span><span class="hs-identifier">ASSERT</span><span class="hs-special">(</span><span> </span><span class="hs-identifier">tc1</span><span> </span><span class="hs-operator">==</span><span> </span><span class="hs-identifier">tc2</span><span> </span><span class="hs-special">)</span><span>
</span><span id="line-2638"></span><span>        </span><span class="annot"><span class="annottext">HasDebugCallStack =&gt; Role -&gt; TyCon -&gt; [Coercion] -&gt; Coercion
</span><a href="GHC.Core.Coercion.html#mkTyConAppCo"><span class="hs-identifier hs-var">mkTyConAppCo</span></a></span><span> </span><span class="annot"><span class="annottext">Role
</span><a href="GHC.Core.Coercion.Axiom.html#Nominal"><span class="hs-identifier hs-var">Nominal</span></a></span><span> </span><span class="annot"><span class="annottext">TyCon
</span><a href="#local-6989586621681033738"><span class="hs-identifier hs-var">tc1</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">forall a b c. (a -&gt; b -&gt; c) -&gt; [a] -&gt; [b] -&gt; [c]
</span><a href="../../base-4.16.4.0/src/GHC-List.html#zipWith"><span class="hs-identifier hs-var">zipWith</span></a></span><span> </span><span class="annot"><span class="annottext">Type -&gt; Type -&gt; Coercion
</span><a href="#local-6989586621681033766"><span class="hs-identifier hs-var">go</span></a></span><span> </span><span class="annot"><span class="annottext">[Type]
</span><a href="#local-6989586621681033737"><span class="hs-identifier hs-var">args1</span></a></span><span> </span><span class="annot"><span class="annottext">[Type]
</span><a href="#local-6989586621681033735"><span class="hs-identifier hs-var">args2</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-2639"></span><span>
</span><span id="line-2640"></span><span>    </span><span class="annot"><a href="#local-6989586621681033766"><span class="hs-identifier hs-var">go</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="GHC.Core.TyCo.Rep.html#AppTy"><span class="hs-identifier hs-type">AppTy</span></a></span><span> </span><span id="local-6989586621681033734"><span class="annot"><span class="annottext">Type
</span><a href="#local-6989586621681033734"><span class="hs-identifier hs-var">ty1a</span></a></span></span><span> </span><span id="local-6989586621681033733"><span class="annot"><span class="annottext">Type
</span><a href="#local-6989586621681033733"><span class="hs-identifier hs-var">ty1b</span></a></span></span><span class="hs-special">)</span><span> </span><span id="local-6989586621681033732"><span class="annot"><span class="annottext">Type
</span><a href="#local-6989586621681033732"><span class="hs-identifier hs-var">ty2</span></a></span></span><span>
</span><span id="line-2641"></span><span>      </span><span class="hs-glyph">|</span><span> </span><span class="annot"><a href="../../base-4.16.4.0/src/GHC-Maybe.html#Just"><span class="hs-identifier hs-type">Just</span></a></span><span> </span><span class="hs-special">(</span><span id="local-6989586621681033731"><span class="annot"><span class="annottext">Type
</span><a href="#local-6989586621681033731"><span class="hs-identifier hs-var">ty2a</span></a></span></span><span class="hs-special">,</span><span> </span><span id="local-6989586621681033730"><span class="annot"><span class="annottext">Type
</span><a href="#local-6989586621681033730"><span class="hs-identifier hs-var">ty2b</span></a></span></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">HasDebugCallStack =&gt; Type -&gt; Maybe (Type, Type)
</span><a href="GHC.Core.Type.html#repSplitAppTy_maybe"><span class="hs-identifier hs-var">repSplitAppTy_maybe</span></a></span><span> </span><span class="annot"><span class="annottext">Type
</span><a href="#local-6989586621681033732"><span class="hs-identifier hs-var">ty2</span></a></span><span>
</span><span id="line-2642"></span><span>      </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">Coercion -&gt; Coercion -&gt; Coercion
</span><a href="GHC.Core.Coercion.html#mkAppCo"><span class="hs-identifier hs-var">mkAppCo</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Type -&gt; Type -&gt; Coercion
</span><a href="#local-6989586621681033766"><span class="hs-identifier hs-var">go</span></a></span><span> </span><span class="annot"><span class="annottext">Type
</span><a href="#local-6989586621681033734"><span class="hs-identifier hs-var">ty1a</span></a></span><span> </span><span class="annot"><span class="annottext">Type
</span><a href="#local-6989586621681033731"><span class="hs-identifier hs-var">ty2a</span></a></span><span class="hs-special">)</span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Type -&gt; Type -&gt; Coercion
</span><a href="#local-6989586621681033766"><span class="hs-identifier hs-var">go</span></a></span><span> </span><span class="annot"><span class="annottext">Type
</span><a href="#local-6989586621681033733"><span class="hs-identifier hs-var">ty1b</span></a></span><span> </span><span class="annot"><span class="annottext">Type
</span><a href="#local-6989586621681033730"><span class="hs-identifier hs-var">ty2b</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-2643"></span><span>
</span><span id="line-2644"></span><span>    </span><span class="annot"><a href="#local-6989586621681033766"><span class="hs-identifier hs-var">go</span></a></span><span> </span><span id="local-6989586621681033728"><span class="annot"><span class="annottext">Type
</span><a href="#local-6989586621681033728"><span class="hs-identifier hs-var">ty1</span></a></span></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="GHC.Core.TyCo.Rep.html#AppTy"><span class="hs-identifier hs-type">AppTy</span></a></span><span> </span><span id="local-6989586621681033727"><span class="annot"><span class="annottext">Type
</span><a href="#local-6989586621681033727"><span class="hs-identifier hs-var">ty2a</span></a></span></span><span> </span><span id="local-6989586621681033726"><span class="annot"><span class="annottext">Type
</span><a href="#local-6989586621681033726"><span class="hs-identifier hs-var">ty2b</span></a></span></span><span class="hs-special">)</span><span>
</span><span id="line-2645"></span><span>      </span><span class="hs-glyph">|</span><span> </span><span class="annot"><a href="../../base-4.16.4.0/src/GHC-Maybe.html#Just"><span class="hs-identifier hs-type">Just</span></a></span><span> </span><span class="hs-special">(</span><span id="local-6989586621681033725"><span class="annot"><span class="annottext">Type
</span><a href="#local-6989586621681033725"><span class="hs-identifier hs-var">ty1a</span></a></span></span><span class="hs-special">,</span><span> </span><span id="local-6989586621681033724"><span class="annot"><span class="annottext">Type
</span><a href="#local-6989586621681033724"><span class="hs-identifier hs-var">ty1b</span></a></span></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">HasDebugCallStack =&gt; Type -&gt; Maybe (Type, Type)
</span><a href="GHC.Core.Type.html#repSplitAppTy_maybe"><span class="hs-identifier hs-var">repSplitAppTy_maybe</span></a></span><span> </span><span class="annot"><span class="annottext">Type
</span><a href="#local-6989586621681033728"><span class="hs-identifier hs-var">ty1</span></a></span><span>
</span><span id="line-2646"></span><span>      </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">Coercion -&gt; Coercion -&gt; Coercion
</span><a href="GHC.Core.Coercion.html#mkAppCo"><span class="hs-identifier hs-var">mkAppCo</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Type -&gt; Type -&gt; Coercion
</span><a href="#local-6989586621681033766"><span class="hs-identifier hs-var">go</span></a></span><span> </span><span class="annot"><span class="annottext">Type
</span><a href="#local-6989586621681033725"><span class="hs-identifier hs-var">ty1a</span></a></span><span> </span><span class="annot"><span class="annottext">Type
</span><a href="#local-6989586621681033727"><span class="hs-identifier hs-var">ty2a</span></a></span><span class="hs-special">)</span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Type -&gt; Type -&gt; Coercion
</span><a href="#local-6989586621681033766"><span class="hs-identifier hs-var">go</span></a></span><span> </span><span class="annot"><span class="annottext">Type
</span><a href="#local-6989586621681033724"><span class="hs-identifier hs-var">ty1b</span></a></span><span> </span><span class="annot"><span class="annottext">Type
</span><a href="#local-6989586621681033726"><span class="hs-identifier hs-var">ty2b</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-2647"></span><span>
</span><span id="line-2648"></span><span>    </span><span class="annot"><a href="#local-6989586621681033766"><span class="hs-identifier hs-var">go</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="GHC.Core.TyCo.Rep.html#ForAllTy"><span class="hs-identifier hs-type">ForAllTy</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="GHC.Types.Var.html#Bndr"><span class="hs-identifier hs-type">Bndr</span></a></span><span> </span><span id="local-6989586621681033723"><span class="annot"><span class="annottext">CoVar
</span><a href="#local-6989586621681033723"><span class="hs-identifier hs-var">tv1</span></a></span></span><span> </span><span id="local-6989586621681033722"><span class="annot"><span class="annottext">ArgFlag
</span><a href="#local-6989586621681033722"><span class="hs-identifier hs-var">_flag1</span></a></span></span><span class="hs-special">)</span><span> </span><span id="local-6989586621681033721"><span class="annot"><span class="annottext">Type
</span><a href="#local-6989586621681033721"><span class="hs-identifier hs-var">ty1</span></a></span></span><span class="hs-special">)</span><span> </span><span class="hs-special">(</span><span class="annot"><a href="GHC.Core.TyCo.Rep.html#ForAllTy"><span class="hs-identifier hs-type">ForAllTy</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="GHC.Types.Var.html#Bndr"><span class="hs-identifier hs-type">Bndr</span></a></span><span> </span><span id="local-6989586621681033720"><span class="annot"><span class="annottext">CoVar
</span><a href="#local-6989586621681033720"><span class="hs-identifier hs-var">tv2</span></a></span></span><span> </span><span id="local-6989586621681033719"><span class="annot"><span class="annottext">ArgFlag
</span><a href="#local-6989586621681033719"><span class="hs-identifier hs-var">_flag2</span></a></span></span><span class="hs-special">)</span><span> </span><span id="local-6989586621681033718"><span class="annot"><span class="annottext">Type
</span><a href="#local-6989586621681033718"><span class="hs-identifier hs-var">ty2</span></a></span></span><span class="hs-special">)</span><span>
</span><span id="line-2649"></span><span>      </span><span class="hs-glyph">|</span><span> </span><span class="annot"><span class="annottext">CoVar -&gt; Bool
</span><a href="GHC.Types.Var.html#isTyVar"><span class="hs-identifier hs-var">isTyVar</span></a></span><span> </span><span class="annot"><span class="annottext">CoVar
</span><a href="#local-6989586621681033723"><span class="hs-identifier hs-var">tv1</span></a></span><span>
</span><span id="line-2650"></span><span>      </span><span class="hs-glyph">=</span><span> </span><span class="hs-identifier">ASSERT</span><span class="hs-special">(</span><span> </span><span class="hs-identifier">isTyVar</span><span> </span><span class="hs-identifier">tv2</span><span> </span><span class="hs-special">)</span><span>
</span><span id="line-2651"></span><span>        </span><span class="annot"><span class="annottext">CoVar -&gt; Coercion -&gt; Coercion -&gt; Coercion
</span><a href="GHC.Core.Coercion.html#mkForAllCo"><span class="hs-identifier hs-var">mkForAllCo</span></a></span><span> </span><span class="annot"><span class="annottext">CoVar
</span><a href="#local-6989586621681033723"><span class="hs-identifier hs-var">tv1</span></a></span><span> </span><span class="annot"><span class="annottext">Coercion
</span><a href="#local-6989586621681033717"><span class="hs-identifier hs-var">kind_co</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Type -&gt; Type -&gt; Coercion
</span><a href="#local-6989586621681033766"><span class="hs-identifier hs-var">go</span></a></span><span> </span><span class="annot"><span class="annottext">Type
</span><a href="#local-6989586621681033721"><span class="hs-identifier hs-var">ty1</span></a></span><span> </span><span class="annot"><span class="annottext">Type
</span><a href="#local-6989586621681033716"><span class="hs-identifier hs-var">ty2'</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-2652"></span><span>      </span><span class="hs-keyword">where</span><span> </span><span id="local-6989586621681033717"><span class="annot"><span class="annottext">kind_co :: Coercion
</span><a href="#local-6989586621681033717"><span class="hs-identifier hs-var hs-var">kind_co</span></a></span></span><span>  </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">Type -&gt; Type -&gt; Coercion
</span><a href="#local-6989586621681033766"><span class="hs-identifier hs-var">go</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">CoVar -&gt; Type
</span><a href="GHC.Types.Var.html#tyVarKind"><span class="hs-identifier hs-var">tyVarKind</span></a></span><span> </span><span class="annot"><span class="annottext">CoVar
</span><a href="#local-6989586621681033723"><span class="hs-identifier hs-var">tv1</span></a></span><span class="hs-special">)</span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">CoVar -&gt; Type
</span><a href="GHC.Types.Var.html#tyVarKind"><span class="hs-identifier hs-var">tyVarKind</span></a></span><span> </span><span class="annot"><span class="annottext">CoVar
</span><a href="#local-6989586621681033720"><span class="hs-identifier hs-var">tv2</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-2653"></span><span>            </span><span id="local-6989586621681033715"><span class="annot"><span class="annottext">in_scope :: InScopeSet
</span><a href="#local-6989586621681033715"><span class="hs-identifier hs-var hs-var">in_scope</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">VarSet -&gt; InScopeSet
</span><a href="GHC.Types.Var.Env.html#mkInScopeSet"><span class="hs-identifier hs-var">mkInScopeSet</span></a></span><span> </span><span class="annot"><span class="annottext">forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><a href="../../base-4.16.4.0/src/GHC-Base.html#%24"><span class="hs-operator hs-var">$</span></a></span><span> </span><span class="annot"><span class="annottext">Type -&gt; VarSet
</span><a href="GHC.Core.TyCo.FVs.html#tyCoVarsOfType"><span class="hs-identifier hs-var">tyCoVarsOfType</span></a></span><span> </span><span class="annot"><span class="annottext">Type
</span><a href="#local-6989586621681033718"><span class="hs-identifier hs-var">ty2</span></a></span><span> </span><span class="annot"><span class="annottext">VarSet -&gt; VarSet -&gt; VarSet
</span><a href="GHC.Types.Var.Set.html#unionVarSet"><span class="hs-operator hs-var">`unionVarSet`</span></a></span><span> </span><span class="annot"><span class="annottext">Coercion -&gt; VarSet
</span><a href="GHC.Core.TyCo.FVs.html#tyCoVarsOfCo"><span class="hs-identifier hs-var">tyCoVarsOfCo</span></a></span><span> </span><span class="annot"><span class="annottext">Coercion
</span><a href="#local-6989586621681033717"><span class="hs-identifier hs-var">kind_co</span></a></span><span>
</span><span id="line-2654"></span><span>            </span><span id="local-6989586621681033716"><span class="annot"><span class="annottext">ty2' :: Type
</span><a href="#local-6989586621681033716"><span class="hs-identifier hs-var hs-var">ty2'</span></a></span></span><span>     </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">InScopeSet -&gt; [CoVar] -&gt; [Type] -&gt; Type -&gt; Type
</span><a href="GHC.Core.TyCo.Subst.html#substTyWithInScope"><span class="hs-identifier hs-var">substTyWithInScope</span></a></span><span> </span><span class="annot"><span class="annottext">InScopeSet
</span><a href="#local-6989586621681033715"><span class="hs-identifier hs-var">in_scope</span></a></span><span> </span><span class="hs-special">[</span><span class="annot"><span class="annottext">CoVar
</span><a href="#local-6989586621681033720"><span class="hs-identifier hs-var">tv2</span></a></span><span class="hs-special">]</span><span>
</span><span id="line-2655"></span><span>                         </span><span class="hs-special">[</span><span class="annot"><span class="annottext">CoVar -&gt; Type
</span><a href="GHC.Core.TyCo.Rep.html#mkTyVarTy"><span class="hs-identifier hs-var">mkTyVarTy</span></a></span><span> </span><span class="annot"><span class="annottext">CoVar
</span><a href="#local-6989586621681033723"><span class="hs-identifier hs-var">tv1</span></a></span><span> </span><span class="annot"><span class="annottext">Type -&gt; Coercion -&gt; Type
</span><a href="GHC.Core.Type.html#mkCastTy"><span class="hs-operator hs-var">`mkCastTy`</span></a></span><span> </span><span class="annot"><span class="annottext">Coercion
</span><a href="#local-6989586621681033717"><span class="hs-identifier hs-var">kind_co</span></a></span><span class="hs-special">]</span><span>
</span><span id="line-2656"></span><span>                         </span><span class="annot"><span class="annottext">Type
</span><a href="#local-6989586621681033718"><span class="hs-identifier hs-var">ty2</span></a></span><span>
</span><span id="line-2657"></span><span>
</span><span id="line-2658"></span><span>    </span><span class="annot"><a href="#local-6989586621681033766"><span class="hs-identifier hs-var">go</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="GHC.Core.TyCo.Rep.html#ForAllTy"><span class="hs-identifier hs-type">ForAllTy</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="GHC.Types.Var.html#Bndr"><span class="hs-identifier hs-type">Bndr</span></a></span><span> </span><span id="local-6989586621681033712"><span class="annot"><span class="annottext">CoVar
</span><a href="#local-6989586621681033712"><span class="hs-identifier hs-var">cv1</span></a></span></span><span> </span><span id="local-6989586621681033711"><span class="annot"><span class="annottext">ArgFlag
</span><a href="#local-6989586621681033711"><span class="hs-identifier hs-var">_flag1</span></a></span></span><span class="hs-special">)</span><span> </span><span id="local-6989586621681033710"><span class="annot"><span class="annottext">Type
</span><a href="#local-6989586621681033710"><span class="hs-identifier hs-var">ty1</span></a></span></span><span class="hs-special">)</span><span> </span><span class="hs-special">(</span><span class="annot"><a href="GHC.Core.TyCo.Rep.html#ForAllTy"><span class="hs-identifier hs-type">ForAllTy</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="GHC.Types.Var.html#Bndr"><span class="hs-identifier hs-type">Bndr</span></a></span><span> </span><span id="local-6989586621681033709"><span class="annot"><span class="annottext">CoVar
</span><a href="#local-6989586621681033709"><span class="hs-identifier hs-var">cv2</span></a></span></span><span> </span><span id="local-6989586621681033708"><span class="annot"><span class="annottext">ArgFlag
</span><a href="#local-6989586621681033708"><span class="hs-identifier hs-var">_flag2</span></a></span></span><span class="hs-special">)</span><span> </span><span id="local-6989586621681033707"><span class="annot"><span class="annottext">Type
</span><a href="#local-6989586621681033707"><span class="hs-identifier hs-var">ty2</span></a></span></span><span class="hs-special">)</span><span>
</span><span id="line-2659"></span><span>      </span><span class="hs-glyph">=</span><span> </span><span class="hs-identifier">ASSERT</span><span class="hs-special">(</span><span> </span><span class="hs-identifier">isCoVar</span><span> </span><span class="hs-identifier">cv1</span><span> </span><span class="hs-operator">&amp;&amp;</span><span> </span><span class="hs-identifier">isCoVar</span><span> </span><span class="hs-identifier">cv2</span><span> </span><span class="hs-special">)</span><span>
</span><span id="line-2660"></span><span>        </span><span class="annot"><span class="annottext">CoVar -&gt; Coercion -&gt; Coercion -&gt; Coercion
</span><a href="GHC.Core.Coercion.html#mkForAllCo"><span class="hs-identifier hs-var">mkForAllCo</span></a></span><span> </span><span class="annot"><span class="annottext">CoVar
</span><a href="#local-6989586621681033712"><span class="hs-identifier hs-var">cv1</span></a></span><span> </span><span class="annot"><span class="annottext">Coercion
</span><a href="#local-6989586621681033706"><span class="hs-identifier hs-var">kind_co</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Type -&gt; Type -&gt; Coercion
</span><a href="#local-6989586621681033766"><span class="hs-identifier hs-var">go</span></a></span><span> </span><span class="annot"><span class="annottext">Type
</span><a href="#local-6989586621681033710"><span class="hs-identifier hs-var">ty1</span></a></span><span> </span><span class="annot"><span class="annottext">Type
</span><a href="#local-6989586621681033705"><span class="hs-identifier hs-var">ty2'</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-2661"></span><span>      </span><span class="hs-keyword">where</span><span> </span><span id="local-6989586621681033704"><span class="annot"><span class="annottext">s1 :: Type
</span><a href="#local-6989586621681033704"><span class="hs-identifier hs-var hs-var">s1</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">CoVar -&gt; Type
</span><a href="GHC.Types.Var.html#varType"><span class="hs-identifier hs-var">varType</span></a></span><span> </span><span class="annot"><span class="annottext">CoVar
</span><a href="#local-6989586621681033712"><span class="hs-identifier hs-var">cv1</span></a></span><span>
</span><span id="line-2662"></span><span>            </span><span id="local-6989586621681033703"><span class="annot"><span class="annottext">s2 :: Type
</span><a href="#local-6989586621681033703"><span class="hs-identifier hs-var hs-var">s2</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">CoVar -&gt; Type
</span><a href="GHC.Types.Var.html#varType"><span class="hs-identifier hs-var">varType</span></a></span><span> </span><span class="annot"><span class="annottext">CoVar
</span><a href="#local-6989586621681033709"><span class="hs-identifier hs-var">cv2</span></a></span><span>
</span><span id="line-2663"></span><span>            </span><span id="local-6989586621681033706"><span class="annot"><span class="annottext">kind_co :: Coercion
</span><a href="#local-6989586621681033706"><span class="hs-identifier hs-var hs-var">kind_co</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">Type -&gt; Type -&gt; Coercion
</span><a href="#local-6989586621681033766"><span class="hs-identifier hs-var">go</span></a></span><span> </span><span class="annot"><span class="annottext">Type
</span><a href="#local-6989586621681033704"><span class="hs-identifier hs-var">s1</span></a></span><span> </span><span class="annot"><span class="annottext">Type
</span><a href="#local-6989586621681033703"><span class="hs-identifier hs-var">s2</span></a></span><span>
</span><span id="line-2664"></span><span>
</span><span id="line-2665"></span><span>            </span><span class="hs-comment">-- s1 = t1 ~r t2</span><span>
</span><span id="line-2666"></span><span>            </span><span class="hs-comment">-- s2 = t3 ~r t4</span><span>
</span><span id="line-2667"></span><span>            </span><span class="hs-comment">-- kind_co :: (t1 ~r t2) ~N (t3 ~r t4)</span><span>
</span><span id="line-2668"></span><span>            </span><span class="hs-comment">-- eta1 :: t1 ~r t3</span><span>
</span><span id="line-2669"></span><span>            </span><span class="hs-comment">-- eta2 :: t2 ~r t4</span><span>
</span><span id="line-2670"></span><span>
</span><span id="line-2671"></span><span>            </span><span id="local-6989586621681033702"><span class="annot"><span class="annottext">r :: Role
</span><a href="#local-6989586621681033702"><span class="hs-identifier hs-var hs-var">r</span></a></span></span><span>    </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">CoVar -&gt; Role
</span><a href="GHC.Core.Coercion.html#coVarRole"><span class="hs-identifier hs-var">coVarRole</span></a></span><span> </span><span class="annot"><span class="annottext">CoVar
</span><a href="#local-6989586621681033712"><span class="hs-identifier hs-var">cv1</span></a></span><span>
</span><span id="line-2672"></span><span>            </span><span id="local-6989586621681033701"><span class="annot"><span class="annottext">kind_co' :: Coercion
</span><a href="#local-6989586621681033701"><span class="hs-identifier hs-var hs-var">kind_co'</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">Role -&gt; Role -&gt; Coercion -&gt; Coercion
</span><a href="GHC.Core.Coercion.html#downgradeRole"><span class="hs-identifier hs-var">downgradeRole</span></a></span><span> </span><span class="annot"><span class="annottext">Role
</span><a href="#local-6989586621681033702"><span class="hs-identifier hs-var">r</span></a></span><span> </span><span class="annot"><span class="annottext">Role
</span><a href="GHC.Core.Coercion.Axiom.html#Nominal"><span class="hs-identifier hs-var">Nominal</span></a></span><span> </span><span class="annot"><span class="annottext">Coercion
</span><a href="#local-6989586621681033706"><span class="hs-identifier hs-var">kind_co</span></a></span><span>
</span><span id="line-2673"></span><span>            </span><span id="local-6989586621681033700"><span class="annot"><span class="annottext">eta1 :: Coercion
</span><a href="#local-6989586621681033700"><span class="hs-identifier hs-var hs-var">eta1</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">HasDebugCallStack =&gt; Role -&gt; Int -&gt; Coercion -&gt; Coercion
</span><a href="GHC.Core.Coercion.html#mkNthCo"><span class="hs-identifier hs-var">mkNthCo</span></a></span><span> </span><span class="annot"><span class="annottext">Role
</span><a href="#local-6989586621681033702"><span class="hs-identifier hs-var">r</span></a></span><span> </span><span class="annot"><span class="annottext">Int
</span><span class="hs-number">2</span></span><span> </span><span class="annot"><span class="annottext">Coercion
</span><a href="#local-6989586621681033701"><span class="hs-identifier hs-var">kind_co'</span></a></span><span>
</span><span id="line-2674"></span><span>            </span><span id="local-6989586621681033699"><span class="annot"><span class="annottext">eta2 :: Coercion
</span><a href="#local-6989586621681033699"><span class="hs-identifier hs-var hs-var">eta2</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">HasDebugCallStack =&gt; Role -&gt; Int -&gt; Coercion -&gt; Coercion
</span><a href="GHC.Core.Coercion.html#mkNthCo"><span class="hs-identifier hs-var">mkNthCo</span></a></span><span> </span><span class="annot"><span class="annottext">Role
</span><a href="#local-6989586621681033702"><span class="hs-identifier hs-var">r</span></a></span><span> </span><span class="annot"><span class="annottext">Int
</span><span class="hs-number">3</span></span><span> </span><span class="annot"><span class="annottext">Coercion
</span><a href="#local-6989586621681033701"><span class="hs-identifier hs-var">kind_co'</span></a></span><span>
</span><span id="line-2675"></span><span>
</span><span id="line-2676"></span><span>            </span><span id="local-6989586621681033698"><span class="annot"><span class="annottext">subst :: TCvSubst
</span><a href="#local-6989586621681033698"><span class="hs-identifier hs-var hs-var">subst</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">InScopeSet -&gt; TCvSubst
</span><a href="GHC.Core.TyCo.Subst.html#mkEmptyTCvSubst"><span class="hs-identifier hs-var">mkEmptyTCvSubst</span></a></span><span> </span><span class="annot"><span class="annottext">forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><a href="../../base-4.16.4.0/src/GHC-Base.html#%24"><span class="hs-operator hs-var">$</span></a></span><span> </span><span class="annot"><span class="annottext">VarSet -&gt; InScopeSet
</span><a href="GHC.Types.Var.Env.html#mkInScopeSet"><span class="hs-identifier hs-var">mkInScopeSet</span></a></span><span> </span><span class="annot"><span class="annottext">forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><a href="../../base-4.16.4.0/src/GHC-Base.html#%24"><span class="hs-operator hs-var">$</span></a></span><span>
</span><span id="line-2677"></span><span>                      </span><span class="annot"><span class="annottext">Type -&gt; VarSet
</span><a href="GHC.Core.TyCo.FVs.html#tyCoVarsOfType"><span class="hs-identifier hs-var">tyCoVarsOfType</span></a></span><span> </span><span class="annot"><span class="annottext">Type
</span><a href="#local-6989586621681033707"><span class="hs-identifier hs-var">ty2</span></a></span><span> </span><span class="annot"><span class="annottext">VarSet -&gt; VarSet -&gt; VarSet
</span><a href="GHC.Types.Var.Set.html#unionVarSet"><span class="hs-operator hs-var">`unionVarSet`</span></a></span><span> </span><span class="annot"><span class="annottext">Coercion -&gt; VarSet
</span><a href="GHC.Core.TyCo.FVs.html#tyCoVarsOfCo"><span class="hs-identifier hs-var">tyCoVarsOfCo</span></a></span><span> </span><span class="annot"><span class="annottext">Coercion
</span><a href="#local-6989586621681033706"><span class="hs-identifier hs-var">kind_co</span></a></span><span>
</span><span id="line-2678"></span><span>            </span><span id="local-6989586621681033705"><span class="annot"><span class="annottext">ty2' :: Type
</span><a href="#local-6989586621681033705"><span class="hs-identifier hs-var hs-var">ty2'</span></a></span></span><span>  </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">HasCallStack =&gt; TCvSubst -&gt; Type -&gt; Type
</span><a href="GHC.Core.TyCo.Subst.html#substTy"><span class="hs-identifier hs-var">substTy</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">TCvSubst -&gt; CoVar -&gt; Coercion -&gt; TCvSubst
</span><a href="GHC.Core.TyCo.Subst.html#extendCvSubst"><span class="hs-identifier hs-var">extendCvSubst</span></a></span><span> </span><span class="annot"><span class="annottext">TCvSubst
</span><a href="#local-6989586621681033698"><span class="hs-identifier hs-var">subst</span></a></span><span> </span><span class="annot"><span class="annottext">CoVar
</span><a href="#local-6989586621681033709"><span class="hs-identifier hs-var">cv2</span></a></span><span> </span><span class="annot"><span class="annottext">forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><a href="../../base-4.16.4.0/src/GHC-Base.html#%24"><span class="hs-operator hs-var">$</span></a></span><span> </span><span class="annot"><span class="annottext">Coercion -&gt; Coercion
</span><a href="GHC.Core.Coercion.html#mkSymCo"><span class="hs-identifier hs-var">mkSymCo</span></a></span><span> </span><span class="annot"><span class="annottext">Coercion
</span><a href="#local-6989586621681033700"><span class="hs-identifier hs-var">eta1</span></a></span><span> </span><span class="annot"><span class="annottext">Coercion -&gt; Coercion -&gt; Coercion
</span><a href="GHC.Core.Coercion.html#mkTransCo"><span class="hs-operator hs-var">`mkTransCo`</span></a></span><span>
</span><span id="line-2679"></span><span>                                                       </span><span class="annot"><span class="annottext">CoVar -&gt; Coercion
</span><a href="GHC.Core.Coercion.html#mkCoVarCo"><span class="hs-identifier hs-var">mkCoVarCo</span></a></span><span> </span><span class="annot"><span class="annottext">CoVar
</span><a href="#local-6989586621681033712"><span class="hs-identifier hs-var">cv1</span></a></span><span> </span><span class="annot"><span class="annottext">Coercion -&gt; Coercion -&gt; Coercion
</span><a href="GHC.Core.Coercion.html#mkTransCo"><span class="hs-operator hs-var">`mkTransCo`</span></a></span><span>
</span><span id="line-2680"></span><span>                                                       </span><span class="annot"><span class="annottext">Coercion
</span><a href="#local-6989586621681033699"><span class="hs-identifier hs-var">eta2</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-2681"></span><span>                            </span><span class="annot"><span class="annottext">Type
</span><a href="#local-6989586621681033707"><span class="hs-identifier hs-var">ty2</span></a></span><span>
</span><span id="line-2682"></span><span>
</span><span id="line-2683"></span><span>    </span><span class="annot"><a href="#local-6989586621681033766"><span class="hs-identifier hs-var">go</span></a></span><span> </span><span id="local-6989586621681033697"><span class="annot"><span class="annottext">ty1 :: Type
</span><a href="#local-6989586621681033697"><span class="hs-identifier hs-var">ty1</span></a></span></span><span class="hs-glyph">@</span><span class="hs-special">(</span><span class="annot"><a href="GHC.Core.TyCo.Rep.html#LitTy"><span class="hs-identifier hs-type">LitTy</span></a></span><span> </span><span id="local-6989586621681033696"><span class="annot"><span class="annottext">TyLit
</span><a href="#local-6989586621681033696"><span class="hs-identifier hs-var">lit1</span></a></span></span><span class="hs-special">)</span><span> </span><span id="local-6989586621681033695"><span class="annot"><span class="annottext">Type
</span><a href="#local-6989586621681033695"><span class="hs-identifier hs-var">_lit2</span></a></span></span><span>
</span><span id="line-2684"></span><span>      </span><span class="hs-glyph">=</span><span> </span><span class="hs-identifier">ASSERT</span><span class="hs-special">(</span><span> </span><span class="hs-keyword">case</span><span> </span><span class="hs-identifier">_lit2</span><span> </span><span class="hs-keyword">of</span><span>
</span><span id="line-2685"></span><span>                  </span><span class="hs-special">{</span><span> </span><span class="hs-identifier">LitTy</span><span> </span><span class="hs-identifier">lit2</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-identifier">lit1</span><span> </span><span class="hs-operator">==</span><span> </span><span class="hs-identifier">lit2</span><span>
</span><span id="line-2686"></span><span>                  </span><span class="hs-special">;</span><span> </span><span class="hs-identifier">_</span><span>          </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-identifier">False</span><span>        </span><span class="hs-special">}</span><span> </span><span class="hs-special">)</span><span>
</span><span id="line-2687"></span><span>        </span><span class="annot"><span class="annottext">Type -&gt; Coercion
</span><a href="GHC.Core.Coercion.html#mkNomReflCo"><span class="hs-identifier hs-var">mkNomReflCo</span></a></span><span> </span><span class="annot"><span class="annottext">Type
</span><a href="#local-6989586621681033697"><span class="hs-identifier hs-var">ty1</span></a></span><span>
</span><span id="line-2688"></span><span>
</span><span id="line-2689"></span><span>    </span><span class="annot"><a href="#local-6989586621681033766"><span class="hs-identifier hs-var">go</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="GHC.Core.TyCo.Rep.html#CoercionTy"><span class="hs-identifier hs-type">CoercionTy</span></a></span><span> </span><span id="local-6989586621681033693"><span class="annot"><span class="annottext">Coercion
</span><a href="#local-6989586621681033693"><span class="hs-identifier hs-var">co1</span></a></span></span><span class="hs-special">)</span><span> </span><span class="hs-special">(</span><span class="annot"><a href="GHC.Core.TyCo.Rep.html#CoercionTy"><span class="hs-identifier hs-type">CoercionTy</span></a></span><span> </span><span id="local-6989586621681033692"><span class="annot"><span class="annottext">Coercion
</span><a href="#local-6989586621681033692"><span class="hs-identifier hs-var">co2</span></a></span></span><span class="hs-special">)</span><span>
</span><span id="line-2690"></span><span>      </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">Role -&gt; Coercion -&gt; Coercion -&gt; Coercion -&gt; Coercion
</span><a href="GHC.Core.Coercion.html#mkProofIrrelCo"><span class="hs-identifier hs-var">mkProofIrrelCo</span></a></span><span> </span><span class="annot"><span class="annottext">Role
</span><a href="GHC.Core.Coercion.Axiom.html#Nominal"><span class="hs-identifier hs-var">Nominal</span></a></span><span> </span><span class="annot"><span class="annottext">Coercion
</span><a href="#local-6989586621681033691"><span class="hs-identifier hs-var">kind_co</span></a></span><span> </span><span class="annot"><span class="annottext">Coercion
</span><a href="#local-6989586621681033693"><span class="hs-identifier hs-var">co1</span></a></span><span> </span><span class="annot"><span class="annottext">Coercion
</span><a href="#local-6989586621681033692"><span class="hs-identifier hs-var">co2</span></a></span><span>
</span><span id="line-2691"></span><span>      </span><span class="hs-keyword">where</span><span>
</span><span id="line-2692"></span><span>        </span><span id="local-6989586621681033691"><span class="annot"><span class="annottext">kind_co :: Coercion
</span><a href="#local-6989586621681033691"><span class="hs-identifier hs-var hs-var">kind_co</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">Type -&gt; Type -&gt; Coercion
</span><a href="#local-6989586621681033766"><span class="hs-identifier hs-var">go</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Coercion -&gt; Type
</span><a href="GHC.Core.Coercion.html#coercionType"><span class="hs-identifier hs-var">coercionType</span></a></span><span> </span><span class="annot"><span class="annottext">Coercion
</span><a href="#local-6989586621681033693"><span class="hs-identifier hs-var">co1</span></a></span><span class="hs-special">)</span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Coercion -&gt; Type
</span><a href="GHC.Core.Coercion.html#coercionType"><span class="hs-identifier hs-var">coercionType</span></a></span><span> </span><span class="annot"><span class="annottext">Coercion
</span><a href="#local-6989586621681033692"><span class="hs-identifier hs-var">co2</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-2693"></span><span>
</span><span id="line-2694"></span><span>    </span><span class="annot"><a href="#local-6989586621681033766"><span class="hs-identifier hs-var">go</span></a></span><span> </span><span id="local-6989586621681033690"><span class="annot"><span class="annottext">Type
</span><a href="#local-6989586621681033690"><span class="hs-identifier hs-var">ty1</span></a></span></span><span> </span><span id="local-6989586621681033689"><span class="annot"><span class="annottext">Type
</span><a href="#local-6989586621681033689"><span class="hs-identifier hs-var">ty2</span></a></span></span><span>
</span><span id="line-2695"></span><span>      </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">forall a. HasCallStack =&gt; String -&gt; SDoc -&gt; a
</span><a href="GHC.Utils.Panic.html#pprPanic"><span class="hs-identifier hs-var">pprPanic</span></a></span><span> </span><span class="annot"><span class="annottext">String
</span><span class="hs-string">&quot;buildKindCoercion&quot;</span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">[SDoc] -&gt; SDoc
</span><a href="GHC.Utils.Outputable.html#vcat"><span class="hs-identifier hs-var">vcat</span></a></span><span> </span><span class="hs-special">[</span><span> </span><span class="annot"><span class="annottext">forall a. Outputable a =&gt; a -&gt; SDoc
</span><a href="GHC.Utils.Outputable.html#ppr"><span class="hs-identifier hs-var">ppr</span></a></span><span> </span><span class="annot"><span class="annottext">Type
</span><a href="#local-6989586621681033768"><span class="hs-identifier hs-var">orig_ty1</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">forall a. Outputable a =&gt; a -&gt; SDoc
</span><a href="GHC.Utils.Outputable.html#ppr"><span class="hs-identifier hs-var">ppr</span></a></span><span> </span><span class="annot"><span class="annottext">Type
</span><a href="#local-6989586621681033767"><span class="hs-identifier hs-var">orig_ty2</span></a></span><span>
</span><span id="line-2696"></span><span>                                           </span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">forall a. Outputable a =&gt; a -&gt; SDoc
</span><a href="GHC.Utils.Outputable.html#ppr"><span class="hs-identifier hs-var">ppr</span></a></span><span> </span><span class="annot"><span class="annottext">Type
</span><a href="#local-6989586621681033690"><span class="hs-identifier hs-var">ty1</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">forall a. Outputable a =&gt; a -&gt; SDoc
</span><a href="GHC.Utils.Outputable.html#ppr"><span class="hs-identifier hs-var">ppr</span></a></span><span> </span><span class="annot"><span class="annottext">Type
</span><a href="#local-6989586621681033689"><span class="hs-identifier hs-var">ty2</span></a></span><span> </span><span class="hs-special">]</span><span class="hs-special">)</span><span>
</span><span id="line-2697"></span><span>
</span><span id="line-2698"></span><span class="hs-comment">{-
%************************************************************************
%*                                                                      *
       Simplifying types
%*                                                                      *
%************************************************************************

The function below morally belongs in GHC.Tc.Solver.Rewrite, but it is used also in
FamInstEnv, and so lives here.

Note [simplifyArgsWorker]
~~~~~~~~~~~~~~~~~~~~~~~~~
Invariant (F2) of Note [Rewriting] in GHC.Tc.Solver.Rewrite says that
rewriting is homogeneous.
This causes some trouble when rewriting a function applied to a telescope
of arguments, perhaps with dependency. For example, suppose

  type family F :: forall (j :: Type) (k :: Type). Maybe j -&gt; Either j k -&gt; Bool -&gt; [k]

and we wish to rewrite the args of (with kind applications explicit)

  F a b (Just a c) (Right a b d) False

where all variables are skolems and

  a :: Type
  b :: Type
  c :: a
  d :: k

  [G] aco :: a ~ fa
  [G] bco :: b ~ fb
  [G] cco :: c ~ fc
  [G] dco :: d ~ fd

The first step is to rewrite all the arguments. This is done before calling
simplifyArgsWorker. We start from

  a
  b
  Just a c
  Right a b d
  False

and get

  (fa,                             co1 :: fa ~ a)
  (fb,                             co2 :: fb ~ b)
  (Just fa (fc |&gt; aco) |&gt; co6,     co3 :: (Just fa (fc |&gt; aco) |&gt; co6) ~ (Just a c))
  (Right fa fb (fd |&gt; bco) |&gt; co7, co4 :: (Right fa fb (fd |&gt; bco) |&gt; co7) ~ (Right a b d))
  (False,                          co5 :: False ~ False)

where
  co6 :: Maybe fa ~ Maybe a
  co7 :: Either fa fb ~ Either a b

We now process the rewritten args in left-to-right order. The first two args
need no further processing. But now consider the third argument. Let f3 = the rewritten
result, Just fa (fc |&gt; aco) |&gt; co6.
This f3 rewritten argument has kind (Maybe a), due to
(F2). And yet, when we build the application (F fa fb ...), we need this
argument to have kind (Maybe fa), not (Maybe a). We must cast this argument.
The coercion to use is
determined by the kind of F: we see in F's kind that the third argument has
kind Maybe j. Critically, we also know that the argument corresponding to j
(in our example, a) rewrote with a coercion co1. We can thus know the
coercion needed for the 3rd argument is (Maybe (sym co1)), thus building
(f3 |&gt; Maybe (sym co1))

More generally, we must use the Lifting Lemma, as implemented in
Coercion.liftCoSubst. As we work left-to-right, any variable that is a
dependent parameter (j and k, in our example) gets mapped in a lifting context
to the coercion that is output from rewriting the corresponding argument (co1
and co2, in our example). Then, after rewriting later arguments, we lift the
kind of these arguments in the lifting context that we've be building up.
This coercion is then used to keep the result of rewriting well-kinded.

Working through our example, this is what happens:

  1. Extend the (empty) LC with [j |-&gt; co1]. No new casting must be done,
     because the binder associated with the first argument has a closed type (no
     variables).

  2. Extend the LC with [k |-&gt; co2]. No casting to do.

  3. Lifting the kind (Maybe j) with our LC
     yields co8 :: Maybe fa ~ Maybe a. Use (f3 |&gt; sym co8) as the argument to
     F.

  4. Lifting the kind (Either j k) with our LC
     yields co9 :: Either fa fb ~ Either a b. Use (f4 |&gt; sym co9) as the 4th
     argument to F, where f4 is the rewritten form of argument 4, written above.

  5. We lift Bool with our LC, getting &lt;Bool&gt;;
     casting has no effect.

We're now almost done, but the new application (F fa fb (f3 |&gt; sym co8) (f4 &gt; sym co9) False)
has the wrong kind. Its kind is [fb], instead of the original [b].
So we must use our LC one last time to lift the result kind [k],
getting res_co :: [fb] ~ [b], and we cast our result.

Accordingly, the final result is

  F fa fb (Just fa (fc |&gt; aco) |&gt; Maybe (sym aco) |&gt; sym (Maybe (sym aco)))
          (Right fa fb (fd |&gt; bco) |&gt; Either (sym aco) (sym bco) |&gt; sym (Either (sym aco) (sym bco)))
          False
            |&gt; [sym bco]

The res_co (in this case, [sym bco])
is returned as the third return value from simplifyArgsWorker.

Note [Last case in simplifyArgsWorker]
~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~
In writing simplifyArgsWorker's `go`, we know here that args cannot be empty,
because that case is first. We've run out of
binders. But perhaps inner_ki is a tyvar that has been instantiated with a
&#928;-type.

Here is an example.

  a :: forall (k :: Type). k -&gt; k
  type family Star
  Proxy :: forall j. j -&gt; Type
  axStar :: Star ~ Type
  type family NoWay :: Bool
  axNoWay :: NoWay ~ False
  bo :: Type
  [G] bc :: bo ~ Bool   (in inert set)

  co :: (forall j. j -&gt; Type) ~ (forall (j :: Star). (j |&gt; axStar) -&gt; Star)
  co = forall (j :: sym axStar). (&lt;j&gt; -&gt; sym axStar)

  We are rewriting:
  a (forall (j :: Star). (j |&gt; axStar) -&gt; Star)   -- 1
    (Proxy |&gt; co)                                 -- 2
    (bo |&gt; sym axStar)                            -- 3
    (NoWay |&gt; sym bc)                             -- 4
      :: Star

First, we rewrite all the arguments (before simplifyArgsWorker), like so:

    (forall j. j -&gt; Type, co1 :: (forall j. j -&gt; Type) ~
                                 (forall (j :: Star). (j |&gt; axStar) -&gt; Star))  -- 1
    (Proxy |&gt; co,         co2 :: (Proxy |&gt; co) ~ (Proxy |&gt; co))                -- 2
    (Bool |&gt; sym axStar,  co3 :: (Bool |&gt; sym axStar) ~ (bo |&gt; sym axStar))    -- 3
    (False |&gt; sym bc,     co4 :: (False |&gt; sym bc) ~ (NoWay |&gt; sym bc))        -- 4

Then we do the process described in Note [simplifyArgsWorker].

1. Lifting Type (the kind of the first arg) gives us a reflexive coercion, so we
   don't use it. But we do build a lifting context [k -&gt; co1] (where co1 is a
   result of rewriting an argument, written above).

2. Lifting k gives us co1, so the second argument becomes (Proxy |&gt; co |&gt; sym co1).
   This is not a dependent argument, so we don't extend the lifting context.

Now we need to deal with argument (3).
The way we normally proceed is to lift the kind of the binder, to see whether
it's dependent.
But here, the remainder of the kind of `a` that we're left with
after processing two arguments is just `k`.

The way forward is look up k in the lifting context, getting co1. If we're at
all well-typed, co1 will be a coercion between &#928;-types, with at least one binder.
So, let's
decompose co1 with decomposePiCos. This decomposition needs arguments to use
to instantiate any kind parameters. Look at the type of co1. If we just
decomposed it, we would end up with coercions whose types include j, which is
out of scope here. Accordingly, decomposePiCos takes a list of types whose
kinds are the *right-hand* types in the decomposed coercion. (See comments on
decomposePiCos.) Because the rewritten types have unrewritten kinds (because
rewriting is homogeneous), passing the list of rewritten types to decomposePiCos
just won't do: later arguments' kinds won't be as expected. So we need to get
the *unrewritten* types to pass to decomposePiCos. We can do this easily enough
by taking the kind of the argument coercions, passed in originally.

(Alternative 1: We could re-engineer decomposePiCos to deal with this situation.
But that function is already gnarly, and taking the right-hand types is correct
at its other call sites, which are much more common than this one.)

(Alternative 2: We could avoid calling decomposePiCos entirely, integrating its
behavior into simplifyArgsWorker. This would work, I think, but then all of the
complication of decomposePiCos would end up layered on top of all the complication
here. Please, no.)

(Alternative 3: We could pass the unrewritten arguments into simplifyArgsWorker
so that we don't have to recreate them. But that would complicate the interface
of this function to handle a very dark, dark corner case. Better to keep our
demons to ourselves here instead of exposing them to callers. This decision is
easily reversed if there is ever any performance trouble due to the call of
coercionKind.)

So we now call

  decomposePiCos co1
                 (Pair (forall j. j -&gt; Type) (forall (j :: Star). (j |&gt; axStar) -&gt; Star))
                 [bo |&gt; sym axStar, NoWay |&gt; sym bc]

to get

  co5 :: Star ~ Type
  co6 :: (j |&gt; axStar) ~ (j |&gt; co5), substituted to
                              (bo |&gt; sym axStar |&gt; axStar) ~ (bo |&gt; sym axStar |&gt; co5)
                           == bo ~ bo
  res_co :: Type ~ Star

We then use these casts on (the rewritten) (3) and (4) to get

  (Bool |&gt; sym axStar |&gt; co5 :: Type)   -- (C3)
  (False |&gt; sym bc |&gt; co6    :: bo)     -- (C4)

We can simplify to

  Bool                        -- (C3)
  (False |&gt; sym bc :: bo)     -- (C4)

Of course, we still must do the processing in Note [simplifyArgsWorker] to finish
the job. We thus want to recur. Our new function kind is the left-hand type of
co1 (gotten, recall, by lifting the variable k that was the return kind of the
original function). Why the left-hand type (as opposed to the right-hand type)?
Because we have casted all the arguments according to decomposePiCos, which gets
us from the right-hand type to the left-hand one. We thus recur with that new
function kind, zapping our lifting context, because we have essentially applied
it.

This recursive call returns ([Bool, False], [...], Refl). The Bool and False
are the correct arguments we wish to return. But we must be careful about the
result coercion: our new, rewritten application will have kind Type, but we
want to make sure that the result coercion casts this back to Star. (Why?
Because we started with an application of kind Star, and rewriting is homogeneous.)

So, we have to twiddle the result coercion appropriately.

Let's check whether this is well-typed. We know

  a :: forall (k :: Type). k -&gt; k

  a (forall j. j -&gt; Type) :: (forall j. j -&gt; Type) -&gt; forall j. j -&gt; Type

  a (forall j. j -&gt; Type)
    Proxy
      :: forall j. j -&gt; Type

  a (forall j. j -&gt; Type)
    Proxy
    Bool
      :: Bool -&gt; Type

  a (forall j. j -&gt; Type)
    Proxy
    Bool
    False
      :: Type

  a (forall j. j -&gt; Type)
    Proxy
    Bool
    False
     |&gt; res_co
     :: Star

as desired.

Whew.

Historical note: I (Richard E) once thought that the final part of the kind
had to be a variable k (as in the example above). But it might not be: it could
be an application of a variable. Here is the example:

  let f :: forall (a :: Type) (b :: a -&gt; Type). b (Any @a)
      k :: Type
      x :: k

  rewrite (f @Type @((-&gt;) k) x)

After instantiating [a |-&gt; Type, b |-&gt; ((-&gt;) k)], we see that `b (Any @a)`
is `k -&gt; Any @a`, and thus the third argument of `x :: k` is well-kinded.

-}</span><span>
</span><span id="line-2977"></span><span>
</span><span id="line-2978"></span><span>
</span><span id="line-2979"></span><span class="hs-comment">-- This is shared between the rewriter and the normaliser in GHC.Core.FamInstEnv.</span><span>
</span><span id="line-2980"></span><span class="hs-comment">-- See Note [simplifyArgsWorker]</span><span>
</span><span id="line-2981"></span><span class="hs-pragma">{-# INLINE</span><span> </span><span class="annot"><a href="GHC.Core.Coercion.html#simplifyArgsWorker"><span class="hs-pragma hs-type">simplifyArgsWorker</span></a></span><span> </span><span class="hs-pragma">#-}</span><span>
</span><span id="line-2982"></span><span class="annot"><a href="GHC.Core.Coercion.html#simplifyArgsWorker"><span class="hs-identifier hs-type">simplifyArgsWorker</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="hs-special">[</span><span class="annot"><a href="GHC.Core.TyCo.Rep.html#TyCoBinder"><span class="hs-identifier hs-type">TyCoBinder</span></a></span><span class="hs-special">]</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="GHC.Core.TyCo.Rep.html#Kind"><span class="hs-identifier hs-type">Kind</span></a></span><span>
</span><span id="line-2983"></span><span>                       </span><span class="hs-comment">-- the binders &amp; result kind (not a &#928;-type) of the function applied to the args</span><span>
</span><span id="line-2984"></span><span>                       </span><span class="hs-comment">-- list of binders can be shorter or longer than the list of args</span><span>
</span><span id="line-2985"></span><span>                   </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="GHC.Types.Var.Set.html#TyCoVarSet"><span class="hs-identifier hs-type">TyCoVarSet</span></a></span><span>   </span><span class="hs-comment">-- free vars of the args</span><span>
</span><span id="line-2986"></span><span>                   </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-special">[</span><span class="annot"><a href="GHC.Core.Coercion.Axiom.html#Role"><span class="hs-identifier hs-type">Role</span></a></span><span class="hs-special">]</span><span>   </span><span class="hs-comment">-- list of roles, r</span><span>
</span><span id="line-2987"></span><span>                   </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-special">[</span><span class="hs-special">(</span><span class="annot"><a href="GHC.Core.TyCo.Rep.html#Type"><span class="hs-identifier hs-type">Type</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><a href="GHC.Core.TyCo.Rep.html#Coercion"><span class="hs-identifier hs-type">Coercion</span></a></span><span class="hs-special">)</span><span class="hs-special">]</span><span> </span><span class="hs-comment">-- rewritten type arguments, arg</span><span>
</span><span id="line-2988"></span><span>                                         </span><span class="hs-comment">-- each comes with the coercion used to rewrite it,</span><span>
</span><span id="line-2989"></span><span>                                         </span><span class="hs-comment">-- with co :: rewritten_type ~ original_type</span><span>
</span><span id="line-2990"></span><span>                   </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-special">(</span><span class="hs-special">[</span><span class="annot"><a href="GHC.Core.TyCo.Rep.html#Type"><span class="hs-identifier hs-type">Type</span></a></span><span class="hs-special">]</span><span class="hs-special">,</span><span> </span><span class="hs-special">[</span><span class="annot"><a href="GHC.Core.TyCo.Rep.html#Coercion"><span class="hs-identifier hs-type">Coercion</span></a></span><span class="hs-special">]</span><span class="hs-special">,</span><span> </span><span class="annot"><a href="GHC.Core.TyCo.Rep.html#MCoercionN"><span class="hs-identifier hs-type">MCoercionN</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-2991"></span><span class="hs-comment">-- Returns (xis, cos, res_co), where each co :: xi ~ arg,</span><span>
</span><span id="line-2992"></span><span class="hs-comment">-- and res_co :: kind (f xis) ~ kind (f tys), where f is the function applied to the args</span><span>
</span><span id="line-2993"></span><span class="hs-comment">-- Precondition: if f :: forall bndrs. inner_ki (where bndrs and inner_ki are passed in),</span><span>
</span><span id="line-2994"></span><span class="hs-comment">-- then (f orig_tys) is well kinded. Note that (f rewritten_tys) might *not* be well-kinded.</span><span>
</span><span id="line-2995"></span><span class="hs-comment">-- Massaging the rewritten_tys in order to make (f rewritten_tys) well-kinded is what this</span><span>
</span><span id="line-2996"></span><span class="hs-comment">-- function is all about. That is, (f xis), where xis are the returned arguments, *is*</span><span>
</span><span id="line-2997"></span><span class="hs-comment">-- well kinded.</span><span>
</span><span id="line-2998"></span><span id="simplifyArgsWorker"><span class="annot"><span class="annottext">simplifyArgsWorker :: [TyCoBinder]
-&gt; Type
-&gt; VarSet
-&gt; [Role]
-&gt; [(Type, Coercion)]
-&gt; ([Type], [Coercion], MCoercion)
</span><a href="GHC.Core.Coercion.html#simplifyArgsWorker"><span class="hs-identifier hs-var hs-var">simplifyArgsWorker</span></a></span></span><span> </span><span id="local-6989586621681033687"><span class="annot"><span class="annottext">[TyCoBinder]
</span><a href="#local-6989586621681033687"><span class="hs-identifier hs-var">orig_ki_binders</span></a></span></span><span> </span><span id="local-6989586621681033686"><span class="annot"><span class="annottext">Type
</span><a href="#local-6989586621681033686"><span class="hs-identifier hs-var">orig_inner_ki</span></a></span></span><span> </span><span id="local-6989586621681033685"><span class="annot"><span class="annottext">VarSet
</span><a href="#local-6989586621681033685"><span class="hs-identifier hs-var">orig_fvs</span></a></span></span><span>
</span><span id="line-2999"></span><span>                   </span><span id="local-6989586621681033684"><span class="annot"><span class="annottext">[Role]
</span><a href="#local-6989586621681033684"><span class="hs-identifier hs-var">orig_roles</span></a></span></span><span> </span><span id="local-6989586621681033683"><span class="annot"><span class="annottext">[(Type, Coercion)]
</span><a href="#local-6989586621681033683"><span class="hs-identifier hs-var">orig_simplified_args</span></a></span></span><span>
</span><span id="line-3000"></span><span>  </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">[Type]
-&gt; [Coercion]
-&gt; LiftingContext
-&gt; [TyCoBinder]
-&gt; Type
-&gt; [Role]
-&gt; [(Type, Coercion)]
-&gt; ([Type], [Coercion], MCoercion)
</span><a href="#local-6989586621681033682"><span class="hs-identifier hs-var">go</span></a></span><span> </span><span class="hs-special">[</span><span class="hs-special">]</span><span> </span><span class="hs-special">[</span><span class="hs-special">]</span><span> </span><span class="annot"><span class="annottext">LiftingContext
</span><a href="#local-6989586621681033681"><span class="hs-identifier hs-var">orig_lc</span></a></span><span> </span><span class="annot"><span class="annottext">[TyCoBinder]
</span><a href="#local-6989586621681033687"><span class="hs-identifier hs-var">orig_ki_binders</span></a></span><span> </span><span class="annot"><span class="annottext">Type
</span><a href="#local-6989586621681033686"><span class="hs-identifier hs-var">orig_inner_ki</span></a></span><span> </span><span class="annot"><span class="annottext">[Role]
</span><a href="#local-6989586621681033684"><span class="hs-identifier hs-var">orig_roles</span></a></span><span> </span><span class="annot"><span class="annottext">[(Type, Coercion)]
</span><a href="#local-6989586621681033683"><span class="hs-identifier hs-var">orig_simplified_args</span></a></span><span>
</span><span id="line-3001"></span><span>  </span><span class="hs-keyword">where</span><span>
</span><span id="line-3002"></span><span>    </span><span id="local-6989586621681033681"><span class="annot"><span class="annottext">orig_lc :: LiftingContext
</span><a href="#local-6989586621681033681"><span class="hs-identifier hs-var hs-var">orig_lc</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">InScopeSet -&gt; LiftingContext
</span><a href="GHC.Core.Coercion.html#emptyLiftingContext"><span class="hs-identifier hs-var">emptyLiftingContext</span></a></span><span> </span><span class="annot"><span class="annottext">forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><a href="../../base-4.16.4.0/src/GHC-Base.html#%24"><span class="hs-operator hs-var">$</span></a></span><span> </span><span class="annot"><span class="annottext">VarSet -&gt; InScopeSet
</span><a href="GHC.Types.Var.Env.html#mkInScopeSet"><span class="hs-identifier hs-var">mkInScopeSet</span></a></span><span> </span><span class="annot"><span class="annottext">forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><a href="../../base-4.16.4.0/src/GHC-Base.html#%24"><span class="hs-operator hs-var">$</span></a></span><span> </span><span class="annot"><span class="annottext">VarSet
</span><a href="#local-6989586621681033685"><span class="hs-identifier hs-var">orig_fvs</span></a></span><span>
</span><span id="line-3003"></span><span>
</span><span id="line-3004"></span><span>    </span><span class="annot"><a href="#local-6989586621681033682"><span class="hs-identifier hs-type">go</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="hs-special">[</span><span class="annot"><a href="GHC.Core.TyCo.Rep.html#Type"><span class="hs-identifier hs-type">Type</span></a></span><span class="hs-special">]</span><span>      </span><span class="hs-comment">-- Xis accumulator, in reverse order</span><span>
</span><span id="line-3005"></span><span>       </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-special">[</span><span class="annot"><a href="GHC.Core.TyCo.Rep.html#Coercion"><span class="hs-identifier hs-type">Coercion</span></a></span><span class="hs-special">]</span><span>  </span><span class="hs-comment">-- Coercions accumulator, in reverse order</span><span>
</span><span id="line-3006"></span><span>                      </span><span class="hs-comment">-- These are in 1-to-1 correspondence</span><span>
</span><span id="line-3007"></span><span>       </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="GHC.Core.Coercion.html#LiftingContext"><span class="hs-identifier hs-type">LiftingContext</span></a></span><span>  </span><span class="hs-comment">-- mapping from tyvars to rewriting coercions</span><span>
</span><span id="line-3008"></span><span>       </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-special">[</span><span class="annot"><a href="GHC.Core.TyCo.Rep.html#TyCoBinder"><span class="hs-identifier hs-type">TyCoBinder</span></a></span><span class="hs-special">]</span><span>    </span><span class="hs-comment">-- Unsubsted binders of function's kind</span><span>
</span><span id="line-3009"></span><span>       </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="GHC.Core.TyCo.Rep.html#Kind"><span class="hs-identifier hs-type">Kind</span></a></span><span>        </span><span class="hs-comment">-- Unsubsted result kind of function (not a Pi-type)</span><span>
</span><span id="line-3010"></span><span>       </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-special">[</span><span class="annot"><a href="GHC.Core.Coercion.Axiom.html#Role"><span class="hs-identifier hs-type">Role</span></a></span><span class="hs-special">]</span><span>      </span><span class="hs-comment">-- Roles at which to rewrite these ...</span><span>
</span><span id="line-3011"></span><span>       </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-special">[</span><span class="hs-special">(</span><span class="annot"><a href="GHC.Core.TyCo.Rep.html#Type"><span class="hs-identifier hs-type">Type</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><a href="GHC.Core.TyCo.Rep.html#Coercion"><span class="hs-identifier hs-type">Coercion</span></a></span><span class="hs-special">)</span><span class="hs-special">]</span><span>  </span><span class="hs-comment">-- rewritten arguments, with their rewriting coercions</span><span>
</span><span id="line-3012"></span><span>       </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-special">(</span><span class="hs-special">[</span><span class="annot"><a href="GHC.Core.TyCo.Rep.html#Type"><span class="hs-identifier hs-type">Type</span></a></span><span class="hs-special">]</span><span class="hs-special">,</span><span> </span><span class="hs-special">[</span><span class="annot"><a href="GHC.Core.TyCo.Rep.html#Coercion"><span class="hs-identifier hs-type">Coercion</span></a></span><span class="hs-special">]</span><span class="hs-special">,</span><span> </span><span class="annot"><a href="GHC.Core.TyCo.Rep.html#MCoercionN"><span class="hs-identifier hs-type">MCoercionN</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-3013"></span><span>    </span><span id="local-6989586621681033682"><span class="annot"><span class="annottext">go :: [Type]
-&gt; [Coercion]
-&gt; LiftingContext
-&gt; [TyCoBinder]
-&gt; Type
-&gt; [Role]
-&gt; [(Type, Coercion)]
-&gt; ([Type], [Coercion], MCoercion)
</span><a href="#local-6989586621681033682"><span class="hs-identifier hs-var hs-var">go</span></a></span></span><span> </span><span id="local-6989586621681033680"><span class="annot"><span class="annottext">[Type]
</span><a href="#local-6989586621681033680"><span class="hs-identifier hs-var">acc_xis</span></a></span></span><span> </span><span id="local-6989586621681033679"><span class="annot"><span class="annottext">[Coercion]
</span><a href="#local-6989586621681033679"><span class="hs-identifier hs-var">acc_cos</span></a></span></span><span> </span><span class="hs-glyph">!</span><span id="local-6989586621681033678"><span class="annot"><span class="annottext">LiftingContext
</span><a href="#local-6989586621681033678"><span class="hs-identifier hs-var">lc</span></a></span></span><span> </span><span id="local-6989586621681033677"><span class="annot"><span class="annottext">[TyCoBinder]
</span><a href="#local-6989586621681033677"><span class="hs-identifier hs-var">binders</span></a></span></span><span> </span><span id="local-6989586621681033676"><span class="annot"><span class="annottext">Type
</span><a href="#local-6989586621681033676"><span class="hs-identifier hs-var">inner_ki</span></a></span></span><span> </span><span class="annot"><span class="annottext">[Role]
</span><span class="hs-identifier">_</span></span><span> </span><span class="hs-special">[</span><span class="hs-special">]</span><span>
</span><span id="line-3014"></span><span>        </span><span class="hs-comment">-- The !lc makes the function strict in the lifting context</span><span>
</span><span id="line-3015"></span><span>        </span><span class="hs-comment">-- which means GHC can unbox that pair.  A modest win.</span><span>
</span><span id="line-3016"></span><span>      </span><span class="hs-glyph">=</span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">forall a. [a] -&gt; [a]
</span><a href="../../base-4.16.4.0/src/GHC-List.html#reverse"><span class="hs-identifier hs-var">reverse</span></a></span><span> </span><span class="annot"><span class="annottext">[Type]
</span><a href="#local-6989586621681033680"><span class="hs-identifier hs-var">acc_xis</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">forall a. [a] -&gt; [a]
</span><a href="../../base-4.16.4.0/src/GHC-List.html#reverse"><span class="hs-identifier hs-var">reverse</span></a></span><span> </span><span class="annot"><span class="annottext">[Coercion]
</span><a href="#local-6989586621681033679"><span class="hs-identifier hs-var">acc_cos</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">MCoercion
</span><a href="#local-6989586621681033675"><span class="hs-identifier hs-var">kind_co</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-3017"></span><span>      </span><span class="hs-keyword">where</span><span>
</span><span id="line-3018"></span><span>        </span><span id="local-6989586621681033674"><span class="annot"><span class="annottext">final_kind :: Type
</span><a href="#local-6989586621681033674"><span class="hs-identifier hs-var hs-var">final_kind</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">[TyCoBinder] -&gt; Type -&gt; Type
</span><a href="GHC.Core.TyCo.Rep.html#mkPiTys"><span class="hs-identifier hs-var">mkPiTys</span></a></span><span> </span><span class="annot"><span class="annottext">[TyCoBinder]
</span><a href="#local-6989586621681033677"><span class="hs-identifier hs-var">binders</span></a></span><span> </span><span class="annot"><span class="annottext">Type
</span><a href="#local-6989586621681033676"><span class="hs-identifier hs-var">inner_ki</span></a></span><span>
</span><span id="line-3019"></span><span>        </span><span id="local-6989586621681033675"><span class="annot"><span class="annottext">kind_co :: MCoercion
</span><a href="#local-6989586621681033675"><span class="hs-identifier hs-var hs-var">kind_co</span></a></span></span><span> </span><span class="hs-glyph">|</span><span> </span><span class="annot"><span class="annottext">Type -&gt; Bool
</span><a href="GHC.Core.TyCo.FVs.html#noFreeVarsOfType"><span class="hs-identifier hs-var">noFreeVarsOfType</span></a></span><span> </span><span class="annot"><span class="annottext">Type
</span><a href="#local-6989586621681033674"><span class="hs-identifier hs-var">final_kind</span></a></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">MCoercion
</span><a href="GHC.Core.TyCo.Rep.html#MRefl"><span class="hs-identifier hs-var">MRefl</span></a></span><span>
</span><span id="line-3020"></span><span>                </span><span class="hs-glyph">|</span><span> </span><span class="annot"><span class="annottext">Bool
</span><a href="../../base-4.16.4.0/src/GHC-Base.html#otherwise"><span class="hs-identifier hs-var">otherwise</span></a></span><span>                   </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">Coercion -&gt; MCoercion
</span><a href="GHC.Core.TyCo.Rep.html#MCo"><span class="hs-identifier hs-var">MCo</span></a></span><span> </span><span class="annot"><span class="annottext">forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><a href="../../base-4.16.4.0/src/GHC-Base.html#%24"><span class="hs-operator hs-var">$</span></a></span><span> </span><span class="annot"><span class="annottext">HasDebugCallStack =&gt; Role -&gt; LiftingContext -&gt; Type -&gt; Coercion
</span><a href="GHC.Core.Coercion.html#liftCoSubst"><span class="hs-identifier hs-var">liftCoSubst</span></a></span><span> </span><span class="annot"><span class="annottext">Role
</span><a href="GHC.Core.Coercion.Axiom.html#Nominal"><span class="hs-identifier hs-var">Nominal</span></a></span><span> </span><span class="annot"><span class="annottext">LiftingContext
</span><a href="#local-6989586621681033678"><span class="hs-identifier hs-var">lc</span></a></span><span> </span><span class="annot"><span class="annottext">Type
</span><a href="#local-6989586621681033674"><span class="hs-identifier hs-var">final_kind</span></a></span><span>
</span><span id="line-3021"></span><span>
</span><span id="line-3022"></span><span>    </span><span class="annot"><a href="#local-6989586621681033682"><span class="hs-identifier hs-var">go</span></a></span><span> </span><span id="local-6989586621681033671"><span class="annot"><span class="annottext">[Type]
</span><a href="#local-6989586621681033671"><span class="hs-identifier hs-var">acc_xis</span></a></span></span><span> </span><span id="local-6989586621681033670"><span class="annot"><span class="annottext">[Coercion]
</span><a href="#local-6989586621681033670"><span class="hs-identifier hs-var">acc_cos</span></a></span></span><span> </span><span id="local-6989586621681033669"><span class="annot"><span class="annottext">LiftingContext
</span><a href="#local-6989586621681033669"><span class="hs-identifier hs-var">lc</span></a></span></span><span> </span><span class="hs-special">(</span><span id="local-6989586621681033668"><span class="annot"><span class="annottext">TyCoBinder
</span><a href="#local-6989586621681033668"><span class="hs-identifier hs-var">binder</span></a></span></span><span class="annot"><span class="hs-glyph hs-type">:</span></span><span id="local-6989586621681033667"><span class="annot"><span class="annottext">[TyCoBinder]
</span><a href="#local-6989586621681033667"><span class="hs-identifier hs-var">binders</span></a></span></span><span class="hs-special">)</span><span> </span><span id="local-6989586621681033666"><span class="annot"><span class="annottext">Type
</span><a href="#local-6989586621681033666"><span class="hs-identifier hs-var">inner_ki</span></a></span></span><span> </span><span class="hs-special">(</span><span id="local-6989586621681033665"><span class="annot"><span class="annottext">Role
</span><a href="#local-6989586621681033665"><span class="hs-keyword hs-var">role</span></a></span></span><span class="annot"><span class="hs-glyph hs-type">:</span></span><span id="local-6989586621681033664"><span class="annot"><span class="annottext">[Role]
</span><a href="#local-6989586621681033664"><span class="hs-identifier hs-var">roles</span></a></span></span><span class="hs-special">)</span><span> </span><span class="hs-special">(</span><span class="hs-special">(</span><span id="local-6989586621681033663"><span class="annot"><span class="annottext">Type
</span><a href="#local-6989586621681033663"><span class="hs-identifier hs-var">xi</span></a></span></span><span class="hs-special">,</span><span id="local-6989586621681033662"><span class="annot"><span class="annottext">Coercion
</span><a href="#local-6989586621681033662"><span class="hs-identifier hs-var">co</span></a></span></span><span class="hs-special">)</span><span class="annot"><span class="hs-glyph hs-type">:</span></span><span id="local-6989586621681033661"><span class="annot"><span class="annottext">[(Type, Coercion)]
</span><a href="#local-6989586621681033661"><span class="hs-identifier hs-var">args</span></a></span></span><span class="hs-special">)</span><span>
</span><span id="line-3023"></span><span>      </span><span class="hs-glyph">=</span><span> </span><span class="hs-comment">-- By Note [Rewriting] in GHC.Tc.Solver.Rewrite invariant (F2),</span><span>
</span><span id="line-3024"></span><span>         </span><span class="hs-comment">-- tcTypeKind(xi) = tcTypeKind(ty). But, it's possible that xi will be</span><span>
</span><span id="line-3025"></span><span>         </span><span class="hs-comment">-- used as an argument to a function whose kind is different, if</span><span>
</span><span id="line-3026"></span><span>         </span><span class="hs-comment">-- earlier arguments have been rewritten to new types. We thus</span><span>
</span><span id="line-3027"></span><span>         </span><span class="hs-comment">-- need a coercion (kind_co :: old_kind ~ new_kind).</span><span>
</span><span id="line-3028"></span><span>         </span><span class="hs-comment">--</span><span>
</span><span id="line-3029"></span><span>         </span><span class="hs-comment">-- The bangs here have been observed to improve performance</span><span>
</span><span id="line-3030"></span><span>         </span><span class="hs-comment">-- significantly in optimized builds; see #18502</span><span>
</span><span id="line-3031"></span><span>         </span><span class="hs-keyword">let</span><span> </span><span class="hs-glyph">!</span><span id="local-6989586621681033660"><span class="annot"><span class="annottext">kind_co :: Coercion
</span><a href="#local-6989586621681033660"><span class="hs-identifier hs-var hs-var">kind_co</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">Coercion -&gt; Coercion
</span><a href="GHC.Core.Coercion.html#mkSymCo"><span class="hs-identifier hs-var">mkSymCo</span></a></span><span> </span><span class="annot"><span class="annottext">forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><a href="../../base-4.16.4.0/src/GHC-Base.html#%24"><span class="hs-operator hs-var">$</span></a></span><span>
</span><span id="line-3032"></span><span>                        </span><span class="annot"><span class="annottext">HasDebugCallStack =&gt; Role -&gt; LiftingContext -&gt; Type -&gt; Coercion
</span><a href="GHC.Core.Coercion.html#liftCoSubst"><span class="hs-identifier hs-var">liftCoSubst</span></a></span><span> </span><span class="annot"><span class="annottext">Role
</span><a href="GHC.Core.Coercion.Axiom.html#Nominal"><span class="hs-identifier hs-var">Nominal</span></a></span><span> </span><span class="annot"><span class="annottext">LiftingContext
</span><a href="#local-6989586621681033669"><span class="hs-identifier hs-var">lc</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">TyCoBinder -&gt; Type
</span><a href="GHC.Core.Type.html#tyCoBinderType"><span class="hs-identifier hs-var">tyCoBinderType</span></a></span><span> </span><span class="annot"><span class="annottext">TyCoBinder
</span><a href="#local-6989586621681033668"><span class="hs-identifier hs-var">binder</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-3033"></span><span>             </span><span class="hs-glyph">!</span><span id="local-6989586621681033658"><span class="annot"><span class="annottext">casted_xi :: Type
</span><a href="#local-6989586621681033658"><span class="hs-identifier hs-var hs-var">casted_xi</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">Type
</span><a href="#local-6989586621681033663"><span class="hs-identifier hs-var">xi</span></a></span><span> </span><span class="annot"><span class="annottext">Type -&gt; Coercion -&gt; Type
</span><a href="GHC.Core.Type.html#mkCastTy"><span class="hs-operator hs-var">`mkCastTy`</span></a></span><span> </span><span class="annot"><span class="annottext">Coercion
</span><a href="#local-6989586621681033660"><span class="hs-identifier hs-var">kind_co</span></a></span><span>
</span><span id="line-3034"></span><span>             </span><span id="local-6989586621681033657"><span class="annot"><span class="annottext">casted_co :: Coercion
</span><a href="#local-6989586621681033657"><span class="hs-identifier hs-var hs-var">casted_co</span></a></span></span><span> </span><span class="hs-glyph">=</span><span>  </span><span class="annot"><span class="annottext">Role -&gt; Type -&gt; Coercion -&gt; Coercion -&gt; Coercion
</span><a href="GHC.Core.Coercion.html#mkCoherenceLeftCo"><span class="hs-identifier hs-var">mkCoherenceLeftCo</span></a></span><span> </span><span class="annot"><span class="annottext">Role
</span><a href="#local-6989586621681033665"><span class="hs-keyword hs-var">role</span></a></span><span> </span><span class="annot"><span class="annottext">Type
</span><a href="#local-6989586621681033663"><span class="hs-identifier hs-var">xi</span></a></span><span> </span><span class="annot"><span class="annottext">Coercion
</span><a href="#local-6989586621681033660"><span class="hs-identifier hs-var">kind_co</span></a></span><span> </span><span class="annot"><span class="annottext">Coercion
</span><a href="#local-6989586621681033662"><span class="hs-identifier hs-var">co</span></a></span><span>
</span><span id="line-3035"></span><span>
</span><span id="line-3036"></span><span>         </span><span class="hs-comment">-- now, extend the lifting context with the new binding</span><span>
</span><span id="line-3037"></span><span>             </span><span class="hs-glyph">!</span><span id="local-6989586621681033656"><span class="annot"><span class="annottext">new_lc :: LiftingContext
</span><a href="#local-6989586621681033656"><span class="hs-identifier hs-var hs-var">new_lc</span></a></span></span><span> </span><span class="hs-glyph">|</span><span> </span><span class="annot"><a href="../../base-4.16.4.0/src/GHC-Maybe.html#Just"><span class="hs-identifier hs-type">Just</span></a></span><span> </span><span id="local-6989586621681033655"><span class="annot"><span class="annottext">CoVar
</span><a href="#local-6989586621681033655"><span class="hs-identifier hs-var">tv</span></a></span></span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">TyCoBinder -&gt; Maybe CoVar
</span><a href="GHC.Core.Type.html#tyCoBinderVar_maybe"><span class="hs-identifier hs-var">tyCoBinderVar_maybe</span></a></span><span> </span><span class="annot"><span class="annottext">TyCoBinder
</span><a href="#local-6989586621681033668"><span class="hs-identifier hs-var">binder</span></a></span><span>
</span><span id="line-3038"></span><span>                     </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">LiftingContext -&gt; CoVar -&gt; Coercion -&gt; LiftingContext
</span><a href="GHC.Core.Coercion.html#extendLiftingContextAndInScope"><span class="hs-identifier hs-var">extendLiftingContextAndInScope</span></a></span><span> </span><span class="annot"><span class="annottext">LiftingContext
</span><a href="#local-6989586621681033669"><span class="hs-identifier hs-var">lc</span></a></span><span> </span><span class="annot"><span class="annottext">CoVar
</span><a href="#local-6989586621681033655"><span class="hs-identifier hs-var">tv</span></a></span><span> </span><span class="annot"><span class="annottext">Coercion
</span><a href="#local-6989586621681033657"><span class="hs-identifier hs-var">casted_co</span></a></span><span>
</span><span id="line-3039"></span><span>                     </span><span class="hs-glyph">|</span><span> </span><span class="annot"><span class="annottext">Bool
</span><a href="../../base-4.16.4.0/src/GHC-Base.html#otherwise"><span class="hs-identifier hs-var">otherwise</span></a></span><span>
</span><span id="line-3040"></span><span>                     </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">LiftingContext
</span><a href="#local-6989586621681033669"><span class="hs-identifier hs-var">lc</span></a></span><span>
</span><span id="line-3041"></span><span>         </span><span class="hs-keyword">in</span><span>
</span><span id="line-3042"></span><span>         </span><span class="annot"><span class="annottext">[Type]
-&gt; [Coercion]
-&gt; LiftingContext
-&gt; [TyCoBinder]
-&gt; Type
-&gt; [Role]
-&gt; [(Type, Coercion)]
-&gt; ([Type], [Coercion], MCoercion)
</span><a href="#local-6989586621681033682"><span class="hs-identifier hs-var">go</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Type
</span><a href="#local-6989586621681033658"><span class="hs-identifier hs-var">casted_xi</span></a></span><span> </span><span class="annot"><span class="annottext">forall a. a -&gt; [a] -&gt; [a]
</span><span class="hs-glyph hs-var">:</span></span><span> </span><span class="annot"><span class="annottext">[Type]
</span><a href="#local-6989586621681033671"><span class="hs-identifier hs-var">acc_xis</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-3043"></span><span>            </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Coercion
</span><a href="#local-6989586621681033657"><span class="hs-identifier hs-var">casted_co</span></a></span><span> </span><span class="annot"><span class="annottext">forall a. a -&gt; [a] -&gt; [a]
</span><span class="hs-glyph hs-var">:</span></span><span> </span><span class="annot"><span class="annottext">[Coercion]
</span><a href="#local-6989586621681033670"><span class="hs-identifier hs-var">acc_cos</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-3044"></span><span>            </span><span class="annot"><span class="annottext">LiftingContext
</span><a href="#local-6989586621681033656"><span class="hs-identifier hs-var">new_lc</span></a></span><span>
</span><span id="line-3045"></span><span>            </span><span class="annot"><span class="annottext">[TyCoBinder]
</span><a href="#local-6989586621681033667"><span class="hs-identifier hs-var">binders</span></a></span><span>
</span><span id="line-3046"></span><span>            </span><span class="annot"><span class="annottext">Type
</span><a href="#local-6989586621681033666"><span class="hs-identifier hs-var">inner_ki</span></a></span><span>
</span><span id="line-3047"></span><span>            </span><span class="annot"><span class="annottext">[Role]
</span><a href="#local-6989586621681033664"><span class="hs-identifier hs-var">roles</span></a></span><span>
</span><span id="line-3048"></span><span>            </span><span class="annot"><span class="annottext">[(Type, Coercion)]
</span><a href="#local-6989586621681033661"><span class="hs-identifier hs-var">args</span></a></span><span>
</span><span id="line-3049"></span><span>
</span><span id="line-3050"></span><span>
</span><span id="line-3051"></span><span>      </span><span class="hs-comment">-- See Note [Last case in simplifyArgsWorker]</span><span>
</span><span id="line-3052"></span><span>    </span><span class="annot"><a href="#local-6989586621681033682"><span class="hs-identifier hs-var">go</span></a></span><span> </span><span id="local-6989586621681033653"><span class="annot"><span class="annottext">[Type]
</span><a href="#local-6989586621681033653"><span class="hs-identifier hs-var">acc_xis</span></a></span></span><span> </span><span id="local-6989586621681033652"><span class="annot"><span class="annottext">[Coercion]
</span><a href="#local-6989586621681033652"><span class="hs-identifier hs-var">acc_cos</span></a></span></span><span> </span><span id="local-6989586621681033651"><span class="annot"><span class="annottext">LiftingContext
</span><a href="#local-6989586621681033651"><span class="hs-identifier hs-var">lc</span></a></span></span><span> </span><span class="hs-special">[</span><span class="hs-special">]</span><span> </span><span id="local-6989586621681033650"><span class="annot"><span class="annottext">Type
</span><a href="#local-6989586621681033650"><span class="hs-identifier hs-var">inner_ki</span></a></span></span><span> </span><span id="local-6989586621681033649"><span class="annot"><span class="annottext">[Role]
</span><a href="#local-6989586621681033649"><span class="hs-identifier hs-var">roles</span></a></span></span><span> </span><span id="local-6989586621681033648"><span class="annot"><span class="annottext">[(Type, Coercion)]
</span><a href="#local-6989586621681033648"><span class="hs-identifier hs-var">args</span></a></span></span><span>
</span><span id="line-3053"></span><span>      </span><span class="hs-glyph">=</span><span> </span><span class="hs-keyword">let</span><span> </span><span id="local-6989586621681033647"><span class="annot"><span class="annottext">co1 :: Coercion
</span><a href="#local-6989586621681033647"><span class="hs-identifier hs-var hs-var">co1</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">HasDebugCallStack =&gt; Role -&gt; LiftingContext -&gt; Type -&gt; Coercion
</span><a href="GHC.Core.Coercion.html#liftCoSubst"><span class="hs-identifier hs-var">liftCoSubst</span></a></span><span> </span><span class="annot"><span class="annottext">Role
</span><a href="GHC.Core.Coercion.Axiom.html#Nominal"><span class="hs-identifier hs-var">Nominal</span></a></span><span> </span><span class="annot"><span class="annottext">LiftingContext
</span><a href="#local-6989586621681033651"><span class="hs-identifier hs-var">lc</span></a></span><span> </span><span class="annot"><span class="annottext">Type
</span><a href="#local-6989586621681033650"><span class="hs-identifier hs-var">inner_ki</span></a></span><span>
</span><span id="line-3054"></span><span>            </span><span id="local-6989586621681033646"><span class="annot"><span class="annottext">co1_kind :: Pair Type
</span><a href="#local-6989586621681033646"><span class="hs-identifier hs-var hs-var">co1_kind</span></a></span></span><span>              </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">Coercion -&gt; Pair Type
</span><a href="GHC.Core.Coercion.html#coercionKind"><span class="hs-identifier hs-var">coercionKind</span></a></span><span> </span><span class="annot"><span class="annottext">Coercion
</span><a href="#local-6989586621681033647"><span class="hs-identifier hs-var">co1</span></a></span><span>
</span><span id="line-3055"></span><span>            </span><span id="local-6989586621681033645"><span class="annot"><span class="annottext">unrewritten_tys :: [Type]
</span><a href="#local-6989586621681033645"><span class="hs-identifier hs-var hs-var">unrewritten_tys</span></a></span></span><span>       </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">forall a b. (a -&gt; b) -&gt; [a] -&gt; [b]
</span><a href="../../base-4.16.4.0/src/GHC-Base.html#map"><span class="hs-identifier hs-var">map</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Coercion -&gt; Type
</span><a href="GHC.Core.Coercion.html#coercionRKind"><span class="hs-identifier hs-var">coercionRKind</span></a></span><span> </span><span class="annot"><span class="annottext">forall b c a. (b -&gt; c) -&gt; (a -&gt; b) -&gt; a -&gt; c
</span><a href="../../base-4.16.4.0/src/GHC-Base.html#."><span class="hs-operator hs-var">.</span></a></span><span> </span><span class="annot"><span class="annottext">forall a b. (a, b) -&gt; b
</span><a href="../../base-4.16.4.0/src/Data-Tuple.html#snd"><span class="hs-identifier hs-var">snd</span></a></span><span class="hs-special">)</span><span> </span><span class="annot"><span class="annottext">[(Type, Coercion)]
</span><a href="#local-6989586621681033648"><span class="hs-identifier hs-var">args</span></a></span><span>
</span><span id="line-3056"></span><span>            </span><span class="hs-special">(</span><span id="local-6989586621681033644"><span class="annot"><span class="annottext">[Coercion]
</span><a href="#local-6989586621681033644"><span class="hs-identifier hs-var">arg_cos</span></a></span></span><span class="hs-special">,</span><span> </span><span id="local-6989586621681033643"><span class="annot"><span class="annottext">Coercion
</span><a href="#local-6989586621681033643"><span class="hs-identifier hs-var">res_co</span></a></span></span><span class="hs-special">)</span><span>     </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">HasDebugCallStack =&gt;
Coercion -&gt; Pair Type -&gt; [Type] -&gt; ([Coercion], Coercion)
</span><a href="GHC.Core.Coercion.html#decomposePiCos"><span class="hs-identifier hs-var">decomposePiCos</span></a></span><span> </span><span class="annot"><span class="annottext">Coercion
</span><a href="#local-6989586621681033647"><span class="hs-identifier hs-var">co1</span></a></span><span> </span><span class="annot"><span class="annottext">Pair Type
</span><a href="#local-6989586621681033646"><span class="hs-identifier hs-var">co1_kind</span></a></span><span> </span><span class="annot"><span class="annottext">[Type]
</span><a href="#local-6989586621681033645"><span class="hs-identifier hs-var">unrewritten_tys</span></a></span><span>
</span><span id="line-3057"></span><span>            </span><span id="local-6989586621681033642"><span class="annot"><span class="annottext">casted_args :: [(Type, Coercion)]
</span><a href="#local-6989586621681033642"><span class="hs-identifier hs-var hs-var">casted_args</span></a></span></span><span>           </span><span class="hs-glyph">=</span><span> </span><span class="hs-identifier">ASSERT2</span><span class="hs-special">(</span><span> </span><span class="hs-identifier">equalLength</span><span> </span><span class="hs-identifier">args</span><span> </span><span class="hs-identifier">arg_cos</span><span>
</span><span id="line-3058"></span><span>                                           </span><span class="hs-special">,</span><span> </span><span class="hs-identifier">ppr</span><span> </span><span class="hs-identifier">args</span><span> </span><span class="hs-operator">$$</span><span> </span><span class="hs-identifier">ppr</span><span> </span><span class="hs-identifier">arg_cos</span><span> </span><span class="hs-special">)</span><span>
</span><span id="line-3059"></span><span>                                    </span><span class="hs-special">[</span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Type
</span><a href="#local-6989586621681033641"><span class="hs-identifier hs-var">casted_xi</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">Coercion
</span><a href="#local-6989586621681033640"><span class="hs-identifier hs-var">casted_co</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-3060"></span><span>                                    </span><span class="hs-glyph">|</span><span> </span><span class="hs-special">(</span><span class="hs-special">(</span><span id="local-6989586621681033639"><span class="annot"><span class="annottext">Type
</span><a href="#local-6989586621681033639"><span class="hs-identifier hs-var">xi</span></a></span></span><span class="hs-special">,</span><span> </span><span id="local-6989586621681033638"><span class="annot"><span class="annottext">Coercion
</span><a href="#local-6989586621681033638"><span class="hs-identifier hs-var">co</span></a></span></span><span class="hs-special">)</span><span class="hs-special">,</span><span> </span><span id="local-6989586621681033637"><span class="annot"><span class="annottext">Coercion
</span><a href="#local-6989586621681033637"><span class="hs-identifier hs-var">arg_co</span></a></span></span><span class="hs-special">,</span><span> </span><span id="local-6989586621681033636"><span class="annot"><span class="annottext">Role
</span><a href="#local-6989586621681033636"><span class="hs-keyword hs-var">role</span></a></span></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">forall a b c. [a] -&gt; [b] -&gt; [c] -&gt; [(a, b, c)]
</span><a href="../../base-4.16.4.0/src/GHC-List.html#zip3"><span class="hs-identifier hs-var">zip3</span></a></span><span> </span><span class="annot"><span class="annottext">[(Type, Coercion)]
</span><a href="#local-6989586621681033648"><span class="hs-identifier hs-var">args</span></a></span><span> </span><span class="annot"><span class="annottext">[Coercion]
</span><a href="#local-6989586621681033644"><span class="hs-identifier hs-var">arg_cos</span></a></span><span> </span><span class="annot"><span class="annottext">[Role]
</span><a href="#local-6989586621681033649"><span class="hs-identifier hs-var">roles</span></a></span><span>
</span><span id="line-3061"></span><span>                                    </span><span class="hs-special">,</span><span> </span><span class="hs-keyword">let</span><span> </span><span id="local-6989586621681033641"><span class="annot"><span class="annottext">casted_xi :: Type
</span><a href="#local-6989586621681033641"><span class="hs-identifier hs-var hs-var">casted_xi</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">Type
</span><a href="#local-6989586621681033639"><span class="hs-identifier hs-var">xi</span></a></span><span> </span><span class="annot"><span class="annottext">Type -&gt; Coercion -&gt; Type
</span><a href="GHC.Core.Type.html#mkCastTy"><span class="hs-operator hs-var">`mkCastTy`</span></a></span><span> </span><span class="annot"><span class="annottext">Coercion
</span><a href="#local-6989586621681033637"><span class="hs-identifier hs-var">arg_co</span></a></span><span>
</span><span id="line-3062"></span><span>                                          </span><span id="local-6989586621681033640"><span class="annot"><span class="annottext">casted_co :: Coercion
</span><a href="#local-6989586621681033640"><span class="hs-identifier hs-var hs-var">casted_co</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">Role -&gt; Type -&gt; Coercion -&gt; Coercion -&gt; Coercion
</span><a href="GHC.Core.Coercion.html#mkCoherenceLeftCo"><span class="hs-identifier hs-var">mkCoherenceLeftCo</span></a></span><span> </span><span class="annot"><span class="annottext">Role
</span><a href="#local-6989586621681033636"><span class="hs-keyword hs-var">role</span></a></span><span> </span><span class="annot"><span class="annottext">Type
</span><a href="#local-6989586621681033639"><span class="hs-identifier hs-var">xi</span></a></span><span> </span><span class="annot"><span class="annottext">Coercion
</span><a href="#local-6989586621681033637"><span class="hs-identifier hs-var">arg_co</span></a></span><span> </span><span class="annot"><span class="annottext">Coercion
</span><a href="#local-6989586621681033638"><span class="hs-identifier hs-var">co</span></a></span><span> </span><span class="hs-special">]</span><span>
</span><span id="line-3063"></span><span>               </span><span class="hs-comment">-- In general decomposePiCos can return fewer cos than tys,</span><span>
</span><span id="line-3064"></span><span>               </span><span class="hs-comment">-- but not here; because we're well typed, there will be enough</span><span>
</span><span id="line-3065"></span><span>               </span><span class="hs-comment">-- binders. Note that decomposePiCos does substitutions, so even</span><span>
</span><span id="line-3066"></span><span>               </span><span class="hs-comment">-- if the original substitution results in something ending with</span><span>
</span><span id="line-3067"></span><span>               </span><span class="hs-comment">-- ... -&gt; k, that k will be substituted to perhaps reveal more</span><span>
</span><span id="line-3068"></span><span>               </span><span class="hs-comment">-- binders.</span><span>
</span><span id="line-3069"></span><span>            </span><span id="local-6989586621681033634"><span class="annot"><span class="annottext">zapped_lc :: LiftingContext
</span><a href="#local-6989586621681033634"><span class="hs-identifier hs-var hs-var">zapped_lc</span></a></span></span><span>             </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">LiftingContext -&gt; LiftingContext
</span><a href="GHC.Core.Coercion.html#zapLiftingContext"><span class="hs-identifier hs-var">zapLiftingContext</span></a></span><span> </span><span class="annot"><span class="annottext">LiftingContext
</span><a href="#local-6989586621681033651"><span class="hs-identifier hs-var">lc</span></a></span><span>
</span><span id="line-3070"></span><span>            </span><span class="annot"><a href="GHC.Data.Pair.html#Pair"><span class="hs-identifier hs-type">Pair</span></a></span><span> </span><span id="local-6989586621681033633"><span class="annot"><span class="annottext">Type
</span><a href="#local-6989586621681033633"><span class="hs-identifier hs-var">rewritten_kind</span></a></span></span><span> </span><span class="annot"><span class="annottext">Type
</span><span class="hs-identifier">_</span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">Pair Type
</span><a href="#local-6989586621681033646"><span class="hs-identifier hs-var">co1_kind</span></a></span><span>
</span><span id="line-3071"></span><span>            </span><span class="hs-special">(</span><span id="local-6989586621681033632"><span class="annot"><span class="annottext">[TyCoBinder]
</span><a href="#local-6989586621681033632"><span class="hs-identifier hs-var">bndrs</span></a></span></span><span class="hs-special">,</span><span> </span><span id="local-6989586621681033631"><span class="annot"><span class="annottext">Type
</span><a href="#local-6989586621681033631"><span class="hs-identifier hs-var">new_inner</span></a></span></span><span class="hs-special">)</span><span>    </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">Type -&gt; ([TyCoBinder], Type)
</span><a href="GHC.Core.Type.html#splitPiTys"><span class="hs-identifier hs-var">splitPiTys</span></a></span><span> </span><span class="annot"><span class="annottext">Type
</span><a href="#local-6989586621681033633"><span class="hs-identifier hs-var">rewritten_kind</span></a></span><span>
</span><span id="line-3072"></span><span>
</span><span id="line-3073"></span><span>            </span><span class="hs-special">(</span><span id="local-6989586621681033629"><span class="annot"><span class="annottext">[Type]
</span><a href="#local-6989586621681033629"><span class="hs-identifier hs-var">xis_out</span></a></span></span><span class="hs-special">,</span><span> </span><span id="local-6989586621681033628"><span class="annot"><span class="annottext">[Coercion]
</span><a href="#local-6989586621681033628"><span class="hs-identifier hs-var">cos_out</span></a></span></span><span class="hs-special">,</span><span> </span><span id="local-6989586621681033627"><span class="annot"><span class="annottext">MCoercion
</span><a href="#local-6989586621681033627"><span class="hs-identifier hs-var">res_co_out</span></a></span></span><span class="hs-special">)</span><span>
</span><span id="line-3074"></span><span>              </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">[Type]
-&gt; [Coercion]
-&gt; LiftingContext
-&gt; [TyCoBinder]
-&gt; Type
-&gt; [Role]
-&gt; [(Type, Coercion)]
-&gt; ([Type], [Coercion], MCoercion)
</span><a href="#local-6989586621681033682"><span class="hs-identifier hs-var">go</span></a></span><span> </span><span class="annot"><span class="annottext">[Type]
</span><a href="#local-6989586621681033653"><span class="hs-identifier hs-var">acc_xis</span></a></span><span> </span><span class="annot"><span class="annottext">[Coercion]
</span><a href="#local-6989586621681033652"><span class="hs-identifier hs-var">acc_cos</span></a></span><span> </span><span class="annot"><span class="annottext">LiftingContext
</span><a href="#local-6989586621681033634"><span class="hs-identifier hs-var">zapped_lc</span></a></span><span> </span><span class="annot"><span class="annottext">[TyCoBinder]
</span><a href="#local-6989586621681033632"><span class="hs-identifier hs-var">bndrs</span></a></span><span> </span><span class="annot"><span class="annottext">Type
</span><a href="#local-6989586621681033631"><span class="hs-identifier hs-var">new_inner</span></a></span><span> </span><span class="annot"><span class="annottext">[Role]
</span><a href="#local-6989586621681033649"><span class="hs-identifier hs-var">roles</span></a></span><span> </span><span class="annot"><span class="annottext">[(Type, Coercion)]
</span><a href="#local-6989586621681033642"><span class="hs-identifier hs-var">casted_args</span></a></span><span>
</span><span id="line-3075"></span><span>        </span><span class="hs-keyword">in</span><span>
</span><span id="line-3076"></span><span>        </span><span class="hs-special">(</span><span class="annot"><span class="annottext">[Type]
</span><a href="#local-6989586621681033629"><span class="hs-identifier hs-var">xis_out</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">[Coercion]
</span><a href="#local-6989586621681033628"><span class="hs-identifier hs-var">cos_out</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">MCoercion
</span><a href="#local-6989586621681033627"><span class="hs-identifier hs-var">res_co_out</span></a></span><span> </span><span class="annot"><span class="annottext">MCoercion -&gt; Coercion -&gt; MCoercion
</span><a href="GHC.Core.Coercion.html#mkTransMCoL"><span class="hs-operator hs-var">`mkTransMCoL`</span></a></span><span> </span><span class="annot"><span class="annottext">Coercion
</span><a href="#local-6989586621681033643"><span class="hs-identifier hs-var">res_co</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-3077"></span><span>
</span><span id="line-3078"></span><span>    </span><span class="annot"><a href="#local-6989586621681033682"><span class="hs-identifier hs-var">go</span></a></span><span> </span><span class="annot"><span class="annottext">[Type]
</span><span class="hs-identifier">_</span></span><span> </span><span class="annot"><span class="annottext">[Coercion]
</span><span class="hs-identifier">_</span></span><span> </span><span class="annot"><span class="annottext">LiftingContext
</span><span class="hs-identifier">_</span></span><span> </span><span class="annot"><span class="annottext">[TyCoBinder]
</span><span class="hs-identifier">_</span></span><span> </span><span class="annot"><span class="annottext">Type
</span><span class="hs-identifier">_</span></span><span> </span><span class="annot"><span class="annottext">[Role]
</span><span class="hs-identifier">_</span></span><span> </span><span class="annot"><span class="annottext">[(Type, Coercion)]
</span><span class="hs-identifier">_</span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">forall a. String -&gt; a
</span><a href="GHC.Utils.Panic.Plain.html#panic"><span class="hs-identifier hs-var">panic</span></a></span><span>
</span><span id="line-3079"></span><span>        </span><span class="annot"><span class="annottext">String
</span><span class="hs-string">&quot;simplifyArgsWorker wandered into deeper water than usual&quot;</span></span><span>
</span><span id="line-3080"></span><span>           </span><span class="hs-comment">-- This debug information is commented out because leaving it in</span><span>
</span><span id="line-3081"></span><span>           </span><span class="hs-comment">-- causes a ~2% increase in allocations in T9872d.</span><span>
</span><span id="line-3082"></span><span>           </span><span class="hs-comment">-- That's independent of the analogous case in rewrite_args_fast</span><span>
</span><span id="line-3083"></span><span>           </span><span class="hs-comment">-- in GHC.Tc.Solver.Rewrite:</span><span>
</span><span id="line-3084"></span><span>           </span><span class="hs-comment">-- each of these causes a 2% increase on its own, so commenting them</span><span>
</span><span id="line-3085"></span><span>           </span><span class="hs-comment">-- both out gives a 4% decrease in T9872d.</span><span>
</span><span id="line-3086"></span><span>           </span><span class="hs-comment">{-

             (vcat [ppr orig_binders,
                    ppr orig_inner_ki,
                    ppr (take 10 orig_roles), -- often infinite!
                    ppr orig_tys])
           -}</span><span>
</span><span id="line-3093"></span><span>
</span><span id="line-3094"></span><span class="hs-comment">{-
%************************************************************************
%*                                                                      *
       Coercion holes
%*                                                                      *
%************************************************************************
-}</span><span>
</span><span id="line-3101"></span><span>
</span><span id="line-3102"></span><span class="annot"><a href="GHC.Core.Coercion.html#has_co_hole_ty"><span class="hs-identifier hs-type">has_co_hole_ty</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><a href="GHC.Core.TyCo.Rep.html#Type"><span class="hs-identifier hs-type">Type</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="../../base-4.16.4.0/src/Data-Semigroup-Internal.html#Any"><span class="hs-identifier hs-type">Monoid.Any</span></a></span><span>
</span><span id="line-3103"></span><span class="annot"><a href="GHC.Core.Coercion.html#has_co_hole_co"><span class="hs-identifier hs-type">has_co_hole_co</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><a href="GHC.Core.TyCo.Rep.html#Coercion"><span class="hs-identifier hs-type">Coercion</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="../../base-4.16.4.0/src/Data-Semigroup-Internal.html#Any"><span class="hs-identifier hs-type">Monoid.Any</span></a></span><span>
</span><span id="line-3104"></span><span class="hs-special">(</span><span id="has_co_hole_ty"><span class="annot"><span class="annottext">Type -&gt; Any
</span><a href="GHC.Core.Coercion.html#has_co_hole_ty"><span class="hs-identifier hs-var">has_co_hole_ty</span></a></span></span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">[Type] -&gt; Any
</span><span class="hs-identifier">_</span></span><span class="hs-special">,</span><span> </span><span id="has_co_hole_co"><span class="annot"><span class="annottext">Coercion -&gt; Any
</span><a href="GHC.Core.Coercion.html#has_co_hole_co"><span class="hs-identifier hs-var">has_co_hole_co</span></a></span></span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">[Coercion] -&gt; Any
</span><span class="hs-identifier">_</span></span><span class="hs-special">)</span><span>
</span><span id="line-3105"></span><span>  </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">forall a env.
Monoid a =&gt;
TyCoFolder env a
-&gt; env -&gt; (Type -&gt; a, [Type] -&gt; a, Coercion -&gt; a, [Coercion] -&gt; a)
</span><a href="GHC.Core.TyCo.Rep.html#foldTyCo"><span class="hs-identifier hs-var">foldTyCo</span></a></span><span> </span><span class="annot"><span class="annottext">forall {env}. TyCoFolder env Any
</span><a href="#local-6989586621681033621"><span class="hs-identifier hs-var">folder</span></a></span><span> </span><span class="hs-special">(</span><span class="hs-special">)</span><span>
</span><span id="line-3106"></span><span>  </span><span class="hs-keyword">where</span><span>
</span><span id="line-3107"></span><span>    </span><span id="local-6989586621681033621"><span class="annot"><span class="annottext">folder :: TyCoFolder env Any
</span><a href="#local-6989586621681033621"><span class="hs-identifier hs-var hs-var">folder</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><a href="GHC.Core.TyCo.Rep.html#TyCoFolder"><span class="hs-identifier hs-type">TyCoFolder</span></a></span><span> </span><span class="hs-special">{</span><span> </span><span class="annot"><span class="annottext">tcf_view :: Type -&gt; Maybe Type
</span><a href="GHC.Core.TyCo.Rep.html#tcf_view"><span class="hs-identifier hs-var">tcf_view</span></a></span><span>  </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">forall a b. a -&gt; b -&gt; a
</span><a href="../../base-4.16.4.0/src/GHC-Base.html#const"><span class="hs-identifier hs-var">const</span></a></span><span> </span><span class="annot"><span class="annottext">forall a. Maybe a
</span><a href="../../base-4.16.4.0/src/GHC-Maybe.html#Nothing"><span class="hs-identifier hs-var">Nothing</span></a></span><span>
</span><span id="line-3108"></span><span>                        </span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">tcf_tyvar :: env -&gt; CoVar -&gt; Any
</span><a href="GHC.Core.TyCo.Rep.html#tcf_tyvar"><span class="hs-identifier hs-var">tcf_tyvar</span></a></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">forall a b c. a -&gt; b -&gt; c -&gt; a
</span><a href="#local-6989586621681033616"><span class="hs-identifier hs-var">const2</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Bool -&gt; Any
</span><a href="../../base-4.16.4.0/src/Data-Semigroup-Internal.html#Any"><span class="hs-identifier hs-var">Monoid.Any</span></a></span><span> </span><span class="annot"><span class="annottext">Bool
</span><span class="hs-identifier hs-var">False</span></span><span class="hs-special">)</span><span>
</span><span id="line-3109"></span><span>                        </span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">tcf_covar :: env -&gt; CoVar -&gt; Any
</span><a href="GHC.Core.TyCo.Rep.html#tcf_covar"><span class="hs-identifier hs-var">tcf_covar</span></a></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">forall a b c. a -&gt; b -&gt; c -&gt; a
</span><a href="#local-6989586621681033616"><span class="hs-identifier hs-var">const2</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Bool -&gt; Any
</span><a href="../../base-4.16.4.0/src/Data-Semigroup-Internal.html#Any"><span class="hs-identifier hs-var">Monoid.Any</span></a></span><span> </span><span class="annot"><span class="annottext">Bool
</span><span class="hs-identifier hs-var">False</span></span><span class="hs-special">)</span><span>
</span><span id="line-3110"></span><span>                        </span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">tcf_hole :: env -&gt; CoercionHole -&gt; Any
</span><a href="GHC.Core.TyCo.Rep.html#tcf_hole"><span class="hs-identifier hs-var">tcf_hole</span></a></span><span>  </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">forall a b c. a -&gt; b -&gt; c -&gt; a
</span><a href="#local-6989586621681033616"><span class="hs-identifier hs-var">const2</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Bool -&gt; Any
</span><a href="../../base-4.16.4.0/src/Data-Semigroup-Internal.html#Any"><span class="hs-identifier hs-var">Monoid.Any</span></a></span><span> </span><span class="annot"><span class="annottext">Bool
</span><span class="hs-identifier hs-var">True</span></span><span class="hs-special">)</span><span>
</span><span id="line-3111"></span><span>                        </span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">tcf_tycobinder :: env -&gt; CoVar -&gt; ArgFlag -&gt; env
</span><a href="GHC.Core.TyCo.Rep.html#tcf_tycobinder"><span class="hs-identifier hs-var">tcf_tycobinder</span></a></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">forall a b c. a -&gt; b -&gt; c -&gt; a
</span><a href="#local-6989586621681033616"><span class="hs-identifier hs-var">const2</span></a></span><span>
</span><span id="line-3112"></span><span>                        </span><span class="hs-special">}</span><span>
</span><span id="line-3113"></span><span>
</span><span id="line-3114"></span><span>    </span><span id="local-6989586621681035585"><span id="local-6989586621681035586"><span id="local-6989586621681035587"><span class="annot"><a href="#local-6989586621681033616"><span class="hs-identifier hs-type">const2</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><a href="#local-6989586621681035587"><span class="hs-identifier hs-type">a</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="#local-6989586621681035586"><span class="hs-identifier hs-type">b</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="#local-6989586621681035585"><span class="hs-identifier hs-type">c</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="#local-6989586621681035587"><span class="hs-identifier hs-type">a</span></a></span></span></span></span><span>
</span><span id="line-3115"></span><span>    </span><span id="local-6989586621681033616"><span class="annot"><span class="annottext">const2 :: forall a b c. a -&gt; b -&gt; c -&gt; a
</span><a href="#local-6989586621681033616"><span class="hs-identifier hs-var hs-var">const2</span></a></span></span><span> </span><span id="local-6989586621681033611"><span class="annot"><span class="annottext">a
</span><a href="#local-6989586621681033611"><span class="hs-identifier hs-var">x</span></a></span></span><span> </span><span class="annot"><span class="annottext">b
</span><span class="hs-identifier">_</span></span><span> </span><span class="annot"><span class="annottext">c
</span><span class="hs-identifier">_</span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">a
</span><a href="#local-6989586621681033611"><span class="hs-identifier hs-var">x</span></a></span><span>
</span><span id="line-3116"></span><span>
</span><span id="line-3117"></span><span class="hs-comment">-- | Is there a coercion hole in this type?</span><span>
</span><span id="line-3118"></span><span class="annot"><a href="GHC.Core.Coercion.html#hasCoercionHoleTy"><span class="hs-identifier hs-type">hasCoercionHoleTy</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><a href="GHC.Core.TyCo.Rep.html#Type"><span class="hs-identifier hs-type">Type</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="hs-identifier hs-type">Bool</span></span><span>
</span><span id="line-3119"></span><span id="hasCoercionHoleTy"><span class="annot"><span class="annottext">hasCoercionHoleTy :: Type -&gt; Bool
</span><a href="GHC.Core.Coercion.html#hasCoercionHoleTy"><span class="hs-identifier hs-var hs-var">hasCoercionHoleTy</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">Any -&gt; Bool
</span><a href="../../base-4.16.4.0/src/Data-Semigroup-Internal.html#getAny"><span class="hs-identifier hs-var">Monoid.getAny</span></a></span><span> </span><span class="annot"><span class="annottext">forall b c a. (b -&gt; c) -&gt; (a -&gt; b) -&gt; a -&gt; c
</span><a href="../../base-4.16.4.0/src/GHC-Base.html#."><span class="hs-operator hs-var">.</span></a></span><span> </span><span class="annot"><span class="annottext">Type -&gt; Any
</span><a href="GHC.Core.Coercion.html#has_co_hole_ty"><span class="hs-identifier hs-var">has_co_hole_ty</span></a></span><span>
</span><span id="line-3120"></span><span>
</span><span id="line-3121"></span><span class="hs-comment">-- | Is there a coercion hole in this coercion?</span><span>
</span><span id="line-3122"></span><span class="annot"><a href="GHC.Core.Coercion.html#hasCoercionHoleCo"><span class="hs-identifier hs-type">hasCoercionHoleCo</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><a href="GHC.Core.TyCo.Rep.html#Coercion"><span class="hs-identifier hs-type">Coercion</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="hs-identifier hs-type">Bool</span></span><span>
</span><span id="line-3123"></span><span id="hasCoercionHoleCo"><span class="annot"><span class="annottext">hasCoercionHoleCo :: Coercion -&gt; Bool
</span><a href="GHC.Core.Coercion.html#hasCoercionHoleCo"><span class="hs-identifier hs-var hs-var">hasCoercionHoleCo</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">Any -&gt; Bool
</span><a href="../../base-4.16.4.0/src/Data-Semigroup-Internal.html#getAny"><span class="hs-identifier hs-var">Monoid.getAny</span></a></span><span> </span><span class="annot"><span class="annottext">forall b c a. (b -&gt; c) -&gt; (a -&gt; b) -&gt; a -&gt; c
</span><a href="../../base-4.16.4.0/src/GHC-Base.html#."><span class="hs-operator hs-var">.</span></a></span><span> </span><span class="annot"><span class="annottext">Coercion -&gt; Any
</span><a href="GHC.Core.Coercion.html#has_co_hole_co"><span class="hs-identifier hs-var">has_co_hole_co</span></a></span><span>
</span><span id="line-3124"></span><span>
</span><span id="line-3125"></span><span class="hs-comment">-- | A set of 'CoercionHole's</span><span>
</span><span id="line-3126"></span><span class="hs-keyword">type</span><span> </span><span id="HoleSet"><span class="annot"><a href="GHC.Core.Coercion.html#HoleSet"><span class="hs-identifier hs-var">HoleSet</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><a href="GHC.Types.Unique.Set.html#UniqSet"><span class="hs-identifier hs-type">UniqSet</span></a></span><span> </span><span class="annot"><a href="GHC.Core.TyCo.Rep.html#CoercionHole"><span class="hs-identifier hs-type">CoercionHole</span></a></span><span>
</span><span id="line-3127"></span><span>
</span><span id="line-3128"></span><span class="hs-comment">-- | Extract out all the coercion holes from a given type</span><span>
</span><span id="line-3129"></span><span class="annot"><a href="GHC.Core.Coercion.html#coercionHolesOfType"><span class="hs-identifier hs-type">coercionHolesOfType</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><a href="GHC.Core.TyCo.Rep.html#Type"><span class="hs-identifier hs-type">Type</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="GHC.Types.Unique.Set.html#UniqSet"><span class="hs-identifier hs-type">UniqSet</span></a></span><span> </span><span class="annot"><a href="GHC.Core.TyCo.Rep.html#CoercionHole"><span class="hs-identifier hs-type">CoercionHole</span></a></span><span>
</span><span id="line-3130"></span><span class="annot"><a href="GHC.Core.Coercion.html#coercionHolesOfCo"><span class="hs-identifier hs-type">coercionHolesOfCo</span></a></span><span>   </span><span class="hs-glyph">::</span><span> </span><span class="annot"><a href="GHC.Core.TyCo.Rep.html#Coercion"><span class="hs-identifier hs-type">Coercion</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="GHC.Types.Unique.Set.html#UniqSet"><span class="hs-identifier hs-type">UniqSet</span></a></span><span> </span><span class="annot"><a href="GHC.Core.TyCo.Rep.html#CoercionHole"><span class="hs-identifier hs-type">CoercionHole</span></a></span><span>
</span><span id="line-3131"></span><span class="hs-special">(</span><span id="coercionHolesOfType"><span class="annot"><span class="annottext">Type -&gt; UniqSet CoercionHole
</span><a href="GHC.Core.Coercion.html#coercionHolesOfType"><span class="hs-identifier hs-var">coercionHolesOfType</span></a></span></span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">[Type] -&gt; UniqSet CoercionHole
</span><span class="hs-identifier">_</span></span><span class="hs-special">,</span><span> </span><span id="coercionHolesOfCo"><span class="annot"><span class="annottext">Coercion -&gt; UniqSet CoercionHole
</span><a href="GHC.Core.Coercion.html#coercionHolesOfCo"><span class="hs-identifier hs-var">coercionHolesOfCo</span></a></span></span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">[Coercion] -&gt; UniqSet CoercionHole
</span><span class="hs-identifier">_</span></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">forall a env.
Monoid a =&gt;
TyCoFolder env a
-&gt; env -&gt; (Type -&gt; a, [Type] -&gt; a, Coercion -&gt; a, [Coercion] -&gt; a)
</span><a href="GHC.Core.TyCo.Rep.html#foldTyCo"><span class="hs-identifier hs-var">foldTyCo</span></a></span><span> </span><span class="annot"><span class="annottext">TyCoFolder () (UniqSet CoercionHole)
</span><a href="#local-6989586621681033607"><span class="hs-identifier hs-var">folder</span></a></span><span> </span><span class="hs-special">(</span><span class="hs-special">)</span><span>
</span><span id="line-3132"></span><span>  </span><span class="hs-keyword">where</span><span>
</span><span id="line-3133"></span><span>    </span><span id="local-6989586621681033607"><span class="annot"><span class="annottext">folder :: TyCoFolder () (UniqSet CoercionHole)
</span><a href="#local-6989586621681033607"><span class="hs-identifier hs-var hs-var">folder</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><a href="GHC.Core.TyCo.Rep.html#TyCoFolder"><span class="hs-identifier hs-type">TyCoFolder</span></a></span><span> </span><span class="hs-special">{</span><span> </span><span class="annot"><span class="annottext">tcf_view :: Type -&gt; Maybe Type
</span><a href="GHC.Core.TyCo.Rep.html#tcf_view"><span class="hs-identifier hs-var">tcf_view</span></a></span><span>  </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">forall a b. a -&gt; b -&gt; a
</span><a href="../../base-4.16.4.0/src/GHC-Base.html#const"><span class="hs-identifier hs-var">const</span></a></span><span> </span><span class="annot"><span class="annottext">forall a. Maybe a
</span><a href="../../base-4.16.4.0/src/GHC-Maybe.html#Nothing"><span class="hs-identifier hs-var">Nothing</span></a></span><span>  </span><span class="hs-comment">-- don't look through synonyms</span><span>
</span><span id="line-3134"></span><span>                        </span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">tcf_tyvar :: () -&gt; CoVar -&gt; UniqSet CoercionHole
</span><a href="GHC.Core.TyCo.Rep.html#tcf_tyvar"><span class="hs-identifier hs-var">tcf_tyvar</span></a></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-glyph">\</span><span> </span><span class="annot"><span class="annottext">()
</span><span class="hs-identifier">_</span></span><span> </span><span class="annot"><span class="annottext">CoVar
</span><span class="hs-identifier">_</span></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="annottext">forall a. Monoid a =&gt; a
</span><a href="../../base-4.16.4.0/src/GHC-Base.html#mempty"><span class="hs-identifier hs-var">mempty</span></a></span><span>
</span><span id="line-3135"></span><span>                        </span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">tcf_covar :: () -&gt; CoVar -&gt; UniqSet CoercionHole
</span><a href="GHC.Core.TyCo.Rep.html#tcf_covar"><span class="hs-identifier hs-var">tcf_covar</span></a></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-glyph">\</span><span> </span><span class="annot"><span class="annottext">()
</span><span class="hs-identifier">_</span></span><span> </span><span class="annot"><span class="annottext">CoVar
</span><span class="hs-identifier">_</span></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="annottext">forall a. Monoid a =&gt; a
</span><a href="../../base-4.16.4.0/src/GHC-Base.html#mempty"><span class="hs-identifier hs-var">mempty</span></a></span><span>
</span><span id="line-3136"></span><span>                        </span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">tcf_hole :: () -&gt; CoercionHole -&gt; UniqSet CoercionHole
</span><a href="GHC.Core.TyCo.Rep.html#tcf_hole"><span class="hs-identifier hs-var">tcf_hole</span></a></span><span>  </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">forall a b. a -&gt; b -&gt; a
</span><a href="../../base-4.16.4.0/src/GHC-Base.html#const"><span class="hs-identifier hs-var">const</span></a></span><span> </span><span class="annot"><span class="annottext">forall a. Uniquable a =&gt; a -&gt; UniqSet a
</span><a href="GHC.Types.Unique.Set.html#unitUniqSet"><span class="hs-identifier hs-var">unitUniqSet</span></a></span><span>
</span><span id="line-3137"></span><span>                        </span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">tcf_tycobinder :: () -&gt; CoVar -&gt; ArgFlag -&gt; ()
</span><a href="GHC.Core.TyCo.Rep.html#tcf_tycobinder"><span class="hs-identifier hs-var">tcf_tycobinder</span></a></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-glyph">\</span><span> </span><span class="annot"><span class="annottext">()
</span><span class="hs-identifier">_</span></span><span> </span><span class="annot"><span class="annottext">CoVar
</span><span class="hs-identifier">_</span></span><span> </span><span class="annot"><span class="annottext">ArgFlag
</span><span class="hs-identifier">_</span></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-special">(</span><span class="hs-special">)</span><span>
</span><span id="line-3138"></span><span>                        </span><span class="hs-special">}</span><span>
</span><span id="line-3139"></span></pre></body></html>