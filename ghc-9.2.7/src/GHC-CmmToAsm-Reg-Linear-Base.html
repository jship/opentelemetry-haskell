<?xml version="1.0" encoding="UTF-8"?>
<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Strict//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-strict.dtd">
<html>
<head>
<!-- Generated by HsColour, http://code.haskell.org/~malcolm/hscolour/ -->
<title>GHC/CmmToAsm/Reg/Linear/Base.hs</title>
<link type='text/css' rel='stylesheet' href='hscolour.css' />
</head>
<body>
<pre><a name="line-1"></a><span class='hs-comment'>{-# LANGUAGE RecordWildCards #-}</span>
<a name="line-2"></a>
<a name="line-3"></a><span class='hs-comment'>-- | Put common type definitions here to break recursive module dependencies.</span>
<a name="line-4"></a>
<a name="line-5"></a><span class='hs-keyword'>module</span> <span class='hs-conid'>GHC.CmmToAsm.Reg.Linear.Base</span> <span class='hs-layout'>(</span>
<a name="line-6"></a>        <span class='hs-conid'>BlockAssignment</span><span class='hs-layout'>,</span>
<a name="line-7"></a>        <span class='hs-varid'>lookupBlockAssignment</span><span class='hs-layout'>,</span>
<a name="line-8"></a>        <span class='hs-varid'>lookupFirstUsed</span><span class='hs-layout'>,</span>
<a name="line-9"></a>        <span class='hs-varid'>emptyBlockAssignment</span><span class='hs-layout'>,</span>
<a name="line-10"></a>        <span class='hs-varid'>updateBlockAssignment</span><span class='hs-layout'>,</span>
<a name="line-11"></a>
<a name="line-12"></a>        <span class='hs-conid'>Loc</span><span class='hs-layout'>(</span><span class='hs-keyglyph'>..</span><span class='hs-layout'>)</span><span class='hs-layout'>,</span>
<a name="line-13"></a>        <span class='hs-varid'>regsOfLoc</span><span class='hs-layout'>,</span>
<a name="line-14"></a>
<a name="line-15"></a>        <span class='hs-comment'>-- for stats</span>
<a name="line-16"></a>        <span class='hs-conid'>SpillReason</span><span class='hs-layout'>(</span><span class='hs-keyglyph'>..</span><span class='hs-layout'>)</span><span class='hs-layout'>,</span>
<a name="line-17"></a>        <span class='hs-conid'>RegAllocStats</span><span class='hs-layout'>(</span><span class='hs-keyglyph'>..</span><span class='hs-layout'>)</span><span class='hs-layout'>,</span>
<a name="line-18"></a>
<a name="line-19"></a>        <span class='hs-comment'>-- the allocator monad</span>
<a name="line-20"></a>        <span class='hs-conid'>RA_State</span><span class='hs-layout'>(</span><span class='hs-keyglyph'>..</span><span class='hs-layout'>)</span><span class='hs-layout'>,</span>
<a name="line-21"></a><span class='hs-layout'>)</span>
<a name="line-22"></a>
<a name="line-23"></a><span class='hs-keyword'>where</span>
<a name="line-24"></a>
<a name="line-25"></a><span class='hs-keyword'>import</span> <span class='hs-conid'>GHC.Prelude</span>
<a name="line-26"></a>
<a name="line-27"></a><span class='hs-keyword'>import</span> <span class='hs-conid'>GHC.CmmToAsm.Reg.Linear.StackMap</span>
<a name="line-28"></a><span class='hs-keyword'>import</span> <span class='hs-conid'>GHC.CmmToAsm.Reg.Liveness</span>
<a name="line-29"></a><span class='hs-keyword'>import</span> <span class='hs-conid'>GHC.CmmToAsm.Config</span>
<a name="line-30"></a><span class='hs-keyword'>import</span> <span class='hs-conid'>GHC.Platform.Reg</span>
<a name="line-31"></a>
<a name="line-32"></a><span class='hs-keyword'>import</span> <span class='hs-conid'>GHC.Utils.Outputable</span>
<a name="line-33"></a><span class='hs-keyword'>import</span> <span class='hs-conid'>GHC.Types.Unique</span>
<a name="line-34"></a><span class='hs-keyword'>import</span> <span class='hs-conid'>GHC.Types.Unique.FM</span>
<a name="line-35"></a><span class='hs-keyword'>import</span> <span class='hs-conid'>GHC.Types.Unique.Supply</span>
<a name="line-36"></a><span class='hs-keyword'>import</span> <span class='hs-conid'>GHC.Cmm.BlockId</span>
<a name="line-37"></a><span class='hs-keyword'>import</span> <span class='hs-conid'>GHC.Cmm.Dataflow.Collections</span>
<a name="line-38"></a><span class='hs-keyword'>import</span> <span class='hs-conid'>GHC.CmmToAsm.Reg.Utils</span>
<a name="line-39"></a>
<a name="line-40"></a><a name="ReadingOrWriting"></a><span class='hs-keyword'>data</span> <span class='hs-conid'>ReadingOrWriting</span> <span class='hs-keyglyph'>=</span> <span class='hs-conid'>Reading</span> <span class='hs-keyglyph'>|</span> <span class='hs-conid'>Writing</span> <span class='hs-keyword'>deriving</span> <span class='hs-layout'>(</span><span class='hs-conid'>Eq</span><span class='hs-layout'>,</span><span class='hs-conid'>Ord</span><span class='hs-layout'>)</span>
<a name="line-41"></a>
<a name="line-42"></a><a name="BlockAssignment"></a><span class='hs-comment'>-- | Used to store the register assignment on entry to a basic block.</span>
<a name="line-43"></a><a name="BlockAssignment"></a><span class='hs-comment'>--      We use this to handle join points, where multiple branch instructions</span>
<a name="line-44"></a><a name="BlockAssignment"></a><span class='hs-comment'>--      target a particular label. We have to insert fixup code to make</span>
<a name="line-45"></a><a name="BlockAssignment"></a><span class='hs-comment'>--      the register assignments from the different sources match up.</span>
<a name="line-46"></a><a name="BlockAssignment"></a><span class='hs-comment'>--</span>
<a name="line-47"></a><a name="BlockAssignment"></a><span class='hs-keyword'>data</span> <span class='hs-conid'>BlockAssignment</span> <span class='hs-varid'>freeRegs</span>
<a name="line-48"></a>        <span class='hs-keyglyph'>=</span> <span class='hs-conid'>BlockAssignment</span> <span class='hs-layout'>{</span> <span class='hs-varid'>blockMap</span> <span class='hs-keyglyph'>::</span> <span class='hs-varop'>!</span><span class='hs-layout'>(</span><span class='hs-conid'>BlockMap</span> <span class='hs-layout'>(</span><span class='hs-varid'>freeRegs</span><span class='hs-layout'>,</span> <span class='hs-conid'>RegMap</span> <span class='hs-conid'>Loc</span><span class='hs-layout'>)</span><span class='hs-layout'>)</span>
<a name="line-49"></a>                          <span class='hs-layout'>,</span> <span class='hs-varid'>firstUsed</span> <span class='hs-keyglyph'>::</span> <span class='hs-varop'>!</span><span class='hs-layout'>(</span><span class='hs-conid'>UniqFM</span> <span class='hs-conid'>VirtualReg</span> <span class='hs-conid'>RealReg</span><span class='hs-layout'>)</span> <span class='hs-layout'>}</span>
<a name="line-50"></a>
<a name="line-51"></a><a name="lookupBlockAssignment"></a><span class='hs-comment'>-- | Find the register mapping for a specific BlockId.</span>
<a name="line-52"></a><span class='hs-definition'>lookupBlockAssignment</span> <span class='hs-keyglyph'>::</span> <span class='hs-conid'>BlockId</span> <span class='hs-keyglyph'>-&gt;</span> <span class='hs-conid'>BlockAssignment</span> <span class='hs-varid'>freeRegs</span> <span class='hs-keyglyph'>-&gt;</span> <span class='hs-conid'>Maybe</span> <span class='hs-layout'>(</span><span class='hs-varid'>freeRegs</span><span class='hs-layout'>,</span> <span class='hs-conid'>RegMap</span> <span class='hs-conid'>Loc</span><span class='hs-layout'>)</span>
<a name="line-53"></a><span class='hs-definition'>lookupBlockAssignment</span> <span class='hs-varid'>bid</span> <span class='hs-varid'>ba</span> <span class='hs-keyglyph'>=</span> <span class='hs-varid'>mapLookup</span> <span class='hs-varid'>bid</span> <span class='hs-layout'>(</span><span class='hs-varid'>blockMap</span> <span class='hs-varid'>ba</span><span class='hs-layout'>)</span>
<a name="line-54"></a>
<a name="line-55"></a><a name="lookupFirstUsed"></a><span class='hs-comment'>-- | Lookup which register a virtual register was first assigned to.</span>
<a name="line-56"></a><span class='hs-definition'>lookupFirstUsed</span> <span class='hs-keyglyph'>::</span> <span class='hs-conid'>VirtualReg</span> <span class='hs-keyglyph'>-&gt;</span> <span class='hs-conid'>BlockAssignment</span> <span class='hs-varid'>freeRegs</span> <span class='hs-keyglyph'>-&gt;</span> <span class='hs-conid'>Maybe</span> <span class='hs-conid'>RealReg</span>
<a name="line-57"></a><span class='hs-definition'>lookupFirstUsed</span> <span class='hs-varid'>vr</span> <span class='hs-varid'>ba</span> <span class='hs-keyglyph'>=</span> <span class='hs-varid'>lookupUFM</span> <span class='hs-layout'>(</span><span class='hs-varid'>firstUsed</span> <span class='hs-varid'>ba</span><span class='hs-layout'>)</span> <span class='hs-varid'>vr</span>
<a name="line-58"></a>
<a name="line-59"></a><a name="emptyBlockAssignment"></a><span class='hs-comment'>-- | An initial empty 'BlockAssignment'</span>
<a name="line-60"></a><span class='hs-definition'>emptyBlockAssignment</span> <span class='hs-keyglyph'>::</span> <span class='hs-conid'>BlockAssignment</span> <span class='hs-varid'>freeRegs</span>
<a name="line-61"></a><span class='hs-definition'>emptyBlockAssignment</span> <span class='hs-keyglyph'>=</span> <span class='hs-conid'>BlockAssignment</span> <span class='hs-varid'>mapEmpty</span> <span class='hs-varid'>mempty</span>
<a name="line-62"></a>
<a name="line-63"></a><a name="updateBlockAssignment"></a><span class='hs-comment'>-- | Add new register mappings for a specific block.</span>
<a name="line-64"></a><span class='hs-definition'>updateBlockAssignment</span> <span class='hs-keyglyph'>::</span> <span class='hs-conid'>BlockId</span>
<a name="line-65"></a>  <span class='hs-keyglyph'>-&gt;</span> <span class='hs-layout'>(</span><span class='hs-varid'>freeRegs</span><span class='hs-layout'>,</span> <span class='hs-conid'>RegMap</span> <span class='hs-conid'>Loc</span><span class='hs-layout'>)</span>
<a name="line-66"></a>  <span class='hs-keyglyph'>-&gt;</span> <span class='hs-conid'>BlockAssignment</span> <span class='hs-varid'>freeRegs</span>
<a name="line-67"></a>  <span class='hs-keyglyph'>-&gt;</span> <span class='hs-conid'>BlockAssignment</span> <span class='hs-varid'>freeRegs</span>
<a name="line-68"></a><span class='hs-definition'>updateBlockAssignment</span> <span class='hs-varid'>dest</span> <span class='hs-layout'>(</span><span class='hs-varid'>freeRegs</span><span class='hs-layout'>,</span> <span class='hs-varid'>regMap</span><span class='hs-layout'>)</span> <span class='hs-layout'>(</span><span class='hs-conid'>BlockAssignment</span> <span class='hs-layout'>{</span><span class='hs-keyglyph'>..</span><span class='hs-layout'>}</span><span class='hs-layout'>)</span> <span class='hs-keyglyph'>=</span>
<a name="line-69"></a>  <span class='hs-conid'>BlockAssignment</span> <span class='hs-layout'>(</span><span class='hs-varid'>mapInsert</span> <span class='hs-varid'>dest</span> <span class='hs-layout'>(</span><span class='hs-varid'>freeRegs</span><span class='hs-layout'>,</span> <span class='hs-varid'>regMap</span><span class='hs-layout'>)</span> <span class='hs-varid'>blockMap</span><span class='hs-layout'>)</span>
<a name="line-70"></a>                  <span class='hs-layout'>(</span><span class='hs-varid'>mergeUFM</span> <span class='hs-varid'>combWithExisting</span> <span class='hs-varid'>id</span> <span class='hs-layout'>(</span><span class='hs-varid'>mapMaybeUFM</span> <span class='hs-varid'>fromLoc</span><span class='hs-layout'>)</span> <span class='hs-layout'>(</span><span class='hs-varid'>firstUsed</span><span class='hs-layout'>)</span> <span class='hs-layout'>(</span><span class='hs-varid'>toVRegMap</span> <span class='hs-varid'>regMap</span><span class='hs-layout'>)</span><span class='hs-layout'>)</span>
<a name="line-71"></a>  <span class='hs-keyword'>where</span>
<a name="line-72"></a>    <span class='hs-comment'>-- The blocks are processed in dependency order, so if there's already an</span>
<a name="line-73"></a>    <span class='hs-comment'>-- entry in the map then keep that assignment rather than writing the new</span>
<a name="line-74"></a>    <span class='hs-comment'>-- assignment.</span>
<a name="line-75"></a>    <span class='hs-varid'>combWithExisting</span> <span class='hs-keyglyph'>::</span> <span class='hs-conid'>RealReg</span> <span class='hs-keyglyph'>-&gt;</span> <span class='hs-conid'>Loc</span> <span class='hs-keyglyph'>-&gt;</span> <span class='hs-conid'>Maybe</span> <span class='hs-conid'>RealReg</span>
<a name="line-76"></a>    <span class='hs-varid'>combWithExisting</span> <span class='hs-varid'>old_reg</span> <span class='hs-keyword'>_</span> <span class='hs-keyglyph'>=</span> <span class='hs-conid'>Just</span> <span class='hs-varop'>$</span> <span class='hs-varid'>old_reg</span>
<a name="line-77"></a>
<a name="line-78"></a>    <span class='hs-varid'>fromLoc</span> <span class='hs-keyglyph'>::</span> <span class='hs-conid'>Loc</span> <span class='hs-keyglyph'>-&gt;</span> <span class='hs-conid'>Maybe</span> <span class='hs-conid'>RealReg</span>
<a name="line-79"></a>    <span class='hs-varid'>fromLoc</span> <span class='hs-layout'>(</span><span class='hs-conid'>InReg</span> <span class='hs-varid'>rr</span><span class='hs-layout'>)</span> <span class='hs-keyglyph'>=</span> <span class='hs-conid'>Just</span> <span class='hs-varid'>rr</span>
<a name="line-80"></a>    <span class='hs-varid'>fromLoc</span> <span class='hs-layout'>(</span><span class='hs-conid'>InBoth</span> <span class='hs-varid'>rr</span> <span class='hs-keyword'>_</span><span class='hs-layout'>)</span> <span class='hs-keyglyph'>=</span> <span class='hs-conid'>Just</span> <span class='hs-varid'>rr</span>
<a name="line-81"></a>    <span class='hs-varid'>fromLoc</span> <span class='hs-keyword'>_</span> <span class='hs-keyglyph'>=</span> <span class='hs-conid'>Nothing</span>
<a name="line-82"></a>
<a name="line-83"></a>
<a name="line-84"></a><span class='hs-comment'>-- | Where a vreg is currently stored</span>
<a name="line-85"></a><span class='hs-comment'>--      A temporary can be marked as living in both a register and memory</span>
<a name="line-86"></a><span class='hs-comment'>--      (InBoth), for example if it was recently loaded from a spill location.</span>
<a name="line-87"></a><span class='hs-comment'>--      This makes it cheap to spill (no save instruction required), but we</span>
<a name="line-88"></a><span class='hs-comment'>--      have to be careful to turn this into InReg if the value in the</span>
<a name="line-89"></a><span class='hs-comment'>--      register is changed.</span>
<a name="line-90"></a>
<a name="line-91"></a><a name="Loc"></a><span class='hs-comment'>--      This is also useful when a temporary is about to be clobbered.  We</span>
<a name="line-92"></a><a name="Loc"></a><span class='hs-comment'>--      save it in a spill location, but mark it as InBoth because the current</span>
<a name="line-93"></a><a name="Loc"></a><span class='hs-comment'>--      instruction might still want to read it.</span>
<a name="line-94"></a><a name="Loc"></a><span class='hs-comment'>--</span>
<a name="line-95"></a><a name="Loc"></a><span class='hs-keyword'>data</span> <span class='hs-conid'>Loc</span>
<a name="line-96"></a>        <span class='hs-comment'>-- | vreg is in a register</span>
<a name="line-97"></a>        <span class='hs-keyglyph'>=</span> <span class='hs-conid'>InReg</span>   <span class='hs-varop'>!</span><span class='hs-conid'>RealReg</span>
<a name="line-98"></a>
<a name="line-99"></a>        <span class='hs-comment'>-- | vreg is held in a stack slot</span>
<a name="line-100"></a>        <span class='hs-keyglyph'>|</span> <span class='hs-conid'>InMem</span>   <span class='hs-comment'>{-# UNPACK #-}</span>  <span class='hs-varop'>!</span><span class='hs-conid'>StackSlot</span>
<a name="line-101"></a>
<a name="line-102"></a>
<a name="line-103"></a>        <span class='hs-comment'>-- | vreg is held in both a register and a stack slot</span>
<a name="line-104"></a>        <span class='hs-keyglyph'>|</span> <span class='hs-conid'>InBoth</span>   <span class='hs-varop'>!</span><span class='hs-conid'>RealReg</span>
<a name="line-105"></a>                   <span class='hs-comment'>{-# UNPACK #-}</span> <span class='hs-varop'>!</span><span class='hs-conid'>StackSlot</span>
<a name="line-106"></a>        <span class='hs-keyword'>deriving</span> <span class='hs-layout'>(</span><span class='hs-conid'>Eq</span><span class='hs-layout'>,</span> <span class='hs-conid'>Show</span><span class='hs-layout'>,</span> <span class='hs-conid'>Ord</span><span class='hs-layout'>)</span>
<a name="line-107"></a>
<a name="line-108"></a><a name="instance%20Outputable%20Loc"></a><span class='hs-keyword'>instance</span> <span class='hs-conid'>Outputable</span> <span class='hs-conid'>Loc</span> <span class='hs-keyword'>where</span>
<a name="line-109"></a>        <span class='hs-varid'>ppr</span> <span class='hs-varid'>l</span> <span class='hs-keyglyph'>=</span> <span class='hs-varid'>text</span> <span class='hs-layout'>(</span><span class='hs-varid'>show</span> <span class='hs-varid'>l</span><span class='hs-layout'>)</span>
<a name="line-110"></a>
<a name="line-111"></a>
<a name="line-112"></a><a name="regsOfLoc"></a><span class='hs-comment'>-- | Get the reg numbers stored in this Loc.</span>
<a name="line-113"></a><span class='hs-definition'>regsOfLoc</span> <span class='hs-keyglyph'>::</span> <span class='hs-conid'>Loc</span> <span class='hs-keyglyph'>-&gt;</span> <span class='hs-keyglyph'>[</span><span class='hs-conid'>RealReg</span><span class='hs-keyglyph'>]</span>
<a name="line-114"></a><span class='hs-definition'>regsOfLoc</span> <span class='hs-layout'>(</span><span class='hs-conid'>InReg</span> <span class='hs-varid'>r</span><span class='hs-layout'>)</span>    <span class='hs-keyglyph'>=</span> <span class='hs-keyglyph'>[</span><span class='hs-varid'>r</span><span class='hs-keyglyph'>]</span>
<a name="line-115"></a><span class='hs-definition'>regsOfLoc</span> <span class='hs-layout'>(</span><span class='hs-conid'>InBoth</span> <span class='hs-varid'>r</span> <span class='hs-keyword'>_</span><span class='hs-layout'>)</span> <span class='hs-keyglyph'>=</span> <span class='hs-keyglyph'>[</span><span class='hs-varid'>r</span><span class='hs-keyglyph'>]</span>
<a name="line-116"></a><span class='hs-definition'>regsOfLoc</span> <span class='hs-layout'>(</span><span class='hs-conid'>InMem</span> <span class='hs-keyword'>_</span><span class='hs-layout'>)</span>    <span class='hs-keyglyph'>=</span> <span class='hs-conid'>[]</span>
<a name="line-117"></a>
<a name="line-118"></a>
<a name="line-119"></a><a name="SpillReason"></a><span class='hs-comment'>-- | Reasons why instructions might be inserted by the spiller.</span>
<a name="line-120"></a><a name="SpillReason"></a><span class='hs-comment'>--      Used when generating stats for -ddrop-asm-stats.</span>
<a name="line-121"></a><a name="SpillReason"></a><span class='hs-comment'>--</span>
<a name="line-122"></a><a name="SpillReason"></a><span class='hs-keyword'>data</span> <span class='hs-conid'>SpillReason</span>
<a name="line-123"></a>        <span class='hs-comment'>-- | vreg was spilled to a slot so we could use its</span>
<a name="line-124"></a>        <span class='hs-comment'>--      current hreg for another vreg</span>
<a name="line-125"></a>        <span class='hs-keyglyph'>=</span> <span class='hs-conid'>SpillAlloc</span>    <span class='hs-varop'>!</span><span class='hs-conid'>Unique</span>
<a name="line-126"></a>
<a name="line-127"></a>        <span class='hs-comment'>-- | vreg was moved because its hreg was clobbered</span>
<a name="line-128"></a>        <span class='hs-keyglyph'>|</span> <span class='hs-conid'>SpillClobber</span>  <span class='hs-varop'>!</span><span class='hs-conid'>Unique</span>
<a name="line-129"></a>
<a name="line-130"></a>        <span class='hs-comment'>-- | vreg was loaded from a spill slot</span>
<a name="line-131"></a>        <span class='hs-keyglyph'>|</span> <span class='hs-conid'>SpillLoad</span>     <span class='hs-varop'>!</span><span class='hs-conid'>Unique</span>
<a name="line-132"></a>
<a name="line-133"></a>        <span class='hs-comment'>-- | reg-reg move inserted during join to targets</span>
<a name="line-134"></a>        <span class='hs-keyglyph'>|</span> <span class='hs-conid'>SpillJoinRR</span>   <span class='hs-varop'>!</span><span class='hs-conid'>Unique</span>
<a name="line-135"></a>
<a name="line-136"></a>        <span class='hs-comment'>-- | reg-mem move inserted during join to targets</span>
<a name="line-137"></a>        <span class='hs-keyglyph'>|</span> <span class='hs-conid'>SpillJoinRM</span>   <span class='hs-varop'>!</span><span class='hs-conid'>Unique</span>
<a name="line-138"></a>
<a name="line-139"></a>
<a name="line-140"></a><a name="RegAllocStats"></a><span class='hs-comment'>-- | Used to carry interesting stats out of the register allocator.</span>
<a name="line-141"></a><a name="RegAllocStats"></a><span class='hs-keyword'>data</span> <span class='hs-conid'>RegAllocStats</span>
<a name="line-142"></a>        <span class='hs-keyglyph'>=</span> <span class='hs-conid'>RegAllocStats</span>
<a name="line-143"></a>        <span class='hs-layout'>{</span> <span class='hs-varid'>ra_spillInstrs</span>        <span class='hs-keyglyph'>::</span> <span class='hs-conid'>UniqFM</span> <span class='hs-conid'>Unique</span> <span class='hs-keyglyph'>[</span><span class='hs-conid'>Int</span><span class='hs-keyglyph'>]</span> <span class='hs-comment'>-- Keys are the uniques of regs</span>
<a name="line-144"></a>                                                       <span class='hs-comment'>-- and taken from SpillReason</span>
<a name="line-145"></a>                                                       <span class='hs-comment'>-- See Note [UniqFM and the register allocator]</span>
<a name="line-146"></a>        <span class='hs-layout'>,</span> <span class='hs-varid'>ra_fixupList</span>     <span class='hs-keyglyph'>::</span> <span class='hs-keyglyph'>[</span><span class='hs-layout'>(</span><span class='hs-conid'>BlockId</span><span class='hs-layout'>,</span><span class='hs-conid'>BlockId</span><span class='hs-layout'>,</span><span class='hs-conid'>BlockId</span><span class='hs-layout'>)</span><span class='hs-keyglyph'>]</span>
<a name="line-147"></a>        <span class='hs-comment'>-- ^ (from,fixup,to) : We inserted fixup code between from and to</span>
<a name="line-148"></a>        <span class='hs-layout'>}</span>
<a name="line-149"></a>
<a name="line-150"></a>
<a name="line-151"></a><a name="RA_State"></a><span class='hs-comment'>-- | The register allocator state</span>
<a name="line-152"></a><a name="RA_State"></a><span class='hs-keyword'>data</span> <span class='hs-conid'>RA_State</span> <span class='hs-varid'>freeRegs</span>
<a name="line-153"></a>        <span class='hs-keyglyph'>=</span> <span class='hs-conid'>RA_State</span>
<a name="line-154"></a>
<a name="line-155"></a>        <span class='hs-layout'>{</span>
<a name="line-156"></a>        <span class='hs-comment'>-- | the current mapping from basic blocks to</span>
<a name="line-157"></a>        <span class='hs-comment'>--      the register assignments at the beginning of that block.</span>
<a name="line-158"></a>          <span class='hs-varid'>ra_blockassig</span> <span class='hs-keyglyph'>::</span> <span class='hs-conid'>BlockAssignment</span> <span class='hs-varid'>freeRegs</span>
<a name="line-159"></a>
<a name="line-160"></a>        <span class='hs-comment'>-- | free machine registers</span>
<a name="line-161"></a>        <span class='hs-layout'>,</span> <span class='hs-varid'>ra_freeregs</span>   <span class='hs-keyglyph'>::</span> <span class='hs-varop'>!</span><span class='hs-varid'>freeRegs</span>
<a name="line-162"></a>
<a name="line-163"></a>        <span class='hs-comment'>-- | assignment of temps to locations</span>
<a name="line-164"></a>        <span class='hs-layout'>,</span> <span class='hs-varid'>ra_assig</span>      <span class='hs-keyglyph'>::</span> <span class='hs-conid'>RegMap</span> <span class='hs-conid'>Loc</span>
<a name="line-165"></a>
<a name="line-166"></a>        <span class='hs-comment'>-- | current stack delta</span>
<a name="line-167"></a>        <span class='hs-layout'>,</span> <span class='hs-varid'>ra_delta</span>      <span class='hs-keyglyph'>::</span> <span class='hs-conid'>Int</span>
<a name="line-168"></a>
<a name="line-169"></a>        <span class='hs-comment'>-- | free stack slots for spilling</span>
<a name="line-170"></a>        <span class='hs-layout'>,</span> <span class='hs-varid'>ra_stack</span>      <span class='hs-keyglyph'>::</span> <span class='hs-conid'>StackMap</span>
<a name="line-171"></a>
<a name="line-172"></a>        <span class='hs-comment'>-- | unique supply for generating names for join point fixup blocks.</span>
<a name="line-173"></a>        <span class='hs-layout'>,</span> <span class='hs-varid'>ra_us</span>         <span class='hs-keyglyph'>::</span> <span class='hs-conid'>UniqSupply</span>
<a name="line-174"></a>
<a name="line-175"></a>        <span class='hs-comment'>-- | Record why things were spilled, for -ddrop-asm-stats.</span>
<a name="line-176"></a>        <span class='hs-comment'>--      Just keep a list here instead of a map of regs -&gt; reasons.</span>
<a name="line-177"></a>        <span class='hs-comment'>--      We don't want to slow down the allocator if we're not going to emit the stats.</span>
<a name="line-178"></a>        <span class='hs-layout'>,</span> <span class='hs-varid'>ra_spills</span>     <span class='hs-keyglyph'>::</span> <span class='hs-keyglyph'>[</span><span class='hs-conid'>SpillReason</span><span class='hs-keyglyph'>]</span>
<a name="line-179"></a>
<a name="line-180"></a>        <span class='hs-comment'>-- | Native code generator configuration</span>
<a name="line-181"></a>        <span class='hs-layout'>,</span> <span class='hs-varid'>ra_config</span>     <span class='hs-keyglyph'>::</span> <span class='hs-varop'>!</span><span class='hs-conid'>NCGConfig</span>
<a name="line-182"></a>
<a name="line-183"></a>        <span class='hs-comment'>-- | (from,fixup,to) : We inserted fixup code between from and to</span>
<a name="line-184"></a>        <span class='hs-layout'>,</span> <span class='hs-varid'>ra_fixups</span>     <span class='hs-keyglyph'>::</span> <span class='hs-keyglyph'>[</span><span class='hs-layout'>(</span><span class='hs-conid'>BlockId</span><span class='hs-layout'>,</span><span class='hs-conid'>BlockId</span><span class='hs-layout'>,</span><span class='hs-conid'>BlockId</span><span class='hs-layout'>)</span><span class='hs-keyglyph'>]</span>
<a name="line-185"></a>
<a name="line-186"></a>        <span class='hs-layout'>}</span>
<a name="line-187"></a>
<a name="line-188"></a>
</pre></body>
</html>
