<?xml version="1.0" encoding="UTF-8"?>
<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Strict//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-strict.dtd">
<html>
<head>
<!-- Generated by HsColour, http://code.haskell.org/~malcolm/hscolour/ -->
<title>GHC/Runtime/Context.hs</title>
<link type='text/css' rel='stylesheet' href='hscolour.css' />
</head>
<body>
<pre><a name="line-1"></a><span class='hs-keyword'>module</span> <span class='hs-conid'>GHC.Runtime.Context</span>
<a name="line-2"></a>   <span class='hs-layout'>(</span> <span class='hs-conid'>InteractiveContext</span> <span class='hs-layout'>(</span><span class='hs-keyglyph'>..</span><span class='hs-layout'>)</span>
<a name="line-3"></a>   <span class='hs-layout'>,</span> <span class='hs-conid'>InteractiveImport</span> <span class='hs-layout'>(</span><span class='hs-keyglyph'>..</span><span class='hs-layout'>)</span>
<a name="line-4"></a>   <span class='hs-layout'>,</span> <span class='hs-varid'>emptyInteractiveContext</span>
<a name="line-5"></a>   <span class='hs-layout'>,</span> <span class='hs-varid'>extendInteractiveContext</span>
<a name="line-6"></a>   <span class='hs-layout'>,</span> <span class='hs-varid'>extendInteractiveContextWithIds</span>
<a name="line-7"></a>   <span class='hs-layout'>,</span> <span class='hs-varid'>setInteractivePrintName</span>
<a name="line-8"></a>   <span class='hs-layout'>,</span> <span class='hs-varid'>substInteractiveContext</span>
<a name="line-9"></a>   <span class='hs-layout'>,</span> <span class='hs-varid'>icExtendGblRdrEnv</span>
<a name="line-10"></a>   <span class='hs-layout'>,</span> <span class='hs-varid'>icInteractiveModule</span>
<a name="line-11"></a>   <span class='hs-layout'>,</span> <span class='hs-varid'>icInScopeTTs</span>
<a name="line-12"></a>   <span class='hs-layout'>,</span> <span class='hs-varid'>icPrintUnqual</span>
<a name="line-13"></a>   <span class='hs-layout'>)</span>
<a name="line-14"></a><span class='hs-keyword'>where</span>
<a name="line-15"></a>
<a name="line-16"></a><span class='hs-keyword'>import</span> <span class='hs-conid'>GHC.Prelude</span>
<a name="line-17"></a>
<a name="line-18"></a><span class='hs-keyword'>import</span> <span class='hs-conid'>GHC.Hs</span>
<a name="line-19"></a>
<a name="line-20"></a><span class='hs-keyword'>import</span> <span class='hs-conid'>GHC.Driver.Session</span>
<a name="line-21"></a><span class='hs-keyword'>import</span> <span class='hs-comment'>{-# SOURCE #-}</span> <span class='hs-conid'>GHC.Driver.Plugins</span>
<a name="line-22"></a>
<a name="line-23"></a><span class='hs-keyword'>import</span> <span class='hs-conid'>GHC.Runtime.Eval.Types</span> <span class='hs-layout'>(</span> <span class='hs-conid'>Resume</span> <span class='hs-layout'>)</span>
<a name="line-24"></a>
<a name="line-25"></a><span class='hs-keyword'>import</span> <span class='hs-conid'>GHC.Unit</span>
<a name="line-26"></a><span class='hs-keyword'>import</span> <span class='hs-conid'>GHC.Unit.Env</span>
<a name="line-27"></a>
<a name="line-28"></a><span class='hs-keyword'>import</span> <span class='hs-conid'>GHC.Core.FamInstEnv</span>
<a name="line-29"></a><span class='hs-keyword'>import</span> <span class='hs-conid'>GHC.Core.InstEnv</span> <span class='hs-layout'>(</span> <span class='hs-conid'>ClsInst</span><span class='hs-layout'>,</span> <span class='hs-varid'>identicalClsInstHead</span> <span class='hs-layout'>)</span>
<a name="line-30"></a><span class='hs-keyword'>import</span> <span class='hs-conid'>GHC.Core.Type</span>
<a name="line-31"></a>
<a name="line-32"></a><span class='hs-keyword'>import</span> <span class='hs-conid'>GHC.Types.Avail</span>
<a name="line-33"></a><span class='hs-keyword'>import</span> <span class='hs-conid'>GHC.Types.Fixity.Env</span>
<a name="line-34"></a><span class='hs-keyword'>import</span> <span class='hs-conid'>GHC.Types.Id</span> <span class='hs-layout'>(</span> <span class='hs-varid'>isRecordSelector</span> <span class='hs-layout'>)</span>
<a name="line-35"></a><span class='hs-keyword'>import</span> <span class='hs-conid'>GHC.Types.Id.Info</span> <span class='hs-layout'>(</span> <span class='hs-conid'>IdDetails</span><span class='hs-layout'>(</span><span class='hs-keyglyph'>..</span><span class='hs-layout'>)</span> <span class='hs-layout'>)</span>
<a name="line-36"></a><span class='hs-keyword'>import</span> <span class='hs-conid'>GHC.Types.Name</span>
<a name="line-37"></a><span class='hs-keyword'>import</span> <span class='hs-conid'>GHC.Types.Name.Env</span>
<a name="line-38"></a><span class='hs-keyword'>import</span> <span class='hs-conid'>GHC.Types.Name.Reader</span>
<a name="line-39"></a><span class='hs-keyword'>import</span> <span class='hs-conid'>GHC.Types.Name.Ppr</span>
<a name="line-40"></a><span class='hs-keyword'>import</span> <span class='hs-conid'>GHC.Types.TyThing</span>
<a name="line-41"></a><span class='hs-keyword'>import</span> <span class='hs-conid'>GHC.Types.Var</span>
<a name="line-42"></a>
<a name="line-43"></a><span class='hs-keyword'>import</span> <span class='hs-conid'>GHC.Builtin.Names</span> <span class='hs-layout'>(</span> <span class='hs-varid'>ioTyConName</span><span class='hs-layout'>,</span> <span class='hs-varid'>printName</span><span class='hs-layout'>,</span> <span class='hs-varid'>mkInteractiveModule</span> <span class='hs-layout'>)</span>
<a name="line-44"></a>
<a name="line-45"></a><span class='hs-keyword'>import</span> <span class='hs-conid'>GHC.Utils.Outputable</span>
<a name="line-46"></a><span class='hs-keyword'>import</span> <span class='hs-conid'>GHC.Utils.Misc</span>
<a name="line-47"></a>
<a name="line-48"></a><span class='hs-comment'>{-
<a name="line-49"></a>Note [The interactive package]
<a name="line-50"></a>~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~
<a name="line-51"></a>Type, class, and value declarations at the command prompt are treated
<a name="line-52"></a>as if they were defined in modules
<a name="line-53"></a>   interactive:Ghci1
<a name="line-54"></a>   interactive:Ghci2
<a name="line-55"></a>   ...etc...
<a name="line-56"></a>with each bunch of declarations using a new module, all sharing a
<a name="line-57"></a>common package 'interactive' (see Module.interactiveUnitId, and
<a name="line-58"></a>GHC.Builtin.Names.mkInteractiveModule).
<a name="line-59"></a>
<a name="line-60"></a>This scheme deals well with shadowing.  For example:
<a name="line-61"></a>
<a name="line-62"></a>   ghci&gt; data T = A
<a name="line-63"></a>   ghci&gt; data T = B
<a name="line-64"></a>   ghci&gt; :i A
<a name="line-65"></a>   data Ghci1.T = A  -- Defined at &lt;interactive&gt;:2:10
<a name="line-66"></a>
<a name="line-67"></a>Here we must display info about constructor A, but its type T has been
<a name="line-68"></a>shadowed by the second declaration.  But it has a respectable
<a name="line-69"></a>qualified name (Ghci1.T), and its source location says where it was
<a name="line-70"></a>defined.
<a name="line-71"></a>
<a name="line-72"></a>So the main invariant continues to hold, that in any session an
<a name="line-73"></a>original name M.T only refers to one unique thing.  (In a previous
<a name="line-74"></a>iteration both the T's above were called :Interactive.T, albeit with
<a name="line-75"></a>different uniques, which gave rise to all sorts of trouble.)
<a name="line-76"></a>
<a name="line-77"></a>The details are a bit tricky though:
<a name="line-78"></a>
<a name="line-79"></a> * The field ic_mod_index counts which Ghci module we've got up to.
<a name="line-80"></a>   It is incremented when extending ic_tythings
<a name="line-81"></a>
<a name="line-82"></a> * ic_tythings contains only things from the 'interactive' package.
<a name="line-83"></a>
<a name="line-84"></a> * Module from the 'interactive' package (Ghci1, Ghci2 etc) never go
<a name="line-85"></a>   in the Home Package Table (HPT).  When you say :load, that's when we
<a name="line-86"></a>   extend the HPT.
<a name="line-87"></a>
<a name="line-88"></a> * The 'homeUnitId' field of DynFlags is *not* set to 'interactive'.
<a name="line-89"></a>   It stays as 'main' (or whatever -this-unit-id says), and is the
<a name="line-90"></a>   package to which :load'ed modules are added to.
<a name="line-91"></a>
<a name="line-92"></a> * So how do we arrange that declarations at the command prompt get to
<a name="line-93"></a>   be in the 'interactive' package?  Simply by setting the tcg_mod
<a name="line-94"></a>   field of the TcGblEnv to "interactive:Ghci1".  This is done by the
<a name="line-95"></a>   call to initTc in initTcInteractive, which in turn get the module
<a name="line-96"></a>   from it 'icInteractiveModule' field of the interactive context.
<a name="line-97"></a>
<a name="line-98"></a>   The 'homeUnitId' field stays as 'main' (or whatever -this-unit-id says.
<a name="line-99"></a>
<a name="line-100"></a> * The main trickiness is that the type environment (tcg_type_env) and
<a name="line-101"></a>   fixity envt (tcg_fix_env), now contain entities from all the
<a name="line-102"></a>   interactive-package modules (Ghci1, Ghci2, ...) together, rather
<a name="line-103"></a>   than just a single module as is usually the case.  So you can't use
<a name="line-104"></a>   "nameIsLocalOrFrom" to decide whether to look in the TcGblEnv vs
<a name="line-105"></a>   the HPT/PTE.  This is a change, but not a problem provided you
<a name="line-106"></a>   know.
<a name="line-107"></a>
<a name="line-108"></a>* However, the tcg_binds, tcg_sigs, tcg_insts, tcg_fam_insts, etc fields
<a name="line-109"></a>  of the TcGblEnv, which collect "things defined in this module", all
<a name="line-110"></a>  refer to stuff define in a single GHCi command, *not* all the commands
<a name="line-111"></a>  so far.
<a name="line-112"></a>
<a name="line-113"></a>  In contrast, tcg_inst_env, tcg_fam_inst_env, have instances from
<a name="line-114"></a>  all GhciN modules, which makes sense -- they are all "home package"
<a name="line-115"></a>  modules.
<a name="line-116"></a>
<a name="line-117"></a>
<a name="line-118"></a>Note [Interactively-bound Ids in GHCi]
<a name="line-119"></a>~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~
<a name="line-120"></a>The Ids bound by previous Stmts in GHCi are currently
<a name="line-121"></a>        a) GlobalIds, with
<a name="line-122"></a>        b) An External Name, like Ghci4.foo
<a name="line-123"></a>           See Note [The interactive package] above
<a name="line-124"></a>        c) A tidied type
<a name="line-125"></a>
<a name="line-126"></a> (a) They must be GlobalIds (not LocalIds) otherwise when we come to
<a name="line-127"></a>     compile an expression using these ids later, the byte code
<a name="line-128"></a>     generator will consider the occurrences to be free rather than
<a name="line-129"></a>     global.
<a name="line-130"></a>
<a name="line-131"></a> (b) Having an External Name is important because of Note
<a name="line-132"></a>     [GlobalRdrEnv shadowing] in GHC.Types.Names.RdrName
<a name="line-133"></a>
<a name="line-134"></a> (c) Their types are tidied. This is important, because :info may ask
<a name="line-135"></a>     to look at them, and :info expects the things it looks up to have
<a name="line-136"></a>     tidy types
<a name="line-137"></a>
<a name="line-138"></a>Where do interactively-bound Ids come from?
<a name="line-139"></a>
<a name="line-140"></a>  - GHCi REPL Stmts   e.g.
<a name="line-141"></a>         ghci&gt; let foo x = x+1
<a name="line-142"></a>    These start with an Internal Name because a Stmt is a local
<a name="line-143"></a>    construct, so the renamer naturally builds an Internal name for
<a name="line-144"></a>    each of its binders.  Then in tcRnStmt they are externalised via
<a name="line-145"></a>    GHC.Tc.Module.externaliseAndTidyId, so they get Names like Ghic4.foo.
<a name="line-146"></a>
<a name="line-147"></a>  - Ids bound by the debugger etc have Names constructed by
<a name="line-148"></a>    GHC.Iface.Env.newInteractiveBinder; at the call sites it is followed by
<a name="line-149"></a>    mkVanillaGlobal or mkVanillaGlobalWithInfo.  So again, they are
<a name="line-150"></a>    all Global, External.
<a name="line-151"></a>
<a name="line-152"></a>  - TyCons, Classes, and Ids bound by other top-level declarations in
<a name="line-153"></a>    GHCi (eg foreign import, record selectors) also get External
<a name="line-154"></a>    Names, with Ghci9 (or 8, or 7, etc) as the module name.
<a name="line-155"></a>
<a name="line-156"></a>
<a name="line-157"></a>Note [ic_tythings]
<a name="line-158"></a>~~~~~~~~~~~~~~~~~~
<a name="line-159"></a>The ic_tythings field contains
<a name="line-160"></a>  * The TyThings declared by the user at the command prompt
<a name="line-161"></a>    (eg Ids, TyCons, Classes)
<a name="line-162"></a>
<a name="line-163"></a>  * The user-visible Ids that arise from such things, which
<a name="line-164"></a>    *don't* come from 'implicitTyThings', notably:
<a name="line-165"></a>       - record selectors
<a name="line-166"></a>       - class ops
<a name="line-167"></a>    The implicitTyThings are readily obtained from the TyThings
<a name="line-168"></a>    but record selectors etc are not
<a name="line-169"></a>
<a name="line-170"></a>It does *not* contain
<a name="line-171"></a>  * DFunIds (they can be gotten from ic_instances)
<a name="line-172"></a>  * CoAxioms (ditto)
<a name="line-173"></a>
<a name="line-174"></a>See also Note [Interactively-bound Ids in GHCi]
<a name="line-175"></a>
<a name="line-176"></a>Note [Override identical instances in GHCi]
<a name="line-177"></a>~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~
<a name="line-178"></a>If you declare a new instance in GHCi that is identical to a previous one,
<a name="line-179"></a>we simply override the previous one; we don't regard it as overlapping.
<a name="line-180"></a>e.g.    Prelude&gt; data T = A | B
<a name="line-181"></a>        Prelude&gt; instance Eq T where ...
<a name="line-182"></a>        Prelude&gt; instance Eq T where ...   -- This one overrides
<a name="line-183"></a>
<a name="line-184"></a>It's exactly the same for type-family instances.  See #7102
<a name="line-185"></a>-}</span>
<a name="line-186"></a>
<a name="line-187"></a><a name="InteractiveContext"></a><span class='hs-comment'>-- | Interactive context, recording information about the state of the</span>
<a name="line-188"></a><a name="InteractiveContext"></a><span class='hs-comment'>-- context in which statements are executed in a GHCi session.</span>
<a name="line-189"></a><a name="InteractiveContext"></a><span class='hs-keyword'>data</span> <span class='hs-conid'>InteractiveContext</span>
<a name="line-190"></a>  <span class='hs-keyglyph'>=</span> <span class='hs-conid'>InteractiveContext</span> <span class='hs-layout'>{</span>
<a name="line-191"></a>         <span class='hs-varid'>ic_dflags</span>     <span class='hs-keyglyph'>::</span> <span class='hs-conid'>DynFlags</span><span class='hs-layout'>,</span>
<a name="line-192"></a>             <span class='hs-comment'>-- ^ The 'DynFlags' used to evaluate interactive expressions</span>
<a name="line-193"></a>             <span class='hs-comment'>-- and statements.</span>
<a name="line-194"></a>
<a name="line-195"></a>         <span class='hs-varid'>ic_mod_index</span> <span class='hs-keyglyph'>::</span> <span class='hs-conid'>Int</span><span class='hs-layout'>,</span>
<a name="line-196"></a>             <span class='hs-comment'>-- ^ Each GHCi stmt or declaration brings some new things into</span>
<a name="line-197"></a>             <span class='hs-comment'>-- scope. We give them names like interactive:Ghci9.T,</span>
<a name="line-198"></a>             <span class='hs-comment'>-- where the ic_index is the '9'.  The ic_mod_index is</span>
<a name="line-199"></a>             <span class='hs-comment'>-- incremented whenever we add something to ic_tythings</span>
<a name="line-200"></a>             <span class='hs-comment'>-- See Note [The interactive package]</span>
<a name="line-201"></a>
<a name="line-202"></a>         <span class='hs-varid'>ic_imports</span> <span class='hs-keyglyph'>::</span> <span class='hs-keyglyph'>[</span><span class='hs-conid'>InteractiveImport</span><span class='hs-keyglyph'>]</span><span class='hs-layout'>,</span>
<a name="line-203"></a>             <span class='hs-comment'>-- ^ The GHCi top-level scope (ic_rn_gbl_env) is extended with</span>
<a name="line-204"></a>             <span class='hs-comment'>-- these imports</span>
<a name="line-205"></a>             <span class='hs-comment'>--</span>
<a name="line-206"></a>             <span class='hs-comment'>-- This field is only stored here so that the client</span>
<a name="line-207"></a>             <span class='hs-comment'>-- can retrieve it with GHC.getContext. GHC itself doesn't</span>
<a name="line-208"></a>             <span class='hs-comment'>-- use it, but does reset it to empty sometimes (such</span>
<a name="line-209"></a>             <span class='hs-comment'>-- as before a GHC.load). The context is set with GHC.setContext.</span>
<a name="line-210"></a>
<a name="line-211"></a>         <span class='hs-varid'>ic_tythings</span>   <span class='hs-keyglyph'>::</span> <span class='hs-keyglyph'>[</span><span class='hs-conid'>TyThing</span><span class='hs-keyglyph'>]</span><span class='hs-layout'>,</span>
<a name="line-212"></a>             <span class='hs-comment'>-- ^ TyThings defined by the user, in reverse order of</span>
<a name="line-213"></a>             <span class='hs-comment'>-- definition (ie most recent at the front)</span>
<a name="line-214"></a>             <span class='hs-comment'>-- See Note [ic_tythings]</span>
<a name="line-215"></a>
<a name="line-216"></a>         <span class='hs-varid'>ic_rn_gbl_env</span> <span class='hs-keyglyph'>::</span> <span class='hs-conid'>GlobalRdrEnv</span><span class='hs-layout'>,</span>
<a name="line-217"></a>             <span class='hs-comment'>-- ^ The cached 'GlobalRdrEnv', built by</span>
<a name="line-218"></a>             <span class='hs-comment'>-- 'GHC.Runtime.Eval.setContext' and updated regularly</span>
<a name="line-219"></a>             <span class='hs-comment'>-- It contains everything in scope at the command line,</span>
<a name="line-220"></a>             <span class='hs-comment'>-- including everything in ic_tythings</span>
<a name="line-221"></a>
<a name="line-222"></a>         <span class='hs-varid'>ic_instances</span>  <span class='hs-keyglyph'>::</span> <span class='hs-layout'>(</span><span class='hs-keyglyph'>[</span><span class='hs-conid'>ClsInst</span><span class='hs-keyglyph'>]</span><span class='hs-layout'>,</span> <span class='hs-keyglyph'>[</span><span class='hs-conid'>FamInst</span><span class='hs-keyglyph'>]</span><span class='hs-layout'>)</span><span class='hs-layout'>,</span>
<a name="line-223"></a>             <span class='hs-comment'>-- ^ All instances and family instances created during</span>
<a name="line-224"></a>             <span class='hs-comment'>-- this session.  These are grabbed en masse after each</span>
<a name="line-225"></a>             <span class='hs-comment'>-- update to be sure that proper overlapping is retained.</span>
<a name="line-226"></a>             <span class='hs-comment'>-- That is, rather than re-check the overlapping each</span>
<a name="line-227"></a>             <span class='hs-comment'>-- time we update the context, we just take the results</span>
<a name="line-228"></a>             <span class='hs-comment'>-- from the instance code that already does that.</span>
<a name="line-229"></a>
<a name="line-230"></a>         <span class='hs-varid'>ic_fix_env</span> <span class='hs-keyglyph'>::</span> <span class='hs-conid'>FixityEnv</span><span class='hs-layout'>,</span>
<a name="line-231"></a>            <span class='hs-comment'>-- ^ Fixities declared in let statements</span>
<a name="line-232"></a>
<a name="line-233"></a>         <span class='hs-varid'>ic_default</span> <span class='hs-keyglyph'>::</span> <span class='hs-conid'>Maybe</span> <span class='hs-keyglyph'>[</span><span class='hs-conid'>Type</span><span class='hs-keyglyph'>]</span><span class='hs-layout'>,</span>
<a name="line-234"></a>             <span class='hs-comment'>-- ^ The current default types, set by a 'default' declaration</span>
<a name="line-235"></a>
<a name="line-236"></a>          <span class='hs-varid'>ic_resume</span> <span class='hs-keyglyph'>::</span> <span class='hs-keyglyph'>[</span><span class='hs-conid'>Resume</span><span class='hs-keyglyph'>]</span><span class='hs-layout'>,</span>
<a name="line-237"></a>             <span class='hs-comment'>-- ^ The stack of breakpoint contexts</span>
<a name="line-238"></a>
<a name="line-239"></a>         <span class='hs-varid'>ic_monad</span>      <span class='hs-keyglyph'>::</span> <span class='hs-conid'>Name</span><span class='hs-layout'>,</span>
<a name="line-240"></a>             <span class='hs-comment'>-- ^ The monad that GHCi is executing in</span>
<a name="line-241"></a>
<a name="line-242"></a>         <span class='hs-varid'>ic_int_print</span>  <span class='hs-keyglyph'>::</span> <span class='hs-conid'>Name</span><span class='hs-layout'>,</span>
<a name="line-243"></a>             <span class='hs-comment'>-- ^ The function that is used for printing results</span>
<a name="line-244"></a>             <span class='hs-comment'>-- of expressions in ghci and -e mode.</span>
<a name="line-245"></a>
<a name="line-246"></a>         <span class='hs-varid'>ic_cwd</span> <span class='hs-keyglyph'>::</span> <span class='hs-conid'>Maybe</span> <span class='hs-conid'>FilePath</span><span class='hs-layout'>,</span>
<a name="line-247"></a>             <span class='hs-comment'>-- ^ virtual CWD of the program</span>
<a name="line-248"></a>
<a name="line-249"></a>         <span class='hs-varid'>ic_plugins</span> <span class='hs-keyglyph'>::</span> <span class='hs-varop'>!</span><span class='hs-keyglyph'>[</span><span class='hs-conid'>LoadedPlugin</span><span class='hs-keyglyph'>]</span>
<a name="line-250"></a>             <span class='hs-comment'>-- ^ Cache of loaded plugins. We store them here to avoid having to</span>
<a name="line-251"></a>             <span class='hs-comment'>-- load them everytime we switch to the interctive context.</span>
<a name="line-252"></a>    <span class='hs-layout'>}</span>
<a name="line-253"></a>
<a name="line-254"></a><a name="InteractiveImport"></a><span class='hs-keyword'>data</span> <span class='hs-conid'>InteractiveImport</span>
<a name="line-255"></a>  <span class='hs-keyglyph'>=</span> <span class='hs-conid'>IIDecl</span> <span class='hs-layout'>(</span><span class='hs-conid'>ImportDecl</span> <span class='hs-conid'>GhcPs</span><span class='hs-layout'>)</span>
<a name="line-256"></a>      <span class='hs-comment'>-- ^ Bring the exports of a particular module</span>
<a name="line-257"></a>      <span class='hs-comment'>-- (filtered by an import decl) into scope</span>
<a name="line-258"></a>
<a name="line-259"></a>  <span class='hs-keyglyph'>|</span> <span class='hs-conid'>IIModule</span> <span class='hs-conid'>ModuleName</span>
<a name="line-260"></a>      <span class='hs-comment'>-- ^ Bring into scope the entire top-level envt of</span>
<a name="line-261"></a>      <span class='hs-comment'>-- of this module, including the things imported</span>
<a name="line-262"></a>      <span class='hs-comment'>-- into it.</span>
<a name="line-263"></a>
<a name="line-264"></a>
<a name="line-265"></a><a name="emptyInteractiveContext"></a><span class='hs-comment'>-- | Constructs an empty InteractiveContext.</span>
<a name="line-266"></a><span class='hs-definition'>emptyInteractiveContext</span> <span class='hs-keyglyph'>::</span> <span class='hs-conid'>DynFlags</span> <span class='hs-keyglyph'>-&gt;</span> <span class='hs-conid'>InteractiveContext</span>
<a name="line-267"></a><span class='hs-definition'>emptyInteractiveContext</span> <span class='hs-varid'>dflags</span>
<a name="line-268"></a>  <span class='hs-keyglyph'>=</span> <span class='hs-conid'>InteractiveContext</span> <span class='hs-layout'>{</span>
<a name="line-269"></a>       <span class='hs-varid'>ic_dflags</span>     <span class='hs-keyglyph'>=</span> <span class='hs-varid'>dflags</span><span class='hs-layout'>,</span>
<a name="line-270"></a>       <span class='hs-varid'>ic_imports</span>    <span class='hs-keyglyph'>=</span> <span class='hs-conid'>[]</span><span class='hs-layout'>,</span>
<a name="line-271"></a>       <span class='hs-varid'>ic_rn_gbl_env</span> <span class='hs-keyglyph'>=</span> <span class='hs-varid'>emptyGlobalRdrEnv</span><span class='hs-layout'>,</span>
<a name="line-272"></a>       <span class='hs-varid'>ic_mod_index</span>  <span class='hs-keyglyph'>=</span> <span class='hs-num'>1</span><span class='hs-layout'>,</span>
<a name="line-273"></a>       <span class='hs-varid'>ic_tythings</span>   <span class='hs-keyglyph'>=</span> <span class='hs-conid'>[]</span><span class='hs-layout'>,</span>
<a name="line-274"></a>       <span class='hs-varid'>ic_instances</span>  <span class='hs-keyglyph'>=</span> <span class='hs-layout'>(</span><span class='hs-conid'>[]</span><span class='hs-layout'>,</span><span class='hs-conid'>[]</span><span class='hs-layout'>)</span><span class='hs-layout'>,</span>
<a name="line-275"></a>       <span class='hs-varid'>ic_fix_env</span>    <span class='hs-keyglyph'>=</span> <span class='hs-varid'>emptyNameEnv</span><span class='hs-layout'>,</span>
<a name="line-276"></a>       <span class='hs-varid'>ic_monad</span>      <span class='hs-keyglyph'>=</span> <span class='hs-varid'>ioTyConName</span><span class='hs-layout'>,</span>  <span class='hs-comment'>-- IO monad by default</span>
<a name="line-277"></a>       <span class='hs-varid'>ic_int_print</span>  <span class='hs-keyglyph'>=</span> <span class='hs-varid'>printName</span><span class='hs-layout'>,</span>    <span class='hs-comment'>-- System.IO.print by default</span>
<a name="line-278"></a>       <span class='hs-varid'>ic_default</span>    <span class='hs-keyglyph'>=</span> <span class='hs-conid'>Nothing</span><span class='hs-layout'>,</span>
<a name="line-279"></a>       <span class='hs-varid'>ic_resume</span>     <span class='hs-keyglyph'>=</span> <span class='hs-conid'>[]</span><span class='hs-layout'>,</span>
<a name="line-280"></a>       <span class='hs-varid'>ic_cwd</span>        <span class='hs-keyglyph'>=</span> <span class='hs-conid'>Nothing</span><span class='hs-layout'>,</span>
<a name="line-281"></a>       <span class='hs-varid'>ic_plugins</span>    <span class='hs-keyglyph'>=</span> <span class='hs-conid'>[]</span>
<a name="line-282"></a>       <span class='hs-layout'>}</span>
<a name="line-283"></a>
<a name="line-284"></a><a name="icInteractiveModule"></a><span class='hs-definition'>icInteractiveModule</span> <span class='hs-keyglyph'>::</span> <span class='hs-conid'>InteractiveContext</span> <span class='hs-keyglyph'>-&gt;</span> <span class='hs-conid'>Module</span>
<a name="line-285"></a><span class='hs-definition'>icInteractiveModule</span> <span class='hs-layout'>(</span><span class='hs-conid'>InteractiveContext</span> <span class='hs-layout'>{</span> <span class='hs-varid'>ic_mod_index</span> <span class='hs-keyglyph'>=</span> <span class='hs-varid'>index</span> <span class='hs-layout'>}</span><span class='hs-layout'>)</span>
<a name="line-286"></a>  <span class='hs-keyglyph'>=</span> <span class='hs-varid'>mkInteractiveModule</span> <span class='hs-varid'>index</span>
<a name="line-287"></a>
<a name="line-288"></a><a name="icInScopeTTs"></a><span class='hs-comment'>-- | This function returns the list of visible TyThings (useful for</span>
<a name="line-289"></a><span class='hs-comment'>-- e.g. showBindings)</span>
<a name="line-290"></a><span class='hs-definition'>icInScopeTTs</span> <span class='hs-keyglyph'>::</span> <span class='hs-conid'>InteractiveContext</span> <span class='hs-keyglyph'>-&gt;</span> <span class='hs-keyglyph'>[</span><span class='hs-conid'>TyThing</span><span class='hs-keyglyph'>]</span>
<a name="line-291"></a><span class='hs-definition'>icInScopeTTs</span> <span class='hs-keyglyph'>=</span> <span class='hs-varid'>ic_tythings</span>
<a name="line-292"></a>
<a name="line-293"></a><a name="icPrintUnqual"></a><span class='hs-comment'>-- | Get the PrintUnqualified function based on the flags and this InteractiveContext</span>
<a name="line-294"></a><span class='hs-definition'>icPrintUnqual</span> <span class='hs-keyglyph'>::</span> <span class='hs-conid'>UnitEnv</span> <span class='hs-keyglyph'>-&gt;</span> <span class='hs-conid'>InteractiveContext</span> <span class='hs-keyglyph'>-&gt;</span> <span class='hs-conid'>PrintUnqualified</span>
<a name="line-295"></a><span class='hs-definition'>icPrintUnqual</span> <span class='hs-varid'>unit_env</span> <span class='hs-conid'>InteractiveContext</span><span class='hs-layout'>{</span> <span class='hs-varid'>ic_rn_gbl_env</span> <span class='hs-keyglyph'>=</span> <span class='hs-varid'>grenv</span> <span class='hs-layout'>}</span> <span class='hs-keyglyph'>=</span>
<a name="line-296"></a>    <span class='hs-varid'>mkPrintUnqualified</span> <span class='hs-varid'>unit_env</span> <span class='hs-varid'>grenv</span>
<a name="line-297"></a>
<a name="line-298"></a><a name="extendInteractiveContext"></a><span class='hs-comment'>-- | extendInteractiveContext is called with new TyThings recently defined to update the</span>
<a name="line-299"></a><span class='hs-comment'>-- InteractiveContext to include them.  Ids are easily removed when shadowed,</span>
<a name="line-300"></a><span class='hs-comment'>-- but Classes and TyCons are not.  Some work could be done to determine</span>
<a name="line-301"></a><span class='hs-comment'>-- whether they are entirely shadowed, but as you could still have references</span>
<a name="line-302"></a><span class='hs-comment'>-- to them (e.g. instances for classes or values of the type for TyCons), it's</span>
<a name="line-303"></a><span class='hs-comment'>-- not clear whether removing them is even the appropriate behavior.</span>
<a name="line-304"></a><span class='hs-definition'>extendInteractiveContext</span> <span class='hs-keyglyph'>::</span> <span class='hs-conid'>InteractiveContext</span>
<a name="line-305"></a>                         <span class='hs-keyglyph'>-&gt;</span> <span class='hs-keyglyph'>[</span><span class='hs-conid'>TyThing</span><span class='hs-keyglyph'>]</span>
<a name="line-306"></a>                         <span class='hs-keyglyph'>-&gt;</span> <span class='hs-keyglyph'>[</span><span class='hs-conid'>ClsInst</span><span class='hs-keyglyph'>]</span> <span class='hs-keyglyph'>-&gt;</span> <span class='hs-keyglyph'>[</span><span class='hs-conid'>FamInst</span><span class='hs-keyglyph'>]</span>
<a name="line-307"></a>                         <span class='hs-keyglyph'>-&gt;</span> <span class='hs-conid'>Maybe</span> <span class='hs-keyglyph'>[</span><span class='hs-conid'>Type</span><span class='hs-keyglyph'>]</span>
<a name="line-308"></a>                         <span class='hs-keyglyph'>-&gt;</span> <span class='hs-conid'>FixityEnv</span>
<a name="line-309"></a>                         <span class='hs-keyglyph'>-&gt;</span> <span class='hs-conid'>InteractiveContext</span>
<a name="line-310"></a><span class='hs-definition'>extendInteractiveContext</span> <span class='hs-varid'>ictxt</span> <span class='hs-varid'>new_tythings</span> <span class='hs-varid'>new_cls_insts</span> <span class='hs-varid'>new_fam_insts</span> <span class='hs-varid'>defaults</span> <span class='hs-varid'>fix_env</span>
<a name="line-311"></a>  <span class='hs-keyglyph'>=</span> <span class='hs-varid'>ictxt</span> <span class='hs-layout'>{</span> <span class='hs-varid'>ic_mod_index</span>  <span class='hs-keyglyph'>=</span> <span class='hs-varid'>ic_mod_index</span> <span class='hs-varid'>ictxt</span> <span class='hs-varop'>+</span> <span class='hs-num'>1</span>
<a name="line-312"></a>                            <span class='hs-comment'>-- Always bump this; even instances should create</span>
<a name="line-313"></a>                            <span class='hs-comment'>-- a new mod_index (#9426)</span>
<a name="line-314"></a>          <span class='hs-layout'>,</span> <span class='hs-varid'>ic_tythings</span>   <span class='hs-keyglyph'>=</span> <span class='hs-varid'>new_tythings</span> <span class='hs-varop'>++</span> <span class='hs-varid'>old_tythings</span>
<a name="line-315"></a>          <span class='hs-layout'>,</span> <span class='hs-varid'>ic_rn_gbl_env</span> <span class='hs-keyglyph'>=</span> <span class='hs-varid'>ic_rn_gbl_env</span> <span class='hs-varid'>ictxt</span> <span class='hs-varop'>`icExtendGblRdrEnv`</span> <span class='hs-varid'>new_tythings</span>
<a name="line-316"></a>          <span class='hs-layout'>,</span> <span class='hs-varid'>ic_instances</span>  <span class='hs-keyglyph'>=</span> <span class='hs-layout'>(</span> <span class='hs-varid'>new_cls_insts</span> <span class='hs-varop'>++</span> <span class='hs-varid'>old_cls_insts</span>
<a name="line-317"></a>                            <span class='hs-layout'>,</span> <span class='hs-varid'>new_fam_insts</span> <span class='hs-varop'>++</span> <span class='hs-varid'>fam_insts</span> <span class='hs-layout'>)</span>
<a name="line-318"></a>                            <span class='hs-comment'>-- we don't shadow old family instances (#7102),</span>
<a name="line-319"></a>                            <span class='hs-comment'>-- so don't need to remove them here</span>
<a name="line-320"></a>          <span class='hs-layout'>,</span> <span class='hs-varid'>ic_default</span>    <span class='hs-keyglyph'>=</span> <span class='hs-varid'>defaults</span>
<a name="line-321"></a>          <span class='hs-layout'>,</span> <span class='hs-varid'>ic_fix_env</span>    <span class='hs-keyglyph'>=</span> <span class='hs-varid'>fix_env</span>  <span class='hs-comment'>-- See Note [Fixity declarations in GHCi]</span>
<a name="line-322"></a>          <span class='hs-layout'>}</span>
<a name="line-323"></a>  <span class='hs-keyword'>where</span>
<a name="line-324"></a>    <span class='hs-varid'>new_ids</span> <span class='hs-keyglyph'>=</span> <span class='hs-keyglyph'>[</span><span class='hs-varid'>id</span> <span class='hs-keyglyph'>|</span> <span class='hs-conid'>AnId</span> <span class='hs-varid'>id</span> <span class='hs-keyglyph'>&lt;-</span> <span class='hs-varid'>new_tythings</span><span class='hs-keyglyph'>]</span>
<a name="line-325"></a>    <span class='hs-varid'>old_tythings</span> <span class='hs-keyglyph'>=</span> <span class='hs-varid'>filterOut</span> <span class='hs-layout'>(</span><span class='hs-varid'>shadowed_by</span> <span class='hs-varid'>new_ids</span><span class='hs-layout'>)</span> <span class='hs-layout'>(</span><span class='hs-varid'>ic_tythings</span> <span class='hs-varid'>ictxt</span><span class='hs-layout'>)</span>
<a name="line-326"></a>
<a name="line-327"></a>    <span class='hs-comment'>-- Discard old instances that have been fully overridden</span>
<a name="line-328"></a>    <span class='hs-comment'>-- See Note [Override identical instances in GHCi]</span>
<a name="line-329"></a>    <span class='hs-layout'>(</span><span class='hs-varid'>cls_insts</span><span class='hs-layout'>,</span> <span class='hs-varid'>fam_insts</span><span class='hs-layout'>)</span> <span class='hs-keyglyph'>=</span> <span class='hs-varid'>ic_instances</span> <span class='hs-varid'>ictxt</span>
<a name="line-330"></a>    <span class='hs-varid'>old_cls_insts</span> <span class='hs-keyglyph'>=</span> <span class='hs-varid'>filterOut</span> <span class='hs-layout'>(</span><span class='hs-keyglyph'>\</span><span class='hs-varid'>i</span> <span class='hs-keyglyph'>-&gt;</span> <span class='hs-varid'>any</span> <span class='hs-layout'>(</span><span class='hs-varid'>identicalClsInstHead</span> <span class='hs-varid'>i</span><span class='hs-layout'>)</span> <span class='hs-varid'>new_cls_insts</span><span class='hs-layout'>)</span> <span class='hs-varid'>cls_insts</span>
<a name="line-331"></a>
<a name="line-332"></a><a name="extendInteractiveContextWithIds"></a><span class='hs-definition'>extendInteractiveContextWithIds</span> <span class='hs-keyglyph'>::</span> <span class='hs-conid'>InteractiveContext</span> <span class='hs-keyglyph'>-&gt;</span> <span class='hs-keyglyph'>[</span><span class='hs-conid'>Id</span><span class='hs-keyglyph'>]</span> <span class='hs-keyglyph'>-&gt;</span> <span class='hs-conid'>InteractiveContext</span>
<a name="line-333"></a><span class='hs-comment'>-- Just a specialised version</span>
<a name="line-334"></a><span class='hs-definition'>extendInteractiveContextWithIds</span> <span class='hs-varid'>ictxt</span> <span class='hs-varid'>new_ids</span>
<a name="line-335"></a>  <span class='hs-keyglyph'>|</span> <span class='hs-varid'>null</span> <span class='hs-varid'>new_ids</span> <span class='hs-keyglyph'>=</span> <span class='hs-varid'>ictxt</span>
<a name="line-336"></a>  <span class='hs-keyglyph'>|</span> <span class='hs-varid'>otherwise</span>    <span class='hs-keyglyph'>=</span> <span class='hs-varid'>ictxt</span> <span class='hs-layout'>{</span> <span class='hs-varid'>ic_mod_index</span>  <span class='hs-keyglyph'>=</span> <span class='hs-varid'>ic_mod_index</span> <span class='hs-varid'>ictxt</span> <span class='hs-varop'>+</span> <span class='hs-num'>1</span>
<a name="line-337"></a>                         <span class='hs-layout'>,</span> <span class='hs-varid'>ic_tythings</span>   <span class='hs-keyglyph'>=</span> <span class='hs-varid'>new_tythings</span> <span class='hs-varop'>++</span> <span class='hs-varid'>old_tythings</span>
<a name="line-338"></a>                         <span class='hs-layout'>,</span> <span class='hs-varid'>ic_rn_gbl_env</span> <span class='hs-keyglyph'>=</span> <span class='hs-varid'>ic_rn_gbl_env</span> <span class='hs-varid'>ictxt</span> <span class='hs-varop'>`icExtendGblRdrEnv`</span> <span class='hs-varid'>new_tythings</span> <span class='hs-layout'>}</span>
<a name="line-339"></a>  <span class='hs-keyword'>where</span>
<a name="line-340"></a>    <span class='hs-varid'>new_tythings</span> <span class='hs-keyglyph'>=</span> <span class='hs-varid'>map</span> <span class='hs-conid'>AnId</span> <span class='hs-varid'>new_ids</span>
<a name="line-341"></a>    <span class='hs-varid'>old_tythings</span> <span class='hs-keyglyph'>=</span> <span class='hs-varid'>filterOut</span> <span class='hs-layout'>(</span><span class='hs-varid'>shadowed_by</span> <span class='hs-varid'>new_ids</span><span class='hs-layout'>)</span> <span class='hs-layout'>(</span><span class='hs-varid'>ic_tythings</span> <span class='hs-varid'>ictxt</span><span class='hs-layout'>)</span>
<a name="line-342"></a>
<a name="line-343"></a><a name="shadowed_by"></a><span class='hs-definition'>shadowed_by</span> <span class='hs-keyglyph'>::</span> <span class='hs-keyglyph'>[</span><span class='hs-conid'>Id</span><span class='hs-keyglyph'>]</span> <span class='hs-keyglyph'>-&gt;</span> <span class='hs-conid'>TyThing</span> <span class='hs-keyglyph'>-&gt;</span> <span class='hs-conid'>Bool</span>
<a name="line-344"></a><span class='hs-definition'>shadowed_by</span> <span class='hs-varid'>ids</span> <span class='hs-keyglyph'>=</span> <span class='hs-varid'>shadowed</span>
<a name="line-345"></a>  <span class='hs-keyword'>where</span>
<a name="line-346"></a>    <span class='hs-comment'>-- Keep record selectors because they might be needed by HasField (#19322)</span>
<a name="line-347"></a>    <span class='hs-varid'>shadowed</span> <span class='hs-layout'>(</span><span class='hs-conid'>AnId</span> <span class='hs-varid'>id</span><span class='hs-layout'>)</span> <span class='hs-keyglyph'>|</span> <span class='hs-varid'>isRecordSelector</span> <span class='hs-varid'>id</span> <span class='hs-keyglyph'>=</span> <span class='hs-conid'>False</span>
<a name="line-348"></a>    <span class='hs-varid'>shadowed</span> <span class='hs-varid'>tything</span> <span class='hs-keyglyph'>=</span> <span class='hs-varid'>getOccName</span> <span class='hs-varid'>tything</span> <span class='hs-varop'>`elemOccSet`</span> <span class='hs-varid'>new_occs</span>
<a name="line-349"></a>    <span class='hs-varid'>new_occs</span> <span class='hs-keyglyph'>=</span> <span class='hs-varid'>mkOccSet</span> <span class='hs-layout'>(</span><span class='hs-varid'>map</span> <span class='hs-varid'>getOccName</span> <span class='hs-varid'>ids</span><span class='hs-layout'>)</span>
<a name="line-350"></a>
<a name="line-351"></a><a name="setInteractivePrintName"></a><span class='hs-definition'>setInteractivePrintName</span> <span class='hs-keyglyph'>::</span> <span class='hs-conid'>InteractiveContext</span> <span class='hs-keyglyph'>-&gt;</span> <span class='hs-conid'>Name</span> <span class='hs-keyglyph'>-&gt;</span> <span class='hs-conid'>InteractiveContext</span>
<a name="line-352"></a><span class='hs-definition'>setInteractivePrintName</span> <span class='hs-varid'>ic</span> <span class='hs-varid'>n</span> <span class='hs-keyglyph'>=</span> <span class='hs-varid'>ic</span><span class='hs-layout'>{</span><span class='hs-varid'>ic_int_print</span> <span class='hs-keyglyph'>=</span> <span class='hs-varid'>n</span><span class='hs-layout'>}</span>
<a name="line-353"></a>
<a name="line-354"></a>    <span class='hs-comment'>-- ToDo: should not add Ids to the gbl env here</span>
<a name="line-355"></a>
<a name="line-356"></a><a name="icExtendGblRdrEnv"></a><span class='hs-comment'>-- | Add TyThings to the GlobalRdrEnv, earlier ones in the list shadowing</span>
<a name="line-357"></a><span class='hs-comment'>-- later ones, and shadowing existing entries in the GlobalRdrEnv.</span>
<a name="line-358"></a><span class='hs-definition'>icExtendGblRdrEnv</span> <span class='hs-keyglyph'>::</span> <span class='hs-conid'>GlobalRdrEnv</span> <span class='hs-keyglyph'>-&gt;</span> <span class='hs-keyglyph'>[</span><span class='hs-conid'>TyThing</span><span class='hs-keyglyph'>]</span> <span class='hs-keyglyph'>-&gt;</span> <span class='hs-conid'>GlobalRdrEnv</span>
<a name="line-359"></a><span class='hs-definition'>icExtendGblRdrEnv</span> <span class='hs-varid'>env</span> <span class='hs-varid'>tythings</span>
<a name="line-360"></a>  <span class='hs-keyglyph'>=</span> <span class='hs-varid'>foldr</span> <span class='hs-varid'>add</span> <span class='hs-varid'>env</span> <span class='hs-varid'>tythings</span>  <span class='hs-comment'>-- Foldr makes things in the front of</span>
<a name="line-361"></a>                            <span class='hs-comment'>-- the list shadow things at the back</span>
<a name="line-362"></a>  <span class='hs-keyword'>where</span>
<a name="line-363"></a>    <span class='hs-comment'>-- One at a time, to ensure each shadows the previous ones</span>
<a name="line-364"></a>    <span class='hs-varid'>add</span> <span class='hs-varid'>thing</span> <span class='hs-varid'>env</span>
<a name="line-365"></a>       <span class='hs-keyglyph'>|</span> <span class='hs-varid'>is_sub_bndr</span> <span class='hs-varid'>thing</span>
<a name="line-366"></a>       <span class='hs-keyglyph'>=</span> <span class='hs-varid'>env</span>
<a name="line-367"></a>       <span class='hs-keyglyph'>|</span> <span class='hs-varid'>otherwise</span>
<a name="line-368"></a>       <span class='hs-keyglyph'>=</span> <span class='hs-varid'>foldl'</span> <span class='hs-varid'>extendGlobalRdrEnv</span> <span class='hs-varid'>env1</span> <span class='hs-layout'>(</span><span class='hs-varid'>concatMap</span> <span class='hs-varid'>localGREsFromAvail</span> <span class='hs-varid'>avail</span><span class='hs-layout'>)</span>
<a name="line-369"></a>       <span class='hs-keyword'>where</span>
<a name="line-370"></a>          <span class='hs-varid'>env1</span>  <span class='hs-keyglyph'>=</span> <span class='hs-varid'>shadowNames</span> <span class='hs-varid'>env</span> <span class='hs-layout'>(</span><span class='hs-varid'>concatMap</span> <span class='hs-varid'>availGreNames</span> <span class='hs-varid'>avail</span><span class='hs-layout'>)</span>
<a name="line-371"></a>          <span class='hs-varid'>avail</span> <span class='hs-keyglyph'>=</span> <span class='hs-varid'>tyThingAvailInfo</span> <span class='hs-varid'>thing</span>
<a name="line-372"></a>
<a name="line-373"></a>    <span class='hs-comment'>-- Ugh! The new_tythings may include record selectors, since they</span>
<a name="line-374"></a>    <span class='hs-comment'>-- are not implicit-ids, and must appear in the TypeEnv.  But they</span>
<a name="line-375"></a>    <span class='hs-comment'>-- will also be brought into scope by the corresponding (ATyCon</span>
<a name="line-376"></a>    <span class='hs-comment'>-- tc).  And we want the latter, because that has the correct</span>
<a name="line-377"></a>    <span class='hs-comment'>-- parent (#10520)</span>
<a name="line-378"></a>    <span class='hs-varid'>is_sub_bndr</span> <span class='hs-layout'>(</span><span class='hs-conid'>AnId</span> <span class='hs-varid'>f</span><span class='hs-layout'>)</span> <span class='hs-keyglyph'>=</span> <span class='hs-keyword'>case</span> <span class='hs-varid'>idDetails</span> <span class='hs-varid'>f</span> <span class='hs-keyword'>of</span>
<a name="line-379"></a>                             <span class='hs-conid'>RecSelId</span> <span class='hs-layout'>{</span><span class='hs-layout'>}</span>  <span class='hs-keyglyph'>-&gt;</span> <span class='hs-conid'>True</span>
<a name="line-380"></a>                             <span class='hs-conid'>ClassOpId</span> <span class='hs-layout'>{</span><span class='hs-layout'>}</span> <span class='hs-keyglyph'>-&gt;</span> <span class='hs-conid'>True</span>
<a name="line-381"></a>                             <span class='hs-keyword'>_</span>            <span class='hs-keyglyph'>-&gt;</span> <span class='hs-conid'>False</span>
<a name="line-382"></a>    <span class='hs-varid'>is_sub_bndr</span> <span class='hs-keyword'>_</span> <span class='hs-keyglyph'>=</span> <span class='hs-conid'>False</span>
<a name="line-383"></a>
<a name="line-384"></a><a name="substInteractiveContext"></a><span class='hs-definition'>substInteractiveContext</span> <span class='hs-keyglyph'>::</span> <span class='hs-conid'>InteractiveContext</span> <span class='hs-keyglyph'>-&gt;</span> <span class='hs-conid'>TCvSubst</span> <span class='hs-keyglyph'>-&gt;</span> <span class='hs-conid'>InteractiveContext</span>
<a name="line-385"></a><span class='hs-definition'>substInteractiveContext</span> <span class='hs-varid'>ictxt</span><span class='hs-keyglyph'>@</span><span class='hs-conid'>InteractiveContext</span><span class='hs-layout'>{</span> <span class='hs-varid'>ic_tythings</span> <span class='hs-keyglyph'>=</span> <span class='hs-varid'>tts</span> <span class='hs-layout'>}</span> <span class='hs-varid'>subst</span>
<a name="line-386"></a>  <span class='hs-keyglyph'>|</span> <span class='hs-varid'>isEmptyTCvSubst</span> <span class='hs-varid'>subst</span> <span class='hs-keyglyph'>=</span> <span class='hs-varid'>ictxt</span>
<a name="line-387"></a>  <span class='hs-keyglyph'>|</span> <span class='hs-varid'>otherwise</span>             <span class='hs-keyglyph'>=</span> <span class='hs-varid'>ictxt</span> <span class='hs-layout'>{</span> <span class='hs-varid'>ic_tythings</span> <span class='hs-keyglyph'>=</span> <span class='hs-varid'>map</span> <span class='hs-varid'>subst_ty</span> <span class='hs-varid'>tts</span> <span class='hs-layout'>}</span>
<a name="line-388"></a>  <span class='hs-keyword'>where</span>
<a name="line-389"></a>    <span class='hs-varid'>subst_ty</span> <span class='hs-layout'>(</span><span class='hs-conid'>AnId</span> <span class='hs-varid'>id</span><span class='hs-layout'>)</span>
<a name="line-390"></a>      <span class='hs-keyglyph'>=</span> <span class='hs-conid'>AnId</span> <span class='hs-varop'>$</span> <span class='hs-varid'>updateIdTypeAndMult</span> <span class='hs-layout'>(</span><span class='hs-varid'>substTyAddInScope</span> <span class='hs-varid'>subst</span><span class='hs-layout'>)</span> <span class='hs-varid'>id</span>
<a name="line-391"></a>      <span class='hs-comment'>-- Variables in the interactive context *can* mention free type variables</span>
<a name="line-392"></a>      <span class='hs-comment'>-- because of the runtime debugger. Otherwise you'd expect all</span>
<a name="line-393"></a>      <span class='hs-comment'>-- variables bound in the interactive context to be closed.</span>
<a name="line-394"></a>    <span class='hs-varid'>subst_ty</span> <span class='hs-varid'>tt</span>
<a name="line-395"></a>      <span class='hs-keyglyph'>=</span> <span class='hs-varid'>tt</span>
<a name="line-396"></a>
<a name="line-397"></a><a name="instance%20Outputable%20InteractiveImport"></a><span class='hs-keyword'>instance</span> <span class='hs-conid'>Outputable</span> <span class='hs-conid'>InteractiveImport</span> <span class='hs-keyword'>where</span>
<a name="line-398"></a>  <span class='hs-varid'>ppr</span> <span class='hs-layout'>(</span><span class='hs-conid'>IIModule</span> <span class='hs-varid'>m</span><span class='hs-layout'>)</span> <span class='hs-keyglyph'>=</span> <span class='hs-varid'>char</span> <span class='hs-chr'>'*'</span> <span class='hs-varop'>&lt;&gt;</span> <span class='hs-varid'>ppr</span> <span class='hs-varid'>m</span>
<a name="line-399"></a>  <span class='hs-varid'>ppr</span> <span class='hs-layout'>(</span><span class='hs-conid'>IIDecl</span> <span class='hs-varid'>d</span><span class='hs-layout'>)</span>   <span class='hs-keyglyph'>=</span> <span class='hs-varid'>ppr</span> <span class='hs-varid'>d</span>
<a name="line-400"></a>
</pre></body>
</html>
