<?xml version="1.0" encoding="UTF-8"?>
<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Strict//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-strict.dtd">
<html>
<head>
<!-- Generated by HsColour, http://code.haskell.org/~malcolm/hscolour/ -->
<title>GHC/Types/SafeHaskell.hs</title>
<link type='text/css' rel='stylesheet' href='hscolour.css' />
</head>
<body>
<pre><a name="line-1"></a><span class='hs-comment'>-- | This stuff here is related to supporting the Safe Haskell extension,</span>
<a name="line-2"></a><span class='hs-comment'>-- primarily about storing under what trust type a module has been compiled.</span>
<a name="line-3"></a><span class='hs-keyword'>module</span> <span class='hs-conid'>GHC.Types.SafeHaskell</span>
<a name="line-4"></a>   <span class='hs-layout'>(</span> <span class='hs-conid'>IsSafeImport</span>
<a name="line-5"></a>   <span class='hs-layout'>,</span> <span class='hs-conid'>SafeHaskellMode</span><span class='hs-layout'>(</span><span class='hs-keyglyph'>..</span><span class='hs-layout'>)</span>
<a name="line-6"></a>   <span class='hs-layout'>,</span> <span class='hs-conid'>IfaceTrustInfo</span>
<a name="line-7"></a>   <span class='hs-layout'>,</span> <span class='hs-varid'>getSafeMode</span>
<a name="line-8"></a>   <span class='hs-layout'>,</span> <span class='hs-varid'>setSafeMode</span>
<a name="line-9"></a>   <span class='hs-layout'>,</span> <span class='hs-varid'>noIfaceTrustInfo</span>
<a name="line-10"></a>   <span class='hs-layout'>)</span>
<a name="line-11"></a><span class='hs-keyword'>where</span>
<a name="line-12"></a>
<a name="line-13"></a><span class='hs-keyword'>import</span> <span class='hs-conid'>GHC.Prelude</span>
<a name="line-14"></a>
<a name="line-15"></a><span class='hs-keyword'>import</span> <span class='hs-conid'>GHC.Utils.Binary</span>
<a name="line-16"></a><span class='hs-keyword'>import</span> <span class='hs-conid'>GHC.Utils.Outputable</span>
<a name="line-17"></a>
<a name="line-18"></a><span class='hs-keyword'>import</span> <span class='hs-conid'>Data.Word</span>
<a name="line-19"></a>
<a name="line-20"></a>
<a name="line-21"></a><a name="IsSafeImport"></a><span class='hs-comment'>-- | Is an import a safe import?</span>
<a name="line-22"></a><a name="IsSafeImport"></a><span class='hs-keyword'>type</span> <span class='hs-conid'>IsSafeImport</span> <span class='hs-keyglyph'>=</span> <span class='hs-conid'>Bool</span>
<a name="line-23"></a>
<a name="line-24"></a><a name="SafeHaskellMode"></a><span class='hs-comment'>-- | The various Safe Haskell modes</span>
<a name="line-25"></a><a name="SafeHaskellMode"></a><span class='hs-keyword'>data</span> <span class='hs-conid'>SafeHaskellMode</span>
<a name="line-26"></a>   <span class='hs-keyglyph'>=</span> <span class='hs-conid'>Sf_None</span>          <span class='hs-comment'>-- ^ inferred unsafe</span>
<a name="line-27"></a>   <span class='hs-keyglyph'>|</span> <span class='hs-conid'>Sf_Unsafe</span>        <span class='hs-comment'>-- ^ declared and checked</span>
<a name="line-28"></a>   <span class='hs-keyglyph'>|</span> <span class='hs-conid'>Sf_Trustworthy</span>   <span class='hs-comment'>-- ^ declared and checked</span>
<a name="line-29"></a>   <span class='hs-keyglyph'>|</span> <span class='hs-conid'>Sf_Safe</span>          <span class='hs-comment'>-- ^ declared and checked</span>
<a name="line-30"></a>   <span class='hs-keyglyph'>|</span> <span class='hs-conid'>Sf_SafeInferred</span>  <span class='hs-comment'>-- ^ inferred as safe</span>
<a name="line-31"></a>   <span class='hs-keyglyph'>|</span> <span class='hs-conid'>Sf_Ignore</span>        <span class='hs-comment'>-- ^ @-fno-safe-haskell@ state</span>
<a name="line-32"></a>   <span class='hs-keyword'>deriving</span> <span class='hs-layout'>(</span><span class='hs-conid'>Eq</span><span class='hs-layout'>)</span>
<a name="line-33"></a>
<a name="line-34"></a><a name="instance%20Show%20SafeHaskellMode"></a><span class='hs-keyword'>instance</span> <span class='hs-conid'>Show</span> <span class='hs-conid'>SafeHaskellMode</span> <span class='hs-keyword'>where</span>
<a name="line-35"></a>    <span class='hs-varid'>show</span> <span class='hs-conid'>Sf_None</span>         <span class='hs-keyglyph'>=</span> <span class='hs-str'>"None"</span>
<a name="line-36"></a>    <span class='hs-varid'>show</span> <span class='hs-conid'>Sf_Unsafe</span>       <span class='hs-keyglyph'>=</span> <span class='hs-str'>"Unsafe"</span>
<a name="line-37"></a>    <span class='hs-varid'>show</span> <span class='hs-conid'>Sf_Trustworthy</span>  <span class='hs-keyglyph'>=</span> <span class='hs-str'>"Trustworthy"</span>
<a name="line-38"></a>    <span class='hs-varid'>show</span> <span class='hs-conid'>Sf_Safe</span>         <span class='hs-keyglyph'>=</span> <span class='hs-str'>"Safe"</span>
<a name="line-39"></a>    <span class='hs-varid'>show</span> <span class='hs-conid'>Sf_SafeInferred</span> <span class='hs-keyglyph'>=</span> <span class='hs-str'>"Safe-Inferred"</span>
<a name="line-40"></a>    <span class='hs-varid'>show</span> <span class='hs-conid'>Sf_Ignore</span>       <span class='hs-keyglyph'>=</span> <span class='hs-str'>"Ignore"</span>
<a name="line-41"></a>
<a name="line-42"></a><a name="instance%20Outputable%20SafeHaskellMode"></a><span class='hs-keyword'>instance</span> <span class='hs-conid'>Outputable</span> <span class='hs-conid'>SafeHaskellMode</span> <span class='hs-keyword'>where</span>
<a name="line-43"></a>    <span class='hs-varid'>ppr</span> <span class='hs-keyglyph'>=</span> <span class='hs-varid'>text</span> <span class='hs-varop'>.</span> <span class='hs-varid'>show</span>
<a name="line-44"></a>
<a name="line-45"></a><a name="IfaceTrustInfo"></a><span class='hs-comment'>-- | Safe Haskell information for 'ModIface'</span>
<a name="line-46"></a><a name="IfaceTrustInfo"></a><span class='hs-comment'>-- Simply a wrapper around SafeHaskellMode to sepperate iface and flags</span>
<a name="line-47"></a><a name="IfaceTrustInfo"></a><span class='hs-keyword'>newtype</span> <span class='hs-conid'>IfaceTrustInfo</span> <span class='hs-keyglyph'>=</span> <span class='hs-conid'>TrustInfo</span> <span class='hs-conid'>SafeHaskellMode</span>
<a name="line-48"></a>
<a name="line-49"></a><a name="getSafeMode"></a><span class='hs-definition'>getSafeMode</span> <span class='hs-keyglyph'>::</span> <span class='hs-conid'>IfaceTrustInfo</span> <span class='hs-keyglyph'>-&gt;</span> <span class='hs-conid'>SafeHaskellMode</span>
<a name="line-50"></a><span class='hs-definition'>getSafeMode</span> <span class='hs-layout'>(</span><span class='hs-conid'>TrustInfo</span> <span class='hs-varid'>x</span><span class='hs-layout'>)</span> <span class='hs-keyglyph'>=</span> <span class='hs-varid'>x</span>
<a name="line-51"></a>
<a name="line-52"></a><a name="setSafeMode"></a><span class='hs-definition'>setSafeMode</span> <span class='hs-keyglyph'>::</span> <span class='hs-conid'>SafeHaskellMode</span> <span class='hs-keyglyph'>-&gt;</span> <span class='hs-conid'>IfaceTrustInfo</span>
<a name="line-53"></a><span class='hs-definition'>setSafeMode</span> <span class='hs-keyglyph'>=</span> <span class='hs-conid'>TrustInfo</span>
<a name="line-54"></a>
<a name="line-55"></a><a name="noIfaceTrustInfo"></a><span class='hs-definition'>noIfaceTrustInfo</span> <span class='hs-keyglyph'>::</span> <span class='hs-conid'>IfaceTrustInfo</span>
<a name="line-56"></a><span class='hs-definition'>noIfaceTrustInfo</span> <span class='hs-keyglyph'>=</span> <span class='hs-varid'>setSafeMode</span> <span class='hs-conid'>Sf_None</span>
<a name="line-57"></a>
<a name="line-58"></a><a name="trustInfoToNum"></a><span class='hs-definition'>trustInfoToNum</span> <span class='hs-keyglyph'>::</span> <span class='hs-conid'>IfaceTrustInfo</span> <span class='hs-keyglyph'>-&gt;</span> <span class='hs-conid'>Word8</span>
<a name="line-59"></a><span class='hs-definition'>trustInfoToNum</span> <span class='hs-varid'>it</span>
<a name="line-60"></a>  <span class='hs-keyglyph'>=</span> <span class='hs-keyword'>case</span> <span class='hs-varid'>getSafeMode</span> <span class='hs-varid'>it</span> <span class='hs-keyword'>of</span>
<a name="line-61"></a>            <span class='hs-conid'>Sf_None</span>         <span class='hs-keyglyph'>-&gt;</span> <span class='hs-num'>0</span>
<a name="line-62"></a>            <span class='hs-conid'>Sf_Unsafe</span>       <span class='hs-keyglyph'>-&gt;</span> <span class='hs-num'>1</span>
<a name="line-63"></a>            <span class='hs-conid'>Sf_Trustworthy</span>  <span class='hs-keyglyph'>-&gt;</span> <span class='hs-num'>2</span>
<a name="line-64"></a>            <span class='hs-conid'>Sf_Safe</span>         <span class='hs-keyglyph'>-&gt;</span> <span class='hs-num'>3</span>
<a name="line-65"></a>            <span class='hs-conid'>Sf_SafeInferred</span> <span class='hs-keyglyph'>-&gt;</span> <span class='hs-num'>4</span>
<a name="line-66"></a>            <span class='hs-conid'>Sf_Ignore</span>       <span class='hs-keyglyph'>-&gt;</span> <span class='hs-num'>0</span>
<a name="line-67"></a>
<a name="line-68"></a><a name="numToTrustInfo"></a><span class='hs-definition'>numToTrustInfo</span> <span class='hs-keyglyph'>::</span> <span class='hs-conid'>Word8</span> <span class='hs-keyglyph'>-&gt;</span> <span class='hs-conid'>IfaceTrustInfo</span>
<a name="line-69"></a><span class='hs-definition'>numToTrustInfo</span> <span class='hs-num'>0</span> <span class='hs-keyglyph'>=</span> <span class='hs-varid'>setSafeMode</span> <span class='hs-conid'>Sf_None</span>
<a name="line-70"></a><span class='hs-definition'>numToTrustInfo</span> <span class='hs-num'>1</span> <span class='hs-keyglyph'>=</span> <span class='hs-varid'>setSafeMode</span> <span class='hs-conid'>Sf_Unsafe</span>
<a name="line-71"></a><span class='hs-definition'>numToTrustInfo</span> <span class='hs-num'>2</span> <span class='hs-keyglyph'>=</span> <span class='hs-varid'>setSafeMode</span> <span class='hs-conid'>Sf_Trustworthy</span>
<a name="line-72"></a><span class='hs-definition'>numToTrustInfo</span> <span class='hs-num'>3</span> <span class='hs-keyglyph'>=</span> <span class='hs-varid'>setSafeMode</span> <span class='hs-conid'>Sf_Safe</span>
<a name="line-73"></a><span class='hs-definition'>numToTrustInfo</span> <span class='hs-num'>4</span> <span class='hs-keyglyph'>=</span> <span class='hs-varid'>setSafeMode</span> <span class='hs-conid'>Sf_SafeInferred</span>
<a name="line-74"></a><span class='hs-definition'>numToTrustInfo</span> <span class='hs-varid'>n</span> <span class='hs-keyglyph'>=</span> <span class='hs-varid'>error</span> <span class='hs-varop'>$</span> <span class='hs-str'>"numToTrustInfo: bad input number! ("</span> <span class='hs-varop'>++</span> <span class='hs-varid'>show</span> <span class='hs-varid'>n</span> <span class='hs-varop'>++</span> <span class='hs-str'>")"</span>
<a name="line-75"></a>
<a name="line-76"></a><a name="instance%20Outputable%20IfaceTrustInfo"></a><span class='hs-keyword'>instance</span> <span class='hs-conid'>Outputable</span> <span class='hs-conid'>IfaceTrustInfo</span> <span class='hs-keyword'>where</span>
<a name="line-77"></a>    <span class='hs-varid'>ppr</span> <span class='hs-layout'>(</span><span class='hs-conid'>TrustInfo</span> <span class='hs-conid'>Sf_None</span><span class='hs-layout'>)</span>          <span class='hs-keyglyph'>=</span> <span class='hs-varid'>text</span> <span class='hs-str'>"none"</span>
<a name="line-78"></a>    <span class='hs-varid'>ppr</span> <span class='hs-layout'>(</span><span class='hs-conid'>TrustInfo</span> <span class='hs-conid'>Sf_Ignore</span><span class='hs-layout'>)</span>        <span class='hs-keyglyph'>=</span> <span class='hs-varid'>text</span> <span class='hs-str'>"none"</span>
<a name="line-79"></a>    <span class='hs-varid'>ppr</span> <span class='hs-layout'>(</span><span class='hs-conid'>TrustInfo</span> <span class='hs-conid'>Sf_Unsafe</span><span class='hs-layout'>)</span>        <span class='hs-keyglyph'>=</span> <span class='hs-varid'>text</span> <span class='hs-str'>"unsafe"</span>
<a name="line-80"></a>    <span class='hs-varid'>ppr</span> <span class='hs-layout'>(</span><span class='hs-conid'>TrustInfo</span> <span class='hs-conid'>Sf_Trustworthy</span><span class='hs-layout'>)</span>   <span class='hs-keyglyph'>=</span> <span class='hs-varid'>text</span> <span class='hs-str'>"trustworthy"</span>
<a name="line-81"></a>    <span class='hs-varid'>ppr</span> <span class='hs-layout'>(</span><span class='hs-conid'>TrustInfo</span> <span class='hs-conid'>Sf_Safe</span><span class='hs-layout'>)</span>          <span class='hs-keyglyph'>=</span> <span class='hs-varid'>text</span> <span class='hs-str'>"safe"</span>
<a name="line-82"></a>    <span class='hs-varid'>ppr</span> <span class='hs-layout'>(</span><span class='hs-conid'>TrustInfo</span> <span class='hs-conid'>Sf_SafeInferred</span><span class='hs-layout'>)</span>  <span class='hs-keyglyph'>=</span> <span class='hs-varid'>text</span> <span class='hs-str'>"safe-inferred"</span>
<a name="line-83"></a>
<a name="line-84"></a><a name="instance%20Binary%20IfaceTrustInfo"></a><span class='hs-keyword'>instance</span> <span class='hs-conid'>Binary</span> <span class='hs-conid'>IfaceTrustInfo</span> <span class='hs-keyword'>where</span>
<a name="line-85"></a>    <span class='hs-varid'>put_</span> <span class='hs-varid'>bh</span> <span class='hs-varid'>iftrust</span> <span class='hs-keyglyph'>=</span> <span class='hs-varid'>putByte</span> <span class='hs-varid'>bh</span> <span class='hs-varop'>$</span> <span class='hs-varid'>trustInfoToNum</span> <span class='hs-varid'>iftrust</span>
<a name="line-86"></a>    <span class='hs-varid'>get</span> <span class='hs-varid'>bh</span> <span class='hs-keyglyph'>=</span> <span class='hs-varid'>getByte</span> <span class='hs-varid'>bh</span> <span class='hs-varop'>&gt;&gt;=</span> <span class='hs-layout'>(</span><span class='hs-varid'>return</span> <span class='hs-varop'>.</span> <span class='hs-varid'>numToTrustInfo</span><span class='hs-layout'>)</span>
</pre></body>
</html>
