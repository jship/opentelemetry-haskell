<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd"><html xmlns="http://www.w3.org/1999/xhtml"><head><link rel="stylesheet" type="text/css" href="style.css" /><script type="text/javascript" src="highlight.js"></script></head><body><pre><span class="hs-pragma">{-# LANGUAGE CPP          #-}</span><span>
</span><span id="line-2"></span><span class="hs-pragma">{-# LANGUAGE TypeFamilies #-}</span><span>
</span><span id="line-3"></span><span>
</span><span id="line-4"></span><span class="hs-pragma">{-# OPTIONS_GHC -Wno-incomplete-record-updates #-}</span><span>
</span><span id="line-5"></span><span>
</span><span id="line-6"></span><span class="hs-keyword">module</span><span> </span><span class="hs-identifier">GHC.Rename.Splice</span><span> </span><span class="hs-special">(</span><span>
</span><span id="line-7"></span><span>        </span><span class="annot"><a href="GHC.Rename.Splice.html#rnTopSpliceDecls"><span class="hs-identifier">rnTopSpliceDecls</span></a></span><span class="hs-special">,</span><span>
</span><span id="line-8"></span><span>        </span><span class="annot"><a href="GHC.Rename.Splice.html#rnSpliceType"><span class="hs-identifier">rnSpliceType</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><a href="GHC.Rename.Splice.html#rnSpliceExpr"><span class="hs-identifier">rnSpliceExpr</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><a href="GHC.Rename.Splice.html#rnSplicePat"><span class="hs-identifier">rnSplicePat</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><a href="GHC.Rename.Splice.html#rnSpliceDecl"><span class="hs-identifier">rnSpliceDecl</span></a></span><span class="hs-special">,</span><span>
</span><span id="line-9"></span><span>        </span><span class="annot"><a href="GHC.Rename.Splice.html#rnBracket"><span class="hs-identifier">rnBracket</span></a></span><span class="hs-special">,</span><span>
</span><span id="line-10"></span><span>        </span><span class="annot"><a href="GHC.Rename.Splice.html#checkThLocalName"><span class="hs-identifier">checkThLocalName</span></a></span><span>
</span><span id="line-11"></span><span>        </span><span class="hs-special">,</span><span> </span><span class="annot"><a href="GHC.Rename.Splice.html#traceSplice"><span class="hs-identifier">traceSplice</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><a href="GHC.Rename.Splice.html#SpliceInfo"><span class="hs-identifier">SpliceInfo</span></a></span><span class="hs-special">(</span><span class="hs-glyph">..</span><span class="hs-special">)</span><span>
</span><span id="line-12"></span><span>  </span><span class="hs-special">)</span><span> </span><span class="hs-keyword">where</span><span class="hs-cpp">

#include &quot;HsVersions.h&quot;
</span><span>
</span><span id="line-16"></span><span class="hs-keyword">import</span><span> </span><span class="annot"><a href="GHC.Prelude.html"><span class="hs-identifier">GHC.Prelude</span></a></span><span>
</span><span id="line-17"></span><span>
</span><span id="line-18"></span><span class="hs-keyword">import</span><span> </span><span class="annot"><a href="GHC.Types.Name.html"><span class="hs-identifier">GHC.Types.Name</span></a></span><span>
</span><span id="line-19"></span><span class="hs-keyword">import</span><span> </span><span class="annot"><a href="GHC.Types.Name.Set.html"><span class="hs-identifier">GHC.Types.Name.Set</span></a></span><span>
</span><span id="line-20"></span><span class="hs-keyword">import</span><span> </span><span class="annot"><a href="GHC.Hs.html"><span class="hs-identifier">GHC.Hs</span></a></span><span>
</span><span id="line-21"></span><span class="hs-keyword">import</span><span> </span><span class="annot"><a href="GHC.Types.Name.Reader.html"><span class="hs-identifier">GHC.Types.Name.Reader</span></a></span><span>
</span><span id="line-22"></span><span class="hs-keyword">import</span><span> </span><span class="annot"><a href="GHC.Tc.Utils.Monad.html"><span class="hs-identifier">GHC.Tc.Utils.Monad</span></a></span><span>
</span><span id="line-23"></span><span class="hs-keyword">import</span><span> </span><span class="annot"><a href="GHC.Driver.Env.Types.html"><span class="hs-identifier">GHC.Driver.Env.Types</span></a></span><span>
</span><span id="line-24"></span><span>
</span><span id="line-25"></span><span class="hs-keyword">import</span><span> </span><span class="annot"><a href="GHC.Rename.Env.html"><span class="hs-identifier">GHC.Rename.Env</span></a></span><span>
</span><span id="line-26"></span><span class="hs-keyword">import</span><span> </span><span class="annot"><a href="GHC.Rename.Utils.html"><span class="hs-identifier">GHC.Rename.Utils</span></a></span><span>   </span><span class="hs-special">(</span><span> </span><span class="annot"><a href="GHC.Rename.Utils.html#HsDocContext"><span class="hs-identifier">HsDocContext</span></a></span><span class="hs-special">(</span><span class="hs-glyph">..</span><span class="hs-special">)</span><span class="hs-special">,</span><span> </span><span class="annot"><a href="GHC.Rename.Utils.html#newLocalBndrRn"><span class="hs-identifier">newLocalBndrRn</span></a></span><span> </span><span class="hs-special">)</span><span>
</span><span id="line-27"></span><span class="hs-keyword">import</span><span> </span><span class="annot"><a href="GHC.Rename.Unbound.html"><span class="hs-identifier">GHC.Rename.Unbound</span></a></span><span> </span><span class="hs-special">(</span><span> </span><span class="annot"><a href="GHC.Builtin.Names.html#isUnboundName"><span class="hs-identifier">isUnboundName</span></a></span><span> </span><span class="hs-special">)</span><span>
</span><span id="line-28"></span><span class="hs-keyword">import</span><span> </span><span class="annot"><a href="GHC.Rename.Module.html"><span class="hs-identifier">GHC.Rename.Module</span></a></span><span>  </span><span class="hs-special">(</span><span> </span><span class="annot"><a href="GHC.Rename.Module.html#rnSrcDecls"><span class="hs-identifier">rnSrcDecls</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><a href="GHC.Rename.Module.html#findSplice"><span class="hs-identifier">findSplice</span></a></span><span> </span><span class="hs-special">)</span><span>
</span><span id="line-29"></span><span class="hs-keyword">import</span><span> </span><span class="annot"><a href="GHC.Rename.Pat.html"><span class="hs-identifier">GHC.Rename.Pat</span></a></span><span>     </span><span class="hs-special">(</span><span> </span><span class="annot"><a href="GHC.Rename.Pat.html#rnPat"><span class="hs-identifier">rnPat</span></a></span><span> </span><span class="hs-special">)</span><span>
</span><span id="line-30"></span><span class="hs-keyword">import</span><span> </span><span class="annot"><a href="GHC.Types.Basic.html"><span class="hs-identifier">GHC.Types.Basic</span></a></span><span>    </span><span class="hs-special">(</span><span> </span><span class="annot"><a href="GHC.Types.Basic.html#TopLevelFlag"><span class="hs-identifier">TopLevelFlag</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><a href="GHC.Types.Basic.html#isTopLevel"><span class="hs-identifier">isTopLevel</span></a></span><span> </span><span class="hs-special">)</span><span>
</span><span id="line-31"></span><span class="hs-keyword">import</span><span> </span><span class="annot"><a href="GHC.Types.SourceText.html"><span class="hs-identifier">GHC.Types.SourceText</span></a></span><span> </span><span class="hs-special">(</span><span> </span><span class="annot"><a href="GHC.Types.SourceText.html#SourceText"><span class="hs-identifier">SourceText</span></a></span><span class="hs-special">(</span><span class="hs-glyph">..</span><span class="hs-special">)</span><span> </span><span class="hs-special">)</span><span>
</span><span id="line-32"></span><span class="hs-keyword">import</span><span> </span><span class="annot"><a href="GHC.Utils.Outputable.html"><span class="hs-identifier">GHC.Utils.Outputable</span></a></span><span>
</span><span id="line-33"></span><span class="hs-keyword">import</span><span> </span><span class="annot"><a href="GHC.Unit.Module.html"><span class="hs-identifier">GHC.Unit.Module</span></a></span><span>
</span><span id="line-34"></span><span class="hs-keyword">import</span><span> </span><span class="annot"><a href="GHC.Types.SrcLoc.html"><span class="hs-identifier">GHC.Types.SrcLoc</span></a></span><span>
</span><span id="line-35"></span><span class="hs-keyword">import</span><span> </span><span class="annot"><a href="GHC.Rename.HsType.html"><span class="hs-identifier">GHC.Rename.HsType</span></a></span><span> </span><span class="hs-special">(</span><span> </span><span class="annot"><a href="GHC.Rename.HsType.html#rnLHsType"><span class="hs-identifier">rnLHsType</span></a></span><span> </span><span class="hs-special">)</span><span>
</span><span id="line-36"></span><span>
</span><span id="line-37"></span><span class="hs-keyword">import</span><span> </span><span class="annot"><a href="../../base-4.16.4.0/src/Control-Monad.html#"><span class="hs-identifier">Control.Monad</span></a></span><span>    </span><span class="hs-special">(</span><span> </span><span class="annot"><a href="../../base-4.16.4.0/src/Control-Monad.html#unless"><span class="hs-identifier">unless</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><a href="../../base-4.16.4.0/src/GHC-Base.html#when"><span class="hs-identifier">when</span></a></span><span> </span><span class="hs-special">)</span><span>
</span><span id="line-38"></span><span>
</span><span id="line-39"></span><span class="hs-keyword">import</span><span> </span><span class="hs-pragma">{-# SOURCE</span><span> </span><span class="hs-pragma">#-}</span><span> </span><span class="annot"><a href="GHC.Rename.Expr.html"><span class="hs-identifier">GHC.Rename.Expr</span></a></span><span> </span><span class="hs-special">(</span><span> </span><span class="annot"><a href="GHC.Rename.Expr.html#rnLExpr"><span class="hs-identifier">rnLExpr</span></a></span><span> </span><span class="hs-special">)</span><span>
</span><span id="line-40"></span><span>
</span><span id="line-41"></span><span class="hs-keyword">import</span><span> </span><span class="annot"><a href="GHC.Tc.Utils.Env.html"><span class="hs-identifier">GHC.Tc.Utils.Env</span></a></span><span>     </span><span class="hs-special">(</span><span> </span><span class="annot"><a href="GHC.Tc.Utils.Env.html#checkWellStaged"><span class="hs-identifier">checkWellStaged</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><a href="GHC.Tc.Utils.Env.html#tcMetaTy"><span class="hs-identifier">tcMetaTy</span></a></span><span> </span><span class="hs-special">)</span><span>
</span><span id="line-42"></span><span>
</span><span id="line-43"></span><span class="hs-keyword">import</span><span> </span><span class="annot"><a href="GHC.Driver.Session.html"><span class="hs-identifier">GHC.Driver.Session</span></a></span><span>
</span><span id="line-44"></span><span class="hs-keyword">import</span><span> </span><span class="annot"><a href="GHC.Data.FastString.html"><span class="hs-identifier">GHC.Data.FastString</span></a></span><span>
</span><span id="line-45"></span><span class="hs-keyword">import</span><span> </span><span class="annot"><a href="GHC.Utils.Logger.html"><span class="hs-identifier">GHC.Utils.Logger</span></a></span><span>  </span><span class="hs-special">(</span><span> </span><span class="annot"><a href="GHC.Utils.Logger.html#dumpIfSet_dyn_printer"><span class="hs-identifier">dumpIfSet_dyn_printer</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><a href="GHC.Utils.Logger.html#DumpFormat"><span class="hs-identifier">DumpFormat</span></a></span><span> </span><span class="hs-special">(</span><span class="hs-glyph">..</span><span class="hs-special">)</span><span class="hs-special">,</span><span> </span><span class="annot"><a href="GHC.Utils.Logger.html#getLogger"><span class="hs-identifier">getLogger</span></a></span><span> </span><span class="hs-special">)</span><span>
</span><span id="line-46"></span><span class="hs-keyword">import</span><span> </span><span class="annot"><a href="GHC.Utils.Panic.html"><span class="hs-identifier">GHC.Utils.Panic</span></a></span><span>
</span><span id="line-47"></span><span class="hs-keyword">import</span><span> </span><span class="annot"><a href="GHC.Driver.Hooks.html"><span class="hs-identifier">GHC.Driver.Hooks</span></a></span><span>
</span><span id="line-48"></span><span class="hs-keyword">import</span><span> </span><span class="annot"><a href="GHC.Builtin.Names.TH.html"><span class="hs-identifier">GHC.Builtin.Names.TH</span></a></span><span> </span><span class="hs-special">(</span><span> </span><span class="annot"><a href="GHC.Builtin.Names.TH.html#decsQTyConName"><span class="hs-identifier">decsQTyConName</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><a href="GHC.Builtin.Names.TH.html#expQTyConName"><span class="hs-identifier">expQTyConName</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><a href="GHC.Builtin.Names.TH.html#liftName"><span class="hs-identifier">liftName</span></a></span><span>
</span><span id="line-49"></span><span>                            </span><span class="hs-special">,</span><span> </span><span class="annot"><a href="GHC.Builtin.Names.TH.html#patQTyConName"><span class="hs-identifier">patQTyConName</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><a href="GHC.Builtin.Names.TH.html#quoteDecName"><span class="hs-identifier">quoteDecName</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><a href="GHC.Builtin.Names.TH.html#quoteExpName"><span class="hs-identifier">quoteExpName</span></a></span><span>
</span><span id="line-50"></span><span>                            </span><span class="hs-special">,</span><span> </span><span class="annot"><a href="GHC.Builtin.Names.TH.html#quotePatName"><span class="hs-identifier">quotePatName</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><a href="GHC.Builtin.Names.TH.html#quoteTypeName"><span class="hs-identifier">quoteTypeName</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><a href="GHC.Builtin.Names.TH.html#typeQTyConName"><span class="hs-identifier">typeQTyConName</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-51"></span><span>
</span><span id="line-52"></span><span class="hs-keyword">import</span><span> </span><span class="hs-pragma">{-# SOURCE</span><span> </span><span class="hs-pragma">#-}</span><span> </span><span class="annot"><a href="GHC.Tc.Gen.Expr.html"><span class="hs-identifier">GHC.Tc.Gen.Expr</span></a></span><span>   </span><span class="hs-special">(</span><span> </span><span class="annot"><a href="GHC.Tc.Gen.Expr.html#tcCheckPolyExpr"><span class="hs-identifier">tcCheckPolyExpr</span></a></span><span> </span><span class="hs-special">)</span><span>
</span><span id="line-53"></span><span class="hs-keyword">import</span><span> </span><span class="hs-pragma">{-# SOURCE</span><span> </span><span class="hs-pragma">#-}</span><span> </span><span class="annot"><a href="GHC.Tc.Gen.Splice.html"><span class="hs-identifier">GHC.Tc.Gen.Splice</span></a></span><span>
</span><span id="line-54"></span><span>    </span><span class="hs-special">(</span><span> </span><span class="annot"><a href="GHC.Tc.Gen.Splice.html#runMetaD"><span class="hs-identifier">runMetaD</span></a></span><span>
</span><span id="line-55"></span><span>    </span><span class="hs-special">,</span><span> </span><span class="annot"><a href="GHC.Tc.Gen.Splice.html#runMetaE"><span class="hs-identifier">runMetaE</span></a></span><span>
</span><span id="line-56"></span><span>    </span><span class="hs-special">,</span><span> </span><span class="annot"><a href="GHC.Tc.Gen.Splice.html#runMetaP"><span class="hs-identifier">runMetaP</span></a></span><span>
</span><span id="line-57"></span><span>    </span><span class="hs-special">,</span><span> </span><span class="annot"><a href="GHC.Tc.Gen.Splice.html#runMetaT"><span class="hs-identifier">runMetaT</span></a></span><span>
</span><span id="line-58"></span><span>    </span><span class="hs-special">,</span><span> </span><span class="annot"><a href="GHC.Tc.Gen.Splice.html#tcTopSpliceExpr"><span class="hs-identifier">tcTopSpliceExpr</span></a></span><span>
</span><span id="line-59"></span><span>    </span><span class="hs-special">)</span><span>
</span><span id="line-60"></span><span>
</span><span id="line-61"></span><span class="hs-keyword">import</span><span> </span><span class="annot"><a href="GHC.Tc.Utils.Zonk.html"><span class="hs-identifier">GHC.Tc.Utils.Zonk</span></a></span><span>
</span><span id="line-62"></span><span>
</span><span id="line-63"></span><span class="hs-keyword">import</span><span> </span><span class="annot"><a href="../../ghci-9.2.7/src/GHCi-RemoteTypes.html#"><span class="hs-identifier">GHCi.RemoteTypes</span></a></span><span> </span><span class="hs-special">(</span><span> </span><span class="annot"><a href="../../ghci-9.2.7/src/GHCi-RemoteTypes.html#ForeignRef"><span class="hs-identifier">ForeignRef</span></a></span><span> </span><span class="hs-special">)</span><span>
</span><span id="line-64"></span><span class="hs-keyword">import</span><span> </span><span class="hs-keyword">qualified</span><span> </span><span class="annot"><a href="../../template-haskell-2.18.0.0/src/Language-Haskell-TH.html#"><span class="hs-identifier">Language.Haskell.TH</span></a></span><span> </span><span class="hs-keyword">as</span><span> </span><span class="annot"><span class="hs-identifier">TH</span></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="../../template-haskell-2.18.0.0/src/Language-Haskell-TH-Syntax.html#Q"><span class="hs-identifier">Q</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-65"></span><span>
</span><span id="line-66"></span><span class="hs-keyword">import</span><span> </span><span class="hs-keyword">qualified</span><span> </span><span class="annot"><a href="../../ghc-boot-9.2.7/src/GHC-LanguageExtensions.html#"><span class="hs-identifier">GHC.LanguageExtensions</span></a></span><span> </span><span class="hs-keyword">as</span><span> </span><span class="annot"><span class="hs-identifier">LangExt</span></span><span>
</span><span id="line-67"></span><span>
</span><span id="line-68"></span><span class="hs-comment">{-
************************************************************************
*                                                                      *
        Template Haskell brackets
*                                                                      *
************************************************************************
-}</span><span>
</span><span id="line-75"></span><span>
</span><span id="line-76"></span><span class="annot"><a href="GHC.Rename.Splice.html#rnBracket"><span class="hs-identifier hs-type">rnBracket</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><a href="Language.Haskell.Syntax.Expr.html#HsExpr"><span class="hs-identifier hs-type">HsExpr</span></a></span><span> </span><span class="annot"><a href="GHC.Hs.Extension.html#GhcPs"><span class="hs-identifier hs-type">GhcPs</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="Language.Haskell.Syntax.Expr.html#HsBracket"><span class="hs-identifier hs-type">HsBracket</span></a></span><span> </span><span class="annot"><a href="GHC.Hs.Extension.html#GhcPs"><span class="hs-identifier hs-type">GhcPs</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="GHC.Tc.Types.html#RnM"><span class="hs-identifier hs-type">RnM</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="Language.Haskell.Syntax.Expr.html#HsExpr"><span class="hs-identifier hs-type">HsExpr</span></a></span><span> </span><span class="annot"><a href="GHC.Hs.Extension.html#GhcRn"><span class="hs-identifier hs-type">GhcRn</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><a href="GHC.Types.Name.Set.html#FreeVars"><span class="hs-identifier hs-type">FreeVars</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-77"></span><span id="rnBracket"><span class="annot"><span class="annottext">rnBracket :: HsExpr GhcPs
-&gt; HsBracket GhcPs -&gt; RnM (HsExpr (GhcPass 'Renamed), Uses)
</span><a href="GHC.Rename.Splice.html#rnBracket"><span class="hs-identifier hs-var hs-var">rnBracket</span></a></span></span><span> </span><span id="local-6989586621681353867"><span class="annot"><span class="annottext">HsExpr GhcPs
</span><a href="#local-6989586621681353867"><span class="hs-identifier hs-var">e</span></a></span></span><span> </span><span id="local-6989586621681353866"><span class="annot"><span class="annottext">HsBracket GhcPs
</span><a href="#local-6989586621681353866"><span class="hs-identifier hs-var">br_body</span></a></span></span><span>
</span><span id="line-78"></span><span>  </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">forall a. SDoc -&gt; TcM a -&gt; TcM a
</span><a href="GHC.Tc.Utils.Monad.html#addErrCtxt"><span class="hs-identifier hs-var">addErrCtxt</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">HsBracket GhcPs -&gt; SDoc
</span><a href="GHC.Rename.Splice.html#quotationCtxtDoc"><span class="hs-identifier hs-var">quotationCtxtDoc</span></a></span><span> </span><span class="annot"><span class="annottext">HsBracket GhcPs
</span><a href="#local-6989586621681353866"><span class="hs-identifier hs-var">br_body</span></a></span><span class="hs-special">)</span><span> </span><span class="annot"><span class="annottext">forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><a href="../../base-4.16.4.0/src/GHC-Base.html#%24"><span class="hs-operator hs-var">$</span></a></span><span>
</span><span id="line-79"></span><span>    </span><span class="hs-keyword">do</span><span> </span><span class="hs-special">{</span><span> </span><span class="hs-comment">-- Check that -XTemplateHaskellQuotes is enabled and available</span><span>
</span><span id="line-80"></span><span>         </span><span id="local-6989586621681353863"><span class="annot"><span class="annottext">Bool
</span><a href="#local-6989586621681353863"><span class="hs-identifier hs-var">thQuotesEnabled</span></a></span></span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">forall gbl lcl. Extension -&gt; TcRnIf gbl lcl Bool
</span><a href="GHC.Tc.Utils.Monad.html#xoptM"><span class="hs-identifier hs-var">xoptM</span></a></span><span> </span><span class="annot"><span class="annottext">Extension
</span><span class="hs-identifier hs-var">LangExt.TemplateHaskellQuotes</span></span><span>
</span><span id="line-81"></span><span>       </span><span class="hs-special">;</span><span> </span><span class="annot"><span class="annottext">forall (f :: * -&gt; *). Applicative f =&gt; Bool -&gt; f () -&gt; f ()
</span><a href="../../base-4.16.4.0/src/Control-Monad.html#unless"><span class="hs-identifier hs-var">unless</span></a></span><span> </span><span class="annot"><span class="annottext">Bool
</span><a href="#local-6989586621681353863"><span class="hs-identifier hs-var">thQuotesEnabled</span></a></span><span> </span><span class="annot"><span class="annottext">forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><a href="../../base-4.16.4.0/src/GHC-Base.html#%24"><span class="hs-operator hs-var">$</span></a></span><span>
</span><span id="line-82"></span><span>           </span><span class="annot"><span class="annottext">forall a. SDoc -&gt; TcRn a
</span><a href="GHC.Tc.Utils.Monad.html#failWith"><span class="hs-identifier hs-var">failWith</span></a></span><span> </span><span class="hs-special">(</span><span> </span><span class="annot"><span class="annottext">[SDoc] -&gt; SDoc
</span><a href="GHC.Utils.Outputable.html#vcat"><span class="hs-identifier hs-var">vcat</span></a></span><span>
</span><span id="line-83"></span><span>                      </span><span class="hs-special">[</span><span> </span><span class="annot"><span class="annottext">String -&gt; SDoc
</span><a href="GHC.Utils.Outputable.html#text"><span class="hs-identifier hs-var">text</span></a></span><span> </span><span class="annot"><span class="annottext">String
</span><span class="hs-string">&quot;Syntax error on&quot;</span></span><span> </span><span class="annot"><span class="annottext">SDoc -&gt; SDoc -&gt; SDoc
</span><a href="GHC.Utils.Outputable.html#%3C%2B%3E"><span class="hs-operator hs-var">&lt;+&gt;</span></a></span><span> </span><span class="annot"><span class="annottext">forall a. Outputable a =&gt; a -&gt; SDoc
</span><a href="GHC.Utils.Outputable.html#ppr"><span class="hs-identifier hs-var">ppr</span></a></span><span> </span><span class="annot"><span class="annottext">HsExpr GhcPs
</span><a href="#local-6989586621681353867"><span class="hs-identifier hs-var">e</span></a></span><span>
</span><span id="line-84"></span><span>                      </span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">String -&gt; SDoc
</span><a href="GHC.Utils.Outputable.html#text"><span class="hs-identifier hs-var">text</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">String
</span><span class="hs-string">&quot;Perhaps you intended to use TemplateHaskell&quot;</span></span><span>
</span><span id="line-85"></span><span>                              </span><span class="annot"><span class="annottext">forall a. [a] -&gt; [a] -&gt; [a]
</span><a href="../../base-4.16.4.0/src/GHC-Base.html#%2B%2B"><span class="hs-operator hs-var">++</span></a></span><span> </span><span class="annot"><span class="annottext">String
</span><span class="hs-string">&quot; or TemplateHaskellQuotes&quot;</span></span><span class="hs-special">)</span><span> </span><span class="hs-special">]</span><span> </span><span class="hs-special">)</span><span>
</span><span id="line-86"></span><span>
</span><span id="line-87"></span><span>         </span><span class="hs-comment">-- Check for nested brackets</span><span>
</span><span id="line-88"></span><span>       </span><span class="hs-special">;</span><span> </span><span id="local-6989586621681353855"><span class="annot"><span class="annottext">ThStage
</span><a href="#local-6989586621681353855"><span class="hs-identifier hs-var">cur_stage</span></a></span></span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">TcM ThStage
</span><a href="GHC.Tc.Utils.Monad.html#getStage"><span class="hs-identifier hs-var">getStage</span></a></span><span>
</span><span id="line-89"></span><span>       </span><span class="hs-special">;</span><span> </span><span class="hs-keyword">case</span><span> </span><span class="annot"><span class="annottext">ThStage
</span><a href="#local-6989586621681353855"><span class="hs-identifier hs-var">cur_stage</span></a></span><span> </span><span class="hs-keyword">of</span><span>
</span><span id="line-90"></span><span>           </span><span class="hs-special">{</span><span> </span><span class="annot"><a href="GHC.Tc.Types.html#Splice"><span class="hs-identifier hs-type">Splice</span></a></span><span> </span><span class="annot"><span class="annottext">SpliceType
</span><a href="GHC.Tc.Types.html#Typed"><span class="hs-identifier hs-var">Typed</span></a></span><span>   </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="annottext">Bool -&gt; SDoc -&gt; IOEnv (Env TcGblEnv TcLclEnv) ()
</span><a href="GHC.Tc.Utils.Monad.html#checkTc"><span class="hs-identifier hs-var">checkTc</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">forall id. HsBracket id -&gt; Bool
</span><a href="Language.Haskell.Syntax.Expr.html#isTypedBracket"><span class="hs-identifier hs-var">isTypedBracket</span></a></span><span> </span><span class="annot"><span class="annottext">HsBracket GhcPs
</span><a href="#local-6989586621681353866"><span class="hs-identifier hs-var">br_body</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-91"></span><span>                                       </span><span class="annot"><span class="annottext">SDoc
</span><a href="GHC.Rename.Splice.html#illegalUntypedBracket"><span class="hs-identifier hs-var">illegalUntypedBracket</span></a></span><span>
</span><span id="line-92"></span><span>           </span><span class="hs-special">;</span><span> </span><span class="annot"><a href="GHC.Tc.Types.html#Splice"><span class="hs-identifier hs-type">Splice</span></a></span><span> </span><span class="annot"><span class="annottext">SpliceType
</span><a href="GHC.Tc.Types.html#Untyped"><span class="hs-identifier hs-var">Untyped</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="annottext">Bool -&gt; SDoc -&gt; IOEnv (Env TcGblEnv TcLclEnv) ()
</span><a href="GHC.Tc.Utils.Monad.html#checkTc"><span class="hs-identifier hs-var">checkTc</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Bool -&gt; Bool
</span><span class="hs-identifier hs-var">not</span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">forall id. HsBracket id -&gt; Bool
</span><a href="Language.Haskell.Syntax.Expr.html#isTypedBracket"><span class="hs-identifier hs-var">isTypedBracket</span></a></span><span> </span><span class="annot"><span class="annottext">HsBracket GhcPs
</span><a href="#local-6989586621681353866"><span class="hs-identifier hs-var">br_body</span></a></span><span class="hs-special">)</span><span class="hs-special">)</span><span>
</span><span id="line-93"></span><span>                                       </span><span class="annot"><span class="annottext">SDoc
</span><a href="GHC.Rename.Splice.html#illegalTypedBracket"><span class="hs-identifier hs-var">illegalTypedBracket</span></a></span><span>
</span><span id="line-94"></span><span>           </span><span class="hs-special">;</span><span> </span><span class="annot"><a href="GHC.Tc.Types.html#RunSplice"><span class="hs-identifier hs-type">RunSplice</span></a></span><span> </span><span class="annot"><span class="annottext">TcRef [ForeignRef (Q ())]
</span><span class="hs-identifier">_</span></span><span>    </span><span class="hs-glyph">-&gt;</span><span>
</span><span id="line-95"></span><span>               </span><span class="hs-comment">-- See Note [RunSplice ThLevel] in GHC.Tc.Types.</span><span>
</span><span id="line-96"></span><span>               </span><span class="annot"><span class="annottext">forall a. HasCallStack =&gt; String -&gt; SDoc -&gt; a
</span><a href="GHC.Utils.Panic.html#pprPanic"><span class="hs-identifier hs-var">pprPanic</span></a></span><span> </span><span class="annot"><span class="annottext">String
</span><span class="hs-string">&quot;rnBracket: Renaming bracket when running a splice&quot;</span></span><span>
</span><span id="line-97"></span><span>                        </span><span class="hs-special">(</span><span class="annot"><span class="annottext">forall a. Outputable a =&gt; a -&gt; SDoc
</span><a href="GHC.Utils.Outputable.html#ppr"><span class="hs-identifier hs-var">ppr</span></a></span><span> </span><span class="annot"><span class="annottext">HsExpr GhcPs
</span><a href="#local-6989586621681353867"><span class="hs-identifier hs-var">e</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-98"></span><span>           </span><span class="hs-special">;</span><span> </span><span class="annot"><span class="annottext">ThStage
</span><a href="GHC.Tc.Types.html#Comp"><span class="hs-identifier hs-var">Comp</span></a></span><span>           </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="annottext">forall (m :: * -&gt; *) a. Monad m =&gt; a -&gt; m a
</span><a href="../../base-4.16.4.0/src/GHC-Base.html#return"><span class="hs-identifier hs-var">return</span></a></span><span> </span><span class="hs-special">(</span><span class="hs-special">)</span><span>
</span><span id="line-99"></span><span>           </span><span class="hs-special">;</span><span> </span><span class="annot"><a href="GHC.Tc.Types.html#Brack"><span class="hs-identifier hs-type">Brack</span></a></span><span> </span><span class="hs-special">{</span><span class="hs-special">}</span><span>       </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="annottext">forall a. SDoc -&gt; TcRn a
</span><a href="GHC.Tc.Utils.Monad.html#failWithTc"><span class="hs-identifier hs-var">failWithTc</span></a></span><span> </span><span class="annot"><span class="annottext">SDoc
</span><a href="GHC.Rename.Splice.html#illegalBracket"><span class="hs-identifier hs-var">illegalBracket</span></a></span><span>
</span><span id="line-100"></span><span>           </span><span class="hs-special">}</span><span>
</span><span id="line-101"></span><span>
</span><span id="line-102"></span><span>         </span><span class="hs-comment">-- Brackets are desugared to code that mentions the TH package</span><span>
</span><span id="line-103"></span><span>       </span><span class="hs-special">;</span><span> </span><span class="annot"><span class="annottext">IOEnv (Env TcGblEnv TcLclEnv) ()
</span><a href="GHC.Tc.Utils.Monad.html#recordThUse"><span class="hs-identifier hs-var">recordThUse</span></a></span><span>
</span><span id="line-104"></span><span>
</span><span id="line-105"></span><span>       </span><span class="hs-special">;</span><span> </span><span class="hs-keyword">case</span><span> </span><span class="annot"><span class="annottext">forall id. HsBracket id -&gt; Bool
</span><a href="Language.Haskell.Syntax.Expr.html#isTypedBracket"><span class="hs-identifier hs-var">isTypedBracket</span></a></span><span> </span><span class="annot"><span class="annottext">HsBracket GhcPs
</span><a href="#local-6989586621681353866"><span class="hs-identifier hs-var">br_body</span></a></span><span> </span><span class="hs-keyword">of</span><span>
</span><span id="line-106"></span><span>            </span><span class="annot"><span class="annottext">Bool
</span><span class="hs-identifier hs-var">True</span></span><span>  </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-keyword">do</span><span> </span><span class="hs-special">{</span><span> </span><span class="annot"><span class="annottext">String -&gt; SDoc -&gt; IOEnv (Env TcGblEnv TcLclEnv) ()
</span><a href="GHC.Tc.Utils.Monad.html#traceRn"><span class="hs-identifier hs-var">traceRn</span></a></span><span> </span><span class="annot"><span class="annottext">String
</span><span class="hs-string">&quot;Renaming typed TH bracket&quot;</span></span><span> </span><span class="annot"><span class="annottext">SDoc
</span><a href="GHC.Utils.Outputable.html#empty"><span class="hs-identifier hs-var">empty</span></a></span><span>
</span><span id="line-107"></span><span>                        </span><span class="hs-special">;</span><span> </span><span class="hs-special">(</span><span id="local-6989586621681353836"><span class="annot"><span class="annottext">HsBracket (GhcPass 'Renamed)
</span><a href="#local-6989586621681353836"><span class="hs-identifier hs-var">body'</span></a></span></span><span class="hs-special">,</span><span> </span><span id="local-6989586621681353835"><span class="annot"><span class="annottext">Uses
</span><a href="#local-6989586621681353835"><span class="hs-identifier hs-var">fvs_e</span></a></span></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">&lt;-</span><span>
</span><span id="line-108"></span><span>                          </span><span class="annot"><span class="annottext">forall a. ThStage -&gt; TcM a -&gt; TcM a
</span><a href="GHC.Tc.Utils.Monad.html#setStage"><span class="hs-identifier hs-var">setStage</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">ThStage -&gt; PendingStuff -&gt; ThStage
</span><a href="GHC.Tc.Types.html#Brack"><span class="hs-identifier hs-var">Brack</span></a></span><span> </span><span class="annot"><span class="annottext">ThStage
</span><a href="#local-6989586621681353855"><span class="hs-identifier hs-var">cur_stage</span></a></span><span> </span><span class="annot"><span class="annottext">PendingStuff
</span><a href="GHC.Tc.Types.html#RnPendingTyped"><span class="hs-identifier hs-var">RnPendingTyped</span></a></span><span class="hs-special">)</span><span> </span><span class="annot"><span class="annottext">forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><a href="../../base-4.16.4.0/src/GHC-Base.html#%24"><span class="hs-operator hs-var">$</span></a></span><span>
</span><span id="line-109"></span><span>                                   </span><span class="annot"><span class="annottext">ThStage
-&gt; HsBracket GhcPs -&gt; TcRn (HsBracket (GhcPass 'Renamed), Uses)
</span><a href="GHC.Rename.Splice.html#rn_bracket"><span class="hs-identifier hs-var">rn_bracket</span></a></span><span> </span><span class="annot"><span class="annottext">ThStage
</span><a href="#local-6989586621681353855"><span class="hs-identifier hs-var">cur_stage</span></a></span><span> </span><span class="annot"><span class="annottext">HsBracket GhcPs
</span><a href="#local-6989586621681353866"><span class="hs-identifier hs-var">br_body</span></a></span><span>
</span><span id="line-110"></span><span>                        </span><span class="hs-special">;</span><span> </span><span class="annot"><span class="annottext">forall (m :: * -&gt; *) a. Monad m =&gt; a -&gt; m a
</span><a href="../../base-4.16.4.0/src/GHC-Base.html#return"><span class="hs-identifier hs-var">return</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">forall p. XBracket p -&gt; HsBracket p -&gt; HsExpr p
</span><a href="Language.Haskell.Syntax.Expr.html#HsBracket"><span class="hs-identifier hs-var">HsBracket</span></a></span><span> </span><span class="annot"><span class="annottext">forall a. EpAnn a
</span><a href="GHC.Parser.Annotation.html#noAnn"><span class="hs-identifier hs-var">noAnn</span></a></span><span> </span><span class="annot"><span class="annottext">HsBracket (GhcPass 'Renamed)
</span><a href="#local-6989586621681353836"><span class="hs-identifier hs-var">body'</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">Uses
</span><a href="#local-6989586621681353835"><span class="hs-identifier hs-var">fvs_e</span></a></span><span class="hs-special">)</span><span> </span><span class="hs-special">}</span><span>
</span><span id="line-111"></span><span>
</span><span id="line-112"></span><span>            </span><span class="annot"><span class="annottext">Bool
</span><span class="hs-identifier hs-var">False</span></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-keyword">do</span><span> </span><span class="hs-special">{</span><span> </span><span class="annot"><span class="annottext">String -&gt; SDoc -&gt; IOEnv (Env TcGblEnv TcLclEnv) ()
</span><a href="GHC.Tc.Utils.Monad.html#traceRn"><span class="hs-identifier hs-var">traceRn</span></a></span><span> </span><span class="annot"><span class="annottext">String
</span><span class="hs-string">&quot;Renaming untyped TH bracket&quot;</span></span><span> </span><span class="annot"><span class="annottext">SDoc
</span><a href="GHC.Utils.Outputable.html#empty"><span class="hs-identifier hs-var">empty</span></a></span><span>
</span><span id="line-113"></span><span>                        </span><span class="hs-special">;</span><span> </span><span id="local-6989586621681353829"><span class="annot"><span class="annottext">IORef [PendingRnSplice]
</span><a href="#local-6989586621681353829"><span class="hs-identifier hs-var">ps_var</span></a></span></span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">forall a env. a -&gt; IOEnv env (IORef a)
</span><a href="GHC.Data.IOEnv.html#newMutVar"><span class="hs-identifier hs-var">newMutVar</span></a></span><span> </span><span class="hs-special">[</span><span class="hs-special">]</span><span>
</span><span id="line-114"></span><span>                        </span><span class="hs-special">;</span><span> </span><span class="hs-special">(</span><span id="local-6989586621681353827"><span class="annot"><span class="annottext">HsBracket (GhcPass 'Renamed)
</span><a href="#local-6989586621681353827"><span class="hs-identifier hs-var">body'</span></a></span></span><span class="hs-special">,</span><span> </span><span id="local-6989586621681353826"><span class="annot"><span class="annottext">Uses
</span><a href="#local-6989586621681353826"><span class="hs-identifier hs-var">fvs_e</span></a></span></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">&lt;-</span><span>
</span><span id="line-115"></span><span>                          </span><span class="hs-comment">-- See Note [Rebindable syntax and Template Haskell]</span><span>
</span><span id="line-116"></span><span>                          </span><span class="annot"><span class="annottext">forall gbl lcl a. Extension -&gt; TcRnIf gbl lcl a -&gt; TcRnIf gbl lcl a
</span><a href="GHC.Tc.Utils.Monad.html#unsetXOptM"><span class="hs-identifier hs-var">unsetXOptM</span></a></span><span> </span><span class="annot"><span class="annottext">Extension
</span><span class="hs-identifier hs-var">LangExt.RebindableSyntax</span></span><span> </span><span class="annot"><span class="annottext">forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><a href="../../base-4.16.4.0/src/GHC-Base.html#%24"><span class="hs-operator hs-var">$</span></a></span><span>
</span><span id="line-117"></span><span>                          </span><span class="annot"><span class="annottext">forall a. ThStage -&gt; TcM a -&gt; TcM a
</span><a href="GHC.Tc.Utils.Monad.html#setStage"><span class="hs-identifier hs-var">setStage</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">ThStage -&gt; PendingStuff -&gt; ThStage
</span><a href="GHC.Tc.Types.html#Brack"><span class="hs-identifier hs-var">Brack</span></a></span><span> </span><span class="annot"><span class="annottext">ThStage
</span><a href="#local-6989586621681353855"><span class="hs-identifier hs-var">cur_stage</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">IORef [PendingRnSplice] -&gt; PendingStuff
</span><a href="GHC.Tc.Types.html#RnPendingUntyped"><span class="hs-identifier hs-var">RnPendingUntyped</span></a></span><span> </span><span class="annot"><span class="annottext">IORef [PendingRnSplice]
</span><a href="#local-6989586621681353829"><span class="hs-identifier hs-var">ps_var</span></a></span><span class="hs-special">)</span><span class="hs-special">)</span><span> </span><span class="annot"><span class="annottext">forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><a href="../../base-4.16.4.0/src/GHC-Base.html#%24"><span class="hs-operator hs-var">$</span></a></span><span>
</span><span id="line-118"></span><span>                                   </span><span class="annot"><span class="annottext">ThStage
-&gt; HsBracket GhcPs -&gt; TcRn (HsBracket (GhcPass 'Renamed), Uses)
</span><a href="GHC.Rename.Splice.html#rn_bracket"><span class="hs-identifier hs-var">rn_bracket</span></a></span><span> </span><span class="annot"><span class="annottext">ThStage
</span><a href="#local-6989586621681353855"><span class="hs-identifier hs-var">cur_stage</span></a></span><span> </span><span class="annot"><span class="annottext">HsBracket GhcPs
</span><a href="#local-6989586621681353866"><span class="hs-identifier hs-var">br_body</span></a></span><span>
</span><span id="line-119"></span><span>                        </span><span class="hs-special">;</span><span> </span><span id="local-6989586621681353822"><span class="annot"><span class="annottext">[PendingRnSplice]
</span><a href="#local-6989586621681353822"><span class="hs-identifier hs-var">pendings</span></a></span></span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">forall a env. IORef a -&gt; IOEnv env a
</span><a href="GHC.Data.IOEnv.html#readMutVar"><span class="hs-identifier hs-var">readMutVar</span></a></span><span> </span><span class="annot"><span class="annottext">IORef [PendingRnSplice]
</span><a href="#local-6989586621681353829"><span class="hs-identifier hs-var">ps_var</span></a></span><span>
</span><span id="line-120"></span><span>                        </span><span class="hs-special">;</span><span> </span><span class="annot"><span class="annottext">forall (m :: * -&gt; *) a. Monad m =&gt; a -&gt; m a
</span><a href="../../base-4.16.4.0/src/GHC-Base.html#return"><span class="hs-identifier hs-var">return</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">forall p.
XRnBracketOut p
-&gt; HsBracket (HsBracketRn p) -&gt; [PendingRnSplice' p] -&gt; HsExpr p
</span><a href="Language.Haskell.Syntax.Expr.html#HsRnBracketOut"><span class="hs-identifier hs-var">HsRnBracketOut</span></a></span><span> </span><span class="annot"><span class="annottext">NoExtField
</span><a href="Language.Haskell.Syntax.Extension.html#noExtField"><span class="hs-identifier hs-var">noExtField</span></a></span><span> </span><span class="annot"><span class="annottext">HsBracket (GhcPass 'Renamed)
</span><a href="#local-6989586621681353827"><span class="hs-identifier hs-var">body'</span></a></span><span> </span><span class="annot"><span class="annottext">[PendingRnSplice]
</span><a href="#local-6989586621681353822"><span class="hs-identifier hs-var">pendings</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">Uses
</span><a href="#local-6989586621681353826"><span class="hs-identifier hs-var">fvs_e</span></a></span><span class="hs-special">)</span><span> </span><span class="hs-special">}</span><span>
</span><span id="line-121"></span><span>       </span><span class="hs-special">}</span><span>
</span><span id="line-122"></span><span>
</span><span id="line-123"></span><span class="annot"><a href="GHC.Rename.Splice.html#rn_bracket"><span class="hs-identifier hs-type">rn_bracket</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><a href="GHC.Tc.Types.html#ThStage"><span class="hs-identifier hs-type">ThStage</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="Language.Haskell.Syntax.Expr.html#HsBracket"><span class="hs-identifier hs-type">HsBracket</span></a></span><span> </span><span class="annot"><a href="GHC.Hs.Extension.html#GhcPs"><span class="hs-identifier hs-type">GhcPs</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="GHC.Tc.Types.html#RnM"><span class="hs-identifier hs-type">RnM</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="Language.Haskell.Syntax.Expr.html#HsBracket"><span class="hs-identifier hs-type">HsBracket</span></a></span><span> </span><span class="annot"><a href="GHC.Hs.Extension.html#GhcRn"><span class="hs-identifier hs-type">GhcRn</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><a href="GHC.Types.Name.Set.html#FreeVars"><span class="hs-identifier hs-type">FreeVars</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-124"></span><span id="rn_bracket"><span class="annot"><span class="annottext">rn_bracket :: ThStage
-&gt; HsBracket GhcPs -&gt; TcRn (HsBracket (GhcPass 'Renamed), Uses)
</span><a href="GHC.Rename.Splice.html#rn_bracket"><span class="hs-identifier hs-var hs-var">rn_bracket</span></a></span></span><span> </span><span id="local-6989586621681353818"><span class="annot"><span class="annottext">ThStage
</span><a href="#local-6989586621681353818"><span class="hs-identifier hs-var">outer_stage</span></a></span></span><span> </span><span id="local-6989586621681353817"><span class="annot"><span class="annottext">br :: HsBracket GhcPs
</span><a href="#local-6989586621681353817"><span class="hs-identifier hs-var">br</span></a></span></span><span class="hs-glyph">@</span><span class="hs-special">(</span><span class="annot"><a href="Language.Haskell.Syntax.Expr.html#VarBr"><span class="hs-identifier hs-type">VarBr</span></a></span><span> </span><span id="local-6989586621681353815"><span class="annot"><span class="annottext">XVarBr GhcPs
</span><a href="#local-6989586621681353815"><span class="hs-identifier hs-var">x</span></a></span></span><span> </span><span id="local-6989586621681353814"><span class="annot"><span class="annottext">Bool
</span><a href="#local-6989586621681353814"><span class="hs-identifier hs-var">flg</span></a></span></span><span> </span><span id="local-6989586621681353813"><span class="annot"><span class="annottext">LIdP GhcPs
</span><a href="#local-6989586621681353813"><span class="hs-identifier hs-var">rdr_name</span></a></span></span><span class="hs-special">)</span><span>
</span><span id="line-125"></span><span>  </span><span class="hs-glyph">=</span><span> </span><span class="hs-keyword">do</span><span> </span><span class="hs-special">{</span><span> </span><span id="local-6989586621681353812"><span class="annot"><span class="annottext">Name
</span><a href="#local-6989586621681353812"><span class="hs-identifier hs-var">name</span></a></span></span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">RdrName -&gt; RnM Name
</span><a href="GHC.Rename.Env.html#lookupOccRn"><span class="hs-identifier hs-var">lookupOccRn</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">forall l e. GenLocated l e -&gt; e
</span><a href="GHC.Types.SrcLoc.html#unLoc"><span class="hs-identifier hs-var">unLoc</span></a></span><span> </span><span class="annot"><span class="annottext">LIdP GhcPs
</span><a href="#local-6989586621681353813"><span class="hs-identifier hs-var">rdr_name</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-126"></span><span>       </span><span class="hs-special">;</span><span> </span><span id="local-6989586621681353809"><span class="annot"><span class="annottext">Module
</span><a href="#local-6989586621681353809"><span class="hs-identifier hs-var">this_mod</span></a></span></span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">forall (m :: * -&gt; *). HasModule m =&gt; m Module
</span><a href="GHC.Unit.Module.html#getModule"><span class="hs-identifier hs-var">getModule</span></a></span><span>
</span><span id="line-127"></span><span>
</span><span id="line-128"></span><span>       </span><span class="hs-special">;</span><span> </span><span class="annot"><span class="annottext">forall (f :: * -&gt; *). Applicative f =&gt; Bool -&gt; f () -&gt; f ()
</span><a href="../../base-4.16.4.0/src/GHC-Base.html#when"><span class="hs-identifier hs-var">when</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Bool
</span><a href="#local-6989586621681353814"><span class="hs-identifier hs-var">flg</span></a></span><span> </span><span class="annot"><span class="annottext">Bool -&gt; Bool -&gt; Bool
</span><span class="hs-operator hs-var">&amp;&amp;</span></span><span> </span><span class="annot"><span class="annottext">Module -&gt; Name -&gt; Bool
</span><a href="GHC.Types.Name.html#nameIsLocalOrFrom"><span class="hs-identifier hs-var">nameIsLocalOrFrom</span></a></span><span> </span><span class="annot"><span class="annottext">Module
</span><a href="#local-6989586621681353809"><span class="hs-identifier hs-var">this_mod</span></a></span><span> </span><span class="annot"><span class="annottext">Name
</span><a href="#local-6989586621681353812"><span class="hs-identifier hs-var">name</span></a></span><span class="hs-special">)</span><span> </span><span class="annot"><span class="annottext">forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><a href="../../base-4.16.4.0/src/GHC-Base.html#%24"><span class="hs-operator hs-var">$</span></a></span><span>
</span><span id="line-129"></span><span>             </span><span class="hs-comment">-- Type variables can be quoted in TH. See #5721.</span><span>
</span><span id="line-130"></span><span>                 </span><span class="hs-keyword">do</span><span> </span><span class="hs-special">{</span><span> </span><span id="local-6989586621681353805"><span class="annot"><span class="annottext">Maybe (TopLevelFlag, ThLevel)
</span><a href="#local-6989586621681353805"><span class="hs-identifier hs-var">mb_bind_lvl</span></a></span></span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">Name -&gt; RnM (Maybe (TopLevelFlag, ThLevel))
</span><a href="GHC.Rename.Env.html#lookupLocalOccThLvl_maybe"><span class="hs-identifier hs-var">lookupLocalOccThLvl_maybe</span></a></span><span> </span><span class="annot"><span class="annottext">Name
</span><a href="#local-6989586621681353812"><span class="hs-identifier hs-var">name</span></a></span><span>
</span><span id="line-131"></span><span>                    </span><span class="hs-special">;</span><span> </span><span class="hs-keyword">case</span><span> </span><span class="annot"><span class="annottext">Maybe (TopLevelFlag, ThLevel)
</span><a href="#local-6989586621681353805"><span class="hs-identifier hs-var">mb_bind_lvl</span></a></span><span> </span><span class="hs-keyword">of</span><span>
</span><span id="line-132"></span><span>                        </span><span class="hs-special">{</span><span> </span><span class="annot"><span class="annottext">Maybe (TopLevelFlag, ThLevel)
</span><a href="../../base-4.16.4.0/src/GHC-Maybe.html#Nothing"><span class="hs-identifier hs-var">Nothing</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="annottext">forall (m :: * -&gt; *) a. Monad m =&gt; a -&gt; m a
</span><a href="../../base-4.16.4.0/src/GHC-Base.html#return"><span class="hs-identifier hs-var">return</span></a></span><span> </span><span class="hs-special">(</span><span class="hs-special">)</span><span>      </span><span class="hs-comment">-- Can happen for data constructors,</span><span>
</span><span id="line-133"></span><span>                                                    </span><span class="hs-comment">-- but nothing needs to be done for them</span><span>
</span><span id="line-134"></span><span>
</span><span id="line-135"></span><span>                        </span><span class="hs-special">;</span><span> </span><span class="annot"><a href="../../base-4.16.4.0/src/GHC-Maybe.html#Just"><span class="hs-identifier hs-type">Just</span></a></span><span> </span><span class="hs-special">(</span><span id="local-6989586621681353803"><span class="annot"><span class="annottext">TopLevelFlag
</span><a href="#local-6989586621681353803"><span class="hs-identifier hs-var">top_lvl</span></a></span></span><span class="hs-special">,</span><span> </span><span id="local-6989586621681353802"><span class="annot"><span class="annottext">ThLevel
</span><a href="#local-6989586621681353802"><span class="hs-identifier hs-var">bind_lvl</span></a></span></span><span class="hs-special">)</span><span>  </span><span class="hs-comment">-- See Note [Quoting names]</span><span>
</span><span id="line-136"></span><span>                             </span><span class="hs-glyph">|</span><span> </span><span class="annot"><span class="annottext">TopLevelFlag -&gt; Bool
</span><a href="GHC.Types.Basic.html#isTopLevel"><span class="hs-identifier hs-var">isTopLevel</span></a></span><span> </span><span class="annot"><span class="annottext">TopLevelFlag
</span><a href="#local-6989586621681353803"><span class="hs-identifier hs-var">top_lvl</span></a></span><span>
</span><span id="line-137"></span><span>                             </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="annottext">forall (f :: * -&gt; *). Applicative f =&gt; Bool -&gt; f () -&gt; f ()
</span><a href="../../base-4.16.4.0/src/GHC-Base.html#when"><span class="hs-identifier hs-var">when</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Name -&gt; Bool
</span><a href="GHC.Types.Name.html#isExternalName"><span class="hs-identifier hs-var">isExternalName</span></a></span><span> </span><span class="annot"><span class="annottext">Name
</span><a href="#local-6989586621681353812"><span class="hs-identifier hs-var">name</span></a></span><span class="hs-special">)</span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Name -&gt; IOEnv (Env TcGblEnv TcLclEnv) ()
</span><a href="GHC.Tc.Utils.Monad.html#keepAlive"><span class="hs-identifier hs-var">keepAlive</span></a></span><span> </span><span class="annot"><span class="annottext">Name
</span><a href="#local-6989586621681353812"><span class="hs-identifier hs-var">name</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-138"></span><span>                             </span><span class="hs-glyph">|</span><span> </span><span class="annot"><span class="annottext">Bool
</span><a href="../../base-4.16.4.0/src/GHC-Base.html#otherwise"><span class="hs-identifier hs-var">otherwise</span></a></span><span>
</span><span id="line-139"></span><span>                             </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-keyword">do</span><span> </span><span class="hs-special">{</span><span> </span><span class="annot"><span class="annottext">String -&gt; SDoc -&gt; IOEnv (Env TcGblEnv TcLclEnv) ()
</span><a href="GHC.Tc.Utils.Monad.html#traceRn"><span class="hs-identifier hs-var">traceRn</span></a></span><span> </span><span class="annot"><span class="annottext">String
</span><span class="hs-string">&quot;rn_bracket VarBr&quot;</span></span><span>
</span><span id="line-140"></span><span>                                      </span><span class="hs-special">(</span><span class="annot"><span class="annottext">forall a. Outputable a =&gt; a -&gt; SDoc
</span><a href="GHC.Utils.Outputable.html#ppr"><span class="hs-identifier hs-var">ppr</span></a></span><span> </span><span class="annot"><span class="annottext">Name
</span><a href="#local-6989586621681353812"><span class="hs-identifier hs-var">name</span></a></span><span> </span><span class="annot"><span class="annottext">SDoc -&gt; SDoc -&gt; SDoc
</span><a href="GHC.Utils.Outputable.html#%3C%2B%3E"><span class="hs-operator hs-var">&lt;+&gt;</span></a></span><span> </span><span class="annot"><span class="annottext">forall a. Outputable a =&gt; a -&gt; SDoc
</span><a href="GHC.Utils.Outputable.html#ppr"><span class="hs-identifier hs-var">ppr</span></a></span><span> </span><span class="annot"><span class="annottext">ThLevel
</span><a href="#local-6989586621681353802"><span class="hs-identifier hs-var">bind_lvl</span></a></span><span>
</span><span id="line-141"></span><span>                                                </span><span class="annot"><span class="annottext">SDoc -&gt; SDoc -&gt; SDoc
</span><a href="GHC.Utils.Outputable.html#%3C%2B%3E"><span class="hs-operator hs-var">&lt;+&gt;</span></a></span><span> </span><span class="annot"><span class="annottext">forall a. Outputable a =&gt; a -&gt; SDoc
</span><a href="GHC.Utils.Outputable.html#ppr"><span class="hs-identifier hs-var">ppr</span></a></span><span> </span><span class="annot"><span class="annottext">ThStage
</span><a href="#local-6989586621681353818"><span class="hs-identifier hs-var">outer_stage</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-142"></span><span>                                   </span><span class="hs-special">;</span><span> </span><span class="annot"><span class="annottext">Bool -&gt; SDoc -&gt; IOEnv (Env TcGblEnv TcLclEnv) ()
</span><a href="GHC.Tc.Utils.Monad.html#checkTc"><span class="hs-identifier hs-var">checkTc</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">ThStage -&gt; ThLevel
</span><a href="GHC.Tc.Types.html#thLevel"><span class="hs-identifier hs-var">thLevel</span></a></span><span> </span><span class="annot"><span class="annottext">ThStage
</span><a href="#local-6989586621681353818"><span class="hs-identifier hs-var">outer_stage</span></a></span><span> </span><span class="annot"><span class="annottext">forall a. Num a =&gt; a -&gt; a -&gt; a
</span><a href="../../base-4.16.4.0/src/GHC-Num.html#%2B"><span class="hs-operator hs-var">+</span></a></span><span> </span><span class="annot"><span class="annottext">ThLevel
</span><span class="hs-number">1</span></span><span> </span><span class="annot"><span class="annottext">forall a. Eq a =&gt; a -&gt; a -&gt; Bool
</span><span class="hs-operator hs-var">==</span></span><span> </span><span class="annot"><span class="annottext">ThLevel
</span><a href="#local-6989586621681353802"><span class="hs-identifier hs-var">bind_lvl</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-143"></span><span>                                             </span><span class="hs-special">(</span><span class="annot"><span class="annottext">HsBracket GhcPs -&gt; SDoc
</span><a href="GHC.Rename.Splice.html#quotedNameStageErr"><span class="hs-identifier hs-var">quotedNameStageErr</span></a></span><span> </span><span class="annot"><span class="annottext">HsBracket GhcPs
</span><a href="#local-6989586621681353817"><span class="hs-identifier hs-var">br</span></a></span><span class="hs-special">)</span><span> </span><span class="hs-special">}</span><span>
</span><span id="line-144"></span><span>                        </span><span class="hs-special">}</span><span>
</span><span id="line-145"></span><span>                    </span><span class="hs-special">}</span><span>
</span><span id="line-146"></span><span>       </span><span class="hs-special">;</span><span> </span><span class="annot"><span class="annottext">forall (m :: * -&gt; *) a. Monad m =&gt; a -&gt; m a
</span><a href="../../base-4.16.4.0/src/GHC-Base.html#return"><span class="hs-identifier hs-var">return</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">forall p. XVarBr p -&gt; Bool -&gt; LIdP p -&gt; HsBracket p
</span><a href="Language.Haskell.Syntax.Expr.html#VarBr"><span class="hs-identifier hs-var">VarBr</span></a></span><span> </span><span class="annot"><span class="annottext">XVarBr GhcPs
</span><a href="#local-6989586621681353815"><span class="hs-identifier hs-var">x</span></a></span><span> </span><span class="annot"><span class="annottext">Bool
</span><a href="#local-6989586621681353814"><span class="hs-identifier hs-var">flg</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">forall a an. a -&gt; LocatedAn an a
</span><a href="GHC.Parser.Annotation.html#noLocA"><span class="hs-identifier hs-var">noLocA</span></a></span><span> </span><span class="annot"><span class="annottext">Name
</span><a href="#local-6989586621681353812"><span class="hs-identifier hs-var">name</span></a></span><span class="hs-special">)</span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">Name -&gt; Uses
</span><a href="GHC.Types.Name.Set.html#unitFV"><span class="hs-identifier hs-var">unitFV</span></a></span><span> </span><span class="annot"><span class="annottext">Name
</span><a href="#local-6989586621681353812"><span class="hs-identifier hs-var">name</span></a></span><span class="hs-special">)</span><span> </span><span class="hs-special">}</span><span>
</span><span id="line-147"></span><span>
</span><span id="line-148"></span><span class="annot"><a href="GHC.Rename.Splice.html#rn_bracket"><span class="hs-identifier hs-var">rn_bracket</span></a></span><span> </span><span class="annot"><span class="annottext">ThStage
</span><span class="hs-identifier">_</span></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="Language.Haskell.Syntax.Expr.html#ExpBr"><span class="hs-identifier hs-type">ExpBr</span></a></span><span> </span><span id="local-6989586621681353793"><span class="annot"><span class="annottext">XExpBr GhcPs
</span><a href="#local-6989586621681353793"><span class="hs-identifier hs-var">x</span></a></span></span><span> </span><span id="local-6989586621681353792"><span class="annot"><span class="annottext">LHsExpr GhcPs
</span><a href="#local-6989586621681353792"><span class="hs-identifier hs-var">e</span></a></span></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-keyword">do</span><span> </span><span class="hs-special">{</span><span> </span><span class="hs-special">(</span><span id="local-6989586621681353791"><span class="annot"><span class="annottext">GenLocated SrcSpanAnnA (HsExpr (GhcPass 'Renamed))
</span><a href="#local-6989586621681353791"><span class="hs-identifier hs-var">e'</span></a></span></span><span class="hs-special">,</span><span> </span><span id="local-6989586621681353790"><span class="annot"><span class="annottext">Uses
</span><a href="#local-6989586621681353790"><span class="hs-identifier hs-var">fvs</span></a></span></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">LHsExpr GhcPs -&gt; RnM (LHsExpr (GhcPass 'Renamed), Uses)
</span><a href="GHC.Rename.Expr.html#rnLExpr"><span class="hs-identifier hs-var">rnLExpr</span></a></span><span> </span><span class="annot"><span class="annottext">LHsExpr GhcPs
</span><a href="#local-6989586621681353792"><span class="hs-identifier hs-var">e</span></a></span><span>
</span><span id="line-149"></span><span>                            </span><span class="hs-special">;</span><span> </span><span class="annot"><span class="annottext">forall (m :: * -&gt; *) a. Monad m =&gt; a -&gt; m a
</span><a href="../../base-4.16.4.0/src/GHC-Base.html#return"><span class="hs-identifier hs-var">return</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">forall p. XExpBr p -&gt; LHsExpr p -&gt; HsBracket p
</span><a href="Language.Haskell.Syntax.Expr.html#ExpBr"><span class="hs-identifier hs-var">ExpBr</span></a></span><span> </span><span class="annot"><span class="annottext">XExpBr GhcPs
</span><a href="#local-6989586621681353793"><span class="hs-identifier hs-var">x</span></a></span><span> </span><span class="annot"><span class="annottext">GenLocated SrcSpanAnnA (HsExpr (GhcPass 'Renamed))
</span><a href="#local-6989586621681353791"><span class="hs-identifier hs-var">e'</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">Uses
</span><a href="#local-6989586621681353790"><span class="hs-identifier hs-var">fvs</span></a></span><span class="hs-special">)</span><span> </span><span class="hs-special">}</span><span>
</span><span id="line-150"></span><span>
</span><span id="line-151"></span><span class="annot"><a href="GHC.Rename.Splice.html#rn_bracket"><span class="hs-identifier hs-var">rn_bracket</span></a></span><span> </span><span class="annot"><span class="annottext">ThStage
</span><span class="hs-identifier">_</span></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="Language.Haskell.Syntax.Expr.html#PatBr"><span class="hs-identifier hs-type">PatBr</span></a></span><span> </span><span id="local-6989586621681353788"><span class="annot"><span class="annottext">XPatBr GhcPs
</span><a href="#local-6989586621681353788"><span class="hs-identifier hs-var">x</span></a></span></span><span> </span><span id="local-6989586621681353787"><span class="annot"><span class="annottext">LPat GhcPs
</span><a href="#local-6989586621681353787"><span class="hs-identifier hs-var">p</span></a></span></span><span class="hs-special">)</span><span>
</span><span id="line-152"></span><span>  </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">forall a.
HsMatchContext (GhcPass 'Renamed)
-&gt; LPat GhcPs
-&gt; (LPat (GhcPass 'Renamed) -&gt; RnM (a, Uses))
-&gt; RnM (a, Uses)
</span><a href="GHC.Rename.Pat.html#rnPat"><span class="hs-identifier hs-var">rnPat</span></a></span><span> </span><span class="annot"><span class="annottext">forall p. HsMatchContext p
</span><a href="Language.Haskell.Syntax.Expr.html#ThPatQuote"><span class="hs-identifier hs-var">ThPatQuote</span></a></span><span> </span><span class="annot"><span class="annottext">LPat GhcPs
</span><a href="#local-6989586621681353787"><span class="hs-identifier hs-var">p</span></a></span><span> </span><span class="annot"><span class="annottext">forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><a href="../../base-4.16.4.0/src/GHC-Base.html#%24"><span class="hs-operator hs-var">$</span></a></span><span> </span><span class="hs-glyph">\</span><span> </span><span id="local-6989586621681353785"><span class="annot"><span class="annottext">LPat (GhcPass 'Renamed)
</span><a href="#local-6989586621681353785"><span class="hs-identifier hs-var">p'</span></a></span></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="annottext">forall (m :: * -&gt; *) a. Monad m =&gt; a -&gt; m a
</span><a href="../../base-4.16.4.0/src/GHC-Base.html#return"><span class="hs-identifier hs-var">return</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">forall p. XPatBr p -&gt; LPat p -&gt; HsBracket p
</span><a href="Language.Haskell.Syntax.Expr.html#PatBr"><span class="hs-identifier hs-var">PatBr</span></a></span><span> </span><span class="annot"><span class="annottext">XPatBr GhcPs
</span><a href="#local-6989586621681353788"><span class="hs-identifier hs-var">x</span></a></span><span> </span><span class="annot"><span class="annottext">LPat (GhcPass 'Renamed)
</span><a href="#local-6989586621681353785"><span class="hs-identifier hs-var">p'</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">Uses
</span><a href="GHC.Types.Name.Set.html#emptyFVs"><span class="hs-identifier hs-var">emptyFVs</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-153"></span><span>
</span><span id="line-154"></span><span class="annot"><a href="GHC.Rename.Splice.html#rn_bracket"><span class="hs-identifier hs-var">rn_bracket</span></a></span><span> </span><span class="annot"><span class="annottext">ThStage
</span><span class="hs-identifier">_</span></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="Language.Haskell.Syntax.Expr.html#TypBr"><span class="hs-identifier hs-type">TypBr</span></a></span><span> </span><span id="local-6989586621681353782"><span class="annot"><span class="annottext">XTypBr GhcPs
</span><a href="#local-6989586621681353782"><span class="hs-identifier hs-var">x</span></a></span></span><span> </span><span id="local-6989586621681353781"><span class="annot"><span class="annottext">LHsType GhcPs
</span><a href="#local-6989586621681353781"><span class="hs-identifier hs-var">t</span></a></span></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-keyword">do</span><span> </span><span class="hs-special">{</span><span> </span><span class="hs-special">(</span><span id="local-6989586621681353780"><span class="annot"><span class="annottext">GenLocated SrcSpanAnnA (HsType (GhcPass 'Renamed))
</span><a href="#local-6989586621681353780"><span class="hs-identifier hs-var">t'</span></a></span></span><span class="hs-special">,</span><span> </span><span id="local-6989586621681353779"><span class="annot"><span class="annottext">Uses
</span><a href="#local-6989586621681353779"><span class="hs-identifier hs-var">fvs</span></a></span></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">HsDocContext
-&gt; LHsType GhcPs -&gt; RnM (LHsType (GhcPass 'Renamed), Uses)
</span><a href="GHC.Rename.HsType.html#rnLHsType"><span class="hs-identifier hs-var">rnLHsType</span></a></span><span> </span><span class="annot"><span class="annottext">HsDocContext
</span><a href="GHC.Rename.Utils.html#TypBrCtx"><span class="hs-identifier hs-var">TypBrCtx</span></a></span><span> </span><span class="annot"><span class="annottext">LHsType GhcPs
</span><a href="#local-6989586621681353781"><span class="hs-identifier hs-var">t</span></a></span><span>
</span><span id="line-155"></span><span>                              </span><span class="hs-special">;</span><span> </span><span class="annot"><span class="annottext">forall (m :: * -&gt; *) a. Monad m =&gt; a -&gt; m a
</span><a href="../../base-4.16.4.0/src/GHC-Base.html#return"><span class="hs-identifier hs-var">return</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">forall p. XTypBr p -&gt; LHsType p -&gt; HsBracket p
</span><a href="Language.Haskell.Syntax.Expr.html#TypBr"><span class="hs-identifier hs-var">TypBr</span></a></span><span> </span><span class="annot"><span class="annottext">XTypBr GhcPs
</span><a href="#local-6989586621681353782"><span class="hs-identifier hs-var">x</span></a></span><span> </span><span class="annot"><span class="annottext">GenLocated SrcSpanAnnA (HsType (GhcPass 'Renamed))
</span><a href="#local-6989586621681353780"><span class="hs-identifier hs-var">t'</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">Uses
</span><a href="#local-6989586621681353779"><span class="hs-identifier hs-var">fvs</span></a></span><span class="hs-special">)</span><span> </span><span class="hs-special">}</span><span>
</span><span id="line-156"></span><span>
</span><span id="line-157"></span><span class="annot"><a href="GHC.Rename.Splice.html#rn_bracket"><span class="hs-identifier hs-var">rn_bracket</span></a></span><span> </span><span class="annot"><span class="annottext">ThStage
</span><span class="hs-identifier">_</span></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="Language.Haskell.Syntax.Expr.html#DecBrL"><span class="hs-identifier hs-type">DecBrL</span></a></span><span> </span><span id="local-6989586621681353776"><span class="annot"><span class="annottext">XDecBrL GhcPs
</span><a href="#local-6989586621681353776"><span class="hs-identifier hs-var">x</span></a></span></span><span> </span><span id="local-6989586621681353775"><span class="annot"><span class="annottext">[LHsDecl GhcPs]
</span><a href="#local-6989586621681353775"><span class="hs-identifier hs-var">decls</span></a></span></span><span class="hs-special">)</span><span>
</span><span id="line-158"></span><span>  </span><span class="hs-glyph">=</span><span> </span><span class="hs-keyword">do</span><span> </span><span class="hs-special">{</span><span> </span><span id="local-6989586621681353774"><span class="annot"><span class="annottext">HsGroup GhcPs
</span><a href="#local-6989586621681353774"><span class="hs-identifier hs-var">group</span></a></span></span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">[LHsDecl GhcPs] -&gt; RnM (HsGroup GhcPs)
</span><a href="#local-6989586621681353773"><span class="hs-identifier hs-var">groupDecls</span></a></span><span> </span><span class="annot"><span class="annottext">[LHsDecl GhcPs]
</span><a href="#local-6989586621681353775"><span class="hs-identifier hs-var">decls</span></a></span><span>
</span><span id="line-159"></span><span>       </span><span class="hs-special">;</span><span> </span><span id="local-6989586621681353772"><span class="annot"><span class="annottext">TcGblEnv
</span><a href="#local-6989586621681353772"><span class="hs-identifier hs-var">gbl_env</span></a></span></span><span>  </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">forall gbl lcl. TcRnIf gbl lcl gbl
</span><a href="GHC.Tc.Utils.Monad.html#getGblEnv"><span class="hs-identifier hs-var">getGblEnv</span></a></span><span>
</span><span id="line-160"></span><span>       </span><span class="hs-special">;</span><span> </span><span class="hs-keyword">let</span><span> </span><span id="local-6989586621681353770"><span class="annot"><span class="annottext">new_gbl_env :: TcGblEnv
</span><a href="#local-6989586621681353770"><span class="hs-identifier hs-var hs-var">new_gbl_env</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">TcGblEnv
</span><a href="#local-6989586621681353772"><span class="hs-identifier hs-var">gbl_env</span></a></span><span> </span><span class="hs-special">{</span><span> </span><span class="annot"><span class="annottext">tcg_dus :: DefUses
</span><a href="GHC.Tc.Types.html#tcg_dus"><span class="hs-identifier hs-var">tcg_dus</span></a></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">DefUses
</span><a href="GHC.Types.Name.Set.html#emptyDUs"><span class="hs-identifier hs-var">emptyDUs</span></a></span><span> </span><span class="hs-special">}</span><span>
</span><span id="line-161"></span><span>                          </span><span class="hs-comment">-- The emptyDUs is so that we just collect uses for this</span><span>
</span><span id="line-162"></span><span>                          </span><span class="hs-comment">-- group alone in the call to rnSrcDecls below</span><span>
</span><span id="line-163"></span><span>       </span><span class="hs-special">;</span><span> </span><span class="hs-special">(</span><span id="local-6989586621681353767"><span class="annot"><span class="annottext">TcGblEnv
</span><a href="#local-6989586621681353767"><span class="hs-identifier hs-var">tcg_env</span></a></span></span><span class="hs-special">,</span><span> </span><span id="local-6989586621681353766"><span class="annot"><span class="annottext">HsGroup (GhcPass 'Renamed)
</span><a href="#local-6989586621681353766"><span class="hs-identifier hs-var">group'</span></a></span></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">forall gbl lcl a. gbl -&gt; TcRnIf gbl lcl a -&gt; TcRnIf gbl lcl a
</span><a href="GHC.Tc.Utils.Monad.html#setGblEnv"><span class="hs-identifier hs-var">setGblEnv</span></a></span><span> </span><span class="annot"><span class="annottext">TcGblEnv
</span><a href="#local-6989586621681353770"><span class="hs-identifier hs-var">new_gbl_env</span></a></span><span> </span><span class="annot"><span class="annottext">forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><a href="../../base-4.16.4.0/src/GHC-Base.html#%24"><span class="hs-operator hs-var">$</span></a></span><span>
</span><span id="line-164"></span><span>                              </span><span class="annot"><span class="annottext">HsGroup GhcPs
-&gt; TcRnIf TcGblEnv TcLclEnv (TcGblEnv, HsGroup (GhcPass 'Renamed))
</span><a href="GHC.Rename.Module.html#rnSrcDecls"><span class="hs-identifier hs-var">rnSrcDecls</span></a></span><span> </span><span class="annot"><span class="annottext">HsGroup GhcPs
</span><a href="#local-6989586621681353774"><span class="hs-identifier hs-var">group</span></a></span><span>
</span><span id="line-165"></span><span>
</span><span id="line-166"></span><span>              </span><span class="hs-comment">-- Discard the tcg_env; it contains only extra info about fixity</span><span>
</span><span id="line-167"></span><span>        </span><span class="hs-special">;</span><span> </span><span class="annot"><span class="annottext">String -&gt; SDoc -&gt; IOEnv (Env TcGblEnv TcLclEnv) ()
</span><a href="GHC.Tc.Utils.Monad.html#traceRn"><span class="hs-identifier hs-var">traceRn</span></a></span><span> </span><span class="annot"><span class="annottext">String
</span><span class="hs-string">&quot;rn_bracket dec&quot;</span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">forall a. Outputable a =&gt; a -&gt; SDoc
</span><a href="GHC.Utils.Outputable.html#ppr"><span class="hs-identifier hs-var">ppr</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">TcGblEnv -&gt; DefUses
</span><a href="GHC.Tc.Types.html#tcg_dus"><span class="hs-identifier hs-var">tcg_dus</span></a></span><span> </span><span class="annot"><span class="annottext">TcGblEnv
</span><a href="#local-6989586621681353767"><span class="hs-identifier hs-var">tcg_env</span></a></span><span class="hs-special">)</span><span> </span><span class="annot"><span class="annottext">SDoc -&gt; SDoc -&gt; SDoc
</span><a href="GHC.Utils.Outputable.html#%24%24"><span class="hs-operator hs-var">$$</span></a></span><span>
</span><span id="line-168"></span><span>                   </span><span class="annot"><span class="annottext">forall a. Outputable a =&gt; a -&gt; SDoc
</span><a href="GHC.Utils.Outputable.html#ppr"><span class="hs-identifier hs-var">ppr</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">DefUses -&gt; Uses
</span><a href="GHC.Types.Name.Set.html#duUses"><span class="hs-identifier hs-var">duUses</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">TcGblEnv -&gt; DefUses
</span><a href="GHC.Tc.Types.html#tcg_dus"><span class="hs-identifier hs-var">tcg_dus</span></a></span><span> </span><span class="annot"><span class="annottext">TcGblEnv
</span><a href="#local-6989586621681353767"><span class="hs-identifier hs-var">tcg_env</span></a></span><span class="hs-special">)</span><span class="hs-special">)</span><span class="hs-special">)</span><span>
</span><span id="line-169"></span><span>        </span><span class="hs-special">;</span><span> </span><span class="annot"><span class="annottext">forall (m :: * -&gt; *) a. Monad m =&gt; a -&gt; m a
</span><a href="../../base-4.16.4.0/src/GHC-Base.html#return"><span class="hs-identifier hs-var">return</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">forall p. XDecBrG p -&gt; HsGroup p -&gt; HsBracket p
</span><a href="Language.Haskell.Syntax.Expr.html#DecBrG"><span class="hs-identifier hs-var">DecBrG</span></a></span><span> </span><span class="annot"><span class="annottext">XDecBrL GhcPs
</span><a href="#local-6989586621681353776"><span class="hs-identifier hs-var">x</span></a></span><span> </span><span class="annot"><span class="annottext">HsGroup (GhcPass 'Renamed)
</span><a href="#local-6989586621681353766"><span class="hs-identifier hs-var">group'</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">DefUses -&gt; Uses
</span><a href="GHC.Types.Name.Set.html#duUses"><span class="hs-identifier hs-var">duUses</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">TcGblEnv -&gt; DefUses
</span><a href="GHC.Tc.Types.html#tcg_dus"><span class="hs-identifier hs-var">tcg_dus</span></a></span><span> </span><span class="annot"><span class="annottext">TcGblEnv
</span><a href="#local-6989586621681353767"><span class="hs-identifier hs-var">tcg_env</span></a></span><span class="hs-special">)</span><span class="hs-special">)</span><span> </span><span class="hs-special">}</span><span>
</span><span id="line-170"></span><span>  </span><span class="hs-keyword">where</span><span>
</span><span id="line-171"></span><span>    </span><span class="annot"><a href="#local-6989586621681353773"><span class="hs-identifier hs-type">groupDecls</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="hs-special">[</span><span class="annot"><a href="Language.Haskell.Syntax.Decls.html#LHsDecl"><span class="hs-identifier hs-type">LHsDecl</span></a></span><span> </span><span class="annot"><a href="GHC.Hs.Extension.html#GhcPs"><span class="hs-identifier hs-type">GhcPs</span></a></span><span class="hs-special">]</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="GHC.Tc.Types.html#RnM"><span class="hs-identifier hs-type">RnM</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="Language.Haskell.Syntax.Decls.html#HsGroup"><span class="hs-identifier hs-type">HsGroup</span></a></span><span> </span><span class="annot"><a href="GHC.Hs.Extension.html#GhcPs"><span class="hs-identifier hs-type">GhcPs</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-172"></span><span>    </span><span id="local-6989586621681353773"><span class="annot"><span class="annottext">groupDecls :: [LHsDecl GhcPs] -&gt; RnM (HsGroup GhcPs)
</span><a href="#local-6989586621681353773"><span class="hs-identifier hs-var hs-var">groupDecls</span></a></span></span><span> </span><span id="local-6989586621681353761"><span class="annot"><span class="annottext">[LHsDecl GhcPs]
</span><a href="#local-6989586621681353761"><span class="hs-identifier hs-var">decls</span></a></span></span><span>
</span><span id="line-173"></span><span>      </span><span class="hs-glyph">=</span><span> </span><span class="hs-keyword">do</span><span> </span><span class="hs-special">{</span><span> </span><span class="hs-special">(</span><span id="local-6989586621681353760"><span class="annot"><span class="annottext">HsGroup GhcPs
</span><a href="#local-6989586621681353760"><span class="hs-identifier hs-var">group</span></a></span></span><span class="hs-special">,</span><span> </span><span id="local-6989586621681353759"><span class="annot"><span class="annottext">Maybe (SpliceDecl GhcPs, [GenLocated SrcSpanAnnA (HsDecl GhcPs)])
</span><a href="#local-6989586621681353759"><span class="hs-identifier hs-var">mb_splice</span></a></span></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">[LHsDecl GhcPs]
-&gt; RnM (HsGroup GhcPs, Maybe (SpliceDecl GhcPs, [LHsDecl GhcPs]))
</span><a href="GHC.Rename.Module.html#findSplice"><span class="hs-identifier hs-var">findSplice</span></a></span><span> </span><span class="annot"><span class="annottext">[LHsDecl GhcPs]
</span><a href="#local-6989586621681353761"><span class="hs-identifier hs-var">decls</span></a></span><span>
</span><span id="line-174"></span><span>           </span><span class="hs-special">;</span><span> </span><span class="hs-keyword">case</span><span> </span><span class="annot"><span class="annottext">Maybe (SpliceDecl GhcPs, [GenLocated SrcSpanAnnA (HsDecl GhcPs)])
</span><a href="#local-6989586621681353759"><span class="hs-identifier hs-var">mb_splice</span></a></span><span> </span><span class="hs-keyword">of</span><span>
</span><span id="line-175"></span><span>           </span><span class="hs-special">{</span><span> </span><span class="annot"><span class="annottext">Maybe (SpliceDecl GhcPs, [GenLocated SrcSpanAnnA (HsDecl GhcPs)])
</span><a href="../../base-4.16.4.0/src/GHC-Maybe.html#Nothing"><span class="hs-identifier hs-var">Nothing</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="annottext">forall (m :: * -&gt; *) a. Monad m =&gt; a -&gt; m a
</span><a href="../../base-4.16.4.0/src/GHC-Base.html#return"><span class="hs-identifier hs-var">return</span></a></span><span> </span><span class="annot"><span class="annottext">HsGroup GhcPs
</span><a href="#local-6989586621681353760"><span class="hs-identifier hs-var">group</span></a></span><span>
</span><span id="line-176"></span><span>           </span><span class="hs-special">;</span><span> </span><span class="annot"><a href="../../base-4.16.4.0/src/GHC-Maybe.html#Just"><span class="hs-identifier hs-type">Just</span></a></span><span> </span><span class="hs-special">(</span><span id="local-6989586621681353758"><span class="annot"><span class="annottext">SpliceDecl GhcPs
</span><a href="#local-6989586621681353758"><span class="hs-identifier hs-var">splice</span></a></span></span><span class="hs-special">,</span><span> </span><span id="local-6989586621681353757"><span class="annot"><span class="annottext">[GenLocated SrcSpanAnnA (HsDecl GhcPs)]
</span><a href="#local-6989586621681353757"><span class="hs-identifier hs-var">rest</span></a></span></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">-&gt;</span><span>
</span><span id="line-177"></span><span>               </span><span class="hs-keyword">do</span><span> </span><span class="hs-special">{</span><span> </span><span id="local-6989586621681353756"><span class="annot"><span class="annottext">HsGroup GhcPs
</span><a href="#local-6989586621681353756"><span class="hs-identifier hs-var">group'</span></a></span></span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">[LHsDecl GhcPs] -&gt; RnM (HsGroup GhcPs)
</span><a href="#local-6989586621681353773"><span class="hs-identifier hs-var">groupDecls</span></a></span><span> </span><span class="annot"><span class="annottext">[GenLocated SrcSpanAnnA (HsDecl GhcPs)]
</span><a href="#local-6989586621681353757"><span class="hs-identifier hs-var">rest</span></a></span><span>
</span><span id="line-178"></span><span>                  </span><span class="hs-special">;</span><span> </span><span class="hs-keyword">let</span><span> </span><span id="local-6989586621681353755"><span class="annot"><span class="annottext">group'' :: HsGroup GhcPs
</span><a href="#local-6989586621681353755"><span class="hs-identifier hs-var hs-var">group''</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">forall (p :: Pass).
HsGroup (GhcPass p) -&gt; HsGroup (GhcPass p) -&gt; HsGroup (GhcPass p)
</span><a href="GHC.Hs.Decls.html#appendGroups"><span class="hs-identifier hs-var">appendGroups</span></a></span><span> </span><span class="annot"><span class="annottext">HsGroup GhcPs
</span><a href="#local-6989586621681353760"><span class="hs-identifier hs-var">group</span></a></span><span> </span><span class="annot"><span class="annottext">HsGroup GhcPs
</span><a href="#local-6989586621681353756"><span class="hs-identifier hs-var">group'</span></a></span><span>
</span><span id="line-179"></span><span>                  </span><span class="hs-special">;</span><span> </span><span class="annot"><span class="annottext">forall (m :: * -&gt; *) a. Monad m =&gt; a -&gt; m a
</span><a href="../../base-4.16.4.0/src/GHC-Base.html#return"><span class="hs-identifier hs-var">return</span></a></span><span> </span><span class="annot"><span class="annottext">HsGroup GhcPs
</span><a href="#local-6989586621681353755"><span class="hs-identifier hs-var">group''</span></a></span><span> </span><span class="hs-special">{</span><span> </span><span class="annot"><span class="annottext">hs_splcds :: [LSpliceDecl GhcPs]
</span><a href="Language.Haskell.Syntax.Decls.html#hs_splcds"><span class="hs-identifier hs-var">hs_splcds</span></a></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">forall a an. a -&gt; LocatedAn an a
</span><a href="GHC.Parser.Annotation.html#noLocA"><span class="hs-identifier hs-var">noLocA</span></a></span><span> </span><span class="annot"><span class="annottext">SpliceDecl GhcPs
</span><a href="#local-6989586621681353758"><span class="hs-identifier hs-var">splice</span></a></span><span> </span><span class="annot"><span class="annottext">forall a. a -&gt; [a] -&gt; [a]
</span><span class="hs-glyph hs-var">:</span></span><span> </span><span class="annot"><span class="annottext">forall p. HsGroup p -&gt; [LSpliceDecl p]
</span><a href="Language.Haskell.Syntax.Decls.html#hs_splcds"><span class="hs-identifier hs-var">hs_splcds</span></a></span><span> </span><span class="annot"><span class="annottext">HsGroup GhcPs
</span><a href="#local-6989586621681353756"><span class="hs-identifier hs-var">group'</span></a></span><span> </span><span class="hs-special">}</span><span>
</span><span id="line-180"></span><span>                  </span><span class="hs-special">}</span><span>
</span><span id="line-181"></span><span>           </span><span class="hs-special">}</span><span class="hs-special">}</span><span>
</span><span id="line-182"></span><span>
</span><span id="line-183"></span><span class="annot"><a href="GHC.Rename.Splice.html#rn_bracket"><span class="hs-identifier hs-var">rn_bracket</span></a></span><span> </span><span class="annot"><span class="annottext">ThStage
</span><span class="hs-identifier">_</span></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="Language.Haskell.Syntax.Expr.html#DecBrG"><span class="hs-identifier hs-type">DecBrG</span></a></span><span> </span><span class="hs-special">{</span><span class="hs-special">}</span><span class="hs-special">)</span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">forall a. String -&gt; a
</span><a href="GHC.Utils.Panic.Plain.html#panic"><span class="hs-identifier hs-var">panic</span></a></span><span> </span><span class="annot"><span class="annottext">String
</span><span class="hs-string">&quot;rn_bracket: unexpected DecBrG&quot;</span></span><span>
</span><span id="line-184"></span><span>
</span><span id="line-185"></span><span class="annot"><a href="GHC.Rename.Splice.html#rn_bracket"><span class="hs-identifier hs-var">rn_bracket</span></a></span><span> </span><span class="annot"><span class="annottext">ThStage
</span><span class="hs-identifier">_</span></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="Language.Haskell.Syntax.Expr.html#TExpBr"><span class="hs-identifier hs-type">TExpBr</span></a></span><span> </span><span id="local-6989586621681353750"><span class="annot"><span class="annottext">XTExpBr GhcPs
</span><a href="#local-6989586621681353750"><span class="hs-identifier hs-var">x</span></a></span></span><span> </span><span id="local-6989586621681353749"><span class="annot"><span class="annottext">LHsExpr GhcPs
</span><a href="#local-6989586621681353749"><span class="hs-identifier hs-var">e</span></a></span></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-keyword">do</span><span> </span><span class="hs-special">{</span><span> </span><span class="hs-special">(</span><span id="local-6989586621681353748"><span class="annot"><span class="annottext">GenLocated SrcSpanAnnA (HsExpr (GhcPass 'Renamed))
</span><a href="#local-6989586621681353748"><span class="hs-identifier hs-var">e'</span></a></span></span><span class="hs-special">,</span><span> </span><span id="local-6989586621681353747"><span class="annot"><span class="annottext">Uses
</span><a href="#local-6989586621681353747"><span class="hs-identifier hs-var">fvs</span></a></span></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">LHsExpr GhcPs -&gt; RnM (LHsExpr (GhcPass 'Renamed), Uses)
</span><a href="GHC.Rename.Expr.html#rnLExpr"><span class="hs-identifier hs-var">rnLExpr</span></a></span><span> </span><span class="annot"><span class="annottext">LHsExpr GhcPs
</span><a href="#local-6989586621681353749"><span class="hs-identifier hs-var">e</span></a></span><span>
</span><span id="line-186"></span><span>                               </span><span class="hs-special">;</span><span> </span><span class="annot"><span class="annottext">forall (m :: * -&gt; *) a. Monad m =&gt; a -&gt; m a
</span><a href="../../base-4.16.4.0/src/GHC-Base.html#return"><span class="hs-identifier hs-var">return</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">forall p. XTExpBr p -&gt; LHsExpr p -&gt; HsBracket p
</span><a href="Language.Haskell.Syntax.Expr.html#TExpBr"><span class="hs-identifier hs-var">TExpBr</span></a></span><span> </span><span class="annot"><span class="annottext">XTExpBr GhcPs
</span><a href="#local-6989586621681353750"><span class="hs-identifier hs-var">x</span></a></span><span> </span><span class="annot"><span class="annottext">GenLocated SrcSpanAnnA (HsExpr (GhcPass 'Renamed))
</span><a href="#local-6989586621681353748"><span class="hs-identifier hs-var">e'</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">Uses
</span><a href="#local-6989586621681353747"><span class="hs-identifier hs-var">fvs</span></a></span><span class="hs-special">)</span><span> </span><span class="hs-special">}</span><span>
</span><span id="line-187"></span><span>
</span><span id="line-188"></span><span class="annot"><a href="GHC.Rename.Splice.html#quotationCtxtDoc"><span class="hs-identifier hs-type">quotationCtxtDoc</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><a href="Language.Haskell.Syntax.Expr.html#HsBracket"><span class="hs-identifier hs-type">HsBracket</span></a></span><span> </span><span class="annot"><a href="GHC.Hs.Extension.html#GhcPs"><span class="hs-identifier hs-type">GhcPs</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="GHC.Utils.Outputable.html#SDoc"><span class="hs-identifier hs-type">SDoc</span></a></span><span>
</span><span id="line-189"></span><span id="quotationCtxtDoc"><span class="annot"><span class="annottext">quotationCtxtDoc :: HsBracket GhcPs -&gt; SDoc
</span><a href="GHC.Rename.Splice.html#quotationCtxtDoc"><span class="hs-identifier hs-var hs-var">quotationCtxtDoc</span></a></span></span><span> </span><span id="local-6989586621681353746"><span class="annot"><span class="annottext">HsBracket GhcPs
</span><a href="#local-6989586621681353746"><span class="hs-identifier hs-var">br_body</span></a></span></span><span>
</span><span id="line-190"></span><span>  </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">SDoc -&gt; ThLevel -&gt; SDoc -&gt; SDoc
</span><a href="GHC.Utils.Outputable.html#hang"><span class="hs-identifier hs-var">hang</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">String -&gt; SDoc
</span><a href="GHC.Utils.Outputable.html#text"><span class="hs-identifier hs-var">text</span></a></span><span> </span><span class="annot"><span class="annottext">String
</span><span class="hs-string">&quot;In the Template Haskell quotation&quot;</span></span><span class="hs-special">)</span><span>
</span><span id="line-191"></span><span>         </span><span class="annot"><span class="annottext">ThLevel
</span><span class="hs-number">2</span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">forall a. Outputable a =&gt; a -&gt; SDoc
</span><a href="GHC.Utils.Outputable.html#ppr"><span class="hs-identifier hs-var">ppr</span></a></span><span> </span><span class="annot"><span class="annottext">HsBracket GhcPs
</span><a href="#local-6989586621681353746"><span class="hs-identifier hs-var">br_body</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-192"></span><span>
</span><span id="line-193"></span><span class="annot"><a href="GHC.Rename.Splice.html#illegalBracket"><span class="hs-identifier hs-type">illegalBracket</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><a href="GHC.Utils.Outputable.html#SDoc"><span class="hs-identifier hs-type">SDoc</span></a></span><span>
</span><span id="line-194"></span><span id="illegalBracket"><span class="annot"><span class="annottext">illegalBracket :: SDoc
</span><a href="GHC.Rename.Splice.html#illegalBracket"><span class="hs-identifier hs-var hs-var">illegalBracket</span></a></span></span><span> </span><span class="hs-glyph">=</span><span>
</span><span id="line-195"></span><span>    </span><span class="annot"><span class="annottext">String -&gt; SDoc
</span><a href="GHC.Utils.Outputable.html#text"><span class="hs-identifier hs-var">text</span></a></span><span> </span><span class="annot"><span class="annottext">String
</span><span class="hs-string">&quot;Template Haskell brackets cannot be nested&quot;</span></span><span> </span><span class="annot"><span class="annottext">SDoc -&gt; SDoc -&gt; SDoc
</span><a href="GHC.Utils.Outputable.html#%3C%2B%3E"><span class="hs-operator hs-var">&lt;+&gt;</span></a></span><span>
</span><span id="line-196"></span><span>    </span><span class="annot"><span class="annottext">String -&gt; SDoc
</span><a href="GHC.Utils.Outputable.html#text"><span class="hs-identifier hs-var">text</span></a></span><span> </span><span class="annot"><span class="annottext">String
</span><span class="hs-string">&quot;(without intervening splices)&quot;</span></span><span>
</span><span id="line-197"></span><span>
</span><span id="line-198"></span><span class="annot"><a href="GHC.Rename.Splice.html#illegalTypedBracket"><span class="hs-identifier hs-type">illegalTypedBracket</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><a href="GHC.Utils.Outputable.html#SDoc"><span class="hs-identifier hs-type">SDoc</span></a></span><span>
</span><span id="line-199"></span><span id="illegalTypedBracket"><span class="annot"><span class="annottext">illegalTypedBracket :: SDoc
</span><a href="GHC.Rename.Splice.html#illegalTypedBracket"><span class="hs-identifier hs-var hs-var">illegalTypedBracket</span></a></span></span><span> </span><span class="hs-glyph">=</span><span>
</span><span id="line-200"></span><span>    </span><span class="annot"><span class="annottext">String -&gt; SDoc
</span><a href="GHC.Utils.Outputable.html#text"><span class="hs-identifier hs-var">text</span></a></span><span> </span><span class="annot"><span class="annottext">String
</span><span class="hs-string">&quot;Typed brackets may only appear in typed splices.&quot;</span></span><span>
</span><span id="line-201"></span><span>
</span><span id="line-202"></span><span class="annot"><a href="GHC.Rename.Splice.html#illegalUntypedBracket"><span class="hs-identifier hs-type">illegalUntypedBracket</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><a href="GHC.Utils.Outputable.html#SDoc"><span class="hs-identifier hs-type">SDoc</span></a></span><span>
</span><span id="line-203"></span><span id="illegalUntypedBracket"><span class="annot"><span class="annottext">illegalUntypedBracket :: SDoc
</span><a href="GHC.Rename.Splice.html#illegalUntypedBracket"><span class="hs-identifier hs-var hs-var">illegalUntypedBracket</span></a></span></span><span> </span><span class="hs-glyph">=</span><span>
</span><span id="line-204"></span><span>    </span><span class="annot"><span class="annottext">String -&gt; SDoc
</span><a href="GHC.Utils.Outputable.html#text"><span class="hs-identifier hs-var">text</span></a></span><span> </span><span class="annot"><span class="annottext">String
</span><span class="hs-string">&quot;Untyped brackets may only appear in untyped splices.&quot;</span></span><span>
</span><span id="line-205"></span><span>
</span><span id="line-206"></span><span class="annot"><a href="GHC.Rename.Splice.html#quotedNameStageErr"><span class="hs-identifier hs-type">quotedNameStageErr</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><a href="Language.Haskell.Syntax.Expr.html#HsBracket"><span class="hs-identifier hs-type">HsBracket</span></a></span><span> </span><span class="annot"><a href="GHC.Hs.Extension.html#GhcPs"><span class="hs-identifier hs-type">GhcPs</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="GHC.Utils.Outputable.html#SDoc"><span class="hs-identifier hs-type">SDoc</span></a></span><span>
</span><span id="line-207"></span><span id="quotedNameStageErr"><span class="annot"><span class="annottext">quotedNameStageErr :: HsBracket GhcPs -&gt; SDoc
</span><a href="GHC.Rename.Splice.html#quotedNameStageErr"><span class="hs-identifier hs-var hs-var">quotedNameStageErr</span></a></span></span><span> </span><span id="local-6989586621681353744"><span class="annot"><span class="annottext">HsBracket GhcPs
</span><a href="#local-6989586621681353744"><span class="hs-identifier hs-var">br</span></a></span></span><span>
</span><span id="line-208"></span><span>  </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">[SDoc] -&gt; SDoc
</span><a href="GHC.Utils.Outputable.html#sep"><span class="hs-identifier hs-var">sep</span></a></span><span> </span><span class="hs-special">[</span><span> </span><span class="annot"><span class="annottext">String -&gt; SDoc
</span><a href="GHC.Utils.Outputable.html#text"><span class="hs-identifier hs-var">text</span></a></span><span> </span><span class="annot"><span class="annottext">String
</span><span class="hs-string">&quot;Stage error: the non-top-level quoted name&quot;</span></span><span> </span><span class="annot"><span class="annottext">SDoc -&gt; SDoc -&gt; SDoc
</span><a href="GHC.Utils.Outputable.html#%3C%2B%3E"><span class="hs-operator hs-var">&lt;+&gt;</span></a></span><span> </span><span class="annot"><span class="annottext">forall a. Outputable a =&gt; a -&gt; SDoc
</span><a href="GHC.Utils.Outputable.html#ppr"><span class="hs-identifier hs-var">ppr</span></a></span><span> </span><span class="annot"><span class="annottext">HsBracket GhcPs
</span><a href="#local-6989586621681353744"><span class="hs-identifier hs-var">br</span></a></span><span>
</span><span id="line-209"></span><span>        </span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">String -&gt; SDoc
</span><a href="GHC.Utils.Outputable.html#text"><span class="hs-identifier hs-var">text</span></a></span><span> </span><span class="annot"><span class="annottext">String
</span><span class="hs-string">&quot;must be used at the same stage at which it is bound&quot;</span></span><span> </span><span class="hs-special">]</span><span>
</span><span id="line-210"></span><span>
</span><span id="line-211"></span><span>
</span><span id="line-212"></span><span class="hs-comment">{-
*********************************************************
*                                                      *
                Splices
*                                                      *
*********************************************************

Note [Free variables of typed splices]
~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~
Consider renaming this:
        f = ...
        h = ...$(thing &quot;f&quot;)...

where the splice is a *typed* splice.  The splice can expand into
literally anything, so when we do dependency analysis we must assume
that it might mention 'f'.  So we simply treat all locally-defined
names as mentioned by any splice.  This is terribly brutal, but I
don't see what else to do.  For example, it'll mean that every
locally-defined thing will appear to be used, so no unused-binding
warnings.  But if we miss the dependency, then we might typecheck 'h'
before 'f', and that will crash the type checker because 'f' isn't in
scope.

Currently, I'm not treating a splice as also mentioning every import,
which is a bit inconsistent -- but there are a lot of them.  We might
thereby get some bogus unused-import warnings, but we won't crash the
type checker.  Not very satisfactory really.

Note [Renamer errors]
~~~~~~~~~~~~~~~~~~~~~
It's important to wrap renamer calls in checkNoErrs, because the
renamer does not fail for out of scope variables etc. Instead it
returns a bogus term/type, so that it can report more than one error.
We don't want the type checker to see these bogus unbound variables.
-}</span><span>
</span><span id="line-247"></span><span>
</span><span id="line-248"></span><span id="local-6989586621681354239"><span class="annot"><a href="GHC.Rename.Splice.html#rnSpliceGen"><span class="hs-identifier hs-type">rnSpliceGen</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="hs-special">(</span><span class="annot"><a href="Language.Haskell.Syntax.Expr.html#HsSplice"><span class="hs-identifier hs-type">HsSplice</span></a></span><span> </span><span class="annot"><a href="GHC.Hs.Extension.html#GhcRn"><span class="hs-identifier hs-type">GhcRn</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="GHC.Tc.Types.html#RnM"><span class="hs-identifier hs-type">RnM</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="#local-6989586621681354239"><span class="hs-identifier hs-type">a</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><a href="GHC.Types.Name.Set.html#FreeVars"><span class="hs-identifier hs-type">FreeVars</span></a></span><span class="hs-special">)</span><span class="hs-special">)</span><span>
</span><span id="line-249"></span><span>                                            </span><span class="hs-comment">-- Outside brackets, run splice</span><span>
</span><span id="line-250"></span><span>            </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-special">(</span><span class="annot"><a href="Language.Haskell.Syntax.Expr.html#HsSplice"><span class="hs-identifier hs-type">HsSplice</span></a></span><span> </span><span class="annot"><a href="GHC.Hs.Extension.html#GhcRn"><span class="hs-identifier hs-type">GhcRn</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-special">(</span><span class="annot"><a href="GHC.Hs.Expr.html#PendingRnSplice"><span class="hs-identifier hs-type">PendingRnSplice</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><a href="#local-6989586621681354239"><span class="hs-identifier hs-type">a</span></a></span><span class="hs-special">)</span><span class="hs-special">)</span><span>
</span><span id="line-251"></span><span>                                            </span><span class="hs-comment">-- Inside brackets, make it pending</span><span>
</span><span id="line-252"></span><span>            </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="Language.Haskell.Syntax.Expr.html#HsSplice"><span class="hs-identifier hs-type">HsSplice</span></a></span><span> </span><span class="annot"><a href="GHC.Hs.Extension.html#GhcPs"><span class="hs-identifier hs-type">GhcPs</span></a></span><span>
</span><span id="line-253"></span><span>            </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="GHC.Tc.Types.html#RnM"><span class="hs-identifier hs-type">RnM</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="#local-6989586621681354239"><span class="hs-identifier hs-type">a</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><a href="GHC.Types.Name.Set.html#FreeVars"><span class="hs-identifier hs-type">FreeVars</span></a></span><span class="hs-special">)</span></span><span>
</span><span id="line-254"></span><span id="rnSpliceGen"><span class="annot"><span class="annottext">rnSpliceGen :: forall a.
(HsSplice (GhcPass 'Renamed) -&gt; RnM (a, Uses))
-&gt; (HsSplice (GhcPass 'Renamed) -&gt; (PendingRnSplice, a))
-&gt; HsSplice GhcPs
-&gt; RnM (a, Uses)
</span><a href="GHC.Rename.Splice.html#rnSpliceGen"><span class="hs-identifier hs-var hs-var">rnSpliceGen</span></a></span></span><span> </span><span id="local-6989586621681353728"><span class="annot"><span class="annottext">HsSplice (GhcPass 'Renamed) -&gt; RnM (a, Uses)
</span><a href="#local-6989586621681353728"><span class="hs-identifier hs-var">run_splice</span></a></span></span><span> </span><span id="local-6989586621681353727"><span class="annot"><span class="annottext">HsSplice (GhcPass 'Renamed) -&gt; (PendingRnSplice, a)
</span><a href="#local-6989586621681353727"><span class="hs-identifier hs-var">pend_splice</span></a></span></span><span> </span><span id="local-6989586621681353726"><span class="annot"><span class="annottext">HsSplice GhcPs
</span><a href="#local-6989586621681353726"><span class="hs-identifier hs-var">splice</span></a></span></span><span>
</span><span id="line-255"></span><span>  </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">forall a. SDoc -&gt; TcM a -&gt; TcM a
</span><a href="GHC.Tc.Utils.Monad.html#addErrCtxt"><span class="hs-identifier hs-var">addErrCtxt</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">HsSplice GhcPs -&gt; SDoc
</span><a href="GHC.Rename.Splice.html#spliceCtxt"><span class="hs-identifier hs-var">spliceCtxt</span></a></span><span> </span><span class="annot"><span class="annottext">HsSplice GhcPs
</span><a href="#local-6989586621681353726"><span class="hs-identifier hs-var">splice</span></a></span><span class="hs-special">)</span><span> </span><span class="annot"><span class="annottext">forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><a href="../../base-4.16.4.0/src/GHC-Base.html#%24"><span class="hs-operator hs-var">$</span></a></span><span> </span><span class="hs-keyword">do</span><span>
</span><span id="line-256"></span><span>    </span><span class="hs-special">{</span><span> </span><span id="local-6989586621681353724"><span class="annot"><span class="annottext">ThStage
</span><a href="#local-6989586621681353724"><span class="hs-identifier hs-var">stage</span></a></span></span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">TcM ThStage
</span><a href="GHC.Tc.Utils.Monad.html#getStage"><span class="hs-identifier hs-var">getStage</span></a></span><span>
</span><span id="line-257"></span><span>    </span><span class="hs-special">;</span><span> </span><span class="hs-keyword">case</span><span> </span><span class="annot"><span class="annottext">ThStage
</span><a href="#local-6989586621681353724"><span class="hs-identifier hs-var">stage</span></a></span><span> </span><span class="hs-keyword">of</span><span>
</span><span id="line-258"></span><span>        </span><span class="annot"><a href="GHC.Tc.Types.html#Brack"><span class="hs-identifier hs-type">Brack</span></a></span><span> </span><span id="local-6989586621681353723"><span class="annot"><span class="annottext">ThStage
</span><a href="#local-6989586621681353723"><span class="hs-identifier hs-var">pop_stage</span></a></span></span><span> </span><span class="annot"><span class="annottext">PendingStuff
</span><a href="GHC.Tc.Types.html#RnPendingTyped"><span class="hs-identifier hs-var">RnPendingTyped</span></a></span><span>
</span><span id="line-259"></span><span>          </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-keyword">do</span><span> </span><span class="hs-special">{</span><span> </span><span class="annot"><span class="annottext">Bool -&gt; SDoc -&gt; IOEnv (Env TcGblEnv TcLclEnv) ()
</span><a href="GHC.Tc.Utils.Monad.html#checkTc"><span class="hs-identifier hs-var">checkTc</span></a></span><span> </span><span class="annot"><span class="annottext">Bool
</span><a href="#local-6989586621681353722"><span class="hs-identifier hs-var">is_typed_splice</span></a></span><span> </span><span class="annot"><span class="annottext">SDoc
</span><a href="GHC.Rename.Splice.html#illegalUntypedSplice"><span class="hs-identifier hs-var">illegalUntypedSplice</span></a></span><span>
</span><span id="line-260"></span><span>                </span><span class="hs-special">;</span><span> </span><span class="hs-special">(</span><span id="local-6989586621681353720"><span class="annot"><span class="annottext">HsSplice (GhcPass 'Renamed)
</span><a href="#local-6989586621681353720"><span class="hs-identifier hs-var">splice'</span></a></span></span><span class="hs-special">,</span><span> </span><span id="local-6989586621681353719"><span class="annot"><span class="annottext">Uses
</span><a href="#local-6989586621681353719"><span class="hs-identifier hs-var">fvs</span></a></span></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">forall a. ThStage -&gt; TcM a -&gt; TcM a
</span><a href="GHC.Tc.Utils.Monad.html#setStage"><span class="hs-identifier hs-var">setStage</span></a></span><span> </span><span class="annot"><span class="annottext">ThStage
</span><a href="#local-6989586621681353723"><span class="hs-identifier hs-var">pop_stage</span></a></span><span> </span><span class="annot"><span class="annottext">forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><a href="../../base-4.16.4.0/src/GHC-Base.html#%24"><span class="hs-operator hs-var">$</span></a></span><span>
</span><span id="line-261"></span><span>                                    </span><span class="annot"><span class="annottext">HsSplice GhcPs -&gt; TcRn (HsSplice (GhcPass 'Renamed), Uses)
</span><a href="GHC.Rename.Splice.html#rnSplice"><span class="hs-identifier hs-var">rnSplice</span></a></span><span> </span><span class="annot"><span class="annottext">HsSplice GhcPs
</span><a href="#local-6989586621681353726"><span class="hs-identifier hs-var">splice</span></a></span><span>
</span><span id="line-262"></span><span>                </span><span class="hs-special">;</span><span> </span><span class="hs-keyword">let</span><span> </span><span class="hs-special">(</span><span id="local-6989586621681353717"><span class="annot"><span class="annottext">PendingRnSplice
</span><a href="#local-6989586621681353717"><span class="hs-identifier hs-var">_pending_splice</span></a></span></span><span class="hs-special">,</span><span> </span><span id="local-6989586621681353716"><span class="annot"><span class="annottext">a
</span><a href="#local-6989586621681353716"><span class="hs-identifier hs-var">result</span></a></span></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">HsSplice (GhcPass 'Renamed) -&gt; (PendingRnSplice, a)
</span><a href="#local-6989586621681353727"><span class="hs-identifier hs-var">pend_splice</span></a></span><span> </span><span class="annot"><span class="annottext">HsSplice (GhcPass 'Renamed)
</span><a href="#local-6989586621681353720"><span class="hs-identifier hs-var">splice'</span></a></span><span>
</span><span id="line-263"></span><span>                </span><span class="hs-special">;</span><span> </span><span class="annot"><span class="annottext">forall (m :: * -&gt; *) a. Monad m =&gt; a -&gt; m a
</span><a href="../../base-4.16.4.0/src/GHC-Base.html#return"><span class="hs-identifier hs-var">return</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">a
</span><a href="#local-6989586621681353716"><span class="hs-identifier hs-var">result</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">Uses
</span><a href="#local-6989586621681353719"><span class="hs-identifier hs-var">fvs</span></a></span><span class="hs-special">)</span><span> </span><span class="hs-special">}</span><span>
</span><span id="line-264"></span><span>
</span><span id="line-265"></span><span>        </span><span class="annot"><a href="GHC.Tc.Types.html#Brack"><span class="hs-identifier hs-type">Brack</span></a></span><span> </span><span id="local-6989586621681353715"><span class="annot"><span class="annottext">ThStage
</span><a href="#local-6989586621681353715"><span class="hs-identifier hs-var">pop_stage</span></a></span></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="GHC.Tc.Types.html#RnPendingUntyped"><span class="hs-identifier hs-type">RnPendingUntyped</span></a></span><span> </span><span id="local-6989586621681353714"><span class="annot"><span class="annottext">IORef [PendingRnSplice]
</span><a href="#local-6989586621681353714"><span class="hs-identifier hs-var">ps_var</span></a></span></span><span class="hs-special">)</span><span>
</span><span id="line-266"></span><span>          </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-keyword">do</span><span> </span><span class="hs-special">{</span><span> </span><span class="annot"><span class="annottext">Bool -&gt; SDoc -&gt; IOEnv (Env TcGblEnv TcLclEnv) ()
</span><a href="GHC.Tc.Utils.Monad.html#checkTc"><span class="hs-identifier hs-var">checkTc</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Bool -&gt; Bool
</span><span class="hs-identifier hs-var">not</span></span><span> </span><span class="annot"><span class="annottext">Bool
</span><a href="#local-6989586621681353722"><span class="hs-identifier hs-var">is_typed_splice</span></a></span><span class="hs-special">)</span><span> </span><span class="annot"><span class="annottext">SDoc
</span><a href="GHC.Rename.Splice.html#illegalTypedSplice"><span class="hs-identifier hs-var">illegalTypedSplice</span></a></span><span>
</span><span id="line-267"></span><span>                </span><span class="hs-special">;</span><span> </span><span class="hs-special">(</span><span id="local-6989586621681353712"><span class="annot"><span class="annottext">HsSplice (GhcPass 'Renamed)
</span><a href="#local-6989586621681353712"><span class="hs-identifier hs-var">splice'</span></a></span></span><span class="hs-special">,</span><span> </span><span id="local-6989586621681353711"><span class="annot"><span class="annottext">Uses
</span><a href="#local-6989586621681353711"><span class="hs-identifier hs-var">fvs</span></a></span></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">forall a. ThStage -&gt; TcM a -&gt; TcM a
</span><a href="GHC.Tc.Utils.Monad.html#setStage"><span class="hs-identifier hs-var">setStage</span></a></span><span> </span><span class="annot"><span class="annottext">ThStage
</span><a href="#local-6989586621681353715"><span class="hs-identifier hs-var">pop_stage</span></a></span><span> </span><span class="annot"><span class="annottext">forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><a href="../../base-4.16.4.0/src/GHC-Base.html#%24"><span class="hs-operator hs-var">$</span></a></span><span>
</span><span id="line-268"></span><span>                                    </span><span class="annot"><span class="annottext">HsSplice GhcPs -&gt; TcRn (HsSplice (GhcPass 'Renamed), Uses)
</span><a href="GHC.Rename.Splice.html#rnSplice"><span class="hs-identifier hs-var">rnSplice</span></a></span><span> </span><span class="annot"><span class="annottext">HsSplice GhcPs
</span><a href="#local-6989586621681353726"><span class="hs-identifier hs-var">splice</span></a></span><span>
</span><span id="line-269"></span><span>                </span><span class="hs-special">;</span><span> </span><span class="hs-keyword">let</span><span> </span><span class="hs-special">(</span><span id="local-6989586621681353710"><span class="annot"><span class="annottext">PendingRnSplice
</span><a href="#local-6989586621681353710"><span class="hs-identifier hs-var">pending_splice</span></a></span></span><span class="hs-special">,</span><span> </span><span id="local-6989586621681353709"><span class="annot"><span class="annottext">a
</span><a href="#local-6989586621681353709"><span class="hs-identifier hs-var">result</span></a></span></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">HsSplice (GhcPass 'Renamed) -&gt; (PendingRnSplice, a)
</span><a href="#local-6989586621681353727"><span class="hs-identifier hs-var">pend_splice</span></a></span><span> </span><span class="annot"><span class="annottext">HsSplice (GhcPass 'Renamed)
</span><a href="#local-6989586621681353712"><span class="hs-identifier hs-var">splice'</span></a></span><span>
</span><span id="line-270"></span><span>                </span><span class="hs-special">;</span><span> </span><span id="local-6989586621681353708"><span class="annot"><span class="annottext">[PendingRnSplice]
</span><a href="#local-6989586621681353708"><span class="hs-identifier hs-var">ps</span></a></span></span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">forall a env. IORef a -&gt; IOEnv env a
</span><a href="GHC.Data.IOEnv.html#readMutVar"><span class="hs-identifier hs-var">readMutVar</span></a></span><span> </span><span class="annot"><span class="annottext">IORef [PendingRnSplice]
</span><a href="#local-6989586621681353714"><span class="hs-identifier hs-var">ps_var</span></a></span><span>
</span><span id="line-271"></span><span>                </span><span class="hs-special">;</span><span> </span><span class="annot"><span class="annottext">forall a env. IORef a -&gt; a -&gt; IOEnv env ()
</span><a href="GHC.Data.IOEnv.html#writeMutVar"><span class="hs-identifier hs-var">writeMutVar</span></a></span><span> </span><span class="annot"><span class="annottext">IORef [PendingRnSplice]
</span><a href="#local-6989586621681353714"><span class="hs-identifier hs-var">ps_var</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">PendingRnSplice
</span><a href="#local-6989586621681353710"><span class="hs-identifier hs-var">pending_splice</span></a></span><span> </span><span class="annot"><span class="annottext">forall a. a -&gt; [a] -&gt; [a]
</span><span class="hs-glyph hs-var">:</span></span><span> </span><span class="annot"><span class="annottext">[PendingRnSplice]
</span><a href="#local-6989586621681353708"><span class="hs-identifier hs-var">ps</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-272"></span><span>                </span><span class="hs-special">;</span><span> </span><span class="annot"><span class="annottext">forall (m :: * -&gt; *) a. Monad m =&gt; a -&gt; m a
</span><a href="../../base-4.16.4.0/src/GHC-Base.html#return"><span class="hs-identifier hs-var">return</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">a
</span><a href="#local-6989586621681353709"><span class="hs-identifier hs-var">result</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">Uses
</span><a href="#local-6989586621681353711"><span class="hs-identifier hs-var">fvs</span></a></span><span class="hs-special">)</span><span> </span><span class="hs-special">}</span><span>
</span><span id="line-273"></span><span>
</span><span id="line-274"></span><span>        </span><span class="annot"><span class="annottext">ThStage
</span><span class="hs-identifier">_</span></span><span> </span><span class="hs-glyph">-&gt;</span><span>  </span><span class="hs-keyword">do</span><span> </span><span class="hs-special">{</span><span> </span><span class="annot"><span class="annottext">HsSplice GhcPs -&gt; IOEnv (Env TcGblEnv TcLclEnv) ()
</span><a href="GHC.Rename.Splice.html#checkTopSpliceAllowed"><span class="hs-identifier hs-var">checkTopSpliceAllowed</span></a></span><span> </span><span class="annot"><span class="annottext">HsSplice GhcPs
</span><a href="#local-6989586621681353726"><span class="hs-identifier hs-var">splice</span></a></span><span>
</span><span id="line-275"></span><span>                 </span><span class="hs-special">;</span><span> </span><span class="hs-special">(</span><span id="local-6989586621681353705"><span class="annot"><span class="annottext">HsSplice (GhcPass 'Renamed)
</span><a href="#local-6989586621681353705"><span class="hs-identifier hs-var">splice'</span></a></span></span><span class="hs-special">,</span><span> </span><span id="local-6989586621681353704"><span class="annot"><span class="annottext">Uses
</span><a href="#local-6989586621681353704"><span class="hs-identifier hs-var">fvs1</span></a></span></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">forall r. TcM r -&gt; TcM r
</span><a href="GHC.Tc.Utils.Monad.html#checkNoErrs"><span class="hs-identifier hs-var">checkNoErrs</span></a></span><span> </span><span class="annot"><span class="annottext">forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><a href="../../base-4.16.4.0/src/GHC-Base.html#%24"><span class="hs-operator hs-var">$</span></a></span><span>
</span><span id="line-276"></span><span>                                         </span><span class="annot"><span class="annottext">forall a. ThStage -&gt; TcM a -&gt; TcM a
</span><a href="GHC.Tc.Utils.Monad.html#setStage"><span class="hs-identifier hs-var">setStage</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">SpliceType -&gt; ThStage
</span><a href="GHC.Tc.Types.html#Splice"><span class="hs-identifier hs-var">Splice</span></a></span><span> </span><span class="annot"><span class="annottext">SpliceType
</span><a href="#local-6989586621681353702"><span class="hs-identifier hs-var">splice_type</span></a></span><span class="hs-special">)</span><span> </span><span class="annot"><span class="annottext">forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><a href="../../base-4.16.4.0/src/GHC-Base.html#%24"><span class="hs-operator hs-var">$</span></a></span><span>
</span><span id="line-277"></span><span>                                         </span><span class="annot"><span class="annottext">HsSplice GhcPs -&gt; TcRn (HsSplice (GhcPass 'Renamed), Uses)
</span><a href="GHC.Rename.Splice.html#rnSplice"><span class="hs-identifier hs-var">rnSplice</span></a></span><span> </span><span class="annot"><span class="annottext">HsSplice GhcPs
</span><a href="#local-6989586621681353726"><span class="hs-identifier hs-var">splice</span></a></span><span>
</span><span id="line-278"></span><span>                   </span><span class="hs-comment">-- checkNoErrs: don't attempt to run the splice if</span><span>
</span><span id="line-279"></span><span>                   </span><span class="hs-comment">-- renaming it failed; otherwise we get a cascade of</span><span>
</span><span id="line-280"></span><span>                   </span><span class="hs-comment">-- errors from e.g. unbound variables</span><span>
</span><span id="line-281"></span><span>                 </span><span class="hs-special">;</span><span> </span><span class="hs-special">(</span><span id="local-6989586621681353701"><span class="annot"><span class="annottext">a
</span><a href="#local-6989586621681353701"><span class="hs-identifier hs-var">result</span></a></span></span><span class="hs-special">,</span><span> </span><span id="local-6989586621681353700"><span class="annot"><span class="annottext">Uses
</span><a href="#local-6989586621681353700"><span class="hs-identifier hs-var">fvs2</span></a></span></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">HsSplice (GhcPass 'Renamed) -&gt; RnM (a, Uses)
</span><a href="#local-6989586621681353728"><span class="hs-identifier hs-var">run_splice</span></a></span><span> </span><span class="annot"><span class="annottext">HsSplice (GhcPass 'Renamed)
</span><a href="#local-6989586621681353705"><span class="hs-identifier hs-var">splice'</span></a></span><span>
</span><span id="line-282"></span><span>                 </span><span class="hs-special">;</span><span> </span><span class="annot"><span class="annottext">forall (m :: * -&gt; *) a. Monad m =&gt; a -&gt; m a
</span><a href="../../base-4.16.4.0/src/GHC-Base.html#return"><span class="hs-identifier hs-var">return</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">a
</span><a href="#local-6989586621681353701"><span class="hs-identifier hs-var">result</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">Uses
</span><a href="#local-6989586621681353704"><span class="hs-identifier hs-var">fvs1</span></a></span><span> </span><span class="annot"><span class="annottext">Uses -&gt; Uses -&gt; Uses
</span><a href="GHC.Types.Name.Set.html#plusFV"><span class="hs-operator hs-var">`plusFV`</span></a></span><span> </span><span class="annot"><span class="annottext">Uses
</span><a href="#local-6989586621681353700"><span class="hs-identifier hs-var">fvs2</span></a></span><span class="hs-special">)</span><span> </span><span class="hs-special">}</span><span> </span><span class="hs-special">}</span><span>
</span><span id="line-283"></span><span>   </span><span class="hs-keyword">where</span><span>
</span><span id="line-284"></span><span>     </span><span id="local-6989586621681353722"><span class="annot"><span class="annottext">is_typed_splice :: Bool
</span><a href="#local-6989586621681353722"><span class="hs-identifier hs-var hs-var">is_typed_splice</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">forall id. HsSplice id -&gt; Bool
</span><a href="Language.Haskell.Syntax.Expr.html#isTypedSplice"><span class="hs-identifier hs-var">isTypedSplice</span></a></span><span> </span><span class="annot"><span class="annottext">HsSplice GhcPs
</span><a href="#local-6989586621681353726"><span class="hs-identifier hs-var">splice</span></a></span><span>
</span><span id="line-285"></span><span>     </span><span id="local-6989586621681353702"><span class="annot"><span class="annottext">splice_type :: SpliceType
</span><a href="#local-6989586621681353702"><span class="hs-identifier hs-var hs-var">splice_type</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-keyword">if</span><span> </span><span class="annot"><span class="annottext">Bool
</span><a href="#local-6989586621681353722"><span class="hs-identifier hs-var">is_typed_splice</span></a></span><span>
</span><span id="line-286"></span><span>                   </span><span class="hs-keyword">then</span><span> </span><span class="annot"><span class="annottext">SpliceType
</span><a href="GHC.Tc.Types.html#Typed"><span class="hs-identifier hs-var">Typed</span></a></span><span>
</span><span id="line-287"></span><span>                   </span><span class="hs-keyword">else</span><span> </span><span class="annot"><span class="annottext">SpliceType
</span><a href="GHC.Tc.Types.html#Untyped"><span class="hs-identifier hs-var">Untyped</span></a></span><span>
</span><span id="line-288"></span><span>
</span><span id="line-289"></span><span>
</span><span id="line-290"></span><span class="hs-comment">-- Nested splices are fine without TemplateHaskell because they</span><span>
</span><span id="line-291"></span><span class="hs-comment">-- are not executed until the top-level splice is run.</span><span>
</span><span id="line-292"></span><span class="annot"><a href="GHC.Rename.Splice.html#checkTopSpliceAllowed"><span class="hs-identifier hs-type">checkTopSpliceAllowed</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><a href="Language.Haskell.Syntax.Expr.html#HsSplice"><span class="hs-identifier hs-type">HsSplice</span></a></span><span> </span><span class="annot"><a href="GHC.Hs.Extension.html#GhcPs"><span class="hs-identifier hs-type">GhcPs</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="GHC.Tc.Types.html#RnM"><span class="hs-identifier hs-type">RnM</span></a></span><span> </span><span class="hs-special">(</span><span class="hs-special">)</span><span>
</span><span id="line-293"></span><span id="checkTopSpliceAllowed"><span class="annot"><span class="annottext">checkTopSpliceAllowed :: HsSplice GhcPs -&gt; IOEnv (Env TcGblEnv TcLclEnv) ()
</span><a href="GHC.Rename.Splice.html#checkTopSpliceAllowed"><span class="hs-identifier hs-var hs-var">checkTopSpliceAllowed</span></a></span></span><span> </span><span id="local-6989586621681353697"><span class="annot"><span class="annottext">HsSplice GhcPs
</span><a href="#local-6989586621681353697"><span class="hs-identifier hs-var">splice</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-keyword">do</span><span>
</span><span id="line-294"></span><span>  </span><span class="hs-keyword">let</span><span> </span><span class="hs-special">(</span><span id="local-6989586621681353696"><span class="annot"><span class="annottext">String
</span><a href="#local-6989586621681353696"><span class="hs-identifier hs-var">herald</span></a></span></span><span class="hs-special">,</span><span> </span><span id="local-6989586621681353695"><span class="annot"><span class="annottext">Extension
</span><a href="#local-6989586621681353695"><span class="hs-identifier hs-var">ext</span></a></span></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">HsSplice GhcPs -&gt; (String, Extension)
</span><a href="#local-6989586621681353694"><span class="hs-identifier hs-var">spliceExtension</span></a></span><span> </span><span class="annot"><span class="annottext">HsSplice GhcPs
</span><a href="#local-6989586621681353697"><span class="hs-identifier hs-var">splice</span></a></span><span>
</span><span id="line-295"></span><span>  </span><span id="local-6989586621681353693"><span class="annot"><span class="annottext">Bool
</span><a href="#local-6989586621681353693"><span class="hs-identifier hs-var">extEnabled</span></a></span></span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">forall gbl lcl. Extension -&gt; TcRnIf gbl lcl Bool
</span><a href="GHC.Tc.Utils.Monad.html#xoptM"><span class="hs-identifier hs-var">xoptM</span></a></span><span> </span><span class="annot"><span class="annottext">Extension
</span><a href="#local-6989586621681353695"><span class="hs-identifier hs-var">ext</span></a></span><span>
</span><span id="line-296"></span><span>  </span><span class="annot"><span class="annottext">forall (f :: * -&gt; *). Applicative f =&gt; Bool -&gt; f () -&gt; f ()
</span><a href="../../base-4.16.4.0/src/Control-Monad.html#unless"><span class="hs-identifier hs-var">unless</span></a></span><span> </span><span class="annot"><span class="annottext">Bool
</span><a href="#local-6989586621681353693"><span class="hs-identifier hs-var">extEnabled</span></a></span><span>
</span><span id="line-297"></span><span>    </span><span class="hs-special">(</span><span class="annot"><span class="annottext">forall a. SDoc -&gt; TcRn a
</span><a href="GHC.Tc.Utils.Monad.html#failWith"><span class="hs-identifier hs-var">failWith</span></a></span><span> </span><span class="annot"><span class="annottext">forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><a href="../../base-4.16.4.0/src/GHC-Base.html#%24"><span class="hs-operator hs-var">$</span></a></span><span> </span><span class="annot"><span class="annottext">String -&gt; SDoc
</span><a href="GHC.Utils.Outputable.html#text"><span class="hs-identifier hs-var">text</span></a></span><span> </span><span class="annot"><span class="annottext">String
</span><a href="#local-6989586621681353696"><span class="hs-identifier hs-var">herald</span></a></span><span> </span><span class="annot"><span class="annottext">SDoc -&gt; SDoc -&gt; SDoc
</span><a href="GHC.Utils.Outputable.html#%3C%2B%3E"><span class="hs-operator hs-var">&lt;+&gt;</span></a></span><span> </span><span class="annot"><span class="annottext">String -&gt; SDoc
</span><a href="GHC.Utils.Outputable.html#text"><span class="hs-identifier hs-var">text</span></a></span><span> </span><span class="annot"><span class="annottext">String
</span><span class="hs-string">&quot;are not permitted without&quot;</span></span><span> </span><span class="annot"><span class="annottext">SDoc -&gt; SDoc -&gt; SDoc
</span><a href="GHC.Utils.Outputable.html#%3C%2B%3E"><span class="hs-operator hs-var">&lt;+&gt;</span></a></span><span> </span><span class="annot"><span class="annottext">forall a. Outputable a =&gt; a -&gt; SDoc
</span><a href="GHC.Utils.Outputable.html#ppr"><span class="hs-identifier hs-var">ppr</span></a></span><span> </span><span class="annot"><span class="annottext">Extension
</span><a href="#local-6989586621681353695"><span class="hs-identifier hs-var">ext</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-298"></span><span>  </span><span class="hs-keyword">where</span><span>
</span><span id="line-299"></span><span>     </span><span class="annot"><a href="#local-6989586621681353694"><span class="hs-identifier hs-type">spliceExtension</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><a href="Language.Haskell.Syntax.Expr.html#HsSplice"><span class="hs-identifier hs-type">HsSplice</span></a></span><span> </span><span class="annot"><a href="GHC.Hs.Extension.html#GhcPs"><span class="hs-identifier hs-type">GhcPs</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-special">(</span><span class="annot"><a href="../../base-4.16.4.0/src/GHC-Base.html#String"><span class="hs-identifier hs-type">String</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><span class="hs-identifier hs-type">LangExt.Extension</span></span><span class="hs-special">)</span><span>
</span><span id="line-300"></span><span>     </span><span id="local-6989586621681353694"><span class="annot"><span class="annottext">spliceExtension :: HsSplice GhcPs -&gt; (String, Extension)
</span><a href="#local-6989586621681353694"><span class="hs-identifier hs-var hs-var">spliceExtension</span></a></span></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="Language.Haskell.Syntax.Expr.html#HsQuasiQuote"><span class="hs-identifier hs-type">HsQuasiQuote</span></a></span><span> </span><span class="hs-special">{</span><span class="hs-special">}</span><span class="hs-special">)</span><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">String
</span><span class="hs-string">&quot;Quasi-quotes&quot;</span></span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">Extension
</span><span class="hs-identifier hs-var">LangExt.QuasiQuotes</span></span><span class="hs-special">)</span><span>
</span><span id="line-301"></span><span>     </span><span class="annot"><a href="#local-6989586621681353694"><span class="hs-identifier hs-var">spliceExtension</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="Language.Haskell.Syntax.Expr.html#HsTypedSplice"><span class="hs-identifier hs-type">HsTypedSplice</span></a></span><span> </span><span class="hs-special">{</span><span class="hs-special">}</span><span class="hs-special">)</span><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">String
</span><span class="hs-string">&quot;Top-level splices&quot;</span></span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">Extension
</span><span class="hs-identifier hs-var">LangExt.TemplateHaskell</span></span><span class="hs-special">)</span><span>
</span><span id="line-302"></span><span>     </span><span class="annot"><a href="#local-6989586621681353694"><span class="hs-identifier hs-var">spliceExtension</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="Language.Haskell.Syntax.Expr.html#HsUntypedSplice"><span class="hs-identifier hs-type">HsUntypedSplice</span></a></span><span> </span><span class="hs-special">{</span><span class="hs-special">}</span><span class="hs-special">)</span><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">String
</span><span class="hs-string">&quot;Top-level splices&quot;</span></span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">Extension
</span><span class="hs-identifier hs-var">LangExt.TemplateHaskell</span></span><span class="hs-special">)</span><span>
</span><span id="line-303"></span><span>     </span><span class="annot"><a href="#local-6989586621681353694"><span class="hs-identifier hs-var">spliceExtension</span></a></span><span> </span><span id="local-6989586621681353687"><span class="annot"><span class="annottext">s :: HsSplice GhcPs
</span><a href="#local-6989586621681353687"><span class="hs-identifier hs-var">s</span></a></span></span><span class="hs-glyph">@</span><span class="hs-special">(</span><span class="annot"><a href="Language.Haskell.Syntax.Expr.html#HsSpliced"><span class="hs-identifier hs-type">HsSpliced</span></a></span><span> </span><span class="hs-special">{</span><span class="hs-special">}</span><span class="hs-special">)</span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">forall a. HasCallStack =&gt; String -&gt; SDoc -&gt; a
</span><a href="GHC.Utils.Panic.html#pprPanic"><span class="hs-identifier hs-var">pprPanic</span></a></span><span> </span><span class="annot"><span class="annottext">String
</span><span class="hs-string">&quot;spliceExtension&quot;</span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">forall a. Outputable a =&gt; a -&gt; SDoc
</span><a href="GHC.Utils.Outputable.html#ppr"><span class="hs-identifier hs-var">ppr</span></a></span><span> </span><span class="annot"><span class="annottext">HsSplice GhcPs
</span><a href="#local-6989586621681353687"><span class="hs-identifier hs-var">s</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-304"></span><span>
</span><span id="line-305"></span><span class="hs-comment">------------------</span><span>
</span><span id="line-306"></span><span>
</span><span id="line-307"></span><span class="hs-comment">-- | Returns the result of running a splice and the modFinalizers collected</span><span>
</span><span id="line-308"></span><span class="hs-comment">-- during the execution.</span><span>
</span><span id="line-309"></span><span class="hs-comment">--</span><span>
</span><span id="line-310"></span><span class="hs-comment">-- See Note [Delaying modFinalizers in untyped splices].</span><span>
</span><span id="line-311"></span><span id="local-6989586621681354231"><span class="annot"><a href="GHC.Rename.Splice.html#runRnSplice"><span class="hs-identifier hs-type">runRnSplice</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><a href="Language.Haskell.Syntax.Expr.html#UntypedSpliceFlavour"><span class="hs-identifier hs-type">UntypedSpliceFlavour</span></a></span><span>
</span><span id="line-312"></span><span>            </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-special">(</span><span class="annot"><a href="Language.Haskell.Syntax.Expr.html#LHsExpr"><span class="hs-identifier hs-type">LHsExpr</span></a></span><span> </span><span class="annot"><a href="GHC.Hs.Extension.html#GhcTc"><span class="hs-identifier hs-type">GhcTc</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="GHC.Tc.Types.html#TcRn"><span class="hs-identifier hs-type">TcRn</span></a></span><span> </span><span class="annot"><a href="#local-6989586621681354231"><span class="hs-identifier hs-type">res</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-313"></span><span>            </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-special">(</span><span class="annot"><a href="#local-6989586621681354231"><span class="hs-identifier hs-type">res</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="GHC.Utils.Outputable.html#SDoc"><span class="hs-identifier hs-type">SDoc</span></a></span><span class="hs-special">)</span><span>    </span><span class="hs-comment">-- How to pretty-print res</span><span>
</span><span id="line-314"></span><span>                                </span><span class="hs-comment">-- Usually just ppr, but not for [Decl]</span><span>
</span><span id="line-315"></span><span>            </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="Language.Haskell.Syntax.Expr.html#HsSplice"><span class="hs-identifier hs-type">HsSplice</span></a></span><span> </span><span class="annot"><a href="GHC.Hs.Extension.html#GhcRn"><span class="hs-identifier hs-type">GhcRn</span></a></span><span>   </span><span class="hs-comment">-- Always untyped</span><span>
</span><span id="line-316"></span><span>            </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="GHC.Tc.Types.html#TcRn"><span class="hs-identifier hs-type">TcRn</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="#local-6989586621681354231"><span class="hs-identifier hs-type">res</span></a></span><span class="hs-special">,</span><span> </span><span class="hs-special">[</span><span class="annot"><a href="../../ghci-9.2.7/src/GHCi-RemoteTypes.html#ForeignRef"><span class="hs-identifier hs-type">ForeignRef</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="../../template-haskell-2.18.0.0/src/Language-Haskell-TH-Syntax.html#Q"><span class="hs-identifier hs-type">TH.Q</span></a></span><span> </span><span class="hs-special">(</span><span class="hs-special">)</span><span class="hs-special">)</span><span class="hs-special">]</span><span class="hs-special">)</span></span><span>
</span><span id="line-317"></span><span id="runRnSplice"><span class="annot"><span class="annottext">runRnSplice :: forall res.
UntypedSpliceFlavour
-&gt; (LHsExpr GhcTc -&gt; TcRn res)
-&gt; (res -&gt; SDoc)
-&gt; HsSplice (GhcPass 'Renamed)
-&gt; TcRn (res, [ForeignRef (Q ())])
</span><a href="GHC.Rename.Splice.html#runRnSplice"><span class="hs-identifier hs-var hs-var">runRnSplice</span></a></span></span><span> </span><span id="local-6989586621681353666"><span class="annot"><span class="annottext">UntypedSpliceFlavour
</span><a href="#local-6989586621681353666"><span class="hs-identifier hs-var">flavour</span></a></span></span><span> </span><span id="local-6989586621681353665"><span class="annot"><span class="annottext">LHsExpr GhcTc -&gt; TcRn res
</span><a href="#local-6989586621681353665"><span class="hs-identifier hs-var">run_meta</span></a></span></span><span> </span><span id="local-6989586621681353664"><span class="annot"><span class="annottext">res -&gt; SDoc
</span><a href="#local-6989586621681353664"><span class="hs-identifier hs-var">ppr_res</span></a></span></span><span> </span><span id="local-6989586621681353663"><span class="annot"><span class="annottext">HsSplice (GhcPass 'Renamed)
</span><a href="#local-6989586621681353663"><span class="hs-identifier hs-var">splice</span></a></span></span><span>
</span><span id="line-318"></span><span>  </span><span class="hs-glyph">=</span><span> </span><span class="hs-keyword">do</span><span> </span><span class="hs-special">{</span><span> </span><span id="local-6989586621681353662"><span class="annot"><span class="annottext">Hooks
</span><a href="#local-6989586621681353662"><span class="hs-identifier hs-var">hooks</span></a></span></span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">HscEnv -&gt; Hooks
</span><a href="GHC.Driver.Env.Types.html#hsc_hooks"><span class="hs-identifier hs-var">hsc_hooks</span></a></span><span> </span><span class="annot"><span class="annottext">forall (f :: * -&gt; *) a b. Functor f =&gt; (a -&gt; b) -&gt; f a -&gt; f b
</span><a href="../../base-4.16.4.0/src/Data-Functor.html#%3C%24%3E"><span class="hs-operator hs-var">&lt;$&gt;</span></a></span><span> </span><span class="annot"><span class="annottext">forall gbl lcl. TcRnIf gbl lcl HscEnv
</span><a href="GHC.Tc.Utils.Monad.html#getTopEnv"><span class="hs-identifier hs-var">getTopEnv</span></a></span><span>
</span><span id="line-319"></span><span>       </span><span class="hs-special">;</span><span> </span><span id="local-6989586621681353658"><span class="annot"><span class="annottext">HsSplice (GhcPass 'Renamed)
</span><a href="#local-6989586621681353658"><span class="hs-identifier hs-var">splice'</span></a></span></span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="hs-keyword">case</span><span> </span><span class="annot"><span class="annottext">Hooks
-&gt; Maybe
     (HsSplice (GhcPass 'Renamed)
      -&gt; IOEnv (Env TcGblEnv TcLclEnv) (HsSplice (GhcPass 'Renamed)))
</span><a href="GHC.Driver.Hooks.html#runRnSpliceHook"><span class="hs-identifier hs-var">runRnSpliceHook</span></a></span><span> </span><span class="annot"><span class="annottext">Hooks
</span><a href="#local-6989586621681353662"><span class="hs-identifier hs-var">hooks</span></a></span><span> </span><span class="hs-keyword">of</span><span>
</span><span id="line-320"></span><span>            </span><span class="annot"><span class="annottext">Maybe
  (HsSplice (GhcPass 'Renamed)
   -&gt; IOEnv (Env TcGblEnv TcLclEnv) (HsSplice (GhcPass 'Renamed)))
</span><a href="../../base-4.16.4.0/src/GHC-Maybe.html#Nothing"><span class="hs-identifier hs-var">Nothing</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="annottext">forall (m :: * -&gt; *) a. Monad m =&gt; a -&gt; m a
</span><a href="../../base-4.16.4.0/src/GHC-Base.html#return"><span class="hs-identifier hs-var">return</span></a></span><span> </span><span class="annot"><span class="annottext">HsSplice (GhcPass 'Renamed)
</span><a href="#local-6989586621681353663"><span class="hs-identifier hs-var">splice</span></a></span><span>
</span><span id="line-321"></span><span>            </span><span class="annot"><a href="../../base-4.16.4.0/src/GHC-Maybe.html#Just"><span class="hs-identifier hs-type">Just</span></a></span><span> </span><span id="local-6989586621681353656"><span class="annot"><span class="annottext">HsSplice (GhcPass 'Renamed)
-&gt; IOEnv (Env TcGblEnv TcLclEnv) (HsSplice (GhcPass 'Renamed))
</span><a href="#local-6989586621681353656"><span class="hs-identifier hs-var">h</span></a></span></span><span>  </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="annottext">HsSplice (GhcPass 'Renamed)
-&gt; IOEnv (Env TcGblEnv TcLclEnv) (HsSplice (GhcPass 'Renamed))
</span><a href="#local-6989586621681353656"><span class="hs-identifier hs-var">h</span></a></span><span> </span><span class="annot"><span class="annottext">HsSplice (GhcPass 'Renamed)
</span><a href="#local-6989586621681353663"><span class="hs-identifier hs-var">splice</span></a></span><span>
</span><span id="line-322"></span><span>
</span><span id="line-323"></span><span>       </span><span class="hs-special">;</span><span> </span><span class="hs-keyword">let</span><span> </span><span id="local-6989586621681353655"><span class="annot"><span class="annottext">the_expr :: LHsExpr (GhcPass 'Renamed)
</span><a href="#local-6989586621681353655"><span class="hs-identifier hs-var hs-var">the_expr</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-keyword">case</span><span> </span><span class="annot"><span class="annottext">HsSplice (GhcPass 'Renamed)
</span><a href="#local-6989586621681353658"><span class="hs-identifier hs-var">splice'</span></a></span><span> </span><span class="hs-keyword">of</span><span>
</span><span id="line-324"></span><span>                </span><span class="annot"><a href="Language.Haskell.Syntax.Expr.html#HsUntypedSplice"><span class="hs-identifier hs-type">HsUntypedSplice</span></a></span><span> </span><span class="annot"><span class="annottext">XUntypedSplice (GhcPass 'Renamed)
</span><span class="hs-identifier">_</span></span><span> </span><span class="annot"><span class="annottext">SpliceDecoration
</span><span class="hs-identifier">_</span></span><span> </span><span class="annot"><span class="annottext">IdP (GhcPass 'Renamed)
</span><span class="hs-identifier">_</span></span><span> </span><span id="local-6989586621681353654"><span class="annot"><span class="annottext">LHsExpr (GhcPass 'Renamed)
</span><a href="#local-6989586621681353654"><span class="hs-identifier hs-var">e</span></a></span></span><span>   </span><span class="hs-glyph">-&gt;</span><span>  </span><span class="annot"><span class="annottext">LHsExpr (GhcPass 'Renamed)
</span><a href="#local-6989586621681353654"><span class="hs-identifier hs-var">e</span></a></span><span>
</span><span id="line-325"></span><span>                </span><span class="annot"><a href="Language.Haskell.Syntax.Expr.html#HsQuasiQuote"><span class="hs-identifier hs-type">HsQuasiQuote</span></a></span><span> </span><span class="annot"><span class="annottext">XQuasiQuote (GhcPass 'Renamed)
</span><span class="hs-identifier">_</span></span><span> </span><span class="annot"><span class="annottext">IdP (GhcPass 'Renamed)
</span><span class="hs-identifier">_</span></span><span> </span><span id="local-6989586621681353653"><span class="annot"><span class="annottext">IdP (GhcPass 'Renamed)
</span><a href="#local-6989586621681353653"><span class="hs-identifier hs-var">q</span></a></span></span><span> </span><span id="local-6989586621681353652"><span class="annot"><span class="annottext">SrcSpan
</span><a href="#local-6989586621681353652"><span class="hs-identifier hs-var">qs</span></a></span></span><span> </span><span id="local-6989586621681353651"><span class="annot"><span class="annottext">FastString
</span><a href="#local-6989586621681353651"><span class="hs-identifier hs-var">str</span></a></span></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="annottext">UntypedSpliceFlavour
-&gt; Name -&gt; SrcSpan -&gt; FastString -&gt; LHsExpr (GhcPass 'Renamed)
</span><a href="GHC.Rename.Splice.html#mkQuasiQuoteExpr"><span class="hs-identifier hs-var">mkQuasiQuoteExpr</span></a></span><span> </span><span class="annot"><span class="annottext">UntypedSpliceFlavour
</span><a href="#local-6989586621681353666"><span class="hs-identifier hs-var">flavour</span></a></span><span> </span><span class="annot"><span class="annottext">IdP (GhcPass 'Renamed)
</span><a href="#local-6989586621681353653"><span class="hs-identifier hs-var">q</span></a></span><span> </span><span class="annot"><span class="annottext">SrcSpan
</span><a href="#local-6989586621681353652"><span class="hs-identifier hs-var">qs</span></a></span><span> </span><span class="annot"><span class="annottext">FastString
</span><a href="#local-6989586621681353651"><span class="hs-identifier hs-var">str</span></a></span><span>
</span><span id="line-326"></span><span>                </span><span class="annot"><a href="Language.Haskell.Syntax.Expr.html#HsTypedSplice"><span class="hs-identifier hs-type">HsTypedSplice</span></a></span><span> </span><span class="hs-special">{</span><span class="hs-special">}</span><span>          </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="annottext">forall a. HasCallStack =&gt; String -&gt; SDoc -&gt; a
</span><a href="GHC.Utils.Panic.html#pprPanic"><span class="hs-identifier hs-var">pprPanic</span></a></span><span> </span><span class="annot"><span class="annottext">String
</span><span class="hs-string">&quot;runRnSplice&quot;</span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">forall a. Outputable a =&gt; a -&gt; SDoc
</span><a href="GHC.Utils.Outputable.html#ppr"><span class="hs-identifier hs-var">ppr</span></a></span><span> </span><span class="annot"><span class="annottext">HsSplice (GhcPass 'Renamed)
</span><a href="#local-6989586621681353663"><span class="hs-identifier hs-var">splice</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-327"></span><span>                </span><span class="annot"><a href="Language.Haskell.Syntax.Expr.html#HsSpliced"><span class="hs-identifier hs-type">HsSpliced</span></a></span><span> </span><span class="hs-special">{</span><span class="hs-special">}</span><span>              </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="annottext">forall a. HasCallStack =&gt; String -&gt; SDoc -&gt; a
</span><a href="GHC.Utils.Panic.html#pprPanic"><span class="hs-identifier hs-var">pprPanic</span></a></span><span> </span><span class="annot"><span class="annottext">String
</span><span class="hs-string">&quot;runRnSplice&quot;</span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">forall a. Outputable a =&gt; a -&gt; SDoc
</span><a href="GHC.Utils.Outputable.html#ppr"><span class="hs-identifier hs-var">ppr</span></a></span><span> </span><span class="annot"><span class="annottext">HsSplice (GhcPass 'Renamed)
</span><a href="#local-6989586621681353663"><span class="hs-identifier hs-var">splice</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-328"></span><span>
</span><span id="line-329"></span><span>             </span><span class="hs-comment">-- Typecheck the expression</span><span>
</span><span id="line-330"></span><span>       </span><span class="hs-special">;</span><span> </span><span id="local-6989586621681353649"><span class="annot"><span class="annottext">Type
</span><a href="#local-6989586621681353649"><span class="hs-identifier hs-var">meta_exp_ty</span></a></span></span><span>   </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">Name -&gt; TcM Type
</span><a href="GHC.Tc.Utils.Env.html#tcMetaTy"><span class="hs-identifier hs-var">tcMetaTy</span></a></span><span> </span><span class="annot"><span class="annottext">Name
</span><a href="#local-6989586621681353648"><span class="hs-identifier hs-var">meta_ty_name</span></a></span><span>
</span><span id="line-331"></span><span>       </span><span class="hs-special">;</span><span> </span><span id="local-6989586621681353647"><span class="annot"><span class="annottext">GenLocated SrcSpanAnnA (HsExpr GhcTc)
</span><a href="#local-6989586621681353647"><span class="hs-identifier hs-var">zonked_q_expr</span></a></span></span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">LHsExpr GhcTc -&gt; TcM (LHsExpr GhcTc)
</span><a href="GHC.Tc.Utils.Zonk.html#zonkTopLExpr"><span class="hs-identifier hs-var">zonkTopLExpr</span></a></span><span> </span><span class="annot"><span class="annottext">forall (m :: * -&gt; *) a b. Monad m =&gt; (a -&gt; m b) -&gt; m a -&gt; m b
</span><a href="../../base-4.16.4.0/src/GHC-Base.html#%3D%3C%3C"><span class="hs-operator hs-var">=&lt;&lt;</span></a></span><span>
</span><span id="line-332"></span><span>                            </span><span class="annot"><span class="annottext">SpliceType -&gt; TcM (LHsExpr GhcTc) -&gt; TcM (LHsExpr GhcTc)
</span><a href="GHC.Tc.Gen.Splice.html#tcTopSpliceExpr"><span class="hs-identifier hs-var">tcTopSpliceExpr</span></a></span><span> </span><span class="annot"><span class="annottext">SpliceType
</span><a href="GHC.Tc.Types.html#Untyped"><span class="hs-identifier hs-var">Untyped</span></a></span><span>
</span><span id="line-333"></span><span>                              </span><span class="hs-special">(</span><span class="annot"><span class="annottext">LHsExpr (GhcPass 'Renamed) -&gt; Type -&gt; TcM (LHsExpr GhcTc)
</span><a href="GHC.Tc.Gen.Expr.html#tcCheckPolyExpr"><span class="hs-identifier hs-var">tcCheckPolyExpr</span></a></span><span> </span><span class="annot"><span class="annottext">LHsExpr (GhcPass 'Renamed)
</span><a href="#local-6989586621681353655"><span class="hs-identifier hs-var">the_expr</span></a></span><span> </span><span class="annot"><span class="annottext">Type
</span><a href="#local-6989586621681353649"><span class="hs-identifier hs-var">meta_exp_ty</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-334"></span><span>
</span><span id="line-335"></span><span>             </span><span class="hs-comment">-- Run the expression</span><span>
</span><span id="line-336"></span><span>       </span><span class="hs-special">;</span><span> </span><span id="local-6989586621681353644"><span class="annot"><span class="annottext">TcRef [ForeignRef (Q ())]
</span><a href="#local-6989586621681353644"><span class="hs-identifier hs-var">mod_finalizers_ref</span></a></span></span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">forall a gbl lcl. a -&gt; TcRnIf gbl lcl (TcRef a)
</span><a href="GHC.Tc.Utils.Monad.html#newTcRef"><span class="hs-identifier hs-var">newTcRef</span></a></span><span> </span><span class="hs-special">[</span><span class="hs-special">]</span><span>
</span><span id="line-337"></span><span>       </span><span class="hs-special">;</span><span> </span><span id="local-6989586621681353642"><span class="annot"><span class="annottext">res
</span><a href="#local-6989586621681353642"><span class="hs-identifier hs-var">result</span></a></span></span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">forall a. ThStage -&gt; TcM a -&gt; TcM a
</span><a href="GHC.Tc.Utils.Monad.html#setStage"><span class="hs-identifier hs-var">setStage</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">TcRef [ForeignRef (Q ())] -&gt; ThStage
</span><a href="GHC.Tc.Types.html#RunSplice"><span class="hs-identifier hs-var">RunSplice</span></a></span><span> </span><span class="annot"><span class="annottext">TcRef [ForeignRef (Q ())]
</span><a href="#local-6989586621681353644"><span class="hs-identifier hs-var">mod_finalizers_ref</span></a></span><span class="hs-special">)</span><span> </span><span class="annot"><span class="annottext">forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><a href="../../base-4.16.4.0/src/GHC-Base.html#%24"><span class="hs-operator hs-var">$</span></a></span><span>
</span><span id="line-338"></span><span>                     </span><span class="annot"><span class="annottext">LHsExpr GhcTc -&gt; TcRn res
</span><a href="#local-6989586621681353665"><span class="hs-identifier hs-var">run_meta</span></a></span><span> </span><span class="annot"><span class="annottext">GenLocated SrcSpanAnnA (HsExpr GhcTc)
</span><a href="#local-6989586621681353647"><span class="hs-identifier hs-var">zonked_q_expr</span></a></span><span>
</span><span id="line-339"></span><span>       </span><span class="hs-special">;</span><span> </span><span id="local-6989586621681353641"><span class="annot"><span class="annottext">[ForeignRef (Q ())]
</span><a href="#local-6989586621681353641"><span class="hs-identifier hs-var">mod_finalizers</span></a></span></span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">forall a gbl lcl. TcRef a -&gt; TcRnIf gbl lcl a
</span><a href="GHC.Tc.Utils.Monad.html#readTcRef"><span class="hs-identifier hs-var">readTcRef</span></a></span><span> </span><span class="annot"><span class="annottext">TcRef [ForeignRef (Q ())]
</span><a href="#local-6989586621681353644"><span class="hs-identifier hs-var">mod_finalizers_ref</span></a></span><span>
</span><span id="line-340"></span><span>       </span><span class="hs-special">;</span><span> </span><span class="annot"><span class="annottext">SpliceInfo -&gt; IOEnv (Env TcGblEnv TcLclEnv) ()
</span><a href="GHC.Rename.Splice.html#traceSplice"><span class="hs-identifier hs-var">traceSplice</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="GHC.Rename.Splice.html#SpliceInfo"><span class="hs-identifier hs-type">SpliceInfo</span></a></span><span> </span><span class="hs-special">{</span><span> </span><span class="annot"><span class="annottext">spliceDescription :: String
</span><a href="GHC.Rename.Splice.html#spliceDescription"><span class="hs-identifier hs-var">spliceDescription</span></a></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">String
</span><a href="#local-6989586621681353637"><span class="hs-identifier hs-var">what</span></a></span><span>
</span><span id="line-341"></span><span>                                 </span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">spliceIsDecl :: Bool
</span><a href="GHC.Rename.Splice.html#spliceIsDecl"><span class="hs-identifier hs-var">spliceIsDecl</span></a></span><span>      </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">Bool
</span><a href="#local-6989586621681353635"><span class="hs-identifier hs-var">is_decl</span></a></span><span>
</span><span id="line-342"></span><span>                                 </span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">spliceSource :: Maybe (LHsExpr (GhcPass 'Renamed))
</span><a href="GHC.Rename.Splice.html#spliceSource"><span class="hs-identifier hs-var">spliceSource</span></a></span><span>      </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">forall a. a -&gt; Maybe a
</span><a href="../../base-4.16.4.0/src/GHC-Maybe.html#Just"><span class="hs-identifier hs-var">Just</span></a></span><span> </span><span class="annot"><span class="annottext">LHsExpr (GhcPass 'Renamed)
</span><a href="#local-6989586621681353655"><span class="hs-identifier hs-var">the_expr</span></a></span><span>
</span><span id="line-343"></span><span>                                 </span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">spliceGenerated :: SDoc
</span><a href="GHC.Rename.Splice.html#spliceGenerated"><span class="hs-identifier hs-var">spliceGenerated</span></a></span><span>   </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">res -&gt; SDoc
</span><a href="#local-6989586621681353664"><span class="hs-identifier hs-var">ppr_res</span></a></span><span> </span><span class="annot"><span class="annottext">res
</span><a href="#local-6989586621681353642"><span class="hs-identifier hs-var">result</span></a></span><span> </span><span class="hs-special">}</span><span class="hs-special">)</span><span>
</span><span id="line-344"></span><span>
</span><span id="line-345"></span><span>       </span><span class="hs-special">;</span><span> </span><span class="annot"><span class="annottext">forall (m :: * -&gt; *) a. Monad m =&gt; a -&gt; m a
</span><a href="../../base-4.16.4.0/src/GHC-Base.html#return"><span class="hs-identifier hs-var">return</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">res
</span><a href="#local-6989586621681353642"><span class="hs-identifier hs-var">result</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">[ForeignRef (Q ())]
</span><a href="#local-6989586621681353641"><span class="hs-identifier hs-var">mod_finalizers</span></a></span><span class="hs-special">)</span><span> </span><span class="hs-special">}</span><span>
</span><span id="line-346"></span><span>
</span><span id="line-347"></span><span>  </span><span class="hs-keyword">where</span><span>
</span><span id="line-348"></span><span>    </span><span id="local-6989586621681353648"><span class="annot"><span class="annottext">meta_ty_name :: Name
</span><a href="#local-6989586621681353648"><span class="hs-identifier hs-var hs-var">meta_ty_name</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-keyword">case</span><span> </span><span class="annot"><span class="annottext">UntypedSpliceFlavour
</span><a href="#local-6989586621681353666"><span class="hs-identifier hs-var">flavour</span></a></span><span> </span><span class="hs-keyword">of</span><span>
</span><span id="line-349"></span><span>                       </span><span class="annot"><span class="annottext">UntypedSpliceFlavour
</span><a href="Language.Haskell.Syntax.Expr.html#UntypedExpSplice"><span class="hs-identifier hs-var">UntypedExpSplice</span></a></span><span>  </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="annottext">Name
</span><a href="GHC.Builtin.Names.TH.html#expQTyConName"><span class="hs-identifier hs-var">expQTyConName</span></a></span><span>
</span><span id="line-350"></span><span>                       </span><span class="annot"><span class="annottext">UntypedSpliceFlavour
</span><a href="Language.Haskell.Syntax.Expr.html#UntypedPatSplice"><span class="hs-identifier hs-var">UntypedPatSplice</span></a></span><span>  </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="annottext">Name
</span><a href="GHC.Builtin.Names.TH.html#patQTyConName"><span class="hs-identifier hs-var">patQTyConName</span></a></span><span>
</span><span id="line-351"></span><span>                       </span><span class="annot"><span class="annottext">UntypedSpliceFlavour
</span><a href="Language.Haskell.Syntax.Expr.html#UntypedTypeSplice"><span class="hs-identifier hs-var">UntypedTypeSplice</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="annottext">Name
</span><a href="GHC.Builtin.Names.TH.html#typeQTyConName"><span class="hs-identifier hs-var">typeQTyConName</span></a></span><span>
</span><span id="line-352"></span><span>                       </span><span class="annot"><span class="annottext">UntypedSpliceFlavour
</span><a href="Language.Haskell.Syntax.Expr.html#UntypedDeclSplice"><span class="hs-identifier hs-var">UntypedDeclSplice</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="annottext">Name
</span><a href="GHC.Builtin.Names.TH.html#decsQTyConName"><span class="hs-identifier hs-var">decsQTyConName</span></a></span><span>
</span><span id="line-353"></span><span>    </span><span id="local-6989586621681353637"><span class="annot"><span class="annottext">what :: String
</span><a href="#local-6989586621681353637"><span class="hs-identifier hs-var hs-var">what</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-keyword">case</span><span> </span><span class="annot"><span class="annottext">UntypedSpliceFlavour
</span><a href="#local-6989586621681353666"><span class="hs-identifier hs-var">flavour</span></a></span><span> </span><span class="hs-keyword">of</span><span>
</span><span id="line-354"></span><span>                  </span><span class="annot"><span class="annottext">UntypedSpliceFlavour
</span><a href="Language.Haskell.Syntax.Expr.html#UntypedExpSplice"><span class="hs-identifier hs-var">UntypedExpSplice</span></a></span><span>  </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="annottext">String
</span><span class="hs-string">&quot;expression&quot;</span></span><span>
</span><span id="line-355"></span><span>                  </span><span class="annot"><span class="annottext">UntypedSpliceFlavour
</span><a href="Language.Haskell.Syntax.Expr.html#UntypedPatSplice"><span class="hs-identifier hs-var">UntypedPatSplice</span></a></span><span>  </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="annottext">String
</span><span class="hs-string">&quot;pattern&quot;</span></span><span>
</span><span id="line-356"></span><span>                  </span><span class="annot"><span class="annottext">UntypedSpliceFlavour
</span><a href="Language.Haskell.Syntax.Expr.html#UntypedTypeSplice"><span class="hs-identifier hs-var">UntypedTypeSplice</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="annottext">String
</span><span class="hs-string">&quot;type&quot;</span></span><span>
</span><span id="line-357"></span><span>                  </span><span class="annot"><span class="annottext">UntypedSpliceFlavour
</span><a href="Language.Haskell.Syntax.Expr.html#UntypedDeclSplice"><span class="hs-identifier hs-var">UntypedDeclSplice</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="annottext">String
</span><span class="hs-string">&quot;declarations&quot;</span></span><span>
</span><span id="line-358"></span><span>    </span><span id="local-6989586621681353635"><span class="annot"><span class="annottext">is_decl :: Bool
</span><a href="#local-6989586621681353635"><span class="hs-identifier hs-var hs-var">is_decl</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-keyword">case</span><span> </span><span class="annot"><span class="annottext">UntypedSpliceFlavour
</span><a href="#local-6989586621681353666"><span class="hs-identifier hs-var">flavour</span></a></span><span> </span><span class="hs-keyword">of</span><span>
</span><span id="line-359"></span><span>                 </span><span class="annot"><span class="annottext">UntypedSpliceFlavour
</span><a href="Language.Haskell.Syntax.Expr.html#UntypedDeclSplice"><span class="hs-identifier hs-var">UntypedDeclSplice</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="annottext">Bool
</span><span class="hs-identifier hs-var">True</span></span><span>
</span><span id="line-360"></span><span>                 </span><span class="annot"><span class="annottext">UntypedSpliceFlavour
</span><span class="hs-identifier">_</span></span><span>                 </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="annottext">Bool
</span><span class="hs-identifier hs-var">False</span></span><span>
</span><span id="line-361"></span><span>
</span><span id="line-362"></span><span class="hs-comment">------------------</span><span>
</span><span id="line-363"></span><span class="annot"><a href="GHC.Rename.Splice.html#makePending"><span class="hs-identifier hs-type">makePending</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><a href="Language.Haskell.Syntax.Expr.html#UntypedSpliceFlavour"><span class="hs-identifier hs-type">UntypedSpliceFlavour</span></a></span><span>
</span><span id="line-364"></span><span>            </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="Language.Haskell.Syntax.Expr.html#HsSplice"><span class="hs-identifier hs-type">HsSplice</span></a></span><span> </span><span class="annot"><a href="GHC.Hs.Extension.html#GhcRn"><span class="hs-identifier hs-type">GhcRn</span></a></span><span>
</span><span id="line-365"></span><span>            </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="GHC.Hs.Expr.html#PendingRnSplice"><span class="hs-identifier hs-type">PendingRnSplice</span></a></span><span>
</span><span id="line-366"></span><span id="makePending"><span class="annot"><span class="annottext">makePending :: UntypedSpliceFlavour
-&gt; HsSplice (GhcPass 'Renamed) -&gt; PendingRnSplice
</span><a href="GHC.Rename.Splice.html#makePending"><span class="hs-identifier hs-var hs-var">makePending</span></a></span></span><span> </span><span id="local-6989586621681353627"><span class="annot"><span class="annottext">UntypedSpliceFlavour
</span><a href="#local-6989586621681353627"><span class="hs-identifier hs-var">flavour</span></a></span></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="Language.Haskell.Syntax.Expr.html#HsUntypedSplice"><span class="hs-identifier hs-type">HsUntypedSplice</span></a></span><span> </span><span class="annot"><span class="annottext">XUntypedSplice (GhcPass 'Renamed)
</span><span class="hs-identifier">_</span></span><span> </span><span class="annot"><span class="annottext">SpliceDecoration
</span><span class="hs-identifier">_</span></span><span> </span><span id="local-6989586621681353626"><span class="annot"><span class="annottext">IdP (GhcPass 'Renamed)
</span><a href="#local-6989586621681353626"><span class="hs-identifier hs-var">n</span></a></span></span><span> </span><span id="local-6989586621681353625"><span class="annot"><span class="annottext">LHsExpr (GhcPass 'Renamed)
</span><a href="#local-6989586621681353625"><span class="hs-identifier hs-var">e</span></a></span></span><span class="hs-special">)</span><span>
</span><span id="line-367"></span><span>  </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">UntypedSpliceFlavour
-&gt; Name -&gt; LHsExpr (GhcPass 'Renamed) -&gt; PendingRnSplice
</span><a href="GHC.Hs.Expr.html#PendingRnSplice"><span class="hs-identifier hs-var">PendingRnSplice</span></a></span><span> </span><span class="annot"><span class="annottext">UntypedSpliceFlavour
</span><a href="#local-6989586621681353627"><span class="hs-identifier hs-var">flavour</span></a></span><span> </span><span class="annot"><span class="annottext">IdP (GhcPass 'Renamed)
</span><a href="#local-6989586621681353626"><span class="hs-identifier hs-var">n</span></a></span><span> </span><span class="annot"><span class="annottext">LHsExpr (GhcPass 'Renamed)
</span><a href="#local-6989586621681353625"><span class="hs-identifier hs-var">e</span></a></span><span>
</span><span id="line-368"></span><span class="annot"><a href="GHC.Rename.Splice.html#makePending"><span class="hs-identifier hs-var">makePending</span></a></span><span> </span><span id="local-6989586621681353623"><span class="annot"><span class="annottext">UntypedSpliceFlavour
</span><a href="#local-6989586621681353623"><span class="hs-identifier hs-var">flavour</span></a></span></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="Language.Haskell.Syntax.Expr.html#HsQuasiQuote"><span class="hs-identifier hs-type">HsQuasiQuote</span></a></span><span> </span><span class="annot"><span class="annottext">XQuasiQuote (GhcPass 'Renamed)
</span><span class="hs-identifier">_</span></span><span> </span><span id="local-6989586621681353622"><span class="annot"><span class="annottext">IdP (GhcPass 'Renamed)
</span><a href="#local-6989586621681353622"><span class="hs-identifier hs-var">n</span></a></span></span><span> </span><span id="local-6989586621681353621"><span class="annot"><span class="annottext">IdP (GhcPass 'Renamed)
</span><a href="#local-6989586621681353621"><span class="hs-identifier hs-var">quoter</span></a></span></span><span> </span><span id="local-6989586621681353620"><span class="annot"><span class="annottext">SrcSpan
</span><a href="#local-6989586621681353620"><span class="hs-identifier hs-var">q_span</span></a></span></span><span> </span><span id="local-6989586621681353619"><span class="annot"><span class="annottext">FastString
</span><a href="#local-6989586621681353619"><span class="hs-identifier hs-var">quote</span></a></span></span><span class="hs-special">)</span><span>
</span><span id="line-369"></span><span>  </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">UntypedSpliceFlavour
-&gt; Name -&gt; LHsExpr (GhcPass 'Renamed) -&gt; PendingRnSplice
</span><a href="GHC.Hs.Expr.html#PendingRnSplice"><span class="hs-identifier hs-var">PendingRnSplice</span></a></span><span> </span><span class="annot"><span class="annottext">UntypedSpliceFlavour
</span><a href="#local-6989586621681353623"><span class="hs-identifier hs-var">flavour</span></a></span><span> </span><span class="annot"><span class="annottext">IdP (GhcPass 'Renamed)
</span><a href="#local-6989586621681353622"><span class="hs-identifier hs-var">n</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">UntypedSpliceFlavour
-&gt; Name -&gt; SrcSpan -&gt; FastString -&gt; LHsExpr (GhcPass 'Renamed)
</span><a href="GHC.Rename.Splice.html#mkQuasiQuoteExpr"><span class="hs-identifier hs-var">mkQuasiQuoteExpr</span></a></span><span> </span><span class="annot"><span class="annottext">UntypedSpliceFlavour
</span><a href="#local-6989586621681353623"><span class="hs-identifier hs-var">flavour</span></a></span><span> </span><span class="annot"><span class="annottext">IdP (GhcPass 'Renamed)
</span><a href="#local-6989586621681353621"><span class="hs-identifier hs-var">quoter</span></a></span><span> </span><span class="annot"><span class="annottext">SrcSpan
</span><a href="#local-6989586621681353620"><span class="hs-identifier hs-var">q_span</span></a></span><span> </span><span class="annot"><span class="annottext">FastString
</span><a href="#local-6989586621681353619"><span class="hs-identifier hs-var">quote</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-370"></span><span class="annot"><a href="GHC.Rename.Splice.html#makePending"><span class="hs-identifier hs-var">makePending</span></a></span><span> </span><span class="annot"><span class="annottext">UntypedSpliceFlavour
</span><span class="hs-identifier">_</span></span><span> </span><span id="local-6989586621681353618"><span class="annot"><span class="annottext">splice :: HsSplice (GhcPass 'Renamed)
</span><a href="#local-6989586621681353618"><span class="hs-identifier hs-var">splice</span></a></span></span><span class="hs-glyph">@</span><span class="hs-special">(</span><span class="annot"><a href="Language.Haskell.Syntax.Expr.html#HsTypedSplice"><span class="hs-identifier hs-type">HsTypedSplice</span></a></span><span> </span><span class="hs-special">{</span><span class="hs-special">}</span><span class="hs-special">)</span><span>
</span><span id="line-371"></span><span>  </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">forall a. HasCallStack =&gt; String -&gt; SDoc -&gt; a
</span><a href="GHC.Utils.Panic.html#pprPanic"><span class="hs-identifier hs-var">pprPanic</span></a></span><span> </span><span class="annot"><span class="annottext">String
</span><span class="hs-string">&quot;makePending&quot;</span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">forall a. Outputable a =&gt; a -&gt; SDoc
</span><a href="GHC.Utils.Outputable.html#ppr"><span class="hs-identifier hs-var">ppr</span></a></span><span> </span><span class="annot"><span class="annottext">HsSplice (GhcPass 'Renamed)
</span><a href="#local-6989586621681353618"><span class="hs-identifier hs-var">splice</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-372"></span><span class="annot"><a href="GHC.Rename.Splice.html#makePending"><span class="hs-identifier hs-var">makePending</span></a></span><span> </span><span class="annot"><span class="annottext">UntypedSpliceFlavour
</span><span class="hs-identifier">_</span></span><span> </span><span id="local-6989586621681353617"><span class="annot"><span class="annottext">splice :: HsSplice (GhcPass 'Renamed)
</span><a href="#local-6989586621681353617"><span class="hs-identifier hs-var">splice</span></a></span></span><span class="hs-glyph">@</span><span class="hs-special">(</span><span class="annot"><a href="Language.Haskell.Syntax.Expr.html#HsSpliced"><span class="hs-identifier hs-type">HsSpliced</span></a></span><span> </span><span class="hs-special">{</span><span class="hs-special">}</span><span class="hs-special">)</span><span>
</span><span id="line-373"></span><span>  </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">forall a. HasCallStack =&gt; String -&gt; SDoc -&gt; a
</span><a href="GHC.Utils.Panic.html#pprPanic"><span class="hs-identifier hs-var">pprPanic</span></a></span><span> </span><span class="annot"><span class="annottext">String
</span><span class="hs-string">&quot;makePending&quot;</span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">forall a. Outputable a =&gt; a -&gt; SDoc
</span><a href="GHC.Utils.Outputable.html#ppr"><span class="hs-identifier hs-var">ppr</span></a></span><span> </span><span class="annot"><span class="annottext">HsSplice (GhcPass 'Renamed)
</span><a href="#local-6989586621681353617"><span class="hs-identifier hs-var">splice</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-374"></span><span>
</span><span id="line-375"></span><span class="hs-comment">------------------</span><span>
</span><span id="line-376"></span><span class="annot"><a href="GHC.Rename.Splice.html#mkQuasiQuoteExpr"><span class="hs-identifier hs-type">mkQuasiQuoteExpr</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><a href="Language.Haskell.Syntax.Expr.html#UntypedSpliceFlavour"><span class="hs-identifier hs-type">UntypedSpliceFlavour</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="GHC.Types.Name.html#Name"><span class="hs-identifier hs-type">Name</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="GHC.Types.SrcLoc.html#SrcSpan"><span class="hs-identifier hs-type">SrcSpan</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="GHC.Data.FastString.html#FastString"><span class="hs-identifier hs-type">FastString</span></a></span><span>
</span><span id="line-377"></span><span>                 </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="Language.Haskell.Syntax.Expr.html#LHsExpr"><span class="hs-identifier hs-type">LHsExpr</span></a></span><span> </span><span class="annot"><a href="GHC.Hs.Extension.html#GhcRn"><span class="hs-identifier hs-type">GhcRn</span></a></span><span>
</span><span id="line-378"></span><span class="hs-comment">-- Return the expression (quoter &quot;...quote...&quot;)</span><span>
</span><span id="line-379"></span><span class="hs-comment">-- which is what we must run in a quasi-quote</span><span>
</span><span id="line-380"></span><span id="mkQuasiQuoteExpr"><span class="annot"><span class="annottext">mkQuasiQuoteExpr :: UntypedSpliceFlavour
-&gt; Name -&gt; SrcSpan -&gt; FastString -&gt; LHsExpr (GhcPass 'Renamed)
</span><a href="GHC.Rename.Splice.html#mkQuasiQuoteExpr"><span class="hs-identifier hs-var hs-var">mkQuasiQuoteExpr</span></a></span></span><span> </span><span id="local-6989586621681353616"><span class="annot"><span class="annottext">UntypedSpliceFlavour
</span><a href="#local-6989586621681353616"><span class="hs-identifier hs-var">flavour</span></a></span></span><span> </span><span id="local-6989586621681353615"><span class="annot"><span class="annottext">Name
</span><a href="#local-6989586621681353615"><span class="hs-identifier hs-var">quoter</span></a></span></span><span> </span><span id="local-6989586621681353614"><span class="annot"><span class="annottext">SrcSpan
</span><a href="#local-6989586621681353614"><span class="hs-identifier hs-var">q_span'</span></a></span></span><span> </span><span id="local-6989586621681353613"><span class="annot"><span class="annottext">FastString
</span><a href="#local-6989586621681353613"><span class="hs-identifier hs-var">quote</span></a></span></span><span>
</span><span id="line-381"></span><span>  </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">forall l e. l -&gt; e -&gt; GenLocated l e
</span><a href="GHC.Types.SrcLoc.html#L"><span class="hs-identifier hs-var">L</span></a></span><span> </span><span class="annot"><span class="annottext">SrcSpanAnnA
</span><a href="#local-6989586621681353611"><span class="hs-identifier hs-var">q_span</span></a></span><span> </span><span class="annot"><span class="annottext">forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><a href="../../base-4.16.4.0/src/GHC-Base.html#%24"><span class="hs-operator hs-var">$</span></a></span><span> </span><span class="annot"><span class="annottext">forall p. XApp p -&gt; LHsExpr p -&gt; LHsExpr p -&gt; HsExpr p
</span><a href="Language.Haskell.Syntax.Expr.html#HsApp"><span class="hs-identifier hs-var">HsApp</span></a></span><span> </span><span class="annot"><span class="annottext">EpAnnCO
</span><a href="GHC.Parser.Annotation.html#noComments"><span class="hs-identifier hs-var">noComments</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">forall l e. l -&gt; e -&gt; GenLocated l e
</span><a href="GHC.Types.SrcLoc.html#L"><span class="hs-identifier hs-var">L</span></a></span><span> </span><span class="annot"><span class="annottext">SrcSpanAnnA
</span><a href="#local-6989586621681353611"><span class="hs-identifier hs-var">q_span</span></a></span><span>
</span><span id="line-382"></span><span>             </span><span class="annot"><span class="annottext">forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><a href="../../base-4.16.4.0/src/GHC-Base.html#%24"><span class="hs-operator hs-var">$</span></a></span><span> </span><span class="annot"><span class="annottext">forall p. XApp p -&gt; LHsExpr p -&gt; LHsExpr p -&gt; HsExpr p
</span><a href="Language.Haskell.Syntax.Expr.html#HsApp"><span class="hs-identifier hs-var">HsApp</span></a></span><span> </span><span class="annot"><span class="annottext">EpAnnCO
</span><a href="GHC.Parser.Annotation.html#noComments"><span class="hs-identifier hs-var">noComments</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">forall l e. l -&gt; e -&gt; GenLocated l e
</span><a href="GHC.Types.SrcLoc.html#L"><span class="hs-identifier hs-var">L</span></a></span><span> </span><span class="annot"><span class="annottext">SrcSpanAnnA
</span><a href="#local-6989586621681353611"><span class="hs-identifier hs-var">q_span</span></a></span><span>
</span><span id="line-383"></span><span>                    </span><span class="hs-special">(</span><span class="annot"><span class="annottext">forall p. XVar p -&gt; LIdP p -&gt; HsExpr p
</span><a href="Language.Haskell.Syntax.Expr.html#HsVar"><span class="hs-identifier hs-var">HsVar</span></a></span><span> </span><span class="annot"><span class="annottext">NoExtField
</span><a href="Language.Haskell.Syntax.Extension.html#noExtField"><span class="hs-identifier hs-var">noExtField</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">forall l e. l -&gt; e -&gt; GenLocated l e
</span><a href="GHC.Types.SrcLoc.html#L"><span class="hs-identifier hs-var">L</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">forall a. SrcSpanAnn' a -&gt; SrcSpanAnnN
</span><a href="GHC.Parser.Annotation.html#la2na"><span class="hs-identifier hs-var">la2na</span></a></span><span> </span><span class="annot"><span class="annottext">SrcSpanAnnA
</span><a href="#local-6989586621681353611"><span class="hs-identifier hs-var">q_span</span></a></span><span class="hs-special">)</span><span> </span><span class="annot"><span class="annottext">Name
</span><a href="#local-6989586621681353606"><span class="hs-identifier hs-var">quote_selector</span></a></span><span class="hs-special">)</span><span class="hs-special">)</span><span class="hs-special">)</span><span>
</span><span id="line-384"></span><span>                                </span><span class="annot"><span class="annottext">GenLocated SrcSpanAnnA (HsExpr (GhcPass 'Renamed))
</span><a href="#local-6989586621681353605"><span class="hs-identifier hs-var">quoterExpr</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-385"></span><span>                    </span><span class="annot"><span class="annottext">GenLocated SrcSpanAnnA (HsExpr (GhcPass 'Renamed))
</span><a href="#local-6989586621681353604"><span class="hs-identifier hs-var">quoteExpr</span></a></span><span>
</span><span id="line-386"></span><span>  </span><span class="hs-keyword">where</span><span>
</span><span id="line-387"></span><span>    </span><span id="local-6989586621681353611"><span class="annot"><span class="annottext">q_span :: SrcSpanAnnA
</span><a href="#local-6989586621681353611"><span class="hs-identifier hs-var hs-var">q_span</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">forall ann. SrcSpan -&gt; SrcAnn ann
</span><a href="GHC.Parser.Annotation.html#noAnnSrcSpan"><span class="hs-identifier hs-var">noAnnSrcSpan</span></a></span><span> </span><span class="annot"><span class="annottext">SrcSpan
</span><a href="#local-6989586621681353614"><span class="hs-identifier hs-var">q_span'</span></a></span><span>
</span><span id="line-388"></span><span>    </span><span id="local-6989586621681353605"><span class="annot"><span class="annottext">quoterExpr :: GenLocated SrcSpanAnnA (HsExpr (GhcPass 'Renamed))
</span><a href="#local-6989586621681353605"><span class="hs-identifier hs-var hs-var">quoterExpr</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">forall l e. l -&gt; e -&gt; GenLocated l e
</span><a href="GHC.Types.SrcLoc.html#L"><span class="hs-identifier hs-var">L</span></a></span><span> </span><span class="annot"><span class="annottext">SrcSpanAnnA
</span><a href="#local-6989586621681353611"><span class="hs-identifier hs-var">q_span</span></a></span><span> </span><span class="annot"><span class="annottext">forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><a href="../../base-4.16.4.0/src/GHC-Base.html#%24%21"><span class="hs-operator hs-var">$!</span></a></span><span> </span><span class="annot"><span class="annottext">forall p. XVar p -&gt; LIdP p -&gt; HsExpr p
</span><a href="Language.Haskell.Syntax.Expr.html#HsVar"><span class="hs-identifier hs-var">HsVar</span></a></span><span> </span><span class="annot"><span class="annottext">NoExtField
</span><a href="Language.Haskell.Syntax.Extension.html#noExtField"><span class="hs-identifier hs-var">noExtField</span></a></span><span> </span><span class="annot"><span class="annottext">forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><a href="../../base-4.16.4.0/src/GHC-Base.html#%24%21"><span class="hs-operator hs-var">$!</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">forall l e. l -&gt; e -&gt; GenLocated l e
</span><a href="GHC.Types.SrcLoc.html#L"><span class="hs-identifier hs-var">L</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">forall a. SrcSpanAnn' a -&gt; SrcSpanAnnN
</span><a href="GHC.Parser.Annotation.html#la2na"><span class="hs-identifier hs-var">la2na</span></a></span><span> </span><span class="annot"><span class="annottext">SrcSpanAnnA
</span><a href="#local-6989586621681353611"><span class="hs-identifier hs-var">q_span</span></a></span><span class="hs-special">)</span><span> </span><span class="annot"><span class="annottext">Name
</span><a href="#local-6989586621681353615"><span class="hs-identifier hs-var">quoter</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-389"></span><span>    </span><span id="local-6989586621681353604"><span class="annot"><span class="annottext">quoteExpr :: GenLocated SrcSpanAnnA (HsExpr (GhcPass 'Renamed))
</span><a href="#local-6989586621681353604"><span class="hs-identifier hs-var hs-var">quoteExpr</span></a></span></span><span>  </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">forall l e. l -&gt; e -&gt; GenLocated l e
</span><a href="GHC.Types.SrcLoc.html#L"><span class="hs-identifier hs-var">L</span></a></span><span> </span><span class="annot"><span class="annottext">SrcSpanAnnA
</span><a href="#local-6989586621681353611"><span class="hs-identifier hs-var">q_span</span></a></span><span> </span><span class="annot"><span class="annottext">forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><a href="../../base-4.16.4.0/src/GHC-Base.html#%24%21"><span class="hs-operator hs-var">$!</span></a></span><span> </span><span class="annot"><span class="annottext">forall p. XLitE p -&gt; HsLit p -&gt; HsExpr p
</span><a href="Language.Haskell.Syntax.Expr.html#HsLit"><span class="hs-identifier hs-var">HsLit</span></a></span><span> </span><span class="annot"><span class="annottext">EpAnnCO
</span><a href="GHC.Parser.Annotation.html#noComments"><span class="hs-identifier hs-var">noComments</span></a></span><span> </span><span class="annot"><span class="annottext">forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><a href="../../base-4.16.4.0/src/GHC-Base.html#%24%21"><span class="hs-operator hs-var">$!</span></a></span><span> </span><span class="annot"><span class="annottext">forall x. XHsString x -&gt; FastString -&gt; HsLit x
</span><a href="Language.Haskell.Syntax.Lit.html#HsString"><span class="hs-identifier hs-var">HsString</span></a></span><span> </span><span class="annot"><span class="annottext">SourceText
</span><a href="GHC.Types.SourceText.html#NoSourceText"><span class="hs-identifier hs-var">NoSourceText</span></a></span><span> </span><span class="annot"><span class="annottext">FastString
</span><a href="#local-6989586621681353613"><span class="hs-identifier hs-var">quote</span></a></span><span>
</span><span id="line-390"></span><span>    </span><span id="local-6989586621681353606"><span class="annot"><span class="annottext">quote_selector :: Name
</span><a href="#local-6989586621681353606"><span class="hs-identifier hs-var hs-var">quote_selector</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-keyword">case</span><span> </span><span class="annot"><span class="annottext">UntypedSpliceFlavour
</span><a href="#local-6989586621681353616"><span class="hs-identifier hs-var">flavour</span></a></span><span> </span><span class="hs-keyword">of</span><span>
</span><span id="line-391"></span><span>                       </span><span class="annot"><span class="annottext">UntypedSpliceFlavour
</span><a href="Language.Haskell.Syntax.Expr.html#UntypedExpSplice"><span class="hs-identifier hs-var">UntypedExpSplice</span></a></span><span>  </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="annottext">Name
</span><a href="GHC.Builtin.Names.TH.html#quoteExpName"><span class="hs-identifier hs-var">quoteExpName</span></a></span><span>
</span><span id="line-392"></span><span>                       </span><span class="annot"><span class="annottext">UntypedSpliceFlavour
</span><a href="Language.Haskell.Syntax.Expr.html#UntypedPatSplice"><span class="hs-identifier hs-var">UntypedPatSplice</span></a></span><span>  </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="annottext">Name
</span><a href="GHC.Builtin.Names.TH.html#quotePatName"><span class="hs-identifier hs-var">quotePatName</span></a></span><span>
</span><span id="line-393"></span><span>                       </span><span class="annot"><span class="annottext">UntypedSpliceFlavour
</span><a href="Language.Haskell.Syntax.Expr.html#UntypedTypeSplice"><span class="hs-identifier hs-var">UntypedTypeSplice</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="annottext">Name
</span><a href="GHC.Builtin.Names.TH.html#quoteTypeName"><span class="hs-identifier hs-var">quoteTypeName</span></a></span><span>
</span><span id="line-394"></span><span>                       </span><span class="annot"><span class="annottext">UntypedSpliceFlavour
</span><a href="Language.Haskell.Syntax.Expr.html#UntypedDeclSplice"><span class="hs-identifier hs-var">UntypedDeclSplice</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="annottext">Name
</span><a href="GHC.Builtin.Names.TH.html#quoteDecName"><span class="hs-identifier hs-var">quoteDecName</span></a></span><span>
</span><span id="line-395"></span><span>
</span><span id="line-396"></span><span class="hs-comment">---------------------</span><span>
</span><span id="line-397"></span><span class="annot"><a href="GHC.Rename.Splice.html#rnSplice"><span class="hs-identifier hs-type">rnSplice</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><a href="Language.Haskell.Syntax.Expr.html#HsSplice"><span class="hs-identifier hs-type">HsSplice</span></a></span><span> </span><span class="annot"><a href="GHC.Hs.Extension.html#GhcPs"><span class="hs-identifier hs-type">GhcPs</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="GHC.Tc.Types.html#RnM"><span class="hs-identifier hs-type">RnM</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="Language.Haskell.Syntax.Expr.html#HsSplice"><span class="hs-identifier hs-type">HsSplice</span></a></span><span> </span><span class="annot"><a href="GHC.Hs.Extension.html#GhcRn"><span class="hs-identifier hs-type">GhcRn</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><a href="GHC.Types.Name.Set.html#FreeVars"><span class="hs-identifier hs-type">FreeVars</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-398"></span><span class="hs-comment">-- Not exported...used for all</span><span>
</span><span id="line-399"></span><span id="rnSplice"><span class="annot"><span class="annottext">rnSplice :: HsSplice GhcPs -&gt; TcRn (HsSplice (GhcPass 'Renamed), Uses)
</span><a href="GHC.Rename.Splice.html#rnSplice"><span class="hs-identifier hs-var hs-var">rnSplice</span></a></span></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="Language.Haskell.Syntax.Expr.html#HsTypedSplice"><span class="hs-identifier hs-type">HsTypedSplice</span></a></span><span> </span><span id="local-6989586621681353598"><span class="annot"><span class="annottext">XTypedSplice GhcPs
</span><a href="#local-6989586621681353598"><span class="hs-identifier hs-var">x</span></a></span></span><span> </span><span id="local-6989586621681353597"><span class="annot"><span class="annottext">SpliceDecoration
</span><a href="#local-6989586621681353597"><span class="hs-identifier hs-var">hasParen</span></a></span></span><span> </span><span id="local-6989586621681353596"><span class="annot"><span class="annottext">IdP GhcPs
</span><a href="#local-6989586621681353596"><span class="hs-identifier hs-var">splice_name</span></a></span></span><span> </span><span id="local-6989586621681353595"><span class="annot"><span class="annottext">LHsExpr GhcPs
</span><a href="#local-6989586621681353595"><span class="hs-identifier hs-var">expr</span></a></span></span><span class="hs-special">)</span><span>
</span><span id="line-400"></span><span>  </span><span class="hs-glyph">=</span><span> </span><span class="hs-keyword">do</span><span>  </span><span class="hs-special">{</span><span> </span><span id="local-6989586621681353594"><span class="annot"><span class="annottext">SrcSpan
</span><a href="#local-6989586621681353594"><span class="hs-identifier hs-var">loc</span></a></span></span><span>  </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">TcRn SrcSpan
</span><a href="GHC.Tc.Utils.Monad.html#getSrcSpanM"><span class="hs-identifier hs-var">getSrcSpanM</span></a></span><span>
</span><span id="line-401"></span><span>        </span><span class="hs-special">;</span><span> </span><span id="local-6989586621681353592"><span class="annot"><span class="annottext">Name
</span><a href="#local-6989586621681353592"><span class="hs-identifier hs-var">n'</span></a></span></span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">GenLocated SrcSpanAnnN RdrName -&gt; RnM Name
</span><a href="GHC.Rename.Utils.html#newLocalBndrRn"><span class="hs-identifier hs-var">newLocalBndrRn</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">forall l e. l -&gt; e -&gt; GenLocated l e
</span><a href="GHC.Types.SrcLoc.html#L"><span class="hs-identifier hs-var">L</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">forall ann. SrcSpan -&gt; SrcAnn ann
</span><a href="GHC.Parser.Annotation.html#noAnnSrcSpan"><span class="hs-identifier hs-var">noAnnSrcSpan</span></a></span><span> </span><span class="annot"><span class="annottext">SrcSpan
</span><a href="#local-6989586621681353594"><span class="hs-identifier hs-var">loc</span></a></span><span class="hs-special">)</span><span> </span><span class="annot"><span class="annottext">IdP GhcPs
</span><a href="#local-6989586621681353596"><span class="hs-identifier hs-var">splice_name</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-402"></span><span>        </span><span class="hs-special">;</span><span> </span><span class="hs-special">(</span><span id="local-6989586621681353591"><span class="annot"><span class="annottext">GenLocated SrcSpanAnnA (HsExpr (GhcPass 'Renamed))
</span><a href="#local-6989586621681353591"><span class="hs-identifier hs-var">expr'</span></a></span></span><span class="hs-special">,</span><span> </span><span id="local-6989586621681353590"><span class="annot"><span class="annottext">Uses
</span><a href="#local-6989586621681353590"><span class="hs-identifier hs-var">fvs</span></a></span></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">LHsExpr GhcPs -&gt; RnM (LHsExpr (GhcPass 'Renamed), Uses)
</span><a href="GHC.Rename.Expr.html#rnLExpr"><span class="hs-identifier hs-var">rnLExpr</span></a></span><span> </span><span class="annot"><span class="annottext">LHsExpr GhcPs
</span><a href="#local-6989586621681353595"><span class="hs-identifier hs-var">expr</span></a></span><span>
</span><span id="line-403"></span><span>        </span><span class="hs-special">;</span><span> </span><span class="annot"><span class="annottext">forall (m :: * -&gt; *) a. Monad m =&gt; a -&gt; m a
</span><a href="../../base-4.16.4.0/src/GHC-Base.html#return"><span class="hs-identifier hs-var">return</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">forall id.
XTypedSplice id
-&gt; SpliceDecoration -&gt; IdP id -&gt; LHsExpr id -&gt; HsSplice id
</span><a href="Language.Haskell.Syntax.Expr.html#HsTypedSplice"><span class="hs-identifier hs-var">HsTypedSplice</span></a></span><span> </span><span class="annot"><span class="annottext">XTypedSplice GhcPs
</span><a href="#local-6989586621681353598"><span class="hs-identifier hs-var">x</span></a></span><span> </span><span class="annot"><span class="annottext">SpliceDecoration
</span><a href="#local-6989586621681353597"><span class="hs-identifier hs-var">hasParen</span></a></span><span> </span><span class="annot"><span class="annottext">Name
</span><a href="#local-6989586621681353592"><span class="hs-identifier hs-var">n'</span></a></span><span> </span><span class="annot"><span class="annottext">GenLocated SrcSpanAnnA (HsExpr (GhcPass 'Renamed))
</span><a href="#local-6989586621681353591"><span class="hs-identifier hs-var">expr'</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">Uses
</span><a href="#local-6989586621681353590"><span class="hs-identifier hs-var">fvs</span></a></span><span class="hs-special">)</span><span> </span><span class="hs-special">}</span><span>
</span><span id="line-404"></span><span>
</span><span id="line-405"></span><span class="annot"><a href="GHC.Rename.Splice.html#rnSplice"><span class="hs-identifier hs-var">rnSplice</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="Language.Haskell.Syntax.Expr.html#HsUntypedSplice"><span class="hs-identifier hs-type">HsUntypedSplice</span></a></span><span> </span><span id="local-6989586621681353589"><span class="annot"><span class="annottext">XUntypedSplice GhcPs
</span><a href="#local-6989586621681353589"><span class="hs-identifier hs-var">x</span></a></span></span><span> </span><span id="local-6989586621681353588"><span class="annot"><span class="annottext">SpliceDecoration
</span><a href="#local-6989586621681353588"><span class="hs-identifier hs-var">hasParen</span></a></span></span><span> </span><span id="local-6989586621681353587"><span class="annot"><span class="annottext">IdP GhcPs
</span><a href="#local-6989586621681353587"><span class="hs-identifier hs-var">splice_name</span></a></span></span><span> </span><span id="local-6989586621681353586"><span class="annot"><span class="annottext">LHsExpr GhcPs
</span><a href="#local-6989586621681353586"><span class="hs-identifier hs-var">expr</span></a></span></span><span class="hs-special">)</span><span>
</span><span id="line-406"></span><span>  </span><span class="hs-glyph">=</span><span> </span><span class="hs-keyword">do</span><span>  </span><span class="hs-special">{</span><span> </span><span id="local-6989586621681353585"><span class="annot"><span class="annottext">SrcSpan
</span><a href="#local-6989586621681353585"><span class="hs-identifier hs-var">loc</span></a></span></span><span>  </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">TcRn SrcSpan
</span><a href="GHC.Tc.Utils.Monad.html#getSrcSpanM"><span class="hs-identifier hs-var">getSrcSpanM</span></a></span><span>
</span><span id="line-407"></span><span>        </span><span class="hs-special">;</span><span> </span><span id="local-6989586621681353584"><span class="annot"><span class="annottext">Name
</span><a href="#local-6989586621681353584"><span class="hs-identifier hs-var">n'</span></a></span></span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">GenLocated SrcSpanAnnN RdrName -&gt; RnM Name
</span><a href="GHC.Rename.Utils.html#newLocalBndrRn"><span class="hs-identifier hs-var">newLocalBndrRn</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">forall l e. l -&gt; e -&gt; GenLocated l e
</span><a href="GHC.Types.SrcLoc.html#L"><span class="hs-identifier hs-var">L</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">forall ann. SrcSpan -&gt; SrcAnn ann
</span><a href="GHC.Parser.Annotation.html#noAnnSrcSpan"><span class="hs-identifier hs-var">noAnnSrcSpan</span></a></span><span> </span><span class="annot"><span class="annottext">SrcSpan
</span><a href="#local-6989586621681353585"><span class="hs-identifier hs-var">loc</span></a></span><span class="hs-special">)</span><span> </span><span class="annot"><span class="annottext">IdP GhcPs
</span><a href="#local-6989586621681353587"><span class="hs-identifier hs-var">splice_name</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-408"></span><span>        </span><span class="hs-special">;</span><span> </span><span class="hs-special">(</span><span id="local-6989586621681353583"><span class="annot"><span class="annottext">GenLocated SrcSpanAnnA (HsExpr (GhcPass 'Renamed))
</span><a href="#local-6989586621681353583"><span class="hs-identifier hs-var">expr'</span></a></span></span><span class="hs-special">,</span><span> </span><span id="local-6989586621681353582"><span class="annot"><span class="annottext">Uses
</span><a href="#local-6989586621681353582"><span class="hs-identifier hs-var">fvs</span></a></span></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">LHsExpr GhcPs -&gt; RnM (LHsExpr (GhcPass 'Renamed), Uses)
</span><a href="GHC.Rename.Expr.html#rnLExpr"><span class="hs-identifier hs-var">rnLExpr</span></a></span><span> </span><span class="annot"><span class="annottext">LHsExpr GhcPs
</span><a href="#local-6989586621681353586"><span class="hs-identifier hs-var">expr</span></a></span><span>
</span><span id="line-409"></span><span>        </span><span class="hs-special">;</span><span> </span><span class="annot"><span class="annottext">forall (m :: * -&gt; *) a. Monad m =&gt; a -&gt; m a
</span><a href="../../base-4.16.4.0/src/GHC-Base.html#return"><span class="hs-identifier hs-var">return</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">forall id.
XUntypedSplice id
-&gt; SpliceDecoration -&gt; IdP id -&gt; LHsExpr id -&gt; HsSplice id
</span><a href="Language.Haskell.Syntax.Expr.html#HsUntypedSplice"><span class="hs-identifier hs-var">HsUntypedSplice</span></a></span><span> </span><span class="annot"><span class="annottext">XUntypedSplice GhcPs
</span><a href="#local-6989586621681353589"><span class="hs-identifier hs-var">x</span></a></span><span> </span><span class="annot"><span class="annottext">SpliceDecoration
</span><a href="#local-6989586621681353588"><span class="hs-identifier hs-var">hasParen</span></a></span><span> </span><span class="annot"><span class="annottext">Name
</span><a href="#local-6989586621681353584"><span class="hs-identifier hs-var">n'</span></a></span><span> </span><span class="annot"><span class="annottext">GenLocated SrcSpanAnnA (HsExpr (GhcPass 'Renamed))
</span><a href="#local-6989586621681353583"><span class="hs-identifier hs-var">expr'</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">Uses
</span><a href="#local-6989586621681353582"><span class="hs-identifier hs-var">fvs</span></a></span><span class="hs-special">)</span><span> </span><span class="hs-special">}</span><span>
</span><span id="line-410"></span><span>
</span><span id="line-411"></span><span class="annot"><a href="GHC.Rename.Splice.html#rnSplice"><span class="hs-identifier hs-var">rnSplice</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="Language.Haskell.Syntax.Expr.html#HsQuasiQuote"><span class="hs-identifier hs-type">HsQuasiQuote</span></a></span><span> </span><span id="local-6989586621681353581"><span class="annot"><span class="annottext">XQuasiQuote GhcPs
</span><a href="#local-6989586621681353581"><span class="hs-identifier hs-var">x</span></a></span></span><span> </span><span id="local-6989586621681353580"><span class="annot"><span class="annottext">IdP GhcPs
</span><a href="#local-6989586621681353580"><span class="hs-identifier hs-var">splice_name</span></a></span></span><span> </span><span id="local-6989586621681353579"><span class="annot"><span class="annottext">IdP GhcPs
</span><a href="#local-6989586621681353579"><span class="hs-identifier hs-var">quoter</span></a></span></span><span> </span><span id="local-6989586621681353578"><span class="annot"><span class="annottext">SrcSpan
</span><a href="#local-6989586621681353578"><span class="hs-identifier hs-var">q_loc</span></a></span></span><span> </span><span id="local-6989586621681353577"><span class="annot"><span class="annottext">FastString
</span><a href="#local-6989586621681353577"><span class="hs-identifier hs-var">quote</span></a></span></span><span class="hs-special">)</span><span>
</span><span id="line-412"></span><span>  </span><span class="hs-glyph">=</span><span> </span><span class="hs-keyword">do</span><span>  </span><span class="hs-special">{</span><span> </span><span id="local-6989586621681353576"><span class="annot"><span class="annottext">SrcSpan
</span><a href="#local-6989586621681353576"><span class="hs-identifier hs-var">loc</span></a></span></span><span>  </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">TcRn SrcSpan
</span><a href="GHC.Tc.Utils.Monad.html#getSrcSpanM"><span class="hs-identifier hs-var">getSrcSpanM</span></a></span><span>
</span><span id="line-413"></span><span>        </span><span class="hs-special">;</span><span> </span><span id="local-6989586621681353575"><span class="annot"><span class="annottext">Name
</span><a href="#local-6989586621681353575"><span class="hs-identifier hs-var">splice_name'</span></a></span></span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">GenLocated SrcSpanAnnN RdrName -&gt; RnM Name
</span><a href="GHC.Rename.Utils.html#newLocalBndrRn"><span class="hs-identifier hs-var">newLocalBndrRn</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">forall l e. l -&gt; e -&gt; GenLocated l e
</span><a href="GHC.Types.SrcLoc.html#L"><span class="hs-identifier hs-var">L</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">forall ann. SrcSpan -&gt; SrcAnn ann
</span><a href="GHC.Parser.Annotation.html#noAnnSrcSpan"><span class="hs-identifier hs-var">noAnnSrcSpan</span></a></span><span> </span><span class="annot"><span class="annottext">SrcSpan
</span><a href="#local-6989586621681353576"><span class="hs-identifier hs-var">loc</span></a></span><span class="hs-special">)</span><span> </span><span class="annot"><span class="annottext">IdP GhcPs
</span><a href="#local-6989586621681353580"><span class="hs-identifier hs-var">splice_name</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-414"></span><span>
</span><span id="line-415"></span><span>          </span><span class="hs-comment">-- Rename the quoter; akin to the HsVar case of rnExpr</span><span>
</span><span id="line-416"></span><span>        </span><span class="hs-special">;</span><span> </span><span id="local-6989586621681353574"><span class="annot"><span class="annottext">Name
</span><a href="#local-6989586621681353574"><span class="hs-identifier hs-var">quoter'</span></a></span></span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">RdrName -&gt; RnM Name
</span><a href="GHC.Rename.Env.html#lookupOccRn"><span class="hs-identifier hs-var">lookupOccRn</span></a></span><span> </span><span class="annot"><span class="annottext">IdP GhcPs
</span><a href="#local-6989586621681353579"><span class="hs-identifier hs-var">quoter</span></a></span><span>
</span><span id="line-417"></span><span>        </span><span class="hs-special">;</span><span> </span><span id="local-6989586621681353573"><span class="annot"><span class="annottext">Module
</span><a href="#local-6989586621681353573"><span class="hs-identifier hs-var">this_mod</span></a></span></span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">forall (m :: * -&gt; *). HasModule m =&gt; m Module
</span><a href="GHC.Unit.Module.html#getModule"><span class="hs-identifier hs-var">getModule</span></a></span><span>
</span><span id="line-418"></span><span>        </span><span class="hs-special">;</span><span> </span><span class="annot"><span class="annottext">forall (f :: * -&gt; *). Applicative f =&gt; Bool -&gt; f () -&gt; f ()
</span><a href="../../base-4.16.4.0/src/GHC-Base.html#when"><span class="hs-identifier hs-var">when</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Module -&gt; Name -&gt; Bool
</span><a href="GHC.Types.Name.html#nameIsLocalOrFrom"><span class="hs-identifier hs-var">nameIsLocalOrFrom</span></a></span><span> </span><span class="annot"><span class="annottext">Module
</span><a href="#local-6989586621681353573"><span class="hs-identifier hs-var">this_mod</span></a></span><span> </span><span class="annot"><span class="annottext">Name
</span><a href="#local-6989586621681353574"><span class="hs-identifier hs-var">quoter'</span></a></span><span class="hs-special">)</span><span> </span><span class="annot"><span class="annottext">forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><a href="../../base-4.16.4.0/src/GHC-Base.html#%24"><span class="hs-operator hs-var">$</span></a></span><span>
</span><span id="line-419"></span><span>          </span><span class="annot"><span class="annottext">Name -&gt; IOEnv (Env TcGblEnv TcLclEnv) ()
</span><a href="GHC.Rename.Splice.html#checkThLocalName"><span class="hs-identifier hs-var">checkThLocalName</span></a></span><span> </span><span class="annot"><span class="annottext">Name
</span><a href="#local-6989586621681353574"><span class="hs-identifier hs-var">quoter'</span></a></span><span>
</span><span id="line-420"></span><span>
</span><span id="line-421"></span><span>        </span><span class="hs-special">;</span><span> </span><span class="annot"><span class="annottext">forall (m :: * -&gt; *) a. Monad m =&gt; a -&gt; m a
</span><a href="../../base-4.16.4.0/src/GHC-Base.html#return"><span class="hs-identifier hs-var">return</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">forall id.
XQuasiQuote id
-&gt; IdP id -&gt; IdP id -&gt; SrcSpan -&gt; FastString -&gt; HsSplice id
</span><a href="Language.Haskell.Syntax.Expr.html#HsQuasiQuote"><span class="hs-identifier hs-var">HsQuasiQuote</span></a></span><span> </span><span class="annot"><span class="annottext">XQuasiQuote GhcPs
</span><a href="#local-6989586621681353581"><span class="hs-identifier hs-var">x</span></a></span><span> </span><span class="annot"><span class="annottext">Name
</span><a href="#local-6989586621681353575"><span class="hs-identifier hs-var">splice_name'</span></a></span><span> </span><span class="annot"><span class="annottext">Name
</span><a href="#local-6989586621681353574"><span class="hs-identifier hs-var">quoter'</span></a></span><span> </span><span class="annot"><span class="annottext">SrcSpan
</span><a href="#local-6989586621681353578"><span class="hs-identifier hs-var">q_loc</span></a></span><span> </span><span class="annot"><span class="annottext">FastString
</span><a href="#local-6989586621681353577"><span class="hs-identifier hs-var">quote</span></a></span><span>
</span><span id="line-422"></span><span>                                                             </span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">Name -&gt; Uses
</span><a href="GHC.Types.Name.Set.html#unitFV"><span class="hs-identifier hs-var">unitFV</span></a></span><span> </span><span class="annot"><span class="annottext">Name
</span><a href="#local-6989586621681353574"><span class="hs-identifier hs-var">quoter'</span></a></span><span class="hs-special">)</span><span> </span><span class="hs-special">}</span><span>
</span><span id="line-423"></span><span>
</span><span id="line-424"></span><span class="annot"><a href="GHC.Rename.Splice.html#rnSplice"><span class="hs-identifier hs-var">rnSplice</span></a></span><span> </span><span id="local-6989586621681353572"><span class="annot"><span class="annottext">splice :: HsSplice GhcPs
</span><a href="#local-6989586621681353572"><span class="hs-identifier hs-var">splice</span></a></span></span><span class="hs-glyph">@</span><span class="hs-special">(</span><span class="annot"><a href="Language.Haskell.Syntax.Expr.html#HsSpliced"><span class="hs-identifier hs-type">HsSpliced</span></a></span><span> </span><span class="hs-special">{</span><span class="hs-special">}</span><span class="hs-special">)</span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">forall a. HasCallStack =&gt; String -&gt; SDoc -&gt; a
</span><a href="GHC.Utils.Panic.html#pprPanic"><span class="hs-identifier hs-var">pprPanic</span></a></span><span> </span><span class="annot"><span class="annottext">String
</span><span class="hs-string">&quot;rnSplice&quot;</span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">forall a. Outputable a =&gt; a -&gt; SDoc
</span><a href="GHC.Utils.Outputable.html#ppr"><span class="hs-identifier hs-var">ppr</span></a></span><span> </span><span class="annot"><span class="annottext">HsSplice GhcPs
</span><a href="#local-6989586621681353572"><span class="hs-identifier hs-var">splice</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-425"></span><span>
</span><span id="line-426"></span><span class="hs-comment">---------------------</span><span>
</span><span id="line-427"></span><span class="annot"><a href="GHC.Rename.Splice.html#rnSpliceExpr"><span class="hs-identifier hs-type">rnSpliceExpr</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><a href="Language.Haskell.Syntax.Expr.html#HsSplice"><span class="hs-identifier hs-type">HsSplice</span></a></span><span> </span><span class="annot"><a href="GHC.Hs.Extension.html#GhcPs"><span class="hs-identifier hs-type">GhcPs</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="GHC.Tc.Types.html#RnM"><span class="hs-identifier hs-type">RnM</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="Language.Haskell.Syntax.Expr.html#HsExpr"><span class="hs-identifier hs-type">HsExpr</span></a></span><span> </span><span class="annot"><a href="GHC.Hs.Extension.html#GhcRn"><span class="hs-identifier hs-type">GhcRn</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><a href="GHC.Types.Name.Set.html#FreeVars"><span class="hs-identifier hs-type">FreeVars</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-428"></span><span id="rnSpliceExpr"><span class="annot"><span class="annottext">rnSpliceExpr :: HsSplice GhcPs -&gt; RnM (HsExpr (GhcPass 'Renamed), Uses)
</span><a href="GHC.Rename.Splice.html#rnSpliceExpr"><span class="hs-identifier hs-var hs-var">rnSpliceExpr</span></a></span></span><span> </span><span id="local-6989586621681353571"><span class="annot"><span class="annottext">HsSplice GhcPs
</span><a href="#local-6989586621681353571"><span class="hs-identifier hs-var">splice</span></a></span></span><span>
</span><span id="line-429"></span><span>  </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">forall a.
(HsSplice (GhcPass 'Renamed) -&gt; RnM (a, Uses))
-&gt; (HsSplice (GhcPass 'Renamed) -&gt; (PendingRnSplice, a))
-&gt; HsSplice GhcPs
-&gt; RnM (a, Uses)
</span><a href="GHC.Rename.Splice.html#rnSpliceGen"><span class="hs-identifier hs-var">rnSpliceGen</span></a></span><span> </span><span class="annot"><span class="annottext">HsSplice (GhcPass 'Renamed)
-&gt; RnM (HsExpr (GhcPass 'Renamed), Uses)
</span><a href="#local-6989586621681353570"><span class="hs-identifier hs-var">run_expr_splice</span></a></span><span> </span><span class="annot"><span class="annottext">HsSplice (GhcPass 'Renamed)
-&gt; (PendingRnSplice, HsExpr (GhcPass 'Renamed))
</span><a href="#local-6989586621681353569"><span class="hs-identifier hs-var">pend_expr_splice</span></a></span><span> </span><span class="annot"><span class="annottext">HsSplice GhcPs
</span><a href="#local-6989586621681353571"><span class="hs-identifier hs-var">splice</span></a></span><span>
</span><span id="line-430"></span><span>  </span><span class="hs-keyword">where</span><span>
</span><span id="line-431"></span><span>    </span><span class="annot"><a href="#local-6989586621681353569"><span class="hs-identifier hs-type">pend_expr_splice</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><a href="Language.Haskell.Syntax.Expr.html#HsSplice"><span class="hs-identifier hs-type">HsSplice</span></a></span><span> </span><span class="annot"><a href="GHC.Hs.Extension.html#GhcRn"><span class="hs-identifier hs-type">GhcRn</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-special">(</span><span class="annot"><a href="GHC.Hs.Expr.html#PendingRnSplice"><span class="hs-identifier hs-type">PendingRnSplice</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><a href="Language.Haskell.Syntax.Expr.html#HsExpr"><span class="hs-identifier hs-type">HsExpr</span></a></span><span> </span><span class="annot"><a href="GHC.Hs.Extension.html#GhcRn"><span class="hs-identifier hs-type">GhcRn</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-432"></span><span>    </span><span id="local-6989586621681353569"><span class="annot"><span class="annottext">pend_expr_splice :: HsSplice (GhcPass 'Renamed)
-&gt; (PendingRnSplice, HsExpr (GhcPass 'Renamed))
</span><a href="#local-6989586621681353569"><span class="hs-identifier hs-var hs-var">pend_expr_splice</span></a></span></span><span> </span><span id="local-6989586621681353568"><span class="annot"><span class="annottext">HsSplice (GhcPass 'Renamed)
</span><a href="#local-6989586621681353568"><span class="hs-identifier hs-var">rn_splice</span></a></span></span><span>
</span><span id="line-433"></span><span>        </span><span class="hs-glyph">=</span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">UntypedSpliceFlavour
-&gt; HsSplice (GhcPass 'Renamed) -&gt; PendingRnSplice
</span><a href="GHC.Rename.Splice.html#makePending"><span class="hs-identifier hs-var">makePending</span></a></span><span> </span><span class="annot"><span class="annottext">UntypedSpliceFlavour
</span><a href="Language.Haskell.Syntax.Expr.html#UntypedExpSplice"><span class="hs-identifier hs-var">UntypedExpSplice</span></a></span><span> </span><span class="annot"><span class="annottext">HsSplice (GhcPass 'Renamed)
</span><a href="#local-6989586621681353568"><span class="hs-identifier hs-var">rn_splice</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">forall p. XSpliceE p -&gt; HsSplice p -&gt; HsExpr p
</span><a href="Language.Haskell.Syntax.Expr.html#HsSpliceE"><span class="hs-identifier hs-var">HsSpliceE</span></a></span><span> </span><span class="annot"><span class="annottext">forall a. EpAnn a
</span><a href="GHC.Parser.Annotation.html#noAnn"><span class="hs-identifier hs-var">noAnn</span></a></span><span> </span><span class="annot"><span class="annottext">HsSplice (GhcPass 'Renamed)
</span><a href="#local-6989586621681353568"><span class="hs-identifier hs-var">rn_splice</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-434"></span><span>
</span><span id="line-435"></span><span>    </span><span class="annot"><a href="#local-6989586621681353570"><span class="hs-identifier hs-type">run_expr_splice</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><a href="Language.Haskell.Syntax.Expr.html#HsSplice"><span class="hs-identifier hs-type">HsSplice</span></a></span><span> </span><span class="annot"><a href="GHC.Hs.Extension.html#GhcRn"><span class="hs-identifier hs-type">GhcRn</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="GHC.Tc.Types.html#RnM"><span class="hs-identifier hs-type">RnM</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="Language.Haskell.Syntax.Expr.html#HsExpr"><span class="hs-identifier hs-type">HsExpr</span></a></span><span> </span><span class="annot"><a href="GHC.Hs.Extension.html#GhcRn"><span class="hs-identifier hs-type">GhcRn</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><a href="GHC.Types.Name.Set.html#FreeVars"><span class="hs-identifier hs-type">FreeVars</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-436"></span><span>    </span><span id="local-6989586621681353570"><span class="annot"><span class="annottext">run_expr_splice :: HsSplice (GhcPass 'Renamed)
-&gt; RnM (HsExpr (GhcPass 'Renamed), Uses)
</span><a href="#local-6989586621681353570"><span class="hs-identifier hs-var hs-var">run_expr_splice</span></a></span></span><span> </span><span id="local-6989586621681353566"><span class="annot"><span class="annottext">HsSplice (GhcPass 'Renamed)
</span><a href="#local-6989586621681353566"><span class="hs-identifier hs-var">rn_splice</span></a></span></span><span>
</span><span id="line-437"></span><span>      </span><span class="hs-glyph">|</span><span> </span><span class="annot"><span class="annottext">forall id. HsSplice id -&gt; Bool
</span><a href="Language.Haskell.Syntax.Expr.html#isTypedSplice"><span class="hs-identifier hs-var">isTypedSplice</span></a></span><span> </span><span class="annot"><span class="annottext">HsSplice (GhcPass 'Renamed)
</span><a href="#local-6989586621681353566"><span class="hs-identifier hs-var">rn_splice</span></a></span><span>   </span><span class="hs-comment">-- Run it later, in the type checker</span><span>
</span><span id="line-438"></span><span>      </span><span class="hs-glyph">=</span><span> </span><span class="hs-keyword">do</span><span> </span><span class="hs-special">{</span><span>  </span><span class="hs-comment">-- Ugh!  See Note [Splices] above</span><span>
</span><span id="line-439"></span><span>             </span><span class="annot"><span class="annottext">String -&gt; SDoc -&gt; IOEnv (Env TcGblEnv TcLclEnv) ()
</span><a href="GHC.Tc.Utils.Monad.html#traceRn"><span class="hs-identifier hs-var">traceRn</span></a></span><span> </span><span class="annot"><span class="annottext">String
</span><span class="hs-string">&quot;rnSpliceExpr: typed expression splice&quot;</span></span><span> </span><span class="annot"><span class="annottext">SDoc
</span><a href="GHC.Utils.Outputable.html#empty"><span class="hs-identifier hs-var">empty</span></a></span><span>
</span><span id="line-440"></span><span>           </span><span class="hs-special">;</span><span> </span><span id="local-6989586621681353565"><span class="annot"><span class="annottext">LocalRdrEnv
</span><a href="#local-6989586621681353565"><span class="hs-identifier hs-var">lcl_rdr</span></a></span></span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">RnM LocalRdrEnv
</span><a href="GHC.Tc.Utils.Monad.html#getLocalRdrEnv"><span class="hs-identifier hs-var">getLocalRdrEnv</span></a></span><span>
</span><span id="line-441"></span><span>           </span><span class="hs-special">;</span><span> </span><span id="local-6989586621681353563"><span class="annot"><span class="annottext">GlobalRdrEnv
</span><a href="#local-6989586621681353563"><span class="hs-identifier hs-var">gbl_rdr</span></a></span></span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">TcRn GlobalRdrEnv
</span><a href="GHC.Tc.Utils.Monad.html#getGlobalRdrEnv"><span class="hs-identifier hs-var">getGlobalRdrEnv</span></a></span><span>
</span><span id="line-442"></span><span>           </span><span class="hs-special">;</span><span> </span><span class="hs-keyword">let</span><span> </span><span id="local-6989586621681353561"><span class="annot"><span class="annottext">gbl_names :: Uses
</span><a href="#local-6989586621681353561"><span class="hs-identifier hs-var hs-var">gbl_names</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">[Name] -&gt; Uses
</span><a href="GHC.Types.Name.Set.html#mkNameSet"><span class="hs-identifier hs-var">mkNameSet</span></a></span><span> </span><span class="hs-special">[</span><span class="annot"><span class="annottext">GlobalRdrElt -&gt; Name
</span><a href="GHC.Types.Name.Reader.html#greMangledName"><span class="hs-identifier hs-var">greMangledName</span></a></span><span> </span><span class="annot"><span class="annottext">GlobalRdrElt
</span><a href="#local-6989586621681353558"><span class="hs-identifier hs-var">gre</span></a></span><span> </span><span class="hs-glyph">|</span><span> </span><span id="local-6989586621681353558"><span class="annot"><span class="annottext">GlobalRdrElt
</span><a href="#local-6989586621681353558"><span class="hs-identifier hs-var">gre</span></a></span></span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">GlobalRdrEnv -&gt; [GlobalRdrElt]
</span><a href="GHC.Types.Name.Reader.html#globalRdrEnvElts"><span class="hs-identifier hs-var">globalRdrEnvElts</span></a></span><span> </span><span class="annot"><span class="annottext">GlobalRdrEnv
</span><a href="#local-6989586621681353563"><span class="hs-identifier hs-var">gbl_rdr</span></a></span><span>
</span><span id="line-443"></span><span>                                                     </span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">GlobalRdrElt -&gt; Bool
</span><a href="GHC.Types.Name.Reader.html#isLocalGRE"><span class="hs-identifier hs-var">isLocalGRE</span></a></span><span> </span><span class="annot"><span class="annottext">GlobalRdrElt
</span><a href="#local-6989586621681353558"><span class="hs-identifier hs-var">gre</span></a></span><span class="hs-special">]</span><span>
</span><span id="line-444"></span><span>                 </span><span id="local-6989586621681353555"><span class="annot"><span class="annottext">lcl_names :: Uses
</span><a href="#local-6989586621681353555"><span class="hs-identifier hs-var hs-var">lcl_names</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">[Name] -&gt; Uses
</span><a href="GHC.Types.Name.Set.html#mkNameSet"><span class="hs-identifier hs-var">mkNameSet</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">LocalRdrEnv -&gt; [Name]
</span><a href="GHC.Types.Name.Reader.html#localRdrEnvElts"><span class="hs-identifier hs-var">localRdrEnvElts</span></a></span><span> </span><span class="annot"><span class="annottext">LocalRdrEnv
</span><a href="#local-6989586621681353565"><span class="hs-identifier hs-var">lcl_rdr</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-445"></span><span>
</span><span id="line-446"></span><span>           </span><span class="hs-special">;</span><span> </span><span class="annot"><span class="annottext">forall (m :: * -&gt; *) a. Monad m =&gt; a -&gt; m a
</span><a href="../../base-4.16.4.0/src/GHC-Base.html#return"><span class="hs-identifier hs-var">return</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">forall p. XSpliceE p -&gt; HsSplice p -&gt; HsExpr p
</span><a href="Language.Haskell.Syntax.Expr.html#HsSpliceE"><span class="hs-identifier hs-var">HsSpliceE</span></a></span><span> </span><span class="annot"><span class="annottext">forall a. EpAnn a
</span><a href="GHC.Parser.Annotation.html#noAnn"><span class="hs-identifier hs-var">noAnn</span></a></span><span> </span><span class="annot"><span class="annottext">HsSplice (GhcPass 'Renamed)
</span><a href="#local-6989586621681353566"><span class="hs-identifier hs-var">rn_splice</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">Uses
</span><a href="#local-6989586621681353555"><span class="hs-identifier hs-var">lcl_names</span></a></span><span> </span><span class="annot"><span class="annottext">Uses -&gt; Uses -&gt; Uses
</span><a href="GHC.Types.Name.Set.html#plusFV"><span class="hs-operator hs-var">`plusFV`</span></a></span><span> </span><span class="annot"><span class="annottext">Uses
</span><a href="#local-6989586621681353561"><span class="hs-identifier hs-var">gbl_names</span></a></span><span class="hs-special">)</span><span> </span><span class="hs-special">}</span><span>
</span><span id="line-447"></span><span>
</span><span id="line-448"></span><span>      </span><span class="hs-glyph">|</span><span> </span><span class="annot"><span class="annottext">Bool
</span><a href="../../base-4.16.4.0/src/GHC-Base.html#otherwise"><span class="hs-identifier hs-var">otherwise</span></a></span><span>  </span><span class="hs-comment">-- Run it here, see Note [Running splices in the Renamer]</span><span>
</span><span id="line-449"></span><span>      </span><span class="hs-glyph">=</span><span> </span><span class="hs-keyword">do</span><span> </span><span class="hs-special">{</span><span> </span><span class="annot"><span class="annottext">String -&gt; SDoc -&gt; IOEnv (Env TcGblEnv TcLclEnv) ()
</span><a href="GHC.Tc.Utils.Monad.html#traceRn"><span class="hs-identifier hs-var">traceRn</span></a></span><span> </span><span class="annot"><span class="annottext">String
</span><span class="hs-string">&quot;rnSpliceExpr: untyped expression splice&quot;</span></span><span> </span><span class="annot"><span class="annottext">SDoc
</span><a href="GHC.Utils.Outputable.html#empty"><span class="hs-identifier hs-var">empty</span></a></span><span>
</span><span id="line-450"></span><span>           </span><span class="hs-special">;</span><span> </span><span class="hs-special">(</span><span id="local-6989586621681353553"><span class="annot"><span class="annottext">GenLocated SrcSpanAnnA (HsExpr GhcPs)
</span><a href="#local-6989586621681353553"><span class="hs-identifier hs-var">rn_expr</span></a></span></span><span class="hs-special">,</span><span> </span><span id="local-6989586621681353552"><span class="annot"><span class="annottext">[ForeignRef (Q ())]
</span><a href="#local-6989586621681353552"><span class="hs-identifier hs-var">mod_finalizers</span></a></span></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">&lt;-</span><span>
</span><span id="line-451"></span><span>                </span><span class="annot"><span class="annottext">forall res.
UntypedSpliceFlavour
-&gt; (LHsExpr GhcTc -&gt; TcRn res)
-&gt; (res -&gt; SDoc)
-&gt; HsSplice (GhcPass 'Renamed)
-&gt; TcRn (res, [ForeignRef (Q ())])
</span><a href="GHC.Rename.Splice.html#runRnSplice"><span class="hs-identifier hs-var">runRnSplice</span></a></span><span> </span><span class="annot"><span class="annottext">UntypedSpliceFlavour
</span><a href="Language.Haskell.Syntax.Expr.html#UntypedExpSplice"><span class="hs-identifier hs-var">UntypedExpSplice</span></a></span><span> </span><span class="annot"><span class="annottext">LHsExpr GhcTc -&gt; TcM (LHsExpr GhcPs)
</span><a href="GHC.Tc.Gen.Splice.html#runMetaE"><span class="hs-identifier hs-var">runMetaE</span></a></span><span> </span><span class="annot"><span class="annottext">forall a. Outputable a =&gt; a -&gt; SDoc
</span><a href="GHC.Utils.Outputable.html#ppr"><span class="hs-identifier hs-var">ppr</span></a></span><span> </span><span class="annot"><span class="annottext">HsSplice (GhcPass 'Renamed)
</span><a href="#local-6989586621681353566"><span class="hs-identifier hs-var">rn_splice</span></a></span><span>
</span><span id="line-452"></span><span>           </span><span class="hs-special">;</span><span> </span><span class="hs-special">(</span><span id="local-6989586621681353551"><span class="annot"><span class="annottext">GenLocated SrcSpanAnnA (HsExpr (GhcPass 'Renamed))
</span><a href="#local-6989586621681353551"><span class="hs-identifier hs-var">lexpr3</span></a></span></span><span class="hs-special">,</span><span> </span><span id="local-6989586621681353550"><span class="annot"><span class="annottext">Uses
</span><a href="#local-6989586621681353550"><span class="hs-identifier hs-var">fvs</span></a></span></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">forall r. TcM r -&gt; TcM r
</span><a href="GHC.Tc.Utils.Monad.html#checkNoErrs"><span class="hs-identifier hs-var">checkNoErrs</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">LHsExpr GhcPs -&gt; RnM (LHsExpr (GhcPass 'Renamed), Uses)
</span><a href="GHC.Rename.Expr.html#rnLExpr"><span class="hs-identifier hs-var">rnLExpr</span></a></span><span> </span><span class="annot"><span class="annottext">GenLocated SrcSpanAnnA (HsExpr GhcPs)
</span><a href="#local-6989586621681353553"><span class="hs-identifier hs-var">rn_expr</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-453"></span><span>             </span><span class="hs-comment">-- See Note [Delaying modFinalizers in untyped splices].</span><span>
</span><span id="line-454"></span><span>           </span><span class="hs-special">;</span><span> </span><span class="annot"><span class="annottext">forall (m :: * -&gt; *) a. Monad m =&gt; a -&gt; m a
</span><a href="../../base-4.16.4.0/src/GHC-Base.html#return"><span class="hs-identifier hs-var">return</span></a></span><span> </span><span class="hs-special">(</span><span> </span><span class="annot"><span class="annottext">forall p. XPar p -&gt; LHsExpr p -&gt; HsExpr p
</span><a href="Language.Haskell.Syntax.Expr.html#HsPar"><span class="hs-identifier hs-var">HsPar</span></a></span><span> </span><span class="annot"><span class="annottext">forall a. EpAnn a
</span><a href="GHC.Parser.Annotation.html#noAnn"><span class="hs-identifier hs-var">noAnn</span></a></span><span> </span><span class="annot"><span class="annottext">forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><a href="../../base-4.16.4.0/src/GHC-Base.html#%24"><span class="hs-operator hs-var">$</span></a></span><span> </span><span class="annot"><span class="annottext">forall p. XSpliceE p -&gt; HsSplice p -&gt; HsExpr p
</span><a href="Language.Haskell.Syntax.Expr.html#HsSpliceE"><span class="hs-identifier hs-var">HsSpliceE</span></a></span><span> </span><span class="annot"><span class="annottext">forall a. EpAnn a
</span><a href="GHC.Parser.Annotation.html#noAnn"><span class="hs-identifier hs-var">noAnn</span></a></span><span>
</span><span id="line-455"></span><span>                            </span><span class="annot"><span class="annottext">forall b c a. (b -&gt; c) -&gt; (a -&gt; b) -&gt; a -&gt; c
</span><a href="../../base-4.16.4.0/src/GHC-Base.html#."><span class="hs-operator hs-var">.</span></a></span><span> </span><span class="annot"><span class="annottext">forall id.
XSpliced id -&gt; ThModFinalizers -&gt; HsSplicedThing id -&gt; HsSplice id
</span><a href="Language.Haskell.Syntax.Expr.html#HsSpliced"><span class="hs-identifier hs-var">HsSpliced</span></a></span><span> </span><span class="annot"><span class="annottext">NoExtField
</span><a href="Language.Haskell.Syntax.Extension.html#noExtField"><span class="hs-identifier hs-var">noExtField</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">[ForeignRef (Q ())] -&gt; ThModFinalizers
</span><a href="Language.Haskell.Syntax.Expr.html#ThModFinalizers"><span class="hs-identifier hs-var">ThModFinalizers</span></a></span><span> </span><span class="annot"><span class="annottext">[ForeignRef (Q ())]
</span><a href="#local-6989586621681353552"><span class="hs-identifier hs-var">mod_finalizers</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-456"></span><span>                            </span><span class="annot"><span class="annottext">forall b c a. (b -&gt; c) -&gt; (a -&gt; b) -&gt; a -&gt; c
</span><a href="../../base-4.16.4.0/src/GHC-Base.html#."><span class="hs-operator hs-var">.</span></a></span><span> </span><span class="annot"><span class="annottext">forall id. HsExpr id -&gt; HsSplicedThing id
</span><a href="Language.Haskell.Syntax.Expr.html#HsSplicedExpr"><span class="hs-identifier hs-var">HsSplicedExpr</span></a></span><span> </span><span class="annot"><span class="annottext">forall (f :: * -&gt; *) a b. Functor f =&gt; (a -&gt; b) -&gt; f a -&gt; f b
</span><a href="../../base-4.16.4.0/src/Data-Functor.html#%3C%24%3E"><span class="hs-operator hs-var">&lt;$&gt;</span></a></span><span>
</span><span id="line-457"></span><span>                            </span><span class="annot"><span class="annottext">GenLocated SrcSpanAnnA (HsExpr (GhcPass 'Renamed))
</span><a href="#local-6989586621681353551"><span class="hs-identifier hs-var">lexpr3</span></a></span><span>
</span><span id="line-458"></span><span>                    </span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">Uses
</span><a href="#local-6989586621681353550"><span class="hs-identifier hs-var">fvs</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-459"></span><span>           </span><span class="hs-special">}</span><span>
</span><span id="line-460"></span><span>
</span><span id="line-461"></span><span class="hs-comment">{- Note [Running splices in the Renamer]
~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~

Splices used to be run in the typechecker, which led to (#4364). Since the
renamer must decide which expressions depend on which others, and it cannot
reliably do this for arbitrary splices, we used to conservatively say that
splices depend on all other expressions in scope. Unfortunately, this led to
the problem of cyclic type declarations seen in (#4364). Instead, by
running splices in the renamer, we side-step the problem of determining
dependencies: by the time the dependency analysis happens, any splices have
already been run, and expression dependencies can be determined as usual.

However, see (#9813), for an example where we would like to run splices
*after* performing dependency analysis (that is, after renaming). It would be
desirable to typecheck &quot;non-splicy&quot; expressions (those expressions that do not
contain splices directly or via dependence on an expression that does) before
&quot;splicy&quot; expressions, such that types/expressions within the same declaration
group would be available to `reify` calls, for example consider the following:

&gt; module M where
&gt;   data D = C
&gt;   f = 1
&gt;   g = $(mapM reify ['f, 'D, ''C] ...)

Compilation of this example fails since D/C/f are not in the type environment
and thus cannot be reified as they have not been typechecked by the time the
splice is renamed and thus run.

These requirements are at odds: we do not want to run splices in the renamer as
we wish to first determine dependencies and typecheck certain expressions,
making them available to reify, but cannot accurately determine dependencies
without running splices in the renamer!

Indeed, the conclusion of (#9813) was that it is not worth the complexity
to try and
 a) implement and maintain the code for renaming/typechecking non-splicy
    expressions before splicy expressions,
 b) explain to TH users which expressions are/not available to reify at any
    given point.

-}</span><span>
</span><span id="line-502"></span><span>
</span><span id="line-503"></span><span class="hs-comment">{- Note [Rebindable syntax and Template Haskell]
~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~
When processing Template Haskell quotes with Rebindable Syntax (RS) enabled,
there are two possibilities: apply the RS rules to the quotes or don't.

One might expect that with {-# LANGUAGE RebindableSyntax #-} at the top of a
module, any 'if' expression would end up being turned into a call to whatever
'ifThenElse' function is in scope, regardless of whether the said if expression
appears in &quot;normal&quot; Haskell code or in a TH quote. This however comes with its
problems. Consider the following code:

  {-# LANGUAGE TemplateHaskell, RebindableSyntax #-}

  module X where

  import Prelude ( Monad(..), Bool(..), print, ($) )
  import Language.Haskell.TH.Syntax

  $( do stuff &lt;- [| if True then 10 else 15 |]
        runIO $ print stuff
        return [] )

If we apply the RS rules, then GHC would complain about not having suitable
fromInteger/ifThenElse functions in scope. But this quote is just a bit of
Haskell syntax that has yet to be used, or, to put it differently, placed
(spliced) in some context where the said functions might be available. More
generally, untyped TH quotes are meant to work with yet-unbound identifiers.
This tends to show that untyped TH and Rebindable Syntax overall don't play
well together. Users still have the option to splice &quot;normal&quot; if expressions
into modules where RS is enabled, to turn them into applications of
an 'ifThenElse' function of their choice.

Typed TH (TTH) quotes, on the other hand, come with different constraints. They
don't quite have this &quot;delayed&quot; nature: we typecheck them while processing
them, and TTH users expect RS to Just Work in their quotes, exactly like it does
outside of the quotes. There, we do not have to accept unbound identifiers and
we can apply the RS rules both in the typechecking and desugaring of the quotes
without triggering surprising/bad behaviour for users. For instance, the
following code is expected to be rejected (because of the lack of suitable
'fromInteger'/'ifThenElse' functions in scope):

  {-# LANGUAGE TemplateHaskell, RebindableSyntax #-}

  module X where

  import Prelude ( Monad(..), Bool(..), print, ($) )
  import Language.Haskell.TH.Syntax

  $$( do stuff &lt;- [|| if True then 10 else 15 ||]
         runIO $ print stuff
         return [] )

The conclusion is that even if RS is enabled for a given module, GHC disables it
when processing untyped TH quotes from that module, to avoid the aforementioned
problems, but keeps it on while processing typed TH quotes.

This note and approach originated in #18102.

-}</span><span>
</span><span id="line-562"></span><span>
</span><span id="line-563"></span><span class="hs-comment">{- Note [Delaying modFinalizers in untyped splices]
~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~

When splices run in the renamer, 'reify' does not have access to the local
type environment (#11832, [1]).

For instance, in

&gt; let x = e in $(reify (mkName &quot;x&quot;) &gt;&gt;= runIO . print &gt;&gt; [| return () |])

'reify' cannot find @x@, because the local type environment is not yet
populated. To address this, we allow 'reify' execution to be deferred with
'addModFinalizer'.

&gt; let x = e in $(do addModFinalizer (reify (mkName &quot;x&quot;) &gt;&gt;= runIO . print)
                    [| return () |]
                )

The finalizer is run with the local type environment when type checking is
complete.

Since the local type environment is not available in the renamer, we annotate
the tree at the splice point [2] with @HsSpliceE (HsSpliced finalizers e)@ where
@e@ is the result of splicing and @finalizers@ are the finalizers that have been
collected during evaluation of the splice [3]. In our example,

&gt; HsLet
&gt;   (x = e)
&gt;   (HsSpliceE $ HsSpliced [reify (mkName &quot;x&quot;) &gt;&gt;= runIO . print]
&gt;                          (HsSplicedExpr $ return ())
&gt;   )

When the typechecker finds the annotation, it inserts the finalizers in the
global environment and exposes the current local environment to them [4, 5, 6].

&gt; addModFinalizersWithLclEnv [reify (mkName &quot;x&quot;) &gt;&gt;= runIO . print]

References:

[1] https://gitlab.haskell.org/ghc/ghc/wikis/template-haskell/reify
[2] 'rnSpliceExpr'
[3] 'GHC.Tc.Gen.Splice.qAddModFinalizer'
[4] 'GHC.Tc.Gen.Expr.tcExpr' ('HsSpliceE' ('HsSpliced' ...))
[5] 'GHC.Tc.Gen.HsType.tc_hs_type' ('HsSpliceTy' ('HsSpliced' ...))
[6] 'GHC.Tc.Gen.Pat.tc_pat' ('SplicePat' ('HsSpliced' ...))

-}</span><span>
</span><span id="line-610"></span><span>
</span><span id="line-611"></span><span class="hs-comment">----------------------</span><span>
</span><span id="line-612"></span><span class="annot"><a href="GHC.Rename.Splice.html#rnSpliceType"><span class="hs-identifier hs-type">rnSpliceType</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><a href="Language.Haskell.Syntax.Expr.html#HsSplice"><span class="hs-identifier hs-type">HsSplice</span></a></span><span> </span><span class="annot"><a href="GHC.Hs.Extension.html#GhcPs"><span class="hs-identifier hs-type">GhcPs</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="GHC.Tc.Types.html#RnM"><span class="hs-identifier hs-type">RnM</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="Language.Haskell.Syntax.Type.html#HsType"><span class="hs-identifier hs-type">HsType</span></a></span><span> </span><span class="annot"><a href="GHC.Hs.Extension.html#GhcRn"><span class="hs-identifier hs-type">GhcRn</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><a href="GHC.Types.Name.Set.html#FreeVars"><span class="hs-identifier hs-type">FreeVars</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-613"></span><span id="rnSpliceType"><span class="annot"><span class="annottext">rnSpliceType :: HsSplice GhcPs -&gt; RnM (HsType (GhcPass 'Renamed), Uses)
</span><a href="GHC.Rename.Splice.html#rnSpliceType"><span class="hs-identifier hs-var hs-var">rnSpliceType</span></a></span></span><span> </span><span id="local-6989586621681353545"><span class="annot"><span class="annottext">HsSplice GhcPs
</span><a href="#local-6989586621681353545"><span class="hs-identifier hs-var">splice</span></a></span></span><span>
</span><span id="line-614"></span><span>  </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">forall a.
(HsSplice (GhcPass 'Renamed) -&gt; RnM (a, Uses))
-&gt; (HsSplice (GhcPass 'Renamed) -&gt; (PendingRnSplice, a))
-&gt; HsSplice GhcPs
-&gt; RnM (a, Uses)
</span><a href="GHC.Rename.Splice.html#rnSpliceGen"><span class="hs-identifier hs-var">rnSpliceGen</span></a></span><span> </span><span class="annot"><span class="annottext">HsSplice (GhcPass 'Renamed)
-&gt; RnM (HsType (GhcPass 'Renamed), Uses)
</span><a href="#local-6989586621681353544"><span class="hs-identifier hs-var">run_type_splice</span></a></span><span> </span><span class="annot"><span class="annottext">HsSplice (GhcPass 'Renamed)
-&gt; (PendingRnSplice, HsType (GhcPass 'Renamed))
</span><a href="#local-6989586621681353543"><span class="hs-identifier hs-var">pend_type_splice</span></a></span><span> </span><span class="annot"><span class="annottext">HsSplice GhcPs
</span><a href="#local-6989586621681353545"><span class="hs-identifier hs-var">splice</span></a></span><span>
</span><span id="line-615"></span><span>  </span><span class="hs-keyword">where</span><span>
</span><span id="line-616"></span><span>    </span><span id="local-6989586621681353543"><span class="annot"><span class="annottext">pend_type_splice :: HsSplice (GhcPass 'Renamed)
-&gt; (PendingRnSplice, HsType (GhcPass 'Renamed))
</span><a href="#local-6989586621681353543"><span class="hs-identifier hs-var hs-var">pend_type_splice</span></a></span></span><span> </span><span id="local-6989586621681353542"><span class="annot"><span class="annottext">HsSplice (GhcPass 'Renamed)
</span><a href="#local-6989586621681353542"><span class="hs-identifier hs-var">rn_splice</span></a></span></span><span>
</span><span id="line-617"></span><span>       </span><span class="hs-glyph">=</span><span> </span><span class="hs-special">(</span><span> </span><span class="annot"><span class="annottext">UntypedSpliceFlavour
-&gt; HsSplice (GhcPass 'Renamed) -&gt; PendingRnSplice
</span><a href="GHC.Rename.Splice.html#makePending"><span class="hs-identifier hs-var">makePending</span></a></span><span> </span><span class="annot"><span class="annottext">UntypedSpliceFlavour
</span><a href="Language.Haskell.Syntax.Expr.html#UntypedTypeSplice"><span class="hs-identifier hs-var">UntypedTypeSplice</span></a></span><span> </span><span class="annot"><span class="annottext">HsSplice (GhcPass 'Renamed)
</span><a href="#local-6989586621681353542"><span class="hs-identifier hs-var">rn_splice</span></a></span><span>
</span><span id="line-618"></span><span>         </span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">forall pass. XSpliceTy pass -&gt; HsSplice pass -&gt; HsType pass
</span><a href="Language.Haskell.Syntax.Type.html#HsSpliceTy"><span class="hs-identifier hs-var">HsSpliceTy</span></a></span><span> </span><span class="annot"><span class="annottext">NoExtField
</span><a href="Language.Haskell.Syntax.Extension.html#noExtField"><span class="hs-identifier hs-var">noExtField</span></a></span><span> </span><span class="annot"><span class="annottext">HsSplice (GhcPass 'Renamed)
</span><a href="#local-6989586621681353542"><span class="hs-identifier hs-var">rn_splice</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-619"></span><span>
</span><span id="line-620"></span><span>    </span><span id="local-6989586621681353544"><span class="annot"><span class="annottext">run_type_splice :: HsSplice (GhcPass 'Renamed)
-&gt; RnM (HsType (GhcPass 'Renamed), Uses)
</span><a href="#local-6989586621681353544"><span class="hs-identifier hs-var hs-var">run_type_splice</span></a></span></span><span> </span><span id="local-6989586621681353520"><span class="annot"><span class="annottext">HsSplice (GhcPass 'Renamed)
</span><a href="#local-6989586621681353520"><span class="hs-identifier hs-var">rn_splice</span></a></span></span><span>
</span><span id="line-621"></span><span>      </span><span class="hs-glyph">=</span><span> </span><span class="hs-keyword">do</span><span> </span><span class="hs-special">{</span><span> </span><span class="annot"><span class="annottext">String -&gt; SDoc -&gt; IOEnv (Env TcGblEnv TcLclEnv) ()
</span><a href="GHC.Tc.Utils.Monad.html#traceRn"><span class="hs-identifier hs-var">traceRn</span></a></span><span> </span><span class="annot"><span class="annottext">String
</span><span class="hs-string">&quot;rnSpliceType: untyped type splice&quot;</span></span><span> </span><span class="annot"><span class="annottext">SDoc
</span><a href="GHC.Utils.Outputable.html#empty"><span class="hs-identifier hs-var">empty</span></a></span><span>
</span><span id="line-622"></span><span>           </span><span class="hs-special">;</span><span> </span><span class="hs-special">(</span><span id="local-6989586621681353519"><span class="annot"><span class="annottext">GenLocated SrcSpanAnnA (HsType GhcPs)
</span><a href="#local-6989586621681353519"><span class="hs-identifier hs-var">hs_ty2</span></a></span></span><span class="hs-special">,</span><span> </span><span id="local-6989586621681353518"><span class="annot"><span class="annottext">[ForeignRef (Q ())]
</span><a href="#local-6989586621681353518"><span class="hs-identifier hs-var">mod_finalizers</span></a></span></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">&lt;-</span><span>
</span><span id="line-623"></span><span>                </span><span class="annot"><span class="annottext">forall res.
UntypedSpliceFlavour
-&gt; (LHsExpr GhcTc -&gt; TcRn res)
-&gt; (res -&gt; SDoc)
-&gt; HsSplice (GhcPass 'Renamed)
-&gt; TcRn (res, [ForeignRef (Q ())])
</span><a href="GHC.Rename.Splice.html#runRnSplice"><span class="hs-identifier hs-var">runRnSplice</span></a></span><span> </span><span class="annot"><span class="annottext">UntypedSpliceFlavour
</span><a href="Language.Haskell.Syntax.Expr.html#UntypedTypeSplice"><span class="hs-identifier hs-var">UntypedTypeSplice</span></a></span><span> </span><span class="annot"><span class="annottext">LHsExpr GhcTc -&gt; TcM (LHsType GhcPs)
</span><a href="GHC.Tc.Gen.Splice.html#runMetaT"><span class="hs-identifier hs-var">runMetaT</span></a></span><span> </span><span class="annot"><span class="annottext">forall a. Outputable a =&gt; a -&gt; SDoc
</span><a href="GHC.Utils.Outputable.html#ppr"><span class="hs-identifier hs-var">ppr</span></a></span><span> </span><span class="annot"><span class="annottext">HsSplice (GhcPass 'Renamed)
</span><a href="#local-6989586621681353520"><span class="hs-identifier hs-var">rn_splice</span></a></span><span>
</span><span id="line-624"></span><span>           </span><span class="hs-special">;</span><span> </span><span class="hs-special">(</span><span id="local-6989586621681353517"><span class="annot"><span class="annottext">GenLocated SrcSpanAnnA (HsType (GhcPass 'Renamed))
</span><a href="#local-6989586621681353517"><span class="hs-identifier hs-var">hs_ty3</span></a></span></span><span class="hs-special">,</span><span> </span><span id="local-6989586621681353516"><span class="annot"><span class="annottext">Uses
</span><a href="#local-6989586621681353516"><span class="hs-identifier hs-var">fvs</span></a></span></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="hs-keyword">do</span><span> </span><span class="hs-special">{</span><span> </span><span class="hs-keyword">let</span><span> </span><span id="local-6989586621681353515"><span class="annot"><span class="annottext">doc :: HsDocContext
</span><a href="#local-6989586621681353515"><span class="hs-identifier hs-var hs-var">doc</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">LHsType GhcPs -&gt; HsDocContext
</span><a href="GHC.Rename.Utils.html#SpliceTypeCtx"><span class="hs-identifier hs-var">SpliceTypeCtx</span></a></span><span> </span><span class="annot"><span class="annottext">GenLocated SrcSpanAnnA (HsType GhcPs)
</span><a href="#local-6989586621681353519"><span class="hs-identifier hs-var">hs_ty2</span></a></span><span>
</span><span id="line-625"></span><span>                                 </span><span class="hs-special">;</span><span> </span><span class="annot"><span class="annottext">forall r. TcM r -&gt; TcM r
</span><a href="GHC.Tc.Utils.Monad.html#checkNoErrs"><span class="hs-identifier hs-var">checkNoErrs</span></a></span><span> </span><span class="annot"><span class="annottext">forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><a href="../../base-4.16.4.0/src/GHC-Base.html#%24"><span class="hs-operator hs-var">$</span></a></span><span> </span><span class="annot"><span class="annottext">HsDocContext
-&gt; LHsType GhcPs -&gt; RnM (LHsType (GhcPass 'Renamed), Uses)
</span><a href="GHC.Rename.HsType.html#rnLHsType"><span class="hs-identifier hs-var">rnLHsType</span></a></span><span> </span><span class="annot"><span class="annottext">HsDocContext
</span><a href="#local-6989586621681353515"><span class="hs-identifier hs-var">doc</span></a></span><span> </span><span class="annot"><span class="annottext">GenLocated SrcSpanAnnA (HsType GhcPs)
</span><a href="#local-6989586621681353519"><span class="hs-identifier hs-var">hs_ty2</span></a></span><span> </span><span class="hs-special">}</span><span>
</span><span id="line-626"></span><span>                                    </span><span class="hs-comment">-- checkNoErrs: see Note [Renamer errors]</span><span>
</span><span id="line-627"></span><span>             </span><span class="hs-comment">-- See Note [Delaying modFinalizers in untyped splices].</span><span>
</span><span id="line-628"></span><span>           </span><span class="hs-special">;</span><span> </span><span class="annot"><span class="annottext">forall (m :: * -&gt; *) a. Monad m =&gt; a -&gt; m a
</span><a href="../../base-4.16.4.0/src/GHC-Base.html#return"><span class="hs-identifier hs-var">return</span></a></span><span> </span><span class="hs-special">(</span><span> </span><span class="annot"><span class="annottext">forall pass. XParTy pass -&gt; LHsType pass -&gt; HsType pass
</span><a href="Language.Haskell.Syntax.Type.html#HsParTy"><span class="hs-identifier hs-var">HsParTy</span></a></span><span> </span><span class="annot"><span class="annottext">forall a. EpAnn a
</span><a href="GHC.Parser.Annotation.html#noAnn"><span class="hs-identifier hs-var">noAnn</span></a></span><span>
</span><span id="line-629"></span><span>                              </span><span class="annot"><span class="annottext">forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><a href="../../base-4.16.4.0/src/GHC-Base.html#%24"><span class="hs-operator hs-var">$</span></a></span><span> </span><span class="annot"><span class="annottext">forall pass. XSpliceTy pass -&gt; HsSplice pass -&gt; HsType pass
</span><a href="Language.Haskell.Syntax.Type.html#HsSpliceTy"><span class="hs-identifier hs-var">HsSpliceTy</span></a></span><span> </span><span class="annot"><span class="annottext">NoExtField
</span><a href="Language.Haskell.Syntax.Extension.html#noExtField"><span class="hs-identifier hs-var">noExtField</span></a></span><span>
</span><span id="line-630"></span><span>                              </span><span class="annot"><span class="annottext">forall b c a. (b -&gt; c) -&gt; (a -&gt; b) -&gt; a -&gt; c
</span><a href="../../base-4.16.4.0/src/GHC-Base.html#."><span class="hs-operator hs-var">.</span></a></span><span> </span><span class="annot"><span class="annottext">forall id.
XSpliced id -&gt; ThModFinalizers -&gt; HsSplicedThing id -&gt; HsSplice id
</span><a href="Language.Haskell.Syntax.Expr.html#HsSpliced"><span class="hs-identifier hs-var">HsSpliced</span></a></span><span> </span><span class="annot"><span class="annottext">NoExtField
</span><a href="Language.Haskell.Syntax.Extension.html#noExtField"><span class="hs-identifier hs-var">noExtField</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">[ForeignRef (Q ())] -&gt; ThModFinalizers
</span><a href="Language.Haskell.Syntax.Expr.html#ThModFinalizers"><span class="hs-identifier hs-var">ThModFinalizers</span></a></span><span> </span><span class="annot"><span class="annottext">[ForeignRef (Q ())]
</span><a href="#local-6989586621681353518"><span class="hs-identifier hs-var">mod_finalizers</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-631"></span><span>                              </span><span class="annot"><span class="annottext">forall b c a. (b -&gt; c) -&gt; (a -&gt; b) -&gt; a -&gt; c
</span><a href="../../base-4.16.4.0/src/GHC-Base.html#."><span class="hs-operator hs-var">.</span></a></span><span> </span><span class="annot"><span class="annottext">forall id. HsType id -&gt; HsSplicedThing id
</span><a href="Language.Haskell.Syntax.Expr.html#HsSplicedTy"><span class="hs-identifier hs-var">HsSplicedTy</span></a></span><span> </span><span class="annot"><span class="annottext">forall (f :: * -&gt; *) a b. Functor f =&gt; (a -&gt; b) -&gt; f a -&gt; f b
</span><a href="../../base-4.16.4.0/src/Data-Functor.html#%3C%24%3E"><span class="hs-operator hs-var">&lt;$&gt;</span></a></span><span>
</span><span id="line-632"></span><span>                              </span><span class="annot"><span class="annottext">GenLocated SrcSpanAnnA (HsType (GhcPass 'Renamed))
</span><a href="#local-6989586621681353517"><span class="hs-identifier hs-var">hs_ty3</span></a></span><span>
</span><span id="line-633"></span><span>                    </span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">Uses
</span><a href="#local-6989586621681353516"><span class="hs-identifier hs-var">fvs</span></a></span><span>
</span><span id="line-634"></span><span>                    </span><span class="hs-special">)</span><span> </span><span class="hs-special">}</span><span>
</span><span id="line-635"></span><span>              </span><span class="hs-comment">-- Wrap the result of the splice in parens so that we don't</span><span>
</span><span id="line-636"></span><span>              </span><span class="hs-comment">-- lose the outermost location set by runQuasiQuote (#7918)</span><span>
</span><span id="line-637"></span><span>
</span><span id="line-638"></span><span class="hs-comment">{- Note [Partial Type Splices]
~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~
Partial Type Signatures are partially supported in TH type splices: only
anonymous wild cards are allowed.

  -- ToDo: SLPJ says: I don't understand all this

Normally, named wild cards are collected before renaming a (partial) type
signature. However, TH type splices are run during renaming, i.e. after the
initial traversal, leading to out of scope errors for named wild cards. We
can't just extend the initial traversal to collect the named wild cards in TH
type splices, as we'd need to expand them, which is supposed to happen only
once, during renaming.

Similarly, the extra-constraints wild card is handled right before renaming
too, and is therefore also not supported in a TH type splice. Another reason
to forbid extra-constraints wild cards in TH type splices is that a single
signature can contain many TH type splices, whereas it mustn't contain more
than one extra-constraints wild card. Enforcing would this be hard the way
things are currently organised.

Anonymous wild cards pose no problem, because they start out without names and
are given names during renaming. These names are collected right after
renaming. The names generated for anonymous wild cards in TH type splices will
thus be collected as well.

For more details about renaming wild cards, see GHC.Rename.HsType.rnHsSigWcType

Note that partial type signatures are fully supported in TH declaration
splices, e.g.:

     [d| foo :: _ =&gt; _
         foo x y = x == y |]

This is because in this case, the partial type signature can be treated as a
whole signature, instead of as an arbitrary type.

-}</span><span>
</span><span id="line-676"></span><span>
</span><span id="line-677"></span><span>
</span><span id="line-678"></span><span class="hs-comment">----------------------</span><span>
</span><span id="line-679"></span><span class="hs-comment">-- | Rename a splice pattern. See Note [rnSplicePat]</span><span>
</span><span id="line-680"></span><span class="annot"><a href="GHC.Rename.Splice.html#rnSplicePat"><span class="hs-identifier hs-type">rnSplicePat</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><a href="Language.Haskell.Syntax.Expr.html#HsSplice"><span class="hs-identifier hs-type">HsSplice</span></a></span><span> </span><span class="annot"><a href="GHC.Hs.Extension.html#GhcPs"><span class="hs-identifier hs-type">GhcPs</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="GHC.Tc.Types.html#RnM"><span class="hs-identifier hs-type">RnM</span></a></span><span> </span><span class="hs-special">(</span><span> </span><span class="annot"><a href="../../base-4.16.4.0/src/Data-Either.html#Either"><span class="hs-identifier hs-type">Either</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="Language.Haskell.Syntax.Pat.html#Pat"><span class="hs-identifier hs-type">Pat</span></a></span><span> </span><span class="annot"><a href="GHC.Hs.Extension.html#GhcPs"><span class="hs-identifier hs-type">GhcPs</span></a></span><span class="hs-special">)</span><span> </span><span class="hs-special">(</span><span class="annot"><a href="Language.Haskell.Syntax.Pat.html#Pat"><span class="hs-identifier hs-type">Pat</span></a></span><span> </span><span class="annot"><a href="GHC.Hs.Extension.html#GhcRn"><span class="hs-identifier hs-type">GhcRn</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-681"></span><span>                                       </span><span class="hs-special">,</span><span> </span><span class="annot"><a href="GHC.Types.Name.Set.html#FreeVars"><span class="hs-identifier hs-type">FreeVars</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-682"></span><span id="rnSplicePat"><span class="annot"><span class="annottext">rnSplicePat :: HsSplice GhcPs
-&gt; RnM (Either (Pat GhcPs) (Pat (GhcPass 'Renamed)), Uses)
</span><a href="GHC.Rename.Splice.html#rnSplicePat"><span class="hs-identifier hs-var hs-var">rnSplicePat</span></a></span></span><span> </span><span id="local-6989586621681353511"><span class="annot"><span class="annottext">HsSplice GhcPs
</span><a href="#local-6989586621681353511"><span class="hs-identifier hs-var">splice</span></a></span></span><span>
</span><span id="line-683"></span><span>  </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">forall a.
(HsSplice (GhcPass 'Renamed) -&gt; RnM (a, Uses))
-&gt; (HsSplice (GhcPass 'Renamed) -&gt; (PendingRnSplice, a))
-&gt; HsSplice GhcPs
-&gt; RnM (a, Uses)
</span><a href="GHC.Rename.Splice.html#rnSpliceGen"><span class="hs-identifier hs-var">rnSpliceGen</span></a></span><span> </span><span class="annot"><span class="annottext">HsSplice (GhcPass 'Renamed)
-&gt; RnM (Either (Pat GhcPs) (Pat (GhcPass 'Renamed)), Uses)
</span><a href="#local-6989586621681353510"><span class="hs-identifier hs-var">run_pat_splice</span></a></span><span> </span><span class="annot"><span class="annottext">forall b.
HsSplice (GhcPass 'Renamed)
-&gt; (PendingRnSplice, Either b (Pat (GhcPass 'Renamed)))
</span><a href="#local-6989586621681353509"><span class="hs-identifier hs-var">pend_pat_splice</span></a></span><span> </span><span class="annot"><span class="annottext">HsSplice GhcPs
</span><a href="#local-6989586621681353511"><span class="hs-identifier hs-var">splice</span></a></span><span>
</span><span id="line-684"></span><span>  </span><span class="hs-keyword">where</span><span>
</span><span id="line-685"></span><span>    </span><span id="local-6989586621681354175"><span class="annot"><a href="#local-6989586621681353509"><span class="hs-identifier hs-type">pend_pat_splice</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><a href="Language.Haskell.Syntax.Expr.html#HsSplice"><span class="hs-identifier hs-type">HsSplice</span></a></span><span> </span><span class="annot"><a href="GHC.Hs.Extension.html#GhcRn"><span class="hs-identifier hs-type">GhcRn</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span>
</span><span id="line-686"></span><span>                       </span><span class="hs-special">(</span><span class="annot"><a href="GHC.Hs.Expr.html#PendingRnSplice"><span class="hs-identifier hs-type">PendingRnSplice</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><a href="../../base-4.16.4.0/src/Data-Either.html#Either"><span class="hs-identifier hs-type">Either</span></a></span><span> </span><span class="annot"><a href="#local-6989586621681354175"><span class="hs-identifier hs-type">b</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="Language.Haskell.Syntax.Pat.html#Pat"><span class="hs-identifier hs-type">Pat</span></a></span><span> </span><span class="annot"><a href="GHC.Hs.Extension.html#GhcRn"><span class="hs-identifier hs-type">GhcRn</span></a></span><span class="hs-special">)</span><span class="hs-special">)</span></span><span>
</span><span id="line-687"></span><span>    </span><span id="local-6989586621681353509"><span class="annot"><span class="annottext">pend_pat_splice :: forall b.
HsSplice (GhcPass 'Renamed)
-&gt; (PendingRnSplice, Either b (Pat (GhcPass 'Renamed)))
</span><a href="#local-6989586621681353509"><span class="hs-identifier hs-var hs-var">pend_pat_splice</span></a></span></span><span> </span><span id="local-6989586621681353508"><span class="annot"><span class="annottext">HsSplice (GhcPass 'Renamed)
</span><a href="#local-6989586621681353508"><span class="hs-identifier hs-var">rn_splice</span></a></span></span><span>
</span><span id="line-688"></span><span>      </span><span class="hs-glyph">=</span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">UntypedSpliceFlavour
-&gt; HsSplice (GhcPass 'Renamed) -&gt; PendingRnSplice
</span><a href="GHC.Rename.Splice.html#makePending"><span class="hs-identifier hs-var">makePending</span></a></span><span> </span><span class="annot"><span class="annottext">UntypedSpliceFlavour
</span><a href="Language.Haskell.Syntax.Expr.html#UntypedPatSplice"><span class="hs-identifier hs-var">UntypedPatSplice</span></a></span><span> </span><span class="annot"><span class="annottext">HsSplice (GhcPass 'Renamed)
</span><a href="#local-6989586621681353508"><span class="hs-identifier hs-var">rn_splice</span></a></span><span>
</span><span id="line-689"></span><span>        </span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">forall a b. b -&gt; Either a b
</span><a href="../../base-4.16.4.0/src/Data-Either.html#Right"><span class="hs-identifier hs-var">Right</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">forall p. XSplicePat p -&gt; HsSplice p -&gt; Pat p
</span><a href="Language.Haskell.Syntax.Pat.html#SplicePat"><span class="hs-identifier hs-var">SplicePat</span></a></span><span> </span><span class="annot"><span class="annottext">NoExtField
</span><a href="Language.Haskell.Syntax.Extension.html#noExtField"><span class="hs-identifier hs-var">noExtField</span></a></span><span> </span><span class="annot"><span class="annottext">HsSplice (GhcPass 'Renamed)
</span><a href="#local-6989586621681353508"><span class="hs-identifier hs-var">rn_splice</span></a></span><span class="hs-special">)</span><span class="hs-special">)</span><span>
</span><span id="line-690"></span><span>
</span><span id="line-691"></span><span>    </span><span class="annot"><a href="#local-6989586621681353510"><span class="hs-identifier hs-type">run_pat_splice</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><a href="Language.Haskell.Syntax.Expr.html#HsSplice"><span class="hs-identifier hs-type">HsSplice</span></a></span><span> </span><span class="annot"><a href="GHC.Hs.Extension.html#GhcRn"><span class="hs-identifier hs-type">GhcRn</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span>
</span><span id="line-692"></span><span>                      </span><span class="annot"><a href="GHC.Tc.Types.html#RnM"><span class="hs-identifier hs-type">RnM</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="../../base-4.16.4.0/src/Data-Either.html#Either"><span class="hs-identifier hs-type">Either</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="Language.Haskell.Syntax.Pat.html#Pat"><span class="hs-identifier hs-type">Pat</span></a></span><span> </span><span class="annot"><a href="GHC.Hs.Extension.html#GhcPs"><span class="hs-identifier hs-type">GhcPs</span></a></span><span class="hs-special">)</span><span> </span><span class="hs-special">(</span><span class="annot"><a href="Language.Haskell.Syntax.Pat.html#Pat"><span class="hs-identifier hs-type">Pat</span></a></span><span> </span><span class="annot"><a href="GHC.Hs.Extension.html#GhcRn"><span class="hs-identifier hs-type">GhcRn</span></a></span><span class="hs-special">)</span><span class="hs-special">,</span><span> </span><span class="annot"><a href="GHC.Types.Name.Set.html#FreeVars"><span class="hs-identifier hs-type">FreeVars</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-693"></span><span>    </span><span id="local-6989586621681353510"><span class="annot"><span class="annottext">run_pat_splice :: HsSplice (GhcPass 'Renamed)
-&gt; RnM (Either (Pat GhcPs) (Pat (GhcPass 'Renamed)), Uses)
</span><a href="#local-6989586621681353510"><span class="hs-identifier hs-var hs-var">run_pat_splice</span></a></span></span><span> </span><span id="local-6989586621681353506"><span class="annot"><span class="annottext">HsSplice (GhcPass 'Renamed)
</span><a href="#local-6989586621681353506"><span class="hs-identifier hs-var">rn_splice</span></a></span></span><span>
</span><span id="line-694"></span><span>      </span><span class="hs-glyph">=</span><span> </span><span class="hs-keyword">do</span><span> </span><span class="hs-special">{</span><span> </span><span class="annot"><span class="annottext">String -&gt; SDoc -&gt; IOEnv (Env TcGblEnv TcLclEnv) ()
</span><a href="GHC.Tc.Utils.Monad.html#traceRn"><span class="hs-identifier hs-var">traceRn</span></a></span><span> </span><span class="annot"><span class="annottext">String
</span><span class="hs-string">&quot;rnSplicePat: untyped pattern splice&quot;</span></span><span> </span><span class="annot"><span class="annottext">SDoc
</span><a href="GHC.Utils.Outputable.html#empty"><span class="hs-identifier hs-var">empty</span></a></span><span>
</span><span id="line-695"></span><span>           </span><span class="hs-special">;</span><span> </span><span class="hs-special">(</span><span id="local-6989586621681353505"><span class="annot"><span class="annottext">GenLocated SrcSpanAnnA (Pat GhcPs)
</span><a href="#local-6989586621681353505"><span class="hs-identifier hs-var">pat</span></a></span></span><span class="hs-special">,</span><span> </span><span id="local-6989586621681353504"><span class="annot"><span class="annottext">[ForeignRef (Q ())]
</span><a href="#local-6989586621681353504"><span class="hs-identifier hs-var">mod_finalizers</span></a></span></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">&lt;-</span><span>
</span><span id="line-696"></span><span>                </span><span class="annot"><span class="annottext">forall res.
UntypedSpliceFlavour
-&gt; (LHsExpr GhcTc -&gt; TcRn res)
-&gt; (res -&gt; SDoc)
-&gt; HsSplice (GhcPass 'Renamed)
-&gt; TcRn (res, [ForeignRef (Q ())])
</span><a href="GHC.Rename.Splice.html#runRnSplice"><span class="hs-identifier hs-var">runRnSplice</span></a></span><span> </span><span class="annot"><span class="annottext">UntypedSpliceFlavour
</span><a href="Language.Haskell.Syntax.Expr.html#UntypedPatSplice"><span class="hs-identifier hs-var">UntypedPatSplice</span></a></span><span> </span><span class="annot"><span class="annottext">LHsExpr GhcTc -&gt; TcM (LPat GhcPs)
</span><a href="GHC.Tc.Gen.Splice.html#runMetaP"><span class="hs-identifier hs-var">runMetaP</span></a></span><span> </span><span class="annot"><span class="annottext">forall a. Outputable a =&gt; a -&gt; SDoc
</span><a href="GHC.Utils.Outputable.html#ppr"><span class="hs-identifier hs-var">ppr</span></a></span><span> </span><span class="annot"><span class="annottext">HsSplice (GhcPass 'Renamed)
</span><a href="#local-6989586621681353506"><span class="hs-identifier hs-var">rn_splice</span></a></span><span>
</span><span id="line-697"></span><span>             </span><span class="hs-comment">-- See Note [Delaying modFinalizers in untyped splices].</span><span>
</span><span id="line-698"></span><span>           </span><span class="hs-special">;</span><span> </span><span class="annot"><span class="annottext">forall (m :: * -&gt; *) a. Monad m =&gt; a -&gt; m a
</span><a href="../../base-4.16.4.0/src/GHC-Base.html#return"><span class="hs-identifier hs-var">return</span></a></span><span> </span><span class="hs-special">(</span><span> </span><span class="annot"><span class="annottext">forall a b. a -&gt; Either a b
</span><a href="../../base-4.16.4.0/src/Data-Either.html#Left"><span class="hs-identifier hs-var">Left</span></a></span><span> </span><span class="annot"><span class="annottext">forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><a href="../../base-4.16.4.0/src/GHC-Base.html#%24"><span class="hs-operator hs-var">$</span></a></span><span> </span><span class="annot"><span class="annottext">forall p. XParPat p -&gt; LPat p -&gt; Pat p
</span><a href="Language.Haskell.Syntax.Pat.html#ParPat"><span class="hs-identifier hs-var">ParPat</span></a></span><span> </span><span class="annot"><span class="annottext">forall a. EpAnn a
</span><a href="GHC.Parser.Annotation.html#noAnn"><span class="hs-identifier hs-var">noAnn</span></a></span><span> </span><span class="annot"><span class="annottext">forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><a href="../../base-4.16.4.0/src/GHC-Base.html#%24"><span class="hs-operator hs-var">$</span></a></span><span> </span><span class="hs-special">(</span><span class="hs-special">(</span><span class="annot"><span class="annottext">forall p. XSplicePat p -&gt; HsSplice p -&gt; Pat p
</span><a href="Language.Haskell.Syntax.Pat.html#SplicePat"><span class="hs-identifier hs-var">SplicePat</span></a></span><span> </span><span class="annot"><span class="annottext">NoExtField
</span><a href="Language.Haskell.Syntax.Extension.html#noExtField"><span class="hs-identifier hs-var">noExtField</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-699"></span><span>                              </span><span class="annot"><span class="annottext">forall b c a. (b -&gt; c) -&gt; (a -&gt; b) -&gt; a -&gt; c
</span><a href="../../base-4.16.4.0/src/GHC-Base.html#."><span class="hs-operator hs-var">.</span></a></span><span> </span><span class="annot"><span class="annottext">forall id.
XSpliced id -&gt; ThModFinalizers -&gt; HsSplicedThing id -&gt; HsSplice id
</span><a href="Language.Haskell.Syntax.Expr.html#HsSpliced"><span class="hs-identifier hs-var">HsSpliced</span></a></span><span> </span><span class="annot"><span class="annottext">NoExtField
</span><a href="Language.Haskell.Syntax.Extension.html#noExtField"><span class="hs-identifier hs-var">noExtField</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">[ForeignRef (Q ())] -&gt; ThModFinalizers
</span><a href="Language.Haskell.Syntax.Expr.html#ThModFinalizers"><span class="hs-identifier hs-var">ThModFinalizers</span></a></span><span> </span><span class="annot"><span class="annottext">[ForeignRef (Q ())]
</span><a href="#local-6989586621681353504"><span class="hs-identifier hs-var">mod_finalizers</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-700"></span><span>                              </span><span class="annot"><span class="annottext">forall b c a. (b -&gt; c) -&gt; (a -&gt; b) -&gt; a -&gt; c
</span><a href="../../base-4.16.4.0/src/GHC-Base.html#."><span class="hs-operator hs-var">.</span></a></span><span> </span><span class="annot"><span class="annottext">forall id. Pat id -&gt; HsSplicedThing id
</span><a href="Language.Haskell.Syntax.Expr.html#HsSplicedPat"><span class="hs-identifier hs-var">HsSplicedPat</span></a></span><span class="hs-special">)</span><span>  </span><span class="annot"><span class="annottext">forall a b l. (a -&gt; b) -&gt; GenLocated l a -&gt; GenLocated l b
</span><a href="GHC.Types.SrcLoc.html#mapLoc"><span class="hs-operator hs-var">`mapLoc`</span></a></span><span>
</span><span id="line-701"></span><span>                              </span><span class="annot"><span class="annottext">GenLocated SrcSpanAnnA (Pat GhcPs)
</span><a href="#local-6989586621681353505"><span class="hs-identifier hs-var">pat</span></a></span><span>
</span><span id="line-702"></span><span>                    </span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">Uses
</span><a href="GHC.Types.Name.Set.html#emptyFVs"><span class="hs-identifier hs-var">emptyFVs</span></a></span><span>
</span><span id="line-703"></span><span>                    </span><span class="hs-special">)</span><span> </span><span class="hs-special">}</span><span>
</span><span id="line-704"></span><span>              </span><span class="hs-comment">-- Wrap the result of the quasi-quoter in parens so that we don't</span><span>
</span><span id="line-705"></span><span>              </span><span class="hs-comment">-- lose the outermost location set by runQuasiQuote (#7918)</span><span>
</span><span id="line-706"></span><span>
</span><span id="line-707"></span><span class="hs-comment">----------------------</span><span>
</span><span id="line-708"></span><span class="annot"><a href="GHC.Rename.Splice.html#rnSpliceDecl"><span class="hs-identifier hs-type">rnSpliceDecl</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><a href="Language.Haskell.Syntax.Decls.html#SpliceDecl"><span class="hs-identifier hs-type">SpliceDecl</span></a></span><span> </span><span class="annot"><a href="GHC.Hs.Extension.html#GhcPs"><span class="hs-identifier hs-type">GhcPs</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="GHC.Tc.Types.html#RnM"><span class="hs-identifier hs-type">RnM</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="Language.Haskell.Syntax.Decls.html#SpliceDecl"><span class="hs-identifier hs-type">SpliceDecl</span></a></span><span> </span><span class="annot"><a href="GHC.Hs.Extension.html#GhcRn"><span class="hs-identifier hs-type">GhcRn</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><a href="GHC.Types.Name.Set.html#FreeVars"><span class="hs-identifier hs-type">FreeVars</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-709"></span><span id="rnSpliceDecl"><span class="annot"><span class="annottext">rnSpliceDecl :: SpliceDecl GhcPs -&gt; RnM (SpliceDecl (GhcPass 'Renamed), Uses)
</span><a href="GHC.Rename.Splice.html#rnSpliceDecl"><span class="hs-identifier hs-var hs-var">rnSpliceDecl</span></a></span></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="Language.Haskell.Syntax.Decls.html#SpliceDecl"><span class="hs-identifier hs-type">SpliceDecl</span></a></span><span> </span><span class="annot"><span class="annottext">XSpliceDecl GhcPs
</span><span class="hs-identifier">_</span></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="GHC.Types.SrcLoc.html#L"><span class="hs-identifier hs-type">L</span></a></span><span> </span><span id="local-6989586621681353499"><span class="annot"><span class="annottext">SrcSpanAnnA
</span><a href="#local-6989586621681353499"><span class="hs-identifier hs-var">loc</span></a></span></span><span> </span><span id="local-6989586621681353498"><span class="annot"><span class="annottext">HsSplice GhcPs
</span><a href="#local-6989586621681353498"><span class="hs-identifier hs-var">splice</span></a></span></span><span class="hs-special">)</span><span> </span><span id="local-6989586621681353497"><span class="annot"><span class="annottext">SpliceExplicitFlag
</span><a href="#local-6989586621681353497"><span class="hs-identifier hs-var">flg</span></a></span></span><span class="hs-special">)</span><span>
</span><span id="line-710"></span><span>  </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">forall a.
(HsSplice (GhcPass 'Renamed) -&gt; RnM (a, Uses))
-&gt; (HsSplice (GhcPass 'Renamed) -&gt; (PendingRnSplice, a))
-&gt; HsSplice GhcPs
-&gt; RnM (a, Uses)
</span><a href="GHC.Rename.Splice.html#rnSpliceGen"><span class="hs-identifier hs-var">rnSpliceGen</span></a></span><span> </span><span class="annot"><span class="annottext">forall {a} {a}. Outputable a =&gt; a -&gt; a
</span><a href="#local-6989586621681353496"><span class="hs-identifier hs-var">run_decl_splice</span></a></span><span> </span><span class="annot"><span class="annottext">HsSplice (GhcPass 'Renamed)
-&gt; (PendingRnSplice, SpliceDecl (GhcPass 'Renamed))
</span><a href="#local-6989586621681353495"><span class="hs-identifier hs-var">pend_decl_splice</span></a></span><span> </span><span class="annot"><span class="annottext">HsSplice GhcPs
</span><a href="#local-6989586621681353498"><span class="hs-identifier hs-var">splice</span></a></span><span>
</span><span id="line-711"></span><span>  </span><span class="hs-keyword">where</span><span>
</span><span id="line-712"></span><span>    </span><span id="local-6989586621681353495"><span class="annot"><span class="annottext">pend_decl_splice :: HsSplice (GhcPass 'Renamed)
-&gt; (PendingRnSplice, SpliceDecl (GhcPass 'Renamed))
</span><a href="#local-6989586621681353495"><span class="hs-identifier hs-var hs-var">pend_decl_splice</span></a></span></span><span> </span><span id="local-6989586621681353494"><span class="annot"><span class="annottext">HsSplice (GhcPass 'Renamed)
</span><a href="#local-6989586621681353494"><span class="hs-identifier hs-var">rn_splice</span></a></span></span><span>
</span><span id="line-713"></span><span>       </span><span class="hs-glyph">=</span><span> </span><span class="hs-special">(</span><span> </span><span class="annot"><span class="annottext">UntypedSpliceFlavour
-&gt; HsSplice (GhcPass 'Renamed) -&gt; PendingRnSplice
</span><a href="GHC.Rename.Splice.html#makePending"><span class="hs-identifier hs-var">makePending</span></a></span><span> </span><span class="annot"><span class="annottext">UntypedSpliceFlavour
</span><a href="Language.Haskell.Syntax.Expr.html#UntypedDeclSplice"><span class="hs-identifier hs-var">UntypedDeclSplice</span></a></span><span> </span><span class="annot"><span class="annottext">HsSplice (GhcPass 'Renamed)
</span><a href="#local-6989586621681353494"><span class="hs-identifier hs-var">rn_splice</span></a></span><span>
</span><span id="line-714"></span><span>         </span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">forall p.
XSpliceDecl p
-&gt; XRec p (HsSplice p) -&gt; SpliceExplicitFlag -&gt; SpliceDecl p
</span><a href="Language.Haskell.Syntax.Decls.html#SpliceDecl"><span class="hs-identifier hs-var">SpliceDecl</span></a></span><span> </span><span class="annot"><span class="annottext">NoExtField
</span><a href="Language.Haskell.Syntax.Extension.html#noExtField"><span class="hs-identifier hs-var">noExtField</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">forall l e. l -&gt; e -&gt; GenLocated l e
</span><a href="GHC.Types.SrcLoc.html#L"><span class="hs-identifier hs-var">L</span></a></span><span> </span><span class="annot"><span class="annottext">SrcSpanAnnA
</span><a href="#local-6989586621681353499"><span class="hs-identifier hs-var">loc</span></a></span><span> </span><span class="annot"><span class="annottext">HsSplice (GhcPass 'Renamed)
</span><a href="#local-6989586621681353494"><span class="hs-identifier hs-var">rn_splice</span></a></span><span class="hs-special">)</span><span> </span><span class="annot"><span class="annottext">SpliceExplicitFlag
</span><a href="#local-6989586621681353497"><span class="hs-identifier hs-var">flg</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-715"></span><span>
</span><span id="line-716"></span><span>    </span><span id="local-6989586621681353496"><span class="annot"><span class="annottext">run_decl_splice :: a -&gt; a
</span><a href="#local-6989586621681353496"><span class="hs-identifier hs-var hs-var">run_decl_splice</span></a></span></span><span> </span><span id="local-6989586621681353489"><span class="annot"><span class="annottext">a
</span><a href="#local-6989586621681353489"><span class="hs-identifier hs-var">rn_splice</span></a></span></span><span>  </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">forall a. HasCallStack =&gt; String -&gt; SDoc -&gt; a
</span><a href="GHC.Utils.Panic.html#pprPanic"><span class="hs-identifier hs-var">pprPanic</span></a></span><span> </span><span class="annot"><span class="annottext">String
</span><span class="hs-string">&quot;rnSpliceDecl&quot;</span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">forall a. Outputable a =&gt; a -&gt; SDoc
</span><a href="GHC.Utils.Outputable.html#ppr"><span class="hs-identifier hs-var">ppr</span></a></span><span> </span><span class="annot"><span class="annottext">a
</span><a href="#local-6989586621681353489"><span class="hs-identifier hs-var">rn_splice</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-717"></span><span>
</span><span id="line-718"></span><span class="annot"><a href="GHC.Rename.Splice.html#rnTopSpliceDecls"><span class="hs-identifier hs-type">rnTopSpliceDecls</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><a href="Language.Haskell.Syntax.Expr.html#HsSplice"><span class="hs-identifier hs-type">HsSplice</span></a></span><span> </span><span class="annot"><a href="GHC.Hs.Extension.html#GhcPs"><span class="hs-identifier hs-type">GhcPs</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="GHC.Tc.Types.html#RnM"><span class="hs-identifier hs-type">RnM</span></a></span><span> </span><span class="hs-special">(</span><span class="hs-special">[</span><span class="annot"><a href="Language.Haskell.Syntax.Decls.html#LHsDecl"><span class="hs-identifier hs-type">LHsDecl</span></a></span><span> </span><span class="annot"><a href="GHC.Hs.Extension.html#GhcPs"><span class="hs-identifier hs-type">GhcPs</span></a></span><span class="hs-special">]</span><span class="hs-special">,</span><span> </span><span class="annot"><a href="GHC.Types.Name.Set.html#FreeVars"><span class="hs-identifier hs-type">FreeVars</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-719"></span><span class="hs-comment">-- Declaration splice at the very top level of the module</span><span>
</span><span id="line-720"></span><span id="rnTopSpliceDecls"><span class="annot"><span class="annottext">rnTopSpliceDecls :: HsSplice GhcPs -&gt; RnM ([LHsDecl GhcPs], Uses)
</span><a href="GHC.Rename.Splice.html#rnTopSpliceDecls"><span class="hs-identifier hs-var hs-var">rnTopSpliceDecls</span></a></span></span><span> </span><span id="local-6989586621681353488"><span class="annot"><span class="annottext">HsSplice GhcPs
</span><a href="#local-6989586621681353488"><span class="hs-identifier hs-var">splice</span></a></span></span><span>
</span><span id="line-721"></span><span>   </span><span class="hs-glyph">=</span><span>  </span><span class="hs-keyword">do</span><span> </span><span class="hs-special">{</span><span> </span><span class="annot"><span class="annottext">HsSplice GhcPs -&gt; IOEnv (Env TcGblEnv TcLclEnv) ()
</span><a href="GHC.Rename.Splice.html#checkTopSpliceAllowed"><span class="hs-identifier hs-var">checkTopSpliceAllowed</span></a></span><span> </span><span class="annot"><span class="annottext">HsSplice GhcPs
</span><a href="#local-6989586621681353488"><span class="hs-identifier hs-var">splice</span></a></span><span>
</span><span id="line-722"></span><span>         </span><span class="hs-special">;</span><span> </span><span class="hs-special">(</span><span id="local-6989586621681353487"><span class="annot"><span class="annottext">HsSplice (GhcPass 'Renamed)
</span><a href="#local-6989586621681353487"><span class="hs-identifier hs-var">rn_splice</span></a></span></span><span class="hs-special">,</span><span> </span><span id="local-6989586621681353486"><span class="annot"><span class="annottext">Uses
</span><a href="#local-6989586621681353486"><span class="hs-identifier hs-var">fvs</span></a></span></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">forall r. TcM r -&gt; TcM r
</span><a href="GHC.Tc.Utils.Monad.html#checkNoErrs"><span class="hs-identifier hs-var">checkNoErrs</span></a></span><span> </span><span class="annot"><span class="annottext">forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><a href="../../base-4.16.4.0/src/GHC-Base.html#%24"><span class="hs-operator hs-var">$</span></a></span><span>
</span><span id="line-723"></span><span>                               </span><span class="annot"><span class="annottext">forall a. ThStage -&gt; TcM a -&gt; TcM a
</span><a href="GHC.Tc.Utils.Monad.html#setStage"><span class="hs-identifier hs-var">setStage</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">SpliceType -&gt; ThStage
</span><a href="GHC.Tc.Types.html#Splice"><span class="hs-identifier hs-var">Splice</span></a></span><span> </span><span class="annot"><span class="annottext">SpliceType
</span><a href="GHC.Tc.Types.html#Untyped"><span class="hs-identifier hs-var">Untyped</span></a></span><span class="hs-special">)</span><span> </span><span class="annot"><span class="annottext">forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><a href="../../base-4.16.4.0/src/GHC-Base.html#%24"><span class="hs-operator hs-var">$</span></a></span><span>
</span><span id="line-724"></span><span>                               </span><span class="annot"><span class="annottext">HsSplice GhcPs -&gt; TcRn (HsSplice (GhcPass 'Renamed), Uses)
</span><a href="GHC.Rename.Splice.html#rnSplice"><span class="hs-identifier hs-var">rnSplice</span></a></span><span> </span><span class="annot"><span class="annottext">HsSplice GhcPs
</span><a href="#local-6989586621681353488"><span class="hs-identifier hs-var">splice</span></a></span><span>
</span><span id="line-725"></span><span>           </span><span class="hs-comment">-- As always, be sure to checkNoErrs above lest we end up with</span><span>
</span><span id="line-726"></span><span>           </span><span class="hs-comment">-- holes making it to typechecking, hence #12584.</span><span>
</span><span id="line-727"></span><span>           </span><span class="hs-comment">--</span><span>
</span><span id="line-728"></span><span>           </span><span class="hs-comment">-- Note that we cannot call checkNoErrs for the whole duration</span><span>
</span><span id="line-729"></span><span>           </span><span class="hs-comment">-- of rnTopSpliceDecls. The reason is that checkNoErrs changes</span><span>
</span><span id="line-730"></span><span>           </span><span class="hs-comment">-- the local environment to temporarily contain a new</span><span>
</span><span id="line-731"></span><span>           </span><span class="hs-comment">-- reference to store errors, and add_mod_finalizers would</span><span>
</span><span id="line-732"></span><span>           </span><span class="hs-comment">-- cause this reference to be stored after checkNoErrs finishes.</span><span>
</span><span id="line-733"></span><span>           </span><span class="hs-comment">-- This is checked by test TH_finalizer.</span><span>
</span><span id="line-734"></span><span>         </span><span class="hs-special">;</span><span> </span><span class="annot"><span class="annottext">String -&gt; SDoc -&gt; IOEnv (Env TcGblEnv TcLclEnv) ()
</span><a href="GHC.Tc.Utils.Monad.html#traceRn"><span class="hs-identifier hs-var">traceRn</span></a></span><span> </span><span class="annot"><span class="annottext">String
</span><span class="hs-string">&quot;rnTopSpliceDecls: untyped declaration splice&quot;</span></span><span> </span><span class="annot"><span class="annottext">SDoc
</span><a href="GHC.Utils.Outputable.html#empty"><span class="hs-identifier hs-var">empty</span></a></span><span>
</span><span id="line-735"></span><span>         </span><span class="hs-special">;</span><span> </span><span class="hs-special">(</span><span id="local-6989586621681353485"><span class="annot"><span class="annottext">[GenLocated SrcSpanAnnA (HsDecl GhcPs)]
</span><a href="#local-6989586621681353485"><span class="hs-identifier hs-var">decls</span></a></span></span><span class="hs-special">,</span><span> </span><span id="local-6989586621681353484"><span class="annot"><span class="annottext">[ForeignRef (Q ())]
</span><a href="#local-6989586621681353484"><span class="hs-identifier hs-var">mod_finalizers</span></a></span></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">forall r. TcM r -&gt; TcM r
</span><a href="GHC.Tc.Utils.Monad.html#checkNoErrs"><span class="hs-identifier hs-var">checkNoErrs</span></a></span><span> </span><span class="annot"><span class="annottext">forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><a href="../../base-4.16.4.0/src/GHC-Base.html#%24"><span class="hs-operator hs-var">$</span></a></span><span>
</span><span id="line-736"></span><span>               </span><span class="annot"><span class="annottext">forall res.
UntypedSpliceFlavour
-&gt; (LHsExpr GhcTc -&gt; TcRn res)
-&gt; (res -&gt; SDoc)
-&gt; HsSplice (GhcPass 'Renamed)
-&gt; TcRn (res, [ForeignRef (Q ())])
</span><a href="GHC.Rename.Splice.html#runRnSplice"><span class="hs-identifier hs-var">runRnSplice</span></a></span><span> </span><span class="annot"><span class="annottext">UntypedSpliceFlavour
</span><a href="Language.Haskell.Syntax.Expr.html#UntypedDeclSplice"><span class="hs-identifier hs-var">UntypedDeclSplice</span></a></span><span> </span><span class="annot"><span class="annottext">LHsExpr GhcTc -&gt; TcM [LHsDecl GhcPs]
</span><a href="GHC.Tc.Gen.Splice.html#runMetaD"><span class="hs-identifier hs-var">runMetaD</span></a></span><span> </span><span class="annot"><span class="annottext">[LHsDecl GhcPs] -&gt; SDoc
</span><a href="#local-6989586621681353483"><span class="hs-identifier hs-var">ppr_decls</span></a></span><span> </span><span class="annot"><span class="annottext">HsSplice (GhcPass 'Renamed)
</span><a href="#local-6989586621681353487"><span class="hs-identifier hs-var">rn_splice</span></a></span><span>
</span><span id="line-737"></span><span>         </span><span class="hs-special">;</span><span> </span><span class="annot"><span class="annottext">[ForeignRef (Q ())] -&gt; IOEnv (Env TcGblEnv TcLclEnv) ()
</span><a href="#local-6989586621681353482"><span class="hs-identifier hs-var">add_mod_finalizers_now</span></a></span><span> </span><span class="annot"><span class="annottext">[ForeignRef (Q ())]
</span><a href="#local-6989586621681353484"><span class="hs-identifier hs-var">mod_finalizers</span></a></span><span>
</span><span id="line-738"></span><span>         </span><span class="hs-special">;</span><span> </span><span class="annot"><span class="annottext">forall (m :: * -&gt; *) a. Monad m =&gt; a -&gt; m a
</span><a href="../../base-4.16.4.0/src/GHC-Base.html#return"><span class="hs-identifier hs-var">return</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">[GenLocated SrcSpanAnnA (HsDecl GhcPs)]
</span><a href="#local-6989586621681353485"><span class="hs-identifier hs-var">decls</span></a></span><span class="hs-special">,</span><span class="annot"><span class="annottext">Uses
</span><a href="#local-6989586621681353486"><span class="hs-identifier hs-var">fvs</span></a></span><span class="hs-special">)</span><span> </span><span class="hs-special">}</span><span>
</span><span id="line-739"></span><span>   </span><span class="hs-keyword">where</span><span>
</span><span id="line-740"></span><span>     </span><span class="annot"><a href="#local-6989586621681353483"><span class="hs-identifier hs-type">ppr_decls</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="hs-special">[</span><span class="annot"><a href="Language.Haskell.Syntax.Decls.html#LHsDecl"><span class="hs-identifier hs-type">LHsDecl</span></a></span><span> </span><span class="annot"><a href="GHC.Hs.Extension.html#GhcPs"><span class="hs-identifier hs-type">GhcPs</span></a></span><span class="hs-special">]</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="GHC.Utils.Outputable.html#SDoc"><span class="hs-identifier hs-type">SDoc</span></a></span><span>
</span><span id="line-741"></span><span>     </span><span id="local-6989586621681353483"><span class="annot"><span class="annottext">ppr_decls :: [LHsDecl GhcPs] -&gt; SDoc
</span><a href="#local-6989586621681353483"><span class="hs-identifier hs-var hs-var">ppr_decls</span></a></span></span><span> </span><span id="local-6989586621681353481"><span class="annot"><span class="annottext">[LHsDecl GhcPs]
</span><a href="#local-6989586621681353481"><span class="hs-identifier hs-var">ds</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">[SDoc] -&gt; SDoc
</span><a href="GHC.Utils.Outputable.html#vcat"><span class="hs-identifier hs-var">vcat</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">forall a b. (a -&gt; b) -&gt; [a] -&gt; [b]
</span><a href="../../base-4.16.4.0/src/GHC-Base.html#map"><span class="hs-identifier hs-var">map</span></a></span><span> </span><span class="annot"><span class="annottext">forall a. Outputable a =&gt; a -&gt; SDoc
</span><a href="GHC.Utils.Outputable.html#ppr"><span class="hs-identifier hs-var">ppr</span></a></span><span> </span><span class="annot"><span class="annottext">[LHsDecl GhcPs]
</span><a href="#local-6989586621681353481"><span class="hs-identifier hs-var">ds</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-742"></span><span>
</span><span id="line-743"></span><span>     </span><span class="hs-comment">-- Adds finalizers to the global environment instead of delaying them</span><span>
</span><span id="line-744"></span><span>     </span><span class="hs-comment">-- to the type checker.</span><span>
</span><span id="line-745"></span><span>     </span><span class="hs-comment">--</span><span>
</span><span id="line-746"></span><span>     </span><span class="hs-comment">-- Declaration splices do not have an interesting local environment so</span><span>
</span><span id="line-747"></span><span>     </span><span class="hs-comment">-- there is no point in delaying them.</span><span>
</span><span id="line-748"></span><span>     </span><span class="hs-comment">--</span><span>
</span><span id="line-749"></span><span>     </span><span class="hs-comment">-- See Note [Delaying modFinalizers in untyped splices].</span><span>
</span><span id="line-750"></span><span>     </span><span class="annot"><a href="#local-6989586621681353482"><span class="hs-identifier hs-type">add_mod_finalizers_now</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="hs-special">[</span><span class="annot"><a href="../../ghci-9.2.7/src/GHCi-RemoteTypes.html#ForeignRef"><span class="hs-identifier hs-type">ForeignRef</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="../../template-haskell-2.18.0.0/src/Language-Haskell-TH-Syntax.html#Q"><span class="hs-identifier hs-type">TH.Q</span></a></span><span> </span><span class="hs-special">(</span><span class="hs-special">)</span><span class="hs-special">)</span><span class="hs-special">]</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="GHC.Tc.Types.html#TcRn"><span class="hs-identifier hs-type">TcRn</span></a></span><span> </span><span class="hs-special">(</span><span class="hs-special">)</span><span>
</span><span id="line-751"></span><span>     </span><span id="local-6989586621681353482"><span class="annot"><span class="annottext">add_mod_finalizers_now :: [ForeignRef (Q ())] -&gt; IOEnv (Env TcGblEnv TcLclEnv) ()
</span><a href="#local-6989586621681353482"><span class="hs-identifier hs-var hs-var">add_mod_finalizers_now</span></a></span></span><span> </span><span class="hs-special">[</span><span class="hs-special">]</span><span>             </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">forall (m :: * -&gt; *) a. Monad m =&gt; a -&gt; m a
</span><a href="../../base-4.16.4.0/src/GHC-Base.html#return"><span class="hs-identifier hs-var">return</span></a></span><span> </span><span class="hs-special">(</span><span class="hs-special">)</span><span>
</span><span id="line-752"></span><span>     </span><span class="annot"><a href="#local-6989586621681353482"><span class="hs-identifier hs-var">add_mod_finalizers_now</span></a></span><span> </span><span id="local-6989586621681353480"><span class="annot"><span class="annottext">[ForeignRef (Q ())]
</span><a href="#local-6989586621681353480"><span class="hs-identifier hs-var">mod_finalizers</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-keyword">do</span><span>
</span><span id="line-753"></span><span>       </span><span id="local-6989586621681353479"><span class="annot"><span class="annottext">TcRef [(TcLclEnv, ThModFinalizers)]
</span><a href="#local-6989586621681353479"><span class="hs-identifier hs-var">th_modfinalizers_var</span></a></span></span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">forall (f :: * -&gt; *) a b. Functor f =&gt; (a -&gt; b) -&gt; f a -&gt; f b
</span><a href="../../base-4.16.4.0/src/GHC-Base.html#fmap"><span class="hs-identifier hs-var">fmap</span></a></span><span> </span><span class="annot"><span class="annottext">TcGblEnv -&gt; TcRef [(TcLclEnv, ThModFinalizers)]
</span><a href="GHC.Tc.Types.html#tcg_th_modfinalizers"><span class="hs-identifier hs-var">tcg_th_modfinalizers</span></a></span><span> </span><span class="annot"><span class="annottext">forall gbl lcl. TcRnIf gbl lcl gbl
</span><a href="GHC.Tc.Utils.Monad.html#getGblEnv"><span class="hs-identifier hs-var">getGblEnv</span></a></span><span>
</span><span id="line-754"></span><span>       </span><span id="local-6989586621681353477"><span class="annot"><span class="annottext">TcLclEnv
</span><a href="#local-6989586621681353477"><span class="hs-identifier hs-var">env</span></a></span></span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">forall gbl lcl. TcRnIf gbl lcl lcl
</span><a href="GHC.Tc.Utils.Monad.html#getLclEnv"><span class="hs-identifier hs-var">getLclEnv</span></a></span><span>
</span><span id="line-755"></span><span>       </span><span class="annot"><span class="annottext">forall a gbl lcl. TcRef a -&gt; (a -&gt; a) -&gt; TcRnIf gbl lcl ()
</span><a href="GHC.Tc.Utils.Monad.html#updTcRef"><span class="hs-identifier hs-var">updTcRef</span></a></span><span> </span><span class="annot"><span class="annottext">TcRef [(TcLclEnv, ThModFinalizers)]
</span><a href="#local-6989586621681353479"><span class="hs-identifier hs-var">th_modfinalizers_var</span></a></span><span> </span><span class="annot"><span class="annottext">forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><a href="../../base-4.16.4.0/src/GHC-Base.html#%24"><span class="hs-operator hs-var">$</span></a></span><span> </span><span class="hs-glyph">\</span><span id="local-6989586621681353474"><span class="annot"><span class="annottext">[(TcLclEnv, ThModFinalizers)]
</span><a href="#local-6989586621681353474"><span class="hs-identifier hs-var">fins</span></a></span></span><span> </span><span class="hs-glyph">-&gt;</span><span>
</span><span id="line-756"></span><span>         </span><span class="hs-special">(</span><span class="annot"><span class="annottext">TcLclEnv
</span><a href="#local-6989586621681353477"><span class="hs-identifier hs-var">env</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">[ForeignRef (Q ())] -&gt; ThModFinalizers
</span><a href="Language.Haskell.Syntax.Expr.html#ThModFinalizers"><span class="hs-identifier hs-var">ThModFinalizers</span></a></span><span> </span><span class="annot"><span class="annottext">[ForeignRef (Q ())]
</span><a href="#local-6989586621681353480"><span class="hs-identifier hs-var">mod_finalizers</span></a></span><span class="hs-special">)</span><span> </span><span class="annot"><span class="annottext">forall a. a -&gt; [a] -&gt; [a]
</span><span class="hs-glyph hs-var">:</span></span><span> </span><span class="annot"><span class="annottext">[(TcLclEnv, ThModFinalizers)]
</span><a href="#local-6989586621681353474"><span class="hs-identifier hs-var">fins</span></a></span><span>
</span><span id="line-757"></span><span>
</span><span id="line-758"></span><span>
</span><span id="line-759"></span><span class="hs-comment">{-
Note [rnSplicePat]
~~~~~~~~~~~~~~~~~~
Renaming a pattern splice is a bit tricky, because we need the variables
bound in the pattern to be in scope in the RHS of the pattern. This scope
management is effectively done by using continuation-passing style in
GHC.Rename.Pat, through the CpsRn monad. We don't wish to be in that monad here
(it would create import cycles and generally conflict with renaming other
splices), so we really want to return a (Pat RdrName) -- the result of
running the splice -- which can then be further renamed in GHC.Rename.Pat, in
the CpsRn monad.

The problem is that if we're renaming a splice within a bracket, we
*don't* want to run the splice now. We really do just want to rename
it to an HsSplice Name. Of course, then we can't know what variables
are bound within the splice. So we accept any unbound variables and
rename them again when the bracket is spliced in.  If a variable is brought
into scope by a pattern splice all is fine.  If it is not then an error is
reported.

In any case, when we're done in rnSplicePat, we'll either have a
Pat RdrName (the result of running a top-level splice) or a Pat Name
(the renamed nested splice). Thus, the awkward return type of
rnSplicePat.
-}</span><span>
</span><span id="line-784"></span><span>
</span><span id="line-785"></span><span class="annot"><a href="GHC.Rename.Splice.html#spliceCtxt"><span class="hs-identifier hs-type">spliceCtxt</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><a href="Language.Haskell.Syntax.Expr.html#HsSplice"><span class="hs-identifier hs-type">HsSplice</span></a></span><span> </span><span class="annot"><a href="GHC.Hs.Extension.html#GhcPs"><span class="hs-identifier hs-type">GhcPs</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="GHC.Utils.Outputable.html#SDoc"><span class="hs-identifier hs-type">SDoc</span></a></span><span>
</span><span id="line-786"></span><span id="spliceCtxt"><span class="annot"><span class="annottext">spliceCtxt :: HsSplice GhcPs -&gt; SDoc
</span><a href="GHC.Rename.Splice.html#spliceCtxt"><span class="hs-identifier hs-var hs-var">spliceCtxt</span></a></span></span><span> </span><span id="local-6989586621681353473"><span class="annot"><span class="annottext">HsSplice GhcPs
</span><a href="#local-6989586621681353473"><span class="hs-identifier hs-var">splice</span></a></span></span><span>
</span><span id="line-787"></span><span>  </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">SDoc -&gt; ThLevel -&gt; SDoc -&gt; SDoc
</span><a href="GHC.Utils.Outputable.html#hang"><span class="hs-identifier hs-var">hang</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">String -&gt; SDoc
</span><a href="GHC.Utils.Outputable.html#text"><span class="hs-identifier hs-var">text</span></a></span><span> </span><span class="annot"><span class="annottext">String
</span><span class="hs-string">&quot;In the&quot;</span></span><span> </span><span class="annot"><span class="annottext">SDoc -&gt; SDoc -&gt; SDoc
</span><a href="GHC.Utils.Outputable.html#%3C%2B%3E"><span class="hs-operator hs-var">&lt;+&gt;</span></a></span><span> </span><span class="annot"><span class="annottext">SDoc
</span><a href="#local-6989586621681353472"><span class="hs-identifier hs-var">what</span></a></span><span class="hs-special">)</span><span> </span><span class="annot"><span class="annottext">ThLevel
</span><span class="hs-number">2</span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">forall a. Outputable a =&gt; a -&gt; SDoc
</span><a href="GHC.Utils.Outputable.html#ppr"><span class="hs-identifier hs-var">ppr</span></a></span><span> </span><span class="annot"><span class="annottext">HsSplice GhcPs
</span><a href="#local-6989586621681353473"><span class="hs-identifier hs-var">splice</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-788"></span><span>  </span><span class="hs-keyword">where</span><span>
</span><span id="line-789"></span><span>    </span><span id="local-6989586621681353472"><span class="annot"><span class="annottext">what :: SDoc
</span><a href="#local-6989586621681353472"><span class="hs-identifier hs-var hs-var">what</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-keyword">case</span><span> </span><span class="annot"><span class="annottext">HsSplice GhcPs
</span><a href="#local-6989586621681353473"><span class="hs-identifier hs-var">splice</span></a></span><span> </span><span class="hs-keyword">of</span><span>
</span><span id="line-790"></span><span>             </span><span class="annot"><a href="Language.Haskell.Syntax.Expr.html#HsUntypedSplice"><span class="hs-identifier hs-type">HsUntypedSplice</span></a></span><span> </span><span class="hs-special">{</span><span class="hs-special">}</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="annottext">String -&gt; SDoc
</span><a href="GHC.Utils.Outputable.html#text"><span class="hs-identifier hs-var">text</span></a></span><span> </span><span class="annot"><span class="annottext">String
</span><span class="hs-string">&quot;untyped splice:&quot;</span></span><span>
</span><span id="line-791"></span><span>             </span><span class="annot"><a href="Language.Haskell.Syntax.Expr.html#HsTypedSplice"><span class="hs-identifier hs-type">HsTypedSplice</span></a></span><span>   </span><span class="hs-special">{</span><span class="hs-special">}</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="annottext">String -&gt; SDoc
</span><a href="GHC.Utils.Outputable.html#text"><span class="hs-identifier hs-var">text</span></a></span><span> </span><span class="annot"><span class="annottext">String
</span><span class="hs-string">&quot;typed splice:&quot;</span></span><span>
</span><span id="line-792"></span><span>             </span><span class="annot"><a href="Language.Haskell.Syntax.Expr.html#HsQuasiQuote"><span class="hs-identifier hs-type">HsQuasiQuote</span></a></span><span>    </span><span class="hs-special">{</span><span class="hs-special">}</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="annottext">String -&gt; SDoc
</span><a href="GHC.Utils.Outputable.html#text"><span class="hs-identifier hs-var">text</span></a></span><span> </span><span class="annot"><span class="annottext">String
</span><span class="hs-string">&quot;quasi-quotation:&quot;</span></span><span>
</span><span id="line-793"></span><span>             </span><span class="annot"><a href="Language.Haskell.Syntax.Expr.html#HsSpliced"><span class="hs-identifier hs-type">HsSpliced</span></a></span><span>       </span><span class="hs-special">{</span><span class="hs-special">}</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="annottext">String -&gt; SDoc
</span><a href="GHC.Utils.Outputable.html#text"><span class="hs-identifier hs-var">text</span></a></span><span> </span><span class="annot"><span class="annottext">String
</span><span class="hs-string">&quot;spliced expression:&quot;</span></span><span>
</span><span id="line-794"></span><span>
</span><span id="line-795"></span><span class="hs-comment">-- | The splice data to be logged</span><span>
</span><span id="line-796"></span><span class="hs-keyword">data</span><span> </span><span id="SpliceInfo"><span class="annot"><a href="GHC.Rename.Splice.html#SpliceInfo"><span class="hs-identifier hs-var">SpliceInfo</span></a></span></span><span>
</span><span id="line-797"></span><span>  </span><span class="hs-glyph">=</span><span> </span><span id="SpliceInfo"><span class="annot"><a href="GHC.Rename.Splice.html#SpliceInfo"><span class="hs-identifier hs-var">SpliceInfo</span></a></span></span><span>
</span><span id="line-798"></span><span>    </span><span class="hs-special">{</span><span> </span><span id="spliceDescription"><span class="annot"><span class="annottext">SpliceInfo -&gt; String
</span><a href="GHC.Rename.Splice.html#spliceDescription"><span class="hs-identifier hs-var hs-var">spliceDescription</span></a></span></span><span>  </span><span class="hs-glyph">::</span><span> </span><span class="annot"><a href="../../base-4.16.4.0/src/GHC-Base.html#String"><span class="hs-identifier hs-type">String</span></a></span><span>
</span><span id="line-799"></span><span>    </span><span class="hs-special">,</span><span> </span><span id="spliceSource"><span class="annot"><span class="annottext">SpliceInfo -&gt; Maybe (LHsExpr (GhcPass 'Renamed))
</span><a href="GHC.Rename.Splice.html#spliceSource"><span class="hs-identifier hs-var hs-var">spliceSource</span></a></span></span><span>       </span><span class="hs-glyph">::</span><span> </span><span class="annot"><a href="../../base-4.16.4.0/src/GHC-Maybe.html#Maybe"><span class="hs-identifier hs-type">Maybe</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="Language.Haskell.Syntax.Expr.html#LHsExpr"><span class="hs-identifier hs-type">LHsExpr</span></a></span><span> </span><span class="annot"><a href="GHC.Hs.Extension.html#GhcRn"><span class="hs-identifier hs-type">GhcRn</span></a></span><span class="hs-special">)</span><span> </span><span class="hs-comment">-- Nothing &lt;=&gt; top-level decls</span><span>
</span><span id="line-800"></span><span>                                                  </span><span class="hs-comment">--        added by addTopDecls</span><span>
</span><span id="line-801"></span><span>    </span><span class="hs-special">,</span><span> </span><span id="spliceIsDecl"><span class="annot"><span class="annottext">SpliceInfo -&gt; Bool
</span><a href="GHC.Rename.Splice.html#spliceIsDecl"><span class="hs-identifier hs-var hs-var">spliceIsDecl</span></a></span></span><span>       </span><span class="hs-glyph">::</span><span> </span><span class="annot"><span class="hs-identifier hs-type">Bool</span></span><span>    </span><span class="hs-comment">-- True &lt;=&gt; put the generate code in a file</span><span>
</span><span id="line-802"></span><span>                                    </span><span class="hs-comment">--          when -dth-dec-file is on</span><span>
</span><span id="line-803"></span><span>    </span><span class="hs-special">,</span><span> </span><span id="spliceGenerated"><span class="annot"><span class="annottext">SpliceInfo -&gt; SDoc
</span><a href="GHC.Rename.Splice.html#spliceGenerated"><span class="hs-identifier hs-var hs-var">spliceGenerated</span></a></span></span><span>    </span><span class="hs-glyph">::</span><span> </span><span class="annot"><a href="GHC.Utils.Outputable.html#SDoc"><span class="hs-identifier hs-type">SDoc</span></a></span><span>
</span><span id="line-804"></span><span>    </span><span class="hs-special">}</span><span>
</span><span id="line-805"></span><span>        </span><span class="hs-comment">-- Note that 'spliceSource' is *renamed* but not *typechecked*</span><span>
</span><span id="line-806"></span><span>        </span><span class="hs-comment">-- Reason (a) less typechecking crap</span><span>
</span><span id="line-807"></span><span>        </span><span class="hs-comment">--        (b) data constructors after type checking have been</span><span>
</span><span id="line-808"></span><span>        </span><span class="hs-comment">--            changed to their *wrappers*, and that makes them</span><span>
</span><span id="line-809"></span><span>        </span><span class="hs-comment">--            print always fully qualified</span><span>
</span><span id="line-810"></span><span>
</span><span id="line-811"></span><span class="hs-comment">-- | outputs splice information for 2 flags which have different output formats:</span><span>
</span><span id="line-812"></span><span class="hs-comment">-- `-ddump-splices` and `-dth-dec-file`</span><span>
</span><span id="line-813"></span><span class="annot"><a href="GHC.Rename.Splice.html#traceSplice"><span class="hs-identifier hs-type">traceSplice</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><a href="GHC.Rename.Splice.html#SpliceInfo"><span class="hs-identifier hs-type">SpliceInfo</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="GHC.Tc.Types.html#TcM"><span class="hs-identifier hs-type">TcM</span></a></span><span> </span><span class="hs-special">(</span><span class="hs-special">)</span><span>
</span><span id="line-814"></span><span id="traceSplice"><span class="annot"><span class="annottext">traceSplice :: SpliceInfo -&gt; IOEnv (Env TcGblEnv TcLclEnv) ()
</span><a href="GHC.Rename.Splice.html#traceSplice"><span class="hs-identifier hs-var hs-var">traceSplice</span></a></span></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="GHC.Rename.Splice.html#SpliceInfo"><span class="hs-identifier hs-type">SpliceInfo</span></a></span><span> </span><span class="hs-special">{</span><span> </span><span class="annot"><span class="annottext">spliceDescription :: SpliceInfo -&gt; String
</span><a href="GHC.Rename.Splice.html#spliceDescription"><span class="hs-identifier hs-var">spliceDescription</span></a></span><span> </span><span class="hs-glyph">=</span><span> </span><span id="local-6989586621681353471"><span class="annot"><span class="annottext">String
</span><a href="#local-6989586621681353471"><span class="hs-identifier hs-var">sd</span></a></span></span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">spliceSource :: SpliceInfo -&gt; Maybe (LHsExpr (GhcPass 'Renamed))
</span><a href="GHC.Rename.Splice.html#spliceSource"><span class="hs-identifier hs-var">spliceSource</span></a></span><span> </span><span class="hs-glyph">=</span><span> </span><span id="local-6989586621681353470"><span class="annot"><span class="annottext">Maybe (LHsExpr (GhcPass 'Renamed))
</span><a href="#local-6989586621681353470"><span class="hs-identifier hs-var">mb_src</span></a></span></span><span>
</span><span id="line-815"></span><span>                        </span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">spliceGenerated :: SpliceInfo -&gt; SDoc
</span><a href="GHC.Rename.Splice.html#spliceGenerated"><span class="hs-identifier hs-var">spliceGenerated</span></a></span><span> </span><span class="hs-glyph">=</span><span> </span><span id="local-6989586621681353469"><span class="annot"><span class="annottext">SDoc
</span><a href="#local-6989586621681353469"><span class="hs-identifier hs-var">gen</span></a></span></span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">spliceIsDecl :: SpliceInfo -&gt; Bool
</span><a href="GHC.Rename.Splice.html#spliceIsDecl"><span class="hs-identifier hs-var">spliceIsDecl</span></a></span><span> </span><span class="hs-glyph">=</span><span> </span><span id="local-6989586621681353468"><span class="annot"><span class="annottext">Bool
</span><a href="#local-6989586621681353468"><span class="hs-identifier hs-var">is_decl</span></a></span></span><span> </span><span class="hs-special">}</span><span class="hs-special">)</span><span>
</span><span id="line-816"></span><span>  </span><span class="hs-glyph">=</span><span> </span><span class="hs-keyword">do</span><span> </span><span id="local-6989586621681353467"><span class="annot"><span class="annottext">SrcSpan
</span><a href="#local-6989586621681353467"><span class="hs-identifier hs-var">loc</span></a></span></span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="hs-keyword">case</span><span> </span><span class="annot"><span class="annottext">Maybe (LHsExpr (GhcPass 'Renamed))
</span><a href="#local-6989586621681353470"><span class="hs-identifier hs-var">mb_src</span></a></span><span> </span><span class="hs-keyword">of</span><span>
</span><span id="line-817"></span><span>                 </span><span class="annot"><span class="annottext">Maybe (LHsExpr (GhcPass 'Renamed))
</span><a href="../../base-4.16.4.0/src/GHC-Maybe.html#Nothing"><span class="hs-identifier hs-var">Nothing</span></a></span><span>        </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="annottext">TcRn SrcSpan
</span><a href="GHC.Tc.Utils.Monad.html#getSrcSpanM"><span class="hs-identifier hs-var">getSrcSpanM</span></a></span><span>
</span><span id="line-818"></span><span>                 </span><span class="annot"><a href="../../base-4.16.4.0/src/GHC-Maybe.html#Just"><span class="hs-identifier hs-type">Just</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="GHC.Types.SrcLoc.html#L"><span class="hs-identifier hs-type">L</span></a></span><span> </span><span id="local-6989586621681353466"><span class="annot"><span class="annottext">SrcSpanAnnA
</span><a href="#local-6989586621681353466"><span class="hs-identifier hs-var">loc</span></a></span></span><span> </span><span class="annot"><span class="annottext">HsExpr (GhcPass 'Renamed)
</span><span class="hs-identifier">_</span></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="annottext">forall (m :: * -&gt; *) a. Monad m =&gt; a -&gt; m a
</span><a href="../../base-4.16.4.0/src/GHC-Base.html#return"><span class="hs-identifier hs-var">return</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">forall a. SrcSpanAnn' a -&gt; SrcSpan
</span><a href="GHC.Parser.Annotation.html#locA"><span class="hs-identifier hs-var">locA</span></a></span><span> </span><span class="annot"><span class="annottext">SrcSpanAnnA
</span><a href="#local-6989586621681353466"><span class="hs-identifier hs-var">loc</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-819"></span><span>       </span><span class="annot"><span class="annottext">DumpFlag -&gt; SDoc -&gt; IOEnv (Env TcGblEnv TcLclEnv) ()
</span><a href="GHC.Tc.Utils.Monad.html#traceOptTcRn"><span class="hs-identifier hs-var">traceOptTcRn</span></a></span><span> </span><span class="annot"><span class="annottext">DumpFlag
</span><a href="GHC.Driver.Flags.html#Opt_D_dump_splices"><span class="hs-identifier hs-var">Opt_D_dump_splices</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">SrcSpan -&gt; SDoc
</span><a href="#local-6989586621681353462"><span class="hs-identifier hs-var">spliceDebugDoc</span></a></span><span> </span><span class="annot"><span class="annottext">SrcSpan
</span><a href="#local-6989586621681353467"><span class="hs-identifier hs-var">loc</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-820"></span><span>
</span><span id="line-821"></span><span>       </span><span class="annot"><span class="annottext">forall (f :: * -&gt; *). Applicative f =&gt; Bool -&gt; f () -&gt; f ()
</span><a href="../../base-4.16.4.0/src/GHC-Base.html#when"><span class="hs-identifier hs-var">when</span></a></span><span> </span><span class="annot"><span class="annottext">Bool
</span><a href="#local-6989586621681353468"><span class="hs-identifier hs-var">is_decl</span></a></span><span> </span><span class="annot"><span class="annottext">forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><a href="../../base-4.16.4.0/src/GHC-Base.html#%24"><span class="hs-operator hs-var">$</span></a></span><span> </span><span class="hs-keyword">do</span><span> </span><span class="hs-comment">-- Raw material for -dth-dec-file</span><span>
</span><span id="line-822"></span><span>        </span><span id="local-6989586621681353461"><span class="annot"><span class="annottext">DynFlags
</span><a href="#local-6989586621681353461"><span class="hs-identifier hs-var">dflags</span></a></span></span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">forall (m :: * -&gt; *). HasDynFlags m =&gt; m DynFlags
</span><a href="GHC.Driver.Session.html#getDynFlags"><span class="hs-identifier hs-var">getDynFlags</span></a></span><span>
</span><span id="line-823"></span><span>        </span><span id="local-6989586621681353459"><span class="annot"><span class="annottext">Logger
</span><a href="#local-6989586621681353459"><span class="hs-identifier hs-var">logger</span></a></span></span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">forall (m :: * -&gt; *). HasLogger m =&gt; m Logger
</span><a href="GHC.Utils.Logger.html#getLogger"><span class="hs-identifier hs-var">getLogger</span></a></span><span>
</span><span id="line-824"></span><span>        </span><span class="annot"><span class="annottext">forall (m :: * -&gt; *) a. MonadIO m =&gt; IO a -&gt; m a
</span><a href="../../base-4.16.4.0/src/Control-Monad-IO-Class.html#liftIO"><span class="hs-identifier hs-var">liftIO</span></a></span><span> </span><span class="annot"><span class="annottext">forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><a href="../../base-4.16.4.0/src/GHC-Base.html#%24"><span class="hs-operator hs-var">$</span></a></span><span> </span><span class="annot"><span class="annottext">PrintUnqualified
-&gt; Logger
-&gt; DynFlags
-&gt; DumpFlag
-&gt; String
-&gt; DumpFormat
-&gt; SDoc
-&gt; IO ()
</span><a href="GHC.Utils.Logger.html#dumpIfSet_dyn_printer"><span class="hs-identifier hs-var">dumpIfSet_dyn_printer</span></a></span><span> </span><span class="annot"><span class="annottext">PrintUnqualified
</span><a href="GHC.Utils.Outputable.html#alwaysQualify"><span class="hs-identifier hs-var">alwaysQualify</span></a></span><span> </span><span class="annot"><span class="annottext">Logger
</span><a href="#local-6989586621681353459"><span class="hs-identifier hs-var">logger</span></a></span><span> </span><span class="annot"><span class="annottext">DynFlags
</span><a href="#local-6989586621681353461"><span class="hs-identifier hs-var">dflags</span></a></span><span> </span><span class="annot"><span class="annottext">DumpFlag
</span><a href="GHC.Driver.Flags.html#Opt_D_th_dec_file"><span class="hs-identifier hs-var">Opt_D_th_dec_file</span></a></span><span>
</span><span id="line-825"></span><span>                                       </span><span class="annot"><span class="annottext">String
</span><span class="hs-string">&quot;&quot;</span></span><span> </span><span class="annot"><span class="annottext">DumpFormat
</span><a href="GHC.Utils.Logger.html#FormatHaskell"><span class="hs-identifier hs-var">FormatHaskell</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">SrcSpan -&gt; SDoc
</span><a href="#local-6989586621681353454"><span class="hs-identifier hs-var">spliceCodeDoc</span></a></span><span> </span><span class="annot"><span class="annottext">SrcSpan
</span><a href="#local-6989586621681353467"><span class="hs-identifier hs-var">loc</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-826"></span><span>  </span><span class="hs-keyword">where</span><span>
</span><span id="line-827"></span><span>    </span><span class="hs-comment">-- `-ddump-splices`</span><span>
</span><span id="line-828"></span><span>    </span><span class="annot"><a href="#local-6989586621681353462"><span class="hs-identifier hs-type">spliceDebugDoc</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><a href="GHC.Types.SrcLoc.html#SrcSpan"><span class="hs-identifier hs-type">SrcSpan</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="GHC.Utils.Outputable.html#SDoc"><span class="hs-identifier hs-type">SDoc</span></a></span><span>
</span><span id="line-829"></span><span>    </span><span id="local-6989586621681353462"><span class="annot"><span class="annottext">spliceDebugDoc :: SrcSpan -&gt; SDoc
</span><a href="#local-6989586621681353462"><span class="hs-identifier hs-var hs-var">spliceDebugDoc</span></a></span></span><span> </span><span id="local-6989586621681353453"><span class="annot"><span class="annottext">SrcSpan
</span><a href="#local-6989586621681353453"><span class="hs-identifier hs-var">loc</span></a></span></span><span>
</span><span id="line-830"></span><span>      </span><span class="hs-glyph">=</span><span> </span><span class="hs-keyword">let</span><span> </span><span id="local-6989586621681353452"><span class="annot"><span class="annottext">code :: [SDoc]
</span><a href="#local-6989586621681353452"><span class="hs-identifier hs-var hs-var">code</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-keyword">case</span><span> </span><span class="annot"><span class="annottext">Maybe (LHsExpr (GhcPass 'Renamed))
</span><a href="#local-6989586621681353470"><span class="hs-identifier hs-var">mb_src</span></a></span><span> </span><span class="hs-keyword">of</span><span>
</span><span id="line-831"></span><span>                     </span><span class="annot"><span class="annottext">Maybe (LHsExpr (GhcPass 'Renamed))
</span><a href="../../base-4.16.4.0/src/GHC-Maybe.html#Nothing"><span class="hs-identifier hs-var">Nothing</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="annottext">[SDoc]
</span><a href="#local-6989586621681353451"><span class="hs-identifier hs-var">ending</span></a></span><span>
</span><span id="line-832"></span><span>                     </span><span class="annot"><a href="../../base-4.16.4.0/src/GHC-Maybe.html#Just"><span class="hs-identifier hs-type">Just</span></a></span><span> </span><span id="local-6989586621681353450"><span class="annot"><span class="annottext">LHsExpr (GhcPass 'Renamed)
</span><a href="#local-6989586621681353450"><span class="hs-identifier hs-var">e</span></a></span></span><span>  </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="annottext">ThLevel -&gt; SDoc -&gt; SDoc
</span><a href="GHC.Utils.Outputable.html#nest"><span class="hs-identifier hs-var">nest</span></a></span><span> </span><span class="annot"><span class="annottext">ThLevel
</span><span class="hs-number">2</span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">forall a. Outputable a =&gt; a -&gt; SDoc
</span><a href="GHC.Utils.Outputable.html#ppr"><span class="hs-identifier hs-var">ppr</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">forall (p :: Pass). LHsExpr (GhcPass p) -&gt; LHsExpr (GhcPass p)
</span><a href="GHC.Hs.Expr.html#stripParensLHsExpr"><span class="hs-identifier hs-var">stripParensLHsExpr</span></a></span><span> </span><span class="annot"><span class="annottext">LHsExpr (GhcPass 'Renamed)
</span><a href="#local-6989586621681353450"><span class="hs-identifier hs-var">e</span></a></span><span class="hs-special">)</span><span class="hs-special">)</span><span> </span><span class="annot"><span class="annottext">forall a. a -&gt; [a] -&gt; [a]
</span><span class="hs-glyph hs-var">:</span></span><span> </span><span class="annot"><span class="annottext">[SDoc]
</span><a href="#local-6989586621681353451"><span class="hs-identifier hs-var">ending</span></a></span><span>
</span><span id="line-833"></span><span>            </span><span id="local-6989586621681353451"><span class="annot"><span class="annottext">ending :: [SDoc]
</span><a href="#local-6989586621681353451"><span class="hs-identifier hs-var hs-var">ending</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-special">[</span><span> </span><span class="annot"><span class="annottext">String -&gt; SDoc
</span><a href="GHC.Utils.Outputable.html#text"><span class="hs-identifier hs-var">text</span></a></span><span> </span><span class="annot"><span class="annottext">String
</span><span class="hs-string">&quot;======&gt;&quot;</span></span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">ThLevel -&gt; SDoc -&gt; SDoc
</span><a href="GHC.Utils.Outputable.html#nest"><span class="hs-identifier hs-var">nest</span></a></span><span> </span><span class="annot"><span class="annottext">ThLevel
</span><span class="hs-number">2</span></span><span> </span><span class="annot"><span class="annottext">SDoc
</span><a href="#local-6989586621681353469"><span class="hs-identifier hs-var">gen</span></a></span><span> </span><span class="hs-special">]</span><span>
</span><span id="line-834"></span><span>        </span><span class="hs-keyword">in</span><span>  </span><span class="annot"><span class="annottext">SDoc -&gt; ThLevel -&gt; SDoc -&gt; SDoc
</span><a href="GHC.Utils.Outputable.html#hang"><span class="hs-identifier hs-var">hang</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">forall a. Outputable a =&gt; a -&gt; SDoc
</span><a href="GHC.Utils.Outputable.html#ppr"><span class="hs-identifier hs-var">ppr</span></a></span><span> </span><span class="annot"><span class="annottext">SrcSpan
</span><a href="#local-6989586621681353453"><span class="hs-identifier hs-var">loc</span></a></span><span> </span><span class="annot"><span class="annottext">SDoc -&gt; SDoc -&gt; SDoc
</span><a href="GHC.Utils.Outputable.html#%3C%3E"><span class="hs-operator hs-var">&lt;&gt;</span></a></span><span> </span><span class="annot"><span class="annottext">SDoc
</span><a href="GHC.Utils.Outputable.html#colon"><span class="hs-identifier hs-var">colon</span></a></span><span> </span><span class="annot"><span class="annottext">SDoc -&gt; SDoc -&gt; SDoc
</span><a href="GHC.Utils.Outputable.html#%3C%2B%3E"><span class="hs-operator hs-var">&lt;+&gt;</span></a></span><span> </span><span class="annot"><span class="annottext">String -&gt; SDoc
</span><a href="GHC.Utils.Outputable.html#text"><span class="hs-identifier hs-var">text</span></a></span><span> </span><span class="annot"><span class="annottext">String
</span><span class="hs-string">&quot;Splicing&quot;</span></span><span> </span><span class="annot"><span class="annottext">SDoc -&gt; SDoc -&gt; SDoc
</span><a href="GHC.Utils.Outputable.html#%3C%2B%3E"><span class="hs-operator hs-var">&lt;+&gt;</span></a></span><span> </span><span class="annot"><span class="annottext">String -&gt; SDoc
</span><a href="GHC.Utils.Outputable.html#text"><span class="hs-identifier hs-var">text</span></a></span><span> </span><span class="annot"><span class="annottext">String
</span><a href="#local-6989586621681353471"><span class="hs-identifier hs-var">sd</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-835"></span><span>               </span><span class="annot"><span class="annottext">ThLevel
</span><span class="hs-number">2</span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">[SDoc] -&gt; SDoc
</span><a href="GHC.Utils.Outputable.html#sep"><span class="hs-identifier hs-var">sep</span></a></span><span> </span><span class="annot"><span class="annottext">[SDoc]
</span><a href="#local-6989586621681353452"><span class="hs-identifier hs-var">code</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-836"></span><span>
</span><span id="line-837"></span><span>    </span><span class="hs-comment">-- `-dth-dec-file`</span><span>
</span><span id="line-838"></span><span>    </span><span class="annot"><a href="#local-6989586621681353454"><span class="hs-identifier hs-type">spliceCodeDoc</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><a href="GHC.Types.SrcLoc.html#SrcSpan"><span class="hs-identifier hs-type">SrcSpan</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="GHC.Utils.Outputable.html#SDoc"><span class="hs-identifier hs-type">SDoc</span></a></span><span>
</span><span id="line-839"></span><span>    </span><span id="local-6989586621681353454"><span class="annot"><span class="annottext">spliceCodeDoc :: SrcSpan -&gt; SDoc
</span><a href="#local-6989586621681353454"><span class="hs-identifier hs-var hs-var">spliceCodeDoc</span></a></span></span><span> </span><span id="local-6989586621681353445"><span class="annot"><span class="annottext">SrcSpan
</span><a href="#local-6989586621681353445"><span class="hs-identifier hs-var">loc</span></a></span></span><span>
</span><span id="line-840"></span><span>      </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">[SDoc] -&gt; SDoc
</span><a href="GHC.Utils.Outputable.html#vcat"><span class="hs-identifier hs-var">vcat</span></a></span><span> </span><span class="hs-special">[</span><span> </span><span class="annot"><span class="annottext">String -&gt; SDoc
</span><a href="GHC.Utils.Outputable.html#text"><span class="hs-identifier hs-var">text</span></a></span><span> </span><span class="annot"><span class="annottext">String
</span><span class="hs-string">&quot;--&quot;</span></span><span> </span><span class="annot"><span class="annottext">SDoc -&gt; SDoc -&gt; SDoc
</span><a href="GHC.Utils.Outputable.html#%3C%2B%3E"><span class="hs-operator hs-var">&lt;+&gt;</span></a></span><span> </span><span class="annot"><span class="annottext">forall a. Outputable a =&gt; a -&gt; SDoc
</span><a href="GHC.Utils.Outputable.html#ppr"><span class="hs-identifier hs-var">ppr</span></a></span><span> </span><span class="annot"><span class="annottext">SrcSpan
</span><a href="#local-6989586621681353445"><span class="hs-identifier hs-var">loc</span></a></span><span> </span><span class="annot"><span class="annottext">SDoc -&gt; SDoc -&gt; SDoc
</span><a href="GHC.Utils.Outputable.html#%3C%3E"><span class="hs-operator hs-var">&lt;&gt;</span></a></span><span> </span><span class="annot"><span class="annottext">SDoc
</span><a href="GHC.Utils.Outputable.html#colon"><span class="hs-identifier hs-var">colon</span></a></span><span> </span><span class="annot"><span class="annottext">SDoc -&gt; SDoc -&gt; SDoc
</span><a href="GHC.Utils.Outputable.html#%3C%2B%3E"><span class="hs-operator hs-var">&lt;+&gt;</span></a></span><span> </span><span class="annot"><span class="annottext">String -&gt; SDoc
</span><a href="GHC.Utils.Outputable.html#text"><span class="hs-identifier hs-var">text</span></a></span><span> </span><span class="annot"><span class="annottext">String
</span><span class="hs-string">&quot;Splicing&quot;</span></span><span> </span><span class="annot"><span class="annottext">SDoc -&gt; SDoc -&gt; SDoc
</span><a href="GHC.Utils.Outputable.html#%3C%2B%3E"><span class="hs-operator hs-var">&lt;+&gt;</span></a></span><span> </span><span class="annot"><span class="annottext">String -&gt; SDoc
</span><a href="GHC.Utils.Outputable.html#text"><span class="hs-identifier hs-var">text</span></a></span><span> </span><span class="annot"><span class="annottext">String
</span><a href="#local-6989586621681353471"><span class="hs-identifier hs-var">sd</span></a></span><span>
</span><span id="line-841"></span><span>             </span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">SDoc
</span><a href="#local-6989586621681353469"><span class="hs-identifier hs-var">gen</span></a></span><span> </span><span class="hs-special">]</span><span>
</span><span id="line-842"></span><span>
</span><span id="line-843"></span><span class="annot"><a href="GHC.Rename.Splice.html#illegalTypedSplice"><span class="hs-identifier hs-type">illegalTypedSplice</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><a href="GHC.Utils.Outputable.html#SDoc"><span class="hs-identifier hs-type">SDoc</span></a></span><span>
</span><span id="line-844"></span><span id="illegalTypedSplice"><span class="annot"><span class="annottext">illegalTypedSplice :: SDoc
</span><a href="GHC.Rename.Splice.html#illegalTypedSplice"><span class="hs-identifier hs-var hs-var">illegalTypedSplice</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">String -&gt; SDoc
</span><a href="GHC.Utils.Outputable.html#text"><span class="hs-identifier hs-var">text</span></a></span><span> </span><span class="annot"><span class="annottext">String
</span><span class="hs-string">&quot;Typed splices may not appear in untyped brackets&quot;</span></span><span>
</span><span id="line-845"></span><span>
</span><span id="line-846"></span><span class="annot"><a href="GHC.Rename.Splice.html#illegalUntypedSplice"><span class="hs-identifier hs-type">illegalUntypedSplice</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><a href="GHC.Utils.Outputable.html#SDoc"><span class="hs-identifier hs-type">SDoc</span></a></span><span>
</span><span id="line-847"></span><span id="illegalUntypedSplice"><span class="annot"><span class="annottext">illegalUntypedSplice :: SDoc
</span><a href="GHC.Rename.Splice.html#illegalUntypedSplice"><span class="hs-identifier hs-var hs-var">illegalUntypedSplice</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">String -&gt; SDoc
</span><a href="GHC.Utils.Outputable.html#text"><span class="hs-identifier hs-var">text</span></a></span><span> </span><span class="annot"><span class="annottext">String
</span><span class="hs-string">&quot;Untyped splices may not appear in typed brackets&quot;</span></span><span>
</span><span id="line-848"></span><span>
</span><span id="line-849"></span><span class="annot"><a href="GHC.Rename.Splice.html#checkThLocalName"><span class="hs-identifier hs-type">checkThLocalName</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><a href="GHC.Types.Name.html#Name"><span class="hs-identifier hs-type">Name</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="GHC.Tc.Types.html#RnM"><span class="hs-identifier hs-type">RnM</span></a></span><span> </span><span class="hs-special">(</span><span class="hs-special">)</span><span>
</span><span id="line-850"></span><span id="checkThLocalName"><span class="annot"><span class="annottext">checkThLocalName :: Name -&gt; IOEnv (Env TcGblEnv TcLclEnv) ()
</span><a href="GHC.Rename.Splice.html#checkThLocalName"><span class="hs-identifier hs-var hs-var">checkThLocalName</span></a></span></span><span> </span><span id="local-6989586621681353444"><span class="annot"><span class="annottext">Name
</span><a href="#local-6989586621681353444"><span class="hs-identifier hs-var">name</span></a></span></span><span>
</span><span id="line-851"></span><span>  </span><span class="hs-glyph">|</span><span> </span><span class="annot"><span class="annottext">Name -&gt; Bool
</span><a href="GHC.Builtin.Names.html#isUnboundName"><span class="hs-identifier hs-var">isUnboundName</span></a></span><span> </span><span class="annot"><span class="annottext">Name
</span><a href="#local-6989586621681353444"><span class="hs-identifier hs-var">name</span></a></span><span>   </span><span class="hs-comment">-- Do not report two errors for</span><span>
</span><span id="line-852"></span><span>  </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">forall (m :: * -&gt; *) a. Monad m =&gt; a -&gt; m a
</span><a href="../../base-4.16.4.0/src/GHC-Base.html#return"><span class="hs-identifier hs-var">return</span></a></span><span> </span><span class="hs-special">(</span><span class="hs-special">)</span><span>            </span><span class="hs-comment">--   $(not_in_scope args)</span><span>
</span><span id="line-853"></span><span>
</span><span id="line-854"></span><span>  </span><span class="hs-glyph">|</span><span> </span><span class="annot"><span class="annottext">Bool
</span><a href="../../base-4.16.4.0/src/GHC-Base.html#otherwise"><span class="hs-identifier hs-var">otherwise</span></a></span><span>
</span><span id="line-855"></span><span>  </span><span class="hs-glyph">=</span><span> </span><span class="hs-keyword">do</span><span>  </span><span class="hs-special">{</span><span> </span><span class="annot"><span class="annottext">String -&gt; SDoc -&gt; IOEnv (Env TcGblEnv TcLclEnv) ()
</span><a href="GHC.Tc.Utils.Monad.html#traceRn"><span class="hs-identifier hs-var">traceRn</span></a></span><span> </span><span class="annot"><span class="annottext">String
</span><span class="hs-string">&quot;checkThLocalName&quot;</span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">forall a. Outputable a =&gt; a -&gt; SDoc
</span><a href="GHC.Utils.Outputable.html#ppr"><span class="hs-identifier hs-var">ppr</span></a></span><span> </span><span class="annot"><span class="annottext">Name
</span><a href="#local-6989586621681353444"><span class="hs-identifier hs-var">name</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-856"></span><span>        </span><span class="hs-special">;</span><span> </span><span id="local-6989586621681353443"><span class="annot"><span class="annottext">Maybe (TopLevelFlag, ThLevel, ThStage)
</span><a href="#local-6989586621681353443"><span class="hs-identifier hs-var">mb_local_use</span></a></span></span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">Name -&gt; TcRn (Maybe (TopLevelFlag, ThLevel, ThStage))
</span><a href="GHC.Tc.Utils.Monad.html#getStageAndBindLevel"><span class="hs-identifier hs-var">getStageAndBindLevel</span></a></span><span> </span><span class="annot"><span class="annottext">Name
</span><a href="#local-6989586621681353444"><span class="hs-identifier hs-var">name</span></a></span><span>
</span><span id="line-857"></span><span>        </span><span class="hs-special">;</span><span> </span><span class="hs-keyword">case</span><span> </span><span class="annot"><span class="annottext">Maybe (TopLevelFlag, ThLevel, ThStage)
</span><a href="#local-6989586621681353443"><span class="hs-identifier hs-var">mb_local_use</span></a></span><span> </span><span class="hs-keyword">of</span><span> </span><span class="hs-special">{</span><span>
</span><span id="line-858"></span><span>             </span><span class="annot"><span class="annottext">Maybe (TopLevelFlag, ThLevel, ThStage)
</span><a href="../../base-4.16.4.0/src/GHC-Maybe.html#Nothing"><span class="hs-identifier hs-var">Nothing</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="annottext">forall (m :: * -&gt; *) a. Monad m =&gt; a -&gt; m a
</span><a href="../../base-4.16.4.0/src/GHC-Base.html#return"><span class="hs-identifier hs-var">return</span></a></span><span> </span><span class="hs-special">(</span><span class="hs-special">)</span><span> </span><span class="hs-special">;</span><span>  </span><span class="hs-comment">-- Not a locally-bound thing</span><span>
</span><span id="line-859"></span><span>             </span><span class="annot"><a href="../../base-4.16.4.0/src/GHC-Maybe.html#Just"><span class="hs-identifier hs-type">Just</span></a></span><span> </span><span class="hs-special">(</span><span id="local-6989586621681353441"><span class="annot"><span class="annottext">TopLevelFlag
</span><a href="#local-6989586621681353441"><span class="hs-identifier hs-var">top_lvl</span></a></span></span><span class="hs-special">,</span><span> </span><span id="local-6989586621681353440"><span class="annot"><span class="annottext">ThLevel
</span><a href="#local-6989586621681353440"><span class="hs-identifier hs-var">bind_lvl</span></a></span></span><span class="hs-special">,</span><span> </span><span id="local-6989586621681353439"><span class="annot"><span class="annottext">ThStage
</span><a href="#local-6989586621681353439"><span class="hs-identifier hs-var">use_stage</span></a></span></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">-&gt;</span><span>
</span><span id="line-860"></span><span>    </span><span class="hs-keyword">do</span><span>  </span><span class="hs-special">{</span><span> </span><span class="hs-keyword">let</span><span> </span><span id="local-6989586621681353438"><span class="annot"><span class="annottext">use_lvl :: ThLevel
</span><a href="#local-6989586621681353438"><span class="hs-identifier hs-var hs-var">use_lvl</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">ThStage -&gt; ThLevel
</span><a href="GHC.Tc.Types.html#thLevel"><span class="hs-identifier hs-var">thLevel</span></a></span><span> </span><span class="annot"><span class="annottext">ThStage
</span><a href="#local-6989586621681353439"><span class="hs-identifier hs-var">use_stage</span></a></span><span>
</span><span id="line-861"></span><span>        </span><span class="hs-special">;</span><span> </span><span class="annot"><span class="annottext">SDoc -&gt; ThLevel -&gt; ThLevel -&gt; IOEnv (Env TcGblEnv TcLclEnv) ()
</span><a href="GHC.Tc.Utils.Env.html#checkWellStaged"><span class="hs-identifier hs-var">checkWellStaged</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">SDoc -&gt; SDoc
</span><a href="GHC.Utils.Outputable.html#quotes"><span class="hs-identifier hs-var">quotes</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">forall a. Outputable a =&gt; a -&gt; SDoc
</span><a href="GHC.Utils.Outputable.html#ppr"><span class="hs-identifier hs-var">ppr</span></a></span><span> </span><span class="annot"><span class="annottext">Name
</span><a href="#local-6989586621681353444"><span class="hs-identifier hs-var">name</span></a></span><span class="hs-special">)</span><span class="hs-special">)</span><span> </span><span class="annot"><span class="annottext">ThLevel
</span><a href="#local-6989586621681353440"><span class="hs-identifier hs-var">bind_lvl</span></a></span><span> </span><span class="annot"><span class="annottext">ThLevel
</span><a href="#local-6989586621681353438"><span class="hs-identifier hs-var">use_lvl</span></a></span><span>
</span><span id="line-862"></span><span>        </span><span class="hs-special">;</span><span> </span><span class="annot"><span class="annottext">String -&gt; SDoc -&gt; IOEnv (Env TcGblEnv TcLclEnv) ()
</span><a href="GHC.Tc.Utils.Monad.html#traceRn"><span class="hs-identifier hs-var">traceRn</span></a></span><span> </span><span class="annot"><span class="annottext">String
</span><span class="hs-string">&quot;checkThLocalName&quot;</span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">forall a. Outputable a =&gt; a -&gt; SDoc
</span><a href="GHC.Utils.Outputable.html#ppr"><span class="hs-identifier hs-var">ppr</span></a></span><span> </span><span class="annot"><span class="annottext">Name
</span><a href="#local-6989586621681353444"><span class="hs-identifier hs-var">name</span></a></span><span> </span><span class="annot"><span class="annottext">SDoc -&gt; SDoc -&gt; SDoc
</span><a href="GHC.Utils.Outputable.html#%3C%2B%3E"><span class="hs-operator hs-var">&lt;+&gt;</span></a></span><span> </span><span class="annot"><span class="annottext">forall a. Outputable a =&gt; a -&gt; SDoc
</span><a href="GHC.Utils.Outputable.html#ppr"><span class="hs-identifier hs-var">ppr</span></a></span><span> </span><span class="annot"><span class="annottext">ThLevel
</span><a href="#local-6989586621681353440"><span class="hs-identifier hs-var">bind_lvl</span></a></span><span>
</span><span id="line-863"></span><span>                                               </span><span class="annot"><span class="annottext">SDoc -&gt; SDoc -&gt; SDoc
</span><a href="GHC.Utils.Outputable.html#%3C%2B%3E"><span class="hs-operator hs-var">&lt;+&gt;</span></a></span><span> </span><span class="annot"><span class="annottext">forall a. Outputable a =&gt; a -&gt; SDoc
</span><a href="GHC.Utils.Outputable.html#ppr"><span class="hs-identifier hs-var">ppr</span></a></span><span> </span><span class="annot"><span class="annottext">ThStage
</span><a href="#local-6989586621681353439"><span class="hs-identifier hs-var">use_stage</span></a></span><span>
</span><span id="line-864"></span><span>                                               </span><span class="annot"><span class="annottext">SDoc -&gt; SDoc -&gt; SDoc
</span><a href="GHC.Utils.Outputable.html#%3C%2B%3E"><span class="hs-operator hs-var">&lt;+&gt;</span></a></span><span> </span><span class="annot"><span class="annottext">forall a. Outputable a =&gt; a -&gt; SDoc
</span><a href="GHC.Utils.Outputable.html#ppr"><span class="hs-identifier hs-var">ppr</span></a></span><span> </span><span class="annot"><span class="annottext">ThLevel
</span><a href="#local-6989586621681353438"><span class="hs-identifier hs-var">use_lvl</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-865"></span><span>        </span><span class="hs-special">;</span><span> </span><span class="annot"><span class="annottext">TopLevelFlag
-&gt; ThLevel
-&gt; ThStage
-&gt; ThLevel
-&gt; Name
-&gt; IOEnv (Env TcGblEnv TcLclEnv) ()
</span><a href="GHC.Rename.Splice.html#checkCrossStageLifting"><span class="hs-identifier hs-var">checkCrossStageLifting</span></a></span><span> </span><span class="annot"><span class="annottext">TopLevelFlag
</span><a href="#local-6989586621681353441"><span class="hs-identifier hs-var">top_lvl</span></a></span><span> </span><span class="annot"><span class="annottext">ThLevel
</span><a href="#local-6989586621681353440"><span class="hs-identifier hs-var">bind_lvl</span></a></span><span> </span><span class="annot"><span class="annottext">ThStage
</span><a href="#local-6989586621681353439"><span class="hs-identifier hs-var">use_stage</span></a></span><span> </span><span class="annot"><span class="annottext">ThLevel
</span><a href="#local-6989586621681353438"><span class="hs-identifier hs-var">use_lvl</span></a></span><span> </span><span class="annot"><span class="annottext">Name
</span><a href="#local-6989586621681353444"><span class="hs-identifier hs-var">name</span></a></span><span> </span><span class="hs-special">}</span><span> </span><span class="hs-special">}</span><span> </span><span class="hs-special">}</span><span>
</span><span id="line-866"></span><span>
</span><span id="line-867"></span><span class="hs-comment">--------------------------------------</span><span>
</span><span id="line-868"></span><span class="annot"><a href="GHC.Rename.Splice.html#checkCrossStageLifting"><span class="hs-identifier hs-type">checkCrossStageLifting</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><a href="GHC.Types.Basic.html#TopLevelFlag"><span class="hs-identifier hs-type">TopLevelFlag</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="GHC.Tc.Types.html#ThLevel"><span class="hs-identifier hs-type">ThLevel</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="GHC.Tc.Types.html#ThStage"><span class="hs-identifier hs-type">ThStage</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="GHC.Tc.Types.html#ThLevel"><span class="hs-identifier hs-type">ThLevel</span></a></span><span>
</span><span id="line-869"></span><span>                       </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="GHC.Types.Name.html#Name"><span class="hs-identifier hs-type">Name</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="GHC.Tc.Types.html#TcM"><span class="hs-identifier hs-type">TcM</span></a></span><span> </span><span class="hs-special">(</span><span class="hs-special">)</span><span>
</span><span id="line-870"></span><span class="hs-comment">-- We are inside brackets, and (use_lvl &gt; bind_lvl)</span><span>
</span><span id="line-871"></span><span class="hs-comment">-- Now we must check whether there's a cross-stage lift to do</span><span>
</span><span id="line-872"></span><span class="hs-comment">-- Examples   \x -&gt; [| x |]</span><span>
</span><span id="line-873"></span><span class="hs-comment">--            [| map |]</span><span>
</span><span id="line-874"></span><span class="hs-comment">--</span><span>
</span><span id="line-875"></span><span class="hs-comment">-- This code is similar to checkCrossStageLifting in GHC.Tc.Gen.Expr, but</span><span>
</span><span id="line-876"></span><span class="hs-comment">-- this is only run on *untyped* brackets.</span><span>
</span><span id="line-877"></span><span>
</span><span id="line-878"></span><span id="checkCrossStageLifting"><span class="annot"><span class="annottext">checkCrossStageLifting :: TopLevelFlag
-&gt; ThLevel
-&gt; ThStage
-&gt; ThLevel
-&gt; Name
-&gt; IOEnv (Env TcGblEnv TcLclEnv) ()
</span><a href="GHC.Rename.Splice.html#checkCrossStageLifting"><span class="hs-identifier hs-var hs-var">checkCrossStageLifting</span></a></span></span><span> </span><span id="local-6989586621681353435"><span class="annot"><span class="annottext">TopLevelFlag
</span><a href="#local-6989586621681353435"><span class="hs-identifier hs-var">top_lvl</span></a></span></span><span> </span><span id="local-6989586621681353434"><span class="annot"><span class="annottext">ThLevel
</span><a href="#local-6989586621681353434"><span class="hs-identifier hs-var">bind_lvl</span></a></span></span><span> </span><span id="local-6989586621681353433"><span class="annot"><span class="annottext">ThStage
</span><a href="#local-6989586621681353433"><span class="hs-identifier hs-var">use_stage</span></a></span></span><span> </span><span id="local-6989586621681353432"><span class="annot"><span class="annottext">ThLevel
</span><a href="#local-6989586621681353432"><span class="hs-identifier hs-var">use_lvl</span></a></span></span><span> </span><span id="local-6989586621681353431"><span class="annot"><span class="annottext">Name
</span><a href="#local-6989586621681353431"><span class="hs-identifier hs-var">name</span></a></span></span><span>
</span><span id="line-879"></span><span>  </span><span class="hs-glyph">|</span><span> </span><span class="annot"><a href="GHC.Tc.Types.html#Brack"><span class="hs-identifier hs-type">Brack</span></a></span><span> </span><span class="annot"><span class="annottext">ThStage
</span><span class="hs-identifier">_</span></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="GHC.Tc.Types.html#RnPendingUntyped"><span class="hs-identifier hs-type">RnPendingUntyped</span></a></span><span> </span><span id="local-6989586621681353430"><span class="annot"><span class="annottext">IORef [PendingRnSplice]
</span><a href="#local-6989586621681353430"><span class="hs-identifier hs-var">ps_var</span></a></span></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">ThStage
</span><a href="#local-6989586621681353433"><span class="hs-identifier hs-var">use_stage</span></a></span><span>   </span><span class="hs-comment">-- Only for untyped brackets</span><span>
</span><span id="line-880"></span><span>  </span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">ThLevel
</span><a href="#local-6989586621681353432"><span class="hs-identifier hs-var">use_lvl</span></a></span><span> </span><span class="annot"><span class="annottext">forall a. Ord a =&gt; a -&gt; a -&gt; Bool
</span><span class="hs-operator hs-var">&gt;</span></span><span> </span><span class="annot"><span class="annottext">ThLevel
</span><a href="#local-6989586621681353434"><span class="hs-identifier hs-var">bind_lvl</span></a></span><span>                               </span><span class="hs-comment">-- Cross-stage condition</span><span>
</span><span id="line-881"></span><span>  </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">TopLevelFlag
-&gt; Name
-&gt; IORef [PendingRnSplice]
-&gt; IOEnv (Env TcGblEnv TcLclEnv) ()
</span><a href="GHC.Rename.Splice.html#check_cross_stage_lifting"><span class="hs-identifier hs-var">check_cross_stage_lifting</span></a></span><span> </span><span class="annot"><span class="annottext">TopLevelFlag
</span><a href="#local-6989586621681353435"><span class="hs-identifier hs-var">top_lvl</span></a></span><span> </span><span class="annot"><span class="annottext">Name
</span><a href="#local-6989586621681353431"><span class="hs-identifier hs-var">name</span></a></span><span> </span><span class="annot"><span class="annottext">IORef [PendingRnSplice]
</span><a href="#local-6989586621681353430"><span class="hs-identifier hs-var">ps_var</span></a></span><span>
</span><span id="line-882"></span><span>  </span><span class="hs-glyph">|</span><span> </span><span class="annot"><span class="annottext">Bool
</span><a href="../../base-4.16.4.0/src/GHC-Base.html#otherwise"><span class="hs-identifier hs-var">otherwise</span></a></span><span>
</span><span id="line-883"></span><span>  </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">forall (m :: * -&gt; *) a. Monad m =&gt; a -&gt; m a
</span><a href="../../base-4.16.4.0/src/GHC-Base.html#return"><span class="hs-identifier hs-var">return</span></a></span><span> </span><span class="hs-special">(</span><span class="hs-special">)</span><span>
</span><span id="line-884"></span><span>
</span><span id="line-885"></span><span class="annot"><a href="GHC.Rename.Splice.html#check_cross_stage_lifting"><span class="hs-identifier hs-type">check_cross_stage_lifting</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><a href="GHC.Types.Basic.html#TopLevelFlag"><span class="hs-identifier hs-type">TopLevelFlag</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="GHC.Types.Name.html#Name"><span class="hs-identifier hs-type">Name</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="GHC.Tc.Types.html#TcRef"><span class="hs-identifier hs-type">TcRef</span></a></span><span> </span><span class="hs-special">[</span><span class="annot"><a href="GHC.Hs.Expr.html#PendingRnSplice"><span class="hs-identifier hs-type">PendingRnSplice</span></a></span><span class="hs-special">]</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="GHC.Tc.Types.html#TcM"><span class="hs-identifier hs-type">TcM</span></a></span><span> </span><span class="hs-special">(</span><span class="hs-special">)</span><span>
</span><span id="line-886"></span><span id="check_cross_stage_lifting"><span class="annot"><span class="annottext">check_cross_stage_lifting :: TopLevelFlag
-&gt; Name
-&gt; IORef [PendingRnSplice]
-&gt; IOEnv (Env TcGblEnv TcLclEnv) ()
</span><a href="GHC.Rename.Splice.html#check_cross_stage_lifting"><span class="hs-identifier hs-var hs-var">check_cross_stage_lifting</span></a></span></span><span> </span><span id="local-6989586621681353427"><span class="annot"><span class="annottext">TopLevelFlag
</span><a href="#local-6989586621681353427"><span class="hs-identifier hs-var">top_lvl</span></a></span></span><span> </span><span id="local-6989586621681353426"><span class="annot"><span class="annottext">Name
</span><a href="#local-6989586621681353426"><span class="hs-identifier hs-var">name</span></a></span></span><span> </span><span id="local-6989586621681353425"><span class="annot"><span class="annottext">IORef [PendingRnSplice]
</span><a href="#local-6989586621681353425"><span class="hs-identifier hs-var">ps_var</span></a></span></span><span>
</span><span id="line-887"></span><span>  </span><span class="hs-glyph">|</span><span> </span><span class="annot"><span class="annottext">TopLevelFlag -&gt; Bool
</span><a href="GHC.Types.Basic.html#isTopLevel"><span class="hs-identifier hs-var">isTopLevel</span></a></span><span> </span><span class="annot"><span class="annottext">TopLevelFlag
</span><a href="#local-6989586621681353427"><span class="hs-identifier hs-var">top_lvl</span></a></span><span>
</span><span id="line-888"></span><span>        </span><span class="hs-comment">-- Top-level identifiers in this module,</span><span>
</span><span id="line-889"></span><span>        </span><span class="hs-comment">-- (which have External Names)</span><span>
</span><span id="line-890"></span><span>        </span><span class="hs-comment">-- are just like the imported case:</span><span>
</span><span id="line-891"></span><span>        </span><span class="hs-comment">-- no need for the 'lifting' treatment</span><span>
</span><span id="line-892"></span><span>        </span><span class="hs-comment">-- E.g.  this is fine:</span><span>
</span><span id="line-893"></span><span>        </span><span class="hs-comment">--   f x = x</span><span>
</span><span id="line-894"></span><span>        </span><span class="hs-comment">--   g y = [| f 3 |]</span><span>
</span><span id="line-895"></span><span>  </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">forall (f :: * -&gt; *). Applicative f =&gt; Bool -&gt; f () -&gt; f ()
</span><a href="../../base-4.16.4.0/src/GHC-Base.html#when"><span class="hs-identifier hs-var">when</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Name -&gt; Bool
</span><a href="GHC.Types.Name.html#isExternalName"><span class="hs-identifier hs-var">isExternalName</span></a></span><span> </span><span class="annot"><span class="annottext">Name
</span><a href="#local-6989586621681353426"><span class="hs-identifier hs-var">name</span></a></span><span class="hs-special">)</span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Name -&gt; IOEnv (Env TcGblEnv TcLclEnv) ()
</span><a href="GHC.Tc.Utils.Monad.html#keepAlive"><span class="hs-identifier hs-var">keepAlive</span></a></span><span> </span><span class="annot"><span class="annottext">Name
</span><a href="#local-6989586621681353426"><span class="hs-identifier hs-var">name</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-896"></span><span>    </span><span class="hs-comment">-- See Note [Keeping things alive for Template Haskell]</span><span>
</span><span id="line-897"></span><span>
</span><span id="line-898"></span><span>  </span><span class="hs-glyph">|</span><span> </span><span class="annot"><span class="annottext">Bool
</span><a href="../../base-4.16.4.0/src/GHC-Base.html#otherwise"><span class="hs-identifier hs-var">otherwise</span></a></span><span>
</span><span id="line-899"></span><span>  </span><span class="hs-glyph">=</span><span>     </span><span class="hs-comment">-- Nested identifiers, such as 'x' in</span><span>
</span><span id="line-900"></span><span>        </span><span class="hs-comment">-- E.g. \x -&gt; [| h x |]</span><span>
</span><span id="line-901"></span><span>        </span><span class="hs-comment">-- We must behave as if the reference to x was</span><span>
</span><span id="line-902"></span><span>        </span><span class="hs-comment">--      h $(lift x)</span><span>
</span><span id="line-903"></span><span>        </span><span class="hs-comment">-- We use 'x' itself as the SplicePointName, used by</span><span>
</span><span id="line-904"></span><span>        </span><span class="hs-comment">-- the desugarer to stitch it all back together.</span><span>
</span><span id="line-905"></span><span>        </span><span class="hs-comment">-- If 'x' occurs many times we may get many identical</span><span>
</span><span id="line-906"></span><span>        </span><span class="hs-comment">-- bindings of the same SplicePointName, but that doesn't</span><span>
</span><span id="line-907"></span><span>        </span><span class="hs-comment">-- matter, although it's a mite untidy.</span><span>
</span><span id="line-908"></span><span>    </span><span class="hs-keyword">do</span><span>  </span><span class="hs-special">{</span><span> </span><span class="annot"><span class="annottext">String -&gt; SDoc -&gt; IOEnv (Env TcGblEnv TcLclEnv) ()
</span><a href="GHC.Tc.Utils.Monad.html#traceRn"><span class="hs-identifier hs-var">traceRn</span></a></span><span> </span><span class="annot"><span class="annottext">String
</span><span class="hs-string">&quot;checkCrossStageLifting&quot;</span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">forall a. Outputable a =&gt; a -&gt; SDoc
</span><a href="GHC.Utils.Outputable.html#ppr"><span class="hs-identifier hs-var">ppr</span></a></span><span> </span><span class="annot"><span class="annottext">Name
</span><a href="#local-6989586621681353426"><span class="hs-identifier hs-var">name</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-909"></span><span>
</span><span id="line-910"></span><span>          </span><span class="hs-comment">-- Construct the (lift x) expression</span><span>
</span><span id="line-911"></span><span>        </span><span class="hs-special">;</span><span> </span><span class="hs-keyword">let</span><span> </span><span id="local-6989586621681353424"><span class="annot"><span class="annottext">lift_expr :: LHsExpr (GhcPass 'Renamed)
</span><a href="#local-6989586621681353424"><span class="hs-identifier hs-var hs-var">lift_expr</span></a></span></span><span>   </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">forall (id :: Pass).
IsPass id =&gt;
LHsExpr (GhcPass id)
-&gt; LHsExpr (GhcPass id) -&gt; LHsExpr (GhcPass id)
</span><a href="GHC.Hs.Utils.html#nlHsApp"><span class="hs-identifier hs-var">nlHsApp</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">forall (p :: Pass) a.
IsSrcSpanAnn p a =&gt;
IdP (GhcPass p) -&gt; LHsExpr (GhcPass p)
</span><a href="GHC.Hs.Utils.html#nlHsVar"><span class="hs-identifier hs-var">nlHsVar</span></a></span><span> </span><span class="annot"><span class="annottext">Name
</span><a href="GHC.Builtin.Names.TH.html#liftName"><span class="hs-identifier hs-var">liftName</span></a></span><span class="hs-special">)</span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">forall (p :: Pass) a.
IsSrcSpanAnn p a =&gt;
IdP (GhcPass p) -&gt; LHsExpr (GhcPass p)
</span><a href="GHC.Hs.Utils.html#nlHsVar"><span class="hs-identifier hs-var">nlHsVar</span></a></span><span> </span><span class="annot"><span class="annottext">Name
</span><a href="#local-6989586621681353426"><span class="hs-identifier hs-var">name</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-912"></span><span>              </span><span id="local-6989586621681353421"><span class="annot"><span class="annottext">pend_splice :: PendingRnSplice
</span><a href="#local-6989586621681353421"><span class="hs-identifier hs-var hs-var">pend_splice</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">UntypedSpliceFlavour
-&gt; Name -&gt; LHsExpr (GhcPass 'Renamed) -&gt; PendingRnSplice
</span><a href="GHC.Hs.Expr.html#PendingRnSplice"><span class="hs-identifier hs-var">PendingRnSplice</span></a></span><span> </span><span class="annot"><span class="annottext">UntypedSpliceFlavour
</span><a href="Language.Haskell.Syntax.Expr.html#UntypedExpSplice"><span class="hs-identifier hs-var">UntypedExpSplice</span></a></span><span> </span><span class="annot"><span class="annottext">Name
</span><a href="#local-6989586621681353426"><span class="hs-identifier hs-var">name</span></a></span><span> </span><span class="annot"><span class="annottext">LHsExpr (GhcPass 'Renamed)
</span><a href="#local-6989586621681353424"><span class="hs-identifier hs-var">lift_expr</span></a></span><span>
</span><span id="line-913"></span><span>
</span><span id="line-914"></span><span>          </span><span class="hs-comment">-- Warning for implicit lift (#17804)</span><span>
</span><span id="line-915"></span><span>        </span><span class="hs-special">;</span><span> </span><span class="annot"><span class="annottext">forall gbl lcl.
WarningFlag -&gt; TcRnIf gbl lcl () -&gt; TcRnIf gbl lcl ()
</span><a href="GHC.Tc.Utils.Monad.html#whenWOptM"><span class="hs-identifier hs-var">whenWOptM</span></a></span><span> </span><span class="annot"><span class="annottext">WarningFlag
</span><a href="GHC.Driver.Flags.html#Opt_WarnImplicitLift"><span class="hs-identifier hs-var">Opt_WarnImplicitLift</span></a></span><span> </span><span class="annot"><span class="annottext">forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><a href="../../base-4.16.4.0/src/GHC-Base.html#%24"><span class="hs-operator hs-var">$</span></a></span><span>
</span><span id="line-916"></span><span>            </span><span class="annot"><span class="annottext">WarnReason -&gt; SDoc -&gt; IOEnv (Env TcGblEnv TcLclEnv) ()
</span><a href="GHC.Tc.Utils.Monad.html#addWarnTc"><span class="hs-identifier hs-var">addWarnTc</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">WarningFlag -&gt; WarnReason
</span><a href="GHC.Driver.Flags.html#Reason"><span class="hs-identifier hs-var">Reason</span></a></span><span> </span><span class="annot"><span class="annottext">WarningFlag
</span><a href="GHC.Driver.Flags.html#Opt_WarnImplicitLift"><span class="hs-identifier hs-var">Opt_WarnImplicitLift</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-917"></span><span>                       </span><span class="hs-special">(</span><span class="annot"><span class="annottext">String -&gt; SDoc
</span><a href="GHC.Utils.Outputable.html#text"><span class="hs-identifier hs-var">text</span></a></span><span> </span><span class="annot"><span class="annottext">String
</span><span class="hs-string">&quot;The variable&quot;</span></span><span> </span><span class="annot"><span class="annottext">SDoc -&gt; SDoc -&gt; SDoc
</span><a href="GHC.Utils.Outputable.html#%3C%2B%3E"><span class="hs-operator hs-var">&lt;+&gt;</span></a></span><span> </span><span class="annot"><span class="annottext">SDoc -&gt; SDoc
</span><a href="GHC.Utils.Outputable.html#quotes"><span class="hs-identifier hs-var">quotes</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">forall a. Outputable a =&gt; a -&gt; SDoc
</span><a href="GHC.Utils.Outputable.html#ppr"><span class="hs-identifier hs-var">ppr</span></a></span><span> </span><span class="annot"><span class="annottext">Name
</span><a href="#local-6989586621681353426"><span class="hs-identifier hs-var">name</span></a></span><span class="hs-special">)</span><span> </span><span class="annot"><span class="annottext">SDoc -&gt; SDoc -&gt; SDoc
</span><a href="GHC.Utils.Outputable.html#%3C%2B%3E"><span class="hs-operator hs-var">&lt;+&gt;</span></a></span><span>
</span><span id="line-918"></span><span>                        </span><span class="annot"><span class="annottext">String -&gt; SDoc
</span><a href="GHC.Utils.Outputable.html#text"><span class="hs-identifier hs-var">text</span></a></span><span> </span><span class="annot"><span class="annottext">String
</span><span class="hs-string">&quot;is implicitly lifted in the TH quotation&quot;</span></span><span class="hs-special">)</span><span>
</span><span id="line-919"></span><span>
</span><span id="line-920"></span><span>          </span><span class="hs-comment">-- Update the pending splices</span><span>
</span><span id="line-921"></span><span>        </span><span class="hs-special">;</span><span> </span><span id="local-6989586621681353416"><span class="annot"><span class="annottext">[PendingRnSplice]
</span><a href="#local-6989586621681353416"><span class="hs-identifier hs-var">ps</span></a></span></span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">forall a env. IORef a -&gt; IOEnv env a
</span><a href="GHC.Data.IOEnv.html#readMutVar"><span class="hs-identifier hs-var">readMutVar</span></a></span><span> </span><span class="annot"><span class="annottext">IORef [PendingRnSplice]
</span><a href="#local-6989586621681353425"><span class="hs-identifier hs-var">ps_var</span></a></span><span>
</span><span id="line-922"></span><span>        </span><span class="hs-special">;</span><span> </span><span class="annot"><span class="annottext">forall a env. IORef a -&gt; a -&gt; IOEnv env ()
</span><a href="GHC.Data.IOEnv.html#writeMutVar"><span class="hs-identifier hs-var">writeMutVar</span></a></span><span> </span><span class="annot"><span class="annottext">IORef [PendingRnSplice]
</span><a href="#local-6989586621681353425"><span class="hs-identifier hs-var">ps_var</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">PendingRnSplice
</span><a href="#local-6989586621681353421"><span class="hs-identifier hs-var">pend_splice</span></a></span><span> </span><span class="annot"><span class="annottext">forall a. a -&gt; [a] -&gt; [a]
</span><span class="hs-glyph hs-var">:</span></span><span> </span><span class="annot"><span class="annottext">[PendingRnSplice]
</span><a href="#local-6989586621681353416"><span class="hs-identifier hs-var">ps</span></a></span><span class="hs-special">)</span><span> </span><span class="hs-special">}</span><span>
</span><span id="line-923"></span><span>
</span><span id="line-924"></span><span class="hs-comment">{-
Note [Keeping things alive for Template Haskell]
~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~
Consider
  f x = x+1
  g y = [| f 3 |]

Here 'f' is referred to from inside the bracket, which turns into data
and mentions only f's *name*, not 'f' itself. So we need some other
way to keep 'f' alive, lest it get dropped as dead code.  That's what
keepAlive does. It puts it in the keep-alive set, which subsequently
ensures that 'f' stays as a top level binding.

This must be done by the renamer, not the type checker (as of old),
because the type checker doesn't typecheck the body of untyped
brackets (#8540).

A thing can have a bind_lvl of outerLevel, but have an internal name:
   foo = [d| op = 3
             bop = op + 1 |]
Here the bind_lvl of 'op' is (bogusly) outerLevel, even though it is
bound inside a bracket.  That is because we don't even record
binding levels for top-level things; the binding levels are in the
LocalRdrEnv.

So the occurrence of 'op' in the rhs of 'bop' looks a bit like a
cross-stage thing, but it isn't really.  And in fact we never need
to do anything here for top-level bound things, so all is fine, if
a bit hacky.

For these chaps (which have Internal Names) we don't want to put
them in the keep-alive set.

Note [Quoting names]
~~~~~~~~~~~~~~~~~~~~
A quoted name 'n is a bit like a quoted expression [| n |], except that we
have no cross-stage lifting (c.f. GHC.Tc.Gen.Expr.thBrackId).  So, after incrementing
the use-level to account for the brackets, the cases are:

        bind &gt; use                      Error
        bind = use+1                    OK
        bind &lt; use
                Imported things         OK
                Top-level things        OK
                Non-top-level           Error

where 'use' is the binding level of the 'n quote. (So inside the implied
bracket the level would be use+1.)

Examples:

  f 'map        -- OK; also for top-level defns of this module

  \x. f 'x      -- Not ok (bind = 1, use = 1)
                -- (whereas \x. f [| x |] might have been ok, by
                --                               cross-stage lifting

  \y. [| \x. $(f 'y) |] -- Not ok (bind =1, use = 1)

  [| \x. $(f 'x) |]     -- OK (bind = 2, use = 1)
-}</span><span>
</span><span id="line-985"></span></pre></body></html>