<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd"><html xmlns="http://www.w3.org/1999/xhtml"><head><link rel="stylesheet" type="text/css" href="style.css" /><script type="text/javascript" src="highlight.js"></script></head><body><pre><span class="hs-pragma">{-# LANGUAGE CPP #-}</span><span>
</span><span id="line-2"></span><span class="hs-pragma">{-# LANGUAGE FlexibleContexts #-}</span><span>
</span><span id="line-3"></span><span class="hs-pragma">{-# LANGUAGE LambdaCase #-}</span><span>
</span><span id="line-4"></span><span class="hs-pragma">{-# LANGUAGE RankNTypes #-}</span><span>
</span><span id="line-5"></span><span class="hs-pragma">{-# LANGUAGE TupleSections #-}</span><span>
</span><span id="line-6"></span><span class="hs-pragma">{-# LANGUAGE TypeFamilies #-}</span><span>
</span><span id="line-7"></span><span>
</span><span id="line-8"></span><span class="hs-pragma">{-# OPTIONS_GHC -Wno-incomplete-uni-patterns #-}</span><span>
</span><span id="line-9"></span><span>
</span><span id="line-10"></span><span class="hs-comment">{-
(c) The University of Glasgow 2006
(c) The GRASP/AQUA Project, Glasgow University, 1992-1998

-}</span><span>
</span><span id="line-15"></span><span>
</span><span id="line-16"></span><span class="hs-comment">-- | Typechecking patterns</span><span>
</span><span id="line-17"></span><span class="hs-keyword">module</span><span> </span><span class="hs-identifier">GHC.Tc.Gen.Pat</span><span>
</span><span id="line-18"></span><span>   </span><span class="hs-special">(</span><span> </span><span class="annot"><a href="GHC.Tc.Gen.Pat.html#tcLetPat"><span class="hs-identifier">tcLetPat</span></a></span><span>
</span><span id="line-19"></span><span>   </span><span class="hs-special">,</span><span> </span><span class="annot"><a href="GHC.Tc.Gen.Pat.html#newLetBndr"><span class="hs-identifier">newLetBndr</span></a></span><span>
</span><span id="line-20"></span><span>   </span><span class="hs-special">,</span><span> </span><span class="annot"><a href="GHC.Tc.Gen.Pat.html#LetBndrSpec"><span class="hs-identifier">LetBndrSpec</span></a></span><span class="hs-special">(</span><span class="hs-glyph">..</span><span class="hs-special">)</span><span>
</span><span id="line-21"></span><span>   </span><span class="hs-special">,</span><span> </span><span class="annot"><a href="GHC.Tc.Gen.Pat.html#tcCheckPat"><span class="hs-identifier">tcCheckPat</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><a href="GHC.Tc.Gen.Pat.html#tcCheckPat_O"><span class="hs-identifier">tcCheckPat_O</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><a href="GHC.Tc.Gen.Pat.html#tcInferPat"><span class="hs-identifier">tcInferPat</span></a></span><span>
</span><span id="line-22"></span><span>   </span><span class="hs-special">,</span><span> </span><span class="annot"><a href="GHC.Tc.Gen.Pat.html#tcPats"><span class="hs-identifier">tcPats</span></a></span><span>
</span><span id="line-23"></span><span>   </span><span class="hs-special">,</span><span> </span><span class="annot"><a href="GHC.Tc.Gen.Pat.html#addDataConStupidTheta"><span class="hs-identifier">addDataConStupidTheta</span></a></span><span>
</span><span id="line-24"></span><span>   </span><span class="hs-special">,</span><span> </span><span class="annot"><a href="GHC.Tc.Gen.Pat.html#badFieldCon"><span class="hs-identifier">badFieldCon</span></a></span><span>
</span><span id="line-25"></span><span>   </span><span class="hs-special">,</span><span> </span><span class="annot"><a href="GHC.Tc.Gen.Pat.html#polyPatSig"><span class="hs-identifier">polyPatSig</span></a></span><span>
</span><span id="line-26"></span><span>   </span><span class="hs-special">)</span><span>
</span><span id="line-27"></span><span class="hs-keyword">where</span><span class="hs-cpp">

#include &quot;HsVersions.h&quot;
</span><span>
</span><span id="line-31"></span><span class="hs-keyword">import</span><span> </span><span class="annot"><a href="GHC.Prelude.html"><span class="hs-identifier">GHC.Prelude</span></a></span><span>
</span><span id="line-32"></span><span>
</span><span id="line-33"></span><span class="hs-keyword">import</span><span> </span><span class="hs-pragma">{-# SOURCE</span><span> </span><span class="hs-pragma">#-}</span><span>   </span><span class="annot"><a href="GHC.Tc.Gen.Expr.html"><span class="hs-identifier">GHC.Tc.Gen.Expr</span></a></span><span class="hs-special">(</span><span> </span><span class="annot"><a href="GHC.Tc.Gen.Expr.html#tcSyntaxOp"><span class="hs-identifier">tcSyntaxOp</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><a href="GHC.Tc.Gen.Expr.html#tcSyntaxOpGen"><span class="hs-identifier">tcSyntaxOpGen</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><a href="GHC.Tc.Gen.Expr.html#tcInferRho"><span class="hs-identifier">tcInferRho</span></a></span><span> </span><span class="hs-special">)</span><span>
</span><span id="line-34"></span><span>
</span><span id="line-35"></span><span class="hs-keyword">import</span><span> </span><span class="annot"><a href="GHC.Hs.html"><span class="hs-identifier">GHC.Hs</span></a></span><span>
</span><span id="line-36"></span><span class="hs-keyword">import</span><span> </span><span class="annot"><a href="GHC.Rename.Utils.html"><span class="hs-identifier">GHC.Rename.Utils</span></a></span><span>
</span><span id="line-37"></span><span class="hs-keyword">import</span><span> </span><span class="annot"><a href="GHC.Tc.Utils.Zonk.html"><span class="hs-identifier">GHC.Tc.Utils.Zonk</span></a></span><span>
</span><span id="line-38"></span><span class="hs-keyword">import</span><span> </span><span class="annot"><a href="GHC.Tc.Gen.Sig.html"><span class="hs-identifier">GHC.Tc.Gen.Sig</span></a></span><span class="hs-special">(</span><span> </span><span class="annot"><a href="GHC.Tc.Gen.Sig.html#TcPragEnv"><span class="hs-identifier">TcPragEnv</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><a href="GHC.Tc.Gen.Sig.html#lookupPragEnv"><span class="hs-identifier">lookupPragEnv</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><a href="GHC.Tc.Gen.Sig.html#addInlinePrags"><span class="hs-identifier">addInlinePrags</span></a></span><span> </span><span class="hs-special">)</span><span>
</span><span id="line-39"></span><span class="hs-keyword">import</span><span> </span><span class="annot"><a href="GHC.Tc.Utils.Monad.html"><span class="hs-identifier">GHC.Tc.Utils.Monad</span></a></span><span>
</span><span id="line-40"></span><span class="hs-keyword">import</span><span> </span><span class="annot"><a href="GHC.Tc.Utils.Instantiate.html"><span class="hs-identifier">GHC.Tc.Utils.Instantiate</span></a></span><span>
</span><span id="line-41"></span><span class="hs-keyword">import</span><span> </span><span class="annot"><a href="GHC.Types.Id.html"><span class="hs-identifier">GHC.Types.Id</span></a></span><span>
</span><span id="line-42"></span><span class="hs-keyword">import</span><span> </span><span class="annot"><a href="GHC.Types.Var.html"><span class="hs-identifier">GHC.Types.Var</span></a></span><span>
</span><span id="line-43"></span><span class="hs-keyword">import</span><span> </span><span class="annot"><a href="GHC.Types.Name.html"><span class="hs-identifier">GHC.Types.Name</span></a></span><span>
</span><span id="line-44"></span><span class="hs-keyword">import</span><span> </span><span class="annot"><a href="GHC.Types.Name.Reader.html"><span class="hs-identifier">GHC.Types.Name.Reader</span></a></span><span>
</span><span id="line-45"></span><span class="hs-keyword">import</span><span> </span><span class="annot"><a href="GHC.Core.Multiplicity.html"><span class="hs-identifier">GHC.Core.Multiplicity</span></a></span><span>
</span><span id="line-46"></span><span class="hs-keyword">import</span><span> </span><span class="annot"><a href="GHC.Tc.Utils.Env.html"><span class="hs-identifier">GHC.Tc.Utils.Env</span></a></span><span>
</span><span id="line-47"></span><span class="hs-keyword">import</span><span> </span><span class="annot"><a href="GHC.Tc.Utils.TcMType.html"><span class="hs-identifier">GHC.Tc.Utils.TcMType</span></a></span><span>
</span><span id="line-48"></span><span class="hs-keyword">import</span><span> </span><span class="annot"><a href="GHC.Tc.Validity.html"><span class="hs-identifier">GHC.Tc.Validity</span></a></span><span class="hs-special">(</span><span> </span><span class="annot"><a href="GHC.Tc.Validity.html#arityErr"><span class="hs-identifier">arityErr</span></a></span><span> </span><span class="hs-special">)</span><span>
</span><span id="line-49"></span><span class="hs-keyword">import</span><span> </span><span class="annot"><a href="GHC.Core.TyCo.Ppr.html"><span class="hs-identifier">GHC.Core.TyCo.Ppr</span></a></span><span> </span><span class="hs-special">(</span><span> </span><span class="annot"><a href="GHC.Core.TyCo.Ppr.html#pprTyVars"><span class="hs-identifier">pprTyVars</span></a></span><span> </span><span class="hs-special">)</span><span>
</span><span id="line-50"></span><span class="hs-keyword">import</span><span> </span><span class="annot"><a href="GHC.Tc.Utils.TcType.html"><span class="hs-identifier">GHC.Tc.Utils.TcType</span></a></span><span>
</span><span id="line-51"></span><span class="hs-keyword">import</span><span> </span><span class="annot"><a href="GHC.Tc.Utils.Unify.html"><span class="hs-identifier">GHC.Tc.Utils.Unify</span></a></span><span>
</span><span id="line-52"></span><span class="hs-keyword">import</span><span> </span><span class="annot"><a href="GHC.Tc.Gen.HsType.html"><span class="hs-identifier">GHC.Tc.Gen.HsType</span></a></span><span>
</span><span id="line-53"></span><span class="hs-keyword">import</span><span> </span><span class="annot"><a href="GHC.Builtin.Types.html"><span class="hs-identifier">GHC.Builtin.Types</span></a></span><span>
</span><span id="line-54"></span><span class="hs-keyword">import</span><span> </span><span class="annot"><a href="GHC.Tc.Types.Evidence.html"><span class="hs-identifier">GHC.Tc.Types.Evidence</span></a></span><span>
</span><span id="line-55"></span><span class="hs-keyword">import</span><span> </span><span class="annot"><a href="GHC.Tc.Types.Origin.html"><span class="hs-identifier">GHC.Tc.Types.Origin</span></a></span><span>
</span><span id="line-56"></span><span class="hs-keyword">import</span><span> </span><span class="annot"><a href="GHC.Core.TyCon.html"><span class="hs-identifier">GHC.Core.TyCon</span></a></span><span>
</span><span id="line-57"></span><span class="hs-keyword">import</span><span> </span><span class="annot"><a href="GHC.Core.Type.html"><span class="hs-identifier">GHC.Core.Type</span></a></span><span>
</span><span id="line-58"></span><span class="hs-keyword">import</span><span> </span><span class="annot"><a href="GHC.Core.DataCon.html"><span class="hs-identifier">GHC.Core.DataCon</span></a></span><span>
</span><span id="line-59"></span><span class="hs-keyword">import</span><span> </span><span class="annot"><a href="GHC.Core.PatSyn.html"><span class="hs-identifier">GHC.Core.PatSyn</span></a></span><span>
</span><span id="line-60"></span><span class="hs-keyword">import</span><span> </span><span class="annot"><a href="GHC.Core.ConLike.html"><span class="hs-identifier">GHC.Core.ConLike</span></a></span><span>
</span><span id="line-61"></span><span class="hs-keyword">import</span><span> </span><span class="annot"><a href="GHC.Builtin.Names.html"><span class="hs-identifier">GHC.Builtin.Names</span></a></span><span>
</span><span id="line-62"></span><span class="hs-keyword">import</span><span> </span><span class="annot"><a href="GHC.Types.Basic.html"><span class="hs-identifier">GHC.Types.Basic</span></a></span><span> </span><span class="hs-keyword">hiding</span><span> </span><span class="hs-special">(</span><span class="annot"><a href="GHC.Types.Basic.html#SuccessFlag"><span class="hs-identifier">SuccessFlag</span></a></span><span class="hs-special">(</span><span class="hs-glyph">..</span><span class="hs-special">)</span><span class="hs-special">)</span><span>
</span><span id="line-63"></span><span class="hs-keyword">import</span><span> </span><span class="annot"><a href="GHC.Driver.Session.html"><span class="hs-identifier">GHC.Driver.Session</span></a></span><span>
</span><span id="line-64"></span><span class="hs-keyword">import</span><span> </span><span class="annot"><a href="GHC.Types.SrcLoc.html"><span class="hs-identifier">GHC.Types.SrcLoc</span></a></span><span>
</span><span id="line-65"></span><span class="hs-keyword">import</span><span> </span><span class="annot"><a href="GHC.Types.Var.Set.html"><span class="hs-identifier">GHC.Types.Var.Set</span></a></span><span>
</span><span id="line-66"></span><span class="hs-keyword">import</span><span> </span><span class="annot"><a href="GHC.Utils.Misc.html"><span class="hs-identifier">GHC.Utils.Misc</span></a></span><span>
</span><span id="line-67"></span><span class="hs-keyword">import</span><span> </span><span class="annot"><a href="GHC.Utils.Outputable.html"><span class="hs-identifier">GHC.Utils.Outputable</span></a></span><span> </span><span class="hs-keyword">as</span><span> </span><span class="annot"><span class="hs-identifier">Outputable</span></span><span>
</span><span id="line-68"></span><span class="hs-keyword">import</span><span> </span><span class="annot"><a href="GHC.Utils.Panic.html"><span class="hs-identifier">GHC.Utils.Panic</span></a></span><span>
</span><span id="line-69"></span><span class="hs-keyword">import</span><span> </span><span class="hs-keyword">qualified</span><span> </span><span class="annot"><a href="../../ghc-boot-9.2.7/src/GHC-LanguageExtensions.html#"><span class="hs-identifier">GHC.LanguageExtensions</span></a></span><span> </span><span class="hs-keyword">as</span><span> </span><span class="annot"><span class="hs-identifier">LangExt</span></span><span>
</span><span id="line-70"></span><span class="hs-keyword">import</span><span> </span><span class="annot"><a href="../../base-4.16.4.0/src/Control-Arrow.html#"><span class="hs-identifier">Control.Arrow</span></a></span><span>  </span><span class="hs-special">(</span><span> </span><span class="annot"><a href="../../base-4.16.4.0/src/Control-Arrow.html#second"><span class="hs-identifier">second</span></a></span><span> </span><span class="hs-special">)</span><span>
</span><span id="line-71"></span><span class="hs-keyword">import</span><span> </span><span class="annot"><a href="../../base-4.16.4.0/src/Control-Monad.html#"><span class="hs-identifier">Control.Monad</span></a></span><span>
</span><span id="line-72"></span><span class="hs-keyword">import</span><span> </span><span class="annot"><a href="GHC.Data.List.SetOps.html"><span class="hs-identifier">GHC.Data.List.SetOps</span></a></span><span> </span><span class="hs-special">(</span><span> </span><span class="annot"><a href="GHC.Data.List.SetOps.html#getNth"><span class="hs-identifier">getNth</span></a></span><span> </span><span class="hs-special">)</span><span>
</span><span id="line-73"></span><span>
</span><span id="line-74"></span><span class="hs-comment">{-
************************************************************************
*                                                                      *
                External interface
*                                                                      *
************************************************************************
-}</span><span>
</span><span id="line-81"></span><span>
</span><span id="line-82"></span><span id="local-6989586621681388178"><span class="annot"><a href="GHC.Tc.Gen.Pat.html#tcLetPat"><span class="hs-identifier hs-type">tcLetPat</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="hs-special">(</span><span class="annot"><a href="GHC.Types.Name.html#Name"><span class="hs-identifier hs-type">Name</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="../../base-4.16.4.0/src/GHC-Maybe.html#Maybe"><span class="hs-identifier hs-type">Maybe</span></a></span><span> </span><span class="annot"><a href="GHC.Tc.Types.html#TcId"><span class="hs-identifier hs-type">TcId</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-83"></span><span>         </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="GHC.Tc.Gen.Pat.html#LetBndrSpec"><span class="hs-identifier hs-type">LetBndrSpec</span></a></span><span>
</span><span id="line-84"></span><span>         </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="Language.Haskell.Syntax.Pat.html#LPat"><span class="hs-identifier hs-type">LPat</span></a></span><span> </span><span class="annot"><a href="GHC.Hs.Extension.html#GhcRn"><span class="hs-identifier hs-type">GhcRn</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="GHC.Core.TyCo.Rep.html#Scaled"><span class="hs-identifier hs-type">Scaled</span></a></span><span> </span><span class="annot"><a href="GHC.Tc.Utils.TcType.html#ExpSigmaType"><span class="hs-identifier hs-type">ExpSigmaType</span></a></span><span>
</span><span id="line-85"></span><span>         </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="GHC.Tc.Types.html#TcM"><span class="hs-identifier hs-type">TcM</span></a></span><span> </span><span class="annot"><a href="#local-6989586621681388178"><span class="hs-identifier hs-type">a</span></a></span><span>
</span><span id="line-86"></span><span>         </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="GHC.Tc.Types.html#TcM"><span class="hs-identifier hs-type">TcM</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="Language.Haskell.Syntax.Pat.html#LPat"><span class="hs-identifier hs-type">LPat</span></a></span><span> </span><span class="annot"><a href="GHC.Hs.Extension.html#GhcTc"><span class="hs-identifier hs-type">GhcTc</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><a href="#local-6989586621681388178"><span class="hs-identifier hs-type">a</span></a></span><span class="hs-special">)</span></span><span>
</span><span id="line-87"></span><span id="tcLetPat"><span class="annot"><span class="annottext">tcLetPat :: forall a.
(Name -&gt; Maybe TyVar)
-&gt; LetBndrSpec
-&gt; LPat GhcRn
-&gt; Scaled ExpSigmaType
-&gt; TcM a
-&gt; TcM (LPat GhcTc, a)
</span><a href="GHC.Tc.Gen.Pat.html#tcLetPat"><span class="hs-identifier hs-var hs-var">tcLetPat</span></a></span></span><span> </span><span id="local-6989586621681387807"><span class="annot"><span class="annottext">Name -&gt; Maybe TyVar
</span><a href="#local-6989586621681387807"><span class="hs-identifier hs-var">sig_fn</span></a></span></span><span> </span><span id="local-6989586621681387806"><span class="annot"><span class="annottext">LetBndrSpec
</span><a href="#local-6989586621681387806"><span class="hs-identifier hs-var">no_gen</span></a></span></span><span> </span><span id="local-6989586621681387805"><span class="annot"><span class="annottext">LPat GhcRn
</span><a href="#local-6989586621681387805"><span class="hs-identifier hs-var">pat</span></a></span></span><span> </span><span id="local-6989586621681387804"><span class="annot"><span class="annottext">Scaled ExpSigmaType
</span><a href="#local-6989586621681387804"><span class="hs-identifier hs-var">pat_ty</span></a></span></span><span> </span><span id="local-6989586621681387803"><span class="annot"><span class="annottext">TcM a
</span><a href="#local-6989586621681387803"><span class="hs-identifier hs-var">thing_inside</span></a></span></span><span>
</span><span id="line-88"></span><span>  </span><span class="hs-glyph">=</span><span> </span><span class="hs-keyword">do</span><span> </span><span class="hs-special">{</span><span> </span><span id="local-6989586621681387802"><span class="annot"><span class="annottext">TcLevel
</span><a href="#local-6989586621681387802"><span class="hs-identifier hs-var">bind_lvl</span></a></span></span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">TcM TcLevel
</span><a href="GHC.Tc.Utils.Monad.html#getTcLevel"><span class="hs-identifier hs-var">getTcLevel</span></a></span><span>
</span><span id="line-89"></span><span>       </span><span class="hs-special">;</span><span> </span><span class="hs-keyword">let</span><span> </span><span id="local-6989586621681387800"><span class="annot"><span class="annottext">ctxt :: PatCtxt
</span><a href="#local-6989586621681387800"><span class="hs-identifier hs-var hs-var">ctxt</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><a href="GHC.Tc.Gen.Pat.html#LetPat"><span class="hs-identifier hs-type">LetPat</span></a></span><span> </span><span class="hs-special">{</span><span> </span><span class="annot"><span class="annottext">pc_lvl :: TcLevel
</span><a href="GHC.Tc.Gen.Pat.html#pc_lvl"><span class="hs-identifier hs-var">pc_lvl</span></a></span><span>    </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">TcLevel
</span><a href="#local-6989586621681387802"><span class="hs-identifier hs-var">bind_lvl</span></a></span><span>
</span><span id="line-90"></span><span>                           </span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">pc_sig_fn :: Name -&gt; Maybe TyVar
</span><a href="GHC.Tc.Gen.Pat.html#pc_sig_fn"><span class="hs-identifier hs-var">pc_sig_fn</span></a></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">Name -&gt; Maybe TyVar
</span><a href="#local-6989586621681387807"><span class="hs-identifier hs-var">sig_fn</span></a></span><span>
</span><span id="line-91"></span><span>                           </span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">pc_new :: LetBndrSpec
</span><a href="GHC.Tc.Gen.Pat.html#pc_new"><span class="hs-identifier hs-var">pc_new</span></a></span><span>    </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">LetBndrSpec
</span><a href="#local-6989586621681387806"><span class="hs-identifier hs-var">no_gen</span></a></span><span> </span><span class="hs-special">}</span><span>
</span><span id="line-92"></span><span>             </span><span id="local-6989586621681387795"><span class="annot"><span class="annottext">penv :: PatEnv
</span><a href="#local-6989586621681387795"><span class="hs-identifier hs-var hs-var">penv</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><a href="GHC.Tc.Gen.Pat.html#PE"><span class="hs-identifier hs-type">PE</span></a></span><span> </span><span class="hs-special">{</span><span> </span><span class="annot"><span class="annottext">pe_lazy :: Bool
</span><a href="GHC.Tc.Gen.Pat.html#pe_lazy"><span class="hs-identifier hs-var">pe_lazy</span></a></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">Bool
</span><span class="hs-identifier hs-var">True</span></span><span>
</span><span id="line-93"></span><span>                       </span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">pe_ctxt :: PatCtxt
</span><a href="GHC.Tc.Gen.Pat.html#pe_ctxt"><span class="hs-identifier hs-var">pe_ctxt</span></a></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">PatCtxt
</span><a href="#local-6989586621681387800"><span class="hs-identifier hs-var">ctxt</span></a></span><span>
</span><span id="line-94"></span><span>                       </span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">pe_orig :: CtOrigin
</span><a href="GHC.Tc.Gen.Pat.html#pe_orig"><span class="hs-identifier hs-var">pe_orig</span></a></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">CtOrigin
</span><a href="GHC.Tc.Types.Origin.html#PatOrigin"><span class="hs-identifier hs-var">PatOrigin</span></a></span><span> </span><span class="hs-special">}</span><span>
</span><span id="line-95"></span><span>
</span><span id="line-96"></span><span>       </span><span class="hs-special">;</span><span> </span><span class="annot"><span class="annottext">Scaled ExpSigmaType -&gt; Checker (LPat GhcRn) (LPat GhcTc)
</span><a href="GHC.Tc.Gen.Pat.html#tc_lpat"><span class="hs-identifier hs-var">tc_lpat</span></a></span><span> </span><span class="annot"><span class="annottext">Scaled ExpSigmaType
</span><a href="#local-6989586621681387804"><span class="hs-identifier hs-var">pat_ty</span></a></span><span> </span><span class="annot"><span class="annottext">PatEnv
</span><a href="#local-6989586621681387795"><span class="hs-identifier hs-var">penv</span></a></span><span> </span><span class="annot"><span class="annottext">LPat GhcRn
</span><a href="#local-6989586621681387805"><span class="hs-identifier hs-var">pat</span></a></span><span> </span><span class="annot"><span class="annottext">TcM a
</span><a href="#local-6989586621681387803"><span class="hs-identifier hs-var">thing_inside</span></a></span><span> </span><span class="hs-special">}</span><span>
</span><span id="line-97"></span><span>
</span><span id="line-98"></span><span class="hs-comment">-----------------</span><span>
</span><span id="line-99"></span><span id="local-6989586621681388169"><span class="annot"><a href="GHC.Tc.Gen.Pat.html#tcPats"><span class="hs-identifier hs-type">tcPats</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><a href="Language.Haskell.Syntax.Expr.html#HsMatchContext"><span class="hs-identifier hs-type">HsMatchContext</span></a></span><span> </span><span class="annot"><a href="GHC.Hs.Extension.html#GhcRn"><span class="hs-identifier hs-type">GhcRn</span></a></span><span>
</span><span id="line-100"></span><span>       </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-special">[</span><span class="annot"><a href="Language.Haskell.Syntax.Pat.html#LPat"><span class="hs-identifier hs-type">LPat</span></a></span><span> </span><span class="annot"><a href="GHC.Hs.Extension.html#GhcRn"><span class="hs-identifier hs-type">GhcRn</span></a></span><span class="hs-special">]</span><span>            </span><span class="hs-comment">-- Patterns,</span><span>
</span><span id="line-101"></span><span>       </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-special">[</span><span class="annot"><a href="GHC.Core.TyCo.Rep.html#Scaled"><span class="hs-identifier hs-type">Scaled</span></a></span><span> </span><span class="annot"><a href="GHC.Tc.Utils.TcType.html#ExpSigmaType"><span class="hs-identifier hs-type">ExpSigmaType</span></a></span><span class="hs-special">]</span><span>         </span><span class="hs-comment">--   and their types</span><span>
</span><span id="line-102"></span><span>       </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="GHC.Tc.Types.html#TcM"><span class="hs-identifier hs-type">TcM</span></a></span><span> </span><span class="annot"><a href="#local-6989586621681388169"><span class="hs-identifier hs-type">a</span></a></span><span>                  </span><span class="hs-comment">--   and the checker for the body</span><span>
</span><span id="line-103"></span><span>       </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="GHC.Tc.Types.html#TcM"><span class="hs-identifier hs-type">TcM</span></a></span><span> </span><span class="hs-special">(</span><span class="hs-special">[</span><span class="annot"><a href="Language.Haskell.Syntax.Pat.html#LPat"><span class="hs-identifier hs-type">LPat</span></a></span><span> </span><span class="annot"><a href="GHC.Hs.Extension.html#GhcTc"><span class="hs-identifier hs-type">GhcTc</span></a></span><span class="hs-special">]</span><span class="hs-special">,</span><span> </span><span class="annot"><a href="#local-6989586621681388169"><span class="hs-identifier hs-type">a</span></a></span><span class="hs-special">)</span></span><span>
</span><span id="line-104"></span><span>
</span><span id="line-105"></span><span class="hs-comment">-- This is the externally-callable wrapper function</span><span>
</span><span id="line-106"></span><span class="hs-comment">-- Typecheck the patterns, extend the environment to bind the variables,</span><span>
</span><span id="line-107"></span><span class="hs-comment">-- do the thing inside, use any existentially-bound dictionaries to</span><span>
</span><span id="line-108"></span><span class="hs-comment">-- discharge parts of the returning LIE, and deal with pattern type</span><span>
</span><span id="line-109"></span><span class="hs-comment">-- signatures</span><span>
</span><span id="line-110"></span><span>
</span><span id="line-111"></span><span class="hs-comment">--   1. Initialise the PatState</span><span>
</span><span id="line-112"></span><span class="hs-comment">--   2. Check the patterns</span><span>
</span><span id="line-113"></span><span class="hs-comment">--   3. Check the body</span><span>
</span><span id="line-114"></span><span class="hs-comment">--   4. Check that no existentials escape</span><span>
</span><span id="line-115"></span><span>
</span><span id="line-116"></span><span id="tcPats"><span class="annot"><span class="annottext">tcPats :: forall a.
HsMatchContext GhcRn
-&gt; [LPat GhcRn]
-&gt; [Scaled ExpSigmaType]
-&gt; TcM a
-&gt; TcM ([LPat GhcTc], a)
</span><a href="GHC.Tc.Gen.Pat.html#tcPats"><span class="hs-identifier hs-var hs-var">tcPats</span></a></span></span><span> </span><span id="local-6989586621681387788"><span class="annot"><span class="annottext">HsMatchContext GhcRn
</span><a href="#local-6989586621681387788"><span class="hs-identifier hs-var">ctxt</span></a></span></span><span> </span><span id="local-6989586621681387787"><span class="annot"><span class="annottext">[LPat GhcRn]
</span><a href="#local-6989586621681387787"><span class="hs-identifier hs-var">pats</span></a></span></span><span> </span><span id="local-6989586621681387786"><span class="annot"><span class="annottext">[Scaled ExpSigmaType]
</span><a href="#local-6989586621681387786"><span class="hs-identifier hs-var">pat_tys</span></a></span></span><span> </span><span id="local-6989586621681387785"><span class="annot"><span class="annottext">TcM a
</span><a href="#local-6989586621681387785"><span class="hs-identifier hs-var">thing_inside</span></a></span></span><span>
</span><span id="line-117"></span><span>  </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">[Scaled ExpSigmaType] -&gt; Checker [LPat GhcRn] [LPat GhcTc]
</span><a href="GHC.Tc.Gen.Pat.html#tc_lpats"><span class="hs-identifier hs-var">tc_lpats</span></a></span><span> </span><span class="annot"><span class="annottext">[Scaled ExpSigmaType]
</span><a href="#local-6989586621681387786"><span class="hs-identifier hs-var">pat_tys</span></a></span><span> </span><span class="annot"><span class="annottext">PatEnv
</span><a href="#local-6989586621681387783"><span class="hs-identifier hs-var">penv</span></a></span><span> </span><span class="annot"><span class="annottext">[LPat GhcRn]
</span><a href="#local-6989586621681387787"><span class="hs-identifier hs-var">pats</span></a></span><span> </span><span class="annot"><span class="annottext">TcM a
</span><a href="#local-6989586621681387785"><span class="hs-identifier hs-var">thing_inside</span></a></span><span>
</span><span id="line-118"></span><span>  </span><span class="hs-keyword">where</span><span>
</span><span id="line-119"></span><span>    </span><span id="local-6989586621681387783"><span class="annot"><span class="annottext">penv :: PatEnv
</span><a href="#local-6989586621681387783"><span class="hs-identifier hs-var hs-var">penv</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><a href="GHC.Tc.Gen.Pat.html#PE"><span class="hs-identifier hs-type">PE</span></a></span><span> </span><span class="hs-special">{</span><span> </span><span class="annot"><span class="annottext">pe_lazy :: Bool
</span><a href="GHC.Tc.Gen.Pat.html#pe_lazy"><span class="hs-identifier hs-var">pe_lazy</span></a></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">Bool
</span><span class="hs-identifier hs-var">False</span></span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">pe_ctxt :: PatCtxt
</span><a href="GHC.Tc.Gen.Pat.html#pe_ctxt"><span class="hs-identifier hs-var">pe_ctxt</span></a></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">HsMatchContext GhcRn -&gt; PatCtxt
</span><a href="GHC.Tc.Gen.Pat.html#LamPat"><span class="hs-identifier hs-var">LamPat</span></a></span><span> </span><span class="annot"><span class="annottext">HsMatchContext GhcRn
</span><a href="#local-6989586621681387788"><span class="hs-identifier hs-var">ctxt</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">pe_orig :: CtOrigin
</span><a href="GHC.Tc.Gen.Pat.html#pe_orig"><span class="hs-identifier hs-var">pe_orig</span></a></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">CtOrigin
</span><a href="GHC.Tc.Types.Origin.html#PatOrigin"><span class="hs-identifier hs-var">PatOrigin</span></a></span><span> </span><span class="hs-special">}</span><span>
</span><span id="line-120"></span><span>
</span><span id="line-121"></span><span id="local-6989586621681388167"><span class="annot"><a href="GHC.Tc.Gen.Pat.html#tcInferPat"><span class="hs-identifier hs-type">tcInferPat</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><a href="Language.Haskell.Syntax.Expr.html#HsMatchContext"><span class="hs-identifier hs-type">HsMatchContext</span></a></span><span> </span><span class="annot"><a href="GHC.Hs.Extension.html#GhcRn"><span class="hs-identifier hs-type">GhcRn</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="Language.Haskell.Syntax.Pat.html#LPat"><span class="hs-identifier hs-type">LPat</span></a></span><span> </span><span class="annot"><a href="GHC.Hs.Extension.html#GhcRn"><span class="hs-identifier hs-type">GhcRn</span></a></span><span>
</span><span id="line-122"></span><span>           </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="GHC.Tc.Types.html#TcM"><span class="hs-identifier hs-type">TcM</span></a></span><span> </span><span class="annot"><a href="#local-6989586621681388167"><span class="hs-identifier hs-type">a</span></a></span><span>
</span><span id="line-123"></span><span>           </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="GHC.Tc.Types.html#TcM"><span class="hs-identifier hs-type">TcM</span></a></span><span> </span><span class="hs-special">(</span><span class="hs-special">(</span><span class="annot"><a href="Language.Haskell.Syntax.Pat.html#LPat"><span class="hs-identifier hs-type">LPat</span></a></span><span> </span><span class="annot"><a href="GHC.Hs.Extension.html#GhcTc"><span class="hs-identifier hs-type">GhcTc</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><a href="#local-6989586621681388167"><span class="hs-identifier hs-type">a</span></a></span><span class="hs-special">)</span><span class="hs-special">,</span><span> </span><span class="annot"><a href="GHC.Tc.Utils.TcType.html#TcSigmaType"><span class="hs-identifier hs-type">TcSigmaType</span></a></span><span class="hs-special">)</span></span><span>
</span><span id="line-124"></span><span id="tcInferPat"><span class="annot"><span class="annottext">tcInferPat :: forall a.
HsMatchContext GhcRn
-&gt; LPat GhcRn -&gt; TcM a -&gt; TcM ((LPat GhcTc, a), TcType)
</span><a href="GHC.Tc.Gen.Pat.html#tcInferPat"><span class="hs-identifier hs-var hs-var">tcInferPat</span></a></span></span><span> </span><span id="local-6989586621681387780"><span class="annot"><span class="annottext">HsMatchContext GhcRn
</span><a href="#local-6989586621681387780"><span class="hs-identifier hs-var">ctxt</span></a></span></span><span> </span><span id="local-6989586621681387779"><span class="annot"><span class="annottext">LPat GhcRn
</span><a href="#local-6989586621681387779"><span class="hs-identifier hs-var">pat</span></a></span></span><span> </span><span id="local-6989586621681387778"><span class="annot"><span class="annottext">TcM a
</span><a href="#local-6989586621681387778"><span class="hs-identifier hs-var">thing_inside</span></a></span></span><span>
</span><span id="line-125"></span><span>  </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">forall a. (ExpSigmaType -&gt; TcM a) -&gt; TcM (a, TcType)
</span><a href="GHC.Tc.Utils.TcMType.html#tcInfer"><span class="hs-identifier hs-var">tcInfer</span></a></span><span> </span><span class="annot"><span class="annottext">forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><a href="../../base-4.16.4.0/src/GHC-Base.html#%24"><span class="hs-operator hs-var">$</span></a></span><span> </span><span class="hs-glyph">\</span><span> </span><span id="local-6989586621681387776"><span class="annot"><span class="annottext">ExpSigmaType
</span><a href="#local-6989586621681387776"><span class="hs-identifier hs-var">exp_ty</span></a></span></span><span> </span><span class="hs-glyph">-&gt;</span><span>
</span><span id="line-126"></span><span>    </span><span class="annot"><span class="annottext">Scaled ExpSigmaType -&gt; Checker (LPat GhcRn) (LPat GhcTc)
</span><a href="GHC.Tc.Gen.Pat.html#tc_lpat"><span class="hs-identifier hs-var">tc_lpat</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">forall a. a -&gt; Scaled a
</span><a href="GHC.Core.Type.html#unrestricted"><span class="hs-identifier hs-var">unrestricted</span></a></span><span> </span><span class="annot"><span class="annottext">ExpSigmaType
</span><a href="#local-6989586621681387776"><span class="hs-identifier hs-var">exp_ty</span></a></span><span class="hs-special">)</span><span> </span><span class="annot"><span class="annottext">PatEnv
</span><a href="#local-6989586621681387774"><span class="hs-identifier hs-var">penv</span></a></span><span> </span><span class="annot"><span class="annottext">LPat GhcRn
</span><a href="#local-6989586621681387779"><span class="hs-identifier hs-var">pat</span></a></span><span> </span><span class="annot"><span class="annottext">TcM a
</span><a href="#local-6989586621681387778"><span class="hs-identifier hs-var">thing_inside</span></a></span><span>
</span><span id="line-127"></span><span> </span><span class="hs-keyword">where</span><span>
</span><span id="line-128"></span><span>    </span><span id="local-6989586621681387774"><span class="annot"><span class="annottext">penv :: PatEnv
</span><a href="#local-6989586621681387774"><span class="hs-identifier hs-var hs-var">penv</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><a href="GHC.Tc.Gen.Pat.html#PE"><span class="hs-identifier hs-type">PE</span></a></span><span> </span><span class="hs-special">{</span><span> </span><span class="annot"><span class="annottext">pe_lazy :: Bool
</span><a href="GHC.Tc.Gen.Pat.html#pe_lazy"><span class="hs-identifier hs-var">pe_lazy</span></a></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">Bool
</span><span class="hs-identifier hs-var">False</span></span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">pe_ctxt :: PatCtxt
</span><a href="GHC.Tc.Gen.Pat.html#pe_ctxt"><span class="hs-identifier hs-var">pe_ctxt</span></a></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">HsMatchContext GhcRn -&gt; PatCtxt
</span><a href="GHC.Tc.Gen.Pat.html#LamPat"><span class="hs-identifier hs-var">LamPat</span></a></span><span> </span><span class="annot"><span class="annottext">HsMatchContext GhcRn
</span><a href="#local-6989586621681387780"><span class="hs-identifier hs-var">ctxt</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">pe_orig :: CtOrigin
</span><a href="GHC.Tc.Gen.Pat.html#pe_orig"><span class="hs-identifier hs-var">pe_orig</span></a></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">CtOrigin
</span><a href="GHC.Tc.Types.Origin.html#PatOrigin"><span class="hs-identifier hs-var">PatOrigin</span></a></span><span> </span><span class="hs-special">}</span><span>
</span><span id="line-129"></span><span>
</span><span id="line-130"></span><span id="local-6989586621681388160"><span class="annot"><a href="GHC.Tc.Gen.Pat.html#tcCheckPat"><span class="hs-identifier hs-type">tcCheckPat</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><a href="Language.Haskell.Syntax.Expr.html#HsMatchContext"><span class="hs-identifier hs-type">HsMatchContext</span></a></span><span> </span><span class="annot"><a href="GHC.Hs.Extension.html#GhcRn"><span class="hs-identifier hs-type">GhcRn</span></a></span><span>
</span><span id="line-131"></span><span>           </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="Language.Haskell.Syntax.Pat.html#LPat"><span class="hs-identifier hs-type">LPat</span></a></span><span> </span><span class="annot"><a href="GHC.Hs.Extension.html#GhcRn"><span class="hs-identifier hs-type">GhcRn</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="GHC.Core.TyCo.Rep.html#Scaled"><span class="hs-identifier hs-type">Scaled</span></a></span><span> </span><span class="annot"><a href="GHC.Tc.Utils.TcType.html#TcSigmaType"><span class="hs-identifier hs-type">TcSigmaType</span></a></span><span>
</span><span id="line-132"></span><span>           </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="GHC.Tc.Types.html#TcM"><span class="hs-identifier hs-type">TcM</span></a></span><span> </span><span class="annot"><a href="#local-6989586621681388160"><span class="hs-identifier hs-type">a</span></a></span><span>                     </span><span class="hs-comment">-- Checker for body</span><span>
</span><span id="line-133"></span><span>           </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="GHC.Tc.Types.html#TcM"><span class="hs-identifier hs-type">TcM</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="Language.Haskell.Syntax.Pat.html#LPat"><span class="hs-identifier hs-type">LPat</span></a></span><span> </span><span class="annot"><a href="GHC.Hs.Extension.html#GhcTc"><span class="hs-identifier hs-type">GhcTc</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><a href="#local-6989586621681388160"><span class="hs-identifier hs-type">a</span></a></span><span class="hs-special">)</span></span><span>
</span><span id="line-134"></span><span id="tcCheckPat"><span class="annot"><span class="annottext">tcCheckPat :: forall a.
HsMatchContext GhcRn
-&gt; LPat GhcRn -&gt; Scaled TcType -&gt; TcM a -&gt; TcM (LPat GhcTc, a)
</span><a href="GHC.Tc.Gen.Pat.html#tcCheckPat"><span class="hs-identifier hs-var hs-var">tcCheckPat</span></a></span></span><span> </span><span id="local-6989586621681387773"><span class="annot"><span class="annottext">HsMatchContext GhcRn
</span><a href="#local-6989586621681387773"><span class="hs-identifier hs-var">ctxt</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">forall a.
HsMatchContext GhcRn
-&gt; CtOrigin
-&gt; LPat GhcRn
-&gt; Scaled TcType
-&gt; TcM a
-&gt; TcM (LPat GhcTc, a)
</span><a href="GHC.Tc.Gen.Pat.html#tcCheckPat_O"><span class="hs-identifier hs-var">tcCheckPat_O</span></a></span><span> </span><span class="annot"><span class="annottext">HsMatchContext GhcRn
</span><a href="#local-6989586621681387773"><span class="hs-identifier hs-var">ctxt</span></a></span><span> </span><span class="annot"><span class="annottext">CtOrigin
</span><a href="GHC.Tc.Types.Origin.html#PatOrigin"><span class="hs-identifier hs-var">PatOrigin</span></a></span><span>
</span><span id="line-135"></span><span>
</span><span id="line-136"></span><span class="hs-comment">-- | A variant of 'tcPat' that takes a custom origin</span><span>
</span><span id="line-137"></span><span id="local-6989586621681388159"><span class="annot"><a href="GHC.Tc.Gen.Pat.html#tcCheckPat_O"><span class="hs-identifier hs-type">tcCheckPat_O</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><a href="Language.Haskell.Syntax.Expr.html#HsMatchContext"><span class="hs-identifier hs-type">HsMatchContext</span></a></span><span> </span><span class="annot"><a href="GHC.Hs.Extension.html#GhcRn"><span class="hs-identifier hs-type">GhcRn</span></a></span><span>
</span><span id="line-138"></span><span>             </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="GHC.Tc.Types.Origin.html#CtOrigin"><span class="hs-identifier hs-type">CtOrigin</span></a></span><span>              </span><span class="hs-comment">-- ^ origin to use if the type needs inst'ing</span><span>
</span><span id="line-139"></span><span>             </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="Language.Haskell.Syntax.Pat.html#LPat"><span class="hs-identifier hs-type">LPat</span></a></span><span> </span><span class="annot"><a href="GHC.Hs.Extension.html#GhcRn"><span class="hs-identifier hs-type">GhcRn</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="GHC.Core.TyCo.Rep.html#Scaled"><span class="hs-identifier hs-type">Scaled</span></a></span><span> </span><span class="annot"><a href="GHC.Tc.Utils.TcType.html#TcSigmaType"><span class="hs-identifier hs-type">TcSigmaType</span></a></span><span>
</span><span id="line-140"></span><span>             </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="GHC.Tc.Types.html#TcM"><span class="hs-identifier hs-type">TcM</span></a></span><span> </span><span class="annot"><a href="#local-6989586621681388159"><span class="hs-identifier hs-type">a</span></a></span><span>                 </span><span class="hs-comment">-- Checker for body</span><span>
</span><span id="line-141"></span><span>             </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="GHC.Tc.Types.html#TcM"><span class="hs-identifier hs-type">TcM</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="Language.Haskell.Syntax.Pat.html#LPat"><span class="hs-identifier hs-type">LPat</span></a></span><span> </span><span class="annot"><a href="GHC.Hs.Extension.html#GhcTc"><span class="hs-identifier hs-type">GhcTc</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><a href="#local-6989586621681388159"><span class="hs-identifier hs-type">a</span></a></span><span class="hs-special">)</span></span><span>
</span><span id="line-142"></span><span id="tcCheckPat_O"><span class="annot"><span class="annottext">tcCheckPat_O :: forall a.
HsMatchContext GhcRn
-&gt; CtOrigin
-&gt; LPat GhcRn
-&gt; Scaled TcType
-&gt; TcM a
-&gt; TcM (LPat GhcTc, a)
</span><a href="GHC.Tc.Gen.Pat.html#tcCheckPat_O"><span class="hs-identifier hs-var hs-var">tcCheckPat_O</span></a></span></span><span> </span><span id="local-6989586621681387772"><span class="annot"><span class="annottext">HsMatchContext GhcRn
</span><a href="#local-6989586621681387772"><span class="hs-identifier hs-var">ctxt</span></a></span></span><span> </span><span id="local-6989586621681387771"><span class="annot"><span class="annottext">CtOrigin
</span><a href="#local-6989586621681387771"><span class="hs-identifier hs-var">orig</span></a></span></span><span> </span><span id="local-6989586621681387770"><span class="annot"><span class="annottext">LPat GhcRn
</span><a href="#local-6989586621681387770"><span class="hs-identifier hs-var">pat</span></a></span></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="GHC.Core.TyCo.Rep.html#Scaled"><span class="hs-identifier hs-type">Scaled</span></a></span><span> </span><span id="local-6989586621681387768"><span class="annot"><span class="annottext">TcType
</span><a href="#local-6989586621681387768"><span class="hs-identifier hs-var">pat_mult</span></a></span></span><span> </span><span id="local-6989586621681387767"><span class="annot"><span class="annottext">TcType
</span><a href="#local-6989586621681387767"><span class="hs-identifier hs-var">pat_ty</span></a></span></span><span class="hs-special">)</span><span> </span><span id="local-6989586621681387766"><span class="annot"><span class="annottext">TcM a
</span><a href="#local-6989586621681387766"><span class="hs-identifier hs-var">thing_inside</span></a></span></span><span>
</span><span id="line-143"></span><span>  </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">Scaled ExpSigmaType -&gt; Checker (LPat GhcRn) (LPat GhcTc)
</span><a href="GHC.Tc.Gen.Pat.html#tc_lpat"><span class="hs-identifier hs-var">tc_lpat</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">forall a. TcType -&gt; a -&gt; Scaled a
</span><a href="GHC.Core.TyCo.Rep.html#Scaled"><span class="hs-identifier hs-var">Scaled</span></a></span><span> </span><span class="annot"><span class="annottext">TcType
</span><a href="#local-6989586621681387768"><span class="hs-identifier hs-var">pat_mult</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">TcType -&gt; ExpSigmaType
</span><a href="GHC.Tc.Utils.TcType.html#mkCheckExpType"><span class="hs-identifier hs-var">mkCheckExpType</span></a></span><span> </span><span class="annot"><span class="annottext">TcType
</span><a href="#local-6989586621681387767"><span class="hs-identifier hs-var">pat_ty</span></a></span><span class="hs-special">)</span><span class="hs-special">)</span><span> </span><span class="annot"><span class="annottext">PatEnv
</span><a href="#local-6989586621681387764"><span class="hs-identifier hs-var">penv</span></a></span><span> </span><span class="annot"><span class="annottext">LPat GhcRn
</span><a href="#local-6989586621681387770"><span class="hs-identifier hs-var">pat</span></a></span><span> </span><span class="annot"><span class="annottext">TcM a
</span><a href="#local-6989586621681387766"><span class="hs-identifier hs-var">thing_inside</span></a></span><span>
</span><span id="line-144"></span><span>  </span><span class="hs-keyword">where</span><span>
</span><span id="line-145"></span><span>    </span><span id="local-6989586621681387764"><span class="annot"><span class="annottext">penv :: PatEnv
</span><a href="#local-6989586621681387764"><span class="hs-identifier hs-var hs-var">penv</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><a href="GHC.Tc.Gen.Pat.html#PE"><span class="hs-identifier hs-type">PE</span></a></span><span> </span><span class="hs-special">{</span><span> </span><span class="annot"><span class="annottext">pe_lazy :: Bool
</span><a href="GHC.Tc.Gen.Pat.html#pe_lazy"><span class="hs-identifier hs-var">pe_lazy</span></a></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">Bool
</span><span class="hs-identifier hs-var">False</span></span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">pe_ctxt :: PatCtxt
</span><a href="GHC.Tc.Gen.Pat.html#pe_ctxt"><span class="hs-identifier hs-var">pe_ctxt</span></a></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">HsMatchContext GhcRn -&gt; PatCtxt
</span><a href="GHC.Tc.Gen.Pat.html#LamPat"><span class="hs-identifier hs-var">LamPat</span></a></span><span> </span><span class="annot"><span class="annottext">HsMatchContext GhcRn
</span><a href="#local-6989586621681387772"><span class="hs-identifier hs-var">ctxt</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">pe_orig :: CtOrigin
</span><a href="GHC.Tc.Gen.Pat.html#pe_orig"><span class="hs-identifier hs-var">pe_orig</span></a></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">CtOrigin
</span><a href="#local-6989586621681387771"><span class="hs-identifier hs-var">orig</span></a></span><span> </span><span class="hs-special">}</span><span>
</span><span id="line-146"></span><span>
</span><span id="line-147"></span><span>
</span><span id="line-148"></span><span class="hs-comment">{-
************************************************************************
*                                                                      *
                PatEnv, PatCtxt, LetBndrSpec
*                                                                      *
************************************************************************
-}</span><span>
</span><span id="line-155"></span><span>
</span><span id="line-156"></span><span class="hs-keyword">data</span><span> </span><span id="PatEnv"><span class="annot"><a href="GHC.Tc.Gen.Pat.html#PatEnv"><span class="hs-identifier hs-var">PatEnv</span></a></span></span><span>
</span><span id="line-157"></span><span>  </span><span class="hs-glyph">=</span><span> </span><span id="PE"><span class="annot"><a href="GHC.Tc.Gen.Pat.html#PE"><span class="hs-identifier hs-var">PE</span></a></span></span><span> </span><span class="hs-special">{</span><span> </span><span id="pe_lazy"><span class="annot"><span class="annottext">PatEnv -&gt; Bool
</span><a href="GHC.Tc.Gen.Pat.html#pe_lazy"><span class="hs-identifier hs-var hs-var">pe_lazy</span></a></span></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><span class="hs-identifier hs-type">Bool</span></span><span>        </span><span class="hs-comment">-- True &lt;=&gt; lazy context, so no existentials allowed</span><span>
</span><span id="line-158"></span><span>       </span><span class="hs-special">,</span><span> </span><span id="pe_ctxt"><span class="annot"><span class="annottext">PatEnv -&gt; PatCtxt
</span><a href="GHC.Tc.Gen.Pat.html#pe_ctxt"><span class="hs-identifier hs-var hs-var">pe_ctxt</span></a></span></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><a href="GHC.Tc.Gen.Pat.html#PatCtxt"><span class="hs-identifier hs-type">PatCtxt</span></a></span><span>     </span><span class="hs-comment">-- Context in which the whole pattern appears</span><span>
</span><span id="line-159"></span><span>       </span><span class="hs-special">,</span><span> </span><span id="pe_orig"><span class="annot"><span class="annottext">PatEnv -&gt; CtOrigin
</span><a href="GHC.Tc.Gen.Pat.html#pe_orig"><span class="hs-identifier hs-var hs-var">pe_orig</span></a></span></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><a href="GHC.Tc.Types.Origin.html#CtOrigin"><span class="hs-identifier hs-type">CtOrigin</span></a></span><span>    </span><span class="hs-comment">-- origin to use if the pat_ty needs inst'ing</span><span>
</span><span id="line-160"></span><span>       </span><span class="hs-special">}</span><span>
</span><span id="line-161"></span><span>
</span><span id="line-162"></span><span class="hs-keyword">data</span><span> </span><span id="PatCtxt"><span class="annot"><a href="GHC.Tc.Gen.Pat.html#PatCtxt"><span class="hs-identifier hs-var">PatCtxt</span></a></span></span><span>
</span><span id="line-163"></span><span>  </span><span class="hs-glyph">=</span><span> </span><span id="LamPat"><span class="annot"><a href="GHC.Tc.Gen.Pat.html#LamPat"><span class="hs-identifier hs-var">LamPat</span></a></span></span><span>   </span><span class="hs-comment">-- Used for lambdas, case etc</span><span>
</span><span id="line-164"></span><span>       </span><span class="hs-special">(</span><span class="annot"><a href="Language.Haskell.Syntax.Expr.html#HsMatchContext"><span class="hs-identifier hs-type">HsMatchContext</span></a></span><span> </span><span class="annot"><a href="GHC.Hs.Extension.html#GhcRn"><span class="hs-identifier hs-type">GhcRn</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-165"></span><span>
</span><span id="line-166"></span><span>  </span><span class="hs-glyph">|</span><span> </span><span id="LetPat"><span class="annot"><a href="GHC.Tc.Gen.Pat.html#LetPat"><span class="hs-identifier hs-var">LetPat</span></a></span></span><span>   </span><span class="hs-comment">-- Used only for let(rec) pattern bindings</span><span>
</span><span id="line-167"></span><span>             </span><span class="hs-comment">-- See Note [Typing patterns in pattern bindings]</span><span>
</span><span id="line-168"></span><span>       </span><span class="hs-special">{</span><span> </span><span id="pc_lvl"><span class="annot"><span class="annottext">PatCtxt -&gt; TcLevel
</span><a href="GHC.Tc.Gen.Pat.html#pc_lvl"><span class="hs-identifier hs-var hs-var">pc_lvl</span></a></span></span><span>    </span><span class="hs-glyph">::</span><span> </span><span class="annot"><a href="GHC.Tc.Utils.TcType.html#TcLevel"><span class="hs-identifier hs-type">TcLevel</span></a></span><span>
</span><span id="line-169"></span><span>                   </span><span class="hs-comment">-- Level of the binding group</span><span>
</span><span id="line-170"></span><span>
</span><span id="line-171"></span><span>       </span><span class="hs-special">,</span><span> </span><span id="pc_sig_fn"><span class="annot"><span class="annottext">PatCtxt -&gt; Name -&gt; Maybe TyVar
</span><a href="GHC.Tc.Gen.Pat.html#pc_sig_fn"><span class="hs-identifier hs-var hs-var">pc_sig_fn</span></a></span></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><a href="GHC.Types.Name.html#Name"><span class="hs-identifier hs-type">Name</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="../../base-4.16.4.0/src/GHC-Maybe.html#Maybe"><span class="hs-identifier hs-type">Maybe</span></a></span><span> </span><span class="annot"><a href="GHC.Tc.Types.html#TcId"><span class="hs-identifier hs-type">TcId</span></a></span><span>
</span><span id="line-172"></span><span>                   </span><span class="hs-comment">-- Tells the expected type</span><span>
</span><span id="line-173"></span><span>                   </span><span class="hs-comment">-- for binders with a signature</span><span>
</span><span id="line-174"></span><span>
</span><span id="line-175"></span><span>       </span><span class="hs-special">,</span><span> </span><span id="pc_new"><span class="annot"><span class="annottext">PatCtxt -&gt; LetBndrSpec
</span><a href="GHC.Tc.Gen.Pat.html#pc_new"><span class="hs-identifier hs-var hs-var">pc_new</span></a></span></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><a href="GHC.Tc.Gen.Pat.html#LetBndrSpec"><span class="hs-identifier hs-type">LetBndrSpec</span></a></span><span>
</span><span id="line-176"></span><span>                </span><span class="hs-comment">-- How to make a new binder</span><span>
</span><span id="line-177"></span><span>       </span><span class="hs-special">}</span><span>        </span><span class="hs-comment">-- for binders without signatures</span><span>
</span><span id="line-178"></span><span>
</span><span id="line-179"></span><span class="hs-keyword">data</span><span> </span><span id="LetBndrSpec"><span class="annot"><a href="GHC.Tc.Gen.Pat.html#LetBndrSpec"><span class="hs-identifier hs-var">LetBndrSpec</span></a></span></span><span>
</span><span id="line-180"></span><span>  </span><span class="hs-glyph">=</span><span> </span><span id="LetLclBndr"><span class="annot"><a href="GHC.Tc.Gen.Pat.html#LetLclBndr"><span class="hs-identifier hs-var">LetLclBndr</span></a></span></span><span>            </span><span class="hs-comment">-- We are going to generalise, and wrap in an AbsBinds</span><span>
</span><span id="line-181"></span><span>                          </span><span class="hs-comment">-- so clone a fresh binder for the local monomorphic Id</span><span>
</span><span id="line-182"></span><span>
</span><span id="line-183"></span><span>  </span><span class="hs-glyph">|</span><span> </span><span id="LetGblBndr"><span class="annot"><a href="GHC.Tc.Gen.Pat.html#LetGblBndr"><span class="hs-identifier hs-var">LetGblBndr</span></a></span></span><span> </span><span class="annot"><a href="GHC.Tc.Gen.Sig.html#TcPragEnv"><span class="hs-identifier hs-type">TcPragEnv</span></a></span><span>  </span><span class="hs-comment">-- Generalisation plan is NoGen, so there isn't going</span><span>
</span><span id="line-184"></span><span>                          </span><span class="hs-comment">-- to be an AbsBinds; So we must bind the global version</span><span>
</span><span id="line-185"></span><span>                          </span><span class="hs-comment">-- of the binder right away.</span><span>
</span><span id="line-186"></span><span>                          </span><span class="hs-comment">-- And here is the inline-pragma information</span><span>
</span><span id="line-187"></span><span>
</span><span id="line-188"></span><span class="hs-keyword">instance</span><span> </span><span class="annot"><a href="GHC.Utils.Outputable.html#Outputable"><span class="hs-identifier hs-type">Outputable</span></a></span><span> </span><span class="annot"><a href="GHC.Tc.Gen.Pat.html#LetBndrSpec"><span class="hs-identifier hs-type">LetBndrSpec</span></a></span><span> </span><span class="hs-keyword">where</span><span>
</span><span id="line-189"></span><span>  </span><span id="local-6989586621681387758"><span class="annot"><span class="annottext">ppr :: LetBndrSpec -&gt; SDoc
</span><a href="GHC.Utils.Outputable.html#ppr"><span class="hs-identifier hs-var hs-var hs-var hs-var">ppr</span></a></span></span><span> </span><span class="annot"><span class="annottext">LetBndrSpec
</span><a href="GHC.Tc.Gen.Pat.html#LetLclBndr"><span class="hs-identifier hs-var">LetLclBndr</span></a></span><span>      </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">String -&gt; SDoc
</span><a href="GHC.Utils.Outputable.html#text"><span class="hs-identifier hs-var">text</span></a></span><span> </span><span class="annot"><span class="annottext">String
</span><span class="hs-string">&quot;LetLclBndr&quot;</span></span><span>
</span><span id="line-190"></span><span>  </span><span class="annot"><a href="GHC.Utils.Outputable.html#ppr"><span class="hs-identifier hs-var">ppr</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="GHC.Tc.Gen.Pat.html#LetGblBndr"><span class="hs-identifier hs-type">LetGblBndr</span></a></span><span> </span><span class="hs-special">{</span><span class="hs-special">}</span><span class="hs-special">)</span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">String -&gt; SDoc
</span><a href="GHC.Utils.Outputable.html#text"><span class="hs-identifier hs-var">text</span></a></span><span> </span><span class="annot"><span class="annottext">String
</span><span class="hs-string">&quot;LetGblBndr&quot;</span></span><span>
</span><span id="line-191"></span><span>
</span><span id="line-192"></span><span class="annot"><a href="GHC.Tc.Gen.Pat.html#makeLazy"><span class="hs-identifier hs-type">makeLazy</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><a href="GHC.Tc.Gen.Pat.html#PatEnv"><span class="hs-identifier hs-type">PatEnv</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="GHC.Tc.Gen.Pat.html#PatEnv"><span class="hs-identifier hs-type">PatEnv</span></a></span><span>
</span><span id="line-193"></span><span id="makeLazy"><span class="annot"><span class="annottext">makeLazy :: PatEnv -&gt; PatEnv
</span><a href="GHC.Tc.Gen.Pat.html#makeLazy"><span class="hs-identifier hs-var hs-var">makeLazy</span></a></span></span><span> </span><span id="local-6989586621681387754"><span class="annot"><span class="annottext">PatEnv
</span><a href="#local-6989586621681387754"><span class="hs-identifier hs-var">penv</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">PatEnv
</span><a href="#local-6989586621681387754"><span class="hs-identifier hs-var">penv</span></a></span><span> </span><span class="hs-special">{</span><span> </span><span class="annot"><span class="annottext">pe_lazy :: Bool
</span><a href="GHC.Tc.Gen.Pat.html#pe_lazy"><span class="hs-identifier hs-var">pe_lazy</span></a></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">Bool
</span><span class="hs-identifier hs-var">True</span></span><span> </span><span class="hs-special">}</span><span>
</span><span id="line-194"></span><span>
</span><span id="line-195"></span><span class="annot"><a href="GHC.Tc.Gen.Pat.html#inPatBind"><span class="hs-identifier hs-type">inPatBind</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><a href="GHC.Tc.Gen.Pat.html#PatEnv"><span class="hs-identifier hs-type">PatEnv</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="hs-identifier hs-type">Bool</span></span><span>
</span><span id="line-196"></span><span id="inPatBind"><span class="annot"><span class="annottext">inPatBind :: PatEnv -&gt; Bool
</span><a href="GHC.Tc.Gen.Pat.html#inPatBind"><span class="hs-identifier hs-var hs-var">inPatBind</span></a></span></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="GHC.Tc.Gen.Pat.html#PE"><span class="hs-identifier hs-type">PE</span></a></span><span> </span><span class="hs-special">{</span><span> </span><span class="annot"><span class="annottext">pe_ctxt :: PatEnv -&gt; PatCtxt
</span><a href="GHC.Tc.Gen.Pat.html#pe_ctxt"><span class="hs-identifier hs-var">pe_ctxt</span></a></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><a href="GHC.Tc.Gen.Pat.html#LetPat"><span class="hs-identifier hs-type">LetPat</span></a></span><span> </span><span class="hs-special">{</span><span class="hs-special">}</span><span> </span><span class="hs-special">}</span><span class="hs-special">)</span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">Bool
</span><span class="hs-identifier hs-var">True</span></span><span>
</span><span id="line-197"></span><span class="annot"><a href="GHC.Tc.Gen.Pat.html#inPatBind"><span class="hs-identifier hs-var">inPatBind</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="GHC.Tc.Gen.Pat.html#PE"><span class="hs-identifier hs-type">PE</span></a></span><span> </span><span class="hs-special">{</span><span> </span><span class="annot"><span class="annottext">pe_ctxt :: PatEnv -&gt; PatCtxt
</span><a href="GHC.Tc.Gen.Pat.html#pe_ctxt"><span class="hs-identifier hs-var">pe_ctxt</span></a></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><a href="GHC.Tc.Gen.Pat.html#LamPat"><span class="hs-identifier hs-type">LamPat</span></a></span><span> </span><span class="hs-special">{</span><span class="hs-special">}</span><span> </span><span class="hs-special">}</span><span class="hs-special">)</span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">Bool
</span><span class="hs-identifier hs-var">False</span></span><span>
</span><span id="line-198"></span><span>
</span><span id="line-199"></span><span class="hs-comment">{- *********************************************************************
*                                                                      *
                Binders
*                                                                      *
********************************************************************* -}</span><span>
</span><span id="line-204"></span><span>
</span><span id="line-205"></span><span class="annot"><a href="GHC.Tc.Gen.Pat.html#tcPatBndr"><span class="hs-identifier hs-type">tcPatBndr</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><a href="GHC.Tc.Gen.Pat.html#PatEnv"><span class="hs-identifier hs-type">PatEnv</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="GHC.Types.Name.html#Name"><span class="hs-identifier hs-type">Name</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="GHC.Core.TyCo.Rep.html#Scaled"><span class="hs-identifier hs-type">Scaled</span></a></span><span> </span><span class="annot"><a href="GHC.Tc.Utils.TcType.html#ExpSigmaType"><span class="hs-identifier hs-type">ExpSigmaType</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="GHC.Tc.Types.html#TcM"><span class="hs-identifier hs-type">TcM</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="GHC.Tc.Types.Evidence.html#HsWrapper"><span class="hs-identifier hs-type">HsWrapper</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><a href="GHC.Tc.Types.html#TcId"><span class="hs-identifier hs-type">TcId</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-206"></span><span class="hs-comment">-- (coi, xp) = tcPatBndr penv x pat_ty</span><span>
</span><span id="line-207"></span><span class="hs-comment">-- Then coi : pat_ty ~ typeof(xp)</span><span>
</span><span id="line-208"></span><span class="hs-comment">--</span><span>
</span><span id="line-209"></span><span id="tcPatBndr"><span class="annot"><span class="annottext">tcPatBndr :: PatEnv -&gt; Name -&gt; Scaled ExpSigmaType -&gt; TcM (HsWrapper, TyVar)
</span><a href="GHC.Tc.Gen.Pat.html#tcPatBndr"><span class="hs-identifier hs-var hs-var">tcPatBndr</span></a></span></span><span> </span><span id="local-6989586621681387751"><span class="annot"><span class="annottext">penv :: PatEnv
</span><a href="#local-6989586621681387751"><span class="hs-identifier hs-var">penv</span></a></span></span><span class="hs-glyph">@</span><span class="hs-special">(</span><span class="annot"><a href="GHC.Tc.Gen.Pat.html#PE"><span class="hs-identifier hs-type">PE</span></a></span><span> </span><span class="hs-special">{</span><span> </span><span class="annot"><span class="annottext">pe_ctxt :: PatEnv -&gt; PatCtxt
</span><a href="GHC.Tc.Gen.Pat.html#pe_ctxt"><span class="hs-identifier hs-var">pe_ctxt</span></a></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><a href="GHC.Tc.Gen.Pat.html#LetPat"><span class="hs-identifier hs-type">LetPat</span></a></span><span> </span><span class="hs-special">{</span><span> </span><span class="annot"><span class="annottext">pc_lvl :: PatCtxt -&gt; TcLevel
</span><a href="GHC.Tc.Gen.Pat.html#pc_lvl"><span class="hs-identifier hs-var">pc_lvl</span></a></span><span>    </span><span class="hs-glyph">=</span><span> </span><span id="local-6989586621681387750"><span class="annot"><span class="annottext">TcLevel
</span><a href="#local-6989586621681387750"><span class="hs-identifier hs-var">bind_lvl</span></a></span></span><span>
</span><span id="line-210"></span><span>                                      </span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">pc_sig_fn :: PatCtxt -&gt; Name -&gt; Maybe TyVar
</span><a href="GHC.Tc.Gen.Pat.html#pc_sig_fn"><span class="hs-identifier hs-var">pc_sig_fn</span></a></span><span> </span><span class="hs-glyph">=</span><span> </span><span id="local-6989586621681387749"><span class="annot"><span class="annottext">Name -&gt; Maybe TyVar
</span><a href="#local-6989586621681387749"><span class="hs-identifier hs-var">sig_fn</span></a></span></span><span>
</span><span id="line-211"></span><span>                                      </span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">pc_new :: PatCtxt -&gt; LetBndrSpec
</span><a href="GHC.Tc.Gen.Pat.html#pc_new"><span class="hs-identifier hs-var">pc_new</span></a></span><span>    </span><span class="hs-glyph">=</span><span> </span><span id="local-6989586621681387748"><span class="annot"><span class="annottext">LetBndrSpec
</span><a href="#local-6989586621681387748"><span class="hs-identifier hs-var">no_gen</span></a></span></span><span> </span><span class="hs-special">}</span><span> </span><span class="hs-special">}</span><span class="hs-special">)</span><span>
</span><span id="line-212"></span><span>          </span><span id="local-6989586621681387747"><span class="annot"><span class="annottext">Name
</span><a href="#local-6989586621681387747"><span class="hs-identifier hs-var">bndr_name</span></a></span></span><span> </span><span id="local-6989586621681387746"><span class="annot"><span class="annottext">Scaled ExpSigmaType
</span><a href="#local-6989586621681387746"><span class="hs-identifier hs-var">exp_pat_ty</span></a></span></span><span>
</span><span id="line-213"></span><span>  </span><span class="hs-comment">-- For the LetPat cases, see</span><span>
</span><span id="line-214"></span><span>  </span><span class="hs-comment">-- Note [Typechecking pattern bindings] in GHC.Tc.Gen.Bind</span><span>
</span><span id="line-215"></span><span>
</span><span id="line-216"></span><span>  </span><span class="hs-glyph">|</span><span> </span><span class="annot"><a href="../../base-4.16.4.0/src/GHC-Maybe.html#Just"><span class="hs-identifier hs-type">Just</span></a></span><span> </span><span id="local-6989586621681387745"><span class="annot"><span class="annottext">TyVar
</span><a href="#local-6989586621681387745"><span class="hs-identifier hs-var">bndr_id</span></a></span></span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">Name -&gt; Maybe TyVar
</span><a href="#local-6989586621681387749"><span class="hs-identifier hs-var">sig_fn</span></a></span><span> </span><span class="annot"><span class="annottext">Name
</span><a href="#local-6989586621681387747"><span class="hs-identifier hs-var">bndr_name</span></a></span><span>   </span><span class="hs-comment">-- There is a signature</span><span>
</span><span id="line-217"></span><span>  </span><span class="hs-glyph">=</span><span> </span><span class="hs-keyword">do</span><span> </span><span class="hs-special">{</span><span> </span><span id="local-6989586621681387744"><span class="annot"><span class="annottext">HsWrapper
</span><a href="#local-6989586621681387744"><span class="hs-identifier hs-var">wrap</span></a></span></span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">PatEnv -&gt; ExpSigmaType -&gt; TcType -&gt; TcM HsWrapper
</span><a href="GHC.Tc.Gen.Pat.html#tc_sub_type"><span class="hs-identifier hs-var">tc_sub_type</span></a></span><span> </span><span class="annot"><span class="annottext">PatEnv
</span><a href="#local-6989586621681387751"><span class="hs-identifier hs-var">penv</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">forall a. Scaled a -&gt; a
</span><a href="GHC.Core.TyCo.Rep.html#scaledThing"><span class="hs-identifier hs-var">scaledThing</span></a></span><span> </span><span class="annot"><span class="annottext">Scaled ExpSigmaType
</span><a href="#local-6989586621681387746"><span class="hs-identifier hs-var">exp_pat_ty</span></a></span><span class="hs-special">)</span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">TyVar -&gt; TcType
</span><a href="GHC.Types.Id.html#idType"><span class="hs-identifier hs-var">idType</span></a></span><span> </span><span class="annot"><span class="annottext">TyVar
</span><a href="#local-6989586621681387745"><span class="hs-identifier hs-var">bndr_id</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-218"></span><span>           </span><span class="hs-comment">-- See Note [Subsumption check at pattern variables]</span><span>
</span><span id="line-219"></span><span>       </span><span class="hs-special">;</span><span> </span><span class="annot"><span class="annottext">String -&gt; SDoc -&gt; TcRn ()
</span><a href="GHC.Tc.Utils.Monad.html#traceTc"><span class="hs-identifier hs-var">traceTc</span></a></span><span> </span><span class="annot"><span class="annottext">String
</span><span class="hs-string">&quot;tcPatBndr(sig)&quot;</span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">forall a. Outputable a =&gt; a -&gt; SDoc
</span><a href="GHC.Utils.Outputable.html#ppr"><span class="hs-identifier hs-var">ppr</span></a></span><span> </span><span class="annot"><span class="annottext">TyVar
</span><a href="#local-6989586621681387745"><span class="hs-identifier hs-var">bndr_id</span></a></span><span> </span><span class="annot"><span class="annottext">SDoc -&gt; SDoc -&gt; SDoc
</span><a href="GHC.Utils.Outputable.html#%24%24"><span class="hs-operator hs-var">$$</span></a></span><span> </span><span class="annot"><span class="annottext">forall a. Outputable a =&gt; a -&gt; SDoc
</span><a href="GHC.Utils.Outputable.html#ppr"><span class="hs-identifier hs-var">ppr</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">TyVar -&gt; TcType
</span><a href="GHC.Types.Id.html#idType"><span class="hs-identifier hs-var">idType</span></a></span><span> </span><span class="annot"><span class="annottext">TyVar
</span><a href="#local-6989586621681387745"><span class="hs-identifier hs-var">bndr_id</span></a></span><span class="hs-special">)</span><span> </span><span class="annot"><span class="annottext">SDoc -&gt; SDoc -&gt; SDoc
</span><a href="GHC.Utils.Outputable.html#%24%24"><span class="hs-operator hs-var">$$</span></a></span><span> </span><span class="annot"><span class="annottext">forall a. Outputable a =&gt; a -&gt; SDoc
</span><a href="GHC.Utils.Outputable.html#ppr"><span class="hs-identifier hs-var">ppr</span></a></span><span> </span><span class="annot"><span class="annottext">Scaled ExpSigmaType
</span><a href="#local-6989586621681387746"><span class="hs-identifier hs-var">exp_pat_ty</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-220"></span><span>       </span><span class="hs-special">;</span><span> </span><span class="annot"><span class="annottext">forall (m :: * -&gt; *) a. Monad m =&gt; a -&gt; m a
</span><a href="../../base-4.16.4.0/src/GHC-Base.html#return"><span class="hs-identifier hs-var">return</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">HsWrapper
</span><a href="#local-6989586621681387744"><span class="hs-identifier hs-var">wrap</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">TyVar
</span><a href="#local-6989586621681387745"><span class="hs-identifier hs-var">bndr_id</span></a></span><span class="hs-special">)</span><span> </span><span class="hs-special">}</span><span>
</span><span id="line-221"></span><span>
</span><span id="line-222"></span><span>  </span><span class="hs-glyph">|</span><span> </span><span class="annot"><span class="annottext">Bool
</span><a href="../../base-4.16.4.0/src/GHC-Base.html#otherwise"><span class="hs-identifier hs-var">otherwise</span></a></span><span>                          </span><span class="hs-comment">-- No signature</span><span>
</span><span id="line-223"></span><span>  </span><span class="hs-glyph">=</span><span> </span><span class="hs-keyword">do</span><span> </span><span class="hs-special">{</span><span> </span><span class="hs-special">(</span><span id="local-6989586621681387738"><span class="annot"><span class="annottext">TcCoercionN
</span><a href="#local-6989586621681387738"><span class="hs-identifier hs-var">co</span></a></span></span><span class="hs-special">,</span><span> </span><span id="local-6989586621681387737"><span class="annot"><span class="annottext">TcType
</span><a href="#local-6989586621681387737"><span class="hs-identifier hs-var">bndr_ty</span></a></span></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="hs-keyword">case</span><span> </span><span class="annot"><span class="annottext">forall a. Scaled a -&gt; a
</span><a href="GHC.Core.TyCo.Rep.html#scaledThing"><span class="hs-identifier hs-var">scaledThing</span></a></span><span> </span><span class="annot"><span class="annottext">Scaled ExpSigmaType
</span><a href="#local-6989586621681387746"><span class="hs-identifier hs-var">exp_pat_ty</span></a></span><span> </span><span class="hs-keyword">of</span><span>
</span><span id="line-224"></span><span>             </span><span class="annot"><a href="GHC.Tc.Utils.TcType.html#Check"><span class="hs-identifier hs-type">Check</span></a></span><span> </span><span id="local-6989586621681387735"><span class="annot"><span class="annottext">TcType
</span><a href="#local-6989586621681387735"><span class="hs-identifier hs-var">pat_ty</span></a></span></span><span>    </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="annottext">TcLevel
-&gt; TcType -&gt; IOEnv (Env TcGblEnv TcLclEnv) (TcCoercionN, TcType)
</span><a href="GHC.Tc.Utils.TcMType.html#promoteTcType"><span class="hs-identifier hs-var">promoteTcType</span></a></span><span> </span><span class="annot"><span class="annottext">TcLevel
</span><a href="#local-6989586621681387750"><span class="hs-identifier hs-var">bind_lvl</span></a></span><span> </span><span class="annot"><span class="annottext">TcType
</span><a href="#local-6989586621681387735"><span class="hs-identifier hs-var">pat_ty</span></a></span><span>
</span><span id="line-225"></span><span>             </span><span class="annot"><a href="GHC.Tc.Utils.TcType.html#Infer"><span class="hs-identifier hs-type">Infer</span></a></span><span> </span><span id="local-6989586621681387732"><span class="annot"><span class="annottext">InferResult
</span><a href="#local-6989586621681387732"><span class="hs-identifier hs-var">infer_res</span></a></span></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-identifier">ASSERT</span><span class="hs-special">(</span><span> </span><span class="hs-identifier">bind_lvl</span><span> </span><span class="hs-operator">==</span><span> </span><span class="hs-identifier">ir_lvl</span><span> </span><span class="hs-identifier">infer_res</span><span> </span><span class="hs-special">)</span><span>
</span><span id="line-226"></span><span>                                </span><span class="hs-comment">-- If we were under a constructor that bumped the</span><span>
</span><span id="line-227"></span><span>                                </span><span class="hs-comment">-- level, we'd be in checking mode (see tcConArg)</span><span>
</span><span id="line-228"></span><span>                                </span><span class="hs-comment">-- hence this assertion</span><span>
</span><span id="line-229"></span><span>                                </span><span class="hs-keyword">do</span><span> </span><span class="hs-special">{</span><span> </span><span id="local-6989586621681387726"><span class="annot"><span class="annottext">TcType
</span><a href="#local-6989586621681387726"><span class="hs-identifier hs-var">bndr_ty</span></a></span></span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">InferResult -&gt; TcM TcType
</span><a href="GHC.Tc.Utils.TcMType.html#inferResultToType"><span class="hs-identifier hs-var">inferResultToType</span></a></span><span> </span><span class="annot"><span class="annottext">InferResult
</span><a href="#local-6989586621681387732"><span class="hs-identifier hs-var">infer_res</span></a></span><span>
</span><span id="line-230"></span><span>                                   </span><span class="hs-special">;</span><span> </span><span class="annot"><span class="annottext">forall (m :: * -&gt; *) a. Monad m =&gt; a -&gt; m a
</span><a href="../../base-4.16.4.0/src/GHC-Base.html#return"><span class="hs-identifier hs-var">return</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">TcType -&gt; TcCoercionN
</span><a href="GHC.Tc.Types.Evidence.html#mkTcNomReflCo"><span class="hs-identifier hs-var">mkTcNomReflCo</span></a></span><span> </span><span class="annot"><span class="annottext">TcType
</span><a href="#local-6989586621681387726"><span class="hs-identifier hs-var">bndr_ty</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">TcType
</span><a href="#local-6989586621681387726"><span class="hs-identifier hs-var">bndr_ty</span></a></span><span class="hs-special">)</span><span> </span><span class="hs-special">}</span><span>
</span><span id="line-231"></span><span>       </span><span class="hs-special">;</span><span> </span><span class="hs-keyword">let</span><span> </span><span id="local-6989586621681387723"><span class="annot"><span class="annottext">bndr_mult :: TcType
</span><a href="#local-6989586621681387723"><span class="hs-identifier hs-var hs-var">bndr_mult</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">forall a. Scaled a -&gt; TcType
</span><a href="GHC.Core.TyCo.Rep.html#scaledMult"><span class="hs-identifier hs-var">scaledMult</span></a></span><span> </span><span class="annot"><span class="annottext">Scaled ExpSigmaType
</span><a href="#local-6989586621681387746"><span class="hs-identifier hs-var">exp_pat_ty</span></a></span><span>
</span><span id="line-232"></span><span>       </span><span class="hs-special">;</span><span> </span><span id="local-6989586621681387721"><span class="annot"><span class="annottext">TyVar
</span><a href="#local-6989586621681387721"><span class="hs-identifier hs-var">bndr_id</span></a></span></span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">LetBndrSpec -&gt; Name -&gt; TcType -&gt; TcType -&gt; TcM TyVar
</span><a href="GHC.Tc.Gen.Pat.html#newLetBndr"><span class="hs-identifier hs-var">newLetBndr</span></a></span><span> </span><span class="annot"><span class="annottext">LetBndrSpec
</span><a href="#local-6989586621681387748"><span class="hs-identifier hs-var">no_gen</span></a></span><span> </span><span class="annot"><span class="annottext">Name
</span><a href="#local-6989586621681387747"><span class="hs-identifier hs-var">bndr_name</span></a></span><span> </span><span class="annot"><span class="annottext">TcType
</span><a href="#local-6989586621681387723"><span class="hs-identifier hs-var">bndr_mult</span></a></span><span> </span><span class="annot"><span class="annottext">TcType
</span><a href="#local-6989586621681387737"><span class="hs-identifier hs-var">bndr_ty</span></a></span><span>
</span><span id="line-233"></span><span>       </span><span class="hs-special">;</span><span> </span><span class="annot"><span class="annottext">String -&gt; SDoc -&gt; TcRn ()
</span><a href="GHC.Tc.Utils.Monad.html#traceTc"><span class="hs-identifier hs-var">traceTc</span></a></span><span> </span><span class="annot"><span class="annottext">String
</span><span class="hs-string">&quot;tcPatBndr(nosig)&quot;</span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">[SDoc] -&gt; SDoc
</span><a href="GHC.Utils.Outputable.html#vcat"><span class="hs-identifier hs-var">vcat</span></a></span><span> </span><span class="hs-special">[</span><span> </span><span class="annot"><span class="annottext">forall a. Outputable a =&gt; a -&gt; SDoc
</span><a href="GHC.Utils.Outputable.html#ppr"><span class="hs-identifier hs-var">ppr</span></a></span><span> </span><span class="annot"><span class="annottext">TcLevel
</span><a href="#local-6989586621681387750"><span class="hs-identifier hs-var">bind_lvl</span></a></span><span>
</span><span id="line-234"></span><span>                                          </span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">forall a. Outputable a =&gt; a -&gt; SDoc
</span><a href="GHC.Utils.Outputable.html#ppr"><span class="hs-identifier hs-var">ppr</span></a></span><span> </span><span class="annot"><span class="annottext">Scaled ExpSigmaType
</span><a href="#local-6989586621681387746"><span class="hs-identifier hs-var">exp_pat_ty</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">forall a. Outputable a =&gt; a -&gt; SDoc
</span><a href="GHC.Utils.Outputable.html#ppr"><span class="hs-identifier hs-var">ppr</span></a></span><span> </span><span class="annot"><span class="annottext">TcType
</span><a href="#local-6989586621681387737"><span class="hs-identifier hs-var">bndr_ty</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">forall a. Outputable a =&gt; a -&gt; SDoc
</span><a href="GHC.Utils.Outputable.html#ppr"><span class="hs-identifier hs-var">ppr</span></a></span><span> </span><span class="annot"><span class="annottext">TcCoercionN
</span><a href="#local-6989586621681387738"><span class="hs-identifier hs-var">co</span></a></span><span>
</span><span id="line-235"></span><span>                                          </span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">forall a. Outputable a =&gt; a -&gt; SDoc
</span><a href="GHC.Utils.Outputable.html#ppr"><span class="hs-identifier hs-var">ppr</span></a></span><span> </span><span class="annot"><span class="annottext">TyVar
</span><a href="#local-6989586621681387721"><span class="hs-identifier hs-var">bndr_id</span></a></span><span> </span><span class="hs-special">]</span><span class="hs-special">)</span><span>
</span><span id="line-236"></span><span>       </span><span class="hs-special">;</span><span> </span><span class="annot"><span class="annottext">forall (m :: * -&gt; *) a. Monad m =&gt; a -&gt; m a
</span><a href="../../base-4.16.4.0/src/GHC-Base.html#return"><span class="hs-identifier hs-var">return</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">TcCoercionN -&gt; HsWrapper
</span><a href="GHC.Tc.Types.Evidence.html#mkWpCastN"><span class="hs-identifier hs-var">mkWpCastN</span></a></span><span> </span><span class="annot"><span class="annottext">TcCoercionN
</span><a href="#local-6989586621681387738"><span class="hs-identifier hs-var">co</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">TyVar
</span><a href="#local-6989586621681387721"><span class="hs-identifier hs-var">bndr_id</span></a></span><span class="hs-special">)</span><span> </span><span class="hs-special">}</span><span>
</span><span id="line-237"></span><span>
</span><span id="line-238"></span><span class="annot"><a href="GHC.Tc.Gen.Pat.html#tcPatBndr"><span class="hs-identifier hs-var">tcPatBndr</span></a></span><span> </span><span class="annot"><span class="annottext">PatEnv
</span><span class="hs-identifier">_</span></span><span> </span><span id="local-6989586621681387718"><span class="annot"><span class="annottext">Name
</span><a href="#local-6989586621681387718"><span class="hs-identifier hs-var">bndr_name</span></a></span></span><span> </span><span id="local-6989586621681387717"><span class="annot"><span class="annottext">Scaled ExpSigmaType
</span><a href="#local-6989586621681387717"><span class="hs-identifier hs-var">pat_ty</span></a></span></span><span>
</span><span id="line-239"></span><span>  </span><span class="hs-glyph">=</span><span> </span><span class="hs-keyword">do</span><span> </span><span class="hs-special">{</span><span> </span><span class="hs-keyword">let</span><span> </span><span id="local-6989586621681387716"><span class="annot"><span class="annottext">pat_mult :: TcType
</span><a href="#local-6989586621681387716"><span class="hs-identifier hs-var hs-var">pat_mult</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">forall a. Scaled a -&gt; TcType
</span><a href="GHC.Core.TyCo.Rep.html#scaledMult"><span class="hs-identifier hs-var">scaledMult</span></a></span><span> </span><span class="annot"><span class="annottext">Scaled ExpSigmaType
</span><a href="#local-6989586621681387717"><span class="hs-identifier hs-var">pat_ty</span></a></span><span>
</span><span id="line-240"></span><span>       </span><span class="hs-special">;</span><span> </span><span id="local-6989586621681387715"><span class="annot"><span class="annottext">TcType
</span><a href="#local-6989586621681387715"><span class="hs-identifier hs-var">pat_ty</span></a></span></span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">ExpSigmaType -&gt; TcM TcType
</span><a href="GHC.Tc.Utils.TcMType.html#expTypeToType"><span class="hs-identifier hs-var">expTypeToType</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">forall a. Scaled a -&gt; a
</span><a href="GHC.Core.TyCo.Rep.html#scaledThing"><span class="hs-identifier hs-var">scaledThing</span></a></span><span> </span><span class="annot"><span class="annottext">Scaled ExpSigmaType
</span><a href="#local-6989586621681387717"><span class="hs-identifier hs-var">pat_ty</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-241"></span><span>       </span><span class="hs-special">;</span><span> </span><span class="annot"><span class="annottext">String -&gt; SDoc -&gt; TcRn ()
</span><a href="GHC.Tc.Utils.Monad.html#traceTc"><span class="hs-identifier hs-var">traceTc</span></a></span><span> </span><span class="annot"><span class="annottext">String
</span><span class="hs-string">&quot;tcPatBndr(not let)&quot;</span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">forall a. Outputable a =&gt; a -&gt; SDoc
</span><a href="GHC.Utils.Outputable.html#ppr"><span class="hs-identifier hs-var">ppr</span></a></span><span> </span><span class="annot"><span class="annottext">Name
</span><a href="#local-6989586621681387718"><span class="hs-identifier hs-var">bndr_name</span></a></span><span> </span><span class="annot"><span class="annottext">SDoc -&gt; SDoc -&gt; SDoc
</span><a href="GHC.Utils.Outputable.html#%24%24"><span class="hs-operator hs-var">$$</span></a></span><span> </span><span class="annot"><span class="annottext">forall a. Outputable a =&gt; a -&gt; SDoc
</span><a href="GHC.Utils.Outputable.html#ppr"><span class="hs-identifier hs-var">ppr</span></a></span><span> </span><span class="annot"><span class="annottext">TcType
</span><a href="#local-6989586621681387715"><span class="hs-identifier hs-var">pat_ty</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-242"></span><span>       </span><span class="hs-special">;</span><span> </span><span class="annot"><span class="annottext">forall (m :: * -&gt; *) a. Monad m =&gt; a -&gt; m a
</span><a href="../../base-4.16.4.0/src/GHC-Base.html#return"><span class="hs-identifier hs-var">return</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">HsWrapper
</span><a href="GHC.Tc.Types.Evidence.html#idHsWrapper"><span class="hs-identifier hs-var">idHsWrapper</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">Name -&gt; TcType -&gt; TcType -&gt; TyVar
</span><a href="GHC.Types.Id.html#mkLocalIdOrCoVar"><span class="hs-identifier hs-var">mkLocalIdOrCoVar</span></a></span><span> </span><span class="annot"><span class="annottext">Name
</span><a href="#local-6989586621681387718"><span class="hs-identifier hs-var">bndr_name</span></a></span><span> </span><span class="annot"><span class="annottext">TcType
</span><a href="#local-6989586621681387716"><span class="hs-identifier hs-var">pat_mult</span></a></span><span> </span><span class="annot"><span class="annottext">TcType
</span><a href="#local-6989586621681387715"><span class="hs-identifier hs-var">pat_ty</span></a></span><span class="hs-special">)</span><span> </span><span class="hs-special">}</span><span>
</span><span id="line-243"></span><span>               </span><span class="hs-comment">-- We should not have &quot;OrCoVar&quot; here, this is a bug (#17545)</span><span>
</span><span id="line-244"></span><span>               </span><span class="hs-comment">-- Whether or not there is a sig is irrelevant,</span><span>
</span><span id="line-245"></span><span>               </span><span class="hs-comment">-- as this is local</span><span>
</span><span id="line-246"></span><span>
</span><span id="line-247"></span><span class="annot"><a href="GHC.Tc.Gen.Pat.html#newLetBndr"><span class="hs-identifier hs-type">newLetBndr</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><a href="GHC.Tc.Gen.Pat.html#LetBndrSpec"><span class="hs-identifier hs-type">LetBndrSpec</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="GHC.Types.Name.html#Name"><span class="hs-identifier hs-type">Name</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="GHC.Core.TyCo.Rep.html#Mult"><span class="hs-identifier hs-type">Mult</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="GHC.Tc.Utils.TcType.html#TcType"><span class="hs-identifier hs-type">TcType</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="GHC.Tc.Types.html#TcM"><span class="hs-identifier hs-type">TcM</span></a></span><span> </span><span class="annot"><a href="GHC.Tc.Types.html#TcId"><span class="hs-identifier hs-type">TcId</span></a></span><span>
</span><span id="line-248"></span><span class="hs-comment">-- Make up a suitable Id for the pattern-binder.</span><span>
</span><span id="line-249"></span><span class="hs-comment">-- See Note [Typechecking pattern bindings], item (4) in GHC.Tc.Gen.Bind</span><span>
</span><span id="line-250"></span><span class="hs-comment">--</span><span>
</span><span id="line-251"></span><span class="hs-comment">-- In the polymorphic case when we are going to generalise</span><span>
</span><span id="line-252"></span><span class="hs-comment">--    (plan InferGen, no_gen = LetLclBndr), generate a &quot;monomorphic version&quot;</span><span>
</span><span id="line-253"></span><span class="hs-comment">--    of the Id; the original name will be bound to the polymorphic version</span><span>
</span><span id="line-254"></span><span class="hs-comment">--    by the AbsBinds</span><span>
</span><span id="line-255"></span><span class="hs-comment">-- In the monomorphic case when we are not going to generalise</span><span>
</span><span id="line-256"></span><span class="hs-comment">--    (plan NoGen, no_gen = LetGblBndr) there is no AbsBinds,</span><span>
</span><span id="line-257"></span><span class="hs-comment">--    and we use the original name directly</span><span>
</span><span id="line-258"></span><span id="newLetBndr"><span class="annot"><span class="annottext">newLetBndr :: LetBndrSpec -&gt; Name -&gt; TcType -&gt; TcType -&gt; TcM TyVar
</span><a href="GHC.Tc.Gen.Pat.html#newLetBndr"><span class="hs-identifier hs-var hs-var">newLetBndr</span></a></span></span><span> </span><span class="annot"><span class="annottext">LetBndrSpec
</span><a href="GHC.Tc.Gen.Pat.html#LetLclBndr"><span class="hs-identifier hs-var">LetLclBndr</span></a></span><span> </span><span id="local-6989586621681387710"><span class="annot"><span class="annottext">Name
</span><a href="#local-6989586621681387710"><span class="hs-identifier hs-var">name</span></a></span></span><span> </span><span id="local-6989586621681387709"><span class="annot"><span class="annottext">TcType
</span><a href="#local-6989586621681387709"><span class="hs-identifier hs-var">w</span></a></span></span><span> </span><span id="local-6989586621681387708"><span class="annot"><span class="annottext">TcType
</span><a href="#local-6989586621681387708"><span class="hs-identifier hs-var">ty</span></a></span></span><span>
</span><span id="line-259"></span><span>  </span><span class="hs-glyph">=</span><span> </span><span class="hs-keyword">do</span><span> </span><span class="hs-special">{</span><span> </span><span id="local-6989586621681387707"><span class="annot"><span class="annottext">Name
</span><a href="#local-6989586621681387707"><span class="hs-identifier hs-var">mono_name</span></a></span></span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">Name -&gt; TcM Name
</span><a href="GHC.Tc.Utils.Monad.html#cloneLocalName"><span class="hs-identifier hs-var">cloneLocalName</span></a></span><span> </span><span class="annot"><span class="annottext">Name
</span><a href="#local-6989586621681387710"><span class="hs-identifier hs-var">name</span></a></span><span>
</span><span id="line-260"></span><span>       </span><span class="hs-special">;</span><span> </span><span class="annot"><span class="annottext">forall (m :: * -&gt; *) a. Monad m =&gt; a -&gt; m a
</span><a href="../../base-4.16.4.0/src/GHC-Base.html#return"><span class="hs-identifier hs-var">return</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">HasDebugCallStack =&gt; Name -&gt; TcType -&gt; TcType -&gt; TyVar
</span><a href="GHC.Types.Id.html#mkLocalId"><span class="hs-identifier hs-var">mkLocalId</span></a></span><span> </span><span class="annot"><span class="annottext">Name
</span><a href="#local-6989586621681387707"><span class="hs-identifier hs-var">mono_name</span></a></span><span> </span><span class="annot"><span class="annottext">TcType
</span><a href="#local-6989586621681387709"><span class="hs-identifier hs-var">w</span></a></span><span> </span><span class="annot"><span class="annottext">TcType
</span><a href="#local-6989586621681387708"><span class="hs-identifier hs-var">ty</span></a></span><span class="hs-special">)</span><span> </span><span class="hs-special">}</span><span>
</span><span id="line-261"></span><span class="annot"><a href="GHC.Tc.Gen.Pat.html#newLetBndr"><span class="hs-identifier hs-var">newLetBndr</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="GHC.Tc.Gen.Pat.html#LetGblBndr"><span class="hs-identifier hs-type">LetGblBndr</span></a></span><span> </span><span id="local-6989586621681387704"><span class="annot"><span class="annottext">TcPragEnv
</span><a href="#local-6989586621681387704"><span class="hs-identifier hs-var">prags</span></a></span></span><span class="hs-special">)</span><span> </span><span id="local-6989586621681387703"><span class="annot"><span class="annottext">Name
</span><a href="#local-6989586621681387703"><span class="hs-identifier hs-var">name</span></a></span></span><span> </span><span id="local-6989586621681387702"><span class="annot"><span class="annottext">TcType
</span><a href="#local-6989586621681387702"><span class="hs-identifier hs-var">w</span></a></span></span><span> </span><span id="local-6989586621681387701"><span class="annot"><span class="annottext">TcType
</span><a href="#local-6989586621681387701"><span class="hs-identifier hs-var">ty</span></a></span></span><span>
</span><span id="line-262"></span><span>  </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">TyVar -&gt; [LSig GhcRn] -&gt; TcM TyVar
</span><a href="GHC.Tc.Gen.Sig.html#addInlinePrags"><span class="hs-identifier hs-var">addInlinePrags</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">HasDebugCallStack =&gt; Name -&gt; TcType -&gt; TcType -&gt; TyVar
</span><a href="GHC.Types.Id.html#mkLocalId"><span class="hs-identifier hs-var">mkLocalId</span></a></span><span> </span><span class="annot"><span class="annottext">Name
</span><a href="#local-6989586621681387703"><span class="hs-identifier hs-var">name</span></a></span><span> </span><span class="annot"><span class="annottext">TcType
</span><a href="#local-6989586621681387702"><span class="hs-identifier hs-var">w</span></a></span><span> </span><span class="annot"><span class="annottext">TcType
</span><a href="#local-6989586621681387701"><span class="hs-identifier hs-var">ty</span></a></span><span class="hs-special">)</span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">TcPragEnv -&gt; Name -&gt; [LSig GhcRn]
</span><a href="GHC.Tc.Gen.Sig.html#lookupPragEnv"><span class="hs-identifier hs-var">lookupPragEnv</span></a></span><span> </span><span class="annot"><span class="annottext">TcPragEnv
</span><a href="#local-6989586621681387704"><span class="hs-identifier hs-var">prags</span></a></span><span> </span><span class="annot"><span class="annottext">Name
</span><a href="#local-6989586621681387703"><span class="hs-identifier hs-var">name</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-263"></span><span>
</span><span id="line-264"></span><span class="annot"><a href="GHC.Tc.Gen.Pat.html#tc_sub_type"><span class="hs-identifier hs-type">tc_sub_type</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><a href="GHC.Tc.Gen.Pat.html#PatEnv"><span class="hs-identifier hs-type">PatEnv</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="GHC.Tc.Utils.TcType.html#ExpSigmaType"><span class="hs-identifier hs-type">ExpSigmaType</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="GHC.Tc.Utils.TcType.html#TcSigmaType"><span class="hs-identifier hs-type">TcSigmaType</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="GHC.Tc.Types.html#TcM"><span class="hs-identifier hs-type">TcM</span></a></span><span> </span><span class="annot"><a href="GHC.Tc.Types.Evidence.html#HsWrapper"><span class="hs-identifier hs-type">HsWrapper</span></a></span><span>
</span><span id="line-265"></span><span class="hs-comment">-- tcSubTypeET with the UserTypeCtxt specialised to GenSigCtxt</span><span>
</span><span id="line-266"></span><span class="hs-comment">-- Used during typechecking patterns</span><span>
</span><span id="line-267"></span><span id="tc_sub_type"><span class="annot"><span class="annottext">tc_sub_type :: PatEnv -&gt; ExpSigmaType -&gt; TcType -&gt; TcM HsWrapper
</span><a href="GHC.Tc.Gen.Pat.html#tc_sub_type"><span class="hs-identifier hs-var hs-var">tc_sub_type</span></a></span></span><span> </span><span id="local-6989586621681387700"><span class="annot"><span class="annottext">PatEnv
</span><a href="#local-6989586621681387700"><span class="hs-identifier hs-var">penv</span></a></span></span><span> </span><span id="local-6989586621681387699"><span class="annot"><span class="annottext">ExpSigmaType
</span><a href="#local-6989586621681387699"><span class="hs-identifier hs-var">t1</span></a></span></span><span> </span><span id="local-6989586621681387698"><span class="annot"><span class="annottext">TcType
</span><a href="#local-6989586621681387698"><span class="hs-identifier hs-var">t2</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">CtOrigin -&gt; UserTypeCtxt -&gt; ExpSigmaType -&gt; TcType -&gt; TcM HsWrapper
</span><a href="GHC.Tc.Utils.Unify.html#tcSubTypePat"><span class="hs-identifier hs-var">tcSubTypePat</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">PatEnv -&gt; CtOrigin
</span><a href="GHC.Tc.Gen.Pat.html#pe_orig"><span class="hs-identifier hs-var">pe_orig</span></a></span><span> </span><span class="annot"><span class="annottext">PatEnv
</span><a href="#local-6989586621681387700"><span class="hs-identifier hs-var">penv</span></a></span><span class="hs-special">)</span><span> </span><span class="annot"><span class="annottext">UserTypeCtxt
</span><a href="GHC.Tc.Types.Origin.html#GenSigCtxt"><span class="hs-identifier hs-var">GenSigCtxt</span></a></span><span> </span><span class="annot"><span class="annottext">ExpSigmaType
</span><a href="#local-6989586621681387699"><span class="hs-identifier hs-var">t1</span></a></span><span> </span><span class="annot"><span class="annottext">TcType
</span><a href="#local-6989586621681387698"><span class="hs-identifier hs-var">t2</span></a></span><span>
</span><span id="line-268"></span><span>
</span><span id="line-269"></span><span class="hs-comment">{- Note [Subsumption check at pattern variables]
~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~
When we come across a variable with a type signature, we need to do a
subsumption, not equality, check against the context type.  e.g.

    data T = MkT (forall a. a-&gt;a)
      f :: forall b. [b]-&gt;[b]
      MkT f = blah

Since 'blah' returns a value of type T, its payload is a polymorphic
function of type (forall a. a-&gt;a).  And that's enough to bind the
less-polymorphic function 'f', but we need some impedance matching
to witness the instantiation.


************************************************************************
*                                                                      *
                The main worker functions
*                                                                      *
************************************************************************

Note [Nesting]
~~~~~~~~~~~~~~
tcPat takes a &quot;thing inside&quot; over which the pattern scopes.  This is partly
so that tcPat can extend the environment for the thing_inside, but also
so that constraints arising in the thing_inside can be discharged by the
pattern.

This does not work so well for the ErrCtxt carried by the monad: we don't
want the error-context for the pattern to scope over the RHS.
Hence the getErrCtxt/setErrCtxt stuff in tcMultiple
-}</span><span>
</span><span id="line-301"></span><span>
</span><span id="line-302"></span><span class="hs-comment">--------------------</span><span>
</span><span id="line-303"></span><span>
</span><span id="line-304"></span><span class="hs-keyword">type</span><span> </span><span id="Checker"><span class="annot"><a href="GHC.Tc.Gen.Pat.html#Checker"><span class="hs-identifier hs-var">Checker</span></a></span></span><span> </span><span id="local-6989586621681387695"><span class="annot"><a href="#local-6989586621681387695"><span class="hs-identifier hs-type">inp</span></a></span></span><span> </span><span id="local-6989586621681387694"><span class="annot"><a href="#local-6989586621681387694"><span class="hs-identifier hs-type">out</span></a></span></span><span> </span><span class="hs-glyph">=</span><span>  </span><span class="hs-keyword">forall</span><span> </span><span id="local-6989586621681387693"><span class="annot"><a href="#local-6989586621681387693"><span class="hs-identifier hs-type">r</span></a></span></span><span class="hs-operator">.</span><span>
</span><span id="line-305"></span><span>                          </span><span class="annot"><a href="GHC.Tc.Gen.Pat.html#PatEnv"><span class="hs-identifier hs-type">PatEnv</span></a></span><span>
</span><span id="line-306"></span><span>                       </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="#local-6989586621681387695"><span class="hs-identifier hs-type">inp</span></a></span><span>
</span><span id="line-307"></span><span>                       </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="GHC.Tc.Types.html#TcM"><span class="hs-identifier hs-type">TcM</span></a></span><span> </span><span class="annot"><a href="#local-6989586621681387693"><span class="hs-identifier hs-type">r</span></a></span><span>      </span><span class="hs-comment">-- Thing inside</span><span>
</span><span id="line-308"></span><span>                       </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="GHC.Tc.Types.html#TcM"><span class="hs-identifier hs-type">TcM</span></a></span><span> </span><span class="hs-special">(</span><span> </span><span class="annot"><a href="#local-6989586621681387694"><span class="hs-identifier hs-type">out</span></a></span><span>
</span><span id="line-309"></span><span>                              </span><span class="hs-special">,</span><span> </span><span class="annot"><a href="#local-6989586621681387693"><span class="hs-identifier hs-type">r</span></a></span><span>    </span><span class="hs-comment">-- Result of thing inside</span><span>
</span><span id="line-310"></span><span>                              </span><span class="hs-special">)</span><span>
</span><span id="line-311"></span><span>
</span><span id="line-312"></span><span id="local-6989586621681388140"><span id="local-6989586621681388141"><span class="annot"><a href="GHC.Tc.Gen.Pat.html#tcMultiple"><span class="hs-identifier hs-type">tcMultiple</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><a href="GHC.Tc.Gen.Pat.html#Checker"><span class="hs-identifier hs-type">Checker</span></a></span><span> </span><span class="annot"><a href="#local-6989586621681388141"><span class="hs-identifier hs-type">inp</span></a></span><span> </span><span class="annot"><a href="#local-6989586621681388140"><span class="hs-identifier hs-type">out</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="GHC.Tc.Gen.Pat.html#Checker"><span class="hs-identifier hs-type">Checker</span></a></span><span> </span><span class="hs-special">[</span><span class="annot"><a href="#local-6989586621681388141"><span class="hs-identifier hs-type">inp</span></a></span><span class="hs-special">]</span><span> </span><span class="hs-special">[</span><span class="annot"><a href="#local-6989586621681388140"><span class="hs-identifier hs-type">out</span></a></span><span class="hs-special">]</span></span></span><span>
</span><span id="line-313"></span><span id="tcMultiple"><span class="annot"><span class="annottext">tcMultiple :: forall inp out. Checker inp out -&gt; Checker [inp] [out]
</span><a href="GHC.Tc.Gen.Pat.html#tcMultiple"><span class="hs-identifier hs-var hs-var">tcMultiple</span></a></span></span><span> </span><span id="local-6989586621681387685"><span class="annot"><span class="annottext">Checker inp out
</span><a href="#local-6989586621681387685"><span class="hs-identifier hs-var">tc_pat</span></a></span></span><span> </span><span id="local-6989586621681387684"><span class="annot"><span class="annottext">PatEnv
</span><a href="#local-6989586621681387684"><span class="hs-identifier hs-var">penv</span></a></span></span><span> </span><span id="local-6989586621681387683"><span class="annot"><span class="annottext">[inp]
</span><a href="#local-6989586621681387683"><span class="hs-identifier hs-var">args</span></a></span></span><span> </span><span id="local-6989586621681387682"><span class="annot"><span class="annottext">TcM r
</span><a href="#local-6989586621681387682"><span class="hs-identifier hs-var">thing_inside</span></a></span></span><span>
</span><span id="line-314"></span><span>  </span><span class="hs-glyph">=</span><span> </span><span class="hs-keyword">do</span><span>  </span><span class="hs-special">{</span><span> </span><span id="local-6989586621681387681"><span class="annot"><span class="annottext">[ErrCtxt]
</span><a href="#local-6989586621681387681"><span class="hs-identifier hs-var">err_ctxt</span></a></span></span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">TcM [ErrCtxt]
</span><a href="GHC.Tc.Utils.Monad.html#getErrCtxt"><span class="hs-identifier hs-var">getErrCtxt</span></a></span><span>
</span><span id="line-315"></span><span>        </span><span class="hs-special">;</span><span> </span><span class="hs-keyword">let</span><span> </span><span id="local-6989586621681387679"><span class="annot"><span class="annottext">loop :: PatEnv -&gt; [inp] -&gt; TcM ([out], r)
</span><a href="#local-6989586621681387679"><span class="hs-identifier hs-var hs-var">loop</span></a></span></span><span> </span><span class="annot"><span class="annottext">PatEnv
</span><span class="hs-identifier">_</span></span><span> </span><span class="hs-special">[</span><span class="hs-special">]</span><span>
</span><span id="line-316"></span><span>                </span><span class="hs-glyph">=</span><span> </span><span class="hs-keyword">do</span><span> </span><span class="hs-special">{</span><span> </span><span id="local-6989586621681387678"><span class="annot"><span class="annottext">r
</span><a href="#local-6989586621681387678"><span class="hs-identifier hs-var">res</span></a></span></span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">TcM r
</span><a href="#local-6989586621681387682"><span class="hs-identifier hs-var">thing_inside</span></a></span><span>
</span><span id="line-317"></span><span>                     </span><span class="hs-special">;</span><span> </span><span class="annot"><span class="annottext">forall (m :: * -&gt; *) a. Monad m =&gt; a -&gt; m a
</span><a href="../../base-4.16.4.0/src/GHC-Base.html#return"><span class="hs-identifier hs-var">return</span></a></span><span> </span><span class="hs-special">(</span><span class="hs-special">[</span><span class="hs-special">]</span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">r
</span><a href="#local-6989586621681387678"><span class="hs-identifier hs-var">res</span></a></span><span class="hs-special">)</span><span> </span><span class="hs-special">}</span><span>
</span><span id="line-318"></span><span>
</span><span id="line-319"></span><span>              </span><span class="annot"><a href="#local-6989586621681387679"><span class="hs-identifier hs-var">loop</span></a></span><span> </span><span id="local-6989586621681387677"><span class="annot"><span class="annottext">PatEnv
</span><a href="#local-6989586621681387677"><span class="hs-identifier hs-var">penv</span></a></span></span><span> </span><span class="hs-special">(</span><span id="local-6989586621681387676"><span class="annot"><span class="annottext">inp
</span><a href="#local-6989586621681387676"><span class="hs-identifier hs-var">arg</span></a></span></span><span class="annot"><span class="hs-glyph hs-type">:</span></span><span id="local-6989586621681387675"><span class="annot"><span class="annottext">[inp]
</span><a href="#local-6989586621681387675"><span class="hs-identifier hs-var">args</span></a></span></span><span class="hs-special">)</span><span>
</span><span id="line-320"></span><span>                </span><span class="hs-glyph">=</span><span> </span><span class="hs-keyword">do</span><span> </span><span class="hs-special">{</span><span> </span><span class="hs-special">(</span><span id="local-6989586621681387674"><span class="annot"><span class="annottext">out
</span><a href="#local-6989586621681387674"><span class="hs-identifier hs-var">p'</span></a></span></span><span class="hs-special">,</span><span> </span><span class="hs-special">(</span><span id="local-6989586621681387673"><span class="annot"><span class="annottext">[out]
</span><a href="#local-6989586621681387673"><span class="hs-identifier hs-var">ps'</span></a></span></span><span class="hs-special">,</span><span> </span><span id="local-6989586621681387672"><span class="annot"><span class="annottext">r
</span><a href="#local-6989586621681387672"><span class="hs-identifier hs-var">res</span></a></span></span><span class="hs-special">)</span><span class="hs-special">)</span><span>
</span><span id="line-321"></span><span>                                </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">Checker inp out
</span><a href="#local-6989586621681387685"><span class="hs-identifier hs-var">tc_pat</span></a></span><span> </span><span class="annot"><span class="annottext">PatEnv
</span><a href="#local-6989586621681387677"><span class="hs-identifier hs-var">penv</span></a></span><span> </span><span class="annot"><span class="annottext">inp
</span><a href="#local-6989586621681387676"><span class="hs-identifier hs-var">arg</span></a></span><span> </span><span class="annot"><span class="annottext">forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><a href="../../base-4.16.4.0/src/GHC-Base.html#%24"><span class="hs-operator hs-var">$</span></a></span><span>
</span><span id="line-322"></span><span>                                   </span><span class="annot"><span class="annottext">forall a. [ErrCtxt] -&gt; TcM a -&gt; TcM a
</span><a href="GHC.Tc.Utils.Monad.html#setErrCtxt"><span class="hs-identifier hs-var">setErrCtxt</span></a></span><span> </span><span class="annot"><span class="annottext">[ErrCtxt]
</span><a href="#local-6989586621681387681"><span class="hs-identifier hs-var">err_ctxt</span></a></span><span> </span><span class="annot"><span class="annottext">forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><a href="../../base-4.16.4.0/src/GHC-Base.html#%24"><span class="hs-operator hs-var">$</span></a></span><span>
</span><span id="line-323"></span><span>                                   </span><span class="annot"><span class="annottext">PatEnv -&gt; [inp] -&gt; TcM ([out], r)
</span><a href="#local-6989586621681387679"><span class="hs-identifier hs-var">loop</span></a></span><span> </span><span class="annot"><span class="annottext">PatEnv
</span><a href="#local-6989586621681387677"><span class="hs-identifier hs-var">penv</span></a></span><span> </span><span class="annot"><span class="annottext">[inp]
</span><a href="#local-6989586621681387675"><span class="hs-identifier hs-var">args</span></a></span><span>
</span><span id="line-324"></span><span>                </span><span class="hs-comment">-- setErrCtxt: restore context before doing the next pattern</span><span>
</span><span id="line-325"></span><span>                </span><span class="hs-comment">-- See note [Nesting] above</span><span>
</span><span id="line-326"></span><span>
</span><span id="line-327"></span><span>                     </span><span class="hs-special">;</span><span> </span><span class="annot"><span class="annottext">forall (m :: * -&gt; *) a. Monad m =&gt; a -&gt; m a
</span><a href="../../base-4.16.4.0/src/GHC-Base.html#return"><span class="hs-identifier hs-var">return</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">out
</span><a href="#local-6989586621681387674"><span class="hs-identifier hs-var">p'</span></a></span><span class="annot"><span class="annottext">forall a. a -&gt; [a] -&gt; [a]
</span><span class="hs-glyph hs-var">:</span></span><span class="annot"><span class="annottext">[out]
</span><a href="#local-6989586621681387673"><span class="hs-identifier hs-var">ps'</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">r
</span><a href="#local-6989586621681387672"><span class="hs-identifier hs-var">res</span></a></span><span class="hs-special">)</span><span> </span><span class="hs-special">}</span><span>
</span><span id="line-328"></span><span>
</span><span id="line-329"></span><span>        </span><span class="hs-special">;</span><span> </span><span class="annot"><span class="annottext">PatEnv -&gt; [inp] -&gt; TcM ([out], r)
</span><a href="#local-6989586621681387679"><span class="hs-identifier hs-var">loop</span></a></span><span> </span><span class="annot"><span class="annottext">PatEnv
</span><a href="#local-6989586621681387684"><span class="hs-identifier hs-var">penv</span></a></span><span> </span><span class="annot"><span class="annottext">[inp]
</span><a href="#local-6989586621681387683"><span class="hs-identifier hs-var">args</span></a></span><span> </span><span class="hs-special">}</span><span>
</span><span id="line-330"></span><span>
</span><span id="line-331"></span><span class="hs-comment">--------------------</span><span>
</span><span id="line-332"></span><span class="annot"><a href="GHC.Tc.Gen.Pat.html#tc_lpat"><span class="hs-identifier hs-type">tc_lpat</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><a href="GHC.Core.TyCo.Rep.html#Scaled"><span class="hs-identifier hs-type">Scaled</span></a></span><span> </span><span class="annot"><a href="GHC.Tc.Utils.TcType.html#ExpSigmaType"><span class="hs-identifier hs-type">ExpSigmaType</span></a></span><span>
</span><span id="line-333"></span><span>        </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="GHC.Tc.Gen.Pat.html#Checker"><span class="hs-identifier hs-type">Checker</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="Language.Haskell.Syntax.Pat.html#LPat"><span class="hs-identifier hs-type">LPat</span></a></span><span> </span><span class="annot"><a href="GHC.Hs.Extension.html#GhcRn"><span class="hs-identifier hs-type">GhcRn</span></a></span><span class="hs-special">)</span><span> </span><span class="hs-special">(</span><span class="annot"><a href="Language.Haskell.Syntax.Pat.html#LPat"><span class="hs-identifier hs-type">LPat</span></a></span><span> </span><span class="annot"><a href="GHC.Hs.Extension.html#GhcTc"><span class="hs-identifier hs-type">GhcTc</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-334"></span><span id="tc_lpat"><span class="annot"><span class="annottext">tc_lpat :: Scaled ExpSigmaType -&gt; Checker (LPat GhcRn) (LPat GhcTc)
</span><a href="GHC.Tc.Gen.Pat.html#tc_lpat"><span class="hs-identifier hs-var hs-var">tc_lpat</span></a></span></span><span> </span><span id="local-6989586621681387667"><span class="annot"><span class="annottext">Scaled ExpSigmaType
</span><a href="#local-6989586621681387667"><span class="hs-identifier hs-var">pat_ty</span></a></span></span><span> </span><span id="local-6989586621681387666"><span class="annot"><span class="annottext">PatEnv
</span><a href="#local-6989586621681387666"><span class="hs-identifier hs-var">penv</span></a></span></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="GHC.Types.SrcLoc.html#L"><span class="hs-identifier hs-type">L</span></a></span><span> </span><span id="local-6989586621681387664"><span class="annot"><span class="annottext">SrcSpanAnn' (EpAnn AnnListItem)
</span><a href="#local-6989586621681387664"><span class="hs-identifier hs-var">span</span></a></span></span><span> </span><span id="local-6989586621681387663"><span class="annot"><span class="annottext">Pat GhcRn
</span><a href="#local-6989586621681387663"><span class="hs-identifier hs-var">pat</span></a></span></span><span class="hs-special">)</span><span> </span><span id="local-6989586621681387662"><span class="annot"><span class="annottext">TcM r
</span><a href="#local-6989586621681387662"><span class="hs-identifier hs-var">thing_inside</span></a></span></span><span>
</span><span id="line-335"></span><span>  </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">forall ann a. SrcSpanAnn' ann -&gt; TcRn a -&gt; TcRn a
</span><a href="GHC.Tc.Utils.Monad.html#setSrcSpanA"><span class="hs-identifier hs-var">setSrcSpanA</span></a></span><span> </span><span class="annot"><span class="annottext">SrcSpanAnn' (EpAnn AnnListItem)
</span><a href="#local-6989586621681387664"><span class="hs-identifier hs-var">span</span></a></span><span> </span><span class="annot"><span class="annottext">forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><a href="../../base-4.16.4.0/src/GHC-Base.html#%24"><span class="hs-operator hs-var">$</span></a></span><span>
</span><span id="line-336"></span><span>    </span><span class="hs-keyword">do</span><span>  </span><span class="hs-special">{</span><span> </span><span class="hs-special">(</span><span id="local-6989586621681387660"><span class="annot"><span class="annottext">Pat GhcTc
</span><a href="#local-6989586621681387660"><span class="hs-identifier hs-var">pat'</span></a></span></span><span class="hs-special">,</span><span> </span><span id="local-6989586621681387659"><span class="annot"><span class="annottext">r
</span><a href="#local-6989586621681387659"><span class="hs-identifier hs-var">res</span></a></span></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">forall a b. Pat GhcRn -&gt; (TcM a -&gt; TcM b) -&gt; TcM a -&gt; TcM b
</span><a href="GHC.Tc.Gen.Pat.html#maybeWrapPatCtxt"><span class="hs-identifier hs-var">maybeWrapPatCtxt</span></a></span><span> </span><span class="annot"><span class="annottext">Pat GhcRn
</span><a href="#local-6989586621681387663"><span class="hs-identifier hs-var">pat</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Scaled ExpSigmaType -&gt; Checker (Pat GhcRn) (Pat GhcTc)
</span><a href="GHC.Tc.Gen.Pat.html#tc_pat"><span class="hs-identifier hs-var">tc_pat</span></a></span><span> </span><span class="annot"><span class="annottext">Scaled ExpSigmaType
</span><a href="#local-6989586621681387667"><span class="hs-identifier hs-var">pat_ty</span></a></span><span> </span><span class="annot"><span class="annottext">PatEnv
</span><a href="#local-6989586621681387666"><span class="hs-identifier hs-var">penv</span></a></span><span> </span><span class="annot"><span class="annottext">Pat GhcRn
</span><a href="#local-6989586621681387663"><span class="hs-identifier hs-var">pat</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-337"></span><span>                                          </span><span class="annot"><span class="annottext">TcM r
</span><a href="#local-6989586621681387662"><span class="hs-identifier hs-var">thing_inside</span></a></span><span>
</span><span id="line-338"></span><span>        </span><span class="hs-special">;</span><span> </span><span class="annot"><span class="annottext">forall (m :: * -&gt; *) a. Monad m =&gt; a -&gt; m a
</span><a href="../../base-4.16.4.0/src/GHC-Base.html#return"><span class="hs-identifier hs-var">return</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">forall l e. l -&gt; e -&gt; GenLocated l e
</span><a href="GHC.Types.SrcLoc.html#L"><span class="hs-identifier hs-var">L</span></a></span><span> </span><span class="annot"><span class="annottext">SrcSpanAnn' (EpAnn AnnListItem)
</span><a href="#local-6989586621681387664"><span class="hs-identifier hs-var">span</span></a></span><span> </span><span class="annot"><span class="annottext">Pat GhcTc
</span><a href="#local-6989586621681387660"><span class="hs-identifier hs-var">pat'</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">r
</span><a href="#local-6989586621681387659"><span class="hs-identifier hs-var">res</span></a></span><span class="hs-special">)</span><span> </span><span class="hs-special">}</span><span>
</span><span id="line-339"></span><span>
</span><span id="line-340"></span><span class="annot"><a href="GHC.Tc.Gen.Pat.html#tc_lpats"><span class="hs-identifier hs-type">tc_lpats</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="hs-special">[</span><span class="annot"><a href="GHC.Core.TyCo.Rep.html#Scaled"><span class="hs-identifier hs-type">Scaled</span></a></span><span> </span><span class="annot"><a href="GHC.Tc.Utils.TcType.html#ExpSigmaType"><span class="hs-identifier hs-type">ExpSigmaType</span></a></span><span class="hs-special">]</span><span>
</span><span id="line-341"></span><span>         </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="GHC.Tc.Gen.Pat.html#Checker"><span class="hs-identifier hs-type">Checker</span></a></span><span> </span><span class="hs-special">[</span><span class="annot"><a href="Language.Haskell.Syntax.Pat.html#LPat"><span class="hs-identifier hs-type">LPat</span></a></span><span> </span><span class="annot"><a href="GHC.Hs.Extension.html#GhcRn"><span class="hs-identifier hs-type">GhcRn</span></a></span><span class="hs-special">]</span><span> </span><span class="hs-special">[</span><span class="annot"><a href="Language.Haskell.Syntax.Pat.html#LPat"><span class="hs-identifier hs-type">LPat</span></a></span><span> </span><span class="annot"><a href="GHC.Hs.Extension.html#GhcTc"><span class="hs-identifier hs-type">GhcTc</span></a></span><span class="hs-special">]</span><span>
</span><span id="line-342"></span><span id="tc_lpats"><span class="annot"><span class="annottext">tc_lpats :: [Scaled ExpSigmaType] -&gt; Checker [LPat GhcRn] [LPat GhcTc]
</span><a href="GHC.Tc.Gen.Pat.html#tc_lpats"><span class="hs-identifier hs-var hs-var">tc_lpats</span></a></span></span><span> </span><span id="local-6989586621681387631"><span class="annot"><span class="annottext">[Scaled ExpSigmaType]
</span><a href="#local-6989586621681387631"><span class="hs-identifier hs-var">tys</span></a></span></span><span> </span><span id="local-6989586621681387630"><span class="annot"><span class="annottext">PatEnv
</span><a href="#local-6989586621681387630"><span class="hs-identifier hs-var">penv</span></a></span></span><span> </span><span id="local-6989586621681387629"><span class="annot"><span class="annottext">[LPat GhcRn]
</span><a href="#local-6989586621681387629"><span class="hs-identifier hs-var">pats</span></a></span></span><span>
</span><span id="line-343"></span><span>  </span><span class="hs-glyph">=</span><span> </span><span class="hs-identifier">ASSERT2</span><span class="hs-special">(</span><span> </span><span class="hs-identifier">equalLength</span><span> </span><span class="hs-identifier">pats</span><span> </span><span class="hs-identifier">tys</span><span class="hs-special">,</span><span> </span><span class="hs-identifier">ppr</span><span> </span><span class="hs-identifier">pats</span><span> </span><span class="hs-operator">$$</span><span> </span><span class="hs-identifier">ppr</span><span> </span><span class="hs-identifier">tys</span><span> </span><span class="hs-special">)</span><span>
</span><span id="line-344"></span><span>    </span><span class="annot"><span class="annottext">forall inp out. Checker inp out -&gt; Checker [inp] [out]
</span><a href="GHC.Tc.Gen.Pat.html#tcMultiple"><span class="hs-identifier hs-var">tcMultiple</span></a></span><span> </span><span class="hs-special">(</span><span class="hs-glyph">\</span><span> </span><span id="local-6989586621681387626"><span class="annot"><span class="annottext">PatEnv
</span><a href="#local-6989586621681387626"><span class="hs-identifier hs-var">penv'</span></a></span></span><span> </span><span class="hs-special">(</span><span id="local-6989586621681387625"><span class="annot"><span class="annottext">GenLocated (SrcSpanAnn' (EpAnn AnnListItem)) (Pat GhcRn)
</span><a href="#local-6989586621681387625"><span class="hs-identifier hs-var">p</span></a></span></span><span class="hs-special">,</span><span id="local-6989586621681387624"><span class="annot"><span class="annottext">Scaled ExpSigmaType
</span><a href="#local-6989586621681387624"><span class="hs-identifier hs-var">t</span></a></span></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="annottext">Scaled ExpSigmaType -&gt; Checker (LPat GhcRn) (LPat GhcTc)
</span><a href="GHC.Tc.Gen.Pat.html#tc_lpat"><span class="hs-identifier hs-var">tc_lpat</span></a></span><span> </span><span class="annot"><span class="annottext">Scaled ExpSigmaType
</span><a href="#local-6989586621681387624"><span class="hs-identifier hs-var">t</span></a></span><span> </span><span class="annot"><span class="annottext">PatEnv
</span><a href="#local-6989586621681387626"><span class="hs-identifier hs-var">penv'</span></a></span><span> </span><span class="annot"><span class="annottext">GenLocated (SrcSpanAnn' (EpAnn AnnListItem)) (Pat GhcRn)
</span><a href="#local-6989586621681387625"><span class="hs-identifier hs-var">p</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-345"></span><span>               </span><span class="annot"><span class="annottext">PatEnv
</span><a href="#local-6989586621681387630"><span class="hs-identifier hs-var">penv</span></a></span><span>
</span><span id="line-346"></span><span>               </span><span class="hs-special">(</span><span class="annot"><span class="annottext">forall a b. String -&gt; [a] -&gt; [b] -&gt; [(a, b)]
</span><a href="GHC.Utils.Misc.html#zipEqual"><span class="hs-identifier hs-var">zipEqual</span></a></span><span> </span><span class="annot"><span class="annottext">String
</span><span class="hs-string">&quot;tc_lpats&quot;</span></span><span> </span><span class="annot"><span class="annottext">[LPat GhcRn]
</span><a href="#local-6989586621681387629"><span class="hs-identifier hs-var">pats</span></a></span><span> </span><span class="annot"><span class="annottext">[Scaled ExpSigmaType]
</span><a href="#local-6989586621681387631"><span class="hs-identifier hs-var">tys</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-347"></span><span>
</span><span id="line-348"></span><span class="hs-comment">--------------------</span><span>
</span><span id="line-349"></span><span class="hs-comment">-- See Note [Wrapper returned from tcSubMult] in GHC.Tc.Utils.Unify.</span><span>
</span><span id="line-350"></span><span id="local-6989586621681388104"><span class="annot"><a href="GHC.Tc.Gen.Pat.html#checkManyPattern"><span class="hs-identifier hs-type">checkManyPattern</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><a href="GHC.Core.TyCo.Rep.html#Scaled"><span class="hs-identifier hs-type">Scaled</span></a></span><span> </span><span class="annot"><a href="#local-6989586621681388104"><span class="hs-identifier hs-type">a</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="GHC.Tc.Types.html#TcM"><span class="hs-identifier hs-type">TcM</span></a></span><span> </span><span class="annot"><a href="GHC.Tc.Types.Evidence.html#HsWrapper"><span class="hs-identifier hs-type">HsWrapper</span></a></span></span><span>
</span><span id="line-351"></span><span id="checkManyPattern"><span class="annot"><span class="annottext">checkManyPattern :: forall a. Scaled a -&gt; TcM HsWrapper
</span><a href="GHC.Tc.Gen.Pat.html#checkManyPattern"><span class="hs-identifier hs-var hs-var">checkManyPattern</span></a></span></span><span> </span><span id="local-6989586621681387621"><span class="annot"><span class="annottext">Scaled a
</span><a href="#local-6989586621681387621"><span class="hs-identifier hs-var">pat_ty</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">CtOrigin -&gt; TcType -&gt; TcType -&gt; TcM HsWrapper
</span><a href="GHC.Tc.Utils.Unify.html#tcSubMult"><span class="hs-identifier hs-var">tcSubMult</span></a></span><span> </span><span class="annot"><span class="annottext">CtOrigin
</span><a href="GHC.Tc.Types.Origin.html#NonLinearPatternOrigin"><span class="hs-identifier hs-var">NonLinearPatternOrigin</span></a></span><span> </span><span class="annot"><span class="annottext">TcType
</span><a href="GHC.Core.Type.html#Many"><span class="hs-identifier hs-var">Many</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">forall a. Scaled a -&gt; TcType
</span><a href="GHC.Core.TyCo.Rep.html#scaledMult"><span class="hs-identifier hs-var">scaledMult</span></a></span><span> </span><span class="annot"><span class="annottext">Scaled a
</span><a href="#local-6989586621681387621"><span class="hs-identifier hs-var">pat_ty</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-352"></span><span>
</span><span id="line-353"></span><span class="annot"><a href="GHC.Tc.Gen.Pat.html#tc_pat"><span class="hs-identifier hs-type">tc_pat</span></a></span><span>  </span><span class="hs-glyph">::</span><span> </span><span class="annot"><a href="GHC.Core.TyCo.Rep.html#Scaled"><span class="hs-identifier hs-type">Scaled</span></a></span><span> </span><span class="annot"><a href="GHC.Tc.Utils.TcType.html#ExpSigmaType"><span class="hs-identifier hs-type">ExpSigmaType</span></a></span><span>
</span><span id="line-354"></span><span>        </span><span class="hs-comment">-- ^ Fully refined result type</span><span>
</span><span id="line-355"></span><span>        </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="GHC.Tc.Gen.Pat.html#Checker"><span class="hs-identifier hs-type">Checker</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="Language.Haskell.Syntax.Pat.html#Pat"><span class="hs-identifier hs-type">Pat</span></a></span><span> </span><span class="annot"><a href="GHC.Hs.Extension.html#GhcRn"><span class="hs-identifier hs-type">GhcRn</span></a></span><span class="hs-special">)</span><span> </span><span class="hs-special">(</span><span class="annot"><a href="Language.Haskell.Syntax.Pat.html#Pat"><span class="hs-identifier hs-type">Pat</span></a></span><span> </span><span class="annot"><a href="GHC.Hs.Extension.html#GhcTc"><span class="hs-identifier hs-type">GhcTc</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-356"></span><span>        </span><span class="hs-comment">-- ^ Translated pattern</span><span>
</span><span id="line-357"></span><span>
</span><span id="line-358"></span><span id="tc_pat"><span class="annot"><span class="annottext">tc_pat :: Scaled ExpSigmaType -&gt; Checker (Pat GhcRn) (Pat GhcTc)
</span><a href="GHC.Tc.Gen.Pat.html#tc_pat"><span class="hs-identifier hs-var hs-var">tc_pat</span></a></span></span><span> </span><span id="local-6989586621681387507"><span class="annot"><span class="annottext">Scaled ExpSigmaType
</span><a href="#local-6989586621681387507"><span class="hs-identifier hs-var">pat_ty</span></a></span></span><span> </span><span id="local-6989586621681387506"><span class="annot"><span class="annottext">PatEnv
</span><a href="#local-6989586621681387506"><span class="hs-identifier hs-var">penv</span></a></span></span><span> </span><span id="local-6989586621681387505"><span class="annot"><span class="annottext">Pat GhcRn
</span><a href="#local-6989586621681387505"><span class="hs-identifier hs-var">ps_pat</span></a></span></span><span> </span><span id="local-6989586621681387504"><span class="annot"><span class="annottext">TcM r
</span><a href="#local-6989586621681387504"><span class="hs-identifier hs-var">thing_inside</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-keyword">case</span><span> </span><span class="annot"><span class="annottext">Pat GhcRn
</span><a href="#local-6989586621681387505"><span class="hs-identifier hs-var">ps_pat</span></a></span><span> </span><span class="hs-keyword">of</span><span>
</span><span id="line-359"></span><span>
</span><span id="line-360"></span><span>  </span><span class="annot"><a href="Language.Haskell.Syntax.Pat.html#VarPat"><span class="hs-identifier hs-type">VarPat</span></a></span><span> </span><span id="local-6989586621681387502"><span class="annot"><span class="annottext">XVarPat GhcRn
</span><a href="#local-6989586621681387502"><span class="hs-identifier hs-var">x</span></a></span></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="GHC.Types.SrcLoc.html#L"><span class="hs-identifier hs-type">L</span></a></span><span> </span><span id="local-6989586621681387501"><span class="annot"><span class="annottext">SrcSpanAnnN
</span><a href="#local-6989586621681387501"><span class="hs-identifier hs-var">l</span></a></span></span><span> </span><span id="local-6989586621681387500"><span class="annot"><span class="annottext">Name
</span><a href="#local-6989586621681387500"><span class="hs-identifier hs-var">name</span></a></span></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-keyword">do</span><span>
</span><span id="line-361"></span><span>        </span><span class="hs-special">{</span><span> </span><span class="hs-special">(</span><span id="local-6989586621681387499"><span class="annot"><span class="annottext">HsWrapper
</span><a href="#local-6989586621681387499"><span class="hs-identifier hs-var">wrap</span></a></span></span><span class="hs-special">,</span><span> </span><span id="local-6989586621681387498"><span class="annot"><span class="annottext">TyVar
</span><a href="#local-6989586621681387498"><span class="hs-identifier hs-var">id</span></a></span></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">PatEnv -&gt; Name -&gt; Scaled ExpSigmaType -&gt; TcM (HsWrapper, TyVar)
</span><a href="GHC.Tc.Gen.Pat.html#tcPatBndr"><span class="hs-identifier hs-var">tcPatBndr</span></a></span><span> </span><span class="annot"><span class="annottext">PatEnv
</span><a href="#local-6989586621681387506"><span class="hs-identifier hs-var">penv</span></a></span><span> </span><span class="annot"><span class="annottext">Name
</span><a href="#local-6989586621681387500"><span class="hs-identifier hs-var">name</span></a></span><span> </span><span class="annot"><span class="annottext">Scaled ExpSigmaType
</span><a href="#local-6989586621681387507"><span class="hs-identifier hs-var">pat_ty</span></a></span><span>
</span><span id="line-362"></span><span>        </span><span class="hs-special">;</span><span> </span><span class="hs-special">(</span><span id="local-6989586621681387497"><span class="annot"><span class="annottext">r
</span><a href="#local-6989586621681387497"><span class="hs-identifier hs-var">res</span></a></span></span><span class="hs-special">,</span><span> </span><span id="local-6989586621681387496"><span class="annot"><span class="annottext">HsWrapper
</span><a href="#local-6989586621681387496"><span class="hs-identifier hs-var">mult_wrap</span></a></span></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">forall a. Name -&gt; TcType -&gt; TcM a -&gt; TcM (a, HsWrapper)
</span><a href="GHC.Tc.Utils.Env.html#tcCheckUsage"><span class="hs-identifier hs-var">tcCheckUsage</span></a></span><span> </span><span class="annot"><span class="annottext">Name
</span><a href="#local-6989586621681387500"><span class="hs-identifier hs-var">name</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">forall a. Scaled a -&gt; TcType
</span><a href="GHC.Core.TyCo.Rep.html#scaledMult"><span class="hs-identifier hs-var">scaledMult</span></a></span><span> </span><span class="annot"><span class="annottext">Scaled ExpSigmaType
</span><a href="#local-6989586621681387507"><span class="hs-identifier hs-var">pat_ty</span></a></span><span class="hs-special">)</span><span> </span><span class="annot"><span class="annottext">forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><a href="../../base-4.16.4.0/src/GHC-Base.html#%24"><span class="hs-operator hs-var">$</span></a></span><span>
</span><span id="line-363"></span><span>                              </span><span class="annot"><span class="annottext">forall a. Name -&gt; TyVar -&gt; TcM a -&gt; TcM a
</span><a href="GHC.Tc.Utils.Env.html#tcExtendIdEnv1"><span class="hs-identifier hs-var">tcExtendIdEnv1</span></a></span><span> </span><span class="annot"><span class="annottext">Name
</span><a href="#local-6989586621681387500"><span class="hs-identifier hs-var">name</span></a></span><span> </span><span class="annot"><span class="annottext">TyVar
</span><a href="#local-6989586621681387498"><span class="hs-identifier hs-var">id</span></a></span><span> </span><span class="annot"><span class="annottext">TcM r
</span><a href="#local-6989586621681387504"><span class="hs-identifier hs-var">thing_inside</span></a></span><span>
</span><span id="line-364"></span><span>            </span><span class="hs-comment">-- See Note [Wrapper returned from tcSubMult] in GHC.Tc.Utils.Unify.</span><span>
</span><span id="line-365"></span><span>        </span><span class="hs-special">;</span><span> </span><span id="local-6989586621681387493"><span class="annot"><span class="annottext">TcType
</span><a href="#local-6989586621681387493"><span class="hs-identifier hs-var">pat_ty</span></a></span></span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">ExpSigmaType -&gt; TcM TcType
</span><a href="GHC.Tc.Utils.TcMType.html#readExpType"><span class="hs-identifier hs-var">readExpType</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">forall a. Scaled a -&gt; a
</span><a href="GHC.Core.TyCo.Rep.html#scaledThing"><span class="hs-identifier hs-var">scaledThing</span></a></span><span> </span><span class="annot"><span class="annottext">Scaled ExpSigmaType
</span><a href="#local-6989586621681387507"><span class="hs-identifier hs-var">pat_ty</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-366"></span><span>        </span><span class="hs-special">;</span><span> </span><span class="annot"><span class="annottext">forall (m :: * -&gt; *) a. Monad m =&gt; a -&gt; m a
</span><a href="../../base-4.16.4.0/src/GHC-Base.html#return"><span class="hs-identifier hs-var">return</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">HsWrapper -&gt; Pat GhcTc -&gt; TcType -&gt; Pat GhcTc
</span><a href="GHC.Hs.Utils.html#mkHsWrapPat"><span class="hs-identifier hs-var">mkHsWrapPat</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">HsWrapper
</span><a href="#local-6989586621681387499"><span class="hs-identifier hs-var">wrap</span></a></span><span> </span><span class="annot"><span class="annottext">HsWrapper -&gt; HsWrapper -&gt; HsWrapper
</span><a href="GHC.Tc.Types.Evidence.html#%3C.%3E"><span class="hs-operator hs-var">&lt;.&gt;</span></a></span><span> </span><span class="annot"><span class="annottext">HsWrapper
</span><a href="#local-6989586621681387496"><span class="hs-identifier hs-var">mult_wrap</span></a></span><span class="hs-special">)</span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">forall p. XVarPat p -&gt; LIdP p -&gt; Pat p
</span><a href="Language.Haskell.Syntax.Pat.html#VarPat"><span class="hs-identifier hs-var">VarPat</span></a></span><span> </span><span class="annot"><span class="annottext">XVarPat GhcRn
</span><a href="#local-6989586621681387502"><span class="hs-identifier hs-var">x</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">forall l e. l -&gt; e -&gt; GenLocated l e
</span><a href="GHC.Types.SrcLoc.html#L"><span class="hs-identifier hs-var">L</span></a></span><span> </span><span class="annot"><span class="annottext">SrcSpanAnnN
</span><a href="#local-6989586621681387501"><span class="hs-identifier hs-var">l</span></a></span><span> </span><span class="annot"><span class="annottext">TyVar
</span><a href="#local-6989586621681387498"><span class="hs-identifier hs-var">id</span></a></span><span class="hs-special">)</span><span class="hs-special">)</span><span> </span><span class="annot"><span class="annottext">TcType
</span><a href="#local-6989586621681387493"><span class="hs-identifier hs-var">pat_ty</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">r
</span><a href="#local-6989586621681387497"><span class="hs-identifier hs-var">res</span></a></span><span class="hs-special">)</span><span> </span><span class="hs-special">}</span><span>
</span><span id="line-367"></span><span>
</span><span id="line-368"></span><span>  </span><span class="annot"><a href="Language.Haskell.Syntax.Pat.html#ParPat"><span class="hs-identifier hs-type">ParPat</span></a></span><span> </span><span id="local-6989586621681387488"><span class="annot"><span class="annottext">XParPat GhcRn
</span><a href="#local-6989586621681387488"><span class="hs-identifier hs-var">x</span></a></span></span><span> </span><span id="local-6989586621681387487"><span class="annot"><span class="annottext">LPat GhcRn
</span><a href="#local-6989586621681387487"><span class="hs-identifier hs-var">pat</span></a></span></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-keyword">do</span><span>
</span><span id="line-369"></span><span>        </span><span class="hs-special">{</span><span> </span><span class="hs-special">(</span><span id="local-6989586621681387486"><span class="annot"><span class="annottext">GenLocated (SrcSpanAnn' (EpAnn AnnListItem)) (Pat GhcTc)
</span><a href="#local-6989586621681387486"><span class="hs-identifier hs-var">pat'</span></a></span></span><span class="hs-special">,</span><span> </span><span id="local-6989586621681387485"><span class="annot"><span class="annottext">r
</span><a href="#local-6989586621681387485"><span class="hs-identifier hs-var">res</span></a></span></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">Scaled ExpSigmaType -&gt; Checker (LPat GhcRn) (LPat GhcTc)
</span><a href="GHC.Tc.Gen.Pat.html#tc_lpat"><span class="hs-identifier hs-var">tc_lpat</span></a></span><span> </span><span class="annot"><span class="annottext">Scaled ExpSigmaType
</span><a href="#local-6989586621681387507"><span class="hs-identifier hs-var">pat_ty</span></a></span><span> </span><span class="annot"><span class="annottext">PatEnv
</span><a href="#local-6989586621681387506"><span class="hs-identifier hs-var">penv</span></a></span><span> </span><span class="annot"><span class="annottext">LPat GhcRn
</span><a href="#local-6989586621681387487"><span class="hs-identifier hs-var">pat</span></a></span><span> </span><span class="annot"><span class="annottext">TcM r
</span><a href="#local-6989586621681387504"><span class="hs-identifier hs-var">thing_inside</span></a></span><span>
</span><span id="line-370"></span><span>        </span><span class="hs-special">;</span><span> </span><span class="annot"><span class="annottext">forall (m :: * -&gt; *) a. Monad m =&gt; a -&gt; m a
</span><a href="../../base-4.16.4.0/src/GHC-Base.html#return"><span class="hs-identifier hs-var">return</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">forall p. XParPat p -&gt; LPat p -&gt; Pat p
</span><a href="Language.Haskell.Syntax.Pat.html#ParPat"><span class="hs-identifier hs-var">ParPat</span></a></span><span> </span><span class="annot"><span class="annottext">XParPat GhcRn
</span><a href="#local-6989586621681387488"><span class="hs-identifier hs-var">x</span></a></span><span> </span><span class="annot"><span class="annottext">GenLocated (SrcSpanAnn' (EpAnn AnnListItem)) (Pat GhcTc)
</span><a href="#local-6989586621681387486"><span class="hs-identifier hs-var">pat'</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">r
</span><a href="#local-6989586621681387485"><span class="hs-identifier hs-var">res</span></a></span><span class="hs-special">)</span><span> </span><span class="hs-special">}</span><span>
</span><span id="line-371"></span><span>
</span><span id="line-372"></span><span>  </span><span class="annot"><a href="Language.Haskell.Syntax.Pat.html#BangPat"><span class="hs-identifier hs-type">BangPat</span></a></span><span> </span><span id="local-6989586621681387483"><span class="annot"><span class="annottext">XBangPat GhcRn
</span><a href="#local-6989586621681387483"><span class="hs-identifier hs-var">x</span></a></span></span><span> </span><span id="local-6989586621681387482"><span class="annot"><span class="annottext">LPat GhcRn
</span><a href="#local-6989586621681387482"><span class="hs-identifier hs-var">pat</span></a></span></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-keyword">do</span><span>
</span><span id="line-373"></span><span>        </span><span class="hs-special">{</span><span> </span><span class="hs-special">(</span><span id="local-6989586621681387481"><span class="annot"><span class="annottext">GenLocated (SrcSpanAnn' (EpAnn AnnListItem)) (Pat GhcTc)
</span><a href="#local-6989586621681387481"><span class="hs-identifier hs-var">pat'</span></a></span></span><span class="hs-special">,</span><span> </span><span id="local-6989586621681387480"><span class="annot"><span class="annottext">r
</span><a href="#local-6989586621681387480"><span class="hs-identifier hs-var">res</span></a></span></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">Scaled ExpSigmaType -&gt; Checker (LPat GhcRn) (LPat GhcTc)
</span><a href="GHC.Tc.Gen.Pat.html#tc_lpat"><span class="hs-identifier hs-var">tc_lpat</span></a></span><span> </span><span class="annot"><span class="annottext">Scaled ExpSigmaType
</span><a href="#local-6989586621681387507"><span class="hs-identifier hs-var">pat_ty</span></a></span><span> </span><span class="annot"><span class="annottext">PatEnv
</span><a href="#local-6989586621681387506"><span class="hs-identifier hs-var">penv</span></a></span><span> </span><span class="annot"><span class="annottext">LPat GhcRn
</span><a href="#local-6989586621681387482"><span class="hs-identifier hs-var">pat</span></a></span><span> </span><span class="annot"><span class="annottext">TcM r
</span><a href="#local-6989586621681387504"><span class="hs-identifier hs-var">thing_inside</span></a></span><span>
</span><span id="line-374"></span><span>        </span><span class="hs-special">;</span><span> </span><span class="annot"><span class="annottext">forall (m :: * -&gt; *) a. Monad m =&gt; a -&gt; m a
</span><a href="../../base-4.16.4.0/src/GHC-Base.html#return"><span class="hs-identifier hs-var">return</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">forall p. XBangPat p -&gt; LPat p -&gt; Pat p
</span><a href="Language.Haskell.Syntax.Pat.html#BangPat"><span class="hs-identifier hs-var">BangPat</span></a></span><span> </span><span class="annot"><span class="annottext">XBangPat GhcRn
</span><a href="#local-6989586621681387483"><span class="hs-identifier hs-var">x</span></a></span><span> </span><span class="annot"><span class="annottext">GenLocated (SrcSpanAnn' (EpAnn AnnListItem)) (Pat GhcTc)
</span><a href="#local-6989586621681387481"><span class="hs-identifier hs-var">pat'</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">r
</span><a href="#local-6989586621681387480"><span class="hs-identifier hs-var">res</span></a></span><span class="hs-special">)</span><span> </span><span class="hs-special">}</span><span>
</span><span id="line-375"></span><span>
</span><span id="line-376"></span><span>  </span><span class="annot"><a href="Language.Haskell.Syntax.Pat.html#LazyPat"><span class="hs-identifier hs-type">LazyPat</span></a></span><span> </span><span id="local-6989586621681387478"><span class="annot"><span class="annottext">XLazyPat GhcRn
</span><a href="#local-6989586621681387478"><span class="hs-identifier hs-var">x</span></a></span></span><span> </span><span id="local-6989586621681387477"><span class="annot"><span class="annottext">LPat GhcRn
</span><a href="#local-6989586621681387477"><span class="hs-identifier hs-var">pat</span></a></span></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-keyword">do</span><span>
</span><span id="line-377"></span><span>        </span><span class="hs-special">{</span><span> </span><span id="local-6989586621681387476"><span class="annot"><span class="annottext">HsWrapper
</span><a href="#local-6989586621681387476"><span class="hs-identifier hs-var">mult_wrap</span></a></span></span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">forall a. Scaled a -&gt; TcM HsWrapper
</span><a href="GHC.Tc.Gen.Pat.html#checkManyPattern"><span class="hs-identifier hs-var">checkManyPattern</span></a></span><span> </span><span class="annot"><span class="annottext">Scaled ExpSigmaType
</span><a href="#local-6989586621681387507"><span class="hs-identifier hs-var">pat_ty</span></a></span><span>
</span><span id="line-378"></span><span>            </span><span class="hs-comment">-- See Note [Wrapper returned from tcSubMult] in GHC.Tc.Utils.Unify.</span><span>
</span><span id="line-379"></span><span>        </span><span class="hs-special">;</span><span> </span><span class="hs-special">(</span><span id="local-6989586621681387475"><span class="annot"><span class="annottext">GenLocated (SrcSpanAnn' (EpAnn AnnListItem)) (Pat GhcTc)
</span><a href="#local-6989586621681387475"><span class="hs-identifier hs-var">pat'</span></a></span></span><span class="hs-special">,</span><span> </span><span class="hs-special">(</span><span id="local-6989586621681387474"><span class="annot"><span class="annottext">r
</span><a href="#local-6989586621681387474"><span class="hs-identifier hs-var">res</span></a></span></span><span class="hs-special">,</span><span> </span><span id="local-6989586621681387473"><span class="annot"><span class="annottext">WantedConstraints
</span><a href="#local-6989586621681387473"><span class="hs-identifier hs-var">pat_ct</span></a></span></span><span class="hs-special">)</span><span class="hs-special">)</span><span>
</span><span id="line-380"></span><span>                </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">Scaled ExpSigmaType -&gt; Checker (LPat GhcRn) (LPat GhcTc)
</span><a href="GHC.Tc.Gen.Pat.html#tc_lpat"><span class="hs-identifier hs-var">tc_lpat</span></a></span><span> </span><span class="annot"><span class="annottext">Scaled ExpSigmaType
</span><a href="#local-6989586621681387507"><span class="hs-identifier hs-var">pat_ty</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">PatEnv -&gt; PatEnv
</span><a href="GHC.Tc.Gen.Pat.html#makeLazy"><span class="hs-identifier hs-var">makeLazy</span></a></span><span> </span><span class="annot"><span class="annottext">PatEnv
</span><a href="#local-6989586621681387506"><span class="hs-identifier hs-var">penv</span></a></span><span class="hs-special">)</span><span> </span><span class="annot"><span class="annottext">LPat GhcRn
</span><a href="#local-6989586621681387477"><span class="hs-identifier hs-var">pat</span></a></span><span> </span><span class="annot"><span class="annottext">forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><a href="../../base-4.16.4.0/src/GHC-Base.html#%24"><span class="hs-operator hs-var">$</span></a></span><span>
</span><span id="line-381"></span><span>                   </span><span class="annot"><span class="annottext">forall a. TcM a -&gt; TcM (a, WantedConstraints)
</span><a href="GHC.Tc.Utils.Monad.html#captureConstraints"><span class="hs-identifier hs-var">captureConstraints</span></a></span><span> </span><span class="annot"><span class="annottext">TcM r
</span><a href="#local-6989586621681387504"><span class="hs-identifier hs-var">thing_inside</span></a></span><span>
</span><span id="line-382"></span><span>                </span><span class="hs-comment">-- Ignore refined penv', revert to penv</span><span>
</span><span id="line-383"></span><span>
</span><span id="line-384"></span><span>        </span><span class="hs-special">;</span><span> </span><span class="annot"><span class="annottext">WantedConstraints -&gt; TcRn ()
</span><a href="GHC.Tc.Utils.Monad.html#emitConstraints"><span class="hs-identifier hs-var">emitConstraints</span></a></span><span> </span><span class="annot"><span class="annottext">WantedConstraints
</span><a href="#local-6989586621681387473"><span class="hs-identifier hs-var">pat_ct</span></a></span><span>
</span><span id="line-385"></span><span>        </span><span class="hs-comment">-- captureConstraints/extendConstraints:</span><span>
</span><span id="line-386"></span><span>        </span><span class="hs-comment">--   see Note [Hopping the LIE in lazy patterns]</span><span>
</span><span id="line-387"></span><span>
</span><span id="line-388"></span><span>        </span><span class="hs-comment">-- Check that the expected pattern type is itself lifted</span><span>
</span><span id="line-389"></span><span>        </span><span class="hs-special">;</span><span> </span><span id="local-6989586621681387470"><span class="annot"><span class="annottext">TcType
</span><a href="#local-6989586621681387470"><span class="hs-identifier hs-var">pat_ty</span></a></span></span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">ExpSigmaType -&gt; TcM TcType
</span><a href="GHC.Tc.Utils.TcMType.html#readExpType"><span class="hs-identifier hs-var">readExpType</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">forall a. Scaled a -&gt; a
</span><a href="GHC.Core.TyCo.Rep.html#scaledThing"><span class="hs-identifier hs-var">scaledThing</span></a></span><span> </span><span class="annot"><span class="annottext">Scaled ExpSigmaType
</span><a href="#local-6989586621681387507"><span class="hs-identifier hs-var">pat_ty</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-390"></span><span>        </span><span class="hs-special">;</span><span> </span><span class="annot"><span class="annottext">TcCoercionN
</span><span class="hs-identifier">_</span></span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">Maybe SDoc -&gt; TcType -&gt; TcType -&gt; TcM TcCoercionN
</span><a href="GHC.Tc.Utils.Unify.html#unifyType"><span class="hs-identifier hs-var">unifyType</span></a></span><span> </span><span class="annot"><span class="annottext">forall a. Maybe a
</span><a href="../../base-4.16.4.0/src/GHC-Maybe.html#Nothing"><span class="hs-identifier hs-var">Nothing</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">HasDebugCallStack =&gt; TcType -&gt; TcType
</span><a href="GHC.Core.Type.html#tcTypeKind"><span class="hs-identifier hs-var">tcTypeKind</span></a></span><span> </span><span class="annot"><span class="annottext">TcType
</span><a href="#local-6989586621681387470"><span class="hs-identifier hs-var">pat_ty</span></a></span><span class="hs-special">)</span><span> </span><span class="annot"><span class="annottext">TcType
</span><a href="GHC.Builtin.Types.html#liftedTypeKind"><span class="hs-identifier hs-var">liftedTypeKind</span></a></span><span>
</span><span id="line-391"></span><span>
</span><span id="line-392"></span><span>        </span><span class="hs-special">;</span><span> </span><span class="annot"><span class="annottext">forall (m :: * -&gt; *) a. Monad m =&gt; a -&gt; m a
</span><a href="../../base-4.16.4.0/src/GHC-Base.html#return"><span class="hs-identifier hs-var">return</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">HsWrapper -&gt; Pat GhcTc -&gt; TcType -&gt; Pat GhcTc
</span><a href="GHC.Hs.Utils.html#mkHsWrapPat"><span class="hs-identifier hs-var">mkHsWrapPat</span></a></span><span> </span><span class="annot"><span class="annottext">HsWrapper
</span><a href="#local-6989586621681387476"><span class="hs-identifier hs-var">mult_wrap</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">forall p. XLazyPat p -&gt; LPat p -&gt; Pat p
</span><a href="Language.Haskell.Syntax.Pat.html#LazyPat"><span class="hs-identifier hs-var">LazyPat</span></a></span><span> </span><span class="annot"><span class="annottext">XLazyPat GhcRn
</span><a href="#local-6989586621681387478"><span class="hs-identifier hs-var">x</span></a></span><span> </span><span class="annot"><span class="annottext">GenLocated (SrcSpanAnn' (EpAnn AnnListItem)) (Pat GhcTc)
</span><a href="#local-6989586621681387475"><span class="hs-identifier hs-var">pat'</span></a></span><span class="hs-special">)</span><span> </span><span class="annot"><span class="annottext">TcType
</span><a href="#local-6989586621681387470"><span class="hs-identifier hs-var">pat_ty</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">r
</span><a href="#local-6989586621681387474"><span class="hs-identifier hs-var">res</span></a></span><span class="hs-special">)</span><span> </span><span class="hs-special">}</span><span>
</span><span id="line-393"></span><span>
</span><span id="line-394"></span><span>  </span><span class="annot"><a href="Language.Haskell.Syntax.Pat.html#WildPat"><span class="hs-identifier hs-type">WildPat</span></a></span><span> </span><span class="annot"><span class="annottext">XWildPat GhcRn
</span><span class="hs-identifier">_</span></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-keyword">do</span><span>
</span><span id="line-395"></span><span>        </span><span class="hs-special">{</span><span> </span><span id="local-6989586621681387465"><span class="annot"><span class="annottext">HsWrapper
</span><a href="#local-6989586621681387465"><span class="hs-identifier hs-var">mult_wrap</span></a></span></span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">forall a. Scaled a -&gt; TcM HsWrapper
</span><a href="GHC.Tc.Gen.Pat.html#checkManyPattern"><span class="hs-identifier hs-var">checkManyPattern</span></a></span><span> </span><span class="annot"><span class="annottext">Scaled ExpSigmaType
</span><a href="#local-6989586621681387507"><span class="hs-identifier hs-var">pat_ty</span></a></span><span>
</span><span id="line-396"></span><span>            </span><span class="hs-comment">-- See Note [Wrapper returned from tcSubMult] in GHC.Tc.Utils.Unify.</span><span>
</span><span id="line-397"></span><span>        </span><span class="hs-special">;</span><span> </span><span id="local-6989586621681387464"><span class="annot"><span class="annottext">r
</span><a href="#local-6989586621681387464"><span class="hs-identifier hs-var">res</span></a></span></span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">TcM r
</span><a href="#local-6989586621681387504"><span class="hs-identifier hs-var">thing_inside</span></a></span><span>
</span><span id="line-398"></span><span>        </span><span class="hs-special">;</span><span> </span><span id="local-6989586621681387463"><span class="annot"><span class="annottext">TcType
</span><a href="#local-6989586621681387463"><span class="hs-identifier hs-var">pat_ty</span></a></span></span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">ExpSigmaType -&gt; TcM TcType
</span><a href="GHC.Tc.Utils.TcMType.html#expTypeToType"><span class="hs-identifier hs-var">expTypeToType</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">forall a. Scaled a -&gt; a
</span><a href="GHC.Core.TyCo.Rep.html#scaledThing"><span class="hs-identifier hs-var">scaledThing</span></a></span><span> </span><span class="annot"><span class="annottext">Scaled ExpSigmaType
</span><a href="#local-6989586621681387507"><span class="hs-identifier hs-var">pat_ty</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-399"></span><span>        </span><span class="hs-special">;</span><span> </span><span class="annot"><span class="annottext">forall (m :: * -&gt; *) a. Monad m =&gt; a -&gt; m a
</span><a href="../../base-4.16.4.0/src/GHC-Base.html#return"><span class="hs-identifier hs-var">return</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">HsWrapper -&gt; Pat GhcTc -&gt; TcType -&gt; Pat GhcTc
</span><a href="GHC.Hs.Utils.html#mkHsWrapPat"><span class="hs-identifier hs-var">mkHsWrapPat</span></a></span><span> </span><span class="annot"><span class="annottext">HsWrapper
</span><a href="#local-6989586621681387465"><span class="hs-identifier hs-var">mult_wrap</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">forall p. XWildPat p -&gt; Pat p
</span><a href="Language.Haskell.Syntax.Pat.html#WildPat"><span class="hs-identifier hs-var">WildPat</span></a></span><span> </span><span class="annot"><span class="annottext">TcType
</span><a href="#local-6989586621681387463"><span class="hs-identifier hs-var">pat_ty</span></a></span><span class="hs-special">)</span><span> </span><span class="annot"><span class="annottext">TcType
</span><a href="#local-6989586621681387463"><span class="hs-identifier hs-var">pat_ty</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">r
</span><a href="#local-6989586621681387464"><span class="hs-identifier hs-var">res</span></a></span><span class="hs-special">)</span><span> </span><span class="hs-special">}</span><span>
</span><span id="line-400"></span><span>
</span><span id="line-401"></span><span>  </span><span class="annot"><a href="Language.Haskell.Syntax.Pat.html#AsPat"><span class="hs-identifier hs-type">AsPat</span></a></span><span> </span><span id="local-6989586621681387461"><span class="annot"><span class="annottext">XAsPat GhcRn
</span><a href="#local-6989586621681387461"><span class="hs-identifier hs-var">x</span></a></span></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="GHC.Types.SrcLoc.html#L"><span class="hs-identifier hs-type">L</span></a></span><span> </span><span id="local-6989586621681387460"><span class="annot"><span class="annottext">SrcSpanAnnN
</span><a href="#local-6989586621681387460"><span class="hs-identifier hs-var">nm_loc</span></a></span></span><span> </span><span id="local-6989586621681387459"><span class="annot"><span class="annottext">Name
</span><a href="#local-6989586621681387459"><span class="hs-identifier hs-var">name</span></a></span></span><span class="hs-special">)</span><span> </span><span id="local-6989586621681387458"><span class="annot"><span class="annottext">LPat GhcRn
</span><a href="#local-6989586621681387458"><span class="hs-identifier hs-var">pat</span></a></span></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-keyword">do</span><span>
</span><span id="line-402"></span><span>        </span><span class="hs-special">{</span><span> </span><span id="local-6989586621681387457"><span class="annot"><span class="annottext">HsWrapper
</span><a href="#local-6989586621681387457"><span class="hs-identifier hs-var">mult_wrap</span></a></span></span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">forall a. Scaled a -&gt; TcM HsWrapper
</span><a href="GHC.Tc.Gen.Pat.html#checkManyPattern"><span class="hs-identifier hs-var">checkManyPattern</span></a></span><span> </span><span class="annot"><span class="annottext">Scaled ExpSigmaType
</span><a href="#local-6989586621681387507"><span class="hs-identifier hs-var">pat_ty</span></a></span><span>
</span><span id="line-403"></span><span>            </span><span class="hs-comment">-- See Note [Wrapper returned from tcSubMult] in GHC.Tc.Utils.Unify.</span><span>
</span><span id="line-404"></span><span>        </span><span class="hs-special">;</span><span> </span><span class="hs-special">(</span><span id="local-6989586621681387456"><span class="annot"><span class="annottext">HsWrapper
</span><a href="#local-6989586621681387456"><span class="hs-identifier hs-var">wrap</span></a></span></span><span class="hs-special">,</span><span> </span><span id="local-6989586621681387455"><span class="annot"><span class="annottext">TyVar
</span><a href="#local-6989586621681387455"><span class="hs-identifier hs-var">bndr_id</span></a></span></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">forall ann a. SrcSpanAnn' ann -&gt; TcRn a -&gt; TcRn a
</span><a href="GHC.Tc.Utils.Monad.html#setSrcSpanA"><span class="hs-identifier hs-var">setSrcSpanA</span></a></span><span> </span><span class="annot"><span class="annottext">SrcSpanAnnN
</span><a href="#local-6989586621681387460"><span class="hs-identifier hs-var">nm_loc</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">PatEnv -&gt; Name -&gt; Scaled ExpSigmaType -&gt; TcM (HsWrapper, TyVar)
</span><a href="GHC.Tc.Gen.Pat.html#tcPatBndr"><span class="hs-identifier hs-var">tcPatBndr</span></a></span><span> </span><span class="annot"><span class="annottext">PatEnv
</span><a href="#local-6989586621681387506"><span class="hs-identifier hs-var">penv</span></a></span><span> </span><span class="annot"><span class="annottext">Name
</span><a href="#local-6989586621681387459"><span class="hs-identifier hs-var">name</span></a></span><span> </span><span class="annot"><span class="annottext">Scaled ExpSigmaType
</span><a href="#local-6989586621681387507"><span class="hs-identifier hs-var">pat_ty</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-405"></span><span>        </span><span class="hs-special">;</span><span> </span><span class="hs-special">(</span><span id="local-6989586621681387454"><span class="annot"><span class="annottext">GenLocated (SrcSpanAnn' (EpAnn AnnListItem)) (Pat GhcTc)
</span><a href="#local-6989586621681387454"><span class="hs-identifier hs-var">pat'</span></a></span></span><span class="hs-special">,</span><span> </span><span id="local-6989586621681387453"><span class="annot"><span class="annottext">r
</span><a href="#local-6989586621681387453"><span class="hs-identifier hs-var">res</span></a></span></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">forall a. Name -&gt; TyVar -&gt; TcM a -&gt; TcM a
</span><a href="GHC.Tc.Utils.Env.html#tcExtendIdEnv1"><span class="hs-identifier hs-var">tcExtendIdEnv1</span></a></span><span> </span><span class="annot"><span class="annottext">Name
</span><a href="#local-6989586621681387459"><span class="hs-identifier hs-var">name</span></a></span><span> </span><span class="annot"><span class="annottext">TyVar
</span><a href="#local-6989586621681387455"><span class="hs-identifier hs-var">bndr_id</span></a></span><span> </span><span class="annot"><span class="annottext">forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><a href="../../base-4.16.4.0/src/GHC-Base.html#%24"><span class="hs-operator hs-var">$</span></a></span><span>
</span><span id="line-406"></span><span>                         </span><span class="annot"><span class="annottext">Scaled ExpSigmaType -&gt; Checker (LPat GhcRn) (LPat GhcTc)
</span><a href="GHC.Tc.Gen.Pat.html#tc_lpat"><span class="hs-identifier hs-var">tc_lpat</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Scaled ExpSigmaType
</span><a href="#local-6989586621681387507"><span class="hs-identifier hs-var">pat_ty</span></a></span><span> </span><span class="annot"><span class="annottext">forall a b. Scaled a -&gt; b -&gt; Scaled b
</span><a href="GHC.Core.Type.html#scaledSet"><span class="hs-operator hs-var">`scaledSet`</span></a></span><span class="hs-special">(</span><span class="annot"><span class="annottext">TcType -&gt; ExpSigmaType
</span><a href="GHC.Tc.Utils.TcType.html#mkCheckExpType"><span class="hs-identifier hs-var">mkCheckExpType</span></a></span><span> </span><span class="annot"><span class="annottext">forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><a href="../../base-4.16.4.0/src/GHC-Base.html#%24"><span class="hs-operator hs-var">$</span></a></span><span> </span><span class="annot"><span class="annottext">TyVar -&gt; TcType
</span><a href="GHC.Types.Id.html#idType"><span class="hs-identifier hs-var">idType</span></a></span><span> </span><span class="annot"><span class="annottext">TyVar
</span><a href="#local-6989586621681387455"><span class="hs-identifier hs-var">bndr_id</span></a></span><span class="hs-special">)</span><span class="hs-special">)</span><span>
</span><span id="line-407"></span><span>                                 </span><span class="annot"><span class="annottext">PatEnv
</span><a href="#local-6989586621681387506"><span class="hs-identifier hs-var">penv</span></a></span><span> </span><span class="annot"><span class="annottext">LPat GhcRn
</span><a href="#local-6989586621681387458"><span class="hs-identifier hs-var">pat</span></a></span><span> </span><span class="annot"><span class="annottext">TcM r
</span><a href="#local-6989586621681387504"><span class="hs-identifier hs-var">thing_inside</span></a></span><span>
</span><span id="line-408"></span><span>            </span><span class="hs-comment">-- NB: if we do inference on:</span><span>
</span><span id="line-409"></span><span>            </span><span class="hs-comment">--          \ (y@(x::forall a. a-&gt;a)) = e</span><span>
</span><span id="line-410"></span><span>            </span><span class="hs-comment">-- we'll fail.  The as-pattern infers a monotype for 'y', which then</span><span>
</span><span id="line-411"></span><span>            </span><span class="hs-comment">-- fails to unify with the polymorphic type for 'x'.  This could</span><span>
</span><span id="line-412"></span><span>            </span><span class="hs-comment">-- perhaps be fixed, but only with a bit more work.</span><span>
</span><span id="line-413"></span><span>            </span><span class="hs-comment">--</span><span>
</span><span id="line-414"></span><span>            </span><span class="hs-comment">-- If you fix it, don't forget the bindInstsOfPatIds!</span><span>
</span><span id="line-415"></span><span>        </span><span class="hs-special">;</span><span> </span><span id="local-6989586621681387451"><span class="annot"><span class="annottext">TcType
</span><a href="#local-6989586621681387451"><span class="hs-identifier hs-var">pat_ty</span></a></span></span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">ExpSigmaType -&gt; TcM TcType
</span><a href="GHC.Tc.Utils.TcMType.html#readExpType"><span class="hs-identifier hs-var">readExpType</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">forall a. Scaled a -&gt; a
</span><a href="GHC.Core.TyCo.Rep.html#scaledThing"><span class="hs-identifier hs-var">scaledThing</span></a></span><span> </span><span class="annot"><span class="annottext">Scaled ExpSigmaType
</span><a href="#local-6989586621681387507"><span class="hs-identifier hs-var">pat_ty</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-416"></span><span>        </span><span class="hs-special">;</span><span> </span><span class="annot"><span class="annottext">forall (m :: * -&gt; *) a. Monad m =&gt; a -&gt; m a
</span><a href="../../base-4.16.4.0/src/GHC-Base.html#return"><span class="hs-identifier hs-var">return</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">HsWrapper -&gt; Pat GhcTc -&gt; TcType -&gt; Pat GhcTc
</span><a href="GHC.Hs.Utils.html#mkHsWrapPat"><span class="hs-identifier hs-var">mkHsWrapPat</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">HsWrapper
</span><a href="#local-6989586621681387456"><span class="hs-identifier hs-var">wrap</span></a></span><span> </span><span class="annot"><span class="annottext">HsWrapper -&gt; HsWrapper -&gt; HsWrapper
</span><a href="GHC.Tc.Types.Evidence.html#%3C.%3E"><span class="hs-operator hs-var">&lt;.&gt;</span></a></span><span> </span><span class="annot"><span class="annottext">HsWrapper
</span><a href="#local-6989586621681387457"><span class="hs-identifier hs-var">mult_wrap</span></a></span><span class="hs-special">)</span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">forall p. XAsPat p -&gt; LIdP p -&gt; LPat p -&gt; Pat p
</span><a href="Language.Haskell.Syntax.Pat.html#AsPat"><span class="hs-identifier hs-var">AsPat</span></a></span><span> </span><span class="annot"><span class="annottext">XAsPat GhcRn
</span><a href="#local-6989586621681387461"><span class="hs-identifier hs-var">x</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">forall l e. l -&gt; e -&gt; GenLocated l e
</span><a href="GHC.Types.SrcLoc.html#L"><span class="hs-identifier hs-var">L</span></a></span><span> </span><span class="annot"><span class="annottext">SrcSpanAnnN
</span><a href="#local-6989586621681387460"><span class="hs-identifier hs-var">nm_loc</span></a></span><span> </span><span class="annot"><span class="annottext">TyVar
</span><a href="#local-6989586621681387455"><span class="hs-identifier hs-var">bndr_id</span></a></span><span class="hs-special">)</span><span> </span><span class="annot"><span class="annottext">GenLocated (SrcSpanAnn' (EpAnn AnnListItem)) (Pat GhcTc)
</span><a href="#local-6989586621681387454"><span class="hs-identifier hs-var">pat'</span></a></span><span class="hs-special">)</span><span> </span><span class="annot"><span class="annottext">TcType
</span><a href="#local-6989586621681387451"><span class="hs-identifier hs-var">pat_ty</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">r
</span><a href="#local-6989586621681387453"><span class="hs-identifier hs-var">res</span></a></span><span class="hs-special">)</span><span> </span><span class="hs-special">}</span><span>
</span><span id="line-417"></span><span>
</span><span id="line-418"></span><span>  </span><span class="annot"><a href="Language.Haskell.Syntax.Pat.html#ViewPat"><span class="hs-identifier hs-type">ViewPat</span></a></span><span> </span><span class="annot"><span class="annottext">XViewPat GhcRn
</span><span class="hs-identifier">_</span></span><span> </span><span id="local-6989586621681387449"><span class="annot"><span class="annottext">LHsExpr GhcRn
</span><a href="#local-6989586621681387449"><span class="hs-identifier hs-var">expr</span></a></span></span><span> </span><span id="local-6989586621681387448"><span class="annot"><span class="annottext">LPat GhcRn
</span><a href="#local-6989586621681387448"><span class="hs-identifier hs-var">pat</span></a></span></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-keyword">do</span><span>
</span><span id="line-419"></span><span>        </span><span class="hs-special">{</span><span> </span><span id="local-6989586621681387447"><span class="annot"><span class="annottext">HsWrapper
</span><a href="#local-6989586621681387447"><span class="hs-identifier hs-var">mult_wrap</span></a></span></span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">forall a. Scaled a -&gt; TcM HsWrapper
</span><a href="GHC.Tc.Gen.Pat.html#checkManyPattern"><span class="hs-identifier hs-var">checkManyPattern</span></a></span><span> </span><span class="annot"><span class="annottext">Scaled ExpSigmaType
</span><a href="#local-6989586621681387507"><span class="hs-identifier hs-var">pat_ty</span></a></span><span>
</span><span id="line-420"></span><span>         </span><span class="hs-comment">-- See Note [Wrapper returned from tcSubMult] in GHC.Tc.Utils.Unify.</span><span>
</span><span id="line-421"></span><span>         </span><span class="hs-comment">--</span><span>
</span><span id="line-422"></span><span>         </span><span class="hs-comment">-- It should be possible to have view patterns at linear (or otherwise</span><span>
</span><span id="line-423"></span><span>         </span><span class="hs-comment">-- non-Many) multiplicity. But it is not clear at the moment what</span><span>
</span><span id="line-424"></span><span>         </span><span class="hs-comment">-- restriction need to be put in place, if any, for linear view</span><span>
</span><span id="line-425"></span><span>         </span><span class="hs-comment">-- patterns to desugar to type-correct Core.</span><span>
</span><span id="line-426"></span><span>
</span><span id="line-427"></span><span>        </span><span class="hs-special">;</span><span> </span><span class="hs-special">(</span><span id="local-6989586621681387446"><span class="annot"><span class="annottext">GenLocated (SrcSpanAnn' (EpAnn AnnListItem)) (HsExpr GhcTc)
</span><a href="#local-6989586621681387446"><span class="hs-identifier hs-var">expr'</span></a></span></span><span class="hs-special">,</span><span id="local-6989586621681387445"><span class="annot"><span class="annottext">TcType
</span><a href="#local-6989586621681387445"><span class="hs-identifier hs-var">expr_ty</span></a></span></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">LHsExpr GhcRn -&gt; TcM (LHsExpr GhcTc, TcType)
</span><a href="GHC.Tc.Gen.Expr.html#tcInferRho"><span class="hs-identifier hs-var">tcInferRho</span></a></span><span> </span><span class="annot"><span class="annottext">LHsExpr GhcRn
</span><a href="#local-6989586621681387449"><span class="hs-identifier hs-var">expr</span></a></span><span>
</span><span id="line-428"></span><span>               </span><span class="hs-comment">-- Note [View patterns and polymorphism]</span><span>
</span><span id="line-429"></span><span>
</span><span id="line-430"></span><span>         </span><span class="hs-comment">-- Expression must be a function</span><span>
</span><span id="line-431"></span><span>        </span><span class="hs-special">;</span><span> </span><span class="hs-keyword">let</span><span> </span><span id="local-6989586621681387444"><span class="annot"><span class="annottext">herald :: SDoc
</span><a href="#local-6989586621681387444"><span class="hs-identifier hs-var hs-var">herald</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">String -&gt; SDoc
</span><a href="GHC.Utils.Outputable.html#text"><span class="hs-identifier hs-var">text</span></a></span><span> </span><span class="annot"><span class="annottext">String
</span><span class="hs-string">&quot;A view pattern expression expects&quot;</span></span><span>
</span><span id="line-432"></span><span>        </span><span class="hs-special">;</span><span> </span><span class="hs-special">(</span><span id="local-6989586621681387443"><span class="annot"><span class="annottext">HsWrapper
</span><a href="#local-6989586621681387443"><span class="hs-identifier hs-var">expr_wrap1</span></a></span></span><span class="hs-special">,</span><span> </span><span class="annot"><a href="GHC.Core.TyCo.Rep.html#Scaled"><span class="hs-identifier hs-type">Scaled</span></a></span><span> </span><span id="local-6989586621681387442"><span class="annot"><span class="annottext">TcType
</span><a href="#local-6989586621681387442"><span class="hs-identifier hs-var">_mult</span></a></span></span><span> </span><span id="local-6989586621681387441"><span class="annot"><span class="annottext">TcType
</span><a href="#local-6989586621681387441"><span class="hs-identifier hs-var">inf_arg_ty</span></a></span></span><span class="hs-special">,</span><span> </span><span id="local-6989586621681387440"><span class="annot"><span class="annottext">TcType
</span><a href="#local-6989586621681387440"><span class="hs-identifier hs-var">inf_res_sigma</span></a></span></span><span class="hs-special">)</span><span>
</span><span id="line-433"></span><span>            </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">SDoc
-&gt; Maybe SDoc
-&gt; (Int, [Scaled TcType])
-&gt; TcType
-&gt; TcM (HsWrapper, Scaled TcType, TcType)
</span><a href="GHC.Tc.Utils.Unify.html#matchActualFunTySigma"><span class="hs-identifier hs-var">matchActualFunTySigma</span></a></span><span> </span><span class="annot"><span class="annottext">SDoc
</span><a href="#local-6989586621681387444"><span class="hs-identifier hs-var">herald</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">forall a. a -&gt; Maybe a
</span><a href="../../base-4.16.4.0/src/GHC-Maybe.html#Just"><span class="hs-identifier hs-var">Just</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">forall a. Outputable a =&gt; a -&gt; SDoc
</span><a href="GHC.Utils.Outputable.html#ppr"><span class="hs-identifier hs-var">ppr</span></a></span><span> </span><span class="annot"><span class="annottext">LHsExpr GhcRn
</span><a href="#local-6989586621681387449"><span class="hs-identifier hs-var">expr</span></a></span><span class="hs-special">)</span><span class="hs-special">)</span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Int
</span><span class="hs-number">1</span></span><span class="hs-special">,</span><span class="hs-special">[</span><span class="hs-special">]</span><span class="hs-special">)</span><span> </span><span class="annot"><span class="annottext">TcType
</span><a href="#local-6989586621681387445"><span class="hs-identifier hs-var">expr_ty</span></a></span><span>
</span><span id="line-434"></span><span>               </span><span class="hs-comment">-- See Note [View patterns and polymorphism]</span><span>
</span><span id="line-435"></span><span>               </span><span class="hs-comment">-- expr_wrap1 :: expr_ty &quot;-&gt;&quot; (inf_arg_ty -&gt; inf_res_sigma)</span><span>
</span><span id="line-436"></span><span>
</span><span id="line-437"></span><span>         </span><span class="hs-comment">-- Check that overall pattern is more polymorphic than arg type</span><span>
</span><span id="line-438"></span><span>        </span><span class="hs-special">;</span><span> </span><span id="local-6989586621681387438"><span class="annot"><span class="annottext">HsWrapper
</span><a href="#local-6989586621681387438"><span class="hs-identifier hs-var">expr_wrap2</span></a></span></span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">PatEnv -&gt; ExpSigmaType -&gt; TcType -&gt; TcM HsWrapper
</span><a href="GHC.Tc.Gen.Pat.html#tc_sub_type"><span class="hs-identifier hs-var">tc_sub_type</span></a></span><span> </span><span class="annot"><span class="annottext">PatEnv
</span><a href="#local-6989586621681387506"><span class="hs-identifier hs-var">penv</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">forall a. Scaled a -&gt; a
</span><a href="GHC.Core.TyCo.Rep.html#scaledThing"><span class="hs-identifier hs-var">scaledThing</span></a></span><span> </span><span class="annot"><span class="annottext">Scaled ExpSigmaType
</span><a href="#local-6989586621681387507"><span class="hs-identifier hs-var">pat_ty</span></a></span><span class="hs-special">)</span><span> </span><span class="annot"><span class="annottext">TcType
</span><a href="#local-6989586621681387441"><span class="hs-identifier hs-var">inf_arg_ty</span></a></span><span>
</span><span id="line-439"></span><span>            </span><span class="hs-comment">-- expr_wrap2 :: pat_ty &quot;-&gt;&quot; inf_arg_ty</span><span>
</span><span id="line-440"></span><span>
</span><span id="line-441"></span><span>         </span><span class="hs-comment">-- Pattern must have inf_res_sigma</span><span>
</span><span id="line-442"></span><span>        </span><span class="hs-special">;</span><span> </span><span class="hs-special">(</span><span id="local-6989586621681387437"><span class="annot"><span class="annottext">GenLocated (SrcSpanAnn' (EpAnn AnnListItem)) (Pat GhcTc)
</span><a href="#local-6989586621681387437"><span class="hs-identifier hs-var">pat'</span></a></span></span><span class="hs-special">,</span><span> </span><span id="local-6989586621681387436"><span class="annot"><span class="annottext">r
</span><a href="#local-6989586621681387436"><span class="hs-identifier hs-var">res</span></a></span></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">Scaled ExpSigmaType -&gt; Checker (LPat GhcRn) (LPat GhcTc)
</span><a href="GHC.Tc.Gen.Pat.html#tc_lpat"><span class="hs-identifier hs-var">tc_lpat</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Scaled ExpSigmaType
</span><a href="#local-6989586621681387507"><span class="hs-identifier hs-var">pat_ty</span></a></span><span> </span><span class="annot"><span class="annottext">forall a b. Scaled a -&gt; b -&gt; Scaled b
</span><a href="GHC.Core.Type.html#scaledSet"><span class="hs-operator hs-var">`scaledSet`</span></a></span><span> </span><span class="annot"><span class="annottext">TcType -&gt; ExpSigmaType
</span><a href="GHC.Tc.Utils.TcType.html#mkCheckExpType"><span class="hs-identifier hs-var">mkCheckExpType</span></a></span><span> </span><span class="annot"><span class="annottext">TcType
</span><a href="#local-6989586621681387440"><span class="hs-identifier hs-var">inf_res_sigma</span></a></span><span class="hs-special">)</span><span> </span><span class="annot"><span class="annottext">PatEnv
</span><a href="#local-6989586621681387506"><span class="hs-identifier hs-var">penv</span></a></span><span> </span><span class="annot"><span class="annottext">LPat GhcRn
</span><a href="#local-6989586621681387448"><span class="hs-identifier hs-var">pat</span></a></span><span> </span><span class="annot"><span class="annottext">TcM r
</span><a href="#local-6989586621681387504"><span class="hs-identifier hs-var">thing_inside</span></a></span><span>
</span><span id="line-443"></span><span>
</span><span id="line-444"></span><span>        </span><span class="hs-special">;</span><span> </span><span class="hs-keyword">let</span><span> </span><span class="annot"><a href="GHC.Core.TyCo.Rep.html#Scaled"><span class="hs-identifier hs-type">Scaled</span></a></span><span> </span><span id="local-6989586621681387435"><span class="annot"><span class="annottext">TcType
</span><a href="#local-6989586621681387435"><span class="hs-identifier hs-var">w</span></a></span></span><span> </span><span id="local-6989586621681387434"><span class="annot"><span class="annottext">ExpSigmaType
</span><a href="#local-6989586621681387434"><span class="hs-identifier hs-var">h_pat_ty</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">Scaled ExpSigmaType
</span><a href="#local-6989586621681387507"><span class="hs-identifier hs-var">pat_ty</span></a></span><span>
</span><span id="line-445"></span><span>        </span><span class="hs-special">;</span><span> </span><span id="local-6989586621681387433"><span class="annot"><span class="annottext">TcType
</span><a href="#local-6989586621681387433"><span class="hs-identifier hs-var">pat_ty</span></a></span></span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">ExpSigmaType -&gt; TcM TcType
</span><a href="GHC.Tc.Utils.TcMType.html#readExpType"><span class="hs-identifier hs-var">readExpType</span></a></span><span> </span><span class="annot"><span class="annottext">ExpSigmaType
</span><a href="#local-6989586621681387434"><span class="hs-identifier hs-var">h_pat_ty</span></a></span><span>
</span><span id="line-446"></span><span>        </span><span class="hs-special">;</span><span> </span><span class="hs-keyword">let</span><span> </span><span id="local-6989586621681387432"><span class="annot"><span class="annottext">expr_wrap2' :: HsWrapper
</span><a href="#local-6989586621681387432"><span class="hs-identifier hs-var hs-var">expr_wrap2'</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">HsWrapper
-&gt; HsWrapper -&gt; Scaled TcType -&gt; TcType -&gt; SDoc -&gt; HsWrapper
</span><a href="GHC.Tc.Types.Evidence.html#mkWpFun"><span class="hs-identifier hs-var">mkWpFun</span></a></span><span> </span><span class="annot"><span class="annottext">HsWrapper
</span><a href="#local-6989586621681387438"><span class="hs-identifier hs-var">expr_wrap2</span></a></span><span> </span><span class="annot"><span class="annottext">HsWrapper
</span><a href="GHC.Tc.Types.Evidence.html#idHsWrapper"><span class="hs-identifier hs-var">idHsWrapper</span></a></span><span>
</span><span id="line-447"></span><span>                                    </span><span class="hs-special">(</span><span class="annot"><span class="annottext">forall a. TcType -&gt; a -&gt; Scaled a
</span><a href="GHC.Core.TyCo.Rep.html#Scaled"><span class="hs-identifier hs-var">Scaled</span></a></span><span> </span><span class="annot"><span class="annottext">TcType
</span><a href="#local-6989586621681387435"><span class="hs-identifier hs-var">w</span></a></span><span> </span><span class="annot"><span class="annottext">TcType
</span><a href="#local-6989586621681387433"><span class="hs-identifier hs-var">pat_ty</span></a></span><span class="hs-special">)</span><span> </span><span class="annot"><span class="annottext">TcType
</span><a href="#local-6989586621681387440"><span class="hs-identifier hs-var">inf_res_sigma</span></a></span><span> </span><span class="annot"><span class="annottext">SDoc
</span><a href="#local-6989586621681387430"><span class="hs-identifier hs-var">doc</span></a></span><span>
</span><span id="line-448"></span><span>               </span><span class="hs-comment">-- expr_wrap2' :: (inf_arg_ty -&gt; inf_res_sigma) &quot;-&gt;&quot;</span><span>
</span><span id="line-449"></span><span>               </span><span class="hs-comment">--                (pat_ty -&gt; inf_res_sigma)</span><span>
</span><span id="line-450"></span><span>              </span><span id="local-6989586621681387429"><span class="annot"><span class="annottext">expr_wrap :: HsWrapper
</span><a href="#local-6989586621681387429"><span class="hs-identifier hs-var hs-var">expr_wrap</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">HsWrapper
</span><a href="#local-6989586621681387432"><span class="hs-identifier hs-var">expr_wrap2'</span></a></span><span> </span><span class="annot"><span class="annottext">HsWrapper -&gt; HsWrapper -&gt; HsWrapper
</span><a href="GHC.Tc.Types.Evidence.html#%3C.%3E"><span class="hs-operator hs-var">&lt;.&gt;</span></a></span><span> </span><span class="annot"><span class="annottext">HsWrapper
</span><a href="#local-6989586621681387443"><span class="hs-identifier hs-var">expr_wrap1</span></a></span><span> </span><span class="annot"><span class="annottext">HsWrapper -&gt; HsWrapper -&gt; HsWrapper
</span><a href="GHC.Tc.Types.Evidence.html#%3C.%3E"><span class="hs-operator hs-var">&lt;.&gt;</span></a></span><span> </span><span class="annot"><span class="annottext">HsWrapper
</span><a href="#local-6989586621681387447"><span class="hs-identifier hs-var">mult_wrap</span></a></span><span>
</span><span id="line-451"></span><span>              </span><span id="local-6989586621681387430"><span class="annot"><span class="annottext">doc :: SDoc
</span><a href="#local-6989586621681387430"><span class="hs-identifier hs-var hs-var">doc</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">String -&gt; SDoc
</span><a href="GHC.Utils.Outputable.html#text"><span class="hs-identifier hs-var">text</span></a></span><span> </span><span class="annot"><span class="annottext">String
</span><span class="hs-string">&quot;When checking the view pattern function:&quot;</span></span><span> </span><span class="annot"><span class="annottext">SDoc -&gt; SDoc -&gt; SDoc
</span><a href="GHC.Utils.Outputable.html#%3C%2B%3E"><span class="hs-operator hs-var">&lt;+&gt;</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">forall a. Outputable a =&gt; a -&gt; SDoc
</span><a href="GHC.Utils.Outputable.html#ppr"><span class="hs-identifier hs-var">ppr</span></a></span><span> </span><span class="annot"><span class="annottext">LHsExpr GhcRn
</span><a href="#local-6989586621681387449"><span class="hs-identifier hs-var">expr</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-452"></span><span>        </span><span class="hs-special">;</span><span> </span><span class="annot"><span class="annottext">forall (m :: * -&gt; *) a. Monad m =&gt; a -&gt; m a
</span><a href="../../base-4.16.4.0/src/GHC-Base.html#return"><span class="hs-identifier hs-var">return</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">forall p. XViewPat p -&gt; LHsExpr p -&gt; LPat p -&gt; Pat p
</span><a href="Language.Haskell.Syntax.Pat.html#ViewPat"><span class="hs-identifier hs-var">ViewPat</span></a></span><span> </span><span class="annot"><span class="annottext">TcType
</span><a href="#local-6989586621681387433"><span class="hs-identifier hs-var">pat_ty</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">HsWrapper -&gt; LHsExpr GhcTc -&gt; LHsExpr GhcTc
</span><a href="GHC.Hs.Utils.html#mkLHsWrap"><span class="hs-identifier hs-var">mkLHsWrap</span></a></span><span> </span><span class="annot"><span class="annottext">HsWrapper
</span><a href="#local-6989586621681387429"><span class="hs-identifier hs-var">expr_wrap</span></a></span><span> </span><span class="annot"><span class="annottext">GenLocated (SrcSpanAnn' (EpAnn AnnListItem)) (HsExpr GhcTc)
</span><a href="#local-6989586621681387446"><span class="hs-identifier hs-var">expr'</span></a></span><span class="hs-special">)</span><span> </span><span class="annot"><span class="annottext">GenLocated (SrcSpanAnn' (EpAnn AnnListItem)) (Pat GhcTc)
</span><a href="#local-6989586621681387437"><span class="hs-identifier hs-var">pat'</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">r
</span><a href="#local-6989586621681387436"><span class="hs-identifier hs-var">res</span></a></span><span class="hs-special">)</span><span class="hs-special">}</span><span>
</span><span id="line-453"></span><span>
</span><span id="line-454"></span><span class="hs-comment">{- Note [View patterns and polymorphism]
~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~
Consider this exotic example:
   pair :: forall a. Bool -&gt; a -&gt; forall b. b -&gt; (a,b)

   f :: Int -&gt; blah
   f (pair True -&gt; x) = ...here (x :: forall b. b -&gt; (Int,b))

The expression (pair True) should have type
    pair True :: Int -&gt; forall b. b -&gt; (Int,b)
so that it is ready to consume the incoming Int. It should be an
arrow type (t1 -&gt; t2); hence using (tcInferRho expr).

Then, when taking that arrow apart we want to get a *sigma* type
(forall b. b-&gt;(Int,b)), because that's what we want to bind 'x' to.
Fortunately that's what matchExpectedFunTySigma returns anyway.
-}</span><span>
</span><span id="line-471"></span><span>
</span><span id="line-472"></span><span class="hs-comment">-- Type signatures in patterns</span><span>
</span><span id="line-473"></span><span class="hs-comment">-- See Note [Pattern coercions] below</span><span>
</span><span id="line-474"></span><span>  </span><span class="annot"><a href="Language.Haskell.Syntax.Pat.html#SigPat"><span class="hs-identifier hs-type">SigPat</span></a></span><span> </span><span class="annot"><span class="annottext">XSigPat GhcRn
</span><span class="hs-identifier">_</span></span><span> </span><span id="local-6989586621681387425"><span class="annot"><span class="annottext">LPat GhcRn
</span><a href="#local-6989586621681387425"><span class="hs-identifier hs-var">pat</span></a></span></span><span> </span><span id="local-6989586621681387424"><span class="annot"><span class="annottext">HsPatSigType (NoGhcTc GhcRn)
</span><a href="#local-6989586621681387424"><span class="hs-identifier hs-var">sig_ty</span></a></span></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-keyword">do</span><span>
</span><span id="line-475"></span><span>        </span><span class="hs-special">{</span><span> </span><span class="hs-special">(</span><span id="local-6989586621681387423"><span class="annot"><span class="annottext">TcType
</span><a href="#local-6989586621681387423"><span class="hs-identifier hs-var">inner_ty</span></a></span></span><span class="hs-special">,</span><span> </span><span id="local-6989586621681387422"><span class="annot"><span class="annottext">[(Name, TyVar)]
</span><a href="#local-6989586621681387422"><span class="hs-identifier hs-var">tv_binds</span></a></span></span><span class="hs-special">,</span><span> </span><span id="local-6989586621681387421"><span class="annot"><span class="annottext">[(Name, TyVar)]
</span><a href="#local-6989586621681387421"><span class="hs-identifier hs-var">wcs</span></a></span></span><span class="hs-special">,</span><span> </span><span id="local-6989586621681387420"><span class="annot"><span class="annottext">HsWrapper
</span><a href="#local-6989586621681387420"><span class="hs-identifier hs-var">wrap</span></a></span></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">Bool
-&gt; HsPatSigType GhcRn
-&gt; ExpSigmaType
-&gt; TcM (TcType, [(Name, TyVar)], [(Name, TyVar)], HsWrapper)
</span><a href="GHC.Tc.Gen.Pat.html#tcPatSig"><span class="hs-identifier hs-var">tcPatSig</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">PatEnv -&gt; Bool
</span><a href="GHC.Tc.Gen.Pat.html#inPatBind"><span class="hs-identifier hs-var">inPatBind</span></a></span><span> </span><span class="annot"><span class="annottext">PatEnv
</span><a href="#local-6989586621681387506"><span class="hs-identifier hs-var">penv</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-476"></span><span>                                                            </span><span class="annot"><span class="annottext">HsPatSigType (NoGhcTc GhcRn)
</span><a href="#local-6989586621681387424"><span class="hs-identifier hs-var">sig_ty</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">forall a. Scaled a -&gt; a
</span><a href="GHC.Core.TyCo.Rep.html#scaledThing"><span class="hs-identifier hs-var">scaledThing</span></a></span><span> </span><span class="annot"><span class="annottext">Scaled ExpSigmaType
</span><a href="#local-6989586621681387507"><span class="hs-identifier hs-var">pat_ty</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-477"></span><span>                </span><span class="hs-comment">-- Using tcExtendNameTyVarEnv is appropriate here</span><span>
</span><span id="line-478"></span><span>                </span><span class="hs-comment">-- because we're not really bringing fresh tyvars into scope.</span><span>
</span><span id="line-479"></span><span>                </span><span class="hs-comment">-- We're *naming* existing tyvars. Note that it is OK for a tyvar</span><span>
</span><span id="line-480"></span><span>                </span><span class="hs-comment">-- from an outer scope to mention one of these tyvars in its kind.</span><span>
</span><span id="line-481"></span><span>        </span><span class="hs-special">;</span><span> </span><span class="hs-special">(</span><span id="local-6989586621681387418"><span class="annot"><span class="annottext">GenLocated (SrcSpanAnn' (EpAnn AnnListItem)) (Pat GhcTc)
</span><a href="#local-6989586621681387418"><span class="hs-identifier hs-var">pat'</span></a></span></span><span class="hs-special">,</span><span> </span><span id="local-6989586621681387417"><span class="annot"><span class="annottext">r
</span><a href="#local-6989586621681387417"><span class="hs-identifier hs-var">res</span></a></span></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">forall r. [(Name, TyVar)] -&gt; TcM r -&gt; TcM r
</span><a href="GHC.Tc.Utils.Env.html#tcExtendNameTyVarEnv"><span class="hs-identifier hs-var">tcExtendNameTyVarEnv</span></a></span><span> </span><span class="annot"><span class="annottext">[(Name, TyVar)]
</span><a href="#local-6989586621681387421"><span class="hs-identifier hs-var">wcs</span></a></span><span>      </span><span class="annot"><span class="annottext">forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><a href="../../base-4.16.4.0/src/GHC-Base.html#%24"><span class="hs-operator hs-var">$</span></a></span><span>
</span><span id="line-482"></span><span>                         </span><span class="annot"><span class="annottext">forall r. [(Name, TyVar)] -&gt; TcM r -&gt; TcM r
</span><a href="GHC.Tc.Utils.Env.html#tcExtendNameTyVarEnv"><span class="hs-identifier hs-var">tcExtendNameTyVarEnv</span></a></span><span> </span><span class="annot"><span class="annottext">[(Name, TyVar)]
</span><a href="#local-6989586621681387422"><span class="hs-identifier hs-var">tv_binds</span></a></span><span> </span><span class="annot"><span class="annottext">forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><a href="../../base-4.16.4.0/src/GHC-Base.html#%24"><span class="hs-operator hs-var">$</span></a></span><span>
</span><span id="line-483"></span><span>                         </span><span class="annot"><span class="annottext">Scaled ExpSigmaType -&gt; Checker (LPat GhcRn) (LPat GhcTc)
</span><a href="GHC.Tc.Gen.Pat.html#tc_lpat"><span class="hs-identifier hs-var">tc_lpat</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Scaled ExpSigmaType
</span><a href="#local-6989586621681387507"><span class="hs-identifier hs-var">pat_ty</span></a></span><span> </span><span class="annot"><span class="annottext">forall a b. Scaled a -&gt; b -&gt; Scaled b
</span><a href="GHC.Core.Type.html#scaledSet"><span class="hs-operator hs-var">`scaledSet`</span></a></span><span> </span><span class="annot"><span class="annottext">TcType -&gt; ExpSigmaType
</span><a href="GHC.Tc.Utils.TcType.html#mkCheckExpType"><span class="hs-identifier hs-var">mkCheckExpType</span></a></span><span> </span><span class="annot"><span class="annottext">TcType
</span><a href="#local-6989586621681387423"><span class="hs-identifier hs-var">inner_ty</span></a></span><span class="hs-special">)</span><span> </span><span class="annot"><span class="annottext">PatEnv
</span><a href="#local-6989586621681387506"><span class="hs-identifier hs-var">penv</span></a></span><span> </span><span class="annot"><span class="annottext">LPat GhcRn
</span><a href="#local-6989586621681387425"><span class="hs-identifier hs-var">pat</span></a></span><span> </span><span class="annot"><span class="annottext">TcM r
</span><a href="#local-6989586621681387504"><span class="hs-identifier hs-var">thing_inside</span></a></span><span>
</span><span id="line-484"></span><span>        </span><span class="hs-special">;</span><span> </span><span id="local-6989586621681387415"><span class="annot"><span class="annottext">TcType
</span><a href="#local-6989586621681387415"><span class="hs-identifier hs-var">pat_ty</span></a></span></span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">ExpSigmaType -&gt; TcM TcType
</span><a href="GHC.Tc.Utils.TcMType.html#readExpType"><span class="hs-identifier hs-var">readExpType</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">forall a. Scaled a -&gt; a
</span><a href="GHC.Core.TyCo.Rep.html#scaledThing"><span class="hs-identifier hs-var">scaledThing</span></a></span><span> </span><span class="annot"><span class="annottext">Scaled ExpSigmaType
</span><a href="#local-6989586621681387507"><span class="hs-identifier hs-var">pat_ty</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-485"></span><span>        </span><span class="hs-special">;</span><span> </span><span class="annot"><span class="annottext">forall (m :: * -&gt; *) a. Monad m =&gt; a -&gt; m a
</span><a href="../../base-4.16.4.0/src/GHC-Base.html#return"><span class="hs-identifier hs-var">return</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">HsWrapper -&gt; Pat GhcTc -&gt; TcType -&gt; Pat GhcTc
</span><a href="GHC.Hs.Utils.html#mkHsWrapPat"><span class="hs-identifier hs-var">mkHsWrapPat</span></a></span><span> </span><span class="annot"><span class="annottext">HsWrapper
</span><a href="#local-6989586621681387420"><span class="hs-identifier hs-var">wrap</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">forall p. XSigPat p -&gt; LPat p -&gt; HsPatSigType (NoGhcTc p) -&gt; Pat p
</span><a href="Language.Haskell.Syntax.Pat.html#SigPat"><span class="hs-identifier hs-var">SigPat</span></a></span><span> </span><span class="annot"><span class="annottext">TcType
</span><a href="#local-6989586621681387423"><span class="hs-identifier hs-var">inner_ty</span></a></span><span> </span><span class="annot"><span class="annottext">GenLocated (SrcSpanAnn' (EpAnn AnnListItem)) (Pat GhcTc)
</span><a href="#local-6989586621681387418"><span class="hs-identifier hs-var">pat'</span></a></span><span> </span><span class="annot"><span class="annottext">HsPatSigType (NoGhcTc GhcRn)
</span><a href="#local-6989586621681387424"><span class="hs-identifier hs-var">sig_ty</span></a></span><span class="hs-special">)</span><span> </span><span class="annot"><span class="annottext">TcType
</span><a href="#local-6989586621681387415"><span class="hs-identifier hs-var">pat_ty</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">r
</span><a href="#local-6989586621681387417"><span class="hs-identifier hs-var">res</span></a></span><span class="hs-special">)</span><span> </span><span class="hs-special">}</span><span>
</span><span id="line-486"></span><span>
</span><span id="line-487"></span><span class="hs-comment">------------------------</span><span>
</span><span id="line-488"></span><span class="hs-comment">-- Lists, tuples, arrays</span><span>
</span><span id="line-489"></span><span>  </span><span class="annot"><a href="Language.Haskell.Syntax.Pat.html#ListPat"><span class="hs-identifier hs-type">ListPat</span></a></span><span> </span><span class="annot"><span class="annottext">Maybe SyntaxExprRn
XListPat GhcRn
</span><a href="../../base-4.16.4.0/src/GHC-Maybe.html#Nothing"><span class="hs-identifier hs-var">Nothing</span></a></span><span> </span><span id="local-6989586621681387413"><span class="annot"><span class="annottext">[LPat GhcRn]
</span><a href="#local-6989586621681387413"><span class="hs-identifier hs-var">pats</span></a></span></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-keyword">do</span><span>
</span><span id="line-490"></span><span>        </span><span class="hs-special">{</span><span> </span><span class="hs-special">(</span><span id="local-6989586621681387412"><span class="annot"><span class="annottext">HsWrapper
</span><a href="#local-6989586621681387412"><span class="hs-identifier hs-var">coi</span></a></span></span><span class="hs-special">,</span><span> </span><span id="local-6989586621681387411"><span class="annot"><span class="annottext">TcType
</span><a href="#local-6989586621681387411"><span class="hs-identifier hs-var">elt_ty</span></a></span></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">forall a.
(TcType -&gt; TcM (TcCoercionN, a))
-&gt; PatEnv -&gt; ExpSigmaType -&gt; TcM (HsWrapper, a)
</span><a href="GHC.Tc.Gen.Pat.html#matchExpectedPatTy"><span class="hs-identifier hs-var">matchExpectedPatTy</span></a></span><span> </span><span class="annot"><span class="annottext">TcType -&gt; IOEnv (Env TcGblEnv TcLclEnv) (TcCoercionN, TcType)
</span><a href="GHC.Tc.Utils.Unify.html#matchExpectedListTy"><span class="hs-identifier hs-var">matchExpectedListTy</span></a></span><span> </span><span class="annot"><span class="annottext">PatEnv
</span><a href="#local-6989586621681387506"><span class="hs-identifier hs-var">penv</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">forall a. Scaled a -&gt; a
</span><a href="GHC.Core.TyCo.Rep.html#scaledThing"><span class="hs-identifier hs-var">scaledThing</span></a></span><span> </span><span class="annot"><span class="annottext">Scaled ExpSigmaType
</span><a href="#local-6989586621681387507"><span class="hs-identifier hs-var">pat_ty</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-491"></span><span>        </span><span class="hs-special">;</span><span> </span><span class="hs-special">(</span><span id="local-6989586621681387408"><span class="annot"><span class="annottext">[GenLocated (SrcSpanAnn' (EpAnn AnnListItem)) (Pat GhcTc)]
</span><a href="#local-6989586621681387408"><span class="hs-identifier hs-var">pats'</span></a></span></span><span class="hs-special">,</span><span> </span><span id="local-6989586621681387407"><span class="annot"><span class="annottext">r
</span><a href="#local-6989586621681387407"><span class="hs-identifier hs-var">res</span></a></span></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">forall inp out. Checker inp out -&gt; Checker [inp] [out]
</span><a href="GHC.Tc.Gen.Pat.html#tcMultiple"><span class="hs-identifier hs-var">tcMultiple</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Scaled ExpSigmaType -&gt; Checker (LPat GhcRn) (LPat GhcTc)
</span><a href="GHC.Tc.Gen.Pat.html#tc_lpat"><span class="hs-identifier hs-var">tc_lpat</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Scaled ExpSigmaType
</span><a href="#local-6989586621681387507"><span class="hs-identifier hs-var">pat_ty</span></a></span><span> </span><span class="annot"><span class="annottext">forall a b. Scaled a -&gt; b -&gt; Scaled b
</span><a href="GHC.Core.Type.html#scaledSet"><span class="hs-operator hs-var">`scaledSet`</span></a></span><span> </span><span class="annot"><span class="annottext">TcType -&gt; ExpSigmaType
</span><a href="GHC.Tc.Utils.TcType.html#mkCheckExpType"><span class="hs-identifier hs-var">mkCheckExpType</span></a></span><span> </span><span class="annot"><span class="annottext">TcType
</span><a href="#local-6989586621681387411"><span class="hs-identifier hs-var">elt_ty</span></a></span><span class="hs-special">)</span><span class="hs-special">)</span><span>
</span><span id="line-492"></span><span>                                     </span><span class="annot"><span class="annottext">PatEnv
</span><a href="#local-6989586621681387506"><span class="hs-identifier hs-var">penv</span></a></span><span> </span><span class="annot"><span class="annottext">[LPat GhcRn]
</span><a href="#local-6989586621681387413"><span class="hs-identifier hs-var">pats</span></a></span><span> </span><span class="annot"><span class="annottext">TcM r
</span><a href="#local-6989586621681387504"><span class="hs-identifier hs-var">thing_inside</span></a></span><span>
</span><span id="line-493"></span><span>        </span><span class="hs-special">;</span><span> </span><span id="local-6989586621681387406"><span class="annot"><span class="annottext">TcType
</span><a href="#local-6989586621681387406"><span class="hs-identifier hs-var">pat_ty</span></a></span></span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">ExpSigmaType -&gt; TcM TcType
</span><a href="GHC.Tc.Utils.TcMType.html#readExpType"><span class="hs-identifier hs-var">readExpType</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">forall a. Scaled a -&gt; a
</span><a href="GHC.Core.TyCo.Rep.html#scaledThing"><span class="hs-identifier hs-var">scaledThing</span></a></span><span> </span><span class="annot"><span class="annottext">Scaled ExpSigmaType
</span><a href="#local-6989586621681387507"><span class="hs-identifier hs-var">pat_ty</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-494"></span><span>        </span><span class="hs-special">;</span><span> </span><span class="annot"><span class="annottext">forall (m :: * -&gt; *) a. Monad m =&gt; a -&gt; m a
</span><a href="../../base-4.16.4.0/src/GHC-Base.html#return"><span class="hs-identifier hs-var">return</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">HsWrapper -&gt; Pat GhcTc -&gt; TcType -&gt; Pat GhcTc
</span><a href="GHC.Hs.Utils.html#mkHsWrapPat"><span class="hs-identifier hs-var">mkHsWrapPat</span></a></span><span> </span><span class="annot"><span class="annottext">HsWrapper
</span><a href="#local-6989586621681387412"><span class="hs-identifier hs-var">coi</span></a></span><span>
</span><span id="line-495"></span><span>                         </span><span class="hs-special">(</span><span class="annot"><span class="annottext">forall p. XListPat p -&gt; [LPat p] -&gt; Pat p
</span><a href="Language.Haskell.Syntax.Pat.html#ListPat"><span class="hs-identifier hs-var">ListPat</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">TcType -&gt; Maybe (TcType, SyntaxExpr GhcTc) -&gt; ListPatTc
</span><a href="GHC.Hs.Pat.html#ListPatTc"><span class="hs-identifier hs-var">ListPatTc</span></a></span><span> </span><span class="annot"><span class="annottext">TcType
</span><a href="#local-6989586621681387411"><span class="hs-identifier hs-var">elt_ty</span></a></span><span> </span><span class="annot"><span class="annottext">forall a. Maybe a
</span><a href="../../base-4.16.4.0/src/GHC-Maybe.html#Nothing"><span class="hs-identifier hs-var">Nothing</span></a></span><span class="hs-special">)</span><span> </span><span class="annot"><span class="annottext">[GenLocated (SrcSpanAnn' (EpAnn AnnListItem)) (Pat GhcTc)]
</span><a href="#local-6989586621681387408"><span class="hs-identifier hs-var">pats'</span></a></span><span class="hs-special">)</span><span> </span><span class="annot"><span class="annottext">TcType
</span><a href="#local-6989586621681387406"><span class="hs-identifier hs-var">pat_ty</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">r
</span><a href="#local-6989586621681387407"><span class="hs-identifier hs-var">res</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-496"></span><span class="hs-special">}</span><span>
</span><span id="line-497"></span><span>
</span><span id="line-498"></span><span>  </span><span class="annot"><a href="Language.Haskell.Syntax.Pat.html#ListPat"><span class="hs-identifier hs-type">ListPat</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="../../base-4.16.4.0/src/GHC-Maybe.html#Just"><span class="hs-identifier hs-type">Just</span></a></span><span> </span><span id="local-6989586621681387404"><span class="annot"><span class="annottext">SyntaxExprRn
</span><a href="#local-6989586621681387404"><span class="hs-identifier hs-var">e</span></a></span></span><span class="hs-special">)</span><span> </span><span id="local-6989586621681387403"><span class="annot"><span class="annottext">[LPat GhcRn]
</span><a href="#local-6989586621681387403"><span class="hs-identifier hs-var">pats</span></a></span></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-keyword">do</span><span>
</span><span id="line-499"></span><span>        </span><span class="hs-special">{</span><span> </span><span id="local-6989586621681387402"><span class="annot"><span class="annottext">TcType
</span><a href="#local-6989586621681387402"><span class="hs-identifier hs-var">tau_pat_ty</span></a></span></span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">ExpSigmaType -&gt; TcM TcType
</span><a href="GHC.Tc.Utils.TcMType.html#expTypeToType"><span class="hs-identifier hs-var">expTypeToType</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">forall a. Scaled a -&gt; a
</span><a href="GHC.Core.TyCo.Rep.html#scaledThing"><span class="hs-identifier hs-var">scaledThing</span></a></span><span> </span><span class="annot"><span class="annottext">Scaled ExpSigmaType
</span><a href="#local-6989586621681387507"><span class="hs-identifier hs-var">pat_ty</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-500"></span><span>        </span><span class="hs-special">;</span><span> </span><span class="hs-special">(</span><span class="hs-special">(</span><span id="local-6989586621681387401"><span class="annot"><span class="annottext">[GenLocated (SrcSpanAnn' (EpAnn AnnListItem)) (Pat GhcTc)]
</span><a href="#local-6989586621681387401"><span class="hs-identifier hs-var">pats'</span></a></span></span><span class="hs-special">,</span><span> </span><span id="local-6989586621681387400"><span class="annot"><span class="annottext">r
</span><a href="#local-6989586621681387400"><span class="hs-identifier hs-var">res</span></a></span></span><span class="hs-special">,</span><span> </span><span id="local-6989586621681387399"><span class="annot"><span class="annottext">TcType
</span><a href="#local-6989586621681387399"><span class="hs-identifier hs-var">elt_ty</span></a></span></span><span class="hs-special">)</span><span class="hs-special">,</span><span> </span><span id="local-6989586621681387398"><span class="annot"><span class="annottext">SyntaxExprTc
</span><a href="#local-6989586621681387398"><span class="hs-identifier hs-var">e'</span></a></span></span><span class="hs-special">)</span><span>
</span><span id="line-501"></span><span>            </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">forall a.
CtOrigin
-&gt; SyntaxExprRn
-&gt; [SyntaxOpType]
-&gt; SyntaxOpType
-&gt; ([TcType] -&gt; [TcType] -&gt; TcM a)
-&gt; TcM (a, SyntaxExprTc)
</span><a href="GHC.Tc.Gen.Expr.html#tcSyntaxOpGen"><span class="hs-identifier hs-var">tcSyntaxOpGen</span></a></span><span> </span><span class="annot"><span class="annottext">CtOrigin
</span><a href="GHC.Tc.Types.Origin.html#ListOrigin"><span class="hs-identifier hs-var">ListOrigin</span></a></span><span> </span><span class="annot"><span class="annottext">SyntaxExprRn
</span><a href="#local-6989586621681387404"><span class="hs-identifier hs-var">e</span></a></span><span> </span><span class="hs-special">[</span><span class="annot"><span class="annottext">ExpSigmaType -&gt; SyntaxOpType
</span><a href="GHC.Tc.Utils.TcType.html#SynType"><span class="hs-identifier hs-var">SynType</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">TcType -&gt; ExpSigmaType
</span><a href="GHC.Tc.Utils.TcType.html#mkCheckExpType"><span class="hs-identifier hs-var">mkCheckExpType</span></a></span><span> </span><span class="annot"><span class="annottext">TcType
</span><a href="#local-6989586621681387402"><span class="hs-identifier hs-var">tau_pat_ty</span></a></span><span class="hs-special">)</span><span class="hs-special">]</span><span>
</span><span id="line-502"></span><span>                                          </span><span class="annot"><span class="annottext">SyntaxOpType
</span><a href="GHC.Tc.Utils.TcType.html#SynList"><span class="hs-identifier hs-var">SynList</span></a></span><span> </span><span class="annot"><span class="annottext">forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><a href="../../base-4.16.4.0/src/GHC-Base.html#%24"><span class="hs-operator hs-var">$</span></a></span><span>
</span><span id="line-503"></span><span>                 </span><span class="hs-glyph">\</span><span> </span><span class="hs-special">[</span><span id="local-6989586621681387394"><span class="annot"><span class="annottext">TcType
</span><a href="#local-6989586621681387394"><span class="hs-identifier hs-var">elt_ty</span></a></span></span><span class="hs-special">]</span><span> </span><span class="annot"><span class="annottext">[TcType]
</span><span class="hs-identifier">_</span></span><span> </span><span class="hs-glyph">-&gt;</span><span>
</span><span id="line-504"></span><span>                 </span><span class="hs-keyword">do</span><span> </span><span class="hs-special">{</span><span> </span><span class="hs-special">(</span><span id="local-6989586621681387393"><span class="annot"><span class="annottext">[GenLocated (SrcSpanAnn' (EpAnn AnnListItem)) (Pat GhcTc)]
</span><a href="#local-6989586621681387393"><span class="hs-identifier hs-var">pats'</span></a></span></span><span class="hs-special">,</span><span> </span><span id="local-6989586621681387392"><span class="annot"><span class="annottext">r
</span><a href="#local-6989586621681387392"><span class="hs-identifier hs-var">res</span></a></span></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">forall inp out. Checker inp out -&gt; Checker [inp] [out]
</span><a href="GHC.Tc.Gen.Pat.html#tcMultiple"><span class="hs-identifier hs-var">tcMultiple</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Scaled ExpSigmaType -&gt; Checker (LPat GhcRn) (LPat GhcTc)
</span><a href="GHC.Tc.Gen.Pat.html#tc_lpat"><span class="hs-identifier hs-var">tc_lpat</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Scaled ExpSigmaType
</span><a href="#local-6989586621681387507"><span class="hs-identifier hs-var">pat_ty</span></a></span><span> </span><span class="annot"><span class="annottext">forall a b. Scaled a -&gt; b -&gt; Scaled b
</span><a href="GHC.Core.Type.html#scaledSet"><span class="hs-operator hs-var">`scaledSet`</span></a></span><span> </span><span class="annot"><span class="annottext">TcType -&gt; ExpSigmaType
</span><a href="GHC.Tc.Utils.TcType.html#mkCheckExpType"><span class="hs-identifier hs-var">mkCheckExpType</span></a></span><span> </span><span class="annot"><span class="annottext">TcType
</span><a href="#local-6989586621681387394"><span class="hs-identifier hs-var">elt_ty</span></a></span><span class="hs-special">)</span><span class="hs-special">)</span><span>
</span><span id="line-505"></span><span>                                                 </span><span class="annot"><span class="annottext">PatEnv
</span><a href="#local-6989586621681387506"><span class="hs-identifier hs-var">penv</span></a></span><span> </span><span class="annot"><span class="annottext">[LPat GhcRn]
</span><a href="#local-6989586621681387403"><span class="hs-identifier hs-var">pats</span></a></span><span> </span><span class="annot"><span class="annottext">TcM r
</span><a href="#local-6989586621681387504"><span class="hs-identifier hs-var">thing_inside</span></a></span><span>
</span><span id="line-506"></span><span>                    </span><span class="hs-special">;</span><span> </span><span class="annot"><span class="annottext">forall (m :: * -&gt; *) a. Monad m =&gt; a -&gt; m a
</span><a href="../../base-4.16.4.0/src/GHC-Base.html#return"><span class="hs-identifier hs-var">return</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">[GenLocated (SrcSpanAnn' (EpAnn AnnListItem)) (Pat GhcTc)]
</span><a href="#local-6989586621681387393"><span class="hs-identifier hs-var">pats'</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">r
</span><a href="#local-6989586621681387392"><span class="hs-identifier hs-var">res</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">TcType
</span><a href="#local-6989586621681387394"><span class="hs-identifier hs-var">elt_ty</span></a></span><span class="hs-special">)</span><span> </span><span class="hs-special">}</span><span>
</span><span id="line-507"></span><span>        </span><span class="hs-special">;</span><span> </span><span class="annot"><span class="annottext">forall (m :: * -&gt; *) a. Monad m =&gt; a -&gt; m a
</span><a href="../../base-4.16.4.0/src/GHC-Base.html#return"><span class="hs-identifier hs-var">return</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">forall p. XListPat p -&gt; [LPat p] -&gt; Pat p
</span><a href="Language.Haskell.Syntax.Pat.html#ListPat"><span class="hs-identifier hs-var">ListPat</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">TcType -&gt; Maybe (TcType, SyntaxExpr GhcTc) -&gt; ListPatTc
</span><a href="GHC.Hs.Pat.html#ListPatTc"><span class="hs-identifier hs-var">ListPatTc</span></a></span><span> </span><span class="annot"><span class="annottext">TcType
</span><a href="#local-6989586621681387399"><span class="hs-identifier hs-var">elt_ty</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">forall a. a -&gt; Maybe a
</span><a href="../../base-4.16.4.0/src/GHC-Maybe.html#Just"><span class="hs-identifier hs-var">Just</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">TcType
</span><a href="#local-6989586621681387402"><span class="hs-identifier hs-var">tau_pat_ty</span></a></span><span class="hs-special">,</span><span class="annot"><span class="annottext">SyntaxExprTc
</span><a href="#local-6989586621681387398"><span class="hs-identifier hs-var">e'</span></a></span><span class="hs-special">)</span><span class="hs-special">)</span><span class="hs-special">)</span><span> </span><span class="annot"><span class="annottext">[GenLocated (SrcSpanAnn' (EpAnn AnnListItem)) (Pat GhcTc)]
</span><a href="#local-6989586621681387401"><span class="hs-identifier hs-var">pats'</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">r
</span><a href="#local-6989586621681387400"><span class="hs-identifier hs-var">res</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-508"></span><span class="hs-special">}</span><span>
</span><span id="line-509"></span><span>
</span><span id="line-510"></span><span>  </span><span class="annot"><a href="Language.Haskell.Syntax.Pat.html#TuplePat"><span class="hs-identifier hs-type">TuplePat</span></a></span><span> </span><span class="annot"><span class="annottext">XTuplePat GhcRn
</span><span class="hs-identifier">_</span></span><span> </span><span id="local-6989586621681387390"><span class="annot"><span class="annottext">[LPat GhcRn]
</span><a href="#local-6989586621681387390"><span class="hs-identifier hs-var">pats</span></a></span></span><span> </span><span id="local-6989586621681387389"><span class="annot"><span class="annottext">Boxity
</span><a href="#local-6989586621681387389"><span class="hs-identifier hs-var">boxity</span></a></span></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-keyword">do</span><span>
</span><span id="line-511"></span><span>        </span><span class="hs-special">{</span><span> </span><span class="hs-keyword">let</span><span> </span><span id="local-6989586621681387388"><span class="annot"><span class="annottext">arity :: Int
</span><a href="#local-6989586621681387388"><span class="hs-identifier hs-var hs-var">arity</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">forall (t :: * -&gt; *) a. Foldable t =&gt; t a -&gt; Int
</span><a href="../../base-4.16.4.0/src/Data-Foldable.html#length"><span class="hs-identifier hs-var">length</span></a></span><span> </span><span class="annot"><span class="annottext">[LPat GhcRn]
</span><a href="#local-6989586621681387390"><span class="hs-identifier hs-var">pats</span></a></span><span>
</span><span id="line-512"></span><span>              </span><span id="local-6989586621681387386"><span class="annot"><span class="annottext">tc :: TyCon
</span><a href="#local-6989586621681387386"><span class="hs-identifier hs-var hs-var">tc</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">Boxity -&gt; Int -&gt; TyCon
</span><a href="GHC.Builtin.Types.html#tupleTyCon"><span class="hs-identifier hs-var">tupleTyCon</span></a></span><span> </span><span class="annot"><span class="annottext">Boxity
</span><a href="#local-6989586621681387389"><span class="hs-identifier hs-var">boxity</span></a></span><span> </span><span class="annot"><span class="annottext">Int
</span><a href="#local-6989586621681387388"><span class="hs-identifier hs-var">arity</span></a></span><span>
</span><span id="line-513"></span><span>              </span><span class="hs-comment">-- NB: tupleTyCon does not flatten 1-tuples</span><span>
</span><span id="line-514"></span><span>              </span><span class="hs-comment">-- See Note [Don't flatten tuples from HsSyn] in GHC.Core.Make</span><span>
</span><span id="line-515"></span><span>        </span><span class="hs-special">;</span><span> </span><span class="annot"><span class="annottext">Int -&gt; TcRn ()
</span><a href="GHC.Rename.Utils.html#checkTupSize"><span class="hs-identifier hs-var">checkTupSize</span></a></span><span> </span><span class="annot"><span class="annottext">Int
</span><a href="#local-6989586621681387388"><span class="hs-identifier hs-var">arity</span></a></span><span>
</span><span id="line-516"></span><span>        </span><span class="hs-special">;</span><span> </span><span class="hs-special">(</span><span id="local-6989586621681387383"><span class="annot"><span class="annottext">HsWrapper
</span><a href="#local-6989586621681387383"><span class="hs-identifier hs-var">coi</span></a></span></span><span class="hs-special">,</span><span> </span><span id="local-6989586621681387382"><span class="annot"><span class="annottext">[TcType]
</span><a href="#local-6989586621681387382"><span class="hs-identifier hs-var">arg_tys</span></a></span></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">forall a.
(TcType -&gt; TcM (TcCoercionN, a))
-&gt; PatEnv -&gt; ExpSigmaType -&gt; TcM (HsWrapper, a)
</span><a href="GHC.Tc.Gen.Pat.html#matchExpectedPatTy"><span class="hs-identifier hs-var">matchExpectedPatTy</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">TyCon -&gt; TcType -&gt; TcM (TcCoercionN, [TcType])
</span><a href="GHC.Tc.Utils.Unify.html#matchExpectedTyConApp"><span class="hs-identifier hs-var">matchExpectedTyConApp</span></a></span><span> </span><span class="annot"><span class="annottext">TyCon
</span><a href="#local-6989586621681387386"><span class="hs-identifier hs-var">tc</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-517"></span><span>                                               </span><span class="annot"><span class="annottext">PatEnv
</span><a href="#local-6989586621681387506"><span class="hs-identifier hs-var">penv</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">forall a. Scaled a -&gt; a
</span><a href="GHC.Core.TyCo.Rep.html#scaledThing"><span class="hs-identifier hs-var">scaledThing</span></a></span><span> </span><span class="annot"><span class="annottext">Scaled ExpSigmaType
</span><a href="#local-6989586621681387507"><span class="hs-identifier hs-var">pat_ty</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-518"></span><span>                     </span><span class="hs-comment">-- Unboxed tuples have RuntimeRep vars, which we discard:</span><span>
</span><span id="line-519"></span><span>                     </span><span class="hs-comment">-- See Note [Unboxed tuple RuntimeRep vars] in GHC.Core.TyCon</span><span>
</span><span id="line-520"></span><span>        </span><span class="hs-special">;</span><span> </span><span class="hs-keyword">let</span><span> </span><span id="local-6989586621681387380"><span class="annot"><span class="annottext">con_arg_tys :: [TcType]
</span><a href="#local-6989586621681387380"><span class="hs-identifier hs-var hs-var">con_arg_tys</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-keyword">case</span><span> </span><span class="annot"><span class="annottext">Boxity
</span><a href="#local-6989586621681387389"><span class="hs-identifier hs-var">boxity</span></a></span><span> </span><span class="hs-keyword">of</span><span> </span><span class="annot"><span class="annottext">Boxity
</span><a href="GHC.Types.Basic.html#Unboxed"><span class="hs-identifier hs-var">Unboxed</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="annottext">forall a. Int -&gt; [a] -&gt; [a]
</span><a href="../../base-4.16.4.0/src/GHC-List.html#drop"><span class="hs-identifier hs-var">drop</span></a></span><span> </span><span class="annot"><span class="annottext">Int
</span><a href="#local-6989586621681387388"><span class="hs-identifier hs-var">arity</span></a></span><span> </span><span class="annot"><span class="annottext">[TcType]
</span><a href="#local-6989586621681387382"><span class="hs-identifier hs-var">arg_tys</span></a></span><span>
</span><span id="line-521"></span><span>                                           </span><span class="annot"><span class="annottext">Boxity
</span><a href="GHC.Types.Basic.html#Boxed"><span class="hs-identifier hs-var">Boxed</span></a></span><span>   </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="annottext">[TcType]
</span><a href="#local-6989586621681387382"><span class="hs-identifier hs-var">arg_tys</span></a></span><span>
</span><span id="line-522"></span><span>        </span><span class="hs-special">;</span><span> </span><span class="hs-special">(</span><span id="local-6989586621681387376"><span class="annot"><span class="annottext">[GenLocated (SrcSpanAnn' (EpAnn AnnListItem)) (Pat GhcTc)]
</span><a href="#local-6989586621681387376"><span class="hs-identifier hs-var">pats'</span></a></span></span><span class="hs-special">,</span><span> </span><span id="local-6989586621681387375"><span class="annot"><span class="annottext">r
</span><a href="#local-6989586621681387375"><span class="hs-identifier hs-var">res</span></a></span></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">[Scaled ExpSigmaType] -&gt; Checker [LPat GhcRn] [LPat GhcTc]
</span><a href="GHC.Tc.Gen.Pat.html#tc_lpats"><span class="hs-identifier hs-var">tc_lpats</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">forall a b. (a -&gt; b) -&gt; [a] -&gt; [b]
</span><a href="../../base-4.16.4.0/src/GHC-Base.html#map"><span class="hs-identifier hs-var">map</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">forall a b. Scaled a -&gt; b -&gt; Scaled b
</span><a href="GHC.Core.Type.html#scaledSet"><span class="hs-identifier hs-var">scaledSet</span></a></span><span> </span><span class="annot"><span class="annottext">Scaled ExpSigmaType
</span><a href="#local-6989586621681387507"><span class="hs-identifier hs-var">pat_ty</span></a></span><span> </span><span class="annot"><span class="annottext">forall b c a. (b -&gt; c) -&gt; (a -&gt; b) -&gt; a -&gt; c
</span><a href="../../base-4.16.4.0/src/GHC-Base.html#."><span class="hs-operator hs-var">.</span></a></span><span> </span><span class="annot"><span class="annottext">TcType -&gt; ExpSigmaType
</span><a href="GHC.Tc.Utils.TcType.html#mkCheckExpType"><span class="hs-identifier hs-var">mkCheckExpType</span></a></span><span class="hs-special">)</span><span> </span><span class="annot"><span class="annottext">[TcType]
</span><a href="#local-6989586621681387380"><span class="hs-identifier hs-var">con_arg_tys</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-523"></span><span>                                   </span><span class="annot"><span class="annottext">PatEnv
</span><a href="#local-6989586621681387506"><span class="hs-identifier hs-var">penv</span></a></span><span> </span><span class="annot"><span class="annottext">[LPat GhcRn]
</span><a href="#local-6989586621681387390"><span class="hs-identifier hs-var">pats</span></a></span><span> </span><span class="annot"><span class="annottext">TcM r
</span><a href="#local-6989586621681387504"><span class="hs-identifier hs-var">thing_inside</span></a></span><span>
</span><span id="line-524"></span><span>
</span><span id="line-525"></span><span>        </span><span class="hs-special">;</span><span> </span><span id="local-6989586621681387373"><span class="annot"><span class="annottext">DynFlags
</span><a href="#local-6989586621681387373"><span class="hs-identifier hs-var">dflags</span></a></span></span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">forall (m :: * -&gt; *). HasDynFlags m =&gt; m DynFlags
</span><a href="GHC.Driver.Session.html#getDynFlags"><span class="hs-identifier hs-var">getDynFlags</span></a></span><span>
</span><span id="line-526"></span><span>
</span><span id="line-527"></span><span>        </span><span class="hs-comment">-- Under flag control turn a pattern (x,y,z) into ~(x,y,z)</span><span>
</span><span id="line-528"></span><span>        </span><span class="hs-comment">-- so that we can experiment with lazy tuple-matching.</span><span>
</span><span id="line-529"></span><span>        </span><span class="hs-comment">-- This is a pretty odd place to make the switch, but</span><span>
</span><span id="line-530"></span><span>        </span><span class="hs-comment">-- it was easy to do.</span><span>
</span><span id="line-531"></span><span>        </span><span class="hs-special">;</span><span> </span><span class="hs-keyword">let</span><span>
</span><span id="line-532"></span><span>              </span><span id="local-6989586621681387371"><span class="annot"><span class="annottext">unmangled_result :: Pat GhcTc
</span><a href="#local-6989586621681387371"><span class="hs-identifier hs-var hs-var">unmangled_result</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">forall p. XTuplePat p -&gt; [LPat p] -&gt; Boxity -&gt; Pat p
</span><a href="Language.Haskell.Syntax.Pat.html#TuplePat"><span class="hs-identifier hs-var">TuplePat</span></a></span><span> </span><span class="annot"><span class="annottext">[TcType]
</span><a href="#local-6989586621681387380"><span class="hs-identifier hs-var">con_arg_tys</span></a></span><span> </span><span class="annot"><span class="annottext">[GenLocated (SrcSpanAnn' (EpAnn AnnListItem)) (Pat GhcTc)]
</span><a href="#local-6989586621681387376"><span class="hs-identifier hs-var">pats'</span></a></span><span> </span><span class="annot"><span class="annottext">Boxity
</span><a href="#local-6989586621681387389"><span class="hs-identifier hs-var">boxity</span></a></span><span>
</span><span id="line-533"></span><span>                                 </span><span class="hs-comment">-- pat_ty /= pat_ty iff coi /= IdCo</span><span>
</span><span id="line-534"></span><span>              </span><span id="local-6989586621681387370"><span class="annot"><span class="annottext">possibly_mangled_result :: Pat GhcTc
</span><a href="#local-6989586621681387370"><span class="hs-identifier hs-var hs-var">possibly_mangled_result</span></a></span></span><span>
</span><span id="line-535"></span><span>                </span><span class="hs-glyph">|</span><span> </span><span class="annot"><span class="annottext">GeneralFlag -&gt; DynFlags -&gt; Bool
</span><a href="GHC.Driver.Session.html#gopt"><span class="hs-identifier hs-var">gopt</span></a></span><span> </span><span class="annot"><span class="annottext">GeneralFlag
</span><a href="GHC.Driver.Flags.html#Opt_IrrefutableTuples"><span class="hs-identifier hs-var">Opt_IrrefutableTuples</span></a></span><span> </span><span class="annot"><span class="annottext">DynFlags
</span><a href="#local-6989586621681387373"><span class="hs-identifier hs-var">dflags</span></a></span><span> </span><span class="annot"><span class="annottext">Bool -&gt; Bool -&gt; Bool
</span><span class="hs-operator hs-var">&amp;&amp;</span></span><span>
</span><span id="line-536"></span><span>                  </span><span class="annot"><span class="annottext">Boxity -&gt; Bool
</span><a href="GHC.Types.Basic.html#isBoxed"><span class="hs-identifier hs-var">isBoxed</span></a></span><span> </span><span class="annot"><span class="annottext">Boxity
</span><a href="#local-6989586621681387389"><span class="hs-identifier hs-var">boxity</span></a></span><span>   </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">forall p. XLazyPat p -&gt; LPat p -&gt; Pat p
</span><a href="Language.Haskell.Syntax.Pat.html#LazyPat"><span class="hs-identifier hs-var">LazyPat</span></a></span><span> </span><span class="annot"><span class="annottext">NoExtField
</span><a href="Language.Haskell.Syntax.Extension.html#noExtField"><span class="hs-identifier hs-var">noExtField</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">forall a an. a -&gt; LocatedAn an a
</span><a href="GHC.Parser.Annotation.html#noLocA"><span class="hs-identifier hs-var">noLocA</span></a></span><span> </span><span class="annot"><span class="annottext">Pat GhcTc
</span><a href="#local-6989586621681387371"><span class="hs-identifier hs-var">unmangled_result</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-537"></span><span>                </span><span class="hs-glyph">|</span><span> </span><span class="annot"><span class="annottext">Bool
</span><a href="../../base-4.16.4.0/src/GHC-Base.html#otherwise"><span class="hs-identifier hs-var">otherwise</span></a></span><span>        </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">Pat GhcTc
</span><a href="#local-6989586621681387371"><span class="hs-identifier hs-var">unmangled_result</span></a></span><span>
</span><span id="line-538"></span><span>
</span><span id="line-539"></span><span>        </span><span class="hs-special">;</span><span> </span><span id="local-6989586621681387364"><span class="annot"><span class="annottext">TcType
</span><a href="#local-6989586621681387364"><span class="hs-identifier hs-var">pat_ty</span></a></span></span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">ExpSigmaType -&gt; TcM TcType
</span><a href="GHC.Tc.Utils.TcMType.html#readExpType"><span class="hs-identifier hs-var">readExpType</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">forall a. Scaled a -&gt; a
</span><a href="GHC.Core.TyCo.Rep.html#scaledThing"><span class="hs-identifier hs-var">scaledThing</span></a></span><span> </span><span class="annot"><span class="annottext">Scaled ExpSigmaType
</span><a href="#local-6989586621681387507"><span class="hs-identifier hs-var">pat_ty</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-540"></span><span>        </span><span class="hs-special">;</span><span> </span><span class="hs-identifier">ASSERT</span><span class="hs-special">(</span><span> </span><span class="hs-identifier">con_arg_tys</span><span> </span><span class="hs-special">`</span><span class="hs-identifier">equalLength</span><span class="hs-special">`</span><span> </span><span class="hs-identifier">pats</span><span> </span><span class="hs-special">)</span><span> </span><span class="hs-comment">-- Syntactically enforced</span><span>
</span><span id="line-541"></span><span>          </span><span class="annot"><span class="annottext">forall (m :: * -&gt; *) a. Monad m =&gt; a -&gt; m a
</span><a href="../../base-4.16.4.0/src/GHC-Base.html#return"><span class="hs-identifier hs-var">return</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">HsWrapper -&gt; Pat GhcTc -&gt; TcType -&gt; Pat GhcTc
</span><a href="GHC.Hs.Utils.html#mkHsWrapPat"><span class="hs-identifier hs-var">mkHsWrapPat</span></a></span><span> </span><span class="annot"><span class="annottext">HsWrapper
</span><a href="#local-6989586621681387383"><span class="hs-identifier hs-var">coi</span></a></span><span> </span><span class="annot"><span class="annottext">Pat GhcTc
</span><a href="#local-6989586621681387370"><span class="hs-identifier hs-var">possibly_mangled_result</span></a></span><span> </span><span class="annot"><span class="annottext">TcType
</span><a href="#local-6989586621681387364"><span class="hs-identifier hs-var">pat_ty</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">r
</span><a href="#local-6989586621681387375"><span class="hs-identifier hs-var">res</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-542"></span><span>        </span><span class="hs-special">}</span><span>
</span><span id="line-543"></span><span>
</span><span id="line-544"></span><span>  </span><span class="annot"><a href="Language.Haskell.Syntax.Pat.html#SumPat"><span class="hs-identifier hs-type">SumPat</span></a></span><span> </span><span class="annot"><span class="annottext">XSumPat GhcRn
</span><span class="hs-identifier">_</span></span><span> </span><span id="local-6989586621681387362"><span class="annot"><span class="annottext">LPat GhcRn
</span><a href="#local-6989586621681387362"><span class="hs-identifier hs-var">pat</span></a></span></span><span> </span><span id="local-6989586621681387361"><span class="annot"><span class="annottext">Int
</span><a href="#local-6989586621681387361"><span class="hs-identifier hs-var">alt</span></a></span></span><span> </span><span id="local-6989586621681387360"><span class="annot"><span class="annottext">Int
</span><a href="#local-6989586621681387360"><span class="hs-identifier hs-var">arity</span></a></span></span><span>  </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-keyword">do</span><span>
</span><span id="line-545"></span><span>        </span><span class="hs-special">{</span><span> </span><span class="hs-keyword">let</span><span> </span><span id="local-6989586621681387359"><span class="annot"><span class="annottext">tc :: TyCon
</span><a href="#local-6989586621681387359"><span class="hs-identifier hs-var hs-var">tc</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">Int -&gt; TyCon
</span><a href="GHC.Builtin.Types.html#sumTyCon"><span class="hs-identifier hs-var">sumTyCon</span></a></span><span> </span><span class="annot"><span class="annottext">Int
</span><a href="#local-6989586621681387360"><span class="hs-identifier hs-var">arity</span></a></span><span>
</span><span id="line-546"></span><span>        </span><span class="hs-special">;</span><span> </span><span class="hs-special">(</span><span id="local-6989586621681387357"><span class="annot"><span class="annottext">HsWrapper
</span><a href="#local-6989586621681387357"><span class="hs-identifier hs-var">coi</span></a></span></span><span class="hs-special">,</span><span> </span><span id="local-6989586621681387356"><span class="annot"><span class="annottext">[TcType]
</span><a href="#local-6989586621681387356"><span class="hs-identifier hs-var">arg_tys</span></a></span></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">forall a.
(TcType -&gt; TcM (TcCoercionN, a))
-&gt; PatEnv -&gt; ExpSigmaType -&gt; TcM (HsWrapper, a)
</span><a href="GHC.Tc.Gen.Pat.html#matchExpectedPatTy"><span class="hs-identifier hs-var">matchExpectedPatTy</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">TyCon -&gt; TcType -&gt; TcM (TcCoercionN, [TcType])
</span><a href="GHC.Tc.Utils.Unify.html#matchExpectedTyConApp"><span class="hs-identifier hs-var">matchExpectedTyConApp</span></a></span><span> </span><span class="annot"><span class="annottext">TyCon
</span><a href="#local-6989586621681387359"><span class="hs-identifier hs-var">tc</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-547"></span><span>                                               </span><span class="annot"><span class="annottext">PatEnv
</span><a href="#local-6989586621681387506"><span class="hs-identifier hs-var">penv</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">forall a. Scaled a -&gt; a
</span><a href="GHC.Core.TyCo.Rep.html#scaledThing"><span class="hs-identifier hs-var">scaledThing</span></a></span><span> </span><span class="annot"><span class="annottext">Scaled ExpSigmaType
</span><a href="#local-6989586621681387507"><span class="hs-identifier hs-var">pat_ty</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-548"></span><span>        </span><span class="hs-special">;</span><span> </span><span class="hs-comment">-- Drop levity vars, we don't care about them here</span><span>
</span><span id="line-549"></span><span>          </span><span class="hs-keyword">let</span><span> </span><span id="local-6989586621681387355"><span class="annot"><span class="annottext">con_arg_tys :: [TcType]
</span><a href="#local-6989586621681387355"><span class="hs-identifier hs-var hs-var">con_arg_tys</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">forall a. Int -&gt; [a] -&gt; [a]
</span><a href="../../base-4.16.4.0/src/GHC-List.html#drop"><span class="hs-identifier hs-var">drop</span></a></span><span> </span><span class="annot"><span class="annottext">Int
</span><a href="#local-6989586621681387360"><span class="hs-identifier hs-var">arity</span></a></span><span> </span><span class="annot"><span class="annottext">[TcType]
</span><a href="#local-6989586621681387356"><span class="hs-identifier hs-var">arg_tys</span></a></span><span>
</span><span id="line-550"></span><span>        </span><span class="hs-special">;</span><span> </span><span class="hs-special">(</span><span id="local-6989586621681387354"><span class="annot"><span class="annottext">GenLocated (SrcSpanAnn' (EpAnn AnnListItem)) (Pat GhcTc)
</span><a href="#local-6989586621681387354"><span class="hs-identifier hs-var">pat'</span></a></span></span><span class="hs-special">,</span><span> </span><span id="local-6989586621681387353"><span class="annot"><span class="annottext">r
</span><a href="#local-6989586621681387353"><span class="hs-identifier hs-var">res</span></a></span></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">Scaled ExpSigmaType -&gt; Checker (LPat GhcRn) (LPat GhcTc)
</span><a href="GHC.Tc.Gen.Pat.html#tc_lpat"><span class="hs-identifier hs-var">tc_lpat</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Scaled ExpSigmaType
</span><a href="#local-6989586621681387507"><span class="hs-identifier hs-var">pat_ty</span></a></span><span> </span><span class="annot"><span class="annottext">forall a b. Scaled a -&gt; b -&gt; Scaled b
</span><a href="GHC.Core.Type.html#scaledSet"><span class="hs-operator hs-var">`scaledSet`</span></a></span><span> </span><span class="annot"><span class="annottext">TcType -&gt; ExpSigmaType
</span><a href="GHC.Tc.Utils.TcType.html#mkCheckExpType"><span class="hs-identifier hs-var">mkCheckExpType</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">[TcType]
</span><a href="#local-6989586621681387355"><span class="hs-identifier hs-var">con_arg_tys</span></a></span><span> </span><span class="annot"><span class="annottext">forall a. Outputable a =&gt; [a] -&gt; Int -&gt; a
</span><a href="GHC.Data.List.SetOps.html#getNth"><span class="hs-operator hs-var">`getNth`</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Int
</span><a href="#local-6989586621681387361"><span class="hs-identifier hs-var">alt</span></a></span><span> </span><span class="annot"><span class="annottext">forall a. Num a =&gt; a -&gt; a -&gt; a
</span><a href="../../base-4.16.4.0/src/GHC-Num.html#-"><span class="hs-glyph hs-var">-</span></a></span><span> </span><span class="annot"><span class="annottext">Int
</span><span class="hs-number">1</span></span><span class="hs-special">)</span><span class="hs-special">)</span><span class="hs-special">)</span><span>
</span><span id="line-551"></span><span>                                 </span><span class="annot"><span class="annottext">PatEnv
</span><a href="#local-6989586621681387506"><span class="hs-identifier hs-var">penv</span></a></span><span> </span><span class="annot"><span class="annottext">LPat GhcRn
</span><a href="#local-6989586621681387362"><span class="hs-identifier hs-var">pat</span></a></span><span> </span><span class="annot"><span class="annottext">TcM r
</span><a href="#local-6989586621681387504"><span class="hs-identifier hs-var">thing_inside</span></a></span><span>
</span><span id="line-552"></span><span>        </span><span class="hs-special">;</span><span> </span><span id="local-6989586621681387352"><span class="annot"><span class="annottext">TcType
</span><a href="#local-6989586621681387352"><span class="hs-identifier hs-var">pat_ty</span></a></span></span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">ExpSigmaType -&gt; TcM TcType
</span><a href="GHC.Tc.Utils.TcMType.html#readExpType"><span class="hs-identifier hs-var">readExpType</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">forall a. Scaled a -&gt; a
</span><a href="GHC.Core.TyCo.Rep.html#scaledThing"><span class="hs-identifier hs-var">scaledThing</span></a></span><span> </span><span class="annot"><span class="annottext">Scaled ExpSigmaType
</span><a href="#local-6989586621681387507"><span class="hs-identifier hs-var">pat_ty</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-553"></span><span>        </span><span class="hs-special">;</span><span> </span><span class="annot"><span class="annottext">forall (m :: * -&gt; *) a. Monad m =&gt; a -&gt; m a
</span><a href="../../base-4.16.4.0/src/GHC-Base.html#return"><span class="hs-identifier hs-var">return</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">HsWrapper -&gt; Pat GhcTc -&gt; TcType -&gt; Pat GhcTc
</span><a href="GHC.Hs.Utils.html#mkHsWrapPat"><span class="hs-identifier hs-var">mkHsWrapPat</span></a></span><span> </span><span class="annot"><span class="annottext">HsWrapper
</span><a href="#local-6989586621681387357"><span class="hs-identifier hs-var">coi</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">forall p. XSumPat p -&gt; LPat p -&gt; Int -&gt; Int -&gt; Pat p
</span><a href="Language.Haskell.Syntax.Pat.html#SumPat"><span class="hs-identifier hs-var">SumPat</span></a></span><span> </span><span class="annot"><span class="annottext">[TcType]
</span><a href="#local-6989586621681387355"><span class="hs-identifier hs-var">con_arg_tys</span></a></span><span> </span><span class="annot"><span class="annottext">GenLocated (SrcSpanAnn' (EpAnn AnnListItem)) (Pat GhcTc)
</span><a href="#local-6989586621681387354"><span class="hs-identifier hs-var">pat'</span></a></span><span> </span><span class="annot"><span class="annottext">Int
</span><a href="#local-6989586621681387361"><span class="hs-identifier hs-var">alt</span></a></span><span> </span><span class="annot"><span class="annottext">Int
</span><a href="#local-6989586621681387360"><span class="hs-identifier hs-var">arity</span></a></span><span class="hs-special">)</span><span> </span><span class="annot"><span class="annottext">TcType
</span><a href="#local-6989586621681387352"><span class="hs-identifier hs-var">pat_ty</span></a></span><span>
</span><span id="line-554"></span><span>                 </span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">r
</span><a href="#local-6989586621681387353"><span class="hs-identifier hs-var">res</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-555"></span><span>        </span><span class="hs-special">}</span><span>
</span><span id="line-556"></span><span>
</span><span id="line-557"></span><span class="hs-comment">------------------------</span><span>
</span><span id="line-558"></span><span class="hs-comment">-- Data constructors</span><span>
</span><span id="line-559"></span><span>  </span><span class="annot"><a href="Language.Haskell.Syntax.Pat.html#ConPat"><span class="hs-identifier hs-type">ConPat</span></a></span><span> </span><span class="annot"><span class="annottext">XConPat GhcRn
</span><span class="hs-identifier">_</span></span><span> </span><span id="local-6989586621681387350"><span class="annot"><span class="annottext">XRec GhcRn (ConLikeP GhcRn)
</span><a href="#local-6989586621681387350"><span class="hs-identifier hs-var">con</span></a></span></span><span> </span><span id="local-6989586621681387349"><span class="annot"><span class="annottext">HsConPatDetails GhcRn
</span><a href="#local-6989586621681387349"><span class="hs-identifier hs-var">arg_pats</span></a></span></span><span> </span><span class="hs-glyph">-&gt;</span><span>
</span><span id="line-560"></span><span>    </span><span class="annot"><span class="annottext">forall a.
PatEnv
-&gt; GenLocated SrcSpanAnnN Name
-&gt; Scaled ExpSigmaType
-&gt; HsConPatDetails GhcRn
-&gt; TcM a
-&gt; TcM (Pat GhcTc, a)
</span><a href="GHC.Tc.Gen.Pat.html#tcConPat"><span class="hs-identifier hs-var">tcConPat</span></a></span><span> </span><span class="annot"><span class="annottext">PatEnv
</span><a href="#local-6989586621681387506"><span class="hs-identifier hs-var">penv</span></a></span><span> </span><span class="annot"><span class="annottext">XRec GhcRn (ConLikeP GhcRn)
</span><a href="#local-6989586621681387350"><span class="hs-identifier hs-var">con</span></a></span><span> </span><span class="annot"><span class="annottext">Scaled ExpSigmaType
</span><a href="#local-6989586621681387507"><span class="hs-identifier hs-var">pat_ty</span></a></span><span> </span><span class="annot"><span class="annottext">HsConPatDetails GhcRn
</span><a href="#local-6989586621681387349"><span class="hs-identifier hs-var">arg_pats</span></a></span><span> </span><span class="annot"><span class="annottext">TcM r
</span><a href="#local-6989586621681387504"><span class="hs-identifier hs-var">thing_inside</span></a></span><span>
</span><span id="line-561"></span><span>
</span><span id="line-562"></span><span class="hs-comment">------------------------</span><span>
</span><span id="line-563"></span><span class="hs-comment">-- Literal patterns</span><span>
</span><span id="line-564"></span><span>  </span><span class="annot"><a href="Language.Haskell.Syntax.Pat.html#LitPat"><span class="hs-identifier hs-type">LitPat</span></a></span><span> </span><span id="local-6989586621681387346"><span class="annot"><span class="annottext">XLitPat GhcRn
</span><a href="#local-6989586621681387346"><span class="hs-identifier hs-var">x</span></a></span></span><span> </span><span id="local-6989586621681387345"><span class="annot"><span class="annottext">HsLit GhcRn
</span><a href="#local-6989586621681387345"><span class="hs-identifier hs-var">simple_lit</span></a></span></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-keyword">do</span><span>
</span><span id="line-565"></span><span>        </span><span class="hs-special">{</span><span> </span><span class="hs-keyword">let</span><span> </span><span id="local-6989586621681387344"><span class="annot"><span class="annottext">lit_ty :: TcType
</span><a href="#local-6989586621681387344"><span class="hs-identifier hs-var hs-var">lit_ty</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">forall (p :: Pass). HsLit (GhcPass p) -&gt; TcType
</span><a href="GHC.Tc.Utils.Zonk.html#hsLitType"><span class="hs-identifier hs-var">hsLitType</span></a></span><span> </span><span class="annot"><span class="annottext">HsLit GhcRn
</span><a href="#local-6989586621681387345"><span class="hs-identifier hs-var">simple_lit</span></a></span><span>
</span><span id="line-566"></span><span>        </span><span class="hs-special">;</span><span> </span><span id="local-6989586621681387342"><span class="annot"><span class="annottext">HsWrapper
</span><a href="#local-6989586621681387342"><span class="hs-identifier hs-var">wrap</span></a></span></span><span>   </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">PatEnv -&gt; ExpSigmaType -&gt; TcType -&gt; TcM HsWrapper
</span><a href="GHC.Tc.Gen.Pat.html#tc_sub_type"><span class="hs-identifier hs-var">tc_sub_type</span></a></span><span> </span><span class="annot"><span class="annottext">PatEnv
</span><a href="#local-6989586621681387506"><span class="hs-identifier hs-var">penv</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">forall a. Scaled a -&gt; a
</span><a href="GHC.Core.TyCo.Rep.html#scaledThing"><span class="hs-identifier hs-var">scaledThing</span></a></span><span> </span><span class="annot"><span class="annottext">Scaled ExpSigmaType
</span><a href="#local-6989586621681387507"><span class="hs-identifier hs-var">pat_ty</span></a></span><span class="hs-special">)</span><span> </span><span class="annot"><span class="annottext">TcType
</span><a href="#local-6989586621681387344"><span class="hs-identifier hs-var">lit_ty</span></a></span><span>
</span><span id="line-567"></span><span>        </span><span class="hs-special">;</span><span> </span><span id="local-6989586621681387341"><span class="annot"><span class="annottext">r
</span><a href="#local-6989586621681387341"><span class="hs-identifier hs-var">res</span></a></span></span><span>    </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">TcM r
</span><a href="#local-6989586621681387504"><span class="hs-identifier hs-var">thing_inside</span></a></span><span>
</span><span id="line-568"></span><span>        </span><span class="hs-special">;</span><span> </span><span id="local-6989586621681387340"><span class="annot"><span class="annottext">TcType
</span><a href="#local-6989586621681387340"><span class="hs-identifier hs-var">pat_ty</span></a></span></span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">ExpSigmaType -&gt; TcM TcType
</span><a href="GHC.Tc.Utils.TcMType.html#readExpType"><span class="hs-identifier hs-var">readExpType</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">forall a. Scaled a -&gt; a
</span><a href="GHC.Core.TyCo.Rep.html#scaledThing"><span class="hs-identifier hs-var">scaledThing</span></a></span><span> </span><span class="annot"><span class="annottext">Scaled ExpSigmaType
</span><a href="#local-6989586621681387507"><span class="hs-identifier hs-var">pat_ty</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-569"></span><span>        </span><span class="hs-special">;</span><span> </span><span class="annot"><span class="annottext">forall (m :: * -&gt; *) a. Monad m =&gt; a -&gt; m a
</span><a href="../../base-4.16.4.0/src/GHC-Base.html#return"><span class="hs-identifier hs-var">return</span></a></span><span> </span><span class="hs-special">(</span><span> </span><span class="annot"><span class="annottext">HsWrapper -&gt; Pat GhcTc -&gt; TcType -&gt; Pat GhcTc
</span><a href="GHC.Hs.Utils.html#mkHsWrapPat"><span class="hs-identifier hs-var">mkHsWrapPat</span></a></span><span> </span><span class="annot"><span class="annottext">HsWrapper
</span><a href="#local-6989586621681387342"><span class="hs-identifier hs-var">wrap</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">forall p. XLitPat p -&gt; HsLit p -&gt; Pat p
</span><a href="Language.Haskell.Syntax.Pat.html#LitPat"><span class="hs-identifier hs-var">LitPat</span></a></span><span> </span><span class="annot"><span class="annottext">XLitPat GhcRn
</span><a href="#local-6989586621681387346"><span class="hs-identifier hs-var">x</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">forall (p1 :: Pass) (p2 :: Pass).
HsLit (GhcPass p1) -&gt; HsLit (GhcPass p2)
</span><a href="GHC.Hs.Lit.html#convertLit"><span class="hs-identifier hs-var">convertLit</span></a></span><span> </span><span class="annot"><span class="annottext">HsLit GhcRn
</span><a href="#local-6989586621681387345"><span class="hs-identifier hs-var">simple_lit</span></a></span><span class="hs-special">)</span><span class="hs-special">)</span><span> </span><span class="annot"><span class="annottext">TcType
</span><a href="#local-6989586621681387340"><span class="hs-identifier hs-var">pat_ty</span></a></span><span>
</span><span id="line-570"></span><span>                 </span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">r
</span><a href="#local-6989586621681387341"><span class="hs-identifier hs-var">res</span></a></span><span class="hs-special">)</span><span> </span><span class="hs-special">}</span><span>
</span><span id="line-571"></span><span>
</span><span id="line-572"></span><span class="hs-comment">------------------------</span><span>
</span><span id="line-573"></span><span class="hs-comment">-- Overloaded patterns: n, and n+k</span><span>
</span><span id="line-574"></span><span>
</span><span id="line-575"></span><span class="hs-comment">-- In the case of a negative literal (the more complicated case),</span><span>
</span><span id="line-576"></span><span class="hs-comment">-- we get</span><span>
</span><span id="line-577"></span><span class="hs-comment">--</span><span>
</span><span id="line-578"></span><span class="hs-comment">--   case v of (-5) -&gt; blah</span><span>
</span><span id="line-579"></span><span class="hs-comment">--</span><span>
</span><span id="line-580"></span><span class="hs-comment">-- becoming</span><span>
</span><span id="line-581"></span><span class="hs-comment">--</span><span>
</span><span id="line-582"></span><span class="hs-comment">--   if v == (negate (fromInteger 5)) then blah else ...</span><span>
</span><span id="line-583"></span><span class="hs-comment">--</span><span>
</span><span id="line-584"></span><span class="hs-comment">-- There are two bits of rebindable syntax:</span><span>
</span><span id="line-585"></span><span class="hs-comment">--   (==)   :: pat_ty -&gt; neg_lit_ty -&gt; Bool</span><span>
</span><span id="line-586"></span><span class="hs-comment">--   negate :: lit_ty -&gt; neg_lit_ty</span><span>
</span><span id="line-587"></span><span class="hs-comment">-- where lit_ty is the type of the overloaded literal 5.</span><span>
</span><span id="line-588"></span><span class="hs-comment">--</span><span>
</span><span id="line-589"></span><span class="hs-comment">-- When there is no negation, neg_lit_ty and lit_ty are the same</span><span>
</span><span id="line-590"></span><span>  </span><span class="annot"><a href="Language.Haskell.Syntax.Pat.html#NPat"><span class="hs-identifier hs-type">NPat</span></a></span><span> </span><span class="annot"><span class="annottext">XNPat GhcRn
</span><span class="hs-identifier">_</span></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="GHC.Types.SrcLoc.html#L"><span class="hs-identifier hs-type">L</span></a></span><span> </span><span id="local-6989586621681387337"><span class="annot"><span class="annottext">SrcSpan
</span><a href="#local-6989586621681387337"><span class="hs-identifier hs-var">l</span></a></span></span><span> </span><span id="local-6989586621681387336"><span class="annot"><span class="annottext">HsOverLit GhcRn
</span><a href="#local-6989586621681387336"><span class="hs-identifier hs-var">over_lit</span></a></span></span><span class="hs-special">)</span><span> </span><span id="local-6989586621681387335"><span class="annot"><span class="annottext">Maybe (SyntaxExpr GhcRn)
</span><a href="#local-6989586621681387335"><span class="hs-identifier hs-var">mb_neg</span></a></span></span><span> </span><span id="local-6989586621681387334"><span class="annot"><span class="annottext">SyntaxExpr GhcRn
</span><a href="#local-6989586621681387334"><span class="hs-identifier hs-var">eq</span></a></span></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-keyword">do</span><span>
</span><span id="line-591"></span><span>        </span><span class="hs-special">{</span><span> </span><span id="local-6989586621681387333"><span class="annot"><span class="annottext">HsWrapper
</span><a href="#local-6989586621681387333"><span class="hs-identifier hs-var">mult_wrap</span></a></span></span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">forall a. Scaled a -&gt; TcM HsWrapper
</span><a href="GHC.Tc.Gen.Pat.html#checkManyPattern"><span class="hs-identifier hs-var">checkManyPattern</span></a></span><span> </span><span class="annot"><span class="annottext">Scaled ExpSigmaType
</span><a href="#local-6989586621681387507"><span class="hs-identifier hs-var">pat_ty</span></a></span><span>
</span><span id="line-592"></span><span>          </span><span class="hs-comment">-- See Note [Wrapper returned from tcSubMult] in GHC.Tc.Utils.Unify.</span><span>
</span><span id="line-593"></span><span>          </span><span class="hs-comment">--</span><span>
</span><span id="line-594"></span><span>          </span><span class="hs-comment">-- It may be possible to refine linear pattern so that they work in</span><span>
</span><span id="line-595"></span><span>          </span><span class="hs-comment">-- linear environments. But it is not clear how useful this is.</span><span>
</span><span id="line-596"></span><span>        </span><span class="hs-special">;</span><span> </span><span class="hs-keyword">let</span><span> </span><span id="local-6989586621681387332"><span class="annot"><span class="annottext">orig :: CtOrigin
</span><a href="#local-6989586621681387332"><span class="hs-identifier hs-var hs-var">orig</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">HsOverLit GhcRn -&gt; CtOrigin
</span><a href="GHC.Tc.Types.Origin.html#LiteralOrigin"><span class="hs-identifier hs-var">LiteralOrigin</span></a></span><span> </span><span class="annot"><span class="annottext">HsOverLit GhcRn
</span><a href="#local-6989586621681387336"><span class="hs-identifier hs-var">over_lit</span></a></span><span>
</span><span id="line-597"></span><span>        </span><span class="hs-special">;</span><span> </span><span class="hs-special">(</span><span class="hs-special">(</span><span id="local-6989586621681387330"><span class="annot"><span class="annottext">HsOverLit GhcTc
</span><a href="#local-6989586621681387330"><span class="hs-identifier hs-var">lit'</span></a></span></span><span class="hs-special">,</span><span> </span><span id="local-6989586621681387329"><span class="annot"><span class="annottext">Maybe SyntaxExprTc
</span><a href="#local-6989586621681387329"><span class="hs-identifier hs-var">mb_neg'</span></a></span></span><span class="hs-special">)</span><span class="hs-special">,</span><span> </span><span id="local-6989586621681387328"><span class="annot"><span class="annottext">SyntaxExprTc
</span><a href="#local-6989586621681387328"><span class="hs-identifier hs-var">eq'</span></a></span></span><span class="hs-special">)</span><span>
</span><span id="line-598"></span><span>            </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">forall a.
CtOrigin
-&gt; SyntaxExprRn
-&gt; [SyntaxOpType]
-&gt; ExpSigmaType
-&gt; ([TcType] -&gt; [TcType] -&gt; TcM a)
-&gt; TcM (a, SyntaxExprTc)
</span><a href="GHC.Tc.Gen.Expr.html#tcSyntaxOp"><span class="hs-identifier hs-var">tcSyntaxOp</span></a></span><span> </span><span class="annot"><span class="annottext">CtOrigin
</span><a href="#local-6989586621681387332"><span class="hs-identifier hs-var">orig</span></a></span><span> </span><span class="annot"><span class="annottext">SyntaxExpr GhcRn
</span><a href="#local-6989586621681387334"><span class="hs-identifier hs-var">eq</span></a></span><span> </span><span class="hs-special">[</span><span class="annot"><span class="annottext">ExpSigmaType -&gt; SyntaxOpType
</span><a href="GHC.Tc.Utils.TcType.html#SynType"><span class="hs-identifier hs-var">SynType</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">forall a. Scaled a -&gt; a
</span><a href="GHC.Core.TyCo.Rep.html#scaledThing"><span class="hs-identifier hs-var">scaledThing</span></a></span><span> </span><span class="annot"><span class="annottext">Scaled ExpSigmaType
</span><a href="#local-6989586621681387507"><span class="hs-identifier hs-var">pat_ty</span></a></span><span class="hs-special">)</span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">SyntaxOpType
</span><a href="GHC.Tc.Utils.TcType.html#SynAny"><span class="hs-identifier hs-var">SynAny</span></a></span><span class="hs-special">]</span><span>
</span><span id="line-599"></span><span>                          </span><span class="hs-special">(</span><span class="annot"><span class="annottext">TcType -&gt; ExpSigmaType
</span><a href="GHC.Tc.Utils.TcType.html#mkCheckExpType"><span class="hs-identifier hs-var">mkCheckExpType</span></a></span><span> </span><span class="annot"><span class="annottext">TcType
</span><a href="GHC.Builtin.Types.html#boolTy"><span class="hs-identifier hs-var">boolTy</span></a></span><span class="hs-special">)</span><span> </span><span class="annot"><span class="annottext">forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><a href="../../base-4.16.4.0/src/GHC-Base.html#%24"><span class="hs-operator hs-var">$</span></a></span><span>
</span><span id="line-600"></span><span>               </span><span class="hs-glyph">\</span><span> </span><span class="hs-special">[</span><span id="local-6989586621681387325"><span class="annot"><span class="annottext">TcType
</span><a href="#local-6989586621681387325"><span class="hs-identifier hs-var">neg_lit_ty</span></a></span></span><span class="hs-special">]</span><span> </span><span class="annot"><span class="annottext">[TcType]
</span><span class="hs-identifier">_</span></span><span> </span><span class="hs-glyph">-&gt;</span><span>
</span><span id="line-601"></span><span>               </span><span class="hs-keyword">let</span><span> </span><span id="local-6989586621681387324"><span class="annot"><span class="annottext">new_over_lit :: TcType -&gt; TcM (HsOverLit GhcTc)
</span><a href="#local-6989586621681387324"><span class="hs-identifier hs-var hs-var">new_over_lit</span></a></span></span><span> </span><span id="local-6989586621681387323"><span class="annot"><span class="annottext">TcType
</span><a href="#local-6989586621681387323"><span class="hs-identifier hs-var">lit_ty</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">HsOverLit GhcRn -&gt; ExpSigmaType -&gt; TcM (HsOverLit GhcTc)
</span><a href="GHC.Tc.Utils.Instantiate.html#newOverloadedLit"><span class="hs-identifier hs-var">newOverloadedLit</span></a></span><span> </span><span class="annot"><span class="annottext">HsOverLit GhcRn
</span><a href="#local-6989586621681387336"><span class="hs-identifier hs-var">over_lit</span></a></span><span>
</span><span id="line-602"></span><span>                                           </span><span class="hs-special">(</span><span class="annot"><span class="annottext">TcType -&gt; ExpSigmaType
</span><a href="GHC.Tc.Utils.TcType.html#mkCheckExpType"><span class="hs-identifier hs-var">mkCheckExpType</span></a></span><span> </span><span class="annot"><span class="annottext">TcType
</span><a href="#local-6989586621681387323"><span class="hs-identifier hs-var">lit_ty</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-603"></span><span>               </span><span class="hs-keyword">in</span><span> </span><span class="hs-keyword">case</span><span> </span><span class="annot"><span class="annottext">Maybe (SyntaxExpr GhcRn)
</span><a href="#local-6989586621681387335"><span class="hs-identifier hs-var">mb_neg</span></a></span><span> </span><span class="hs-keyword">of</span><span>
</span><span id="line-604"></span><span>                 </span><span class="annot"><span class="annottext">Maybe (SyntaxExpr GhcRn)
</span><a href="../../base-4.16.4.0/src/GHC-Maybe.html#Nothing"><span class="hs-identifier hs-var">Nothing</span></a></span><span>  </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-special">(</span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">forall a. Maybe a
</span><a href="../../base-4.16.4.0/src/GHC-Maybe.html#Nothing"><span class="hs-identifier hs-var">Nothing</span></a></span><span class="hs-special">)</span><span> </span><span class="annot"><span class="annottext">forall (f :: * -&gt; *) a b. Functor f =&gt; (a -&gt; b) -&gt; f a -&gt; f b
</span><a href="../../base-4.16.4.0/src/Data-Functor.html#%3C%24%3E"><span class="hs-operator hs-var">&lt;$&gt;</span></a></span><span> </span><span class="annot"><span class="annottext">TcType -&gt; TcM (HsOverLit GhcTc)
</span><a href="#local-6989586621681387324"><span class="hs-identifier hs-var">new_over_lit</span></a></span><span> </span><span class="annot"><span class="annottext">TcType
</span><a href="#local-6989586621681387325"><span class="hs-identifier hs-var">neg_lit_ty</span></a></span><span>
</span><span id="line-605"></span><span>                 </span><span class="annot"><a href="../../base-4.16.4.0/src/GHC-Maybe.html#Just"><span class="hs-identifier hs-type">Just</span></a></span><span> </span><span id="local-6989586621681387320"><span class="annot"><span class="annottext">SyntaxExpr GhcRn
</span><a href="#local-6989586621681387320"><span class="hs-identifier hs-var">neg</span></a></span></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-comment">-- Negative literal</span><span>
</span><span id="line-606"></span><span>                             </span><span class="hs-comment">-- The 'negate' is re-mappable syntax</span><span>
</span><span id="line-607"></span><span>                   </span><span class="annot"><span class="annottext">forall (a :: * -&gt; * -&gt; *) b c d.
Arrow a =&gt;
a b c -&gt; a (d, b) (d, c)
</span><a href="../../base-4.16.4.0/src/Control-Arrow.html#second"><span class="hs-identifier hs-var">second</span></a></span><span> </span><span class="annot"><span class="annottext">forall a. a -&gt; Maybe a
</span><a href="../../base-4.16.4.0/src/GHC-Maybe.html#Just"><span class="hs-identifier hs-var">Just</span></a></span><span> </span><span class="annot"><span class="annottext">forall (f :: * -&gt; *) a b. Functor f =&gt; (a -&gt; b) -&gt; f a -&gt; f b
</span><a href="../../base-4.16.4.0/src/Data-Functor.html#%3C%24%3E"><span class="hs-operator hs-var">&lt;$&gt;</span></a></span><span>
</span><span id="line-608"></span><span>                   </span><span class="hs-special">(</span><span class="annot"><span class="annottext">forall a.
CtOrigin
-&gt; SyntaxExprRn
-&gt; [SyntaxOpType]
-&gt; ExpSigmaType
-&gt; ([TcType] -&gt; [TcType] -&gt; TcM a)
-&gt; TcM (a, SyntaxExprTc)
</span><a href="GHC.Tc.Gen.Expr.html#tcSyntaxOp"><span class="hs-identifier hs-var">tcSyntaxOp</span></a></span><span> </span><span class="annot"><span class="annottext">CtOrigin
</span><a href="#local-6989586621681387332"><span class="hs-identifier hs-var">orig</span></a></span><span> </span><span class="annot"><span class="annottext">SyntaxExpr GhcRn
</span><a href="#local-6989586621681387320"><span class="hs-identifier hs-var">neg</span></a></span><span> </span><span class="hs-special">[</span><span class="annot"><span class="annottext">SyntaxOpType
</span><a href="GHC.Tc.Utils.TcType.html#SynRho"><span class="hs-identifier hs-var">SynRho</span></a></span><span class="hs-special">]</span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">TcType -&gt; ExpSigmaType
</span><a href="GHC.Tc.Utils.TcType.html#mkCheckExpType"><span class="hs-identifier hs-var">mkCheckExpType</span></a></span><span> </span><span class="annot"><span class="annottext">TcType
</span><a href="#local-6989586621681387325"><span class="hs-identifier hs-var">neg_lit_ty</span></a></span><span class="hs-special">)</span><span> </span><span class="annot"><span class="annottext">forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><a href="../../base-4.16.4.0/src/GHC-Base.html#%24"><span class="hs-operator hs-var">$</span></a></span><span>
</span><span id="line-609"></span><span>                    </span><span class="hs-glyph">\</span><span> </span><span class="hs-special">[</span><span id="local-6989586621681387318"><span class="annot"><span class="annottext">TcType
</span><a href="#local-6989586621681387318"><span class="hs-identifier hs-var">lit_ty</span></a></span></span><span class="hs-special">]</span><span> </span><span class="annot"><span class="annottext">[TcType]
</span><span class="hs-identifier">_</span></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="annottext">TcType -&gt; TcM (HsOverLit GhcTc)
</span><a href="#local-6989586621681387324"><span class="hs-identifier hs-var">new_over_lit</span></a></span><span> </span><span class="annot"><span class="annottext">TcType
</span><a href="#local-6989586621681387318"><span class="hs-identifier hs-var">lit_ty</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-610"></span><span>                     </span><span class="hs-comment">-- applied to a closed literal: linearity doesn't matter as</span><span>
</span><span id="line-611"></span><span>                     </span><span class="hs-comment">-- literals are typed in an empty environment, hence have</span><span>
</span><span id="line-612"></span><span>                     </span><span class="hs-comment">-- all multiplicities.</span><span>
</span><span id="line-613"></span><span>
</span><span id="line-614"></span><span>        </span><span class="hs-special">;</span><span> </span><span id="local-6989586621681387317"><span class="annot"><span class="annottext">r
</span><a href="#local-6989586621681387317"><span class="hs-identifier hs-var">res</span></a></span></span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">TcM r
</span><a href="#local-6989586621681387504"><span class="hs-identifier hs-var">thing_inside</span></a></span><span>
</span><span id="line-615"></span><span>        </span><span class="hs-special">;</span><span> </span><span id="local-6989586621681387316"><span class="annot"><span class="annottext">TcType
</span><a href="#local-6989586621681387316"><span class="hs-identifier hs-var">pat_ty</span></a></span></span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">ExpSigmaType -&gt; TcM TcType
</span><a href="GHC.Tc.Utils.TcMType.html#readExpType"><span class="hs-identifier hs-var">readExpType</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">forall a. Scaled a -&gt; a
</span><a href="GHC.Core.TyCo.Rep.html#scaledThing"><span class="hs-identifier hs-var">scaledThing</span></a></span><span> </span><span class="annot"><span class="annottext">Scaled ExpSigmaType
</span><a href="#local-6989586621681387507"><span class="hs-identifier hs-var">pat_ty</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-616"></span><span>        </span><span class="hs-special">;</span><span> </span><span class="annot"><span class="annottext">forall (m :: * -&gt; *) a. Monad m =&gt; a -&gt; m a
</span><a href="../../base-4.16.4.0/src/GHC-Base.html#return"><span class="hs-identifier hs-var">return</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">HsWrapper -&gt; Pat GhcTc -&gt; TcType -&gt; Pat GhcTc
</span><a href="GHC.Hs.Utils.html#mkHsWrapPat"><span class="hs-identifier hs-var">mkHsWrapPat</span></a></span><span> </span><span class="annot"><span class="annottext">HsWrapper
</span><a href="#local-6989586621681387333"><span class="hs-identifier hs-var">mult_wrap</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">forall p.
XNPat p
-&gt; XRec p (HsOverLit p)
-&gt; Maybe (SyntaxExpr p)
-&gt; SyntaxExpr p
-&gt; Pat p
</span><a href="Language.Haskell.Syntax.Pat.html#NPat"><span class="hs-identifier hs-var">NPat</span></a></span><span> </span><span class="annot"><span class="annottext">TcType
</span><a href="#local-6989586621681387316"><span class="hs-identifier hs-var">pat_ty</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">forall l e. l -&gt; e -&gt; GenLocated l e
</span><a href="GHC.Types.SrcLoc.html#L"><span class="hs-identifier hs-var">L</span></a></span><span> </span><span class="annot"><span class="annottext">SrcSpan
</span><a href="#local-6989586621681387337"><span class="hs-identifier hs-var">l</span></a></span><span> </span><span class="annot"><span class="annottext">HsOverLit GhcTc
</span><a href="#local-6989586621681387330"><span class="hs-identifier hs-var">lit'</span></a></span><span class="hs-special">)</span><span> </span><span class="annot"><span class="annottext">Maybe SyntaxExprTc
</span><a href="#local-6989586621681387329"><span class="hs-identifier hs-var">mb_neg'</span></a></span><span> </span><span class="annot"><span class="annottext">SyntaxExprTc
</span><a href="#local-6989586621681387328"><span class="hs-identifier hs-var">eq'</span></a></span><span class="hs-special">)</span><span> </span><span class="annot"><span class="annottext">TcType
</span><a href="#local-6989586621681387316"><span class="hs-identifier hs-var">pat_ty</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">r
</span><a href="#local-6989586621681387317"><span class="hs-identifier hs-var">res</span></a></span><span class="hs-special">)</span><span> </span><span class="hs-special">}</span><span>
</span><span id="line-617"></span><span>
</span><span id="line-618"></span><span class="hs-comment">{-
Note [NPlusK patterns]
~~~~~~~~~~~~~~~~~~~~~~
From

  case v of x + 5 -&gt; blah

we get

  if v &gt;= 5 then (\x -&gt; blah) (v - 5) else ...

There are two bits of rebindable syntax:
  (&gt;=) :: pat_ty -&gt; lit1_ty -&gt; Bool
  (-)  :: pat_ty -&gt; lit2_ty -&gt; var_ty

lit1_ty and lit2_ty could conceivably be different.
var_ty is the type inferred for x, the variable in the pattern.

Note that we need to type-check the literal twice, because it is used
twice, and may be used at different types. The second HsOverLit stored in the
AST is used for the subtraction operation.
-}</span><span>
</span><span id="line-640"></span><span>
</span><span id="line-641"></span><span class="hs-comment">-- See Note [NPlusK patterns]</span><span>
</span><span id="line-642"></span><span>  </span><span class="annot"><a href="Language.Haskell.Syntax.Pat.html#NPlusKPat"><span class="hs-identifier hs-type">NPlusKPat</span></a></span><span> </span><span class="annot"><span class="annottext">XNPlusKPat GhcRn
</span><span class="hs-identifier">_</span></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="GHC.Types.SrcLoc.html#L"><span class="hs-identifier hs-type">L</span></a></span><span> </span><span id="local-6989586621681387314"><span class="annot"><span class="annottext">SrcSpanAnnN
</span><a href="#local-6989586621681387314"><span class="hs-identifier hs-var">nm_loc</span></a></span></span><span> </span><span id="local-6989586621681387313"><span class="annot"><span class="annottext">Name
</span><a href="#local-6989586621681387313"><span class="hs-identifier hs-var">name</span></a></span></span><span class="hs-special">)</span><span>
</span><span id="line-643"></span><span>               </span><span class="hs-special">(</span><span class="annot"><a href="GHC.Types.SrcLoc.html#L"><span class="hs-identifier hs-type">L</span></a></span><span> </span><span id="local-6989586621681387312"><span class="annot"><span class="annottext">SrcSpan
</span><a href="#local-6989586621681387312"><span class="hs-identifier hs-var">loc</span></a></span></span><span> </span><span id="local-6989586621681387311"><span class="annot"><span class="annottext">HsOverLit GhcRn
</span><a href="#local-6989586621681387311"><span class="hs-identifier hs-var">lit</span></a></span></span><span class="hs-special">)</span><span> </span><span class="annot"><span class="annottext">HsOverLit GhcRn
</span><span class="hs-identifier">_</span></span><span> </span><span id="local-6989586621681387310"><span class="annot"><span class="annottext">SyntaxExpr GhcRn
</span><a href="#local-6989586621681387310"><span class="hs-identifier hs-var">ge</span></a></span></span><span> </span><span id="local-6989586621681387309"><span class="annot"><span class="annottext">SyntaxExpr GhcRn
</span><a href="#local-6989586621681387309"><span class="hs-identifier hs-var">minus</span></a></span></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-keyword">do</span><span>
</span><span id="line-644"></span><span>        </span><span class="hs-special">{</span><span> </span><span id="local-6989586621681387308"><span class="annot"><span class="annottext">HsWrapper
</span><a href="#local-6989586621681387308"><span class="hs-identifier hs-var">mult_wrap</span></a></span></span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">forall a. Scaled a -&gt; TcM HsWrapper
</span><a href="GHC.Tc.Gen.Pat.html#checkManyPattern"><span class="hs-identifier hs-var">checkManyPattern</span></a></span><span> </span><span class="annot"><span class="annottext">Scaled ExpSigmaType
</span><a href="#local-6989586621681387507"><span class="hs-identifier hs-var">pat_ty</span></a></span><span>
</span><span id="line-645"></span><span>            </span><span class="hs-comment">-- See Note [Wrapper returned from tcSubMult] in GHC.Tc.Utils.Unify.</span><span>
</span><span id="line-646"></span><span>        </span><span class="hs-special">;</span><span> </span><span class="hs-keyword">let</span><span> </span><span id="local-6989586621681387307"><span class="annot"><span class="annottext">pat_exp_ty :: ExpSigmaType
</span><a href="#local-6989586621681387307"><span class="hs-identifier hs-var hs-var">pat_exp_ty</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">forall a. Scaled a -&gt; a
</span><a href="GHC.Core.TyCo.Rep.html#scaledThing"><span class="hs-identifier hs-var">scaledThing</span></a></span><span> </span><span class="annot"><span class="annottext">Scaled ExpSigmaType
</span><a href="#local-6989586621681387507"><span class="hs-identifier hs-var">pat_ty</span></a></span><span>
</span><span id="line-647"></span><span>              </span><span id="local-6989586621681387306"><span class="annot"><span class="annottext">orig :: CtOrigin
</span><a href="#local-6989586621681387306"><span class="hs-identifier hs-var hs-var">orig</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">HsOverLit GhcRn -&gt; CtOrigin
</span><a href="GHC.Tc.Types.Origin.html#LiteralOrigin"><span class="hs-identifier hs-var">LiteralOrigin</span></a></span><span> </span><span class="annot"><span class="annottext">HsOverLit GhcRn
</span><a href="#local-6989586621681387311"><span class="hs-identifier hs-var">lit</span></a></span><span>
</span><span id="line-648"></span><span>        </span><span class="hs-special">;</span><span> </span><span class="hs-special">(</span><span id="local-6989586621681387305"><span class="annot"><span class="annottext">HsOverLit GhcTc
</span><a href="#local-6989586621681387305"><span class="hs-identifier hs-var">lit1'</span></a></span></span><span class="hs-special">,</span><span> </span><span id="local-6989586621681387304"><span class="annot"><span class="annottext">SyntaxExprTc
</span><a href="#local-6989586621681387304"><span class="hs-identifier hs-var">ge'</span></a></span></span><span class="hs-special">)</span><span>
</span><span id="line-649"></span><span>            </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">forall a.
CtOrigin
-&gt; SyntaxExprRn
-&gt; [SyntaxOpType]
-&gt; ExpSigmaType
-&gt; ([TcType] -&gt; [TcType] -&gt; TcM a)
-&gt; TcM (a, SyntaxExprTc)
</span><a href="GHC.Tc.Gen.Expr.html#tcSyntaxOp"><span class="hs-identifier hs-var">tcSyntaxOp</span></a></span><span> </span><span class="annot"><span class="annottext">CtOrigin
</span><a href="#local-6989586621681387306"><span class="hs-identifier hs-var">orig</span></a></span><span> </span><span class="annot"><span class="annottext">SyntaxExpr GhcRn
</span><a href="#local-6989586621681387310"><span class="hs-identifier hs-var">ge</span></a></span><span> </span><span class="hs-special">[</span><span class="annot"><span class="annottext">ExpSigmaType -&gt; SyntaxOpType
</span><a href="GHC.Tc.Utils.TcType.html#SynType"><span class="hs-identifier hs-var">SynType</span></a></span><span> </span><span class="annot"><span class="annottext">ExpSigmaType
</span><a href="#local-6989586621681387307"><span class="hs-identifier hs-var">pat_exp_ty</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">SyntaxOpType
</span><a href="GHC.Tc.Utils.TcType.html#SynRho"><span class="hs-identifier hs-var">SynRho</span></a></span><span class="hs-special">]</span><span>
</span><span id="line-650"></span><span>                                  </span><span class="hs-special">(</span><span class="annot"><span class="annottext">TcType -&gt; ExpSigmaType
</span><a href="GHC.Tc.Utils.TcType.html#mkCheckExpType"><span class="hs-identifier hs-var">mkCheckExpType</span></a></span><span> </span><span class="annot"><span class="annottext">TcType
</span><a href="GHC.Builtin.Types.html#boolTy"><span class="hs-identifier hs-var">boolTy</span></a></span><span class="hs-special">)</span><span> </span><span class="annot"><span class="annottext">forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><a href="../../base-4.16.4.0/src/GHC-Base.html#%24"><span class="hs-operator hs-var">$</span></a></span><span>
</span><span id="line-651"></span><span>               </span><span class="hs-glyph">\</span><span> </span><span class="hs-special">[</span><span id="local-6989586621681387303"><span class="annot"><span class="annottext">TcType
</span><a href="#local-6989586621681387303"><span class="hs-identifier hs-var">lit1_ty</span></a></span></span><span class="hs-special">]</span><span> </span><span class="annot"><span class="annottext">[TcType]
</span><span class="hs-identifier">_</span></span><span> </span><span class="hs-glyph">-&gt;</span><span>
</span><span id="line-652"></span><span>               </span><span class="annot"><span class="annottext">HsOverLit GhcRn -&gt; ExpSigmaType -&gt; TcM (HsOverLit GhcTc)
</span><a href="GHC.Tc.Utils.Instantiate.html#newOverloadedLit"><span class="hs-identifier hs-var">newOverloadedLit</span></a></span><span> </span><span class="annot"><span class="annottext">HsOverLit GhcRn
</span><a href="#local-6989586621681387311"><span class="hs-identifier hs-var">lit</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">TcType -&gt; ExpSigmaType
</span><a href="GHC.Tc.Utils.TcType.html#mkCheckExpType"><span class="hs-identifier hs-var">mkCheckExpType</span></a></span><span> </span><span class="annot"><span class="annottext">TcType
</span><a href="#local-6989586621681387303"><span class="hs-identifier hs-var">lit1_ty</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-653"></span><span>        </span><span class="hs-special">;</span><span> </span><span class="hs-special">(</span><span class="hs-special">(</span><span id="local-6989586621681387302"><span class="annot"><span class="annottext">HsOverLit GhcTc
</span><a href="#local-6989586621681387302"><span class="hs-identifier hs-var">lit2'</span></a></span></span><span class="hs-special">,</span><span> </span><span id="local-6989586621681387301"><span class="annot"><span class="annottext">HsWrapper
</span><a href="#local-6989586621681387301"><span class="hs-identifier hs-var">minus_wrap</span></a></span></span><span class="hs-special">,</span><span> </span><span id="local-6989586621681387300"><span class="annot"><span class="annottext">TyVar
</span><a href="#local-6989586621681387300"><span class="hs-identifier hs-var">bndr_id</span></a></span></span><span class="hs-special">)</span><span class="hs-special">,</span><span> </span><span id="local-6989586621681387299"><span class="annot"><span class="annottext">SyntaxExprTc
</span><a href="#local-6989586621681387299"><span class="hs-identifier hs-var">minus'</span></a></span></span><span class="hs-special">)</span><span>
</span><span id="line-654"></span><span>            </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">forall a.
CtOrigin
-&gt; SyntaxExprRn
-&gt; [SyntaxOpType]
-&gt; SyntaxOpType
-&gt; ([TcType] -&gt; [TcType] -&gt; TcM a)
-&gt; TcM (a, SyntaxExprTc)
</span><a href="GHC.Tc.Gen.Expr.html#tcSyntaxOpGen"><span class="hs-identifier hs-var">tcSyntaxOpGen</span></a></span><span> </span><span class="annot"><span class="annottext">CtOrigin
</span><a href="#local-6989586621681387306"><span class="hs-identifier hs-var">orig</span></a></span><span> </span><span class="annot"><span class="annottext">SyntaxExpr GhcRn
</span><a href="#local-6989586621681387309"><span class="hs-identifier hs-var">minus</span></a></span><span> </span><span class="hs-special">[</span><span class="annot"><span class="annottext">ExpSigmaType -&gt; SyntaxOpType
</span><a href="GHC.Tc.Utils.TcType.html#SynType"><span class="hs-identifier hs-var">SynType</span></a></span><span> </span><span class="annot"><span class="annottext">ExpSigmaType
</span><a href="#local-6989586621681387307"><span class="hs-identifier hs-var">pat_exp_ty</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">SyntaxOpType
</span><a href="GHC.Tc.Utils.TcType.html#SynRho"><span class="hs-identifier hs-var">SynRho</span></a></span><span class="hs-special">]</span><span> </span><span class="annot"><span class="annottext">SyntaxOpType
</span><a href="GHC.Tc.Utils.TcType.html#SynAny"><span class="hs-identifier hs-var">SynAny</span></a></span><span> </span><span class="annot"><span class="annottext">forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><a href="../../base-4.16.4.0/src/GHC-Base.html#%24"><span class="hs-operator hs-var">$</span></a></span><span>
</span><span id="line-655"></span><span>               </span><span class="hs-glyph">\</span><span> </span><span class="hs-special">[</span><span id="local-6989586621681387298"><span class="annot"><span class="annottext">TcType
</span><a href="#local-6989586621681387298"><span class="hs-identifier hs-var">lit2_ty</span></a></span></span><span class="hs-special">,</span><span> </span><span id="local-6989586621681387297"><span class="annot"><span class="annottext">TcType
</span><a href="#local-6989586621681387297"><span class="hs-identifier hs-var">var_ty</span></a></span></span><span class="hs-special">]</span><span> </span><span class="annot"><span class="annottext">[TcType]
</span><span class="hs-identifier">_</span></span><span> </span><span class="hs-glyph">-&gt;</span><span>
</span><span id="line-656"></span><span>               </span><span class="hs-keyword">do</span><span> </span><span class="hs-special">{</span><span> </span><span id="local-6989586621681387296"><span class="annot"><span class="annottext">HsOverLit GhcTc
</span><a href="#local-6989586621681387296"><span class="hs-identifier hs-var">lit2'</span></a></span></span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">HsOverLit GhcRn -&gt; ExpSigmaType -&gt; TcM (HsOverLit GhcTc)
</span><a href="GHC.Tc.Utils.Instantiate.html#newOverloadedLit"><span class="hs-identifier hs-var">newOverloadedLit</span></a></span><span> </span><span class="annot"><span class="annottext">HsOverLit GhcRn
</span><a href="#local-6989586621681387311"><span class="hs-identifier hs-var">lit</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">TcType -&gt; ExpSigmaType
</span><a href="GHC.Tc.Utils.TcType.html#mkCheckExpType"><span class="hs-identifier hs-var">mkCheckExpType</span></a></span><span> </span><span class="annot"><span class="annottext">TcType
</span><a href="#local-6989586621681387298"><span class="hs-identifier hs-var">lit2_ty</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-657"></span><span>                  </span><span class="hs-special">;</span><span> </span><span class="hs-special">(</span><span id="local-6989586621681387295"><span class="annot"><span class="annottext">HsWrapper
</span><a href="#local-6989586621681387295"><span class="hs-identifier hs-var">wrap</span></a></span></span><span class="hs-special">,</span><span> </span><span id="local-6989586621681387294"><span class="annot"><span class="annottext">TyVar
</span><a href="#local-6989586621681387294"><span class="hs-identifier hs-var">bndr_id</span></a></span></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">forall ann a. SrcSpanAnn' ann -&gt; TcRn a -&gt; TcRn a
</span><a href="GHC.Tc.Utils.Monad.html#setSrcSpanA"><span class="hs-identifier hs-var">setSrcSpanA</span></a></span><span> </span><span class="annot"><span class="annottext">SrcSpanAnnN
</span><a href="#local-6989586621681387314"><span class="hs-identifier hs-var">nm_loc</span></a></span><span> </span><span class="annot"><span class="annottext">forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><a href="../../base-4.16.4.0/src/GHC-Base.html#%24"><span class="hs-operator hs-var">$</span></a></span><span>
</span><span id="line-658"></span><span>                                     </span><span class="annot"><span class="annottext">PatEnv -&gt; Name -&gt; Scaled ExpSigmaType -&gt; TcM (HsWrapper, TyVar)
</span><a href="GHC.Tc.Gen.Pat.html#tcPatBndr"><span class="hs-identifier hs-var">tcPatBndr</span></a></span><span> </span><span class="annot"><span class="annottext">PatEnv
</span><a href="#local-6989586621681387506"><span class="hs-identifier hs-var">penv</span></a></span><span> </span><span class="annot"><span class="annottext">Name
</span><a href="#local-6989586621681387313"><span class="hs-identifier hs-var">name</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">forall a. a -&gt; Scaled a
</span><a href="GHC.Core.Type.html#unrestricted"><span class="hs-identifier hs-var">unrestricted</span></a></span><span> </span><span class="annot"><span class="annottext">forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><a href="../../base-4.16.4.0/src/GHC-Base.html#%24"><span class="hs-operator hs-var">$</span></a></span><span> </span><span class="annot"><span class="annottext">TcType -&gt; ExpSigmaType
</span><a href="GHC.Tc.Utils.TcType.html#mkCheckExpType"><span class="hs-identifier hs-var">mkCheckExpType</span></a></span><span> </span><span class="annot"><span class="annottext">TcType
</span><a href="#local-6989586621681387297"><span class="hs-identifier hs-var">var_ty</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-659"></span><span>                           </span><span class="hs-comment">-- co :: var_ty ~ idType bndr_id</span><span>
</span><span id="line-660"></span><span>
</span><span id="line-661"></span><span>                           </span><span class="hs-comment">-- minus_wrap is applicable to minus'</span><span>
</span><span id="line-662"></span><span>                  </span><span class="hs-special">;</span><span> </span><span class="annot"><span class="annottext">forall (m :: * -&gt; *) a. Monad m =&gt; a -&gt; m a
</span><a href="../../base-4.16.4.0/src/GHC-Base.html#return"><span class="hs-identifier hs-var">return</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">HsOverLit GhcTc
</span><a href="#local-6989586621681387296"><span class="hs-identifier hs-var">lit2'</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">HsWrapper
</span><a href="#local-6989586621681387295"><span class="hs-identifier hs-var">wrap</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">TyVar
</span><a href="#local-6989586621681387294"><span class="hs-identifier hs-var">bndr_id</span></a></span><span class="hs-special">)</span><span> </span><span class="hs-special">}</span><span>
</span><span id="line-663"></span><span>
</span><span id="line-664"></span><span>        </span><span class="hs-special">;</span><span> </span><span id="local-6989586621681387293"><span class="annot"><span class="annottext">TcType
</span><a href="#local-6989586621681387293"><span class="hs-identifier hs-var">pat_ty</span></a></span></span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">ExpSigmaType -&gt; TcM TcType
</span><a href="GHC.Tc.Utils.TcMType.html#readExpType"><span class="hs-identifier hs-var">readExpType</span></a></span><span> </span><span class="annot"><span class="annottext">ExpSigmaType
</span><a href="#local-6989586621681387307"><span class="hs-identifier hs-var">pat_exp_ty</span></a></span><span>
</span><span id="line-665"></span><span>        </span><span class="hs-comment">-- The Report says that n+k patterns must be in Integral</span><span>
</span><span id="line-666"></span><span>        </span><span class="hs-comment">-- but it's silly to insist on this in the RebindableSyntax case</span><span>
</span><span id="line-667"></span><span>        </span><span class="hs-special">;</span><span> </span><span class="annot"><span class="annottext">forall (m :: * -&gt; *). Monad m =&gt; m Bool -&gt; m () -&gt; m ()
</span><a href="GHC.Utils.Monad.html#unlessM"><span class="hs-identifier hs-var">unlessM</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">forall gbl lcl. Extension -&gt; TcRnIf gbl lcl Bool
</span><a href="GHC.Tc.Utils.Monad.html#xoptM"><span class="hs-identifier hs-var">xoptM</span></a></span><span> </span><span class="annot"><span class="annottext">Extension
</span><span class="hs-identifier hs-var">LangExt.RebindableSyntax</span></span><span class="hs-special">)</span><span> </span><span class="annot"><span class="annottext">forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><a href="../../base-4.16.4.0/src/GHC-Base.html#%24"><span class="hs-operator hs-var">$</span></a></span><span>
</span><span id="line-668"></span><span>          </span><span class="hs-keyword">do</span><span> </span><span class="hs-special">{</span><span> </span><span id="local-6989586621681387289"><span class="annot"><span class="annottext">Class
</span><a href="#local-6989586621681387289"><span class="hs-identifier hs-var">icls</span></a></span></span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">Name -&gt; TcM Class
</span><a href="GHC.Tc.Utils.Env.html#tcLookupClass"><span class="hs-identifier hs-var">tcLookupClass</span></a></span><span> </span><span class="annot"><span class="annottext">Name
</span><a href="GHC.Builtin.Names.html#integralClassName"><span class="hs-identifier hs-var">integralClassName</span></a></span><span>
</span><span id="line-669"></span><span>             </span><span class="hs-special">;</span><span> </span><span class="annot"><span class="annottext">CtOrigin -&gt; [TcType] -&gt; TcRn ()
</span><a href="GHC.Tc.Utils.Instantiate.html#instStupidTheta"><span class="hs-identifier hs-var">instStupidTheta</span></a></span><span> </span><span class="annot"><span class="annottext">CtOrigin
</span><a href="#local-6989586621681387306"><span class="hs-identifier hs-var">orig</span></a></span><span> </span><span class="hs-special">[</span><span class="annot"><span class="annottext">Class -&gt; [TcType] -&gt; TcType
</span><a href="GHC.Core.Predicate.html#mkClassPred"><span class="hs-identifier hs-var">mkClassPred</span></a></span><span> </span><span class="annot"><span class="annottext">Class
</span><a href="#local-6989586621681387289"><span class="hs-identifier hs-var">icls</span></a></span><span> </span><span class="hs-special">[</span><span class="annot"><span class="annottext">TcType
</span><a href="#local-6989586621681387293"><span class="hs-identifier hs-var">pat_ty</span></a></span><span class="hs-special">]</span><span class="hs-special">]</span><span> </span><span class="hs-special">}</span><span>
</span><span id="line-670"></span><span>
</span><span id="line-671"></span><span>        </span><span class="hs-special">;</span><span> </span><span id="local-6989586621681387284"><span class="annot"><span class="annottext">r
</span><a href="#local-6989586621681387284"><span class="hs-identifier hs-var">res</span></a></span></span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">forall a. Name -&gt; TyVar -&gt; TcM a -&gt; TcM a
</span><a href="GHC.Tc.Utils.Env.html#tcExtendIdEnv1"><span class="hs-identifier hs-var">tcExtendIdEnv1</span></a></span><span> </span><span class="annot"><span class="annottext">Name
</span><a href="#local-6989586621681387313"><span class="hs-identifier hs-var">name</span></a></span><span> </span><span class="annot"><span class="annottext">TyVar
</span><a href="#local-6989586621681387300"><span class="hs-identifier hs-var">bndr_id</span></a></span><span> </span><span class="annot"><span class="annottext">TcM r
</span><a href="#local-6989586621681387504"><span class="hs-identifier hs-var">thing_inside</span></a></span><span>
</span><span id="line-672"></span><span>
</span><span id="line-673"></span><span>        </span><span class="hs-special">;</span><span> </span><span class="hs-keyword">let</span><span> </span><span id="local-6989586621681387283"><span class="annot"><span class="annottext">minus'' :: SyntaxExprTc
</span><a href="#local-6989586621681387283"><span class="hs-identifier hs-var hs-var">minus''</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-keyword">case</span><span> </span><span class="annot"><span class="annottext">SyntaxExprTc
</span><a href="#local-6989586621681387299"><span class="hs-identifier hs-var">minus'</span></a></span><span> </span><span class="hs-keyword">of</span><span>
</span><span id="line-674"></span><span>                          </span><span class="annot"><span class="annottext">SyntaxExprTc
</span><a href="GHC.Hs.Expr.html#NoSyntaxExprTc"><span class="hs-identifier hs-var">NoSyntaxExprTc</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="annottext">forall a. HasCallStack =&gt; String -&gt; SDoc -&gt; a
</span><a href="GHC.Utils.Panic.html#pprPanic"><span class="hs-identifier hs-var">pprPanic</span></a></span><span> </span><span class="annot"><span class="annottext">String
</span><span class="hs-string">&quot;tc_pat NoSyntaxExprTc&quot;</span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">forall a. Outputable a =&gt; a -&gt; SDoc
</span><a href="GHC.Utils.Outputable.html#ppr"><span class="hs-identifier hs-var">ppr</span></a></span><span> </span><span class="annot"><span class="annottext">SyntaxExprTc
</span><a href="#local-6989586621681387299"><span class="hs-identifier hs-var">minus'</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-675"></span><span>                                   </span><span class="hs-comment">-- this should be statically avoidable</span><span>
</span><span id="line-676"></span><span>                                   </span><span class="hs-comment">-- Case (3) from Note [NoSyntaxExpr] in &quot;GHC.Hs.Expr&quot;</span><span>
</span><span id="line-677"></span><span>                          </span><span class="annot"><a href="GHC.Hs.Expr.html#SyntaxExprTc"><span class="hs-identifier hs-type">SyntaxExprTc</span></a></span><span> </span><span class="hs-special">{</span><span> </span><span class="annot"><span class="annottext">syn_expr :: SyntaxExprTc -&gt; HsExpr GhcTc
</span><a href="GHC.Hs.Expr.html#syn_expr"><span class="hs-identifier hs-var">syn_expr</span></a></span><span> </span><span class="hs-glyph">=</span><span> </span><span id="local-6989586621681387278"><span class="annot"><span class="annottext">HsExpr GhcTc
</span><a href="#local-6989586621681387278"><span class="hs-identifier hs-var">minus'_expr</span></a></span></span><span>
</span><span id="line-678"></span><span>                                       </span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">syn_arg_wraps :: SyntaxExprTc -&gt; [HsWrapper]
</span><a href="GHC.Hs.Expr.html#syn_arg_wraps"><span class="hs-identifier hs-var">syn_arg_wraps</span></a></span><span> </span><span class="hs-glyph">=</span><span> </span><span id="local-6989586621681387276"><span class="annot"><span class="annottext">[HsWrapper]
</span><a href="#local-6989586621681387276"><span class="hs-identifier hs-var">minus'_arg_wraps</span></a></span></span><span>
</span><span id="line-679"></span><span>                                       </span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">syn_res_wrap :: SyntaxExprTc -&gt; HsWrapper
</span><a href="GHC.Hs.Expr.html#syn_res_wrap"><span class="hs-identifier hs-var">syn_res_wrap</span></a></span><span> </span><span class="hs-glyph">=</span><span> </span><span id="local-6989586621681387274"><span class="annot"><span class="annottext">HsWrapper
</span><a href="#local-6989586621681387274"><span class="hs-identifier hs-var">minus'_res_wrap</span></a></span></span><span> </span><span class="hs-special">}</span><span>
</span><span id="line-680"></span><span>                            </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="GHC.Hs.Expr.html#SyntaxExprTc"><span class="hs-identifier hs-type">SyntaxExprTc</span></a></span><span> </span><span class="hs-special">{</span><span> </span><span class="annot"><span class="annottext">syn_expr :: HsExpr GhcTc
</span><a href="GHC.Hs.Expr.html#syn_expr"><span class="hs-identifier hs-var">syn_expr</span></a></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">HsExpr GhcTc
</span><a href="#local-6989586621681387278"><span class="hs-identifier hs-var">minus'_expr</span></a></span><span>
</span><span id="line-681"></span><span>                                            </span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">syn_arg_wraps :: [HsWrapper]
</span><a href="GHC.Hs.Expr.html#syn_arg_wraps"><span class="hs-identifier hs-var">syn_arg_wraps</span></a></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">[HsWrapper]
</span><a href="#local-6989586621681387276"><span class="hs-identifier hs-var">minus'_arg_wraps</span></a></span><span>
</span><span id="line-682"></span><span>                                            </span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">syn_res_wrap :: HsWrapper
</span><a href="GHC.Hs.Expr.html#syn_res_wrap"><span class="hs-identifier hs-var">syn_res_wrap</span></a></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">HsWrapper
</span><a href="#local-6989586621681387301"><span class="hs-identifier hs-var">minus_wrap</span></a></span><span> </span><span class="annot"><span class="annottext">HsWrapper -&gt; HsWrapper -&gt; HsWrapper
</span><a href="GHC.Tc.Types.Evidence.html#%3C.%3E"><span class="hs-operator hs-var">&lt;.&gt;</span></a></span><span> </span><span class="annot"><span class="annottext">HsWrapper
</span><a href="#local-6989586621681387274"><span class="hs-identifier hs-var">minus'_res_wrap</span></a></span><span> </span><span class="hs-special">}</span><span>
</span><span id="line-683"></span><span>                             </span><span class="hs-comment">-- Oy. This should really be a record update, but</span><span>
</span><span id="line-684"></span><span>                             </span><span class="hs-comment">-- we get warnings if we try. #17783</span><span>
</span><span id="line-685"></span><span>              </span><span id="local-6989586621681387273"><span class="annot"><span class="annottext">pat' :: Pat GhcTc
</span><a href="#local-6989586621681387273"><span class="hs-identifier hs-var hs-var">pat'</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">forall p.
XNPlusKPat p
-&gt; LIdP p
-&gt; XRec p (HsOverLit p)
-&gt; HsOverLit p
-&gt; SyntaxExpr p
-&gt; SyntaxExpr p
-&gt; Pat p
</span><a href="Language.Haskell.Syntax.Pat.html#NPlusKPat"><span class="hs-identifier hs-var">NPlusKPat</span></a></span><span> </span><span class="annot"><span class="annottext">TcType
</span><a href="#local-6989586621681387293"><span class="hs-identifier hs-var">pat_ty</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">forall l e. l -&gt; e -&gt; GenLocated l e
</span><a href="GHC.Types.SrcLoc.html#L"><span class="hs-identifier hs-var">L</span></a></span><span> </span><span class="annot"><span class="annottext">SrcSpanAnnN
</span><a href="#local-6989586621681387314"><span class="hs-identifier hs-var">nm_loc</span></a></span><span> </span><span class="annot"><span class="annottext">TyVar
</span><a href="#local-6989586621681387300"><span class="hs-identifier hs-var">bndr_id</span></a></span><span class="hs-special">)</span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">forall l e. l -&gt; e -&gt; GenLocated l e
</span><a href="GHC.Types.SrcLoc.html#L"><span class="hs-identifier hs-var">L</span></a></span><span> </span><span class="annot"><span class="annottext">SrcSpan
</span><a href="#local-6989586621681387312"><span class="hs-identifier hs-var">loc</span></a></span><span> </span><span class="annot"><span class="annottext">HsOverLit GhcTc
</span><a href="#local-6989586621681387305"><span class="hs-identifier hs-var">lit1'</span></a></span><span class="hs-special">)</span><span> </span><span class="annot"><span class="annottext">HsOverLit GhcTc
</span><a href="#local-6989586621681387302"><span class="hs-identifier hs-var">lit2'</span></a></span><span>
</span><span id="line-686"></span><span>                               </span><span class="annot"><span class="annottext">SyntaxExprTc
</span><a href="#local-6989586621681387304"><span class="hs-identifier hs-var">ge'</span></a></span><span> </span><span class="annot"><span class="annottext">SyntaxExprTc
</span><a href="#local-6989586621681387283"><span class="hs-identifier hs-var">minus''</span></a></span><span>
</span><span id="line-687"></span><span>        </span><span class="hs-special">;</span><span> </span><span class="annot"><span class="annottext">forall (m :: * -&gt; *) a. Monad m =&gt; a -&gt; m a
</span><a href="../../base-4.16.4.0/src/GHC-Base.html#return"><span class="hs-identifier hs-var">return</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">HsWrapper -&gt; Pat GhcTc -&gt; TcType -&gt; Pat GhcTc
</span><a href="GHC.Hs.Utils.html#mkHsWrapPat"><span class="hs-identifier hs-var">mkHsWrapPat</span></a></span><span> </span><span class="annot"><span class="annottext">HsWrapper
</span><a href="#local-6989586621681387308"><span class="hs-identifier hs-var">mult_wrap</span></a></span><span> </span><span class="annot"><span class="annottext">Pat GhcTc
</span><a href="#local-6989586621681387273"><span class="hs-identifier hs-var">pat'</span></a></span><span> </span><span class="annot"><span class="annottext">TcType
</span><a href="#local-6989586621681387293"><span class="hs-identifier hs-var">pat_ty</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">r
</span><a href="#local-6989586621681387284"><span class="hs-identifier hs-var">res</span></a></span><span class="hs-special">)</span><span> </span><span class="hs-special">}</span><span>
</span><span id="line-688"></span><span>
</span><span id="line-689"></span><span class="hs-comment">-- HsSpliced is an annotation produced by 'GHC.Rename.Splice.rnSplicePat'.</span><span>
</span><span id="line-690"></span><span class="hs-comment">-- Here we get rid of it and add the finalizers to the global environment.</span><span>
</span><span id="line-691"></span><span class="hs-comment">--</span><span>
</span><span id="line-692"></span><span class="hs-comment">-- See Note [Delaying modFinalizers in untyped splices] in GHC.Rename.Splice.</span><span>
</span><span id="line-693"></span><span>  </span><span class="annot"><a href="Language.Haskell.Syntax.Pat.html#SplicePat"><span class="hs-identifier hs-type">SplicePat</span></a></span><span> </span><span class="annot"><span class="annottext">XSplicePat GhcRn
</span><span class="hs-identifier">_</span></span><span> </span><span id="local-6989586621681387271"><span class="annot"><span class="annottext">HsSplice GhcRn
</span><a href="#local-6989586621681387271"><span class="hs-identifier hs-var">splice</span></a></span></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-keyword">case</span><span> </span><span class="annot"><span class="annottext">HsSplice GhcRn
</span><a href="#local-6989586621681387271"><span class="hs-identifier hs-var">splice</span></a></span><span> </span><span class="hs-keyword">of</span><span>
</span><span id="line-694"></span><span>    </span><span class="hs-special">(</span><span class="annot"><a href="Language.Haskell.Syntax.Expr.html#HsSpliced"><span class="hs-identifier hs-type">HsSpliced</span></a></span><span> </span><span class="annot"><span class="annottext">XSpliced GhcRn
</span><span class="hs-identifier">_</span></span><span> </span><span id="local-6989586621681387269"><span class="annot"><span class="annottext">ThModFinalizers
</span><a href="#local-6989586621681387269"><span class="hs-identifier hs-var">mod_finalizers</span></a></span></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="Language.Haskell.Syntax.Expr.html#HsSplicedPat"><span class="hs-identifier hs-type">HsSplicedPat</span></a></span><span> </span><span id="local-6989586621681387267"><span class="annot"><span class="annottext">Pat GhcRn
</span><a href="#local-6989586621681387267"><span class="hs-identifier hs-var">pat</span></a></span></span><span class="hs-special">)</span><span class="hs-special">)</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-keyword">do</span><span>
</span><span id="line-695"></span><span>      </span><span class="hs-special">{</span><span> </span><span class="annot"><span class="annottext">ThModFinalizers -&gt; TcRn ()
</span><a href="GHC.Tc.Utils.Monad.html#addModFinalizersWithLclEnv"><span class="hs-identifier hs-var">addModFinalizersWithLclEnv</span></a></span><span> </span><span class="annot"><span class="annottext">ThModFinalizers
</span><a href="#local-6989586621681387269"><span class="hs-identifier hs-var">mod_finalizers</span></a></span><span>
</span><span id="line-696"></span><span>      </span><span class="hs-special">;</span><span> </span><span class="annot"><span class="annottext">Scaled ExpSigmaType -&gt; Checker (Pat GhcRn) (Pat GhcTc)
</span><a href="GHC.Tc.Gen.Pat.html#tc_pat"><span class="hs-identifier hs-var">tc_pat</span></a></span><span> </span><span class="annot"><span class="annottext">Scaled ExpSigmaType
</span><a href="#local-6989586621681387507"><span class="hs-identifier hs-var">pat_ty</span></a></span><span> </span><span class="annot"><span class="annottext">PatEnv
</span><a href="#local-6989586621681387506"><span class="hs-identifier hs-var">penv</span></a></span><span> </span><span class="annot"><span class="annottext">Pat GhcRn
</span><a href="#local-6989586621681387267"><span class="hs-identifier hs-var">pat</span></a></span><span> </span><span class="annot"><span class="annottext">TcM r
</span><a href="#local-6989586621681387504"><span class="hs-identifier hs-var">thing_inside</span></a></span><span> </span><span class="hs-special">}</span><span>
</span><span id="line-697"></span><span>    </span><span class="annot"><span class="annottext">HsSplice GhcRn
</span><span class="hs-identifier">_</span></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="annottext">forall a. String -&gt; a
</span><a href="GHC.Utils.Panic.Plain.html#panic"><span class="hs-identifier hs-var">panic</span></a></span><span> </span><span class="annot"><span class="annottext">String
</span><span class="hs-string">&quot;invalid splice in splice pat&quot;</span></span><span>
</span><span id="line-698"></span><span>
</span><span id="line-699"></span><span>
</span><span id="line-700"></span><span class="hs-comment">{-
Note [Hopping the LIE in lazy patterns]
~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~
In a lazy pattern, we must *not* discharge constraints from the RHS
from dictionaries bound in the pattern.  E.g.
        f ~(C x) = 3
We can't discharge the Num constraint from dictionaries bound by
the pattern C!

So we have to make the constraints from thing_inside &quot;hop around&quot;
the pattern.  Hence the captureConstraints and emitConstraints.

The same thing ensures that equality constraints in a lazy match
are not made available in the RHS of the match. For example
        data T a where { T1 :: Int -&gt; T Int; ... }
        f :: T a -&gt; Int -&gt; a
        f ~(T1 i) y = y
It's obviously not sound to refine a to Int in the right
hand side, because the argument might not match T1 at all!

Finally, a lazy pattern should not bind any existential type variables
because they won't be in scope when we do the desugaring


************************************************************************
*                                                                      *
            Pattern signatures   (pat :: type)
*                                                                      *
************************************************************************
-}</span><span>
</span><span id="line-730"></span><span>
</span><span id="line-731"></span><span class="annot"><a href="GHC.Tc.Gen.Pat.html#tcPatSig"><span class="hs-identifier hs-type">tcPatSig</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><span class="hs-identifier hs-type">Bool</span></span><span>                    </span><span class="hs-comment">-- True &lt;=&gt; pattern binding</span><span>
</span><span id="line-732"></span><span>         </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="Language.Haskell.Syntax.Type.html#HsPatSigType"><span class="hs-identifier hs-type">HsPatSigType</span></a></span><span> </span><span class="annot"><a href="GHC.Hs.Extension.html#GhcRn"><span class="hs-identifier hs-type">GhcRn</span></a></span><span>
</span><span id="line-733"></span><span>         </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="GHC.Tc.Utils.TcType.html#ExpSigmaType"><span class="hs-identifier hs-type">ExpSigmaType</span></a></span><span>
</span><span id="line-734"></span><span>         </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="GHC.Tc.Types.html#TcM"><span class="hs-identifier hs-type">TcM</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="GHC.Tc.Utils.TcType.html#TcType"><span class="hs-identifier hs-type">TcType</span></a></span><span class="hs-special">,</span><span>            </span><span class="hs-comment">-- The type to use for &quot;inside&quot; the signature</span><span>
</span><span id="line-735"></span><span>                 </span><span class="hs-special">[</span><span class="hs-special">(</span><span class="annot"><a href="GHC.Types.Name.html#Name"><span class="hs-identifier hs-type">Name</span></a></span><span class="hs-special">,</span><span class="annot"><a href="GHC.Types.Var.html#TcTyVar"><span class="hs-identifier hs-type">TcTyVar</span></a></span><span class="hs-special">)</span><span class="hs-special">]</span><span class="hs-special">,</span><span>  </span><span class="hs-comment">-- The new bit of type environment, binding</span><span>
</span><span id="line-736"></span><span>                                    </span><span class="hs-comment">-- the scoped type variables</span><span>
</span><span id="line-737"></span><span>                 </span><span class="hs-special">[</span><span class="hs-special">(</span><span class="annot"><a href="GHC.Types.Name.html#Name"><span class="hs-identifier hs-type">Name</span></a></span><span class="hs-special">,</span><span class="annot"><a href="GHC.Types.Var.html#TcTyVar"><span class="hs-identifier hs-type">TcTyVar</span></a></span><span class="hs-special">)</span><span class="hs-special">]</span><span class="hs-special">,</span><span>  </span><span class="hs-comment">-- The wildcards</span><span>
</span><span id="line-738"></span><span>                 </span><span class="annot"><a href="GHC.Tc.Types.Evidence.html#HsWrapper"><span class="hs-identifier hs-type">HsWrapper</span></a></span><span class="hs-special">)</span><span>         </span><span class="hs-comment">-- Coercion due to unification with actual ty</span><span>
</span><span id="line-739"></span><span>                                    </span><span class="hs-comment">-- Of shape:  res_ty ~ sig_ty</span><span>
</span><span id="line-740"></span><span id="tcPatSig"><span class="annot"><span class="annottext">tcPatSig :: Bool
-&gt; HsPatSigType GhcRn
-&gt; ExpSigmaType
-&gt; TcM (TcType, [(Name, TyVar)], [(Name, TyVar)], HsWrapper)
</span><a href="GHC.Tc.Gen.Pat.html#tcPatSig"><span class="hs-identifier hs-var hs-var">tcPatSig</span></a></span></span><span> </span><span id="local-6989586621681387263"><span class="annot"><span class="annottext">Bool
</span><a href="#local-6989586621681387263"><span class="hs-identifier hs-var">in_pat_bind</span></a></span></span><span> </span><span id="local-6989586621681387262"><span class="annot"><span class="annottext">HsPatSigType GhcRn
</span><a href="#local-6989586621681387262"><span class="hs-identifier hs-var">sig</span></a></span></span><span> </span><span id="local-6989586621681387261"><span class="annot"><span class="annottext">ExpSigmaType
</span><a href="#local-6989586621681387261"><span class="hs-identifier hs-var">res_ty</span></a></span></span><span>
</span><span id="line-741"></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-keyword">do</span><span>  </span><span class="hs-special">{</span><span> </span><span class="hs-special">(</span><span id="local-6989586621681387260"><span class="annot"><span class="annottext">[(Name, TyVar)]
</span><a href="#local-6989586621681387260"><span class="hs-identifier hs-var">sig_wcs</span></a></span></span><span class="hs-special">,</span><span> </span><span id="local-6989586621681387259"><span class="annot"><span class="annottext">[(Name, TyVar)]
</span><a href="#local-6989586621681387259"><span class="hs-identifier hs-var">sig_tvs</span></a></span></span><span class="hs-special">,</span><span> </span><span id="local-6989586621681387258"><span class="annot"><span class="annottext">TcType
</span><a href="#local-6989586621681387258"><span class="hs-identifier hs-var">sig_ty</span></a></span></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">UserTypeCtxt
-&gt; HoleMode
-&gt; HsPatSigType GhcRn
-&gt; ContextKind
-&gt; TcM ([(Name, TyVar)], [(Name, TyVar)], TcType)
</span><a href="GHC.Tc.Gen.HsType.html#tcHsPatSigType"><span class="hs-identifier hs-var">tcHsPatSigType</span></a></span><span> </span><span class="annot"><span class="annottext">UserTypeCtxt
</span><a href="GHC.Tc.Types.Origin.html#PatSigCtxt"><span class="hs-identifier hs-var">PatSigCtxt</span></a></span><span> </span><span class="annot"><span class="annottext">HoleMode
</span><a href="GHC.Tc.Gen.HsType.html#HM_Sig"><span class="hs-identifier hs-var">HM_Sig</span></a></span><span> </span><span class="annot"><span class="annottext">HsPatSigType GhcRn
</span><a href="#local-6989586621681387262"><span class="hs-identifier hs-var">sig</span></a></span><span> </span><span class="annot"><span class="annottext">ContextKind
</span><a href="GHC.Tc.Gen.HsType.html#OpenKind"><span class="hs-identifier hs-var">OpenKind</span></a></span><span>
</span><span id="line-742"></span><span>        </span><span class="hs-comment">-- sig_tvs are the type variables free in 'sig',</span><span>
</span><span id="line-743"></span><span>        </span><span class="hs-comment">-- and not already in scope. These are the ones</span><span>
</span><span id="line-744"></span><span>        </span><span class="hs-comment">-- that should be brought into scope</span><span>
</span><span id="line-745"></span><span>
</span><span id="line-746"></span><span>        </span><span class="hs-special">;</span><span> </span><span class="hs-keyword">if</span><span> </span><span class="annot"><span class="annottext">forall (t :: * -&gt; *) a. Foldable t =&gt; t a -&gt; Bool
</span><a href="../../base-4.16.4.0/src/Data-Foldable.html#null"><span class="hs-identifier hs-var">null</span></a></span><span> </span><span class="annot"><span class="annottext">[(Name, TyVar)]
</span><a href="#local-6989586621681387259"><span class="hs-identifier hs-var">sig_tvs</span></a></span><span> </span><span class="hs-keyword">then</span><span> </span><span class="hs-keyword">do</span><span> </span><span class="hs-special">{</span><span>
</span><span id="line-747"></span><span>                </span><span class="hs-comment">-- Just do the subsumption check and return</span><span>
</span><span id="line-748"></span><span>                  </span><span id="local-6989586621681387252"><span class="annot"><span class="annottext">HsWrapper
</span><a href="#local-6989586621681387252"><span class="hs-identifier hs-var">wrap</span></a></span></span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">forall a. (TidyEnv -&gt; TcM (TidyEnv, SDoc)) -&gt; TcM a -&gt; TcM a
</span><a href="GHC.Tc.Utils.Monad.html#addErrCtxtM"><span class="hs-identifier hs-var">addErrCtxtM</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">TcType -&gt; TidyEnv -&gt; TcM (TidyEnv, SDoc)
</span><a href="#local-6989586621681387250"><span class="hs-identifier hs-var">mk_msg</span></a></span><span> </span><span class="annot"><span class="annottext">TcType
</span><a href="#local-6989586621681387258"><span class="hs-identifier hs-var">sig_ty</span></a></span><span class="hs-special">)</span><span> </span><span class="annot"><span class="annottext">forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><a href="../../base-4.16.4.0/src/GHC-Base.html#%24"><span class="hs-operator hs-var">$</span></a></span><span>
</span><span id="line-749"></span><span>                          </span><span class="annot"><span class="annottext">CtOrigin -&gt; UserTypeCtxt -&gt; ExpSigmaType -&gt; TcType -&gt; TcM HsWrapper
</span><a href="GHC.Tc.Utils.Unify.html#tcSubTypePat"><span class="hs-identifier hs-var">tcSubTypePat</span></a></span><span> </span><span class="annot"><span class="annottext">CtOrigin
</span><a href="GHC.Tc.Types.Origin.html#PatSigOrigin"><span class="hs-identifier hs-var">PatSigOrigin</span></a></span><span> </span><span class="annot"><span class="annottext">UserTypeCtxt
</span><a href="GHC.Tc.Types.Origin.html#PatSigCtxt"><span class="hs-identifier hs-var">PatSigCtxt</span></a></span><span> </span><span class="annot"><span class="annottext">ExpSigmaType
</span><a href="#local-6989586621681387261"><span class="hs-identifier hs-var">res_ty</span></a></span><span> </span><span class="annot"><span class="annottext">TcType
</span><a href="#local-6989586621681387258"><span class="hs-identifier hs-var">sig_ty</span></a></span><span>
</span><span id="line-750"></span><span>                </span><span class="hs-special">;</span><span> </span><span class="annot"><span class="annottext">forall (m :: * -&gt; *) a. Monad m =&gt; a -&gt; m a
</span><a href="../../base-4.16.4.0/src/GHC-Base.html#return"><span class="hs-identifier hs-var">return</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">TcType
</span><a href="#local-6989586621681387258"><span class="hs-identifier hs-var">sig_ty</span></a></span><span class="hs-special">,</span><span> </span><span class="hs-special">[</span><span class="hs-special">]</span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">[(Name, TyVar)]
</span><a href="#local-6989586621681387260"><span class="hs-identifier hs-var">sig_wcs</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">HsWrapper
</span><a href="#local-6989586621681387252"><span class="hs-identifier hs-var">wrap</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-751"></span><span>        </span><span class="hs-special">}</span><span> </span><span class="hs-keyword">else</span><span> </span><span class="hs-keyword">do</span><span>
</span><span id="line-752"></span><span>                </span><span class="hs-comment">-- Type signature binds at least one scoped type variable</span><span>
</span><span id="line-753"></span><span>
</span><span id="line-754"></span><span>                </span><span class="hs-comment">-- A pattern binding cannot bind scoped type variables</span><span>
</span><span id="line-755"></span><span>                </span><span class="hs-comment">-- It is more convenient to make the test here</span><span>
</span><span id="line-756"></span><span>                </span><span class="hs-comment">-- than in the renamer</span><span>
</span><span id="line-757"></span><span>        </span><span class="hs-special">{</span><span> </span><span class="annot"><span class="annottext">forall (f :: * -&gt; *). Applicative f =&gt; Bool -&gt; f () -&gt; f ()
</span><a href="../../base-4.16.4.0/src/GHC-Base.html#when"><span class="hs-identifier hs-var">when</span></a></span><span> </span><span class="annot"><span class="annottext">Bool
</span><a href="#local-6989586621681387263"><span class="hs-identifier hs-var">in_pat_bind</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">SDoc -&gt; TcRn ()
</span><a href="GHC.Tc.Utils.Monad.html#addErr"><span class="hs-identifier hs-var">addErr</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">[(Name, TyVar)] -&gt; SDoc
</span><a href="GHC.Tc.Gen.Pat.html#patBindSigErr"><span class="hs-identifier hs-var">patBindSigErr</span></a></span><span> </span><span class="annot"><span class="annottext">[(Name, TyVar)]
</span><a href="#local-6989586621681387259"><span class="hs-identifier hs-var">sig_tvs</span></a></span><span class="hs-special">)</span><span class="hs-special">)</span><span>
</span><span id="line-758"></span><span>
</span><span id="line-759"></span><span>        </span><span class="hs-comment">-- Now do a subsumption check of the pattern signature against res_ty</span><span>
</span><span id="line-760"></span><span>        </span><span class="hs-special">;</span><span> </span><span id="local-6989586621681387245"><span class="annot"><span class="annottext">HsWrapper
</span><a href="#local-6989586621681387245"><span class="hs-identifier hs-var">wrap</span></a></span></span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">forall a. (TidyEnv -&gt; TcM (TidyEnv, SDoc)) -&gt; TcM a -&gt; TcM a
</span><a href="GHC.Tc.Utils.Monad.html#addErrCtxtM"><span class="hs-identifier hs-var">addErrCtxtM</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">TcType -&gt; TidyEnv -&gt; TcM (TidyEnv, SDoc)
</span><a href="#local-6989586621681387250"><span class="hs-identifier hs-var">mk_msg</span></a></span><span> </span><span class="annot"><span class="annottext">TcType
</span><a href="#local-6989586621681387258"><span class="hs-identifier hs-var">sig_ty</span></a></span><span class="hs-special">)</span><span> </span><span class="annot"><span class="annottext">forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><a href="../../base-4.16.4.0/src/GHC-Base.html#%24"><span class="hs-operator hs-var">$</span></a></span><span>
</span><span id="line-761"></span><span>                  </span><span class="annot"><span class="annottext">CtOrigin -&gt; UserTypeCtxt -&gt; ExpSigmaType -&gt; TcType -&gt; TcM HsWrapper
</span><a href="GHC.Tc.Utils.Unify.html#tcSubTypePat"><span class="hs-identifier hs-var">tcSubTypePat</span></a></span><span> </span><span class="annot"><span class="annottext">CtOrigin
</span><a href="GHC.Tc.Types.Origin.html#PatSigOrigin"><span class="hs-identifier hs-var">PatSigOrigin</span></a></span><span> </span><span class="annot"><span class="annottext">UserTypeCtxt
</span><a href="GHC.Tc.Types.Origin.html#PatSigCtxt"><span class="hs-identifier hs-var">PatSigCtxt</span></a></span><span> </span><span class="annot"><span class="annottext">ExpSigmaType
</span><a href="#local-6989586621681387261"><span class="hs-identifier hs-var">res_ty</span></a></span><span> </span><span class="annot"><span class="annottext">TcType
</span><a href="#local-6989586621681387258"><span class="hs-identifier hs-var">sig_ty</span></a></span><span>
</span><span id="line-762"></span><span>
</span><span id="line-763"></span><span>        </span><span class="hs-comment">-- Phew!</span><span>
</span><span id="line-764"></span><span>        </span><span class="hs-special">;</span><span> </span><span class="annot"><span class="annottext">forall (m :: * -&gt; *) a. Monad m =&gt; a -&gt; m a
</span><a href="../../base-4.16.4.0/src/GHC-Base.html#return"><span class="hs-identifier hs-var">return</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">TcType
</span><a href="#local-6989586621681387258"><span class="hs-identifier hs-var">sig_ty</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">[(Name, TyVar)]
</span><a href="#local-6989586621681387259"><span class="hs-identifier hs-var">sig_tvs</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">[(Name, TyVar)]
</span><a href="#local-6989586621681387260"><span class="hs-identifier hs-var">sig_wcs</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">HsWrapper
</span><a href="#local-6989586621681387245"><span class="hs-identifier hs-var">wrap</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-765"></span><span>        </span><span class="hs-special">}</span><span> </span><span class="hs-special">}</span><span>
</span><span id="line-766"></span><span>  </span><span class="hs-keyword">where</span><span>
</span><span id="line-767"></span><span>    </span><span id="local-6989586621681387250"><span class="annot"><span class="annottext">mk_msg :: TcType -&gt; TidyEnv -&gt; TcM (TidyEnv, SDoc)
</span><a href="#local-6989586621681387250"><span class="hs-identifier hs-var hs-var">mk_msg</span></a></span></span><span> </span><span id="local-6989586621681387244"><span class="annot"><span class="annottext">TcType
</span><a href="#local-6989586621681387244"><span class="hs-identifier hs-var">sig_ty</span></a></span></span><span> </span><span id="local-6989586621681387243"><span class="annot"><span class="annottext">TidyEnv
</span><a href="#local-6989586621681387243"><span class="hs-identifier hs-var">tidy_env</span></a></span></span><span>
</span><span id="line-768"></span><span>       </span><span class="hs-glyph">=</span><span> </span><span class="hs-keyword">do</span><span> </span><span class="hs-special">{</span><span> </span><span class="hs-special">(</span><span id="local-6989586621681387242"><span class="annot"><span class="annottext">TidyEnv
</span><a href="#local-6989586621681387242"><span class="hs-identifier hs-var">tidy_env</span></a></span></span><span class="hs-special">,</span><span> </span><span id="local-6989586621681387241"><span class="annot"><span class="annottext">TcType
</span><a href="#local-6989586621681387241"><span class="hs-identifier hs-var">sig_ty</span></a></span></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">TidyEnv -&gt; TcType -&gt; TcM (TidyEnv, TcType)
</span><a href="GHC.Tc.Utils.TcMType.html#zonkTidyTcType"><span class="hs-identifier hs-var">zonkTidyTcType</span></a></span><span> </span><span class="annot"><span class="annottext">TidyEnv
</span><a href="#local-6989586621681387243"><span class="hs-identifier hs-var">tidy_env</span></a></span><span> </span><span class="annot"><span class="annottext">TcType
</span><a href="#local-6989586621681387244"><span class="hs-identifier hs-var">sig_ty</span></a></span><span>
</span><span id="line-769"></span><span>            </span><span class="hs-special">;</span><span> </span><span id="local-6989586621681387239"><span class="annot"><span class="annottext">TcType
</span><a href="#local-6989586621681387239"><span class="hs-identifier hs-var">res_ty</span></a></span></span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">ExpSigmaType -&gt; TcM TcType
</span><a href="GHC.Tc.Utils.TcMType.html#readExpType"><span class="hs-identifier hs-var">readExpType</span></a></span><span> </span><span class="annot"><span class="annottext">ExpSigmaType
</span><a href="#local-6989586621681387261"><span class="hs-identifier hs-var">res_ty</span></a></span><span>   </span><span class="hs-comment">-- should be filled in by now</span><span>
</span><span id="line-770"></span><span>            </span><span class="hs-special">;</span><span> </span><span class="hs-special">(</span><span id="local-6989586621681387238"><span class="annot"><span class="annottext">TidyEnv
</span><a href="#local-6989586621681387238"><span class="hs-identifier hs-var">tidy_env</span></a></span></span><span class="hs-special">,</span><span> </span><span id="local-6989586621681387237"><span class="annot"><span class="annottext">TcType
</span><a href="#local-6989586621681387237"><span class="hs-identifier hs-var">res_ty</span></a></span></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">TidyEnv -&gt; TcType -&gt; TcM (TidyEnv, TcType)
</span><a href="GHC.Tc.Utils.TcMType.html#zonkTidyTcType"><span class="hs-identifier hs-var">zonkTidyTcType</span></a></span><span> </span><span class="annot"><span class="annottext">TidyEnv
</span><a href="#local-6989586621681387242"><span class="hs-identifier hs-var">tidy_env</span></a></span><span> </span><span class="annot"><span class="annottext">TcType
</span><a href="#local-6989586621681387239"><span class="hs-identifier hs-var">res_ty</span></a></span><span>
</span><span id="line-771"></span><span>            </span><span class="hs-special">;</span><span> </span><span class="hs-keyword">let</span><span> </span><span id="local-6989586621681387236"><span class="annot"><span class="annottext">msg :: SDoc
</span><a href="#local-6989586621681387236"><span class="hs-identifier hs-var hs-var">msg</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">[SDoc] -&gt; SDoc
</span><a href="GHC.Utils.Outputable.html#vcat"><span class="hs-identifier hs-var">vcat</span></a></span><span> </span><span class="hs-special">[</span><span> </span><span class="annot"><span class="annottext">SDoc -&gt; Int -&gt; SDoc -&gt; SDoc
</span><a href="GHC.Utils.Outputable.html#hang"><span class="hs-identifier hs-var">hang</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">String -&gt; SDoc
</span><a href="GHC.Utils.Outputable.html#text"><span class="hs-identifier hs-var">text</span></a></span><span> </span><span class="annot"><span class="annottext">String
</span><span class="hs-string">&quot;When checking that the pattern signature:&quot;</span></span><span class="hs-special">)</span><span>
</span><span id="line-772"></span><span>                                  </span><span class="annot"><span class="annottext">Int
</span><span class="hs-number">4</span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">forall a. Outputable a =&gt; a -&gt; SDoc
</span><a href="GHC.Utils.Outputable.html#ppr"><span class="hs-identifier hs-var">ppr</span></a></span><span> </span><span class="annot"><span class="annottext">TcType
</span><a href="#local-6989586621681387241"><span class="hs-identifier hs-var">sig_ty</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-773"></span><span>                             </span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">Int -&gt; SDoc -&gt; SDoc
</span><a href="GHC.Utils.Outputable.html#nest"><span class="hs-identifier hs-var">nest</span></a></span><span> </span><span class="annot"><span class="annottext">Int
</span><span class="hs-number">2</span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">SDoc -&gt; Int -&gt; SDoc -&gt; SDoc
</span><a href="GHC.Utils.Outputable.html#hang"><span class="hs-identifier hs-var">hang</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">String -&gt; SDoc
</span><a href="GHC.Utils.Outputable.html#text"><span class="hs-identifier hs-var">text</span></a></span><span> </span><span class="annot"><span class="annottext">String
</span><span class="hs-string">&quot;fits the type of its context:&quot;</span></span><span class="hs-special">)</span><span>
</span><span id="line-774"></span><span>                                          </span><span class="annot"><span class="annottext">Int
</span><span class="hs-number">2</span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">forall a. Outputable a =&gt; a -&gt; SDoc
</span><a href="GHC.Utils.Outputable.html#ppr"><span class="hs-identifier hs-var">ppr</span></a></span><span> </span><span class="annot"><span class="annottext">TcType
</span><a href="#local-6989586621681387237"><span class="hs-identifier hs-var">res_ty</span></a></span><span class="hs-special">)</span><span class="hs-special">)</span><span> </span><span class="hs-special">]</span><span>
</span><span id="line-775"></span><span>            </span><span class="hs-special">;</span><span> </span><span class="annot"><span class="annottext">forall (m :: * -&gt; *) a. Monad m =&gt; a -&gt; m a
</span><a href="../../base-4.16.4.0/src/GHC-Base.html#return"><span class="hs-identifier hs-var">return</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">TidyEnv
</span><a href="#local-6989586621681387238"><span class="hs-identifier hs-var">tidy_env</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">SDoc
</span><a href="#local-6989586621681387236"><span class="hs-identifier hs-var">msg</span></a></span><span class="hs-special">)</span><span> </span><span class="hs-special">}</span><span>
</span><span id="line-776"></span><span>
</span><span id="line-777"></span><span class="annot"><a href="GHC.Tc.Gen.Pat.html#patBindSigErr"><span class="hs-identifier hs-type">patBindSigErr</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="hs-special">[</span><span class="hs-special">(</span><span class="annot"><a href="GHC.Types.Name.html#Name"><span class="hs-identifier hs-type">Name</span></a></span><span class="hs-special">,</span><span class="annot"><a href="GHC.Types.Var.html#TcTyVar"><span class="hs-identifier hs-type">TcTyVar</span></a></span><span class="hs-special">)</span><span class="hs-special">]</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="GHC.Utils.Outputable.html#SDoc"><span class="hs-identifier hs-type">SDoc</span></a></span><span>
</span><span id="line-778"></span><span id="patBindSigErr"><span class="annot"><span class="annottext">patBindSigErr :: [(Name, TyVar)] -&gt; SDoc
</span><a href="GHC.Tc.Gen.Pat.html#patBindSigErr"><span class="hs-identifier hs-var hs-var">patBindSigErr</span></a></span></span><span> </span><span id="local-6989586621681387233"><span class="annot"><span class="annottext">[(Name, TyVar)]
</span><a href="#local-6989586621681387233"><span class="hs-identifier hs-var">sig_tvs</span></a></span></span><span>
</span><span id="line-779"></span><span>  </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">SDoc -&gt; Int -&gt; SDoc -&gt; SDoc
</span><a href="GHC.Utils.Outputable.html#hang"><span class="hs-identifier hs-var">hang</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">String -&gt; SDoc
</span><a href="GHC.Utils.Outputable.html#text"><span class="hs-identifier hs-var">text</span></a></span><span> </span><span class="annot"><span class="annottext">String
</span><span class="hs-string">&quot;You cannot bind scoped type variable&quot;</span></span><span> </span><span class="annot"><span class="annottext">SDoc -&gt; SDoc -&gt; SDoc
</span><a href="GHC.Utils.Outputable.html#%3C%3E"><span class="hs-operator hs-var">&lt;&gt;</span></a></span><span> </span><span class="annot"><span class="annottext">forall a. [a] -&gt; SDoc
</span><a href="GHC.Utils.Outputable.html#plural"><span class="hs-identifier hs-var">plural</span></a></span><span> </span><span class="annot"><span class="annottext">[(Name, TyVar)]
</span><a href="#local-6989586621681387233"><span class="hs-identifier hs-var">sig_tvs</span></a></span><span>
</span><span id="line-780"></span><span>          </span><span class="annot"><span class="annottext">SDoc -&gt; SDoc -&gt; SDoc
</span><a href="GHC.Utils.Outputable.html#%3C%2B%3E"><span class="hs-operator hs-var">&lt;+&gt;</span></a></span><span> </span><span class="annot"><span class="annottext">forall a. Outputable a =&gt; [a] -&gt; SDoc
</span><a href="GHC.Utils.Outputable.html#pprQuotedList"><span class="hs-identifier hs-var">pprQuotedList</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">forall a b. (a -&gt; b) -&gt; [a] -&gt; [b]
</span><a href="../../base-4.16.4.0/src/GHC-Base.html#map"><span class="hs-identifier hs-var">map</span></a></span><span> </span><span class="annot"><span class="annottext">forall a b. (a, b) -&gt; a
</span><a href="../../base-4.16.4.0/src/Data-Tuple.html#fst"><span class="hs-identifier hs-var">fst</span></a></span><span> </span><span class="annot"><span class="annottext">[(Name, TyVar)]
</span><a href="#local-6989586621681387233"><span class="hs-identifier hs-var">sig_tvs</span></a></span><span class="hs-special">)</span><span class="hs-special">)</span><span>
</span><span id="line-781"></span><span>       </span><span class="annot"><span class="annottext">Int
</span><span class="hs-number">2</span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">String -&gt; SDoc
</span><a href="GHC.Utils.Outputable.html#text"><span class="hs-identifier hs-var">text</span></a></span><span> </span><span class="annot"><span class="annottext">String
</span><span class="hs-string">&quot;in a pattern binding signature&quot;</span></span><span class="hs-special">)</span><span>
</span><span id="line-782"></span><span>
</span><span id="line-783"></span><span>
</span><span id="line-784"></span><span class="hs-comment">{- *********************************************************************
*                                                                      *
        Most of the work for constructors is here
        (the rest is in the ConPatIn case of tc_pat)
*                                                                      *
************************************************************************

[Pattern matching indexed data types]
~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~
Consider the following declarations:

  data family Map k :: * -&gt; *
  data instance Map (a, b) v = MapPair (Map a (Pair b v))

and a case expression

  case x :: Map (Int, c) w of MapPair m -&gt; ...

As explained by [Wrappers for data instance tycons] in GHC.Types.Id.Make, the
worker/wrapper types for MapPair are

  $WMapPair :: forall a b v. Map a (Map a b v) -&gt; Map (a, b) v
  $wMapPair :: forall a b v. Map a (Map a b v) -&gt; :R123Map a b v

So, the type of the scrutinee is Map (Int, c) w, but the tycon of MapPair is
:R123Map, which means the straight use of boxySplitTyConApp would give a type
error.  Hence, the smart wrapper function boxySplitTyConAppWithFamily calls
boxySplitTyConApp with the family tycon Map instead, which gives us the family
type list {(Int, c), w}.  To get the correct split for :R123Map, we need to
unify the family type list {(Int, c), w} with the instance types {(a, b), v}
(provided by tyConFamInst_maybe together with the family tycon).  This
unification yields the substitution [a -&gt; Int, b -&gt; c, v -&gt; w], which gives us
the split arguments for the representation tycon :R123Map as {Int, c, w}

In other words, boxySplitTyConAppWithFamily implicitly takes the coercion

  Co123Map a b v :: {Map (a, b) v ~ :R123Map a b v}

moving between representation and family type into account.  To produce type
correct Core, this coercion needs to be used to case the type of the scrutinee
from the family to the representation type.  This is achieved by
unwrapFamInstScrutinee using a CoPat around the result pattern.

Now it might appear seem as if we could have used the previous GADT type
refinement infrastructure of refineAlt and friends instead of the explicit
unification and CoPat generation.  However, that would be wrong.  Why?  The
whole point of GADT refinement is that the refinement is local to the case
alternative.  In contrast, the substitution generated by the unification of
the family type list and instance types needs to be propagated to the outside.
Imagine that in the above example, the type of the scrutinee would have been
(Map x w), then we would have unified {x, w} with {(a, b), v}, yielding the
substitution [x -&gt; (a, b), v -&gt; w].  In contrast to GADT matching, the
instantiation of x with (a, b) must be global; ie, it must be valid in *all*
alternatives of the case expression, whereas in the GADT case it might vary
between alternatives.

RIP GADT refinement: refinements have been replaced by the use of explicit
equality constraints that are used in conjunction with implication constraints
to express the local scope of GADT refinements.

Note [Freshen existentials]
~~~~~~~~~~~~~~~~~~~~~~~~~~~
It is essential that these existentials are freshened.
Otherwise, if we have something like
  case (a :: Ex, b :: Ex) of (MkEx ..., MkEx ...) -&gt; ...
we'll give both unpacked existential variables the
same name, leading to shadowing.

-}</span><span>
</span><span id="line-853"></span><span>
</span><span id="line-854"></span><span class="hs-comment">--      Running example:</span><span>
</span><span id="line-855"></span><span class="hs-comment">-- MkT :: forall a b c. (a~[b]) =&gt; b -&gt; c -&gt; T a</span><span>
</span><span id="line-856"></span><span class="hs-comment">--       with scrutinee of type (T ty)</span><span>
</span><span id="line-857"></span><span>
</span><span id="line-858"></span><span id="local-6989586621681388040"><span class="annot"><a href="GHC.Tc.Gen.Pat.html#tcConPat"><span class="hs-identifier hs-type">tcConPat</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><a href="GHC.Tc.Gen.Pat.html#PatEnv"><span class="hs-identifier hs-type">PatEnv</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="GHC.Parser.Annotation.html#LocatedN"><span class="hs-identifier hs-type">LocatedN</span></a></span><span> </span><span class="annot"><a href="GHC.Types.Name.html#Name"><span class="hs-identifier hs-type">Name</span></a></span><span>
</span><span id="line-859"></span><span>         </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="GHC.Core.TyCo.Rep.html#Scaled"><span class="hs-identifier hs-type">Scaled</span></a></span><span> </span><span class="annot"><a href="GHC.Tc.Utils.TcType.html#ExpSigmaType"><span class="hs-identifier hs-type">ExpSigmaType</span></a></span><span>    </span><span class="hs-comment">-- Type of the pattern</span><span>
</span><span id="line-860"></span><span>         </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="Language.Haskell.Syntax.Pat.html#HsConPatDetails"><span class="hs-identifier hs-type">HsConPatDetails</span></a></span><span> </span><span class="annot"><a href="GHC.Hs.Extension.html#GhcRn"><span class="hs-identifier hs-type">GhcRn</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="GHC.Tc.Types.html#TcM"><span class="hs-identifier hs-type">TcM</span></a></span><span> </span><span class="annot"><a href="#local-6989586621681388040"><span class="hs-identifier hs-type">a</span></a></span><span>
</span><span id="line-861"></span><span>         </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="GHC.Tc.Types.html#TcM"><span class="hs-identifier hs-type">TcM</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="Language.Haskell.Syntax.Pat.html#Pat"><span class="hs-identifier hs-type">Pat</span></a></span><span> </span><span class="annot"><a href="GHC.Hs.Extension.html#GhcTc"><span class="hs-identifier hs-type">GhcTc</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><a href="#local-6989586621681388040"><span class="hs-identifier hs-type">a</span></a></span><span class="hs-special">)</span></span><span>
</span><span id="line-862"></span><span id="tcConPat"><span class="annot"><span class="annottext">tcConPat :: forall a.
PatEnv
-&gt; GenLocated SrcSpanAnnN Name
-&gt; Scaled ExpSigmaType
-&gt; HsConPatDetails GhcRn
-&gt; TcM a
-&gt; TcM (Pat GhcTc, a)
</span><a href="GHC.Tc.Gen.Pat.html#tcConPat"><span class="hs-identifier hs-var hs-var">tcConPat</span></a></span></span><span> </span><span id="local-6989586621681387227"><span class="annot"><span class="annottext">PatEnv
</span><a href="#local-6989586621681387227"><span class="hs-identifier hs-var">penv</span></a></span></span><span> </span><span id="local-6989586621681387226"><span class="annot"><span class="annottext">con_lname :: GenLocated SrcSpanAnnN Name
</span><a href="#local-6989586621681387226"><span class="hs-identifier hs-var">con_lname</span></a></span></span><span class="hs-glyph">@</span><span class="hs-special">(</span><span class="annot"><a href="GHC.Types.SrcLoc.html#L"><span class="hs-identifier hs-type">L</span></a></span><span> </span><span class="annot"><span class="annottext">SrcSpanAnnN
</span><span class="hs-identifier">_</span></span><span> </span><span id="local-6989586621681387225"><span class="annot"><span class="annottext">Name
</span><a href="#local-6989586621681387225"><span class="hs-identifier hs-var">con_name</span></a></span></span><span class="hs-special">)</span><span> </span><span id="local-6989586621681387224"><span class="annot"><span class="annottext">Scaled ExpSigmaType
</span><a href="#local-6989586621681387224"><span class="hs-identifier hs-var">pat_ty</span></a></span></span><span> </span><span id="local-6989586621681387223"><span class="annot"><span class="annottext">HsConPatDetails GhcRn
</span><a href="#local-6989586621681387223"><span class="hs-identifier hs-var">arg_pats</span></a></span></span><span> </span><span id="local-6989586621681387222"><span class="annot"><span class="annottext">TcM a
</span><a href="#local-6989586621681387222"><span class="hs-identifier hs-var">thing_inside</span></a></span></span><span>
</span><span id="line-863"></span><span>  </span><span class="hs-glyph">=</span><span> </span><span class="hs-keyword">do</span><span>  </span><span class="hs-special">{</span><span> </span><span id="local-6989586621681387221"><span class="annot"><span class="annottext">ConLike
</span><a href="#local-6989586621681387221"><span class="hs-identifier hs-var">con_like</span></a></span></span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">Name -&gt; TcM ConLike
</span><a href="GHC.Tc.Utils.Env.html#tcLookupConLike"><span class="hs-identifier hs-var">tcLookupConLike</span></a></span><span> </span><span class="annot"><span class="annottext">Name
</span><a href="#local-6989586621681387225"><span class="hs-identifier hs-var">con_name</span></a></span><span>
</span><span id="line-864"></span><span>        </span><span class="hs-special">;</span><span> </span><span class="hs-keyword">case</span><span> </span><span class="annot"><span class="annottext">ConLike
</span><a href="#local-6989586621681387221"><span class="hs-identifier hs-var">con_like</span></a></span><span> </span><span class="hs-keyword">of</span><span>
</span><span id="line-865"></span><span>            </span><span class="annot"><a href="GHC.Core.ConLike.html#RealDataCon"><span class="hs-identifier hs-type">RealDataCon</span></a></span><span> </span><span id="local-6989586621681387218"><span class="annot"><span class="annottext">DataCon
</span><a href="#local-6989586621681387218"><span class="hs-identifier hs-var">data_con</span></a></span></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="annottext">forall a.
PatEnv
-&gt; GenLocated SrcSpanAnnN Name
-&gt; DataCon
-&gt; Scaled ExpSigmaType
-&gt; HsConPatDetails GhcRn
-&gt; TcM a
-&gt; TcM (Pat GhcTc, a)
</span><a href="GHC.Tc.Gen.Pat.html#tcDataConPat"><span class="hs-identifier hs-var">tcDataConPat</span></a></span><span> </span><span class="annot"><span class="annottext">PatEnv
</span><a href="#local-6989586621681387227"><span class="hs-identifier hs-var">penv</span></a></span><span> </span><span class="annot"><span class="annottext">GenLocated SrcSpanAnnN Name
</span><a href="#local-6989586621681387226"><span class="hs-identifier hs-var">con_lname</span></a></span><span> </span><span class="annot"><span class="annottext">DataCon
</span><a href="#local-6989586621681387218"><span class="hs-identifier hs-var">data_con</span></a></span><span>
</span><span id="line-866"></span><span>                                                 </span><span class="annot"><span class="annottext">Scaled ExpSigmaType
</span><a href="#local-6989586621681387224"><span class="hs-identifier hs-var">pat_ty</span></a></span><span> </span><span class="annot"><span class="annottext">HsConPatDetails GhcRn
</span><a href="#local-6989586621681387223"><span class="hs-identifier hs-var">arg_pats</span></a></span><span> </span><span class="annot"><span class="annottext">TcM a
</span><a href="#local-6989586621681387222"><span class="hs-identifier hs-var">thing_inside</span></a></span><span>
</span><span id="line-867"></span><span>            </span><span class="annot"><a href="GHC.Core.ConLike.html#PatSynCon"><span class="hs-identifier hs-type">PatSynCon</span></a></span><span> </span><span id="local-6989586621681387215"><span class="annot"><span class="annottext">PatSyn
</span><a href="#local-6989586621681387215"><span class="hs-identifier hs-var">pat_syn</span></a></span></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="annottext">forall a.
PatEnv
-&gt; GenLocated SrcSpanAnnN Name
-&gt; PatSyn
-&gt; Scaled ExpSigmaType
-&gt; HsConPatDetails GhcRn
-&gt; TcM a
-&gt; TcM (Pat GhcTc, a)
</span><a href="GHC.Tc.Gen.Pat.html#tcPatSynPat"><span class="hs-identifier hs-var">tcPatSynPat</span></a></span><span> </span><span class="annot"><span class="annottext">PatEnv
</span><a href="#local-6989586621681387227"><span class="hs-identifier hs-var">penv</span></a></span><span> </span><span class="annot"><span class="annottext">GenLocated SrcSpanAnnN Name
</span><a href="#local-6989586621681387226"><span class="hs-identifier hs-var">con_lname</span></a></span><span> </span><span class="annot"><span class="annottext">PatSyn
</span><a href="#local-6989586621681387215"><span class="hs-identifier hs-var">pat_syn</span></a></span><span>
</span><span id="line-868"></span><span>                                             </span><span class="annot"><span class="annottext">Scaled ExpSigmaType
</span><a href="#local-6989586621681387224"><span class="hs-identifier hs-var">pat_ty</span></a></span><span> </span><span class="annot"><span class="annottext">HsConPatDetails GhcRn
</span><a href="#local-6989586621681387223"><span class="hs-identifier hs-var">arg_pats</span></a></span><span> </span><span class="annot"><span class="annottext">TcM a
</span><a href="#local-6989586621681387222"><span class="hs-identifier hs-var">thing_inside</span></a></span><span>
</span><span id="line-869"></span><span>        </span><span class="hs-special">}</span><span>
</span><span id="line-870"></span><span>
</span><span id="line-871"></span><span id="local-6989586621681387997"><span class="annot"><a href="GHC.Tc.Gen.Pat.html#tcDataConPat"><span class="hs-identifier hs-type">tcDataConPat</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><a href="GHC.Tc.Gen.Pat.html#PatEnv"><span class="hs-identifier hs-type">PatEnv</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="GHC.Parser.Annotation.html#LocatedN"><span class="hs-identifier hs-type">LocatedN</span></a></span><span> </span><span class="annot"><a href="GHC.Types.Name.html#Name"><span class="hs-identifier hs-type">Name</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="GHC.Core.DataCon.html#DataCon"><span class="hs-identifier hs-type">DataCon</span></a></span><span>
</span><span id="line-872"></span><span>             </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="GHC.Core.TyCo.Rep.html#Scaled"><span class="hs-identifier hs-type">Scaled</span></a></span><span> </span><span class="annot"><a href="GHC.Tc.Utils.TcType.html#ExpSigmaType"><span class="hs-identifier hs-type">ExpSigmaType</span></a></span><span>        </span><span class="hs-comment">-- Type of the pattern</span><span>
</span><span id="line-873"></span><span>             </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="Language.Haskell.Syntax.Pat.html#HsConPatDetails"><span class="hs-identifier hs-type">HsConPatDetails</span></a></span><span> </span><span class="annot"><a href="GHC.Hs.Extension.html#GhcRn"><span class="hs-identifier hs-type">GhcRn</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="GHC.Tc.Types.html#TcM"><span class="hs-identifier hs-type">TcM</span></a></span><span> </span><span class="annot"><a href="#local-6989586621681387997"><span class="hs-identifier hs-type">a</span></a></span><span>
</span><span id="line-874"></span><span>             </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="GHC.Tc.Types.html#TcM"><span class="hs-identifier hs-type">TcM</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="Language.Haskell.Syntax.Pat.html#Pat"><span class="hs-identifier hs-type">Pat</span></a></span><span> </span><span class="annot"><a href="GHC.Hs.Extension.html#GhcTc"><span class="hs-identifier hs-type">GhcTc</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><a href="#local-6989586621681387997"><span class="hs-identifier hs-type">a</span></a></span><span class="hs-special">)</span></span><span>
</span><span id="line-875"></span><span id="tcDataConPat"><span class="annot"><span class="annottext">tcDataConPat :: forall a.
PatEnv
-&gt; GenLocated SrcSpanAnnN Name
-&gt; DataCon
-&gt; Scaled ExpSigmaType
-&gt; HsConPatDetails GhcRn
-&gt; TcM a
-&gt; TcM (Pat GhcTc, a)
</span><a href="GHC.Tc.Gen.Pat.html#tcDataConPat"><span class="hs-identifier hs-var hs-var">tcDataConPat</span></a></span></span><span> </span><span id="local-6989586621681387153"><span class="annot"><span class="annottext">PatEnv
</span><a href="#local-6989586621681387153"><span class="hs-identifier hs-var">penv</span></a></span></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="GHC.Types.SrcLoc.html#L"><span class="hs-identifier hs-type">L</span></a></span><span> </span><span id="local-6989586621681387152"><span class="annot"><span class="annottext">SrcSpanAnnN
</span><a href="#local-6989586621681387152"><span class="hs-identifier hs-var">con_span</span></a></span></span><span> </span><span id="local-6989586621681387151"><span class="annot"><span class="annottext">Name
</span><a href="#local-6989586621681387151"><span class="hs-identifier hs-var">con_name</span></a></span></span><span class="hs-special">)</span><span> </span><span id="local-6989586621681387150"><span class="annot"><span class="annottext">DataCon
</span><a href="#local-6989586621681387150"><span class="hs-identifier hs-var">data_con</span></a></span></span><span> </span><span id="local-6989586621681387149"><span class="annot"><span class="annottext">Scaled ExpSigmaType
</span><a href="#local-6989586621681387149"><span class="hs-identifier hs-var">pat_ty_scaled</span></a></span></span><span>
</span><span id="line-876"></span><span>             </span><span id="local-6989586621681387148"><span class="annot"><span class="annottext">HsConPatDetails GhcRn
</span><a href="#local-6989586621681387148"><span class="hs-identifier hs-var">arg_pats</span></a></span></span><span> </span><span id="local-6989586621681387147"><span class="annot"><span class="annottext">TcM a
</span><a href="#local-6989586621681387147"><span class="hs-identifier hs-var">thing_inside</span></a></span></span><span>
</span><span id="line-877"></span><span>  </span><span class="hs-glyph">=</span><span> </span><span class="hs-keyword">do</span><span>  </span><span class="hs-special">{</span><span> </span><span class="hs-keyword">let</span><span> </span><span id="local-6989586621681387146"><span class="annot"><span class="annottext">tycon :: TyCon
</span><a href="#local-6989586621681387146"><span class="hs-identifier hs-var hs-var">tycon</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">DataCon -&gt; TyCon
</span><a href="GHC.Core.DataCon.html#dataConTyCon"><span class="hs-identifier hs-var">dataConTyCon</span></a></span><span> </span><span class="annot"><span class="annottext">DataCon
</span><a href="#local-6989586621681387150"><span class="hs-identifier hs-var">data_con</span></a></span><span>
</span><span id="line-878"></span><span>                  </span><span class="hs-comment">-- For data families this is the representation tycon</span><span>
</span><span id="line-879"></span><span>              </span><span class="hs-special">(</span><span id="local-6989586621681387144"><span class="annot"><span class="annottext">[TyVar]
</span><a href="#local-6989586621681387144"><span class="hs-identifier hs-var">univ_tvs</span></a></span></span><span class="hs-special">,</span><span> </span><span id="local-6989586621681387143"><span class="annot"><span class="annottext">[TyVar]
</span><a href="#local-6989586621681387143"><span class="hs-identifier hs-var">ex_tvs</span></a></span></span><span class="hs-special">,</span><span> </span><span id="local-6989586621681387142"><span class="annot"><span class="annottext">[EqSpec]
</span><a href="#local-6989586621681387142"><span class="hs-identifier hs-var">eq_spec</span></a></span></span><span class="hs-special">,</span><span> </span><span id="local-6989586621681387141"><span class="annot"><span class="annottext">[TcType]
</span><a href="#local-6989586621681387141"><span class="hs-identifier hs-var">theta</span></a></span></span><span class="hs-special">,</span><span> </span><span id="local-6989586621681387140"><span class="annot"><span class="annottext">[Scaled TcType]
</span><a href="#local-6989586621681387140"><span class="hs-identifier hs-var">arg_tys</span></a></span></span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">TcType
</span><span class="hs-identifier">_</span></span><span class="hs-special">)</span><span>
</span><span id="line-880"></span><span>                </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">DataCon
-&gt; ([TyVar], [TyVar], [EqSpec], [TcType], [Scaled TcType], TcType)
</span><a href="GHC.Core.DataCon.html#dataConFullSig"><span class="hs-identifier hs-var">dataConFullSig</span></a></span><span> </span><span class="annot"><span class="annottext">DataCon
</span><a href="#local-6989586621681387150"><span class="hs-identifier hs-var">data_con</span></a></span><span>
</span><span id="line-881"></span><span>              </span><span id="local-6989586621681387138"><span class="annot"><span class="annottext">header :: GenLocated SrcSpanAnnN ConLike
</span><a href="#local-6989586621681387138"><span class="hs-identifier hs-var hs-var">header</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">forall l e. l -&gt; e -&gt; GenLocated l e
</span><a href="GHC.Types.SrcLoc.html#L"><span class="hs-identifier hs-var">L</span></a></span><span> </span><span class="annot"><span class="annottext">SrcSpanAnnN
</span><a href="#local-6989586621681387152"><span class="hs-identifier hs-var">con_span</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">DataCon -&gt; ConLike
</span><a href="GHC.Core.ConLike.html#RealDataCon"><span class="hs-identifier hs-var">RealDataCon</span></a></span><span> </span><span class="annot"><span class="annottext">DataCon
</span><a href="#local-6989586621681387150"><span class="hs-identifier hs-var">data_con</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-882"></span><span>
</span><span id="line-883"></span><span>          </span><span class="hs-comment">-- Instantiate the constructor type variables [a-&gt;ty]</span><span>
</span><span id="line-884"></span><span>          </span><span class="hs-comment">-- This may involve doing a family-instance coercion,</span><span>
</span><span id="line-885"></span><span>          </span><span class="hs-comment">-- and building a wrapper</span><span>
</span><span id="line-886"></span><span>        </span><span class="hs-special">;</span><span> </span><span class="hs-special">(</span><span id="local-6989586621681387137"><span class="annot"><span class="annottext">HsWrapper
</span><a href="#local-6989586621681387137"><span class="hs-identifier hs-var">wrap</span></a></span></span><span class="hs-special">,</span><span> </span><span id="local-6989586621681387136"><span class="annot"><span class="annottext">[TcType]
</span><a href="#local-6989586621681387136"><span class="hs-identifier hs-var">ctxt_res_tys</span></a></span></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">PatEnv -&gt; TyCon -&gt; Scaled ExpSigmaType -&gt; TcM (HsWrapper, [TcType])
</span><a href="GHC.Tc.Gen.Pat.html#matchExpectedConTy"><span class="hs-identifier hs-var">matchExpectedConTy</span></a></span><span> </span><span class="annot"><span class="annottext">PatEnv
</span><a href="#local-6989586621681387153"><span class="hs-identifier hs-var">penv</span></a></span><span> </span><span class="annot"><span class="annottext">TyCon
</span><a href="#local-6989586621681387146"><span class="hs-identifier hs-var">tycon</span></a></span><span> </span><span class="annot"><span class="annottext">Scaled ExpSigmaType
</span><a href="#local-6989586621681387149"><span class="hs-identifier hs-var">pat_ty_scaled</span></a></span><span>
</span><span id="line-887"></span><span>        </span><span class="hs-special">;</span><span> </span><span id="local-6989586621681387134"><span class="annot"><span class="annottext">TcType
</span><a href="#local-6989586621681387134"><span class="hs-identifier hs-var">pat_ty</span></a></span></span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">ExpSigmaType -&gt; TcM TcType
</span><a href="GHC.Tc.Utils.TcMType.html#readExpType"><span class="hs-identifier hs-var">readExpType</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">forall a. Scaled a -&gt; a
</span><a href="GHC.Core.TyCo.Rep.html#scaledThing"><span class="hs-identifier hs-var">scaledThing</span></a></span><span> </span><span class="annot"><span class="annottext">Scaled ExpSigmaType
</span><a href="#local-6989586621681387149"><span class="hs-identifier hs-var">pat_ty_scaled</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-888"></span><span>
</span><span id="line-889"></span><span>          </span><span class="hs-comment">-- Add the stupid theta</span><span>
</span><span id="line-890"></span><span>        </span><span class="hs-special">;</span><span> </span><span class="annot"><span class="annottext">forall ann a. SrcSpanAnn' ann -&gt; TcRn a -&gt; TcRn a
</span><a href="GHC.Tc.Utils.Monad.html#setSrcSpanA"><span class="hs-identifier hs-var">setSrcSpanA</span></a></span><span> </span><span class="annot"><span class="annottext">SrcSpanAnnN
</span><a href="#local-6989586621681387152"><span class="hs-identifier hs-var">con_span</span></a></span><span> </span><span class="annot"><span class="annottext">forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><a href="../../base-4.16.4.0/src/GHC-Base.html#%24"><span class="hs-operator hs-var">$</span></a></span><span> </span><span class="annot"><span class="annottext">DataCon -&gt; [TcType] -&gt; TcRn ()
</span><a href="GHC.Tc.Gen.Pat.html#addDataConStupidTheta"><span class="hs-identifier hs-var">addDataConStupidTheta</span></a></span><span> </span><span class="annot"><span class="annottext">DataCon
</span><a href="#local-6989586621681387150"><span class="hs-identifier hs-var">data_con</span></a></span><span> </span><span class="annot"><span class="annottext">[TcType]
</span><a href="#local-6989586621681387136"><span class="hs-identifier hs-var">ctxt_res_tys</span></a></span><span>
</span><span id="line-891"></span><span>
</span><span id="line-892"></span><span>        </span><span class="hs-comment">-- Check that this isn't a GADT pattern match</span><span>
</span><span id="line-893"></span><span>        </span><span class="hs-comment">-- in situations in which that isn't allowed.</span><span>
</span><span id="line-894"></span><span>        </span><span class="hs-special">;</span><span> </span><span class="hs-keyword">let</span><span> </span><span id="local-6989586621681387133"><span class="annot"><span class="annottext">all_arg_tys :: [TcType]
</span><a href="#local-6989586621681387133"><span class="hs-identifier hs-var hs-var">all_arg_tys</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">[EqSpec] -&gt; [TcType]
</span><a href="GHC.Core.DataCon.html#eqSpecPreds"><span class="hs-identifier hs-var">eqSpecPreds</span></a></span><span> </span><span class="annot"><span class="annottext">[EqSpec]
</span><a href="#local-6989586621681387142"><span class="hs-identifier hs-var">eq_spec</span></a></span><span> </span><span class="annot"><span class="annottext">forall a. [a] -&gt; [a] -&gt; [a]
</span><a href="../../base-4.16.4.0/src/GHC-Base.html#%2B%2B"><span class="hs-operator hs-var">++</span></a></span><span> </span><span class="annot"><span class="annottext">[TcType]
</span><a href="#local-6989586621681387141"><span class="hs-identifier hs-var">theta</span></a></span><span> </span><span class="annot"><span class="annottext">forall a. [a] -&gt; [a] -&gt; [a]
</span><a href="../../base-4.16.4.0/src/GHC-Base.html#%2B%2B"><span class="hs-operator hs-var">++</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">forall a b. (a -&gt; b) -&gt; [a] -&gt; [b]
</span><a href="../../base-4.16.4.0/src/GHC-Base.html#map"><span class="hs-identifier hs-var">map</span></a></span><span> </span><span class="annot"><span class="annottext">forall a. Scaled a -&gt; a
</span><a href="GHC.Core.TyCo.Rep.html#scaledThing"><span class="hs-identifier hs-var">scaledThing</span></a></span><span> </span><span class="annot"><span class="annottext">[Scaled TcType]
</span><a href="#local-6989586621681387140"><span class="hs-identifier hs-var">arg_tys</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-895"></span><span>        </span><span class="hs-special">;</span><span> </span><span class="annot"><span class="annottext">ConLike -&gt; [TyVar] -&gt; [TcType] -&gt; PatEnv -&gt; TcRn ()
</span><a href="GHC.Tc.Gen.Pat.html#checkGADT"><span class="hs-identifier hs-var">checkGADT</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">DataCon -&gt; ConLike
</span><a href="GHC.Core.ConLike.html#RealDataCon"><span class="hs-identifier hs-var">RealDataCon</span></a></span><span> </span><span class="annot"><span class="annottext">DataCon
</span><a href="#local-6989586621681387150"><span class="hs-identifier hs-var">data_con</span></a></span><span class="hs-special">)</span><span> </span><span class="annot"><span class="annottext">[TyVar]
</span><a href="#local-6989586621681387143"><span class="hs-identifier hs-var">ex_tvs</span></a></span><span> </span><span class="annot"><span class="annottext">[TcType]
</span><a href="#local-6989586621681387133"><span class="hs-identifier hs-var">all_arg_tys</span></a></span><span> </span><span class="annot"><span class="annottext">PatEnv
</span><a href="#local-6989586621681387153"><span class="hs-identifier hs-var">penv</span></a></span><span>
</span><span id="line-896"></span><span>
</span><span id="line-897"></span><span>        </span><span class="hs-special">;</span><span> </span><span id="local-6989586621681387130"><span class="annot"><span class="annottext">TCvSubst
</span><a href="#local-6989586621681387130"><span class="hs-identifier hs-var">tenv1</span></a></span></span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">CtOrigin -&gt; [TyVar] -&gt; [TcType] -&gt; TcM TCvSubst
</span><a href="GHC.Tc.Utils.Instantiate.html#instTyVarsWith"><span class="hs-identifier hs-var">instTyVarsWith</span></a></span><span> </span><span class="annot"><span class="annottext">CtOrigin
</span><a href="GHC.Tc.Types.Origin.html#PatOrigin"><span class="hs-identifier hs-var">PatOrigin</span></a></span><span> </span><span class="annot"><span class="annottext">[TyVar]
</span><a href="#local-6989586621681387144"><span class="hs-identifier hs-var">univ_tvs</span></a></span><span> </span><span class="annot"><span class="annottext">[TcType]
</span><a href="#local-6989586621681387136"><span class="hs-identifier hs-var">ctxt_res_tys</span></a></span><span>
</span><span id="line-898"></span><span>                  </span><span class="hs-comment">-- NB: Do not use zipTvSubst!  See #14154</span><span>
</span><span id="line-899"></span><span>                  </span><span class="hs-comment">-- We want to create a well-kinded substitution, so</span><span>
</span><span id="line-900"></span><span>                  </span><span class="hs-comment">-- that the instantiated type is well-kinded</span><span>
</span><span id="line-901"></span><span>
</span><span id="line-902"></span><span>        </span><span class="hs-special">;</span><span> </span><span class="hs-special">(</span><span id="local-6989586621681387128"><span class="annot"><span class="annottext">TCvSubst
</span><a href="#local-6989586621681387128"><span class="hs-identifier hs-var">tenv</span></a></span></span><span class="hs-special">,</span><span> </span><span id="local-6989586621681387127"><span class="annot"><span class="annottext">[TyVar]
</span><a href="#local-6989586621681387127"><span class="hs-identifier hs-var">ex_tvs'</span></a></span></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">TCvSubst -&gt; [TyVar] -&gt; TcM (TCvSubst, [TyVar])
</span><a href="GHC.Tc.Utils.Instantiate.html#tcInstSuperSkolTyVarsX"><span class="hs-identifier hs-var">tcInstSuperSkolTyVarsX</span></a></span><span> </span><span class="annot"><span class="annottext">TCvSubst
</span><a href="#local-6989586621681387130"><span class="hs-identifier hs-var">tenv1</span></a></span><span> </span><span class="annot"><span class="annottext">[TyVar]
</span><a href="#local-6989586621681387143"><span class="hs-identifier hs-var">ex_tvs</span></a></span><span>
</span><span id="line-903"></span><span>                     </span><span class="hs-comment">-- Get location from monad, not from ex_tvs</span><span>
</span><span id="line-904"></span><span>                     </span><span class="hs-comment">-- This freshens: See Note [Freshen existentials]</span><span>
</span><span id="line-905"></span><span>                     </span><span class="hs-comment">-- Why &quot;super&quot;? See Note [Binding when lookup up instances]</span><span>
</span><span id="line-906"></span><span>                     </span><span class="hs-comment">-- in GHC.Core.InstEnv.</span><span>
</span><span id="line-907"></span><span>
</span><span id="line-908"></span><span>        </span><span class="hs-special">;</span><span> </span><span class="hs-keyword">let</span><span> </span><span id="local-6989586621681387125"><span class="annot"><span class="annottext">arg_tys' :: [Scaled TcType]
</span><a href="#local-6989586621681387125"><span class="hs-identifier hs-var hs-var">arg_tys'</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">HasCallStack =&gt; TCvSubst -&gt; [Scaled TcType] -&gt; [Scaled TcType]
</span><a href="GHC.Core.TyCo.Subst.html#substScaledTys"><span class="hs-identifier hs-var">substScaledTys</span></a></span><span> </span><span class="annot"><span class="annottext">TCvSubst
</span><a href="#local-6989586621681387128"><span class="hs-identifier hs-var">tenv</span></a></span><span> </span><span class="annot"><span class="annottext">[Scaled TcType]
</span><a href="#local-6989586621681387140"><span class="hs-identifier hs-var">arg_tys</span></a></span><span>
</span><span id="line-909"></span><span>              </span><span id="local-6989586621681387123"><span class="annot"><span class="annottext">pat_mult :: TcType
</span><a href="#local-6989586621681387123"><span class="hs-identifier hs-var hs-var">pat_mult</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">forall a. Scaled a -&gt; TcType
</span><a href="GHC.Core.TyCo.Rep.html#scaledMult"><span class="hs-identifier hs-var">scaledMult</span></a></span><span> </span><span class="annot"><span class="annottext">Scaled ExpSigmaType
</span><a href="#local-6989586621681387149"><span class="hs-identifier hs-var">pat_ty_scaled</span></a></span><span>
</span><span id="line-910"></span><span>              </span><span id="local-6989586621681387122"><span class="annot"><span class="annottext">arg_tys_scaled :: [Scaled TcType]
</span><a href="#local-6989586621681387122"><span class="hs-identifier hs-var hs-var">arg_tys_scaled</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">forall a b. (a -&gt; b) -&gt; [a] -&gt; [b]
</span><a href="../../base-4.16.4.0/src/GHC-Base.html#map"><span class="hs-identifier hs-var">map</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">forall a. TcType -&gt; Scaled a -&gt; Scaled a
</span><a href="GHC.Core.Multiplicity.html#scaleScaled"><span class="hs-identifier hs-var">scaleScaled</span></a></span><span> </span><span class="annot"><span class="annottext">TcType
</span><a href="#local-6989586621681387123"><span class="hs-identifier hs-var">pat_mult</span></a></span><span class="hs-special">)</span><span> </span><span class="annot"><span class="annottext">[Scaled TcType]
</span><a href="#local-6989586621681387125"><span class="hs-identifier hs-var">arg_tys'</span></a></span><span>
</span><span id="line-911"></span><span>
</span><span id="line-912"></span><span>        </span><span class="hs-special">;</span><span> </span><span class="annot"><span class="annottext">String -&gt; SDoc -&gt; TcRn ()
</span><a href="GHC.Tc.Utils.Monad.html#traceTc"><span class="hs-identifier hs-var">traceTc</span></a></span><span> </span><span class="annot"><span class="annottext">String
</span><span class="hs-string">&quot;tcConPat&quot;</span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">[SDoc] -&gt; SDoc
</span><a href="GHC.Utils.Outputable.html#vcat"><span class="hs-identifier hs-var">vcat</span></a></span><span> </span><span class="hs-special">[</span><span> </span><span class="annot"><span class="annottext">forall a. Outputable a =&gt; a -&gt; SDoc
</span><a href="GHC.Utils.Outputable.html#ppr"><span class="hs-identifier hs-var">ppr</span></a></span><span> </span><span class="annot"><span class="annottext">Name
</span><a href="#local-6989586621681387151"><span class="hs-identifier hs-var">con_name</span></a></span><span>
</span><span id="line-913"></span><span>                                   </span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">[TyVar] -&gt; SDoc
</span><a href="GHC.Core.TyCo.Ppr.html#pprTyVars"><span class="hs-identifier hs-var">pprTyVars</span></a></span><span> </span><span class="annot"><span class="annottext">[TyVar]
</span><a href="#local-6989586621681387144"><span class="hs-identifier hs-var">univ_tvs</span></a></span><span>
</span><span id="line-914"></span><span>                                   </span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">[TyVar] -&gt; SDoc
</span><a href="GHC.Core.TyCo.Ppr.html#pprTyVars"><span class="hs-identifier hs-var">pprTyVars</span></a></span><span> </span><span class="annot"><span class="annottext">[TyVar]
</span><a href="#local-6989586621681387143"><span class="hs-identifier hs-var">ex_tvs</span></a></span><span>
</span><span id="line-915"></span><span>                                   </span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">forall a. Outputable a =&gt; a -&gt; SDoc
</span><a href="GHC.Utils.Outputable.html#ppr"><span class="hs-identifier hs-var">ppr</span></a></span><span> </span><span class="annot"><span class="annottext">[EqSpec]
</span><a href="#local-6989586621681387142"><span class="hs-identifier hs-var">eq_spec</span></a></span><span>
</span><span id="line-916"></span><span>                                   </span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">forall a. Outputable a =&gt; a -&gt; SDoc
</span><a href="GHC.Utils.Outputable.html#ppr"><span class="hs-identifier hs-var">ppr</span></a></span><span> </span><span class="annot"><span class="annottext">[TcType]
</span><a href="#local-6989586621681387141"><span class="hs-identifier hs-var">theta</span></a></span><span>
</span><span id="line-917"></span><span>                                   </span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">[TyVar] -&gt; SDoc
</span><a href="GHC.Core.TyCo.Ppr.html#pprTyVars"><span class="hs-identifier hs-var">pprTyVars</span></a></span><span> </span><span class="annot"><span class="annottext">[TyVar]
</span><a href="#local-6989586621681387127"><span class="hs-identifier hs-var">ex_tvs'</span></a></span><span>
</span><span id="line-918"></span><span>                                   </span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">forall a. Outputable a =&gt; a -&gt; SDoc
</span><a href="GHC.Utils.Outputable.html#ppr"><span class="hs-identifier hs-var">ppr</span></a></span><span> </span><span class="annot"><span class="annottext">[TcType]
</span><a href="#local-6989586621681387136"><span class="hs-identifier hs-var">ctxt_res_tys</span></a></span><span>
</span><span id="line-919"></span><span>                                   </span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">forall a. Outputable a =&gt; a -&gt; SDoc
</span><a href="GHC.Utils.Outputable.html#ppr"><span class="hs-identifier hs-var">ppr</span></a></span><span> </span><span class="annot"><span class="annottext">[Scaled TcType]
</span><a href="#local-6989586621681387125"><span class="hs-identifier hs-var">arg_tys'</span></a></span><span>
</span><span id="line-920"></span><span>                                   </span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">forall a. Outputable a =&gt; a -&gt; SDoc
</span><a href="GHC.Utils.Outputable.html#ppr"><span class="hs-identifier hs-var">ppr</span></a></span><span> </span><span class="annot"><span class="annottext">HsConPatDetails GhcRn
</span><a href="#local-6989586621681387148"><span class="hs-identifier hs-var">arg_pats</span></a></span><span> </span><span class="hs-special">]</span><span class="hs-special">)</span><span>
</span><span id="line-921"></span><span>        </span><span class="hs-special">;</span><span> </span><span class="hs-keyword">if</span><span> </span><span class="annot"><span class="annottext">forall (t :: * -&gt; *) a. Foldable t =&gt; t a -&gt; Bool
</span><a href="../../base-4.16.4.0/src/Data-Foldable.html#null"><span class="hs-identifier hs-var">null</span></a></span><span> </span><span class="annot"><span class="annottext">[TyVar]
</span><a href="#local-6989586621681387143"><span class="hs-identifier hs-var">ex_tvs</span></a></span><span> </span><span class="annot"><span class="annottext">Bool -&gt; Bool -&gt; Bool
</span><span class="hs-operator hs-var">&amp;&amp;</span></span><span> </span><span class="annot"><span class="annottext">forall (t :: * -&gt; *) a. Foldable t =&gt; t a -&gt; Bool
</span><a href="../../base-4.16.4.0/src/Data-Foldable.html#null"><span class="hs-identifier hs-var">null</span></a></span><span> </span><span class="annot"><span class="annottext">[EqSpec]
</span><a href="#local-6989586621681387142"><span class="hs-identifier hs-var">eq_spec</span></a></span><span> </span><span class="annot"><span class="annottext">Bool -&gt; Bool -&gt; Bool
</span><span class="hs-operator hs-var">&amp;&amp;</span></span><span> </span><span class="annot"><span class="annottext">forall (t :: * -&gt; *) a. Foldable t =&gt; t a -&gt; Bool
</span><a href="../../base-4.16.4.0/src/Data-Foldable.html#null"><span class="hs-identifier hs-var">null</span></a></span><span> </span><span class="annot"><span class="annottext">[TcType]
</span><a href="#local-6989586621681387141"><span class="hs-identifier hs-var">theta</span></a></span><span>
</span><span id="line-922"></span><span>          </span><span class="hs-keyword">then</span><span> </span><span class="hs-keyword">do</span><span> </span><span class="hs-special">{</span><span> </span><span class="hs-comment">-- The common case; no class bindings etc</span><span>
</span><span id="line-923"></span><span>                    </span><span class="hs-comment">-- (see Note [Arrows and patterns])</span><span>
</span><span id="line-924"></span><span>                    </span><span class="hs-special">(</span><span id="local-6989586621681387120"><span class="annot"><span class="annottext">HsConDetails
  (HsPatSigType GhcRn)
  (GenLocated (SrcSpanAnn' (EpAnn AnnListItem)) (Pat GhcTc))
  (HsRecFields
     GhcTc (GenLocated (SrcSpanAnn' (EpAnn AnnListItem)) (Pat GhcTc)))
</span><a href="#local-6989586621681387120"><span class="hs-identifier hs-var">arg_pats'</span></a></span></span><span class="hs-special">,</span><span> </span><span id="local-6989586621681387119"><span class="annot"><span class="annottext">a
</span><a href="#local-6989586621681387119"><span class="hs-identifier hs-var">res</span></a></span></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">ConLike
-&gt; [Scaled TcType]
-&gt; TCvSubst
-&gt; Checker (HsConPatDetails GhcRn) (HsConPatDetails GhcTc)
</span><a href="GHC.Tc.Gen.Pat.html#tcConArgs"><span class="hs-identifier hs-var">tcConArgs</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">DataCon -&gt; ConLike
</span><a href="GHC.Core.ConLike.html#RealDataCon"><span class="hs-identifier hs-var">RealDataCon</span></a></span><span> </span><span class="annot"><span class="annottext">DataCon
</span><a href="#local-6989586621681387150"><span class="hs-identifier hs-var">data_con</span></a></span><span class="hs-special">)</span><span> </span><span class="annot"><span class="annottext">[Scaled TcType]
</span><a href="#local-6989586621681387122"><span class="hs-identifier hs-var">arg_tys_scaled</span></a></span><span>
</span><span id="line-925"></span><span>                                                  </span><span class="annot"><span class="annottext">TCvSubst
</span><a href="#local-6989586621681387128"><span class="hs-identifier hs-var">tenv</span></a></span><span> </span><span class="annot"><span class="annottext">PatEnv
</span><a href="#local-6989586621681387153"><span class="hs-identifier hs-var">penv</span></a></span><span> </span><span class="annot"><span class="annottext">HsConPatDetails GhcRn
</span><a href="#local-6989586621681387148"><span class="hs-identifier hs-var">arg_pats</span></a></span><span> </span><span class="annot"><span class="annottext">TcM a
</span><a href="#local-6989586621681387147"><span class="hs-identifier hs-var">thing_inside</span></a></span><span>
</span><span id="line-926"></span><span>                  </span><span class="hs-special">;</span><span> </span><span class="hs-keyword">let</span><span> </span><span id="local-6989586621681387117"><span class="annot"><span class="annottext">res_pat :: Pat GhcTc
</span><a href="#local-6989586621681387117"><span class="hs-identifier hs-var hs-var">res_pat</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><a href="Language.Haskell.Syntax.Pat.html#ConPat"><span class="hs-identifier hs-type">ConPat</span></a></span><span> </span><span class="hs-special">{</span><span> </span><span class="annot"><span class="annottext">pat_con :: XRec GhcTc (ConLikeP GhcTc)
</span><a href="Language.Haskell.Syntax.Pat.html#pat_con"><span class="hs-identifier hs-var">pat_con</span></a></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">GenLocated SrcSpanAnnN ConLike
</span><a href="#local-6989586621681387138"><span class="hs-identifier hs-var">header</span></a></span><span>
</span><span id="line-927"></span><span>                                         </span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">pat_args :: HsConPatDetails GhcTc
</span><a href="Language.Haskell.Syntax.Pat.html#pat_args"><span class="hs-identifier hs-var">pat_args</span></a></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">HsConDetails
  (HsPatSigType GhcRn)
  (GenLocated (SrcSpanAnn' (EpAnn AnnListItem)) (Pat GhcTc))
  (HsRecFields
     GhcTc (GenLocated (SrcSpanAnn' (EpAnn AnnListItem)) (Pat GhcTc)))
</span><a href="#local-6989586621681387120"><span class="hs-identifier hs-var">arg_pats'</span></a></span><span>
</span><span id="line-928"></span><span>                                         </span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">pat_con_ext :: XConPat GhcTc
</span><a href="Language.Haskell.Syntax.Pat.html#pat_con_ext"><span class="hs-identifier hs-var">pat_con_ext</span></a></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><a href="GHC.Hs.Pat.html#ConPatTc"><span class="hs-identifier hs-type">ConPatTc</span></a></span><span>
</span><span id="line-929"></span><span>                                           </span><span class="hs-special">{</span><span> </span><span class="annot"><span class="annottext">cpt_tvs :: [TyVar]
</span><a href="GHC.Hs.Pat.html#cpt_tvs"><span class="hs-identifier hs-var">cpt_tvs</span></a></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-special">[</span><span class="hs-special">]</span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">cpt_dicts :: [TyVar]
</span><a href="GHC.Hs.Pat.html#cpt_dicts"><span class="hs-identifier hs-var">cpt_dicts</span></a></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-special">[</span><span class="hs-special">]</span><span>
</span><span id="line-930"></span><span>                                           </span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">cpt_binds :: TcEvBinds
</span><a href="GHC.Hs.Pat.html#cpt_binds"><span class="hs-identifier hs-var">cpt_binds</span></a></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">TcEvBinds
</span><a href="GHC.Tc.Types.Evidence.html#emptyTcEvBinds"><span class="hs-identifier hs-var">emptyTcEvBinds</span></a></span><span>
</span><span id="line-931"></span><span>                                           </span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">cpt_arg_tys :: [TcType]
</span><a href="GHC.Hs.Pat.html#cpt_arg_tys"><span class="hs-identifier hs-var">cpt_arg_tys</span></a></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">[TcType]
</span><a href="#local-6989586621681387136"><span class="hs-identifier hs-var">ctxt_res_tys</span></a></span><span>
</span><span id="line-932"></span><span>                                           </span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">cpt_wrap :: HsWrapper
</span><a href="GHC.Hs.Pat.html#cpt_wrap"><span class="hs-identifier hs-var">cpt_wrap</span></a></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">HsWrapper
</span><a href="GHC.Tc.Types.Evidence.html#idHsWrapper"><span class="hs-identifier hs-var">idHsWrapper</span></a></span><span>
</span><span id="line-933"></span><span>                                           </span><span class="hs-special">}</span><span>
</span><span id="line-934"></span><span>                                         </span><span class="hs-special">}</span><span>
</span><span id="line-935"></span><span>
</span><span id="line-936"></span><span>                  </span><span class="hs-special">;</span><span> </span><span class="annot"><span class="annottext">forall (m :: * -&gt; *) a. Monad m =&gt; a -&gt; m a
</span><a href="../../base-4.16.4.0/src/GHC-Base.html#return"><span class="hs-identifier hs-var">return</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">HsWrapper -&gt; Pat GhcTc -&gt; TcType -&gt; Pat GhcTc
</span><a href="GHC.Hs.Utils.html#mkHsWrapPat"><span class="hs-identifier hs-var">mkHsWrapPat</span></a></span><span> </span><span class="annot"><span class="annottext">HsWrapper
</span><a href="#local-6989586621681387137"><span class="hs-identifier hs-var">wrap</span></a></span><span> </span><span class="annot"><span class="annottext">Pat GhcTc
</span><a href="#local-6989586621681387117"><span class="hs-identifier hs-var">res_pat</span></a></span><span> </span><span class="annot"><span class="annottext">TcType
</span><a href="#local-6989586621681387134"><span class="hs-identifier hs-var">pat_ty</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">a
</span><a href="#local-6989586621681387119"><span class="hs-identifier hs-var">res</span></a></span><span class="hs-special">)</span><span> </span><span class="hs-special">}</span><span>
</span><span id="line-937"></span><span>
</span><span id="line-938"></span><span>          </span><span class="hs-keyword">else</span><span> </span><span class="hs-keyword">do</span><span>   </span><span class="hs-comment">-- The general case, with existential,</span><span>
</span><span id="line-939"></span><span>                    </span><span class="hs-comment">-- and local equality constraints</span><span>
</span><span id="line-940"></span><span>        </span><span class="hs-special">{</span><span> </span><span class="hs-keyword">let</span><span> </span><span id="local-6989586621681387106"><span class="annot"><span class="annottext">theta' :: [TcType]
</span><a href="#local-6989586621681387106"><span class="hs-identifier hs-var hs-var">theta'</span></a></span></span><span>     </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">HasCallStack =&gt; TCvSubst -&gt; [TcType] -&gt; [TcType]
</span><a href="GHC.Core.TyCo.Subst.html#substTheta"><span class="hs-identifier hs-var">substTheta</span></a></span><span> </span><span class="annot"><span class="annottext">TCvSubst
</span><a href="#local-6989586621681387128"><span class="hs-identifier hs-var">tenv</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">[EqSpec] -&gt; [TcType]
</span><a href="GHC.Core.DataCon.html#eqSpecPreds"><span class="hs-identifier hs-var">eqSpecPreds</span></a></span><span> </span><span class="annot"><span class="annottext">[EqSpec]
</span><a href="#local-6989586621681387142"><span class="hs-identifier hs-var">eq_spec</span></a></span><span> </span><span class="annot"><span class="annottext">forall a. [a] -&gt; [a] -&gt; [a]
</span><a href="../../base-4.16.4.0/src/GHC-Base.html#%2B%2B"><span class="hs-operator hs-var">++</span></a></span><span> </span><span class="annot"><span class="annottext">[TcType]
</span><a href="#local-6989586621681387141"><span class="hs-identifier hs-var">theta</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-941"></span><span>                           </span><span class="hs-comment">-- order is *important* as we generate the list of</span><span>
</span><span id="line-942"></span><span>                           </span><span class="hs-comment">-- dictionary binders from theta'</span><span>
</span><span id="line-943"></span><span>              </span><span id="local-6989586621681387104"><span class="annot"><span class="annottext">no_equalities :: Bool
</span><a href="#local-6989586621681387104"><span class="hs-identifier hs-var hs-var">no_equalities</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">forall (t :: * -&gt; *) a. Foldable t =&gt; t a -&gt; Bool
</span><a href="../../base-4.16.4.0/src/Data-Foldable.html#null"><span class="hs-identifier hs-var">null</span></a></span><span> </span><span class="annot"><span class="annottext">[EqSpec]
</span><a href="#local-6989586621681387142"><span class="hs-identifier hs-var">eq_spec</span></a></span><span> </span><span class="annot"><span class="annottext">Bool -&gt; Bool -&gt; Bool
</span><span class="hs-operator hs-var">&amp;&amp;</span></span><span> </span><span class="annot"><span class="annottext">Bool -&gt; Bool
</span><span class="hs-identifier hs-var">not</span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">forall (t :: * -&gt; *) a. Foldable t =&gt; (a -&gt; Bool) -&gt; t a -&gt; Bool
</span><a href="../../base-4.16.4.0/src/Data-Foldable.html#any"><span class="hs-identifier hs-var">any</span></a></span><span> </span><span class="annot"><span class="annottext">TcType -&gt; Bool
</span><a href="GHC.Core.Predicate.html#isEqPred"><span class="hs-identifier hs-var">isEqPred</span></a></span><span> </span><span class="annot"><span class="annottext">[TcType]
</span><a href="#local-6989586621681387141"><span class="hs-identifier hs-var">theta</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-944"></span><span>              </span><span id="local-6989586621681387101"><span class="annot"><span class="annottext">skol_info :: SkolemInfo
</span><a href="#local-6989586621681387101"><span class="hs-identifier hs-var hs-var">skol_info</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">ConLike -&gt; HsMatchContext GhcRn -&gt; SkolemInfo
</span><a href="GHC.Tc.Types.Origin.html#PatSkol"><span class="hs-identifier hs-var">PatSkol</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">DataCon -&gt; ConLike
</span><a href="GHC.Core.ConLike.html#RealDataCon"><span class="hs-identifier hs-var">RealDataCon</span></a></span><span> </span><span class="annot"><span class="annottext">DataCon
</span><a href="#local-6989586621681387150"><span class="hs-identifier hs-var">data_con</span></a></span><span class="hs-special">)</span><span> </span><span class="annot"><span class="annottext">HsMatchContext GhcRn
</span><a href="#local-6989586621681387099"><span class="hs-identifier hs-var">mc</span></a></span><span>
</span><span id="line-945"></span><span>              </span><span id="local-6989586621681387099"><span class="annot"><span class="annottext">mc :: HsMatchContext GhcRn
</span><a href="#local-6989586621681387099"><span class="hs-identifier hs-var hs-var">mc</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-keyword">case</span><span> </span><span class="annot"><span class="annottext">PatEnv -&gt; PatCtxt
</span><a href="GHC.Tc.Gen.Pat.html#pe_ctxt"><span class="hs-identifier hs-var">pe_ctxt</span></a></span><span> </span><span class="annot"><span class="annottext">PatEnv
</span><a href="#local-6989586621681387153"><span class="hs-identifier hs-var">penv</span></a></span><span> </span><span class="hs-keyword">of</span><span>
</span><span id="line-946"></span><span>                     </span><span class="annot"><a href="GHC.Tc.Gen.Pat.html#LamPat"><span class="hs-identifier hs-type">LamPat</span></a></span><span> </span><span id="local-6989586621681387098"><span class="annot"><span class="annottext">HsMatchContext GhcRn
</span><a href="#local-6989586621681387098"><span class="hs-identifier hs-var">mc</span></a></span></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="annottext">HsMatchContext GhcRn
</span><a href="#local-6989586621681387098"><span class="hs-identifier hs-var">mc</span></a></span><span>
</span><span id="line-947"></span><span>                     </span><span class="annot"><a href="GHC.Tc.Gen.Pat.html#LetPat"><span class="hs-identifier hs-type">LetPat</span></a></span><span> </span><span class="hs-special">{</span><span class="hs-special">}</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="annottext">forall p. HsMatchContext p
</span><a href="Language.Haskell.Syntax.Expr.html#PatBindRhs"><span class="hs-identifier hs-var">PatBindRhs</span></a></span><span>
</span><span id="line-948"></span><span>
</span><span id="line-949"></span><span>        </span><span class="hs-special">;</span><span> </span><span id="local-6989586621681387096"><span class="annot"><span class="annottext">Bool
</span><a href="#local-6989586621681387096"><span class="hs-identifier hs-var">gadts_on</span></a></span></span><span>    </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">forall gbl lcl. Extension -&gt; TcRnIf gbl lcl Bool
</span><a href="GHC.Tc.Utils.Monad.html#xoptM"><span class="hs-identifier hs-var">xoptM</span></a></span><span> </span><span class="annot"><span class="annottext">Extension
</span><span class="hs-identifier hs-var">LangExt.GADTs</span></span><span>
</span><span id="line-950"></span><span>        </span><span class="hs-special">;</span><span> </span><span id="local-6989586621681387094"><span class="annot"><span class="annottext">Bool
</span><a href="#local-6989586621681387094"><span class="hs-identifier hs-var">families_on</span></a></span></span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">forall gbl lcl. Extension -&gt; TcRnIf gbl lcl Bool
</span><a href="GHC.Tc.Utils.Monad.html#xoptM"><span class="hs-identifier hs-var">xoptM</span></a></span><span> </span><span class="annot"><span class="annottext">Extension
</span><span class="hs-identifier hs-var">LangExt.TypeFamilies</span></span><span>
</span><span id="line-951"></span><span>        </span><span class="hs-special">;</span><span> </span><span class="annot"><span class="annottext">Bool -&gt; SDoc -&gt; TcRn ()
</span><a href="GHC.Tc.Utils.Monad.html#checkTc"><span class="hs-identifier hs-var">checkTc</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Bool
</span><a href="#local-6989586621681387104"><span class="hs-identifier hs-var">no_equalities</span></a></span><span> </span><span class="annot"><span class="annottext">Bool -&gt; Bool -&gt; Bool
</span><span class="hs-operator hs-var">||</span></span><span> </span><span class="annot"><span class="annottext">Bool
</span><a href="#local-6989586621681387096"><span class="hs-identifier hs-var">gadts_on</span></a></span><span> </span><span class="annot"><span class="annottext">Bool -&gt; Bool -&gt; Bool
</span><span class="hs-operator hs-var">||</span></span><span> </span><span class="annot"><span class="annottext">Bool
</span><a href="#local-6989586621681387094"><span class="hs-identifier hs-var">families_on</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-952"></span><span>                  </span><span class="hs-special">(</span><span class="annot"><span class="annottext">String -&gt; SDoc
</span><a href="GHC.Utils.Outputable.html#text"><span class="hs-identifier hs-var">text</span></a></span><span> </span><span class="annot"><span class="annottext">String
</span><span class="hs-string">&quot;A pattern match on a GADT requires the&quot;</span></span><span> </span><span class="annot"><span class="annottext">SDoc -&gt; SDoc -&gt; SDoc
</span><a href="GHC.Utils.Outputable.html#%3C%2B%3E"><span class="hs-operator hs-var">&lt;+&gt;</span></a></span><span>
</span><span id="line-953"></span><span>                   </span><span class="annot"><span class="annottext">String -&gt; SDoc
</span><a href="GHC.Utils.Outputable.html#text"><span class="hs-identifier hs-var">text</span></a></span><span> </span><span class="annot"><span class="annottext">String
</span><span class="hs-string">&quot;GADTs or TypeFamilies language extension&quot;</span></span><span class="hs-special">)</span><span>
</span><span id="line-954"></span><span>                  </span><span class="hs-comment">-- #2905 decided that a *pattern-match* of a GADT</span><span>
</span><span id="line-955"></span><span>                  </span><span class="hs-comment">-- should require the GADT language flag.</span><span>
</span><span id="line-956"></span><span>                  </span><span class="hs-comment">-- Re TypeFamilies see also #7156</span><span>
</span><span id="line-957"></span><span>
</span><span id="line-958"></span><span>        </span><span class="hs-special">;</span><span> </span><span id="local-6989586621681387090"><span class="annot"><span class="annottext">[TyVar]
</span><a href="#local-6989586621681387090"><span class="hs-identifier hs-var">given</span></a></span></span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">[TcType] -&gt; TcM [TyVar]
</span><a href="GHC.Tc.Utils.TcMType.html#newEvVars"><span class="hs-identifier hs-var">newEvVars</span></a></span><span> </span><span class="annot"><span class="annottext">[TcType]
</span><a href="#local-6989586621681387106"><span class="hs-identifier hs-var">theta'</span></a></span><span>
</span><span id="line-959"></span><span>        </span><span class="hs-special">;</span><span> </span><span class="hs-special">(</span><span id="local-6989586621681387088"><span class="annot"><span class="annottext">TcEvBinds
</span><a href="#local-6989586621681387088"><span class="hs-identifier hs-var">ev_binds</span></a></span></span><span class="hs-special">,</span><span> </span><span class="hs-special">(</span><span id="local-6989586621681387087"><span class="annot"><span class="annottext">HsConDetails
  (HsPatSigType GhcRn)
  (GenLocated (SrcSpanAnn' (EpAnn AnnListItem)) (Pat GhcTc))
  (HsRecFields
     GhcTc (GenLocated (SrcSpanAnn' (EpAnn AnnListItem)) (Pat GhcTc)))
</span><a href="#local-6989586621681387087"><span class="hs-identifier hs-var">arg_pats'</span></a></span></span><span class="hs-special">,</span><span> </span><span id="local-6989586621681387086"><span class="annot"><span class="annottext">a
</span><a href="#local-6989586621681387086"><span class="hs-identifier hs-var">res</span></a></span></span><span class="hs-special">)</span><span class="hs-special">)</span><span>
</span><span id="line-960"></span><span>             </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">forall result.
SkolemInfo
-&gt; [TyVar] -&gt; [TyVar] -&gt; TcM result -&gt; TcM (TcEvBinds, result)
</span><a href="GHC.Tc.Utils.Unify.html#checkConstraints"><span class="hs-identifier hs-var">checkConstraints</span></a></span><span> </span><span class="annot"><span class="annottext">SkolemInfo
</span><a href="#local-6989586621681387101"><span class="hs-identifier hs-var">skol_info</span></a></span><span> </span><span class="annot"><span class="annottext">[TyVar]
</span><a href="#local-6989586621681387127"><span class="hs-identifier hs-var">ex_tvs'</span></a></span><span> </span><span class="annot"><span class="annottext">[TyVar]
</span><a href="#local-6989586621681387090"><span class="hs-identifier hs-var">given</span></a></span><span> </span><span class="annot"><span class="annottext">forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><a href="../../base-4.16.4.0/src/GHC-Base.html#%24"><span class="hs-operator hs-var">$</span></a></span><span>
</span><span id="line-961"></span><span>                </span><span class="annot"><span class="annottext">ConLike
-&gt; [Scaled TcType]
-&gt; TCvSubst
-&gt; Checker (HsConPatDetails GhcRn) (HsConPatDetails GhcTc)
</span><a href="GHC.Tc.Gen.Pat.html#tcConArgs"><span class="hs-identifier hs-var">tcConArgs</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">DataCon -&gt; ConLike
</span><a href="GHC.Core.ConLike.html#RealDataCon"><span class="hs-identifier hs-var">RealDataCon</span></a></span><span> </span><span class="annot"><span class="annottext">DataCon
</span><a href="#local-6989586621681387150"><span class="hs-identifier hs-var">data_con</span></a></span><span class="hs-special">)</span><span> </span><span class="annot"><span class="annottext">[Scaled TcType]
</span><a href="#local-6989586621681387122"><span class="hs-identifier hs-var">arg_tys_scaled</span></a></span><span> </span><span class="annot"><span class="annottext">TCvSubst
</span><a href="#local-6989586621681387128"><span class="hs-identifier hs-var">tenv</span></a></span><span> </span><span class="annot"><span class="annottext">PatEnv
</span><a href="#local-6989586621681387153"><span class="hs-identifier hs-var">penv</span></a></span><span> </span><span class="annot"><span class="annottext">HsConPatDetails GhcRn
</span><a href="#local-6989586621681387148"><span class="hs-identifier hs-var">arg_pats</span></a></span><span> </span><span class="annot"><span class="annottext">TcM a
</span><a href="#local-6989586621681387147"><span class="hs-identifier hs-var">thing_inside</span></a></span><span>
</span><span id="line-962"></span><span>
</span><span id="line-963"></span><span>        </span><span class="hs-special">;</span><span> </span><span class="hs-keyword">let</span><span> </span><span id="local-6989586621681387084"><span class="annot"><span class="annottext">res_pat :: Pat GhcTc
</span><a href="#local-6989586621681387084"><span class="hs-identifier hs-var hs-var">res_pat</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><a href="Language.Haskell.Syntax.Pat.html#ConPat"><span class="hs-identifier hs-type">ConPat</span></a></span><span>
</span><span id="line-964"></span><span>                </span><span class="hs-special">{</span><span> </span><span class="annot"><span class="annottext">pat_con :: XRec GhcTc (ConLikeP GhcTc)
</span><a href="Language.Haskell.Syntax.Pat.html#pat_con"><span class="hs-identifier hs-var">pat_con</span></a></span><span>   </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">GenLocated SrcSpanAnnN ConLike
</span><a href="#local-6989586621681387138"><span class="hs-identifier hs-var">header</span></a></span><span>
</span><span id="line-965"></span><span>                </span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">pat_args :: HsConPatDetails GhcTc
</span><a href="Language.Haskell.Syntax.Pat.html#pat_args"><span class="hs-identifier hs-var">pat_args</span></a></span><span>  </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">HsConDetails
  (HsPatSigType GhcRn)
  (GenLocated (SrcSpanAnn' (EpAnn AnnListItem)) (Pat GhcTc))
  (HsRecFields
     GhcTc (GenLocated (SrcSpanAnn' (EpAnn AnnListItem)) (Pat GhcTc)))
</span><a href="#local-6989586621681387087"><span class="hs-identifier hs-var">arg_pats'</span></a></span><span>
</span><span id="line-966"></span><span>                </span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">pat_con_ext :: XConPat GhcTc
</span><a href="Language.Haskell.Syntax.Pat.html#pat_con_ext"><span class="hs-identifier hs-var">pat_con_ext</span></a></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><a href="GHC.Hs.Pat.html#ConPatTc"><span class="hs-identifier hs-type">ConPatTc</span></a></span><span>
</span><span id="line-967"></span><span>                  </span><span class="hs-special">{</span><span> </span><span class="annot"><span class="annottext">cpt_tvs :: [TyVar]
</span><a href="GHC.Hs.Pat.html#cpt_tvs"><span class="hs-identifier hs-var">cpt_tvs</span></a></span><span>   </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">[TyVar]
</span><a href="#local-6989586621681387127"><span class="hs-identifier hs-var">ex_tvs'</span></a></span><span>
</span><span id="line-968"></span><span>                  </span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">cpt_dicts :: [TyVar]
</span><a href="GHC.Hs.Pat.html#cpt_dicts"><span class="hs-identifier hs-var">cpt_dicts</span></a></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">[TyVar]
</span><a href="#local-6989586621681387090"><span class="hs-identifier hs-var">given</span></a></span><span>
</span><span id="line-969"></span><span>                  </span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">cpt_binds :: TcEvBinds
</span><a href="GHC.Hs.Pat.html#cpt_binds"><span class="hs-identifier hs-var">cpt_binds</span></a></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">TcEvBinds
</span><a href="#local-6989586621681387088"><span class="hs-identifier hs-var">ev_binds</span></a></span><span>
</span><span id="line-970"></span><span>                  </span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">cpt_arg_tys :: [TcType]
</span><a href="GHC.Hs.Pat.html#cpt_arg_tys"><span class="hs-identifier hs-var">cpt_arg_tys</span></a></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">[TcType]
</span><a href="#local-6989586621681387136"><span class="hs-identifier hs-var">ctxt_res_tys</span></a></span><span>
</span><span id="line-971"></span><span>                  </span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">cpt_wrap :: HsWrapper
</span><a href="GHC.Hs.Pat.html#cpt_wrap"><span class="hs-identifier hs-var">cpt_wrap</span></a></span><span>  </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">HsWrapper
</span><a href="GHC.Tc.Types.Evidence.html#idHsWrapper"><span class="hs-identifier hs-var">idHsWrapper</span></a></span><span>
</span><span id="line-972"></span><span>                  </span><span class="hs-special">}</span><span>
</span><span id="line-973"></span><span>                </span><span class="hs-special">}</span><span>
</span><span id="line-974"></span><span>        </span><span class="hs-special">;</span><span> </span><span class="annot"><span class="annottext">forall (m :: * -&gt; *) a. Monad m =&gt; a -&gt; m a
</span><a href="../../base-4.16.4.0/src/GHC-Base.html#return"><span class="hs-identifier hs-var">return</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">HsWrapper -&gt; Pat GhcTc -&gt; TcType -&gt; Pat GhcTc
</span><a href="GHC.Hs.Utils.html#mkHsWrapPat"><span class="hs-identifier hs-var">mkHsWrapPat</span></a></span><span> </span><span class="annot"><span class="annottext">HsWrapper
</span><a href="#local-6989586621681387137"><span class="hs-identifier hs-var">wrap</span></a></span><span> </span><span class="annot"><span class="annottext">Pat GhcTc
</span><a href="#local-6989586621681387084"><span class="hs-identifier hs-var">res_pat</span></a></span><span> </span><span class="annot"><span class="annottext">TcType
</span><a href="#local-6989586621681387134"><span class="hs-identifier hs-var">pat_ty</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">a
</span><a href="#local-6989586621681387086"><span class="hs-identifier hs-var">res</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-975"></span><span>        </span><span class="hs-special">}</span><span> </span><span class="hs-special">}</span><span>
</span><span id="line-976"></span><span>
</span><span id="line-977"></span><span id="local-6989586621681387995"><span class="annot"><a href="GHC.Tc.Gen.Pat.html#tcPatSynPat"><span class="hs-identifier hs-type">tcPatSynPat</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><a href="GHC.Tc.Gen.Pat.html#PatEnv"><span class="hs-identifier hs-type">PatEnv</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="GHC.Parser.Annotation.html#LocatedN"><span class="hs-identifier hs-type">LocatedN</span></a></span><span> </span><span class="annot"><a href="GHC.Types.Name.html#Name"><span class="hs-identifier hs-type">Name</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="GHC.Core.PatSyn.html#PatSyn"><span class="hs-identifier hs-type">PatSyn</span></a></span><span>
</span><span id="line-978"></span><span>            </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="GHC.Core.TyCo.Rep.html#Scaled"><span class="hs-identifier hs-type">Scaled</span></a></span><span> </span><span class="annot"><a href="GHC.Tc.Utils.TcType.html#ExpSigmaType"><span class="hs-identifier hs-type">ExpSigmaType</span></a></span><span>         </span><span class="hs-comment">-- Type of the pattern</span><span>
</span><span id="line-979"></span><span>            </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="Language.Haskell.Syntax.Pat.html#HsConPatDetails"><span class="hs-identifier hs-type">HsConPatDetails</span></a></span><span> </span><span class="annot"><a href="GHC.Hs.Extension.html#GhcRn"><span class="hs-identifier hs-type">GhcRn</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="GHC.Tc.Types.html#TcM"><span class="hs-identifier hs-type">TcM</span></a></span><span> </span><span class="annot"><a href="#local-6989586621681387995"><span class="hs-identifier hs-type">a</span></a></span><span>
</span><span id="line-980"></span><span>            </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="GHC.Tc.Types.html#TcM"><span class="hs-identifier hs-type">TcM</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="Language.Haskell.Syntax.Pat.html#Pat"><span class="hs-identifier hs-type">Pat</span></a></span><span> </span><span class="annot"><a href="GHC.Hs.Extension.html#GhcTc"><span class="hs-identifier hs-type">GhcTc</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><a href="#local-6989586621681387995"><span class="hs-identifier hs-type">a</span></a></span><span class="hs-special">)</span></span><span>
</span><span id="line-981"></span><span id="tcPatSynPat"><span class="annot"><span class="annottext">tcPatSynPat :: forall a.
PatEnv
-&gt; GenLocated SrcSpanAnnN Name
-&gt; PatSyn
-&gt; Scaled ExpSigmaType
-&gt; HsConPatDetails GhcRn
-&gt; TcM a
-&gt; TcM (Pat GhcTc, a)
</span><a href="GHC.Tc.Gen.Pat.html#tcPatSynPat"><span class="hs-identifier hs-var hs-var">tcPatSynPat</span></a></span></span><span> </span><span id="local-6989586621681387049"><span class="annot"><span class="annottext">PatEnv
</span><a href="#local-6989586621681387049"><span class="hs-identifier hs-var">penv</span></a></span></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="GHC.Types.SrcLoc.html#L"><span class="hs-identifier hs-type">L</span></a></span><span> </span><span id="local-6989586621681387048"><span class="annot"><span class="annottext">SrcSpanAnnN
</span><a href="#local-6989586621681387048"><span class="hs-identifier hs-var">con_span</span></a></span></span><span> </span><span id="local-6989586621681387047"><span class="annot"><span class="annottext">Name
</span><a href="#local-6989586621681387047"><span class="hs-identifier hs-var">con_name</span></a></span></span><span class="hs-special">)</span><span> </span><span id="local-6989586621681387046"><span class="annot"><span class="annottext">PatSyn
</span><a href="#local-6989586621681387046"><span class="hs-identifier hs-var">pat_syn</span></a></span></span><span> </span><span id="local-6989586621681387045"><span class="annot"><span class="annottext">Scaled ExpSigmaType
</span><a href="#local-6989586621681387045"><span class="hs-identifier hs-var">pat_ty</span></a></span></span><span> </span><span id="local-6989586621681387044"><span class="annot"><span class="annottext">HsConPatDetails GhcRn
</span><a href="#local-6989586621681387044"><span class="hs-identifier hs-var">arg_pats</span></a></span></span><span> </span><span id="local-6989586621681387043"><span class="annot"><span class="annottext">TcM a
</span><a href="#local-6989586621681387043"><span class="hs-identifier hs-var">thing_inside</span></a></span></span><span>
</span><span id="line-982"></span><span>  </span><span class="hs-glyph">=</span><span> </span><span class="hs-keyword">do</span><span>  </span><span class="hs-special">{</span><span> </span><span class="hs-keyword">let</span><span> </span><span class="hs-special">(</span><span id="local-6989586621681387042"><span class="annot"><span class="annottext">[TyVar]
</span><a href="#local-6989586621681387042"><span class="hs-identifier hs-var">univ_tvs</span></a></span></span><span class="hs-special">,</span><span> </span><span id="local-6989586621681387041"><span class="annot"><span class="annottext">[TcType]
</span><a href="#local-6989586621681387041"><span class="hs-identifier hs-var">req_theta</span></a></span></span><span class="hs-special">,</span><span> </span><span id="local-6989586621681387040"><span class="annot"><span class="annottext">[TyVar]
</span><a href="#local-6989586621681387040"><span class="hs-identifier hs-var">ex_tvs</span></a></span></span><span class="hs-special">,</span><span> </span><span id="local-6989586621681387039"><span class="annot"><span class="annottext">[TcType]
</span><a href="#local-6989586621681387039"><span class="hs-identifier hs-var">prov_theta</span></a></span></span><span class="hs-special">,</span><span> </span><span id="local-6989586621681387038"><span class="annot"><span class="annottext">[Scaled TcType]
</span><a href="#local-6989586621681387038"><span class="hs-identifier hs-var">arg_tys</span></a></span></span><span class="hs-special">,</span><span> </span><span id="local-6989586621681387037"><span class="annot"><span class="annottext">TcType
</span><a href="#local-6989586621681387037"><span class="hs-identifier hs-var">ty</span></a></span></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">PatSyn
-&gt; ([TyVar], [TcType], [TyVar], [TcType], [Scaled TcType], TcType)
</span><a href="GHC.Core.PatSyn.html#patSynSig"><span class="hs-identifier hs-var">patSynSig</span></a></span><span> </span><span class="annot"><span class="annottext">PatSyn
</span><a href="#local-6989586621681387046"><span class="hs-identifier hs-var">pat_syn</span></a></span><span>
</span><span id="line-983"></span><span>
</span><span id="line-984"></span><span>        </span><span class="hs-special">;</span><span> </span><span class="hs-special">(</span><span id="local-6989586621681387035"><span class="annot"><span class="annottext">TCvSubst
</span><a href="#local-6989586621681387035"><span class="hs-identifier hs-var">subst</span></a></span></span><span class="hs-special">,</span><span> </span><span id="local-6989586621681387034"><span class="annot"><span class="annottext">[TyVar]
</span><a href="#local-6989586621681387034"><span class="hs-identifier hs-var">univ_tvs'</span></a></span></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">[TyVar] -&gt; TcM (TCvSubst, [TyVar])
</span><a href="GHC.Tc.Utils.TcMType.html#newMetaTyVars"><span class="hs-identifier hs-var">newMetaTyVars</span></a></span><span> </span><span class="annot"><span class="annottext">[TyVar]
</span><a href="#local-6989586621681387042"><span class="hs-identifier hs-var">univ_tvs</span></a></span><span>
</span><span id="line-985"></span><span>
</span><span id="line-986"></span><span>        </span><span class="hs-comment">-- Check that we aren't matching on a GADT-like pattern synonym</span><span>
</span><span id="line-987"></span><span>        </span><span class="hs-comment">-- in situations in which that isn't allowed.</span><span>
</span><span id="line-988"></span><span>        </span><span class="hs-special">;</span><span> </span><span class="hs-keyword">let</span><span> </span><span id="local-6989586621681387032"><span class="annot"><span class="annottext">all_arg_tys :: [TcType]
</span><a href="#local-6989586621681387032"><span class="hs-identifier hs-var hs-var">all_arg_tys</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">TcType
</span><a href="#local-6989586621681387037"><span class="hs-identifier hs-var">ty</span></a></span><span> </span><span class="annot"><span class="annottext">forall a. a -&gt; [a] -&gt; [a]
</span><span class="hs-glyph hs-var">:</span></span><span> </span><span class="annot"><span class="annottext">[TcType]
</span><a href="#local-6989586621681387039"><span class="hs-identifier hs-var">prov_theta</span></a></span><span> </span><span class="annot"><span class="annottext">forall a. [a] -&gt; [a] -&gt; [a]
</span><a href="../../base-4.16.4.0/src/GHC-Base.html#%2B%2B"><span class="hs-operator hs-var">++</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">forall a b. (a -&gt; b) -&gt; [a] -&gt; [b]
</span><a href="../../base-4.16.4.0/src/GHC-Base.html#map"><span class="hs-identifier hs-var">map</span></a></span><span> </span><span class="annot"><span class="annottext">forall a. Scaled a -&gt; a
</span><a href="GHC.Core.TyCo.Rep.html#scaledThing"><span class="hs-identifier hs-var">scaledThing</span></a></span><span> </span><span class="annot"><span class="annottext">[Scaled TcType]
</span><a href="#local-6989586621681387038"><span class="hs-identifier hs-var">arg_tys</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-989"></span><span>        </span><span class="hs-special">;</span><span> </span><span class="annot"><span class="annottext">ConLike -&gt; [TyVar] -&gt; [TcType] -&gt; PatEnv -&gt; TcRn ()
</span><a href="GHC.Tc.Gen.Pat.html#checkGADT"><span class="hs-identifier hs-var">checkGADT</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">PatSyn -&gt; ConLike
</span><a href="GHC.Core.ConLike.html#PatSynCon"><span class="hs-identifier hs-var">PatSynCon</span></a></span><span> </span><span class="annot"><span class="annottext">PatSyn
</span><a href="#local-6989586621681387046"><span class="hs-identifier hs-var">pat_syn</span></a></span><span class="hs-special">)</span><span> </span><span class="annot"><span class="annottext">[TyVar]
</span><a href="#local-6989586621681387040"><span class="hs-identifier hs-var">ex_tvs</span></a></span><span> </span><span class="annot"><span class="annottext">[TcType]
</span><a href="#local-6989586621681387032"><span class="hs-identifier hs-var">all_arg_tys</span></a></span><span> </span><span class="annot"><span class="annottext">PatEnv
</span><a href="#local-6989586621681387049"><span class="hs-identifier hs-var">penv</span></a></span><span>
</span><span id="line-990"></span><span>
</span><span id="line-991"></span><span>        </span><span class="hs-special">;</span><span> </span><span class="hs-special">(</span><span id="local-6989586621681387031"><span class="annot"><span class="annottext">TCvSubst
</span><a href="#local-6989586621681387031"><span class="hs-identifier hs-var">tenv</span></a></span></span><span class="hs-special">,</span><span> </span><span id="local-6989586621681387030"><span class="annot"><span class="annottext">[TyVar]
</span><a href="#local-6989586621681387030"><span class="hs-identifier hs-var">ex_tvs'</span></a></span></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">TCvSubst -&gt; [TyVar] -&gt; TcM (TCvSubst, [TyVar])
</span><a href="GHC.Tc.Utils.Instantiate.html#tcInstSuperSkolTyVarsX"><span class="hs-identifier hs-var">tcInstSuperSkolTyVarsX</span></a></span><span> </span><span class="annot"><span class="annottext">TCvSubst
</span><a href="#local-6989586621681387035"><span class="hs-identifier hs-var">subst</span></a></span><span> </span><span class="annot"><span class="annottext">[TyVar]
</span><a href="#local-6989586621681387040"><span class="hs-identifier hs-var">ex_tvs</span></a></span><span>
</span><span id="line-992"></span><span>           </span><span class="hs-comment">-- This freshens: Note [Freshen existentials]</span><span>
</span><span id="line-993"></span><span>
</span><span id="line-994"></span><span>        </span><span class="hs-special">;</span><span> </span><span class="hs-keyword">let</span><span> </span><span id="local-6989586621681387029"><span class="annot"><span class="annottext">ty' :: TcType
</span><a href="#local-6989586621681387029"><span class="hs-identifier hs-var hs-var">ty'</span></a></span></span><span>         </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">HasCallStack =&gt; TCvSubst -&gt; TcType -&gt; TcType
</span><a href="GHC.Core.TyCo.Subst.html#substTy"><span class="hs-identifier hs-var">substTy</span></a></span><span> </span><span class="annot"><span class="annottext">TCvSubst
</span><a href="#local-6989586621681387031"><span class="hs-identifier hs-var">tenv</span></a></span><span> </span><span class="annot"><span class="annottext">TcType
</span><a href="#local-6989586621681387037"><span class="hs-identifier hs-var">ty</span></a></span><span>
</span><span id="line-995"></span><span>              </span><span id="local-6989586621681387027"><span class="annot"><span class="annottext">arg_tys' :: [Scaled TcType]
</span><a href="#local-6989586621681387027"><span class="hs-identifier hs-var hs-var">arg_tys'</span></a></span></span><span>    </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">HasCallStack =&gt; TCvSubst -&gt; [Scaled TcType] -&gt; [Scaled TcType]
</span><a href="GHC.Core.TyCo.Subst.html#substScaledTys"><span class="hs-identifier hs-var">substScaledTys</span></a></span><span> </span><span class="annot"><span class="annottext">TCvSubst
</span><a href="#local-6989586621681387031"><span class="hs-identifier hs-var">tenv</span></a></span><span> </span><span class="annot"><span class="annottext">[Scaled TcType]
</span><a href="#local-6989586621681387038"><span class="hs-identifier hs-var">arg_tys</span></a></span><span>
</span><span id="line-996"></span><span>              </span><span id="local-6989586621681387026"><span class="annot"><span class="annottext">pat_mult :: TcType
</span><a href="#local-6989586621681387026"><span class="hs-identifier hs-var hs-var">pat_mult</span></a></span></span><span>    </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">forall a. Scaled a -&gt; TcType
</span><a href="GHC.Core.TyCo.Rep.html#scaledMult"><span class="hs-identifier hs-var">scaledMult</span></a></span><span> </span><span class="annot"><span class="annottext">Scaled ExpSigmaType
</span><a href="#local-6989586621681387045"><span class="hs-identifier hs-var">pat_ty</span></a></span><span>
</span><span id="line-997"></span><span>              </span><span id="local-6989586621681387025"><span class="annot"><span class="annottext">arg_tys_scaled :: [Scaled TcType]
</span><a href="#local-6989586621681387025"><span class="hs-identifier hs-var hs-var">arg_tys_scaled</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">forall a b. (a -&gt; b) -&gt; [a] -&gt; [b]
</span><a href="../../base-4.16.4.0/src/GHC-Base.html#map"><span class="hs-identifier hs-var">map</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">forall a. TcType -&gt; Scaled a -&gt; Scaled a
</span><a href="GHC.Core.Multiplicity.html#scaleScaled"><span class="hs-identifier hs-var">scaleScaled</span></a></span><span> </span><span class="annot"><span class="annottext">TcType
</span><a href="#local-6989586621681387026"><span class="hs-identifier hs-var">pat_mult</span></a></span><span class="hs-special">)</span><span> </span><span class="annot"><span class="annottext">[Scaled TcType]
</span><a href="#local-6989586621681387027"><span class="hs-identifier hs-var">arg_tys'</span></a></span><span>
</span><span id="line-998"></span><span>              </span><span id="local-6989586621681387024"><span class="annot"><span class="annottext">prov_theta' :: [TcType]
</span><a href="#local-6989586621681387024"><span class="hs-identifier hs-var hs-var">prov_theta'</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">HasCallStack =&gt; TCvSubst -&gt; [TcType] -&gt; [TcType]
</span><a href="GHC.Core.TyCo.Subst.html#substTheta"><span class="hs-identifier hs-var">substTheta</span></a></span><span> </span><span class="annot"><span class="annottext">TCvSubst
</span><a href="#local-6989586621681387031"><span class="hs-identifier hs-var">tenv</span></a></span><span> </span><span class="annot"><span class="annottext">[TcType]
</span><a href="#local-6989586621681387039"><span class="hs-identifier hs-var">prov_theta</span></a></span><span>
</span><span id="line-999"></span><span>              </span><span id="local-6989586621681387023"><span class="annot"><span class="annottext">req_theta' :: [TcType]
</span><a href="#local-6989586621681387023"><span class="hs-identifier hs-var hs-var">req_theta'</span></a></span></span><span>  </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">HasCallStack =&gt; TCvSubst -&gt; [TcType] -&gt; [TcType]
</span><a href="GHC.Core.TyCo.Subst.html#substTheta"><span class="hs-identifier hs-var">substTheta</span></a></span><span> </span><span class="annot"><span class="annottext">TCvSubst
</span><a href="#local-6989586621681387031"><span class="hs-identifier hs-var">tenv</span></a></span><span> </span><span class="annot"><span class="annottext">[TcType]
</span><a href="#local-6989586621681387041"><span class="hs-identifier hs-var">req_theta</span></a></span><span>
</span><span id="line-1000"></span><span>
</span><span id="line-1001"></span><span>        </span><span class="hs-special">;</span><span> </span><span id="local-6989586621681387022"><span class="annot"><span class="annottext">HsWrapper
</span><a href="#local-6989586621681387022"><span class="hs-identifier hs-var">mult_wrap</span></a></span></span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">forall a. Scaled a -&gt; TcM HsWrapper
</span><a href="GHC.Tc.Gen.Pat.html#checkManyPattern"><span class="hs-identifier hs-var">checkManyPattern</span></a></span><span> </span><span class="annot"><span class="annottext">Scaled ExpSigmaType
</span><a href="#local-6989586621681387045"><span class="hs-identifier hs-var">pat_ty</span></a></span><span>
</span><span id="line-1002"></span><span>            </span><span class="hs-comment">-- See Note [Wrapper returned from tcSubMult] in GHC.Tc.Utils.Unify.</span><span>
</span><span id="line-1003"></span><span>
</span><span id="line-1004"></span><span>        </span><span class="hs-special">;</span><span> </span><span id="local-6989586621681387021"><span class="annot"><span class="annottext">HsWrapper
</span><a href="#local-6989586621681387021"><span class="hs-identifier hs-var">wrap</span></a></span></span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">PatEnv -&gt; ExpSigmaType -&gt; TcType -&gt; TcM HsWrapper
</span><a href="GHC.Tc.Gen.Pat.html#tc_sub_type"><span class="hs-identifier hs-var">tc_sub_type</span></a></span><span> </span><span class="annot"><span class="annottext">PatEnv
</span><a href="#local-6989586621681387049"><span class="hs-identifier hs-var">penv</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">forall a. Scaled a -&gt; a
</span><a href="GHC.Core.TyCo.Rep.html#scaledThing"><span class="hs-identifier hs-var">scaledThing</span></a></span><span> </span><span class="annot"><span class="annottext">Scaled ExpSigmaType
</span><a href="#local-6989586621681387045"><span class="hs-identifier hs-var">pat_ty</span></a></span><span class="hs-special">)</span><span> </span><span class="annot"><span class="annottext">TcType
</span><a href="#local-6989586621681387029"><span class="hs-identifier hs-var">ty'</span></a></span><span>
</span><span id="line-1005"></span><span>        </span><span class="hs-special">;</span><span> </span><span class="annot"><span class="annottext">String -&gt; SDoc -&gt; TcRn ()
</span><a href="GHC.Tc.Utils.Monad.html#traceTc"><span class="hs-identifier hs-var">traceTc</span></a></span><span> </span><span class="annot"><span class="annottext">String
</span><span class="hs-string">&quot;tcPatSynPat&quot;</span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">forall a. Outputable a =&gt; a -&gt; SDoc
</span><a href="GHC.Utils.Outputable.html#ppr"><span class="hs-identifier hs-var">ppr</span></a></span><span> </span><span class="annot"><span class="annottext">PatSyn
</span><a href="#local-6989586621681387046"><span class="hs-identifier hs-var">pat_syn</span></a></span><span> </span><span class="annot"><span class="annottext">SDoc -&gt; SDoc -&gt; SDoc
</span><a href="GHC.Utils.Outputable.html#%24%24"><span class="hs-operator hs-var">$$</span></a></span><span>
</span><span id="line-1006"></span><span>                                 </span><span class="annot"><span class="annottext">forall a. Outputable a =&gt; a -&gt; SDoc
</span><a href="GHC.Utils.Outputable.html#ppr"><span class="hs-identifier hs-var">ppr</span></a></span><span> </span><span class="annot"><span class="annottext">Scaled ExpSigmaType
</span><a href="#local-6989586621681387045"><span class="hs-identifier hs-var">pat_ty</span></a></span><span> </span><span class="annot"><span class="annottext">SDoc -&gt; SDoc -&gt; SDoc
</span><a href="GHC.Utils.Outputable.html#%24%24"><span class="hs-operator hs-var">$$</span></a></span><span>
</span><span id="line-1007"></span><span>                                 </span><span class="annot"><span class="annottext">forall a. Outputable a =&gt; a -&gt; SDoc
</span><a href="GHC.Utils.Outputable.html#ppr"><span class="hs-identifier hs-var">ppr</span></a></span><span> </span><span class="annot"><span class="annottext">TcType
</span><a href="#local-6989586621681387029"><span class="hs-identifier hs-var">ty'</span></a></span><span> </span><span class="annot"><span class="annottext">SDoc -&gt; SDoc -&gt; SDoc
</span><a href="GHC.Utils.Outputable.html#%24%24"><span class="hs-operator hs-var">$$</span></a></span><span>
</span><span id="line-1008"></span><span>                                 </span><span class="annot"><span class="annottext">forall a. Outputable a =&gt; a -&gt; SDoc
</span><a href="GHC.Utils.Outputable.html#ppr"><span class="hs-identifier hs-var">ppr</span></a></span><span> </span><span class="annot"><span class="annottext">[TyVar]
</span><a href="#local-6989586621681387030"><span class="hs-identifier hs-var">ex_tvs'</span></a></span><span> </span><span class="annot"><span class="annottext">SDoc -&gt; SDoc -&gt; SDoc
</span><a href="GHC.Utils.Outputable.html#%24%24"><span class="hs-operator hs-var">$$</span></a></span><span>
</span><span id="line-1009"></span><span>                                 </span><span class="annot"><span class="annottext">forall a. Outputable a =&gt; a -&gt; SDoc
</span><a href="GHC.Utils.Outputable.html#ppr"><span class="hs-identifier hs-var">ppr</span></a></span><span> </span><span class="annot"><span class="annottext">[TcType]
</span><a href="#local-6989586621681387024"><span class="hs-identifier hs-var">prov_theta'</span></a></span><span> </span><span class="annot"><span class="annottext">SDoc -&gt; SDoc -&gt; SDoc
</span><a href="GHC.Utils.Outputable.html#%24%24"><span class="hs-operator hs-var">$$</span></a></span><span>
</span><span id="line-1010"></span><span>                                 </span><span class="annot"><span class="annottext">forall a. Outputable a =&gt; a -&gt; SDoc
</span><a href="GHC.Utils.Outputable.html#ppr"><span class="hs-identifier hs-var">ppr</span></a></span><span> </span><span class="annot"><span class="annottext">[TcType]
</span><a href="#local-6989586621681387023"><span class="hs-identifier hs-var">req_theta'</span></a></span><span> </span><span class="annot"><span class="annottext">SDoc -&gt; SDoc -&gt; SDoc
</span><a href="GHC.Utils.Outputable.html#%24%24"><span class="hs-operator hs-var">$$</span></a></span><span>
</span><span id="line-1011"></span><span>                                 </span><span class="annot"><span class="annottext">forall a. Outputable a =&gt; a -&gt; SDoc
</span><a href="GHC.Utils.Outputable.html#ppr"><span class="hs-identifier hs-var">ppr</span></a></span><span> </span><span class="annot"><span class="annottext">[Scaled TcType]
</span><a href="#local-6989586621681387027"><span class="hs-identifier hs-var">arg_tys'</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-1012"></span><span>
</span><span id="line-1013"></span><span>        </span><span class="hs-special">;</span><span> </span><span id="local-6989586621681387020"><span class="annot"><span class="annottext">[TyVar]
</span><a href="#local-6989586621681387020"><span class="hs-identifier hs-var">prov_dicts'</span></a></span></span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">[TcType] -&gt; TcM [TyVar]
</span><a href="GHC.Tc.Utils.TcMType.html#newEvVars"><span class="hs-identifier hs-var">newEvVars</span></a></span><span> </span><span class="annot"><span class="annottext">[TcType]
</span><a href="#local-6989586621681387024"><span class="hs-identifier hs-var">prov_theta'</span></a></span><span>
</span><span id="line-1014"></span><span>
</span><span id="line-1015"></span><span>        </span><span class="hs-special">;</span><span> </span><span class="hs-keyword">let</span><span> </span><span id="local-6989586621681387019"><span class="annot"><span class="annottext">skol_info :: SkolemInfo
</span><a href="#local-6989586621681387019"><span class="hs-identifier hs-var hs-var">skol_info</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-keyword">case</span><span> </span><span class="annot"><span class="annottext">PatEnv -&gt; PatCtxt
</span><a href="GHC.Tc.Gen.Pat.html#pe_ctxt"><span class="hs-identifier hs-var">pe_ctxt</span></a></span><span> </span><span class="annot"><span class="annottext">PatEnv
</span><a href="#local-6989586621681387049"><span class="hs-identifier hs-var">penv</span></a></span><span> </span><span class="hs-keyword">of</span><span>
</span><span id="line-1016"></span><span>                            </span><span class="annot"><a href="GHC.Tc.Gen.Pat.html#LamPat"><span class="hs-identifier hs-type">LamPat</span></a></span><span> </span><span id="local-6989586621681387018"><span class="annot"><span class="annottext">HsMatchContext GhcRn
</span><a href="#local-6989586621681387018"><span class="hs-identifier hs-var">mc</span></a></span></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="annottext">ConLike -&gt; HsMatchContext GhcRn -&gt; SkolemInfo
</span><a href="GHC.Tc.Types.Origin.html#PatSkol"><span class="hs-identifier hs-var">PatSkol</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">PatSyn -&gt; ConLike
</span><a href="GHC.Core.ConLike.html#PatSynCon"><span class="hs-identifier hs-var">PatSynCon</span></a></span><span> </span><span class="annot"><span class="annottext">PatSyn
</span><a href="#local-6989586621681387046"><span class="hs-identifier hs-var">pat_syn</span></a></span><span class="hs-special">)</span><span> </span><span class="annot"><span class="annottext">HsMatchContext GhcRn
</span><a href="#local-6989586621681387018"><span class="hs-identifier hs-var">mc</span></a></span><span>
</span><span id="line-1017"></span><span>                            </span><span class="annot"><a href="GHC.Tc.Gen.Pat.html#LetPat"><span class="hs-identifier hs-type">LetPat</span></a></span><span> </span><span class="hs-special">{</span><span class="hs-special">}</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="annottext">SkolemInfo
</span><a href="GHC.Tc.Types.Origin.html#UnkSkol"><span class="hs-identifier hs-var">UnkSkol</span></a></span><span> </span><span class="hs-comment">-- Doesn't matter</span><span>
</span><span id="line-1018"></span><span>
</span><span id="line-1019"></span><span>        </span><span class="hs-special">;</span><span> </span><span id="local-6989586621681387016"><span class="annot"><span class="annottext">HsWrapper
</span><a href="#local-6989586621681387016"><span class="hs-identifier hs-var">req_wrap</span></a></span></span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">CtOrigin -&gt; [TcType] -&gt; [TcType] -&gt; TcM HsWrapper
</span><a href="GHC.Tc.Utils.Instantiate.html#instCall"><span class="hs-identifier hs-var">instCall</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Name -&gt; CtOrigin
</span><a href="GHC.Tc.Types.Origin.html#OccurrenceOf"><span class="hs-identifier hs-var">OccurrenceOf</span></a></span><span> </span><span class="annot"><span class="annottext">Name
</span><a href="#local-6989586621681387047"><span class="hs-identifier hs-var">con_name</span></a></span><span class="hs-special">)</span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">[TyVar] -&gt; [TcType]
</span><a href="GHC.Core.TyCo.Rep.html#mkTyVarTys"><span class="hs-identifier hs-var">mkTyVarTys</span></a></span><span> </span><span class="annot"><span class="annottext">[TyVar]
</span><a href="#local-6989586621681387034"><span class="hs-identifier hs-var">univ_tvs'</span></a></span><span class="hs-special">)</span><span> </span><span class="annot"><span class="annottext">[TcType]
</span><a href="#local-6989586621681387023"><span class="hs-identifier hs-var">req_theta'</span></a></span><span>
</span><span id="line-1020"></span><span>                      </span><span class="hs-comment">-- Origin (OccurrenceOf con_name):</span><span>
</span><span id="line-1021"></span><span>                      </span><span class="hs-comment">-- see Note [Call-stack tracing of pattern synonyms]</span><span>
</span><span id="line-1022"></span><span>        </span><span class="hs-special">;</span><span> </span><span class="annot"><span class="annottext">String -&gt; SDoc -&gt; TcRn ()
</span><a href="GHC.Tc.Utils.Monad.html#traceTc"><span class="hs-identifier hs-var">traceTc</span></a></span><span> </span><span class="annot"><span class="annottext">String
</span><span class="hs-string">&quot;instCall&quot;</span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">forall a. Outputable a =&gt; a -&gt; SDoc
</span><a href="GHC.Utils.Outputable.html#ppr"><span class="hs-identifier hs-var">ppr</span></a></span><span> </span><span class="annot"><span class="annottext">HsWrapper
</span><a href="#local-6989586621681387016"><span class="hs-identifier hs-var">req_wrap</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-1023"></span><span>
</span><span id="line-1024"></span><span>        </span><span class="hs-special">;</span><span> </span><span class="annot"><span class="annottext">String -&gt; SDoc -&gt; TcRn ()
</span><a href="GHC.Tc.Utils.Monad.html#traceTc"><span class="hs-identifier hs-var">traceTc</span></a></span><span> </span><span class="annot"><span class="annottext">String
</span><span class="hs-string">&quot;checkConstraints {&quot;</span></span><span> </span><span class="annot"><span class="annottext">SDoc
</span><a href="GHC.Utils.Outputable.html#empty"><span class="hs-identifier hs-var">Outputable.empty</span></a></span><span>
</span><span id="line-1025"></span><span>        </span><span class="hs-special">;</span><span> </span><span class="hs-special">(</span><span id="local-6989586621681387011"><span class="annot"><span class="annottext">TcEvBinds
</span><a href="#local-6989586621681387011"><span class="hs-identifier hs-var">ev_binds</span></a></span></span><span class="hs-special">,</span><span> </span><span class="hs-special">(</span><span id="local-6989586621681387010"><span class="annot"><span class="annottext">HsConDetails
  (HsPatSigType GhcRn)
  (GenLocated (SrcSpanAnn' (EpAnn AnnListItem)) (Pat GhcTc))
  (HsRecFields
     GhcTc (GenLocated (SrcSpanAnn' (EpAnn AnnListItem)) (Pat GhcTc)))
</span><a href="#local-6989586621681387010"><span class="hs-identifier hs-var">arg_pats'</span></a></span></span><span class="hs-special">,</span><span> </span><span id="local-6989586621681387009"><span class="annot"><span class="annottext">a
</span><a href="#local-6989586621681387009"><span class="hs-identifier hs-var">res</span></a></span></span><span class="hs-special">)</span><span class="hs-special">)</span><span>
</span><span id="line-1026"></span><span>             </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">forall result.
SkolemInfo
-&gt; [TyVar] -&gt; [TyVar] -&gt; TcM result -&gt; TcM (TcEvBinds, result)
</span><a href="GHC.Tc.Utils.Unify.html#checkConstraints"><span class="hs-identifier hs-var">checkConstraints</span></a></span><span> </span><span class="annot"><span class="annottext">SkolemInfo
</span><a href="#local-6989586621681387019"><span class="hs-identifier hs-var">skol_info</span></a></span><span> </span><span class="annot"><span class="annottext">[TyVar]
</span><a href="#local-6989586621681387030"><span class="hs-identifier hs-var">ex_tvs'</span></a></span><span> </span><span class="annot"><span class="annottext">[TyVar]
</span><a href="#local-6989586621681387020"><span class="hs-identifier hs-var">prov_dicts'</span></a></span><span> </span><span class="annot"><span class="annottext">forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><a href="../../base-4.16.4.0/src/GHC-Base.html#%24"><span class="hs-operator hs-var">$</span></a></span><span>
</span><span id="line-1027"></span><span>                </span><span class="annot"><span class="annottext">ConLike
-&gt; [Scaled TcType]
-&gt; TCvSubst
-&gt; Checker (HsConPatDetails GhcRn) (HsConPatDetails GhcTc)
</span><a href="GHC.Tc.Gen.Pat.html#tcConArgs"><span class="hs-identifier hs-var">tcConArgs</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">PatSyn -&gt; ConLike
</span><a href="GHC.Core.ConLike.html#PatSynCon"><span class="hs-identifier hs-var">PatSynCon</span></a></span><span> </span><span class="annot"><span class="annottext">PatSyn
</span><a href="#local-6989586621681387046"><span class="hs-identifier hs-var">pat_syn</span></a></span><span class="hs-special">)</span><span> </span><span class="annot"><span class="annottext">[Scaled TcType]
</span><a href="#local-6989586621681387025"><span class="hs-identifier hs-var">arg_tys_scaled</span></a></span><span> </span><span class="annot"><span class="annottext">TCvSubst
</span><a href="#local-6989586621681387031"><span class="hs-identifier hs-var">tenv</span></a></span><span> </span><span class="annot"><span class="annottext">PatEnv
</span><a href="#local-6989586621681387049"><span class="hs-identifier hs-var">penv</span></a></span><span> </span><span class="annot"><span class="annottext">HsConPatDetails GhcRn
</span><a href="#local-6989586621681387044"><span class="hs-identifier hs-var">arg_pats</span></a></span><span> </span><span class="annot"><span class="annottext">TcM a
</span><a href="#local-6989586621681387043"><span class="hs-identifier hs-var">thing_inside</span></a></span><span>
</span><span id="line-1028"></span><span>
</span><span id="line-1029"></span><span>        </span><span class="hs-special">;</span><span> </span><span class="annot"><span class="annottext">String -&gt; SDoc -&gt; TcRn ()
</span><a href="GHC.Tc.Utils.Monad.html#traceTc"><span class="hs-identifier hs-var">traceTc</span></a></span><span> </span><span class="annot"><span class="annottext">String
</span><span class="hs-string">&quot;checkConstraints }&quot;</span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">forall a. Outputable a =&gt; a -&gt; SDoc
</span><a href="GHC.Utils.Outputable.html#ppr"><span class="hs-identifier hs-var">ppr</span></a></span><span> </span><span class="annot"><span class="annottext">TcEvBinds
</span><a href="#local-6989586621681387011"><span class="hs-identifier hs-var">ev_binds</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-1030"></span><span>        </span><span class="hs-special">;</span><span> </span><span class="hs-keyword">let</span><span> </span><span id="local-6989586621681387008"><span class="annot"><span class="annottext">res_pat :: Pat GhcTc
</span><a href="#local-6989586621681387008"><span class="hs-identifier hs-var hs-var">res_pat</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><a href="Language.Haskell.Syntax.Pat.html#ConPat"><span class="hs-identifier hs-type">ConPat</span></a></span><span> </span><span class="hs-special">{</span><span> </span><span class="annot"><span class="annottext">pat_con :: XRec GhcTc (ConLikeP GhcTc)
</span><a href="Language.Haskell.Syntax.Pat.html#pat_con"><span class="hs-identifier hs-var">pat_con</span></a></span><span>   </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">forall l e. l -&gt; e -&gt; GenLocated l e
</span><a href="GHC.Types.SrcLoc.html#L"><span class="hs-identifier hs-var">L</span></a></span><span> </span><span class="annot"><span class="annottext">SrcSpanAnnN
</span><a href="#local-6989586621681387048"><span class="hs-identifier hs-var">con_span</span></a></span><span> </span><span class="annot"><span class="annottext">forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><a href="../../base-4.16.4.0/src/GHC-Base.html#%24"><span class="hs-operator hs-var">$</span></a></span><span> </span><span class="annot"><span class="annottext">PatSyn -&gt; ConLike
</span><a href="GHC.Core.ConLike.html#PatSynCon"><span class="hs-identifier hs-var">PatSynCon</span></a></span><span> </span><span class="annot"><span class="annottext">PatSyn
</span><a href="#local-6989586621681387046"><span class="hs-identifier hs-var">pat_syn</span></a></span><span>
</span><span id="line-1031"></span><span>                               </span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">pat_args :: HsConPatDetails GhcTc
</span><a href="Language.Haskell.Syntax.Pat.html#pat_args"><span class="hs-identifier hs-var">pat_args</span></a></span><span>  </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">HsConDetails
  (HsPatSigType GhcRn)
  (GenLocated (SrcSpanAnn' (EpAnn AnnListItem)) (Pat GhcTc))
  (HsRecFields
     GhcTc (GenLocated (SrcSpanAnn' (EpAnn AnnListItem)) (Pat GhcTc)))
</span><a href="#local-6989586621681387010"><span class="hs-identifier hs-var">arg_pats'</span></a></span><span>
</span><span id="line-1032"></span><span>                               </span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">pat_con_ext :: XConPat GhcTc
</span><a href="Language.Haskell.Syntax.Pat.html#pat_con_ext"><span class="hs-identifier hs-var">pat_con_ext</span></a></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><a href="GHC.Hs.Pat.html#ConPatTc"><span class="hs-identifier hs-type">ConPatTc</span></a></span><span>
</span><span id="line-1033"></span><span>                                 </span><span class="hs-special">{</span><span> </span><span class="annot"><span class="annottext">cpt_tvs :: [TyVar]
</span><a href="GHC.Hs.Pat.html#cpt_tvs"><span class="hs-identifier hs-var">cpt_tvs</span></a></span><span>   </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">[TyVar]
</span><a href="#local-6989586621681387030"><span class="hs-identifier hs-var">ex_tvs'</span></a></span><span>
</span><span id="line-1034"></span><span>                                 </span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">cpt_dicts :: [TyVar]
</span><a href="GHC.Hs.Pat.html#cpt_dicts"><span class="hs-identifier hs-var">cpt_dicts</span></a></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">[TyVar]
</span><a href="#local-6989586621681387020"><span class="hs-identifier hs-var">prov_dicts'</span></a></span><span>
</span><span id="line-1035"></span><span>                                 </span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">cpt_binds :: TcEvBinds
</span><a href="GHC.Hs.Pat.html#cpt_binds"><span class="hs-identifier hs-var">cpt_binds</span></a></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">TcEvBinds
</span><a href="#local-6989586621681387011"><span class="hs-identifier hs-var">ev_binds</span></a></span><span>
</span><span id="line-1036"></span><span>                                 </span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">cpt_arg_tys :: [TcType]
</span><a href="GHC.Hs.Pat.html#cpt_arg_tys"><span class="hs-identifier hs-var">cpt_arg_tys</span></a></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">[TyVar] -&gt; [TcType]
</span><a href="GHC.Core.TyCo.Rep.html#mkTyVarTys"><span class="hs-identifier hs-var">mkTyVarTys</span></a></span><span> </span><span class="annot"><span class="annottext">[TyVar]
</span><a href="#local-6989586621681387034"><span class="hs-identifier hs-var">univ_tvs'</span></a></span><span>
</span><span id="line-1037"></span><span>                                 </span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">cpt_wrap :: HsWrapper
</span><a href="GHC.Hs.Pat.html#cpt_wrap"><span class="hs-identifier hs-var">cpt_wrap</span></a></span><span>  </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">HsWrapper
</span><a href="#local-6989586621681387016"><span class="hs-identifier hs-var">req_wrap</span></a></span><span>
</span><span id="line-1038"></span><span>                                 </span><span class="hs-special">}</span><span>
</span><span id="line-1039"></span><span>                               </span><span class="hs-special">}</span><span>
</span><span id="line-1040"></span><span>        </span><span class="hs-special">;</span><span> </span><span id="local-6989586621681387007"><span class="annot"><span class="annottext">TcType
</span><a href="#local-6989586621681387007"><span class="hs-identifier hs-var">pat_ty</span></a></span></span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">ExpSigmaType -&gt; TcM TcType
</span><a href="GHC.Tc.Utils.TcMType.html#readExpType"><span class="hs-identifier hs-var">readExpType</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">forall a. Scaled a -&gt; a
</span><a href="GHC.Core.TyCo.Rep.html#scaledThing"><span class="hs-identifier hs-var">scaledThing</span></a></span><span> </span><span class="annot"><span class="annottext">Scaled ExpSigmaType
</span><a href="#local-6989586621681387045"><span class="hs-identifier hs-var">pat_ty</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-1041"></span><span>        </span><span class="hs-special">;</span><span> </span><span class="annot"><span class="annottext">forall (m :: * -&gt; *) a. Monad m =&gt; a -&gt; m a
</span><a href="../../base-4.16.4.0/src/GHC-Base.html#return"><span class="hs-identifier hs-var">return</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">HsWrapper -&gt; Pat GhcTc -&gt; TcType -&gt; Pat GhcTc
</span><a href="GHC.Hs.Utils.html#mkHsWrapPat"><span class="hs-identifier hs-var">mkHsWrapPat</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">HsWrapper
</span><a href="#local-6989586621681387021"><span class="hs-identifier hs-var">wrap</span></a></span><span> </span><span class="annot"><span class="annottext">HsWrapper -&gt; HsWrapper -&gt; HsWrapper
</span><a href="GHC.Tc.Types.Evidence.html#%3C.%3E"><span class="hs-operator hs-var">&lt;.&gt;</span></a></span><span> </span><span class="annot"><span class="annottext">HsWrapper
</span><a href="#local-6989586621681387022"><span class="hs-identifier hs-var">mult_wrap</span></a></span><span class="hs-special">)</span><span> </span><span class="annot"><span class="annottext">Pat GhcTc
</span><a href="#local-6989586621681387008"><span class="hs-identifier hs-var">res_pat</span></a></span><span> </span><span class="annot"><span class="annottext">TcType
</span><a href="#local-6989586621681387007"><span class="hs-identifier hs-var">pat_ty</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">a
</span><a href="#local-6989586621681387009"><span class="hs-identifier hs-var">res</span></a></span><span class="hs-special">)</span><span> </span><span class="hs-special">}</span><span>
</span><span id="line-1042"></span><span>
</span><span id="line-1043"></span><span class="hs-comment">{- Note [Call-stack tracing of pattern synonyms]
~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~
Consider
   f :: HasCallStack =&gt; blah

   pattern Annotated :: HasCallStack =&gt; (CallStack, a) -&gt; a
   pattern Annotated x &lt;- (f -&gt; x)

When we pattern-match against `Annotated` we will call `f`, and must
pass a call-stack.  We may want `Annotated` itself to propagate the call
stack, so we give it a HasCallStack constraint too.  But then we expect
to see `Annotated` in the call stack.

This is achieve easily, but a bit trickily.  When we instantiate
Annotated's &quot;required&quot; constraints, in tcPatSynPat, give them a
CtOrigin of (OccurrenceOf &quot;Annotated&quot;). That way the special magic
in GHC.Tc.Solver.Canonical.canClassNC which deals with CallStack
constraints will kick in: that logic only fires on constraints
whose Origin is (OccurrenceOf f).

See also Note [Overview of implicit CallStacks] in GHC.Tc.Types.Evidence
and Note [Solving CallStack constraints] in GHC.Tc.Solver.Monad
-}</span><span>
</span><span id="line-1066"></span><span class="hs-comment">----------------------------</span><span>
</span><span id="line-1067"></span><span class="hs-comment">-- | Convenient wrapper for calling a matchExpectedXXX function</span><span>
</span><span id="line-1068"></span><span id="local-6989586621681388069"><span class="annot"><a href="GHC.Tc.Gen.Pat.html#matchExpectedPatTy"><span class="hs-identifier hs-type">matchExpectedPatTy</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="hs-special">(</span><span class="annot"><a href="GHC.Tc.Utils.TcType.html#TcRhoType"><span class="hs-identifier hs-type">TcRhoType</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="GHC.Tc.Types.html#TcM"><span class="hs-identifier hs-type">TcM</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="GHC.Tc.Types.Evidence.html#TcCoercionN"><span class="hs-identifier hs-type">TcCoercionN</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><a href="#local-6989586621681388069"><span class="hs-identifier hs-type">a</span></a></span><span class="hs-special">)</span><span class="hs-special">)</span><span>
</span><span id="line-1069"></span><span>                    </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="GHC.Tc.Gen.Pat.html#PatEnv"><span class="hs-identifier hs-type">PatEnv</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="GHC.Tc.Utils.TcType.html#ExpSigmaType"><span class="hs-identifier hs-type">ExpSigmaType</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="GHC.Tc.Types.html#TcM"><span class="hs-identifier hs-type">TcM</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="GHC.Tc.Types.Evidence.html#HsWrapper"><span class="hs-identifier hs-type">HsWrapper</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><a href="#local-6989586621681388069"><span class="hs-identifier hs-type">a</span></a></span><span class="hs-special">)</span></span><span>
</span><span id="line-1070"></span><span class="hs-comment">-- See Note [Matching polytyped patterns]</span><span>
</span><span id="line-1071"></span><span class="hs-comment">-- Returns a wrapper : pat_ty ~R inner_ty</span><span>
</span><span id="line-1072"></span><span id="matchExpectedPatTy"><span class="annot"><span class="annottext">matchExpectedPatTy :: forall a.
(TcType -&gt; TcM (TcCoercionN, a))
-&gt; PatEnv -&gt; ExpSigmaType -&gt; TcM (HsWrapper, a)
</span><a href="GHC.Tc.Gen.Pat.html#matchExpectedPatTy"><span class="hs-identifier hs-var hs-var">matchExpectedPatTy</span></a></span></span><span> </span><span id="local-6989586621681386998"><span class="annot"><span class="annottext">TcType -&gt; TcM (TcCoercionN, a)
</span><a href="#local-6989586621681386998"><span class="hs-identifier hs-var">inner_match</span></a></span></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="GHC.Tc.Gen.Pat.html#PE"><span class="hs-identifier hs-type">PE</span></a></span><span> </span><span class="hs-special">{</span><span> </span><span class="annot"><span class="annottext">pe_orig :: PatEnv -&gt; CtOrigin
</span><a href="GHC.Tc.Gen.Pat.html#pe_orig"><span class="hs-identifier hs-var">pe_orig</span></a></span><span> </span><span class="hs-glyph">=</span><span> </span><span id="local-6989586621681386997"><span class="annot"><span class="annottext">CtOrigin
</span><a href="#local-6989586621681386997"><span class="hs-identifier hs-var">orig</span></a></span></span><span> </span><span class="hs-special">}</span><span class="hs-special">)</span><span> </span><span id="local-6989586621681386996"><span class="annot"><span class="annottext">ExpSigmaType
</span><a href="#local-6989586621681386996"><span class="hs-identifier hs-var">pat_ty</span></a></span></span><span>
</span><span id="line-1073"></span><span>  </span><span class="hs-glyph">=</span><span> </span><span class="hs-keyword">do</span><span> </span><span class="hs-special">{</span><span> </span><span id="local-6989586621681386995"><span class="annot"><span class="annottext">TcType
</span><a href="#local-6989586621681386995"><span class="hs-identifier hs-var">pat_ty</span></a></span></span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">ExpSigmaType -&gt; TcM TcType
</span><a href="GHC.Tc.Utils.TcMType.html#expTypeToType"><span class="hs-identifier hs-var">expTypeToType</span></a></span><span> </span><span class="annot"><span class="annottext">ExpSigmaType
</span><a href="#local-6989586621681386996"><span class="hs-identifier hs-var">pat_ty</span></a></span><span>
</span><span id="line-1074"></span><span>       </span><span class="hs-special">;</span><span> </span><span class="hs-special">(</span><span id="local-6989586621681386994"><span class="annot"><span class="annottext">HsWrapper
</span><a href="#local-6989586621681386994"><span class="hs-identifier hs-var">wrap</span></a></span></span><span class="hs-special">,</span><span> </span><span id="local-6989586621681386993"><span class="annot"><span class="annottext">TcType
</span><a href="#local-6989586621681386993"><span class="hs-identifier hs-var">pat_rho</span></a></span></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">CtOrigin -&gt; TcType -&gt; TcM (HsWrapper, TcType)
</span><a href="GHC.Tc.Utils.Instantiate.html#topInstantiate"><span class="hs-identifier hs-var">topInstantiate</span></a></span><span> </span><span class="annot"><span class="annottext">CtOrigin
</span><a href="#local-6989586621681386997"><span class="hs-identifier hs-var">orig</span></a></span><span> </span><span class="annot"><span class="annottext">TcType
</span><a href="#local-6989586621681386995"><span class="hs-identifier hs-var">pat_ty</span></a></span><span>
</span><span id="line-1075"></span><span>       </span><span class="hs-special">;</span><span> </span><span class="hs-special">(</span><span id="local-6989586621681386991"><span class="annot"><span class="annottext">TcCoercionN
</span><a href="#local-6989586621681386991"><span class="hs-identifier hs-var">co</span></a></span></span><span class="hs-special">,</span><span> </span><span id="local-6989586621681386990"><span class="annot"><span class="annottext">a
</span><a href="#local-6989586621681386990"><span class="hs-identifier hs-var">res</span></a></span></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">TcType -&gt; TcM (TcCoercionN, a)
</span><a href="#local-6989586621681386998"><span class="hs-identifier hs-var">inner_match</span></a></span><span> </span><span class="annot"><span class="annottext">TcType
</span><a href="#local-6989586621681386993"><span class="hs-identifier hs-var">pat_rho</span></a></span><span>
</span><span id="line-1076"></span><span>       </span><span class="hs-special">;</span><span> </span><span class="annot"><span class="annottext">String -&gt; SDoc -&gt; TcRn ()
</span><a href="GHC.Tc.Utils.Monad.html#traceTc"><span class="hs-identifier hs-var">traceTc</span></a></span><span> </span><span class="annot"><span class="annottext">String
</span><span class="hs-string">&quot;matchExpectedPatTy&quot;</span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">forall a. Outputable a =&gt; a -&gt; SDoc
</span><a href="GHC.Utils.Outputable.html#ppr"><span class="hs-identifier hs-var">ppr</span></a></span><span> </span><span class="annot"><span class="annottext">TcType
</span><a href="#local-6989586621681386995"><span class="hs-identifier hs-var">pat_ty</span></a></span><span> </span><span class="annot"><span class="annottext">SDoc -&gt; SDoc -&gt; SDoc
</span><a href="GHC.Utils.Outputable.html#%24%24"><span class="hs-operator hs-var">$$</span></a></span><span> </span><span class="annot"><span class="annottext">forall a. Outputable a =&gt; a -&gt; SDoc
</span><a href="GHC.Utils.Outputable.html#ppr"><span class="hs-identifier hs-var">ppr</span></a></span><span> </span><span class="annot"><span class="annottext">HsWrapper
</span><a href="#local-6989586621681386994"><span class="hs-identifier hs-var">wrap</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-1077"></span><span>       </span><span class="hs-special">;</span><span> </span><span class="annot"><span class="annottext">forall (m :: * -&gt; *) a. Monad m =&gt; a -&gt; m a
</span><a href="../../base-4.16.4.0/src/GHC-Base.html#return"><span class="hs-identifier hs-var">return</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">TcCoercionN -&gt; HsWrapper
</span><a href="GHC.Tc.Types.Evidence.html#mkWpCastN"><span class="hs-identifier hs-var">mkWpCastN</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">TcCoercionN -&gt; TcCoercionN
</span><a href="GHC.Tc.Types.Evidence.html#mkTcSymCo"><span class="hs-identifier hs-var">mkTcSymCo</span></a></span><span> </span><span class="annot"><span class="annottext">TcCoercionN
</span><a href="#local-6989586621681386991"><span class="hs-identifier hs-var">co</span></a></span><span class="hs-special">)</span><span> </span><span class="annot"><span class="annottext">HsWrapper -&gt; HsWrapper -&gt; HsWrapper
</span><a href="GHC.Tc.Types.Evidence.html#%3C.%3E"><span class="hs-operator hs-var">&lt;.&gt;</span></a></span><span> </span><span class="annot"><span class="annottext">HsWrapper
</span><a href="#local-6989586621681386994"><span class="hs-identifier hs-var">wrap</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">a
</span><a href="#local-6989586621681386990"><span class="hs-identifier hs-var">res</span></a></span><span class="hs-special">)</span><span> </span><span class="hs-special">}</span><span>
</span><span id="line-1078"></span><span>
</span><span id="line-1079"></span><span class="hs-comment">----------------------------</span><span>
</span><span id="line-1080"></span><span class="annot"><a href="GHC.Tc.Gen.Pat.html#matchExpectedConTy"><span class="hs-identifier hs-type">matchExpectedConTy</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><a href="GHC.Tc.Gen.Pat.html#PatEnv"><span class="hs-identifier hs-type">PatEnv</span></a></span><span>
</span><span id="line-1081"></span><span>                   </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="GHC.Core.TyCon.html#TyCon"><span class="hs-identifier hs-type">TyCon</span></a></span><span>      </span><span class="hs-comment">-- The TyCon that this data</span><span>
</span><span id="line-1082"></span><span>                                 </span><span class="hs-comment">-- constructor actually returns</span><span>
</span><span id="line-1083"></span><span>                                 </span><span class="hs-comment">-- In the case of a data family this is</span><span>
</span><span id="line-1084"></span><span>                                 </span><span class="hs-comment">-- the /representation/ TyCon</span><span>
</span><span id="line-1085"></span><span>                   </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="GHC.Core.TyCo.Rep.html#Scaled"><span class="hs-identifier hs-type">Scaled</span></a></span><span> </span><span class="annot"><a href="GHC.Tc.Utils.TcType.html#ExpSigmaType"><span class="hs-identifier hs-type">ExpSigmaType</span></a></span><span>  </span><span class="hs-comment">-- The type of the pattern; in the</span><span>
</span><span id="line-1086"></span><span>                                           </span><span class="hs-comment">-- case of a data family this would</span><span>
</span><span id="line-1087"></span><span>                                           </span><span class="hs-comment">-- mention the /family/ TyCon</span><span>
</span><span id="line-1088"></span><span>                   </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="GHC.Tc.Types.html#TcM"><span class="hs-identifier hs-type">TcM</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="GHC.Tc.Types.Evidence.html#HsWrapper"><span class="hs-identifier hs-type">HsWrapper</span></a></span><span class="hs-special">,</span><span> </span><span class="hs-special">[</span><span class="annot"><a href="GHC.Tc.Utils.TcType.html#TcSigmaType"><span class="hs-identifier hs-type">TcSigmaType</span></a></span><span class="hs-special">]</span><span class="hs-special">)</span><span>
</span><span id="line-1089"></span><span class="hs-comment">-- See Note [Matching constructor patterns]</span><span>
</span><span id="line-1090"></span><span class="hs-comment">-- Returns a wrapper : pat_ty &quot;-&gt;&quot; T ty1 ... tyn</span><span>
</span><span id="line-1091"></span><span id="matchExpectedConTy"><span class="annot"><span class="annottext">matchExpectedConTy :: PatEnv -&gt; TyCon -&gt; Scaled ExpSigmaType -&gt; TcM (HsWrapper, [TcType])
</span><a href="GHC.Tc.Gen.Pat.html#matchExpectedConTy"><span class="hs-identifier hs-var hs-var">matchExpectedConTy</span></a></span></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="GHC.Tc.Gen.Pat.html#PE"><span class="hs-identifier hs-type">PE</span></a></span><span> </span><span class="hs-special">{</span><span> </span><span class="annot"><span class="annottext">pe_orig :: PatEnv -&gt; CtOrigin
</span><a href="GHC.Tc.Gen.Pat.html#pe_orig"><span class="hs-identifier hs-var">pe_orig</span></a></span><span> </span><span class="hs-glyph">=</span><span> </span><span id="local-6989586621681386988"><span class="annot"><span class="annottext">CtOrigin
</span><a href="#local-6989586621681386988"><span class="hs-identifier hs-var">orig</span></a></span></span><span> </span><span class="hs-special">}</span><span class="hs-special">)</span><span> </span><span id="local-6989586621681386987"><span class="annot"><span class="annottext">TyCon
</span><a href="#local-6989586621681386987"><span class="hs-identifier hs-var">data_tc</span></a></span></span><span> </span><span id="local-6989586621681386986"><span class="annot"><span class="annottext">Scaled ExpSigmaType
</span><a href="#local-6989586621681386986"><span class="hs-identifier hs-var">exp_pat_ty</span></a></span></span><span>
</span><span id="line-1092"></span><span>  </span><span class="hs-glyph">|</span><span> </span><span class="annot"><a href="../../base-4.16.4.0/src/GHC-Maybe.html#Just"><span class="hs-identifier hs-type">Just</span></a></span><span> </span><span class="hs-special">(</span><span id="local-6989586621681386985"><span class="annot"><span class="annottext">TyCon
</span><a href="#local-6989586621681386985"><span class="hs-identifier hs-var">fam_tc</span></a></span></span><span class="hs-special">,</span><span> </span><span id="local-6989586621681386984"><span class="annot"><span class="annottext">[TcType]
</span><a href="#local-6989586621681386984"><span class="hs-identifier hs-var">fam_args</span></a></span></span><span class="hs-special">,</span><span> </span><span id="local-6989586621681386983"><span class="annot"><span class="annottext">CoAxiom Unbranched
</span><a href="#local-6989586621681386983"><span class="hs-identifier hs-var">co_tc</span></a></span></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">TyCon -&gt; Maybe (TyCon, [TcType], CoAxiom Unbranched)
</span><a href="GHC.Core.TyCon.html#tyConFamInstSig_maybe"><span class="hs-identifier hs-var">tyConFamInstSig_maybe</span></a></span><span> </span><span class="annot"><span class="annottext">TyCon
</span><a href="#local-6989586621681386987"><span class="hs-identifier hs-var">data_tc</span></a></span><span>
</span><span id="line-1093"></span><span>         </span><span class="hs-comment">-- Comments refer to Note [Matching constructor patterns]</span><span>
</span><span id="line-1094"></span><span>         </span><span class="hs-comment">-- co_tc :: forall a. T [a] ~ T7 a</span><span>
</span><span id="line-1095"></span><span>  </span><span class="hs-glyph">=</span><span> </span><span class="hs-keyword">do</span><span> </span><span class="hs-special">{</span><span> </span><span id="local-6989586621681386981"><span class="annot"><span class="annottext">TcType
</span><a href="#local-6989586621681386981"><span class="hs-identifier hs-var">pat_ty</span></a></span></span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">ExpSigmaType -&gt; TcM TcType
</span><a href="GHC.Tc.Utils.TcMType.html#expTypeToType"><span class="hs-identifier hs-var">expTypeToType</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">forall a. Scaled a -&gt; a
</span><a href="GHC.Core.TyCo.Rep.html#scaledThing"><span class="hs-identifier hs-var">scaledThing</span></a></span><span> </span><span class="annot"><span class="annottext">Scaled ExpSigmaType
</span><a href="#local-6989586621681386986"><span class="hs-identifier hs-var">exp_pat_ty</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-1096"></span><span>       </span><span class="hs-special">;</span><span> </span><span class="hs-special">(</span><span id="local-6989586621681386980"><span class="annot"><span class="annottext">HsWrapper
</span><a href="#local-6989586621681386980"><span class="hs-identifier hs-var">wrap</span></a></span></span><span class="hs-special">,</span><span> </span><span id="local-6989586621681386979"><span class="annot"><span class="annottext">TcType
</span><a href="#local-6989586621681386979"><span class="hs-identifier hs-var">pat_rho</span></a></span></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">CtOrigin -&gt; TcType -&gt; TcM (HsWrapper, TcType)
</span><a href="GHC.Tc.Utils.Instantiate.html#topInstantiate"><span class="hs-identifier hs-var">topInstantiate</span></a></span><span> </span><span class="annot"><span class="annottext">CtOrigin
</span><a href="#local-6989586621681386988"><span class="hs-identifier hs-var">orig</span></a></span><span> </span><span class="annot"><span class="annottext">TcType
</span><a href="#local-6989586621681386981"><span class="hs-identifier hs-var">pat_ty</span></a></span><span>
</span><span id="line-1097"></span><span>
</span><span id="line-1098"></span><span>       </span><span class="hs-special">;</span><span> </span><span class="hs-special">(</span><span id="local-6989586621681386978"><span class="annot"><span class="annottext">TCvSubst
</span><a href="#local-6989586621681386978"><span class="hs-identifier hs-var">subst</span></a></span></span><span class="hs-special">,</span><span> </span><span id="local-6989586621681386977"><span class="annot"><span class="annottext">[TyVar]
</span><a href="#local-6989586621681386977"><span class="hs-identifier hs-var">tvs'</span></a></span></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">[TyVar] -&gt; TcM (TCvSubst, [TyVar])
</span><a href="GHC.Tc.Utils.TcMType.html#newMetaTyVars"><span class="hs-identifier hs-var">newMetaTyVars</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">TyCon -&gt; [TyVar]
</span><a href="GHC.Core.TyCon.html#tyConTyVars"><span class="hs-identifier hs-var">tyConTyVars</span></a></span><span> </span><span class="annot"><span class="annottext">TyCon
</span><a href="#local-6989586621681386987"><span class="hs-identifier hs-var">data_tc</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-1099"></span><span>             </span><span class="hs-comment">-- tys = [ty1,ty2]</span><span>
</span><span id="line-1100"></span><span>
</span><span id="line-1101"></span><span>       </span><span class="hs-special">;</span><span> </span><span class="annot"><span class="annottext">String -&gt; SDoc -&gt; TcRn ()
</span><a href="GHC.Tc.Utils.Monad.html#traceTc"><span class="hs-identifier hs-var">traceTc</span></a></span><span> </span><span class="annot"><span class="annottext">String
</span><span class="hs-string">&quot;matchExpectedConTy&quot;</span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">[SDoc] -&gt; SDoc
</span><a href="GHC.Utils.Outputable.html#vcat"><span class="hs-identifier hs-var">vcat</span></a></span><span> </span><span class="hs-special">[</span><span class="annot"><span class="annottext">forall a. Outputable a =&gt; a -&gt; SDoc
</span><a href="GHC.Utils.Outputable.html#ppr"><span class="hs-identifier hs-var">ppr</span></a></span><span> </span><span class="annot"><span class="annottext">TyCon
</span><a href="#local-6989586621681386987"><span class="hs-identifier hs-var">data_tc</span></a></span><span class="hs-special">,</span><span>
</span><span id="line-1102"></span><span>                                             </span><span class="annot"><span class="annottext">forall a. Outputable a =&gt; a -&gt; SDoc
</span><a href="GHC.Utils.Outputable.html#ppr"><span class="hs-identifier hs-var">ppr</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">TyCon -&gt; [TyVar]
</span><a href="GHC.Core.TyCon.html#tyConTyVars"><span class="hs-identifier hs-var">tyConTyVars</span></a></span><span> </span><span class="annot"><span class="annottext">TyCon
</span><a href="#local-6989586621681386987"><span class="hs-identifier hs-var">data_tc</span></a></span><span class="hs-special">)</span><span class="hs-special">,</span><span>
</span><span id="line-1103"></span><span>                                             </span><span class="annot"><span class="annottext">forall a. Outputable a =&gt; a -&gt; SDoc
</span><a href="GHC.Utils.Outputable.html#ppr"><span class="hs-identifier hs-var">ppr</span></a></span><span> </span><span class="annot"><span class="annottext">TyCon
</span><a href="#local-6989586621681386985"><span class="hs-identifier hs-var">fam_tc</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">forall a. Outputable a =&gt; a -&gt; SDoc
</span><a href="GHC.Utils.Outputable.html#ppr"><span class="hs-identifier hs-var">ppr</span></a></span><span> </span><span class="annot"><span class="annottext">[TcType]
</span><a href="#local-6989586621681386984"><span class="hs-identifier hs-var">fam_args</span></a></span><span class="hs-special">,</span><span>
</span><span id="line-1104"></span><span>                                             </span><span class="annot"><span class="annottext">forall a. Outputable a =&gt; a -&gt; SDoc
</span><a href="GHC.Utils.Outputable.html#ppr"><span class="hs-identifier hs-var">ppr</span></a></span><span> </span><span class="annot"><span class="annottext">Scaled ExpSigmaType
</span><a href="#local-6989586621681386986"><span class="hs-identifier hs-var">exp_pat_ty</span></a></span><span class="hs-special">,</span><span>
</span><span id="line-1105"></span><span>                                             </span><span class="annot"><span class="annottext">forall a. Outputable a =&gt; a -&gt; SDoc
</span><a href="GHC.Utils.Outputable.html#ppr"><span class="hs-identifier hs-var">ppr</span></a></span><span> </span><span class="annot"><span class="annottext">TcType
</span><a href="#local-6989586621681386981"><span class="hs-identifier hs-var">pat_ty</span></a></span><span class="hs-special">,</span><span>
</span><span id="line-1106"></span><span>                                             </span><span class="annot"><span class="annottext">forall a. Outputable a =&gt; a -&gt; SDoc
</span><a href="GHC.Utils.Outputable.html#ppr"><span class="hs-identifier hs-var">ppr</span></a></span><span> </span><span class="annot"><span class="annottext">TcType
</span><a href="#local-6989586621681386979"><span class="hs-identifier hs-var">pat_rho</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">forall a. Outputable a =&gt; a -&gt; SDoc
</span><a href="GHC.Utils.Outputable.html#ppr"><span class="hs-identifier hs-var">ppr</span></a></span><span> </span><span class="annot"><span class="annottext">HsWrapper
</span><a href="#local-6989586621681386980"><span class="hs-identifier hs-var">wrap</span></a></span><span class="hs-special">]</span><span class="hs-special">)</span><span>
</span><span id="line-1107"></span><span>       </span><span class="hs-special">;</span><span> </span><span id="local-6989586621681386975"><span class="annot"><span class="annottext">TcCoercionN
</span><a href="#local-6989586621681386975"><span class="hs-identifier hs-var">co1</span></a></span></span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">Maybe SDoc -&gt; TcType -&gt; TcType -&gt; TcM TcCoercionN
</span><a href="GHC.Tc.Utils.Unify.html#unifyType"><span class="hs-identifier hs-var">unifyType</span></a></span><span> </span><span class="annot"><span class="annottext">forall a. Maybe a
</span><a href="../../base-4.16.4.0/src/GHC-Maybe.html#Nothing"><span class="hs-identifier hs-var">Nothing</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">TyCon -&gt; [TcType] -&gt; TcType
</span><a href="GHC.Core.Type.html#mkTyConApp"><span class="hs-identifier hs-var">mkTyConApp</span></a></span><span> </span><span class="annot"><span class="annottext">TyCon
</span><a href="#local-6989586621681386985"><span class="hs-identifier hs-var">fam_tc</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">HasCallStack =&gt; TCvSubst -&gt; [TcType] -&gt; [TcType]
</span><a href="GHC.Core.TyCo.Subst.html#substTys"><span class="hs-identifier hs-var">substTys</span></a></span><span> </span><span class="annot"><span class="annottext">TCvSubst
</span><a href="#local-6989586621681386978"><span class="hs-identifier hs-var">subst</span></a></span><span> </span><span class="annot"><span class="annottext">[TcType]
</span><a href="#local-6989586621681386984"><span class="hs-identifier hs-var">fam_args</span></a></span><span class="hs-special">)</span><span class="hs-special">)</span><span> </span><span class="annot"><span class="annottext">TcType
</span><a href="#local-6989586621681386979"><span class="hs-identifier hs-var">pat_rho</span></a></span><span>
</span><span id="line-1108"></span><span>             </span><span class="hs-comment">-- co1 : T (ty1,ty2) ~N pat_rho</span><span>
</span><span id="line-1109"></span><span>             </span><span class="hs-comment">-- could use tcSubType here... but it's the wrong way round</span><span>
</span><span id="line-1110"></span><span>             </span><span class="hs-comment">-- for actual vs. expected in error messages.</span><span>
</span><span id="line-1111"></span><span>
</span><span id="line-1112"></span><span>       </span><span class="hs-special">;</span><span> </span><span class="hs-keyword">let</span><span> </span><span id="local-6989586621681386972"><span class="annot"><span class="annottext">tys' :: [TcType]
</span><a href="#local-6989586621681386972"><span class="hs-identifier hs-var hs-var">tys'</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">[TyVar] -&gt; [TcType]
</span><a href="GHC.Core.TyCo.Rep.html#mkTyVarTys"><span class="hs-identifier hs-var">mkTyVarTys</span></a></span><span> </span><span class="annot"><span class="annottext">[TyVar]
</span><a href="#local-6989586621681386977"><span class="hs-identifier hs-var">tvs'</span></a></span><span>
</span><span id="line-1113"></span><span>             </span><span id="local-6989586621681386971"><span class="annot"><span class="annottext">co2 :: TcCoercionN
</span><a href="#local-6989586621681386971"><span class="hs-identifier hs-var hs-var">co2</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">CoAxiom Unbranched -&gt; [TcType] -&gt; [TcCoercionN] -&gt; TcCoercionN
</span><a href="GHC.Tc.Types.Evidence.html#mkTcUnbranchedAxInstCo"><span class="hs-identifier hs-var">mkTcUnbranchedAxInstCo</span></a></span><span> </span><span class="annot"><span class="annottext">CoAxiom Unbranched
</span><a href="#local-6989586621681386983"><span class="hs-identifier hs-var">co_tc</span></a></span><span> </span><span class="annot"><span class="annottext">[TcType]
</span><a href="#local-6989586621681386972"><span class="hs-identifier hs-var">tys'</span></a></span><span> </span><span class="hs-special">[</span><span class="hs-special">]</span><span>
</span><span id="line-1114"></span><span>             </span><span class="hs-comment">-- co2 : T (ty1,ty2) ~R T7 ty1 ty2</span><span>
</span><span id="line-1115"></span><span>
</span><span id="line-1116"></span><span>             </span><span id="local-6989586621681386969"><span class="annot"><span class="annottext">full_co :: TcCoercionN
</span><a href="#local-6989586621681386969"><span class="hs-identifier hs-var hs-var">full_co</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">HasDebugCallStack =&gt; TcCoercionN -&gt; TcCoercionN
</span><a href="GHC.Tc.Types.Evidence.html#mkTcSubCo"><span class="hs-identifier hs-var">mkTcSubCo</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">TcCoercionN -&gt; TcCoercionN
</span><a href="GHC.Tc.Types.Evidence.html#mkTcSymCo"><span class="hs-identifier hs-var">mkTcSymCo</span></a></span><span> </span><span class="annot"><span class="annottext">TcCoercionN
</span><a href="#local-6989586621681386975"><span class="hs-identifier hs-var">co1</span></a></span><span class="hs-special">)</span><span> </span><span class="annot"><span class="annottext">TcCoercionN -&gt; TcCoercionN -&gt; TcCoercionN
</span><a href="GHC.Tc.Types.Evidence.html#mkTcTransCo"><span class="hs-operator hs-var">`mkTcTransCo`</span></a></span><span> </span><span class="annot"><span class="annottext">TcCoercionN
</span><a href="#local-6989586621681386971"><span class="hs-identifier hs-var">co2</span></a></span><span>
</span><span id="line-1117"></span><span>             </span><span class="hs-comment">-- full_co :: pat_rho ~R T7 ty1 ty2</span><span>
</span><span id="line-1118"></span><span>
</span><span id="line-1119"></span><span>       </span><span class="hs-special">;</span><span> </span><span class="annot"><span class="annottext">forall (m :: * -&gt; *) a. Monad m =&gt; a -&gt; m a
</span><a href="../../base-4.16.4.0/src/GHC-Base.html#return"><span class="hs-identifier hs-var">return</span></a></span><span> </span><span class="hs-special">(</span><span> </span><span class="annot"><span class="annottext">TcCoercionN -&gt; HsWrapper
</span><a href="GHC.Tc.Types.Evidence.html#mkWpCastR"><span class="hs-identifier hs-var">mkWpCastR</span></a></span><span> </span><span class="annot"><span class="annottext">TcCoercionN
</span><a href="#local-6989586621681386969"><span class="hs-identifier hs-var">full_co</span></a></span><span> </span><span class="annot"><span class="annottext">HsWrapper -&gt; HsWrapper -&gt; HsWrapper
</span><a href="GHC.Tc.Types.Evidence.html#%3C.%3E"><span class="hs-operator hs-var">&lt;.&gt;</span></a></span><span> </span><span class="annot"><span class="annottext">HsWrapper
</span><a href="#local-6989586621681386980"><span class="hs-identifier hs-var">wrap</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">[TcType]
</span><a href="#local-6989586621681386972"><span class="hs-identifier hs-var">tys'</span></a></span><span class="hs-special">)</span><span> </span><span class="hs-special">}</span><span>
</span><span id="line-1120"></span><span>
</span><span id="line-1121"></span><span>  </span><span class="hs-glyph">|</span><span> </span><span class="annot"><span class="annottext">Bool
</span><a href="../../base-4.16.4.0/src/GHC-Base.html#otherwise"><span class="hs-identifier hs-var">otherwise</span></a></span><span>
</span><span id="line-1122"></span><span>  </span><span class="hs-glyph">=</span><span> </span><span class="hs-keyword">do</span><span> </span><span class="hs-special">{</span><span> </span><span id="local-6989586621681386965"><span class="annot"><span class="annottext">TcType
</span><a href="#local-6989586621681386965"><span class="hs-identifier hs-var">pat_ty</span></a></span></span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">ExpSigmaType -&gt; TcM TcType
</span><a href="GHC.Tc.Utils.TcMType.html#expTypeToType"><span class="hs-identifier hs-var">expTypeToType</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">forall a. Scaled a -&gt; a
</span><a href="GHC.Core.TyCo.Rep.html#scaledThing"><span class="hs-identifier hs-var">scaledThing</span></a></span><span> </span><span class="annot"><span class="annottext">Scaled ExpSigmaType
</span><a href="#local-6989586621681386986"><span class="hs-identifier hs-var">exp_pat_ty</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-1123"></span><span>       </span><span class="hs-special">;</span><span> </span><span class="hs-special">(</span><span id="local-6989586621681386964"><span class="annot"><span class="annottext">HsWrapper
</span><a href="#local-6989586621681386964"><span class="hs-identifier hs-var">wrap</span></a></span></span><span class="hs-special">,</span><span> </span><span id="local-6989586621681386963"><span class="annot"><span class="annottext">TcType
</span><a href="#local-6989586621681386963"><span class="hs-identifier hs-var">pat_rho</span></a></span></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">CtOrigin -&gt; TcType -&gt; TcM (HsWrapper, TcType)
</span><a href="GHC.Tc.Utils.Instantiate.html#topInstantiate"><span class="hs-identifier hs-var">topInstantiate</span></a></span><span> </span><span class="annot"><span class="annottext">CtOrigin
</span><a href="#local-6989586621681386988"><span class="hs-identifier hs-var">orig</span></a></span><span> </span><span class="annot"><span class="annottext">TcType
</span><a href="#local-6989586621681386965"><span class="hs-identifier hs-var">pat_ty</span></a></span><span>
</span><span id="line-1124"></span><span>       </span><span class="hs-special">;</span><span> </span><span class="hs-special">(</span><span id="local-6989586621681386962"><span class="annot"><span class="annottext">TcCoercionN
</span><a href="#local-6989586621681386962"><span class="hs-identifier hs-var">coi</span></a></span></span><span class="hs-special">,</span><span> </span><span id="local-6989586621681386961"><span class="annot"><span class="annottext">[TcType]
</span><a href="#local-6989586621681386961"><span class="hs-identifier hs-var">tys</span></a></span></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">TyCon -&gt; TcType -&gt; TcM (TcCoercionN, [TcType])
</span><a href="GHC.Tc.Utils.Unify.html#matchExpectedTyConApp"><span class="hs-identifier hs-var">matchExpectedTyConApp</span></a></span><span> </span><span class="annot"><span class="annottext">TyCon
</span><a href="#local-6989586621681386987"><span class="hs-identifier hs-var">data_tc</span></a></span><span> </span><span class="annot"><span class="annottext">TcType
</span><a href="#local-6989586621681386963"><span class="hs-identifier hs-var">pat_rho</span></a></span><span>
</span><span id="line-1125"></span><span>       </span><span class="hs-special">;</span><span> </span><span class="annot"><span class="annottext">forall (m :: * -&gt; *) a. Monad m =&gt; a -&gt; m a
</span><a href="../../base-4.16.4.0/src/GHC-Base.html#return"><span class="hs-identifier hs-var">return</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">TcCoercionN -&gt; HsWrapper
</span><a href="GHC.Tc.Types.Evidence.html#mkWpCastN"><span class="hs-identifier hs-var">mkWpCastN</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">TcCoercionN -&gt; TcCoercionN
</span><a href="GHC.Tc.Types.Evidence.html#mkTcSymCo"><span class="hs-identifier hs-var">mkTcSymCo</span></a></span><span> </span><span class="annot"><span class="annottext">TcCoercionN
</span><a href="#local-6989586621681386962"><span class="hs-identifier hs-var">coi</span></a></span><span class="hs-special">)</span><span> </span><span class="annot"><span class="annottext">HsWrapper -&gt; HsWrapper -&gt; HsWrapper
</span><a href="GHC.Tc.Types.Evidence.html#%3C.%3E"><span class="hs-operator hs-var">&lt;.&gt;</span></a></span><span> </span><span class="annot"><span class="annottext">HsWrapper
</span><a href="#local-6989586621681386964"><span class="hs-identifier hs-var">wrap</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">[TcType]
</span><a href="#local-6989586621681386961"><span class="hs-identifier hs-var">tys</span></a></span><span class="hs-special">)</span><span> </span><span class="hs-special">}</span><span>
</span><span id="line-1126"></span><span>
</span><span id="line-1127"></span><span class="hs-comment">{-
Note [Matching constructor patterns]
~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~
Suppose (coi, tys) = matchExpectedConType data_tc pat_ty

 * In the simple case, pat_ty = tc tys

 * If pat_ty is a polytype, we want to instantiate it
   This is like part of a subsumption check.  Eg
      f :: (forall a. [a]) -&gt; blah
      f [] = blah

 * In a type family case, suppose we have
          data family T a
          data instance T (p,q) = A p | B q
       Then we'll have internally generated
              data T7 p q = A p | B q
              axiom coT7 p q :: T (p,q) ~ T7 p q

       So if pat_ty = T (ty1,ty2), we return (coi, [ty1,ty2]) such that
           coi = coi2 . coi1 : T7 t ~ pat_ty
           coi1 : T (ty1,ty2) ~ pat_ty
           coi2 : T7 ty1 ty2 ~ T (ty1,ty2)

   For families we do all this matching here, not in the unifier,
   because we never want a whisper of the data_tycon to appear in
   error messages; it's a purely internal thing
-}</span><span>
</span><span id="line-1155"></span><span>
</span><span id="line-1156"></span><span class="hs-comment">{-
Note [Typechecking type applications in patterns]
~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~
How should we typecheck type applications in patterns, such as
   f :: Either (Maybe a) [b] -&gt; blah
   f (Left @x @[y] (v::Maybe x)) = blah

It's quite straightforward, and very similar to the treatment of
pattern signatures.

* Step 1: bind the newly-in-scope type variables x and y to fresh
  unification variables, say x0 and y0.

* Step 2: typecheck those type arguments, @x and @[y], to get the
  types x0 and [y0].

* Step 3: Unify those types with the type arguments we expect,
  in this case (Maybe a) and [b].  These unifications will
  (perhaps after the constraint solver has done its work)
  unify   x0 := Maybe a
          y0 := b
  Thus we learn that x stands for (Maybe a) and y for b.

Wrinkles:

* Surprisingly, we can discard the coercions arising from
  these unifications.  The *only* thing the unification does is
  to side-effect those unification variables, so that we know
  what type x and y stand for; and cause an error if the equality
  is not soluble.  It's a bit like a Derived constraint arising
  from a functional dependency.

* Exactly the same works for existential arguments
     data T where
        MkT :: a -&gt; a -&gt; T
     f :: T -&gt; blah
     f (MkT @x v w) = ...
   Here we create a fresh unification variable x0 for x, and
   unify it with the fresh existential variable bound by the pattern.

* Note that both here and in pattern signatures the unification may
  not even end up unifying the variable.  For example
     type S a b = a
     f :: Maybe a -&gt; Bool
     f (Just @(S a b) x) = True :: b
   In Step 3 we will unify (S a0 b0 ~ a), which succeeds, but has no
   effect on the unification variable b0, to which 'b' is bound.
   Later, in the RHS, we find that b0 must be Bool, and unify it there.
   All is fine.
-}</span><span>
</span><span id="line-1206"></span><span>
</span><span id="line-1207"></span><span class="annot"><a href="GHC.Tc.Gen.Pat.html#tcConArgs"><span class="hs-identifier hs-type">tcConArgs</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><a href="GHC.Core.ConLike.html#ConLike"><span class="hs-identifier hs-type">ConLike</span></a></span><span>
</span><span id="line-1208"></span><span>          </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-special">[</span><span class="annot"><a href="GHC.Core.TyCo.Rep.html#Scaled"><span class="hs-identifier hs-type">Scaled</span></a></span><span> </span><span class="annot"><a href="GHC.Tc.Utils.TcType.html#TcSigmaType"><span class="hs-identifier hs-type">TcSigmaType</span></a></span><span class="hs-special">]</span><span>
</span><span id="line-1209"></span><span>          </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="GHC.Core.TyCo.Subst.html#TCvSubst"><span class="hs-identifier hs-type">TCvSubst</span></a></span><span>            </span><span class="hs-comment">-- Instantiating substitution for constructor type</span><span>
</span><span id="line-1210"></span><span>          </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="GHC.Tc.Gen.Pat.html#Checker"><span class="hs-identifier hs-type">Checker</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="Language.Haskell.Syntax.Pat.html#HsConPatDetails"><span class="hs-identifier hs-type">HsConPatDetails</span></a></span><span> </span><span class="annot"><a href="GHC.Hs.Extension.html#GhcRn"><span class="hs-identifier hs-type">GhcRn</span></a></span><span class="hs-special">)</span><span> </span><span class="hs-special">(</span><span class="annot"><a href="Language.Haskell.Syntax.Pat.html#HsConPatDetails"><span class="hs-identifier hs-type">HsConPatDetails</span></a></span><span> </span><span class="annot"><a href="GHC.Hs.Extension.html#GhcTc"><span class="hs-identifier hs-type">GhcTc</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-1211"></span><span id="tcConArgs"><span class="annot"><span class="annottext">tcConArgs :: ConLike
-&gt; [Scaled TcType]
-&gt; TCvSubst
-&gt; Checker (HsConPatDetails GhcRn) (HsConPatDetails GhcTc)
</span><a href="GHC.Tc.Gen.Pat.html#tcConArgs"><span class="hs-identifier hs-var hs-var">tcConArgs</span></a></span></span><span> </span><span id="local-6989586621681386928"><span class="annot"><span class="annottext">ConLike
</span><a href="#local-6989586621681386928"><span class="hs-identifier hs-var">con_like</span></a></span></span><span> </span><span id="local-6989586621681386927"><span class="annot"><span class="annottext">[Scaled TcType]
</span><a href="#local-6989586621681386927"><span class="hs-identifier hs-var">arg_tys</span></a></span></span><span> </span><span id="local-6989586621681386926"><span class="annot"><span class="annottext">TCvSubst
</span><a href="#local-6989586621681386926"><span class="hs-identifier hs-var">tenv</span></a></span></span><span> </span><span id="local-6989586621681386925"><span class="annot"><span class="annottext">PatEnv
</span><a href="#local-6989586621681386925"><span class="hs-identifier hs-var">penv</span></a></span></span><span> </span><span id="local-6989586621681386924"><span class="annot"><span class="annottext">HsConPatDetails GhcRn
</span><a href="#local-6989586621681386924"><span class="hs-identifier hs-var">con_args</span></a></span></span><span> </span><span id="local-6989586621681386923"><span class="annot"><span class="annottext">TcM r
</span><a href="#local-6989586621681386923"><span class="hs-identifier hs-var">thing_inside</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-keyword">case</span><span> </span><span class="annot"><span class="annottext">HsConPatDetails GhcRn
</span><a href="#local-6989586621681386924"><span class="hs-identifier hs-var">con_args</span></a></span><span> </span><span class="hs-keyword">of</span><span>
</span><span id="line-1212"></span><span>  </span><span class="annot"><a href="Language.Haskell.Syntax.Type.html#PrefixCon"><span class="hs-identifier hs-type">PrefixCon</span></a></span><span> </span><span id="local-6989586621681386921"><span class="annot"><span class="annottext">[HsPatSigType (NoGhcTc GhcRn)]
</span><a href="#local-6989586621681386921"><span class="hs-identifier hs-var">type_args</span></a></span></span><span> </span><span id="local-6989586621681386920"><span class="annot"><span class="annottext">[LPat GhcRn]
</span><a href="#local-6989586621681386920"><span class="hs-identifier hs-var">arg_pats</span></a></span></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-keyword">do</span><span>
</span><span id="line-1213"></span><span>        </span><span class="hs-special">{</span><span> </span><span class="annot"><span class="annottext">Bool -&gt; SDoc -&gt; TcRn ()
</span><a href="GHC.Tc.Utils.Monad.html#checkTc"><span class="hs-identifier hs-var">checkTc</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Int
</span><a href="#local-6989586621681386919"><span class="hs-identifier hs-var">con_arity</span></a></span><span> </span><span class="annot"><span class="annottext">forall a. Eq a =&gt; a -&gt; a -&gt; Bool
</span><span class="hs-operator hs-var">==</span></span><span> </span><span class="annot"><span class="annottext">Int
</span><a href="#local-6989586621681386918"><span class="hs-identifier hs-var">no_of_args</span></a></span><span class="hs-special">)</span><span>     </span><span class="hs-comment">-- Check correct arity</span><span>
</span><span id="line-1214"></span><span>                  </span><span class="hs-special">(</span><span class="annot"><span class="annottext">forall a. Outputable a =&gt; SDoc -&gt; a -&gt; Int -&gt; Int -&gt; SDoc
</span><a href="GHC.Tc.Validity.html#arityErr"><span class="hs-identifier hs-var">arityErr</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">String -&gt; SDoc
</span><a href="GHC.Utils.Outputable.html#text"><span class="hs-identifier hs-var">text</span></a></span><span> </span><span class="annot"><span class="annottext">String
</span><span class="hs-string">&quot;constructor&quot;</span></span><span class="hs-special">)</span><span> </span><span class="annot"><span class="annottext">ConLike
</span><a href="#local-6989586621681386928"><span class="hs-identifier hs-var">con_like</span></a></span><span> </span><span class="annot"><span class="annottext">Int
</span><a href="#local-6989586621681386919"><span class="hs-identifier hs-var">con_arity</span></a></span><span> </span><span class="annot"><span class="annottext">Int
</span><a href="#local-6989586621681386918"><span class="hs-identifier hs-var">no_of_args</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-1215"></span><span>
</span><span id="line-1216"></span><span>        </span><span class="hs-special">;</span><span> </span><span class="hs-keyword">let</span><span> </span><span id="local-6989586621681386917"><span class="annot"><span class="annottext">con_binders :: [InvisTVBinder]
</span><a href="#local-6989586621681386917"><span class="hs-identifier hs-var hs-var">con_binders</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">ConLike -&gt; [InvisTVBinder]
</span><a href="GHC.Core.ConLike.html#conLikeUserTyVarBinders"><span class="hs-identifier hs-var">conLikeUserTyVarBinders</span></a></span><span> </span><span class="annot"><span class="annottext">ConLike
</span><a href="#local-6989586621681386928"><span class="hs-identifier hs-var">con_like</span></a></span><span>
</span><span id="line-1217"></span><span>        </span><span class="hs-special">;</span><span> </span><span class="annot"><span class="annottext">Bool -&gt; SDoc -&gt; TcRn ()
</span><a href="GHC.Tc.Utils.Monad.html#checkTc"><span class="hs-identifier hs-var">checkTc</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">[HsPatSigType (NoGhcTc GhcRn)]
</span><a href="#local-6989586621681386921"><span class="hs-identifier hs-var">type_args</span></a></span><span> </span><span class="annot"><span class="annottext">forall a b. [a] -&gt; [b] -&gt; Bool
</span><a href="GHC.Utils.Misc.html#leLength"><span class="hs-operator hs-var">`leLength`</span></a></span><span> </span><span class="annot"><span class="annottext">[InvisTVBinder]
</span><a href="#local-6989586621681386917"><span class="hs-identifier hs-var">con_binders</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-1218"></span><span>                  </span><span class="hs-special">(</span><span class="annot"><span class="annottext">ConLike -&gt; Int -&gt; Int -&gt; SDoc
</span><a href="GHC.Tc.Gen.Pat.html#conTyArgArityErr"><span class="hs-identifier hs-var">conTyArgArityErr</span></a></span><span> </span><span class="annot"><span class="annottext">ConLike
</span><a href="#local-6989586621681386928"><span class="hs-identifier hs-var">con_like</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">forall (t :: * -&gt; *) a. Foldable t =&gt; t a -&gt; Int
</span><a href="../../base-4.16.4.0/src/Data-Foldable.html#length"><span class="hs-identifier hs-var">length</span></a></span><span> </span><span class="annot"><span class="annottext">[InvisTVBinder]
</span><a href="#local-6989586621681386917"><span class="hs-identifier hs-var">con_binders</span></a></span><span class="hs-special">)</span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">forall (t :: * -&gt; *) a. Foldable t =&gt; t a -&gt; Int
</span><a href="../../base-4.16.4.0/src/Data-Foldable.html#length"><span class="hs-identifier hs-var">length</span></a></span><span> </span><span class="annot"><span class="annottext">[HsPatSigType (NoGhcTc GhcRn)]
</span><a href="#local-6989586621681386921"><span class="hs-identifier hs-var">type_args</span></a></span><span class="hs-special">)</span><span class="hs-special">)</span><span>
</span><span id="line-1219"></span><span>
</span><span id="line-1220"></span><span>        </span><span class="hs-special">;</span><span> </span><span class="hs-keyword">let</span><span> </span><span id="local-6989586621681386913"><span class="annot"><span class="annottext">pats_w_tys :: [(GenLocated (SrcSpanAnn' (EpAnn AnnListItem)) (Pat GhcRn),
  Scaled TcType)]
</span><a href="#local-6989586621681386913"><span class="hs-identifier hs-var hs-var">pats_w_tys</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">forall a b. String -&gt; [a] -&gt; [b] -&gt; [(a, b)]
</span><a href="GHC.Utils.Misc.html#zipEqual"><span class="hs-identifier hs-var">zipEqual</span></a></span><span> </span><span class="annot"><span class="annottext">String
</span><span class="hs-string">&quot;tcConArgs&quot;</span></span><span> </span><span class="annot"><span class="annottext">[LPat GhcRn]
</span><a href="#local-6989586621681386920"><span class="hs-identifier hs-var">arg_pats</span></a></span><span> </span><span class="annot"><span class="annottext">[Scaled TcType]
</span><a href="#local-6989586621681386927"><span class="hs-identifier hs-var">arg_tys</span></a></span><span>
</span><span id="line-1221"></span><span>        </span><span class="hs-special">;</span><span> </span><span class="hs-special">(</span><span id="local-6989586621681386912"><span class="annot"><span class="annottext">[TcType]
</span><a href="#local-6989586621681386912"><span class="hs-identifier hs-var">type_args'</span></a></span></span><span class="hs-special">,</span><span> </span><span class="hs-special">(</span><span id="local-6989586621681386911"><span class="annot"><span class="annottext">[GenLocated (SrcSpanAnn' (EpAnn AnnListItem)) (Pat GhcTc)]
</span><a href="#local-6989586621681386911"><span class="hs-identifier hs-var">arg_pats'</span></a></span></span><span class="hs-special">,</span><span> </span><span id="local-6989586621681386910"><span class="annot"><span class="annottext">r
</span><a href="#local-6989586621681386910"><span class="hs-identifier hs-var">res</span></a></span></span><span class="hs-special">)</span><span class="hs-special">)</span><span>
</span><span id="line-1222"></span><span>            </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">forall inp out. Checker inp out -&gt; Checker [inp] [out]
</span><a href="GHC.Tc.Gen.Pat.html#tcMultiple"><span class="hs-identifier hs-var">tcMultiple</span></a></span><span> </span><span class="annot"><span class="annottext">Checker (HsPatSigType GhcRn) TcType
</span><a href="GHC.Tc.Gen.Pat.html#tcConTyArg"><span class="hs-identifier hs-var">tcConTyArg</span></a></span><span> </span><span class="annot"><span class="annottext">PatEnv
</span><a href="#local-6989586621681386925"><span class="hs-identifier hs-var">penv</span></a></span><span> </span><span class="annot"><span class="annottext">[HsPatSigType (NoGhcTc GhcRn)]
</span><a href="#local-6989586621681386921"><span class="hs-identifier hs-var">type_args</span></a></span><span> </span><span class="annot"><span class="annottext">forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><a href="../../base-4.16.4.0/src/GHC-Base.html#%24"><span class="hs-operator hs-var">$</span></a></span><span>
</span><span id="line-1223"></span><span>               </span><span class="annot"><span class="annottext">forall inp out. Checker inp out -&gt; Checker [inp] [out]
</span><a href="GHC.Tc.Gen.Pat.html#tcMultiple"><span class="hs-identifier hs-var">tcMultiple</span></a></span><span> </span><span class="annot"><span class="annottext">Checker (LPat GhcRn, Scaled TcType) (LPat GhcTc)
</span><a href="GHC.Tc.Gen.Pat.html#tcConArg"><span class="hs-identifier hs-var">tcConArg</span></a></span><span> </span><span class="annot"><span class="annottext">PatEnv
</span><a href="#local-6989586621681386925"><span class="hs-identifier hs-var">penv</span></a></span><span> </span><span class="annot"><span class="annottext">[(GenLocated (SrcSpanAnn' (EpAnn AnnListItem)) (Pat GhcRn),
  Scaled TcType)]
</span><a href="#local-6989586621681386913"><span class="hs-identifier hs-var">pats_w_tys</span></a></span><span> </span><span class="annot"><span class="annottext">TcM r
</span><a href="#local-6989586621681386923"><span class="hs-identifier hs-var">thing_inside</span></a></span><span>
</span><span id="line-1224"></span><span>
</span><span id="line-1225"></span><span>          </span><span class="hs-comment">-- This unification is straight from Figure 7 of</span><span>
</span><span id="line-1226"></span><span>          </span><span class="hs-comment">-- &quot;Type Variables in Patterns&quot;, Haskell'18</span><span>
</span><span id="line-1227"></span><span>        </span><span class="hs-special">;</span><span> </span><span class="annot"><span class="annottext">[TcCoercionN]
</span><span class="hs-identifier">_</span></span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">forall (m :: * -&gt; *) a b c.
Applicative m =&gt;
(a -&gt; b -&gt; m c) -&gt; [a] -&gt; [b] -&gt; m [c]
</span><a href="../../base-4.16.4.0/src/Control-Monad.html#zipWithM"><span class="hs-identifier hs-var">zipWithM</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Maybe SDoc -&gt; TcType -&gt; TcType -&gt; TcM TcCoercionN
</span><a href="GHC.Tc.Utils.Unify.html#unifyType"><span class="hs-identifier hs-var">unifyType</span></a></span><span> </span><span class="annot"><span class="annottext">forall a. Maybe a
</span><a href="../../base-4.16.4.0/src/GHC-Maybe.html#Nothing"><span class="hs-identifier hs-var">Nothing</span></a></span><span class="hs-special">)</span><span> </span><span class="annot"><span class="annottext">[TcType]
</span><a href="#local-6989586621681386912"><span class="hs-identifier hs-var">type_args'</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">TCvSubst -&gt; [TyVar] -&gt; [TcType]
</span><a href="GHC.Core.TyCo.Subst.html#substTyVars"><span class="hs-identifier hs-var">substTyVars</span></a></span><span> </span><span class="annot"><span class="annottext">TCvSubst
</span><a href="#local-6989586621681386926"><span class="hs-identifier hs-var">tenv</span></a></span><span> </span><span class="annot"><span class="annottext">forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><a href="../../base-4.16.4.0/src/GHC-Base.html#%24"><span class="hs-operator hs-var">$</span></a></span><span>
</span><span id="line-1228"></span><span>                                                        </span><span class="annot"><span class="annottext">forall tv argf. [VarBndr tv argf] -&gt; [tv]
</span><a href="GHC.Types.Var.html#binderVars"><span class="hs-identifier hs-var">binderVars</span></a></span><span> </span><span class="annot"><span class="annottext">[InvisTVBinder]
</span><a href="#local-6989586621681386917"><span class="hs-identifier hs-var">con_binders</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-1229"></span><span>          </span><span class="hs-comment">-- OK to drop coercions here. These unifications are all about</span><span>
</span><span id="line-1230"></span><span>          </span><span class="hs-comment">-- guiding inference based on a user-written type annotation</span><span>
</span><span id="line-1231"></span><span>          </span><span class="hs-comment">-- See Note [Typechecking type applications in patterns]</span><span>
</span><span id="line-1232"></span><span>
</span><span id="line-1233"></span><span>        </span><span class="hs-special">;</span><span> </span><span class="annot"><span class="annottext">forall (m :: * -&gt; *) a. Monad m =&gt; a -&gt; m a
</span><a href="../../base-4.16.4.0/src/GHC-Base.html#return"><span class="hs-identifier hs-var">return</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">forall tyarg arg rec.
[tyarg] -&gt; [arg] -&gt; HsConDetails tyarg arg rec
</span><a href="Language.Haskell.Syntax.Type.html#PrefixCon"><span class="hs-identifier hs-var">PrefixCon</span></a></span><span> </span><span class="annot"><span class="annottext">[HsPatSigType (NoGhcTc GhcRn)]
</span><a href="#local-6989586621681386921"><span class="hs-identifier hs-var">type_args</span></a></span><span> </span><span class="annot"><span class="annottext">[GenLocated (SrcSpanAnn' (EpAnn AnnListItem)) (Pat GhcTc)]
</span><a href="#local-6989586621681386911"><span class="hs-identifier hs-var">arg_pats'</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">r
</span><a href="#local-6989586621681386910"><span class="hs-identifier hs-var">res</span></a></span><span class="hs-special">)</span><span> </span><span class="hs-special">}</span><span>
</span><span id="line-1234"></span><span>    </span><span class="hs-keyword">where</span><span>
</span><span id="line-1235"></span><span>      </span><span id="local-6989586621681386919"><span class="annot"><span class="annottext">con_arity :: Int
</span><a href="#local-6989586621681386919"><span class="hs-identifier hs-var hs-var">con_arity</span></a></span></span><span>  </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">ConLike -&gt; Int
</span><a href="GHC.Core.ConLike.html#conLikeArity"><span class="hs-identifier hs-var">conLikeArity</span></a></span><span> </span><span class="annot"><span class="annottext">ConLike
</span><a href="#local-6989586621681386928"><span class="hs-identifier hs-var">con_like</span></a></span><span>
</span><span id="line-1236"></span><span>      </span><span id="local-6989586621681386918"><span class="annot"><span class="annottext">no_of_args :: Int
</span><a href="#local-6989586621681386918"><span class="hs-identifier hs-var hs-var">no_of_args</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">forall (t :: * -&gt; *) a. Foldable t =&gt; t a -&gt; Int
</span><a href="../../base-4.16.4.0/src/Data-Foldable.html#length"><span class="hs-identifier hs-var">length</span></a></span><span> </span><span class="annot"><span class="annottext">[LPat GhcRn]
</span><a href="#local-6989586621681386920"><span class="hs-identifier hs-var">arg_pats</span></a></span><span>
</span><span id="line-1237"></span><span>
</span><span id="line-1238"></span><span>  </span><span class="annot"><a href="Language.Haskell.Syntax.Type.html#InfixCon"><span class="hs-identifier hs-type">InfixCon</span></a></span><span> </span><span id="local-6989586621681386902"><span class="annot"><span class="annottext">LPat GhcRn
</span><a href="#local-6989586621681386902"><span class="hs-identifier hs-var">p1</span></a></span></span><span> </span><span id="local-6989586621681386901"><span class="annot"><span class="annottext">LPat GhcRn
</span><a href="#local-6989586621681386901"><span class="hs-identifier hs-var">p2</span></a></span></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-keyword">do</span><span>
</span><span id="line-1239"></span><span>        </span><span class="hs-special">{</span><span> </span><span class="annot"><span class="annottext">Bool -&gt; SDoc -&gt; TcRn ()
</span><a href="GHC.Tc.Utils.Monad.html#checkTc"><span class="hs-identifier hs-var">checkTc</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Int
</span><a href="#local-6989586621681386900"><span class="hs-identifier hs-var">con_arity</span></a></span><span> </span><span class="annot"><span class="annottext">forall a. Eq a =&gt; a -&gt; a -&gt; Bool
</span><span class="hs-operator hs-var">==</span></span><span> </span><span class="annot"><span class="annottext">Int
</span><span class="hs-number">2</span></span><span class="hs-special">)</span><span>      </span><span class="hs-comment">-- Check correct arity</span><span>
</span><span id="line-1240"></span><span>                  </span><span class="hs-special">(</span><span class="annot"><span class="annottext">forall a. Outputable a =&gt; SDoc -&gt; a -&gt; Int -&gt; Int -&gt; SDoc
</span><a href="GHC.Tc.Validity.html#arityErr"><span class="hs-identifier hs-var">arityErr</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">String -&gt; SDoc
</span><a href="GHC.Utils.Outputable.html#text"><span class="hs-identifier hs-var">text</span></a></span><span> </span><span class="annot"><span class="annottext">String
</span><span class="hs-string">&quot;constructor&quot;</span></span><span class="hs-special">)</span><span> </span><span class="annot"><span class="annottext">ConLike
</span><a href="#local-6989586621681386928"><span class="hs-identifier hs-var">con_like</span></a></span><span> </span><span class="annot"><span class="annottext">Int
</span><a href="#local-6989586621681386900"><span class="hs-identifier hs-var">con_arity</span></a></span><span> </span><span class="annot"><span class="annottext">Int
</span><span class="hs-number">2</span></span><span class="hs-special">)</span><span>
</span><span id="line-1241"></span><span>        </span><span class="hs-special">;</span><span> </span><span class="hs-keyword">let</span><span> </span><span class="hs-special">[</span><span id="local-6989586621681386899"><span class="annot"><span class="annottext">Scaled TcType
</span><a href="#local-6989586621681386899"><span class="hs-identifier hs-var">arg_ty1</span></a></span></span><span class="hs-special">,</span><span id="local-6989586621681386898"><span class="annot"><span class="annottext">Scaled TcType
</span><a href="#local-6989586621681386898"><span class="hs-identifier hs-var">arg_ty2</span></a></span></span><span class="hs-special">]</span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">[Scaled TcType]
</span><a href="#local-6989586621681386927"><span class="hs-identifier hs-var">arg_tys</span></a></span><span>       </span><span class="hs-comment">-- This can't fail after the arity check</span><span>
</span><span id="line-1242"></span><span>        </span><span class="hs-special">;</span><span> </span><span class="hs-special">(</span><span class="hs-special">[</span><span id="local-6989586621681386897"><span class="annot"><span class="annottext">GenLocated (SrcSpanAnn' (EpAnn AnnListItem)) (Pat GhcTc)
</span><a href="#local-6989586621681386897"><span class="hs-identifier hs-var">p1'</span></a></span></span><span class="hs-special">,</span><span id="local-6989586621681386896"><span class="annot"><span class="annottext">GenLocated (SrcSpanAnn' (EpAnn AnnListItem)) (Pat GhcTc)
</span><a href="#local-6989586621681386896"><span class="hs-identifier hs-var">p2'</span></a></span></span><span class="hs-special">]</span><span class="hs-special">,</span><span> </span><span id="local-6989586621681386895"><span class="annot"><span class="annottext">r
</span><a href="#local-6989586621681386895"><span class="hs-identifier hs-var">res</span></a></span></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">forall inp out. Checker inp out -&gt; Checker [inp] [out]
</span><a href="GHC.Tc.Gen.Pat.html#tcMultiple"><span class="hs-identifier hs-var">tcMultiple</span></a></span><span> </span><span class="annot"><span class="annottext">Checker (LPat GhcRn, Scaled TcType) (LPat GhcTc)
</span><a href="GHC.Tc.Gen.Pat.html#tcConArg"><span class="hs-identifier hs-var">tcConArg</span></a></span><span> </span><span class="annot"><span class="annottext">PatEnv
</span><a href="#local-6989586621681386925"><span class="hs-identifier hs-var">penv</span></a></span><span> </span><span class="hs-special">[</span><span class="hs-special">(</span><span class="annot"><span class="annottext">LPat GhcRn
</span><a href="#local-6989586621681386902"><span class="hs-identifier hs-var">p1</span></a></span><span class="hs-special">,</span><span class="annot"><span class="annottext">Scaled TcType
</span><a href="#local-6989586621681386899"><span class="hs-identifier hs-var">arg_ty1</span></a></span><span class="hs-special">)</span><span class="hs-special">,</span><span class="hs-special">(</span><span class="annot"><span class="annottext">LPat GhcRn
</span><a href="#local-6989586621681386901"><span class="hs-identifier hs-var">p2</span></a></span><span class="hs-special">,</span><span class="annot"><span class="annottext">Scaled TcType
</span><a href="#local-6989586621681386898"><span class="hs-identifier hs-var">arg_ty2</span></a></span><span class="hs-special">)</span><span class="hs-special">]</span><span>
</span><span id="line-1243"></span><span>                                                  </span><span class="annot"><span class="annottext">TcM r
</span><a href="#local-6989586621681386923"><span class="hs-identifier hs-var">thing_inside</span></a></span><span>
</span><span id="line-1244"></span><span>        </span><span class="hs-special">;</span><span> </span><span class="annot"><span class="annottext">forall (m :: * -&gt; *) a. Monad m =&gt; a -&gt; m a
</span><a href="../../base-4.16.4.0/src/GHC-Base.html#return"><span class="hs-identifier hs-var">return</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">forall tyarg arg rec. arg -&gt; arg -&gt; HsConDetails tyarg arg rec
</span><a href="Language.Haskell.Syntax.Type.html#InfixCon"><span class="hs-identifier hs-var">InfixCon</span></a></span><span> </span><span class="annot"><span class="annottext">GenLocated (SrcSpanAnn' (EpAnn AnnListItem)) (Pat GhcTc)
</span><a href="#local-6989586621681386897"><span class="hs-identifier hs-var">p1'</span></a></span><span> </span><span class="annot"><span class="annottext">GenLocated (SrcSpanAnn' (EpAnn AnnListItem)) (Pat GhcTc)
</span><a href="#local-6989586621681386896"><span class="hs-identifier hs-var">p2'</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">r
</span><a href="#local-6989586621681386895"><span class="hs-identifier hs-var">res</span></a></span><span class="hs-special">)</span><span> </span><span class="hs-special">}</span><span>
</span><span id="line-1245"></span><span>    </span><span class="hs-keyword">where</span><span>
</span><span id="line-1246"></span><span>      </span><span id="local-6989586621681386900"><span class="annot"><span class="annottext">con_arity :: Int
</span><a href="#local-6989586621681386900"><span class="hs-identifier hs-var hs-var">con_arity</span></a></span></span><span>  </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">ConLike -&gt; Int
</span><a href="GHC.Core.ConLike.html#conLikeArity"><span class="hs-identifier hs-var">conLikeArity</span></a></span><span> </span><span class="annot"><span class="annottext">ConLike
</span><a href="#local-6989586621681386928"><span class="hs-identifier hs-var">con_like</span></a></span><span>
</span><span id="line-1247"></span><span>
</span><span id="line-1248"></span><span>  </span><span class="annot"><a href="Language.Haskell.Syntax.Type.html#RecCon"><span class="hs-identifier hs-type">RecCon</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="Language.Haskell.Syntax.Pat.html#HsRecFields"><span class="hs-identifier hs-type">HsRecFields</span></a></span><span> </span><span id="local-6989586621681386892"><span class="annot"><span class="annottext">[LHsRecField GhcRn (LPat GhcRn)]
</span><a href="#local-6989586621681386892"><span class="hs-identifier hs-var">rpats</span></a></span></span><span> </span><span id="local-6989586621681386891"><span class="annot"><span class="annottext">Maybe (Located Int)
</span><a href="#local-6989586621681386891"><span class="hs-identifier hs-var">dd</span></a></span></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-keyword">do</span><span>
</span><span id="line-1249"></span><span>        </span><span class="hs-special">{</span><span> </span><span class="hs-special">(</span><span id="local-6989586621681386890"><span class="annot"><span class="annottext">[GenLocated
   (SrcSpanAnn' (EpAnn AnnListItem))
   (HsRecField'
      (FieldOcc GhcTc)
      (GenLocated (SrcSpanAnn' (EpAnn AnnListItem)) (Pat GhcTc)))]
</span><a href="#local-6989586621681386890"><span class="hs-identifier hs-var">rpats'</span></a></span></span><span class="hs-special">,</span><span> </span><span id="local-6989586621681386889"><span class="annot"><span class="annottext">r
</span><a href="#local-6989586621681386889"><span class="hs-identifier hs-var">res</span></a></span></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">forall inp out. Checker inp out -&gt; Checker [inp] [out]
</span><a href="GHC.Tc.Gen.Pat.html#tcMultiple"><span class="hs-identifier hs-var">tcMultiple</span></a></span><span> </span><span class="annot"><span class="annottext">Checker
  (LHsRecField GhcRn (LPat GhcRn)) (LHsRecField GhcTc (LPat GhcTc))
</span><a href="#local-6989586621681386888"><span class="hs-identifier hs-var">tc_field</span></a></span><span> </span><span class="annot"><span class="annottext">PatEnv
</span><a href="#local-6989586621681386925"><span class="hs-identifier hs-var">penv</span></a></span><span> </span><span class="annot"><span class="annottext">[LHsRecField GhcRn (LPat GhcRn)]
</span><a href="#local-6989586621681386892"><span class="hs-identifier hs-var">rpats</span></a></span><span> </span><span class="annot"><span class="annottext">TcM r
</span><a href="#local-6989586621681386923"><span class="hs-identifier hs-var">thing_inside</span></a></span><span>
</span><span id="line-1250"></span><span>        </span><span class="hs-special">;</span><span> </span><span class="annot"><span class="annottext">forall (m :: * -&gt; *) a. Monad m =&gt; a -&gt; m a
</span><a href="../../base-4.16.4.0/src/GHC-Base.html#return"><span class="hs-identifier hs-var">return</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">forall tyarg arg rec. rec -&gt; HsConDetails tyarg arg rec
</span><a href="Language.Haskell.Syntax.Type.html#RecCon"><span class="hs-identifier hs-var">RecCon</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">forall p arg.
[LHsRecField p arg] -&gt; Maybe (Located Int) -&gt; HsRecFields p arg
</span><a href="Language.Haskell.Syntax.Pat.html#HsRecFields"><span class="hs-identifier hs-var">HsRecFields</span></a></span><span> </span><span class="annot"><span class="annottext">[GenLocated
   (SrcSpanAnn' (EpAnn AnnListItem))
   (HsRecField'
      (FieldOcc GhcTc)
      (GenLocated (SrcSpanAnn' (EpAnn AnnListItem)) (Pat GhcTc)))]
</span><a href="#local-6989586621681386890"><span class="hs-identifier hs-var">rpats'</span></a></span><span> </span><span class="annot"><span class="annottext">Maybe (Located Int)
</span><a href="#local-6989586621681386891"><span class="hs-identifier hs-var">dd</span></a></span><span class="hs-special">)</span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">r
</span><a href="#local-6989586621681386889"><span class="hs-identifier hs-var">res</span></a></span><span class="hs-special">)</span><span> </span><span class="hs-special">}</span><span>
</span><span id="line-1251"></span><span>    </span><span class="hs-keyword">where</span><span>
</span><span id="line-1252"></span><span>      </span><span class="annot"><a href="#local-6989586621681386888"><span class="hs-identifier hs-type">tc_field</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><a href="GHC.Tc.Gen.Pat.html#Checker"><span class="hs-identifier hs-type">Checker</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="Language.Haskell.Syntax.Pat.html#LHsRecField"><span class="hs-identifier hs-type">LHsRecField</span></a></span><span> </span><span class="annot"><a href="GHC.Hs.Extension.html#GhcRn"><span class="hs-identifier hs-type">GhcRn</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="Language.Haskell.Syntax.Pat.html#LPat"><span class="hs-identifier hs-type">LPat</span></a></span><span> </span><span class="annot"><a href="GHC.Hs.Extension.html#GhcRn"><span class="hs-identifier hs-type">GhcRn</span></a></span><span class="hs-special">)</span><span class="hs-special">)</span><span>
</span><span id="line-1253"></span><span>                          </span><span class="hs-special">(</span><span class="annot"><a href="Language.Haskell.Syntax.Pat.html#LHsRecField"><span class="hs-identifier hs-type">LHsRecField</span></a></span><span> </span><span class="annot"><a href="GHC.Hs.Extension.html#GhcTc"><span class="hs-identifier hs-type">GhcTc</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="Language.Haskell.Syntax.Pat.html#LPat"><span class="hs-identifier hs-type">LPat</span></a></span><span> </span><span class="annot"><a href="GHC.Hs.Extension.html#GhcTc"><span class="hs-identifier hs-type">GhcTc</span></a></span><span class="hs-special">)</span><span class="hs-special">)</span><span>
</span><span id="line-1254"></span><span>      </span><span id="local-6989586621681386888"><span class="annot"><span class="annottext">tc_field :: Checker
  (LHsRecField GhcRn (LPat GhcRn)) (LHsRecField GhcTc (LPat GhcTc))
</span><a href="#local-6989586621681386888"><span class="hs-identifier hs-var hs-var">tc_field</span></a></span></span><span> </span><span id="local-6989586621681386883"><span class="annot"><span class="annottext">PatEnv
</span><a href="#local-6989586621681386883"><span class="hs-identifier hs-var">penv</span></a></span></span><span>
</span><span id="line-1255"></span><span>               </span><span class="hs-special">(</span><span class="annot"><a href="GHC.Types.SrcLoc.html#L"><span class="hs-identifier hs-type">L</span></a></span><span> </span><span id="local-6989586621681386882"><span class="annot"><span class="annottext">SrcSpanAnn' (EpAnn AnnListItem)
</span><a href="#local-6989586621681386882"><span class="hs-identifier hs-var">l</span></a></span></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="Language.Haskell.Syntax.Pat.html#HsRecField"><span class="hs-identifier hs-type">HsRecField</span></a></span><span> </span><span id="local-6989586621681386880"><span class="annot"><span class="annottext">XHsRecField (FieldOcc GhcRn)
</span><a href="#local-6989586621681386880"><span class="hs-identifier hs-var">ann</span></a></span></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="GHC.Types.SrcLoc.html#L"><span class="hs-identifier hs-type">L</span></a></span><span> </span><span id="local-6989586621681386879"><span class="annot"><span class="annottext">SrcSpan
</span><a href="#local-6989586621681386879"><span class="hs-identifier hs-var">loc</span></a></span></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="Language.Haskell.Syntax.Type.html#FieldOcc"><span class="hs-identifier hs-type">FieldOcc</span></a></span><span> </span><span id="local-6989586621681386877"><span class="annot"><span class="annottext">XCFieldOcc GhcRn
</span><a href="#local-6989586621681386877"><span class="hs-identifier hs-var">sel</span></a></span></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="GHC.Types.SrcLoc.html#L"><span class="hs-identifier hs-type">L</span></a></span><span> </span><span id="local-6989586621681386876"><span class="annot"><span class="annottext">SrcSpanAnnN
</span><a href="#local-6989586621681386876"><span class="hs-identifier hs-var">lr</span></a></span></span><span> </span><span id="local-6989586621681386875"><span class="annot"><span class="annottext">RdrName
</span><a href="#local-6989586621681386875"><span class="hs-identifier hs-var">rdr</span></a></span></span><span class="hs-special">)</span><span class="hs-special">)</span><span class="hs-special">)</span><span> </span><span id="local-6989586621681386874"><span class="annot"><span class="annottext">GenLocated (SrcSpanAnn' (EpAnn AnnListItem)) (Pat GhcRn)
</span><a href="#local-6989586621681386874"><span class="hs-identifier hs-var">pat</span></a></span></span><span> </span><span id="local-6989586621681386873"><span class="annot"><span class="annottext">Bool
</span><a href="#local-6989586621681386873"><span class="hs-identifier hs-var">pun</span></a></span></span><span class="hs-special">)</span><span class="hs-special">)</span><span>
</span><span id="line-1256"></span><span>               </span><span id="local-6989586621681386872"><span class="annot"><span class="annottext">TcM r
</span><a href="#local-6989586621681386872"><span class="hs-identifier hs-var">thing_inside</span></a></span></span><span>
</span><span id="line-1257"></span><span>        </span><span class="hs-glyph">=</span><span> </span><span class="hs-keyword">do</span><span> </span><span class="hs-special">{</span><span> </span><span id="local-6989586621681386871"><span class="annot"><span class="annottext">TyVar
</span><a href="#local-6989586621681386871"><span class="hs-identifier hs-var">sel'</span></a></span></span><span>   </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">Name -&gt; TcM TyVar
</span><a href="GHC.Tc.Utils.Env.html#tcLookupId"><span class="hs-identifier hs-var">tcLookupId</span></a></span><span> </span><span class="annot"><span class="annottext">XCFieldOcc GhcRn
</span><a href="#local-6989586621681386877"><span class="hs-identifier hs-var">sel</span></a></span><span>
</span><span id="line-1258"></span><span>             </span><span class="hs-special">;</span><span> </span><span id="local-6989586621681386869"><span class="annot"><span class="annottext">Scaled TcType
</span><a href="#local-6989586621681386869"><span class="hs-identifier hs-var">pat_ty</span></a></span></span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">forall a. SrcSpan -&gt; TcRn a -&gt; TcRn a
</span><a href="GHC.Tc.Utils.Monad.html#setSrcSpan"><span class="hs-identifier hs-var">setSrcSpan</span></a></span><span> </span><span class="annot"><span class="annottext">SrcSpan
</span><a href="#local-6989586621681386879"><span class="hs-identifier hs-var">loc</span></a></span><span> </span><span class="annot"><span class="annottext">forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><a href="../../base-4.16.4.0/src/GHC-Base.html#%24"><span class="hs-operator hs-var">$</span></a></span><span> </span><span class="annot"><span class="annottext">Name -&gt; FieldLabelString -&gt; TcRn (Scaled TcType)
</span><a href="#local-6989586621681386867"><span class="hs-identifier hs-var">find_field_ty</span></a></span><span> </span><span class="annot"><span class="annottext">XCFieldOcc GhcRn
</span><a href="#local-6989586621681386877"><span class="hs-identifier hs-var">sel</span></a></span><span>
</span><span id="line-1259"></span><span>                                            </span><span class="hs-special">(</span><span class="annot"><span class="annottext">OccName -&gt; FieldLabelString
</span><a href="GHC.Types.Name.Occurrence.html#occNameFS"><span class="hs-identifier hs-var">occNameFS</span></a></span><span> </span><span class="annot"><span class="annottext">forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><a href="../../base-4.16.4.0/src/GHC-Base.html#%24"><span class="hs-operator hs-var">$</span></a></span><span> </span><span class="annot"><span class="annottext">RdrName -&gt; OccName
</span><a href="GHC.Types.Name.Reader.html#rdrNameOcc"><span class="hs-identifier hs-var">rdrNameOcc</span></a></span><span> </span><span class="annot"><span class="annottext">RdrName
</span><a href="#local-6989586621681386875"><span class="hs-identifier hs-var">rdr</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-1260"></span><span>             </span><span class="hs-special">;</span><span> </span><span class="hs-special">(</span><span id="local-6989586621681386864"><span class="annot"><span class="annottext">GenLocated (SrcSpanAnn' (EpAnn AnnListItem)) (Pat GhcTc)
</span><a href="#local-6989586621681386864"><span class="hs-identifier hs-var">pat'</span></a></span></span><span class="hs-special">,</span><span> </span><span id="local-6989586621681386863"><span class="annot"><span class="annottext">r
</span><a href="#local-6989586621681386863"><span class="hs-identifier hs-var">res</span></a></span></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">Checker (LPat GhcRn, Scaled TcType) (LPat GhcTc)
</span><a href="GHC.Tc.Gen.Pat.html#tcConArg"><span class="hs-identifier hs-var">tcConArg</span></a></span><span> </span><span class="annot"><span class="annottext">PatEnv
</span><a href="#local-6989586621681386883"><span class="hs-identifier hs-var">penv</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">GenLocated (SrcSpanAnn' (EpAnn AnnListItem)) (Pat GhcRn)
</span><a href="#local-6989586621681386874"><span class="hs-identifier hs-var">pat</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">Scaled TcType
</span><a href="#local-6989586621681386869"><span class="hs-identifier hs-var">pat_ty</span></a></span><span class="hs-special">)</span><span> </span><span class="annot"><span class="annottext">TcM r
</span><a href="#local-6989586621681386872"><span class="hs-identifier hs-var">thing_inside</span></a></span><span>
</span><span id="line-1261"></span><span>             </span><span class="hs-special">;</span><span> </span><span class="annot"><span class="annottext">forall (m :: * -&gt; *) a. Monad m =&gt; a -&gt; m a
</span><a href="../../base-4.16.4.0/src/GHC-Base.html#return"><span class="hs-identifier hs-var">return</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">forall l e. l -&gt; e -&gt; GenLocated l e
</span><a href="GHC.Types.SrcLoc.html#L"><span class="hs-identifier hs-var">L</span></a></span><span> </span><span class="annot"><span class="annottext">SrcSpanAnn' (EpAnn AnnListItem)
</span><a href="#local-6989586621681386882"><span class="hs-identifier hs-var">l</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">forall id arg.
XHsRecField id -&gt; Located id -&gt; arg -&gt; Bool -&gt; HsRecField' id arg
</span><a href="Language.Haskell.Syntax.Pat.html#HsRecField"><span class="hs-identifier hs-var">HsRecField</span></a></span><span> </span><span class="annot"><span class="annottext">XHsRecField (FieldOcc GhcRn)
</span><a href="#local-6989586621681386880"><span class="hs-identifier hs-var">ann</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">forall l e. l -&gt; e -&gt; GenLocated l e
</span><a href="GHC.Types.SrcLoc.html#L"><span class="hs-identifier hs-var">L</span></a></span><span> </span><span class="annot"><span class="annottext">SrcSpan
</span><a href="#local-6989586621681386879"><span class="hs-identifier hs-var">loc</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">forall pass.
XCFieldOcc pass -&gt; GenLocated SrcSpanAnnN RdrName -&gt; FieldOcc pass
</span><a href="Language.Haskell.Syntax.Type.html#FieldOcc"><span class="hs-identifier hs-var">FieldOcc</span></a></span><span> </span><span class="annot"><span class="annottext">TyVar
</span><a href="#local-6989586621681386871"><span class="hs-identifier hs-var">sel'</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">forall l e. l -&gt; e -&gt; GenLocated l e
</span><a href="GHC.Types.SrcLoc.html#L"><span class="hs-identifier hs-var">L</span></a></span><span> </span><span class="annot"><span class="annottext">SrcSpanAnnN
</span><a href="#local-6989586621681386876"><span class="hs-identifier hs-var">lr</span></a></span><span> </span><span class="annot"><span class="annottext">RdrName
</span><a href="#local-6989586621681386875"><span class="hs-identifier hs-var">rdr</span></a></span><span class="hs-special">)</span><span class="hs-special">)</span><span class="hs-special">)</span><span> </span><span class="annot"><span class="annottext">GenLocated (SrcSpanAnn' (EpAnn AnnListItem)) (Pat GhcTc)
</span><a href="#local-6989586621681386864"><span class="hs-identifier hs-var">pat'</span></a></span><span>
</span><span id="line-1262"></span><span>                                                                        </span><span class="annot"><span class="annottext">Bool
</span><a href="#local-6989586621681386873"><span class="hs-identifier hs-var">pun</span></a></span><span class="hs-special">)</span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">r
</span><a href="#local-6989586621681386863"><span class="hs-identifier hs-var">res</span></a></span><span class="hs-special">)</span><span> </span><span class="hs-special">}</span><span>
</span><span id="line-1263"></span><span>
</span><span id="line-1264"></span><span>
</span><span id="line-1265"></span><span>      </span><span class="annot"><a href="#local-6989586621681386867"><span class="hs-identifier hs-type">find_field_ty</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><a href="GHC.Types.Name.html#Name"><span class="hs-identifier hs-type">Name</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="GHC.Types.FieldLabel.html#FieldLabelString"><span class="hs-identifier hs-type">FieldLabelString</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="GHC.Tc.Types.html#TcM"><span class="hs-identifier hs-type">TcM</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="GHC.Core.TyCo.Rep.html#Scaled"><span class="hs-identifier hs-type">Scaled</span></a></span><span> </span><span class="annot"><a href="GHC.Tc.Utils.TcType.html#TcType"><span class="hs-identifier hs-type">TcType</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-1266"></span><span>      </span><span id="local-6989586621681386867"><span class="annot"><span class="annottext">find_field_ty :: Name -&gt; FieldLabelString -&gt; TcRn (Scaled TcType)
</span><a href="#local-6989586621681386867"><span class="hs-identifier hs-var hs-var">find_field_ty</span></a></span></span><span> </span><span id="local-6989586621681386862"><span class="annot"><span class="annottext">Name
</span><a href="#local-6989586621681386862"><span class="hs-identifier hs-var">sel</span></a></span></span><span> </span><span id="local-6989586621681386861"><span class="annot"><span class="annottext">FieldLabelString
</span><a href="#local-6989586621681386861"><span class="hs-identifier hs-var">lbl</span></a></span></span><span>
</span><span id="line-1267"></span><span>        </span><span class="hs-glyph">=</span><span> </span><span class="hs-keyword">case</span><span> </span><span class="hs-special">[</span><span class="annot"><span class="annottext">Scaled TcType
</span><a href="#local-6989586621681386860"><span class="hs-identifier hs-var">ty</span></a></span><span> </span><span class="hs-glyph">|</span><span> </span><span class="hs-special">(</span><span id="local-6989586621681386859"><span class="annot"><span class="annottext">FieldLabel
</span><a href="#local-6989586621681386859"><span class="hs-identifier hs-var">fl</span></a></span></span><span class="hs-special">,</span><span> </span><span id="local-6989586621681386860"><span class="annot"><span class="annottext">Scaled TcType
</span><a href="#local-6989586621681386860"><span class="hs-identifier hs-var">ty</span></a></span></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">[(FieldLabel, Scaled TcType)]
</span><a href="#local-6989586621681386858"><span class="hs-identifier hs-var">field_tys</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">FieldLabel -&gt; Name
</span><a href="GHC.Types.FieldLabel.html#flSelector"><span class="hs-identifier hs-var">flSelector</span></a></span><span> </span><span class="annot"><span class="annottext">FieldLabel
</span><a href="#local-6989586621681386859"><span class="hs-identifier hs-var">fl</span></a></span><span> </span><span class="annot"><span class="annottext">forall a. Eq a =&gt; a -&gt; a -&gt; Bool
</span><span class="hs-operator hs-var">==</span></span><span> </span><span class="annot"><span class="annottext">Name
</span><a href="#local-6989586621681386862"><span class="hs-identifier hs-var">sel</span></a></span><span> </span><span class="hs-special">]</span><span> </span><span class="hs-keyword">of</span><span>
</span><span id="line-1268"></span><span>
</span><span id="line-1269"></span><span>                </span><span class="hs-comment">-- No matching field; chances are this field label comes from some</span><span>
</span><span id="line-1270"></span><span>                </span><span class="hs-comment">-- other record type (or maybe none).  If this happens, just fail,</span><span>
</span><span id="line-1271"></span><span>                </span><span class="hs-comment">-- otherwise we get crashes later (#8570), and similar:</span><span>
</span><span id="line-1272"></span><span>                </span><span class="hs-comment">--      f (R { foo = (a,b) }) = a+b</span><span>
</span><span id="line-1273"></span><span>                </span><span class="hs-comment">-- If foo isn't one of R's fields, we don't want to crash when</span><span>
</span><span id="line-1274"></span><span>                </span><span class="hs-comment">-- typechecking the &quot;a+b&quot;.</span><span>
</span><span id="line-1275"></span><span>           </span><span class="hs-special">[</span><span class="hs-special">]</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="annottext">forall a. SDoc -&gt; TcRn a
</span><a href="GHC.Tc.Utils.Monad.html#failWith"><span class="hs-identifier hs-var">failWith</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">ConLike -&gt; FieldLabelString -&gt; SDoc
</span><a href="GHC.Tc.Gen.Pat.html#badFieldCon"><span class="hs-identifier hs-var">badFieldCon</span></a></span><span> </span><span class="annot"><span class="annottext">ConLike
</span><a href="#local-6989586621681386928"><span class="hs-identifier hs-var">con_like</span></a></span><span> </span><span class="annot"><span class="annottext">FieldLabelString
</span><a href="#local-6989586621681386861"><span class="hs-identifier hs-var">lbl</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-1276"></span><span>
</span><span id="line-1277"></span><span>                </span><span class="hs-comment">-- The normal case, when the field comes from the right constructor</span><span>
</span><span id="line-1278"></span><span>           </span><span class="hs-special">(</span><span id="local-6989586621681386855"><span class="annot"><span class="annottext">Scaled TcType
</span><a href="#local-6989586621681386855"><span class="hs-identifier hs-var">pat_ty</span></a></span></span><span> </span><span class="annot"><span class="hs-glyph hs-type">:</span></span><span> </span><span id="local-6989586621681386854"><span class="annot"><span class="annottext">[Scaled TcType]
</span><a href="#local-6989586621681386854"><span class="hs-identifier hs-var">extras</span></a></span></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-keyword">do</span><span>
</span><span id="line-1279"></span><span>                </span><span class="annot"><span class="annottext">String -&gt; SDoc -&gt; TcRn ()
</span><a href="GHC.Tc.Utils.Monad.html#traceTc"><span class="hs-identifier hs-var">traceTc</span></a></span><span> </span><span class="annot"><span class="annottext">String
</span><span class="hs-string">&quot;find_field&quot;</span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">forall a. Outputable a =&gt; a -&gt; SDoc
</span><a href="GHC.Utils.Outputable.html#ppr"><span class="hs-identifier hs-var">ppr</span></a></span><span> </span><span class="annot"><span class="annottext">Scaled TcType
</span><a href="#local-6989586621681386855"><span class="hs-identifier hs-var">pat_ty</span></a></span><span> </span><span class="annot"><span class="annottext">SDoc -&gt; SDoc -&gt; SDoc
</span><a href="GHC.Utils.Outputable.html#%3C%2B%3E"><span class="hs-operator hs-var">&lt;+&gt;</span></a></span><span> </span><span class="annot"><span class="annottext">forall a. Outputable a =&gt; a -&gt; SDoc
</span><a href="GHC.Utils.Outputable.html#ppr"><span class="hs-identifier hs-var">ppr</span></a></span><span> </span><span class="annot"><span class="annottext">[Scaled TcType]
</span><a href="#local-6989586621681386854"><span class="hs-identifier hs-var">extras</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-1280"></span><span>                </span><span class="hs-identifier">ASSERT</span><span class="hs-special">(</span><span> </span><span class="hs-identifier">null</span><span> </span><span class="hs-identifier">extras</span><span> </span><span class="hs-special">)</span><span> </span><span class="hs-special">(</span><span class="hs-identifier">return</span><span> </span><span class="hs-identifier">pat_ty</span><span class="hs-special">)</span><span>
</span><span id="line-1281"></span><span>
</span><span id="line-1282"></span><span>      </span><span class="annot"><a href="#local-6989586621681386858"><span class="hs-identifier hs-type">field_tys</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="hs-special">[</span><span class="hs-special">(</span><span class="annot"><a href="GHC.Types.FieldLabel.html#FieldLabel"><span class="hs-identifier hs-type">FieldLabel</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><a href="GHC.Core.TyCo.Rep.html#Scaled"><span class="hs-identifier hs-type">Scaled</span></a></span><span> </span><span class="annot"><a href="GHC.Tc.Utils.TcType.html#TcType"><span class="hs-identifier hs-type">TcType</span></a></span><span class="hs-special">)</span><span class="hs-special">]</span><span>
</span><span id="line-1283"></span><span>      </span><span id="local-6989586621681386858"><span class="annot"><span class="annottext">field_tys :: [(FieldLabel, Scaled TcType)]
</span><a href="#local-6989586621681386858"><span class="hs-identifier hs-var hs-var">field_tys</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">forall a b. [a] -&gt; [b] -&gt; [(a, b)]
</span><a href="../../base-4.16.4.0/src/GHC-List.html#zip"><span class="hs-identifier hs-var">zip</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">ConLike -&gt; [FieldLabel]
</span><a href="GHC.Core.ConLike.html#conLikeFieldLabels"><span class="hs-identifier hs-var">conLikeFieldLabels</span></a></span><span> </span><span class="annot"><span class="annottext">ConLike
</span><a href="#local-6989586621681386928"><span class="hs-identifier hs-var">con_like</span></a></span><span class="hs-special">)</span><span> </span><span class="annot"><span class="annottext">[Scaled TcType]
</span><a href="#local-6989586621681386927"><span class="hs-identifier hs-var">arg_tys</span></a></span><span>
</span><span id="line-1284"></span><span>          </span><span class="hs-comment">-- Don't use zipEqual! If the constructor isn't really a record, then</span><span>
</span><span id="line-1285"></span><span>          </span><span class="hs-comment">-- dataConFieldLabels will be empty (and each field in the pattern</span><span>
</span><span id="line-1286"></span><span>          </span><span class="hs-comment">-- will generate an error below).</span><span>
</span><span id="line-1287"></span><span>
</span><span id="line-1288"></span><span class="annot"><a href="GHC.Tc.Gen.Pat.html#tcConTyArg"><span class="hs-identifier hs-type">tcConTyArg</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><a href="GHC.Tc.Gen.Pat.html#Checker"><span class="hs-identifier hs-type">Checker</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="Language.Haskell.Syntax.Type.html#HsPatSigType"><span class="hs-identifier hs-type">HsPatSigType</span></a></span><span> </span><span class="annot"><a href="GHC.Hs.Extension.html#GhcRn"><span class="hs-identifier hs-type">GhcRn</span></a></span><span class="hs-special">)</span><span> </span><span class="annot"><a href="GHC.Tc.Utils.TcType.html#TcType"><span class="hs-identifier hs-type">TcType</span></a></span><span>
</span><span id="line-1289"></span><span id="tcConTyArg"><span class="annot"><span class="annottext">tcConTyArg :: Checker (HsPatSigType GhcRn) TcType
</span><a href="GHC.Tc.Gen.Pat.html#tcConTyArg"><span class="hs-identifier hs-var hs-var">tcConTyArg</span></a></span></span><span> </span><span id="local-6989586621681386846"><span class="annot"><span class="annottext">PatEnv
</span><a href="#local-6989586621681386846"><span class="hs-identifier hs-var">penv</span></a></span></span><span> </span><span id="local-6989586621681386845"><span class="annot"><span class="annottext">HsPatSigType GhcRn
</span><a href="#local-6989586621681386845"><span class="hs-identifier hs-var">rn_ty</span></a></span></span><span> </span><span id="local-6989586621681386844"><span class="annot"><span class="annottext">TcM r
</span><a href="#local-6989586621681386844"><span class="hs-identifier hs-var">thing_inside</span></a></span></span><span>
</span><span id="line-1290"></span><span>  </span><span class="hs-glyph">=</span><span> </span><span class="hs-keyword">do</span><span> </span><span class="hs-special">{</span><span> </span><span class="hs-special">(</span><span id="local-6989586621681386843"><span class="annot"><span class="annottext">[(Name, TyVar)]
</span><a href="#local-6989586621681386843"><span class="hs-identifier hs-var">sig_wcs</span></a></span></span><span class="hs-special">,</span><span> </span><span id="local-6989586621681386842"><span class="annot"><span class="annottext">[(Name, TyVar)]
</span><a href="#local-6989586621681386842"><span class="hs-identifier hs-var">sig_ibs</span></a></span></span><span class="hs-special">,</span><span> </span><span id="local-6989586621681386841"><span class="annot"><span class="annottext">TcType
</span><a href="#local-6989586621681386841"><span class="hs-identifier hs-var">arg_ty</span></a></span></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">UserTypeCtxt
-&gt; HoleMode
-&gt; HsPatSigType GhcRn
-&gt; ContextKind
-&gt; TcM ([(Name, TyVar)], [(Name, TyVar)], TcType)
</span><a href="GHC.Tc.Gen.HsType.html#tcHsPatSigType"><span class="hs-identifier hs-var">tcHsPatSigType</span></a></span><span> </span><span class="annot"><span class="annottext">UserTypeCtxt
</span><a href="GHC.Tc.Types.Origin.html#TypeAppCtxt"><span class="hs-identifier hs-var">TypeAppCtxt</span></a></span><span> </span><span class="annot"><span class="annottext">HoleMode
</span><a href="GHC.Tc.Gen.HsType.html#HM_TyAppPat"><span class="hs-identifier hs-var">HM_TyAppPat</span></a></span><span> </span><span class="annot"><span class="annottext">HsPatSigType GhcRn
</span><a href="#local-6989586621681386845"><span class="hs-identifier hs-var">rn_ty</span></a></span><span> </span><span class="annot"><span class="annottext">ContextKind
</span><a href="GHC.Tc.Gen.HsType.html#AnyKind"><span class="hs-identifier hs-var">AnyKind</span></a></span><span>
</span><span id="line-1291"></span><span>               </span><span class="hs-comment">-- AnyKind is a bit suspect: it really should be the kind gotten</span><span>
</span><span id="line-1292"></span><span>               </span><span class="hs-comment">-- from instantiating the constructor type. But this would be</span><span>
</span><span id="line-1293"></span><span>               </span><span class="hs-comment">-- hard to get right, because earlier type patterns might influence</span><span>
</span><span id="line-1294"></span><span>               </span><span class="hs-comment">-- the kinds of later patterns. In any case, it all gets checked</span><span>
</span><span id="line-1295"></span><span>               </span><span class="hs-comment">-- by the calls to unifyType in tcConArgs, which will also unify</span><span>
</span><span id="line-1296"></span><span>               </span><span class="hs-comment">-- kinds.</span><span>
</span><span id="line-1297"></span><span>       </span><span class="hs-special">;</span><span> </span><span class="annot"><span class="annottext">forall (f :: * -&gt; *). Applicative f =&gt; Bool -&gt; f () -&gt; f ()
</span><a href="../../base-4.16.4.0/src/GHC-Base.html#when"><span class="hs-identifier hs-var">when</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Bool -&gt; Bool
</span><span class="hs-identifier hs-var">not</span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">forall (t :: * -&gt; *) a. Foldable t =&gt; t a -&gt; Bool
</span><a href="../../base-4.16.4.0/src/Data-Foldable.html#null"><span class="hs-identifier hs-var">null</span></a></span><span> </span><span class="annot"><span class="annottext">[(Name, TyVar)]
</span><a href="#local-6989586621681386842"><span class="hs-identifier hs-var">sig_ibs</span></a></span><span class="hs-special">)</span><span> </span><span class="annot"><span class="annottext">Bool -&gt; Bool -&gt; Bool
</span><span class="hs-operator hs-var">&amp;&amp;</span></span><span> </span><span class="annot"><span class="annottext">PatEnv -&gt; Bool
</span><a href="GHC.Tc.Gen.Pat.html#inPatBind"><span class="hs-identifier hs-var">inPatBind</span></a></span><span> </span><span class="annot"><span class="annottext">PatEnv
</span><a href="#local-6989586621681386846"><span class="hs-identifier hs-var">penv</span></a></span><span class="hs-special">)</span><span> </span><span class="annot"><span class="annottext">forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><a href="../../base-4.16.4.0/src/GHC-Base.html#%24"><span class="hs-operator hs-var">$</span></a></span><span>
</span><span id="line-1298"></span><span>           </span><span class="annot"><span class="annottext">SDoc -&gt; TcRn ()
</span><a href="GHC.Tc.Utils.Monad.html#addErr"><span class="hs-identifier hs-var">addErr</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">String -&gt; SDoc
</span><a href="GHC.Utils.Outputable.html#text"><span class="hs-identifier hs-var">text</span></a></span><span> </span><span class="annot"><span class="annottext">String
</span><span class="hs-string">&quot;Binding type variables is not allowed in pattern bindings&quot;</span></span><span class="hs-special">)</span><span>
</span><span id="line-1299"></span><span>       </span><span class="hs-special">;</span><span> </span><span id="local-6989586621681386837"><span class="annot"><span class="annottext">r
</span><a href="#local-6989586621681386837"><span class="hs-identifier hs-var">result</span></a></span></span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">forall r. [(Name, TyVar)] -&gt; TcM r -&gt; TcM r
</span><a href="GHC.Tc.Utils.Env.html#tcExtendNameTyVarEnv"><span class="hs-identifier hs-var">tcExtendNameTyVarEnv</span></a></span><span> </span><span class="annot"><span class="annottext">[(Name, TyVar)]
</span><a href="#local-6989586621681386843"><span class="hs-identifier hs-var">sig_wcs</span></a></span><span> </span><span class="annot"><span class="annottext">forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><a href="../../base-4.16.4.0/src/GHC-Base.html#%24"><span class="hs-operator hs-var">$</span></a></span><span>
</span><span id="line-1300"></span><span>                   </span><span class="annot"><span class="annottext">forall r. [(Name, TyVar)] -&gt; TcM r -&gt; TcM r
</span><a href="GHC.Tc.Utils.Env.html#tcExtendNameTyVarEnv"><span class="hs-identifier hs-var">tcExtendNameTyVarEnv</span></a></span><span> </span><span class="annot"><span class="annottext">[(Name, TyVar)]
</span><a href="#local-6989586621681386842"><span class="hs-identifier hs-var">sig_ibs</span></a></span><span> </span><span class="annot"><span class="annottext">forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><a href="../../base-4.16.4.0/src/GHC-Base.html#%24"><span class="hs-operator hs-var">$</span></a></span><span>
</span><span id="line-1301"></span><span>                   </span><span class="annot"><span class="annottext">TcM r
</span><a href="#local-6989586621681386844"><span class="hs-identifier hs-var">thing_inside</span></a></span><span>
</span><span id="line-1302"></span><span>       </span><span class="hs-special">;</span><span> </span><span class="annot"><span class="annottext">forall (m :: * -&gt; *) a. Monad m =&gt; a -&gt; m a
</span><a href="../../base-4.16.4.0/src/GHC-Base.html#return"><span class="hs-identifier hs-var">return</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">TcType
</span><a href="#local-6989586621681386841"><span class="hs-identifier hs-var">arg_ty</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">r
</span><a href="#local-6989586621681386837"><span class="hs-identifier hs-var">result</span></a></span><span class="hs-special">)</span><span> </span><span class="hs-special">}</span><span>
</span><span id="line-1303"></span><span>
</span><span id="line-1304"></span><span class="annot"><a href="GHC.Tc.Gen.Pat.html#tcConArg"><span class="hs-identifier hs-type">tcConArg</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><a href="GHC.Tc.Gen.Pat.html#Checker"><span class="hs-identifier hs-type">Checker</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="Language.Haskell.Syntax.Pat.html#LPat"><span class="hs-identifier hs-type">LPat</span></a></span><span> </span><span class="annot"><a href="GHC.Hs.Extension.html#GhcRn"><span class="hs-identifier hs-type">GhcRn</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><a href="GHC.Core.TyCo.Rep.html#Scaled"><span class="hs-identifier hs-type">Scaled</span></a></span><span> </span><span class="annot"><a href="GHC.Tc.Utils.TcType.html#TcSigmaType"><span class="hs-identifier hs-type">TcSigmaType</span></a></span><span class="hs-special">)</span><span> </span><span class="hs-special">(</span><span class="annot"><a href="Language.Haskell.Syntax.Pat.html#LPat"><span class="hs-identifier hs-type">LPat</span></a></span><span> </span><span class="annot"><a href="GHC.Hs.Extension.html#GhcTc"><span class="hs-identifier hs-type">GhcTc</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-1305"></span><span id="tcConArg"><span class="annot"><span class="annottext">tcConArg :: Checker (LPat GhcRn, Scaled TcType) (LPat GhcTc)
</span><a href="GHC.Tc.Gen.Pat.html#tcConArg"><span class="hs-identifier hs-var hs-var">tcConArg</span></a></span></span><span> </span><span id="local-6989586621681386836"><span class="annot"><span class="annottext">PatEnv
</span><a href="#local-6989586621681386836"><span class="hs-identifier hs-var">penv</span></a></span></span><span> </span><span class="hs-special">(</span><span id="local-6989586621681386835"><span class="annot"><span class="annottext">LPat GhcRn
</span><a href="#local-6989586621681386835"><span class="hs-identifier hs-var">arg_pat</span></a></span></span><span class="hs-special">,</span><span> </span><span class="annot"><a href="GHC.Core.TyCo.Rep.html#Scaled"><span class="hs-identifier hs-type">Scaled</span></a></span><span> </span><span id="local-6989586621681386834"><span class="annot"><span class="annottext">TcType
</span><a href="#local-6989586621681386834"><span class="hs-identifier hs-var">arg_mult</span></a></span></span><span> </span><span id="local-6989586621681386833"><span class="annot"><span class="annottext">TcType
</span><a href="#local-6989586621681386833"><span class="hs-identifier hs-var">arg_ty</span></a></span></span><span class="hs-special">)</span><span>
</span><span id="line-1306"></span><span>  </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">Scaled ExpSigmaType -&gt; Checker (LPat GhcRn) (LPat GhcTc)
</span><a href="GHC.Tc.Gen.Pat.html#tc_lpat"><span class="hs-identifier hs-var">tc_lpat</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">forall a. TcType -&gt; a -&gt; Scaled a
</span><a href="GHC.Core.TyCo.Rep.html#Scaled"><span class="hs-identifier hs-var">Scaled</span></a></span><span> </span><span class="annot"><span class="annottext">TcType
</span><a href="#local-6989586621681386834"><span class="hs-identifier hs-var">arg_mult</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">TcType -&gt; ExpSigmaType
</span><a href="GHC.Tc.Utils.TcType.html#mkCheckExpType"><span class="hs-identifier hs-var">mkCheckExpType</span></a></span><span> </span><span class="annot"><span class="annottext">TcType
</span><a href="#local-6989586621681386833"><span class="hs-identifier hs-var">arg_ty</span></a></span><span class="hs-special">)</span><span class="hs-special">)</span><span> </span><span class="annot"><span class="annottext">PatEnv
</span><a href="#local-6989586621681386836"><span class="hs-identifier hs-var">penv</span></a></span><span> </span><span class="annot"><span class="annottext">LPat GhcRn
</span><a href="#local-6989586621681386835"><span class="hs-identifier hs-var">arg_pat</span></a></span><span>
</span><span id="line-1307"></span><span>
</span><span id="line-1308"></span><span class="annot"><a href="GHC.Tc.Gen.Pat.html#addDataConStupidTheta"><span class="hs-identifier hs-type">addDataConStupidTheta</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><a href="GHC.Core.DataCon.html#DataCon"><span class="hs-identifier hs-type">DataCon</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-special">[</span><span class="annot"><a href="GHC.Tc.Utils.TcType.html#TcType"><span class="hs-identifier hs-type">TcType</span></a></span><span class="hs-special">]</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="GHC.Tc.Types.html#TcM"><span class="hs-identifier hs-type">TcM</span></a></span><span> </span><span class="hs-special">(</span><span class="hs-special">)</span><span>
</span><span id="line-1309"></span><span class="hs-comment">-- Instantiate the &quot;stupid theta&quot; of the data con, and throw</span><span>
</span><span id="line-1310"></span><span class="hs-comment">-- the constraints into the constraint set</span><span>
</span><span id="line-1311"></span><span id="addDataConStupidTheta"><span class="annot"><span class="annottext">addDataConStupidTheta :: DataCon -&gt; [TcType] -&gt; TcRn ()
</span><a href="GHC.Tc.Gen.Pat.html#addDataConStupidTheta"><span class="hs-identifier hs-var hs-var">addDataConStupidTheta</span></a></span></span><span> </span><span id="local-6989586621681386832"><span class="annot"><span class="annottext">DataCon
</span><a href="#local-6989586621681386832"><span class="hs-identifier hs-var">data_con</span></a></span></span><span> </span><span id="local-6989586621681386831"><span class="annot"><span class="annottext">[TcType]
</span><a href="#local-6989586621681386831"><span class="hs-identifier hs-var">inst_tys</span></a></span></span><span>
</span><span id="line-1312"></span><span>  </span><span class="hs-glyph">|</span><span> </span><span class="annot"><span class="annottext">forall (t :: * -&gt; *) a. Foldable t =&gt; t a -&gt; Bool
</span><a href="../../base-4.16.4.0/src/Data-Foldable.html#null"><span class="hs-identifier hs-var">null</span></a></span><span> </span><span class="annot"><span class="annottext">[TcType]
</span><a href="#local-6989586621681386830"><span class="hs-identifier hs-var">stupid_theta</span></a></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">forall (m :: * -&gt; *) a. Monad m =&gt; a -&gt; m a
</span><a href="../../base-4.16.4.0/src/GHC-Base.html#return"><span class="hs-identifier hs-var">return</span></a></span><span> </span><span class="hs-special">(</span><span class="hs-special">)</span><span>
</span><span id="line-1313"></span><span>  </span><span class="hs-glyph">|</span><span> </span><span class="annot"><span class="annottext">Bool
</span><a href="../../base-4.16.4.0/src/GHC-Base.html#otherwise"><span class="hs-identifier hs-var">otherwise</span></a></span><span>         </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">CtOrigin -&gt; [TcType] -&gt; TcRn ()
</span><a href="GHC.Tc.Utils.Instantiate.html#instStupidTheta"><span class="hs-identifier hs-var">instStupidTheta</span></a></span><span> </span><span class="annot"><span class="annottext">CtOrigin
</span><a href="#local-6989586621681386829"><span class="hs-identifier hs-var">origin</span></a></span><span> </span><span class="annot"><span class="annottext">[TcType]
</span><a href="#local-6989586621681386828"><span class="hs-identifier hs-var">inst_theta</span></a></span><span>
</span><span id="line-1314"></span><span>  </span><span class="hs-keyword">where</span><span>
</span><span id="line-1315"></span><span>    </span><span id="local-6989586621681386829"><span class="annot"><span class="annottext">origin :: CtOrigin
</span><a href="#local-6989586621681386829"><span class="hs-identifier hs-var hs-var">origin</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">Name -&gt; CtOrigin
</span><a href="GHC.Tc.Types.Origin.html#OccurrenceOf"><span class="hs-identifier hs-var">OccurrenceOf</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">DataCon -&gt; Name
</span><a href="GHC.Core.DataCon.html#dataConName"><span class="hs-identifier hs-var">dataConName</span></a></span><span> </span><span class="annot"><span class="annottext">DataCon
</span><a href="#local-6989586621681386832"><span class="hs-identifier hs-var">data_con</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-1316"></span><span>        </span><span class="hs-comment">-- The origin should always report &quot;occurrence of C&quot;</span><span>
</span><span id="line-1317"></span><span>        </span><span class="hs-comment">-- even when C occurs in a pattern</span><span>
</span><span id="line-1318"></span><span>    </span><span id="local-6989586621681386830"><span class="annot"><span class="annottext">stupid_theta :: [TcType]
</span><a href="#local-6989586621681386830"><span class="hs-identifier hs-var hs-var">stupid_theta</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">DataCon -&gt; [TcType]
</span><a href="GHC.Core.DataCon.html#dataConStupidTheta"><span class="hs-identifier hs-var">dataConStupidTheta</span></a></span><span> </span><span class="annot"><span class="annottext">DataCon
</span><a href="#local-6989586621681386832"><span class="hs-identifier hs-var">data_con</span></a></span><span>
</span><span id="line-1319"></span><span>    </span><span id="local-6989586621681386825"><span class="annot"><span class="annottext">univ_tvs :: [TyVar]
</span><a href="#local-6989586621681386825"><span class="hs-identifier hs-var hs-var">univ_tvs</span></a></span></span><span>     </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">DataCon -&gt; [TyVar]
</span><a href="GHC.Core.DataCon.html#dataConUnivTyVars"><span class="hs-identifier hs-var">dataConUnivTyVars</span></a></span><span> </span><span class="annot"><span class="annottext">DataCon
</span><a href="#local-6989586621681386832"><span class="hs-identifier hs-var">data_con</span></a></span><span>
</span><span id="line-1320"></span><span>    </span><span id="local-6989586621681386823"><span class="annot"><span class="annottext">tenv :: TCvSubst
</span><a href="#local-6989586621681386823"><span class="hs-identifier hs-var hs-var">tenv</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">HasDebugCallStack =&gt; [TyVar] -&gt; [TcType] -&gt; TCvSubst
</span><a href="GHC.Core.TyCo.Subst.html#zipTvSubst"><span class="hs-identifier hs-var">zipTvSubst</span></a></span><span> </span><span class="annot"><span class="annottext">[TyVar]
</span><a href="#local-6989586621681386825"><span class="hs-identifier hs-var">univ_tvs</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">forall b a. [b] -&gt; [a] -&gt; [a]
</span><a href="GHC.Utils.Misc.html#takeList"><span class="hs-identifier hs-var">takeList</span></a></span><span> </span><span class="annot"><span class="annottext">[TyVar]
</span><a href="#local-6989586621681386825"><span class="hs-identifier hs-var">univ_tvs</span></a></span><span> </span><span class="annot"><span class="annottext">[TcType]
</span><a href="#local-6989586621681386831"><span class="hs-identifier hs-var">inst_tys</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-1321"></span><span>         </span><span class="hs-comment">-- NB: inst_tys can be longer than the univ tyvars</span><span>
</span><span id="line-1322"></span><span>         </span><span class="hs-comment">--     because the constructor might have existentials</span><span>
</span><span id="line-1323"></span><span>    </span><span id="local-6989586621681386828"><span class="annot"><span class="annottext">inst_theta :: [TcType]
</span><a href="#local-6989586621681386828"><span class="hs-identifier hs-var hs-var">inst_theta</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">HasCallStack =&gt; TCvSubst -&gt; [TcType] -&gt; [TcType]
</span><a href="GHC.Core.TyCo.Subst.html#substTheta"><span class="hs-identifier hs-var">substTheta</span></a></span><span> </span><span class="annot"><span class="annottext">TCvSubst
</span><a href="#local-6989586621681386823"><span class="hs-identifier hs-var">tenv</span></a></span><span> </span><span class="annot"><span class="annottext">[TcType]
</span><a href="#local-6989586621681386830"><span class="hs-identifier hs-var">stupid_theta</span></a></span><span>
</span><span id="line-1324"></span><span>
</span><span id="line-1325"></span><span class="annot"><a href="GHC.Tc.Gen.Pat.html#conTyArgArityErr"><span class="hs-identifier hs-type">conTyArgArityErr</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><a href="GHC.Core.ConLike.html#ConLike"><span class="hs-identifier hs-type">ConLike</span></a></span><span>
</span><span id="line-1326"></span><span>                 </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="hs-identifier hs-type">Int</span></span><span>   </span><span class="hs-comment">-- expected # of arguments</span><span>
</span><span id="line-1327"></span><span>                 </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="hs-identifier hs-type">Int</span></span><span>   </span><span class="hs-comment">-- actual # of arguments</span><span>
</span><span id="line-1328"></span><span>                 </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="GHC.Utils.Outputable.html#SDoc"><span class="hs-identifier hs-type">SDoc</span></a></span><span>
</span><span id="line-1329"></span><span id="conTyArgArityErr"><span class="annot"><span class="annottext">conTyArgArityErr :: ConLike -&gt; Int -&gt; Int -&gt; SDoc
</span><a href="GHC.Tc.Gen.Pat.html#conTyArgArityErr"><span class="hs-identifier hs-var hs-var">conTyArgArityErr</span></a></span></span><span> </span><span id="local-6989586621681386820"><span class="annot"><span class="annottext">ConLike
</span><a href="#local-6989586621681386820"><span class="hs-identifier hs-var">con_like</span></a></span></span><span> </span><span id="local-6989586621681386819"><span class="annot"><span class="annottext">Int
</span><a href="#local-6989586621681386819"><span class="hs-identifier hs-var">expected_number</span></a></span></span><span> </span><span id="local-6989586621681386818"><span class="annot"><span class="annottext">Int
</span><a href="#local-6989586621681386818"><span class="hs-identifier hs-var">actual_number</span></a></span></span><span>
</span><span id="line-1330"></span><span>  </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">String -&gt; SDoc
</span><a href="GHC.Utils.Outputable.html#text"><span class="hs-identifier hs-var">text</span></a></span><span> </span><span class="annot"><span class="annottext">String
</span><span class="hs-string">&quot;Too many type arguments in constructor pattern for&quot;</span></span><span> </span><span class="annot"><span class="annottext">SDoc -&gt; SDoc -&gt; SDoc
</span><a href="GHC.Utils.Outputable.html#%3C%2B%3E"><span class="hs-operator hs-var">&lt;+&gt;</span></a></span><span> </span><span class="annot"><span class="annottext">SDoc -&gt; SDoc
</span><a href="GHC.Utils.Outputable.html#quotes"><span class="hs-identifier hs-var">quotes</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">forall a. Outputable a =&gt; a -&gt; SDoc
</span><a href="GHC.Utils.Outputable.html#ppr"><span class="hs-identifier hs-var">ppr</span></a></span><span> </span><span class="annot"><span class="annottext">ConLike
</span><a href="#local-6989586621681386820"><span class="hs-identifier hs-var">con_like</span></a></span><span class="hs-special">)</span><span> </span><span class="annot"><span class="annottext">SDoc -&gt; SDoc -&gt; SDoc
</span><a href="GHC.Utils.Outputable.html#%24%24"><span class="hs-operator hs-var">$$</span></a></span><span>
</span><span id="line-1331"></span><span>    </span><span class="annot"><span class="annottext">String -&gt; SDoc
</span><a href="GHC.Utils.Outputable.html#text"><span class="hs-identifier hs-var">text</span></a></span><span> </span><span class="annot"><span class="annottext">String
</span><span class="hs-string">&quot;Expected no more than&quot;</span></span><span> </span><span class="annot"><span class="annottext">SDoc -&gt; SDoc -&gt; SDoc
</span><a href="GHC.Utils.Outputable.html#%3C%2B%3E"><span class="hs-operator hs-var">&lt;+&gt;</span></a></span><span> </span><span class="annot"><span class="annottext">forall a. Outputable a =&gt; a -&gt; SDoc
</span><a href="GHC.Utils.Outputable.html#ppr"><span class="hs-identifier hs-var">ppr</span></a></span><span> </span><span class="annot"><span class="annottext">Int
</span><a href="#local-6989586621681386819"><span class="hs-identifier hs-var">expected_number</span></a></span><span> </span><span class="annot"><span class="annottext">SDoc -&gt; SDoc -&gt; SDoc
</span><a href="GHC.Utils.Outputable.html#%3C%3E"><span class="hs-operator hs-var">&lt;&gt;</span></a></span><span> </span><span class="annot"><span class="annottext">SDoc
</span><a href="GHC.Utils.Outputable.html#semi"><span class="hs-identifier hs-var">semi</span></a></span><span> </span><span class="annot"><span class="annottext">SDoc -&gt; SDoc -&gt; SDoc
</span><a href="GHC.Utils.Outputable.html#%3C%2B%3E"><span class="hs-operator hs-var">&lt;+&gt;</span></a></span><span> </span><span class="annot"><span class="annottext">String -&gt; SDoc
</span><a href="GHC.Utils.Outputable.html#text"><span class="hs-identifier hs-var">text</span></a></span><span> </span><span class="annot"><span class="annottext">String
</span><span class="hs-string">&quot;got&quot;</span></span><span> </span><span class="annot"><span class="annottext">SDoc -&gt; SDoc -&gt; SDoc
</span><a href="GHC.Utils.Outputable.html#%3C%2B%3E"><span class="hs-operator hs-var">&lt;+&gt;</span></a></span><span> </span><span class="annot"><span class="annottext">forall a. Outputable a =&gt; a -&gt; SDoc
</span><a href="GHC.Utils.Outputable.html#ppr"><span class="hs-identifier hs-var">ppr</span></a></span><span> </span><span class="annot"><span class="annottext">Int
</span><a href="#local-6989586621681386818"><span class="hs-identifier hs-var">actual_number</span></a></span><span>
</span><span id="line-1332"></span><span>
</span><span id="line-1333"></span><span class="hs-comment">{-
Note [Arrows and patterns]
~~~~~~~~~~~~~~~~~~~~~~~~~~
(Oct 07) Arrow notation has the odd property that it involves
&quot;holes in the scope&quot;. For example:
  expr :: Arrow a =&gt; a () Int
  expr = proc (y,z) -&gt; do
          x &lt;- term -&lt; y
          expr' -&lt; x

Here the 'proc (y,z)' binding scopes over the arrow tails but not the
arrow body (e.g 'term').  As things stand (bogusly) all the
constraints from the proc body are gathered together, so constraints
from 'term' will be seen by the tcPat for (y,z).  But we must *not*
bind constraints from 'term' here, because the desugarer will not make
these bindings scope over 'term'.

The Right Thing is not to confuse these constraints together. But for
now the Easy Thing is to ensure that we do not have existential or
GADT constraints in a 'proc', which we do by disallowing any
non-vanilla pattern match (i.e. one that introduces existential
variables or provided constraints), in tcDataConPat and tcPatSynPat.

We also short-cut the constraint simplification for such vanilla patterns,
so that we bind no constraints. Hence the 'fast path' in tcDataConPat;
which applies more generally (not just within 'proc'), as it's a good
plan in general to bypass the constraint simplification step entirely
when it's not needed.

************************************************************************
*                                                                      *
                Note [Pattern coercions]
*                                                                      *
************************************************************************

In principle, these program would be reasonable:

        f :: (forall a. a-&gt;a) -&gt; Int
        f (x :: Int-&gt;Int) = x 3

        g :: (forall a. [a]) -&gt; Bool
        g [] = True

In both cases, the function type signature restricts what arguments can be passed
in a call (to polymorphic ones).  The pattern type signature then instantiates this
type.  For example, in the first case,  (forall a. a-&gt;a) &lt;= Int -&gt; Int, and we
generate the translated term
        f = \x' :: (forall a. a-&gt;a).  let x = x' Int in x 3

From a type-system point of view, this is perfectly fine, but it's *very* seldom useful.
And it requires a significant amount of code to implement, because we need to decorate
the translated pattern with coercion functions (generated from the subsumption check
by tcSub).

So for now I'm just insisting on type *equality* in patterns.  No subsumption.

Old notes about desugaring, at a time when pattern coercions were handled:

A SigPat is a type coercion and must be handled one at a time.  We can't
combine them unless the type of the pattern inside is identical, and we don't
bother to check for that.  For example:

        data T = T1 Int | T2 Bool
        f :: (forall a. a -&gt; a) -&gt; T -&gt; t
        f (g::Int-&gt;Int)   (T1 i) = T1 (g i)
        f (g::Bool-&gt;Bool) (T2 b) = T2 (g b)

We desugar this as follows:

        f = \ g::(forall a. a-&gt;a) t::T -&gt;
            let gi = g Int
            in case t of { T1 i -&gt; T1 (gi i)
                           other -&gt;
            let gb = g Bool
            in case t of { T2 b -&gt; T2 (gb b)
                           other -&gt; fail }}

Note that we do not treat the first column of patterns as a
column of variables, because the coerced variables (gi, gb)
would be of different types.  So we get rather grotty code.
But I don't think this is a common case, and if it was we could
doubtless improve it.

Meanwhile, the strategy is:
        * treat each SigPat coercion (always non-identity coercions)
                as a separate block
        * deal with the stuff inside, and then wrap a binding round
                the result to bind the new variable (gi, gb, etc)


************************************************************************
*                                                                      *
\subsection{Errors and contexts}
*                                                                      *
************************************************************************

Note [Existential check]
~~~~~~~~~~~~~~~~~~~~~~~~
Lazy patterns can't bind existentials.  They arise in two ways:
  * Let bindings      let { C a b = e } in b
  * Twiddle patterns  f ~(C a b) = e
The pe_lazy field of PatEnv says whether we are inside a lazy
pattern (perhaps deeply)

See also Note [Typechecking pattern bindings] in GHC.Tc.Gen.Bind
-}</span><span>
</span><span id="line-1439"></span><span>
</span><span id="line-1440"></span><span id="local-6989586621681388125"><span id="local-6989586621681388126"><span class="annot"><a href="GHC.Tc.Gen.Pat.html#maybeWrapPatCtxt"><span class="hs-identifier hs-type">maybeWrapPatCtxt</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><a href="Language.Haskell.Syntax.Pat.html#Pat"><span class="hs-identifier hs-type">Pat</span></a></span><span> </span><span class="annot"><a href="GHC.Hs.Extension.html#GhcRn"><span class="hs-identifier hs-type">GhcRn</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-special">(</span><span class="annot"><a href="GHC.Tc.Types.html#TcM"><span class="hs-identifier hs-type">TcM</span></a></span><span> </span><span class="annot"><a href="#local-6989586621681388126"><span class="hs-identifier hs-type">a</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="GHC.Tc.Types.html#TcM"><span class="hs-identifier hs-type">TcM</span></a></span><span> </span><span class="annot"><a href="#local-6989586621681388125"><span class="hs-identifier hs-type">b</span></a></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="GHC.Tc.Types.html#TcM"><span class="hs-identifier hs-type">TcM</span></a></span><span> </span><span class="annot"><a href="#local-6989586621681388126"><span class="hs-identifier hs-type">a</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="GHC.Tc.Types.html#TcM"><span class="hs-identifier hs-type">TcM</span></a></span><span> </span><span class="annot"><a href="#local-6989586621681388125"><span class="hs-identifier hs-type">b</span></a></span></span></span><span>
</span><span id="line-1441"></span><span class="hs-comment">-- Not all patterns are worth pushing a context</span><span>
</span><span id="line-1442"></span><span id="maybeWrapPatCtxt"><span class="annot"><span class="annottext">maybeWrapPatCtxt :: forall a b. Pat GhcRn -&gt; (TcM a -&gt; TcM b) -&gt; TcM a -&gt; TcM b
</span><a href="GHC.Tc.Gen.Pat.html#maybeWrapPatCtxt"><span class="hs-identifier hs-var hs-var">maybeWrapPatCtxt</span></a></span></span><span> </span><span id="local-6989586621681386805"><span class="annot"><span class="annottext">Pat GhcRn
</span><a href="#local-6989586621681386805"><span class="hs-identifier hs-var">pat</span></a></span></span><span> </span><span id="local-6989586621681386804"><span class="annot"><span class="annottext">TcM a -&gt; TcM b
</span><a href="#local-6989586621681386804"><span class="hs-identifier hs-var">tcm</span></a></span></span><span> </span><span id="local-6989586621681386803"><span class="annot"><span class="annottext">TcM a
</span><a href="#local-6989586621681386803"><span class="hs-identifier hs-var">thing_inside</span></a></span></span><span>
</span><span id="line-1443"></span><span>  </span><span class="hs-glyph">|</span><span> </span><span class="annot"><span class="annottext">Bool -&gt; Bool
</span><span class="hs-identifier hs-var">not</span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">forall {p}. Pat p -&gt; Bool
</span><a href="#local-6989586621681386802"><span class="hs-identifier hs-var">worth_wrapping</span></a></span><span> </span><span class="annot"><span class="annottext">Pat GhcRn
</span><a href="#local-6989586621681386805"><span class="hs-identifier hs-var">pat</span></a></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">TcM a -&gt; TcM b
</span><a href="#local-6989586621681386804"><span class="hs-identifier hs-var">tcm</span></a></span><span> </span><span class="annot"><span class="annottext">TcM a
</span><a href="#local-6989586621681386803"><span class="hs-identifier hs-var">thing_inside</span></a></span><span>
</span><span id="line-1444"></span><span>  </span><span class="hs-glyph">|</span><span> </span><span class="annot"><span class="annottext">Bool
</span><a href="../../base-4.16.4.0/src/GHC-Base.html#otherwise"><span class="hs-identifier hs-var">otherwise</span></a></span><span>                </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">forall a. SDoc -&gt; TcM a -&gt; TcM a
</span><a href="GHC.Tc.Utils.Monad.html#addErrCtxt"><span class="hs-identifier hs-var">addErrCtxt</span></a></span><span> </span><span class="annot"><span class="annottext">SDoc
</span><a href="#local-6989586621681386800"><span class="hs-identifier hs-var">msg</span></a></span><span> </span><span class="annot"><span class="annottext">forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><a href="../../base-4.16.4.0/src/GHC-Base.html#%24"><span class="hs-operator hs-var">$</span></a></span><span> </span><span class="annot"><span class="annottext">TcM a -&gt; TcM b
</span><a href="#local-6989586621681386804"><span class="hs-identifier hs-var">tcm</span></a></span><span> </span><span class="annot"><span class="annottext">forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><a href="../../base-4.16.4.0/src/GHC-Base.html#%24"><span class="hs-operator hs-var">$</span></a></span><span> </span><span class="annot"><span class="annottext">forall a. TcM a -&gt; TcM a
</span><a href="GHC.Tc.Utils.Monad.html#popErrCtxt"><span class="hs-identifier hs-var">popErrCtxt</span></a></span><span> </span><span class="annot"><span class="annottext">TcM a
</span><a href="#local-6989586621681386803"><span class="hs-identifier hs-var">thing_inside</span></a></span><span>
</span><span id="line-1445"></span><span>                               </span><span class="hs-comment">-- Remember to pop before doing thing_inside</span><span>
</span><span id="line-1446"></span><span>  </span><span class="hs-keyword">where</span><span>
</span><span id="line-1447"></span><span>   </span><span id="local-6989586621681386802"><span class="annot"><span class="annottext">worth_wrapping :: Pat p -&gt; Bool
</span><a href="#local-6989586621681386802"><span class="hs-identifier hs-var hs-var">worth_wrapping</span></a></span></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="Language.Haskell.Syntax.Pat.html#VarPat"><span class="hs-identifier hs-type">VarPat</span></a></span><span> </span><span class="hs-special">{</span><span class="hs-special">}</span><span class="hs-special">)</span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">Bool
</span><span class="hs-identifier hs-var">False</span></span><span>
</span><span id="line-1448"></span><span>   </span><span class="annot"><a href="#local-6989586621681386802"><span class="hs-identifier hs-var">worth_wrapping</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="Language.Haskell.Syntax.Pat.html#ParPat"><span class="hs-identifier hs-type">ParPat</span></a></span><span> </span><span class="hs-special">{</span><span class="hs-special">}</span><span class="hs-special">)</span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">Bool
</span><span class="hs-identifier hs-var">False</span></span><span>
</span><span id="line-1449"></span><span>   </span><span class="annot"><a href="#local-6989586621681386802"><span class="hs-identifier hs-var">worth_wrapping</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="Language.Haskell.Syntax.Pat.html#AsPat"><span class="hs-identifier hs-type">AsPat</span></a></span><span> </span><span class="hs-special">{</span><span class="hs-special">}</span><span class="hs-special">)</span><span>  </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">Bool
</span><span class="hs-identifier hs-var">False</span></span><span>
</span><span id="line-1450"></span><span>   </span><span class="annot"><a href="#local-6989586621681386802"><span class="hs-identifier hs-var">worth_wrapping</span></a></span><span> </span><span class="annot"><span class="annottext">Pat p
</span><span class="hs-identifier">_</span></span><span>           </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">Bool
</span><span class="hs-identifier hs-var">True</span></span><span>
</span><span id="line-1451"></span><span>   </span><span id="local-6989586621681386800"><span class="annot"><span class="annottext">msg :: SDoc
</span><a href="#local-6989586621681386800"><span class="hs-identifier hs-var hs-var">msg</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">SDoc -&gt; Int -&gt; SDoc -&gt; SDoc
</span><a href="GHC.Utils.Outputable.html#hang"><span class="hs-identifier hs-var">hang</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">String -&gt; SDoc
</span><a href="GHC.Utils.Outputable.html#text"><span class="hs-identifier hs-var">text</span></a></span><span> </span><span class="annot"><span class="annottext">String
</span><span class="hs-string">&quot;In the pattern:&quot;</span></span><span class="hs-special">)</span><span> </span><span class="annot"><span class="annottext">Int
</span><span class="hs-number">2</span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">forall a. Outputable a =&gt; a -&gt; SDoc
</span><a href="GHC.Utils.Outputable.html#ppr"><span class="hs-identifier hs-var">ppr</span></a></span><span> </span><span class="annot"><span class="annottext">Pat GhcRn
</span><a href="#local-6989586621681386805"><span class="hs-identifier hs-var">pat</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-1452"></span><span>
</span><span id="line-1453"></span><span class="hs-comment">-----------------------------------------------</span><span>
</span><span id="line-1454"></span><span>
</span><span id="line-1455"></span><span class="hs-comment">-- | Check that a pattern isn't a GADT, or doesn't have existential variables,</span><span>
</span><span id="line-1456"></span><span class="hs-comment">-- in a situation in which that is not permitted (inside a lazy pattern, or</span><span>
</span><span id="line-1457"></span><span class="hs-comment">-- in arrow notation).</span><span>
</span><span id="line-1458"></span><span class="annot"><a href="GHC.Tc.Gen.Pat.html#checkGADT"><span class="hs-identifier hs-type">checkGADT</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><a href="GHC.Core.ConLike.html#ConLike"><span class="hs-identifier hs-type">ConLike</span></a></span><span>
</span><span id="line-1459"></span><span>          </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-special">[</span><span class="annot"><a href="GHC.Types.Var.html#TyVar"><span class="hs-identifier hs-type">TyVar</span></a></span><span class="hs-special">]</span><span> </span><span class="hs-comment">-- ^ existentials</span><span>
</span><span id="line-1460"></span><span>          </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-special">[</span><span class="annot"><a href="GHC.Core.TyCo.Rep.html#Type"><span class="hs-identifier hs-type">Type</span></a></span><span class="hs-special">]</span><span>  </span><span class="hs-comment">-- ^ argument types</span><span>
</span><span id="line-1461"></span><span>          </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="GHC.Tc.Gen.Pat.html#PatEnv"><span class="hs-identifier hs-type">PatEnv</span></a></span><span>
</span><span id="line-1462"></span><span>          </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="GHC.Tc.Types.html#TcM"><span class="hs-identifier hs-type">TcM</span></a></span><span> </span><span class="hs-special">(</span><span class="hs-special">)</span><span>
</span><span id="line-1463"></span><span id="checkGADT"><span class="annot"><span class="annottext">checkGADT :: ConLike -&gt; [TyVar] -&gt; [TcType] -&gt; PatEnv -&gt; TcRn ()
</span><a href="GHC.Tc.Gen.Pat.html#checkGADT"><span class="hs-identifier hs-var hs-var">checkGADT</span></a></span></span><span> </span><span id="local-6989586621681386797"><span class="annot"><span class="annottext">ConLike
</span><a href="#local-6989586621681386797"><span class="hs-identifier hs-var">conlike</span></a></span></span><span> </span><span id="local-6989586621681386796"><span class="annot"><span class="annottext">[TyVar]
</span><a href="#local-6989586621681386796"><span class="hs-identifier hs-var">ex_tvs</span></a></span></span><span> </span><span id="local-6989586621681386795"><span class="annot"><span class="annottext">[TcType]
</span><a href="#local-6989586621681386795"><span class="hs-identifier hs-var">arg_tys</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-glyph">\</span><span class="hs-glyph">case</span><span>
</span><span id="line-1464"></span><span>  </span><span class="annot"><a href="GHC.Tc.Gen.Pat.html#PE"><span class="hs-identifier hs-type">PE</span></a></span><span> </span><span class="hs-special">{</span><span> </span><span class="annot"><span class="annottext">pe_ctxt :: PatEnv -&gt; PatCtxt
</span><a href="GHC.Tc.Gen.Pat.html#pe_ctxt"><span class="hs-identifier hs-var">pe_ctxt</span></a></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><a href="GHC.Tc.Gen.Pat.html#LetPat"><span class="hs-identifier hs-type">LetPat</span></a></span><span> </span><span class="hs-special">{</span><span class="hs-special">}</span><span> </span><span class="hs-special">}</span><span>
</span><span id="line-1465"></span><span>    </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="annottext">forall (m :: * -&gt; *) a. Monad m =&gt; a -&gt; m a
</span><a href="../../base-4.16.4.0/src/GHC-Base.html#return"><span class="hs-identifier hs-var">return</span></a></span><span> </span><span class="hs-special">(</span><span class="hs-special">)</span><span>
</span><span id="line-1466"></span><span>  </span><span class="annot"><a href="GHC.Tc.Gen.Pat.html#PE"><span class="hs-identifier hs-type">PE</span></a></span><span> </span><span class="hs-special">{</span><span> </span><span class="annot"><span class="annottext">pe_ctxt :: PatEnv -&gt; PatCtxt
</span><a href="GHC.Tc.Gen.Pat.html#pe_ctxt"><span class="hs-identifier hs-var">pe_ctxt</span></a></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><a href="GHC.Tc.Gen.Pat.html#LamPat"><span class="hs-identifier hs-type">LamPat</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="Language.Haskell.Syntax.Expr.html#ArrowMatchCtxt"><span class="hs-identifier hs-type">ArrowMatchCtxt</span></a></span><span> </span><span class="hs-special">{</span><span class="hs-special">}</span><span class="hs-special">)</span><span> </span><span class="hs-special">}</span><span>
</span><span id="line-1467"></span><span>    </span><span class="hs-glyph">|</span><span> </span><span class="annot"><span class="annottext">Bool -&gt; Bool
</span><span class="hs-identifier hs-var">not</span></span><span> </span><span class="annot"><span class="annottext">forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><a href="../../base-4.16.4.0/src/GHC-Base.html#%24"><span class="hs-operator hs-var">$</span></a></span><span> </span><span class="annot"><span class="annottext">ConLike -&gt; Bool
</span><a href="GHC.Core.ConLike.html#isVanillaConLike"><span class="hs-identifier hs-var">isVanillaConLike</span></a></span><span> </span><span class="annot"><span class="annottext">ConLike
</span><a href="#local-6989586621681386797"><span class="hs-identifier hs-var">conlike</span></a></span><span>
</span><span id="line-1468"></span><span>    </span><span class="hs-comment">-- See Note [Arrows and patterns]</span><span>
</span><span id="line-1469"></span><span>    </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="annottext">forall a. SDoc -&gt; TcRn a
</span><a href="GHC.Tc.Utils.Monad.html#failWithTc"><span class="hs-identifier hs-var">failWithTc</span></a></span><span> </span><span class="annot"><span class="annottext">SDoc
</span><a href="GHC.Tc.Gen.Pat.html#existentialProcPat"><span class="hs-identifier hs-var">existentialProcPat</span></a></span><span>
</span><span id="line-1470"></span><span>  </span><span class="annot"><a href="GHC.Tc.Gen.Pat.html#PE"><span class="hs-identifier hs-type">PE</span></a></span><span> </span><span class="hs-special">{</span><span> </span><span class="annot"><span class="annottext">pe_lazy :: PatEnv -&gt; Bool
</span><a href="GHC.Tc.Gen.Pat.html#pe_lazy"><span class="hs-identifier hs-var">pe_lazy</span></a></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">Bool
</span><span class="hs-identifier hs-var">True</span></span><span> </span><span class="hs-special">}</span><span>
</span><span id="line-1471"></span><span>    </span><span class="hs-glyph">|</span><span> </span><span class="annot"><span class="annottext">Bool
</span><a href="#local-6989586621681386790"><span class="hs-identifier hs-var">has_existentials</span></a></span><span>
</span><span id="line-1472"></span><span>    </span><span class="hs-comment">-- See Note [Existential check]</span><span>
</span><span id="line-1473"></span><span>    </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="annottext">forall a. SDoc -&gt; TcRn a
</span><a href="GHC.Tc.Utils.Monad.html#failWithTc"><span class="hs-identifier hs-var">failWithTc</span></a></span><span> </span><span class="annot"><span class="annottext">SDoc
</span><a href="GHC.Tc.Gen.Pat.html#existentialLazyPat"><span class="hs-identifier hs-var">existentialLazyPat</span></a></span><span>
</span><span id="line-1474"></span><span>  </span><span class="annot"><span class="annottext">PatEnv
</span><span class="hs-identifier">_</span></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="annottext">forall (m :: * -&gt; *) a. Monad m =&gt; a -&gt; m a
</span><a href="../../base-4.16.4.0/src/GHC-Base.html#return"><span class="hs-identifier hs-var">return</span></a></span><span> </span><span class="hs-special">(</span><span class="hs-special">)</span><span>
</span><span id="line-1475"></span><span>  </span><span class="hs-keyword">where</span><span>
</span><span id="line-1476"></span><span>    </span><span class="annot"><a href="#local-6989586621681386790"><span class="hs-identifier hs-type">has_existentials</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><span class="hs-identifier hs-type">Bool</span></span><span>
</span><span id="line-1477"></span><span>    </span><span id="local-6989586621681386790"><span class="annot"><span class="annottext">has_existentials :: Bool
</span><a href="#local-6989586621681386790"><span class="hs-identifier hs-var hs-var">has_existentials</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">forall (t :: * -&gt; *) a. Foldable t =&gt; (a -&gt; Bool) -&gt; t a -&gt; Bool
</span><a href="../../base-4.16.4.0/src/Data-Foldable.html#any"><span class="hs-identifier hs-var">any</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">TyVar -&gt; VarSet -&gt; Bool
</span><a href="GHC.Types.Var.Set.html#elemVarSet"><span class="hs-operator hs-var">`elemVarSet`</span></a></span><span> </span><span class="annot"><span class="annottext">[TcType] -&gt; VarSet
</span><a href="GHC.Core.TyCo.FVs.html#tyCoVarsOfTypes"><span class="hs-identifier hs-var">tyCoVarsOfTypes</span></a></span><span> </span><span class="annot"><span class="annottext">[TcType]
</span><a href="#local-6989586621681386795"><span class="hs-identifier hs-var">arg_tys</span></a></span><span class="hs-special">)</span><span> </span><span class="annot"><span class="annottext">[TyVar]
</span><a href="#local-6989586621681386796"><span class="hs-identifier hs-var">ex_tvs</span></a></span><span>
</span><span id="line-1478"></span><span>
</span><span id="line-1479"></span><span class="annot"><a href="GHC.Tc.Gen.Pat.html#existentialLazyPat"><span class="hs-identifier hs-type">existentialLazyPat</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><a href="GHC.Utils.Outputable.html#SDoc"><span class="hs-identifier hs-type">SDoc</span></a></span><span>
</span><span id="line-1480"></span><span id="existentialLazyPat"><span class="annot"><span class="annottext">existentialLazyPat :: SDoc
</span><a href="GHC.Tc.Gen.Pat.html#existentialLazyPat"><span class="hs-identifier hs-var hs-var">existentialLazyPat</span></a></span></span><span>
</span><span id="line-1481"></span><span>  </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">SDoc -&gt; Int -&gt; SDoc -&gt; SDoc
</span><a href="GHC.Utils.Outputable.html#hang"><span class="hs-identifier hs-var">hang</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">String -&gt; SDoc
</span><a href="GHC.Utils.Outputable.html#text"><span class="hs-identifier hs-var">text</span></a></span><span> </span><span class="annot"><span class="annottext">String
</span><span class="hs-string">&quot;An existential or GADT data constructor cannot be used&quot;</span></span><span class="hs-special">)</span><span>
</span><span id="line-1482"></span><span>       </span><span class="annot"><span class="annottext">Int
</span><span class="hs-number">2</span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">String -&gt; SDoc
</span><a href="GHC.Utils.Outputable.html#text"><span class="hs-identifier hs-var">text</span></a></span><span> </span><span class="annot"><span class="annottext">String
</span><span class="hs-string">&quot;inside a lazy (~) pattern&quot;</span></span><span class="hs-special">)</span><span>
</span><span id="line-1483"></span><span>
</span><span id="line-1484"></span><span class="annot"><a href="GHC.Tc.Gen.Pat.html#existentialProcPat"><span class="hs-identifier hs-type">existentialProcPat</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><a href="GHC.Utils.Outputable.html#SDoc"><span class="hs-identifier hs-type">SDoc</span></a></span><span>
</span><span id="line-1485"></span><span id="existentialProcPat"><span class="annot"><span class="annottext">existentialProcPat :: SDoc
</span><a href="GHC.Tc.Gen.Pat.html#existentialProcPat"><span class="hs-identifier hs-var hs-var">existentialProcPat</span></a></span></span><span>
</span><span id="line-1486"></span><span>  </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">String -&gt; SDoc
</span><a href="GHC.Utils.Outputable.html#text"><span class="hs-identifier hs-var">text</span></a></span><span> </span><span class="annot"><span class="annottext">String
</span><span class="hs-string">&quot;Proc patterns cannot use existential or GADT data constructors&quot;</span></span><span>
</span><span id="line-1487"></span><span>
</span><span id="line-1488"></span><span class="annot"><a href="GHC.Tc.Gen.Pat.html#badFieldCon"><span class="hs-identifier hs-type">badFieldCon</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><a href="GHC.Core.ConLike.html#ConLike"><span class="hs-identifier hs-type">ConLike</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="GHC.Types.FieldLabel.html#FieldLabelString"><span class="hs-identifier hs-type">FieldLabelString</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="GHC.Utils.Outputable.html#SDoc"><span class="hs-identifier hs-type">SDoc</span></a></span><span>
</span><span id="line-1489"></span><span id="badFieldCon"><span class="annot"><span class="annottext">badFieldCon :: ConLike -&gt; FieldLabelString -&gt; SDoc
</span><a href="GHC.Tc.Gen.Pat.html#badFieldCon"><span class="hs-identifier hs-var hs-var">badFieldCon</span></a></span></span><span> </span><span id="local-6989586621681386786"><span class="annot"><span class="annottext">ConLike
</span><a href="#local-6989586621681386786"><span class="hs-identifier hs-var">con</span></a></span></span><span> </span><span id="local-6989586621681386785"><span class="annot"><span class="annottext">FieldLabelString
</span><a href="#local-6989586621681386785"><span class="hs-identifier hs-var">field</span></a></span></span><span>
</span><span id="line-1490"></span><span>  </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">[SDoc] -&gt; SDoc
</span><a href="GHC.Utils.Outputable.html#hsep"><span class="hs-identifier hs-var">hsep</span></a></span><span> </span><span class="hs-special">[</span><span class="annot"><span class="annottext">String -&gt; SDoc
</span><a href="GHC.Utils.Outputable.html#text"><span class="hs-identifier hs-var">text</span></a></span><span> </span><span class="annot"><span class="annottext">String
</span><span class="hs-string">&quot;Constructor&quot;</span></span><span> </span><span class="annot"><span class="annottext">SDoc -&gt; SDoc -&gt; SDoc
</span><a href="GHC.Utils.Outputable.html#%3C%2B%3E"><span class="hs-operator hs-var">&lt;+&gt;</span></a></span><span> </span><span class="annot"><span class="annottext">SDoc -&gt; SDoc
</span><a href="GHC.Utils.Outputable.html#quotes"><span class="hs-identifier hs-var">quotes</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">forall a. Outputable a =&gt; a -&gt; SDoc
</span><a href="GHC.Utils.Outputable.html#ppr"><span class="hs-identifier hs-var">ppr</span></a></span><span> </span><span class="annot"><span class="annottext">ConLike
</span><a href="#local-6989586621681386786"><span class="hs-identifier hs-var">con</span></a></span><span class="hs-special">)</span><span class="hs-special">,</span><span>
</span><span id="line-1491"></span><span>          </span><span class="annot"><span class="annottext">String -&gt; SDoc
</span><a href="GHC.Utils.Outputable.html#text"><span class="hs-identifier hs-var">text</span></a></span><span> </span><span class="annot"><span class="annottext">String
</span><span class="hs-string">&quot;does not have field&quot;</span></span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">SDoc -&gt; SDoc
</span><a href="GHC.Utils.Outputable.html#quotes"><span class="hs-identifier hs-var">quotes</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">forall a. Outputable a =&gt; a -&gt; SDoc
</span><a href="GHC.Utils.Outputable.html#ppr"><span class="hs-identifier hs-var">ppr</span></a></span><span> </span><span class="annot"><span class="annottext">FieldLabelString
</span><a href="#local-6989586621681386785"><span class="hs-identifier hs-var">field</span></a></span><span class="hs-special">)</span><span class="hs-special">]</span><span>
</span><span id="line-1492"></span><span>
</span><span id="line-1493"></span><span class="annot"><a href="GHC.Tc.Gen.Pat.html#polyPatSig"><span class="hs-identifier hs-type">polyPatSig</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><a href="GHC.Tc.Utils.TcType.html#TcType"><span class="hs-identifier hs-type">TcType</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="GHC.Utils.Outputable.html#SDoc"><span class="hs-identifier hs-type">SDoc</span></a></span><span>
</span><span id="line-1494"></span><span id="polyPatSig"><span class="annot"><span class="annottext">polyPatSig :: TcType -&gt; SDoc
</span><a href="GHC.Tc.Gen.Pat.html#polyPatSig"><span class="hs-identifier hs-var hs-var">polyPatSig</span></a></span></span><span> </span><span id="local-6989586621681386783"><span class="annot"><span class="annottext">TcType
</span><a href="#local-6989586621681386783"><span class="hs-identifier hs-var">sig_ty</span></a></span></span><span>
</span><span id="line-1495"></span><span>  </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">SDoc -&gt; Int -&gt; SDoc -&gt; SDoc
</span><a href="GHC.Utils.Outputable.html#hang"><span class="hs-identifier hs-var">hang</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">String -&gt; SDoc
</span><a href="GHC.Utils.Outputable.html#text"><span class="hs-identifier hs-var">text</span></a></span><span> </span><span class="annot"><span class="annottext">String
</span><span class="hs-string">&quot;Illegal polymorphic type signature in pattern:&quot;</span></span><span class="hs-special">)</span><span>
</span><span id="line-1496"></span><span>       </span><span class="annot"><span class="annottext">Int
</span><span class="hs-number">2</span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">forall a. Outputable a =&gt; a -&gt; SDoc
</span><a href="GHC.Utils.Outputable.html#ppr"><span class="hs-identifier hs-var">ppr</span></a></span><span> </span><span class="annot"><span class="annottext">TcType
</span><a href="#local-6989586621681386783"><span class="hs-identifier hs-var">sig_ty</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-1497"></span></pre></body></html>