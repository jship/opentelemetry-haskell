<?xml version="1.0" encoding="UTF-8"?>
<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Strict//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-strict.dtd">
<html>
<head>
<!-- Generated by HsColour, http://code.haskell.org/~malcolm/hscolour/ -->
<title>GHC/HsToCore/Types.hs</title>
<link type='text/css' rel='stylesheet' href='hscolour.css' />
</head>
<body>
<pre><a name="line-1"></a><span class='hs-comment'>{-# LANGUAGE TypeFamilies, UndecidableInstances #-}</span>
<a name="line-2"></a>
<a name="line-3"></a><span class='hs-comment'>-- | Various types used during desugaring.</span>
<a name="line-4"></a><span class='hs-keyword'>module</span> <span class='hs-conid'>GHC.HsToCore.Types</span> <span class='hs-layout'>(</span>
<a name="line-5"></a>        <span class='hs-conid'>DsM</span><span class='hs-layout'>,</span> <span class='hs-conid'>DsLclEnv</span><span class='hs-layout'>(</span><span class='hs-keyglyph'>..</span><span class='hs-layout'>)</span><span class='hs-layout'>,</span> <span class='hs-conid'>DsGblEnv</span><span class='hs-layout'>(</span><span class='hs-keyglyph'>..</span><span class='hs-layout'>)</span><span class='hs-layout'>,</span>
<a name="line-6"></a>        <span class='hs-conid'>DsMetaEnv</span><span class='hs-layout'>,</span> <span class='hs-conid'>DsMetaVal</span><span class='hs-layout'>(</span><span class='hs-keyglyph'>..</span><span class='hs-layout'>)</span><span class='hs-layout'>,</span> <span class='hs-conid'>CompleteMatches</span>
<a name="line-7"></a>    <span class='hs-layout'>)</span> <span class='hs-keyword'>where</span>
<a name="line-8"></a>
<a name="line-9"></a><span class='hs-keyword'>import</span> <span class='hs-conid'>Data.IORef</span>
<a name="line-10"></a>
<a name="line-11"></a><span class='hs-keyword'>import</span> <span class='hs-conid'>GHC.Types.CostCentre.State</span>
<a name="line-12"></a><span class='hs-keyword'>import</span> <span class='hs-conid'>GHC.Types.Name.Env</span>
<a name="line-13"></a><span class='hs-keyword'>import</span> <span class='hs-conid'>GHC.Types.SrcLoc</span>
<a name="line-14"></a><span class='hs-keyword'>import</span> <span class='hs-conid'>GHC.Types.Var</span>
<a name="line-15"></a><span class='hs-keyword'>import</span> <span class='hs-conid'>GHC.Types.Name.Reader</span> <span class='hs-layout'>(</span><span class='hs-conid'>GlobalRdrEnv</span><span class='hs-layout'>)</span>
<a name="line-16"></a><span class='hs-keyword'>import</span> <span class='hs-conid'>GHC.Hs</span> <span class='hs-layout'>(</span><span class='hs-conid'>LForeignDecl</span><span class='hs-layout'>,</span> <span class='hs-conid'>HsExpr</span><span class='hs-layout'>,</span> <span class='hs-conid'>GhcTc</span><span class='hs-layout'>)</span>
<a name="line-17"></a><span class='hs-keyword'>import</span> <span class='hs-conid'>GHC.Tc.Types</span> <span class='hs-layout'>(</span><span class='hs-conid'>TcRnIf</span><span class='hs-layout'>,</span> <span class='hs-conid'>IfGblEnv</span><span class='hs-layout'>,</span> <span class='hs-conid'>IfLclEnv</span><span class='hs-layout'>,</span> <span class='hs-conid'>CompleteMatches</span><span class='hs-layout'>)</span>
<a name="line-18"></a><span class='hs-keyword'>import</span> <span class='hs-conid'>GHC.HsToCore.Pmc.Types</span> <span class='hs-layout'>(</span><span class='hs-conid'>Nablas</span><span class='hs-layout'>)</span>
<a name="line-19"></a><span class='hs-keyword'>import</span> <span class='hs-conid'>GHC.Core</span> <span class='hs-layout'>(</span><span class='hs-conid'>CoreExpr</span><span class='hs-layout'>)</span>
<a name="line-20"></a><span class='hs-keyword'>import</span> <span class='hs-conid'>GHC.Core.FamInstEnv</span>
<a name="line-21"></a><span class='hs-keyword'>import</span> <span class='hs-conid'>GHC.Utils.Error</span>
<a name="line-22"></a><span class='hs-keyword'>import</span> <span class='hs-conid'>GHC.Utils.Outputable</span> <span class='hs-keyword'>as</span> <span class='hs-conid'>Outputable</span>
<a name="line-23"></a><span class='hs-keyword'>import</span> <span class='hs-conid'>GHC.Unit.Module</span>
<a name="line-24"></a><span class='hs-keyword'>import</span> <span class='hs-conid'>GHC.Driver.Hooks</span> <span class='hs-layout'>(</span><span class='hs-conid'>DsForeignsHook</span><span class='hs-layout'>)</span>
<a name="line-25"></a><span class='hs-keyword'>import</span> <span class='hs-conid'>GHC.Data.OrdList</span> <span class='hs-layout'>(</span><span class='hs-conid'>OrdList</span><span class='hs-layout'>)</span>
<a name="line-26"></a><span class='hs-keyword'>import</span> <span class='hs-conid'>GHC.Types.ForeignStubs</span> <span class='hs-layout'>(</span><span class='hs-conid'>ForeignStubs</span><span class='hs-layout'>)</span>
<a name="line-27"></a>
<a name="line-28"></a><span class='hs-comment'>{-
<a name="line-29"></a>************************************************************************
<a name="line-30"></a>*                                                                      *
<a name="line-31"></a>                Desugarer monad
<a name="line-32"></a>*                                                                      *
<a name="line-33"></a>************************************************************************
<a name="line-34"></a>
<a name="line-35"></a>Now the mondo monad magic (yes, @DsM@ is a silly name)---carry around
<a name="line-36"></a>a @UniqueSupply@ and some annotations, which
<a name="line-37"></a>presumably include source-file location information:
<a name="line-38"></a>-}</span>
<a name="line-39"></a>
<a name="line-40"></a><a name="DsGblEnv"></a><span class='hs-comment'>-- | Global read-only context and state of the desugarer.</span>
<a name="line-41"></a><a name="DsGblEnv"></a><span class='hs-comment'>-- The statefulness is implemented through 'IORef's.</span>
<a name="line-42"></a><a name="DsGblEnv"></a><span class='hs-keyword'>data</span> <span class='hs-conid'>DsGblEnv</span>
<a name="line-43"></a>  <span class='hs-keyglyph'>=</span> <span class='hs-conid'>DsGblEnv</span>
<a name="line-44"></a>  <span class='hs-layout'>{</span> <span class='hs-varid'>ds_mod</span>          <span class='hs-keyglyph'>::</span> <span class='hs-conid'>Module</span>             <span class='hs-comment'>-- For SCC profiling</span>
<a name="line-45"></a>  <span class='hs-layout'>,</span> <span class='hs-varid'>ds_fam_inst_env</span> <span class='hs-keyglyph'>::</span> <span class='hs-conid'>FamInstEnv</span>         <span class='hs-comment'>-- Like tcg_fam_inst_env</span>
<a name="line-46"></a>  <span class='hs-layout'>,</span> <span class='hs-varid'>ds_gbl_rdr_env</span>  <span class='hs-keyglyph'>::</span> <span class='hs-conid'>GlobalRdrEnv</span>       <span class='hs-comment'>-- needed *only* to know what newtype</span>
<a name="line-47"></a>                                          <span class='hs-comment'>-- constructors are in scope during</span>
<a name="line-48"></a>                                          <span class='hs-comment'>-- pattern-match satisfiability checking</span>
<a name="line-49"></a>  <span class='hs-layout'>,</span> <span class='hs-varid'>ds_unqual</span>  <span class='hs-keyglyph'>::</span> <span class='hs-conid'>PrintUnqualified</span>
<a name="line-50"></a>  <span class='hs-layout'>,</span> <span class='hs-varid'>ds_msgs</span>    <span class='hs-keyglyph'>::</span> <span class='hs-conid'>IORef</span> <span class='hs-layout'>(</span><span class='hs-conid'>Messages</span> <span class='hs-conid'>DecoratedSDoc</span><span class='hs-layout'>)</span> <span class='hs-comment'>-- Warning messages</span>
<a name="line-51"></a>  <span class='hs-layout'>,</span> <span class='hs-varid'>ds_if_env</span>  <span class='hs-keyglyph'>::</span> <span class='hs-layout'>(</span><span class='hs-conid'>IfGblEnv</span><span class='hs-layout'>,</span> <span class='hs-conid'>IfLclEnv</span><span class='hs-layout'>)</span>    <span class='hs-comment'>-- Used for looking up global,</span>
<a name="line-52"></a>                                          <span class='hs-comment'>-- possibly-imported things</span>
<a name="line-53"></a>  <span class='hs-layout'>,</span> <span class='hs-varid'>ds_complete_matches</span> <span class='hs-keyglyph'>::</span> <span class='hs-conid'>CompleteMatches</span>
<a name="line-54"></a>     <span class='hs-comment'>-- Additional complete pattern matches</span>
<a name="line-55"></a>  <span class='hs-layout'>,</span> <span class='hs-varid'>ds_cc_st</span>   <span class='hs-keyglyph'>::</span> <span class='hs-conid'>IORef</span> <span class='hs-conid'>CostCentreState</span>
<a name="line-56"></a>     <span class='hs-comment'>-- Tracking indices for cost centre annotations</span>
<a name="line-57"></a>  <span class='hs-layout'>}</span>
<a name="line-58"></a>
<a name="line-59"></a><a name="instance%20ContainsModule%20DsGblEnv"></a><span class='hs-keyword'>instance</span> <span class='hs-conid'>ContainsModule</span> <span class='hs-conid'>DsGblEnv</span> <span class='hs-keyword'>where</span>
<a name="line-60"></a>  <span class='hs-varid'>extractModule</span> <span class='hs-keyglyph'>=</span> <span class='hs-varid'>ds_mod</span>
<a name="line-61"></a>
<a name="line-62"></a><a name="DsLclEnv"></a><span class='hs-comment'>-- | Local state of the desugarer, extended as we lexically descend</span>
<a name="line-63"></a><a name="DsLclEnv"></a><span class='hs-keyword'>data</span> <span class='hs-conid'>DsLclEnv</span>
<a name="line-64"></a>  <span class='hs-keyglyph'>=</span> <span class='hs-conid'>DsLclEnv</span>
<a name="line-65"></a>  <span class='hs-layout'>{</span> <span class='hs-varid'>dsl_meta</span>    <span class='hs-keyglyph'>::</span> <span class='hs-conid'>DsMetaEnv</span>   <span class='hs-comment'>-- ^ Template Haskell bindings</span>
<a name="line-66"></a>  <span class='hs-layout'>,</span> <span class='hs-varid'>dsl_loc</span>     <span class='hs-keyglyph'>::</span> <span class='hs-conid'>RealSrcSpan</span> <span class='hs-comment'>-- ^ To put in pattern-matching error msgs</span>
<a name="line-67"></a>  <span class='hs-layout'>,</span> <span class='hs-varid'>dsl_nablas</span>  <span class='hs-keyglyph'>::</span> <span class='hs-conid'>Nablas</span>
<a name="line-68"></a>  <span class='hs-comment'>-- ^ See Note [Note [Long-distance information] in "GHC.HsToCore.Pmc".</span>
<a name="line-69"></a>  <span class='hs-comment'>-- The set of reaching values Nablas is augmented as we walk inwards, refined</span>
<a name="line-70"></a>  <span class='hs-comment'>-- through each pattern match in turn</span>
<a name="line-71"></a>  <span class='hs-layout'>}</span>
<a name="line-72"></a>
<a name="line-73"></a><a name="DsMetaEnv"></a><span class='hs-comment'>-- Inside [| |] brackets, the desugarer looks</span>
<a name="line-74"></a><a name="DsMetaEnv"></a><span class='hs-comment'>-- up variables in the DsMetaEnv</span>
<a name="line-75"></a><a name="DsMetaEnv"></a><span class='hs-keyword'>type</span> <span class='hs-conid'>DsMetaEnv</span> <span class='hs-keyglyph'>=</span> <span class='hs-conid'>NameEnv</span> <span class='hs-conid'>DsMetaVal</span>
<a name="line-76"></a>
<a name="line-77"></a><a name="DsMetaVal"></a><span class='hs-keyword'>data</span> <span class='hs-conid'>DsMetaVal</span>
<a name="line-78"></a>  <span class='hs-keyglyph'>=</span> <span class='hs-conid'>DsBound</span> <span class='hs-conid'>Id</span>         <span class='hs-comment'>-- Bound by a pattern inside the [| |].</span>
<a name="line-79"></a>                       <span class='hs-comment'>-- Will be dynamically alpha renamed.</span>
<a name="line-80"></a>                       <span class='hs-comment'>-- The Id has type THSyntax.Var</span>
<a name="line-81"></a>
<a name="line-82"></a>  <span class='hs-keyglyph'>|</span> <span class='hs-conid'>DsSplice</span> <span class='hs-layout'>(</span><span class='hs-conid'>HsExpr</span> <span class='hs-conid'>GhcTc</span><span class='hs-layout'>)</span> <span class='hs-comment'>-- These bindings are introduced by</span>
<a name="line-83"></a>                            <span class='hs-comment'>-- the PendingSplices on a HsBracketOut</span>
<a name="line-84"></a>
<a name="line-85"></a><a name="DsM"></a><span class='hs-comment'>-- | Desugaring monad. See also 'TcM'.</span>
<a name="line-86"></a><a name="DsM"></a><span class='hs-keyword'>type</span> <span class='hs-conid'>DsM</span> <span class='hs-keyglyph'>=</span> <span class='hs-conid'>TcRnIf</span> <span class='hs-conid'>DsGblEnv</span> <span class='hs-conid'>DsLclEnv</span>
<a name="line-87"></a>
<a name="line-88"></a><span class='hs-comment'>-- See Note [The Decoupling Abstract Data Hack]</span>
<a name="line-89"></a><span class='hs-keyword'>type</span> <span class='hs-keyword'>instance</span> <span class='hs-conid'>DsForeignsHook</span> <span class='hs-keyglyph'>=</span> <span class='hs-keyglyph'>[</span><span class='hs-conid'>LForeignDecl</span> <span class='hs-conid'>GhcTc</span><span class='hs-keyglyph'>]</span> <span class='hs-keyglyph'>-&gt;</span> <span class='hs-conid'>DsM</span> <span class='hs-layout'>(</span><span class='hs-conid'>ForeignStubs</span><span class='hs-layout'>,</span> <span class='hs-conid'>OrdList</span> <span class='hs-layout'>(</span><span class='hs-conid'>Id</span><span class='hs-layout'>,</span> <span class='hs-conid'>CoreExpr</span><span class='hs-layout'>)</span><span class='hs-layout'>)</span>
</pre></body>
</html>
