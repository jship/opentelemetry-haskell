<?xml version="1.0" encoding="UTF-8"?>
<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Strict//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-strict.dtd">
<html>
<head>
<!-- Generated by HsColour, http://code.haskell.org/~malcolm/hscolour/ -->
<title>GHC/Parser/Annotation.hs</title>
<link type='text/css' rel='stylesheet' href='hscolour.css' />
</head>
<body>
<pre><a name="line-1"></a><span class='hs-comment'>{-# LANGUAGE FlexibleContexts #-}</span>
<a name="line-2"></a><span class='hs-comment'>{-# LANGUAGE DeriveDataTypeable #-}</span>
<a name="line-3"></a><span class='hs-comment'>{-# LANGUAGE DeriveFunctor #-}</span>
<a name="line-4"></a><span class='hs-comment'>{-# LANGUAGE FlexibleInstances #-}</span>
<a name="line-5"></a>
<a name="line-6"></a><span class='hs-keyword'>module</span> <span class='hs-conid'>GHC.Parser.Annotation</span> <span class='hs-layout'>(</span>
<a name="line-7"></a>  <span class='hs-comment'>-- * Core Exact Print Annotation types</span>
<a name="line-8"></a>  <span class='hs-conid'>AnnKeywordId</span><span class='hs-layout'>(</span><span class='hs-keyglyph'>..</span><span class='hs-layout'>)</span><span class='hs-layout'>,</span>
<a name="line-9"></a>  <span class='hs-conid'>EpaComment</span><span class='hs-layout'>(</span><span class='hs-keyglyph'>..</span><span class='hs-layout'>)</span><span class='hs-layout'>,</span> <span class='hs-conid'>EpaCommentTok</span><span class='hs-layout'>(</span><span class='hs-keyglyph'>..</span><span class='hs-layout'>)</span><span class='hs-layout'>,</span>
<a name="line-10"></a>  <span class='hs-conid'>IsUnicodeSyntax</span><span class='hs-layout'>(</span><span class='hs-keyglyph'>..</span><span class='hs-layout'>)</span><span class='hs-layout'>,</span>
<a name="line-11"></a>  <span class='hs-varid'>unicodeAnn</span><span class='hs-layout'>,</span>
<a name="line-12"></a>  <span class='hs-conid'>HasE</span><span class='hs-layout'>(</span><span class='hs-keyglyph'>..</span><span class='hs-layout'>)</span><span class='hs-layout'>,</span>
<a name="line-13"></a>
<a name="line-14"></a>  <span class='hs-comment'>-- * In-tree Exact Print Annotations</span>
<a name="line-15"></a>  <span class='hs-conid'>AddEpAnn</span><span class='hs-layout'>(</span><span class='hs-keyglyph'>..</span><span class='hs-layout'>)</span><span class='hs-layout'>,</span>
<a name="line-16"></a>  <span class='hs-conid'>EpaLocation</span><span class='hs-layout'>(</span><span class='hs-keyglyph'>..</span><span class='hs-layout'>)</span><span class='hs-layout'>,</span> <span class='hs-varid'>epaLocationRealSrcSpan</span><span class='hs-layout'>,</span> <span class='hs-varid'>epaLocationFromSrcAnn</span><span class='hs-layout'>,</span>
<a name="line-17"></a>  <span class='hs-conid'>DeltaPos</span><span class='hs-layout'>(</span><span class='hs-keyglyph'>..</span><span class='hs-layout'>)</span><span class='hs-layout'>,</span> <span class='hs-varid'>deltaPos</span><span class='hs-layout'>,</span> <span class='hs-varid'>getDeltaLine</span><span class='hs-layout'>,</span>
<a name="line-18"></a>
<a name="line-19"></a>  <span class='hs-conid'>EpAnn</span><span class='hs-layout'>(</span><span class='hs-keyglyph'>..</span><span class='hs-layout'>)</span><span class='hs-layout'>,</span> <span class='hs-conid'>Anchor</span><span class='hs-layout'>(</span><span class='hs-keyglyph'>..</span><span class='hs-layout'>)</span><span class='hs-layout'>,</span> <span class='hs-conid'>AnchorOperation</span><span class='hs-layout'>(</span><span class='hs-keyglyph'>..</span><span class='hs-layout'>)</span><span class='hs-layout'>,</span>
<a name="line-20"></a>  <span class='hs-varid'>spanAsAnchor</span><span class='hs-layout'>,</span> <span class='hs-varid'>realSpanAsAnchor</span><span class='hs-layout'>,</span>
<a name="line-21"></a>  <span class='hs-varid'>noAnn</span><span class='hs-layout'>,</span>
<a name="line-22"></a>
<a name="line-23"></a>  <span class='hs-comment'>-- ** Comments in Annotations</span>
<a name="line-24"></a>
<a name="line-25"></a>  <span class='hs-conid'>EpAnnComments</span><span class='hs-layout'>(</span><span class='hs-keyglyph'>..</span><span class='hs-layout'>)</span><span class='hs-layout'>,</span> <span class='hs-conid'>LEpaComment</span><span class='hs-layout'>,</span> <span class='hs-varid'>emptyComments</span><span class='hs-layout'>,</span>
<a name="line-26"></a>  <span class='hs-varid'>getFollowingComments</span><span class='hs-layout'>,</span> <span class='hs-varid'>setFollowingComments</span><span class='hs-layout'>,</span> <span class='hs-varid'>setPriorComments</span><span class='hs-layout'>,</span>
<a name="line-27"></a>  <span class='hs-conid'>EpAnnCO</span><span class='hs-layout'>,</span>
<a name="line-28"></a>
<a name="line-29"></a>  <span class='hs-comment'>-- ** Annotations in 'GenLocated'</span>
<a name="line-30"></a>  <span class='hs-conid'>LocatedA</span><span class='hs-layout'>,</span> <span class='hs-conid'>LocatedL</span><span class='hs-layout'>,</span> <span class='hs-conid'>LocatedC</span><span class='hs-layout'>,</span> <span class='hs-conid'>LocatedN</span><span class='hs-layout'>,</span> <span class='hs-conid'>LocatedAn</span><span class='hs-layout'>,</span> <span class='hs-conid'>LocatedP</span><span class='hs-layout'>,</span>
<a name="line-31"></a>  <span class='hs-conid'>SrcSpanAnnA</span><span class='hs-layout'>,</span> <span class='hs-conid'>SrcSpanAnnL</span><span class='hs-layout'>,</span> <span class='hs-conid'>SrcSpanAnnP</span><span class='hs-layout'>,</span> <span class='hs-conid'>SrcSpanAnnC</span><span class='hs-layout'>,</span> <span class='hs-conid'>SrcSpanAnnN</span><span class='hs-layout'>,</span>
<a name="line-32"></a>  <span class='hs-conid'>SrcSpanAnn'</span><span class='hs-layout'>(</span><span class='hs-keyglyph'>..</span><span class='hs-layout'>)</span><span class='hs-layout'>,</span> <span class='hs-conid'>SrcAnn</span><span class='hs-layout'>,</span>
<a name="line-33"></a>
<a name="line-34"></a>  <span class='hs-comment'>-- ** Annotation data types used in 'GenLocated'</span>
<a name="line-35"></a>
<a name="line-36"></a>  <span class='hs-conid'>AnnListItem</span><span class='hs-layout'>(</span><span class='hs-keyglyph'>..</span><span class='hs-layout'>)</span><span class='hs-layout'>,</span> <span class='hs-conid'>AnnList</span><span class='hs-layout'>(</span><span class='hs-keyglyph'>..</span><span class='hs-layout'>)</span><span class='hs-layout'>,</span>
<a name="line-37"></a>  <span class='hs-conid'>AnnParen</span><span class='hs-layout'>(</span><span class='hs-keyglyph'>..</span><span class='hs-layout'>)</span><span class='hs-layout'>,</span> <span class='hs-conid'>ParenType</span><span class='hs-layout'>(</span><span class='hs-keyglyph'>..</span><span class='hs-layout'>)</span><span class='hs-layout'>,</span> <span class='hs-varid'>parenTypeKws</span><span class='hs-layout'>,</span>
<a name="line-38"></a>  <span class='hs-conid'>AnnPragma</span><span class='hs-layout'>(</span><span class='hs-keyglyph'>..</span><span class='hs-layout'>)</span><span class='hs-layout'>,</span>
<a name="line-39"></a>  <span class='hs-conid'>AnnContext</span><span class='hs-layout'>(</span><span class='hs-keyglyph'>..</span><span class='hs-layout'>)</span><span class='hs-layout'>,</span>
<a name="line-40"></a>  <span class='hs-conid'>NameAnn</span><span class='hs-layout'>(</span><span class='hs-keyglyph'>..</span><span class='hs-layout'>)</span><span class='hs-layout'>,</span> <span class='hs-conid'>NameAdornment</span><span class='hs-layout'>(</span><span class='hs-keyglyph'>..</span><span class='hs-layout'>)</span><span class='hs-layout'>,</span>
<a name="line-41"></a>  <span class='hs-conid'>NoEpAnns</span><span class='hs-layout'>(</span><span class='hs-keyglyph'>..</span><span class='hs-layout'>)</span><span class='hs-layout'>,</span>
<a name="line-42"></a>  <span class='hs-conid'>AnnSortKey</span><span class='hs-layout'>(</span><span class='hs-keyglyph'>..</span><span class='hs-layout'>)</span><span class='hs-layout'>,</span>
<a name="line-43"></a>
<a name="line-44"></a>  <span class='hs-comment'>-- ** Trailing annotations in lists</span>
<a name="line-45"></a>  <span class='hs-conid'>TrailingAnn</span><span class='hs-layout'>(</span><span class='hs-keyglyph'>..</span><span class='hs-layout'>)</span><span class='hs-layout'>,</span> <span class='hs-varid'>addTrailingAnnToA</span><span class='hs-layout'>,</span> <span class='hs-varid'>addTrailingAnnToL</span><span class='hs-layout'>,</span> <span class='hs-varid'>addTrailingCommaToN</span><span class='hs-layout'>,</span>
<a name="line-46"></a>
<a name="line-47"></a>  <span class='hs-comment'>-- ** Utilities for converting between different 'GenLocated' when</span>
<a name="line-48"></a>  <span class='hs-comment'>-- ** we do not care about the annotations.</span>
<a name="line-49"></a>  <span class='hs-varid'>la2na</span><span class='hs-layout'>,</span> <span class='hs-varid'>na2la</span><span class='hs-layout'>,</span> <span class='hs-varid'>n2l</span><span class='hs-layout'>,</span> <span class='hs-varid'>l2n</span><span class='hs-layout'>,</span> <span class='hs-varid'>l2l</span><span class='hs-layout'>,</span> <span class='hs-varid'>la2la</span><span class='hs-layout'>,</span>
<a name="line-50"></a>  <span class='hs-varid'>reLoc</span><span class='hs-layout'>,</span> <span class='hs-varid'>reLocA</span><span class='hs-layout'>,</span> <span class='hs-varid'>reLocL</span><span class='hs-layout'>,</span> <span class='hs-varid'>reLocC</span><span class='hs-layout'>,</span> <span class='hs-varid'>reLocN</span><span class='hs-layout'>,</span>
<a name="line-51"></a>
<a name="line-52"></a>  <span class='hs-varid'>la2r</span><span class='hs-layout'>,</span> <span class='hs-varid'>realSrcSpan</span><span class='hs-layout'>,</span>
<a name="line-53"></a>
<a name="line-54"></a>  <span class='hs-comment'>-- ** Building up annotations</span>
<a name="line-55"></a>  <span class='hs-varid'>extraToAnnList</span><span class='hs-layout'>,</span> <span class='hs-varid'>reAnn</span><span class='hs-layout'>,</span>
<a name="line-56"></a>  <span class='hs-varid'>reAnnL</span><span class='hs-layout'>,</span> <span class='hs-varid'>reAnnC</span><span class='hs-layout'>,</span>
<a name="line-57"></a>  <span class='hs-varid'>addAnns</span><span class='hs-layout'>,</span> <span class='hs-varid'>addAnnsA</span><span class='hs-layout'>,</span> <span class='hs-varid'>widenSpan</span><span class='hs-layout'>,</span> <span class='hs-varid'>widenAnchor</span><span class='hs-layout'>,</span> <span class='hs-varid'>widenAnchorR</span><span class='hs-layout'>,</span> <span class='hs-varid'>widenLocatedAn</span><span class='hs-layout'>,</span>
<a name="line-58"></a>
<a name="line-59"></a>  <span class='hs-comment'>-- ** Querying annotations</span>
<a name="line-60"></a>  <span class='hs-varid'>getLocAnn</span><span class='hs-layout'>,</span>
<a name="line-61"></a>  <span class='hs-varid'>epAnnAnns</span><span class='hs-layout'>,</span> <span class='hs-varid'>epAnnAnnsL</span><span class='hs-layout'>,</span>
<a name="line-62"></a>  <span class='hs-varid'>annParen2AddEpAnn</span><span class='hs-layout'>,</span>
<a name="line-63"></a>  <span class='hs-varid'>epAnnComments</span><span class='hs-layout'>,</span>
<a name="line-64"></a>
<a name="line-65"></a>  <span class='hs-comment'>-- ** Working with locations of annotations</span>
<a name="line-66"></a>  <span class='hs-varid'>sortLocatedA</span><span class='hs-layout'>,</span>
<a name="line-67"></a>  <span class='hs-varid'>mapLocA</span><span class='hs-layout'>,</span>
<a name="line-68"></a>  <span class='hs-varid'>combineLocsA</span><span class='hs-layout'>,</span>
<a name="line-69"></a>  <span class='hs-varid'>combineSrcSpansA</span><span class='hs-layout'>,</span>
<a name="line-70"></a>  <span class='hs-varid'>addCLocA</span><span class='hs-layout'>,</span> <span class='hs-varid'>addCLocAA</span><span class='hs-layout'>,</span>
<a name="line-71"></a>
<a name="line-72"></a>  <span class='hs-comment'>-- ** Constructing 'GenLocated' annotation types when we do not care</span>
<a name="line-73"></a>  <span class='hs-comment'>-- about annotations.</span>
<a name="line-74"></a>  <span class='hs-varid'>noLocA</span><span class='hs-layout'>,</span> <span class='hs-varid'>getLocA</span><span class='hs-layout'>,</span>
<a name="line-75"></a>  <span class='hs-varid'>noSrcSpanA</span><span class='hs-layout'>,</span>
<a name="line-76"></a>  <span class='hs-varid'>noAnnSrcSpan</span><span class='hs-layout'>,</span>
<a name="line-77"></a>
<a name="line-78"></a>  <span class='hs-comment'>-- ** Working with comments in annotations</span>
<a name="line-79"></a>  <span class='hs-varid'>noComments</span><span class='hs-layout'>,</span> <span class='hs-varid'>comment</span><span class='hs-layout'>,</span> <span class='hs-varid'>addCommentsToSrcAnn</span><span class='hs-layout'>,</span> <span class='hs-varid'>setCommentsSrcAnn</span><span class='hs-layout'>,</span>
<a name="line-80"></a>  <span class='hs-varid'>addCommentsToEpAnn</span><span class='hs-layout'>,</span> <span class='hs-varid'>setCommentsEpAnn</span><span class='hs-layout'>,</span>
<a name="line-81"></a>  <span class='hs-varid'>transferAnnsA</span><span class='hs-layout'>,</span> <span class='hs-varid'>commentsOnlyA</span><span class='hs-layout'>,</span> <span class='hs-varid'>removeCommentsA</span><span class='hs-layout'>,</span>
<a name="line-82"></a>
<a name="line-83"></a>  <span class='hs-varid'>placeholderRealSpan</span><span class='hs-layout'>,</span>
<a name="line-84"></a>  <span class='hs-layout'>)</span> <span class='hs-keyword'>where</span>
<a name="line-85"></a>
<a name="line-86"></a><span class='hs-keyword'>import</span> <span class='hs-conid'>GHC.Prelude</span>
<a name="line-87"></a>
<a name="line-88"></a><span class='hs-keyword'>import</span> <span class='hs-conid'>Data.Data</span>
<a name="line-89"></a><span class='hs-keyword'>import</span> <span class='hs-conid'>Data.Function</span> <span class='hs-layout'>(</span><span class='hs-varid'>on</span><span class='hs-layout'>)</span>
<a name="line-90"></a><span class='hs-keyword'>import</span> <span class='hs-conid'>Data.List</span> <span class='hs-layout'>(</span><span class='hs-varid'>sortBy</span><span class='hs-layout'>)</span>
<a name="line-91"></a><span class='hs-keyword'>import</span> <span class='hs-conid'>Data.Semigroup</span>
<a name="line-92"></a><span class='hs-keyword'>import</span> <span class='hs-conid'>GHC.Data.FastString</span>
<a name="line-93"></a><span class='hs-keyword'>import</span> <span class='hs-conid'>GHC.Types.Name</span>
<a name="line-94"></a><span class='hs-keyword'>import</span> <span class='hs-conid'>GHC.Types.SrcLoc</span>
<a name="line-95"></a><span class='hs-keyword'>import</span> <span class='hs-conid'>GHC.Utils.Binary</span>
<a name="line-96"></a><span class='hs-keyword'>import</span> <span class='hs-conid'>GHC.Utils.Outputable</span> <span class='hs-varid'>hiding</span> <span class='hs-layout'>(</span> <span class='hs-layout'>(</span><span class='hs-varop'>&lt;&gt;</span><span class='hs-layout'>)</span> <span class='hs-layout'>)</span>
<a name="line-97"></a><span class='hs-keyword'>import</span> <span class='hs-conid'>GHC.Utils.Panic</span>
<a name="line-98"></a>
<a name="line-99"></a><span class='hs-comment'>{-
<a name="line-100"></a>Note [exact print annotations]
<a name="line-101"></a>~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~
<a name="line-102"></a>Given a parse tree of a Haskell module, how can we reconstruct
<a name="line-103"></a>the original Haskell source code, retaining all whitespace and
<a name="line-104"></a>source code comments?  We need to track the locations of all
<a name="line-105"></a>elements from the original source: this includes keywords such as
<a name="line-106"></a>'let' / 'in' / 'do' etc as well as punctuation such as commas and
<a name="line-107"></a>braces, and also comments.  We collectively refer to this
<a name="line-108"></a>metadata as the "exact print annotations".
<a name="line-109"></a>
<a name="line-110"></a>NON-COMMENT ELEMENTS
<a name="line-111"></a>
<a name="line-112"></a>Intuitively, every AST element directly contains a bag of keywords
<a name="line-113"></a>(keywords can show up more than once in a node: a semicolon i.e. newline
<a name="line-114"></a>can show up multiple times before the next AST element), each of which
<a name="line-115"></a>needs to be associated with its location in the original source code.
<a name="line-116"></a>
<a name="line-117"></a>These keywords are recorded directly in the AST element in which they
<a name="line-118"></a>occur, for the GhcPs phase.
<a name="line-119"></a>
<a name="line-120"></a>For any given element in the AST, there is only a set number of
<a name="line-121"></a>keywords that are applicable for it (e.g., you'll never see an
<a name="line-122"></a>'import' keyword associated with a let-binding.)  The set of allowed
<a name="line-123"></a>keywords is documented in a comment associated with the constructor
<a name="line-124"></a>of a given AST element, although the ground truth is in GHC.Parser
<a name="line-125"></a>and GHC.Parser.PostProcess (which actually add the annotations).
<a name="line-126"></a>
<a name="line-127"></a>COMMENT ELEMENTS
<a name="line-128"></a>
<a name="line-129"></a>We associate comments with the lowest (most specific) AST element
<a name="line-130"></a>enclosing them
<a name="line-131"></a>
<a name="line-132"></a>PARSER STATE
<a name="line-133"></a>
<a name="line-134"></a>There are three fields in PState (the parser state) which play a role
<a name="line-135"></a>with annotation comments.
<a name="line-136"></a>
<a name="line-137"></a>&gt;  comment_q :: [LEpaComment],
<a name="line-138"></a>&gt;  header_comments :: Maybe [LEpaComment],
<a name="line-139"></a>&gt;  eof_pos :: Maybe (RealSrcSpan, RealSrcSpan), -- pos, gap to prior token
<a name="line-140"></a>
<a name="line-141"></a>The 'comment_q' field captures comments as they are seen in the token stream,
<a name="line-142"></a>so that when they are ready to be allocated via the parser they are
<a name="line-143"></a>available.
<a name="line-144"></a>
<a name="line-145"></a>The 'header_comments' capture the comments coming at the top of the
<a name="line-146"></a>source file.  They are moved there from the `comment_q` when comments
<a name="line-147"></a>are allocated for the first top-level declaration.
<a name="line-148"></a>
<a name="line-149"></a>The 'eof_pos' captures the final location in the file, and the
<a name="line-150"></a>location of the immediately preceding token to the last location, so
<a name="line-151"></a>that the exact-printer can work out how far to advance to add the
<a name="line-152"></a>trailing whitespace.
<a name="line-153"></a>
<a name="line-154"></a>PARSER EMISSION OF ANNOTATIONS
<a name="line-155"></a>
<a name="line-156"></a>The parser interacts with the lexer using the functions
<a name="line-157"></a>
<a name="line-158"></a>&gt; getCommentsFor      :: (MonadP m) =&gt; SrcSpan -&gt; m EpAnnComments
<a name="line-159"></a>&gt; getPriorCommentsFor :: (MonadP m) =&gt; SrcSpan -&gt; m EpAnnComments
<a name="line-160"></a>&gt; getFinalCommentsFor :: (MonadP m) =&gt; SrcSpan -&gt; m EpAnnComments
<a name="line-161"></a>
<a name="line-162"></a>The 'getCommentsFor' function is the one used most often.  It takes
<a name="line-163"></a>the AST element SrcSpan and removes and returns any comments in the
<a name="line-164"></a>'comment_q' that are inside the span. 'allocateComments' in 'Lexer' is
<a name="line-165"></a>responsible for making sure we only return comments that actually fit
<a name="line-166"></a>in the 'SrcSpan'.
<a name="line-167"></a>
<a name="line-168"></a>The 'getPriorCommentsFor' function is used for top-level declarations,
<a name="line-169"></a>and removes and returns any comments in the 'comment_q' that either
<a name="line-170"></a>precede or are included in the given SrcSpan. This is to ensure that
<a name="line-171"></a>preceding documentation comments are kept together with the
<a name="line-172"></a>declaration they belong to.
<a name="line-173"></a>
<a name="line-174"></a>The 'getFinalCommentsFor' function is called right at the end when EOF
<a name="line-175"></a>is hit. This drains the 'comment_q' completely, and returns the
<a name="line-176"></a>'header_comments', remaining 'comment_q' entries and the
<a name="line-177"></a>'eof_pos'. These values are inserted into the 'HsModule' AST element.
<a name="line-178"></a>
<a name="line-179"></a>The wiki page describing this feature is
<a name="line-180"></a>https://gitlab.haskell.org/ghc/ghc/wikis/api-annotations
<a name="line-181"></a>
<a name="line-182"></a>-}</span>
<a name="line-183"></a>
<a name="line-184"></a><span class='hs-comment'>-- --------------------------------------------------------------------</span>
<a name="line-185"></a>
<a name="line-186"></a><a name="AnnKeywordId"></a><span class='hs-comment'>-- | Exact print annotations exist so that tools can perform source to</span>
<a name="line-187"></a><a name="AnnKeywordId"></a><span class='hs-comment'>-- source conversions of Haskell code. They are used to keep track of</span>
<a name="line-188"></a><a name="AnnKeywordId"></a><span class='hs-comment'>-- the various syntactic keywords that are not otherwise captured in the</span>
<a name="line-189"></a><a name="AnnKeywordId"></a><span class='hs-comment'>-- AST.</span>
<a name="line-190"></a><a name="AnnKeywordId"></a><span class='hs-comment'>--</span>
<a name="line-191"></a><a name="AnnKeywordId"></a><span class='hs-comment'>-- The wiki page describing this feature is</span>
<a name="line-192"></a><a name="AnnKeywordId"></a><span class='hs-comment'>-- https://gitlab.haskell.org/ghc/ghc/wikis/api-annotations</span>
<a name="line-193"></a><a name="AnnKeywordId"></a><span class='hs-comment'>-- https://gitlab.haskell.org/ghc/ghc/-/wikis/implementing-trees-that-grow/in-tree-api-annotations</span>
<a name="line-194"></a><a name="AnnKeywordId"></a><span class='hs-comment'>--</span>
<a name="line-195"></a><a name="AnnKeywordId"></a><span class='hs-comment'>-- Note: in general the names of these are taken from the</span>
<a name="line-196"></a><a name="AnnKeywordId"></a><span class='hs-comment'>-- corresponding token, unless otherwise noted</span>
<a name="line-197"></a><a name="AnnKeywordId"></a><span class='hs-comment'>-- See note [exact print annotations] above for details of the usage</span>
<a name="line-198"></a><a name="AnnKeywordId"></a><span class='hs-keyword'>data</span> <span class='hs-conid'>AnnKeywordId</span>
<a name="line-199"></a>    <span class='hs-keyglyph'>=</span> <span class='hs-conid'>AnnAnyclass</span>
<a name="line-200"></a>    <span class='hs-keyglyph'>|</span> <span class='hs-conid'>AnnAs</span>
<a name="line-201"></a>    <span class='hs-keyglyph'>|</span> <span class='hs-conid'>AnnAt</span>
<a name="line-202"></a>    <span class='hs-keyglyph'>|</span> <span class='hs-conid'>AnnBang</span>  <span class='hs-comment'>-- ^ '!'</span>
<a name="line-203"></a>    <span class='hs-keyglyph'>|</span> <span class='hs-conid'>AnnBackquote</span> <span class='hs-comment'>-- ^ '`'</span>
<a name="line-204"></a>    <span class='hs-keyglyph'>|</span> <span class='hs-conid'>AnnBy</span>
<a name="line-205"></a>    <span class='hs-keyglyph'>|</span> <span class='hs-conid'>AnnCase</span> <span class='hs-comment'>-- ^ case or lambda case</span>
<a name="line-206"></a>    <span class='hs-keyglyph'>|</span> <span class='hs-conid'>AnnClass</span>
<a name="line-207"></a>    <span class='hs-keyglyph'>|</span> <span class='hs-conid'>AnnClose</span> <span class='hs-comment'>-- ^  '\#)' or '\#-}'  etc</span>
<a name="line-208"></a>    <span class='hs-keyglyph'>|</span> <span class='hs-conid'>AnnCloseB</span> <span class='hs-comment'>-- ^ '|)'</span>
<a name="line-209"></a>    <span class='hs-keyglyph'>|</span> <span class='hs-conid'>AnnCloseBU</span> <span class='hs-comment'>-- ^ '|)', unicode variant</span>
<a name="line-210"></a>    <span class='hs-keyglyph'>|</span> <span class='hs-conid'>AnnCloseC</span> <span class='hs-comment'>-- ^ '}'</span>
<a name="line-211"></a>    <span class='hs-keyglyph'>|</span> <span class='hs-conid'>AnnCloseQ</span>  <span class='hs-comment'>-- ^ '|]'</span>
<a name="line-212"></a>    <span class='hs-keyglyph'>|</span> <span class='hs-conid'>AnnCloseQU</span> <span class='hs-comment'>-- ^ '|]', unicode variant</span>
<a name="line-213"></a>    <span class='hs-keyglyph'>|</span> <span class='hs-conid'>AnnCloseP</span> <span class='hs-comment'>-- ^ ')'</span>
<a name="line-214"></a>    <span class='hs-keyglyph'>|</span> <span class='hs-conid'>AnnClosePH</span> <span class='hs-comment'>-- ^ '\#)'</span>
<a name="line-215"></a>    <span class='hs-keyglyph'>|</span> <span class='hs-conid'>AnnCloseS</span> <span class='hs-comment'>-- ^ ']'</span>
<a name="line-216"></a>    <span class='hs-keyglyph'>|</span> <span class='hs-conid'>AnnColon</span>
<a name="line-217"></a>    <span class='hs-keyglyph'>|</span> <span class='hs-conid'>AnnComma</span> <span class='hs-comment'>-- ^ as a list separator</span>
<a name="line-218"></a>    <span class='hs-keyglyph'>|</span> <span class='hs-conid'>AnnCommaTuple</span> <span class='hs-comment'>-- ^ in a RdrName for a tuple</span>
<a name="line-219"></a>    <span class='hs-keyglyph'>|</span> <span class='hs-conid'>AnnDarrow</span> <span class='hs-comment'>-- ^ '=&gt;'</span>
<a name="line-220"></a>    <span class='hs-keyglyph'>|</span> <span class='hs-conid'>AnnDarrowU</span> <span class='hs-comment'>-- ^ '=&gt;', unicode variant</span>
<a name="line-221"></a>    <span class='hs-keyglyph'>|</span> <span class='hs-conid'>AnnData</span>
<a name="line-222"></a>    <span class='hs-keyglyph'>|</span> <span class='hs-conid'>AnnDcolon</span> <span class='hs-comment'>-- ^ '::'</span>
<a name="line-223"></a>    <span class='hs-keyglyph'>|</span> <span class='hs-conid'>AnnDcolonU</span> <span class='hs-comment'>-- ^ '::', unicode variant</span>
<a name="line-224"></a>    <span class='hs-keyglyph'>|</span> <span class='hs-conid'>AnnDefault</span>
<a name="line-225"></a>    <span class='hs-keyglyph'>|</span> <span class='hs-conid'>AnnDeriving</span>
<a name="line-226"></a>    <span class='hs-keyglyph'>|</span> <span class='hs-conid'>AnnDo</span>
<a name="line-227"></a>    <span class='hs-keyglyph'>|</span> <span class='hs-conid'>AnnDot</span>    <span class='hs-comment'>-- ^ '.'</span>
<a name="line-228"></a>    <span class='hs-keyglyph'>|</span> <span class='hs-conid'>AnnDotdot</span> <span class='hs-comment'>-- ^ '..'</span>
<a name="line-229"></a>    <span class='hs-keyglyph'>|</span> <span class='hs-conid'>AnnElse</span>
<a name="line-230"></a>    <span class='hs-keyglyph'>|</span> <span class='hs-conid'>AnnEqual</span>
<a name="line-231"></a>    <span class='hs-keyglyph'>|</span> <span class='hs-conid'>AnnExport</span>
<a name="line-232"></a>    <span class='hs-keyglyph'>|</span> <span class='hs-conid'>AnnFamily</span>
<a name="line-233"></a>    <span class='hs-keyglyph'>|</span> <span class='hs-conid'>AnnForall</span>
<a name="line-234"></a>    <span class='hs-keyglyph'>|</span> <span class='hs-conid'>AnnForallU</span> <span class='hs-comment'>-- ^ Unicode variant</span>
<a name="line-235"></a>    <span class='hs-keyglyph'>|</span> <span class='hs-conid'>AnnForeign</span>
<a name="line-236"></a>    <span class='hs-keyglyph'>|</span> <span class='hs-conid'>AnnFunId</span> <span class='hs-comment'>-- ^ for function name in matches where there are</span>
<a name="line-237"></a>               <span class='hs-comment'>-- multiple equations for the function.</span>
<a name="line-238"></a>    <span class='hs-keyglyph'>|</span> <span class='hs-conid'>AnnGroup</span>
<a name="line-239"></a>    <span class='hs-keyglyph'>|</span> <span class='hs-conid'>AnnHeader</span> <span class='hs-comment'>-- ^ for CType</span>
<a name="line-240"></a>    <span class='hs-keyglyph'>|</span> <span class='hs-conid'>AnnHiding</span>
<a name="line-241"></a>    <span class='hs-keyglyph'>|</span> <span class='hs-conid'>AnnIf</span>
<a name="line-242"></a>    <span class='hs-keyglyph'>|</span> <span class='hs-conid'>AnnImport</span>
<a name="line-243"></a>    <span class='hs-keyglyph'>|</span> <span class='hs-conid'>AnnIn</span>
<a name="line-244"></a>    <span class='hs-keyglyph'>|</span> <span class='hs-conid'>AnnInfix</span> <span class='hs-comment'>-- ^ 'infix' or 'infixl' or 'infixr'</span>
<a name="line-245"></a>    <span class='hs-keyglyph'>|</span> <span class='hs-conid'>AnnInstance</span>
<a name="line-246"></a>    <span class='hs-keyglyph'>|</span> <span class='hs-conid'>AnnLam</span>
<a name="line-247"></a>    <span class='hs-keyglyph'>|</span> <span class='hs-conid'>AnnLarrow</span>     <span class='hs-comment'>-- ^ '&lt;-'</span>
<a name="line-248"></a>    <span class='hs-keyglyph'>|</span> <span class='hs-conid'>AnnLarrowU</span>    <span class='hs-comment'>-- ^ '&lt;-', unicode variant</span>
<a name="line-249"></a>    <span class='hs-keyglyph'>|</span> <span class='hs-conid'>AnnLet</span>
<a name="line-250"></a>    <span class='hs-keyglyph'>|</span> <span class='hs-conid'>AnnLollyU</span>     <span class='hs-comment'>-- ^ The '⊸' unicode arrow</span>
<a name="line-251"></a>    <span class='hs-keyglyph'>|</span> <span class='hs-conid'>AnnMdo</span>
<a name="line-252"></a>    <span class='hs-keyglyph'>|</span> <span class='hs-conid'>AnnMinus</span> <span class='hs-comment'>-- ^ '-'</span>
<a name="line-253"></a>    <span class='hs-keyglyph'>|</span> <span class='hs-conid'>AnnModule</span>
<a name="line-254"></a>    <span class='hs-keyglyph'>|</span> <span class='hs-conid'>AnnNewtype</span>
<a name="line-255"></a>    <span class='hs-keyglyph'>|</span> <span class='hs-conid'>AnnName</span> <span class='hs-comment'>-- ^ where a name loses its location in the AST, this carries it</span>
<a name="line-256"></a>    <span class='hs-keyglyph'>|</span> <span class='hs-conid'>AnnOf</span>
<a name="line-257"></a>    <span class='hs-keyglyph'>|</span> <span class='hs-conid'>AnnOpen</span>    <span class='hs-comment'>-- ^ '{-\# DEPRECATED' etc. Opening of pragmas where</span>
<a name="line-258"></a>                 <span class='hs-comment'>-- the capitalisation of the string can be changed by</span>
<a name="line-259"></a>                 <span class='hs-comment'>-- the user. The actual text used is stored in a</span>
<a name="line-260"></a>                 <span class='hs-comment'>-- 'SourceText' on the relevant pragma item.</span>
<a name="line-261"></a>    <span class='hs-keyglyph'>|</span> <span class='hs-conid'>AnnOpenB</span>   <span class='hs-comment'>-- ^ '(|'</span>
<a name="line-262"></a>    <span class='hs-keyglyph'>|</span> <span class='hs-conid'>AnnOpenBU</span>  <span class='hs-comment'>-- ^ '(|', unicode variant</span>
<a name="line-263"></a>    <span class='hs-keyglyph'>|</span> <span class='hs-conid'>AnnOpenC</span>   <span class='hs-comment'>-- ^ '{'</span>
<a name="line-264"></a>    <span class='hs-keyglyph'>|</span> <span class='hs-conid'>AnnOpenE</span>   <span class='hs-comment'>-- ^ '[e|' or '[e||'</span>
<a name="line-265"></a>    <span class='hs-keyglyph'>|</span> <span class='hs-conid'>AnnOpenEQ</span>  <span class='hs-comment'>-- ^ '[|'</span>
<a name="line-266"></a>    <span class='hs-keyglyph'>|</span> <span class='hs-conid'>AnnOpenEQU</span> <span class='hs-comment'>-- ^ '[|', unicode variant</span>
<a name="line-267"></a>    <span class='hs-keyglyph'>|</span> <span class='hs-conid'>AnnOpenP</span>   <span class='hs-comment'>-- ^ '('</span>
<a name="line-268"></a>    <span class='hs-keyglyph'>|</span> <span class='hs-conid'>AnnOpenS</span>   <span class='hs-comment'>-- ^ '['</span>
<a name="line-269"></a>    <span class='hs-keyglyph'>|</span> <span class='hs-conid'>AnnOpenPH</span>  <span class='hs-comment'>-- ^ '(\#'</span>
<a name="line-270"></a>    <span class='hs-keyglyph'>|</span> <span class='hs-conid'>AnnDollar</span>          <span class='hs-comment'>-- ^ prefix '$'   -- TemplateHaskell</span>
<a name="line-271"></a>    <span class='hs-keyglyph'>|</span> <span class='hs-conid'>AnnDollarDollar</span>    <span class='hs-comment'>-- ^ prefix '$$'  -- TemplateHaskell</span>
<a name="line-272"></a>    <span class='hs-keyglyph'>|</span> <span class='hs-conid'>AnnPackageName</span>
<a name="line-273"></a>    <span class='hs-keyglyph'>|</span> <span class='hs-conid'>AnnPattern</span>
<a name="line-274"></a>    <span class='hs-keyglyph'>|</span> <span class='hs-conid'>AnnPercent</span>    <span class='hs-comment'>-- ^ '%'  -- for HsExplicitMult</span>
<a name="line-275"></a>    <span class='hs-keyglyph'>|</span> <span class='hs-conid'>AnnPercentOne</span> <span class='hs-comment'>-- ^ '%1' -- for HsLinearArrow</span>
<a name="line-276"></a>    <span class='hs-keyglyph'>|</span> <span class='hs-conid'>AnnProc</span>
<a name="line-277"></a>    <span class='hs-keyglyph'>|</span> <span class='hs-conid'>AnnQualified</span>
<a name="line-278"></a>    <span class='hs-keyglyph'>|</span> <span class='hs-conid'>AnnRarrow</span> <span class='hs-comment'>-- ^ '-&gt;'</span>
<a name="line-279"></a>    <span class='hs-keyglyph'>|</span> <span class='hs-conid'>AnnRarrowU</span> <span class='hs-comment'>-- ^ '-&gt;', unicode variant</span>
<a name="line-280"></a>    <span class='hs-keyglyph'>|</span> <span class='hs-conid'>AnnRec</span>
<a name="line-281"></a>    <span class='hs-keyglyph'>|</span> <span class='hs-conid'>AnnRole</span>
<a name="line-282"></a>    <span class='hs-keyglyph'>|</span> <span class='hs-conid'>AnnSafe</span>
<a name="line-283"></a>    <span class='hs-keyglyph'>|</span> <span class='hs-conid'>AnnSemi</span> <span class='hs-comment'>-- ^ ';'</span>
<a name="line-284"></a>    <span class='hs-keyglyph'>|</span> <span class='hs-conid'>AnnSimpleQuote</span> <span class='hs-comment'>-- ^ '''</span>
<a name="line-285"></a>    <span class='hs-keyglyph'>|</span> <span class='hs-conid'>AnnSignature</span>
<a name="line-286"></a>    <span class='hs-keyglyph'>|</span> <span class='hs-conid'>AnnStatic</span> <span class='hs-comment'>-- ^ 'static'</span>
<a name="line-287"></a>    <span class='hs-keyglyph'>|</span> <span class='hs-conid'>AnnStock</span>
<a name="line-288"></a>    <span class='hs-keyglyph'>|</span> <span class='hs-conid'>AnnThen</span>
<a name="line-289"></a>    <span class='hs-keyglyph'>|</span> <span class='hs-conid'>AnnThTyQuote</span> <span class='hs-comment'>-- ^ double '''</span>
<a name="line-290"></a>    <span class='hs-keyglyph'>|</span> <span class='hs-conid'>AnnTilde</span> <span class='hs-comment'>-- ^ '~'</span>
<a name="line-291"></a>    <span class='hs-keyglyph'>|</span> <span class='hs-conid'>AnnType</span>
<a name="line-292"></a>    <span class='hs-keyglyph'>|</span> <span class='hs-conid'>AnnUnit</span> <span class='hs-comment'>-- ^ '()' for types</span>
<a name="line-293"></a>    <span class='hs-keyglyph'>|</span> <span class='hs-conid'>AnnUsing</span>
<a name="line-294"></a>    <span class='hs-keyglyph'>|</span> <span class='hs-conid'>AnnVal</span>  <span class='hs-comment'>-- ^ e.g. INTEGER</span>
<a name="line-295"></a>    <span class='hs-keyglyph'>|</span> <span class='hs-conid'>AnnValStr</span>  <span class='hs-comment'>-- ^ String value, will need quotes when output</span>
<a name="line-296"></a>    <span class='hs-keyglyph'>|</span> <span class='hs-conid'>AnnVbar</span> <span class='hs-comment'>-- ^ '|'</span>
<a name="line-297"></a>    <span class='hs-keyglyph'>|</span> <span class='hs-conid'>AnnVia</span> <span class='hs-comment'>-- ^ 'via'</span>
<a name="line-298"></a>    <span class='hs-keyglyph'>|</span> <span class='hs-conid'>AnnWhere</span>
<a name="line-299"></a>    <span class='hs-keyglyph'>|</span> <span class='hs-conid'>Annlarrowtail</span> <span class='hs-comment'>-- ^ '-&lt;'</span>
<a name="line-300"></a>    <span class='hs-keyglyph'>|</span> <span class='hs-conid'>AnnlarrowtailU</span> <span class='hs-comment'>-- ^ '-&lt;', unicode variant</span>
<a name="line-301"></a>    <span class='hs-keyglyph'>|</span> <span class='hs-conid'>Annrarrowtail</span> <span class='hs-comment'>-- ^ '-&gt;'</span>
<a name="line-302"></a>    <span class='hs-keyglyph'>|</span> <span class='hs-conid'>AnnrarrowtailU</span> <span class='hs-comment'>-- ^ '-&gt;', unicode variant</span>
<a name="line-303"></a>    <span class='hs-keyglyph'>|</span> <span class='hs-conid'>AnnLarrowtail</span> <span class='hs-comment'>-- ^ '-&lt;&lt;'</span>
<a name="line-304"></a>    <span class='hs-keyglyph'>|</span> <span class='hs-conid'>AnnLarrowtailU</span> <span class='hs-comment'>-- ^ '-&lt;&lt;', unicode variant</span>
<a name="line-305"></a>    <span class='hs-keyglyph'>|</span> <span class='hs-conid'>AnnRarrowtail</span> <span class='hs-comment'>-- ^ '&gt;&gt;-'</span>
<a name="line-306"></a>    <span class='hs-keyglyph'>|</span> <span class='hs-conid'>AnnRarrowtailU</span> <span class='hs-comment'>-- ^ '&gt;&gt;-', unicode variant</span>
<a name="line-307"></a>    <span class='hs-keyword'>deriving</span> <span class='hs-layout'>(</span><span class='hs-conid'>Eq</span><span class='hs-layout'>,</span> <span class='hs-conid'>Ord</span><span class='hs-layout'>,</span> <span class='hs-conid'>Data</span><span class='hs-layout'>,</span> <span class='hs-conid'>Show</span><span class='hs-layout'>)</span>
<a name="line-308"></a>
<a name="line-309"></a><a name="instance%20Outputable%20AnnKeywordId"></a><span class='hs-keyword'>instance</span> <span class='hs-conid'>Outputable</span> <span class='hs-conid'>AnnKeywordId</span> <span class='hs-keyword'>where</span>
<a name="line-310"></a>  <span class='hs-varid'>ppr</span> <span class='hs-varid'>x</span> <span class='hs-keyglyph'>=</span> <span class='hs-varid'>text</span> <span class='hs-layout'>(</span><span class='hs-varid'>show</span> <span class='hs-varid'>x</span><span class='hs-layout'>)</span>
<a name="line-311"></a>
<a name="line-312"></a><a name="IsUnicodeSyntax"></a><span class='hs-comment'>-- | Certain tokens can have alternate representations when unicode syntax is</span>
<a name="line-313"></a><a name="IsUnicodeSyntax"></a><span class='hs-comment'>-- enabled. This flag is attached to those tokens in the lexer so that the</span>
<a name="line-314"></a><a name="IsUnicodeSyntax"></a><span class='hs-comment'>-- original source representation can be reproduced in the corresponding</span>
<a name="line-315"></a><a name="IsUnicodeSyntax"></a><span class='hs-comment'>-- 'EpAnnotation'</span>
<a name="line-316"></a><a name="IsUnicodeSyntax"></a><span class='hs-keyword'>data</span> <span class='hs-conid'>IsUnicodeSyntax</span> <span class='hs-keyglyph'>=</span> <span class='hs-conid'>UnicodeSyntax</span> <span class='hs-keyglyph'>|</span> <span class='hs-conid'>NormalSyntax</span>
<a name="line-317"></a>    <span class='hs-keyword'>deriving</span> <span class='hs-layout'>(</span><span class='hs-conid'>Eq</span><span class='hs-layout'>,</span> <span class='hs-conid'>Ord</span><span class='hs-layout'>,</span> <span class='hs-conid'>Data</span><span class='hs-layout'>,</span> <span class='hs-conid'>Show</span><span class='hs-layout'>)</span>
<a name="line-318"></a>
<a name="line-319"></a><a name="unicodeAnn"></a><span class='hs-comment'>-- | Convert a normal annotation into its unicode equivalent one</span>
<a name="line-320"></a><span class='hs-definition'>unicodeAnn</span> <span class='hs-keyglyph'>::</span> <span class='hs-conid'>AnnKeywordId</span> <span class='hs-keyglyph'>-&gt;</span> <span class='hs-conid'>AnnKeywordId</span>
<a name="line-321"></a><span class='hs-definition'>unicodeAnn</span> <span class='hs-conid'>AnnForall</span>     <span class='hs-keyglyph'>=</span> <span class='hs-conid'>AnnForallU</span>
<a name="line-322"></a><span class='hs-definition'>unicodeAnn</span> <span class='hs-conid'>AnnDcolon</span>     <span class='hs-keyglyph'>=</span> <span class='hs-conid'>AnnDcolonU</span>
<a name="line-323"></a><span class='hs-definition'>unicodeAnn</span> <span class='hs-conid'>AnnLarrow</span>     <span class='hs-keyglyph'>=</span> <span class='hs-conid'>AnnLarrowU</span>
<a name="line-324"></a><span class='hs-definition'>unicodeAnn</span> <span class='hs-conid'>AnnRarrow</span>     <span class='hs-keyglyph'>=</span> <span class='hs-conid'>AnnRarrowU</span>
<a name="line-325"></a><span class='hs-definition'>unicodeAnn</span> <span class='hs-conid'>AnnDarrow</span>     <span class='hs-keyglyph'>=</span> <span class='hs-conid'>AnnDarrowU</span>
<a name="line-326"></a><span class='hs-definition'>unicodeAnn</span> <span class='hs-conid'>Annlarrowtail</span> <span class='hs-keyglyph'>=</span> <span class='hs-conid'>AnnlarrowtailU</span>
<a name="line-327"></a><span class='hs-definition'>unicodeAnn</span> <span class='hs-conid'>Annrarrowtail</span> <span class='hs-keyglyph'>=</span> <span class='hs-conid'>AnnrarrowtailU</span>
<a name="line-328"></a><span class='hs-definition'>unicodeAnn</span> <span class='hs-conid'>AnnLarrowtail</span> <span class='hs-keyglyph'>=</span> <span class='hs-conid'>AnnLarrowtailU</span>
<a name="line-329"></a><span class='hs-definition'>unicodeAnn</span> <span class='hs-conid'>AnnRarrowtail</span> <span class='hs-keyglyph'>=</span> <span class='hs-conid'>AnnRarrowtailU</span>
<a name="line-330"></a><span class='hs-definition'>unicodeAnn</span> <span class='hs-conid'>AnnOpenB</span>      <span class='hs-keyglyph'>=</span> <span class='hs-conid'>AnnOpenBU</span>
<a name="line-331"></a><span class='hs-definition'>unicodeAnn</span> <span class='hs-conid'>AnnCloseB</span>     <span class='hs-keyglyph'>=</span> <span class='hs-conid'>AnnCloseBU</span>
<a name="line-332"></a><span class='hs-definition'>unicodeAnn</span> <span class='hs-conid'>AnnOpenEQ</span>     <span class='hs-keyglyph'>=</span> <span class='hs-conid'>AnnOpenEQU</span>
<a name="line-333"></a><span class='hs-definition'>unicodeAnn</span> <span class='hs-conid'>AnnCloseQ</span>     <span class='hs-keyglyph'>=</span> <span class='hs-conid'>AnnCloseQU</span>
<a name="line-334"></a><span class='hs-definition'>unicodeAnn</span> <span class='hs-varid'>ann</span>           <span class='hs-keyglyph'>=</span> <span class='hs-varid'>ann</span>
<a name="line-335"></a>
<a name="line-336"></a>
<a name="line-337"></a><a name="HasE"></a><span class='hs-comment'>-- | Some template haskell tokens have two variants, one with an `e` the other</span>
<a name="line-338"></a><a name="HasE"></a><span class='hs-comment'>-- not:</span>
<a name="line-339"></a><a name="HasE"></a><span class='hs-comment'>--</span>
<a name="line-340"></a><a name="HasE"></a><span class='hs-comment'>-- &gt;  [| or [e|</span>
<a name="line-341"></a><a name="HasE"></a><span class='hs-comment'>-- &gt;  [|| or [e||</span>
<a name="line-342"></a><a name="HasE"></a><span class='hs-comment'>--</span>
<a name="line-343"></a><a name="HasE"></a><span class='hs-comment'>-- This type indicates whether the 'e' is present or not.</span>
<a name="line-344"></a><a name="HasE"></a><span class='hs-keyword'>data</span> <span class='hs-conid'>HasE</span> <span class='hs-keyglyph'>=</span> <span class='hs-conid'>HasE</span> <span class='hs-keyglyph'>|</span> <span class='hs-conid'>NoE</span>
<a name="line-345"></a>     <span class='hs-keyword'>deriving</span> <span class='hs-layout'>(</span><span class='hs-conid'>Eq</span><span class='hs-layout'>,</span> <span class='hs-conid'>Ord</span><span class='hs-layout'>,</span> <span class='hs-conid'>Data</span><span class='hs-layout'>,</span> <span class='hs-conid'>Show</span><span class='hs-layout'>)</span>
<a name="line-346"></a>
<a name="line-347"></a><span class='hs-comment'>-- ---------------------------------------------------------------------</span>
<a name="line-348"></a>
<a name="line-349"></a><a name="EpaComment"></a><span class='hs-keyword'>data</span> <span class='hs-conid'>EpaComment</span> <span class='hs-keyglyph'>=</span>
<a name="line-350"></a>  <span class='hs-conid'>EpaComment</span>
<a name="line-351"></a>    <span class='hs-layout'>{</span> <span class='hs-varid'>ac_tok</span> <span class='hs-keyglyph'>::</span> <span class='hs-conid'>EpaCommentTok</span>
<a name="line-352"></a>    <span class='hs-layout'>,</span> <span class='hs-varid'>ac_prior_tok</span> <span class='hs-keyglyph'>::</span> <span class='hs-conid'>RealSrcSpan</span>
<a name="line-353"></a>    <span class='hs-comment'>-- ^ The location of the prior token, used in exact printing.  The</span>
<a name="line-354"></a>    <span class='hs-comment'>-- 'EpaComment' appears as an 'LEpaComment' containing its</span>
<a name="line-355"></a>    <span class='hs-comment'>-- location.  The difference between the end of the prior token</span>
<a name="line-356"></a>    <span class='hs-comment'>-- and the start of this location is used for the spacing when</span>
<a name="line-357"></a>    <span class='hs-comment'>-- exact printing the comment.</span>
<a name="line-358"></a>    <span class='hs-layout'>}</span>
<a name="line-359"></a>    <span class='hs-keyword'>deriving</span> <span class='hs-layout'>(</span><span class='hs-conid'>Eq</span><span class='hs-layout'>,</span> <span class='hs-conid'>Ord</span><span class='hs-layout'>,</span> <span class='hs-conid'>Data</span><span class='hs-layout'>,</span> <span class='hs-conid'>Show</span><span class='hs-layout'>)</span>
<a name="line-360"></a>
<a name="line-361"></a><a name="EpaCommentTok"></a><span class='hs-keyword'>data</span> <span class='hs-conid'>EpaCommentTok</span> <span class='hs-keyglyph'>=</span>
<a name="line-362"></a>  <span class='hs-comment'>-- Documentation annotations</span>
<a name="line-363"></a>    <span class='hs-conid'>EpaDocCommentNext</span>  <span class='hs-conid'>String</span>     <span class='hs-comment'>-- ^ something beginning '-- |'</span>
<a name="line-364"></a>  <span class='hs-keyglyph'>|</span> <span class='hs-conid'>EpaDocCommentPrev</span>  <span class='hs-conid'>String</span>     <span class='hs-comment'>-- ^ something beginning '-- ^'</span>
<a name="line-365"></a>  <span class='hs-keyglyph'>|</span> <span class='hs-conid'>EpaDocCommentNamed</span> <span class='hs-conid'>String</span>     <span class='hs-comment'>-- ^ something beginning '-- $'</span>
<a name="line-366"></a>  <span class='hs-keyglyph'>|</span> <span class='hs-conid'>EpaDocSection</span>      <span class='hs-conid'>Int</span> <span class='hs-conid'>String</span> <span class='hs-comment'>-- ^ a section heading</span>
<a name="line-367"></a>  <span class='hs-keyglyph'>|</span> <span class='hs-conid'>EpaDocOptions</span>      <span class='hs-conid'>String</span>     <span class='hs-comment'>-- ^ doc options (prune, ignore-exports, etc)</span>
<a name="line-368"></a>  <span class='hs-keyglyph'>|</span> <span class='hs-conid'>EpaLineComment</span>     <span class='hs-conid'>String</span>     <span class='hs-comment'>-- ^ comment starting by "--"</span>
<a name="line-369"></a>  <span class='hs-keyglyph'>|</span> <span class='hs-conid'>EpaBlockComment</span>    <span class='hs-conid'>String</span>     <span class='hs-comment'>-- ^ comment in {- -}</span>
<a name="line-370"></a>  <span class='hs-keyglyph'>|</span> <span class='hs-conid'>EpaEofComment</span>                 <span class='hs-comment'>-- ^ empty comment, capturing</span>
<a name="line-371"></a>                                  <span class='hs-comment'>-- location of EOF</span>
<a name="line-372"></a>
<a name="line-373"></a>  <span class='hs-comment'>-- See #19697 for a discussion of EpaEofComment's use and how it</span>
<a name="line-374"></a>  <span class='hs-comment'>-- should be removed in favour of capturing it in the location for</span>
<a name="line-375"></a>  <span class='hs-comment'>-- 'Located HsModule' in the parser.</span>
<a name="line-376"></a>
<a name="line-377"></a>    <span class='hs-keyword'>deriving</span> <span class='hs-layout'>(</span><span class='hs-conid'>Eq</span><span class='hs-layout'>,</span> <span class='hs-conid'>Ord</span><span class='hs-layout'>,</span> <span class='hs-conid'>Data</span><span class='hs-layout'>,</span> <span class='hs-conid'>Show</span><span class='hs-layout'>)</span>
<a name="line-378"></a><span class='hs-comment'>-- Note: these are based on the Token versions, but the Token type is</span>
<a name="line-379"></a><span class='hs-comment'>-- defined in GHC.Parser.Lexer and bringing it in here would create a loop</span>
<a name="line-380"></a>
<a name="line-381"></a><a name="instance%20Outputable%20EpaComment"></a><span class='hs-keyword'>instance</span> <span class='hs-conid'>Outputable</span> <span class='hs-conid'>EpaComment</span> <span class='hs-keyword'>where</span>
<a name="line-382"></a>  <span class='hs-varid'>ppr</span> <span class='hs-varid'>x</span> <span class='hs-keyglyph'>=</span> <span class='hs-varid'>text</span> <span class='hs-layout'>(</span><span class='hs-varid'>show</span> <span class='hs-varid'>x</span><span class='hs-layout'>)</span>
<a name="line-383"></a>
<a name="line-384"></a><span class='hs-comment'>-- ---------------------------------------------------------------------</span>
<a name="line-385"></a>
<a name="line-386"></a><a name="AddEpAnn"></a><span class='hs-comment'>-- | Captures an annotation, storing the @'AnnKeywordId'@ and its</span>
<a name="line-387"></a><a name="AddEpAnn"></a><span class='hs-comment'>-- location.  The parser only ever inserts @'EpaLocation'@ fields with a</span>
<a name="line-388"></a><a name="AddEpAnn"></a><span class='hs-comment'>-- RealSrcSpan being the original location of the annotation in the</span>
<a name="line-389"></a><a name="AddEpAnn"></a><span class='hs-comment'>-- source file.</span>
<a name="line-390"></a><a name="AddEpAnn"></a><span class='hs-comment'>-- The @'EpaLocation'@ can also store a delta position if the AST has been</span>
<a name="line-391"></a><a name="AddEpAnn"></a><span class='hs-comment'>-- modified and needs to be pretty printed again.</span>
<a name="line-392"></a><a name="AddEpAnn"></a><span class='hs-comment'>-- The usual way an 'AddEpAnn' is created is using the 'mj' ("make</span>
<a name="line-393"></a><a name="AddEpAnn"></a><span class='hs-comment'>-- jump") function, and then it can be inserted into the appropriate</span>
<a name="line-394"></a><a name="AddEpAnn"></a><span class='hs-comment'>-- annotation.</span>
<a name="line-395"></a><a name="AddEpAnn"></a><span class='hs-keyword'>data</span> <span class='hs-conid'>AddEpAnn</span> <span class='hs-keyglyph'>=</span> <span class='hs-conid'>AddEpAnn</span> <span class='hs-conid'>AnnKeywordId</span> <span class='hs-conid'>EpaLocation</span> <span class='hs-keyword'>deriving</span> <span class='hs-layout'>(</span><span class='hs-conid'>Data</span><span class='hs-layout'>,</span><span class='hs-conid'>Eq</span><span class='hs-layout'>)</span>
<a name="line-396"></a>
<a name="line-397"></a><a name="EpaLocation"></a><span class='hs-comment'>-- | The anchor for an @'AnnKeywordId'@. The Parser inserts the</span>
<a name="line-398"></a><a name="EpaLocation"></a><span class='hs-comment'>-- @'EpaSpan'@ variant, giving the exact location of the original item</span>
<a name="line-399"></a><a name="EpaLocation"></a><span class='hs-comment'>-- in the parsed source.  This can be replaced by the @'EpaDelta'@</span>
<a name="line-400"></a><a name="EpaLocation"></a><span class='hs-comment'>-- version, to provide a position for the item relative to the end of</span>
<a name="line-401"></a><a name="EpaLocation"></a><span class='hs-comment'>-- the previous item in the source.  This is useful when editing an</span>
<a name="line-402"></a><a name="EpaLocation"></a><span class='hs-comment'>-- AST prior to exact printing the changed one. The list of comments</span>
<a name="line-403"></a><a name="EpaLocation"></a><span class='hs-comment'>-- in the @'EpaDelta'@ variant captures any comments between the prior</span>
<a name="line-404"></a><a name="EpaLocation"></a><span class='hs-comment'>-- output and the thing being marked here, since we cannot otherwise</span>
<a name="line-405"></a><a name="EpaLocation"></a><span class='hs-comment'>-- sort the relative order.</span>
<a name="line-406"></a><a name="EpaLocation"></a><span class='hs-keyword'>data</span> <span class='hs-conid'>EpaLocation</span> <span class='hs-keyglyph'>=</span> <span class='hs-conid'>EpaSpan</span> <span class='hs-varop'>!</span><span class='hs-conid'>RealSrcSpan</span>
<a name="line-407"></a>                 <span class='hs-keyglyph'>|</span> <span class='hs-conid'>EpaDelta</span> <span class='hs-varop'>!</span><span class='hs-conid'>DeltaPos</span> <span class='hs-varop'>!</span><span class='hs-keyglyph'>[</span><span class='hs-conid'>LEpaComment</span><span class='hs-keyglyph'>]</span>
<a name="line-408"></a>               <span class='hs-keyword'>deriving</span> <span class='hs-layout'>(</span><span class='hs-conid'>Data</span><span class='hs-layout'>,</span><span class='hs-conid'>Eq</span><span class='hs-layout'>,</span><span class='hs-conid'>Ord</span><span class='hs-layout'>)</span>
<a name="line-409"></a>
<a name="line-410"></a><a name="DeltaPos"></a><span class='hs-comment'>-- | Spacing between output items when exact printing.  It captures</span>
<a name="line-411"></a><a name="DeltaPos"></a><span class='hs-comment'>-- the spacing from the current print position on the page to the</span>
<a name="line-412"></a><a name="DeltaPos"></a><span class='hs-comment'>-- position required for the thing about to be printed.  This is</span>
<a name="line-413"></a><a name="DeltaPos"></a><span class='hs-comment'>-- either on the same line in which case is is simply the number of</span>
<a name="line-414"></a><a name="DeltaPos"></a><span class='hs-comment'>-- spaces to emit, or it is some number of lines down, with a given</span>
<a name="line-415"></a><a name="DeltaPos"></a><span class='hs-comment'>-- column offset.  The exact printing algorithm keeps track of the</span>
<a name="line-416"></a><a name="DeltaPos"></a><span class='hs-comment'>-- column offset pertaining to the current anchor position, so the</span>
<a name="line-417"></a><a name="DeltaPos"></a><span class='hs-comment'>-- `deltaColumn` is the additional spaces to add in this case.  See</span>
<a name="line-418"></a><a name="DeltaPos"></a><span class='hs-comment'>-- https://gitlab.haskell.org/ghc/ghc/wikis/api-annotations for</span>
<a name="line-419"></a><a name="DeltaPos"></a><span class='hs-comment'>-- details.</span>
<a name="line-420"></a><a name="DeltaPos"></a><span class='hs-keyword'>data</span> <span class='hs-conid'>DeltaPos</span>
<a name="line-421"></a>  <span class='hs-keyglyph'>=</span> <span class='hs-conid'>SameLine</span> <span class='hs-layout'>{</span> <span class='hs-varid'>deltaColumn</span> <span class='hs-keyglyph'>::</span> <span class='hs-varop'>!</span><span class='hs-conid'>Int</span> <span class='hs-layout'>}</span>
<a name="line-422"></a>  <span class='hs-keyglyph'>|</span> <span class='hs-conid'>DifferentLine</span>
<a name="line-423"></a>      <span class='hs-layout'>{</span> <span class='hs-varid'>deltaLine</span>   <span class='hs-keyglyph'>::</span> <span class='hs-varop'>!</span><span class='hs-conid'>Int</span><span class='hs-layout'>,</span> <span class='hs-comment'>-- ^ deltaLine should always be &gt; 0</span>
<a name="line-424"></a>        <span class='hs-varid'>deltaColumn</span> <span class='hs-keyglyph'>::</span> <span class='hs-varop'>!</span><span class='hs-conid'>Int</span>
<a name="line-425"></a>      <span class='hs-layout'>}</span> <span class='hs-keyword'>deriving</span> <span class='hs-layout'>(</span><span class='hs-conid'>Show</span><span class='hs-layout'>,</span><span class='hs-conid'>Eq</span><span class='hs-layout'>,</span><span class='hs-conid'>Ord</span><span class='hs-layout'>,</span><span class='hs-conid'>Data</span><span class='hs-layout'>)</span>
<a name="line-426"></a>
<a name="line-427"></a><a name="deltaPos"></a><span class='hs-comment'>-- | Smart constructor for a 'DeltaPos'. It preserves the invariant</span>
<a name="line-428"></a><span class='hs-comment'>-- that for the 'DifferentLine' constructor 'deltaLine' is always &gt; 0.</span>
<a name="line-429"></a><span class='hs-definition'>deltaPos</span> <span class='hs-keyglyph'>::</span> <span class='hs-conid'>Int</span> <span class='hs-keyglyph'>-&gt;</span> <span class='hs-conid'>Int</span> <span class='hs-keyglyph'>-&gt;</span> <span class='hs-conid'>DeltaPos</span>
<a name="line-430"></a><span class='hs-definition'>deltaPos</span> <span class='hs-varid'>l</span> <span class='hs-varid'>c</span> <span class='hs-keyglyph'>=</span> <span class='hs-keyword'>case</span> <span class='hs-varid'>l</span> <span class='hs-keyword'>of</span>
<a name="line-431"></a>  <span class='hs-num'>0</span> <span class='hs-keyglyph'>-&gt;</span> <span class='hs-conid'>SameLine</span> <span class='hs-varid'>c</span>
<a name="line-432"></a>  <span class='hs-keyword'>_</span> <span class='hs-keyglyph'>-&gt;</span> <span class='hs-conid'>DifferentLine</span> <span class='hs-varid'>l</span> <span class='hs-varid'>c</span>
<a name="line-433"></a>
<a name="line-434"></a><a name="getDeltaLine"></a><span class='hs-definition'>getDeltaLine</span> <span class='hs-keyglyph'>::</span> <span class='hs-conid'>DeltaPos</span> <span class='hs-keyglyph'>-&gt;</span> <span class='hs-conid'>Int</span>
<a name="line-435"></a><span class='hs-definition'>getDeltaLine</span> <span class='hs-layout'>(</span><span class='hs-conid'>SameLine</span> <span class='hs-keyword'>_</span><span class='hs-layout'>)</span> <span class='hs-keyglyph'>=</span> <span class='hs-num'>0</span>
<a name="line-436"></a><span class='hs-definition'>getDeltaLine</span> <span class='hs-layout'>(</span><span class='hs-conid'>DifferentLine</span> <span class='hs-varid'>r</span> <span class='hs-keyword'>_</span><span class='hs-layout'>)</span> <span class='hs-keyglyph'>=</span> <span class='hs-varid'>r</span>
<a name="line-437"></a>
<a name="line-438"></a><a name="epaLocationRealSrcSpan"></a><span class='hs-comment'>-- | Used in the parser only, extract the 'RealSrcSpan' from an</span>
<a name="line-439"></a><span class='hs-comment'>-- 'EpaLocation'. The parser will never insert a 'DeltaPos', so the</span>
<a name="line-440"></a><span class='hs-comment'>-- partial function is safe.</span>
<a name="line-441"></a><span class='hs-definition'>epaLocationRealSrcSpan</span> <span class='hs-keyglyph'>::</span> <span class='hs-conid'>EpaLocation</span> <span class='hs-keyglyph'>-&gt;</span> <span class='hs-conid'>RealSrcSpan</span>
<a name="line-442"></a><span class='hs-definition'>epaLocationRealSrcSpan</span> <span class='hs-layout'>(</span><span class='hs-conid'>EpaSpan</span> <span class='hs-varid'>r</span><span class='hs-layout'>)</span> <span class='hs-keyglyph'>=</span> <span class='hs-varid'>r</span>
<a name="line-443"></a><span class='hs-definition'>epaLocationRealSrcSpan</span> <span class='hs-layout'>(</span><span class='hs-conid'>EpaDelta</span> <span class='hs-keyword'>_</span> <span class='hs-keyword'>_</span><span class='hs-layout'>)</span> <span class='hs-keyglyph'>=</span> <span class='hs-varid'>panic</span> <span class='hs-str'>"epaLocationRealSrcSpan"</span>
<a name="line-444"></a>
<a name="line-445"></a><a name="epaLocationFromSrcAnn"></a><span class='hs-definition'>epaLocationFromSrcAnn</span> <span class='hs-keyglyph'>::</span> <span class='hs-conid'>SrcAnn</span> <span class='hs-varid'>ann</span> <span class='hs-keyglyph'>-&gt;</span> <span class='hs-conid'>EpaLocation</span>
<a name="line-446"></a><span class='hs-definition'>epaLocationFromSrcAnn</span> <span class='hs-layout'>(</span><span class='hs-conid'>SrcSpanAnn</span> <span class='hs-conid'>EpAnnNotUsed</span> <span class='hs-varid'>l</span><span class='hs-layout'>)</span> <span class='hs-keyglyph'>=</span> <span class='hs-conid'>EpaSpan</span> <span class='hs-layout'>(</span><span class='hs-varid'>realSrcSpan</span> <span class='hs-varid'>l</span><span class='hs-layout'>)</span>
<a name="line-447"></a><span class='hs-definition'>epaLocationFromSrcAnn</span> <span class='hs-layout'>(</span><span class='hs-conid'>SrcSpanAnn</span> <span class='hs-layout'>(</span><span class='hs-conid'>EpAnn</span> <span class='hs-varid'>anc</span> <span class='hs-keyword'>_</span> <span class='hs-keyword'>_</span><span class='hs-layout'>)</span> <span class='hs-keyword'>_</span><span class='hs-layout'>)</span> <span class='hs-keyglyph'>=</span> <span class='hs-conid'>EpaSpan</span> <span class='hs-layout'>(</span><span class='hs-varid'>anchor</span> <span class='hs-varid'>anc</span><span class='hs-layout'>)</span>
<a name="line-448"></a>
<a name="line-449"></a><a name="instance%20Outputable%20EpaLocation"></a><span class='hs-keyword'>instance</span> <span class='hs-conid'>Outputable</span> <span class='hs-conid'>EpaLocation</span> <span class='hs-keyword'>where</span>
<a name="line-450"></a>  <span class='hs-varid'>ppr</span> <span class='hs-layout'>(</span><span class='hs-conid'>EpaSpan</span> <span class='hs-varid'>r</span><span class='hs-layout'>)</span> <span class='hs-keyglyph'>=</span> <span class='hs-varid'>text</span> <span class='hs-str'>"EpaSpan"</span> <span class='hs-varop'>&lt;+&gt;</span> <span class='hs-varid'>ppr</span> <span class='hs-varid'>r</span>
<a name="line-451"></a>  <span class='hs-varid'>ppr</span> <span class='hs-layout'>(</span><span class='hs-conid'>EpaDelta</span> <span class='hs-varid'>d</span> <span class='hs-varid'>cs</span><span class='hs-layout'>)</span> <span class='hs-keyglyph'>=</span> <span class='hs-varid'>text</span> <span class='hs-str'>"EpaDelta"</span> <span class='hs-varop'>&lt;+&gt;</span> <span class='hs-varid'>ppr</span> <span class='hs-varid'>d</span> <span class='hs-varop'>&lt;+&gt;</span> <span class='hs-varid'>ppr</span> <span class='hs-varid'>cs</span>
<a name="line-452"></a>
<a name="line-453"></a><a name="instance%20Outputable%20AddEpAnn"></a><span class='hs-keyword'>instance</span> <span class='hs-conid'>Outputable</span> <span class='hs-conid'>AddEpAnn</span> <span class='hs-keyword'>where</span>
<a name="line-454"></a>  <span class='hs-varid'>ppr</span> <span class='hs-layout'>(</span><span class='hs-conid'>AddEpAnn</span> <span class='hs-varid'>kw</span> <span class='hs-varid'>ss</span><span class='hs-layout'>)</span> <span class='hs-keyglyph'>=</span> <span class='hs-varid'>text</span> <span class='hs-str'>"AddEpAnn"</span> <span class='hs-varop'>&lt;+&gt;</span> <span class='hs-varid'>ppr</span> <span class='hs-varid'>kw</span> <span class='hs-varop'>&lt;+&gt;</span> <span class='hs-varid'>ppr</span> <span class='hs-varid'>ss</span>
<a name="line-455"></a>
<a name="line-456"></a><a name="instance%20Ord%20AddEpAnn"></a><span class='hs-keyword'>instance</span> <span class='hs-conid'>Ord</span> <span class='hs-conid'>AddEpAnn</span> <span class='hs-keyword'>where</span>
<a name="line-457"></a>  <span class='hs-varid'>compare</span> <span class='hs-layout'>(</span><span class='hs-conid'>AddEpAnn</span> <span class='hs-varid'>kw1</span> <span class='hs-varid'>loc1</span><span class='hs-layout'>)</span> <span class='hs-layout'>(</span><span class='hs-conid'>AddEpAnn</span> <span class='hs-varid'>kw2</span> <span class='hs-varid'>loc2</span><span class='hs-layout'>)</span> <span class='hs-keyglyph'>=</span> <span class='hs-varid'>compare</span> <span class='hs-layout'>(</span><span class='hs-varid'>loc1</span><span class='hs-layout'>,</span> <span class='hs-varid'>kw1</span><span class='hs-layout'>)</span> <span class='hs-layout'>(</span><span class='hs-varid'>loc2</span><span class='hs-layout'>,</span><span class='hs-varid'>kw2</span><span class='hs-layout'>)</span>
<a name="line-458"></a>
<a name="line-459"></a><span class='hs-comment'>-- ---------------------------------------------------------------------</span>
<a name="line-460"></a>
<a name="line-461"></a><a name="EpAnn"></a><span class='hs-comment'>-- | The exact print annotations (EPAs) are kept in the HsSyn AST for</span>
<a name="line-462"></a><a name="EpAnn"></a><span class='hs-comment'>--   the GhcPs phase. We do not always have EPAs though, only for code</span>
<a name="line-463"></a><a name="EpAnn"></a><span class='hs-comment'>--   that has been parsed as they do not exist for generated</span>
<a name="line-464"></a><a name="EpAnn"></a><span class='hs-comment'>--   code. This type captures that they may be missing.</span>
<a name="line-465"></a><a name="EpAnn"></a><span class='hs-comment'>--</span>
<a name="line-466"></a><a name="EpAnn"></a><span class='hs-comment'>-- A goal of the annotations is that an AST can be edited, including</span>
<a name="line-467"></a><a name="EpAnn"></a><span class='hs-comment'>-- moving subtrees from one place to another, duplicating them, and so</span>
<a name="line-468"></a><a name="EpAnn"></a><span class='hs-comment'>-- on.  This means that each fragment must be self-contained.  To this</span>
<a name="line-469"></a><a name="EpAnn"></a><span class='hs-comment'>-- end, each annotated fragment keeps track of the anchor position it</span>
<a name="line-470"></a><a name="EpAnn"></a><span class='hs-comment'>-- was originally captured at, being simply the start span of the</span>
<a name="line-471"></a><a name="EpAnn"></a><span class='hs-comment'>-- topmost element of the ast fragment.  This gives us a way to later</span>
<a name="line-472"></a><a name="EpAnn"></a><span class='hs-comment'>-- re-calculate all Located items in this layer of the AST, as well as</span>
<a name="line-473"></a><a name="EpAnn"></a><span class='hs-comment'>-- any annotations captured. The comments associated with the AST</span>
<a name="line-474"></a><a name="EpAnn"></a><span class='hs-comment'>-- fragment are also captured here.</span>
<a name="line-475"></a><a name="EpAnn"></a><span class='hs-comment'>--</span>
<a name="line-476"></a><a name="EpAnn"></a><span class='hs-comment'>-- The 'ann' type parameter allows this general structure to be</span>
<a name="line-477"></a><a name="EpAnn"></a><span class='hs-comment'>-- specialised to the specific set of locations of original exact</span>
<a name="line-478"></a><a name="EpAnn"></a><span class='hs-comment'>-- print annotation elements.  So for 'HsLet' we have</span>
<a name="line-479"></a><a name="EpAnn"></a><span class='hs-comment'>--</span>
<a name="line-480"></a><a name="EpAnn"></a><span class='hs-comment'>--    type instance XLet GhcPs = EpAnn AnnsLet</span>
<a name="line-481"></a><a name="EpAnn"></a><span class='hs-comment'>--    data AnnsLet</span>
<a name="line-482"></a><a name="EpAnn"></a><span class='hs-comment'>--      = AnnsLet {</span>
<a name="line-483"></a><a name="EpAnn"></a><span class='hs-comment'>--          alLet :: EpaLocation,</span>
<a name="line-484"></a><a name="EpAnn"></a><span class='hs-comment'>--          alIn :: EpaLocation</span>
<a name="line-485"></a><a name="EpAnn"></a><span class='hs-comment'>--          } deriving Data</span>
<a name="line-486"></a><a name="EpAnn"></a><span class='hs-comment'>--</span>
<a name="line-487"></a><a name="EpAnn"></a><span class='hs-comment'>-- The spacing between the items under the scope of a given EpAnn is</span>
<a name="line-488"></a><a name="EpAnn"></a><span class='hs-comment'>-- normally derived from the original 'Anchor'.  But if a sub-element</span>
<a name="line-489"></a><a name="EpAnn"></a><span class='hs-comment'>-- is not in its original position, the required spacing can be</span>
<a name="line-490"></a><a name="EpAnn"></a><span class='hs-comment'>-- directly captured in the 'anchor_op' field of the 'entry' Anchor.</span>
<a name="line-491"></a><a name="EpAnn"></a><span class='hs-comment'>-- This allows us to freely move elements around, and stitch together</span>
<a name="line-492"></a><a name="EpAnn"></a><span class='hs-comment'>-- new AST fragments out of old ones, and have them still printed out</span>
<a name="line-493"></a><a name="EpAnn"></a><span class='hs-comment'>-- in a precise way.</span>
<a name="line-494"></a><a name="EpAnn"></a><span class='hs-keyword'>data</span> <span class='hs-conid'>EpAnn</span> <span class='hs-varid'>ann</span>
<a name="line-495"></a>  <span class='hs-keyglyph'>=</span> <span class='hs-conid'>EpAnn</span> <span class='hs-layout'>{</span> <span class='hs-varid'>entry</span>   <span class='hs-keyglyph'>::</span> <span class='hs-varop'>!</span><span class='hs-conid'>Anchor</span>
<a name="line-496"></a>           <span class='hs-comment'>-- ^ Base location for the start of the syntactic element</span>
<a name="line-497"></a>           <span class='hs-comment'>-- holding the annotations.</span>
<a name="line-498"></a>           <span class='hs-layout'>,</span> <span class='hs-varid'>anns</span>     <span class='hs-keyglyph'>::</span> <span class='hs-varop'>!</span><span class='hs-varid'>ann</span> <span class='hs-comment'>-- ^ Annotations added by the Parser</span>
<a name="line-499"></a>           <span class='hs-layout'>,</span> <span class='hs-varid'>comments</span> <span class='hs-keyglyph'>::</span> <span class='hs-varop'>!</span><span class='hs-conid'>EpAnnComments</span>
<a name="line-500"></a>              <span class='hs-comment'>-- ^ Comments enclosed in the SrcSpan of the element</span>
<a name="line-501"></a>              <span class='hs-comment'>-- this `EpAnn` is attached to</span>
<a name="line-502"></a>           <span class='hs-layout'>}</span>
<a name="line-503"></a>  <span class='hs-keyglyph'>|</span> <span class='hs-conid'>EpAnnNotUsed</span> <span class='hs-comment'>-- ^ No Annotation for generated code,</span>
<a name="line-504"></a>                  <span class='hs-comment'>-- e.g. from TH, deriving, etc.</span>
<a name="line-505"></a>        <span class='hs-keyword'>deriving</span> <span class='hs-layout'>(</span><span class='hs-conid'>Data</span><span class='hs-layout'>,</span> <span class='hs-conid'>Eq</span><span class='hs-layout'>,</span> <span class='hs-conid'>Functor</span><span class='hs-layout'>)</span>
<a name="line-506"></a>
<a name="line-507"></a><span class='hs-comment'>-- | An 'Anchor' records the base location for the start of the</span>
<a name="line-508"></a><span class='hs-comment'>-- syntactic element holding the annotations, and is used as the point</span>
<a name="line-509"></a><span class='hs-comment'>-- of reference for calculating delta positions for contained</span>
<a name="line-510"></a><span class='hs-comment'>-- annotations.</span>
<a name="line-511"></a><span class='hs-comment'>-- It is also normally used as the reference point for the spacing of</span>
<a name="line-512"></a><span class='hs-comment'>-- the element relative to its container. If it is moved, that</span>
<a name="line-513"></a><span class='hs-comment'>-- relationship is tracked in the 'anchor_op' instead.</span>
<a name="line-514"></a>
<a name="line-515"></a><a name="Anchor"></a><span class='hs-keyword'>data</span> <span class='hs-conid'>Anchor</span> <span class='hs-keyglyph'>=</span> <span class='hs-conid'>Anchor</span>        <span class='hs-layout'>{</span> <span class='hs-varid'>anchor</span> <span class='hs-keyglyph'>::</span> <span class='hs-conid'>RealSrcSpan</span>
<a name="line-516"></a>                                 <span class='hs-comment'>-- ^ Base location for the start of</span>
<a name="line-517"></a>                                 <span class='hs-comment'>-- the syntactic element holding</span>
<a name="line-518"></a>                                 <span class='hs-comment'>-- the annotations.</span>
<a name="line-519"></a>                            <span class='hs-layout'>,</span> <span class='hs-varid'>anchor_op</span> <span class='hs-keyglyph'>::</span> <span class='hs-conid'>AnchorOperation</span> <span class='hs-layout'>}</span>
<a name="line-520"></a>        <span class='hs-keyword'>deriving</span> <span class='hs-layout'>(</span><span class='hs-conid'>Data</span><span class='hs-layout'>,</span> <span class='hs-conid'>Eq</span><span class='hs-layout'>,</span> <span class='hs-conid'>Show</span><span class='hs-layout'>)</span>
<a name="line-521"></a>
<a name="line-522"></a><a name="AnchorOperation"></a><span class='hs-comment'>-- | If tools modify the parsed source, the 'MovedAnchor' variant can</span>
<a name="line-523"></a><a name="AnchorOperation"></a><span class='hs-comment'>-- directly provide the spacing for this item relative to the previous</span>
<a name="line-524"></a><a name="AnchorOperation"></a><span class='hs-comment'>-- one when printing. This allows AST fragments with a particular</span>
<a name="line-525"></a><a name="AnchorOperation"></a><span class='hs-comment'>-- anchor to be freely moved, without worrying about recalculating the</span>
<a name="line-526"></a><a name="AnchorOperation"></a><span class='hs-comment'>-- appropriate anchor span.</span>
<a name="line-527"></a><a name="AnchorOperation"></a><span class='hs-keyword'>data</span> <span class='hs-conid'>AnchorOperation</span> <span class='hs-keyglyph'>=</span> <span class='hs-conid'>UnchangedAnchor</span>
<a name="line-528"></a>                     <span class='hs-keyglyph'>|</span> <span class='hs-conid'>MovedAnchor</span> <span class='hs-conid'>DeltaPos</span>
<a name="line-529"></a>        <span class='hs-keyword'>deriving</span> <span class='hs-layout'>(</span><span class='hs-conid'>Data</span><span class='hs-layout'>,</span> <span class='hs-conid'>Eq</span><span class='hs-layout'>,</span> <span class='hs-conid'>Show</span><span class='hs-layout'>)</span>
<a name="line-530"></a>
<a name="line-531"></a>
<a name="line-532"></a><a name="spanAsAnchor"></a><span class='hs-definition'>spanAsAnchor</span> <span class='hs-keyglyph'>::</span> <span class='hs-conid'>SrcSpan</span> <span class='hs-keyglyph'>-&gt;</span> <span class='hs-conid'>Anchor</span>
<a name="line-533"></a><span class='hs-definition'>spanAsAnchor</span> <span class='hs-varid'>s</span>  <span class='hs-keyglyph'>=</span> <span class='hs-conid'>Anchor</span> <span class='hs-layout'>(</span><span class='hs-varid'>realSrcSpan</span> <span class='hs-varid'>s</span><span class='hs-layout'>)</span> <span class='hs-conid'>UnchangedAnchor</span>
<a name="line-534"></a>
<a name="line-535"></a><a name="realSpanAsAnchor"></a><span class='hs-definition'>realSpanAsAnchor</span> <span class='hs-keyglyph'>::</span> <span class='hs-conid'>RealSrcSpan</span> <span class='hs-keyglyph'>-&gt;</span> <span class='hs-conid'>Anchor</span>
<a name="line-536"></a><span class='hs-definition'>realSpanAsAnchor</span> <span class='hs-varid'>s</span>  <span class='hs-keyglyph'>=</span> <span class='hs-conid'>Anchor</span> <span class='hs-varid'>s</span> <span class='hs-conid'>UnchangedAnchor</span>
<a name="line-537"></a>
<a name="line-538"></a><span class='hs-comment'>-- ---------------------------------------------------------------------</span>
<a name="line-539"></a>
<a name="line-540"></a><a name="EpAnnComments"></a><span class='hs-comment'>-- | When we are parsing we add comments that belong a particular AST</span>
<a name="line-541"></a><a name="EpAnnComments"></a><span class='hs-comment'>-- element, and print them together with the element, interleaving</span>
<a name="line-542"></a><a name="EpAnnComments"></a><span class='hs-comment'>-- them into the output stream.  But when editing the AST to move</span>
<a name="line-543"></a><a name="EpAnnComments"></a><span class='hs-comment'>-- fragments around it is useful to be able to first separate the</span>
<a name="line-544"></a><a name="EpAnnComments"></a><span class='hs-comment'>-- comments into those occuring before the AST element and those</span>
<a name="line-545"></a><a name="EpAnnComments"></a><span class='hs-comment'>-- following it.  The 'EpaCommentsBalanced' constructor is used to do</span>
<a name="line-546"></a><a name="EpAnnComments"></a><span class='hs-comment'>-- this. The GHC parser will only insert the 'EpaComments' form.</span>
<a name="line-547"></a><a name="EpAnnComments"></a><span class='hs-keyword'>data</span> <span class='hs-conid'>EpAnnComments</span> <span class='hs-keyglyph'>=</span> <span class='hs-conid'>EpaComments</span>
<a name="line-548"></a>                        <span class='hs-layout'>{</span> <span class='hs-varid'>priorComments</span> <span class='hs-keyglyph'>::</span> <span class='hs-varop'>!</span><span class='hs-keyglyph'>[</span><span class='hs-conid'>LEpaComment</span><span class='hs-keyglyph'>]</span> <span class='hs-layout'>}</span>
<a name="line-549"></a>                    <span class='hs-keyglyph'>|</span> <span class='hs-conid'>EpaCommentsBalanced</span>
<a name="line-550"></a>                        <span class='hs-layout'>{</span> <span class='hs-varid'>priorComments</span> <span class='hs-keyglyph'>::</span> <span class='hs-varop'>!</span><span class='hs-keyglyph'>[</span><span class='hs-conid'>LEpaComment</span><span class='hs-keyglyph'>]</span>
<a name="line-551"></a>                        <span class='hs-layout'>,</span> <span class='hs-varid'>followingComments</span> <span class='hs-keyglyph'>::</span> <span class='hs-varop'>!</span><span class='hs-keyglyph'>[</span><span class='hs-conid'>LEpaComment</span><span class='hs-keyglyph'>]</span> <span class='hs-layout'>}</span>
<a name="line-552"></a>        <span class='hs-keyword'>deriving</span> <span class='hs-layout'>(</span><span class='hs-conid'>Data</span><span class='hs-layout'>,</span> <span class='hs-conid'>Eq</span><span class='hs-layout'>)</span>
<a name="line-553"></a>
<a name="line-554"></a><a name="LEpaComment"></a><span class='hs-keyword'>type</span> <span class='hs-conid'>LEpaComment</span> <span class='hs-keyglyph'>=</span> <span class='hs-conid'>GenLocated</span> <span class='hs-conid'>Anchor</span> <span class='hs-conid'>EpaComment</span>
<a name="line-555"></a>
<a name="line-556"></a><a name="emptyComments"></a><span class='hs-definition'>emptyComments</span> <span class='hs-keyglyph'>::</span> <span class='hs-conid'>EpAnnComments</span>
<a name="line-557"></a><span class='hs-definition'>emptyComments</span> <span class='hs-keyglyph'>=</span> <span class='hs-conid'>EpaComments</span> <span class='hs-conid'>[]</span>
<a name="line-558"></a>
<a name="line-559"></a><span class='hs-comment'>-- ---------------------------------------------------------------------</span>
<a name="line-560"></a><span class='hs-comment'>-- Annotations attached to a 'SrcSpan'.</span>
<a name="line-561"></a><span class='hs-comment'>-- ---------------------------------------------------------------------</span>
<a name="line-562"></a>
<a name="line-563"></a><span class='hs-comment'>-- | The 'SrcSpanAnn\'' type wraps a normal 'SrcSpan', together with</span>
<a name="line-564"></a><span class='hs-comment'>-- an extra annotation type. This is mapped to a specific `GenLocated`</span>
<a name="line-565"></a><span class='hs-comment'>-- usage in the AST through the `XRec` and `Anno` type families.</span>
<a name="line-566"></a>
<a name="line-567"></a><a name="SrcSpanAnn'"></a><span class='hs-comment'>-- Important that the fields are strict as these live inside L nodes which</span>
<a name="line-568"></a><a name="SrcSpanAnn'"></a><span class='hs-comment'>-- are live for a long time.</span>
<a name="line-569"></a><a name="SrcSpanAnn'"></a><span class='hs-keyword'>data</span> <span class='hs-conid'>SrcSpanAnn'</span> <span class='hs-varid'>a</span> <span class='hs-keyglyph'>=</span> <span class='hs-conid'>SrcSpanAnn</span> <span class='hs-layout'>{</span> <span class='hs-varid'>ann</span> <span class='hs-keyglyph'>::</span> <span class='hs-varop'>!</span><span class='hs-varid'>a</span><span class='hs-layout'>,</span> <span class='hs-varid'>locA</span> <span class='hs-keyglyph'>::</span> <span class='hs-varop'>!</span><span class='hs-conid'>SrcSpan</span> <span class='hs-layout'>}</span>
<a name="line-570"></a>        <span class='hs-keyword'>deriving</span> <span class='hs-layout'>(</span><span class='hs-conid'>Data</span><span class='hs-layout'>,</span> <span class='hs-conid'>Eq</span><span class='hs-layout'>)</span>
<a name="line-571"></a><span class='hs-comment'>-- See Note [XRec and Anno in the AST]</span>
<a name="line-572"></a>
<a name="line-573"></a><a name="SrcAnn"></a><span class='hs-comment'>-- | We mostly use 'SrcSpanAnn\'' with an 'EpAnn\''</span>
<a name="line-574"></a><a name="SrcAnn"></a><span class='hs-keyword'>type</span> <span class='hs-conid'>SrcAnn</span> <span class='hs-varid'>ann</span> <span class='hs-keyglyph'>=</span> <span class='hs-conid'>SrcSpanAnn'</span> <span class='hs-layout'>(</span><span class='hs-conid'>EpAnn</span> <span class='hs-varid'>ann</span><span class='hs-layout'>)</span>
<a name="line-575"></a>
<a name="line-576"></a><a name="LocatedA"></a><span class='hs-keyword'>type</span> <span class='hs-conid'>LocatedA</span> <span class='hs-keyglyph'>=</span> <span class='hs-conid'>GenLocated</span> <span class='hs-conid'>SrcSpanAnnA</span>
<a name="line-577"></a><a name="LocatedN"></a><span class='hs-keyword'>type</span> <span class='hs-conid'>LocatedN</span> <span class='hs-keyglyph'>=</span> <span class='hs-conid'>GenLocated</span> <span class='hs-conid'>SrcSpanAnnN</span>
<a name="line-578"></a>
<a name="line-579"></a><a name="LocatedL"></a><span class='hs-keyword'>type</span> <span class='hs-conid'>LocatedL</span> <span class='hs-keyglyph'>=</span> <span class='hs-conid'>GenLocated</span> <span class='hs-conid'>SrcSpanAnnL</span>
<a name="line-580"></a><a name="LocatedP"></a><span class='hs-keyword'>type</span> <span class='hs-conid'>LocatedP</span> <span class='hs-keyglyph'>=</span> <span class='hs-conid'>GenLocated</span> <span class='hs-conid'>SrcSpanAnnP</span>
<a name="line-581"></a><a name="LocatedC"></a><span class='hs-keyword'>type</span> <span class='hs-conid'>LocatedC</span> <span class='hs-keyglyph'>=</span> <span class='hs-conid'>GenLocated</span> <span class='hs-conid'>SrcSpanAnnC</span>
<a name="line-582"></a>
<a name="line-583"></a><a name="SrcSpanAnnA"></a><span class='hs-keyword'>type</span> <span class='hs-conid'>SrcSpanAnnA</span> <span class='hs-keyglyph'>=</span> <span class='hs-conid'>SrcAnn</span> <span class='hs-conid'>AnnListItem</span>
<a name="line-584"></a><a name="SrcSpanAnnN"></a><span class='hs-keyword'>type</span> <span class='hs-conid'>SrcSpanAnnN</span> <span class='hs-keyglyph'>=</span> <span class='hs-conid'>SrcAnn</span> <span class='hs-conid'>NameAnn</span>
<a name="line-585"></a>
<a name="line-586"></a><a name="SrcSpanAnnL"></a><span class='hs-keyword'>type</span> <span class='hs-conid'>SrcSpanAnnL</span> <span class='hs-keyglyph'>=</span> <span class='hs-conid'>SrcAnn</span> <span class='hs-conid'>AnnList</span>
<a name="line-587"></a><a name="SrcSpanAnnP"></a><span class='hs-keyword'>type</span> <span class='hs-conid'>SrcSpanAnnP</span> <span class='hs-keyglyph'>=</span> <span class='hs-conid'>SrcAnn</span> <span class='hs-conid'>AnnPragma</span>
<a name="line-588"></a><a name="SrcSpanAnnC"></a><span class='hs-keyword'>type</span> <span class='hs-conid'>SrcSpanAnnC</span> <span class='hs-keyglyph'>=</span> <span class='hs-conid'>SrcAnn</span> <span class='hs-conid'>AnnContext</span>
<a name="line-589"></a>
<a name="line-590"></a><a name="LocatedAn"></a><span class='hs-comment'>-- | General representation of a 'GenLocated' type carrying a</span>
<a name="line-591"></a><a name="LocatedAn"></a><span class='hs-comment'>-- parameterised annotation type.</span>
<a name="line-592"></a><a name="LocatedAn"></a><span class='hs-keyword'>type</span> <span class='hs-conid'>LocatedAn</span> <span class='hs-varid'>an</span> <span class='hs-keyglyph'>=</span> <span class='hs-conid'>GenLocated</span> <span class='hs-layout'>(</span><span class='hs-conid'>SrcAnn</span> <span class='hs-varid'>an</span><span class='hs-layout'>)</span>
<a name="line-593"></a>
<a name="line-594"></a><span class='hs-comment'>{-
<a name="line-595"></a>Note [XRec and Anno in the AST]
<a name="line-596"></a>~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~
<a name="line-597"></a>
<a name="line-598"></a>The exact print annotations are captured directly inside the AST, using
<a name="line-599"></a>TTG extension points. However certain annotations need to be captured
<a name="line-600"></a>on the Located versions too.  While there is a general form for these,
<a name="line-601"></a>captured in the type SrcSpanAnn', there are also specific usages in
<a name="line-602"></a>different contexts.
<a name="line-603"></a>
<a name="line-604"></a>Some of the particular use cases are
<a name="line-605"></a>
<a name="line-606"></a>1) RdrNames, which can have additional items such as backticks or parens
<a name="line-607"></a>
<a name="line-608"></a>2) Items which occur in lists, and the annotation relates purely
<a name="line-609"></a>to its usage inside a list.
<a name="line-610"></a>
<a name="line-611"></a>See the section above this note for the rest.
<a name="line-612"></a>
<a name="line-613"></a>The Anno type family maps the specific SrcSpanAnn' variant for a given
<a name="line-614"></a>item.
<a name="line-615"></a>
<a name="line-616"></a>So
<a name="line-617"></a>
<a name="line-618"></a>  type instance XRec (GhcPass p) a = GenLocated (Anno a) a
<a name="line-619"></a>  type instance Anno RdrName = SrcSpanAnnN
<a name="line-620"></a>  type LocatedN = GenLocated SrcSpanAnnN
<a name="line-621"></a>
<a name="line-622"></a>meaning we can have type LocatedN RdrName
<a name="line-623"></a>
<a name="line-624"></a>-}</span>
<a name="line-625"></a>
<a name="line-626"></a><span class='hs-comment'>-- ---------------------------------------------------------------------</span>
<a name="line-627"></a><span class='hs-comment'>-- Annotations for items in a list</span>
<a name="line-628"></a><span class='hs-comment'>-- ---------------------------------------------------------------------</span>
<a name="line-629"></a>
<a name="line-630"></a><a name="TrailingAnn"></a><span class='hs-comment'>-- | Captures the location of punctuation occuring between items,</span>
<a name="line-631"></a><a name="TrailingAnn"></a><span class='hs-comment'>-- normally in a list.  It is captured as a trailing annotation.</span>
<a name="line-632"></a><a name="TrailingAnn"></a><span class='hs-keyword'>data</span> <span class='hs-conid'>TrailingAnn</span>
<a name="line-633"></a>  <span class='hs-keyglyph'>=</span> <span class='hs-conid'>AddSemiAnn</span> <span class='hs-conid'>EpaLocation</span>    <span class='hs-comment'>-- ^ Trailing ';'</span>
<a name="line-634"></a>  <span class='hs-keyglyph'>|</span> <span class='hs-conid'>AddCommaAnn</span> <span class='hs-conid'>EpaLocation</span>   <span class='hs-comment'>-- ^ Trailing ','</span>
<a name="line-635"></a>  <span class='hs-keyglyph'>|</span> <span class='hs-conid'>AddVbarAnn</span> <span class='hs-conid'>EpaLocation</span>    <span class='hs-comment'>-- ^ Trailing '|'</span>
<a name="line-636"></a>  <span class='hs-keyglyph'>|</span> <span class='hs-conid'>AddRarrowAnn</span> <span class='hs-conid'>EpaLocation</span>  <span class='hs-comment'>-- ^ Trailing '-&gt;'</span>
<a name="line-637"></a>  <span class='hs-keyglyph'>|</span> <span class='hs-conid'>AddRarrowAnnU</span> <span class='hs-conid'>EpaLocation</span> <span class='hs-comment'>-- ^ Trailing '-&gt;', unicode variant</span>
<a name="line-638"></a>  <span class='hs-keyglyph'>|</span> <span class='hs-conid'>AddLollyAnnU</span> <span class='hs-conid'>EpaLocation</span>  <span class='hs-comment'>-- ^ Trailing '⊸'</span>
<a name="line-639"></a>  <span class='hs-keyword'>deriving</span> <span class='hs-layout'>(</span><span class='hs-conid'>Data</span><span class='hs-layout'>,</span><span class='hs-conid'>Eq</span><span class='hs-layout'>,</span> <span class='hs-conid'>Ord</span><span class='hs-layout'>)</span>
<a name="line-640"></a>
<a name="line-641"></a><a name="instance%20Outputable%20TrailingAnn"></a><span class='hs-keyword'>instance</span> <span class='hs-conid'>Outputable</span> <span class='hs-conid'>TrailingAnn</span> <span class='hs-keyword'>where</span>
<a name="line-642"></a>  <span class='hs-varid'>ppr</span> <span class='hs-layout'>(</span><span class='hs-conid'>AddSemiAnn</span> <span class='hs-varid'>ss</span><span class='hs-layout'>)</span>    <span class='hs-keyglyph'>=</span> <span class='hs-varid'>text</span> <span class='hs-str'>"AddSemiAnn"</span>    <span class='hs-varop'>&lt;+&gt;</span> <span class='hs-varid'>ppr</span> <span class='hs-varid'>ss</span>
<a name="line-643"></a>  <span class='hs-varid'>ppr</span> <span class='hs-layout'>(</span><span class='hs-conid'>AddCommaAnn</span> <span class='hs-varid'>ss</span><span class='hs-layout'>)</span>   <span class='hs-keyglyph'>=</span> <span class='hs-varid'>text</span> <span class='hs-str'>"AddCommaAnn"</span>   <span class='hs-varop'>&lt;+&gt;</span> <span class='hs-varid'>ppr</span> <span class='hs-varid'>ss</span>
<a name="line-644"></a>  <span class='hs-varid'>ppr</span> <span class='hs-layout'>(</span><span class='hs-conid'>AddVbarAnn</span> <span class='hs-varid'>ss</span><span class='hs-layout'>)</span>    <span class='hs-keyglyph'>=</span> <span class='hs-varid'>text</span> <span class='hs-str'>"AddVbarAnn"</span>    <span class='hs-varop'>&lt;+&gt;</span> <span class='hs-varid'>ppr</span> <span class='hs-varid'>ss</span>
<a name="line-645"></a>  <span class='hs-varid'>ppr</span> <span class='hs-layout'>(</span><span class='hs-conid'>AddRarrowAnn</span> <span class='hs-varid'>ss</span><span class='hs-layout'>)</span>  <span class='hs-keyglyph'>=</span> <span class='hs-varid'>text</span> <span class='hs-str'>"AddRarrowAnn"</span>  <span class='hs-varop'>&lt;+&gt;</span> <span class='hs-varid'>ppr</span> <span class='hs-varid'>ss</span>
<a name="line-646"></a>  <span class='hs-varid'>ppr</span> <span class='hs-layout'>(</span><span class='hs-conid'>AddRarrowAnnU</span> <span class='hs-varid'>ss</span><span class='hs-layout'>)</span> <span class='hs-keyglyph'>=</span> <span class='hs-varid'>text</span> <span class='hs-str'>"AddRarrowAnnU"</span> <span class='hs-varop'>&lt;+&gt;</span> <span class='hs-varid'>ppr</span> <span class='hs-varid'>ss</span>
<a name="line-647"></a>  <span class='hs-varid'>ppr</span> <span class='hs-layout'>(</span><span class='hs-conid'>AddLollyAnnU</span> <span class='hs-varid'>ss</span><span class='hs-layout'>)</span>  <span class='hs-keyglyph'>=</span> <span class='hs-varid'>text</span> <span class='hs-str'>"AddLollyAnnU"</span>  <span class='hs-varop'>&lt;+&gt;</span> <span class='hs-varid'>ppr</span> <span class='hs-varid'>ss</span>
<a name="line-648"></a>
<a name="line-649"></a><a name="AnnListItem"></a><span class='hs-comment'>-- | Annotation for items appearing in a list. They can have one or</span>
<a name="line-650"></a><a name="AnnListItem"></a><span class='hs-comment'>-- more trailing punctuations items, such as commas or semicolons.</span>
<a name="line-651"></a><a name="AnnListItem"></a><span class='hs-keyword'>data</span> <span class='hs-conid'>AnnListItem</span>
<a name="line-652"></a>  <span class='hs-keyglyph'>=</span> <span class='hs-conid'>AnnListItem</span> <span class='hs-layout'>{</span>
<a name="line-653"></a>      <span class='hs-varid'>lann_trailing</span>  <span class='hs-keyglyph'>::</span> <span class='hs-keyglyph'>[</span><span class='hs-conid'>TrailingAnn</span><span class='hs-keyglyph'>]</span>
<a name="line-654"></a>      <span class='hs-layout'>}</span>
<a name="line-655"></a>  <span class='hs-keyword'>deriving</span> <span class='hs-layout'>(</span><span class='hs-conid'>Data</span><span class='hs-layout'>,</span> <span class='hs-conid'>Eq</span><span class='hs-layout'>)</span>
<a name="line-656"></a>
<a name="line-657"></a><span class='hs-comment'>-- ---------------------------------------------------------------------</span>
<a name="line-658"></a><span class='hs-comment'>-- Annotations for the context of a list of items</span>
<a name="line-659"></a><span class='hs-comment'>-- ---------------------------------------------------------------------</span>
<a name="line-660"></a>
<a name="line-661"></a><a name="AnnList"></a><span class='hs-comment'>-- | Annotation for the "container" of a list. This captures</span>
<a name="line-662"></a><a name="AnnList"></a><span class='hs-comment'>-- surrounding items such as braces if present, and introductory</span>
<a name="line-663"></a><a name="AnnList"></a><span class='hs-comment'>-- keywords such as 'where'.</span>
<a name="line-664"></a><a name="AnnList"></a><span class='hs-keyword'>data</span> <span class='hs-conid'>AnnList</span>
<a name="line-665"></a>  <span class='hs-keyglyph'>=</span> <span class='hs-conid'>AnnList</span> <span class='hs-layout'>{</span>
<a name="line-666"></a>      <span class='hs-varid'>al_anchor</span>    <span class='hs-keyglyph'>::</span> <span class='hs-conid'>Maybe</span> <span class='hs-conid'>Anchor</span><span class='hs-layout'>,</span> <span class='hs-comment'>-- ^ start point of a list having layout</span>
<a name="line-667"></a>      <span class='hs-varid'>al_open</span>      <span class='hs-keyglyph'>::</span> <span class='hs-conid'>Maybe</span> <span class='hs-conid'>AddEpAnn</span><span class='hs-layout'>,</span>
<a name="line-668"></a>      <span class='hs-varid'>al_close</span>     <span class='hs-keyglyph'>::</span> <span class='hs-conid'>Maybe</span> <span class='hs-conid'>AddEpAnn</span><span class='hs-layout'>,</span>
<a name="line-669"></a>      <span class='hs-varid'>al_rest</span>      <span class='hs-keyglyph'>::</span> <span class='hs-keyglyph'>[</span><span class='hs-conid'>AddEpAnn</span><span class='hs-keyglyph'>]</span><span class='hs-layout'>,</span> <span class='hs-comment'>-- ^ context, such as 'where' keyword</span>
<a name="line-670"></a>      <span class='hs-varid'>al_trailing</span>  <span class='hs-keyglyph'>::</span> <span class='hs-keyglyph'>[</span><span class='hs-conid'>TrailingAnn</span><span class='hs-keyglyph'>]</span> <span class='hs-comment'>-- ^ items appearing after the</span>
<a name="line-671"></a>                                    <span class='hs-comment'>-- list, such as '=&gt;' for a</span>
<a name="line-672"></a>                                    <span class='hs-comment'>-- context</span>
<a name="line-673"></a>      <span class='hs-layout'>}</span> <span class='hs-keyword'>deriving</span> <span class='hs-layout'>(</span><span class='hs-conid'>Data</span><span class='hs-layout'>,</span><span class='hs-conid'>Eq</span><span class='hs-layout'>)</span>
<a name="line-674"></a>
<a name="line-675"></a><span class='hs-comment'>-- ---------------------------------------------------------------------</span>
<a name="line-676"></a><span class='hs-comment'>-- Annotations for parenthesised elements, such as tuples, lists</span>
<a name="line-677"></a><span class='hs-comment'>-- ---------------------------------------------------------------------</span>
<a name="line-678"></a>
<a name="line-679"></a><a name="AnnParen"></a><span class='hs-comment'>-- | exact print annotation for an item having surrounding "brackets", such as</span>
<a name="line-680"></a><a name="AnnParen"></a><span class='hs-comment'>-- tuples or lists</span>
<a name="line-681"></a><a name="AnnParen"></a><span class='hs-keyword'>data</span> <span class='hs-conid'>AnnParen</span>
<a name="line-682"></a>  <span class='hs-keyglyph'>=</span> <span class='hs-conid'>AnnParen</span> <span class='hs-layout'>{</span>
<a name="line-683"></a>      <span class='hs-varid'>ap_adornment</span> <span class='hs-keyglyph'>::</span> <span class='hs-conid'>ParenType</span><span class='hs-layout'>,</span>
<a name="line-684"></a>      <span class='hs-varid'>ap_open</span>      <span class='hs-keyglyph'>::</span> <span class='hs-conid'>EpaLocation</span><span class='hs-layout'>,</span>
<a name="line-685"></a>      <span class='hs-varid'>ap_close</span>     <span class='hs-keyglyph'>::</span> <span class='hs-conid'>EpaLocation</span>
<a name="line-686"></a>      <span class='hs-layout'>}</span> <span class='hs-keyword'>deriving</span> <span class='hs-layout'>(</span><span class='hs-conid'>Data</span><span class='hs-layout'>)</span>
<a name="line-687"></a>
<a name="line-688"></a><a name="ParenType"></a><span class='hs-comment'>-- | Detail of the "brackets" used in an 'AnnParen' exact print annotation.</span>
<a name="line-689"></a><a name="ParenType"></a><span class='hs-keyword'>data</span> <span class='hs-conid'>ParenType</span>
<a name="line-690"></a>  <span class='hs-keyglyph'>=</span> <span class='hs-conid'>AnnParens</span>       <span class='hs-comment'>-- ^ '(', ')'</span>
<a name="line-691"></a>  <span class='hs-keyglyph'>|</span> <span class='hs-conid'>AnnParensHash</span>   <span class='hs-comment'>-- ^ '(#', '#)'</span>
<a name="line-692"></a>  <span class='hs-keyglyph'>|</span> <span class='hs-conid'>AnnParensSquare</span> <span class='hs-comment'>-- ^ '[', ']'</span>
<a name="line-693"></a>  <span class='hs-keyword'>deriving</span> <span class='hs-layout'>(</span><span class='hs-conid'>Eq</span><span class='hs-layout'>,</span> <span class='hs-conid'>Ord</span><span class='hs-layout'>,</span> <span class='hs-conid'>Data</span><span class='hs-layout'>)</span>
<a name="line-694"></a>
<a name="line-695"></a><a name="parenTypeKws"></a><span class='hs-comment'>-- | Maps the 'ParenType' to the related opening and closing</span>
<a name="line-696"></a><span class='hs-comment'>-- AnnKeywordId. Used when actually printing the item.</span>
<a name="line-697"></a><span class='hs-definition'>parenTypeKws</span> <span class='hs-keyglyph'>::</span> <span class='hs-conid'>ParenType</span> <span class='hs-keyglyph'>-&gt;</span> <span class='hs-layout'>(</span><span class='hs-conid'>AnnKeywordId</span><span class='hs-layout'>,</span> <span class='hs-conid'>AnnKeywordId</span><span class='hs-layout'>)</span>
<a name="line-698"></a><span class='hs-definition'>parenTypeKws</span> <span class='hs-conid'>AnnParens</span>       <span class='hs-keyglyph'>=</span> <span class='hs-layout'>(</span><span class='hs-conid'>AnnOpenP</span><span class='hs-layout'>,</span> <span class='hs-conid'>AnnCloseP</span><span class='hs-layout'>)</span>
<a name="line-699"></a><span class='hs-definition'>parenTypeKws</span> <span class='hs-conid'>AnnParensHash</span>   <span class='hs-keyglyph'>=</span> <span class='hs-layout'>(</span><span class='hs-conid'>AnnOpenPH</span><span class='hs-layout'>,</span> <span class='hs-conid'>AnnClosePH</span><span class='hs-layout'>)</span>
<a name="line-700"></a><span class='hs-definition'>parenTypeKws</span> <span class='hs-conid'>AnnParensSquare</span> <span class='hs-keyglyph'>=</span> <span class='hs-layout'>(</span><span class='hs-conid'>AnnOpenS</span><span class='hs-layout'>,</span> <span class='hs-conid'>AnnCloseS</span><span class='hs-layout'>)</span>
<a name="line-701"></a>
<a name="line-702"></a><span class='hs-comment'>-- ---------------------------------------------------------------------</span>
<a name="line-703"></a>
<a name="line-704"></a><a name="AnnContext"></a><span class='hs-comment'>-- | Exact print annotation for the 'Context' data type.</span>
<a name="line-705"></a><a name="AnnContext"></a><span class='hs-keyword'>data</span> <span class='hs-conid'>AnnContext</span>
<a name="line-706"></a>  <span class='hs-keyglyph'>=</span> <span class='hs-conid'>AnnContext</span> <span class='hs-layout'>{</span>
<a name="line-707"></a>      <span class='hs-varid'>ac_darrow</span>    <span class='hs-keyglyph'>::</span> <span class='hs-conid'>Maybe</span> <span class='hs-layout'>(</span><span class='hs-conid'>IsUnicodeSyntax</span><span class='hs-layout'>,</span> <span class='hs-conid'>EpaLocation</span><span class='hs-layout'>)</span><span class='hs-layout'>,</span>
<a name="line-708"></a>                      <span class='hs-comment'>-- ^ location and encoding of the '=&gt;', if present.</span>
<a name="line-709"></a>      <span class='hs-varid'>ac_open</span>      <span class='hs-keyglyph'>::</span> <span class='hs-keyglyph'>[</span><span class='hs-conid'>EpaLocation</span><span class='hs-keyglyph'>]</span><span class='hs-layout'>,</span> <span class='hs-comment'>-- ^ zero or more opening parentheses.</span>
<a name="line-710"></a>      <span class='hs-varid'>ac_close</span>     <span class='hs-keyglyph'>::</span> <span class='hs-keyglyph'>[</span><span class='hs-conid'>EpaLocation</span><span class='hs-keyglyph'>]</span>  <span class='hs-comment'>-- ^ zero or more closing parentheses.</span>
<a name="line-711"></a>      <span class='hs-layout'>}</span> <span class='hs-keyword'>deriving</span> <span class='hs-layout'>(</span><span class='hs-conid'>Data</span><span class='hs-layout'>)</span>
<a name="line-712"></a>
<a name="line-713"></a>
<a name="line-714"></a><span class='hs-comment'>-- ---------------------------------------------------------------------</span>
<a name="line-715"></a><span class='hs-comment'>-- Annotations for names</span>
<a name="line-716"></a><span class='hs-comment'>-- ---------------------------------------------------------------------</span>
<a name="line-717"></a>
<a name="line-718"></a><a name="NameAnn"></a><span class='hs-comment'>-- | exact print annotations for a 'RdrName'.  There are many kinds of</span>
<a name="line-719"></a><a name="NameAnn"></a><span class='hs-comment'>-- adornment that can be attached to a given 'RdrName'. This type</span>
<a name="line-720"></a><a name="NameAnn"></a><span class='hs-comment'>-- captures them, as detailed on the individual constructors.</span>
<a name="line-721"></a><a name="NameAnn"></a><span class='hs-keyword'>data</span> <span class='hs-conid'>NameAnn</span>
<a name="line-722"></a>  <span class='hs-comment'>-- | Used for a name with an adornment, so '`foo`', '(bar)'</span>
<a name="line-723"></a>  <span class='hs-keyglyph'>=</span> <span class='hs-conid'>NameAnn</span> <span class='hs-layout'>{</span>
<a name="line-724"></a>      <span class='hs-varid'>nann_adornment</span> <span class='hs-keyglyph'>::</span> <span class='hs-conid'>NameAdornment</span><span class='hs-layout'>,</span>
<a name="line-725"></a>      <span class='hs-varid'>nann_open</span>      <span class='hs-keyglyph'>::</span> <span class='hs-conid'>EpaLocation</span><span class='hs-layout'>,</span>
<a name="line-726"></a>      <span class='hs-varid'>nann_name</span>      <span class='hs-keyglyph'>::</span> <span class='hs-conid'>EpaLocation</span><span class='hs-layout'>,</span>
<a name="line-727"></a>      <span class='hs-varid'>nann_close</span>     <span class='hs-keyglyph'>::</span> <span class='hs-conid'>EpaLocation</span><span class='hs-layout'>,</span>
<a name="line-728"></a>      <span class='hs-varid'>nann_trailing</span>  <span class='hs-keyglyph'>::</span> <span class='hs-keyglyph'>[</span><span class='hs-conid'>TrailingAnn</span><span class='hs-keyglyph'>]</span>
<a name="line-729"></a>      <span class='hs-layout'>}</span>
<a name="line-730"></a>  <span class='hs-comment'>-- | Used for @(,,,)@, or @(#,,,#)#</span>
<a name="line-731"></a>  <span class='hs-keyglyph'>|</span> <span class='hs-conid'>NameAnnCommas</span> <span class='hs-layout'>{</span>
<a name="line-732"></a>      <span class='hs-varid'>nann_adornment</span> <span class='hs-keyglyph'>::</span> <span class='hs-conid'>NameAdornment</span><span class='hs-layout'>,</span>
<a name="line-733"></a>      <span class='hs-varid'>nann_open</span>      <span class='hs-keyglyph'>::</span> <span class='hs-conid'>EpaLocation</span><span class='hs-layout'>,</span>
<a name="line-734"></a>      <span class='hs-varid'>nann_commas</span>    <span class='hs-keyglyph'>::</span> <span class='hs-keyglyph'>[</span><span class='hs-conid'>EpaLocation</span><span class='hs-keyglyph'>]</span><span class='hs-layout'>,</span>
<a name="line-735"></a>      <span class='hs-varid'>nann_close</span>     <span class='hs-keyglyph'>::</span> <span class='hs-conid'>EpaLocation</span><span class='hs-layout'>,</span>
<a name="line-736"></a>      <span class='hs-varid'>nann_trailing</span>  <span class='hs-keyglyph'>::</span> <span class='hs-keyglyph'>[</span><span class='hs-conid'>TrailingAnn</span><span class='hs-keyglyph'>]</span>
<a name="line-737"></a>      <span class='hs-layout'>}</span>
<a name="line-738"></a>  <span class='hs-comment'>-- | Used for @()@, @(##)@, @[]@</span>
<a name="line-739"></a>  <span class='hs-keyglyph'>|</span> <span class='hs-conid'>NameAnnOnly</span> <span class='hs-layout'>{</span>
<a name="line-740"></a>      <span class='hs-varid'>nann_adornment</span> <span class='hs-keyglyph'>::</span> <span class='hs-conid'>NameAdornment</span><span class='hs-layout'>,</span>
<a name="line-741"></a>      <span class='hs-varid'>nann_open</span>      <span class='hs-keyglyph'>::</span> <span class='hs-conid'>EpaLocation</span><span class='hs-layout'>,</span>
<a name="line-742"></a>      <span class='hs-varid'>nann_close</span>     <span class='hs-keyglyph'>::</span> <span class='hs-conid'>EpaLocation</span><span class='hs-layout'>,</span>
<a name="line-743"></a>      <span class='hs-varid'>nann_trailing</span>  <span class='hs-keyglyph'>::</span> <span class='hs-keyglyph'>[</span><span class='hs-conid'>TrailingAnn</span><span class='hs-keyglyph'>]</span>
<a name="line-744"></a>      <span class='hs-layout'>}</span>
<a name="line-745"></a>  <span class='hs-comment'>-- | Used for @-&gt;@, as an identifier</span>
<a name="line-746"></a>  <span class='hs-keyglyph'>|</span> <span class='hs-conid'>NameAnnRArrow</span> <span class='hs-layout'>{</span>
<a name="line-747"></a>      <span class='hs-varid'>nann_name</span>      <span class='hs-keyglyph'>::</span> <span class='hs-conid'>EpaLocation</span><span class='hs-layout'>,</span>
<a name="line-748"></a>      <span class='hs-varid'>nann_trailing</span>  <span class='hs-keyglyph'>::</span> <span class='hs-keyglyph'>[</span><span class='hs-conid'>TrailingAnn</span><span class='hs-keyglyph'>]</span>
<a name="line-749"></a>      <span class='hs-layout'>}</span>
<a name="line-750"></a>  <span class='hs-comment'>-- | Used for an item with a leading @'@. The annotation for</span>
<a name="line-751"></a>  <span class='hs-comment'>-- unquoted item is stored in 'nann_quoted'.</span>
<a name="line-752"></a>  <span class='hs-keyglyph'>|</span> <span class='hs-conid'>NameAnnQuote</span> <span class='hs-layout'>{</span>
<a name="line-753"></a>      <span class='hs-varid'>nann_quote</span>     <span class='hs-keyglyph'>::</span> <span class='hs-conid'>EpaLocation</span><span class='hs-layout'>,</span>
<a name="line-754"></a>      <span class='hs-varid'>nann_quoted</span>    <span class='hs-keyglyph'>::</span> <span class='hs-conid'>SrcSpanAnnN</span><span class='hs-layout'>,</span>
<a name="line-755"></a>      <span class='hs-varid'>nann_trailing</span>  <span class='hs-keyglyph'>::</span> <span class='hs-keyglyph'>[</span><span class='hs-conid'>TrailingAnn</span><span class='hs-keyglyph'>]</span>
<a name="line-756"></a>      <span class='hs-layout'>}</span>
<a name="line-757"></a>  <span class='hs-comment'>-- | Used when adding a 'TrailingAnn' to an existing 'LocatedN'</span>
<a name="line-758"></a>  <span class='hs-comment'>-- which has no Api Annotation (via the 'EpAnnNotUsed' constructor.</span>
<a name="line-759"></a>  <span class='hs-keyglyph'>|</span> <span class='hs-conid'>NameAnnTrailing</span> <span class='hs-layout'>{</span>
<a name="line-760"></a>      <span class='hs-varid'>nann_trailing</span>  <span class='hs-keyglyph'>::</span> <span class='hs-keyglyph'>[</span><span class='hs-conid'>TrailingAnn</span><span class='hs-keyglyph'>]</span>
<a name="line-761"></a>      <span class='hs-layout'>}</span>
<a name="line-762"></a>  <span class='hs-keyword'>deriving</span> <span class='hs-layout'>(</span><span class='hs-conid'>Data</span><span class='hs-layout'>,</span> <span class='hs-conid'>Eq</span><span class='hs-layout'>)</span>
<a name="line-763"></a>
<a name="line-764"></a><a name="NameAdornment"></a><span class='hs-comment'>-- | A 'NameAnn' can capture the locations of surrounding adornments,</span>
<a name="line-765"></a><a name="NameAdornment"></a><span class='hs-comment'>-- such as parens or backquotes. This data type identifies what</span>
<a name="line-766"></a><a name="NameAdornment"></a><span class='hs-comment'>-- particular pair are being used.</span>
<a name="line-767"></a><a name="NameAdornment"></a><span class='hs-keyword'>data</span> <span class='hs-conid'>NameAdornment</span>
<a name="line-768"></a>  <span class='hs-keyglyph'>=</span> <span class='hs-conid'>NameParens</span> <span class='hs-comment'>-- ^ '(' ')'</span>
<a name="line-769"></a>  <span class='hs-keyglyph'>|</span> <span class='hs-conid'>NameParensHash</span> <span class='hs-comment'>-- ^ '(#' '#)'</span>
<a name="line-770"></a>  <span class='hs-keyglyph'>|</span> <span class='hs-conid'>NameBackquotes</span> <span class='hs-comment'>-- ^ '`'</span>
<a name="line-771"></a>  <span class='hs-keyglyph'>|</span> <span class='hs-conid'>NameSquare</span> <span class='hs-comment'>-- ^ '[' ']'</span>
<a name="line-772"></a>  <span class='hs-keyword'>deriving</span> <span class='hs-layout'>(</span><span class='hs-conid'>Eq</span><span class='hs-layout'>,</span> <span class='hs-conid'>Ord</span><span class='hs-layout'>,</span> <span class='hs-conid'>Data</span><span class='hs-layout'>)</span>
<a name="line-773"></a>
<a name="line-774"></a><span class='hs-comment'>-- ---------------------------------------------------------------------</span>
<a name="line-775"></a>
<a name="line-776"></a><a name="AnnPragma"></a><span class='hs-comment'>-- | exact print annotation used for capturing the locations of</span>
<a name="line-777"></a><a name="AnnPragma"></a><span class='hs-comment'>-- annotations in pragmas.</span>
<a name="line-778"></a><a name="AnnPragma"></a><span class='hs-keyword'>data</span> <span class='hs-conid'>AnnPragma</span>
<a name="line-779"></a>  <span class='hs-keyglyph'>=</span> <span class='hs-conid'>AnnPragma</span> <span class='hs-layout'>{</span>
<a name="line-780"></a>      <span class='hs-varid'>apr_open</span>      <span class='hs-keyglyph'>::</span> <span class='hs-conid'>AddEpAnn</span><span class='hs-layout'>,</span>
<a name="line-781"></a>      <span class='hs-varid'>apr_close</span>     <span class='hs-keyglyph'>::</span> <span class='hs-conid'>AddEpAnn</span><span class='hs-layout'>,</span>
<a name="line-782"></a>      <span class='hs-varid'>apr_rest</span>      <span class='hs-keyglyph'>::</span> <span class='hs-keyglyph'>[</span><span class='hs-conid'>AddEpAnn</span><span class='hs-keyglyph'>]</span>
<a name="line-783"></a>      <span class='hs-layout'>}</span> <span class='hs-keyword'>deriving</span> <span class='hs-layout'>(</span><span class='hs-conid'>Data</span><span class='hs-layout'>,</span><span class='hs-conid'>Eq</span><span class='hs-layout'>)</span>
<a name="line-784"></a>
<a name="line-785"></a><a name="AnnSortKey"></a><span class='hs-comment'>-- ---------------------------------------------------------------------</span>
<a name="line-786"></a><a name="AnnSortKey"></a><span class='hs-comment'>-- | Captures the sort order of sub elements. This is needed when the</span>
<a name="line-787"></a><a name="AnnSortKey"></a><span class='hs-comment'>-- sub-elements have been split (as in a HsLocalBind which holds separate</span>
<a name="line-788"></a><a name="AnnSortKey"></a><span class='hs-comment'>-- binds and sigs) or for infix patterns where the order has been</span>
<a name="line-789"></a><a name="AnnSortKey"></a><span class='hs-comment'>-- re-arranged. It is captured explicitly so that after the Delta phase a</span>
<a name="line-790"></a><a name="AnnSortKey"></a><span class='hs-comment'>-- SrcSpan is used purely as an index into the annotations, allowing</span>
<a name="line-791"></a><a name="AnnSortKey"></a><span class='hs-comment'>-- transformations of the AST including the introduction of new Located</span>
<a name="line-792"></a><a name="AnnSortKey"></a><span class='hs-comment'>-- items or re-arranging existing ones.</span>
<a name="line-793"></a><a name="AnnSortKey"></a><span class='hs-keyword'>data</span> <span class='hs-conid'>AnnSortKey</span>
<a name="line-794"></a>  <span class='hs-keyglyph'>=</span> <span class='hs-conid'>NoAnnSortKey</span>
<a name="line-795"></a>  <span class='hs-keyglyph'>|</span> <span class='hs-conid'>AnnSortKey</span> <span class='hs-keyglyph'>[</span><span class='hs-conid'>RealSrcSpan</span><span class='hs-keyglyph'>]</span>
<a name="line-796"></a>  <span class='hs-keyword'>deriving</span> <span class='hs-layout'>(</span><span class='hs-conid'>Data</span><span class='hs-layout'>,</span> <span class='hs-conid'>Eq</span><span class='hs-layout'>)</span>
<a name="line-797"></a>
<a name="line-798"></a><span class='hs-comment'>-- ---------------------------------------------------------------------</span>
<a name="line-799"></a>
<a name="line-800"></a>
<a name="line-801"></a><a name="addTrailingAnnToL"></a><span class='hs-comment'>-- | Helper function used in the parser to add a 'TrailingAnn' items</span>
<a name="line-802"></a><span class='hs-comment'>-- to an existing annotation.</span>
<a name="line-803"></a><span class='hs-definition'>addTrailingAnnToL</span> <span class='hs-keyglyph'>::</span> <span class='hs-conid'>SrcSpan</span> <span class='hs-keyglyph'>-&gt;</span> <span class='hs-conid'>TrailingAnn</span> <span class='hs-keyglyph'>-&gt;</span> <span class='hs-conid'>EpAnnComments</span>
<a name="line-804"></a>                  <span class='hs-keyglyph'>-&gt;</span> <span class='hs-conid'>EpAnn</span> <span class='hs-conid'>AnnList</span> <span class='hs-keyglyph'>-&gt;</span> <span class='hs-conid'>EpAnn</span> <span class='hs-conid'>AnnList</span>
<a name="line-805"></a><span class='hs-definition'>addTrailingAnnToL</span> <span class='hs-varid'>s</span> <span class='hs-varid'>t</span> <span class='hs-varid'>cs</span> <span class='hs-conid'>EpAnnNotUsed</span>
<a name="line-806"></a>  <span class='hs-keyglyph'>=</span> <span class='hs-conid'>EpAnn</span> <span class='hs-layout'>(</span><span class='hs-varid'>spanAsAnchor</span> <span class='hs-varid'>s</span><span class='hs-layout'>)</span> <span class='hs-layout'>(</span><span class='hs-conid'>AnnList</span> <span class='hs-layout'>(</span><span class='hs-conid'>Just</span> <span class='hs-varop'>$</span> <span class='hs-varid'>spanAsAnchor</span> <span class='hs-varid'>s</span><span class='hs-layout'>)</span> <span class='hs-conid'>Nothing</span> <span class='hs-conid'>Nothing</span> <span class='hs-conid'>[]</span> <span class='hs-keyglyph'>[</span><span class='hs-varid'>t</span><span class='hs-keyglyph'>]</span><span class='hs-layout'>)</span> <span class='hs-varid'>cs</span>
<a name="line-807"></a><span class='hs-definition'>addTrailingAnnToL</span> <span class='hs-keyword'>_</span> <span class='hs-varid'>t</span> <span class='hs-varid'>cs</span> <span class='hs-varid'>n</span> <span class='hs-keyglyph'>=</span> <span class='hs-varid'>n</span> <span class='hs-layout'>{</span> <span class='hs-varid'>anns</span> <span class='hs-keyglyph'>=</span> <span class='hs-varid'>addTrailing</span> <span class='hs-layout'>(</span><span class='hs-varid'>anns</span> <span class='hs-varid'>n</span><span class='hs-layout'>)</span>
<a name="line-808"></a>                               <span class='hs-layout'>,</span> <span class='hs-varid'>comments</span> <span class='hs-keyglyph'>=</span> <span class='hs-varid'>comments</span> <span class='hs-varid'>n</span> <span class='hs-varop'>&lt;&gt;</span> <span class='hs-varid'>cs</span> <span class='hs-layout'>}</span>
<a name="line-809"></a>  <span class='hs-keyword'>where</span>
<a name="line-810"></a>    <span class='hs-comment'>-- See Note [list append in addTrailing*]</span>
<a name="line-811"></a>    <span class='hs-varid'>addTrailing</span> <span class='hs-varid'>n</span> <span class='hs-keyglyph'>=</span> <span class='hs-varid'>n</span> <span class='hs-layout'>{</span> <span class='hs-varid'>al_trailing</span> <span class='hs-keyglyph'>=</span> <span class='hs-varid'>al_trailing</span> <span class='hs-varid'>n</span> <span class='hs-varop'>++</span> <span class='hs-keyglyph'>[</span><span class='hs-varid'>t</span><span class='hs-keyglyph'>]</span><span class='hs-layout'>}</span>
<a name="line-812"></a>
<a name="line-813"></a><a name="addTrailingAnnToA"></a><span class='hs-comment'>-- | Helper function used in the parser to add a 'TrailingAnn' items</span>
<a name="line-814"></a><span class='hs-comment'>-- to an existing annotation.</span>
<a name="line-815"></a><span class='hs-definition'>addTrailingAnnToA</span> <span class='hs-keyglyph'>::</span> <span class='hs-conid'>SrcSpan</span> <span class='hs-keyglyph'>-&gt;</span> <span class='hs-conid'>TrailingAnn</span> <span class='hs-keyglyph'>-&gt;</span> <span class='hs-conid'>EpAnnComments</span>
<a name="line-816"></a>                  <span class='hs-keyglyph'>-&gt;</span> <span class='hs-conid'>EpAnn</span> <span class='hs-conid'>AnnListItem</span> <span class='hs-keyglyph'>-&gt;</span> <span class='hs-conid'>EpAnn</span> <span class='hs-conid'>AnnListItem</span>
<a name="line-817"></a><span class='hs-definition'>addTrailingAnnToA</span> <span class='hs-varid'>s</span> <span class='hs-varid'>t</span> <span class='hs-varid'>cs</span> <span class='hs-conid'>EpAnnNotUsed</span>
<a name="line-818"></a>  <span class='hs-keyglyph'>=</span> <span class='hs-conid'>EpAnn</span> <span class='hs-layout'>(</span><span class='hs-varid'>spanAsAnchor</span> <span class='hs-varid'>s</span><span class='hs-layout'>)</span> <span class='hs-layout'>(</span><span class='hs-conid'>AnnListItem</span> <span class='hs-keyglyph'>[</span><span class='hs-varid'>t</span><span class='hs-keyglyph'>]</span><span class='hs-layout'>)</span> <span class='hs-varid'>cs</span>
<a name="line-819"></a><span class='hs-definition'>addTrailingAnnToA</span> <span class='hs-keyword'>_</span> <span class='hs-varid'>t</span> <span class='hs-varid'>cs</span> <span class='hs-varid'>n</span> <span class='hs-keyglyph'>=</span> <span class='hs-varid'>n</span> <span class='hs-layout'>{</span> <span class='hs-varid'>anns</span> <span class='hs-keyglyph'>=</span> <span class='hs-varid'>addTrailing</span> <span class='hs-layout'>(</span><span class='hs-varid'>anns</span> <span class='hs-varid'>n</span><span class='hs-layout'>)</span>
<a name="line-820"></a>                               <span class='hs-layout'>,</span> <span class='hs-varid'>comments</span> <span class='hs-keyglyph'>=</span> <span class='hs-varid'>comments</span> <span class='hs-varid'>n</span> <span class='hs-varop'>&lt;&gt;</span> <span class='hs-varid'>cs</span> <span class='hs-layout'>}</span>
<a name="line-821"></a>  <span class='hs-keyword'>where</span>
<a name="line-822"></a>    <span class='hs-comment'>-- See Note [list append in addTrailing*]</span>
<a name="line-823"></a>    <span class='hs-varid'>addTrailing</span> <span class='hs-varid'>n</span> <span class='hs-keyglyph'>=</span> <span class='hs-varid'>n</span> <span class='hs-layout'>{</span> <span class='hs-varid'>lann_trailing</span> <span class='hs-keyglyph'>=</span> <span class='hs-varid'>lann_trailing</span> <span class='hs-varid'>n</span> <span class='hs-varop'>++</span> <span class='hs-keyglyph'>[</span><span class='hs-varid'>t</span><span class='hs-keyglyph'>]</span> <span class='hs-layout'>}</span>
<a name="line-824"></a>
<a name="line-825"></a><a name="addTrailingCommaToN"></a><span class='hs-comment'>-- | Helper function used in the parser to add a comma location to an</span>
<a name="line-826"></a><span class='hs-comment'>-- existing annotation.</span>
<a name="line-827"></a><span class='hs-definition'>addTrailingCommaToN</span> <span class='hs-keyglyph'>::</span> <span class='hs-conid'>SrcSpan</span> <span class='hs-keyglyph'>-&gt;</span> <span class='hs-conid'>EpAnn</span> <span class='hs-conid'>NameAnn</span> <span class='hs-keyglyph'>-&gt;</span> <span class='hs-conid'>EpaLocation</span> <span class='hs-keyglyph'>-&gt;</span> <span class='hs-conid'>EpAnn</span> <span class='hs-conid'>NameAnn</span>
<a name="line-828"></a><span class='hs-definition'>addTrailingCommaToN</span> <span class='hs-varid'>s</span> <span class='hs-conid'>EpAnnNotUsed</span> <span class='hs-varid'>l</span>
<a name="line-829"></a>  <span class='hs-keyglyph'>=</span> <span class='hs-conid'>EpAnn</span> <span class='hs-layout'>(</span><span class='hs-varid'>spanAsAnchor</span> <span class='hs-varid'>s</span><span class='hs-layout'>)</span> <span class='hs-layout'>(</span><span class='hs-conid'>NameAnnTrailing</span> <span class='hs-keyglyph'>[</span><span class='hs-conid'>AddCommaAnn</span> <span class='hs-varid'>l</span><span class='hs-keyglyph'>]</span><span class='hs-layout'>)</span> <span class='hs-varid'>emptyComments</span>
<a name="line-830"></a><span class='hs-definition'>addTrailingCommaToN</span> <span class='hs-keyword'>_</span> <span class='hs-varid'>n</span> <span class='hs-varid'>l</span> <span class='hs-keyglyph'>=</span> <span class='hs-varid'>n</span> <span class='hs-layout'>{</span> <span class='hs-varid'>anns</span> <span class='hs-keyglyph'>=</span> <span class='hs-varid'>addTrailing</span> <span class='hs-layout'>(</span><span class='hs-varid'>anns</span> <span class='hs-varid'>n</span><span class='hs-layout'>)</span> <span class='hs-varid'>l</span> <span class='hs-layout'>}</span>
<a name="line-831"></a>  <span class='hs-keyword'>where</span>
<a name="line-832"></a>    <span class='hs-comment'>-- See Note [list append in addTrailing*]</span>
<a name="line-833"></a>    <span class='hs-varid'>addTrailing</span> <span class='hs-keyglyph'>::</span> <span class='hs-conid'>NameAnn</span> <span class='hs-keyglyph'>-&gt;</span> <span class='hs-conid'>EpaLocation</span> <span class='hs-keyglyph'>-&gt;</span> <span class='hs-conid'>NameAnn</span>
<a name="line-834"></a>    <span class='hs-varid'>addTrailing</span> <span class='hs-varid'>n</span> <span class='hs-varid'>l</span> <span class='hs-keyglyph'>=</span> <span class='hs-varid'>n</span> <span class='hs-layout'>{</span> <span class='hs-varid'>nann_trailing</span> <span class='hs-keyglyph'>=</span> <span class='hs-varid'>nann_trailing</span> <span class='hs-varid'>n</span> <span class='hs-varop'>++</span> <span class='hs-keyglyph'>[</span><span class='hs-conid'>AddCommaAnn</span> <span class='hs-varid'>l</span><span class='hs-keyglyph'>]</span><span class='hs-layout'>}</span>
<a name="line-835"></a>
<a name="line-836"></a><span class='hs-comment'>{-
<a name="line-837"></a>Note [list append in addTrailing*]
<a name="line-838"></a>~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~
<a name="line-839"></a>The addTrailingAnnToL, addTrailingAnnToA and addTrailingCommaToN
<a name="line-840"></a>functions are used to add a separator for an item when it occurs in a
<a name="line-841"></a>list.  So they are used to capture a comma, vbar, semicolon and similar.
<a name="line-842"></a>
<a name="line-843"></a>In general, a given element will have zero or one of these.  In
<a name="line-844"></a>extreme (test) cases, there may be multiple semicolons.
<a name="line-845"></a>
<a name="line-846"></a>In exact printing we sometimes convert the EpaLocation variant for an
<a name="line-847"></a>trailing annotation to the EpaDelta variant, which cannot be sorted.
<a name="line-848"></a>
<a name="line-849"></a>Hence it is critical that these annotations are captured in the order
<a name="line-850"></a>they appear in the original source file.
<a name="line-851"></a>
<a name="line-852"></a>And so we use the less efficient list append to preserve the order,
<a name="line-853"></a>knowing that in most cases the original list is empty.
<a name="line-854"></a>-}</span>
<a name="line-855"></a>
<a name="line-856"></a><span class='hs-comment'>-- ---------------------------------------------------------------------</span>
<a name="line-857"></a>
<a name="line-858"></a><a name="l2n"></a><span class='hs-comment'>-- |Helper function (temporary) during transition of names</span>
<a name="line-859"></a><span class='hs-comment'>--  Discards any annotations</span>
<a name="line-860"></a><span class='hs-definition'>l2n</span> <span class='hs-keyglyph'>::</span> <span class='hs-conid'>LocatedAn</span> <span class='hs-varid'>a1</span> <span class='hs-varid'>a2</span> <span class='hs-keyglyph'>-&gt;</span> <span class='hs-conid'>LocatedN</span> <span class='hs-varid'>a2</span>
<a name="line-861"></a><span class='hs-definition'>l2n</span> <span class='hs-layout'>(</span><span class='hs-conid'>L</span> <span class='hs-varid'>la</span> <span class='hs-varid'>a</span><span class='hs-layout'>)</span> <span class='hs-keyglyph'>=</span> <span class='hs-conid'>L</span> <span class='hs-layout'>(</span><span class='hs-varid'>noAnnSrcSpan</span> <span class='hs-layout'>(</span><span class='hs-varid'>locA</span> <span class='hs-varid'>la</span><span class='hs-layout'>)</span><span class='hs-layout'>)</span> <span class='hs-varid'>a</span>
<a name="line-862"></a>
<a name="line-863"></a><a name="n2l"></a><span class='hs-definition'>n2l</span> <span class='hs-keyglyph'>::</span> <span class='hs-conid'>LocatedN</span> <span class='hs-varid'>a</span> <span class='hs-keyglyph'>-&gt;</span> <span class='hs-conid'>LocatedA</span> <span class='hs-varid'>a</span>
<a name="line-864"></a><span class='hs-definition'>n2l</span> <span class='hs-layout'>(</span><span class='hs-conid'>L</span> <span class='hs-varid'>la</span> <span class='hs-varid'>a</span><span class='hs-layout'>)</span> <span class='hs-keyglyph'>=</span> <span class='hs-conid'>L</span> <span class='hs-layout'>(</span><span class='hs-varid'>na2la</span> <span class='hs-varid'>la</span><span class='hs-layout'>)</span> <span class='hs-varid'>a</span>
<a name="line-865"></a>
<a name="line-866"></a><a name="la2na"></a><span class='hs-comment'>-- |Helper function (temporary) during transition of names</span>
<a name="line-867"></a><span class='hs-comment'>--  Discards any annotations</span>
<a name="line-868"></a><span class='hs-definition'>la2na</span> <span class='hs-keyglyph'>::</span> <span class='hs-conid'>SrcSpanAnn'</span> <span class='hs-varid'>a</span> <span class='hs-keyglyph'>-&gt;</span> <span class='hs-conid'>SrcSpanAnnN</span>
<a name="line-869"></a><span class='hs-definition'>la2na</span> <span class='hs-varid'>l</span> <span class='hs-keyglyph'>=</span> <span class='hs-varid'>noAnnSrcSpan</span> <span class='hs-layout'>(</span><span class='hs-varid'>locA</span> <span class='hs-varid'>l</span><span class='hs-layout'>)</span>
<a name="line-870"></a>
<a name="line-871"></a><a name="la2la"></a><span class='hs-comment'>-- |Helper function (temporary) during transition of names</span>
<a name="line-872"></a><span class='hs-comment'>--  Discards any annotations</span>
<a name="line-873"></a><span class='hs-definition'>la2la</span> <span class='hs-keyglyph'>::</span> <span class='hs-conid'>LocatedAn</span> <span class='hs-varid'>ann1</span> <span class='hs-varid'>a2</span> <span class='hs-keyglyph'>-&gt;</span> <span class='hs-conid'>LocatedAn</span> <span class='hs-varid'>ann2</span> <span class='hs-varid'>a2</span>
<a name="line-874"></a><span class='hs-definition'>la2la</span> <span class='hs-layout'>(</span><span class='hs-conid'>L</span> <span class='hs-varid'>la</span> <span class='hs-varid'>a</span><span class='hs-layout'>)</span> <span class='hs-keyglyph'>=</span> <span class='hs-conid'>L</span> <span class='hs-layout'>(</span><span class='hs-varid'>noAnnSrcSpan</span> <span class='hs-layout'>(</span><span class='hs-varid'>locA</span> <span class='hs-varid'>la</span><span class='hs-layout'>)</span><span class='hs-layout'>)</span> <span class='hs-varid'>a</span>
<a name="line-875"></a>
<a name="line-876"></a><a name="l2l"></a><span class='hs-definition'>l2l</span> <span class='hs-keyglyph'>::</span> <span class='hs-conid'>SrcSpanAnn'</span> <span class='hs-varid'>a</span> <span class='hs-keyglyph'>-&gt;</span> <span class='hs-conid'>SrcAnn</span> <span class='hs-varid'>ann</span>
<a name="line-877"></a><span class='hs-definition'>l2l</span> <span class='hs-varid'>l</span> <span class='hs-keyglyph'>=</span> <span class='hs-varid'>noAnnSrcSpan</span> <span class='hs-layout'>(</span><span class='hs-varid'>locA</span> <span class='hs-varid'>l</span><span class='hs-layout'>)</span>
<a name="line-878"></a>
<a name="line-879"></a><a name="na2la"></a><span class='hs-comment'>-- |Helper function (temporary) during transition of names</span>
<a name="line-880"></a><span class='hs-comment'>--  Discards any annotations</span>
<a name="line-881"></a><span class='hs-definition'>na2la</span> <span class='hs-keyglyph'>::</span> <span class='hs-conid'>SrcSpanAnn'</span> <span class='hs-varid'>a</span> <span class='hs-keyglyph'>-&gt;</span> <span class='hs-conid'>SrcAnn</span> <span class='hs-varid'>ann</span>
<a name="line-882"></a><span class='hs-definition'>na2la</span> <span class='hs-varid'>l</span> <span class='hs-keyglyph'>=</span> <span class='hs-varid'>noAnnSrcSpan</span> <span class='hs-layout'>(</span><span class='hs-varid'>locA</span> <span class='hs-varid'>l</span><span class='hs-layout'>)</span>
<a name="line-883"></a>
<a name="line-884"></a><a name="reLoc"></a><span class='hs-definition'>reLoc</span> <span class='hs-keyglyph'>::</span> <span class='hs-conid'>LocatedAn</span> <span class='hs-varid'>a</span> <span class='hs-varid'>e</span> <span class='hs-keyglyph'>-&gt;</span> <span class='hs-conid'>Located</span> <span class='hs-varid'>e</span>
<a name="line-885"></a><span class='hs-definition'>reLoc</span> <span class='hs-layout'>(</span><span class='hs-conid'>L</span> <span class='hs-layout'>(</span><span class='hs-conid'>SrcSpanAnn</span> <span class='hs-keyword'>_</span> <span class='hs-varid'>l</span><span class='hs-layout'>)</span> <span class='hs-varid'>a</span><span class='hs-layout'>)</span> <span class='hs-keyglyph'>=</span> <span class='hs-conid'>L</span> <span class='hs-varid'>l</span> <span class='hs-varid'>a</span>
<a name="line-886"></a>
<a name="line-887"></a><a name="reLocA"></a><span class='hs-definition'>reLocA</span> <span class='hs-keyglyph'>::</span> <span class='hs-conid'>Located</span> <span class='hs-varid'>e</span> <span class='hs-keyglyph'>-&gt;</span> <span class='hs-conid'>LocatedAn</span> <span class='hs-varid'>ann</span> <span class='hs-varid'>e</span>
<a name="line-888"></a><span class='hs-definition'>reLocA</span> <span class='hs-layout'>(</span><span class='hs-conid'>L</span> <span class='hs-varid'>l</span> <span class='hs-varid'>a</span><span class='hs-layout'>)</span> <span class='hs-keyglyph'>=</span> <span class='hs-layout'>(</span><span class='hs-conid'>L</span> <span class='hs-layout'>(</span><span class='hs-conid'>SrcSpanAnn</span> <span class='hs-conid'>EpAnnNotUsed</span> <span class='hs-varid'>l</span><span class='hs-layout'>)</span> <span class='hs-varid'>a</span><span class='hs-layout'>)</span>
<a name="line-889"></a>
<a name="line-890"></a><a name="reLocL"></a><span class='hs-definition'>reLocL</span> <span class='hs-keyglyph'>::</span> <span class='hs-conid'>LocatedN</span> <span class='hs-varid'>e</span> <span class='hs-keyglyph'>-&gt;</span> <span class='hs-conid'>LocatedA</span> <span class='hs-varid'>e</span>
<a name="line-891"></a><span class='hs-definition'>reLocL</span> <span class='hs-layout'>(</span><span class='hs-conid'>L</span> <span class='hs-varid'>l</span> <span class='hs-varid'>a</span><span class='hs-layout'>)</span> <span class='hs-keyglyph'>=</span> <span class='hs-layout'>(</span><span class='hs-conid'>L</span> <span class='hs-layout'>(</span><span class='hs-varid'>na2la</span> <span class='hs-varid'>l</span><span class='hs-layout'>)</span> <span class='hs-varid'>a</span><span class='hs-layout'>)</span>
<a name="line-892"></a>
<a name="line-893"></a><a name="reLocC"></a><span class='hs-definition'>reLocC</span> <span class='hs-keyglyph'>::</span> <span class='hs-conid'>LocatedN</span> <span class='hs-varid'>e</span> <span class='hs-keyglyph'>-&gt;</span> <span class='hs-conid'>LocatedC</span> <span class='hs-varid'>e</span>
<a name="line-894"></a><span class='hs-definition'>reLocC</span> <span class='hs-layout'>(</span><span class='hs-conid'>L</span> <span class='hs-varid'>l</span> <span class='hs-varid'>a</span><span class='hs-layout'>)</span> <span class='hs-keyglyph'>=</span> <span class='hs-layout'>(</span><span class='hs-conid'>L</span> <span class='hs-layout'>(</span><span class='hs-varid'>na2la</span> <span class='hs-varid'>l</span><span class='hs-layout'>)</span> <span class='hs-varid'>a</span><span class='hs-layout'>)</span>
<a name="line-895"></a>
<a name="line-896"></a><a name="reLocN"></a><span class='hs-definition'>reLocN</span> <span class='hs-keyglyph'>::</span> <span class='hs-conid'>LocatedN</span> <span class='hs-varid'>a</span> <span class='hs-keyglyph'>-&gt;</span> <span class='hs-conid'>Located</span> <span class='hs-varid'>a</span>
<a name="line-897"></a><span class='hs-definition'>reLocN</span> <span class='hs-layout'>(</span><span class='hs-conid'>L</span> <span class='hs-layout'>(</span><span class='hs-conid'>SrcSpanAnn</span> <span class='hs-keyword'>_</span> <span class='hs-varid'>l</span><span class='hs-layout'>)</span> <span class='hs-varid'>a</span><span class='hs-layout'>)</span> <span class='hs-keyglyph'>=</span> <span class='hs-conid'>L</span> <span class='hs-varid'>l</span> <span class='hs-varid'>a</span>
<a name="line-898"></a>
<a name="line-899"></a><span class='hs-comment'>-- ---------------------------------------------------------------------</span>
<a name="line-900"></a>
<a name="line-901"></a><a name="realSrcSpan"></a><span class='hs-definition'>realSrcSpan</span> <span class='hs-keyglyph'>::</span> <span class='hs-conid'>SrcSpan</span> <span class='hs-keyglyph'>-&gt;</span> <span class='hs-conid'>RealSrcSpan</span>
<a name="line-902"></a><span class='hs-definition'>realSrcSpan</span> <span class='hs-layout'>(</span><span class='hs-conid'>RealSrcSpan</span> <span class='hs-varid'>s</span> <span class='hs-keyword'>_</span><span class='hs-layout'>)</span> <span class='hs-keyglyph'>=</span> <span class='hs-varid'>s</span>
<a name="line-903"></a><span class='hs-definition'>realSrcSpan</span> <span class='hs-keyword'>_</span> <span class='hs-keyglyph'>=</span> <span class='hs-varid'>mkRealSrcSpan</span> <span class='hs-varid'>l</span> <span class='hs-varid'>l</span> <span class='hs-comment'>-- AZ temporary</span>
<a name="line-904"></a>  <span class='hs-keyword'>where</span>
<a name="line-905"></a>    <span class='hs-varid'>l</span> <span class='hs-keyglyph'>=</span> <span class='hs-varid'>mkRealSrcLoc</span> <span class='hs-layout'>(</span><span class='hs-varid'>fsLit</span> <span class='hs-str'>"foo"</span><span class='hs-layout'>)</span> <span class='hs-layout'>(</span><span class='hs-comment'>-</span><span class='hs-num'>1</span><span class='hs-layout'>)</span> <span class='hs-layout'>(</span><span class='hs-comment'>-</span><span class='hs-num'>1</span><span class='hs-layout'>)</span>
<a name="line-906"></a>
<a name="line-907"></a><a name="la2r"></a><span class='hs-definition'>la2r</span> <span class='hs-keyglyph'>::</span> <span class='hs-conid'>SrcSpanAnn'</span> <span class='hs-varid'>a</span> <span class='hs-keyglyph'>-&gt;</span> <span class='hs-conid'>RealSrcSpan</span>
<a name="line-908"></a><span class='hs-definition'>la2r</span> <span class='hs-varid'>l</span> <span class='hs-keyglyph'>=</span> <span class='hs-varid'>realSrcSpan</span> <span class='hs-layout'>(</span><span class='hs-varid'>locA</span> <span class='hs-varid'>l</span><span class='hs-layout'>)</span>
<a name="line-909"></a>
<a name="line-910"></a><a name="extraToAnnList"></a><span class='hs-definition'>extraToAnnList</span> <span class='hs-keyglyph'>::</span> <span class='hs-conid'>AnnList</span> <span class='hs-keyglyph'>-&gt;</span> <span class='hs-keyglyph'>[</span><span class='hs-conid'>AddEpAnn</span><span class='hs-keyglyph'>]</span> <span class='hs-keyglyph'>-&gt;</span> <span class='hs-conid'>AnnList</span>
<a name="line-911"></a><span class='hs-definition'>extraToAnnList</span> <span class='hs-layout'>(</span><span class='hs-conid'>AnnList</span> <span class='hs-varid'>a</span> <span class='hs-varid'>o</span> <span class='hs-varid'>c</span> <span class='hs-varid'>e</span> <span class='hs-varid'>t</span><span class='hs-layout'>)</span> <span class='hs-keyword'>as</span> <span class='hs-keyglyph'>=</span> <span class='hs-conid'>AnnList</span> <span class='hs-varid'>a</span> <span class='hs-varid'>o</span> <span class='hs-varid'>c</span> <span class='hs-layout'>(</span><span class='hs-varid'>e</span><span class='hs-varop'>++</span><span class='hs-keyword'>as</span><span class='hs-layout'>)</span> <span class='hs-varid'>t</span>
<a name="line-912"></a>
<a name="line-913"></a><a name="reAnn"></a><span class='hs-definition'>reAnn</span> <span class='hs-keyglyph'>::</span> <span class='hs-keyglyph'>[</span><span class='hs-conid'>TrailingAnn</span><span class='hs-keyglyph'>]</span> <span class='hs-keyglyph'>-&gt;</span> <span class='hs-conid'>EpAnnComments</span> <span class='hs-keyglyph'>-&gt;</span> <span class='hs-conid'>Located</span> <span class='hs-varid'>a</span> <span class='hs-keyglyph'>-&gt;</span> <span class='hs-conid'>LocatedA</span> <span class='hs-varid'>a</span>
<a name="line-914"></a><span class='hs-definition'>reAnn</span> <span class='hs-varid'>anns</span> <span class='hs-varid'>cs</span> <span class='hs-layout'>(</span><span class='hs-conid'>L</span> <span class='hs-varid'>l</span> <span class='hs-varid'>a</span><span class='hs-layout'>)</span> <span class='hs-keyglyph'>=</span> <span class='hs-conid'>L</span> <span class='hs-layout'>(</span><span class='hs-conid'>SrcSpanAnn</span> <span class='hs-layout'>(</span><span class='hs-conid'>EpAnn</span> <span class='hs-layout'>(</span><span class='hs-varid'>spanAsAnchor</span> <span class='hs-varid'>l</span><span class='hs-layout'>)</span> <span class='hs-layout'>(</span><span class='hs-conid'>AnnListItem</span> <span class='hs-varid'>anns</span><span class='hs-layout'>)</span> <span class='hs-varid'>cs</span><span class='hs-layout'>)</span> <span class='hs-varid'>l</span><span class='hs-layout'>)</span> <span class='hs-varid'>a</span>
<a name="line-915"></a>
<a name="line-916"></a><a name="reAnnC"></a><span class='hs-definition'>reAnnC</span> <span class='hs-keyglyph'>::</span> <span class='hs-conid'>AnnContext</span> <span class='hs-keyglyph'>-&gt;</span> <span class='hs-conid'>EpAnnComments</span> <span class='hs-keyglyph'>-&gt;</span> <span class='hs-conid'>Located</span> <span class='hs-varid'>a</span> <span class='hs-keyglyph'>-&gt;</span> <span class='hs-conid'>LocatedC</span> <span class='hs-varid'>a</span>
<a name="line-917"></a><span class='hs-definition'>reAnnC</span> <span class='hs-varid'>anns</span> <span class='hs-varid'>cs</span> <span class='hs-layout'>(</span><span class='hs-conid'>L</span> <span class='hs-varid'>l</span> <span class='hs-varid'>a</span><span class='hs-layout'>)</span> <span class='hs-keyglyph'>=</span> <span class='hs-conid'>L</span> <span class='hs-layout'>(</span><span class='hs-conid'>SrcSpanAnn</span> <span class='hs-layout'>(</span><span class='hs-conid'>EpAnn</span> <span class='hs-layout'>(</span><span class='hs-varid'>spanAsAnchor</span> <span class='hs-varid'>l</span><span class='hs-layout'>)</span> <span class='hs-varid'>anns</span> <span class='hs-varid'>cs</span><span class='hs-layout'>)</span> <span class='hs-varid'>l</span><span class='hs-layout'>)</span> <span class='hs-varid'>a</span>
<a name="line-918"></a>
<a name="line-919"></a><a name="reAnnL"></a><span class='hs-definition'>reAnnL</span> <span class='hs-keyglyph'>::</span> <span class='hs-varid'>ann</span> <span class='hs-keyglyph'>-&gt;</span> <span class='hs-conid'>EpAnnComments</span> <span class='hs-keyglyph'>-&gt;</span> <span class='hs-conid'>Located</span> <span class='hs-varid'>e</span> <span class='hs-keyglyph'>-&gt;</span> <span class='hs-conid'>GenLocated</span> <span class='hs-layout'>(</span><span class='hs-conid'>SrcAnn</span> <span class='hs-varid'>ann</span><span class='hs-layout'>)</span> <span class='hs-varid'>e</span>
<a name="line-920"></a><span class='hs-definition'>reAnnL</span> <span class='hs-varid'>anns</span> <span class='hs-varid'>cs</span> <span class='hs-layout'>(</span><span class='hs-conid'>L</span> <span class='hs-varid'>l</span> <span class='hs-varid'>a</span><span class='hs-layout'>)</span> <span class='hs-keyglyph'>=</span> <span class='hs-conid'>L</span> <span class='hs-layout'>(</span><span class='hs-conid'>SrcSpanAnn</span> <span class='hs-layout'>(</span><span class='hs-conid'>EpAnn</span> <span class='hs-layout'>(</span><span class='hs-varid'>spanAsAnchor</span> <span class='hs-varid'>l</span><span class='hs-layout'>)</span> <span class='hs-varid'>anns</span> <span class='hs-varid'>cs</span><span class='hs-layout'>)</span> <span class='hs-varid'>l</span><span class='hs-layout'>)</span> <span class='hs-varid'>a</span>
<a name="line-921"></a>
<a name="line-922"></a><a name="getLocAnn"></a><span class='hs-definition'>getLocAnn</span> <span class='hs-keyglyph'>::</span> <span class='hs-conid'>Located</span> <span class='hs-varid'>a</span>  <span class='hs-keyglyph'>-&gt;</span> <span class='hs-conid'>SrcSpanAnnA</span>
<a name="line-923"></a><span class='hs-definition'>getLocAnn</span> <span class='hs-layout'>(</span><span class='hs-conid'>L</span> <span class='hs-varid'>l</span> <span class='hs-keyword'>_</span><span class='hs-layout'>)</span> <span class='hs-keyglyph'>=</span> <span class='hs-conid'>SrcSpanAnn</span> <span class='hs-conid'>EpAnnNotUsed</span> <span class='hs-varid'>l</span>
<a name="line-924"></a>
<a name="line-925"></a>
<a name="line-926"></a><a name="getLocA"></a><span class='hs-definition'>getLocA</span> <span class='hs-keyglyph'>::</span> <span class='hs-conid'>GenLocated</span> <span class='hs-layout'>(</span><span class='hs-conid'>SrcSpanAnn'</span> <span class='hs-varid'>a</span><span class='hs-layout'>)</span> <span class='hs-varid'>e</span> <span class='hs-keyglyph'>-&gt;</span> <span class='hs-conid'>SrcSpan</span>
<a name="line-927"></a><span class='hs-definition'>getLocA</span> <span class='hs-layout'>(</span><span class='hs-conid'>L</span> <span class='hs-layout'>(</span><span class='hs-conid'>SrcSpanAnn</span> <span class='hs-keyword'>_</span> <span class='hs-varid'>l</span><span class='hs-layout'>)</span> <span class='hs-keyword'>_</span><span class='hs-layout'>)</span> <span class='hs-keyglyph'>=</span> <span class='hs-varid'>l</span>
<a name="line-928"></a>
<a name="line-929"></a><a name="noLocA"></a><span class='hs-definition'>noLocA</span> <span class='hs-keyglyph'>::</span> <span class='hs-varid'>a</span> <span class='hs-keyglyph'>-&gt;</span> <span class='hs-conid'>LocatedAn</span> <span class='hs-varid'>an</span> <span class='hs-varid'>a</span>
<a name="line-930"></a><span class='hs-definition'>noLocA</span> <span class='hs-keyglyph'>=</span> <span class='hs-conid'>L</span> <span class='hs-layout'>(</span><span class='hs-conid'>SrcSpanAnn</span> <span class='hs-conid'>EpAnnNotUsed</span> <span class='hs-varid'>noSrcSpan</span><span class='hs-layout'>)</span>
<a name="line-931"></a>
<a name="line-932"></a><a name="noAnnSrcSpan"></a><span class='hs-definition'>noAnnSrcSpan</span> <span class='hs-keyglyph'>::</span> <span class='hs-conid'>SrcSpan</span> <span class='hs-keyglyph'>-&gt;</span> <span class='hs-conid'>SrcAnn</span> <span class='hs-varid'>ann</span>
<a name="line-933"></a><span class='hs-definition'>noAnnSrcSpan</span> <span class='hs-varid'>l</span> <span class='hs-keyglyph'>=</span> <span class='hs-conid'>SrcSpanAnn</span> <span class='hs-conid'>EpAnnNotUsed</span> <span class='hs-varid'>l</span>
<a name="line-934"></a>
<a name="line-935"></a><a name="noSrcSpanA"></a><span class='hs-definition'>noSrcSpanA</span> <span class='hs-keyglyph'>::</span> <span class='hs-conid'>SrcAnn</span> <span class='hs-varid'>ann</span>
<a name="line-936"></a><span class='hs-definition'>noSrcSpanA</span> <span class='hs-keyglyph'>=</span> <span class='hs-varid'>noAnnSrcSpan</span> <span class='hs-varid'>noSrcSpan</span>
<a name="line-937"></a>
<a name="line-938"></a><a name="noAnn"></a><span class='hs-comment'>-- | Short form for 'EpAnnNotUsed'</span>
<a name="line-939"></a><span class='hs-definition'>noAnn</span> <span class='hs-keyglyph'>::</span> <span class='hs-conid'>EpAnn</span> <span class='hs-varid'>a</span>
<a name="line-940"></a><span class='hs-definition'>noAnn</span> <span class='hs-keyglyph'>=</span> <span class='hs-conid'>EpAnnNotUsed</span>
<a name="line-941"></a>
<a name="line-942"></a>
<a name="line-943"></a><a name="addAnns"></a><span class='hs-definition'>addAnns</span> <span class='hs-keyglyph'>::</span> <span class='hs-conid'>EpAnn</span> <span class='hs-keyglyph'>[</span><span class='hs-conid'>AddEpAnn</span><span class='hs-keyglyph'>]</span> <span class='hs-keyglyph'>-&gt;</span> <span class='hs-keyglyph'>[</span><span class='hs-conid'>AddEpAnn</span><span class='hs-keyglyph'>]</span> <span class='hs-keyglyph'>-&gt;</span> <span class='hs-conid'>EpAnnComments</span> <span class='hs-keyglyph'>-&gt;</span> <span class='hs-conid'>EpAnn</span> <span class='hs-keyglyph'>[</span><span class='hs-conid'>AddEpAnn</span><span class='hs-keyglyph'>]</span>
<a name="line-944"></a><span class='hs-definition'>addAnns</span> <span class='hs-layout'>(</span><span class='hs-conid'>EpAnn</span> <span class='hs-varid'>l</span> <span class='hs-varid'>as1</span> <span class='hs-varid'>cs</span><span class='hs-layout'>)</span> <span class='hs-varid'>as2</span> <span class='hs-varid'>cs2</span>
<a name="line-945"></a>  <span class='hs-keyglyph'>=</span> <span class='hs-conid'>EpAnn</span> <span class='hs-layout'>(</span><span class='hs-varid'>widenAnchor</span> <span class='hs-varid'>l</span> <span class='hs-layout'>(</span><span class='hs-varid'>as1</span> <span class='hs-varop'>++</span> <span class='hs-varid'>as2</span><span class='hs-layout'>)</span><span class='hs-layout'>)</span> <span class='hs-layout'>(</span><span class='hs-varid'>as1</span> <span class='hs-varop'>++</span> <span class='hs-varid'>as2</span><span class='hs-layout'>)</span> <span class='hs-layout'>(</span><span class='hs-varid'>cs</span> <span class='hs-varop'>&lt;&gt;</span> <span class='hs-varid'>cs2</span><span class='hs-layout'>)</span>
<a name="line-946"></a><span class='hs-definition'>addAnns</span> <span class='hs-conid'>EpAnnNotUsed</span> <span class='hs-conid'>[]</span> <span class='hs-layout'>(</span><span class='hs-conid'>EpaComments</span> <span class='hs-conid'>[]</span><span class='hs-layout'>)</span> <span class='hs-keyglyph'>=</span> <span class='hs-conid'>EpAnnNotUsed</span>
<a name="line-947"></a><span class='hs-definition'>addAnns</span> <span class='hs-conid'>EpAnnNotUsed</span> <span class='hs-conid'>[]</span> <span class='hs-layout'>(</span><span class='hs-conid'>EpaCommentsBalanced</span> <span class='hs-conid'>[]</span> <span class='hs-conid'>[]</span><span class='hs-layout'>)</span> <span class='hs-keyglyph'>=</span> <span class='hs-conid'>EpAnnNotUsed</span>
<a name="line-948"></a><span class='hs-definition'>addAnns</span> <span class='hs-conid'>EpAnnNotUsed</span> <span class='hs-keyword'>as</span> <span class='hs-varid'>cs</span> <span class='hs-keyglyph'>=</span> <span class='hs-conid'>EpAnn</span> <span class='hs-layout'>(</span><span class='hs-conid'>Anchor</span> <span class='hs-varid'>placeholderRealSpan</span> <span class='hs-conid'>UnchangedAnchor</span><span class='hs-layout'>)</span> <span class='hs-keyword'>as</span> <span class='hs-varid'>cs</span>
<a name="line-949"></a>
<a name="line-950"></a><a name="addAnnsA"></a><span class='hs-comment'>-- AZ:TODO use widenSpan here too</span>
<a name="line-951"></a><span class='hs-definition'>addAnnsA</span> <span class='hs-keyglyph'>::</span> <span class='hs-conid'>SrcSpanAnnA</span> <span class='hs-keyglyph'>-&gt;</span> <span class='hs-keyglyph'>[</span><span class='hs-conid'>TrailingAnn</span><span class='hs-keyglyph'>]</span> <span class='hs-keyglyph'>-&gt;</span> <span class='hs-conid'>EpAnnComments</span> <span class='hs-keyglyph'>-&gt;</span> <span class='hs-conid'>SrcSpanAnnA</span>
<a name="line-952"></a><span class='hs-definition'>addAnnsA</span> <span class='hs-layout'>(</span><span class='hs-conid'>SrcSpanAnn</span> <span class='hs-layout'>(</span><span class='hs-conid'>EpAnn</span> <span class='hs-varid'>l</span> <span class='hs-varid'>as1</span> <span class='hs-varid'>cs</span><span class='hs-layout'>)</span> <span class='hs-varid'>loc</span><span class='hs-layout'>)</span> <span class='hs-varid'>as2</span> <span class='hs-varid'>cs2</span>
<a name="line-953"></a>  <span class='hs-keyglyph'>=</span> <span class='hs-conid'>SrcSpanAnn</span> <span class='hs-layout'>(</span><span class='hs-conid'>EpAnn</span> <span class='hs-varid'>l</span> <span class='hs-layout'>(</span><span class='hs-conid'>AnnListItem</span> <span class='hs-layout'>(</span><span class='hs-varid'>lann_trailing</span> <span class='hs-varid'>as1</span> <span class='hs-varop'>++</span> <span class='hs-varid'>as2</span><span class='hs-layout'>)</span><span class='hs-layout'>)</span> <span class='hs-layout'>(</span><span class='hs-varid'>cs</span> <span class='hs-varop'>&lt;&gt;</span> <span class='hs-varid'>cs2</span><span class='hs-layout'>)</span><span class='hs-layout'>)</span> <span class='hs-varid'>loc</span>
<a name="line-954"></a><span class='hs-definition'>addAnnsA</span> <span class='hs-layout'>(</span><span class='hs-conid'>SrcSpanAnn</span> <span class='hs-conid'>EpAnnNotUsed</span> <span class='hs-varid'>loc</span><span class='hs-layout'>)</span> <span class='hs-conid'>[]</span> <span class='hs-layout'>(</span><span class='hs-conid'>EpaComments</span> <span class='hs-conid'>[]</span><span class='hs-layout'>)</span>
<a name="line-955"></a>  <span class='hs-keyglyph'>=</span> <span class='hs-conid'>SrcSpanAnn</span> <span class='hs-conid'>EpAnnNotUsed</span> <span class='hs-varid'>loc</span>
<a name="line-956"></a><span class='hs-definition'>addAnnsA</span> <span class='hs-layout'>(</span><span class='hs-conid'>SrcSpanAnn</span> <span class='hs-conid'>EpAnnNotUsed</span> <span class='hs-varid'>loc</span><span class='hs-layout'>)</span> <span class='hs-conid'>[]</span> <span class='hs-layout'>(</span><span class='hs-conid'>EpaCommentsBalanced</span> <span class='hs-conid'>[]</span> <span class='hs-conid'>[]</span><span class='hs-layout'>)</span>
<a name="line-957"></a>  <span class='hs-keyglyph'>=</span> <span class='hs-conid'>SrcSpanAnn</span> <span class='hs-conid'>EpAnnNotUsed</span> <span class='hs-varid'>loc</span>
<a name="line-958"></a><span class='hs-definition'>addAnnsA</span> <span class='hs-layout'>(</span><span class='hs-conid'>SrcSpanAnn</span> <span class='hs-conid'>EpAnnNotUsed</span> <span class='hs-varid'>loc</span><span class='hs-layout'>)</span> <span class='hs-keyword'>as</span> <span class='hs-varid'>cs</span>
<a name="line-959"></a>  <span class='hs-keyglyph'>=</span> <span class='hs-conid'>SrcSpanAnn</span> <span class='hs-layout'>(</span><span class='hs-conid'>EpAnn</span> <span class='hs-layout'>(</span><span class='hs-varid'>spanAsAnchor</span> <span class='hs-varid'>loc</span><span class='hs-layout'>)</span> <span class='hs-layout'>(</span><span class='hs-conid'>AnnListItem</span> <span class='hs-keyword'>as</span><span class='hs-layout'>)</span> <span class='hs-varid'>cs</span><span class='hs-layout'>)</span> <span class='hs-varid'>loc</span>
<a name="line-960"></a>
<a name="line-961"></a><a name="widenSpan"></a><span class='hs-comment'>-- | The annotations need to all come after the anchor.  Make sure</span>
<a name="line-962"></a><span class='hs-comment'>-- this is the case.</span>
<a name="line-963"></a><span class='hs-definition'>widenSpan</span> <span class='hs-keyglyph'>::</span> <span class='hs-conid'>SrcSpan</span> <span class='hs-keyglyph'>-&gt;</span> <span class='hs-keyglyph'>[</span><span class='hs-conid'>AddEpAnn</span><span class='hs-keyglyph'>]</span> <span class='hs-keyglyph'>-&gt;</span> <span class='hs-conid'>SrcSpan</span>
<a name="line-964"></a><span class='hs-definition'>widenSpan</span> <span class='hs-varid'>s</span> <span class='hs-keyword'>as</span> <span class='hs-keyglyph'>=</span> <span class='hs-varid'>foldl</span> <span class='hs-varid'>combineSrcSpans</span> <span class='hs-varid'>s</span> <span class='hs-layout'>(</span><span class='hs-varid'>go</span> <span class='hs-keyword'>as</span><span class='hs-layout'>)</span>
<a name="line-965"></a>  <span class='hs-keyword'>where</span>
<a name="line-966"></a>    <span class='hs-varid'>go</span> <span class='hs-conid'>[]</span> <span class='hs-keyglyph'>=</span> <span class='hs-conid'>[]</span>
<a name="line-967"></a>    <span class='hs-varid'>go</span> <span class='hs-layout'>(</span><span class='hs-conid'>AddEpAnn</span> <span class='hs-keyword'>_</span> <span class='hs-layout'>(</span><span class='hs-conid'>EpaSpan</span> <span class='hs-varid'>s</span><span class='hs-layout'>)</span><span class='hs-conop'>:</span><span class='hs-varid'>rest</span><span class='hs-layout'>)</span> <span class='hs-keyglyph'>=</span> <span class='hs-conid'>RealSrcSpan</span> <span class='hs-varid'>s</span> <span class='hs-conid'>Nothing</span> <span class='hs-conop'>:</span> <span class='hs-varid'>go</span> <span class='hs-varid'>rest</span>
<a name="line-968"></a>    <span class='hs-varid'>go</span> <span class='hs-layout'>(</span><span class='hs-conid'>AddEpAnn</span> <span class='hs-keyword'>_</span> <span class='hs-layout'>(</span><span class='hs-conid'>EpaDelta</span> <span class='hs-keyword'>_</span> <span class='hs-keyword'>_</span><span class='hs-layout'>)</span><span class='hs-conop'>:</span><span class='hs-varid'>rest</span><span class='hs-layout'>)</span> <span class='hs-keyglyph'>=</span> <span class='hs-varid'>go</span> <span class='hs-varid'>rest</span>
<a name="line-969"></a>
<a name="line-970"></a><a name="widenRealSpan"></a><span class='hs-comment'>-- | The annotations need to all come after the anchor.  Make sure</span>
<a name="line-971"></a><span class='hs-comment'>-- this is the case.</span>
<a name="line-972"></a><span class='hs-definition'>widenRealSpan</span> <span class='hs-keyglyph'>::</span> <span class='hs-conid'>RealSrcSpan</span> <span class='hs-keyglyph'>-&gt;</span> <span class='hs-keyglyph'>[</span><span class='hs-conid'>AddEpAnn</span><span class='hs-keyglyph'>]</span> <span class='hs-keyglyph'>-&gt;</span> <span class='hs-conid'>RealSrcSpan</span>
<a name="line-973"></a><span class='hs-definition'>widenRealSpan</span> <span class='hs-varid'>s</span> <span class='hs-keyword'>as</span> <span class='hs-keyglyph'>=</span> <span class='hs-varid'>foldl</span> <span class='hs-varid'>combineRealSrcSpans</span> <span class='hs-varid'>s</span> <span class='hs-layout'>(</span><span class='hs-varid'>go</span> <span class='hs-keyword'>as</span><span class='hs-layout'>)</span>
<a name="line-974"></a>  <span class='hs-keyword'>where</span>
<a name="line-975"></a>    <span class='hs-varid'>go</span> <span class='hs-conid'>[]</span> <span class='hs-keyglyph'>=</span> <span class='hs-conid'>[]</span>
<a name="line-976"></a>    <span class='hs-varid'>go</span> <span class='hs-layout'>(</span><span class='hs-conid'>AddEpAnn</span> <span class='hs-keyword'>_</span> <span class='hs-layout'>(</span><span class='hs-conid'>EpaSpan</span> <span class='hs-varid'>s</span><span class='hs-layout'>)</span><span class='hs-conop'>:</span><span class='hs-varid'>rest</span><span class='hs-layout'>)</span> <span class='hs-keyglyph'>=</span> <span class='hs-varid'>s</span> <span class='hs-conop'>:</span> <span class='hs-varid'>go</span> <span class='hs-varid'>rest</span>
<a name="line-977"></a>    <span class='hs-varid'>go</span> <span class='hs-layout'>(</span><span class='hs-conid'>AddEpAnn</span> <span class='hs-keyword'>_</span> <span class='hs-layout'>(</span><span class='hs-conid'>EpaDelta</span> <span class='hs-keyword'>_</span> <span class='hs-keyword'>_</span><span class='hs-layout'>)</span><span class='hs-conop'>:</span><span class='hs-varid'>rest</span><span class='hs-layout'>)</span> <span class='hs-keyglyph'>=</span>     <span class='hs-varid'>go</span> <span class='hs-varid'>rest</span>
<a name="line-978"></a>
<a name="line-979"></a><a name="widenAnchor"></a><span class='hs-definition'>widenAnchor</span> <span class='hs-keyglyph'>::</span> <span class='hs-conid'>Anchor</span> <span class='hs-keyglyph'>-&gt;</span> <span class='hs-keyglyph'>[</span><span class='hs-conid'>AddEpAnn</span><span class='hs-keyglyph'>]</span> <span class='hs-keyglyph'>-&gt;</span> <span class='hs-conid'>Anchor</span>
<a name="line-980"></a><span class='hs-definition'>widenAnchor</span> <span class='hs-layout'>(</span><span class='hs-conid'>Anchor</span> <span class='hs-varid'>s</span> <span class='hs-varid'>op</span><span class='hs-layout'>)</span> <span class='hs-keyword'>as</span> <span class='hs-keyglyph'>=</span> <span class='hs-conid'>Anchor</span> <span class='hs-layout'>(</span><span class='hs-varid'>widenRealSpan</span> <span class='hs-varid'>s</span> <span class='hs-keyword'>as</span><span class='hs-layout'>)</span> <span class='hs-varid'>op</span>
<a name="line-981"></a>
<a name="line-982"></a><a name="widenAnchorR"></a><span class='hs-definition'>widenAnchorR</span> <span class='hs-keyglyph'>::</span> <span class='hs-conid'>Anchor</span> <span class='hs-keyglyph'>-&gt;</span> <span class='hs-conid'>RealSrcSpan</span> <span class='hs-keyglyph'>-&gt;</span> <span class='hs-conid'>Anchor</span>
<a name="line-983"></a><span class='hs-definition'>widenAnchorR</span> <span class='hs-layout'>(</span><span class='hs-conid'>Anchor</span> <span class='hs-varid'>s</span> <span class='hs-varid'>op</span><span class='hs-layout'>)</span> <span class='hs-varid'>r</span> <span class='hs-keyglyph'>=</span> <span class='hs-conid'>Anchor</span> <span class='hs-layout'>(</span><span class='hs-varid'>combineRealSrcSpans</span> <span class='hs-varid'>s</span> <span class='hs-varid'>r</span><span class='hs-layout'>)</span> <span class='hs-varid'>op</span>
<a name="line-984"></a>
<a name="line-985"></a><a name="widenLocatedAn"></a><span class='hs-definition'>widenLocatedAn</span> <span class='hs-keyglyph'>::</span> <span class='hs-conid'>SrcSpanAnn'</span> <span class='hs-varid'>an</span> <span class='hs-keyglyph'>-&gt;</span> <span class='hs-keyglyph'>[</span><span class='hs-conid'>AddEpAnn</span><span class='hs-keyglyph'>]</span> <span class='hs-keyglyph'>-&gt;</span> <span class='hs-conid'>SrcSpanAnn'</span> <span class='hs-varid'>an</span>
<a name="line-986"></a><span class='hs-definition'>widenLocatedAn</span> <span class='hs-layout'>(</span><span class='hs-conid'>SrcSpanAnn</span> <span class='hs-varid'>a</span> <span class='hs-varid'>l</span><span class='hs-layout'>)</span> <span class='hs-keyword'>as</span> <span class='hs-keyglyph'>=</span> <span class='hs-conid'>SrcSpanAnn</span> <span class='hs-varid'>a</span> <span class='hs-layout'>(</span><span class='hs-varid'>widenSpan</span> <span class='hs-varid'>l</span> <span class='hs-keyword'>as</span><span class='hs-layout'>)</span>
<a name="line-987"></a>
<a name="line-988"></a><a name="epAnnAnnsL"></a><span class='hs-definition'>epAnnAnnsL</span> <span class='hs-keyglyph'>::</span> <span class='hs-conid'>EpAnn</span> <span class='hs-varid'>a</span> <span class='hs-keyglyph'>-&gt;</span> <span class='hs-keyglyph'>[</span><span class='hs-varid'>a</span><span class='hs-keyglyph'>]</span>
<a name="line-989"></a><span class='hs-definition'>epAnnAnnsL</span> <span class='hs-conid'>EpAnnNotUsed</span> <span class='hs-keyglyph'>=</span> <span class='hs-conid'>[]</span>
<a name="line-990"></a><span class='hs-definition'>epAnnAnnsL</span> <span class='hs-layout'>(</span><span class='hs-conid'>EpAnn</span> <span class='hs-keyword'>_</span> <span class='hs-varid'>anns</span> <span class='hs-keyword'>_</span><span class='hs-layout'>)</span> <span class='hs-keyglyph'>=</span> <span class='hs-keyglyph'>[</span><span class='hs-varid'>anns</span><span class='hs-keyglyph'>]</span>
<a name="line-991"></a>
<a name="line-992"></a><a name="epAnnAnns"></a><span class='hs-definition'>epAnnAnns</span> <span class='hs-keyglyph'>::</span> <span class='hs-conid'>EpAnn</span> <span class='hs-keyglyph'>[</span><span class='hs-conid'>AddEpAnn</span><span class='hs-keyglyph'>]</span> <span class='hs-keyglyph'>-&gt;</span> <span class='hs-keyglyph'>[</span><span class='hs-conid'>AddEpAnn</span><span class='hs-keyglyph'>]</span>
<a name="line-993"></a><span class='hs-definition'>epAnnAnns</span> <span class='hs-conid'>EpAnnNotUsed</span> <span class='hs-keyglyph'>=</span> <span class='hs-conid'>[]</span>
<a name="line-994"></a><span class='hs-definition'>epAnnAnns</span> <span class='hs-layout'>(</span><span class='hs-conid'>EpAnn</span> <span class='hs-keyword'>_</span> <span class='hs-varid'>anns</span> <span class='hs-keyword'>_</span><span class='hs-layout'>)</span> <span class='hs-keyglyph'>=</span> <span class='hs-varid'>anns</span>
<a name="line-995"></a>
<a name="line-996"></a><a name="annParen2AddEpAnn"></a><span class='hs-definition'>annParen2AddEpAnn</span> <span class='hs-keyglyph'>::</span> <span class='hs-conid'>EpAnn</span> <span class='hs-conid'>AnnParen</span> <span class='hs-keyglyph'>-&gt;</span> <span class='hs-keyglyph'>[</span><span class='hs-conid'>AddEpAnn</span><span class='hs-keyglyph'>]</span>
<a name="line-997"></a><span class='hs-definition'>annParen2AddEpAnn</span> <span class='hs-conid'>EpAnnNotUsed</span> <span class='hs-keyglyph'>=</span> <span class='hs-conid'>[]</span>
<a name="line-998"></a><span class='hs-definition'>annParen2AddEpAnn</span> <span class='hs-layout'>(</span><span class='hs-conid'>EpAnn</span> <span class='hs-keyword'>_</span> <span class='hs-layout'>(</span><span class='hs-conid'>AnnParen</span> <span class='hs-varid'>pt</span> <span class='hs-varid'>o</span> <span class='hs-varid'>c</span><span class='hs-layout'>)</span> <span class='hs-keyword'>_</span><span class='hs-layout'>)</span>
<a name="line-999"></a>  <span class='hs-keyglyph'>=</span> <span class='hs-keyglyph'>[</span><span class='hs-conid'>AddEpAnn</span> <span class='hs-varid'>ai</span> <span class='hs-varid'>o</span><span class='hs-layout'>,</span> <span class='hs-conid'>AddEpAnn</span> <span class='hs-varid'>ac</span> <span class='hs-varid'>c</span><span class='hs-keyglyph'>]</span>
<a name="line-1000"></a>  <span class='hs-keyword'>where</span>
<a name="line-1001"></a>    <span class='hs-layout'>(</span><span class='hs-varid'>ai</span><span class='hs-layout'>,</span><span class='hs-varid'>ac</span><span class='hs-layout'>)</span> <span class='hs-keyglyph'>=</span> <span class='hs-varid'>parenTypeKws</span> <span class='hs-varid'>pt</span>
<a name="line-1002"></a>
<a name="line-1003"></a><a name="epAnnComments"></a><span class='hs-definition'>epAnnComments</span> <span class='hs-keyglyph'>::</span> <span class='hs-conid'>EpAnn</span> <span class='hs-varid'>an</span> <span class='hs-keyglyph'>-&gt;</span> <span class='hs-conid'>EpAnnComments</span>
<a name="line-1004"></a><span class='hs-definition'>epAnnComments</span> <span class='hs-conid'>EpAnnNotUsed</span> <span class='hs-keyglyph'>=</span> <span class='hs-conid'>EpaComments</span> <span class='hs-conid'>[]</span>
<a name="line-1005"></a><span class='hs-definition'>epAnnComments</span> <span class='hs-layout'>(</span><span class='hs-conid'>EpAnn</span> <span class='hs-keyword'>_</span> <span class='hs-keyword'>_</span> <span class='hs-varid'>cs</span><span class='hs-layout'>)</span> <span class='hs-keyglyph'>=</span> <span class='hs-varid'>cs</span>
<a name="line-1006"></a>
<a name="line-1007"></a><a name="sortLocatedA"></a><span class='hs-comment'>-- ---------------------------------------------------------------------</span>
<a name="line-1008"></a><span class='hs-comment'>-- sortLocatedA :: [LocatedA a] -&gt; [LocatedA a]</span>
<a name="line-1009"></a><span class='hs-definition'>sortLocatedA</span> <span class='hs-keyglyph'>::</span> <span class='hs-keyglyph'>[</span><span class='hs-conid'>GenLocated</span> <span class='hs-layout'>(</span><span class='hs-conid'>SrcSpanAnn'</span> <span class='hs-varid'>a</span><span class='hs-layout'>)</span> <span class='hs-varid'>e</span><span class='hs-keyglyph'>]</span> <span class='hs-keyglyph'>-&gt;</span> <span class='hs-keyglyph'>[</span><span class='hs-conid'>GenLocated</span> <span class='hs-layout'>(</span><span class='hs-conid'>SrcSpanAnn'</span> <span class='hs-varid'>a</span><span class='hs-layout'>)</span> <span class='hs-varid'>e</span><span class='hs-keyglyph'>]</span>
<a name="line-1010"></a><span class='hs-definition'>sortLocatedA</span> <span class='hs-keyglyph'>=</span> <span class='hs-varid'>sortBy</span> <span class='hs-layout'>(</span><span class='hs-varid'>leftmost_smallest</span> <span class='hs-varop'>`on`</span> <span class='hs-varid'>getLocA</span><span class='hs-layout'>)</span>
<a name="line-1011"></a>
<a name="line-1012"></a><a name="mapLocA"></a><span class='hs-definition'>mapLocA</span> <span class='hs-keyglyph'>::</span> <span class='hs-layout'>(</span><span class='hs-varid'>a</span> <span class='hs-keyglyph'>-&gt;</span> <span class='hs-varid'>b</span><span class='hs-layout'>)</span> <span class='hs-keyglyph'>-&gt;</span> <span class='hs-conid'>GenLocated</span> <span class='hs-conid'>SrcSpan</span> <span class='hs-varid'>a</span> <span class='hs-keyglyph'>-&gt;</span> <span class='hs-conid'>GenLocated</span> <span class='hs-layout'>(</span><span class='hs-conid'>SrcAnn</span> <span class='hs-varid'>ann</span><span class='hs-layout'>)</span> <span class='hs-varid'>b</span>
<a name="line-1013"></a><span class='hs-definition'>mapLocA</span> <span class='hs-varid'>f</span> <span class='hs-layout'>(</span><span class='hs-conid'>L</span> <span class='hs-varid'>l</span> <span class='hs-varid'>a</span><span class='hs-layout'>)</span> <span class='hs-keyglyph'>=</span> <span class='hs-conid'>L</span> <span class='hs-layout'>(</span><span class='hs-varid'>noAnnSrcSpan</span> <span class='hs-varid'>l</span><span class='hs-layout'>)</span> <span class='hs-layout'>(</span><span class='hs-varid'>f</span> <span class='hs-varid'>a</span><span class='hs-layout'>)</span>
<a name="line-1014"></a>
<a name="line-1015"></a><span class='hs-comment'>-- AZ:TODO: move this somewhere sane</span>
<a name="line-1016"></a>
<a name="line-1017"></a><a name="combineLocsA"></a><span class='hs-definition'>combineLocsA</span> <span class='hs-keyglyph'>::</span> <span class='hs-conid'>Semigroup</span> <span class='hs-varid'>a</span> <span class='hs-keyglyph'>=&gt;</span> <span class='hs-conid'>GenLocated</span> <span class='hs-layout'>(</span><span class='hs-conid'>SrcAnn</span> <span class='hs-varid'>a</span><span class='hs-layout'>)</span> <span class='hs-varid'>e1</span> <span class='hs-keyglyph'>-&gt;</span> <span class='hs-conid'>GenLocated</span> <span class='hs-layout'>(</span><span class='hs-conid'>SrcAnn</span> <span class='hs-varid'>a</span><span class='hs-layout'>)</span> <span class='hs-varid'>e2</span> <span class='hs-keyglyph'>-&gt;</span> <span class='hs-conid'>SrcAnn</span> <span class='hs-varid'>a</span>
<a name="line-1018"></a><span class='hs-definition'>combineLocsA</span> <span class='hs-layout'>(</span><span class='hs-conid'>L</span> <span class='hs-varid'>a</span> <span class='hs-keyword'>_</span><span class='hs-layout'>)</span> <span class='hs-layout'>(</span><span class='hs-conid'>L</span> <span class='hs-varid'>b</span> <span class='hs-keyword'>_</span><span class='hs-layout'>)</span> <span class='hs-keyglyph'>=</span> <span class='hs-varid'>combineSrcSpansA</span> <span class='hs-varid'>a</span> <span class='hs-varid'>b</span>
<a name="line-1019"></a>
<a name="line-1020"></a><a name="combineSrcSpansA"></a><span class='hs-definition'>combineSrcSpansA</span> <span class='hs-keyglyph'>::</span> <span class='hs-conid'>Semigroup</span> <span class='hs-varid'>a</span> <span class='hs-keyglyph'>=&gt;</span> <span class='hs-conid'>SrcAnn</span> <span class='hs-varid'>a</span> <span class='hs-keyglyph'>-&gt;</span> <span class='hs-conid'>SrcAnn</span> <span class='hs-varid'>a</span> <span class='hs-keyglyph'>-&gt;</span> <span class='hs-conid'>SrcAnn</span> <span class='hs-varid'>a</span>
<a name="line-1021"></a><span class='hs-definition'>combineSrcSpansA</span> <span class='hs-layout'>(</span><span class='hs-conid'>SrcSpanAnn</span> <span class='hs-varid'>aa</span> <span class='hs-varid'>la</span><span class='hs-layout'>)</span> <span class='hs-layout'>(</span><span class='hs-conid'>SrcSpanAnn</span> <span class='hs-varid'>ab</span> <span class='hs-varid'>lb</span><span class='hs-layout'>)</span>
<a name="line-1022"></a>  <span class='hs-keyglyph'>=</span> <span class='hs-keyword'>case</span> <span class='hs-conid'>SrcSpanAnn</span> <span class='hs-layout'>(</span><span class='hs-varid'>aa</span> <span class='hs-varop'>&lt;&gt;</span> <span class='hs-varid'>ab</span><span class='hs-layout'>)</span> <span class='hs-layout'>(</span><span class='hs-varid'>combineSrcSpans</span> <span class='hs-varid'>la</span> <span class='hs-varid'>lb</span><span class='hs-layout'>)</span> <span class='hs-keyword'>of</span>
<a name="line-1023"></a>      <span class='hs-conid'>SrcSpanAnn</span> <span class='hs-conid'>EpAnnNotUsed</span> <span class='hs-varid'>l</span> <span class='hs-keyglyph'>-&gt;</span> <span class='hs-conid'>SrcSpanAnn</span> <span class='hs-conid'>EpAnnNotUsed</span> <span class='hs-varid'>l</span>
<a name="line-1024"></a>      <span class='hs-conid'>SrcSpanAnn</span> <span class='hs-layout'>(</span><span class='hs-conid'>EpAnn</span> <span class='hs-varid'>anc</span> <span class='hs-varid'>an</span> <span class='hs-varid'>cs</span><span class='hs-layout'>)</span> <span class='hs-varid'>l</span> <span class='hs-keyglyph'>-&gt;</span>
<a name="line-1025"></a>        <span class='hs-conid'>SrcSpanAnn</span> <span class='hs-layout'>(</span><span class='hs-conid'>EpAnn</span> <span class='hs-layout'>(</span><span class='hs-varid'>widenAnchorR</span> <span class='hs-varid'>anc</span> <span class='hs-layout'>(</span><span class='hs-varid'>realSrcSpan</span> <span class='hs-varid'>l</span><span class='hs-layout'>)</span><span class='hs-layout'>)</span> <span class='hs-varid'>an</span> <span class='hs-varid'>cs</span><span class='hs-layout'>)</span> <span class='hs-varid'>l</span>
<a name="line-1026"></a>
<a name="line-1027"></a><a name="addCLocA"></a><span class='hs-comment'>-- | Combine locations from two 'Located' things and add them to a third thing</span>
<a name="line-1028"></a><span class='hs-definition'>addCLocA</span> <span class='hs-keyglyph'>::</span> <span class='hs-conid'>GenLocated</span> <span class='hs-layout'>(</span><span class='hs-conid'>SrcSpanAnn'</span> <span class='hs-varid'>a</span><span class='hs-layout'>)</span> <span class='hs-varid'>e1</span> <span class='hs-keyglyph'>-&gt;</span> <span class='hs-conid'>GenLocated</span> <span class='hs-conid'>SrcSpan</span> <span class='hs-varid'>e2</span> <span class='hs-keyglyph'>-&gt;</span> <span class='hs-varid'>e3</span> <span class='hs-keyglyph'>-&gt;</span> <span class='hs-conid'>GenLocated</span> <span class='hs-layout'>(</span><span class='hs-conid'>SrcAnn</span> <span class='hs-varid'>ann</span><span class='hs-layout'>)</span> <span class='hs-varid'>e3</span>
<a name="line-1029"></a><span class='hs-definition'>addCLocA</span> <span class='hs-varid'>a</span> <span class='hs-varid'>b</span> <span class='hs-varid'>c</span> <span class='hs-keyglyph'>=</span> <span class='hs-conid'>L</span> <span class='hs-layout'>(</span><span class='hs-varid'>noAnnSrcSpan</span> <span class='hs-varop'>$</span> <span class='hs-varid'>combineSrcSpans</span> <span class='hs-layout'>(</span><span class='hs-varid'>locA</span> <span class='hs-varop'>$</span> <span class='hs-varid'>getLoc</span> <span class='hs-varid'>a</span><span class='hs-layout'>)</span> <span class='hs-layout'>(</span><span class='hs-varid'>getLoc</span> <span class='hs-varid'>b</span><span class='hs-layout'>)</span><span class='hs-layout'>)</span> <span class='hs-varid'>c</span>
<a name="line-1030"></a>
<a name="line-1031"></a><a name="addCLocAA"></a><span class='hs-definition'>addCLocAA</span> <span class='hs-keyglyph'>::</span> <span class='hs-conid'>GenLocated</span> <span class='hs-layout'>(</span><span class='hs-conid'>SrcSpanAnn'</span> <span class='hs-varid'>a1</span><span class='hs-layout'>)</span> <span class='hs-varid'>e1</span> <span class='hs-keyglyph'>-&gt;</span> <span class='hs-conid'>GenLocated</span> <span class='hs-layout'>(</span><span class='hs-conid'>SrcSpanAnn'</span> <span class='hs-varid'>a2</span><span class='hs-layout'>)</span> <span class='hs-varid'>e2</span> <span class='hs-keyglyph'>-&gt;</span> <span class='hs-varid'>e3</span> <span class='hs-keyglyph'>-&gt;</span> <span class='hs-conid'>GenLocated</span> <span class='hs-layout'>(</span><span class='hs-conid'>SrcAnn</span> <span class='hs-varid'>ann</span><span class='hs-layout'>)</span> <span class='hs-varid'>e3</span>
<a name="line-1032"></a><span class='hs-definition'>addCLocAA</span> <span class='hs-varid'>a</span> <span class='hs-varid'>b</span> <span class='hs-varid'>c</span> <span class='hs-keyglyph'>=</span> <span class='hs-conid'>L</span> <span class='hs-layout'>(</span><span class='hs-varid'>noAnnSrcSpan</span> <span class='hs-varop'>$</span> <span class='hs-varid'>combineSrcSpans</span> <span class='hs-layout'>(</span><span class='hs-varid'>locA</span> <span class='hs-varop'>$</span> <span class='hs-varid'>getLoc</span> <span class='hs-varid'>a</span><span class='hs-layout'>)</span> <span class='hs-layout'>(</span><span class='hs-varid'>locA</span> <span class='hs-varop'>$</span> <span class='hs-varid'>getLoc</span> <span class='hs-varid'>b</span><span class='hs-layout'>)</span><span class='hs-layout'>)</span> <span class='hs-varid'>c</span>
<a name="line-1033"></a>
<a name="line-1034"></a><span class='hs-comment'>-- ---------------------------------------------------------------------</span>
<a name="line-1035"></a><span class='hs-comment'>-- Utilities for manipulating EpAnnComments</span>
<a name="line-1036"></a><span class='hs-comment'>-- ---------------------------------------------------------------------</span>
<a name="line-1037"></a>
<a name="line-1038"></a><a name="getFollowingComments"></a><span class='hs-definition'>getFollowingComments</span> <span class='hs-keyglyph'>::</span> <span class='hs-conid'>EpAnnComments</span> <span class='hs-keyglyph'>-&gt;</span> <span class='hs-keyglyph'>[</span><span class='hs-conid'>LEpaComment</span><span class='hs-keyglyph'>]</span>
<a name="line-1039"></a><span class='hs-definition'>getFollowingComments</span> <span class='hs-layout'>(</span><span class='hs-conid'>EpaComments</span> <span class='hs-keyword'>_</span><span class='hs-layout'>)</span> <span class='hs-keyglyph'>=</span> <span class='hs-conid'>[]</span>
<a name="line-1040"></a><span class='hs-definition'>getFollowingComments</span> <span class='hs-layout'>(</span><span class='hs-conid'>EpaCommentsBalanced</span> <span class='hs-keyword'>_</span> <span class='hs-varid'>cs</span><span class='hs-layout'>)</span> <span class='hs-keyglyph'>=</span> <span class='hs-varid'>cs</span>
<a name="line-1041"></a>
<a name="line-1042"></a><a name="setFollowingComments"></a><span class='hs-definition'>setFollowingComments</span> <span class='hs-keyglyph'>::</span> <span class='hs-conid'>EpAnnComments</span> <span class='hs-keyglyph'>-&gt;</span> <span class='hs-keyglyph'>[</span><span class='hs-conid'>LEpaComment</span><span class='hs-keyglyph'>]</span> <span class='hs-keyglyph'>-&gt;</span> <span class='hs-conid'>EpAnnComments</span>
<a name="line-1043"></a><span class='hs-definition'>setFollowingComments</span> <span class='hs-layout'>(</span><span class='hs-conid'>EpaComments</span> <span class='hs-varid'>ls</span><span class='hs-layout'>)</span> <span class='hs-varid'>cs</span>           <span class='hs-keyglyph'>=</span> <span class='hs-conid'>EpaCommentsBalanced</span> <span class='hs-varid'>ls</span> <span class='hs-varid'>cs</span>
<a name="line-1044"></a><span class='hs-definition'>setFollowingComments</span> <span class='hs-layout'>(</span><span class='hs-conid'>EpaCommentsBalanced</span> <span class='hs-varid'>ls</span> <span class='hs-keyword'>_</span><span class='hs-layout'>)</span> <span class='hs-varid'>cs</span> <span class='hs-keyglyph'>=</span> <span class='hs-conid'>EpaCommentsBalanced</span> <span class='hs-varid'>ls</span> <span class='hs-varid'>cs</span>
<a name="line-1045"></a>
<a name="line-1046"></a><a name="setPriorComments"></a><span class='hs-definition'>setPriorComments</span> <span class='hs-keyglyph'>::</span> <span class='hs-conid'>EpAnnComments</span> <span class='hs-keyglyph'>-&gt;</span> <span class='hs-keyglyph'>[</span><span class='hs-conid'>LEpaComment</span><span class='hs-keyglyph'>]</span> <span class='hs-keyglyph'>-&gt;</span> <span class='hs-conid'>EpAnnComments</span>
<a name="line-1047"></a><span class='hs-definition'>setPriorComments</span> <span class='hs-layout'>(</span><span class='hs-conid'>EpaComments</span> <span class='hs-keyword'>_</span><span class='hs-layout'>)</span> <span class='hs-varid'>cs</span>            <span class='hs-keyglyph'>=</span> <span class='hs-conid'>EpaComments</span> <span class='hs-varid'>cs</span>
<a name="line-1048"></a><span class='hs-definition'>setPriorComments</span> <span class='hs-layout'>(</span><span class='hs-conid'>EpaCommentsBalanced</span> <span class='hs-keyword'>_</span> <span class='hs-varid'>ts</span><span class='hs-layout'>)</span> <span class='hs-varid'>cs</span> <span class='hs-keyglyph'>=</span> <span class='hs-conid'>EpaCommentsBalanced</span> <span class='hs-varid'>cs</span> <span class='hs-varid'>ts</span>
<a name="line-1049"></a>
<a name="line-1050"></a><span class='hs-comment'>-- ---------------------------------------------------------------------</span>
<a name="line-1051"></a><span class='hs-comment'>-- Comment-only annotations</span>
<a name="line-1052"></a><span class='hs-comment'>-- ---------------------------------------------------------------------</span>
<a name="line-1053"></a>
<a name="line-1054"></a><a name="EpAnnCO"></a><span class='hs-comment'>-- TODO:AZ I think EpAnnCO is not needed</span>
<a name="line-1055"></a><a name="EpAnnCO"></a><span class='hs-keyword'>type</span> <span class='hs-conid'>EpAnnCO</span> <span class='hs-keyglyph'>=</span> <span class='hs-conid'>EpAnn</span> <span class='hs-conid'>NoEpAnns</span> <span class='hs-comment'>-- ^ Api Annotations for comments only</span>
<a name="line-1056"></a>
<a name="line-1057"></a><a name="NoEpAnns"></a><span class='hs-keyword'>data</span> <span class='hs-conid'>NoEpAnns</span> <span class='hs-keyglyph'>=</span> <span class='hs-conid'>NoEpAnns</span>
<a name="line-1058"></a>  <span class='hs-keyword'>deriving</span> <span class='hs-layout'>(</span><span class='hs-conid'>Data</span><span class='hs-layout'>,</span><span class='hs-conid'>Eq</span><span class='hs-layout'>,</span><span class='hs-conid'>Ord</span><span class='hs-layout'>)</span>
<a name="line-1059"></a>
<a name="line-1060"></a><a name="noComments"></a><span class='hs-definition'>noComments</span> <span class='hs-keyglyph'>::</span><span class='hs-conid'>EpAnnCO</span>
<a name="line-1061"></a><span class='hs-definition'>noComments</span> <span class='hs-keyglyph'>=</span> <span class='hs-conid'>EpAnn</span> <span class='hs-layout'>(</span><span class='hs-conid'>Anchor</span> <span class='hs-varid'>placeholderRealSpan</span> <span class='hs-conid'>UnchangedAnchor</span><span class='hs-layout'>)</span> <span class='hs-conid'>NoEpAnns</span> <span class='hs-varid'>emptyComments</span>
<a name="line-1062"></a>
<a name="line-1063"></a><a name="placeholderRealSpan"></a><span class='hs-comment'>-- TODO:AZ get rid of this</span>
<a name="line-1064"></a><span class='hs-definition'>placeholderRealSpan</span> <span class='hs-keyglyph'>::</span> <span class='hs-conid'>RealSrcSpan</span>
<a name="line-1065"></a><span class='hs-definition'>placeholderRealSpan</span> <span class='hs-keyglyph'>=</span> <span class='hs-varid'>realSrcLocSpan</span> <span class='hs-layout'>(</span><span class='hs-varid'>mkRealSrcLoc</span> <span class='hs-layout'>(</span><span class='hs-varid'>mkFastString</span> <span class='hs-str'>"placeholder"</span><span class='hs-layout'>)</span> <span class='hs-layout'>(</span><span class='hs-comment'>-</span><span class='hs-num'>1</span><span class='hs-layout'>)</span> <span class='hs-layout'>(</span><span class='hs-comment'>-</span><span class='hs-num'>1</span><span class='hs-layout'>)</span><span class='hs-layout'>)</span>
<a name="line-1066"></a>
<a name="line-1067"></a><a name="comment"></a><span class='hs-definition'>comment</span> <span class='hs-keyglyph'>::</span> <span class='hs-conid'>RealSrcSpan</span> <span class='hs-keyglyph'>-&gt;</span> <span class='hs-conid'>EpAnnComments</span> <span class='hs-keyglyph'>-&gt;</span> <span class='hs-conid'>EpAnnCO</span>
<a name="line-1068"></a><span class='hs-definition'>comment</span> <span class='hs-varid'>loc</span> <span class='hs-varid'>cs</span> <span class='hs-keyglyph'>=</span> <span class='hs-conid'>EpAnn</span> <span class='hs-layout'>(</span><span class='hs-conid'>Anchor</span> <span class='hs-varid'>loc</span> <span class='hs-conid'>UnchangedAnchor</span><span class='hs-layout'>)</span> <span class='hs-conid'>NoEpAnns</span> <span class='hs-varid'>cs</span>
<a name="line-1069"></a>
<a name="line-1070"></a><span class='hs-comment'>-- ---------------------------------------------------------------------</span>
<a name="line-1071"></a><span class='hs-comment'>-- Utilities for managing comments in an `EpAnn a` structure.</span>
<a name="line-1072"></a><span class='hs-comment'>-- ---------------------------------------------------------------------</span>
<a name="line-1073"></a>
<a name="line-1074"></a><a name="addCommentsToSrcAnn"></a><span class='hs-comment'>-- | Add additional comments to a 'SrcAnn', used for manipulating the</span>
<a name="line-1075"></a><span class='hs-comment'>-- AST prior to exact printing the changed one.</span>
<a name="line-1076"></a><span class='hs-definition'>addCommentsToSrcAnn</span> <span class='hs-keyglyph'>::</span> <span class='hs-layout'>(</span><span class='hs-conid'>Monoid</span> <span class='hs-varid'>ann</span><span class='hs-layout'>)</span> <span class='hs-keyglyph'>=&gt;</span> <span class='hs-conid'>SrcAnn</span> <span class='hs-varid'>ann</span> <span class='hs-keyglyph'>-&gt;</span> <span class='hs-conid'>EpAnnComments</span> <span class='hs-keyglyph'>-&gt;</span> <span class='hs-conid'>SrcAnn</span> <span class='hs-varid'>ann</span>
<a name="line-1077"></a><span class='hs-definition'>addCommentsToSrcAnn</span> <span class='hs-layout'>(</span><span class='hs-conid'>SrcSpanAnn</span> <span class='hs-conid'>EpAnnNotUsed</span> <span class='hs-varid'>loc</span><span class='hs-layout'>)</span> <span class='hs-varid'>cs</span>
<a name="line-1078"></a>  <span class='hs-keyglyph'>=</span> <span class='hs-conid'>SrcSpanAnn</span> <span class='hs-layout'>(</span><span class='hs-conid'>EpAnn</span> <span class='hs-layout'>(</span><span class='hs-conid'>Anchor</span> <span class='hs-layout'>(</span><span class='hs-varid'>realSrcSpan</span> <span class='hs-varid'>loc</span><span class='hs-layout'>)</span> <span class='hs-conid'>UnchangedAnchor</span><span class='hs-layout'>)</span> <span class='hs-varid'>mempty</span> <span class='hs-varid'>cs</span><span class='hs-layout'>)</span> <span class='hs-varid'>loc</span>
<a name="line-1079"></a><span class='hs-definition'>addCommentsToSrcAnn</span> <span class='hs-layout'>(</span><span class='hs-conid'>SrcSpanAnn</span> <span class='hs-layout'>(</span><span class='hs-conid'>EpAnn</span> <span class='hs-varid'>a</span> <span class='hs-varid'>an</span> <span class='hs-varid'>cs</span><span class='hs-layout'>)</span> <span class='hs-varid'>loc</span><span class='hs-layout'>)</span> <span class='hs-varid'>cs'</span>
<a name="line-1080"></a>  <span class='hs-keyglyph'>=</span> <span class='hs-conid'>SrcSpanAnn</span> <span class='hs-layout'>(</span><span class='hs-conid'>EpAnn</span> <span class='hs-varid'>a</span> <span class='hs-varid'>an</span> <span class='hs-layout'>(</span><span class='hs-varid'>cs</span> <span class='hs-varop'>&lt;&gt;</span> <span class='hs-varid'>cs'</span><span class='hs-layout'>)</span><span class='hs-layout'>)</span> <span class='hs-varid'>loc</span>
<a name="line-1081"></a>
<a name="line-1082"></a><a name="setCommentsSrcAnn"></a><span class='hs-comment'>-- | Replace any existing comments on a 'SrcAnn', used for manipulating the</span>
<a name="line-1083"></a><span class='hs-comment'>-- AST prior to exact printing the changed one.</span>
<a name="line-1084"></a><span class='hs-definition'>setCommentsSrcAnn</span> <span class='hs-keyglyph'>::</span> <span class='hs-layout'>(</span><span class='hs-conid'>Monoid</span> <span class='hs-varid'>ann</span><span class='hs-layout'>)</span> <span class='hs-keyglyph'>=&gt;</span> <span class='hs-conid'>SrcAnn</span> <span class='hs-varid'>ann</span> <span class='hs-keyglyph'>-&gt;</span> <span class='hs-conid'>EpAnnComments</span> <span class='hs-keyglyph'>-&gt;</span> <span class='hs-conid'>SrcAnn</span> <span class='hs-varid'>ann</span>
<a name="line-1085"></a><span class='hs-definition'>setCommentsSrcAnn</span> <span class='hs-layout'>(</span><span class='hs-conid'>SrcSpanAnn</span> <span class='hs-conid'>EpAnnNotUsed</span> <span class='hs-varid'>loc</span><span class='hs-layout'>)</span> <span class='hs-varid'>cs</span>
<a name="line-1086"></a>  <span class='hs-keyglyph'>=</span> <span class='hs-conid'>SrcSpanAnn</span> <span class='hs-layout'>(</span><span class='hs-conid'>EpAnn</span> <span class='hs-layout'>(</span><span class='hs-conid'>Anchor</span> <span class='hs-layout'>(</span><span class='hs-varid'>realSrcSpan</span> <span class='hs-varid'>loc</span><span class='hs-layout'>)</span> <span class='hs-conid'>UnchangedAnchor</span><span class='hs-layout'>)</span> <span class='hs-varid'>mempty</span> <span class='hs-varid'>cs</span><span class='hs-layout'>)</span> <span class='hs-varid'>loc</span>
<a name="line-1087"></a><span class='hs-definition'>setCommentsSrcAnn</span> <span class='hs-layout'>(</span><span class='hs-conid'>SrcSpanAnn</span> <span class='hs-layout'>(</span><span class='hs-conid'>EpAnn</span> <span class='hs-varid'>a</span> <span class='hs-varid'>an</span> <span class='hs-keyword'>_</span><span class='hs-layout'>)</span> <span class='hs-varid'>loc</span><span class='hs-layout'>)</span> <span class='hs-varid'>cs</span>
<a name="line-1088"></a>  <span class='hs-keyglyph'>=</span> <span class='hs-conid'>SrcSpanAnn</span> <span class='hs-layout'>(</span><span class='hs-conid'>EpAnn</span> <span class='hs-varid'>a</span> <span class='hs-varid'>an</span> <span class='hs-varid'>cs</span><span class='hs-layout'>)</span> <span class='hs-varid'>loc</span>
<a name="line-1089"></a>
<a name="line-1090"></a><a name="addCommentsToEpAnn"></a><span class='hs-comment'>-- | Add additional comments, used for manipulating the</span>
<a name="line-1091"></a><span class='hs-comment'>-- AST prior to exact printing the changed one.</span>
<a name="line-1092"></a><span class='hs-definition'>addCommentsToEpAnn</span> <span class='hs-keyglyph'>::</span> <span class='hs-layout'>(</span><span class='hs-conid'>Monoid</span> <span class='hs-varid'>a</span><span class='hs-layout'>)</span>
<a name="line-1093"></a>  <span class='hs-keyglyph'>=&gt;</span> <span class='hs-conid'>SrcSpan</span> <span class='hs-keyglyph'>-&gt;</span> <span class='hs-conid'>EpAnn</span> <span class='hs-varid'>a</span> <span class='hs-keyglyph'>-&gt;</span> <span class='hs-conid'>EpAnnComments</span> <span class='hs-keyglyph'>-&gt;</span> <span class='hs-conid'>EpAnn</span> <span class='hs-varid'>a</span>
<a name="line-1094"></a><span class='hs-definition'>addCommentsToEpAnn</span> <span class='hs-varid'>loc</span> <span class='hs-conid'>EpAnnNotUsed</span> <span class='hs-varid'>cs</span>
<a name="line-1095"></a>  <span class='hs-keyglyph'>=</span> <span class='hs-conid'>EpAnn</span> <span class='hs-layout'>(</span><span class='hs-conid'>Anchor</span> <span class='hs-layout'>(</span><span class='hs-varid'>realSrcSpan</span> <span class='hs-varid'>loc</span><span class='hs-layout'>)</span> <span class='hs-conid'>UnchangedAnchor</span><span class='hs-layout'>)</span> <span class='hs-varid'>mempty</span> <span class='hs-varid'>cs</span>
<a name="line-1096"></a><span class='hs-definition'>addCommentsToEpAnn</span> <span class='hs-keyword'>_</span> <span class='hs-layout'>(</span><span class='hs-conid'>EpAnn</span> <span class='hs-varid'>a</span> <span class='hs-varid'>an</span> <span class='hs-varid'>ocs</span><span class='hs-layout'>)</span> <span class='hs-varid'>ncs</span> <span class='hs-keyglyph'>=</span> <span class='hs-conid'>EpAnn</span> <span class='hs-varid'>a</span> <span class='hs-varid'>an</span> <span class='hs-layout'>(</span><span class='hs-varid'>ocs</span> <span class='hs-varop'>&lt;&gt;</span> <span class='hs-varid'>ncs</span><span class='hs-layout'>)</span>
<a name="line-1097"></a>
<a name="line-1098"></a><a name="setCommentsEpAnn"></a><span class='hs-comment'>-- | Replace any existing comments, used for manipulating the</span>
<a name="line-1099"></a><span class='hs-comment'>-- AST prior to exact printing the changed one.</span>
<a name="line-1100"></a><span class='hs-definition'>setCommentsEpAnn</span> <span class='hs-keyglyph'>::</span> <span class='hs-layout'>(</span><span class='hs-conid'>Monoid</span> <span class='hs-varid'>a</span><span class='hs-layout'>)</span>
<a name="line-1101"></a>  <span class='hs-keyglyph'>=&gt;</span> <span class='hs-conid'>SrcSpan</span> <span class='hs-keyglyph'>-&gt;</span> <span class='hs-conid'>EpAnn</span> <span class='hs-varid'>a</span> <span class='hs-keyglyph'>-&gt;</span> <span class='hs-conid'>EpAnnComments</span> <span class='hs-keyglyph'>-&gt;</span> <span class='hs-conid'>EpAnn</span> <span class='hs-varid'>a</span>
<a name="line-1102"></a><span class='hs-definition'>setCommentsEpAnn</span> <span class='hs-varid'>loc</span> <span class='hs-conid'>EpAnnNotUsed</span> <span class='hs-varid'>cs</span>
<a name="line-1103"></a>  <span class='hs-keyglyph'>=</span> <span class='hs-conid'>EpAnn</span> <span class='hs-layout'>(</span><span class='hs-conid'>Anchor</span> <span class='hs-layout'>(</span><span class='hs-varid'>realSrcSpan</span> <span class='hs-varid'>loc</span><span class='hs-layout'>)</span> <span class='hs-conid'>UnchangedAnchor</span><span class='hs-layout'>)</span> <span class='hs-varid'>mempty</span> <span class='hs-varid'>cs</span>
<a name="line-1104"></a><span class='hs-definition'>setCommentsEpAnn</span> <span class='hs-keyword'>_</span> <span class='hs-layout'>(</span><span class='hs-conid'>EpAnn</span> <span class='hs-varid'>a</span> <span class='hs-varid'>an</span> <span class='hs-keyword'>_</span><span class='hs-layout'>)</span> <span class='hs-varid'>cs</span> <span class='hs-keyglyph'>=</span> <span class='hs-conid'>EpAnn</span> <span class='hs-varid'>a</span> <span class='hs-varid'>an</span> <span class='hs-varid'>cs</span>
<a name="line-1105"></a>
<a name="line-1106"></a><a name="transferAnnsA"></a><span class='hs-comment'>-- | Transfer comments and trailing items from the annotations in the</span>
<a name="line-1107"></a><span class='hs-comment'>-- first 'SrcSpanAnnA' argument to those in the second.</span>
<a name="line-1108"></a><span class='hs-definition'>transferAnnsA</span> <span class='hs-keyglyph'>::</span> <span class='hs-conid'>SrcSpanAnnA</span> <span class='hs-keyglyph'>-&gt;</span> <span class='hs-conid'>SrcSpanAnnA</span> <span class='hs-keyglyph'>-&gt;</span> <span class='hs-layout'>(</span><span class='hs-conid'>SrcSpanAnnA</span><span class='hs-layout'>,</span>  <span class='hs-conid'>SrcSpanAnnA</span><span class='hs-layout'>)</span>
<a name="line-1109"></a><span class='hs-definition'>transferAnnsA</span> <span class='hs-varid'>from</span><span class='hs-keyglyph'>@</span><span class='hs-layout'>(</span><span class='hs-conid'>SrcSpanAnn</span> <span class='hs-conid'>EpAnnNotUsed</span> <span class='hs-keyword'>_</span><span class='hs-layout'>)</span> <span class='hs-varid'>to</span> <span class='hs-keyglyph'>=</span> <span class='hs-layout'>(</span><span class='hs-varid'>from</span><span class='hs-layout'>,</span> <span class='hs-varid'>to</span><span class='hs-layout'>)</span>
<a name="line-1110"></a><span class='hs-definition'>transferAnnsA</span> <span class='hs-layout'>(</span><span class='hs-conid'>SrcSpanAnn</span> <span class='hs-layout'>(</span><span class='hs-conid'>EpAnn</span> <span class='hs-varid'>a</span> <span class='hs-varid'>an</span> <span class='hs-varid'>cs</span><span class='hs-layout'>)</span> <span class='hs-varid'>l</span><span class='hs-layout'>)</span> <span class='hs-varid'>to</span>
<a name="line-1111"></a>  <span class='hs-keyglyph'>=</span> <span class='hs-layout'>(</span><span class='hs-layout'>(</span><span class='hs-conid'>SrcSpanAnn</span> <span class='hs-layout'>(</span><span class='hs-conid'>EpAnn</span> <span class='hs-varid'>a</span> <span class='hs-varid'>mempty</span> <span class='hs-varid'>emptyComments</span><span class='hs-layout'>)</span> <span class='hs-varid'>l</span><span class='hs-layout'>)</span><span class='hs-layout'>,</span> <span class='hs-varid'>to'</span><span class='hs-layout'>)</span>
<a name="line-1112"></a>  <span class='hs-keyword'>where</span>
<a name="line-1113"></a>    <span class='hs-varid'>to'</span> <span class='hs-keyglyph'>=</span> <span class='hs-keyword'>case</span> <span class='hs-varid'>to</span> <span class='hs-keyword'>of</span>
<a name="line-1114"></a>      <span class='hs-layout'>(</span><span class='hs-conid'>SrcSpanAnn</span> <span class='hs-conid'>EpAnnNotUsed</span> <span class='hs-varid'>loc</span><span class='hs-layout'>)</span>
<a name="line-1115"></a>        <span class='hs-keyglyph'>-&gt;</span>  <span class='hs-conid'>SrcSpanAnn</span> <span class='hs-layout'>(</span><span class='hs-conid'>EpAnn</span> <span class='hs-layout'>(</span><span class='hs-conid'>Anchor</span> <span class='hs-layout'>(</span><span class='hs-varid'>realSrcSpan</span> <span class='hs-varid'>loc</span><span class='hs-layout'>)</span> <span class='hs-conid'>UnchangedAnchor</span><span class='hs-layout'>)</span> <span class='hs-varid'>an</span> <span class='hs-varid'>cs</span><span class='hs-layout'>)</span> <span class='hs-varid'>loc</span>
<a name="line-1116"></a>      <span class='hs-layout'>(</span><span class='hs-conid'>SrcSpanAnn</span> <span class='hs-layout'>(</span><span class='hs-conid'>EpAnn</span> <span class='hs-varid'>a</span> <span class='hs-varid'>an'</span> <span class='hs-varid'>cs'</span><span class='hs-layout'>)</span> <span class='hs-varid'>loc</span><span class='hs-layout'>)</span>
<a name="line-1117"></a>        <span class='hs-keyglyph'>-&gt;</span> <span class='hs-conid'>SrcSpanAnn</span> <span class='hs-layout'>(</span><span class='hs-conid'>EpAnn</span> <span class='hs-varid'>a</span> <span class='hs-layout'>(</span><span class='hs-varid'>an'</span> <span class='hs-varop'>&lt;&gt;</span> <span class='hs-varid'>an</span><span class='hs-layout'>)</span> <span class='hs-layout'>(</span><span class='hs-varid'>cs'</span> <span class='hs-varop'>&lt;&gt;</span> <span class='hs-varid'>cs</span><span class='hs-layout'>)</span><span class='hs-layout'>)</span> <span class='hs-varid'>loc</span>
<a name="line-1118"></a>
<a name="line-1119"></a><a name="commentsOnlyA"></a><span class='hs-comment'>-- | Remove the exact print annotations payload, leaving only the</span>
<a name="line-1120"></a><span class='hs-comment'>-- anchor and comments.</span>
<a name="line-1121"></a><span class='hs-definition'>commentsOnlyA</span> <span class='hs-keyglyph'>::</span> <span class='hs-conid'>Monoid</span> <span class='hs-varid'>ann</span> <span class='hs-keyglyph'>=&gt;</span> <span class='hs-conid'>SrcAnn</span> <span class='hs-varid'>ann</span> <span class='hs-keyglyph'>-&gt;</span> <span class='hs-conid'>SrcAnn</span> <span class='hs-varid'>ann</span>
<a name="line-1122"></a><span class='hs-definition'>commentsOnlyA</span> <span class='hs-layout'>(</span><span class='hs-conid'>SrcSpanAnn</span> <span class='hs-conid'>EpAnnNotUsed</span> <span class='hs-varid'>loc</span><span class='hs-layout'>)</span> <span class='hs-keyglyph'>=</span> <span class='hs-conid'>SrcSpanAnn</span> <span class='hs-conid'>EpAnnNotUsed</span> <span class='hs-varid'>loc</span>
<a name="line-1123"></a><span class='hs-definition'>commentsOnlyA</span> <span class='hs-layout'>(</span><span class='hs-conid'>SrcSpanAnn</span> <span class='hs-layout'>(</span><span class='hs-conid'>EpAnn</span> <span class='hs-varid'>a</span> <span class='hs-keyword'>_</span> <span class='hs-varid'>cs</span><span class='hs-layout'>)</span> <span class='hs-varid'>loc</span><span class='hs-layout'>)</span> <span class='hs-keyglyph'>=</span> <span class='hs-layout'>(</span><span class='hs-conid'>SrcSpanAnn</span> <span class='hs-layout'>(</span><span class='hs-conid'>EpAnn</span> <span class='hs-varid'>a</span> <span class='hs-varid'>mempty</span> <span class='hs-varid'>cs</span><span class='hs-layout'>)</span> <span class='hs-varid'>loc</span><span class='hs-layout'>)</span>
<a name="line-1124"></a>
<a name="line-1125"></a><a name="removeCommentsA"></a><span class='hs-comment'>-- | Remove the comments, leaving the exact print annotations payload</span>
<a name="line-1126"></a><span class='hs-definition'>removeCommentsA</span> <span class='hs-keyglyph'>::</span> <span class='hs-conid'>SrcAnn</span> <span class='hs-varid'>ann</span> <span class='hs-keyglyph'>-&gt;</span> <span class='hs-conid'>SrcAnn</span> <span class='hs-varid'>ann</span>
<a name="line-1127"></a><span class='hs-definition'>removeCommentsA</span> <span class='hs-layout'>(</span><span class='hs-conid'>SrcSpanAnn</span> <span class='hs-conid'>EpAnnNotUsed</span> <span class='hs-varid'>loc</span><span class='hs-layout'>)</span> <span class='hs-keyglyph'>=</span> <span class='hs-conid'>SrcSpanAnn</span> <span class='hs-conid'>EpAnnNotUsed</span> <span class='hs-varid'>loc</span>
<a name="line-1128"></a><span class='hs-definition'>removeCommentsA</span> <span class='hs-layout'>(</span><span class='hs-conid'>SrcSpanAnn</span> <span class='hs-layout'>(</span><span class='hs-conid'>EpAnn</span> <span class='hs-varid'>a</span> <span class='hs-varid'>an</span> <span class='hs-keyword'>_</span><span class='hs-layout'>)</span> <span class='hs-varid'>loc</span><span class='hs-layout'>)</span>
<a name="line-1129"></a>  <span class='hs-keyglyph'>=</span> <span class='hs-layout'>(</span><span class='hs-conid'>SrcSpanAnn</span> <span class='hs-layout'>(</span><span class='hs-conid'>EpAnn</span> <span class='hs-varid'>a</span> <span class='hs-varid'>an</span> <span class='hs-varid'>emptyComments</span><span class='hs-layout'>)</span> <span class='hs-varid'>loc</span><span class='hs-layout'>)</span>
<a name="line-1130"></a>
<a name="line-1131"></a><span class='hs-comment'>-- ---------------------------------------------------------------------</span>
<a name="line-1132"></a><span class='hs-comment'>-- Semigroup instances, to allow easy combination of annotaion elements</span>
<a name="line-1133"></a><span class='hs-comment'>-- ---------------------------------------------------------------------</span>
<a name="line-1134"></a>
<a name="line-1135"></a><a name="instance%20Semigroup%20(SrcSpanAnn'%20an)"></a><span class='hs-keyword'>instance</span> <span class='hs-layout'>(</span><span class='hs-conid'>Semigroup</span> <span class='hs-varid'>an</span><span class='hs-layout'>)</span> <span class='hs-keyglyph'>=&gt;</span> <span class='hs-conid'>Semigroup</span> <span class='hs-layout'>(</span><span class='hs-conid'>SrcSpanAnn'</span> <span class='hs-varid'>an</span><span class='hs-layout'>)</span> <span class='hs-keyword'>where</span>
<a name="line-1136"></a>  <span class='hs-layout'>(</span><span class='hs-conid'>SrcSpanAnn</span> <span class='hs-varid'>a1</span> <span class='hs-varid'>l1</span><span class='hs-layout'>)</span> <span class='hs-varop'>&lt;&gt;</span> <span class='hs-layout'>(</span><span class='hs-conid'>SrcSpanAnn</span> <span class='hs-varid'>a2</span> <span class='hs-varid'>l2</span><span class='hs-layout'>)</span> <span class='hs-keyglyph'>=</span> <span class='hs-conid'>SrcSpanAnn</span> <span class='hs-layout'>(</span><span class='hs-varid'>a1</span> <span class='hs-varop'>&lt;&gt;</span> <span class='hs-varid'>a2</span><span class='hs-layout'>)</span> <span class='hs-layout'>(</span><span class='hs-varid'>combineSrcSpans</span> <span class='hs-varid'>l1</span> <span class='hs-varid'>l2</span><span class='hs-layout'>)</span>
<a name="line-1137"></a>   <span class='hs-comment'>-- The critical part about the location is its left edge, and all</span>
<a name="line-1138"></a>   <span class='hs-comment'>-- annotations must follow it. So we combine them which yields the</span>
<a name="line-1139"></a>   <span class='hs-comment'>-- largest span</span>
<a name="line-1140"></a>
<a name="line-1141"></a><a name="instance%20Semigroup%20(EpAnn%20a)"></a><span class='hs-keyword'>instance</span> <span class='hs-layout'>(</span><span class='hs-conid'>Semigroup</span> <span class='hs-varid'>a</span><span class='hs-layout'>)</span> <span class='hs-keyglyph'>=&gt;</span> <span class='hs-conid'>Semigroup</span> <span class='hs-layout'>(</span><span class='hs-conid'>EpAnn</span> <span class='hs-varid'>a</span><span class='hs-layout'>)</span> <span class='hs-keyword'>where</span>
<a name="line-1142"></a>  <span class='hs-conid'>EpAnnNotUsed</span> <span class='hs-varop'>&lt;&gt;</span> <span class='hs-varid'>x</span> <span class='hs-keyglyph'>=</span> <span class='hs-varid'>x</span>
<a name="line-1143"></a>  <span class='hs-varid'>x</span> <span class='hs-varop'>&lt;&gt;</span> <span class='hs-conid'>EpAnnNotUsed</span> <span class='hs-keyglyph'>=</span> <span class='hs-varid'>x</span>
<a name="line-1144"></a>  <span class='hs-layout'>(</span><span class='hs-conid'>EpAnn</span> <span class='hs-varid'>l1</span> <span class='hs-varid'>a1</span> <span class='hs-varid'>b1</span><span class='hs-layout'>)</span> <span class='hs-varop'>&lt;&gt;</span> <span class='hs-layout'>(</span><span class='hs-conid'>EpAnn</span> <span class='hs-varid'>l2</span> <span class='hs-varid'>a2</span> <span class='hs-varid'>b2</span><span class='hs-layout'>)</span> <span class='hs-keyglyph'>=</span> <span class='hs-conid'>EpAnn</span> <span class='hs-layout'>(</span><span class='hs-varid'>l1</span> <span class='hs-varop'>&lt;&gt;</span> <span class='hs-varid'>l2</span><span class='hs-layout'>)</span> <span class='hs-layout'>(</span><span class='hs-varid'>a1</span> <span class='hs-varop'>&lt;&gt;</span> <span class='hs-varid'>a2</span><span class='hs-layout'>)</span> <span class='hs-layout'>(</span><span class='hs-varid'>b1</span> <span class='hs-varop'>&lt;&gt;</span> <span class='hs-varid'>b2</span><span class='hs-layout'>)</span>
<a name="line-1145"></a>   <span class='hs-comment'>-- The critical part about the anchor is its left edge, and all</span>
<a name="line-1146"></a>   <span class='hs-comment'>-- annotations must follow it. So we combine them which yields the</span>
<a name="line-1147"></a>   <span class='hs-comment'>-- largest span</span>
<a name="line-1148"></a>
<a name="line-1149"></a><a name="instance%20Ord%20Anchor"></a><span class='hs-keyword'>instance</span> <span class='hs-conid'>Ord</span> <span class='hs-conid'>Anchor</span> <span class='hs-keyword'>where</span>
<a name="line-1150"></a>  <span class='hs-varid'>compare</span> <span class='hs-layout'>(</span><span class='hs-conid'>Anchor</span> <span class='hs-varid'>s1</span> <span class='hs-keyword'>_</span><span class='hs-layout'>)</span> <span class='hs-layout'>(</span><span class='hs-conid'>Anchor</span> <span class='hs-varid'>s2</span> <span class='hs-keyword'>_</span><span class='hs-layout'>)</span> <span class='hs-keyglyph'>=</span> <span class='hs-varid'>compare</span> <span class='hs-varid'>s1</span> <span class='hs-varid'>s2</span>
<a name="line-1151"></a>
<a name="line-1152"></a><a name="instance%20Semigroup%20Anchor"></a><span class='hs-keyword'>instance</span> <span class='hs-conid'>Semigroup</span> <span class='hs-conid'>Anchor</span> <span class='hs-keyword'>where</span>
<a name="line-1153"></a>  <span class='hs-conid'>Anchor</span> <span class='hs-varid'>r1</span> <span class='hs-varid'>o1</span> <span class='hs-varop'>&lt;&gt;</span> <span class='hs-conid'>Anchor</span> <span class='hs-varid'>r2</span> <span class='hs-keyword'>_</span> <span class='hs-keyglyph'>=</span> <span class='hs-conid'>Anchor</span> <span class='hs-layout'>(</span><span class='hs-varid'>combineRealSrcSpans</span> <span class='hs-varid'>r1</span> <span class='hs-varid'>r2</span><span class='hs-layout'>)</span> <span class='hs-varid'>o1</span>
<a name="line-1154"></a>
<a name="line-1155"></a><a name="instance%20Semigroup%20EpAnnComments"></a><span class='hs-keyword'>instance</span> <span class='hs-conid'>Semigroup</span> <span class='hs-conid'>EpAnnComments</span> <span class='hs-keyword'>where</span>
<a name="line-1156"></a>  <span class='hs-conid'>EpaComments</span> <span class='hs-varid'>cs1</span> <span class='hs-varop'>&lt;&gt;</span> <span class='hs-conid'>EpaComments</span> <span class='hs-varid'>cs2</span> <span class='hs-keyglyph'>=</span> <span class='hs-conid'>EpaComments</span> <span class='hs-layout'>(</span><span class='hs-varid'>cs1</span> <span class='hs-varop'>++</span> <span class='hs-varid'>cs2</span><span class='hs-layout'>)</span>
<a name="line-1157"></a>  <span class='hs-conid'>EpaComments</span> <span class='hs-varid'>cs1</span> <span class='hs-varop'>&lt;&gt;</span> <span class='hs-conid'>EpaCommentsBalanced</span> <span class='hs-varid'>cs2</span> <span class='hs-varid'>as2</span> <span class='hs-keyglyph'>=</span> <span class='hs-conid'>EpaCommentsBalanced</span> <span class='hs-layout'>(</span><span class='hs-varid'>cs1</span> <span class='hs-varop'>++</span> <span class='hs-varid'>cs2</span><span class='hs-layout'>)</span> <span class='hs-varid'>as2</span>
<a name="line-1158"></a>  <span class='hs-conid'>EpaCommentsBalanced</span> <span class='hs-varid'>cs1</span> <span class='hs-varid'>as1</span> <span class='hs-varop'>&lt;&gt;</span> <span class='hs-conid'>EpaComments</span> <span class='hs-varid'>cs2</span> <span class='hs-keyglyph'>=</span> <span class='hs-conid'>EpaCommentsBalanced</span> <span class='hs-layout'>(</span><span class='hs-varid'>cs1</span> <span class='hs-varop'>++</span> <span class='hs-varid'>cs2</span><span class='hs-layout'>)</span> <span class='hs-varid'>as1</span>
<a name="line-1159"></a>  <span class='hs-conid'>EpaCommentsBalanced</span> <span class='hs-varid'>cs1</span> <span class='hs-varid'>as1</span> <span class='hs-varop'>&lt;&gt;</span> <span class='hs-conid'>EpaCommentsBalanced</span> <span class='hs-varid'>cs2</span> <span class='hs-varid'>as2</span> <span class='hs-keyglyph'>=</span> <span class='hs-conid'>EpaCommentsBalanced</span> <span class='hs-layout'>(</span><span class='hs-varid'>cs1</span> <span class='hs-varop'>++</span> <span class='hs-varid'>cs2</span><span class='hs-layout'>)</span> <span class='hs-layout'>(</span><span class='hs-varid'>as1</span><span class='hs-varop'>++</span><span class='hs-varid'>as2</span><span class='hs-layout'>)</span>
<a name="line-1160"></a>
<a name="line-1161"></a>
<a name="line-1162"></a><a name="instance%20Monoid%20(EpAnn%20a)"></a><span class='hs-keyword'>instance</span> <span class='hs-layout'>(</span><span class='hs-conid'>Monoid</span> <span class='hs-varid'>a</span><span class='hs-layout'>)</span> <span class='hs-keyglyph'>=&gt;</span> <span class='hs-conid'>Monoid</span> <span class='hs-layout'>(</span><span class='hs-conid'>EpAnn</span> <span class='hs-varid'>a</span><span class='hs-layout'>)</span> <span class='hs-keyword'>where</span>
<a name="line-1163"></a>  <span class='hs-varid'>mempty</span> <span class='hs-keyglyph'>=</span> <span class='hs-conid'>EpAnnNotUsed</span>
<a name="line-1164"></a>
<a name="line-1165"></a><a name="instance%20Semigroup%20AnnListItem"></a><span class='hs-keyword'>instance</span> <span class='hs-conid'>Semigroup</span> <span class='hs-conid'>AnnListItem</span> <span class='hs-keyword'>where</span>
<a name="line-1166"></a>  <span class='hs-layout'>(</span><span class='hs-conid'>AnnListItem</span> <span class='hs-varid'>l1</span><span class='hs-layout'>)</span> <span class='hs-varop'>&lt;&gt;</span> <span class='hs-layout'>(</span><span class='hs-conid'>AnnListItem</span> <span class='hs-varid'>l2</span><span class='hs-layout'>)</span> <span class='hs-keyglyph'>=</span> <span class='hs-conid'>AnnListItem</span> <span class='hs-layout'>(</span><span class='hs-varid'>l1</span> <span class='hs-varop'>&lt;&gt;</span> <span class='hs-varid'>l2</span><span class='hs-layout'>)</span>
<a name="line-1167"></a>
<a name="line-1168"></a><a name="instance%20Monoid%20AnnListItem"></a><span class='hs-keyword'>instance</span> <span class='hs-conid'>Monoid</span> <span class='hs-conid'>AnnListItem</span> <span class='hs-keyword'>where</span>
<a name="line-1169"></a>  <span class='hs-varid'>mempty</span> <span class='hs-keyglyph'>=</span> <span class='hs-conid'>AnnListItem</span> <span class='hs-conid'>[]</span>
<a name="line-1170"></a>
<a name="line-1171"></a>
<a name="line-1172"></a><a name="instance%20Semigroup%20AnnList"></a><span class='hs-keyword'>instance</span> <span class='hs-conid'>Semigroup</span> <span class='hs-conid'>AnnList</span> <span class='hs-keyword'>where</span>
<a name="line-1173"></a>  <span class='hs-layout'>(</span><span class='hs-conid'>AnnList</span> <span class='hs-varid'>a1</span> <span class='hs-varid'>o1</span> <span class='hs-varid'>c1</span> <span class='hs-varid'>r1</span> <span class='hs-varid'>t1</span><span class='hs-layout'>)</span> <span class='hs-varop'>&lt;&gt;</span> <span class='hs-layout'>(</span><span class='hs-conid'>AnnList</span> <span class='hs-varid'>a2</span> <span class='hs-varid'>o2</span> <span class='hs-varid'>c2</span> <span class='hs-varid'>r2</span> <span class='hs-varid'>t2</span><span class='hs-layout'>)</span>
<a name="line-1174"></a>    <span class='hs-keyglyph'>=</span> <span class='hs-conid'>AnnList</span> <span class='hs-layout'>(</span><span class='hs-varid'>a1</span> <span class='hs-varop'>&lt;&gt;</span> <span class='hs-varid'>a2</span><span class='hs-layout'>)</span> <span class='hs-layout'>(</span><span class='hs-varid'>c</span> <span class='hs-varid'>o1</span> <span class='hs-varid'>o2</span><span class='hs-layout'>)</span> <span class='hs-layout'>(</span><span class='hs-varid'>c</span> <span class='hs-varid'>c1</span> <span class='hs-varid'>c2</span><span class='hs-layout'>)</span> <span class='hs-layout'>(</span><span class='hs-varid'>r1</span> <span class='hs-varop'>&lt;&gt;</span> <span class='hs-varid'>r2</span><span class='hs-layout'>)</span> <span class='hs-layout'>(</span><span class='hs-varid'>t1</span> <span class='hs-varop'>&lt;&gt;</span> <span class='hs-varid'>t2</span><span class='hs-layout'>)</span>
<a name="line-1175"></a>    <span class='hs-keyword'>where</span>
<a name="line-1176"></a>      <span class='hs-comment'>-- Left biased combination for the open and close annotations</span>
<a name="line-1177"></a>      <span class='hs-varid'>c</span> <span class='hs-conid'>Nothing</span> <span class='hs-varid'>x</span> <span class='hs-keyglyph'>=</span> <span class='hs-varid'>x</span>
<a name="line-1178"></a>      <span class='hs-varid'>c</span> <span class='hs-varid'>x</span> <span class='hs-conid'>Nothing</span> <span class='hs-keyglyph'>=</span> <span class='hs-varid'>x</span>
<a name="line-1179"></a>      <span class='hs-varid'>c</span> <span class='hs-varid'>f</span> <span class='hs-keyword'>_</span>       <span class='hs-keyglyph'>=</span> <span class='hs-varid'>f</span>
<a name="line-1180"></a>
<a name="line-1181"></a><a name="instance%20Monoid%20AnnList"></a><span class='hs-keyword'>instance</span> <span class='hs-conid'>Monoid</span> <span class='hs-conid'>AnnList</span> <span class='hs-keyword'>where</span>
<a name="line-1182"></a>  <span class='hs-varid'>mempty</span> <span class='hs-keyglyph'>=</span> <span class='hs-conid'>AnnList</span> <span class='hs-conid'>Nothing</span> <span class='hs-conid'>Nothing</span> <span class='hs-conid'>Nothing</span> <span class='hs-conid'>[]</span> <span class='hs-conid'>[]</span>
<a name="line-1183"></a>
<a name="line-1184"></a><a name="instance%20Semigroup%20NameAnn"></a><span class='hs-keyword'>instance</span> <span class='hs-conid'>Semigroup</span> <span class='hs-conid'>NameAnn</span> <span class='hs-keyword'>where</span>
<a name="line-1185"></a>  <span class='hs-keyword'>_</span> <span class='hs-varop'>&lt;&gt;</span> <span class='hs-keyword'>_</span> <span class='hs-keyglyph'>=</span> <span class='hs-varid'>panic</span> <span class='hs-str'>"semigroup nameann"</span>
<a name="line-1186"></a>
<a name="line-1187"></a><a name="instance%20Monoid%20NameAnn"></a><span class='hs-keyword'>instance</span> <span class='hs-conid'>Monoid</span> <span class='hs-conid'>NameAnn</span> <span class='hs-keyword'>where</span>
<a name="line-1188"></a>  <span class='hs-varid'>mempty</span> <span class='hs-keyglyph'>=</span> <span class='hs-conid'>NameAnnTrailing</span> <span class='hs-conid'>[]</span>
<a name="line-1189"></a>
<a name="line-1190"></a>
<a name="line-1191"></a><a name="instance%20Semigroup%20AnnSortKey"></a><span class='hs-keyword'>instance</span> <span class='hs-conid'>Semigroup</span> <span class='hs-conid'>AnnSortKey</span> <span class='hs-keyword'>where</span>
<a name="line-1192"></a>  <span class='hs-conid'>NoAnnSortKey</span> <span class='hs-varop'>&lt;&gt;</span> <span class='hs-varid'>x</span> <span class='hs-keyglyph'>=</span> <span class='hs-varid'>x</span>
<a name="line-1193"></a>  <span class='hs-varid'>x</span> <span class='hs-varop'>&lt;&gt;</span> <span class='hs-conid'>NoAnnSortKey</span> <span class='hs-keyglyph'>=</span> <span class='hs-varid'>x</span>
<a name="line-1194"></a>  <span class='hs-conid'>AnnSortKey</span> <span class='hs-varid'>ls1</span> <span class='hs-varop'>&lt;&gt;</span> <span class='hs-conid'>AnnSortKey</span> <span class='hs-varid'>ls2</span> <span class='hs-keyglyph'>=</span> <span class='hs-conid'>AnnSortKey</span> <span class='hs-layout'>(</span><span class='hs-varid'>ls1</span> <span class='hs-varop'>&lt;&gt;</span> <span class='hs-varid'>ls2</span><span class='hs-layout'>)</span>
<a name="line-1195"></a>
<a name="line-1196"></a><a name="instance%20Monoid%20AnnSortKey"></a><span class='hs-keyword'>instance</span> <span class='hs-conid'>Monoid</span> <span class='hs-conid'>AnnSortKey</span> <span class='hs-keyword'>where</span>
<a name="line-1197"></a>  <span class='hs-varid'>mempty</span> <span class='hs-keyglyph'>=</span> <span class='hs-conid'>NoAnnSortKey</span>
<a name="line-1198"></a>
<a name="line-1199"></a><a name="instance%20Outputable%20(EpAnn%20a)"></a><span class='hs-keyword'>instance</span> <span class='hs-layout'>(</span><span class='hs-conid'>Outputable</span> <span class='hs-varid'>a</span><span class='hs-layout'>)</span> <span class='hs-keyglyph'>=&gt;</span> <span class='hs-conid'>Outputable</span> <span class='hs-layout'>(</span><span class='hs-conid'>EpAnn</span> <span class='hs-varid'>a</span><span class='hs-layout'>)</span> <span class='hs-keyword'>where</span>
<a name="line-1200"></a>  <span class='hs-varid'>ppr</span> <span class='hs-layout'>(</span><span class='hs-conid'>EpAnn</span> <span class='hs-varid'>l</span> <span class='hs-varid'>a</span> <span class='hs-varid'>c</span><span class='hs-layout'>)</span>  <span class='hs-keyglyph'>=</span> <span class='hs-varid'>text</span> <span class='hs-str'>"EpAnn"</span> <span class='hs-varop'>&lt;+&gt;</span> <span class='hs-varid'>ppr</span> <span class='hs-varid'>l</span> <span class='hs-varop'>&lt;+&gt;</span> <span class='hs-varid'>ppr</span> <span class='hs-varid'>a</span> <span class='hs-varop'>&lt;+&gt;</span> <span class='hs-varid'>ppr</span> <span class='hs-varid'>c</span>
<a name="line-1201"></a>  <span class='hs-varid'>ppr</span> <span class='hs-conid'>EpAnnNotUsed</span> <span class='hs-keyglyph'>=</span> <span class='hs-varid'>text</span> <span class='hs-str'>"EpAnnNotUsed"</span>
<a name="line-1202"></a>
<a name="line-1203"></a><a name="instance%20Outputable%20Anchor"></a><span class='hs-keyword'>instance</span> <span class='hs-conid'>Outputable</span> <span class='hs-conid'>Anchor</span> <span class='hs-keyword'>where</span>
<a name="line-1204"></a>  <span class='hs-varid'>ppr</span> <span class='hs-layout'>(</span><span class='hs-conid'>Anchor</span> <span class='hs-varid'>a</span> <span class='hs-varid'>o</span><span class='hs-layout'>)</span>        <span class='hs-keyglyph'>=</span> <span class='hs-varid'>text</span> <span class='hs-str'>"Anchor"</span> <span class='hs-varop'>&lt;+&gt;</span> <span class='hs-varid'>ppr</span> <span class='hs-varid'>a</span> <span class='hs-varop'>&lt;+&gt;</span> <span class='hs-varid'>ppr</span> <span class='hs-varid'>o</span>
<a name="line-1205"></a>
<a name="line-1206"></a><a name="instance%20Outputable%20AnchorOperation"></a><span class='hs-keyword'>instance</span> <span class='hs-conid'>Outputable</span> <span class='hs-conid'>AnchorOperation</span> <span class='hs-keyword'>where</span>
<a name="line-1207"></a>  <span class='hs-varid'>ppr</span> <span class='hs-conid'>UnchangedAnchor</span>   <span class='hs-keyglyph'>=</span> <span class='hs-varid'>text</span> <span class='hs-str'>"UnchangedAnchor"</span>
<a name="line-1208"></a>  <span class='hs-varid'>ppr</span> <span class='hs-layout'>(</span><span class='hs-conid'>MovedAnchor</span> <span class='hs-varid'>d</span><span class='hs-layout'>)</span>   <span class='hs-keyglyph'>=</span> <span class='hs-varid'>text</span> <span class='hs-str'>"MovedAnchor"</span> <span class='hs-varop'>&lt;+&gt;</span> <span class='hs-varid'>ppr</span> <span class='hs-varid'>d</span>
<a name="line-1209"></a>
<a name="line-1210"></a><a name="instance%20Outputable%20DeltaPos"></a><span class='hs-keyword'>instance</span> <span class='hs-conid'>Outputable</span> <span class='hs-conid'>DeltaPos</span> <span class='hs-keyword'>where</span>
<a name="line-1211"></a>  <span class='hs-varid'>ppr</span> <span class='hs-layout'>(</span><span class='hs-conid'>SameLine</span> <span class='hs-varid'>c</span><span class='hs-layout'>)</span> <span class='hs-keyglyph'>=</span> <span class='hs-varid'>text</span> <span class='hs-str'>"SameLine"</span> <span class='hs-varop'>&lt;+&gt;</span> <span class='hs-varid'>ppr</span> <span class='hs-varid'>c</span>
<a name="line-1212"></a>  <span class='hs-varid'>ppr</span> <span class='hs-layout'>(</span><span class='hs-conid'>DifferentLine</span> <span class='hs-varid'>l</span> <span class='hs-varid'>c</span><span class='hs-layout'>)</span> <span class='hs-keyglyph'>=</span> <span class='hs-varid'>text</span> <span class='hs-str'>"DifferentLine"</span> <span class='hs-varop'>&lt;+&gt;</span> <span class='hs-varid'>ppr</span> <span class='hs-varid'>l</span> <span class='hs-varop'>&lt;+&gt;</span> <span class='hs-varid'>ppr</span> <span class='hs-varid'>c</span>
<a name="line-1213"></a>
<a name="line-1214"></a><a name="instance%20Outputable%20(GenLocated%20Anchor%20EpaComment)"></a><span class='hs-keyword'>instance</span> <span class='hs-conid'>Outputable</span> <span class='hs-layout'>(</span><span class='hs-conid'>GenLocated</span> <span class='hs-conid'>Anchor</span> <span class='hs-conid'>EpaComment</span><span class='hs-layout'>)</span> <span class='hs-keyword'>where</span>
<a name="line-1215"></a>  <span class='hs-varid'>ppr</span> <span class='hs-layout'>(</span><span class='hs-conid'>L</span> <span class='hs-varid'>l</span> <span class='hs-varid'>c</span><span class='hs-layout'>)</span> <span class='hs-keyglyph'>=</span> <span class='hs-varid'>text</span> <span class='hs-str'>"L"</span> <span class='hs-varop'>&lt;+&gt;</span> <span class='hs-varid'>ppr</span> <span class='hs-varid'>l</span> <span class='hs-varop'>&lt;+&gt;</span> <span class='hs-varid'>ppr</span> <span class='hs-varid'>c</span>
<a name="line-1216"></a>
<a name="line-1217"></a><a name="instance%20Outputable%20EpAnnComments"></a><span class='hs-keyword'>instance</span> <span class='hs-conid'>Outputable</span> <span class='hs-conid'>EpAnnComments</span> <span class='hs-keyword'>where</span>
<a name="line-1218"></a>  <span class='hs-varid'>ppr</span> <span class='hs-layout'>(</span><span class='hs-conid'>EpaComments</span> <span class='hs-varid'>cs</span><span class='hs-layout'>)</span> <span class='hs-keyglyph'>=</span> <span class='hs-varid'>text</span> <span class='hs-str'>"EpaComments"</span> <span class='hs-varop'>&lt;+&gt;</span> <span class='hs-varid'>ppr</span> <span class='hs-varid'>cs</span>
<a name="line-1219"></a>  <span class='hs-varid'>ppr</span> <span class='hs-layout'>(</span><span class='hs-conid'>EpaCommentsBalanced</span> <span class='hs-varid'>cs</span> <span class='hs-varid'>ts</span><span class='hs-layout'>)</span> <span class='hs-keyglyph'>=</span> <span class='hs-varid'>text</span> <span class='hs-str'>"EpaCommentsBalanced"</span> <span class='hs-varop'>&lt;+&gt;</span> <span class='hs-varid'>ppr</span> <span class='hs-varid'>cs</span> <span class='hs-varop'>&lt;+&gt;</span> <span class='hs-varid'>ppr</span> <span class='hs-varid'>ts</span>
<a name="line-1220"></a>
<a name="line-1221"></a><a name="instance%20NamedThing%20(LocatedAn%20an%20a)"></a><span class='hs-keyword'>instance</span> <span class='hs-layout'>(</span><span class='hs-conid'>NamedThing</span> <span class='hs-layout'>(</span><span class='hs-conid'>Located</span> <span class='hs-varid'>a</span><span class='hs-layout'>)</span><span class='hs-layout'>)</span> <span class='hs-keyglyph'>=&gt;</span> <span class='hs-conid'>NamedThing</span> <span class='hs-layout'>(</span><span class='hs-conid'>LocatedAn</span> <span class='hs-varid'>an</span> <span class='hs-varid'>a</span><span class='hs-layout'>)</span> <span class='hs-keyword'>where</span>
<a name="line-1222"></a>  <span class='hs-varid'>getName</span> <span class='hs-layout'>(</span><span class='hs-conid'>L</span> <span class='hs-varid'>l</span> <span class='hs-varid'>a</span><span class='hs-layout'>)</span> <span class='hs-keyglyph'>=</span> <span class='hs-varid'>getName</span> <span class='hs-layout'>(</span><span class='hs-conid'>L</span> <span class='hs-layout'>(</span><span class='hs-varid'>locA</span> <span class='hs-varid'>l</span><span class='hs-layout'>)</span> <span class='hs-varid'>a</span><span class='hs-layout'>)</span>
<a name="line-1223"></a>
<a name="line-1224"></a><a name="instance%20Outputable%20AnnContext"></a><span class='hs-keyword'>instance</span> <span class='hs-conid'>Outputable</span> <span class='hs-conid'>AnnContext</span> <span class='hs-keyword'>where</span>
<a name="line-1225"></a>  <span class='hs-varid'>ppr</span> <span class='hs-layout'>(</span><span class='hs-conid'>AnnContext</span> <span class='hs-varid'>a</span> <span class='hs-varid'>o</span> <span class='hs-varid'>c</span><span class='hs-layout'>)</span> <span class='hs-keyglyph'>=</span> <span class='hs-varid'>text</span> <span class='hs-str'>"AnnContext"</span> <span class='hs-varop'>&lt;+&gt;</span> <span class='hs-varid'>ppr</span> <span class='hs-varid'>a</span> <span class='hs-varop'>&lt;+&gt;</span> <span class='hs-varid'>ppr</span> <span class='hs-varid'>o</span> <span class='hs-varop'>&lt;+&gt;</span> <span class='hs-varid'>ppr</span> <span class='hs-varid'>c</span>
<a name="line-1226"></a>
<a name="line-1227"></a><a name="instance%20Outputable%20AnnSortKey"></a><span class='hs-keyword'>instance</span> <span class='hs-conid'>Outputable</span> <span class='hs-conid'>AnnSortKey</span> <span class='hs-keyword'>where</span>
<a name="line-1228"></a>  <span class='hs-varid'>ppr</span> <span class='hs-conid'>NoAnnSortKey</span>    <span class='hs-keyglyph'>=</span> <span class='hs-varid'>text</span> <span class='hs-str'>"NoAnnSortKey"</span>
<a name="line-1229"></a>  <span class='hs-varid'>ppr</span> <span class='hs-layout'>(</span><span class='hs-conid'>AnnSortKey</span> <span class='hs-varid'>ls</span><span class='hs-layout'>)</span> <span class='hs-keyglyph'>=</span> <span class='hs-varid'>text</span> <span class='hs-str'>"AnnSortKey"</span> <span class='hs-varop'>&lt;+&gt;</span> <span class='hs-varid'>ppr</span> <span class='hs-varid'>ls</span>
<a name="line-1230"></a>
<a name="line-1231"></a><a name="instance%20Outputable%20IsUnicodeSyntax"></a><span class='hs-keyword'>instance</span> <span class='hs-conid'>Outputable</span> <span class='hs-conid'>IsUnicodeSyntax</span> <span class='hs-keyword'>where</span>
<a name="line-1232"></a>  <span class='hs-varid'>ppr</span> <span class='hs-keyglyph'>=</span> <span class='hs-varid'>text</span> <span class='hs-varop'>.</span> <span class='hs-varid'>show</span>
<a name="line-1233"></a>
<a name="line-1234"></a><a name="instance%20Binary%20(LocatedL%20a)"></a><span class='hs-keyword'>instance</span> <span class='hs-conid'>Binary</span> <span class='hs-varid'>a</span> <span class='hs-keyglyph'>=&gt;</span> <span class='hs-conid'>Binary</span> <span class='hs-layout'>(</span><span class='hs-conid'>LocatedL</span> <span class='hs-varid'>a</span><span class='hs-layout'>)</span> <span class='hs-keyword'>where</span>
<a name="line-1235"></a>  <span class='hs-comment'>-- We do not serialise the annotations</span>
<a name="line-1236"></a>    <span class='hs-varid'>put_</span> <span class='hs-varid'>bh</span> <span class='hs-layout'>(</span><span class='hs-conid'>L</span> <span class='hs-varid'>l</span> <span class='hs-varid'>x</span><span class='hs-layout'>)</span> <span class='hs-keyglyph'>=</span> <span class='hs-keyword'>do</span>
<a name="line-1237"></a>            <span class='hs-varid'>put_</span> <span class='hs-varid'>bh</span> <span class='hs-layout'>(</span><span class='hs-varid'>locA</span> <span class='hs-varid'>l</span><span class='hs-layout'>)</span>
<a name="line-1238"></a>            <span class='hs-varid'>put_</span> <span class='hs-varid'>bh</span> <span class='hs-varid'>x</span>
<a name="line-1239"></a>
<a name="line-1240"></a>    <span class='hs-varid'>get</span> <span class='hs-varid'>bh</span> <span class='hs-keyglyph'>=</span> <span class='hs-keyword'>do</span>
<a name="line-1241"></a>            <span class='hs-varid'>l</span> <span class='hs-keyglyph'>&lt;-</span> <span class='hs-varid'>get</span> <span class='hs-varid'>bh</span>
<a name="line-1242"></a>            <span class='hs-varid'>x</span> <span class='hs-keyglyph'>&lt;-</span> <span class='hs-varid'>get</span> <span class='hs-varid'>bh</span>
<a name="line-1243"></a>            <span class='hs-varid'>return</span> <span class='hs-layout'>(</span><span class='hs-conid'>L</span> <span class='hs-layout'>(</span><span class='hs-varid'>noAnnSrcSpan</span> <span class='hs-varid'>l</span><span class='hs-layout'>)</span> <span class='hs-varid'>x</span><span class='hs-layout'>)</span>
<a name="line-1244"></a>
<a name="line-1245"></a><a name="instance%20Outputable%20(SrcSpanAnn'%20a)"></a><span class='hs-keyword'>instance</span> <span class='hs-layout'>(</span><span class='hs-conid'>Outputable</span> <span class='hs-varid'>a</span><span class='hs-layout'>)</span> <span class='hs-keyglyph'>=&gt;</span> <span class='hs-conid'>Outputable</span> <span class='hs-layout'>(</span><span class='hs-conid'>SrcSpanAnn'</span> <span class='hs-varid'>a</span><span class='hs-layout'>)</span> <span class='hs-keyword'>where</span>
<a name="line-1246"></a>  <span class='hs-varid'>ppr</span> <span class='hs-layout'>(</span><span class='hs-conid'>SrcSpanAnn</span> <span class='hs-varid'>a</span> <span class='hs-varid'>l</span><span class='hs-layout'>)</span> <span class='hs-keyglyph'>=</span> <span class='hs-varid'>text</span> <span class='hs-str'>"SrcSpanAnn"</span> <span class='hs-varop'>&lt;+&gt;</span> <span class='hs-varid'>ppr</span> <span class='hs-varid'>a</span> <span class='hs-varop'>&lt;+&gt;</span> <span class='hs-varid'>ppr</span> <span class='hs-varid'>l</span>
<a name="line-1247"></a>
<a name="line-1248"></a><a name="instance%20Outputable%20(GenLocated%20(SrcSpanAnn'%20a)%20e)"></a><span class='hs-keyword'>instance</span> <span class='hs-layout'>(</span><span class='hs-conid'>Outputable</span> <span class='hs-varid'>a</span><span class='hs-layout'>,</span> <span class='hs-conid'>Outputable</span> <span class='hs-varid'>e</span><span class='hs-layout'>)</span>
<a name="line-1249"></a>     <span class='hs-keyglyph'>=&gt;</span> <span class='hs-conid'>Outputable</span> <span class='hs-layout'>(</span><span class='hs-conid'>GenLocated</span> <span class='hs-layout'>(</span><span class='hs-conid'>SrcSpanAnn'</span> <span class='hs-varid'>a</span><span class='hs-layout'>)</span> <span class='hs-varid'>e</span><span class='hs-layout'>)</span> <span class='hs-keyword'>where</span>
<a name="line-1250"></a>  <span class='hs-varid'>ppr</span> <span class='hs-keyglyph'>=</span> <span class='hs-varid'>pprLocated</span>
<a name="line-1251"></a>
<a name="line-1252"></a><a name="instance%20Outputable%20AnnListItem"></a><span class='hs-keyword'>instance</span> <span class='hs-conid'>Outputable</span> <span class='hs-conid'>AnnListItem</span> <span class='hs-keyword'>where</span>
<a name="line-1253"></a>  <span class='hs-varid'>ppr</span> <span class='hs-layout'>(</span><span class='hs-conid'>AnnListItem</span> <span class='hs-varid'>ts</span><span class='hs-layout'>)</span> <span class='hs-keyglyph'>=</span> <span class='hs-varid'>text</span> <span class='hs-str'>"AnnListItem"</span> <span class='hs-varop'>&lt;+&gt;</span> <span class='hs-varid'>ppr</span> <span class='hs-varid'>ts</span>
<a name="line-1254"></a>
<a name="line-1255"></a><a name="instance%20Outputable%20NameAdornment"></a><span class='hs-keyword'>instance</span> <span class='hs-conid'>Outputable</span> <span class='hs-conid'>NameAdornment</span> <span class='hs-keyword'>where</span>
<a name="line-1256"></a>  <span class='hs-varid'>ppr</span> <span class='hs-conid'>NameParens</span>     <span class='hs-keyglyph'>=</span> <span class='hs-varid'>text</span> <span class='hs-str'>"NameParens"</span>
<a name="line-1257"></a>  <span class='hs-varid'>ppr</span> <span class='hs-conid'>NameParensHash</span> <span class='hs-keyglyph'>=</span> <span class='hs-varid'>text</span> <span class='hs-str'>"NameParensHash"</span>
<a name="line-1258"></a>  <span class='hs-varid'>ppr</span> <span class='hs-conid'>NameBackquotes</span> <span class='hs-keyglyph'>=</span> <span class='hs-varid'>text</span> <span class='hs-str'>"NameBackquotes"</span>
<a name="line-1259"></a>  <span class='hs-varid'>ppr</span> <span class='hs-conid'>NameSquare</span>     <span class='hs-keyglyph'>=</span> <span class='hs-varid'>text</span> <span class='hs-str'>"NameSquare"</span>
<a name="line-1260"></a>
<a name="line-1261"></a><a name="instance%20Outputable%20NameAnn"></a><span class='hs-keyword'>instance</span> <span class='hs-conid'>Outputable</span> <span class='hs-conid'>NameAnn</span> <span class='hs-keyword'>where</span>
<a name="line-1262"></a>  <span class='hs-varid'>ppr</span> <span class='hs-layout'>(</span><span class='hs-conid'>NameAnn</span> <span class='hs-varid'>a</span> <span class='hs-varid'>o</span> <span class='hs-varid'>n</span> <span class='hs-varid'>c</span> <span class='hs-varid'>t</span><span class='hs-layout'>)</span>
<a name="line-1263"></a>    <span class='hs-keyglyph'>=</span> <span class='hs-varid'>text</span> <span class='hs-str'>"NameAnn"</span> <span class='hs-varop'>&lt;+&gt;</span> <span class='hs-varid'>ppr</span> <span class='hs-varid'>a</span> <span class='hs-varop'>&lt;+&gt;</span> <span class='hs-varid'>ppr</span> <span class='hs-varid'>o</span> <span class='hs-varop'>&lt;+&gt;</span> <span class='hs-varid'>ppr</span> <span class='hs-varid'>n</span> <span class='hs-varop'>&lt;+&gt;</span> <span class='hs-varid'>ppr</span> <span class='hs-varid'>c</span> <span class='hs-varop'>&lt;+&gt;</span> <span class='hs-varid'>ppr</span> <span class='hs-varid'>t</span>
<a name="line-1264"></a>  <span class='hs-varid'>ppr</span> <span class='hs-layout'>(</span><span class='hs-conid'>NameAnnCommas</span> <span class='hs-varid'>a</span> <span class='hs-varid'>o</span> <span class='hs-varid'>n</span> <span class='hs-varid'>c</span> <span class='hs-varid'>t</span><span class='hs-layout'>)</span>
<a name="line-1265"></a>    <span class='hs-keyglyph'>=</span> <span class='hs-varid'>text</span> <span class='hs-str'>"NameAnnCommas"</span> <span class='hs-varop'>&lt;+&gt;</span> <span class='hs-varid'>ppr</span> <span class='hs-varid'>a</span> <span class='hs-varop'>&lt;+&gt;</span> <span class='hs-varid'>ppr</span> <span class='hs-varid'>o</span> <span class='hs-varop'>&lt;+&gt;</span> <span class='hs-varid'>ppr</span> <span class='hs-varid'>n</span> <span class='hs-varop'>&lt;+&gt;</span> <span class='hs-varid'>ppr</span> <span class='hs-varid'>c</span> <span class='hs-varop'>&lt;+&gt;</span> <span class='hs-varid'>ppr</span> <span class='hs-varid'>t</span>
<a name="line-1266"></a>  <span class='hs-varid'>ppr</span> <span class='hs-layout'>(</span><span class='hs-conid'>NameAnnOnly</span> <span class='hs-varid'>a</span> <span class='hs-varid'>o</span> <span class='hs-varid'>c</span> <span class='hs-varid'>t</span><span class='hs-layout'>)</span>
<a name="line-1267"></a>    <span class='hs-keyglyph'>=</span> <span class='hs-varid'>text</span> <span class='hs-str'>"NameAnnOnly"</span> <span class='hs-varop'>&lt;+&gt;</span> <span class='hs-varid'>ppr</span> <span class='hs-varid'>a</span> <span class='hs-varop'>&lt;+&gt;</span> <span class='hs-varid'>ppr</span> <span class='hs-varid'>o</span> <span class='hs-varop'>&lt;+&gt;</span> <span class='hs-varid'>ppr</span> <span class='hs-varid'>c</span> <span class='hs-varop'>&lt;+&gt;</span> <span class='hs-varid'>ppr</span> <span class='hs-varid'>t</span>
<a name="line-1268"></a>  <span class='hs-varid'>ppr</span> <span class='hs-layout'>(</span><span class='hs-conid'>NameAnnRArrow</span> <span class='hs-varid'>n</span> <span class='hs-varid'>t</span><span class='hs-layout'>)</span>
<a name="line-1269"></a>    <span class='hs-keyglyph'>=</span> <span class='hs-varid'>text</span> <span class='hs-str'>"NameAnnRArrow"</span> <span class='hs-varop'>&lt;+&gt;</span> <span class='hs-varid'>ppr</span> <span class='hs-varid'>n</span> <span class='hs-varop'>&lt;+&gt;</span> <span class='hs-varid'>ppr</span> <span class='hs-varid'>t</span>
<a name="line-1270"></a>  <span class='hs-varid'>ppr</span> <span class='hs-layout'>(</span><span class='hs-conid'>NameAnnQuote</span> <span class='hs-varid'>q</span> <span class='hs-varid'>n</span> <span class='hs-varid'>t</span><span class='hs-layout'>)</span>
<a name="line-1271"></a>    <span class='hs-keyglyph'>=</span> <span class='hs-varid'>text</span> <span class='hs-str'>"NameAnnQuote"</span> <span class='hs-varop'>&lt;+&gt;</span> <span class='hs-varid'>ppr</span> <span class='hs-varid'>q</span> <span class='hs-varop'>&lt;+&gt;</span> <span class='hs-varid'>ppr</span> <span class='hs-varid'>n</span> <span class='hs-varop'>&lt;+&gt;</span> <span class='hs-varid'>ppr</span> <span class='hs-varid'>t</span>
<a name="line-1272"></a>  <span class='hs-varid'>ppr</span> <span class='hs-layout'>(</span><span class='hs-conid'>NameAnnTrailing</span> <span class='hs-varid'>t</span><span class='hs-layout'>)</span>
<a name="line-1273"></a>    <span class='hs-keyglyph'>=</span> <span class='hs-varid'>text</span> <span class='hs-str'>"NameAnnTrailing"</span> <span class='hs-varop'>&lt;+&gt;</span> <span class='hs-varid'>ppr</span> <span class='hs-varid'>t</span>
<a name="line-1274"></a>
<a name="line-1275"></a><a name="instance%20Outputable%20AnnList"></a><span class='hs-keyword'>instance</span> <span class='hs-conid'>Outputable</span> <span class='hs-conid'>AnnList</span> <span class='hs-keyword'>where</span>
<a name="line-1276"></a>  <span class='hs-varid'>ppr</span> <span class='hs-layout'>(</span><span class='hs-conid'>AnnList</span> <span class='hs-varid'>a</span> <span class='hs-varid'>o</span> <span class='hs-varid'>c</span> <span class='hs-varid'>r</span> <span class='hs-varid'>t</span><span class='hs-layout'>)</span>
<a name="line-1277"></a>    <span class='hs-keyglyph'>=</span> <span class='hs-varid'>text</span> <span class='hs-str'>"AnnList"</span> <span class='hs-varop'>&lt;+&gt;</span> <span class='hs-varid'>ppr</span> <span class='hs-varid'>a</span> <span class='hs-varop'>&lt;+&gt;</span> <span class='hs-varid'>ppr</span> <span class='hs-varid'>o</span> <span class='hs-varop'>&lt;+&gt;</span> <span class='hs-varid'>ppr</span> <span class='hs-varid'>c</span> <span class='hs-varop'>&lt;+&gt;</span> <span class='hs-varid'>ppr</span> <span class='hs-varid'>r</span> <span class='hs-varop'>&lt;+&gt;</span> <span class='hs-varid'>ppr</span> <span class='hs-varid'>t</span>
<a name="line-1278"></a>
<a name="line-1279"></a><a name="instance%20Outputable%20AnnPragma"></a><span class='hs-keyword'>instance</span> <span class='hs-conid'>Outputable</span> <span class='hs-conid'>AnnPragma</span> <span class='hs-keyword'>where</span>
<a name="line-1280"></a>  <span class='hs-varid'>ppr</span> <span class='hs-layout'>(</span><span class='hs-conid'>AnnPragma</span> <span class='hs-varid'>o</span> <span class='hs-varid'>c</span> <span class='hs-varid'>r</span><span class='hs-layout'>)</span> <span class='hs-keyglyph'>=</span> <span class='hs-varid'>text</span> <span class='hs-str'>"AnnPragma"</span> <span class='hs-varop'>&lt;+&gt;</span> <span class='hs-varid'>ppr</span> <span class='hs-varid'>o</span> <span class='hs-varop'>&lt;+&gt;</span> <span class='hs-varid'>ppr</span> <span class='hs-varid'>c</span> <span class='hs-varop'>&lt;+&gt;</span> <span class='hs-varid'>ppr</span> <span class='hs-varid'>r</span>
</pre></body>
</html>
