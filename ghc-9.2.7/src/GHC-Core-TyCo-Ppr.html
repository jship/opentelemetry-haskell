<?xml version="1.0" encoding="UTF-8"?>
<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Strict//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-strict.dtd">
<html>
<head>
<!-- Generated by HsColour, http://code.haskell.org/~malcolm/hscolour/ -->
<title>GHC/Core/TyCo/Ppr.hs</title>
<link type='text/css' rel='stylesheet' href='hscolour.css' />
</head>
<body>
<pre><a name="line-1"></a><span class='hs-comment'>{-# LANGUAGE PatternSynonyms #-}</span>
<a name="line-2"></a>
<a name="line-3"></a><span class='hs-comment'>-- | Pretty-printing types and coercions.</span>
<a name="line-4"></a><span class='hs-keyword'>module</span> <span class='hs-conid'>GHC.Core.TyCo.Ppr</span>
<a name="line-5"></a>  <span class='hs-layout'>(</span>
<a name="line-6"></a>        <span class='hs-comment'>-- * Precedence</span>
<a name="line-7"></a>        <span class='hs-conid'>PprPrec</span><span class='hs-layout'>(</span><span class='hs-keyglyph'>..</span><span class='hs-layout'>)</span><span class='hs-layout'>,</span> <span class='hs-varid'>topPrec</span><span class='hs-layout'>,</span> <span class='hs-varid'>sigPrec</span><span class='hs-layout'>,</span> <span class='hs-varid'>opPrec</span><span class='hs-layout'>,</span> <span class='hs-varid'>funPrec</span><span class='hs-layout'>,</span> <span class='hs-varid'>appPrec</span><span class='hs-layout'>,</span> <span class='hs-varid'>maybeParen</span><span class='hs-layout'>,</span>
<a name="line-8"></a>
<a name="line-9"></a>        <span class='hs-comment'>-- * Pretty-printing types</span>
<a name="line-10"></a>        <span class='hs-varid'>pprType</span><span class='hs-layout'>,</span> <span class='hs-varid'>pprParendType</span><span class='hs-layout'>,</span> <span class='hs-varid'>pprTidiedType</span><span class='hs-layout'>,</span> <span class='hs-varid'>pprPrecType</span><span class='hs-layout'>,</span> <span class='hs-varid'>pprPrecTypeX</span><span class='hs-layout'>,</span>
<a name="line-11"></a>        <span class='hs-varid'>pprTypeApp</span><span class='hs-layout'>,</span> <span class='hs-varid'>pprTCvBndr</span><span class='hs-layout'>,</span> <span class='hs-varid'>pprTCvBndrs</span><span class='hs-layout'>,</span>
<a name="line-12"></a>        <span class='hs-varid'>pprSigmaType</span><span class='hs-layout'>,</span>
<a name="line-13"></a>        <span class='hs-varid'>pprTheta</span><span class='hs-layout'>,</span> <span class='hs-varid'>pprParendTheta</span><span class='hs-layout'>,</span> <span class='hs-varid'>pprForAll</span><span class='hs-layout'>,</span> <span class='hs-varid'>pprUserForAll</span><span class='hs-layout'>,</span>
<a name="line-14"></a>        <span class='hs-varid'>pprTyVar</span><span class='hs-layout'>,</span> <span class='hs-varid'>pprTyVars</span><span class='hs-layout'>,</span>
<a name="line-15"></a>        <span class='hs-varid'>pprThetaArrowTy</span><span class='hs-layout'>,</span> <span class='hs-varid'>pprClassPred</span><span class='hs-layout'>,</span>
<a name="line-16"></a>        <span class='hs-varid'>pprKind</span><span class='hs-layout'>,</span> <span class='hs-varid'>pprParendKind</span><span class='hs-layout'>,</span> <span class='hs-varid'>pprTyLit</span><span class='hs-layout'>,</span>
<a name="line-17"></a>        <span class='hs-varid'>pprDataCons</span><span class='hs-layout'>,</span> <span class='hs-varid'>pprWithExplicitKindsWhen</span><span class='hs-layout'>,</span>
<a name="line-18"></a>        <span class='hs-varid'>pprWithTYPE</span><span class='hs-layout'>,</span> <span class='hs-varid'>pprSourceTyCon</span><span class='hs-layout'>,</span>
<a name="line-19"></a>
<a name="line-20"></a>
<a name="line-21"></a>        <span class='hs-comment'>-- * Pretty-printing coercions</span>
<a name="line-22"></a>        <span class='hs-varid'>pprCo</span><span class='hs-layout'>,</span> <span class='hs-varid'>pprParendCo</span><span class='hs-layout'>,</span>
<a name="line-23"></a>
<a name="line-24"></a>        <span class='hs-varid'>debugPprType</span><span class='hs-layout'>,</span>
<a name="line-25"></a>  <span class='hs-layout'>)</span> <span class='hs-keyword'>where</span>
<a name="line-26"></a>
<a name="line-27"></a><span class='hs-keyword'>import</span> <span class='hs-conid'>GHC.Prelude</span>
<a name="line-28"></a>
<a name="line-29"></a><span class='hs-keyword'>import</span> <span class='hs-comment'>{-# SOURCE #-}</span> <span class='hs-conid'>GHC.CoreToIface</span>
<a name="line-30"></a>   <span class='hs-layout'>(</span> <span class='hs-varid'>toIfaceTypeX</span><span class='hs-layout'>,</span> <span class='hs-varid'>toIfaceTyLit</span><span class='hs-layout'>,</span> <span class='hs-varid'>toIfaceForAllBndr</span>
<a name="line-31"></a>   <span class='hs-layout'>,</span> <span class='hs-varid'>toIfaceTyCon</span><span class='hs-layout'>,</span> <span class='hs-varid'>toIfaceTcArgs</span><span class='hs-layout'>,</span> <span class='hs-varid'>toIfaceCoercionX</span> <span class='hs-layout'>)</span>
<a name="line-32"></a>
<a name="line-33"></a><span class='hs-keyword'>import</span> <span class='hs-comment'>{-# SOURCE #-}</span> <span class='hs-conid'>GHC.Core.DataCon</span>
<a name="line-34"></a>   <span class='hs-layout'>(</span> <span class='hs-varid'>dataConFullSig</span> <span class='hs-layout'>,</span> <span class='hs-varid'>dataConUserTyVarBinders</span><span class='hs-layout'>,</span> <span class='hs-conid'>DataCon</span> <span class='hs-layout'>)</span>
<a name="line-35"></a>
<a name="line-36"></a><span class='hs-keyword'>import</span> <span class='hs-conid'>GHC.Core.Type</span> <span class='hs-layout'>(</span> <span class='hs-varid'>pickyIsLiftedTypeKind</span><span class='hs-layout'>,</span> <span class='hs-varid'>pattern</span> <span class='hs-conid'>One</span><span class='hs-layout'>,</span> <span class='hs-varid'>pattern</span> <span class='hs-conid'>Many</span><span class='hs-layout'>,</span>
<a name="line-37"></a>                       <span class='hs-varid'>splitForAllReqTVBinders</span><span class='hs-layout'>,</span> <span class='hs-varid'>splitForAllInvisTVBinders</span> <span class='hs-layout'>)</span>
<a name="line-38"></a>
<a name="line-39"></a><span class='hs-keyword'>import</span> <span class='hs-conid'>GHC.Core.TyCon</span>
<a name="line-40"></a><span class='hs-keyword'>import</span> <span class='hs-conid'>GHC.Core.TyCo.Rep</span>
<a name="line-41"></a><span class='hs-keyword'>import</span> <span class='hs-conid'>GHC.Core.TyCo.Tidy</span>
<a name="line-42"></a><span class='hs-keyword'>import</span> <span class='hs-conid'>GHC.Core.TyCo.FVs</span>
<a name="line-43"></a><span class='hs-keyword'>import</span> <span class='hs-conid'>GHC.Core.Class</span>
<a name="line-44"></a><span class='hs-keyword'>import</span> <span class='hs-conid'>GHC.Types.Var</span>
<a name="line-45"></a>
<a name="line-46"></a><span class='hs-keyword'>import</span> <span class='hs-conid'>GHC.Iface.Type</span>
<a name="line-47"></a>
<a name="line-48"></a><span class='hs-keyword'>import</span> <span class='hs-conid'>GHC.Types.Var.Set</span>
<a name="line-49"></a><span class='hs-keyword'>import</span> <span class='hs-conid'>GHC.Types.Var.Env</span>
<a name="line-50"></a>
<a name="line-51"></a><span class='hs-keyword'>import</span> <span class='hs-conid'>GHC.Utils.Outputable</span>
<a name="line-52"></a><span class='hs-keyword'>import</span> <span class='hs-conid'>GHC.Utils.Panic</span>
<a name="line-53"></a><span class='hs-keyword'>import</span> <span class='hs-conid'>GHC.Types.Basic</span> <span class='hs-layout'>(</span> <span class='hs-conid'>PprPrec</span><span class='hs-layout'>(</span><span class='hs-keyglyph'>..</span><span class='hs-layout'>)</span><span class='hs-layout'>,</span> <span class='hs-varid'>topPrec</span><span class='hs-layout'>,</span> <span class='hs-varid'>sigPrec</span><span class='hs-layout'>,</span> <span class='hs-varid'>opPrec</span>
<a name="line-54"></a>                       <span class='hs-layout'>,</span> <span class='hs-varid'>funPrec</span><span class='hs-layout'>,</span> <span class='hs-varid'>appPrec</span><span class='hs-layout'>,</span> <span class='hs-varid'>maybeParen</span> <span class='hs-layout'>)</span>
<a name="line-55"></a>
<a name="line-56"></a><span class='hs-comment'>{-
<a name="line-57"></a>%************************************************************************
<a name="line-58"></a>%*                                                                      *
<a name="line-59"></a>                   Pretty-printing types
<a name="line-60"></a>
<a name="line-61"></a>       Defined very early because of debug printing in assertions
<a name="line-62"></a>%*                                                                      *
<a name="line-63"></a>%************************************************************************
<a name="line-64"></a>
<a name="line-65"></a>@pprType@ is the standard @Type@ printer; the overloaded @ppr@ function is
<a name="line-66"></a>defined to use this.  @pprParendType@ is the same, except it puts
<a name="line-67"></a>parens around the type, except for the atomic cases.  @pprParendType@
<a name="line-68"></a>works just by setting the initial context precedence very high.
<a name="line-69"></a>
<a name="line-70"></a>Note that any function which pretty-prints a @Type@ first converts the @Type@
<a name="line-71"></a>to an @IfaceType@. See Note [IfaceType and pretty-printing] in GHC.Iface.Type.
<a name="line-72"></a>
<a name="line-73"></a>See Note [Precedence in types] in GHC.Types.Basic.
<a name="line-74"></a>-}</span>
<a name="line-75"></a>
<a name="line-76"></a><span class='hs-comment'>--------------------------------------------------------</span>
<a name="line-77"></a><span class='hs-comment'>-- When pretty-printing types, we convert to IfaceType,</span>
<a name="line-78"></a><span class='hs-comment'>--   and pretty-print that.</span>
<a name="line-79"></a><span class='hs-comment'>-- See Note [Pretty printing via Iface syntax] in GHC.Types.TyThing.Ppr</span>
<a name="line-80"></a><span class='hs-comment'>--------------------------------------------------------</span>
<a name="line-81"></a>
<a name="line-82"></a><a name="pprType"></a><span class='hs-definition'>pprType</span><span class='hs-layout'>,</span> <span class='hs-varid'>pprParendType</span><span class='hs-layout'>,</span> <span class='hs-varid'>pprTidiedType</span> <span class='hs-keyglyph'>::</span> <span class='hs-conid'>Type</span> <span class='hs-keyglyph'>-&gt;</span> <span class='hs-conid'>SDoc</span>
<a name="line-83"></a><span class='hs-definition'>pprType</span>       <span class='hs-keyglyph'>=</span> <span class='hs-varid'>pprPrecType</span> <span class='hs-varid'>topPrec</span>
<a name="line-84"></a><a name="pprParendType"></a><span class='hs-definition'>pprParendType</span> <span class='hs-keyglyph'>=</span> <span class='hs-varid'>pprPrecType</span> <span class='hs-varid'>appPrec</span>
<a name="line-85"></a>
<a name="line-86"></a><a name="pprTidiedType"></a><span class='hs-comment'>-- already pre-tidied</span>
<a name="line-87"></a><span class='hs-definition'>pprTidiedType</span> <span class='hs-keyglyph'>=</span> <span class='hs-varid'>pprIfaceType</span> <span class='hs-varop'>.</span> <span class='hs-varid'>toIfaceTypeX</span> <span class='hs-varid'>emptyVarSet</span>
<a name="line-88"></a>
<a name="line-89"></a><a name="pprPrecType"></a><span class='hs-definition'>pprPrecType</span> <span class='hs-keyglyph'>::</span> <span class='hs-conid'>PprPrec</span> <span class='hs-keyglyph'>-&gt;</span> <span class='hs-conid'>Type</span> <span class='hs-keyglyph'>-&gt;</span> <span class='hs-conid'>SDoc</span>
<a name="line-90"></a><span class='hs-definition'>pprPrecType</span> <span class='hs-keyglyph'>=</span> <span class='hs-varid'>pprPrecTypeX</span> <span class='hs-varid'>emptyTidyEnv</span>
<a name="line-91"></a>
<a name="line-92"></a><a name="pprPrecTypeX"></a><span class='hs-definition'>pprPrecTypeX</span> <span class='hs-keyglyph'>::</span> <span class='hs-conid'>TidyEnv</span> <span class='hs-keyglyph'>-&gt;</span> <span class='hs-conid'>PprPrec</span> <span class='hs-keyglyph'>-&gt;</span> <span class='hs-conid'>Type</span> <span class='hs-keyglyph'>-&gt;</span> <span class='hs-conid'>SDoc</span>
<a name="line-93"></a><span class='hs-definition'>pprPrecTypeX</span> <span class='hs-varid'>env</span> <span class='hs-varid'>prec</span> <span class='hs-varid'>ty</span>
<a name="line-94"></a>  <span class='hs-keyglyph'>=</span> <span class='hs-varid'>getPprStyle</span> <span class='hs-varop'>$</span> <span class='hs-keyglyph'>\</span><span class='hs-varid'>sty</span> <span class='hs-keyglyph'>-&gt;</span>
<a name="line-95"></a>    <span class='hs-varid'>getPprDebug</span> <span class='hs-varop'>$</span> <span class='hs-keyglyph'>\</span><span class='hs-varid'>debug</span> <span class='hs-keyglyph'>-&gt;</span>
<a name="line-96"></a>    <span class='hs-keyword'>if</span> <span class='hs-varid'>debug</span>                    <span class='hs-comment'>-- Use debugPprType when in</span>
<a name="line-97"></a>    <span class='hs-keyword'>then</span> <span class='hs-varid'>debug_ppr_ty</span> <span class='hs-varid'>prec</span> <span class='hs-varid'>ty</span>   <span class='hs-comment'>-- when in debug-style</span>
<a name="line-98"></a>    <span class='hs-keyword'>else</span> <span class='hs-varid'>pprPrecIfaceType</span> <span class='hs-varid'>prec</span> <span class='hs-layout'>(</span><span class='hs-varid'>tidyToIfaceTypeStyX</span> <span class='hs-varid'>env</span> <span class='hs-varid'>ty</span> <span class='hs-varid'>sty</span><span class='hs-layout'>)</span>
<a name="line-99"></a>    <span class='hs-comment'>-- NB: debug-style is used for -dppr-debug</span>
<a name="line-100"></a>    <span class='hs-comment'>--     dump-style  is used for -ddump-tc-trace etc</span>
<a name="line-101"></a>
<a name="line-102"></a><a name="pprTyLit"></a><span class='hs-definition'>pprTyLit</span> <span class='hs-keyglyph'>::</span> <span class='hs-conid'>TyLit</span> <span class='hs-keyglyph'>-&gt;</span> <span class='hs-conid'>SDoc</span>
<a name="line-103"></a><span class='hs-definition'>pprTyLit</span> <span class='hs-keyglyph'>=</span> <span class='hs-varid'>pprIfaceTyLit</span> <span class='hs-varop'>.</span> <span class='hs-varid'>toIfaceTyLit</span>
<a name="line-104"></a>
<a name="line-105"></a><a name="pprKind"></a><span class='hs-definition'>pprKind</span><span class='hs-layout'>,</span> <span class='hs-varid'>pprParendKind</span> <span class='hs-keyglyph'>::</span> <span class='hs-conid'>Kind</span> <span class='hs-keyglyph'>-&gt;</span> <span class='hs-conid'>SDoc</span>
<a name="line-106"></a><span class='hs-definition'>pprKind</span>       <span class='hs-keyglyph'>=</span> <span class='hs-varid'>pprType</span>
<a name="line-107"></a><a name="pprParendKind"></a><span class='hs-definition'>pprParendKind</span> <span class='hs-keyglyph'>=</span> <span class='hs-varid'>pprParendType</span>
<a name="line-108"></a>
<a name="line-109"></a><a name="tidyToIfaceTypeStyX"></a><span class='hs-definition'>tidyToIfaceTypeStyX</span> <span class='hs-keyglyph'>::</span> <span class='hs-conid'>TidyEnv</span> <span class='hs-keyglyph'>-&gt;</span> <span class='hs-conid'>Type</span> <span class='hs-keyglyph'>-&gt;</span> <span class='hs-conid'>PprStyle</span> <span class='hs-keyglyph'>-&gt;</span> <span class='hs-conid'>IfaceType</span>
<a name="line-110"></a><span class='hs-definition'>tidyToIfaceTypeStyX</span> <span class='hs-varid'>env</span> <span class='hs-varid'>ty</span> <span class='hs-varid'>sty</span>
<a name="line-111"></a>  <span class='hs-keyglyph'>|</span> <span class='hs-varid'>userStyle</span> <span class='hs-varid'>sty</span> <span class='hs-keyglyph'>=</span> <span class='hs-varid'>tidyToIfaceTypeX</span> <span class='hs-varid'>env</span> <span class='hs-varid'>ty</span>
<a name="line-112"></a>  <span class='hs-keyglyph'>|</span> <span class='hs-varid'>otherwise</span>     <span class='hs-keyglyph'>=</span> <span class='hs-varid'>toIfaceTypeX</span> <span class='hs-layout'>(</span><span class='hs-varid'>tyCoVarsOfType</span> <span class='hs-varid'>ty</span><span class='hs-layout'>)</span> <span class='hs-varid'>ty</span>
<a name="line-113"></a>     <span class='hs-comment'>-- in latter case, don't tidy, as we'll be printing uniques.</span>
<a name="line-114"></a>
<a name="line-115"></a><a name="tidyToIfaceType"></a><span class='hs-definition'>tidyToIfaceType</span> <span class='hs-keyglyph'>::</span> <span class='hs-conid'>Type</span> <span class='hs-keyglyph'>-&gt;</span> <span class='hs-conid'>IfaceType</span>
<a name="line-116"></a><span class='hs-definition'>tidyToIfaceType</span> <span class='hs-keyglyph'>=</span> <span class='hs-varid'>tidyToIfaceTypeX</span> <span class='hs-varid'>emptyTidyEnv</span>
<a name="line-117"></a>
<a name="line-118"></a><a name="tidyToIfaceTypeX"></a><span class='hs-definition'>tidyToIfaceTypeX</span> <span class='hs-keyglyph'>::</span> <span class='hs-conid'>TidyEnv</span> <span class='hs-keyglyph'>-&gt;</span> <span class='hs-conid'>Type</span> <span class='hs-keyglyph'>-&gt;</span> <span class='hs-conid'>IfaceType</span>
<a name="line-119"></a><span class='hs-comment'>-- It's vital to tidy before converting to an IfaceType</span>
<a name="line-120"></a><span class='hs-comment'>-- or nested binders will become indistinguishable!</span>
<a name="line-121"></a><span class='hs-comment'>--</span>
<a name="line-122"></a><span class='hs-comment'>-- Also for the free type variables, tell toIfaceTypeX to</span>
<a name="line-123"></a><span class='hs-comment'>-- leave them as IfaceFreeTyVar.  This is super-important</span>
<a name="line-124"></a><span class='hs-comment'>-- for debug printing.</span>
<a name="line-125"></a><span class='hs-definition'>tidyToIfaceTypeX</span> <span class='hs-varid'>env</span> <span class='hs-varid'>ty</span> <span class='hs-keyglyph'>=</span> <span class='hs-varid'>toIfaceTypeX</span> <span class='hs-layout'>(</span><span class='hs-varid'>mkVarSet</span> <span class='hs-varid'>free_tcvs</span><span class='hs-layout'>)</span> <span class='hs-layout'>(</span><span class='hs-varid'>tidyType</span> <span class='hs-varid'>env'</span> <span class='hs-varid'>ty</span><span class='hs-layout'>)</span>
<a name="line-126"></a>  <span class='hs-keyword'>where</span>
<a name="line-127"></a>    <span class='hs-varid'>env'</span>      <span class='hs-keyglyph'>=</span> <span class='hs-varid'>tidyFreeTyCoVars</span> <span class='hs-varid'>env</span> <span class='hs-varid'>free_tcvs</span>
<a name="line-128"></a>    <span class='hs-varid'>free_tcvs</span> <span class='hs-keyglyph'>=</span> <span class='hs-varid'>tyCoVarsOfTypeWellScoped</span> <span class='hs-varid'>ty</span>
<a name="line-129"></a>
<a name="line-130"></a><a name="pprCo"></a><span class='hs-comment'>------------</span>
<a name="line-131"></a><span class='hs-definition'>pprCo</span><span class='hs-layout'>,</span> <span class='hs-varid'>pprParendCo</span> <span class='hs-keyglyph'>::</span> <span class='hs-conid'>Coercion</span> <span class='hs-keyglyph'>-&gt;</span> <span class='hs-conid'>SDoc</span>
<a name="line-132"></a><span class='hs-definition'>pprCo</span>       <span class='hs-varid'>co</span> <span class='hs-keyglyph'>=</span> <span class='hs-varid'>getPprStyle</span> <span class='hs-varop'>$</span> <span class='hs-keyglyph'>\</span> <span class='hs-varid'>sty</span> <span class='hs-keyglyph'>-&gt;</span> <span class='hs-varid'>pprIfaceCoercion</span> <span class='hs-layout'>(</span><span class='hs-varid'>tidyToIfaceCoSty</span> <span class='hs-varid'>co</span> <span class='hs-varid'>sty</span><span class='hs-layout'>)</span>
<a name="line-133"></a><a name="pprParendCo"></a><span class='hs-definition'>pprParendCo</span> <span class='hs-varid'>co</span> <span class='hs-keyglyph'>=</span> <span class='hs-varid'>getPprStyle</span> <span class='hs-varop'>$</span> <span class='hs-keyglyph'>\</span> <span class='hs-varid'>sty</span> <span class='hs-keyglyph'>-&gt;</span> <span class='hs-varid'>pprParendIfaceCoercion</span> <span class='hs-layout'>(</span><span class='hs-varid'>tidyToIfaceCoSty</span> <span class='hs-varid'>co</span> <span class='hs-varid'>sty</span><span class='hs-layout'>)</span>
<a name="line-134"></a>
<a name="line-135"></a><a name="tidyToIfaceCoSty"></a><span class='hs-definition'>tidyToIfaceCoSty</span> <span class='hs-keyglyph'>::</span> <span class='hs-conid'>Coercion</span> <span class='hs-keyglyph'>-&gt;</span> <span class='hs-conid'>PprStyle</span> <span class='hs-keyglyph'>-&gt;</span> <span class='hs-conid'>IfaceCoercion</span>
<a name="line-136"></a><span class='hs-definition'>tidyToIfaceCoSty</span> <span class='hs-varid'>co</span> <span class='hs-varid'>sty</span>
<a name="line-137"></a>  <span class='hs-keyglyph'>|</span> <span class='hs-varid'>userStyle</span> <span class='hs-varid'>sty</span> <span class='hs-keyglyph'>=</span> <span class='hs-varid'>tidyToIfaceCo</span> <span class='hs-varid'>co</span>
<a name="line-138"></a>  <span class='hs-keyglyph'>|</span> <span class='hs-varid'>otherwise</span>     <span class='hs-keyglyph'>=</span> <span class='hs-varid'>toIfaceCoercionX</span> <span class='hs-layout'>(</span><span class='hs-varid'>tyCoVarsOfCo</span> <span class='hs-varid'>co</span><span class='hs-layout'>)</span> <span class='hs-varid'>co</span>
<a name="line-139"></a>     <span class='hs-comment'>-- in latter case, don't tidy, as we'll be printing uniques.</span>
<a name="line-140"></a>
<a name="line-141"></a><a name="tidyToIfaceCo"></a><span class='hs-definition'>tidyToIfaceCo</span> <span class='hs-keyglyph'>::</span> <span class='hs-conid'>Coercion</span> <span class='hs-keyglyph'>-&gt;</span> <span class='hs-conid'>IfaceCoercion</span>
<a name="line-142"></a><span class='hs-comment'>-- It's vital to tidy before converting to an IfaceType</span>
<a name="line-143"></a><span class='hs-comment'>-- or nested binders will become indistinguishable!</span>
<a name="line-144"></a><span class='hs-comment'>--</span>
<a name="line-145"></a><span class='hs-comment'>-- Also for the free type variables, tell toIfaceCoercionX to</span>
<a name="line-146"></a><span class='hs-comment'>-- leave them as IfaceFreeCoVar.  This is super-important</span>
<a name="line-147"></a><span class='hs-comment'>-- for debug printing.</span>
<a name="line-148"></a><span class='hs-definition'>tidyToIfaceCo</span> <span class='hs-varid'>co</span> <span class='hs-keyglyph'>=</span> <span class='hs-varid'>toIfaceCoercionX</span> <span class='hs-layout'>(</span><span class='hs-varid'>mkVarSet</span> <span class='hs-varid'>free_tcvs</span><span class='hs-layout'>)</span> <span class='hs-layout'>(</span><span class='hs-varid'>tidyCo</span> <span class='hs-varid'>env</span> <span class='hs-varid'>co</span><span class='hs-layout'>)</span>
<a name="line-149"></a>  <span class='hs-keyword'>where</span>
<a name="line-150"></a>    <span class='hs-varid'>env</span>       <span class='hs-keyglyph'>=</span> <span class='hs-varid'>tidyFreeTyCoVars</span> <span class='hs-varid'>emptyTidyEnv</span> <span class='hs-varid'>free_tcvs</span>
<a name="line-151"></a>    <span class='hs-varid'>free_tcvs</span> <span class='hs-keyglyph'>=</span> <span class='hs-varid'>scopedSort</span> <span class='hs-varop'>$</span> <span class='hs-varid'>tyCoVarsOfCoList</span> <span class='hs-varid'>co</span>
<a name="line-152"></a><a name="pprClassPred"></a><span class='hs-comment'>------------</span>
<a name="line-153"></a><span class='hs-definition'>pprClassPred</span> <span class='hs-keyglyph'>::</span> <span class='hs-conid'>Class</span> <span class='hs-keyglyph'>-&gt;</span> <span class='hs-keyglyph'>[</span><span class='hs-conid'>Type</span><span class='hs-keyglyph'>]</span> <span class='hs-keyglyph'>-&gt;</span> <span class='hs-conid'>SDoc</span>
<a name="line-154"></a><span class='hs-definition'>pprClassPred</span> <span class='hs-varid'>clas</span> <span class='hs-varid'>tys</span> <span class='hs-keyglyph'>=</span> <span class='hs-varid'>pprTypeApp</span> <span class='hs-layout'>(</span><span class='hs-varid'>classTyCon</span> <span class='hs-varid'>clas</span><span class='hs-layout'>)</span> <span class='hs-varid'>tys</span>
<a name="line-155"></a>
<a name="line-156"></a><a name="pprTheta"></a><span class='hs-comment'>------------</span>
<a name="line-157"></a><span class='hs-definition'>pprTheta</span> <span class='hs-keyglyph'>::</span> <span class='hs-conid'>ThetaType</span> <span class='hs-keyglyph'>-&gt;</span> <span class='hs-conid'>SDoc</span>
<a name="line-158"></a><span class='hs-definition'>pprTheta</span> <span class='hs-keyglyph'>=</span> <span class='hs-varid'>pprIfaceContext</span> <span class='hs-varid'>topPrec</span> <span class='hs-varop'>.</span> <span class='hs-varid'>map</span> <span class='hs-varid'>tidyToIfaceType</span>
<a name="line-159"></a>
<a name="line-160"></a><a name="pprParendTheta"></a><span class='hs-definition'>pprParendTheta</span> <span class='hs-keyglyph'>::</span> <span class='hs-conid'>ThetaType</span> <span class='hs-keyglyph'>-&gt;</span> <span class='hs-conid'>SDoc</span>
<a name="line-161"></a><span class='hs-definition'>pprParendTheta</span> <span class='hs-keyglyph'>=</span> <span class='hs-varid'>pprIfaceContext</span> <span class='hs-varid'>appPrec</span> <span class='hs-varop'>.</span> <span class='hs-varid'>map</span> <span class='hs-varid'>tidyToIfaceType</span>
<a name="line-162"></a>
<a name="line-163"></a><a name="pprThetaArrowTy"></a><span class='hs-definition'>pprThetaArrowTy</span> <span class='hs-keyglyph'>::</span> <span class='hs-conid'>ThetaType</span> <span class='hs-keyglyph'>-&gt;</span> <span class='hs-conid'>SDoc</span>
<a name="line-164"></a><span class='hs-definition'>pprThetaArrowTy</span> <span class='hs-keyglyph'>=</span> <span class='hs-varid'>pprIfaceContextArr</span> <span class='hs-varop'>.</span> <span class='hs-varid'>map</span> <span class='hs-varid'>tidyToIfaceType</span>
<a name="line-165"></a>
<a name="line-166"></a><a name="pprSigmaType"></a><span class='hs-comment'>------------------</span>
<a name="line-167"></a><span class='hs-definition'>pprSigmaType</span> <span class='hs-keyglyph'>::</span> <span class='hs-conid'>Type</span> <span class='hs-keyglyph'>-&gt;</span> <span class='hs-conid'>SDoc</span>
<a name="line-168"></a><span class='hs-definition'>pprSigmaType</span> <span class='hs-keyglyph'>=</span> <span class='hs-varid'>pprIfaceSigmaType</span> <span class='hs-conid'>ShowForAllWhen</span> <span class='hs-varop'>.</span> <span class='hs-varid'>tidyToIfaceType</span>
<a name="line-169"></a>
<a name="line-170"></a><a name="pprForAll"></a><span class='hs-definition'>pprForAll</span> <span class='hs-keyglyph'>::</span> <span class='hs-keyglyph'>[</span><span class='hs-conid'>TyCoVarBinder</span><span class='hs-keyglyph'>]</span> <span class='hs-keyglyph'>-&gt;</span> <span class='hs-conid'>SDoc</span>
<a name="line-171"></a><span class='hs-definition'>pprForAll</span> <span class='hs-varid'>tvs</span> <span class='hs-keyglyph'>=</span> <span class='hs-varid'>pprIfaceForAll</span> <span class='hs-layout'>(</span><span class='hs-varid'>map</span> <span class='hs-varid'>toIfaceForAllBndr</span> <span class='hs-varid'>tvs</span><span class='hs-layout'>)</span>
<a name="line-172"></a>
<a name="line-173"></a><a name="pprUserForAll"></a><span class='hs-comment'>-- | Print a user-level forall; see @Note [When to print foralls]@ in</span>
<a name="line-174"></a><span class='hs-comment'>-- "GHC.Iface.Type".</span>
<a name="line-175"></a><span class='hs-definition'>pprUserForAll</span> <span class='hs-keyglyph'>::</span> <span class='hs-keyglyph'>[</span><span class='hs-conid'>TyCoVarBinder</span><span class='hs-keyglyph'>]</span> <span class='hs-keyglyph'>-&gt;</span> <span class='hs-conid'>SDoc</span>
<a name="line-176"></a><span class='hs-definition'>pprUserForAll</span> <span class='hs-keyglyph'>=</span> <span class='hs-varid'>pprUserIfaceForAll</span> <span class='hs-varop'>.</span> <span class='hs-varid'>map</span> <span class='hs-varid'>toIfaceForAllBndr</span>
<a name="line-177"></a>
<a name="line-178"></a><a name="pprTCvBndrs"></a><span class='hs-definition'>pprTCvBndrs</span> <span class='hs-keyglyph'>::</span> <span class='hs-keyglyph'>[</span><span class='hs-conid'>TyCoVarBinder</span><span class='hs-keyglyph'>]</span> <span class='hs-keyglyph'>-&gt;</span> <span class='hs-conid'>SDoc</span>
<a name="line-179"></a><span class='hs-definition'>pprTCvBndrs</span> <span class='hs-varid'>tvs</span> <span class='hs-keyglyph'>=</span> <span class='hs-varid'>sep</span> <span class='hs-layout'>(</span><span class='hs-varid'>map</span> <span class='hs-varid'>pprTCvBndr</span> <span class='hs-varid'>tvs</span><span class='hs-layout'>)</span>
<a name="line-180"></a>
<a name="line-181"></a><a name="pprTCvBndr"></a><span class='hs-definition'>pprTCvBndr</span> <span class='hs-keyglyph'>::</span> <span class='hs-conid'>TyCoVarBinder</span> <span class='hs-keyglyph'>-&gt;</span> <span class='hs-conid'>SDoc</span>
<a name="line-182"></a><span class='hs-definition'>pprTCvBndr</span> <span class='hs-keyglyph'>=</span> <span class='hs-varid'>pprTyVar</span> <span class='hs-varop'>.</span> <span class='hs-varid'>binderVar</span>
<a name="line-183"></a>
<a name="line-184"></a><a name="pprTyVars"></a><span class='hs-definition'>pprTyVars</span> <span class='hs-keyglyph'>::</span> <span class='hs-keyglyph'>[</span><span class='hs-conid'>TyVar</span><span class='hs-keyglyph'>]</span> <span class='hs-keyglyph'>-&gt;</span> <span class='hs-conid'>SDoc</span>
<a name="line-185"></a><span class='hs-definition'>pprTyVars</span> <span class='hs-varid'>tvs</span> <span class='hs-keyglyph'>=</span> <span class='hs-varid'>sep</span> <span class='hs-layout'>(</span><span class='hs-varid'>map</span> <span class='hs-varid'>pprTyVar</span> <span class='hs-varid'>tvs</span><span class='hs-layout'>)</span>
<a name="line-186"></a>
<a name="line-187"></a><a name="pprTyVar"></a><span class='hs-definition'>pprTyVar</span> <span class='hs-keyglyph'>::</span> <span class='hs-conid'>TyVar</span> <span class='hs-keyglyph'>-&gt;</span> <span class='hs-conid'>SDoc</span>
<a name="line-188"></a><span class='hs-comment'>-- Print a type variable binder with its kind (but not if *)</span>
<a name="line-189"></a><span class='hs-comment'>-- Here we do not go via IfaceType, because the duplication with</span>
<a name="line-190"></a><span class='hs-comment'>-- pprIfaceTvBndr is minimal, and the loss of uniques etc in</span>
<a name="line-191"></a><span class='hs-comment'>-- debug printing is disastrous</span>
<a name="line-192"></a><span class='hs-definition'>pprTyVar</span> <span class='hs-varid'>tv</span>
<a name="line-193"></a>  <span class='hs-keyglyph'>|</span> <span class='hs-varid'>pickyIsLiftedTypeKind</span> <span class='hs-varid'>kind</span> <span class='hs-keyglyph'>=</span> <span class='hs-varid'>ppr</span> <span class='hs-varid'>tv</span>  <span class='hs-comment'>-- See Note [Suppressing * kinds]</span>
<a name="line-194"></a>  <span class='hs-keyglyph'>|</span> <span class='hs-varid'>otherwise</span>                  <span class='hs-keyglyph'>=</span> <span class='hs-varid'>parens</span> <span class='hs-layout'>(</span><span class='hs-varid'>ppr</span> <span class='hs-varid'>tv</span> <span class='hs-varop'>&lt;+&gt;</span> <span class='hs-varid'>dcolon</span> <span class='hs-varop'>&lt;+&gt;</span> <span class='hs-varid'>ppr</span> <span class='hs-varid'>kind</span><span class='hs-layout'>)</span>
<a name="line-195"></a>  <span class='hs-keyword'>where</span>
<a name="line-196"></a>    <span class='hs-varid'>kind</span> <span class='hs-keyglyph'>=</span> <span class='hs-varid'>tyVarKind</span> <span class='hs-varid'>tv</span>
<a name="line-197"></a>
<a name="line-198"></a><span class='hs-comment'>{- Note [Suppressing * kinds]
<a name="line-199"></a>~~~~~~~~~~~~~~~~~~~~~~~~~~~~~
<a name="line-200"></a>Generally we want to print
<a name="line-201"></a>      forall a. a-&gt;a
<a name="line-202"></a>not   forall (a::*). a-&gt;a
<a name="line-203"></a>or    forall (a::Type). a-&gt;a
<a name="line-204"></a>That is, for brevity we suppress a kind ascription of '*' (or Type).
<a name="line-205"></a>
<a name="line-206"></a>But what if the kind is (Const Type x)?
<a name="line-207"></a>   type Const p q = p
<a name="line-208"></a>
<a name="line-209"></a>Then (Const Type x) is just a long way of saying Type.  But it may be
<a name="line-210"></a>jolly confusing to suppress the 'x'.  Suppose we have (polykinds/T18451a)
<a name="line-211"></a>   foo :: forall a b (c :: Const Type b). Proxy '[a, c]
<a name="line-212"></a>
<a name="line-213"></a>Then this error message
<a name="line-214"></a>    • These kind and type variables: a b (c :: Const Type b)
<a name="line-215"></a>      are out of dependency order. Perhaps try this ordering:
<a name="line-216"></a>        (b :: k) (a :: Const (*) b) (c :: Const (*) b)
<a name="line-217"></a>would be much less helpful if we suppressed the kind ascription on 'a'.
<a name="line-218"></a>
<a name="line-219"></a>Hence the use of pickyIsLiftedTypeKind.
<a name="line-220"></a>-}</span>
<a name="line-221"></a>
<a name="line-222"></a><a name="debugPprType"></a><span class='hs-comment'>-----------------</span>
<a name="line-223"></a><span class='hs-definition'>debugPprType</span> <span class='hs-keyglyph'>::</span> <span class='hs-conid'>Type</span> <span class='hs-keyglyph'>-&gt;</span> <span class='hs-conid'>SDoc</span>
<a name="line-224"></a><span class='hs-comment'>-- ^ debugPprType is a simple pretty printer that prints a type</span>
<a name="line-225"></a><span class='hs-comment'>-- without going through IfaceType.  It does not format as prettily</span>
<a name="line-226"></a><span class='hs-comment'>-- as the normal route, but it's much more direct, and that can</span>
<a name="line-227"></a><span class='hs-comment'>-- be useful for debugging.  E.g. with -dppr-debug it prints the</span>
<a name="line-228"></a><span class='hs-comment'>-- kind on type-variable /occurrences/ which the normal route</span>
<a name="line-229"></a><span class='hs-comment'>-- fundamentally cannot do.</span>
<a name="line-230"></a><span class='hs-definition'>debugPprType</span> <span class='hs-varid'>ty</span> <span class='hs-keyglyph'>=</span> <span class='hs-varid'>debug_ppr_ty</span> <span class='hs-varid'>topPrec</span> <span class='hs-varid'>ty</span>
<a name="line-231"></a>
<a name="line-232"></a><a name="debug_ppr_ty"></a><span class='hs-definition'>debug_ppr_ty</span> <span class='hs-keyglyph'>::</span> <span class='hs-conid'>PprPrec</span> <span class='hs-keyglyph'>-&gt;</span> <span class='hs-conid'>Type</span> <span class='hs-keyglyph'>-&gt;</span> <span class='hs-conid'>SDoc</span>
<a name="line-233"></a><span class='hs-definition'>debug_ppr_ty</span> <span class='hs-keyword'>_</span> <span class='hs-layout'>(</span><span class='hs-conid'>LitTy</span> <span class='hs-varid'>l</span><span class='hs-layout'>)</span>
<a name="line-234"></a>  <span class='hs-keyglyph'>=</span> <span class='hs-varid'>ppr</span> <span class='hs-varid'>l</span>
<a name="line-235"></a>
<a name="line-236"></a><span class='hs-definition'>debug_ppr_ty</span> <span class='hs-keyword'>_</span> <span class='hs-layout'>(</span><span class='hs-conid'>TyVarTy</span> <span class='hs-varid'>tv</span><span class='hs-layout'>)</span>
<a name="line-237"></a>  <span class='hs-keyglyph'>=</span> <span class='hs-varid'>ppr</span> <span class='hs-varid'>tv</span>  <span class='hs-comment'>-- With -dppr-debug we get (tv :: kind)</span>
<a name="line-238"></a>
<a name="line-239"></a><span class='hs-definition'>debug_ppr_ty</span> <span class='hs-varid'>prec</span> <span class='hs-varid'>ty</span><span class='hs-keyglyph'>@</span><span class='hs-layout'>(</span><span class='hs-conid'>FunTy</span> <span class='hs-layout'>{</span> <span class='hs-varid'>ft_af</span> <span class='hs-keyglyph'>=</span> <span class='hs-varid'>af</span><span class='hs-layout'>,</span> <span class='hs-varid'>ft_mult</span> <span class='hs-keyglyph'>=</span> <span class='hs-varid'>mult</span><span class='hs-layout'>,</span> <span class='hs-varid'>ft_arg</span> <span class='hs-keyglyph'>=</span> <span class='hs-varid'>arg</span><span class='hs-layout'>,</span> <span class='hs-varid'>ft_res</span> <span class='hs-keyglyph'>=</span> <span class='hs-varid'>res</span> <span class='hs-layout'>}</span><span class='hs-layout'>)</span>
<a name="line-240"></a>  <span class='hs-keyglyph'>=</span> <span class='hs-varid'>maybeParen</span> <span class='hs-varid'>prec</span> <span class='hs-varid'>funPrec</span> <span class='hs-varop'>$</span>
<a name="line-241"></a>    <span class='hs-varid'>sep</span> <span class='hs-keyglyph'>[</span><span class='hs-varid'>debug_ppr_ty</span> <span class='hs-varid'>funPrec</span> <span class='hs-varid'>arg</span><span class='hs-layout'>,</span> <span class='hs-varid'>arr</span> <span class='hs-varop'>&lt;+&gt;</span> <span class='hs-varid'>debug_ppr_ty</span> <span class='hs-varid'>prec</span> <span class='hs-varid'>res</span><span class='hs-keyglyph'>]</span>
<a name="line-242"></a>  <span class='hs-keyword'>where</span>
<a name="line-243"></a>    <span class='hs-varid'>arr</span> <span class='hs-keyglyph'>=</span> <span class='hs-keyword'>case</span> <span class='hs-varid'>af</span> <span class='hs-keyword'>of</span>
<a name="line-244"></a>            <span class='hs-conid'>VisArg</span>   <span class='hs-keyglyph'>-&gt;</span> <span class='hs-keyword'>case</span> <span class='hs-varid'>mult</span> <span class='hs-keyword'>of</span>
<a name="line-245"></a>                          <span class='hs-conid'>One</span> <span class='hs-keyglyph'>-&gt;</span> <span class='hs-varid'>lollipop</span>
<a name="line-246"></a>                          <span class='hs-conid'>Many</span> <span class='hs-keyglyph'>-&gt;</span> <span class='hs-varid'>arrow</span>
<a name="line-247"></a>                          <span class='hs-varid'>w</span> <span class='hs-keyglyph'>-&gt;</span> <span class='hs-varid'>mulArrow</span> <span class='hs-layout'>(</span><span class='hs-varid'>ppr</span> <span class='hs-varid'>w</span><span class='hs-layout'>)</span>
<a name="line-248"></a>            <span class='hs-conid'>InvisArg</span> <span class='hs-keyglyph'>-&gt;</span> <span class='hs-keyword'>case</span> <span class='hs-varid'>mult</span> <span class='hs-keyword'>of</span>
<a name="line-249"></a>                          <span class='hs-conid'>Many</span> <span class='hs-keyglyph'>-&gt;</span> <span class='hs-varid'>darrow</span>
<a name="line-250"></a>                          <span class='hs-keyword'>_</span> <span class='hs-keyglyph'>-&gt;</span> <span class='hs-varid'>pprPanic</span> <span class='hs-str'>"unexpected multiplicity"</span> <span class='hs-layout'>(</span><span class='hs-varid'>ppr</span> <span class='hs-varid'>ty</span><span class='hs-layout'>)</span>
<a name="line-251"></a>
<a name="line-252"></a><span class='hs-definition'>debug_ppr_ty</span> <span class='hs-varid'>prec</span> <span class='hs-layout'>(</span><span class='hs-conid'>TyConApp</span> <span class='hs-varid'>tc</span> <span class='hs-varid'>tys</span><span class='hs-layout'>)</span>
<a name="line-253"></a>  <span class='hs-keyglyph'>|</span> <span class='hs-varid'>null</span> <span class='hs-varid'>tys</span>  <span class='hs-keyglyph'>=</span> <span class='hs-varid'>ppr</span> <span class='hs-varid'>tc</span>
<a name="line-254"></a>  <span class='hs-keyglyph'>|</span> <span class='hs-varid'>otherwise</span> <span class='hs-keyglyph'>=</span> <span class='hs-varid'>maybeParen</span> <span class='hs-varid'>prec</span> <span class='hs-varid'>appPrec</span> <span class='hs-varop'>$</span>
<a name="line-255"></a>                <span class='hs-varid'>hang</span> <span class='hs-layout'>(</span><span class='hs-varid'>ppr</span> <span class='hs-varid'>tc</span><span class='hs-layout'>)</span> <span class='hs-num'>2</span> <span class='hs-layout'>(</span><span class='hs-varid'>sep</span> <span class='hs-layout'>(</span><span class='hs-varid'>map</span> <span class='hs-layout'>(</span><span class='hs-varid'>debug_ppr_ty</span> <span class='hs-varid'>appPrec</span><span class='hs-layout'>)</span> <span class='hs-varid'>tys</span><span class='hs-layout'>)</span><span class='hs-layout'>)</span>
<a name="line-256"></a>
<a name="line-257"></a><span class='hs-definition'>debug_ppr_ty</span> <span class='hs-keyword'>_</span> <span class='hs-layout'>(</span><span class='hs-conid'>AppTy</span> <span class='hs-varid'>t1</span> <span class='hs-varid'>t2</span><span class='hs-layout'>)</span>
<a name="line-258"></a>  <span class='hs-keyglyph'>=</span> <span class='hs-varid'>hang</span> <span class='hs-layout'>(</span><span class='hs-varid'>debug_ppr_ty</span> <span class='hs-varid'>appPrec</span> <span class='hs-varid'>t1</span><span class='hs-layout'>)</span>  <span class='hs-comment'>-- Print parens so we see ((a b) c)</span>
<a name="line-259"></a>       <span class='hs-num'>2</span> <span class='hs-layout'>(</span><span class='hs-varid'>debug_ppr_ty</span> <span class='hs-varid'>appPrec</span> <span class='hs-varid'>t2</span><span class='hs-layout'>)</span>  <span class='hs-comment'>-- so that we can distinguish</span>
<a name="line-260"></a>                                    <span class='hs-comment'>-- TyConApp from AppTy</span>
<a name="line-261"></a>
<a name="line-262"></a><span class='hs-definition'>debug_ppr_ty</span> <span class='hs-varid'>prec</span> <span class='hs-layout'>(</span><span class='hs-conid'>CastTy</span> <span class='hs-varid'>ty</span> <span class='hs-varid'>co</span><span class='hs-layout'>)</span>
<a name="line-263"></a>  <span class='hs-keyglyph'>=</span> <span class='hs-varid'>maybeParen</span> <span class='hs-varid'>prec</span> <span class='hs-varid'>topPrec</span> <span class='hs-varop'>$</span>
<a name="line-264"></a>    <span class='hs-varid'>hang</span> <span class='hs-layout'>(</span><span class='hs-varid'>debug_ppr_ty</span> <span class='hs-varid'>topPrec</span> <span class='hs-varid'>ty</span><span class='hs-layout'>)</span>
<a name="line-265"></a>       <span class='hs-num'>2</span> <span class='hs-layout'>(</span><span class='hs-varid'>text</span> <span class='hs-str'>"|&gt;"</span> <span class='hs-varop'>&lt;+&gt;</span> <span class='hs-varid'>ppr</span> <span class='hs-varid'>co</span><span class='hs-layout'>)</span>
<a name="line-266"></a>
<a name="line-267"></a><span class='hs-definition'>debug_ppr_ty</span> <span class='hs-keyword'>_</span> <span class='hs-layout'>(</span><span class='hs-conid'>CoercionTy</span> <span class='hs-varid'>co</span><span class='hs-layout'>)</span>
<a name="line-268"></a>  <span class='hs-keyglyph'>=</span> <span class='hs-varid'>parens</span> <span class='hs-layout'>(</span><span class='hs-varid'>text</span> <span class='hs-str'>"CO"</span> <span class='hs-varop'>&lt;+&gt;</span> <span class='hs-varid'>ppr</span> <span class='hs-varid'>co</span><span class='hs-layout'>)</span>
<a name="line-269"></a>
<a name="line-270"></a><span class='hs-comment'>-- Invisible forall:  forall {k} (a :: k). t</span>
<a name="line-271"></a><span class='hs-definition'>debug_ppr_ty</span> <span class='hs-varid'>prec</span> <span class='hs-varid'>t</span>
<a name="line-272"></a>  <span class='hs-keyglyph'>|</span> <span class='hs-layout'>(</span><span class='hs-varid'>bndrs</span><span class='hs-layout'>,</span> <span class='hs-varid'>body</span><span class='hs-layout'>)</span> <span class='hs-keyglyph'>&lt;-</span> <span class='hs-varid'>splitForAllInvisTVBinders</span> <span class='hs-varid'>t</span>
<a name="line-273"></a>  <span class='hs-layout'>,</span> <span class='hs-varid'>not</span> <span class='hs-layout'>(</span><span class='hs-varid'>null</span> <span class='hs-varid'>bndrs</span><span class='hs-layout'>)</span>
<a name="line-274"></a>  <span class='hs-keyglyph'>=</span> <span class='hs-varid'>maybeParen</span> <span class='hs-varid'>prec</span> <span class='hs-varid'>funPrec</span> <span class='hs-varop'>$</span>
<a name="line-275"></a>    <span class='hs-varid'>sep</span> <span class='hs-keyglyph'>[</span> <span class='hs-varid'>text</span> <span class='hs-str'>"forall"</span> <span class='hs-varop'>&lt;+&gt;</span> <span class='hs-varid'>fsep</span> <span class='hs-layout'>(</span><span class='hs-varid'>map</span> <span class='hs-varid'>ppr_bndr</span> <span class='hs-varid'>bndrs</span><span class='hs-layout'>)</span> <span class='hs-varop'>&lt;&gt;</span> <span class='hs-varid'>dot</span><span class='hs-layout'>,</span>
<a name="line-276"></a>          <span class='hs-varid'>ppr</span> <span class='hs-varid'>body</span> <span class='hs-keyglyph'>]</span>
<a name="line-277"></a>  <span class='hs-keyword'>where</span>
<a name="line-278"></a>    <span class='hs-comment'>-- (ppr tv) will print the binder kind-annotated</span>
<a name="line-279"></a>    <span class='hs-comment'>-- when in debug-style</span>
<a name="line-280"></a>    <span class='hs-varid'>ppr_bndr</span> <span class='hs-layout'>(</span><span class='hs-conid'>Bndr</span> <span class='hs-varid'>tv</span> <span class='hs-conid'>InferredSpec</span><span class='hs-layout'>)</span>  <span class='hs-keyglyph'>=</span> <span class='hs-varid'>braces</span> <span class='hs-layout'>(</span><span class='hs-varid'>ppr</span> <span class='hs-varid'>tv</span><span class='hs-layout'>)</span>
<a name="line-281"></a>    <span class='hs-varid'>ppr_bndr</span> <span class='hs-layout'>(</span><span class='hs-conid'>Bndr</span> <span class='hs-varid'>tv</span> <span class='hs-conid'>SpecifiedSpec</span><span class='hs-layout'>)</span> <span class='hs-keyglyph'>=</span> <span class='hs-varid'>ppr</span> <span class='hs-varid'>tv</span>
<a name="line-282"></a>
<a name="line-283"></a><span class='hs-comment'>-- Visible forall:  forall x y -&gt; t</span>
<a name="line-284"></a><span class='hs-definition'>debug_ppr_ty</span> <span class='hs-varid'>prec</span> <span class='hs-varid'>t</span>
<a name="line-285"></a>  <span class='hs-keyglyph'>|</span> <span class='hs-layout'>(</span><span class='hs-varid'>bndrs</span><span class='hs-layout'>,</span> <span class='hs-varid'>body</span><span class='hs-layout'>)</span> <span class='hs-keyglyph'>&lt;-</span> <span class='hs-varid'>splitForAllReqTVBinders</span> <span class='hs-varid'>t</span>
<a name="line-286"></a>  <span class='hs-layout'>,</span> <span class='hs-varid'>not</span> <span class='hs-layout'>(</span><span class='hs-varid'>null</span> <span class='hs-varid'>bndrs</span><span class='hs-layout'>)</span>
<a name="line-287"></a>  <span class='hs-keyglyph'>=</span> <span class='hs-varid'>maybeParen</span> <span class='hs-varid'>prec</span> <span class='hs-varid'>funPrec</span> <span class='hs-varop'>$</span>
<a name="line-288"></a>    <span class='hs-varid'>sep</span> <span class='hs-keyglyph'>[</span> <span class='hs-varid'>text</span> <span class='hs-str'>"forall"</span> <span class='hs-varop'>&lt;+&gt;</span> <span class='hs-varid'>fsep</span> <span class='hs-layout'>(</span><span class='hs-varid'>map</span> <span class='hs-varid'>ppr_bndr</span> <span class='hs-varid'>bndrs</span><span class='hs-layout'>)</span> <span class='hs-varop'>&lt;+&gt;</span> <span class='hs-varid'>arrow</span><span class='hs-layout'>,</span>
<a name="line-289"></a>          <span class='hs-varid'>ppr</span> <span class='hs-varid'>body</span> <span class='hs-keyglyph'>]</span>
<a name="line-290"></a>  <span class='hs-keyword'>where</span>
<a name="line-291"></a>    <span class='hs-comment'>-- (ppr tv) will print the binder kind-annotated</span>
<a name="line-292"></a>    <span class='hs-comment'>-- when in debug-style</span>
<a name="line-293"></a>    <span class='hs-varid'>ppr_bndr</span> <span class='hs-layout'>(</span><span class='hs-conid'>Bndr</span> <span class='hs-varid'>tv</span> <span class='hs-conid'>()</span><span class='hs-layout'>)</span> <span class='hs-keyglyph'>=</span> <span class='hs-varid'>ppr</span> <span class='hs-varid'>tv</span>
<a name="line-294"></a>
<a name="line-295"></a><span class='hs-comment'>-- Impossible case: neither visible nor invisible forall.</span>
<a name="line-296"></a><span class='hs-definition'>debug_ppr_ty</span> <span class='hs-keyword'>_</span> <span class='hs-conid'>ForAllTy</span><span class='hs-layout'>{</span><span class='hs-layout'>}</span>
<a name="line-297"></a>  <span class='hs-keyglyph'>=</span> <span class='hs-varid'>panic</span> <span class='hs-str'>"debug_ppr_ty: neither splitForAllInvisTVBinders nor splitForAllReqTVBinders returned any binders"</span>
<a name="line-298"></a>
<a name="line-299"></a><span class='hs-comment'>{-
<a name="line-300"></a>Note [Infix type variables]
<a name="line-301"></a>~~~~~~~~~~~~~~~~~~~~~~~~~~~
<a name="line-302"></a>With TypeOperators you can say
<a name="line-303"></a>
<a name="line-304"></a>   f :: (a ~&gt; b) -&gt; b
<a name="line-305"></a>
<a name="line-306"></a>and the (~&gt;) is considered a type variable.  However, the type
<a name="line-307"></a>pretty-printer in this module will just see (a ~&gt; b) as
<a name="line-308"></a>
<a name="line-309"></a>   App (App (TyVarTy "~&gt;") (TyVarTy "a")) (TyVarTy "b")
<a name="line-310"></a>
<a name="line-311"></a>So it'll print the type in prefix form.  To avoid confusion we must
<a name="line-312"></a>remember to parenthesise the operator, thus
<a name="line-313"></a>
<a name="line-314"></a>   (~&gt;) a b -&gt; b
<a name="line-315"></a>
<a name="line-316"></a>See #2766.
<a name="line-317"></a>-}</span>
<a name="line-318"></a>
<a name="line-319"></a><a name="pprDataCons"></a><span class='hs-definition'>pprDataCons</span> <span class='hs-keyglyph'>::</span> <span class='hs-conid'>TyCon</span> <span class='hs-keyglyph'>-&gt;</span> <span class='hs-conid'>SDoc</span>
<a name="line-320"></a><span class='hs-definition'>pprDataCons</span> <span class='hs-keyglyph'>=</span> <span class='hs-varid'>sepWithVBars</span> <span class='hs-varop'>.</span> <span class='hs-varid'>fmap</span> <span class='hs-varid'>pprDataConWithArgs</span> <span class='hs-varop'>.</span> <span class='hs-varid'>tyConDataCons</span>
<a name="line-321"></a>  <span class='hs-keyword'>where</span>
<a name="line-322"></a>    <span class='hs-varid'>sepWithVBars</span> <span class='hs-conid'>[]</span> <span class='hs-keyglyph'>=</span> <span class='hs-varid'>empty</span>
<a name="line-323"></a>    <span class='hs-varid'>sepWithVBars</span> <span class='hs-varid'>docs</span> <span class='hs-keyglyph'>=</span> <span class='hs-varid'>sep</span> <span class='hs-layout'>(</span><span class='hs-varid'>punctuate</span> <span class='hs-layout'>(</span><span class='hs-varid'>space</span> <span class='hs-varop'>&lt;&gt;</span> <span class='hs-varid'>vbar</span><span class='hs-layout'>)</span> <span class='hs-varid'>docs</span><span class='hs-layout'>)</span>
<a name="line-324"></a>
<a name="line-325"></a><a name="pprDataConWithArgs"></a><span class='hs-definition'>pprDataConWithArgs</span> <span class='hs-keyglyph'>::</span> <span class='hs-conid'>DataCon</span> <span class='hs-keyglyph'>-&gt;</span> <span class='hs-conid'>SDoc</span>
<a name="line-326"></a><span class='hs-definition'>pprDataConWithArgs</span> <span class='hs-varid'>dc</span> <span class='hs-keyglyph'>=</span> <span class='hs-varid'>sep</span> <span class='hs-keyglyph'>[</span><span class='hs-varid'>forAllDoc</span><span class='hs-layout'>,</span> <span class='hs-varid'>thetaDoc</span><span class='hs-layout'>,</span> <span class='hs-varid'>ppr</span> <span class='hs-varid'>dc</span> <span class='hs-varop'>&lt;+&gt;</span> <span class='hs-varid'>argsDoc</span><span class='hs-keyglyph'>]</span>
<a name="line-327"></a>  <span class='hs-keyword'>where</span>
<a name="line-328"></a>    <span class='hs-layout'>(</span><span class='hs-sel'>_univ_tvs</span><span class='hs-layout'>,</span> <span class='hs-sel'>_ex_tvs</span><span class='hs-layout'>,</span> <span class='hs-sel'>_eq_spec</span><span class='hs-layout'>,</span> <span class='hs-varid'>theta</span><span class='hs-layout'>,</span> <span class='hs-varid'>arg_tys</span><span class='hs-layout'>,</span> <span class='hs-sel'>_res_ty</span><span class='hs-layout'>)</span> <span class='hs-keyglyph'>=</span> <span class='hs-varid'>dataConFullSig</span> <span class='hs-varid'>dc</span>
<a name="line-329"></a>    <span class='hs-varid'>user_bndrs</span> <span class='hs-keyglyph'>=</span> <span class='hs-varid'>tyVarSpecToBinders</span> <span class='hs-varop'>$</span> <span class='hs-varid'>dataConUserTyVarBinders</span> <span class='hs-varid'>dc</span>
<a name="line-330"></a>    <span class='hs-varid'>forAllDoc</span>  <span class='hs-keyglyph'>=</span> <span class='hs-varid'>pprUserForAll</span> <span class='hs-varid'>user_bndrs</span>
<a name="line-331"></a>    <span class='hs-varid'>thetaDoc</span>   <span class='hs-keyglyph'>=</span> <span class='hs-varid'>pprThetaArrowTy</span> <span class='hs-varid'>theta</span>
<a name="line-332"></a>    <span class='hs-varid'>argsDoc</span>    <span class='hs-keyglyph'>=</span> <span class='hs-varid'>hsep</span> <span class='hs-layout'>(</span><span class='hs-varid'>fmap</span> <span class='hs-varid'>pprParendType</span> <span class='hs-layout'>(</span><span class='hs-varid'>map</span> <span class='hs-varid'>scaledThing</span> <span class='hs-varid'>arg_tys</span><span class='hs-layout'>)</span><span class='hs-layout'>)</span>
<a name="line-333"></a>
<a name="line-334"></a>
<a name="line-335"></a><a name="pprTypeApp"></a><span class='hs-definition'>pprTypeApp</span> <span class='hs-keyglyph'>::</span> <span class='hs-conid'>TyCon</span> <span class='hs-keyglyph'>-&gt;</span> <span class='hs-keyglyph'>[</span><span class='hs-conid'>Type</span><span class='hs-keyglyph'>]</span> <span class='hs-keyglyph'>-&gt;</span> <span class='hs-conid'>SDoc</span>
<a name="line-336"></a><span class='hs-definition'>pprTypeApp</span> <span class='hs-varid'>tc</span> <span class='hs-varid'>tys</span>
<a name="line-337"></a>  <span class='hs-keyglyph'>=</span> <span class='hs-varid'>pprIfaceTypeApp</span> <span class='hs-varid'>topPrec</span> <span class='hs-layout'>(</span><span class='hs-varid'>toIfaceTyCon</span> <span class='hs-varid'>tc</span><span class='hs-layout'>)</span>
<a name="line-338"></a>                            <span class='hs-layout'>(</span><span class='hs-varid'>toIfaceTcArgs</span> <span class='hs-varid'>tc</span> <span class='hs-varid'>tys</span><span class='hs-layout'>)</span>
<a name="line-339"></a>    <span class='hs-comment'>-- TODO: toIfaceTcArgs seems rather wasteful here</span>
<a name="line-340"></a>
<a name="line-341"></a><a name="pprWithExplicitKindsWhen"></a><span class='hs-comment'>------------------</span>
<a name="line-342"></a><span class='hs-comment'>-- | Display all kind information (with @-fprint-explicit-kinds@) when the</span>
<a name="line-343"></a><span class='hs-comment'>-- provided 'Bool' argument is 'True'.</span>
<a name="line-344"></a><span class='hs-comment'>-- See @Note [Kind arguments in error messages]@ in "GHC.Tc.Errors".</span>
<a name="line-345"></a><span class='hs-definition'>pprWithExplicitKindsWhen</span> <span class='hs-keyglyph'>::</span> <span class='hs-conid'>Bool</span> <span class='hs-keyglyph'>-&gt;</span> <span class='hs-conid'>SDoc</span> <span class='hs-keyglyph'>-&gt;</span> <span class='hs-conid'>SDoc</span>
<a name="line-346"></a><span class='hs-definition'>pprWithExplicitKindsWhen</span> <span class='hs-varid'>b</span>
<a name="line-347"></a>  <span class='hs-keyglyph'>=</span> <span class='hs-varid'>updSDocContext</span> <span class='hs-varop'>$</span> <span class='hs-keyglyph'>\</span><span class='hs-varid'>ctx</span> <span class='hs-keyglyph'>-&gt;</span>
<a name="line-348"></a>      <span class='hs-keyword'>if</span> <span class='hs-varid'>b</span> <span class='hs-keyword'>then</span> <span class='hs-varid'>ctx</span> <span class='hs-layout'>{</span> <span class='hs-varid'>sdocPrintExplicitKinds</span> <span class='hs-keyglyph'>=</span> <span class='hs-conid'>True</span> <span class='hs-layout'>}</span>
<a name="line-349"></a>           <span class='hs-keyword'>else</span> <span class='hs-varid'>ctx</span>
<a name="line-350"></a>
<a name="line-351"></a><a name="pprWithTYPE"></a><span class='hs-comment'>-- | This variant preserves any use of TYPE in a type, effectively</span>
<a name="line-352"></a><span class='hs-comment'>-- locally setting -fprint-explicit-runtime-reps.</span>
<a name="line-353"></a><span class='hs-definition'>pprWithTYPE</span> <span class='hs-keyglyph'>::</span> <span class='hs-conid'>Type</span> <span class='hs-keyglyph'>-&gt;</span> <span class='hs-conid'>SDoc</span>
<a name="line-354"></a><span class='hs-definition'>pprWithTYPE</span> <span class='hs-varid'>ty</span> <span class='hs-keyglyph'>=</span> <span class='hs-varid'>updSDocContext</span> <span class='hs-layout'>(</span><span class='hs-keyglyph'>\</span><span class='hs-varid'>ctx</span> <span class='hs-keyglyph'>-&gt;</span> <span class='hs-varid'>ctx</span> <span class='hs-layout'>{</span> <span class='hs-varid'>sdocPrintExplicitRuntimeReps</span> <span class='hs-keyglyph'>=</span> <span class='hs-conid'>True</span> <span class='hs-layout'>}</span><span class='hs-layout'>)</span> <span class='hs-varop'>$</span>
<a name="line-355"></a>                 <span class='hs-varid'>ppr</span> <span class='hs-varid'>ty</span>
<a name="line-356"></a>
<a name="line-357"></a><a name="pprSourceTyCon"></a><span class='hs-comment'>-- | Pretty prints a 'TyCon', using the family instance in case of a</span>
<a name="line-358"></a><span class='hs-comment'>-- representation tycon.  For example:</span>
<a name="line-359"></a><span class='hs-comment'>--</span>
<a name="line-360"></a><span class='hs-comment'>-- &gt; data T [a] = ...</span>
<a name="line-361"></a><span class='hs-comment'>--</span>
<a name="line-362"></a><span class='hs-comment'>-- In that case we want to print @T [a]@, where @T@ is the family 'TyCon'</span>
<a name="line-363"></a><span class='hs-definition'>pprSourceTyCon</span> <span class='hs-keyglyph'>::</span> <span class='hs-conid'>TyCon</span> <span class='hs-keyglyph'>-&gt;</span> <span class='hs-conid'>SDoc</span>
<a name="line-364"></a><span class='hs-definition'>pprSourceTyCon</span> <span class='hs-varid'>tycon</span>
<a name="line-365"></a>  <span class='hs-keyglyph'>|</span> <span class='hs-conid'>Just</span> <span class='hs-layout'>(</span><span class='hs-varid'>fam_tc</span><span class='hs-layout'>,</span> <span class='hs-varid'>tys</span><span class='hs-layout'>)</span> <span class='hs-keyglyph'>&lt;-</span> <span class='hs-varid'>tyConFamInst_maybe</span> <span class='hs-varid'>tycon</span>
<a name="line-366"></a>  <span class='hs-keyglyph'>=</span> <span class='hs-varid'>ppr</span> <span class='hs-varop'>$</span> <span class='hs-varid'>fam_tc</span> <span class='hs-varop'>`TyConApp`</span> <span class='hs-varid'>tys</span>        <span class='hs-comment'>-- can't be FunTyCon</span>
<a name="line-367"></a>  <span class='hs-keyglyph'>|</span> <span class='hs-varid'>otherwise</span>
<a name="line-368"></a>  <span class='hs-keyglyph'>=</span> <span class='hs-varid'>ppr</span> <span class='hs-varid'>tycon</span>
</pre></body>
</html>
