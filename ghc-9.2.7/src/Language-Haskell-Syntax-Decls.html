<?xml version="1.0" encoding="UTF-8"?>
<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Strict//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-strict.dtd">
<html>
<head>
<!-- Generated by HsColour, http://code.haskell.org/~malcolm/hscolour/ -->
<title>Language/Haskell/Syntax/Decls.hs</title>
<link type='text/css' rel='stylesheet' href='hscolour.css' />
</head>
<body>
<pre><a name="line-1"></a><span class='hs-comment'>{-# LANGUAGE CPP #-}</span>
<a name="line-2"></a><span class='hs-comment'>{-# LANGUAGE ConstraintKinds #-}</span>
<a name="line-3"></a><span class='hs-comment'>{-# LANGUAGE DeriveDataTypeable #-}</span>
<a name="line-4"></a><span class='hs-comment'>{-# LANGUAGE FlexibleContexts #-}</span>
<a name="line-5"></a><span class='hs-comment'>{-# LANGUAGE FlexibleInstances #-}</span>
<a name="line-6"></a><span class='hs-comment'>{-# LANGUAGE ScopedTypeVariables #-}</span>
<a name="line-7"></a><span class='hs-comment'>{-# LANGUAGE TypeApplications #-}</span>
<a name="line-8"></a><span class='hs-comment'>{-# LANGUAGE TypeFamilies #-}</span>
<a name="line-9"></a><span class='hs-comment'>{-# LANGUAGE UndecidableInstances #-}</span> <span class='hs-comment'>-- Wrinkle in Note [Trees That Grow]</span>
<a name="line-10"></a>                                      <span class='hs-comment'>-- in module Language.Haskell.Syntax.Extension</span>
<a name="line-11"></a><span class='hs-comment'>{-# LANGUAGE ViewPatterns #-}</span>
<a name="line-12"></a>
<a name="line-13"></a><span class='hs-comment'>{-
<a name="line-14"></a>(c) The University of Glasgow 2006
<a name="line-15"></a>(c) The GRASP/AQUA Project, Glasgow University, 1992-1998
<a name="line-16"></a>-}</span>
<a name="line-17"></a>
<a name="line-18"></a>
<a name="line-19"></a><span class='hs-comment'>{-# OPTIONS_GHC -Wno-incomplete-record-updates #-}</span>
<a name="line-20"></a>
<a name="line-21"></a><span class='hs-comment'>-- See Note [Language.Haskell.Syntax.* Hierarchy] for why not GHC.Hs.*</span>
<a name="line-22"></a>
<a name="line-23"></a><span class='hs-comment'>-- | Abstract syntax of global declarations.</span>
<a name="line-24"></a><span class='hs-comment'>--</span>
<a name="line-25"></a><span class='hs-comment'>-- Definitions for: @SynDecl@ and @ConDecl@, @ClassDecl@,</span>
<a name="line-26"></a><span class='hs-comment'>-- @InstDecl@, @DefaultDecl@ and @ForeignDecl@.</span>
<a name="line-27"></a><span class='hs-keyword'>module</span> <span class='hs-conid'>Language.Haskell.Syntax.Decls</span> <span class='hs-layout'>(</span>
<a name="line-28"></a>  <span class='hs-comment'>-- * Toplevel declarations</span>
<a name="line-29"></a>  <span class='hs-conid'>HsDecl</span><span class='hs-layout'>(</span><span class='hs-keyglyph'>..</span><span class='hs-layout'>)</span><span class='hs-layout'>,</span> <span class='hs-conid'>LHsDecl</span><span class='hs-layout'>,</span> <span class='hs-conid'>HsDataDefn</span><span class='hs-layout'>(</span><span class='hs-keyglyph'>..</span><span class='hs-layout'>)</span><span class='hs-layout'>,</span> <span class='hs-conid'>HsDeriving</span><span class='hs-layout'>,</span> <span class='hs-conid'>LHsFunDep</span><span class='hs-layout'>,</span> <span class='hs-conid'>FunDep</span><span class='hs-layout'>(</span><span class='hs-keyglyph'>..</span><span class='hs-layout'>)</span><span class='hs-layout'>,</span>
<a name="line-30"></a>  <span class='hs-conid'>HsDerivingClause</span><span class='hs-layout'>(</span><span class='hs-keyglyph'>..</span><span class='hs-layout'>)</span><span class='hs-layout'>,</span> <span class='hs-conid'>LHsDerivingClause</span><span class='hs-layout'>,</span> <span class='hs-conid'>DerivClauseTys</span><span class='hs-layout'>(</span><span class='hs-keyglyph'>..</span><span class='hs-layout'>)</span><span class='hs-layout'>,</span> <span class='hs-conid'>LDerivClauseTys</span><span class='hs-layout'>,</span>
<a name="line-31"></a>  <span class='hs-conid'>NewOrData</span><span class='hs-layout'>(</span><span class='hs-keyglyph'>..</span><span class='hs-layout'>)</span><span class='hs-layout'>,</span> <span class='hs-varid'>newOrDataToFlavour</span><span class='hs-layout'>,</span>
<a name="line-32"></a>  <span class='hs-conid'>StandaloneKindSig</span><span class='hs-layout'>(</span><span class='hs-keyglyph'>..</span><span class='hs-layout'>)</span><span class='hs-layout'>,</span> <span class='hs-conid'>LStandaloneKindSig</span><span class='hs-layout'>,</span>
<a name="line-33"></a>
<a name="line-34"></a>  <span class='hs-comment'>-- ** Class or type declarations</span>
<a name="line-35"></a>  <span class='hs-conid'>TyClDecl</span><span class='hs-layout'>(</span><span class='hs-keyglyph'>..</span><span class='hs-layout'>)</span><span class='hs-layout'>,</span> <span class='hs-conid'>LTyClDecl</span><span class='hs-layout'>,</span> <span class='hs-conid'>DataDeclRn</span><span class='hs-layout'>(</span><span class='hs-keyglyph'>..</span><span class='hs-layout'>)</span><span class='hs-layout'>,</span>
<a name="line-36"></a>  <span class='hs-conid'>TyClGroup</span><span class='hs-layout'>(</span><span class='hs-keyglyph'>..</span><span class='hs-layout'>)</span><span class='hs-layout'>,</span>
<a name="line-37"></a>  <span class='hs-varid'>tyClGroupTyClDecls</span><span class='hs-layout'>,</span> <span class='hs-varid'>tyClGroupInstDecls</span><span class='hs-layout'>,</span> <span class='hs-varid'>tyClGroupRoleDecls</span><span class='hs-layout'>,</span>
<a name="line-38"></a>  <span class='hs-varid'>tyClGroupKindSigs</span><span class='hs-layout'>,</span>
<a name="line-39"></a>  <span class='hs-varid'>isClassDecl</span><span class='hs-layout'>,</span> <span class='hs-varid'>isDataDecl</span><span class='hs-layout'>,</span> <span class='hs-varid'>isSynDecl</span><span class='hs-layout'>,</span>
<a name="line-40"></a>  <span class='hs-varid'>isFamilyDecl</span><span class='hs-layout'>,</span> <span class='hs-varid'>isTypeFamilyDecl</span><span class='hs-layout'>,</span> <span class='hs-varid'>isDataFamilyDecl</span><span class='hs-layout'>,</span>
<a name="line-41"></a>  <span class='hs-varid'>isOpenTypeFamilyInfo</span><span class='hs-layout'>,</span> <span class='hs-varid'>isClosedTypeFamilyInfo</span><span class='hs-layout'>,</span>
<a name="line-42"></a>  <span class='hs-varid'>countTyClDecls</span><span class='hs-layout'>,</span>
<a name="line-43"></a>  <span class='hs-varid'>tyClDeclTyVars</span><span class='hs-layout'>,</span>
<a name="line-44"></a>  <span class='hs-conid'>FamilyDecl</span><span class='hs-layout'>(</span><span class='hs-keyglyph'>..</span><span class='hs-layout'>)</span><span class='hs-layout'>,</span> <span class='hs-conid'>LFamilyDecl</span><span class='hs-layout'>,</span>
<a name="line-45"></a>
<a name="line-46"></a>  <span class='hs-comment'>-- ** Instance declarations</span>
<a name="line-47"></a>  <span class='hs-conid'>InstDecl</span><span class='hs-layout'>(</span><span class='hs-keyglyph'>..</span><span class='hs-layout'>)</span><span class='hs-layout'>,</span> <span class='hs-conid'>LInstDecl</span><span class='hs-layout'>,</span> <span class='hs-conid'>FamilyInfo</span><span class='hs-layout'>(</span><span class='hs-keyglyph'>..</span><span class='hs-layout'>)</span><span class='hs-layout'>,</span> <span class='hs-varid'>pprFlavour</span><span class='hs-layout'>,</span>
<a name="line-48"></a>  <span class='hs-conid'>TyFamInstDecl</span><span class='hs-layout'>(</span><span class='hs-keyglyph'>..</span><span class='hs-layout'>)</span><span class='hs-layout'>,</span> <span class='hs-conid'>LTyFamInstDecl</span><span class='hs-layout'>,</span>
<a name="line-49"></a>  <span class='hs-conid'>TyFamDefltDecl</span><span class='hs-layout'>,</span> <span class='hs-conid'>LTyFamDefltDecl</span><span class='hs-layout'>,</span>
<a name="line-50"></a>  <span class='hs-conid'>DataFamInstDecl</span><span class='hs-layout'>(</span><span class='hs-keyglyph'>..</span><span class='hs-layout'>)</span><span class='hs-layout'>,</span> <span class='hs-conid'>LDataFamInstDecl</span><span class='hs-layout'>,</span>
<a name="line-51"></a>  <span class='hs-conid'>FamEqn</span><span class='hs-layout'>(</span><span class='hs-keyglyph'>..</span><span class='hs-layout'>)</span><span class='hs-layout'>,</span> <span class='hs-conid'>TyFamInstEqn</span><span class='hs-layout'>,</span> <span class='hs-conid'>LTyFamInstEqn</span><span class='hs-layout'>,</span> <span class='hs-conid'>HsTyPats</span><span class='hs-layout'>,</span>
<a name="line-52"></a>  <span class='hs-conid'>LClsInstDecl</span><span class='hs-layout'>,</span> <span class='hs-conid'>ClsInstDecl</span><span class='hs-layout'>(</span><span class='hs-keyglyph'>..</span><span class='hs-layout'>)</span><span class='hs-layout'>,</span>
<a name="line-53"></a>
<a name="line-54"></a>  <span class='hs-comment'>-- ** Standalone deriving declarations</span>
<a name="line-55"></a>  <span class='hs-conid'>DerivDecl</span><span class='hs-layout'>(</span><span class='hs-keyglyph'>..</span><span class='hs-layout'>)</span><span class='hs-layout'>,</span> <span class='hs-conid'>LDerivDecl</span><span class='hs-layout'>,</span>
<a name="line-56"></a>  <span class='hs-comment'>-- ** Deriving strategies</span>
<a name="line-57"></a>  <span class='hs-conid'>DerivStrategy</span><span class='hs-layout'>(</span><span class='hs-keyglyph'>..</span><span class='hs-layout'>)</span><span class='hs-layout'>,</span> <span class='hs-conid'>LDerivStrategy</span><span class='hs-layout'>,</span>
<a name="line-58"></a>  <span class='hs-varid'>derivStrategyName</span><span class='hs-layout'>,</span>
<a name="line-59"></a>  <span class='hs-comment'>-- ** @RULE@ declarations</span>
<a name="line-60"></a>  <span class='hs-conid'>LRuleDecls</span><span class='hs-layout'>,</span><span class='hs-conid'>RuleDecls</span><span class='hs-layout'>(</span><span class='hs-keyglyph'>..</span><span class='hs-layout'>)</span><span class='hs-layout'>,</span><span class='hs-conid'>RuleDecl</span><span class='hs-layout'>(</span><span class='hs-keyglyph'>..</span><span class='hs-layout'>)</span><span class='hs-layout'>,</span><span class='hs-conid'>LRuleDecl</span><span class='hs-layout'>,</span><span class='hs-conid'>HsRuleRn</span><span class='hs-layout'>(</span><span class='hs-keyglyph'>..</span><span class='hs-layout'>)</span><span class='hs-layout'>,</span>
<a name="line-61"></a>  <span class='hs-conid'>RuleBndr</span><span class='hs-layout'>(</span><span class='hs-keyglyph'>..</span><span class='hs-layout'>)</span><span class='hs-layout'>,</span><span class='hs-conid'>LRuleBndr</span><span class='hs-layout'>,</span>
<a name="line-62"></a>  <span class='hs-varid'>collectRuleBndrSigTys</span><span class='hs-layout'>,</span>
<a name="line-63"></a>  <span class='hs-varid'>pprFullRuleName</span><span class='hs-layout'>,</span>
<a name="line-64"></a>  <span class='hs-comment'>-- ** @default@ declarations</span>
<a name="line-65"></a>  <span class='hs-conid'>DefaultDecl</span><span class='hs-layout'>(</span><span class='hs-keyglyph'>..</span><span class='hs-layout'>)</span><span class='hs-layout'>,</span> <span class='hs-conid'>LDefaultDecl</span><span class='hs-layout'>,</span>
<a name="line-66"></a>  <span class='hs-comment'>-- ** Template haskell declaration splice</span>
<a name="line-67"></a>  <span class='hs-conid'>SpliceExplicitFlag</span><span class='hs-layout'>(</span><span class='hs-keyglyph'>..</span><span class='hs-layout'>)</span><span class='hs-layout'>,</span>
<a name="line-68"></a>  <span class='hs-conid'>SpliceDecl</span><span class='hs-layout'>(</span><span class='hs-keyglyph'>..</span><span class='hs-layout'>)</span><span class='hs-layout'>,</span> <span class='hs-conid'>LSpliceDecl</span><span class='hs-layout'>,</span>
<a name="line-69"></a>  <span class='hs-comment'>-- ** Foreign function interface declarations</span>
<a name="line-70"></a>  <span class='hs-conid'>ForeignDecl</span><span class='hs-layout'>(</span><span class='hs-keyglyph'>..</span><span class='hs-layout'>)</span><span class='hs-layout'>,</span> <span class='hs-conid'>LForeignDecl</span><span class='hs-layout'>,</span> <span class='hs-conid'>ForeignImport</span><span class='hs-layout'>(</span><span class='hs-keyglyph'>..</span><span class='hs-layout'>)</span><span class='hs-layout'>,</span> <span class='hs-conid'>ForeignExport</span><span class='hs-layout'>(</span><span class='hs-keyglyph'>..</span><span class='hs-layout'>)</span><span class='hs-layout'>,</span>
<a name="line-71"></a>  <span class='hs-conid'>CImportSpec</span><span class='hs-layout'>(</span><span class='hs-keyglyph'>..</span><span class='hs-layout'>)</span><span class='hs-layout'>,</span>
<a name="line-72"></a>  <span class='hs-comment'>-- ** Data-constructor declarations</span>
<a name="line-73"></a>  <span class='hs-conid'>ConDecl</span><span class='hs-layout'>(</span><span class='hs-keyglyph'>..</span><span class='hs-layout'>)</span><span class='hs-layout'>,</span> <span class='hs-conid'>LConDecl</span><span class='hs-layout'>,</span>
<a name="line-74"></a>  <span class='hs-conid'>HsConDeclH98Details</span><span class='hs-layout'>,</span> <span class='hs-conid'>HsConDeclGADTDetails</span><span class='hs-layout'>(</span><span class='hs-keyglyph'>..</span><span class='hs-layout'>)</span><span class='hs-layout'>,</span>
<a name="line-75"></a>  <span class='hs-comment'>-- ** Document comments</span>
<a name="line-76"></a>  <span class='hs-conid'>DocDecl</span><span class='hs-layout'>(</span><span class='hs-keyglyph'>..</span><span class='hs-layout'>)</span><span class='hs-layout'>,</span> <span class='hs-conid'>LDocDecl</span><span class='hs-layout'>,</span> <span class='hs-varid'>docDeclDoc</span><span class='hs-layout'>,</span>
<a name="line-77"></a>  <span class='hs-comment'>-- ** Deprecations</span>
<a name="line-78"></a>  <span class='hs-conid'>WarnDecl</span><span class='hs-layout'>(</span><span class='hs-keyglyph'>..</span><span class='hs-layout'>)</span><span class='hs-layout'>,</span>  <span class='hs-conid'>LWarnDecl</span><span class='hs-layout'>,</span>
<a name="line-79"></a>  <span class='hs-conid'>WarnDecls</span><span class='hs-layout'>(</span><span class='hs-keyglyph'>..</span><span class='hs-layout'>)</span><span class='hs-layout'>,</span> <span class='hs-conid'>LWarnDecls</span><span class='hs-layout'>,</span>
<a name="line-80"></a>  <span class='hs-comment'>-- ** Annotations</span>
<a name="line-81"></a>  <span class='hs-conid'>AnnDecl</span><span class='hs-layout'>(</span><span class='hs-keyglyph'>..</span><span class='hs-layout'>)</span><span class='hs-layout'>,</span> <span class='hs-conid'>LAnnDecl</span><span class='hs-layout'>,</span>
<a name="line-82"></a>  <span class='hs-conid'>AnnProvenance</span><span class='hs-layout'>(</span><span class='hs-keyglyph'>..</span><span class='hs-layout'>)</span><span class='hs-layout'>,</span> <span class='hs-varid'>annProvenanceName_maybe</span><span class='hs-layout'>,</span>
<a name="line-83"></a>  <span class='hs-comment'>-- ** Role annotations</span>
<a name="line-84"></a>  <span class='hs-conid'>RoleAnnotDecl</span><span class='hs-layout'>(</span><span class='hs-keyglyph'>..</span><span class='hs-layout'>)</span><span class='hs-layout'>,</span> <span class='hs-conid'>LRoleAnnotDecl</span><span class='hs-layout'>,</span>
<a name="line-85"></a>  <span class='hs-comment'>-- ** Injective type families</span>
<a name="line-86"></a>  <span class='hs-conid'>FamilyResultSig</span><span class='hs-layout'>(</span><span class='hs-keyglyph'>..</span><span class='hs-layout'>)</span><span class='hs-layout'>,</span> <span class='hs-conid'>LFamilyResultSig</span><span class='hs-layout'>,</span> <span class='hs-conid'>InjectivityAnn</span><span class='hs-layout'>(</span><span class='hs-keyglyph'>..</span><span class='hs-layout'>)</span><span class='hs-layout'>,</span> <span class='hs-conid'>LInjectivityAnn</span><span class='hs-layout'>,</span>
<a name="line-87"></a>
<a name="line-88"></a>  <span class='hs-comment'>-- * Grouping</span>
<a name="line-89"></a>  <span class='hs-conid'>HsGroup</span><span class='hs-layout'>(</span><span class='hs-keyglyph'>..</span><span class='hs-layout'>)</span><span class='hs-layout'>,</span> <span class='hs-varid'>hsGroupInstDecls</span><span class='hs-layout'>,</span>
<a name="line-90"></a>    <span class='hs-layout'>)</span> <span class='hs-keyword'>where</span>
<a name="line-91"></a>
<a name="line-92"></a><span class='hs-comment'>-- friends:</span>
<a name="line-93"></a><span class='hs-keyword'>import</span> <span class='hs-conid'>GHC.Prelude</span>
<a name="line-94"></a>
<a name="line-95"></a><span class='hs-keyword'>import</span> <span class='hs-comment'>{-# SOURCE #-}</span> <span class='hs-conid'>Language.Haskell.Syntax.Expr</span>
<a name="line-96"></a>  <span class='hs-layout'>(</span> <span class='hs-conid'>HsExpr</span><span class='hs-layout'>,</span> <span class='hs-conid'>HsSplice</span> <span class='hs-layout'>)</span>
<a name="line-97"></a>        <span class='hs-comment'>-- Because Expr imports Decls via HsBracket</span>
<a name="line-98"></a>
<a name="line-99"></a><span class='hs-keyword'>import</span> <span class='hs-conid'>Language.Haskell.Syntax.Binds</span>
<a name="line-100"></a><span class='hs-keyword'>import</span> <span class='hs-conid'>Language.Haskell.Syntax.Type</span>
<a name="line-101"></a><span class='hs-keyword'>import</span> <span class='hs-conid'>GHC.Hs.Doc</span>
<a name="line-102"></a><span class='hs-keyword'>import</span> <span class='hs-conid'>GHC.Core.TyCon</span>
<a name="line-103"></a><span class='hs-keyword'>import</span> <span class='hs-conid'>GHC.Types.Basic</span>
<a name="line-104"></a><span class='hs-keyword'>import</span> <span class='hs-conid'>GHC.Types.ForeignCall</span>
<a name="line-105"></a><span class='hs-keyword'>import</span> <span class='hs-conid'>Language.Haskell.Syntax.Extension</span>
<a name="line-106"></a><span class='hs-keyword'>import</span> <span class='hs-conid'>GHC.Types.Name.Set</span>
<a name="line-107"></a><span class='hs-keyword'>import</span> <span class='hs-conid'>GHC.Types.Fixity</span>
<a name="line-108"></a>
<a name="line-109"></a><span class='hs-comment'>-- others:</span>
<a name="line-110"></a><span class='hs-keyword'>import</span> <span class='hs-conid'>GHC.Utils.Outputable</span>
<a name="line-111"></a><span class='hs-keyword'>import</span> <span class='hs-conid'>GHC.Utils.Misc</span>
<a name="line-112"></a><span class='hs-keyword'>import</span> <span class='hs-conid'>GHC.Types.SrcLoc</span>
<a name="line-113"></a><span class='hs-keyword'>import</span> <span class='hs-conid'>GHC.Types.SourceText</span>
<a name="line-114"></a><span class='hs-keyword'>import</span> <span class='hs-conid'>GHC.Core.Type</span>
<a name="line-115"></a><span class='hs-keyword'>import</span> <span class='hs-conid'>GHC.Unit.Module.Warnings</span>
<a name="line-116"></a>
<a name="line-117"></a><span class='hs-keyword'>import</span> <span class='hs-conid'>GHC.Data.Maybe</span>
<a name="line-118"></a><span class='hs-keyword'>import</span> <span class='hs-conid'>Data.Data</span>        <span class='hs-varid'>hiding</span> <span class='hs-layout'>(</span><span class='hs-conid'>TyCon</span><span class='hs-layout'>,</span><span class='hs-conid'>Fixity</span><span class='hs-layout'>,</span> <span class='hs-conid'>Infix</span><span class='hs-layout'>)</span>
<a name="line-119"></a><span class='hs-keyword'>import</span> <span class='hs-conid'>Data.Void</span>
<a name="line-120"></a>
<a name="line-121"></a><span class='hs-comment'>{-
<a name="line-122"></a>************************************************************************
<a name="line-123"></a>*                                                                      *
<a name="line-124"></a>\subsection[HsDecl]{Declarations}
<a name="line-125"></a>*                                                                      *
<a name="line-126"></a>************************************************************************
<a name="line-127"></a>-}</span>
<a name="line-128"></a>
<a name="line-129"></a><a name="LHsDecl"></a><span class='hs-keyword'>type</span> <span class='hs-conid'>LHsDecl</span> <span class='hs-varid'>p</span> <span class='hs-keyglyph'>=</span> <span class='hs-conid'>XRec</span> <span class='hs-varid'>p</span> <span class='hs-layout'>(</span><span class='hs-conid'>HsDecl</span> <span class='hs-varid'>p</span><span class='hs-layout'>)</span>
<a name="line-130"></a>        <span class='hs-comment'>-- ^ When in a list this may have</span>
<a name="line-131"></a>        <span class='hs-comment'>--</span>
<a name="line-132"></a>        <span class='hs-comment'>--  - 'GHC.Parser.Annotation.AnnKeywordId' : 'GHC.Parser.Annotation.AnnSemi'</span>
<a name="line-133"></a>        <span class='hs-comment'>--</span>
<a name="line-134"></a>
<a name="line-135"></a><span class='hs-comment'>-- For details on above see note [exact print annotations] in GHC.Parser.Annotation</span>
<a name="line-136"></a>
<a name="line-137"></a><a name="HsDecl"></a><span class='hs-comment'>-- | A Haskell Declaration</span>
<a name="line-138"></a><a name="HsDecl"></a><span class='hs-keyword'>data</span> <span class='hs-conid'>HsDecl</span> <span class='hs-varid'>p</span>
<a name="line-139"></a>  <span class='hs-keyglyph'>=</span> <span class='hs-conid'>TyClD</span>      <span class='hs-layout'>(</span><span class='hs-conid'>XTyClD</span> <span class='hs-varid'>p</span><span class='hs-layout'>)</span>      <span class='hs-layout'>(</span><span class='hs-conid'>TyClDecl</span> <span class='hs-varid'>p</span><span class='hs-layout'>)</span>      <span class='hs-comment'>-- ^ Type or Class Declaration</span>
<a name="line-140"></a>  <span class='hs-keyglyph'>|</span> <span class='hs-conid'>InstD</span>      <span class='hs-layout'>(</span><span class='hs-conid'>XInstD</span> <span class='hs-varid'>p</span><span class='hs-layout'>)</span>      <span class='hs-layout'>(</span><span class='hs-conid'>InstDecl</span>  <span class='hs-varid'>p</span><span class='hs-layout'>)</span>     <span class='hs-comment'>-- ^ Instance declaration</span>
<a name="line-141"></a>  <span class='hs-keyglyph'>|</span> <span class='hs-conid'>DerivD</span>     <span class='hs-layout'>(</span><span class='hs-conid'>XDerivD</span> <span class='hs-varid'>p</span><span class='hs-layout'>)</span>     <span class='hs-layout'>(</span><span class='hs-conid'>DerivDecl</span> <span class='hs-varid'>p</span><span class='hs-layout'>)</span>     <span class='hs-comment'>-- ^ Deriving declaration</span>
<a name="line-142"></a>  <span class='hs-keyglyph'>|</span> <span class='hs-conid'>ValD</span>       <span class='hs-layout'>(</span><span class='hs-conid'>XValD</span> <span class='hs-varid'>p</span><span class='hs-layout'>)</span>       <span class='hs-layout'>(</span><span class='hs-conid'>HsBind</span> <span class='hs-varid'>p</span><span class='hs-layout'>)</span>        <span class='hs-comment'>-- ^ Value declaration</span>
<a name="line-143"></a>  <span class='hs-keyglyph'>|</span> <span class='hs-conid'>SigD</span>       <span class='hs-layout'>(</span><span class='hs-conid'>XSigD</span> <span class='hs-varid'>p</span><span class='hs-layout'>)</span>       <span class='hs-layout'>(</span><span class='hs-conid'>Sig</span> <span class='hs-varid'>p</span><span class='hs-layout'>)</span>           <span class='hs-comment'>-- ^ Signature declaration</span>
<a name="line-144"></a>  <span class='hs-keyglyph'>|</span> <span class='hs-conid'>KindSigD</span>   <span class='hs-layout'>(</span><span class='hs-conid'>XKindSigD</span> <span class='hs-varid'>p</span><span class='hs-layout'>)</span>   <span class='hs-layout'>(</span><span class='hs-conid'>StandaloneKindSig</span> <span class='hs-varid'>p</span><span class='hs-layout'>)</span> <span class='hs-comment'>-- ^ Standalone kind signature</span>
<a name="line-145"></a>  <span class='hs-keyglyph'>|</span> <span class='hs-conid'>DefD</span>       <span class='hs-layout'>(</span><span class='hs-conid'>XDefD</span> <span class='hs-varid'>p</span><span class='hs-layout'>)</span>       <span class='hs-layout'>(</span><span class='hs-conid'>DefaultDecl</span> <span class='hs-varid'>p</span><span class='hs-layout'>)</span>   <span class='hs-comment'>-- ^ 'default' declaration</span>
<a name="line-146"></a>  <span class='hs-keyglyph'>|</span> <span class='hs-conid'>ForD</span>       <span class='hs-layout'>(</span><span class='hs-conid'>XForD</span> <span class='hs-varid'>p</span><span class='hs-layout'>)</span>       <span class='hs-layout'>(</span><span class='hs-conid'>ForeignDecl</span> <span class='hs-varid'>p</span><span class='hs-layout'>)</span>   <span class='hs-comment'>-- ^ Foreign declaration</span>
<a name="line-147"></a>  <span class='hs-keyglyph'>|</span> <span class='hs-conid'>WarningD</span>   <span class='hs-layout'>(</span><span class='hs-conid'>XWarningD</span> <span class='hs-varid'>p</span><span class='hs-layout'>)</span>   <span class='hs-layout'>(</span><span class='hs-conid'>WarnDecls</span> <span class='hs-varid'>p</span><span class='hs-layout'>)</span>     <span class='hs-comment'>-- ^ Warning declaration</span>
<a name="line-148"></a>  <span class='hs-keyglyph'>|</span> <span class='hs-conid'>AnnD</span>       <span class='hs-layout'>(</span><span class='hs-conid'>XAnnD</span> <span class='hs-varid'>p</span><span class='hs-layout'>)</span>       <span class='hs-layout'>(</span><span class='hs-conid'>AnnDecl</span> <span class='hs-varid'>p</span><span class='hs-layout'>)</span>       <span class='hs-comment'>-- ^ Annotation declaration</span>
<a name="line-149"></a>  <span class='hs-keyglyph'>|</span> <span class='hs-conid'>RuleD</span>      <span class='hs-layout'>(</span><span class='hs-conid'>XRuleD</span> <span class='hs-varid'>p</span><span class='hs-layout'>)</span>      <span class='hs-layout'>(</span><span class='hs-conid'>RuleDecls</span> <span class='hs-varid'>p</span><span class='hs-layout'>)</span>     <span class='hs-comment'>-- ^ Rule declaration</span>
<a name="line-150"></a>  <span class='hs-keyglyph'>|</span> <span class='hs-conid'>SpliceD</span>    <span class='hs-layout'>(</span><span class='hs-conid'>XSpliceD</span> <span class='hs-varid'>p</span><span class='hs-layout'>)</span>    <span class='hs-layout'>(</span><span class='hs-conid'>SpliceDecl</span> <span class='hs-varid'>p</span><span class='hs-layout'>)</span>    <span class='hs-comment'>-- ^ Splice declaration</span>
<a name="line-151"></a>                                                 <span class='hs-comment'>-- (Includes quasi-quotes)</span>
<a name="line-152"></a>  <span class='hs-keyglyph'>|</span> <span class='hs-conid'>DocD</span>       <span class='hs-layout'>(</span><span class='hs-conid'>XDocD</span> <span class='hs-varid'>p</span><span class='hs-layout'>)</span>       <span class='hs-layout'>(</span><span class='hs-conid'>DocDecl</span><span class='hs-layout'>)</span>  <span class='hs-comment'>-- ^ Documentation comment declaration</span>
<a name="line-153"></a>  <span class='hs-keyglyph'>|</span> <span class='hs-conid'>RoleAnnotD</span> <span class='hs-layout'>(</span><span class='hs-conid'>XRoleAnnotD</span> <span class='hs-varid'>p</span><span class='hs-layout'>)</span> <span class='hs-layout'>(</span><span class='hs-conid'>RoleAnnotDecl</span> <span class='hs-varid'>p</span><span class='hs-layout'>)</span> <span class='hs-comment'>-- ^Role annotation declaration</span>
<a name="line-154"></a>  <span class='hs-keyglyph'>|</span> <span class='hs-conid'>XHsDecl</span>    <span class='hs-varop'>!</span><span class='hs-layout'>(</span><span class='hs-conid'>XXHsDecl</span> <span class='hs-varid'>p</span><span class='hs-layout'>)</span>
<a name="line-155"></a>
<a name="line-156"></a><span class='hs-comment'>{-
<a name="line-157"></a>Note [Top-level fixity signatures in an HsGroup]
<a name="line-158"></a>~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~
<a name="line-159"></a>An `HsGroup p` stores every top-level fixity declarations in one of two places:
<a name="line-160"></a>
<a name="line-161"></a>1. hs_fixds :: [LFixitySig p]
<a name="line-162"></a>
<a name="line-163"></a>   This stores fixity signatures for top-level declarations (e.g., functions,
<a name="line-164"></a>   data constructors, classes, type families, etc.) as well as fixity
<a name="line-165"></a>   signatures for class methods written outside of the class, as in this
<a name="line-166"></a>   example:
<a name="line-167"></a>
<a name="line-168"></a>     infixl 4 `m1`
<a name="line-169"></a>     class C1 a where
<a name="line-170"></a>       m1 :: a -&gt; a -&gt; a
<a name="line-171"></a>
<a name="line-172"></a>2. hs_tyclds :: [TyClGroup p]
<a name="line-173"></a>
<a name="line-174"></a>   Each type class can be found in a TyClDecl inside a TyClGroup, and that
<a name="line-175"></a>   TyClDecl stores the fixity signatures for its methods written inside of the
<a name="line-176"></a>   class, as in this example:
<a name="line-177"></a>
<a name="line-178"></a>     class C2 a where
<a name="line-179"></a>       infixl 4 `m2`
<a name="line-180"></a>       m2 :: a -&gt; a -&gt; a
<a name="line-181"></a>
<a name="line-182"></a>The story for fixity signatures for class methods is made slightly complicated
<a name="line-183"></a>by the fact that they can appear both inside and outside of the class itself,
<a name="line-184"></a>and both forms of fixity signatures are considered top-level. This matters
<a name="line-185"></a>in `GHC.Rename.Module.rnSrcDecls`, which must create a fixity environment out
<a name="line-186"></a>of all top-level fixity signatures before doing anything else. Therefore,
<a name="line-187"></a>`rnSrcDecls` must be aware of both (1) and (2) above. The
<a name="line-188"></a>`hsGroupTopLevelFixitySigs` function is responsible for collecting this
<a name="line-189"></a>information from an `HsGroup`.
<a name="line-190"></a>
<a name="line-191"></a>One might wonder why we even bother separating top-level fixity signatures
<a name="line-192"></a>into two places at all. That is, why not just take the fixity signatures
<a name="line-193"></a>from `hs_tyclds` and put them into `hs_fixds` so that they are all in one
<a name="line-194"></a>location? This ends up causing problems for `GHC.HsToCore.Quote.repTopDs`,
<a name="line-195"></a>which translates each fixity signature in `hs_fixds` and `hs_tyclds` into a
<a name="line-196"></a>Template Haskell `Dec`. If there are any duplicate signatures between the two
<a name="line-197"></a>fields, this will result in an error (#17608).
<a name="line-198"></a>-}</span>
<a name="line-199"></a>
<a name="line-200"></a><a name="HsGroup"></a><span class='hs-comment'>-- | Haskell Group</span>
<a name="line-201"></a><a name="HsGroup"></a><span class='hs-comment'>--</span>
<a name="line-202"></a><a name="HsGroup"></a><span class='hs-comment'>-- A 'HsDecl' is categorised into a 'HsGroup' before being</span>
<a name="line-203"></a><a name="HsGroup"></a><span class='hs-comment'>-- fed to the renamer.</span>
<a name="line-204"></a><a name="HsGroup"></a><span class='hs-keyword'>data</span> <span class='hs-conid'>HsGroup</span> <span class='hs-varid'>p</span>
<a name="line-205"></a>  <span class='hs-keyglyph'>=</span> <span class='hs-conid'>HsGroup</span> <span class='hs-layout'>{</span>
<a name="line-206"></a>        <span class='hs-varid'>hs_ext</span>    <span class='hs-keyglyph'>::</span> <span class='hs-conid'>XCHsGroup</span> <span class='hs-varid'>p</span><span class='hs-layout'>,</span>
<a name="line-207"></a>        <span class='hs-varid'>hs_valds</span>  <span class='hs-keyglyph'>::</span> <span class='hs-conid'>HsValBinds</span> <span class='hs-varid'>p</span><span class='hs-layout'>,</span>
<a name="line-208"></a>        <span class='hs-varid'>hs_splcds</span> <span class='hs-keyglyph'>::</span> <span class='hs-keyglyph'>[</span><span class='hs-conid'>LSpliceDecl</span> <span class='hs-varid'>p</span><span class='hs-keyglyph'>]</span><span class='hs-layout'>,</span>
<a name="line-209"></a>
<a name="line-210"></a>        <span class='hs-varid'>hs_tyclds</span> <span class='hs-keyglyph'>::</span> <span class='hs-keyglyph'>[</span><span class='hs-conid'>TyClGroup</span> <span class='hs-varid'>p</span><span class='hs-keyglyph'>]</span><span class='hs-layout'>,</span>
<a name="line-211"></a>                <span class='hs-comment'>-- A list of mutually-recursive groups;</span>
<a name="line-212"></a>                <span class='hs-comment'>-- This includes `InstDecl`s as well;</span>
<a name="line-213"></a>                <span class='hs-comment'>-- Parser generates a singleton list;</span>
<a name="line-214"></a>                <span class='hs-comment'>-- renamer does dependency analysis</span>
<a name="line-215"></a>
<a name="line-216"></a>        <span class='hs-varid'>hs_derivds</span> <span class='hs-keyglyph'>::</span> <span class='hs-keyglyph'>[</span><span class='hs-conid'>LDerivDecl</span> <span class='hs-varid'>p</span><span class='hs-keyglyph'>]</span><span class='hs-layout'>,</span>
<a name="line-217"></a>
<a name="line-218"></a>        <span class='hs-varid'>hs_fixds</span>  <span class='hs-keyglyph'>::</span> <span class='hs-keyglyph'>[</span><span class='hs-conid'>LFixitySig</span> <span class='hs-varid'>p</span><span class='hs-keyglyph'>]</span><span class='hs-layout'>,</span>
<a name="line-219"></a>                <span class='hs-comment'>-- A list of fixity signatures defined for top-level</span>
<a name="line-220"></a>                <span class='hs-comment'>-- declarations and class methods (defined outside of the class</span>
<a name="line-221"></a>                <span class='hs-comment'>-- itself).</span>
<a name="line-222"></a>                <span class='hs-comment'>-- See Note [Top-level fixity signatures in an HsGroup]</span>
<a name="line-223"></a>
<a name="line-224"></a>        <span class='hs-varid'>hs_defds</span>  <span class='hs-keyglyph'>::</span> <span class='hs-keyglyph'>[</span><span class='hs-conid'>LDefaultDecl</span> <span class='hs-varid'>p</span><span class='hs-keyglyph'>]</span><span class='hs-layout'>,</span>
<a name="line-225"></a>        <span class='hs-varid'>hs_fords</span>  <span class='hs-keyglyph'>::</span> <span class='hs-keyglyph'>[</span><span class='hs-conid'>LForeignDecl</span> <span class='hs-varid'>p</span><span class='hs-keyglyph'>]</span><span class='hs-layout'>,</span>
<a name="line-226"></a>        <span class='hs-varid'>hs_warnds</span> <span class='hs-keyglyph'>::</span> <span class='hs-keyglyph'>[</span><span class='hs-conid'>LWarnDecls</span> <span class='hs-varid'>p</span><span class='hs-keyglyph'>]</span><span class='hs-layout'>,</span>
<a name="line-227"></a>        <span class='hs-varid'>hs_annds</span>  <span class='hs-keyglyph'>::</span> <span class='hs-keyglyph'>[</span><span class='hs-conid'>LAnnDecl</span> <span class='hs-varid'>p</span><span class='hs-keyglyph'>]</span><span class='hs-layout'>,</span>
<a name="line-228"></a>        <span class='hs-varid'>hs_ruleds</span> <span class='hs-keyglyph'>::</span> <span class='hs-keyglyph'>[</span><span class='hs-conid'>LRuleDecls</span> <span class='hs-varid'>p</span><span class='hs-keyglyph'>]</span><span class='hs-layout'>,</span>
<a name="line-229"></a>
<a name="line-230"></a>        <span class='hs-varid'>hs_docs</span>   <span class='hs-keyglyph'>::</span> <span class='hs-keyglyph'>[</span><span class='hs-conid'>LDocDecl</span> <span class='hs-varid'>p</span><span class='hs-keyglyph'>]</span>
<a name="line-231"></a>    <span class='hs-layout'>}</span>
<a name="line-232"></a>  <span class='hs-keyglyph'>|</span> <span class='hs-conid'>XHsGroup</span> <span class='hs-varop'>!</span><span class='hs-layout'>(</span><span class='hs-conid'>XXHsGroup</span> <span class='hs-varid'>p</span><span class='hs-layout'>)</span>
<a name="line-233"></a>
<a name="line-234"></a>
<a name="line-235"></a><a name="hsGroupInstDecls"></a><span class='hs-definition'>hsGroupInstDecls</span> <span class='hs-keyglyph'>::</span> <span class='hs-conid'>HsGroup</span> <span class='hs-varid'>id</span> <span class='hs-keyglyph'>-&gt;</span> <span class='hs-keyglyph'>[</span><span class='hs-conid'>LInstDecl</span> <span class='hs-varid'>id</span><span class='hs-keyglyph'>]</span>
<a name="line-236"></a><span class='hs-definition'>hsGroupInstDecls</span> <span class='hs-keyglyph'>=</span> <span class='hs-layout'>(</span><span class='hs-varop'>=&lt;&lt;</span><span class='hs-layout'>)</span> <span class='hs-varid'>group_instds</span> <span class='hs-varop'>.</span> <span class='hs-varid'>hs_tyclds</span>
<a name="line-237"></a>
<a name="line-238"></a><a name="LSpliceDecl"></a><span class='hs-comment'>-- | Located Splice Declaration</span>
<a name="line-239"></a><a name="LSpliceDecl"></a><span class='hs-keyword'>type</span> <span class='hs-conid'>LSpliceDecl</span> <span class='hs-varid'>pass</span> <span class='hs-keyglyph'>=</span> <span class='hs-conid'>XRec</span> <span class='hs-varid'>pass</span> <span class='hs-layout'>(</span><span class='hs-conid'>SpliceDecl</span> <span class='hs-varid'>pass</span><span class='hs-layout'>)</span>
<a name="line-240"></a>
<a name="line-241"></a><a name="SpliceDecl"></a><span class='hs-comment'>-- | Splice Declaration</span>
<a name="line-242"></a><a name="SpliceDecl"></a><span class='hs-keyword'>data</span> <span class='hs-conid'>SpliceDecl</span> <span class='hs-varid'>p</span>
<a name="line-243"></a>  <span class='hs-keyglyph'>=</span> <span class='hs-conid'>SpliceDecl</span>                  <span class='hs-comment'>-- Top level splice</span>
<a name="line-244"></a>        <span class='hs-layout'>(</span><span class='hs-conid'>XSpliceDecl</span> <span class='hs-varid'>p</span><span class='hs-layout'>)</span>
<a name="line-245"></a>        <span class='hs-layout'>(</span><span class='hs-conid'>XRec</span> <span class='hs-varid'>p</span> <span class='hs-layout'>(</span><span class='hs-conid'>HsSplice</span> <span class='hs-varid'>p</span><span class='hs-layout'>)</span><span class='hs-layout'>)</span>
<a name="line-246"></a>        <span class='hs-conid'>SpliceExplicitFlag</span>
<a name="line-247"></a>  <span class='hs-keyglyph'>|</span> <span class='hs-conid'>XSpliceDecl</span> <span class='hs-varop'>!</span><span class='hs-layout'>(</span><span class='hs-conid'>XXSpliceDecl</span> <span class='hs-varid'>p</span><span class='hs-layout'>)</span>
<a name="line-248"></a>
<a name="line-249"></a><span class='hs-comment'>{-
<a name="line-250"></a>************************************************************************
<a name="line-251"></a>*                                                                      *
<a name="line-252"></a>            Type and class declarations
<a name="line-253"></a>*                                                                      *
<a name="line-254"></a>************************************************************************
<a name="line-255"></a>
<a name="line-256"></a>Note [The Naming story]
<a name="line-257"></a>~~~~~~~~~~~~~~~~~~~~~~~
<a name="line-258"></a>Here is the story about the implicit names that go with type, class,
<a name="line-259"></a>and instance decls.  It's a bit tricky, so pay attention!
<a name="line-260"></a>
<a name="line-261"></a>"Implicit" (or "system") binders
<a name="line-262"></a>~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~
<a name="line-263"></a>  Each data type decl defines
<a name="line-264"></a>        a worker name for each constructor
<a name="line-265"></a>        to-T and from-T convertors
<a name="line-266"></a>  Each class decl defines
<a name="line-267"></a>        a tycon for the class
<a name="line-268"></a>        a data constructor for that tycon
<a name="line-269"></a>        the worker for that constructor
<a name="line-270"></a>        a selector for each superclass
<a name="line-271"></a>
<a name="line-272"></a>All have occurrence names that are derived uniquely from their parent
<a name="line-273"></a>declaration.
<a name="line-274"></a>
<a name="line-275"></a>None of these get separate definitions in an interface file; they are
<a name="line-276"></a>fully defined by the data or class decl.  But they may *occur* in
<a name="line-277"></a>interface files, of course.  Any such occurrence must haul in the
<a name="line-278"></a>relevant type or class decl.
<a name="line-279"></a>
<a name="line-280"></a>Plan of attack:
<a name="line-281"></a> - Ensure they "point to" the parent data/class decl
<a name="line-282"></a>   when loading that decl from an interface file
<a name="line-283"></a>   (See RnHiFiles.getSysBinders)
<a name="line-284"></a>
<a name="line-285"></a> - When typechecking the decl, we build the implicit TyCons and Ids.
<a name="line-286"></a>   When doing so we look them up in the name cache (GHC.Rename.Env.lookupSysName),
<a name="line-287"></a>   to ensure correct module and provenance is set
<a name="line-288"></a>
<a name="line-289"></a>These are the two places that we have to conjure up the magic derived
<a name="line-290"></a>names.  (The actual magic is in GHC.Types.Name.Occurrence.mkWorkerOcc, etc.)
<a name="line-291"></a>
<a name="line-292"></a>Default methods
<a name="line-293"></a>~~~~~~~~~~~~~~~
<a name="line-294"></a> - Occurrence name is derived uniquely from the method name
<a name="line-295"></a>   E.g. $dmmax
<a name="line-296"></a>
<a name="line-297"></a> - If there is a default method name at all, it's recorded in
<a name="line-298"></a>   the ClassOpSig (in GHC.Hs.Binds), in the DefMethInfo field.
<a name="line-299"></a>   (DefMethInfo is defined in GHC.Core.Class)
<a name="line-300"></a>
<a name="line-301"></a>Source-code class decls and interface-code class decls are treated subtly
<a name="line-302"></a>differently, which has given me a great deal of confusion over the years.
<a name="line-303"></a>Here's the deal.  (We distinguish the two cases because source-code decls
<a name="line-304"></a>have (Just binds) in the tcdMeths field, whereas interface decls have Nothing.
<a name="line-305"></a>
<a name="line-306"></a>In *source-code* class declarations:
<a name="line-307"></a>
<a name="line-308"></a> - When parsing, every ClassOpSig gets a DefMeth with a suitable RdrName
<a name="line-309"></a>   This is done by GHC.Parser.PostProcess.mkClassOpSigDM
<a name="line-310"></a>
<a name="line-311"></a> - The renamer renames it to a Name
<a name="line-312"></a>
<a name="line-313"></a> - During typechecking, we generate a binding for each $dm for
<a name="line-314"></a>   which there's a programmer-supplied default method:
<a name="line-315"></a>        class Foo a where
<a name="line-316"></a>          op1 :: &lt;type&gt;
<a name="line-317"></a>          op2 :: &lt;type&gt;
<a name="line-318"></a>          op1 = ...
<a name="line-319"></a>   We generate a binding for $dmop1 but not for $dmop2.
<a name="line-320"></a>   The Class for Foo has a Nothing for op2 and
<a name="line-321"></a>                         a Just ($dm_op1, VanillaDM) for op1.
<a name="line-322"></a>   The Name for $dmop2 is simply discarded.
<a name="line-323"></a>
<a name="line-324"></a>In *interface-file* class declarations:
<a name="line-325"></a>  - When parsing, we see if there's an explicit programmer-supplied default method
<a name="line-326"></a>    because there's an '=' sign to indicate it:
<a name="line-327"></a>        class Foo a where
<a name="line-328"></a>          op1 = :: &lt;type&gt;       -- NB the '='
<a name="line-329"></a>          op2   :: &lt;type&gt;
<a name="line-330"></a>    We use this info to generate a DefMeth with a suitable RdrName for op1,
<a name="line-331"></a>    and a NoDefMeth for op2
<a name="line-332"></a>  - The interface file has a separate definition for $dmop1, with unfolding etc.
<a name="line-333"></a>  - The renamer renames it to a Name.
<a name="line-334"></a>  - The renamer treats $dmop1 as a free variable of the declaration, so that
<a name="line-335"></a>    the binding for $dmop1 will be sucked in.  (See RnHsSyn.tyClDeclFVs)
<a name="line-336"></a>    This doesn't happen for source code class decls, because they *bind* the default method.
<a name="line-337"></a>
<a name="line-338"></a>Dictionary functions
<a name="line-339"></a>~~~~~~~~~~~~~~~~~~~~
<a name="line-340"></a>Each instance declaration gives rise to one dictionary function binding.
<a name="line-341"></a>
<a name="line-342"></a>The type checker makes up new source-code instance declarations
<a name="line-343"></a>(e.g. from 'deriving' or generic default methods --- see
<a name="line-344"></a>GHC.Tc.TyCl.Instance.tcInstDecls1).  So we can't generate the names for
<a name="line-345"></a>dictionary functions in advance (we don't know how many we need).
<a name="line-346"></a>
<a name="line-347"></a>On the other hand for interface-file instance declarations, the decl
<a name="line-348"></a>specifies the name of the dictionary function, and it has a binding elsewhere
<a name="line-349"></a>in the interface file:
<a name="line-350"></a>        instance {Eq Int} = dEqInt
<a name="line-351"></a>        dEqInt :: {Eq Int} &lt;pragma info&gt;
<a name="line-352"></a>
<a name="line-353"></a>So again we treat source code and interface file code slightly differently.
<a name="line-354"></a>
<a name="line-355"></a>Source code:
<a name="line-356"></a>  - Source code instance decls have a Nothing in the (Maybe name) field
<a name="line-357"></a>    (see data InstDecl below)
<a name="line-358"></a>
<a name="line-359"></a>  - The typechecker makes up a Local name for the dict fun for any source-code
<a name="line-360"></a>    instance decl, whether it comes from a source-code instance decl, or whether
<a name="line-361"></a>    the instance decl is derived from some other construct (e.g. 'deriving').
<a name="line-362"></a>
<a name="line-363"></a>  - The occurrence name it chooses is derived from the instance decl (just for
<a name="line-364"></a>    documentation really) --- e.g. dNumInt.  Two dict funs may share a common
<a name="line-365"></a>    occurrence name, but will have different uniques.  E.g.
<a name="line-366"></a>        instance Foo [Int]  where ...
<a name="line-367"></a>        instance Foo [Bool] where ...
<a name="line-368"></a>    These might both be dFooList
<a name="line-369"></a>
<a name="line-370"></a>  - The CoreTidy phase externalises the name, and ensures the occurrence name is
<a name="line-371"></a>    unique (this isn't special to dict funs).  So we'd get dFooList and dFooList1.
<a name="line-372"></a>
<a name="line-373"></a>  - We can take this relaxed approach (changing the occurrence name later)
<a name="line-374"></a>    because dict fun Ids are not captured in a TyCon or Class (unlike default
<a name="line-375"></a>    methods, say).  Instead, they are kept separately in the InstEnv.  This
<a name="line-376"></a>    makes it easy to adjust them after compiling a module.  (Once we've finished
<a name="line-377"></a>    compiling that module, they don't change any more.)
<a name="line-378"></a>
<a name="line-379"></a>
<a name="line-380"></a>Interface file code:
<a name="line-381"></a>  - The instance decl gives the dict fun name, so the InstDecl has a (Just name)
<a name="line-382"></a>    in the (Maybe name) field.
<a name="line-383"></a>
<a name="line-384"></a>  - RnHsSyn.instDeclFVs treats the dict fun name as free in the decl, so that we
<a name="line-385"></a>    suck in the dfun binding
<a name="line-386"></a>-}</span>
<a name="line-387"></a>
<a name="line-388"></a><a name="LTyClDecl"></a><span class='hs-comment'>-- | Located Declaration of a Type or Class</span>
<a name="line-389"></a><a name="LTyClDecl"></a><span class='hs-keyword'>type</span> <span class='hs-conid'>LTyClDecl</span> <span class='hs-varid'>pass</span> <span class='hs-keyglyph'>=</span> <span class='hs-conid'>XRec</span> <span class='hs-varid'>pass</span> <span class='hs-layout'>(</span><span class='hs-conid'>TyClDecl</span> <span class='hs-varid'>pass</span><span class='hs-layout'>)</span>
<a name="line-390"></a>
<a name="line-391"></a><a name="TyClDecl"></a><span class='hs-comment'>-- | A type or class declaration.</span>
<a name="line-392"></a><a name="TyClDecl"></a><span class='hs-keyword'>data</span> <span class='hs-conid'>TyClDecl</span> <span class='hs-varid'>pass</span>
<a name="line-393"></a>  <span class='hs-keyglyph'>=</span> <span class='hs-comment'>-- | @type/data family T :: *-&gt;*@</span>
<a name="line-394"></a>    <span class='hs-comment'>--</span>
<a name="line-395"></a>    <span class='hs-comment'>--  - 'GHC.Parser.Annotation.AnnKeywordId' : 'GHC.Parser.Annotation.AnnType',</span>
<a name="line-396"></a>    <span class='hs-comment'>--             'GHC.Parser.Annotation.AnnData',</span>
<a name="line-397"></a>    <span class='hs-comment'>--             'GHC.Parser.Annotation.AnnFamily','GHC.Parser.Annotation.AnnDcolon',</span>
<a name="line-398"></a>    <span class='hs-comment'>--             'GHC.Parser.Annotation.AnnWhere','GHC.Parser.Annotation.AnnOpenP',</span>
<a name="line-399"></a>    <span class='hs-comment'>--             'GHC.Parser.Annotation.AnnDcolon','GHC.Parser.Annotation.AnnCloseP',</span>
<a name="line-400"></a>    <span class='hs-comment'>--             'GHC.Parser.Annotation.AnnEqual','GHC.Parser.Annotation.AnnRarrow',</span>
<a name="line-401"></a>    <span class='hs-comment'>--             'GHC.Parser.Annotation.AnnVbar'</span>
<a name="line-402"></a>
<a name="line-403"></a>    <span class='hs-comment'>-- For details on above see note [exact print annotations] in GHC.Parser.Annotation</span>
<a name="line-404"></a>    <span class='hs-conid'>FamDecl</span> <span class='hs-layout'>{</span> <span class='hs-varid'>tcdFExt</span> <span class='hs-keyglyph'>::</span> <span class='hs-conid'>XFamDecl</span> <span class='hs-varid'>pass</span><span class='hs-layout'>,</span> <span class='hs-varid'>tcdFam</span> <span class='hs-keyglyph'>::</span> <span class='hs-conid'>FamilyDecl</span> <span class='hs-varid'>pass</span> <span class='hs-layout'>}</span>
<a name="line-405"></a>
<a name="line-406"></a>  <span class='hs-keyglyph'>|</span> <span class='hs-comment'>-- | @type@ declaration</span>
<a name="line-407"></a>    <span class='hs-comment'>--</span>
<a name="line-408"></a>    <span class='hs-comment'>--  - 'GHC.Parser.Annotation.AnnKeywordId' : 'GHC.Parser.Annotation.AnnType',</span>
<a name="line-409"></a>    <span class='hs-comment'>--             'GHC.Parser.Annotation.AnnEqual',</span>
<a name="line-410"></a>
<a name="line-411"></a>    <span class='hs-comment'>-- For details on above see note [exact print annotations] in GHC.Parser.Annotation</span>
<a name="line-412"></a>    <span class='hs-conid'>SynDecl</span> <span class='hs-layout'>{</span> <span class='hs-varid'>tcdSExt</span>   <span class='hs-keyglyph'>::</span> <span class='hs-conid'>XSynDecl</span> <span class='hs-varid'>pass</span>          <span class='hs-comment'>-- ^ Post renameer, FVs</span>
<a name="line-413"></a>            <span class='hs-layout'>,</span> <span class='hs-varid'>tcdLName</span>  <span class='hs-keyglyph'>::</span> <span class='hs-conid'>LIdP</span> <span class='hs-varid'>pass</span>              <span class='hs-comment'>-- ^ Type constructor</span>
<a name="line-414"></a>            <span class='hs-layout'>,</span> <span class='hs-varid'>tcdTyVars</span> <span class='hs-keyglyph'>::</span> <span class='hs-conid'>LHsQTyVars</span> <span class='hs-varid'>pass</span>        <span class='hs-comment'>-- ^ Type variables; for an</span>
<a name="line-415"></a>                                                  <span class='hs-comment'>-- associated type these</span>
<a name="line-416"></a>                                                  <span class='hs-comment'>-- include outer binders</span>
<a name="line-417"></a>            <span class='hs-layout'>,</span> <span class='hs-varid'>tcdFixity</span> <span class='hs-keyglyph'>::</span> <span class='hs-conid'>LexicalFixity</span>          <span class='hs-comment'>-- ^ Fixity used in the declaration</span>
<a name="line-418"></a>            <span class='hs-layout'>,</span> <span class='hs-varid'>tcdRhs</span>    <span class='hs-keyglyph'>::</span> <span class='hs-conid'>LHsType</span> <span class='hs-varid'>pass</span> <span class='hs-layout'>}</span>         <span class='hs-comment'>-- ^ RHS of type declaration</span>
<a name="line-419"></a>
<a name="line-420"></a>  <span class='hs-keyglyph'>|</span> <span class='hs-comment'>-- | @data@ declaration</span>
<a name="line-421"></a>    <span class='hs-comment'>--</span>
<a name="line-422"></a>    <span class='hs-comment'>--  - 'GHC.Parser.Annotation.AnnKeywordId' : 'GHC.Parser.Annotation.AnnData',</span>
<a name="line-423"></a>    <span class='hs-comment'>--              'GHC.Parser.Annotation.AnnFamily',</span>
<a name="line-424"></a>    <span class='hs-comment'>--              'GHC.Parser.Annotation.AnnNewType',</span>
<a name="line-425"></a>    <span class='hs-comment'>--              'GHC.Parser.Annotation.AnnNewType','GHC.Parser.Annotation.AnnDcolon'</span>
<a name="line-426"></a>    <span class='hs-comment'>--              'GHC.Parser.Annotation.AnnWhere',</span>
<a name="line-427"></a>
<a name="line-428"></a>    <span class='hs-comment'>-- For details on above see note [exact print annotations] in GHC.Parser.Annotation</span>
<a name="line-429"></a>    <span class='hs-conid'>DataDecl</span> <span class='hs-layout'>{</span> <span class='hs-varid'>tcdDExt</span>     <span class='hs-keyglyph'>::</span> <span class='hs-conid'>XDataDecl</span> <span class='hs-varid'>pass</span>       <span class='hs-comment'>-- ^ Post renamer, CUSK flag, FVs</span>
<a name="line-430"></a>             <span class='hs-layout'>,</span> <span class='hs-varid'>tcdLName</span>    <span class='hs-keyglyph'>::</span> <span class='hs-conid'>LIdP</span> <span class='hs-varid'>pass</span>             <span class='hs-comment'>-- ^ Type constructor</span>
<a name="line-431"></a>             <span class='hs-layout'>,</span> <span class='hs-varid'>tcdTyVars</span>   <span class='hs-keyglyph'>::</span> <span class='hs-conid'>LHsQTyVars</span> <span class='hs-varid'>pass</span>      <span class='hs-comment'>-- ^ Type variables</span>
<a name="line-432"></a>                              <span class='hs-comment'>-- See Note [TyVar binders for associated declarations]</span>
<a name="line-433"></a>             <span class='hs-layout'>,</span> <span class='hs-varid'>tcdFixity</span>   <span class='hs-keyglyph'>::</span> <span class='hs-conid'>LexicalFixity</span>        <span class='hs-comment'>-- ^ Fixity used in the declaration</span>
<a name="line-434"></a>             <span class='hs-layout'>,</span> <span class='hs-varid'>tcdDataDefn</span> <span class='hs-keyglyph'>::</span> <span class='hs-conid'>HsDataDefn</span> <span class='hs-varid'>pass</span> <span class='hs-layout'>}</span>
<a name="line-435"></a>
<a name="line-436"></a>  <span class='hs-keyglyph'>|</span> <span class='hs-conid'>ClassDecl</span> <span class='hs-layout'>{</span> <span class='hs-varid'>tcdCExt</span>    <span class='hs-keyglyph'>::</span> <span class='hs-conid'>XClassDecl</span> <span class='hs-varid'>pass</span><span class='hs-layout'>,</span>         <span class='hs-comment'>-- ^ Post renamer, FVs</span>
<a name="line-437"></a>                <span class='hs-varid'>tcdCtxt</span>    <span class='hs-keyglyph'>::</span> <span class='hs-conid'>Maybe</span> <span class='hs-layout'>(</span><span class='hs-conid'>LHsContext</span> <span class='hs-varid'>pass</span><span class='hs-layout'>)</span><span class='hs-layout'>,</span> <span class='hs-comment'>-- ^ Context...</span>
<a name="line-438"></a>                <span class='hs-varid'>tcdLName</span>   <span class='hs-keyglyph'>::</span> <span class='hs-conid'>LIdP</span> <span class='hs-varid'>pass</span><span class='hs-layout'>,</span>               <span class='hs-comment'>-- ^ Name of the class</span>
<a name="line-439"></a>                <span class='hs-varid'>tcdTyVars</span>  <span class='hs-keyglyph'>::</span> <span class='hs-conid'>LHsQTyVars</span> <span class='hs-varid'>pass</span><span class='hs-layout'>,</span>         <span class='hs-comment'>-- ^ Class type variables</span>
<a name="line-440"></a>                <span class='hs-varid'>tcdFixity</span>  <span class='hs-keyglyph'>::</span> <span class='hs-conid'>LexicalFixity</span><span class='hs-layout'>,</span> <span class='hs-comment'>-- ^ Fixity used in the declaration</span>
<a name="line-441"></a>                <span class='hs-varid'>tcdFDs</span>     <span class='hs-keyglyph'>::</span> <span class='hs-keyglyph'>[</span><span class='hs-conid'>LHsFunDep</span> <span class='hs-varid'>pass</span><span class='hs-keyglyph'>]</span><span class='hs-layout'>,</span>         <span class='hs-comment'>-- ^ Functional deps</span>
<a name="line-442"></a>                <span class='hs-varid'>tcdSigs</span>    <span class='hs-keyglyph'>::</span> <span class='hs-keyglyph'>[</span><span class='hs-conid'>LSig</span> <span class='hs-varid'>pass</span><span class='hs-keyglyph'>]</span><span class='hs-layout'>,</span>              <span class='hs-comment'>-- ^ Methods' signatures</span>
<a name="line-443"></a>                <span class='hs-varid'>tcdMeths</span>   <span class='hs-keyglyph'>::</span> <span class='hs-conid'>LHsBinds</span> <span class='hs-varid'>pass</span><span class='hs-layout'>,</span>            <span class='hs-comment'>-- ^ Default methods</span>
<a name="line-444"></a>                <span class='hs-varid'>tcdATs</span>     <span class='hs-keyglyph'>::</span> <span class='hs-keyglyph'>[</span><span class='hs-conid'>LFamilyDecl</span> <span class='hs-varid'>pass</span><span class='hs-keyglyph'>]</span><span class='hs-layout'>,</span>       <span class='hs-comment'>-- ^ Associated types;</span>
<a name="line-445"></a>                <span class='hs-varid'>tcdATDefs</span>  <span class='hs-keyglyph'>::</span> <span class='hs-keyglyph'>[</span><span class='hs-conid'>LTyFamDefltDecl</span> <span class='hs-varid'>pass</span><span class='hs-keyglyph'>]</span><span class='hs-layout'>,</span>   <span class='hs-comment'>-- ^ Associated type defaults</span>
<a name="line-446"></a>                <span class='hs-varid'>tcdDocs</span>    <span class='hs-keyglyph'>::</span> <span class='hs-keyglyph'>[</span><span class='hs-conid'>LDocDecl</span> <span class='hs-varid'>pass</span><span class='hs-keyglyph'>]</span>           <span class='hs-comment'>-- ^ Haddock docs</span>
<a name="line-447"></a>    <span class='hs-layout'>}</span>
<a name="line-448"></a>        <span class='hs-comment'>-- ^ - 'GHC.Parser.Annotation.AnnKeywordId' : 'GHC.Parser.Annotation.AnnClass',</span>
<a name="line-449"></a>        <span class='hs-comment'>--           'GHC.Parser.Annotation.AnnWhere','GHC.Parser.Annotation.AnnOpen',</span>
<a name="line-450"></a>        <span class='hs-comment'>--           'GHC.Parser.Annotation.AnnClose'</span>
<a name="line-451"></a>        <span class='hs-comment'>--   - The tcdFDs will have 'GHC.Parser.Annotation.AnnVbar',</span>
<a name="line-452"></a>        <span class='hs-comment'>--                          'GHC.Parser.Annotation.AnnComma'</span>
<a name="line-453"></a>        <span class='hs-comment'>--                          'GHC.Parser.Annotation.AnnRarrow'</span>
<a name="line-454"></a>
<a name="line-455"></a>        <span class='hs-comment'>-- For details on above see note [exact print annotations] in GHC.Parser.Annotation</span>
<a name="line-456"></a>  <span class='hs-keyglyph'>|</span> <span class='hs-conid'>XTyClDecl</span> <span class='hs-varop'>!</span><span class='hs-layout'>(</span><span class='hs-conid'>XXTyClDecl</span> <span class='hs-varid'>pass</span><span class='hs-layout'>)</span>
<a name="line-457"></a>
<a name="line-458"></a><a name="FunDep"></a><span class='hs-keyword'>data</span> <span class='hs-conid'>FunDep</span> <span class='hs-varid'>pass</span>
<a name="line-459"></a>  <span class='hs-keyglyph'>=</span> <span class='hs-conid'>FunDep</span> <span class='hs-layout'>(</span><span class='hs-conid'>XCFunDep</span> <span class='hs-varid'>pass</span><span class='hs-layout'>)</span>
<a name="line-460"></a>           <span class='hs-keyglyph'>[</span><span class='hs-conid'>LIdP</span> <span class='hs-varid'>pass</span><span class='hs-keyglyph'>]</span>
<a name="line-461"></a>           <span class='hs-keyglyph'>[</span><span class='hs-conid'>LIdP</span> <span class='hs-varid'>pass</span><span class='hs-keyglyph'>]</span>
<a name="line-462"></a>  <span class='hs-keyglyph'>|</span> <span class='hs-conid'>XFunDep</span> <span class='hs-varop'>!</span><span class='hs-layout'>(</span><span class='hs-conid'>XXFunDep</span> <span class='hs-varid'>pass</span><span class='hs-layout'>)</span>
<a name="line-463"></a>
<a name="line-464"></a><a name="LHsFunDep"></a><span class='hs-keyword'>type</span> <span class='hs-conid'>LHsFunDep</span> <span class='hs-varid'>pass</span> <span class='hs-keyglyph'>=</span> <span class='hs-conid'>XRec</span> <span class='hs-varid'>pass</span> <span class='hs-layout'>(</span><span class='hs-conid'>FunDep</span> <span class='hs-varid'>pass</span><span class='hs-layout'>)</span>
<a name="line-465"></a>
<a name="line-466"></a><a name="DataDeclRn"></a><span class='hs-keyword'>data</span> <span class='hs-conid'>DataDeclRn</span> <span class='hs-keyglyph'>=</span> <span class='hs-conid'>DataDeclRn</span>
<a name="line-467"></a>             <span class='hs-layout'>{</span> <span class='hs-varid'>tcdDataCusk</span> <span class='hs-keyglyph'>::</span> <span class='hs-conid'>Bool</span>    <span class='hs-comment'>-- ^ does this have a CUSK?</span>
<a name="line-468"></a>                 <span class='hs-comment'>-- See Note [CUSKs: complete user-supplied kind signatures]</span>
<a name="line-469"></a>             <span class='hs-layout'>,</span> <span class='hs-varid'>tcdFVs</span>      <span class='hs-keyglyph'>::</span> <span class='hs-conid'>NameSet</span> <span class='hs-layout'>}</span>
<a name="line-470"></a>  <span class='hs-keyword'>deriving</span> <span class='hs-conid'>Data</span>
<a name="line-471"></a>
<a name="line-472"></a><span class='hs-comment'>{- Note [TyVar binders for associated decls]
<a name="line-473"></a>~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~
<a name="line-474"></a>For an /associated/ data, newtype, or type-family decl, the LHsQTyVars
<a name="line-475"></a>/includes/ outer binders.  For example
<a name="line-476"></a>    class T a where
<a name="line-477"></a>       data D a c
<a name="line-478"></a>       type F a b :: *
<a name="line-479"></a>       type F a b = a -&gt; a
<a name="line-480"></a>Here the data decl for 'D', and type-family decl for 'F', both include 'a'
<a name="line-481"></a>in their LHsQTyVars (tcdTyVars and fdTyVars resp).
<a name="line-482"></a>
<a name="line-483"></a>Ditto any implicit binders in the hsq_implicit field of the LHSQTyVars.
<a name="line-484"></a>
<a name="line-485"></a>The idea is that the associated type is really a top-level decl in its
<a name="line-486"></a>own right.  However we are careful to use the same name 'a', so that
<a name="line-487"></a>we can match things up.
<a name="line-488"></a>
<a name="line-489"></a>c.f. Note [Associated type tyvar names] in GHC.Core.Class
<a name="line-490"></a>     Note [Family instance declaration binders]
<a name="line-491"></a>-}</span>
<a name="line-492"></a>
<a name="line-493"></a><span class='hs-comment'>{- Note [Class LayoutInfo]
<a name="line-494"></a>~~~~~~~~~~~~~~~~~~~~~~~~~~
<a name="line-495"></a>The LayoutInfo is used to associate Haddock comments with parts of the declaration.
<a name="line-496"></a>Compare the following examples:
<a name="line-497"></a>
<a name="line-498"></a>    class C a where
<a name="line-499"></a>      f :: a -&gt; Int
<a name="line-500"></a>      -- ^ comment on f
<a name="line-501"></a>
<a name="line-502"></a>    class C a where
<a name="line-503"></a>      f :: a -&gt; Int
<a name="line-504"></a>    -- ^ comment on C
<a name="line-505"></a>
<a name="line-506"></a>Notice how "comment on f" and "comment on C" differ only by indentation level.
<a name="line-507"></a>Thus we have to record the indentation level of the class declarations.
<a name="line-508"></a>
<a name="line-509"></a>See also Note [Adding Haddock comments to the syntax tree] in GHC.Parser.PostProcess.Haddock
<a name="line-510"></a>-}</span>
<a name="line-511"></a>
<a name="line-512"></a><span class='hs-comment'>-- Simple classifiers for TyClDecl</span>
<a name="line-513"></a><span class='hs-comment'>-- ~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~</span>
<a name="line-514"></a>
<a name="line-515"></a><a name="isDataDecl"></a><span class='hs-comment'>-- | @True@ &lt;=&gt; argument is a @data@\/@newtype@</span>
<a name="line-516"></a><span class='hs-comment'>-- declaration.</span>
<a name="line-517"></a><span class='hs-definition'>isDataDecl</span> <span class='hs-keyglyph'>::</span> <span class='hs-conid'>TyClDecl</span> <span class='hs-varid'>pass</span> <span class='hs-keyglyph'>-&gt;</span> <span class='hs-conid'>Bool</span>
<a name="line-518"></a><span class='hs-definition'>isDataDecl</span> <span class='hs-layout'>(</span><span class='hs-conid'>DataDecl</span> <span class='hs-layout'>{</span><span class='hs-layout'>}</span><span class='hs-layout'>)</span> <span class='hs-keyglyph'>=</span> <span class='hs-conid'>True</span>
<a name="line-519"></a><span class='hs-definition'>isDataDecl</span> <span class='hs-sel'>_other</span>        <span class='hs-keyglyph'>=</span> <span class='hs-conid'>False</span>
<a name="line-520"></a>
<a name="line-521"></a><a name="isSynDecl"></a><span class='hs-comment'>-- | type or type instance declaration</span>
<a name="line-522"></a><span class='hs-definition'>isSynDecl</span> <span class='hs-keyglyph'>::</span> <span class='hs-conid'>TyClDecl</span> <span class='hs-varid'>pass</span> <span class='hs-keyglyph'>-&gt;</span> <span class='hs-conid'>Bool</span>
<a name="line-523"></a><span class='hs-definition'>isSynDecl</span> <span class='hs-layout'>(</span><span class='hs-conid'>SynDecl</span> <span class='hs-layout'>{</span><span class='hs-layout'>}</span><span class='hs-layout'>)</span>   <span class='hs-keyglyph'>=</span> <span class='hs-conid'>True</span>
<a name="line-524"></a><span class='hs-definition'>isSynDecl</span> <span class='hs-sel'>_other</span>        <span class='hs-keyglyph'>=</span> <span class='hs-conid'>False</span>
<a name="line-525"></a>
<a name="line-526"></a><a name="isClassDecl"></a><span class='hs-comment'>-- | type class</span>
<a name="line-527"></a><span class='hs-definition'>isClassDecl</span> <span class='hs-keyglyph'>::</span> <span class='hs-conid'>TyClDecl</span> <span class='hs-varid'>pass</span> <span class='hs-keyglyph'>-&gt;</span> <span class='hs-conid'>Bool</span>
<a name="line-528"></a><span class='hs-definition'>isClassDecl</span> <span class='hs-layout'>(</span><span class='hs-conid'>ClassDecl</span> <span class='hs-layout'>{</span><span class='hs-layout'>}</span><span class='hs-layout'>)</span> <span class='hs-keyglyph'>=</span> <span class='hs-conid'>True</span>
<a name="line-529"></a><span class='hs-definition'>isClassDecl</span> <span class='hs-keyword'>_</span>              <span class='hs-keyglyph'>=</span> <span class='hs-conid'>False</span>
<a name="line-530"></a>
<a name="line-531"></a><a name="isFamilyDecl"></a><span class='hs-comment'>-- | type/data family declaration</span>
<a name="line-532"></a><span class='hs-definition'>isFamilyDecl</span> <span class='hs-keyglyph'>::</span> <span class='hs-conid'>TyClDecl</span> <span class='hs-varid'>pass</span> <span class='hs-keyglyph'>-&gt;</span> <span class='hs-conid'>Bool</span>
<a name="line-533"></a><span class='hs-definition'>isFamilyDecl</span> <span class='hs-layout'>(</span><span class='hs-conid'>FamDecl</span> <span class='hs-layout'>{</span><span class='hs-layout'>}</span><span class='hs-layout'>)</span>  <span class='hs-keyglyph'>=</span> <span class='hs-conid'>True</span>
<a name="line-534"></a><span class='hs-definition'>isFamilyDecl</span> <span class='hs-sel'>_other</span>        <span class='hs-keyglyph'>=</span> <span class='hs-conid'>False</span>
<a name="line-535"></a>
<a name="line-536"></a><a name="isTypeFamilyDecl"></a><span class='hs-comment'>-- | type family declaration</span>
<a name="line-537"></a><span class='hs-definition'>isTypeFamilyDecl</span> <span class='hs-keyglyph'>::</span> <span class='hs-conid'>TyClDecl</span> <span class='hs-varid'>pass</span> <span class='hs-keyglyph'>-&gt;</span> <span class='hs-conid'>Bool</span>
<a name="line-538"></a><span class='hs-definition'>isTypeFamilyDecl</span> <span class='hs-layout'>(</span><span class='hs-conid'>FamDecl</span> <span class='hs-keyword'>_</span> <span class='hs-layout'>(</span><span class='hs-conid'>FamilyDecl</span> <span class='hs-layout'>{</span> <span class='hs-varid'>fdInfo</span> <span class='hs-keyglyph'>=</span> <span class='hs-varid'>info</span> <span class='hs-layout'>}</span><span class='hs-layout'>)</span><span class='hs-layout'>)</span> <span class='hs-keyglyph'>=</span> <span class='hs-keyword'>case</span> <span class='hs-varid'>info</span> <span class='hs-keyword'>of</span>
<a name="line-539"></a>  <span class='hs-conid'>OpenTypeFamily</span>      <span class='hs-keyglyph'>-&gt;</span> <span class='hs-conid'>True</span>
<a name="line-540"></a>  <span class='hs-conid'>ClosedTypeFamily</span> <span class='hs-layout'>{</span><span class='hs-layout'>}</span> <span class='hs-keyglyph'>-&gt;</span> <span class='hs-conid'>True</span>
<a name="line-541"></a>  <span class='hs-keyword'>_</span>                   <span class='hs-keyglyph'>-&gt;</span> <span class='hs-conid'>False</span>
<a name="line-542"></a><span class='hs-definition'>isTypeFamilyDecl</span> <span class='hs-keyword'>_</span> <span class='hs-keyglyph'>=</span> <span class='hs-conid'>False</span>
<a name="line-543"></a>
<a name="line-544"></a><a name="isOpenTypeFamilyInfo"></a><span class='hs-comment'>-- | open type family info</span>
<a name="line-545"></a><span class='hs-definition'>isOpenTypeFamilyInfo</span> <span class='hs-keyglyph'>::</span> <span class='hs-conid'>FamilyInfo</span> <span class='hs-varid'>pass</span> <span class='hs-keyglyph'>-&gt;</span> <span class='hs-conid'>Bool</span>
<a name="line-546"></a><span class='hs-definition'>isOpenTypeFamilyInfo</span> <span class='hs-conid'>OpenTypeFamily</span> <span class='hs-keyglyph'>=</span> <span class='hs-conid'>True</span>
<a name="line-547"></a><span class='hs-definition'>isOpenTypeFamilyInfo</span> <span class='hs-keyword'>_</span>              <span class='hs-keyglyph'>=</span> <span class='hs-conid'>False</span>
<a name="line-548"></a>
<a name="line-549"></a><a name="isClosedTypeFamilyInfo"></a><span class='hs-comment'>-- | closed type family info</span>
<a name="line-550"></a><span class='hs-definition'>isClosedTypeFamilyInfo</span> <span class='hs-keyglyph'>::</span> <span class='hs-conid'>FamilyInfo</span> <span class='hs-varid'>pass</span> <span class='hs-keyglyph'>-&gt;</span> <span class='hs-conid'>Bool</span>
<a name="line-551"></a><span class='hs-definition'>isClosedTypeFamilyInfo</span> <span class='hs-layout'>(</span><span class='hs-conid'>ClosedTypeFamily</span> <span class='hs-layout'>{</span><span class='hs-layout'>}</span><span class='hs-layout'>)</span> <span class='hs-keyglyph'>=</span> <span class='hs-conid'>True</span>
<a name="line-552"></a><span class='hs-definition'>isClosedTypeFamilyInfo</span> <span class='hs-keyword'>_</span>                     <span class='hs-keyglyph'>=</span> <span class='hs-conid'>False</span>
<a name="line-553"></a>
<a name="line-554"></a><a name="isDataFamilyDecl"></a><span class='hs-comment'>-- | data family declaration</span>
<a name="line-555"></a><span class='hs-definition'>isDataFamilyDecl</span> <span class='hs-keyglyph'>::</span> <span class='hs-conid'>TyClDecl</span> <span class='hs-varid'>pass</span> <span class='hs-keyglyph'>-&gt;</span> <span class='hs-conid'>Bool</span>
<a name="line-556"></a><span class='hs-definition'>isDataFamilyDecl</span> <span class='hs-layout'>(</span><span class='hs-conid'>FamDecl</span> <span class='hs-keyword'>_</span> <span class='hs-layout'>(</span><span class='hs-conid'>FamilyDecl</span> <span class='hs-layout'>{</span> <span class='hs-varid'>fdInfo</span> <span class='hs-keyglyph'>=</span> <span class='hs-conid'>DataFamily</span> <span class='hs-layout'>}</span><span class='hs-layout'>)</span><span class='hs-layout'>)</span> <span class='hs-keyglyph'>=</span> <span class='hs-conid'>True</span>
<a name="line-557"></a><span class='hs-definition'>isDataFamilyDecl</span> <span class='hs-sel'>_other</span>      <span class='hs-keyglyph'>=</span> <span class='hs-conid'>False</span>
<a name="line-558"></a>
<a name="line-559"></a><span class='hs-comment'>-- Dealing with names</span>
<a name="line-560"></a>
<a name="line-561"></a><a name="tyClDeclTyVars"></a><span class='hs-definition'>tyClDeclTyVars</span> <span class='hs-keyglyph'>::</span> <span class='hs-conid'>TyClDecl</span> <span class='hs-varid'>pass</span> <span class='hs-keyglyph'>-&gt;</span> <span class='hs-conid'>LHsQTyVars</span> <span class='hs-varid'>pass</span>
<a name="line-562"></a><span class='hs-definition'>tyClDeclTyVars</span> <span class='hs-layout'>(</span><span class='hs-conid'>FamDecl</span> <span class='hs-layout'>{</span> <span class='hs-varid'>tcdFam</span> <span class='hs-keyglyph'>=</span> <span class='hs-conid'>FamilyDecl</span> <span class='hs-layout'>{</span> <span class='hs-varid'>fdTyVars</span> <span class='hs-keyglyph'>=</span> <span class='hs-varid'>tvs</span> <span class='hs-layout'>}</span> <span class='hs-layout'>}</span><span class='hs-layout'>)</span> <span class='hs-keyglyph'>=</span> <span class='hs-varid'>tvs</span>
<a name="line-563"></a><span class='hs-definition'>tyClDeclTyVars</span> <span class='hs-varid'>d</span> <span class='hs-keyglyph'>=</span> <span class='hs-varid'>tcdTyVars</span> <span class='hs-varid'>d</span>
<a name="line-564"></a>
<a name="line-565"></a><a name="countTyClDecls"></a><span class='hs-definition'>countTyClDecls</span> <span class='hs-keyglyph'>::</span> <span class='hs-keyglyph'>[</span><span class='hs-conid'>TyClDecl</span> <span class='hs-varid'>pass</span><span class='hs-keyglyph'>]</span> <span class='hs-keyglyph'>-&gt;</span> <span class='hs-layout'>(</span><span class='hs-conid'>Int</span><span class='hs-layout'>,</span> <span class='hs-conid'>Int</span><span class='hs-layout'>,</span> <span class='hs-conid'>Int</span><span class='hs-layout'>,</span> <span class='hs-conid'>Int</span><span class='hs-layout'>,</span> <span class='hs-conid'>Int</span><span class='hs-layout'>)</span>
<a name="line-566"></a>        <span class='hs-comment'>-- class, synonym decls, data, newtype, family decls</span>
<a name="line-567"></a><span class='hs-definition'>countTyClDecls</span> <span class='hs-varid'>decls</span>
<a name="line-568"></a> <span class='hs-keyglyph'>=</span> <span class='hs-layout'>(</span><span class='hs-varid'>count</span> <span class='hs-varid'>isClassDecl</span>    <span class='hs-varid'>decls</span><span class='hs-layout'>,</span>
<a name="line-569"></a>    <span class='hs-varid'>count</span> <span class='hs-varid'>isSynDecl</span>      <span class='hs-varid'>decls</span><span class='hs-layout'>,</span>  <span class='hs-comment'>-- excluding...</span>
<a name="line-570"></a>    <span class='hs-varid'>count</span> <span class='hs-varid'>isDataTy</span>       <span class='hs-varid'>decls</span><span class='hs-layout'>,</span>  <span class='hs-comment'>-- ...family...</span>
<a name="line-571"></a>    <span class='hs-varid'>count</span> <span class='hs-varid'>isNewTy</span>        <span class='hs-varid'>decls</span><span class='hs-layout'>,</span>  <span class='hs-comment'>-- ...instances</span>
<a name="line-572"></a>    <span class='hs-varid'>count</span> <span class='hs-varid'>isFamilyDecl</span>   <span class='hs-varid'>decls</span><span class='hs-layout'>)</span>
<a name="line-573"></a> <span class='hs-keyword'>where</span>
<a name="line-574"></a>   <span class='hs-varid'>isDataTy</span> <span class='hs-conid'>DataDecl</span><span class='hs-layout'>{</span> <span class='hs-varid'>tcdDataDefn</span> <span class='hs-keyglyph'>=</span> <span class='hs-conid'>HsDataDefn</span> <span class='hs-layout'>{</span> <span class='hs-varid'>dd_ND</span> <span class='hs-keyglyph'>=</span> <span class='hs-conid'>DataType</span> <span class='hs-layout'>}</span> <span class='hs-layout'>}</span> <span class='hs-keyglyph'>=</span> <span class='hs-conid'>True</span>
<a name="line-575"></a>   <span class='hs-varid'>isDataTy</span> <span class='hs-keyword'>_</span>                                                       <span class='hs-keyglyph'>=</span> <span class='hs-conid'>False</span>
<a name="line-576"></a>
<a name="line-577"></a>   <span class='hs-varid'>isNewTy</span> <span class='hs-conid'>DataDecl</span><span class='hs-layout'>{</span> <span class='hs-varid'>tcdDataDefn</span> <span class='hs-keyglyph'>=</span> <span class='hs-conid'>HsDataDefn</span> <span class='hs-layout'>{</span> <span class='hs-varid'>dd_ND</span> <span class='hs-keyglyph'>=</span> <span class='hs-conid'>NewType</span> <span class='hs-layout'>}</span> <span class='hs-layout'>}</span> <span class='hs-keyglyph'>=</span> <span class='hs-conid'>True</span>
<a name="line-578"></a>   <span class='hs-varid'>isNewTy</span> <span class='hs-keyword'>_</span>                                                      <span class='hs-keyglyph'>=</span> <span class='hs-conid'>False</span>
<a name="line-579"></a>
<a name="line-580"></a>
<a name="line-581"></a><span class='hs-comment'>{- Note [CUSKs: complete user-supplied kind signatures]
<a name="line-582"></a>~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~
<a name="line-583"></a>We kind-check declarations differently if they have a complete, user-supplied
<a name="line-584"></a>kind signature (CUSK). This is because we can safely generalise a CUSKed
<a name="line-585"></a>declaration before checking all of the others, supporting polymorphic recursion.
<a name="line-586"></a>See https://gitlab.haskell.org/ghc/ghc/wikis/ghc-kinds/kind-inference#proposed-new-strategy
<a name="line-587"></a>and #9200 for lots of discussion of how we got here.
<a name="line-588"></a>
<a name="line-589"></a>The detection of CUSKs is enabled by the -XCUSKs extension, switched on by default.
<a name="line-590"></a>Under -XNoCUSKs, all declarations are treated as if they have no CUSK.
<a name="line-591"></a>See https://github.com/ghc-proposals/ghc-proposals/blob/master/proposals/0036-kind-signatures.rst
<a name="line-592"></a>
<a name="line-593"></a>PRINCIPLE:
<a name="line-594"></a>  a type declaration has a CUSK iff we could produce a separate kind signature
<a name="line-595"></a>  for it, just like a type signature for a function,
<a name="line-596"></a>  looking only at the header of the declaration.
<a name="line-597"></a>
<a name="line-598"></a>Examples:
<a name="line-599"></a>  * data T1 (a :: *-&gt;*) (b :: *) = ....
<a name="line-600"></a>    -- Has CUSK; equivalant to   T1 :: (*-&gt;*) -&gt; * -&gt; *
<a name="line-601"></a>
<a name="line-602"></a> * data T2 a b = ...
<a name="line-603"></a>   -- No CUSK; we do not want to guess T2 :: * -&gt; * -&gt; *
<a name="line-604"></a>   -- because the full decl might be   data T a b = MkT (a b)
<a name="line-605"></a>
<a name="line-606"></a>  * data T3 (a :: k -&gt; *) (b :: *) = ...
<a name="line-607"></a>    -- CUSK; equivalent to   T3 :: (k -&gt; *) -&gt; * -&gt; *
<a name="line-608"></a>    -- We lexically generalise over k to get
<a name="line-609"></a>    --    T3 :: forall k. (k -&gt; *) -&gt; * -&gt; *
<a name="line-610"></a>    -- The generalisation is here is purely lexical, just like
<a name="line-611"></a>    --    f3 :: a -&gt; a
<a name="line-612"></a>    -- means
<a name="line-613"></a>    --    f3 :: forall a. a -&gt; a
<a name="line-614"></a>
<a name="line-615"></a>  * data T4 (a :: j k) = ...
<a name="line-616"></a>     -- CUSK; equivalent to   T4 :: j k -&gt; *
<a name="line-617"></a>     -- which we lexically generalise to  T4 :: forall j k. j k -&gt; *
<a name="line-618"></a>     -- and then, if PolyKinds is on, we further generalise to
<a name="line-619"></a>     --   T4 :: forall kk (j :: kk -&gt; *) (k :: kk). j k -&gt; *
<a name="line-620"></a>     -- Again this is exactly like what happens as the term level
<a name="line-621"></a>     -- when you write
<a name="line-622"></a>     --    f4 :: forall a b. a b -&gt; Int
<a name="line-623"></a>
<a name="line-624"></a>NOTE THAT
<a name="line-625"></a>  * A CUSK does /not/ mean that everything about the kind signature is
<a name="line-626"></a>    fully specified by the user.  Look at T4 and f4: we had to do kind
<a name="line-627"></a>    inference to figure out the kind-quantification.  But in both cases
<a name="line-628"></a>    (T4 and f4) that inference is done looking /only/ at the header of T4
<a name="line-629"></a>    (or signature for f4), not at the definition thereof.
<a name="line-630"></a>
<a name="line-631"></a>  * The CUSK completely fixes the kind of the type constructor, forever.
<a name="line-632"></a>
<a name="line-633"></a>  * The precise rules, for each declaration form, for whether a declaration
<a name="line-634"></a>    has a CUSK are given in the user manual section "Complete user-supplied
<a name="line-635"></a>    kind signatures and polymorphic recursion".  But they simply implement
<a name="line-636"></a>    PRINCIPLE above.
<a name="line-637"></a>
<a name="line-638"></a>  * Open type families are interesting:
<a name="line-639"></a>      type family T5 a b :: *
<a name="line-640"></a>    There simply /is/ no accompanying declaration, so that info is all
<a name="line-641"></a>    we'll ever get.  So we it has a CUSK by definition, and we default
<a name="line-642"></a>    any un-fixed kind variables to *.
<a name="line-643"></a>
<a name="line-644"></a>  * Associated types are a bit tricker:
<a name="line-645"></a>      class C6 a where
<a name="line-646"></a>         type family T6 a b :: *
<a name="line-647"></a>         op :: a Int -&gt; Int
<a name="line-648"></a>    Here C6 does not have a CUSK (in fact we ultimately discover that
<a name="line-649"></a>    a :: * -&gt; *).  And hence neither does T6, the associated family,
<a name="line-650"></a>    because we can't fix its kind until we have settled C6.  Another
<a name="line-651"></a>    way to say it: unlike a top-level, we /may/ discover more about
<a name="line-652"></a>    a's kind from C6's definition.
<a name="line-653"></a>
<a name="line-654"></a>  * A data definition with a top-level :: must explicitly bind all
<a name="line-655"></a>    kind variables to the right of the ::. See test
<a name="line-656"></a>    dependent/should_compile/KindLevels, which requires this
<a name="line-657"></a>    case. (Naturally, any kind variable mentioned before the :: should
<a name="line-658"></a>    not be bound after it.)
<a name="line-659"></a>
<a name="line-660"></a>    This last point is much more debatable than the others; see
<a name="line-661"></a>    #15142 comment:22
<a name="line-662"></a>
<a name="line-663"></a>    Because this is fiddly to check, there is a field in the DataDeclRn
<a name="line-664"></a>    structure (included in a DataDecl after the renamer) that stores whether
<a name="line-665"></a>    or not the declaration has a CUSK.
<a name="line-666"></a>-}</span>
<a name="line-667"></a>
<a name="line-668"></a>
<a name="line-669"></a><span class='hs-comment'>{- *********************************************************************
<a name="line-670"></a>*                                                                      *
<a name="line-671"></a>                         TyClGroup
<a name="line-672"></a>        Strongly connected components of
<a name="line-673"></a>      type, class, instance, and role declarations
<a name="line-674"></a>*                                                                      *
<a name="line-675"></a>********************************************************************* -}</span>
<a name="line-676"></a>
<a name="line-677"></a><span class='hs-comment'>{- Note [TyClGroups and dependency analysis]
<a name="line-678"></a>~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~
<a name="line-679"></a>A TyClGroup represents a strongly connected components of type/class/instance
<a name="line-680"></a>decls, together with the role annotations for the type/class declarations.
<a name="line-681"></a>
<a name="line-682"></a>The hs_tyclds :: [TyClGroup] field of a HsGroup is a dependency-order
<a name="line-683"></a>sequence of strongly-connected components.
<a name="line-684"></a>
<a name="line-685"></a>Invariants
<a name="line-686"></a> * The type and class declarations, group_tyclds, may depend on each
<a name="line-687"></a>   other, or earlier TyClGroups, but not on later ones
<a name="line-688"></a>
<a name="line-689"></a> * The role annotations, group_roles, are role-annotations for some or
<a name="line-690"></a>   all of the types and classes in group_tyclds (only).
<a name="line-691"></a>
<a name="line-692"></a> * The instance declarations, group_instds, may (and usually will)
<a name="line-693"></a>   depend on group_tyclds, or on earlier TyClGroups, but not on later
<a name="line-694"></a>   ones.
<a name="line-695"></a>
<a name="line-696"></a>See Note [Dependency analysis of type, class, and instance decls]
<a name="line-697"></a>in GHC.Rename.Module for more info.
<a name="line-698"></a>-}</span>
<a name="line-699"></a>
<a name="line-700"></a><a name="TyClGroup"></a><span class='hs-comment'>-- | Type or Class Group</span>
<a name="line-701"></a><a name="TyClGroup"></a><span class='hs-keyword'>data</span> <span class='hs-conid'>TyClGroup</span> <span class='hs-varid'>pass</span>  <span class='hs-comment'>-- See Note [TyClGroups and dependency analysis]</span>
<a name="line-702"></a>  <span class='hs-keyglyph'>=</span> <span class='hs-conid'>TyClGroup</span> <span class='hs-layout'>{</span> <span class='hs-varid'>group_ext</span>    <span class='hs-keyglyph'>::</span> <span class='hs-conid'>XCTyClGroup</span> <span class='hs-varid'>pass</span>
<a name="line-703"></a>              <span class='hs-layout'>,</span> <span class='hs-varid'>group_tyclds</span> <span class='hs-keyglyph'>::</span> <span class='hs-keyglyph'>[</span><span class='hs-conid'>LTyClDecl</span> <span class='hs-varid'>pass</span><span class='hs-keyglyph'>]</span>
<a name="line-704"></a>              <span class='hs-layout'>,</span> <span class='hs-varid'>group_roles</span>  <span class='hs-keyglyph'>::</span> <span class='hs-keyglyph'>[</span><span class='hs-conid'>LRoleAnnotDecl</span> <span class='hs-varid'>pass</span><span class='hs-keyglyph'>]</span>
<a name="line-705"></a>              <span class='hs-layout'>,</span> <span class='hs-varid'>group_kisigs</span> <span class='hs-keyglyph'>::</span> <span class='hs-keyglyph'>[</span><span class='hs-conid'>LStandaloneKindSig</span> <span class='hs-varid'>pass</span><span class='hs-keyglyph'>]</span>
<a name="line-706"></a>              <span class='hs-layout'>,</span> <span class='hs-varid'>group_instds</span> <span class='hs-keyglyph'>::</span> <span class='hs-keyglyph'>[</span><span class='hs-conid'>LInstDecl</span> <span class='hs-varid'>pass</span><span class='hs-keyglyph'>]</span> <span class='hs-layout'>}</span>
<a name="line-707"></a>  <span class='hs-keyglyph'>|</span> <span class='hs-conid'>XTyClGroup</span> <span class='hs-varop'>!</span><span class='hs-layout'>(</span><span class='hs-conid'>XXTyClGroup</span> <span class='hs-varid'>pass</span><span class='hs-layout'>)</span>
<a name="line-708"></a>
<a name="line-709"></a>
<a name="line-710"></a><a name="tyClGroupTyClDecls"></a><span class='hs-definition'>tyClGroupTyClDecls</span> <span class='hs-keyglyph'>::</span> <span class='hs-keyglyph'>[</span><span class='hs-conid'>TyClGroup</span> <span class='hs-varid'>pass</span><span class='hs-keyglyph'>]</span> <span class='hs-keyglyph'>-&gt;</span> <span class='hs-keyglyph'>[</span><span class='hs-conid'>LTyClDecl</span> <span class='hs-varid'>pass</span><span class='hs-keyglyph'>]</span>
<a name="line-711"></a><span class='hs-definition'>tyClGroupTyClDecls</span> <span class='hs-keyglyph'>=</span> <span class='hs-varid'>concatMap</span> <span class='hs-varid'>group_tyclds</span>
<a name="line-712"></a>
<a name="line-713"></a><a name="tyClGroupInstDecls"></a><span class='hs-definition'>tyClGroupInstDecls</span> <span class='hs-keyglyph'>::</span> <span class='hs-keyglyph'>[</span><span class='hs-conid'>TyClGroup</span> <span class='hs-varid'>pass</span><span class='hs-keyglyph'>]</span> <span class='hs-keyglyph'>-&gt;</span> <span class='hs-keyglyph'>[</span><span class='hs-conid'>LInstDecl</span> <span class='hs-varid'>pass</span><span class='hs-keyglyph'>]</span>
<a name="line-714"></a><span class='hs-definition'>tyClGroupInstDecls</span> <span class='hs-keyglyph'>=</span> <span class='hs-varid'>concatMap</span> <span class='hs-varid'>group_instds</span>
<a name="line-715"></a>
<a name="line-716"></a><a name="tyClGroupRoleDecls"></a><span class='hs-definition'>tyClGroupRoleDecls</span> <span class='hs-keyglyph'>::</span> <span class='hs-keyglyph'>[</span><span class='hs-conid'>TyClGroup</span> <span class='hs-varid'>pass</span><span class='hs-keyglyph'>]</span> <span class='hs-keyglyph'>-&gt;</span> <span class='hs-keyglyph'>[</span><span class='hs-conid'>LRoleAnnotDecl</span> <span class='hs-varid'>pass</span><span class='hs-keyglyph'>]</span>
<a name="line-717"></a><span class='hs-definition'>tyClGroupRoleDecls</span> <span class='hs-keyglyph'>=</span> <span class='hs-varid'>concatMap</span> <span class='hs-varid'>group_roles</span>
<a name="line-718"></a>
<a name="line-719"></a><a name="tyClGroupKindSigs"></a><span class='hs-definition'>tyClGroupKindSigs</span> <span class='hs-keyglyph'>::</span> <span class='hs-keyglyph'>[</span><span class='hs-conid'>TyClGroup</span> <span class='hs-varid'>pass</span><span class='hs-keyglyph'>]</span> <span class='hs-keyglyph'>-&gt;</span> <span class='hs-keyglyph'>[</span><span class='hs-conid'>LStandaloneKindSig</span> <span class='hs-varid'>pass</span><span class='hs-keyglyph'>]</span>
<a name="line-720"></a><span class='hs-definition'>tyClGroupKindSigs</span> <span class='hs-keyglyph'>=</span> <span class='hs-varid'>concatMap</span> <span class='hs-varid'>group_kisigs</span>
<a name="line-721"></a>
<a name="line-722"></a>
<a name="line-723"></a><span class='hs-comment'>{- *********************************************************************
<a name="line-724"></a>*                                                                      *
<a name="line-725"></a>               Data and type family declarations
<a name="line-726"></a>*                                                                      *
<a name="line-727"></a>********************************************************************* -}</span>
<a name="line-728"></a>
<a name="line-729"></a><span class='hs-comment'>{- Note [FamilyResultSig]
<a name="line-730"></a>~~~~~~~~~~~~~~~~~~~~~~~~~
<a name="line-731"></a>
<a name="line-732"></a>This data type represents the return signature of a type family.  Possible
<a name="line-733"></a>values are:
<a name="line-734"></a>
<a name="line-735"></a> * NoSig - the user supplied no return signature:
<a name="line-736"></a>      type family Id a where ...
<a name="line-737"></a>
<a name="line-738"></a> * KindSig - the user supplied the return kind:
<a name="line-739"></a>      type family Id a :: * where ...
<a name="line-740"></a>
<a name="line-741"></a> * TyVarSig - user named the result with a type variable and possibly
<a name="line-742"></a>   provided a kind signature for that variable:
<a name="line-743"></a>      type family Id a = r where ...
<a name="line-744"></a>      type family Id a = (r :: *) where ...
<a name="line-745"></a>
<a name="line-746"></a>   Naming result of a type family is required if we want to provide
<a name="line-747"></a>   injectivity annotation for a type family:
<a name="line-748"></a>      type family Id a = r | r -&gt; a where ...
<a name="line-749"></a>
<a name="line-750"></a>See also: Note [Injectivity annotation]
<a name="line-751"></a>
<a name="line-752"></a>Note [Injectivity annotation]
<a name="line-753"></a>~~~~~~~~~~~~~~~~~~~~~~~~~~~~~
<a name="line-754"></a>
<a name="line-755"></a>A user can declare a type family to be injective:
<a name="line-756"></a>
<a name="line-757"></a>   type family Id a = r | r -&gt; a where ...
<a name="line-758"></a>
<a name="line-759"></a> * The part after the "|" is called "injectivity annotation".
<a name="line-760"></a> * "r -&gt; a" part is called "injectivity condition"; at the moment terms
<a name="line-761"></a>   "injectivity annotation" and "injectivity condition" are synonymous
<a name="line-762"></a>   because we only allow a single injectivity condition.
<a name="line-763"></a> * "r" is the "LHS of injectivity condition". LHS can only contain the
<a name="line-764"></a>   variable naming the result of a type family.
<a name="line-765"></a>
<a name="line-766"></a> * "a" is the "RHS of injectivity condition". RHS contains space-separated
<a name="line-767"></a>   type and kind variables representing the arguments of a type
<a name="line-768"></a>   family. Variables can be omitted if a type family is not injective in
<a name="line-769"></a>   these arguments. Example:
<a name="line-770"></a>         type family Foo a b c = d | d -&gt; a c where ...
<a name="line-771"></a>
<a name="line-772"></a>Note that:
<a name="line-773"></a> (a) naming of type family result is required to provide injectivity
<a name="line-774"></a>     annotation
<a name="line-775"></a> (b) for associated types if the result was named then injectivity annotation
<a name="line-776"></a>     is mandatory. Otherwise result type variable is indistinguishable from
<a name="line-777"></a>     associated type default.
<a name="line-778"></a>
<a name="line-779"></a>It is possible that in the future this syntax will be extended to support
<a name="line-780"></a>more complicated injectivity annotations. For example we could declare that
<a name="line-781"></a>if we know the result of Plus and one of its arguments we can determine the
<a name="line-782"></a>other argument:
<a name="line-783"></a>
<a name="line-784"></a>   type family Plus a b = (r :: Nat) | r a -&gt; b, r b -&gt; a where ...
<a name="line-785"></a>
<a name="line-786"></a>Here injectivity annotation would consist of two comma-separated injectivity
<a name="line-787"></a>conditions.
<a name="line-788"></a>
<a name="line-789"></a>See also Note [Injective type families] in GHC.Core.TyCon
<a name="line-790"></a>-}</span>
<a name="line-791"></a>
<a name="line-792"></a><a name="LFamilyResultSig"></a><span class='hs-comment'>-- | Located type Family Result Signature</span>
<a name="line-793"></a><a name="LFamilyResultSig"></a><span class='hs-keyword'>type</span> <span class='hs-conid'>LFamilyResultSig</span> <span class='hs-varid'>pass</span> <span class='hs-keyglyph'>=</span> <span class='hs-conid'>XRec</span> <span class='hs-varid'>pass</span> <span class='hs-layout'>(</span><span class='hs-conid'>FamilyResultSig</span> <span class='hs-varid'>pass</span><span class='hs-layout'>)</span>
<a name="line-794"></a>
<a name="line-795"></a><a name="FamilyResultSig"></a><span class='hs-comment'>-- | type Family Result Signature</span>
<a name="line-796"></a><a name="FamilyResultSig"></a><span class='hs-keyword'>data</span> <span class='hs-conid'>FamilyResultSig</span> <span class='hs-varid'>pass</span> <span class='hs-keyglyph'>=</span> <span class='hs-comment'>-- see Note [FamilyResultSig]</span>
<a name="line-797"></a>    <span class='hs-conid'>NoSig</span> <span class='hs-layout'>(</span><span class='hs-conid'>XNoSig</span> <span class='hs-varid'>pass</span><span class='hs-layout'>)</span>
<a name="line-798"></a>  <span class='hs-comment'>-- ^ - 'GHC.Parser.Annotation.AnnKeywordId' :</span>
<a name="line-799"></a>
<a name="line-800"></a>  <span class='hs-comment'>-- For details on above see note [exact print annotations] in GHC.Parser.Annotation</span>
<a name="line-801"></a>
<a name="line-802"></a>  <span class='hs-keyglyph'>|</span> <span class='hs-conid'>KindSig</span>  <span class='hs-layout'>(</span><span class='hs-conid'>XCKindSig</span> <span class='hs-varid'>pass</span><span class='hs-layout'>)</span> <span class='hs-layout'>(</span><span class='hs-conid'>LHsKind</span> <span class='hs-varid'>pass</span><span class='hs-layout'>)</span>
<a name="line-803"></a>  <span class='hs-comment'>-- ^ - 'GHC.Parser.Annotation.AnnKeywordId' :</span>
<a name="line-804"></a>  <span class='hs-comment'>--             'GHC.Parser.Annotation.AnnOpenP','GHC.Parser.Annotation.AnnDcolon',</span>
<a name="line-805"></a>  <span class='hs-comment'>--             'GHC.Parser.Annotation.AnnCloseP'</span>
<a name="line-806"></a>
<a name="line-807"></a>  <span class='hs-comment'>-- For details on above see note [exact print annotations] in GHC.Parser.Annotation</span>
<a name="line-808"></a>
<a name="line-809"></a>  <span class='hs-keyglyph'>|</span> <span class='hs-conid'>TyVarSig</span> <span class='hs-layout'>(</span><span class='hs-conid'>XTyVarSig</span> <span class='hs-varid'>pass</span><span class='hs-layout'>)</span> <span class='hs-layout'>(</span><span class='hs-conid'>LHsTyVarBndr</span> <span class='hs-conid'>()</span> <span class='hs-varid'>pass</span><span class='hs-layout'>)</span>
<a name="line-810"></a>  <span class='hs-comment'>-- ^ - 'GHC.Parser.Annotation.AnnKeywordId' :</span>
<a name="line-811"></a>  <span class='hs-comment'>--             'GHC.Parser.Annotation.AnnOpenP','GHC.Parser.Annotation.AnnDcolon',</span>
<a name="line-812"></a>  <span class='hs-comment'>--             'GHC.Parser.Annotation.AnnCloseP', 'GHC.Parser.Annotation.AnnEqual'</span>
<a name="line-813"></a>  <span class='hs-keyglyph'>|</span> <span class='hs-conid'>XFamilyResultSig</span> <span class='hs-varop'>!</span><span class='hs-layout'>(</span><span class='hs-conid'>XXFamilyResultSig</span> <span class='hs-varid'>pass</span><span class='hs-layout'>)</span>
<a name="line-814"></a>
<a name="line-815"></a>  <span class='hs-comment'>-- For details on above see note [exact print annotations] in GHC.Parser.Annotation</span>
<a name="line-816"></a>
<a name="line-817"></a>
<a name="line-818"></a><a name="LFamilyDecl"></a><span class='hs-comment'>-- | Located type Family Declaration</span>
<a name="line-819"></a><a name="LFamilyDecl"></a><span class='hs-keyword'>type</span> <span class='hs-conid'>LFamilyDecl</span> <span class='hs-varid'>pass</span> <span class='hs-keyglyph'>=</span> <span class='hs-conid'>XRec</span> <span class='hs-varid'>pass</span> <span class='hs-layout'>(</span><span class='hs-conid'>FamilyDecl</span> <span class='hs-varid'>pass</span><span class='hs-layout'>)</span>
<a name="line-820"></a>
<a name="line-821"></a><a name="FamilyDecl"></a><span class='hs-comment'>-- | type Family Declaration</span>
<a name="line-822"></a><a name="FamilyDecl"></a><span class='hs-keyword'>data</span> <span class='hs-conid'>FamilyDecl</span> <span class='hs-varid'>pass</span> <span class='hs-keyglyph'>=</span> <span class='hs-conid'>FamilyDecl</span>
<a name="line-823"></a>  <span class='hs-layout'>{</span> <span class='hs-varid'>fdExt</span>            <span class='hs-keyglyph'>::</span> <span class='hs-conid'>XCFamilyDecl</span> <span class='hs-varid'>pass</span>
<a name="line-824"></a>  <span class='hs-layout'>,</span> <span class='hs-varid'>fdInfo</span>           <span class='hs-keyglyph'>::</span> <span class='hs-conid'>FamilyInfo</span> <span class='hs-varid'>pass</span>              <span class='hs-comment'>-- type/data, closed/open</span>
<a name="line-825"></a>  <span class='hs-layout'>,</span> <span class='hs-varid'>fdTopLevel</span>       <span class='hs-keyglyph'>::</span> <span class='hs-conid'>TopLevelFlag</span>                 <span class='hs-comment'>-- used for printing only</span>
<a name="line-826"></a>  <span class='hs-layout'>,</span> <span class='hs-varid'>fdLName</span>          <span class='hs-keyglyph'>::</span> <span class='hs-conid'>LIdP</span> <span class='hs-varid'>pass</span>                    <span class='hs-comment'>-- type constructor</span>
<a name="line-827"></a>  <span class='hs-layout'>,</span> <span class='hs-varid'>fdTyVars</span>         <span class='hs-keyglyph'>::</span> <span class='hs-conid'>LHsQTyVars</span> <span class='hs-varid'>pass</span>              <span class='hs-comment'>-- type variables</span>
<a name="line-828"></a>                       <span class='hs-comment'>-- See Note [TyVar binders for associated declarations]</span>
<a name="line-829"></a>  <span class='hs-layout'>,</span> <span class='hs-varid'>fdFixity</span>         <span class='hs-keyglyph'>::</span> <span class='hs-conid'>LexicalFixity</span>                <span class='hs-comment'>-- Fixity used in the declaration</span>
<a name="line-830"></a>  <span class='hs-layout'>,</span> <span class='hs-varid'>fdResultSig</span>      <span class='hs-keyglyph'>::</span> <span class='hs-conid'>LFamilyResultSig</span> <span class='hs-varid'>pass</span>        <span class='hs-comment'>-- result signature</span>
<a name="line-831"></a>  <span class='hs-layout'>,</span> <span class='hs-varid'>fdInjectivityAnn</span> <span class='hs-keyglyph'>::</span> <span class='hs-conid'>Maybe</span> <span class='hs-layout'>(</span><span class='hs-conid'>LInjectivityAnn</span> <span class='hs-varid'>pass</span><span class='hs-layout'>)</span> <span class='hs-comment'>-- optional injectivity ann</span>
<a name="line-832"></a>  <span class='hs-layout'>}</span>
<a name="line-833"></a>  <span class='hs-keyglyph'>|</span> <span class='hs-conid'>XFamilyDecl</span> <span class='hs-varop'>!</span><span class='hs-layout'>(</span><span class='hs-conid'>XXFamilyDecl</span> <span class='hs-varid'>pass</span><span class='hs-layout'>)</span>
<a name="line-834"></a>  <span class='hs-comment'>-- ^ - 'GHC.Parser.Annotation.AnnKeywordId' : 'GHC.Parser.Annotation.AnnType',</span>
<a name="line-835"></a>  <span class='hs-comment'>--             'GHC.Parser.Annotation.AnnData', 'GHC.Parser.Annotation.AnnFamily',</span>
<a name="line-836"></a>  <span class='hs-comment'>--             'GHC.Parser.Annotation.AnnWhere', 'GHC.Parser.Annotation.AnnOpenP',</span>
<a name="line-837"></a>  <span class='hs-comment'>--             'GHC.Parser.Annotation.AnnDcolon', 'GHC.Parser.Annotation.AnnCloseP',</span>
<a name="line-838"></a>  <span class='hs-comment'>--             'GHC.Parser.Annotation.AnnEqual', 'GHC.Parser.Annotation.AnnRarrow',</span>
<a name="line-839"></a>  <span class='hs-comment'>--             'GHC.Parser.Annotation.AnnVbar'</span>
<a name="line-840"></a>
<a name="line-841"></a>  <span class='hs-comment'>-- For details on above see note [exact print annotations] in GHC.Parser.Annotation</span>
<a name="line-842"></a>
<a name="line-843"></a>
<a name="line-844"></a><a name="LInjectivityAnn"></a><span class='hs-comment'>-- | Located Injectivity Annotation</span>
<a name="line-845"></a><a name="LInjectivityAnn"></a><span class='hs-keyword'>type</span> <span class='hs-conid'>LInjectivityAnn</span> <span class='hs-varid'>pass</span> <span class='hs-keyglyph'>=</span> <span class='hs-conid'>XRec</span> <span class='hs-varid'>pass</span> <span class='hs-layout'>(</span><span class='hs-conid'>InjectivityAnn</span> <span class='hs-varid'>pass</span><span class='hs-layout'>)</span>
<a name="line-846"></a>
<a name="line-847"></a><a name="InjectivityAnn"></a><span class='hs-comment'>-- | If the user supplied an injectivity annotation it is represented using</span>
<a name="line-848"></a><a name="InjectivityAnn"></a><span class='hs-comment'>-- InjectivityAnn. At the moment this is a single injectivity condition - see</span>
<a name="line-849"></a><a name="InjectivityAnn"></a><span class='hs-comment'>-- Note [Injectivity annotation]. `Located name` stores the LHS of injectivity</span>
<a name="line-850"></a><a name="InjectivityAnn"></a><span class='hs-comment'>-- condition. `[Located name]` stores the RHS of injectivity condition. Example:</span>
<a name="line-851"></a><a name="InjectivityAnn"></a><span class='hs-comment'>--</span>
<a name="line-852"></a><a name="InjectivityAnn"></a><span class='hs-comment'>--   type family Foo a b c = r | r -&gt; a c where ...</span>
<a name="line-853"></a><a name="InjectivityAnn"></a><span class='hs-comment'>--</span>
<a name="line-854"></a><a name="InjectivityAnn"></a><span class='hs-comment'>-- This will be represented as "InjectivityAnn `r` [`a`, `c`]"</span>
<a name="line-855"></a><a name="InjectivityAnn"></a><span class='hs-keyword'>data</span> <span class='hs-conid'>InjectivityAnn</span> <span class='hs-varid'>pass</span>
<a name="line-856"></a>  <span class='hs-keyglyph'>=</span> <span class='hs-conid'>InjectivityAnn</span> <span class='hs-layout'>(</span><span class='hs-conid'>XCInjectivityAnn</span> <span class='hs-varid'>pass</span><span class='hs-layout'>)</span>
<a name="line-857"></a>                   <span class='hs-layout'>(</span><span class='hs-conid'>LIdP</span> <span class='hs-varid'>pass</span><span class='hs-layout'>)</span> <span class='hs-keyglyph'>[</span><span class='hs-conid'>LIdP</span> <span class='hs-varid'>pass</span><span class='hs-keyglyph'>]</span>
<a name="line-858"></a>  <span class='hs-comment'>-- ^ - 'GHC.Parser.Annotation.AnnKeywordId' :</span>
<a name="line-859"></a>  <span class='hs-comment'>--             'GHC.Parser.Annotation.AnnRarrow', 'GHC.Parser.Annotation.AnnVbar'</span>
<a name="line-860"></a>
<a name="line-861"></a>  <span class='hs-comment'>-- For details on above see note [exact print annotations] in GHC.Parser.Annotation</span>
<a name="line-862"></a>  <span class='hs-keyglyph'>|</span> <span class='hs-conid'>XInjectivityAnn</span> <span class='hs-varop'>!</span><span class='hs-layout'>(</span><span class='hs-conid'>XXInjectivityAnn</span> <span class='hs-varid'>pass</span><span class='hs-layout'>)</span>
<a name="line-863"></a>
<a name="line-864"></a><a name="FamilyInfo"></a><span class='hs-keyword'>data</span> <span class='hs-conid'>FamilyInfo</span> <span class='hs-varid'>pass</span>
<a name="line-865"></a>  <span class='hs-keyglyph'>=</span> <span class='hs-conid'>DataFamily</span>
<a name="line-866"></a>  <span class='hs-keyglyph'>|</span> <span class='hs-conid'>OpenTypeFamily</span>
<a name="line-867"></a>     <span class='hs-comment'>-- | 'Nothing' if we're in an hs-boot file and the user</span>
<a name="line-868"></a>     <span class='hs-comment'>-- said "type family Foo x where .."</span>
<a name="line-869"></a>  <span class='hs-keyglyph'>|</span> <span class='hs-conid'>ClosedTypeFamily</span> <span class='hs-layout'>(</span><span class='hs-conid'>Maybe</span> <span class='hs-keyglyph'>[</span><span class='hs-conid'>LTyFamInstEqn</span> <span class='hs-varid'>pass</span><span class='hs-keyglyph'>]</span><span class='hs-layout'>)</span>
<a name="line-870"></a>
<a name="line-871"></a>
<a name="line-872"></a><span class='hs-comment'>------------- Pretty printing FamilyDecls -----------</span>
<a name="line-873"></a>
<a name="line-874"></a><a name="pprFlavour"></a><span class='hs-definition'>pprFlavour</span> <span class='hs-keyglyph'>::</span> <span class='hs-conid'>FamilyInfo</span> <span class='hs-varid'>pass</span> <span class='hs-keyglyph'>-&gt;</span> <span class='hs-conid'>SDoc</span>
<a name="line-875"></a><span class='hs-definition'>pprFlavour</span> <span class='hs-conid'>DataFamily</span>            <span class='hs-keyglyph'>=</span> <span class='hs-varid'>text</span> <span class='hs-str'>"data"</span>
<a name="line-876"></a><span class='hs-definition'>pprFlavour</span> <span class='hs-conid'>OpenTypeFamily</span>        <span class='hs-keyglyph'>=</span> <span class='hs-varid'>text</span> <span class='hs-str'>"type"</span>
<a name="line-877"></a><span class='hs-definition'>pprFlavour</span> <span class='hs-layout'>(</span><span class='hs-conid'>ClosedTypeFamily</span> <span class='hs-layout'>{</span><span class='hs-layout'>}</span><span class='hs-layout'>)</span> <span class='hs-keyglyph'>=</span> <span class='hs-varid'>text</span> <span class='hs-str'>"type"</span>
<a name="line-878"></a>
<a name="line-879"></a><a name="instance%20Outputable%20(FamilyInfo%20pass)"></a><span class='hs-keyword'>instance</span> <span class='hs-conid'>Outputable</span> <span class='hs-layout'>(</span><span class='hs-conid'>FamilyInfo</span> <span class='hs-varid'>pass</span><span class='hs-layout'>)</span> <span class='hs-keyword'>where</span>
<a name="line-880"></a>  <span class='hs-varid'>ppr</span> <span class='hs-varid'>info</span> <span class='hs-keyglyph'>=</span> <span class='hs-varid'>pprFlavour</span> <span class='hs-varid'>info</span> <span class='hs-varop'>&lt;+&gt;</span> <span class='hs-varid'>text</span> <span class='hs-str'>"family"</span>
<a name="line-881"></a>
<a name="line-882"></a>
<a name="line-883"></a>
<a name="line-884"></a><span class='hs-comment'>{- *********************************************************************
<a name="line-885"></a>*                                                                      *
<a name="line-886"></a>               Data types and data constructors
<a name="line-887"></a>*                                                                      *
<a name="line-888"></a>********************************************************************* -}</span>
<a name="line-889"></a>
<a name="line-890"></a><a name="HsDataDefn"></a><span class='hs-comment'>-- | Haskell Data type Definition</span>
<a name="line-891"></a><a name="HsDataDefn"></a><span class='hs-keyword'>data</span> <span class='hs-conid'>HsDataDefn</span> <span class='hs-varid'>pass</span>   <span class='hs-comment'>-- The payload of a data type defn</span>
<a name="line-892"></a>                       <span class='hs-comment'>-- Used *both* for vanilla data declarations,</span>
<a name="line-893"></a>                       <span class='hs-comment'>--       *and* for data family instances</span>
<a name="line-894"></a>  <span class='hs-keyglyph'>=</span> <span class='hs-comment'>-- | Declares a data type or newtype, giving its constructors</span>
<a name="line-895"></a>    <span class='hs-comment'>-- @</span>
<a name="line-896"></a>    <span class='hs-comment'>--  data/newtype T a = &lt;constrs&gt;</span>
<a name="line-897"></a>    <span class='hs-comment'>--  data/newtype instance T [a] = &lt;constrs&gt;</span>
<a name="line-898"></a>    <span class='hs-comment'>-- @</span>
<a name="line-899"></a>    <span class='hs-conid'>HsDataDefn</span> <span class='hs-layout'>{</span> <span class='hs-varid'>dd_ext</span>    <span class='hs-keyglyph'>::</span> <span class='hs-conid'>XCHsDataDefn</span> <span class='hs-varid'>pass</span><span class='hs-layout'>,</span>
<a name="line-900"></a>                 <span class='hs-varid'>dd_ND</span>     <span class='hs-keyglyph'>::</span> <span class='hs-conid'>NewOrData</span><span class='hs-layout'>,</span>
<a name="line-901"></a>                 <span class='hs-varid'>dd_ctxt</span>   <span class='hs-keyglyph'>::</span> <span class='hs-conid'>Maybe</span> <span class='hs-layout'>(</span><span class='hs-conid'>LHsContext</span> <span class='hs-varid'>pass</span><span class='hs-layout'>)</span><span class='hs-layout'>,</span> <span class='hs-comment'>-- ^ Context</span>
<a name="line-902"></a>                 <span class='hs-varid'>dd_cType</span>  <span class='hs-keyglyph'>::</span> <span class='hs-conid'>Maybe</span> <span class='hs-layout'>(</span><span class='hs-conid'>XRec</span> <span class='hs-varid'>pass</span> <span class='hs-conid'>CType</span><span class='hs-layout'>)</span><span class='hs-layout'>,</span>
<a name="line-903"></a>                 <span class='hs-varid'>dd_kindSig</span><span class='hs-keyglyph'>::</span> <span class='hs-conid'>Maybe</span> <span class='hs-layout'>(</span><span class='hs-conid'>LHsKind</span> <span class='hs-varid'>pass</span><span class='hs-layout'>)</span><span class='hs-layout'>,</span>
<a name="line-904"></a>                     <span class='hs-comment'>-- ^ Optional kind signature.</span>
<a name="line-905"></a>                     <span class='hs-comment'>--</span>
<a name="line-906"></a>                     <span class='hs-comment'>-- @(Just k)@ for a GADT-style @data@,</span>
<a name="line-907"></a>                     <span class='hs-comment'>-- or @data instance@ decl, with explicit kind sig</span>
<a name="line-908"></a>                     <span class='hs-comment'>--</span>
<a name="line-909"></a>                     <span class='hs-comment'>-- Always @Nothing@ for H98-syntax decls</span>
<a name="line-910"></a>
<a name="line-911"></a>                 <span class='hs-varid'>dd_cons</span>   <span class='hs-keyglyph'>::</span> <span class='hs-keyglyph'>[</span><span class='hs-conid'>LConDecl</span> <span class='hs-varid'>pass</span><span class='hs-keyglyph'>]</span><span class='hs-layout'>,</span>
<a name="line-912"></a>                     <span class='hs-comment'>-- ^ Data constructors</span>
<a name="line-913"></a>                     <span class='hs-comment'>--</span>
<a name="line-914"></a>                     <span class='hs-comment'>-- For @data T a = T1 | T2 a@</span>
<a name="line-915"></a>                     <span class='hs-comment'>--   the 'LConDecl's all have 'ConDeclH98'.</span>
<a name="line-916"></a>                     <span class='hs-comment'>-- For @data T a where { T1 :: T a }@</span>
<a name="line-917"></a>                     <span class='hs-comment'>--   the 'LConDecls' all have 'ConDeclGADT'.</span>
<a name="line-918"></a>
<a name="line-919"></a>                 <span class='hs-varid'>dd_derivs</span> <span class='hs-keyglyph'>::</span> <span class='hs-conid'>HsDeriving</span> <span class='hs-varid'>pass</span>  <span class='hs-comment'>-- ^ Optional 'deriving' clause</span>
<a name="line-920"></a>
<a name="line-921"></a>             <span class='hs-comment'>-- For details on above see note [exact print annotations] in GHC.Parser.Annotation</span>
<a name="line-922"></a>   <span class='hs-layout'>}</span>
<a name="line-923"></a>  <span class='hs-keyglyph'>|</span> <span class='hs-conid'>XHsDataDefn</span> <span class='hs-varop'>!</span><span class='hs-layout'>(</span><span class='hs-conid'>XXHsDataDefn</span> <span class='hs-varid'>pass</span><span class='hs-layout'>)</span>
<a name="line-924"></a>
<a name="line-925"></a><a name="HsDeriving"></a><span class='hs-comment'>-- | Haskell Deriving clause</span>
<a name="line-926"></a><a name="HsDeriving"></a><span class='hs-keyword'>type</span> <span class='hs-conid'>HsDeriving</span> <span class='hs-varid'>pass</span> <span class='hs-keyglyph'>=</span> <span class='hs-keyglyph'>[</span><span class='hs-conid'>LHsDerivingClause</span> <span class='hs-varid'>pass</span><span class='hs-keyglyph'>]</span>
<a name="line-927"></a>  <span class='hs-comment'>-- ^ The optional @deriving@ clauses of a data declaration. "Clauses" is</span>
<a name="line-928"></a>  <span class='hs-comment'>-- plural because one can specify multiple deriving clauses using the</span>
<a name="line-929"></a>  <span class='hs-comment'>-- @-XDerivingStrategies@ language extension.</span>
<a name="line-930"></a>  <span class='hs-comment'>--</span>
<a name="line-931"></a>  <span class='hs-comment'>-- The list of 'LHsDerivingClause's corresponds to exactly what the user</span>
<a name="line-932"></a>  <span class='hs-comment'>-- requested to derive, in order. If no deriving clauses were specified,</span>
<a name="line-933"></a>  <span class='hs-comment'>-- the list is empty.</span>
<a name="line-934"></a>
<a name="line-935"></a><a name="LHsDerivingClause"></a><span class='hs-keyword'>type</span> <span class='hs-conid'>LHsDerivingClause</span> <span class='hs-varid'>pass</span> <span class='hs-keyglyph'>=</span> <span class='hs-conid'>XRec</span> <span class='hs-varid'>pass</span> <span class='hs-layout'>(</span><span class='hs-conid'>HsDerivingClause</span> <span class='hs-varid'>pass</span><span class='hs-layout'>)</span>
<a name="line-936"></a>
<a name="line-937"></a><a name="HsDerivingClause"></a><span class='hs-comment'>-- | A single @deriving@ clause of a data declaration.</span>
<a name="line-938"></a><a name="HsDerivingClause"></a><span class='hs-comment'>--</span>
<a name="line-939"></a><a name="HsDerivingClause"></a><span class='hs-comment'>--  - 'GHC.Parser.Annotation.AnnKeywordId' :</span>
<a name="line-940"></a><a name="HsDerivingClause"></a><span class='hs-comment'>--       'GHC.Parser.Annotation.AnnDeriving', 'GHC.Parser.Annotation.AnnStock',</span>
<a name="line-941"></a><a name="HsDerivingClause"></a><span class='hs-comment'>--       'GHC.Parser.Annotation.AnnAnyClass', 'GHC.Parser.Annotation.AnnNewtype',</span>
<a name="line-942"></a><a name="HsDerivingClause"></a><span class='hs-comment'>--       'GHC.Parser.Annotation.AnnOpen','GHC.Parser.Annotation.AnnClose'</span>
<a name="line-943"></a><a name="HsDerivingClause"></a><span class='hs-keyword'>data</span> <span class='hs-conid'>HsDerivingClause</span> <span class='hs-varid'>pass</span>
<a name="line-944"></a>  <span class='hs-comment'>-- See Note [Deriving strategies] in GHC.Tc.Deriv</span>
<a name="line-945"></a>  <span class='hs-keyglyph'>=</span> <span class='hs-conid'>HsDerivingClause</span>
<a name="line-946"></a>    <span class='hs-layout'>{</span> <span class='hs-varid'>deriv_clause_ext</span> <span class='hs-keyglyph'>::</span> <span class='hs-conid'>XCHsDerivingClause</span> <span class='hs-varid'>pass</span>
<a name="line-947"></a>    <span class='hs-layout'>,</span> <span class='hs-varid'>deriv_clause_strategy</span> <span class='hs-keyglyph'>::</span> <span class='hs-conid'>Maybe</span> <span class='hs-layout'>(</span><span class='hs-conid'>LDerivStrategy</span> <span class='hs-varid'>pass</span><span class='hs-layout'>)</span>
<a name="line-948"></a>      <span class='hs-comment'>-- ^ The user-specified strategy (if any) to use when deriving</span>
<a name="line-949"></a>      <span class='hs-comment'>-- 'deriv_clause_tys'.</span>
<a name="line-950"></a>    <span class='hs-layout'>,</span> <span class='hs-varid'>deriv_clause_tys</span> <span class='hs-keyglyph'>::</span> <span class='hs-conid'>LDerivClauseTys</span> <span class='hs-varid'>pass</span>
<a name="line-951"></a>      <span class='hs-comment'>-- ^ The types to derive.</span>
<a name="line-952"></a>    <span class='hs-layout'>}</span>
<a name="line-953"></a>  <span class='hs-keyglyph'>|</span> <span class='hs-conid'>XHsDerivingClause</span> <span class='hs-varop'>!</span><span class='hs-layout'>(</span><span class='hs-conid'>XXHsDerivingClause</span> <span class='hs-varid'>pass</span><span class='hs-layout'>)</span>
<a name="line-954"></a>
<a name="line-955"></a><a name="LDerivClauseTys"></a><span class='hs-keyword'>type</span> <span class='hs-conid'>LDerivClauseTys</span> <span class='hs-varid'>pass</span> <span class='hs-keyglyph'>=</span> <span class='hs-conid'>XRec</span> <span class='hs-varid'>pass</span> <span class='hs-layout'>(</span><span class='hs-conid'>DerivClauseTys</span> <span class='hs-varid'>pass</span><span class='hs-layout'>)</span>
<a name="line-956"></a>
<a name="line-957"></a><a name="DerivClauseTys"></a><span class='hs-comment'>-- | The types mentioned in a single @deriving@ clause. This can come in two</span>
<a name="line-958"></a><a name="DerivClauseTys"></a><span class='hs-comment'>-- forms, 'DctSingle' or 'DctMulti', depending on whether the types are</span>
<a name="line-959"></a><a name="DerivClauseTys"></a><span class='hs-comment'>-- surrounded by enclosing parentheses or not. These parentheses are</span>
<a name="line-960"></a><a name="DerivClauseTys"></a><span class='hs-comment'>-- semantically different than 'HsParTy'. For example, @deriving ()@ means</span>
<a name="line-961"></a><a name="DerivClauseTys"></a><span class='hs-comment'>-- \"derive zero classes\" rather than \"derive an instance of the 0-tuple\".</span>
<a name="line-962"></a><a name="DerivClauseTys"></a><span class='hs-comment'>--</span>
<a name="line-963"></a><a name="DerivClauseTys"></a><span class='hs-comment'>-- 'DerivClauseTys' use 'LHsSigType' because @deriving@ clauses can mention</span>
<a name="line-964"></a><a name="DerivClauseTys"></a><span class='hs-comment'>-- type variables that aren't bound by the datatype, e.g.</span>
<a name="line-965"></a><a name="DerivClauseTys"></a><span class='hs-comment'>--</span>
<a name="line-966"></a><a name="DerivClauseTys"></a><span class='hs-comment'>-- &gt; data T b = ... deriving (C [a])</span>
<a name="line-967"></a><a name="DerivClauseTys"></a><span class='hs-comment'>--</span>
<a name="line-968"></a><a name="DerivClauseTys"></a><span class='hs-comment'>-- should produce a derived instance for @C [a] (T b)@.</span>
<a name="line-969"></a><a name="DerivClauseTys"></a><span class='hs-keyword'>data</span> <span class='hs-conid'>DerivClauseTys</span> <span class='hs-varid'>pass</span>
<a name="line-970"></a>  <span class='hs-keyglyph'>=</span> <span class='hs-comment'>-- | A @deriving@ clause with a single type. Moreover, that type can only</span>
<a name="line-971"></a>    <span class='hs-comment'>-- be a type constructor without any arguments.</span>
<a name="line-972"></a>    <span class='hs-comment'>--</span>
<a name="line-973"></a>    <span class='hs-comment'>-- Example: @deriving Eq@</span>
<a name="line-974"></a>    <span class='hs-conid'>DctSingle</span> <span class='hs-layout'>(</span><span class='hs-conid'>XDctSingle</span> <span class='hs-varid'>pass</span><span class='hs-layout'>)</span> <span class='hs-layout'>(</span><span class='hs-conid'>LHsSigType</span> <span class='hs-varid'>pass</span><span class='hs-layout'>)</span>
<a name="line-975"></a>
<a name="line-976"></a>    <span class='hs-comment'>-- | A @deriving@ clause with a comma-separated list of types, surrounded</span>
<a name="line-977"></a>    <span class='hs-comment'>-- by enclosing parentheses.</span>
<a name="line-978"></a>    <span class='hs-comment'>--</span>
<a name="line-979"></a>    <span class='hs-comment'>-- Example: @deriving (Eq, C a)@</span>
<a name="line-980"></a>  <span class='hs-keyglyph'>|</span> <span class='hs-conid'>DctMulti</span> <span class='hs-layout'>(</span><span class='hs-conid'>XDctMulti</span> <span class='hs-varid'>pass</span><span class='hs-layout'>)</span> <span class='hs-keyglyph'>[</span><span class='hs-conid'>LHsSigType</span> <span class='hs-varid'>pass</span><span class='hs-keyglyph'>]</span>
<a name="line-981"></a>
<a name="line-982"></a>  <span class='hs-keyglyph'>|</span> <span class='hs-conid'>XDerivClauseTys</span> <span class='hs-varop'>!</span><span class='hs-layout'>(</span><span class='hs-conid'>XXDerivClauseTys</span> <span class='hs-varid'>pass</span><span class='hs-layout'>)</span>
<a name="line-983"></a>
<a name="line-984"></a><a name="LStandaloneKindSig"></a><span class='hs-comment'>-- | Located Standalone Kind Signature</span>
<a name="line-985"></a><a name="LStandaloneKindSig"></a><span class='hs-keyword'>type</span> <span class='hs-conid'>LStandaloneKindSig</span> <span class='hs-varid'>pass</span> <span class='hs-keyglyph'>=</span> <span class='hs-conid'>XRec</span> <span class='hs-varid'>pass</span> <span class='hs-layout'>(</span><span class='hs-conid'>StandaloneKindSig</span> <span class='hs-varid'>pass</span><span class='hs-layout'>)</span>
<a name="line-986"></a>
<a name="line-987"></a><a name="StandaloneKindSig"></a><span class='hs-keyword'>data</span> <span class='hs-conid'>StandaloneKindSig</span> <span class='hs-varid'>pass</span>
<a name="line-988"></a>  <span class='hs-keyglyph'>=</span> <span class='hs-conid'>StandaloneKindSig</span> <span class='hs-layout'>(</span><span class='hs-conid'>XStandaloneKindSig</span> <span class='hs-varid'>pass</span><span class='hs-layout'>)</span>
<a name="line-989"></a>      <span class='hs-layout'>(</span><span class='hs-conid'>LIdP</span> <span class='hs-varid'>pass</span><span class='hs-layout'>)</span>           <span class='hs-comment'>-- Why a single binder? See #16754</span>
<a name="line-990"></a>      <span class='hs-layout'>(</span><span class='hs-conid'>LHsSigType</span> <span class='hs-varid'>pass</span><span class='hs-layout'>)</span>     <span class='hs-comment'>-- Why not LHsSigWcType? See Note [Wildcards in standalone kind signatures]</span>
<a name="line-991"></a>  <span class='hs-keyglyph'>|</span> <span class='hs-conid'>XStandaloneKindSig</span> <span class='hs-varop'>!</span><span class='hs-layout'>(</span><span class='hs-conid'>XXStandaloneKindSig</span> <span class='hs-varid'>pass</span><span class='hs-layout'>)</span>
<a name="line-992"></a>
<a name="line-993"></a><span class='hs-comment'>{- Note [Wildcards in standalone kind signatures]
<a name="line-994"></a>~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~
<a name="line-995"></a>Standalone kind signatures enable polymorphic recursion, and it is unclear how
<a name="line-996"></a>to reconcile this with partial type signatures, so we disallow wildcards in
<a name="line-997"></a>them.
<a name="line-998"></a>
<a name="line-999"></a>We reject wildcards in 'rnStandaloneKindSignature' by returning False for
<a name="line-1000"></a>'StandaloneKindSigCtx' in 'wildCardsAllowed'.
<a name="line-1001"></a>
<a name="line-1002"></a>The alternative design is to have special treatment for partial standalone kind
<a name="line-1003"></a>signatures, much like we have special treatment for partial type signatures in
<a name="line-1004"></a>terms. However, partial standalone kind signatures are not a proper replacement
<a name="line-1005"></a>for CUSKs, so this would be a separate feature.
<a name="line-1006"></a>-}</span>
<a name="line-1007"></a>
<a name="line-1008"></a><a name="NewOrData"></a><span class='hs-keyword'>data</span> <span class='hs-conid'>NewOrData</span>
<a name="line-1009"></a>  <span class='hs-keyglyph'>=</span> <span class='hs-conid'>NewType</span>                     <span class='hs-comment'>-- ^ @newtype Blah ...@</span>
<a name="line-1010"></a>  <span class='hs-keyglyph'>|</span> <span class='hs-conid'>DataType</span>                    <span class='hs-comment'>-- ^ @data Blah ...@</span>
<a name="line-1011"></a>  <span class='hs-keyword'>deriving</span><span class='hs-layout'>(</span> <span class='hs-conid'>Eq</span><span class='hs-layout'>,</span> <span class='hs-conid'>Data</span> <span class='hs-layout'>)</span>                <span class='hs-comment'>-- Needed because Demand derives Eq</span>
<a name="line-1012"></a>
<a name="line-1013"></a><a name="newOrDataToFlavour"></a><span class='hs-comment'>-- | Convert a 'NewOrData' to a 'TyConFlavour'</span>
<a name="line-1014"></a><span class='hs-definition'>newOrDataToFlavour</span> <span class='hs-keyglyph'>::</span> <span class='hs-conid'>NewOrData</span> <span class='hs-keyglyph'>-&gt;</span> <span class='hs-conid'>TyConFlavour</span>
<a name="line-1015"></a><span class='hs-definition'>newOrDataToFlavour</span> <span class='hs-conid'>NewType</span>  <span class='hs-keyglyph'>=</span> <span class='hs-conid'>NewtypeFlavour</span>
<a name="line-1016"></a><span class='hs-definition'>newOrDataToFlavour</span> <span class='hs-conid'>DataType</span> <span class='hs-keyglyph'>=</span> <span class='hs-conid'>DataTypeFlavour</span>
<a name="line-1017"></a>
<a name="line-1018"></a>
<a name="line-1019"></a><a name="LConDecl"></a><span class='hs-comment'>-- | Located data Constructor Declaration</span>
<a name="line-1020"></a><a name="LConDecl"></a><span class='hs-keyword'>type</span> <span class='hs-conid'>LConDecl</span> <span class='hs-varid'>pass</span> <span class='hs-keyglyph'>=</span> <span class='hs-conid'>XRec</span> <span class='hs-varid'>pass</span> <span class='hs-layout'>(</span><span class='hs-conid'>ConDecl</span> <span class='hs-varid'>pass</span><span class='hs-layout'>)</span>
<a name="line-1021"></a>      <span class='hs-comment'>-- ^ May have 'GHC.Parser.Annotation.AnnKeywordId' : 'GHC.Parser.Annotation.AnnSemi' when</span>
<a name="line-1022"></a>      <span class='hs-comment'>--   in a GADT constructor list</span>
<a name="line-1023"></a>
<a name="line-1024"></a>  <span class='hs-comment'>-- For details on above see note [exact print annotations] in GHC.Parser.Annotation</span>
<a name="line-1025"></a>
<a name="line-1026"></a><span class='hs-comment'>-- |</span>
<a name="line-1027"></a><span class='hs-comment'>--</span>
<a name="line-1028"></a><span class='hs-comment'>-- @</span>
<a name="line-1029"></a><span class='hs-comment'>-- data T b = forall a. Eq a =&gt; MkT a b</span>
<a name="line-1030"></a><span class='hs-comment'>--   MkT :: forall b a. Eq a =&gt; MkT a b</span>
<a name="line-1031"></a><span class='hs-comment'>--</span>
<a name="line-1032"></a><span class='hs-comment'>-- data T b where</span>
<a name="line-1033"></a><span class='hs-comment'>--      MkT1 :: Int -&gt; T Int</span>
<a name="line-1034"></a><span class='hs-comment'>--</span>
<a name="line-1035"></a><span class='hs-comment'>-- data T = Int `MkT` Int</span>
<a name="line-1036"></a><span class='hs-comment'>--        | MkT2</span>
<a name="line-1037"></a><span class='hs-comment'>--</span>
<a name="line-1038"></a><span class='hs-comment'>-- data T a where</span>
<a name="line-1039"></a><span class='hs-comment'>--      Int `MkT` Int :: T Int</span>
<a name="line-1040"></a><span class='hs-comment'>-- @</span>
<a name="line-1041"></a><span class='hs-comment'>--</span>
<a name="line-1042"></a><span class='hs-comment'>-- - 'GHC.Parser.Annotation.AnnKeywordId's : 'GHC.Parser.Annotation.AnnOpen',</span>
<a name="line-1043"></a><span class='hs-comment'>--            'GHC.Parser.Annotation.AnnDotdot','GHC.Parser.Annotation.AnnCLose',</span>
<a name="line-1044"></a><span class='hs-comment'>--            'GHC.Parser.Annotation.AnnEqual','GHC.Parser.Annotation.AnnVbar',</span>
<a name="line-1045"></a><span class='hs-comment'>--            'GHC.Parser.Annotation.AnnDarrow','GHC.Parser.Annotation.AnnDarrow',</span>
<a name="line-1046"></a><span class='hs-comment'>--            'GHC.Parser.Annotation.AnnForall','GHC.Parser.Annotation.AnnDot'</span>
<a name="line-1047"></a>
<a name="line-1048"></a><span class='hs-comment'>-- For details on above see note [exact print annotations] in GHC.Parser.Annotation</span>
<a name="line-1049"></a>
<a name="line-1050"></a><a name="ConDecl"></a><span class='hs-comment'>-- | data Constructor Declaration</span>
<a name="line-1051"></a><a name="ConDecl"></a><span class='hs-keyword'>data</span> <span class='hs-conid'>ConDecl</span> <span class='hs-varid'>pass</span>
<a name="line-1052"></a>  <span class='hs-keyglyph'>=</span> <span class='hs-conid'>ConDeclGADT</span>
<a name="line-1053"></a>      <span class='hs-layout'>{</span> <span class='hs-varid'>con_g_ext</span>   <span class='hs-keyglyph'>::</span> <span class='hs-conid'>XConDeclGADT</span> <span class='hs-varid'>pass</span>
<a name="line-1054"></a>      <span class='hs-layout'>,</span> <span class='hs-varid'>con_names</span>   <span class='hs-keyglyph'>::</span> <span class='hs-keyglyph'>[</span><span class='hs-conid'>LIdP</span> <span class='hs-varid'>pass</span><span class='hs-keyglyph'>]</span>
<a name="line-1055"></a>
<a name="line-1056"></a>      <span class='hs-comment'>-- The following fields describe the type after the '::'</span>
<a name="line-1057"></a>      <span class='hs-comment'>-- See Note [GADT abstract syntax]</span>
<a name="line-1058"></a>      <span class='hs-layout'>,</span> <span class='hs-varid'>con_bndrs</span>   <span class='hs-keyglyph'>::</span> <span class='hs-conid'>XRec</span> <span class='hs-varid'>pass</span> <span class='hs-layout'>(</span><span class='hs-conid'>HsOuterSigTyVarBndrs</span> <span class='hs-varid'>pass</span><span class='hs-layout'>)</span>
<a name="line-1059"></a>        <span class='hs-comment'>-- ^ The outermost type variable binders, be they explicit or</span>
<a name="line-1060"></a>        <span class='hs-comment'>--   implicit.  The 'XRec' is used to anchor exact print</span>
<a name="line-1061"></a>        <span class='hs-comment'>--   annotations, AnnForall and AnnDot.</span>
<a name="line-1062"></a>      <span class='hs-layout'>,</span> <span class='hs-varid'>con_mb_cxt</span>  <span class='hs-keyglyph'>::</span> <span class='hs-conid'>Maybe</span> <span class='hs-layout'>(</span><span class='hs-conid'>LHsContext</span> <span class='hs-varid'>pass</span><span class='hs-layout'>)</span>   <span class='hs-comment'>-- ^ User-written context (if any)</span>
<a name="line-1063"></a>      <span class='hs-layout'>,</span> <span class='hs-varid'>con_g_args</span>  <span class='hs-keyglyph'>::</span> <span class='hs-conid'>HsConDeclGADTDetails</span> <span class='hs-varid'>pass</span> <span class='hs-comment'>-- ^ Arguments; never infix</span>
<a name="line-1064"></a>      <span class='hs-layout'>,</span> <span class='hs-varid'>con_res_ty</span>  <span class='hs-keyglyph'>::</span> <span class='hs-conid'>LHsType</span> <span class='hs-varid'>pass</span>              <span class='hs-comment'>-- ^ Result type</span>
<a name="line-1065"></a>
<a name="line-1066"></a>      <span class='hs-layout'>,</span> <span class='hs-varid'>con_doc</span>     <span class='hs-keyglyph'>::</span> <span class='hs-conid'>Maybe</span> <span class='hs-conid'>LHsDocString</span>
<a name="line-1067"></a>          <span class='hs-comment'>-- ^ A possible Haddock comment.</span>
<a name="line-1068"></a>      <span class='hs-layout'>}</span>
<a name="line-1069"></a>
<a name="line-1070"></a>  <span class='hs-keyglyph'>|</span> <span class='hs-conid'>ConDeclH98</span>
<a name="line-1071"></a>      <span class='hs-layout'>{</span> <span class='hs-varid'>con_ext</span>     <span class='hs-keyglyph'>::</span> <span class='hs-conid'>XConDeclH98</span> <span class='hs-varid'>pass</span>
<a name="line-1072"></a>      <span class='hs-layout'>,</span> <span class='hs-varid'>con_name</span>    <span class='hs-keyglyph'>::</span> <span class='hs-conid'>LIdP</span> <span class='hs-varid'>pass</span>
<a name="line-1073"></a>
<a name="line-1074"></a>      <span class='hs-layout'>,</span> <span class='hs-varid'>con_forall</span>  <span class='hs-keyglyph'>::</span> <span class='hs-conid'>Bool</span>
<a name="line-1075"></a>                              <span class='hs-comment'>-- ^ True &lt;=&gt; explicit user-written forall</span>
<a name="line-1076"></a>                              <span class='hs-comment'>--     e.g. data T a = forall b. MkT b (b-&gt;a)</span>
<a name="line-1077"></a>                              <span class='hs-comment'>--     con_ex_tvs = {b}</span>
<a name="line-1078"></a>                              <span class='hs-comment'>-- False =&gt; con_ex_tvs is empty</span>
<a name="line-1079"></a>      <span class='hs-layout'>,</span> <span class='hs-varid'>con_ex_tvs</span> <span class='hs-keyglyph'>::</span> <span class='hs-keyglyph'>[</span><span class='hs-conid'>LHsTyVarBndr</span> <span class='hs-conid'>Specificity</span> <span class='hs-varid'>pass</span><span class='hs-keyglyph'>]</span> <span class='hs-comment'>-- ^ Existentials only</span>
<a name="line-1080"></a>      <span class='hs-layout'>,</span> <span class='hs-varid'>con_mb_cxt</span> <span class='hs-keyglyph'>::</span> <span class='hs-conid'>Maybe</span> <span class='hs-layout'>(</span><span class='hs-conid'>LHsContext</span> <span class='hs-varid'>pass</span><span class='hs-layout'>)</span>         <span class='hs-comment'>-- ^ User-written context (if any)</span>
<a name="line-1081"></a>      <span class='hs-layout'>,</span> <span class='hs-varid'>con_args</span>   <span class='hs-keyglyph'>::</span> <span class='hs-conid'>HsConDeclH98Details</span> <span class='hs-varid'>pass</span>        <span class='hs-comment'>-- ^ Arguments; can be infix</span>
<a name="line-1082"></a>
<a name="line-1083"></a>      <span class='hs-layout'>,</span> <span class='hs-varid'>con_doc</span>       <span class='hs-keyglyph'>::</span> <span class='hs-conid'>Maybe</span> <span class='hs-conid'>LHsDocString</span>
<a name="line-1084"></a>          <span class='hs-comment'>-- ^ A possible Haddock comment.</span>
<a name="line-1085"></a>      <span class='hs-layout'>}</span>
<a name="line-1086"></a>  <span class='hs-keyglyph'>|</span> <span class='hs-conid'>XConDecl</span> <span class='hs-varop'>!</span><span class='hs-layout'>(</span><span class='hs-conid'>XXConDecl</span> <span class='hs-varid'>pass</span><span class='hs-layout'>)</span>
<a name="line-1087"></a>
<a name="line-1088"></a><span class='hs-comment'>{- Note [GADT abstract syntax]
<a name="line-1089"></a>~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~
<a name="line-1090"></a>The types of both forms of GADT constructors are very structured, as they
<a name="line-1091"></a>must consist of the quantified type variables (if provided), followed by the
<a name="line-1092"></a>context (if provided), followed by the argument types (if provided), followed
<a name="line-1093"></a>by the result type. (See "Wrinkle: No nested foralls or contexts" below for
<a name="line-1094"></a>more discussion on the restrictions imposed here.) As a result, instead of
<a name="line-1095"></a>storing the type of a GADT constructor as a single LHsType, we split it up
<a name="line-1096"></a>into its constituent components for easier access.
<a name="line-1097"></a>
<a name="line-1098"></a>There are two broad ways to classify GADT constructors:
<a name="line-1099"></a>
<a name="line-1100"></a>* Record-syntax constructors. For example:
<a name="line-1101"></a>
<a name="line-1102"></a>    data T a where
<a name="line-1103"></a>      K :: forall a. Ord a =&gt; { x :: [a], ... } -&gt; T a
<a name="line-1104"></a>
<a name="line-1105"></a>* Prefix constructors, which do not use record syntax. For example:
<a name="line-1106"></a>
<a name="line-1107"></a>    data T a where
<a name="line-1108"></a>      K :: forall a. Ord a =&gt; [a] -&gt; ... -&gt; T a
<a name="line-1109"></a>
<a name="line-1110"></a>This distinction is recorded in the `con_args :: HsConDetails pass`, which
<a name="line-1111"></a>tracks if we're dealing with a RecCon or PrefixCon. It is easy to distinguish
<a name="line-1112"></a>the two in the AST since record GADT constructors use HsRecTy. This distinction
<a name="line-1113"></a>is made in GHC.Parser.PostProcess.mkGadtDecl.
<a name="line-1114"></a>
<a name="line-1115"></a>It is worth elaborating a bit more on the process of splitting the argument
<a name="line-1116"></a>types of a GADT constructor, since there are some non-obvious details involved.
<a name="line-1117"></a>While splitting the argument types of a record GADT constructor is easy (they
<a name="line-1118"></a>are stored in an HsRecTy), splitting the arguments of a prefix GADT constructor
<a name="line-1119"></a>is trickier. The basic idea is that we must split along the outermost function
<a name="line-1120"></a>arrows ((-&gt;) and (%1 -&gt;)) in the type, which GHC.Hs.Type.splitHsFunType
<a name="line-1121"></a>accomplishes. But what about type operators? Consider:
<a name="line-1122"></a>
<a name="line-1123"></a>  C :: a :*: b -&gt; a :*: b -&gt; a :+: b
<a name="line-1124"></a>
<a name="line-1125"></a>This could parse in many different ways depending on the precedences of each
<a name="line-1126"></a>type operator. In particular, if (:*:) were to have lower precedence than (-&gt;),
<a name="line-1127"></a>then it could very well parse like this:
<a name="line-1128"></a>
<a name="line-1129"></a>  a :*: ((b -&gt; a) :*: ((b -&gt; a) :+: b)))
<a name="line-1130"></a>
<a name="line-1131"></a>This would give the false impression that the whole type is part of one large
<a name="line-1132"></a>return type, with no arguments. Note that we do not fully resolve the exact
<a name="line-1133"></a>precedences of each user-defined type operator until the renamer, so this a
<a name="line-1134"></a>more difficult task for the parser.
<a name="line-1135"></a>
<a name="line-1136"></a>Fortunately, there is no risk of the above happening. GHC's parser gives
<a name="line-1137"></a>special treatment to function arrows, and as a result, they are always parsed
<a name="line-1138"></a>with a lower precedence than any other type operator. As a result, the type
<a name="line-1139"></a>above is actually parsed like this:
<a name="line-1140"></a>
<a name="line-1141"></a>  (a :*: b) -&gt; ((a :*: b) -&gt; (a :+: b))
<a name="line-1142"></a>
<a name="line-1143"></a>While we won't know the exact precedences of (:*:) and (:+:) until the renamer,
<a name="line-1144"></a>all we are concerned about in the parser is identifying the overall shape of
<a name="line-1145"></a>the argument and result types, which we can accomplish by piggybacking on the
<a name="line-1146"></a>special treatment given to function arrows. In a future where function arrows
<a name="line-1147"></a>aren't given special status in the parser, we will likely have to modify
<a name="line-1148"></a>GHC.Parser.PostProcess.mkHsOpTyPV to preserve this trick.
<a name="line-1149"></a>
<a name="line-1150"></a>-----
<a name="line-1151"></a>-- Wrinkle: No nested foralls or contexts
<a name="line-1152"></a>-----
<a name="line-1153"></a>
<a name="line-1154"></a>GADT constructors provide some freedom to change the order of foralls in their
<a name="line-1155"></a>types (see Note [DataCon user type variable binders] in GHC.Core.DataCon), but
<a name="line-1156"></a>this freedom is still limited. GADTs still require that all quantification
<a name="line-1157"></a>occurs "prenex". That is, any explicitly quantified type variables must occur
<a name="line-1158"></a>at the front of the GADT type, followed by any contexts, followed by the body of
<a name="line-1159"></a>the GADT type, in precisely that order. For instance:
<a name="line-1160"></a>
<a name="line-1161"></a>  data T where
<a name="line-1162"></a>    MkT1 :: forall a b. (Eq a, Eq b) =&gt; a -&gt; b -&gt; T
<a name="line-1163"></a>      -- OK
<a name="line-1164"></a>    MkT2 :: forall a. Eq a =&gt; forall b. a -&gt; b -&gt; T
<a name="line-1165"></a>      -- Rejected, `forall b` is nested
<a name="line-1166"></a>    MkT3 :: forall a b. Eq a =&gt; Eq b =&gt; a -&gt; b -&gt; T
<a name="line-1167"></a>      -- Rejected, `Eq b` is nested
<a name="line-1168"></a>    MkT4 :: Int -&gt; forall a. a -&gt; T
<a name="line-1169"></a>      -- Rejected, `forall a` is nested
<a name="line-1170"></a>    MkT5 :: forall a. Int -&gt; Eq a =&gt; a -&gt; T
<a name="line-1171"></a>      -- Rejected, `Eq a` is nested
<a name="line-1172"></a>    MkT6 :: (forall a. a -&gt; T)
<a name="line-1173"></a>      -- Rejected, `forall a` is nested due to the surrounding parentheses
<a name="line-1174"></a>    MkT7 :: (Eq a =&gt; a -&gt; t)
<a name="line-1175"></a>      -- Rejected, `Eq a` is nested due to the surrounding parentheses
<a name="line-1176"></a>
<a name="line-1177"></a>For the full details, see the "Formal syntax for GADTs" section of the GHC
<a name="line-1178"></a>User's Guide. GHC enforces that GADT constructors do not have nested `forall`s
<a name="line-1179"></a>or contexts in two parts:
<a name="line-1180"></a>
<a name="line-1181"></a>1. GHC, in the process of splitting apart a GADT's type,
<a name="line-1182"></a>   extracts out the leading `forall` and context (if they are provided). To
<a name="line-1183"></a>   accomplish this splitting, the renamer uses the
<a name="line-1184"></a>   GHC.Hs.Type.splitLHsGADTPrefixTy function, which is careful not to remove
<a name="line-1185"></a>   parentheses surrounding the leading `forall` or context (as these
<a name="line-1186"></a>   parentheses can be syntactically significant). If the third result returned
<a name="line-1187"></a>   by splitLHsGADTPrefixTy contains any `forall`s or contexts, then they must
<a name="line-1188"></a>   be nested, so they will be rejected.
<a name="line-1189"></a>
<a name="line-1190"></a>   Note that this step applies to both prefix and record GADTs alike, as they
<a name="line-1191"></a>   both have syntax which permits `forall`s and contexts. The difference is
<a name="line-1192"></a>   where this step happens:
<a name="line-1193"></a>
<a name="line-1194"></a>   * For prefix GADTs, this happens in the renamer (in rnConDecl), as we cannot
<a name="line-1195"></a>     split until after the type operator fixities have been resolved.
<a name="line-1196"></a>   * For record GADTs, this happens in the parser (in mkGadtDecl).
<a name="line-1197"></a>2. If the GADT type is prefix, the renamer (in the ConDeclGADTPrefixPs case of
<a name="line-1198"></a>   rnConDecl) will then check for nested `forall`s/contexts in the body of a
<a name="line-1199"></a>   prefix GADT type, after it has determined what all of the argument types are.
<a name="line-1200"></a>   This step is necessary to catch examples like MkT4 above, where the nested
<a name="line-1201"></a>   quantification occurs after a visible argument type.
<a name="line-1202"></a>-}</span>
<a name="line-1203"></a>
<a name="line-1204"></a><a name="HsConDeclH98Details"></a><span class='hs-comment'>-- | The arguments in a Haskell98-style data constructor.</span>
<a name="line-1205"></a><a name="HsConDeclH98Details"></a><span class='hs-keyword'>type</span> <span class='hs-conid'>HsConDeclH98Details</span> <span class='hs-varid'>pass</span>
<a name="line-1206"></a>   <span class='hs-keyglyph'>=</span> <span class='hs-conid'>HsConDetails</span> <span class='hs-conid'>Void</span> <span class='hs-layout'>(</span><span class='hs-conid'>HsScaled</span> <span class='hs-varid'>pass</span> <span class='hs-layout'>(</span><span class='hs-conid'>LBangType</span> <span class='hs-varid'>pass</span><span class='hs-layout'>)</span><span class='hs-layout'>)</span> <span class='hs-layout'>(</span><span class='hs-conid'>XRec</span> <span class='hs-varid'>pass</span> <span class='hs-keyglyph'>[</span><span class='hs-conid'>LConDeclField</span> <span class='hs-varid'>pass</span><span class='hs-keyglyph'>]</span><span class='hs-layout'>)</span>
<a name="line-1207"></a><span class='hs-comment'>-- The Void argument to HsConDetails here is a reflection of the fact that</span>
<a name="line-1208"></a><span class='hs-comment'>-- type applications are not allowed in data constructor declarations.</span>
<a name="line-1209"></a>
<a name="line-1210"></a><a name="HsConDeclGADTDetails"></a><span class='hs-comment'>-- | The arguments in a GADT constructor. Unlike Haskell98-style constructors,</span>
<a name="line-1211"></a><a name="HsConDeclGADTDetails"></a><span class='hs-comment'>-- GADT constructors cannot be declared with infix syntax. As a result, we do</span>
<a name="line-1212"></a><a name="HsConDeclGADTDetails"></a><span class='hs-comment'>-- not use 'HsConDetails' here, as 'InfixCon' would be an unrepresentable</span>
<a name="line-1213"></a><a name="HsConDeclGADTDetails"></a><span class='hs-comment'>-- state. (There is a notion of infix GADT constructors for the purposes of</span>
<a name="line-1214"></a><a name="HsConDeclGADTDetails"></a><span class='hs-comment'>-- derived Show instances—see Note [Infix GADT constructors] in</span>
<a name="line-1215"></a><a name="HsConDeclGADTDetails"></a><span class='hs-comment'>-- GHC.Tc.TyCl—but that is an orthogonal concern.)</span>
<a name="line-1216"></a><a name="HsConDeclGADTDetails"></a><span class='hs-keyword'>data</span> <span class='hs-conid'>HsConDeclGADTDetails</span> <span class='hs-varid'>pass</span>
<a name="line-1217"></a>   <span class='hs-keyglyph'>=</span> <span class='hs-conid'>PrefixConGADT</span> <span class='hs-keyglyph'>[</span><span class='hs-conid'>HsScaled</span> <span class='hs-varid'>pass</span> <span class='hs-layout'>(</span><span class='hs-conid'>LBangType</span> <span class='hs-varid'>pass</span><span class='hs-layout'>)</span><span class='hs-keyglyph'>]</span>
<a name="line-1218"></a>   <span class='hs-keyglyph'>|</span> <span class='hs-conid'>RecConGADT</span> <span class='hs-layout'>(</span><span class='hs-conid'>XRec</span> <span class='hs-varid'>pass</span> <span class='hs-keyglyph'>[</span><span class='hs-conid'>LConDeclField</span> <span class='hs-varid'>pass</span><span class='hs-keyglyph'>]</span><span class='hs-layout'>)</span>
<a name="line-1219"></a>
<a name="line-1220"></a><a name="instance%20Outputable%20NewOrData"></a><span class='hs-keyword'>instance</span> <span class='hs-conid'>Outputable</span> <span class='hs-conid'>NewOrData</span> <span class='hs-keyword'>where</span>
<a name="line-1221"></a>  <span class='hs-varid'>ppr</span> <span class='hs-conid'>NewType</span>  <span class='hs-keyglyph'>=</span> <span class='hs-varid'>text</span> <span class='hs-str'>"newtype"</span>
<a name="line-1222"></a>  <span class='hs-varid'>ppr</span> <span class='hs-conid'>DataType</span> <span class='hs-keyglyph'>=</span> <span class='hs-varid'>text</span> <span class='hs-str'>"data"</span>
<a name="line-1223"></a>
<a name="line-1224"></a><span class='hs-comment'>{-
<a name="line-1225"></a>************************************************************************
<a name="line-1226"></a>*                                                                      *
<a name="line-1227"></a>                Instance declarations
<a name="line-1228"></a>*                                                                      *
<a name="line-1229"></a>************************************************************************
<a name="line-1230"></a>
<a name="line-1231"></a>Note [Type family instance declarations in HsSyn]
<a name="line-1232"></a>~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~
<a name="line-1233"></a>The data type FamEqn represents one equation of a type family instance.
<a name="line-1234"></a>Aside from the pass, it is also parameterised over another field, feqn_rhs.
<a name="line-1235"></a>feqn_rhs is either an HsDataDefn (for data family instances) or an LHsType
<a name="line-1236"></a>(for type family instances).
<a name="line-1237"></a>
<a name="line-1238"></a>Type family instances also include associated type family default equations.
<a name="line-1239"></a>That is because a default for a type family looks like this:
<a name="line-1240"></a>
<a name="line-1241"></a>  class C a where
<a name="line-1242"></a>    type family F a b :: Type
<a name="line-1243"></a>    type F c d = (c,d)   -- Default instance
<a name="line-1244"></a>
<a name="line-1245"></a>The default declaration is really just a `type instance` declaration, but one
<a name="line-1246"></a>with particularly simple patterns: they must all be distinct type variables.
<a name="line-1247"></a>That's because we will instantiate it (in an instance declaration for `C`) if
<a name="line-1248"></a>we don't give an explicit instance for `F`. Note that the names of the
<a name="line-1249"></a>variables don't need to match those of the class: it really is like a
<a name="line-1250"></a>free-standing `type instance` declaration.
<a name="line-1251"></a>-}</span>
<a name="line-1252"></a>
<a name="line-1253"></a><span class='hs-comment'>----------------- Type synonym family instances -------------</span>
<a name="line-1254"></a>
<a name="line-1255"></a><a name="LTyFamInstEqn"></a><span class='hs-comment'>-- | Located Type Family Instance Equation</span>
<a name="line-1256"></a><a name="LTyFamInstEqn"></a><span class='hs-keyword'>type</span> <span class='hs-conid'>LTyFamInstEqn</span> <span class='hs-varid'>pass</span> <span class='hs-keyglyph'>=</span> <span class='hs-conid'>XRec</span> <span class='hs-varid'>pass</span> <span class='hs-layout'>(</span><span class='hs-conid'>TyFamInstEqn</span> <span class='hs-varid'>pass</span><span class='hs-layout'>)</span>
<a name="line-1257"></a>  <span class='hs-comment'>-- ^ May have 'GHC.Parser.Annotation.AnnKeywordId' : 'GHC.Parser.Annotation.AnnSemi'</span>
<a name="line-1258"></a>  <span class='hs-comment'>--   when in a list</span>
<a name="line-1259"></a>
<a name="line-1260"></a><span class='hs-comment'>-- For details on above see note [exact print annotations] in GHC.Parser.Annotation</span>
<a name="line-1261"></a>
<a name="line-1262"></a><a name="HsTyPats"></a><span class='hs-comment'>-- | Haskell Type Patterns</span>
<a name="line-1263"></a><a name="HsTyPats"></a><span class='hs-keyword'>type</span> <span class='hs-conid'>HsTyPats</span> <span class='hs-varid'>pass</span> <span class='hs-keyglyph'>=</span> <span class='hs-keyglyph'>[</span><span class='hs-conid'>LHsTypeArg</span> <span class='hs-varid'>pass</span><span class='hs-keyglyph'>]</span>
<a name="line-1264"></a>
<a name="line-1265"></a><span class='hs-comment'>{- Note [Family instance declaration binders]
<a name="line-1266"></a>~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~
<a name="line-1267"></a>The feqn_pats field of FamEqn (family instance equation) stores the LHS type
<a name="line-1268"></a>(and kind) patterns. Any type (and kind) variables contained
<a name="line-1269"></a>in these type patterns are bound in the feqn_bndrs field.
<a name="line-1270"></a>Note that in particular:
<a name="line-1271"></a>
<a name="line-1272"></a>* The feqn_bndrs *include* any anonymous wildcards.  For example
<a name="line-1273"></a>     type instance F a _ = a
<a name="line-1274"></a>  The feqn_bndrs will be HsOuterImplicit {a, _}.  Remember that each separate
<a name="line-1275"></a>  wildcard '_' gets its own unique.  In this context wildcards behave just like
<a name="line-1276"></a>  an ordinary type variable, only anonymous.
<a name="line-1277"></a>
<a name="line-1278"></a>* The feqn_bndrs *include* type variables that are already in scope
<a name="line-1279"></a>
<a name="line-1280"></a>   Eg   class C s t where
<a name="line-1281"></a>          type F t p :: *
<a name="line-1282"></a>        instance C w (a,b) where
<a name="line-1283"></a>          type F (a,b) x = x-&gt;a
<a name="line-1284"></a>   The feqn_bndrs of the F decl is HsOuterImplicit {a,b,x}, even though the
<a name="line-1285"></a>   F decl is nested inside the 'instance' decl.
<a name="line-1286"></a>
<a name="line-1287"></a>   However after the renamer, the uniques will match up:
<a name="line-1288"></a>        instance C w7 (a8,b9) where
<a name="line-1289"></a>          type F (a8,b9) x10 = x10-&gt;a8
<a name="line-1290"></a>   so that we can compare the type pattern in the 'instance' decl and
<a name="line-1291"></a>   in the associated 'type' decl
<a name="line-1292"></a>
<a name="line-1293"></a>c.f. Note [TyVar binders for associated decls]
<a name="line-1294"></a>-}</span>
<a name="line-1295"></a>
<a name="line-1296"></a><a name="TyFamInstEqn"></a><span class='hs-comment'>-- | Type Family Instance Equation</span>
<a name="line-1297"></a><a name="TyFamInstEqn"></a><span class='hs-keyword'>type</span> <span class='hs-conid'>TyFamInstEqn</span> <span class='hs-varid'>pass</span> <span class='hs-keyglyph'>=</span> <span class='hs-conid'>FamEqn</span> <span class='hs-varid'>pass</span> <span class='hs-layout'>(</span><span class='hs-conid'>LHsType</span> <span class='hs-varid'>pass</span><span class='hs-layout'>)</span>
<a name="line-1298"></a>            <span class='hs-comment'>-- Here, the @pats@ are type patterns (with kind and type bndrs).</span>
<a name="line-1299"></a>            <span class='hs-comment'>-- See Note [Family instance declaration binders]</span>
<a name="line-1300"></a>
<a name="line-1301"></a><a name="TyFamDefltDecl"></a><span class='hs-comment'>-- | Type family default declarations.</span>
<a name="line-1302"></a><a name="TyFamDefltDecl"></a><span class='hs-comment'>-- A convenient synonym for 'TyFamInstDecl'.</span>
<a name="line-1303"></a><a name="TyFamDefltDecl"></a><span class='hs-comment'>-- See @Note [Type family instance declarations in HsSyn]@.</span>
<a name="line-1304"></a><a name="TyFamDefltDecl"></a><span class='hs-keyword'>type</span> <span class='hs-conid'>TyFamDefltDecl</span> <span class='hs-keyglyph'>=</span> <span class='hs-conid'>TyFamInstDecl</span>
<a name="line-1305"></a>
<a name="line-1306"></a><a name="LTyFamDefltDecl"></a><span class='hs-comment'>-- | Located type family default declarations.</span>
<a name="line-1307"></a><a name="LTyFamDefltDecl"></a><span class='hs-keyword'>type</span> <span class='hs-conid'>LTyFamDefltDecl</span> <span class='hs-varid'>pass</span> <span class='hs-keyglyph'>=</span> <span class='hs-conid'>XRec</span> <span class='hs-varid'>pass</span> <span class='hs-layout'>(</span><span class='hs-conid'>TyFamDefltDecl</span> <span class='hs-varid'>pass</span><span class='hs-layout'>)</span>
<a name="line-1308"></a>
<a name="line-1309"></a><a name="LTyFamInstDecl"></a><span class='hs-comment'>-- | Located Type Family Instance Declaration</span>
<a name="line-1310"></a><a name="LTyFamInstDecl"></a><span class='hs-keyword'>type</span> <span class='hs-conid'>LTyFamInstDecl</span> <span class='hs-varid'>pass</span> <span class='hs-keyglyph'>=</span> <span class='hs-conid'>XRec</span> <span class='hs-varid'>pass</span> <span class='hs-layout'>(</span><span class='hs-conid'>TyFamInstDecl</span> <span class='hs-varid'>pass</span><span class='hs-layout'>)</span>
<a name="line-1311"></a>
<a name="line-1312"></a><a name="TyFamInstDecl"></a><span class='hs-comment'>-- | Type Family Instance Declaration</span>
<a name="line-1313"></a><a name="TyFamInstDecl"></a><span class='hs-keyword'>data</span> <span class='hs-conid'>TyFamInstDecl</span> <span class='hs-varid'>pass</span>
<a name="line-1314"></a>  <span class='hs-keyglyph'>=</span> <span class='hs-conid'>TyFamInstDecl</span> <span class='hs-layout'>{</span> <span class='hs-varid'>tfid_xtn</span> <span class='hs-keyglyph'>::</span> <span class='hs-conid'>XCTyFamInstDecl</span> <span class='hs-varid'>pass</span>
<a name="line-1315"></a>                  <span class='hs-layout'>,</span> <span class='hs-varid'>tfid_eqn</span> <span class='hs-keyglyph'>::</span> <span class='hs-conid'>TyFamInstEqn</span> <span class='hs-varid'>pass</span> <span class='hs-layout'>}</span>
<a name="line-1316"></a>    <span class='hs-comment'>-- ^</span>
<a name="line-1317"></a>    <span class='hs-comment'>--  - 'GHC.Parser.Annotation.AnnKeywordId' : 'GHC.Parser.Annotation.AnnType',</span>
<a name="line-1318"></a>    <span class='hs-comment'>--           'GHC.Parser.Annotation.AnnInstance',</span>
<a name="line-1319"></a>
<a name="line-1320"></a>    <span class='hs-comment'>-- For details on above see note [exact print annotations] in GHC.Parser.Annotation</span>
<a name="line-1321"></a>  <span class='hs-keyglyph'>|</span> <span class='hs-conid'>XTyFamInstDecl</span> <span class='hs-varop'>!</span><span class='hs-layout'>(</span><span class='hs-conid'>XXTyFamInstDecl</span> <span class='hs-varid'>pass</span><span class='hs-layout'>)</span>
<a name="line-1322"></a>
<a name="line-1323"></a><span class='hs-comment'>----------------- Data family instances -------------</span>
<a name="line-1324"></a>
<a name="line-1325"></a><a name="LDataFamInstDecl"></a><span class='hs-comment'>-- | Located Data Family Instance Declaration</span>
<a name="line-1326"></a><a name="LDataFamInstDecl"></a><span class='hs-keyword'>type</span> <span class='hs-conid'>LDataFamInstDecl</span> <span class='hs-varid'>pass</span> <span class='hs-keyglyph'>=</span> <span class='hs-conid'>XRec</span> <span class='hs-varid'>pass</span> <span class='hs-layout'>(</span><span class='hs-conid'>DataFamInstDecl</span> <span class='hs-varid'>pass</span><span class='hs-layout'>)</span>
<a name="line-1327"></a>
<a name="line-1328"></a><a name="DataFamInstDecl"></a><span class='hs-comment'>-- | Data Family Instance Declaration</span>
<a name="line-1329"></a><a name="DataFamInstDecl"></a><span class='hs-keyword'>newtype</span> <span class='hs-conid'>DataFamInstDecl</span> <span class='hs-varid'>pass</span>
<a name="line-1330"></a>  <span class='hs-keyglyph'>=</span> <span class='hs-conid'>DataFamInstDecl</span> <span class='hs-layout'>{</span> <span class='hs-varid'>dfid_eqn</span> <span class='hs-keyglyph'>::</span> <span class='hs-conid'>FamEqn</span> <span class='hs-varid'>pass</span> <span class='hs-layout'>(</span><span class='hs-conid'>HsDataDefn</span> <span class='hs-varid'>pass</span><span class='hs-layout'>)</span> <span class='hs-layout'>}</span>
<a name="line-1331"></a>    <span class='hs-comment'>-- ^</span>
<a name="line-1332"></a>    <span class='hs-comment'>--  - 'GHC.Parser.Annotation.AnnKeywordId' : 'GHC.Parser.Annotation.AnnData',</span>
<a name="line-1333"></a>    <span class='hs-comment'>--           'GHC.Parser.Annotation.AnnNewType','GHC.Parser.Annotation.AnnInstance',</span>
<a name="line-1334"></a>    <span class='hs-comment'>--           'GHC.Parser.Annotation.AnnDcolon'</span>
<a name="line-1335"></a>    <span class='hs-comment'>--           'GHC.Parser.Annotation.AnnWhere','GHC.Parser.Annotation.AnnOpen',</span>
<a name="line-1336"></a>    <span class='hs-comment'>--           'GHC.Parser.Annotation.AnnClose'</span>
<a name="line-1337"></a>
<a name="line-1338"></a>    <span class='hs-comment'>-- For details on above see note [exact print annotations] in GHC.Parser.Annotation</span>
<a name="line-1339"></a>
<a name="line-1340"></a><span class='hs-comment'>----------------- Family instances (common types) -------------</span>
<a name="line-1341"></a>
<a name="line-1342"></a><a name="FamEqn"></a><span class='hs-comment'>-- | Family Equation</span>
<a name="line-1343"></a><a name="FamEqn"></a><span class='hs-comment'>--</span>
<a name="line-1344"></a><a name="FamEqn"></a><span class='hs-comment'>-- One equation in a type family instance declaration, data family instance</span>
<a name="line-1345"></a><a name="FamEqn"></a><span class='hs-comment'>-- declaration, or type family default.</span>
<a name="line-1346"></a><a name="FamEqn"></a><span class='hs-comment'>-- See Note [Type family instance declarations in HsSyn]</span>
<a name="line-1347"></a><a name="FamEqn"></a><span class='hs-comment'>-- See Note [Family instance declaration binders]</span>
<a name="line-1348"></a><a name="FamEqn"></a><span class='hs-keyword'>data</span> <span class='hs-conid'>FamEqn</span> <span class='hs-varid'>pass</span> <span class='hs-varid'>rhs</span>
<a name="line-1349"></a>  <span class='hs-keyglyph'>=</span> <span class='hs-conid'>FamEqn</span>
<a name="line-1350"></a>       <span class='hs-layout'>{</span> <span class='hs-varid'>feqn_ext</span>    <span class='hs-keyglyph'>::</span> <span class='hs-conid'>XCFamEqn</span> <span class='hs-varid'>pass</span> <span class='hs-varid'>rhs</span>
<a name="line-1351"></a>       <span class='hs-layout'>,</span> <span class='hs-varid'>feqn_tycon</span>  <span class='hs-keyglyph'>::</span> <span class='hs-conid'>LIdP</span> <span class='hs-varid'>pass</span>
<a name="line-1352"></a>       <span class='hs-layout'>,</span> <span class='hs-varid'>feqn_bndrs</span>  <span class='hs-keyglyph'>::</span> <span class='hs-conid'>HsOuterFamEqnTyVarBndrs</span> <span class='hs-varid'>pass</span> <span class='hs-comment'>-- ^ Optional quantified type vars</span>
<a name="line-1353"></a>       <span class='hs-layout'>,</span> <span class='hs-varid'>feqn_pats</span>   <span class='hs-keyglyph'>::</span> <span class='hs-conid'>HsTyPats</span> <span class='hs-varid'>pass</span>
<a name="line-1354"></a>       <span class='hs-layout'>,</span> <span class='hs-varid'>feqn_fixity</span> <span class='hs-keyglyph'>::</span> <span class='hs-conid'>LexicalFixity</span> <span class='hs-comment'>-- ^ Fixity used in the declaration</span>
<a name="line-1355"></a>       <span class='hs-layout'>,</span> <span class='hs-varid'>feqn_rhs</span>    <span class='hs-keyglyph'>::</span> <span class='hs-varid'>rhs</span>
<a name="line-1356"></a>       <span class='hs-layout'>}</span>
<a name="line-1357"></a>    <span class='hs-comment'>-- ^</span>
<a name="line-1358"></a>    <span class='hs-comment'>--  - 'GHC.Parser.Annotation.AnnKeywordId' : 'GHC.Parser.Annotation.AnnEqual'</span>
<a name="line-1359"></a>  <span class='hs-keyglyph'>|</span> <span class='hs-conid'>XFamEqn</span> <span class='hs-varop'>!</span><span class='hs-layout'>(</span><span class='hs-conid'>XXFamEqn</span> <span class='hs-varid'>pass</span> <span class='hs-varid'>rhs</span><span class='hs-layout'>)</span>
<a name="line-1360"></a>
<a name="line-1361"></a>    <span class='hs-comment'>-- For details on above see note [exact print annotations] in GHC.Parser.Annotation</span>
<a name="line-1362"></a>
<a name="line-1363"></a><span class='hs-comment'>----------------- Class instances -------------</span>
<a name="line-1364"></a>
<a name="line-1365"></a><a name="LClsInstDecl"></a><span class='hs-comment'>-- | Located Class Instance Declaration</span>
<a name="line-1366"></a><a name="LClsInstDecl"></a><span class='hs-keyword'>type</span> <span class='hs-conid'>LClsInstDecl</span> <span class='hs-varid'>pass</span> <span class='hs-keyglyph'>=</span> <span class='hs-conid'>XRec</span> <span class='hs-varid'>pass</span> <span class='hs-layout'>(</span><span class='hs-conid'>ClsInstDecl</span> <span class='hs-varid'>pass</span><span class='hs-layout'>)</span>
<a name="line-1367"></a>
<a name="line-1368"></a><a name="ClsInstDecl"></a><span class='hs-comment'>-- | Class Instance Declaration</span>
<a name="line-1369"></a><a name="ClsInstDecl"></a><span class='hs-keyword'>data</span> <span class='hs-conid'>ClsInstDecl</span> <span class='hs-varid'>pass</span>
<a name="line-1370"></a>  <span class='hs-keyglyph'>=</span> <span class='hs-conid'>ClsInstDecl</span>
<a name="line-1371"></a>      <span class='hs-layout'>{</span> <span class='hs-varid'>cid_ext</span>     <span class='hs-keyglyph'>::</span> <span class='hs-conid'>XCClsInstDecl</span> <span class='hs-varid'>pass</span>
<a name="line-1372"></a>      <span class='hs-layout'>,</span> <span class='hs-varid'>cid_poly_ty</span> <span class='hs-keyglyph'>::</span> <span class='hs-conid'>LHsSigType</span> <span class='hs-varid'>pass</span>    <span class='hs-comment'>-- Context =&gt; Class Instance-type</span>
<a name="line-1373"></a>                                          <span class='hs-comment'>-- Using a polytype means that the renamer conveniently</span>
<a name="line-1374"></a>                                          <span class='hs-comment'>-- figures out the quantified type variables for us.</span>
<a name="line-1375"></a>      <span class='hs-layout'>,</span> <span class='hs-varid'>cid_binds</span>         <span class='hs-keyglyph'>::</span> <span class='hs-conid'>LHsBinds</span> <span class='hs-varid'>pass</span>       <span class='hs-comment'>-- Class methods</span>
<a name="line-1376"></a>      <span class='hs-layout'>,</span> <span class='hs-varid'>cid_sigs</span>          <span class='hs-keyglyph'>::</span> <span class='hs-keyglyph'>[</span><span class='hs-conid'>LSig</span> <span class='hs-varid'>pass</span><span class='hs-keyglyph'>]</span>         <span class='hs-comment'>-- User-supplied pragmatic info</span>
<a name="line-1377"></a>      <span class='hs-layout'>,</span> <span class='hs-varid'>cid_tyfam_insts</span>   <span class='hs-keyglyph'>::</span> <span class='hs-keyglyph'>[</span><span class='hs-conid'>LTyFamInstDecl</span> <span class='hs-varid'>pass</span><span class='hs-keyglyph'>]</span>   <span class='hs-comment'>-- Type family instances</span>
<a name="line-1378"></a>      <span class='hs-layout'>,</span> <span class='hs-varid'>cid_datafam_insts</span> <span class='hs-keyglyph'>::</span> <span class='hs-keyglyph'>[</span><span class='hs-conid'>LDataFamInstDecl</span> <span class='hs-varid'>pass</span><span class='hs-keyglyph'>]</span> <span class='hs-comment'>-- Data family instances</span>
<a name="line-1379"></a>      <span class='hs-layout'>,</span> <span class='hs-varid'>cid_overlap_mode</span>  <span class='hs-keyglyph'>::</span> <span class='hs-conid'>Maybe</span> <span class='hs-layout'>(</span><span class='hs-conid'>XRec</span> <span class='hs-varid'>pass</span> <span class='hs-conid'>OverlapMode</span><span class='hs-layout'>)</span>
<a name="line-1380"></a>         <span class='hs-comment'>-- ^ - 'GHC.Parser.Annotation.AnnKeywordId' : 'GHC.Parser.Annotation.AnnOpen',</span>
<a name="line-1381"></a>         <span class='hs-comment'>--                                    'GHC.Parser.Annotation.AnnClose',</span>
<a name="line-1382"></a>
<a name="line-1383"></a>        <span class='hs-comment'>-- For details on above see note [exact print annotations] in GHC.Parser.Annotation</span>
<a name="line-1384"></a>      <span class='hs-layout'>}</span>
<a name="line-1385"></a>    <span class='hs-comment'>-- ^</span>
<a name="line-1386"></a>    <span class='hs-comment'>--  - 'GHC.Parser.Annotation.AnnKeywordId' : 'GHC.Parser.Annotation.AnnInstance',</span>
<a name="line-1387"></a>    <span class='hs-comment'>--           'GHC.Parser.Annotation.AnnWhere',</span>
<a name="line-1388"></a>    <span class='hs-comment'>--           'GHC.Parser.Annotation.AnnOpen','GHC.Parser.Annotation.AnnClose',</span>
<a name="line-1389"></a>
<a name="line-1390"></a>    <span class='hs-comment'>-- For details on above see note [exact print annotations] in GHC.Parser.Annotation</span>
<a name="line-1391"></a>  <span class='hs-keyglyph'>|</span> <span class='hs-conid'>XClsInstDecl</span> <span class='hs-varop'>!</span><span class='hs-layout'>(</span><span class='hs-conid'>XXClsInstDecl</span> <span class='hs-varid'>pass</span><span class='hs-layout'>)</span>
<a name="line-1392"></a>
<a name="line-1393"></a><span class='hs-comment'>----------------- Instances of all kinds -------------</span>
<a name="line-1394"></a>
<a name="line-1395"></a><a name="LInstDecl"></a><span class='hs-comment'>-- | Located Instance Declaration</span>
<a name="line-1396"></a><a name="LInstDecl"></a><span class='hs-keyword'>type</span> <span class='hs-conid'>LInstDecl</span> <span class='hs-varid'>pass</span> <span class='hs-keyglyph'>=</span> <span class='hs-conid'>XRec</span> <span class='hs-varid'>pass</span> <span class='hs-layout'>(</span><span class='hs-conid'>InstDecl</span> <span class='hs-varid'>pass</span><span class='hs-layout'>)</span>
<a name="line-1397"></a>
<a name="line-1398"></a><a name="InstDecl"></a><span class='hs-comment'>-- | Instance Declaration</span>
<a name="line-1399"></a><a name="InstDecl"></a><span class='hs-keyword'>data</span> <span class='hs-conid'>InstDecl</span> <span class='hs-varid'>pass</span>  <span class='hs-comment'>-- Both class and family instances</span>
<a name="line-1400"></a>  <span class='hs-keyglyph'>=</span> <span class='hs-conid'>ClsInstD</span>
<a name="line-1401"></a>      <span class='hs-layout'>{</span> <span class='hs-varid'>cid_d_ext</span> <span class='hs-keyglyph'>::</span> <span class='hs-conid'>XClsInstD</span> <span class='hs-varid'>pass</span>
<a name="line-1402"></a>      <span class='hs-layout'>,</span> <span class='hs-varid'>cid_inst</span>  <span class='hs-keyglyph'>::</span> <span class='hs-conid'>ClsInstDecl</span> <span class='hs-varid'>pass</span> <span class='hs-layout'>}</span>
<a name="line-1403"></a>  <span class='hs-keyglyph'>|</span> <span class='hs-conid'>DataFamInstD</span>              <span class='hs-comment'>-- data family instance</span>
<a name="line-1404"></a>      <span class='hs-layout'>{</span> <span class='hs-varid'>dfid_ext</span>  <span class='hs-keyglyph'>::</span> <span class='hs-conid'>XDataFamInstD</span> <span class='hs-varid'>pass</span>
<a name="line-1405"></a>      <span class='hs-layout'>,</span> <span class='hs-varid'>dfid_inst</span> <span class='hs-keyglyph'>::</span> <span class='hs-conid'>DataFamInstDecl</span> <span class='hs-varid'>pass</span> <span class='hs-layout'>}</span>
<a name="line-1406"></a>  <span class='hs-keyglyph'>|</span> <span class='hs-conid'>TyFamInstD</span>              <span class='hs-comment'>-- type family instance</span>
<a name="line-1407"></a>      <span class='hs-layout'>{</span> <span class='hs-varid'>tfid_ext</span>  <span class='hs-keyglyph'>::</span> <span class='hs-conid'>XTyFamInstD</span> <span class='hs-varid'>pass</span>
<a name="line-1408"></a>      <span class='hs-layout'>,</span> <span class='hs-varid'>tfid_inst</span> <span class='hs-keyglyph'>::</span> <span class='hs-conid'>TyFamInstDecl</span> <span class='hs-varid'>pass</span> <span class='hs-layout'>}</span>
<a name="line-1409"></a>  <span class='hs-keyglyph'>|</span> <span class='hs-conid'>XInstDecl</span> <span class='hs-varop'>!</span><span class='hs-layout'>(</span><span class='hs-conid'>XXInstDecl</span> <span class='hs-varid'>pass</span><span class='hs-layout'>)</span>
<a name="line-1410"></a>
<a name="line-1411"></a><span class='hs-comment'>{-
<a name="line-1412"></a>************************************************************************
<a name="line-1413"></a>*                                                                      *
<a name="line-1414"></a>\subsection[DerivDecl]{A stand-alone instance deriving declaration}
<a name="line-1415"></a>*                                                                      *
<a name="line-1416"></a>************************************************************************
<a name="line-1417"></a>-}</span>
<a name="line-1418"></a>
<a name="line-1419"></a><a name="LDerivDecl"></a><span class='hs-comment'>-- | Located stand-alone 'deriving instance' declaration</span>
<a name="line-1420"></a><a name="LDerivDecl"></a><span class='hs-keyword'>type</span> <span class='hs-conid'>LDerivDecl</span> <span class='hs-varid'>pass</span> <span class='hs-keyglyph'>=</span> <span class='hs-conid'>XRec</span> <span class='hs-varid'>pass</span> <span class='hs-layout'>(</span><span class='hs-conid'>DerivDecl</span> <span class='hs-varid'>pass</span><span class='hs-layout'>)</span>
<a name="line-1421"></a>
<a name="line-1422"></a><a name="DerivDecl"></a><span class='hs-comment'>-- | Stand-alone 'deriving instance' declaration</span>
<a name="line-1423"></a><a name="DerivDecl"></a><span class='hs-keyword'>data</span> <span class='hs-conid'>DerivDecl</span> <span class='hs-varid'>pass</span> <span class='hs-keyglyph'>=</span> <span class='hs-conid'>DerivDecl</span>
<a name="line-1424"></a>        <span class='hs-layout'>{</span> <span class='hs-varid'>deriv_ext</span>          <span class='hs-keyglyph'>::</span> <span class='hs-conid'>XCDerivDecl</span> <span class='hs-varid'>pass</span>
<a name="line-1425"></a>        <span class='hs-layout'>,</span> <span class='hs-varid'>deriv_type</span>         <span class='hs-keyglyph'>::</span> <span class='hs-conid'>LHsSigWcType</span> <span class='hs-varid'>pass</span>
<a name="line-1426"></a>          <span class='hs-comment'>-- ^ The instance type to derive.</span>
<a name="line-1427"></a>          <span class='hs-comment'>--</span>
<a name="line-1428"></a>          <span class='hs-comment'>-- It uses an 'LHsSigWcType' because the context is allowed to be a</span>
<a name="line-1429"></a>          <span class='hs-comment'>-- single wildcard:</span>
<a name="line-1430"></a>          <span class='hs-comment'>--</span>
<a name="line-1431"></a>          <span class='hs-comment'>-- &gt; deriving instance _ =&gt; Eq (Foo a)</span>
<a name="line-1432"></a>          <span class='hs-comment'>--</span>
<a name="line-1433"></a>          <span class='hs-comment'>-- Which signifies that the context should be inferred.</span>
<a name="line-1434"></a>
<a name="line-1435"></a>          <span class='hs-comment'>-- See Note [Inferring the instance context] in GHC.Tc.Deriv.Infer.</span>
<a name="line-1436"></a>
<a name="line-1437"></a>        <span class='hs-layout'>,</span> <span class='hs-varid'>deriv_strategy</span>     <span class='hs-keyglyph'>::</span> <span class='hs-conid'>Maybe</span> <span class='hs-layout'>(</span><span class='hs-conid'>LDerivStrategy</span> <span class='hs-varid'>pass</span><span class='hs-layout'>)</span>
<a name="line-1438"></a>        <span class='hs-layout'>,</span> <span class='hs-varid'>deriv_overlap_mode</span> <span class='hs-keyglyph'>::</span> <span class='hs-conid'>Maybe</span> <span class='hs-layout'>(</span><span class='hs-conid'>XRec</span> <span class='hs-varid'>pass</span> <span class='hs-conid'>OverlapMode</span><span class='hs-layout'>)</span>
<a name="line-1439"></a>         <span class='hs-comment'>-- ^ - 'GHC.Parser.Annotation.AnnKeywordId' : 'GHC.Parser.Annotation.AnnDeriving',</span>
<a name="line-1440"></a>         <span class='hs-comment'>--        'GHC.Parser.Annotation.AnnInstance', 'GHC.Parser.Annotation.AnnStock',</span>
<a name="line-1441"></a>         <span class='hs-comment'>--        'GHC.Parser.Annotation.AnnAnyClass', 'GHC.Parser.Annotation.AnnNewtype',</span>
<a name="line-1442"></a>         <span class='hs-comment'>--        'GHC.Parser.Annotation.AnnOpen','GHC.Parser.Annotation.AnnClose'</span>
<a name="line-1443"></a>
<a name="line-1444"></a>  <span class='hs-comment'>-- For details on above see note [exact print annotations] in GHC.Parser.Annotation</span>
<a name="line-1445"></a>        <span class='hs-layout'>}</span>
<a name="line-1446"></a>  <span class='hs-keyglyph'>|</span> <span class='hs-conid'>XDerivDecl</span> <span class='hs-varop'>!</span><span class='hs-layout'>(</span><span class='hs-conid'>XXDerivDecl</span> <span class='hs-varid'>pass</span><span class='hs-layout'>)</span>
<a name="line-1447"></a>
<a name="line-1448"></a><span class='hs-comment'>{-
<a name="line-1449"></a>************************************************************************
<a name="line-1450"></a>*                                                                      *
<a name="line-1451"></a>                Deriving strategies
<a name="line-1452"></a>*                                                                      *
<a name="line-1453"></a>************************************************************************
<a name="line-1454"></a>-}</span>
<a name="line-1455"></a>
<a name="line-1456"></a><a name="LDerivStrategy"></a><span class='hs-comment'>-- | A 'Located' 'DerivStrategy'.</span>
<a name="line-1457"></a><a name="LDerivStrategy"></a><span class='hs-keyword'>type</span> <span class='hs-conid'>LDerivStrategy</span> <span class='hs-varid'>pass</span> <span class='hs-keyglyph'>=</span> <span class='hs-conid'>XRec</span> <span class='hs-varid'>pass</span> <span class='hs-layout'>(</span><span class='hs-conid'>DerivStrategy</span> <span class='hs-varid'>pass</span><span class='hs-layout'>)</span>
<a name="line-1458"></a>
<a name="line-1459"></a><a name="DerivStrategy"></a><span class='hs-comment'>-- | Which technique the user explicitly requested when deriving an instance.</span>
<a name="line-1460"></a><a name="DerivStrategy"></a><span class='hs-keyword'>data</span> <span class='hs-conid'>DerivStrategy</span> <span class='hs-varid'>pass</span>
<a name="line-1461"></a>  <span class='hs-comment'>-- See Note [Deriving strategies] in GHC.Tc.Deriv</span>
<a name="line-1462"></a>  <span class='hs-keyglyph'>=</span> <span class='hs-conid'>StockStrategy</span> <span class='hs-layout'>(</span><span class='hs-conid'>XStockStrategy</span> <span class='hs-varid'>pass</span><span class='hs-layout'>)</span>
<a name="line-1463"></a>                     <span class='hs-comment'>-- ^ GHC's \"standard\" strategy, which is to implement a</span>
<a name="line-1464"></a>                     <span class='hs-comment'>--   custom instance for the data type. This only works</span>
<a name="line-1465"></a>                     <span class='hs-comment'>--   for certain types that GHC knows about (e.g., 'Eq',</span>
<a name="line-1466"></a>                     <span class='hs-comment'>--   'Show', 'Functor' when @-XDeriveFunctor@ is enabled,</span>
<a name="line-1467"></a>                     <span class='hs-comment'>--   etc.)</span>
<a name="line-1468"></a>  <span class='hs-keyglyph'>|</span> <span class='hs-conid'>AnyclassStrategy</span> <span class='hs-layout'>(</span><span class='hs-conid'>XAnyClassStrategy</span> <span class='hs-varid'>pass</span><span class='hs-layout'>)</span> <span class='hs-comment'>-- ^ @-XDeriveAnyClass@</span>
<a name="line-1469"></a>  <span class='hs-keyglyph'>|</span> <span class='hs-conid'>NewtypeStrategy</span>  <span class='hs-layout'>(</span><span class='hs-conid'>XNewtypeStrategy</span> <span class='hs-varid'>pass</span><span class='hs-layout'>)</span>  <span class='hs-comment'>-- ^ @-XGeneralizedNewtypeDeriving@</span>
<a name="line-1470"></a>  <span class='hs-keyglyph'>|</span> <span class='hs-conid'>ViaStrategy</span> <span class='hs-layout'>(</span><span class='hs-conid'>XViaStrategy</span> <span class='hs-varid'>pass</span><span class='hs-layout'>)</span>
<a name="line-1471"></a>                     <span class='hs-comment'>-- ^ @-XDerivingVia@</span>
<a name="line-1472"></a>
<a name="line-1473"></a><a name="derivStrategyName"></a><span class='hs-comment'>-- | A short description of a @DerivStrategy'@.</span>
<a name="line-1474"></a><span class='hs-definition'>derivStrategyName</span> <span class='hs-keyglyph'>::</span> <span class='hs-conid'>DerivStrategy</span> <span class='hs-varid'>a</span> <span class='hs-keyglyph'>-&gt;</span> <span class='hs-conid'>SDoc</span>
<a name="line-1475"></a><span class='hs-definition'>derivStrategyName</span> <span class='hs-keyglyph'>=</span> <span class='hs-varid'>text</span> <span class='hs-varop'>.</span> <span class='hs-varid'>go</span>
<a name="line-1476"></a>  <span class='hs-keyword'>where</span>
<a name="line-1477"></a>    <span class='hs-varid'>go</span> <span class='hs-conid'>StockStrategy</span>    <span class='hs-layout'>{</span><span class='hs-layout'>}</span> <span class='hs-keyglyph'>=</span> <span class='hs-str'>"stock"</span>
<a name="line-1478"></a>    <span class='hs-varid'>go</span> <span class='hs-conid'>AnyclassStrategy</span> <span class='hs-layout'>{</span><span class='hs-layout'>}</span> <span class='hs-keyglyph'>=</span> <span class='hs-str'>"anyclass"</span>
<a name="line-1479"></a>    <span class='hs-varid'>go</span> <span class='hs-conid'>NewtypeStrategy</span>  <span class='hs-layout'>{</span><span class='hs-layout'>}</span> <span class='hs-keyglyph'>=</span> <span class='hs-str'>"newtype"</span>
<a name="line-1480"></a>    <span class='hs-varid'>go</span> <span class='hs-conid'>ViaStrategy</span>      <span class='hs-layout'>{</span><span class='hs-layout'>}</span> <span class='hs-keyglyph'>=</span> <span class='hs-str'>"via"</span>
<a name="line-1481"></a>
<a name="line-1482"></a><span class='hs-comment'>{-
<a name="line-1483"></a>************************************************************************
<a name="line-1484"></a>*                                                                      *
<a name="line-1485"></a>\subsection[DefaultDecl]{A @default@ declaration}
<a name="line-1486"></a>*                                                                      *
<a name="line-1487"></a>************************************************************************
<a name="line-1488"></a>
<a name="line-1489"></a>There can only be one default declaration per module, but it is hard
<a name="line-1490"></a>for the parser to check that; we pass them all through in the abstract
<a name="line-1491"></a>syntax, and that restriction must be checked in the front end.
<a name="line-1492"></a>-}</span>
<a name="line-1493"></a>
<a name="line-1494"></a><a name="LDefaultDecl"></a><span class='hs-comment'>-- | Located Default Declaration</span>
<a name="line-1495"></a><a name="LDefaultDecl"></a><span class='hs-keyword'>type</span> <span class='hs-conid'>LDefaultDecl</span> <span class='hs-varid'>pass</span> <span class='hs-keyglyph'>=</span> <span class='hs-conid'>XRec</span> <span class='hs-varid'>pass</span> <span class='hs-layout'>(</span><span class='hs-conid'>DefaultDecl</span> <span class='hs-varid'>pass</span><span class='hs-layout'>)</span>
<a name="line-1496"></a>
<a name="line-1497"></a><a name="DefaultDecl"></a><span class='hs-comment'>-- | Default Declaration</span>
<a name="line-1498"></a><a name="DefaultDecl"></a><span class='hs-keyword'>data</span> <span class='hs-conid'>DefaultDecl</span> <span class='hs-varid'>pass</span>
<a name="line-1499"></a>  <span class='hs-keyglyph'>=</span> <span class='hs-conid'>DefaultDecl</span> <span class='hs-layout'>(</span><span class='hs-conid'>XCDefaultDecl</span> <span class='hs-varid'>pass</span><span class='hs-layout'>)</span> <span class='hs-keyglyph'>[</span><span class='hs-conid'>LHsType</span> <span class='hs-varid'>pass</span><span class='hs-keyglyph'>]</span>
<a name="line-1500"></a>        <span class='hs-comment'>-- ^ - 'GHC.Parser.Annotation.AnnKeywordId's : 'GHC.Parser.Annotation.AnnDefault',</span>
<a name="line-1501"></a>        <span class='hs-comment'>--          'GHC.Parser.Annotation.AnnOpen','GHC.Parser.Annotation.AnnClose'</span>
<a name="line-1502"></a>
<a name="line-1503"></a>        <span class='hs-comment'>-- For details on above see note [exact print annotations] in GHC.Parser.Annotation</span>
<a name="line-1504"></a>  <span class='hs-keyglyph'>|</span> <span class='hs-conid'>XDefaultDecl</span> <span class='hs-varop'>!</span><span class='hs-layout'>(</span><span class='hs-conid'>XXDefaultDecl</span> <span class='hs-varid'>pass</span><span class='hs-layout'>)</span>
<a name="line-1505"></a>
<a name="line-1506"></a><span class='hs-comment'>{-
<a name="line-1507"></a>************************************************************************
<a name="line-1508"></a>*                                                                      *
<a name="line-1509"></a>\subsection{Foreign function interface declaration}
<a name="line-1510"></a>*                                                                      *
<a name="line-1511"></a>************************************************************************
<a name="line-1512"></a>-}</span>
<a name="line-1513"></a>
<a name="line-1514"></a><span class='hs-comment'>-- foreign declarations are distinguished as to whether they define or use a</span>
<a name="line-1515"></a><span class='hs-comment'>-- Haskell name</span>
<a name="line-1516"></a><span class='hs-comment'>--</span>
<a name="line-1517"></a><span class='hs-comment'>--  * the Boolean value indicates whether the pre-standard deprecated syntax</span>
<a name="line-1518"></a><span class='hs-comment'>--   has been used</span>
<a name="line-1519"></a>
<a name="line-1520"></a><a name="LForeignDecl"></a><span class='hs-comment'>-- | Located Foreign Declaration</span>
<a name="line-1521"></a><a name="LForeignDecl"></a><span class='hs-keyword'>type</span> <span class='hs-conid'>LForeignDecl</span> <span class='hs-varid'>pass</span> <span class='hs-keyglyph'>=</span> <span class='hs-conid'>XRec</span> <span class='hs-varid'>pass</span> <span class='hs-layout'>(</span><span class='hs-conid'>ForeignDecl</span> <span class='hs-varid'>pass</span><span class='hs-layout'>)</span>
<a name="line-1522"></a>
<a name="line-1523"></a><a name="ForeignDecl"></a><span class='hs-comment'>-- | Foreign Declaration</span>
<a name="line-1524"></a><a name="ForeignDecl"></a><span class='hs-keyword'>data</span> <span class='hs-conid'>ForeignDecl</span> <span class='hs-varid'>pass</span>
<a name="line-1525"></a>  <span class='hs-keyglyph'>=</span> <span class='hs-conid'>ForeignImport</span>
<a name="line-1526"></a>      <span class='hs-layout'>{</span> <span class='hs-varid'>fd_i_ext</span>  <span class='hs-keyglyph'>::</span> <span class='hs-conid'>XForeignImport</span> <span class='hs-varid'>pass</span>   <span class='hs-comment'>-- Post typechecker, rep_ty ~ sig_ty</span>
<a name="line-1527"></a>      <span class='hs-layout'>,</span> <span class='hs-varid'>fd_name</span>   <span class='hs-keyglyph'>::</span> <span class='hs-conid'>LIdP</span> <span class='hs-varid'>pass</span>             <span class='hs-comment'>-- defines this name</span>
<a name="line-1528"></a>      <span class='hs-layout'>,</span> <span class='hs-varid'>fd_sig_ty</span> <span class='hs-keyglyph'>::</span> <span class='hs-conid'>LHsSigType</span> <span class='hs-varid'>pass</span>       <span class='hs-comment'>-- sig_ty</span>
<a name="line-1529"></a>      <span class='hs-layout'>,</span> <span class='hs-varid'>fd_fi</span>     <span class='hs-keyglyph'>::</span> <span class='hs-conid'>ForeignImport</span> <span class='hs-layout'>}</span>
<a name="line-1530"></a>
<a name="line-1531"></a>  <span class='hs-keyglyph'>|</span> <span class='hs-conid'>ForeignExport</span>
<a name="line-1532"></a>      <span class='hs-layout'>{</span> <span class='hs-varid'>fd_e_ext</span>  <span class='hs-keyglyph'>::</span> <span class='hs-conid'>XForeignExport</span> <span class='hs-varid'>pass</span>   <span class='hs-comment'>-- Post typechecker, rep_ty ~ sig_ty</span>
<a name="line-1533"></a>      <span class='hs-layout'>,</span> <span class='hs-varid'>fd_name</span>   <span class='hs-keyglyph'>::</span> <span class='hs-conid'>LIdP</span> <span class='hs-varid'>pass</span>             <span class='hs-comment'>-- uses this name</span>
<a name="line-1534"></a>      <span class='hs-layout'>,</span> <span class='hs-varid'>fd_sig_ty</span> <span class='hs-keyglyph'>::</span> <span class='hs-conid'>LHsSigType</span> <span class='hs-varid'>pass</span>       <span class='hs-comment'>-- sig_ty</span>
<a name="line-1535"></a>      <span class='hs-layout'>,</span> <span class='hs-varid'>fd_fe</span>     <span class='hs-keyglyph'>::</span> <span class='hs-conid'>ForeignExport</span> <span class='hs-layout'>}</span>
<a name="line-1536"></a>        <span class='hs-comment'>-- ^</span>
<a name="line-1537"></a>        <span class='hs-comment'>--  - 'GHC.Parser.Annotation.AnnKeywordId' : 'GHC.Parser.Annotation.AnnForeign',</span>
<a name="line-1538"></a>        <span class='hs-comment'>--           'GHC.Parser.Annotation.AnnImport','GHC.Parser.Annotation.AnnExport',</span>
<a name="line-1539"></a>        <span class='hs-comment'>--           'GHC.Parser.Annotation.AnnDcolon'</span>
<a name="line-1540"></a>
<a name="line-1541"></a>        <span class='hs-comment'>-- For details on above see note [exact print annotations] in GHC.Parser.Annotation</span>
<a name="line-1542"></a>  <span class='hs-keyglyph'>|</span> <span class='hs-conid'>XForeignDecl</span> <span class='hs-varop'>!</span><span class='hs-layout'>(</span><span class='hs-conid'>XXForeignDecl</span> <span class='hs-varid'>pass</span><span class='hs-layout'>)</span>
<a name="line-1543"></a>
<a name="line-1544"></a><span class='hs-comment'>{-
<a name="line-1545"></a>    In both ForeignImport and ForeignExport:
<a name="line-1546"></a>        sig_ty is the type given in the Haskell code
<a name="line-1547"></a>        rep_ty is the representation for this type, i.e. with newtypes
<a name="line-1548"></a>               coerced away and type functions evaluated.
<a name="line-1549"></a>    Thus if the declaration is valid, then rep_ty will only use types
<a name="line-1550"></a>    such as Int and IO that we know how to make foreign calls with.
<a name="line-1551"></a>-}</span>
<a name="line-1552"></a>
<a name="line-1553"></a><a name="ForeignImport"></a><span class='hs-comment'>-- Specification Of an imported external entity in dependence on the calling</span>
<a name="line-1554"></a><a name="ForeignImport"></a><span class='hs-comment'>-- convention</span>
<a name="line-1555"></a><a name="ForeignImport"></a><span class='hs-comment'>--</span>
<a name="line-1556"></a><a name="ForeignImport"></a><span class='hs-keyword'>data</span> <span class='hs-conid'>ForeignImport</span> <span class='hs-keyglyph'>=</span> <span class='hs-comment'>-- import of a C entity</span>
<a name="line-1557"></a>                     <span class='hs-comment'>--</span>
<a name="line-1558"></a>                     <span class='hs-comment'>--  * the two strings specifying a header file or library</span>
<a name="line-1559"></a>                     <span class='hs-comment'>--   may be empty, which indicates the absence of a</span>
<a name="line-1560"></a>                     <span class='hs-comment'>--   header or object specification (both are not used</span>
<a name="line-1561"></a>                     <span class='hs-comment'>--   in the case of `CWrapper' and when `CFunction'</span>
<a name="line-1562"></a>                     <span class='hs-comment'>--   has a dynamic target)</span>
<a name="line-1563"></a>                     <span class='hs-comment'>--</span>
<a name="line-1564"></a>                     <span class='hs-comment'>--  * the calling convention is irrelevant for code</span>
<a name="line-1565"></a>                     <span class='hs-comment'>--   generation in the case of `CLabel', but is needed</span>
<a name="line-1566"></a>                     <span class='hs-comment'>--   for pretty printing</span>
<a name="line-1567"></a>                     <span class='hs-comment'>--</span>
<a name="line-1568"></a>                     <span class='hs-comment'>--  * `Safety' is irrelevant for `CLabel' and `CWrapper'</span>
<a name="line-1569"></a>                     <span class='hs-comment'>--</span>
<a name="line-1570"></a>                     <span class='hs-conid'>CImport</span>  <span class='hs-layout'>(</span><span class='hs-conid'>Located</span> <span class='hs-conid'>CCallConv</span><span class='hs-layout'>)</span> <span class='hs-comment'>-- ccall or stdcall</span>
<a name="line-1571"></a>                              <span class='hs-layout'>(</span><span class='hs-conid'>Located</span> <span class='hs-conid'>Safety</span><span class='hs-layout'>)</span>  <span class='hs-comment'>-- interruptible, safe or unsafe</span>
<a name="line-1572"></a>                              <span class='hs-layout'>(</span><span class='hs-conid'>Maybe</span> <span class='hs-conid'>Header</span><span class='hs-layout'>)</span>       <span class='hs-comment'>-- name of C header</span>
<a name="line-1573"></a>                              <span class='hs-conid'>CImportSpec</span>          <span class='hs-comment'>-- details of the C entity</span>
<a name="line-1574"></a>                              <span class='hs-layout'>(</span><span class='hs-conid'>Located</span> <span class='hs-conid'>SourceText</span><span class='hs-layout'>)</span> <span class='hs-comment'>-- original source text for</span>
<a name="line-1575"></a>                                                   <span class='hs-comment'>-- the C entity</span>
<a name="line-1576"></a>  <span class='hs-keyword'>deriving</span> <span class='hs-conid'>Data</span>
<a name="line-1577"></a>
<a name="line-1578"></a><a name="CImportSpec"></a><span class='hs-comment'>-- details of an external C entity</span>
<a name="line-1579"></a><a name="CImportSpec"></a><span class='hs-comment'>--</span>
<a name="line-1580"></a><a name="CImportSpec"></a><span class='hs-keyword'>data</span> <span class='hs-conid'>CImportSpec</span> <span class='hs-keyglyph'>=</span> <span class='hs-conid'>CLabel</span>    <span class='hs-conid'>CLabelString</span>     <span class='hs-comment'>-- import address of a C label</span>
<a name="line-1581"></a>                 <span class='hs-keyglyph'>|</span> <span class='hs-conid'>CFunction</span> <span class='hs-conid'>CCallTarget</span>      <span class='hs-comment'>-- static or dynamic function</span>
<a name="line-1582"></a>                 <span class='hs-keyglyph'>|</span> <span class='hs-conid'>CWrapper</span>                   <span class='hs-comment'>-- wrapper to expose closures</span>
<a name="line-1583"></a>                                              <span class='hs-comment'>-- (former f.e.d.)</span>
<a name="line-1584"></a>  <span class='hs-keyword'>deriving</span> <span class='hs-conid'>Data</span>
<a name="line-1585"></a>
<a name="line-1586"></a><a name="ForeignExport"></a><span class='hs-comment'>-- specification of an externally exported entity in dependence on the calling</span>
<a name="line-1587"></a><a name="ForeignExport"></a><span class='hs-comment'>-- convention</span>
<a name="line-1588"></a><a name="ForeignExport"></a><span class='hs-comment'>--</span>
<a name="line-1589"></a><a name="ForeignExport"></a><span class='hs-keyword'>data</span> <span class='hs-conid'>ForeignExport</span> <span class='hs-keyglyph'>=</span> <span class='hs-conid'>CExport</span>  <span class='hs-layout'>(</span><span class='hs-conid'>Located</span> <span class='hs-conid'>CExportSpec</span><span class='hs-layout'>)</span> <span class='hs-comment'>-- contains the calling</span>
<a name="line-1590"></a>                                                    <span class='hs-comment'>-- convention</span>
<a name="line-1591"></a>                              <span class='hs-layout'>(</span><span class='hs-conid'>Located</span> <span class='hs-conid'>SourceText</span><span class='hs-layout'>)</span>  <span class='hs-comment'>-- original source text for</span>
<a name="line-1592"></a>                                                    <span class='hs-comment'>-- the C entity</span>
<a name="line-1593"></a>  <span class='hs-keyword'>deriving</span> <span class='hs-conid'>Data</span>
<a name="line-1594"></a>
<a name="line-1595"></a><span class='hs-comment'>-- pretty printing of foreign declarations</span>
<a name="line-1596"></a><span class='hs-comment'>--</span>
<a name="line-1597"></a>
<a name="line-1598"></a><a name="instance%20Outputable%20ForeignImport"></a><span class='hs-keyword'>instance</span> <span class='hs-conid'>Outputable</span> <span class='hs-conid'>ForeignImport</span> <span class='hs-keyword'>where</span>
<a name="line-1599"></a>  <span class='hs-varid'>ppr</span> <span class='hs-layout'>(</span><span class='hs-conid'>CImport</span>  <span class='hs-varid'>cconv</span> <span class='hs-varid'>safety</span> <span class='hs-varid'>mHeader</span> <span class='hs-varid'>spec</span> <span class='hs-layout'>(</span><span class='hs-conid'>L</span> <span class='hs-keyword'>_</span> <span class='hs-varid'>srcText</span><span class='hs-layout'>)</span><span class='hs-layout'>)</span> <span class='hs-keyglyph'>=</span>
<a name="line-1600"></a>    <span class='hs-varid'>ppr</span> <span class='hs-varid'>cconv</span> <span class='hs-varop'>&lt;+&gt;</span> <span class='hs-varid'>ppr</span> <span class='hs-varid'>safety</span>
<a name="line-1601"></a>      <span class='hs-varop'>&lt;+&gt;</span> <span class='hs-varid'>pprWithSourceText</span> <span class='hs-varid'>srcText</span> <span class='hs-layout'>(</span><span class='hs-varid'>pprCEntity</span> <span class='hs-varid'>spec</span> <span class='hs-str'>""</span><span class='hs-layout'>)</span>
<a name="line-1602"></a>    <span class='hs-keyword'>where</span>
<a name="line-1603"></a>      <span class='hs-varid'>pp_hdr</span> <span class='hs-keyglyph'>=</span> <span class='hs-keyword'>case</span> <span class='hs-varid'>mHeader</span> <span class='hs-keyword'>of</span>
<a name="line-1604"></a>               <span class='hs-conid'>Nothing</span> <span class='hs-keyglyph'>-&gt;</span> <span class='hs-varid'>empty</span>
<a name="line-1605"></a>               <span class='hs-conid'>Just</span> <span class='hs-layout'>(</span><span class='hs-conid'>Header</span> <span class='hs-keyword'>_</span> <span class='hs-varid'>header</span><span class='hs-layout'>)</span> <span class='hs-keyglyph'>-&gt;</span> <span class='hs-varid'>ftext</span> <span class='hs-varid'>header</span>
<a name="line-1606"></a>
<a name="line-1607"></a>      <span class='hs-varid'>pprCEntity</span> <span class='hs-layout'>(</span><span class='hs-conid'>CLabel</span> <span class='hs-varid'>lbl</span><span class='hs-layout'>)</span> <span class='hs-keyword'>_</span> <span class='hs-keyglyph'>=</span>
<a name="line-1608"></a>        <span class='hs-varid'>doubleQuotes</span> <span class='hs-varop'>$</span> <span class='hs-varid'>text</span> <span class='hs-str'>"static"</span> <span class='hs-varop'>&lt;+&gt;</span> <span class='hs-varid'>pp_hdr</span> <span class='hs-varop'>&lt;+&gt;</span> <span class='hs-varid'>char</span> <span class='hs-chr'>'&amp;'</span> <span class='hs-varop'>&lt;&gt;</span> <span class='hs-varid'>ppr</span> <span class='hs-varid'>lbl</span>
<a name="line-1609"></a>      <span class='hs-varid'>pprCEntity</span> <span class='hs-layout'>(</span><span class='hs-conid'>CFunction</span> <span class='hs-layout'>(</span><span class='hs-conid'>StaticTarget</span> <span class='hs-varid'>st</span> <span class='hs-sel'>_lbl</span> <span class='hs-keyword'>_</span> <span class='hs-varid'>isFun</span><span class='hs-layout'>)</span><span class='hs-layout'>)</span> <span class='hs-varid'>src</span> <span class='hs-keyglyph'>=</span>
<a name="line-1610"></a>        <span class='hs-keyword'>if</span> <span class='hs-varid'>dqNeeded</span> <span class='hs-keyword'>then</span> <span class='hs-varid'>doubleQuotes</span> <span class='hs-varid'>ce</span> <span class='hs-keyword'>else</span> <span class='hs-varid'>empty</span>
<a name="line-1611"></a>          <span class='hs-keyword'>where</span>
<a name="line-1612"></a>            <span class='hs-varid'>dqNeeded</span> <span class='hs-keyglyph'>=</span> <span class='hs-layout'>(</span><span class='hs-varid'>take</span> <span class='hs-num'>6</span> <span class='hs-varid'>src</span> <span class='hs-varop'>==</span> <span class='hs-str'>"static"</span><span class='hs-layout'>)</span>
<a name="line-1613"></a>                    <span class='hs-varop'>||</span> <span class='hs-varid'>isJust</span> <span class='hs-varid'>mHeader</span>
<a name="line-1614"></a>                    <span class='hs-varop'>||</span> <span class='hs-varid'>not</span> <span class='hs-varid'>isFun</span>
<a name="line-1615"></a>                    <span class='hs-varop'>||</span> <span class='hs-varid'>st</span> <span class='hs-varop'>/=</span> <span class='hs-conid'>NoSourceText</span>
<a name="line-1616"></a>            <span class='hs-varid'>ce</span> <span class='hs-keyglyph'>=</span>
<a name="line-1617"></a>                  <span class='hs-comment'>-- We may need to drop leading spaces first</span>
<a name="line-1618"></a>                  <span class='hs-layout'>(</span><span class='hs-keyword'>if</span> <span class='hs-varid'>take</span> <span class='hs-num'>6</span> <span class='hs-varid'>src</span> <span class='hs-varop'>==</span> <span class='hs-str'>"static"</span> <span class='hs-keyword'>then</span> <span class='hs-varid'>text</span> <span class='hs-str'>"static"</span> <span class='hs-keyword'>else</span> <span class='hs-varid'>empty</span><span class='hs-layout'>)</span>
<a name="line-1619"></a>              <span class='hs-varop'>&lt;+&gt;</span> <span class='hs-varid'>pp_hdr</span>
<a name="line-1620"></a>              <span class='hs-varop'>&lt;+&gt;</span> <span class='hs-layout'>(</span><span class='hs-keyword'>if</span> <span class='hs-varid'>isFun</span> <span class='hs-keyword'>then</span> <span class='hs-varid'>empty</span> <span class='hs-keyword'>else</span> <span class='hs-varid'>text</span> <span class='hs-str'>"value"</span><span class='hs-layout'>)</span>
<a name="line-1621"></a>              <span class='hs-varop'>&lt;+&gt;</span> <span class='hs-layout'>(</span><span class='hs-varid'>pprWithSourceText</span> <span class='hs-varid'>st</span> <span class='hs-varid'>empty</span><span class='hs-layout'>)</span>
<a name="line-1622"></a>      <span class='hs-varid'>pprCEntity</span> <span class='hs-layout'>(</span><span class='hs-conid'>CFunction</span> <span class='hs-conid'>DynamicTarget</span><span class='hs-layout'>)</span> <span class='hs-keyword'>_</span> <span class='hs-keyglyph'>=</span>
<a name="line-1623"></a>        <span class='hs-varid'>doubleQuotes</span> <span class='hs-varop'>$</span> <span class='hs-varid'>text</span> <span class='hs-str'>"dynamic"</span>
<a name="line-1624"></a>      <span class='hs-varid'>pprCEntity</span> <span class='hs-conid'>CWrapper</span> <span class='hs-keyword'>_</span> <span class='hs-keyglyph'>=</span> <span class='hs-varid'>doubleQuotes</span> <span class='hs-varop'>$</span> <span class='hs-varid'>text</span> <span class='hs-str'>"wrapper"</span>
<a name="line-1625"></a>
<a name="line-1626"></a><a name="instance%20Outputable%20ForeignExport"></a><span class='hs-keyword'>instance</span> <span class='hs-conid'>Outputable</span> <span class='hs-conid'>ForeignExport</span> <span class='hs-keyword'>where</span>
<a name="line-1627"></a>  <span class='hs-varid'>ppr</span> <span class='hs-layout'>(</span><span class='hs-conid'>CExport</span>  <span class='hs-layout'>(</span><span class='hs-conid'>L</span> <span class='hs-keyword'>_</span> <span class='hs-layout'>(</span><span class='hs-conid'>CExportStatic</span> <span class='hs-keyword'>_</span> <span class='hs-varid'>lbl</span> <span class='hs-varid'>cconv</span><span class='hs-layout'>)</span><span class='hs-layout'>)</span> <span class='hs-keyword'>_</span><span class='hs-layout'>)</span> <span class='hs-keyglyph'>=</span>
<a name="line-1628"></a>    <span class='hs-varid'>ppr</span> <span class='hs-varid'>cconv</span> <span class='hs-varop'>&lt;+&gt;</span> <span class='hs-varid'>char</span> <span class='hs-chr'>'"'</span> <span class='hs-varop'>&lt;&gt;</span> <span class='hs-varid'>ppr</span> <span class='hs-varid'>lbl</span> <span class='hs-varop'>&lt;&gt;</span> <span class='hs-varid'>char</span> <span class='hs-chr'>'"'</span>
<a name="line-1629"></a>
<a name="line-1630"></a><span class='hs-comment'>{-
<a name="line-1631"></a>************************************************************************
<a name="line-1632"></a>*                                                                      *
<a name="line-1633"></a>\subsection{Rewrite rules}
<a name="line-1634"></a>*                                                                      *
<a name="line-1635"></a>************************************************************************
<a name="line-1636"></a>-}</span>
<a name="line-1637"></a>
<a name="line-1638"></a><a name="LRuleDecls"></a><span class='hs-comment'>-- | Located Rule Declarations</span>
<a name="line-1639"></a><a name="LRuleDecls"></a><span class='hs-keyword'>type</span> <span class='hs-conid'>LRuleDecls</span> <span class='hs-varid'>pass</span> <span class='hs-keyglyph'>=</span> <span class='hs-conid'>XRec</span> <span class='hs-varid'>pass</span> <span class='hs-layout'>(</span><span class='hs-conid'>RuleDecls</span> <span class='hs-varid'>pass</span><span class='hs-layout'>)</span>
<a name="line-1640"></a>
<a name="line-1641"></a>  <span class='hs-comment'>-- Note [Pragma source text] in GHC.Types.SourceText</span>
<a name="line-1642"></a><a name="RuleDecls"></a><span class='hs-comment'>-- | Rule Declarations</span>
<a name="line-1643"></a><a name="RuleDecls"></a><span class='hs-keyword'>data</span> <span class='hs-conid'>RuleDecls</span> <span class='hs-varid'>pass</span> <span class='hs-keyglyph'>=</span> <span class='hs-conid'>HsRules</span> <span class='hs-layout'>{</span> <span class='hs-varid'>rds_ext</span>   <span class='hs-keyglyph'>::</span> <span class='hs-conid'>XCRuleDecls</span> <span class='hs-varid'>pass</span>
<a name="line-1644"></a>                              <span class='hs-layout'>,</span> <span class='hs-varid'>rds_src</span>   <span class='hs-keyglyph'>::</span> <span class='hs-conid'>SourceText</span>
<a name="line-1645"></a>                              <span class='hs-layout'>,</span> <span class='hs-varid'>rds_rules</span> <span class='hs-keyglyph'>::</span> <span class='hs-keyglyph'>[</span><span class='hs-conid'>LRuleDecl</span> <span class='hs-varid'>pass</span><span class='hs-keyglyph'>]</span> <span class='hs-layout'>}</span>
<a name="line-1646"></a>  <span class='hs-keyglyph'>|</span> <span class='hs-conid'>XRuleDecls</span> <span class='hs-varop'>!</span><span class='hs-layout'>(</span><span class='hs-conid'>XXRuleDecls</span> <span class='hs-varid'>pass</span><span class='hs-layout'>)</span>
<a name="line-1647"></a>
<a name="line-1648"></a><a name="LRuleDecl"></a><span class='hs-comment'>-- | Located Rule Declaration</span>
<a name="line-1649"></a><a name="LRuleDecl"></a><span class='hs-keyword'>type</span> <span class='hs-conid'>LRuleDecl</span> <span class='hs-varid'>pass</span> <span class='hs-keyglyph'>=</span> <span class='hs-conid'>XRec</span> <span class='hs-varid'>pass</span> <span class='hs-layout'>(</span><span class='hs-conid'>RuleDecl</span> <span class='hs-varid'>pass</span><span class='hs-layout'>)</span>
<a name="line-1650"></a>
<a name="line-1651"></a><a name="RuleDecl"></a><span class='hs-comment'>-- | Rule Declaration</span>
<a name="line-1652"></a><a name="RuleDecl"></a><span class='hs-keyword'>data</span> <span class='hs-conid'>RuleDecl</span> <span class='hs-varid'>pass</span>
<a name="line-1653"></a>  <span class='hs-keyglyph'>=</span> <span class='hs-conid'>HsRule</span> <span class='hs-comment'>-- Source rule</span>
<a name="line-1654"></a>       <span class='hs-layout'>{</span> <span class='hs-varid'>rd_ext</span>  <span class='hs-keyglyph'>::</span> <span class='hs-conid'>XHsRule</span> <span class='hs-varid'>pass</span>
<a name="line-1655"></a>           <span class='hs-comment'>-- ^ After renamer, free-vars from the LHS and RHS</span>
<a name="line-1656"></a>       <span class='hs-layout'>,</span> <span class='hs-varid'>rd_name</span> <span class='hs-keyglyph'>::</span> <span class='hs-conid'>XRec</span> <span class='hs-varid'>pass</span> <span class='hs-layout'>(</span><span class='hs-conid'>SourceText</span><span class='hs-layout'>,</span><span class='hs-conid'>RuleName</span><span class='hs-layout'>)</span>
<a name="line-1657"></a>           <span class='hs-comment'>-- ^ Note [Pragma source text] in "GHC.Types.Basic"</span>
<a name="line-1658"></a>       <span class='hs-layout'>,</span> <span class='hs-varid'>rd_act</span>  <span class='hs-keyglyph'>::</span> <span class='hs-conid'>Activation</span>
<a name="line-1659"></a>       <span class='hs-layout'>,</span> <span class='hs-varid'>rd_tyvs</span> <span class='hs-keyglyph'>::</span> <span class='hs-conid'>Maybe</span> <span class='hs-keyglyph'>[</span><span class='hs-conid'>LHsTyVarBndr</span> <span class='hs-conid'>()</span> <span class='hs-layout'>(</span><span class='hs-conid'>NoGhcTc</span> <span class='hs-varid'>pass</span><span class='hs-layout'>)</span><span class='hs-keyglyph'>]</span>
<a name="line-1660"></a>           <span class='hs-comment'>-- ^ Forall'd type vars</span>
<a name="line-1661"></a>       <span class='hs-layout'>,</span> <span class='hs-varid'>rd_tmvs</span> <span class='hs-keyglyph'>::</span> <span class='hs-keyglyph'>[</span><span class='hs-conid'>LRuleBndr</span> <span class='hs-varid'>pass</span><span class='hs-keyglyph'>]</span>
<a name="line-1662"></a>           <span class='hs-comment'>-- ^ Forall'd term vars, before typechecking; after typechecking</span>
<a name="line-1663"></a>           <span class='hs-comment'>--    this includes all forall'd vars</span>
<a name="line-1664"></a>       <span class='hs-layout'>,</span> <span class='hs-varid'>rd_lhs</span>  <span class='hs-keyglyph'>::</span> <span class='hs-conid'>XRec</span> <span class='hs-varid'>pass</span> <span class='hs-layout'>(</span><span class='hs-conid'>HsExpr</span> <span class='hs-varid'>pass</span><span class='hs-layout'>)</span>
<a name="line-1665"></a>       <span class='hs-layout'>,</span> <span class='hs-varid'>rd_rhs</span>  <span class='hs-keyglyph'>::</span> <span class='hs-conid'>XRec</span> <span class='hs-varid'>pass</span> <span class='hs-layout'>(</span><span class='hs-conid'>HsExpr</span> <span class='hs-varid'>pass</span><span class='hs-layout'>)</span>
<a name="line-1666"></a>       <span class='hs-layout'>}</span>
<a name="line-1667"></a>    <span class='hs-comment'>-- ^</span>
<a name="line-1668"></a>    <span class='hs-comment'>--  - 'GHC.Parser.Annotation.AnnKeywordId' :</span>
<a name="line-1669"></a>    <span class='hs-comment'>--           'GHC.Parser.Annotation.AnnOpen','GHC.Parser.Annotation.AnnTilde',</span>
<a name="line-1670"></a>    <span class='hs-comment'>--           'GHC.Parser.Annotation.AnnVal',</span>
<a name="line-1671"></a>    <span class='hs-comment'>--           'GHC.Parser.Annotation.AnnClose',</span>
<a name="line-1672"></a>    <span class='hs-comment'>--           'GHC.Parser.Annotation.AnnForall','GHC.Parser.Annotation.AnnDot',</span>
<a name="line-1673"></a>    <span class='hs-comment'>--           'GHC.Parser.Annotation.AnnEqual',</span>
<a name="line-1674"></a>  <span class='hs-keyglyph'>|</span> <span class='hs-conid'>XRuleDecl</span> <span class='hs-varop'>!</span><span class='hs-layout'>(</span><span class='hs-conid'>XXRuleDecl</span> <span class='hs-varid'>pass</span><span class='hs-layout'>)</span>
<a name="line-1675"></a>
<a name="line-1676"></a><a name="HsRuleRn"></a><span class='hs-keyword'>data</span> <span class='hs-conid'>HsRuleRn</span> <span class='hs-keyglyph'>=</span> <span class='hs-conid'>HsRuleRn</span> <span class='hs-conid'>NameSet</span> <span class='hs-conid'>NameSet</span> <span class='hs-comment'>-- Free-vars from the LHS and RHS</span>
<a name="line-1677"></a>  <span class='hs-keyword'>deriving</span> <span class='hs-conid'>Data</span>
<a name="line-1678"></a>
<a name="line-1679"></a><a name="LRuleBndr"></a><span class='hs-comment'>-- | Located Rule Binder</span>
<a name="line-1680"></a><a name="LRuleBndr"></a><span class='hs-keyword'>type</span> <span class='hs-conid'>LRuleBndr</span> <span class='hs-varid'>pass</span> <span class='hs-keyglyph'>=</span> <span class='hs-conid'>XRec</span> <span class='hs-varid'>pass</span> <span class='hs-layout'>(</span><span class='hs-conid'>RuleBndr</span> <span class='hs-varid'>pass</span><span class='hs-layout'>)</span>
<a name="line-1681"></a>
<a name="line-1682"></a><a name="RuleBndr"></a><span class='hs-comment'>-- | Rule Binder</span>
<a name="line-1683"></a><a name="RuleBndr"></a><span class='hs-keyword'>data</span> <span class='hs-conid'>RuleBndr</span> <span class='hs-varid'>pass</span>
<a name="line-1684"></a>  <span class='hs-keyglyph'>=</span> <span class='hs-conid'>RuleBndr</span> <span class='hs-layout'>(</span><span class='hs-conid'>XCRuleBndr</span> <span class='hs-varid'>pass</span><span class='hs-layout'>)</span>  <span class='hs-layout'>(</span><span class='hs-conid'>LIdP</span> <span class='hs-varid'>pass</span><span class='hs-layout'>)</span>
<a name="line-1685"></a>  <span class='hs-keyglyph'>|</span> <span class='hs-conid'>RuleBndrSig</span> <span class='hs-layout'>(</span><span class='hs-conid'>XRuleBndrSig</span> <span class='hs-varid'>pass</span><span class='hs-layout'>)</span> <span class='hs-layout'>(</span><span class='hs-conid'>LIdP</span> <span class='hs-varid'>pass</span><span class='hs-layout'>)</span> <span class='hs-layout'>(</span><span class='hs-conid'>HsPatSigType</span> <span class='hs-varid'>pass</span><span class='hs-layout'>)</span>
<a name="line-1686"></a>  <span class='hs-keyglyph'>|</span> <span class='hs-conid'>XRuleBndr</span> <span class='hs-varop'>!</span><span class='hs-layout'>(</span><span class='hs-conid'>XXRuleBndr</span> <span class='hs-varid'>pass</span><span class='hs-layout'>)</span>
<a name="line-1687"></a>        <span class='hs-comment'>-- ^</span>
<a name="line-1688"></a>        <span class='hs-comment'>--  - 'GHC.Parser.Annotation.AnnKeywordId' : 'GHC.Parser.Annotation.AnnOpen',</span>
<a name="line-1689"></a>        <span class='hs-comment'>--     'GHC.Parser.Annotation.AnnDcolon','GHC.Parser.Annotation.AnnClose'</span>
<a name="line-1690"></a>
<a name="line-1691"></a>        <span class='hs-comment'>-- For details on above see note [exact print annotations] in GHC.Parser.Annotation</span>
<a name="line-1692"></a>
<a name="line-1693"></a><a name="collectRuleBndrSigTys"></a><span class='hs-definition'>collectRuleBndrSigTys</span> <span class='hs-keyglyph'>::</span> <span class='hs-keyglyph'>[</span><span class='hs-conid'>RuleBndr</span> <span class='hs-varid'>pass</span><span class='hs-keyglyph'>]</span> <span class='hs-keyglyph'>-&gt;</span> <span class='hs-keyglyph'>[</span><span class='hs-conid'>HsPatSigType</span> <span class='hs-varid'>pass</span><span class='hs-keyglyph'>]</span>
<a name="line-1694"></a><span class='hs-definition'>collectRuleBndrSigTys</span> <span class='hs-varid'>bndrs</span> <span class='hs-keyglyph'>=</span> <span class='hs-keyglyph'>[</span><span class='hs-varid'>ty</span> <span class='hs-keyglyph'>|</span> <span class='hs-conid'>RuleBndrSig</span> <span class='hs-keyword'>_</span> <span class='hs-keyword'>_</span> <span class='hs-varid'>ty</span> <span class='hs-keyglyph'>&lt;-</span> <span class='hs-varid'>bndrs</span><span class='hs-keyglyph'>]</span>
<a name="line-1695"></a>
<a name="line-1696"></a><a name="pprFullRuleName"></a><span class='hs-definition'>pprFullRuleName</span> <span class='hs-keyglyph'>::</span> <span class='hs-conid'>Located</span> <span class='hs-layout'>(</span><span class='hs-conid'>SourceText</span><span class='hs-layout'>,</span> <span class='hs-conid'>RuleName</span><span class='hs-layout'>)</span> <span class='hs-keyglyph'>-&gt;</span> <span class='hs-conid'>SDoc</span>
<a name="line-1697"></a><span class='hs-definition'>pprFullRuleName</span> <span class='hs-layout'>(</span><span class='hs-conid'>L</span> <span class='hs-keyword'>_</span> <span class='hs-layout'>(</span><span class='hs-varid'>st</span><span class='hs-layout'>,</span> <span class='hs-varid'>n</span><span class='hs-layout'>)</span><span class='hs-layout'>)</span> <span class='hs-keyglyph'>=</span> <span class='hs-varid'>pprWithSourceText</span> <span class='hs-varid'>st</span> <span class='hs-layout'>(</span><span class='hs-varid'>doubleQuotes</span> <span class='hs-varop'>$</span> <span class='hs-varid'>ftext</span> <span class='hs-varid'>n</span><span class='hs-layout'>)</span>
<a name="line-1698"></a>
<a name="line-1699"></a><span class='hs-comment'>{-
<a name="line-1700"></a>************************************************************************
<a name="line-1701"></a>*                                                                      *
<a name="line-1702"></a>\subsection[DocDecl]{Document comments}
<a name="line-1703"></a>*                                                                      *
<a name="line-1704"></a>************************************************************************
<a name="line-1705"></a>-}</span>
<a name="line-1706"></a>
<a name="line-1707"></a><a name="LDocDecl"></a><span class='hs-comment'>-- | Located Documentation comment Declaration</span>
<a name="line-1708"></a><a name="LDocDecl"></a><span class='hs-keyword'>type</span> <span class='hs-conid'>LDocDecl</span> <span class='hs-varid'>pass</span> <span class='hs-keyglyph'>=</span> <span class='hs-conid'>XRec</span> <span class='hs-varid'>pass</span> <span class='hs-layout'>(</span><span class='hs-conid'>DocDecl</span><span class='hs-layout'>)</span>
<a name="line-1709"></a>
<a name="line-1710"></a><a name="DocDecl"></a><span class='hs-comment'>-- | Documentation comment Declaration</span>
<a name="line-1711"></a><a name="DocDecl"></a><span class='hs-keyword'>data</span> <span class='hs-conid'>DocDecl</span>
<a name="line-1712"></a>  <span class='hs-keyglyph'>=</span> <span class='hs-conid'>DocCommentNext</span> <span class='hs-conid'>HsDocString</span>
<a name="line-1713"></a>  <span class='hs-keyglyph'>|</span> <span class='hs-conid'>DocCommentPrev</span> <span class='hs-conid'>HsDocString</span>
<a name="line-1714"></a>  <span class='hs-keyglyph'>|</span> <span class='hs-conid'>DocCommentNamed</span> <span class='hs-conid'>String</span> <span class='hs-conid'>HsDocString</span>
<a name="line-1715"></a>  <span class='hs-keyglyph'>|</span> <span class='hs-conid'>DocGroup</span> <span class='hs-conid'>Int</span> <span class='hs-conid'>HsDocString</span>
<a name="line-1716"></a>  <span class='hs-keyword'>deriving</span> <span class='hs-conid'>Data</span>
<a name="line-1717"></a>
<a name="line-1718"></a><a name="instance%20Outputable%20DocDecl"></a><span class='hs-comment'>-- Okay, I need to reconstruct the document comments, but for now:</span>
<a name="line-1719"></a><a name="instance%20Outputable%20DocDecl"></a><span class='hs-keyword'>instance</span> <span class='hs-conid'>Outputable</span> <span class='hs-conid'>DocDecl</span> <span class='hs-keyword'>where</span>
<a name="line-1720"></a>  <span class='hs-varid'>ppr</span> <span class='hs-keyword'>_</span> <span class='hs-keyglyph'>=</span> <span class='hs-varid'>text</span> <span class='hs-str'>"&lt;document comment&gt;"</span>
<a name="line-1721"></a>
<a name="line-1722"></a><a name="docDeclDoc"></a><span class='hs-definition'>docDeclDoc</span> <span class='hs-keyglyph'>::</span> <span class='hs-conid'>DocDecl</span> <span class='hs-keyglyph'>-&gt;</span> <span class='hs-conid'>HsDocString</span>
<a name="line-1723"></a><span class='hs-definition'>docDeclDoc</span> <span class='hs-layout'>(</span><span class='hs-conid'>DocCommentNext</span> <span class='hs-varid'>d</span><span class='hs-layout'>)</span> <span class='hs-keyglyph'>=</span> <span class='hs-varid'>d</span>
<a name="line-1724"></a><span class='hs-definition'>docDeclDoc</span> <span class='hs-layout'>(</span><span class='hs-conid'>DocCommentPrev</span> <span class='hs-varid'>d</span><span class='hs-layout'>)</span> <span class='hs-keyglyph'>=</span> <span class='hs-varid'>d</span>
<a name="line-1725"></a><span class='hs-definition'>docDeclDoc</span> <span class='hs-layout'>(</span><span class='hs-conid'>DocCommentNamed</span> <span class='hs-keyword'>_</span> <span class='hs-varid'>d</span><span class='hs-layout'>)</span> <span class='hs-keyglyph'>=</span> <span class='hs-varid'>d</span>
<a name="line-1726"></a><span class='hs-definition'>docDeclDoc</span> <span class='hs-layout'>(</span><span class='hs-conid'>DocGroup</span> <span class='hs-keyword'>_</span> <span class='hs-varid'>d</span><span class='hs-layout'>)</span> <span class='hs-keyglyph'>=</span> <span class='hs-varid'>d</span>
<a name="line-1727"></a>
<a name="line-1728"></a><span class='hs-comment'>{-
<a name="line-1729"></a>************************************************************************
<a name="line-1730"></a>*                                                                      *
<a name="line-1731"></a>\subsection[DeprecDecl]{Deprecations}
<a name="line-1732"></a>*                                                                      *
<a name="line-1733"></a>************************************************************************
<a name="line-1734"></a>
<a name="line-1735"></a>We use exported entities for things to deprecate.
<a name="line-1736"></a>-}</span>
<a name="line-1737"></a>
<a name="line-1738"></a><a name="LWarnDecls"></a><span class='hs-comment'>-- | Located Warning Declarations</span>
<a name="line-1739"></a><a name="LWarnDecls"></a><span class='hs-keyword'>type</span> <span class='hs-conid'>LWarnDecls</span> <span class='hs-varid'>pass</span> <span class='hs-keyglyph'>=</span> <span class='hs-conid'>XRec</span> <span class='hs-varid'>pass</span> <span class='hs-layout'>(</span><span class='hs-conid'>WarnDecls</span> <span class='hs-varid'>pass</span><span class='hs-layout'>)</span>
<a name="line-1740"></a>
<a name="line-1741"></a> <span class='hs-comment'>-- Note [Pragma source text] in GHC.Types.SourceText</span>
<a name="line-1742"></a><a name="WarnDecls"></a><span class='hs-comment'>-- | Warning pragma Declarations</span>
<a name="line-1743"></a><a name="WarnDecls"></a><span class='hs-keyword'>data</span> <span class='hs-conid'>WarnDecls</span> <span class='hs-varid'>pass</span> <span class='hs-keyglyph'>=</span> <span class='hs-conid'>Warnings</span> <span class='hs-layout'>{</span> <span class='hs-varid'>wd_ext</span>      <span class='hs-keyglyph'>::</span> <span class='hs-conid'>XWarnings</span> <span class='hs-varid'>pass</span>
<a name="line-1744"></a>                               <span class='hs-layout'>,</span> <span class='hs-varid'>wd_src</span>      <span class='hs-keyglyph'>::</span> <span class='hs-conid'>SourceText</span>
<a name="line-1745"></a>                               <span class='hs-layout'>,</span> <span class='hs-varid'>wd_warnings</span> <span class='hs-keyglyph'>::</span> <span class='hs-keyglyph'>[</span><span class='hs-conid'>LWarnDecl</span> <span class='hs-varid'>pass</span><span class='hs-keyglyph'>]</span>
<a name="line-1746"></a>                               <span class='hs-layout'>}</span>
<a name="line-1747"></a>  <span class='hs-keyglyph'>|</span> <span class='hs-conid'>XWarnDecls</span> <span class='hs-varop'>!</span><span class='hs-layout'>(</span><span class='hs-conid'>XXWarnDecls</span> <span class='hs-varid'>pass</span><span class='hs-layout'>)</span>
<a name="line-1748"></a>
<a name="line-1749"></a><a name="LWarnDecl"></a><span class='hs-comment'>-- | Located Warning pragma Declaration</span>
<a name="line-1750"></a><a name="LWarnDecl"></a><span class='hs-keyword'>type</span> <span class='hs-conid'>LWarnDecl</span> <span class='hs-varid'>pass</span> <span class='hs-keyglyph'>=</span> <span class='hs-conid'>XRec</span> <span class='hs-varid'>pass</span> <span class='hs-layout'>(</span><span class='hs-conid'>WarnDecl</span> <span class='hs-varid'>pass</span><span class='hs-layout'>)</span>
<a name="line-1751"></a>
<a name="line-1752"></a><a name="WarnDecl"></a><span class='hs-comment'>-- | Warning pragma Declaration</span>
<a name="line-1753"></a><a name="WarnDecl"></a><span class='hs-keyword'>data</span> <span class='hs-conid'>WarnDecl</span> <span class='hs-varid'>pass</span> <span class='hs-keyglyph'>=</span> <span class='hs-conid'>Warning</span> <span class='hs-layout'>(</span><span class='hs-conid'>XWarning</span> <span class='hs-varid'>pass</span><span class='hs-layout'>)</span> <span class='hs-keyglyph'>[</span><span class='hs-conid'>LIdP</span> <span class='hs-varid'>pass</span><span class='hs-keyglyph'>]</span> <span class='hs-conid'>WarningTxt</span>
<a name="line-1754"></a>                   <span class='hs-keyglyph'>|</span> <span class='hs-conid'>XWarnDecl</span> <span class='hs-varop'>!</span><span class='hs-layout'>(</span><span class='hs-conid'>XXWarnDecl</span> <span class='hs-varid'>pass</span><span class='hs-layout'>)</span>
<a name="line-1755"></a>
<a name="line-1756"></a><span class='hs-comment'>{-
<a name="line-1757"></a>************************************************************************
<a name="line-1758"></a>*                                                                      *
<a name="line-1759"></a>\subsection[AnnDecl]{Annotations}
<a name="line-1760"></a>*                                                                      *
<a name="line-1761"></a>************************************************************************
<a name="line-1762"></a>-}</span>
<a name="line-1763"></a>
<a name="line-1764"></a><a name="LAnnDecl"></a><span class='hs-comment'>-- | Located Annotation Declaration</span>
<a name="line-1765"></a><a name="LAnnDecl"></a><span class='hs-keyword'>type</span> <span class='hs-conid'>LAnnDecl</span> <span class='hs-varid'>pass</span> <span class='hs-keyglyph'>=</span> <span class='hs-conid'>XRec</span> <span class='hs-varid'>pass</span> <span class='hs-layout'>(</span><span class='hs-conid'>AnnDecl</span> <span class='hs-varid'>pass</span><span class='hs-layout'>)</span>
<a name="line-1766"></a>
<a name="line-1767"></a><a name="AnnDecl"></a><span class='hs-comment'>-- | Annotation Declaration</span>
<a name="line-1768"></a><a name="AnnDecl"></a><span class='hs-keyword'>data</span> <span class='hs-conid'>AnnDecl</span> <span class='hs-varid'>pass</span> <span class='hs-keyglyph'>=</span> <span class='hs-conid'>HsAnnotation</span>
<a name="line-1769"></a>                      <span class='hs-layout'>(</span><span class='hs-conid'>XHsAnnotation</span> <span class='hs-varid'>pass</span><span class='hs-layout'>)</span>
<a name="line-1770"></a>                      <span class='hs-conid'>SourceText</span> <span class='hs-comment'>-- Note [Pragma source text] in GHC.Types.SourceText</span>
<a name="line-1771"></a>                      <span class='hs-layout'>(</span><span class='hs-conid'>AnnProvenance</span> <span class='hs-varid'>pass</span><span class='hs-layout'>)</span> <span class='hs-layout'>(</span><span class='hs-conid'>XRec</span> <span class='hs-varid'>pass</span> <span class='hs-layout'>(</span><span class='hs-conid'>HsExpr</span> <span class='hs-varid'>pass</span><span class='hs-layout'>)</span><span class='hs-layout'>)</span>
<a name="line-1772"></a>      <span class='hs-comment'>-- ^ - 'GHC.Parser.Annotation.AnnKeywordId' : 'GHC.Parser.Annotation.AnnOpen',</span>
<a name="line-1773"></a>      <span class='hs-comment'>--           'GHC.Parser.Annotation.AnnType'</span>
<a name="line-1774"></a>      <span class='hs-comment'>--           'GHC.Parser.Annotation.AnnModule'</span>
<a name="line-1775"></a>      <span class='hs-comment'>--           'GHC.Parser.Annotation.AnnClose'</span>
<a name="line-1776"></a>
<a name="line-1777"></a>      <span class='hs-comment'>-- For details on above see note [exact print annotations] in GHC.Parser.Annotation</span>
<a name="line-1778"></a>  <span class='hs-keyglyph'>|</span> <span class='hs-conid'>XAnnDecl</span> <span class='hs-varop'>!</span><span class='hs-layout'>(</span><span class='hs-conid'>XXAnnDecl</span> <span class='hs-varid'>pass</span><span class='hs-layout'>)</span>
<a name="line-1779"></a>
<a name="line-1780"></a><a name="AnnProvenance"></a><span class='hs-comment'>-- | Annotation Provenance</span>
<a name="line-1781"></a><a name="AnnProvenance"></a><span class='hs-keyword'>data</span> <span class='hs-conid'>AnnProvenance</span> <span class='hs-varid'>pass</span> <span class='hs-keyglyph'>=</span> <span class='hs-conid'>ValueAnnProvenance</span> <span class='hs-layout'>(</span><span class='hs-conid'>LIdP</span> <span class='hs-varid'>pass</span><span class='hs-layout'>)</span>
<a name="line-1782"></a>                        <span class='hs-keyglyph'>|</span> <span class='hs-conid'>TypeAnnProvenance</span> <span class='hs-layout'>(</span><span class='hs-conid'>LIdP</span> <span class='hs-varid'>pass</span><span class='hs-layout'>)</span>
<a name="line-1783"></a>                        <span class='hs-keyglyph'>|</span> <span class='hs-conid'>ModuleAnnProvenance</span>
<a name="line-1784"></a><span class='hs-comment'>-- deriving instance Functor     AnnProvenance</span>
<a name="line-1785"></a><span class='hs-comment'>-- deriving instance Foldable    AnnProvenance</span>
<a name="line-1786"></a><span class='hs-comment'>-- deriving instance Traversable AnnProvenance</span>
<a name="line-1787"></a><span class='hs-comment'>-- deriving instance (Data pass) =&gt; Data (AnnProvenance pass)</span>
<a name="line-1788"></a>
<a name="line-1789"></a><a name="annProvenanceName_maybe"></a><span class='hs-definition'>annProvenanceName_maybe</span> <span class='hs-keyglyph'>::</span> <span class='hs-keyword'>forall</span> <span class='hs-varid'>p</span><span class='hs-varop'>.</span> <span class='hs-conid'>UnXRec</span> <span class='hs-varid'>p</span> <span class='hs-keyglyph'>=&gt;</span> <span class='hs-conid'>AnnProvenance</span> <span class='hs-varid'>p</span> <span class='hs-keyglyph'>-&gt;</span> <span class='hs-conid'>Maybe</span> <span class='hs-layout'>(</span><span class='hs-conid'>IdP</span> <span class='hs-varid'>p</span><span class='hs-layout'>)</span>
<a name="line-1790"></a><span class='hs-definition'>annProvenanceName_maybe</span> <span class='hs-layout'>(</span><span class='hs-conid'>ValueAnnProvenance</span> <span class='hs-layout'>(</span><span class='hs-varid'>unXRec</span> <span class='hs-keyglyph'>@</span><span class='hs-varid'>p</span> <span class='hs-keyglyph'>-&gt;</span> <span class='hs-varid'>name</span><span class='hs-layout'>)</span><span class='hs-layout'>)</span> <span class='hs-keyglyph'>=</span> <span class='hs-conid'>Just</span> <span class='hs-varid'>name</span>
<a name="line-1791"></a><span class='hs-definition'>annProvenanceName_maybe</span> <span class='hs-layout'>(</span><span class='hs-conid'>TypeAnnProvenance</span> <span class='hs-layout'>(</span><span class='hs-varid'>unXRec</span> <span class='hs-keyglyph'>@</span><span class='hs-varid'>p</span> <span class='hs-keyglyph'>-&gt;</span> <span class='hs-varid'>name</span><span class='hs-layout'>)</span><span class='hs-layout'>)</span>  <span class='hs-keyglyph'>=</span> <span class='hs-conid'>Just</span> <span class='hs-varid'>name</span>
<a name="line-1792"></a><span class='hs-definition'>annProvenanceName_maybe</span> <span class='hs-conid'>ModuleAnnProvenance</span>                      <span class='hs-keyglyph'>=</span> <span class='hs-conid'>Nothing</span>
<a name="line-1793"></a>
<a name="line-1794"></a><span class='hs-comment'>{-
<a name="line-1795"></a>************************************************************************
<a name="line-1796"></a>*                                                                      *
<a name="line-1797"></a>\subsection[RoleAnnot]{Role annotations}
<a name="line-1798"></a>*                                                                      *
<a name="line-1799"></a>************************************************************************
<a name="line-1800"></a>-}</span>
<a name="line-1801"></a>
<a name="line-1802"></a><a name="LRoleAnnotDecl"></a><span class='hs-comment'>-- | Located Role Annotation Declaration</span>
<a name="line-1803"></a><a name="LRoleAnnotDecl"></a><span class='hs-keyword'>type</span> <span class='hs-conid'>LRoleAnnotDecl</span> <span class='hs-varid'>pass</span> <span class='hs-keyglyph'>=</span> <span class='hs-conid'>XRec</span> <span class='hs-varid'>pass</span> <span class='hs-layout'>(</span><span class='hs-conid'>RoleAnnotDecl</span> <span class='hs-varid'>pass</span><span class='hs-layout'>)</span>
<a name="line-1804"></a>
<a name="line-1805"></a><a name="RoleAnnotDecl"></a><span class='hs-comment'>-- See #8185 for more info about why role annotations are</span>
<a name="line-1806"></a><a name="RoleAnnotDecl"></a><span class='hs-comment'>-- top-level declarations</span>
<a name="line-1807"></a><a name="RoleAnnotDecl"></a><span class='hs-comment'>-- | Role Annotation Declaration</span>
<a name="line-1808"></a><a name="RoleAnnotDecl"></a><span class='hs-keyword'>data</span> <span class='hs-conid'>RoleAnnotDecl</span> <span class='hs-varid'>pass</span>
<a name="line-1809"></a>  <span class='hs-keyglyph'>=</span> <span class='hs-conid'>RoleAnnotDecl</span> <span class='hs-layout'>(</span><span class='hs-conid'>XCRoleAnnotDecl</span> <span class='hs-varid'>pass</span><span class='hs-layout'>)</span>
<a name="line-1810"></a>                  <span class='hs-layout'>(</span><span class='hs-conid'>LIdP</span> <span class='hs-varid'>pass</span><span class='hs-layout'>)</span>              <span class='hs-comment'>-- type constructor</span>
<a name="line-1811"></a>                  <span class='hs-keyglyph'>[</span><span class='hs-conid'>XRec</span> <span class='hs-varid'>pass</span> <span class='hs-layout'>(</span><span class='hs-conid'>Maybe</span> <span class='hs-conid'>Role</span><span class='hs-layout'>)</span><span class='hs-keyglyph'>]</span> <span class='hs-comment'>-- optional annotations</span>
<a name="line-1812"></a>      <span class='hs-comment'>-- ^ - 'GHC.Parser.Annotation.AnnKeywordId' : 'GHC.Parser.Annotation.AnnType',</span>
<a name="line-1813"></a>      <span class='hs-comment'>--           'GHC.Parser.Annotation.AnnRole'</span>
<a name="line-1814"></a>
<a name="line-1815"></a>      <span class='hs-comment'>-- For details on above see note [exact print annotations] in GHC.Parser.Annotation</span>
<a name="line-1816"></a>  <span class='hs-keyglyph'>|</span> <span class='hs-conid'>XRoleAnnotDecl</span> <span class='hs-varop'>!</span><span class='hs-layout'>(</span><span class='hs-conid'>XXRoleAnnotDecl</span> <span class='hs-varid'>pass</span><span class='hs-layout'>)</span>
</pre></body>
</html>
