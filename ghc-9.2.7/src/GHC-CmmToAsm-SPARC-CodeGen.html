<?xml version="1.0" encoding="UTF-8"?>
<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Strict//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-strict.dtd">
<html>
<head>
<!-- Generated by HsColour, http://code.haskell.org/~malcolm/hscolour/ -->
<title>GHC/CmmToAsm/SPARC/CodeGen.hs</title>
<link type='text/css' rel='stylesheet' href='hscolour.css' />
</head>
<body>
<pre><a name="line-1"></a><span class='hs-comment'>{-# LANGUAGE CPP #-}</span>
<a name="line-2"></a>
<a name="line-3"></a><span class='hs-comment'>-----------------------------------------------------------------------------</span>
<a name="line-4"></a><span class='hs-comment'>--</span>
<a name="line-5"></a><span class='hs-comment'>-- Generating machine code (instruction selection)</span>
<a name="line-6"></a><span class='hs-comment'>--</span>
<a name="line-7"></a><span class='hs-comment'>-- (c) The University of Glasgow 1996-2013</span>
<a name="line-8"></a><span class='hs-comment'>--</span>
<a name="line-9"></a><span class='hs-comment'>-----------------------------------------------------------------------------</span>
<a name="line-10"></a>
<a name="line-11"></a><span class='hs-comment'>{-# LANGUAGE GADTs #-}</span>
<a name="line-12"></a><span class='hs-keyword'>module</span> <span class='hs-conid'>GHC.CmmToAsm.SPARC.CodeGen</span> <span class='hs-layout'>(</span>
<a name="line-13"></a>        <span class='hs-varid'>cmmTopCodeGen</span><span class='hs-layout'>,</span>
<a name="line-14"></a>        <span class='hs-varid'>generateJumpTableForInstr</span><span class='hs-layout'>,</span>
<a name="line-15"></a>        <span class='hs-conid'>InstrBlock</span>
<a name="line-16"></a><span class='hs-layout'>)</span>
<a name="line-17"></a>
<a name="line-18"></a><span class='hs-keyword'>where</span>
<a name="line-19"></a>
<a name="line-20"></a><span class='hs-cpp'>#include "HsVersions.h"</span>
<a name="line-21"></a>
<a name="line-22"></a><span class='hs-comment'>-- NCG stuff:</span>
<a name="line-23"></a><span class='hs-keyword'>import</span> <span class='hs-conid'>GHC.Prelude</span>
<a name="line-24"></a>
<a name="line-25"></a><span class='hs-keyword'>import</span> <span class='hs-conid'>GHC.CmmToAsm.SPARC.Base</span>
<a name="line-26"></a><span class='hs-keyword'>import</span> <span class='hs-conid'>GHC.CmmToAsm.SPARC.CodeGen.Sanity</span>
<a name="line-27"></a><span class='hs-keyword'>import</span> <span class='hs-conid'>GHC.CmmToAsm.SPARC.CodeGen.Amode</span>
<a name="line-28"></a><span class='hs-keyword'>import</span> <span class='hs-conid'>GHC.CmmToAsm.SPARC.CodeGen.CondCode</span>
<a name="line-29"></a><span class='hs-keyword'>import</span> <span class='hs-conid'>GHC.CmmToAsm.SPARC.CodeGen.Gen64</span>
<a name="line-30"></a><span class='hs-keyword'>import</span> <span class='hs-conid'>GHC.CmmToAsm.SPARC.CodeGen.Gen32</span>
<a name="line-31"></a><span class='hs-keyword'>import</span> <span class='hs-conid'>GHC.CmmToAsm.SPARC.CodeGen.Base</span>
<a name="line-32"></a><span class='hs-keyword'>import</span> <span class='hs-conid'>GHC.CmmToAsm.SPARC.Instr</span>
<a name="line-33"></a><span class='hs-keyword'>import</span> <span class='hs-conid'>GHC.CmmToAsm.SPARC.Imm</span>
<a name="line-34"></a><span class='hs-keyword'>import</span> <span class='hs-conid'>GHC.CmmToAsm.SPARC.AddrMode</span>
<a name="line-35"></a><span class='hs-keyword'>import</span> <span class='hs-conid'>GHC.CmmToAsm.SPARC.Regs</span>
<a name="line-36"></a><span class='hs-keyword'>import</span> <span class='hs-conid'>GHC.CmmToAsm.SPARC.Stack</span>
<a name="line-37"></a><span class='hs-keyword'>import</span> <span class='hs-conid'>GHC.CmmToAsm.Types</span>
<a name="line-38"></a><span class='hs-keyword'>import</span> <span class='hs-conid'>GHC.CmmToAsm.Format</span>
<a name="line-39"></a><span class='hs-keyword'>import</span> <span class='hs-conid'>GHC.CmmToAsm.Monad</span>   <span class='hs-layout'>(</span> <span class='hs-conid'>NatM</span><span class='hs-layout'>,</span> <span class='hs-varid'>getNewRegNat</span><span class='hs-layout'>,</span> <span class='hs-varid'>getNewLabelNat</span><span class='hs-layout'>,</span> <span class='hs-varid'>getPlatform</span><span class='hs-layout'>,</span> <span class='hs-varid'>getConfig</span> <span class='hs-layout'>)</span>
<a name="line-40"></a><span class='hs-keyword'>import</span> <span class='hs-conid'>GHC.CmmToAsm.Config</span>
<a name="line-41"></a>
<a name="line-42"></a><span class='hs-comment'>-- Our intermediate code:</span>
<a name="line-43"></a><span class='hs-keyword'>import</span> <span class='hs-conid'>GHC.Cmm.BlockId</span>
<a name="line-44"></a><span class='hs-keyword'>import</span> <span class='hs-conid'>GHC.Cmm</span>
<a name="line-45"></a><span class='hs-keyword'>import</span> <span class='hs-conid'>GHC.Cmm.Utils</span>
<a name="line-46"></a><span class='hs-keyword'>import</span> <span class='hs-conid'>GHC.Cmm.Switch</span>
<a name="line-47"></a><span class='hs-keyword'>import</span> <span class='hs-conid'>GHC.Cmm.Dataflow.Block</span>
<a name="line-48"></a><span class='hs-keyword'>import</span> <span class='hs-conid'>GHC.Cmm.Dataflow.Graph</span>
<a name="line-49"></a><span class='hs-keyword'>import</span> <span class='hs-conid'>GHC.CmmToAsm.PIC</span>
<a name="line-50"></a><span class='hs-keyword'>import</span> <span class='hs-conid'>GHC.Platform.Reg</span>
<a name="line-51"></a><span class='hs-keyword'>import</span> <span class='hs-conid'>GHC.Cmm.CLabel</span>
<a name="line-52"></a><span class='hs-keyword'>import</span> <span class='hs-conid'>GHC.CmmToAsm.CPrim</span>
<a name="line-53"></a>
<a name="line-54"></a><span class='hs-comment'>-- The rest:</span>
<a name="line-55"></a><span class='hs-keyword'>import</span> <span class='hs-conid'>GHC.Types.Basic</span>
<a name="line-56"></a><span class='hs-keyword'>import</span> <span class='hs-conid'>GHC.Data.FastString</span>
<a name="line-57"></a><span class='hs-keyword'>import</span> <span class='hs-conid'>GHC.Data.OrdList</span>
<a name="line-58"></a><span class='hs-keyword'>import</span> <span class='hs-conid'>GHC.Utils.Panic</span>
<a name="line-59"></a><span class='hs-keyword'>import</span> <span class='hs-conid'>GHC.Platform</span>
<a name="line-60"></a>
<a name="line-61"></a><span class='hs-keyword'>import</span> <span class='hs-conid'>Control.Monad</span>    <span class='hs-layout'>(</span> <span class='hs-varid'>mapAndUnzipM</span> <span class='hs-layout'>)</span>
<a name="line-62"></a>
<a name="line-63"></a><a name="cmmTopCodeGen"></a><span class='hs-comment'>-- | Top level code generation</span>
<a name="line-64"></a><span class='hs-definition'>cmmTopCodeGen</span> <span class='hs-keyglyph'>::</span> <span class='hs-conid'>RawCmmDecl</span>
<a name="line-65"></a>              <span class='hs-keyglyph'>-&gt;</span> <span class='hs-conid'>NatM</span> <span class='hs-keyglyph'>[</span><span class='hs-conid'>NatCmmDecl</span> <span class='hs-conid'>RawCmmStatics</span> <span class='hs-conid'>Instr</span><span class='hs-keyglyph'>]</span>
<a name="line-66"></a>
<a name="line-67"></a><span class='hs-definition'>cmmTopCodeGen</span> <span class='hs-layout'>(</span><span class='hs-conid'>CmmProc</span> <span class='hs-varid'>info</span> <span class='hs-varid'>lab</span> <span class='hs-varid'>live</span> <span class='hs-varid'>graph</span><span class='hs-layout'>)</span>
<a name="line-68"></a> <span class='hs-keyglyph'>=</span> <span class='hs-keyword'>do</span> <span class='hs-keyword'>let</span> <span class='hs-varid'>blocks</span> <span class='hs-keyglyph'>=</span> <span class='hs-varid'>toBlockListEntryFirst</span> <span class='hs-varid'>graph</span>
<a name="line-69"></a>      <span class='hs-layout'>(</span><span class='hs-varid'>nat_blocks</span><span class='hs-layout'>,</span><span class='hs-varid'>statics</span><span class='hs-layout'>)</span> <span class='hs-keyglyph'>&lt;-</span> <span class='hs-varid'>mapAndUnzipM</span> <span class='hs-varid'>basicBlockCodeGen</span> <span class='hs-varid'>blocks</span>
<a name="line-70"></a>
<a name="line-71"></a>      <span class='hs-keyword'>let</span> <span class='hs-varid'>proc</span> <span class='hs-keyglyph'>=</span> <span class='hs-conid'>CmmProc</span> <span class='hs-varid'>info</span> <span class='hs-varid'>lab</span> <span class='hs-varid'>live</span> <span class='hs-layout'>(</span><span class='hs-conid'>ListGraph</span> <span class='hs-varop'>$</span> <span class='hs-varid'>concat</span> <span class='hs-varid'>nat_blocks</span><span class='hs-layout'>)</span>
<a name="line-72"></a>      <span class='hs-keyword'>let</span> <span class='hs-varid'>tops</span> <span class='hs-keyglyph'>=</span> <span class='hs-varid'>proc</span> <span class='hs-conop'>:</span> <span class='hs-varid'>concat</span> <span class='hs-varid'>statics</span>
<a name="line-73"></a>
<a name="line-74"></a>      <span class='hs-varid'>return</span> <span class='hs-varid'>tops</span>
<a name="line-75"></a>
<a name="line-76"></a><span class='hs-definition'>cmmTopCodeGen</span> <span class='hs-layout'>(</span><span class='hs-conid'>CmmData</span> <span class='hs-varid'>sec</span> <span class='hs-varid'>dat</span><span class='hs-layout'>)</span> <span class='hs-keyglyph'>=</span>
<a name="line-77"></a>  <span class='hs-varid'>return</span> <span class='hs-keyglyph'>[</span><span class='hs-conid'>CmmData</span> <span class='hs-varid'>sec</span> <span class='hs-varid'>dat</span><span class='hs-keyglyph'>]</span>  <span class='hs-comment'>-- no translation, we just use CmmStatic</span>
<a name="line-78"></a>
<a name="line-79"></a>
<a name="line-80"></a><a name="basicBlockCodeGen"></a><span class='hs-comment'>-- | Do code generation on a single block of CMM code.</span>
<a name="line-81"></a><span class='hs-comment'>--      code generation may introduce new basic block boundaries, which</span>
<a name="line-82"></a><span class='hs-comment'>--      are indicated by the NEWBLOCK instruction.  We must split up the</span>
<a name="line-83"></a><span class='hs-comment'>--      instruction stream into basic blocks again.  Also, we extract</span>
<a name="line-84"></a><span class='hs-comment'>--      LDATAs here too.</span>
<a name="line-85"></a><span class='hs-definition'>basicBlockCodeGen</span> <span class='hs-keyglyph'>::</span> <span class='hs-conid'>CmmBlock</span>
<a name="line-86"></a>                  <span class='hs-keyglyph'>-&gt;</span> <span class='hs-conid'>NatM</span> <span class='hs-layout'>(</span> <span class='hs-keyglyph'>[</span><span class='hs-conid'>NatBasicBlock</span> <span class='hs-conid'>Instr</span><span class='hs-keyglyph'>]</span>
<a name="line-87"></a>                          <span class='hs-layout'>,</span> <span class='hs-keyglyph'>[</span><span class='hs-conid'>NatCmmDecl</span> <span class='hs-conid'>RawCmmStatics</span> <span class='hs-conid'>Instr</span><span class='hs-keyglyph'>]</span><span class='hs-layout'>)</span>
<a name="line-88"></a>
<a name="line-89"></a><span class='hs-definition'>basicBlockCodeGen</span> <span class='hs-varid'>block</span> <span class='hs-keyglyph'>=</span> <span class='hs-keyword'>do</span>
<a name="line-90"></a>  <span class='hs-keyword'>let</span> <span class='hs-layout'>(</span><span class='hs-keyword'>_</span><span class='hs-layout'>,</span> <span class='hs-varid'>nodes</span><span class='hs-layout'>,</span> <span class='hs-varid'>tail</span><span class='hs-layout'>)</span>  <span class='hs-keyglyph'>=</span> <span class='hs-varid'>blockSplit</span> <span class='hs-varid'>block</span>
<a name="line-91"></a>      <span class='hs-varid'>id</span> <span class='hs-keyglyph'>=</span> <span class='hs-varid'>entryLabel</span> <span class='hs-varid'>block</span>
<a name="line-92"></a>      <span class='hs-varid'>stmts</span> <span class='hs-keyglyph'>=</span> <span class='hs-varid'>blockToList</span> <span class='hs-varid'>nodes</span>
<a name="line-93"></a>  <span class='hs-varid'>platform</span> <span class='hs-keyglyph'>&lt;-</span> <span class='hs-varid'>getPlatform</span>
<a name="line-94"></a>  <span class='hs-varid'>mid_instrs</span> <span class='hs-keyglyph'>&lt;-</span> <span class='hs-varid'>stmtsToInstrs</span> <span class='hs-varid'>stmts</span>
<a name="line-95"></a>  <span class='hs-varid'>tail_instrs</span> <span class='hs-keyglyph'>&lt;-</span> <span class='hs-varid'>stmtToInstrs</span> <span class='hs-varid'>tail</span>
<a name="line-96"></a>  <span class='hs-keyword'>let</span> <span class='hs-varid'>instrs</span> <span class='hs-keyglyph'>=</span> <span class='hs-varid'>mid_instrs</span> <span class='hs-varop'>`appOL`</span> <span class='hs-varid'>tail_instrs</span>
<a name="line-97"></a>  <span class='hs-keyword'>let</span>
<a name="line-98"></a>        <span class='hs-layout'>(</span><span class='hs-varid'>top</span><span class='hs-layout'>,</span><span class='hs-varid'>other_blocks</span><span class='hs-layout'>,</span><span class='hs-varid'>statics</span><span class='hs-layout'>)</span>
<a name="line-99"></a>                <span class='hs-keyglyph'>=</span> <span class='hs-varid'>foldrOL</span> <span class='hs-varid'>mkBlocks</span> <span class='hs-layout'>(</span><span class='hs-conid'>[]</span><span class='hs-layout'>,</span><span class='hs-conid'>[]</span><span class='hs-layout'>,</span><span class='hs-conid'>[]</span><span class='hs-layout'>)</span> <span class='hs-varid'>instrs</span>
<a name="line-100"></a>
<a name="line-101"></a>        <span class='hs-varid'>mkBlocks</span> <span class='hs-layout'>(</span><span class='hs-conid'>NEWBLOCK</span> <span class='hs-varid'>id</span><span class='hs-layout'>)</span> <span class='hs-layout'>(</span><span class='hs-varid'>instrs</span><span class='hs-layout'>,</span><span class='hs-varid'>blocks</span><span class='hs-layout'>,</span><span class='hs-varid'>statics</span><span class='hs-layout'>)</span>
<a name="line-102"></a>          <span class='hs-keyglyph'>=</span> <span class='hs-layout'>(</span><span class='hs-conid'>[]</span><span class='hs-layout'>,</span> <span class='hs-conid'>BasicBlock</span> <span class='hs-varid'>id</span> <span class='hs-varid'>instrs</span> <span class='hs-conop'>:</span> <span class='hs-varid'>blocks</span><span class='hs-layout'>,</span> <span class='hs-varid'>statics</span><span class='hs-layout'>)</span>
<a name="line-103"></a>
<a name="line-104"></a>        <span class='hs-varid'>mkBlocks</span> <span class='hs-layout'>(</span><span class='hs-conid'>LDATA</span> <span class='hs-varid'>sec</span> <span class='hs-varid'>dat</span><span class='hs-layout'>)</span> <span class='hs-layout'>(</span><span class='hs-varid'>instrs</span><span class='hs-layout'>,</span><span class='hs-varid'>blocks</span><span class='hs-layout'>,</span><span class='hs-varid'>statics</span><span class='hs-layout'>)</span>
<a name="line-105"></a>          <span class='hs-keyglyph'>=</span> <span class='hs-layout'>(</span><span class='hs-varid'>instrs</span><span class='hs-layout'>,</span> <span class='hs-varid'>blocks</span><span class='hs-layout'>,</span> <span class='hs-conid'>CmmData</span> <span class='hs-varid'>sec</span> <span class='hs-varid'>dat</span><span class='hs-conop'>:</span><span class='hs-varid'>statics</span><span class='hs-layout'>)</span>
<a name="line-106"></a>
<a name="line-107"></a>        <span class='hs-varid'>mkBlocks</span> <span class='hs-varid'>instr</span> <span class='hs-layout'>(</span><span class='hs-varid'>instrs</span><span class='hs-layout'>,</span><span class='hs-varid'>blocks</span><span class='hs-layout'>,</span><span class='hs-varid'>statics</span><span class='hs-layout'>)</span>
<a name="line-108"></a>          <span class='hs-keyglyph'>=</span> <span class='hs-layout'>(</span><span class='hs-varid'>instr</span><span class='hs-conop'>:</span><span class='hs-varid'>instrs</span><span class='hs-layout'>,</span> <span class='hs-varid'>blocks</span><span class='hs-layout'>,</span> <span class='hs-varid'>statics</span><span class='hs-layout'>)</span>
<a name="line-109"></a>
<a name="line-110"></a>        <span class='hs-comment'>-- do intra-block sanity checking</span>
<a name="line-111"></a>        <span class='hs-varid'>blocksChecked</span>
<a name="line-112"></a>                <span class='hs-keyglyph'>=</span> <span class='hs-varid'>map</span> <span class='hs-layout'>(</span><span class='hs-varid'>checkBlock</span> <span class='hs-varid'>platform</span> <span class='hs-varid'>block</span><span class='hs-layout'>)</span>
<a name="line-113"></a>                <span class='hs-varop'>$</span> <span class='hs-conid'>BasicBlock</span> <span class='hs-varid'>id</span> <span class='hs-varid'>top</span> <span class='hs-conop'>:</span> <span class='hs-varid'>other_blocks</span>
<a name="line-114"></a>
<a name="line-115"></a>  <span class='hs-varid'>return</span> <span class='hs-layout'>(</span><span class='hs-varid'>blocksChecked</span><span class='hs-layout'>,</span> <span class='hs-varid'>statics</span><span class='hs-layout'>)</span>
<a name="line-116"></a>
<a name="line-117"></a>
<a name="line-118"></a><a name="stmtsToInstrs"></a><span class='hs-comment'>-- | Convert some Cmm statements to SPARC instructions.</span>
<a name="line-119"></a><span class='hs-definition'>stmtsToInstrs</span> <span class='hs-keyglyph'>::</span> <span class='hs-keyglyph'>[</span><span class='hs-conid'>CmmNode</span> <span class='hs-varid'>e</span> <span class='hs-varid'>x</span><span class='hs-keyglyph'>]</span> <span class='hs-keyglyph'>-&gt;</span> <span class='hs-conid'>NatM</span> <span class='hs-conid'>InstrBlock</span>
<a name="line-120"></a><span class='hs-definition'>stmtsToInstrs</span> <span class='hs-varid'>stmts</span>
<a name="line-121"></a>   <span class='hs-keyglyph'>=</span> <span class='hs-keyword'>do</span> <span class='hs-varid'>instrss</span> <span class='hs-keyglyph'>&lt;-</span> <span class='hs-varid'>mapM</span> <span class='hs-varid'>stmtToInstrs</span> <span class='hs-varid'>stmts</span>
<a name="line-122"></a>        <span class='hs-varid'>return</span> <span class='hs-layout'>(</span><span class='hs-varid'>concatOL</span> <span class='hs-varid'>instrss</span><span class='hs-layout'>)</span>
<a name="line-123"></a>
<a name="line-124"></a>
<a name="line-125"></a><a name="stmtToInstrs"></a><span class='hs-definition'>stmtToInstrs</span> <span class='hs-keyglyph'>::</span> <span class='hs-conid'>CmmNode</span> <span class='hs-varid'>e</span> <span class='hs-varid'>x</span> <span class='hs-keyglyph'>-&gt;</span> <span class='hs-conid'>NatM</span> <span class='hs-conid'>InstrBlock</span>
<a name="line-126"></a><span class='hs-definition'>stmtToInstrs</span> <span class='hs-varid'>stmt</span> <span class='hs-keyglyph'>=</span> <span class='hs-keyword'>do</span>
<a name="line-127"></a>  <span class='hs-varid'>platform</span> <span class='hs-keyglyph'>&lt;-</span> <span class='hs-varid'>getPlatform</span>
<a name="line-128"></a>  <span class='hs-varid'>config</span> <span class='hs-keyglyph'>&lt;-</span> <span class='hs-varid'>getConfig</span>
<a name="line-129"></a>  <span class='hs-keyword'>case</span> <span class='hs-varid'>stmt</span> <span class='hs-keyword'>of</span>
<a name="line-130"></a>    <span class='hs-conid'>CmmComment</span> <span class='hs-varid'>s</span>   <span class='hs-keyglyph'>-&gt;</span> <span class='hs-varid'>return</span> <span class='hs-layout'>(</span><span class='hs-varid'>unitOL</span> <span class='hs-layout'>(</span><span class='hs-conid'>COMMENT</span> <span class='hs-varid'>s</span><span class='hs-layout'>)</span><span class='hs-layout'>)</span>
<a name="line-131"></a>    <span class='hs-conid'>CmmTick</span> <span class='hs-layout'>{</span><span class='hs-layout'>}</span>     <span class='hs-keyglyph'>-&gt;</span> <span class='hs-varid'>return</span> <span class='hs-varid'>nilOL</span>
<a name="line-132"></a>    <span class='hs-conid'>CmmUnwind</span> <span class='hs-layout'>{</span><span class='hs-layout'>}</span>   <span class='hs-keyglyph'>-&gt;</span> <span class='hs-varid'>return</span> <span class='hs-varid'>nilOL</span>
<a name="line-133"></a>
<a name="line-134"></a>    <span class='hs-conid'>CmmAssign</span> <span class='hs-varid'>reg</span> <span class='hs-varid'>src</span>
<a name="line-135"></a>      <span class='hs-keyglyph'>|</span> <span class='hs-varid'>isFloatType</span> <span class='hs-varid'>ty</span>  <span class='hs-keyglyph'>-&gt;</span> <span class='hs-varid'>assignReg_FltCode</span> <span class='hs-varid'>format</span> <span class='hs-varid'>reg</span> <span class='hs-varid'>src</span>
<a name="line-136"></a>      <span class='hs-keyglyph'>|</span> <span class='hs-varid'>isWord64</span> <span class='hs-varid'>ty</span>     <span class='hs-keyglyph'>-&gt;</span> <span class='hs-varid'>assignReg_I64Code</span>        <span class='hs-varid'>reg</span> <span class='hs-varid'>src</span>
<a name="line-137"></a>      <span class='hs-keyglyph'>|</span> <span class='hs-varid'>otherwise</span>       <span class='hs-keyglyph'>-&gt;</span> <span class='hs-varid'>assignReg_IntCode</span> <span class='hs-varid'>format</span> <span class='hs-varid'>reg</span> <span class='hs-varid'>src</span>
<a name="line-138"></a>        <span class='hs-keyword'>where</span> <span class='hs-varid'>ty</span> <span class='hs-keyglyph'>=</span> <span class='hs-varid'>cmmRegType</span> <span class='hs-varid'>platform</span> <span class='hs-varid'>reg</span>
<a name="line-139"></a>              <span class='hs-varid'>format</span> <span class='hs-keyglyph'>=</span> <span class='hs-varid'>cmmTypeFormat</span> <span class='hs-varid'>ty</span>
<a name="line-140"></a>
<a name="line-141"></a>    <span class='hs-conid'>CmmStore</span> <span class='hs-varid'>addr</span> <span class='hs-varid'>src</span> <span class='hs-keyword'>_</span>
<a name="line-142"></a>      <span class='hs-keyglyph'>|</span> <span class='hs-varid'>isFloatType</span> <span class='hs-varid'>ty</span>  <span class='hs-keyglyph'>-&gt;</span> <span class='hs-varid'>assignMem_FltCode</span> <span class='hs-varid'>format</span> <span class='hs-varid'>addr</span> <span class='hs-varid'>src</span>
<a name="line-143"></a>      <span class='hs-keyglyph'>|</span> <span class='hs-varid'>isWord64</span> <span class='hs-varid'>ty</span>     <span class='hs-keyglyph'>-&gt;</span> <span class='hs-varid'>assignMem_I64Code</span>      <span class='hs-varid'>addr</span> <span class='hs-varid'>src</span>
<a name="line-144"></a>      <span class='hs-keyglyph'>|</span> <span class='hs-varid'>otherwise</span>       <span class='hs-keyglyph'>-&gt;</span> <span class='hs-varid'>assignMem_IntCode</span> <span class='hs-varid'>format</span> <span class='hs-varid'>addr</span> <span class='hs-varid'>src</span>
<a name="line-145"></a>        <span class='hs-keyword'>where</span> <span class='hs-varid'>ty</span> <span class='hs-keyglyph'>=</span> <span class='hs-varid'>cmmExprType</span> <span class='hs-varid'>platform</span> <span class='hs-varid'>src</span>
<a name="line-146"></a>              <span class='hs-varid'>format</span> <span class='hs-keyglyph'>=</span> <span class='hs-varid'>cmmTypeFormat</span> <span class='hs-varid'>ty</span>
<a name="line-147"></a>
<a name="line-148"></a>    <span class='hs-conid'>CmmUnsafeForeignCall</span> <span class='hs-varid'>target</span> <span class='hs-varid'>result_regs</span> <span class='hs-varid'>args</span>
<a name="line-149"></a>       <span class='hs-keyglyph'>-&gt;</span> <span class='hs-varid'>genCCall</span> <span class='hs-varid'>target</span> <span class='hs-varid'>result_regs</span> <span class='hs-varid'>args</span>
<a name="line-150"></a>
<a name="line-151"></a>    <span class='hs-conid'>CmmBranch</span>   <span class='hs-varid'>id</span>              <span class='hs-keyglyph'>-&gt;</span> <span class='hs-varid'>genBranch</span> <span class='hs-varid'>id</span>
<a name="line-152"></a>    <span class='hs-conid'>CmmCondBranch</span> <span class='hs-varid'>arg</span> <span class='hs-varid'>true</span> <span class='hs-varid'>false</span> <span class='hs-keyword'>_</span> <span class='hs-keyglyph'>-&gt;</span> <span class='hs-keyword'>do</span>
<a name="line-153"></a>      <span class='hs-varid'>b1</span> <span class='hs-keyglyph'>&lt;-</span> <span class='hs-varid'>genCondJump</span> <span class='hs-varid'>true</span> <span class='hs-varid'>arg</span>
<a name="line-154"></a>      <span class='hs-varid'>b2</span> <span class='hs-keyglyph'>&lt;-</span> <span class='hs-varid'>genBranch</span> <span class='hs-varid'>false</span>
<a name="line-155"></a>      <span class='hs-varid'>return</span> <span class='hs-layout'>(</span><span class='hs-varid'>b1</span> <span class='hs-varop'>`appOL`</span> <span class='hs-varid'>b2</span><span class='hs-layout'>)</span>
<a name="line-156"></a>    <span class='hs-conid'>CmmSwitch</span> <span class='hs-varid'>arg</span> <span class='hs-varid'>ids</span>   <span class='hs-keyglyph'>-&gt;</span> <span class='hs-varid'>genSwitch</span> <span class='hs-varid'>config</span> <span class='hs-varid'>arg</span> <span class='hs-varid'>ids</span>
<a name="line-157"></a>    <span class='hs-conid'>CmmCall</span> <span class='hs-layout'>{</span> <span class='hs-varid'>cml_target</span> <span class='hs-keyglyph'>=</span> <span class='hs-varid'>arg</span> <span class='hs-layout'>}</span> <span class='hs-keyglyph'>-&gt;</span> <span class='hs-varid'>genJump</span> <span class='hs-varid'>arg</span>
<a name="line-158"></a>
<a name="line-159"></a>    <span class='hs-keyword'>_</span>
<a name="line-160"></a>     <span class='hs-keyglyph'>-&gt;</span> <span class='hs-varid'>panic</span> <span class='hs-str'>"stmtToInstrs: statement should have been cps'd away"</span>
<a name="line-161"></a>
<a name="line-162"></a>
<a name="line-163"></a><span class='hs-comment'>{-
<a name="line-164"></a>Now, given a tree (the argument to a CmmLoad) that references memory,
<a name="line-165"></a>produce a suitable addressing mode.
<a name="line-166"></a>
<a name="line-167"></a>A Rule of the Game (tm) for Amodes: use of the addr bit must
<a name="line-168"></a>immediately follow use of the code part, since the code part puts
<a name="line-169"></a>values in registers which the addr then refers to.  So you can't put
<a name="line-170"></a>anything in between, lest it overwrite some of those registers.  If
<a name="line-171"></a>you need to do some other computation between the code part and use of
<a name="line-172"></a>the addr bit, first store the effective address from the amode in a
<a name="line-173"></a>temporary, then do the other computation, and then use the temporary:
<a name="line-174"></a>
<a name="line-175"></a>    code
<a name="line-176"></a>    LEA amode, tmp
<a name="line-177"></a>    ... other computation ...
<a name="line-178"></a>    ... (tmp) ...
<a name="line-179"></a>-}</span>
<a name="line-180"></a>
<a name="line-181"></a>
<a name="line-182"></a>
<a name="line-183"></a><a name="jumpTableEntry"></a><span class='hs-comment'>-- | Convert a BlockId to some CmmStatic data</span>
<a name="line-184"></a><span class='hs-definition'>jumpTableEntry</span> <span class='hs-keyglyph'>::</span> <span class='hs-conid'>Platform</span> <span class='hs-keyglyph'>-&gt;</span> <span class='hs-conid'>Maybe</span> <span class='hs-conid'>BlockId</span> <span class='hs-keyglyph'>-&gt;</span> <span class='hs-conid'>CmmStatic</span>
<a name="line-185"></a><span class='hs-definition'>jumpTableEntry</span> <span class='hs-varid'>platform</span> <span class='hs-conid'>Nothing</span> <span class='hs-keyglyph'>=</span> <span class='hs-conid'>CmmStaticLit</span> <span class='hs-layout'>(</span><span class='hs-conid'>CmmInt</span> <span class='hs-num'>0</span> <span class='hs-layout'>(</span><span class='hs-varid'>wordWidth</span> <span class='hs-varid'>platform</span><span class='hs-layout'>)</span><span class='hs-layout'>)</span>
<a name="line-186"></a><span class='hs-definition'>jumpTableEntry</span> <span class='hs-keyword'>_</span> <span class='hs-layout'>(</span><span class='hs-conid'>Just</span> <span class='hs-varid'>blockid</span><span class='hs-layout'>)</span> <span class='hs-keyglyph'>=</span> <span class='hs-conid'>CmmStaticLit</span> <span class='hs-layout'>(</span><span class='hs-conid'>CmmLabel</span> <span class='hs-varid'>blockLabel</span><span class='hs-layout'>)</span>
<a name="line-187"></a>    <span class='hs-keyword'>where</span> <span class='hs-varid'>blockLabel</span> <span class='hs-keyglyph'>=</span> <span class='hs-varid'>blockLbl</span> <span class='hs-varid'>blockid</span>
<a name="line-188"></a>
<a name="line-189"></a>
<a name="line-190"></a>
<a name="line-191"></a><span class='hs-comment'>-- -----------------------------------------------------------------------------</span>
<a name="line-192"></a><span class='hs-comment'>-- Generating assignments</span>
<a name="line-193"></a>
<a name="line-194"></a><span class='hs-comment'>-- Assignments are really at the heart of the whole code generation</span>
<a name="line-195"></a><span class='hs-comment'>-- business.  Almost all top-level nodes of any real importance are</span>
<a name="line-196"></a><span class='hs-comment'>-- assignments, which correspond to loads, stores, or register</span>
<a name="line-197"></a><span class='hs-comment'>-- transfers.  If we're really lucky, some of the register transfers</span>
<a name="line-198"></a><span class='hs-comment'>-- will go away, because we can use the destination register to</span>
<a name="line-199"></a><span class='hs-comment'>-- complete the code generation for the right hand side.  This only</span>
<a name="line-200"></a><span class='hs-comment'>-- fails when the right hand side is forced into a fixed register</span>
<a name="line-201"></a><span class='hs-comment'>-- (e.g. the result of a call).</span>
<a name="line-202"></a>
<a name="line-203"></a><a name="assignMem_IntCode"></a><span class='hs-definition'>assignMem_IntCode</span> <span class='hs-keyglyph'>::</span> <span class='hs-conid'>Format</span> <span class='hs-keyglyph'>-&gt;</span> <span class='hs-conid'>CmmExpr</span> <span class='hs-keyglyph'>-&gt;</span> <span class='hs-conid'>CmmExpr</span> <span class='hs-keyglyph'>-&gt;</span> <span class='hs-conid'>NatM</span> <span class='hs-conid'>InstrBlock</span>
<a name="line-204"></a><span class='hs-definition'>assignMem_IntCode</span> <span class='hs-varid'>pk</span> <span class='hs-varid'>addr</span> <span class='hs-varid'>src</span> <span class='hs-keyglyph'>=</span> <span class='hs-keyword'>do</span>
<a name="line-205"></a>    <span class='hs-layout'>(</span><span class='hs-varid'>srcReg</span><span class='hs-layout'>,</span> <span class='hs-varid'>code</span><span class='hs-layout'>)</span> <span class='hs-keyglyph'>&lt;-</span> <span class='hs-varid'>getSomeReg</span> <span class='hs-varid'>src</span>
<a name="line-206"></a>    <span class='hs-conid'>Amode</span> <span class='hs-varid'>dstAddr</span> <span class='hs-varid'>addr_code</span> <span class='hs-keyglyph'>&lt;-</span> <span class='hs-varid'>getAmode</span> <span class='hs-varid'>addr</span>
<a name="line-207"></a>    <span class='hs-varid'>return</span> <span class='hs-varop'>$</span> <span class='hs-varid'>code</span> <span class='hs-varop'>`appOL`</span> <span class='hs-varid'>addr_code</span> <span class='hs-varop'>`snocOL`</span> <span class='hs-conid'>ST</span> <span class='hs-varid'>pk</span> <span class='hs-varid'>srcReg</span> <span class='hs-varid'>dstAddr</span>
<a name="line-208"></a>
<a name="line-209"></a>
<a name="line-210"></a><a name="assignReg_IntCode"></a><span class='hs-definition'>assignReg_IntCode</span> <span class='hs-keyglyph'>::</span> <span class='hs-conid'>Format</span> <span class='hs-keyglyph'>-&gt;</span> <span class='hs-conid'>CmmReg</span>  <span class='hs-keyglyph'>-&gt;</span> <span class='hs-conid'>CmmExpr</span> <span class='hs-keyglyph'>-&gt;</span> <span class='hs-conid'>NatM</span> <span class='hs-conid'>InstrBlock</span>
<a name="line-211"></a><span class='hs-definition'>assignReg_IntCode</span> <span class='hs-keyword'>_</span> <span class='hs-varid'>reg</span> <span class='hs-varid'>src</span> <span class='hs-keyglyph'>=</span> <span class='hs-keyword'>do</span>
<a name="line-212"></a>    <span class='hs-varid'>platform</span> <span class='hs-keyglyph'>&lt;-</span> <span class='hs-varid'>getPlatform</span>
<a name="line-213"></a>    <span class='hs-varid'>r</span> <span class='hs-keyglyph'>&lt;-</span> <span class='hs-varid'>getRegister</span> <span class='hs-varid'>src</span>
<a name="line-214"></a>    <span class='hs-keyword'>let</span> <span class='hs-varid'>dst</span> <span class='hs-keyglyph'>=</span> <span class='hs-varid'>getRegisterReg</span> <span class='hs-varid'>platform</span> <span class='hs-varid'>reg</span>
<a name="line-215"></a>    <span class='hs-varid'>return</span> <span class='hs-varop'>$</span> <span class='hs-keyword'>case</span> <span class='hs-varid'>r</span> <span class='hs-keyword'>of</span>
<a name="line-216"></a>        <span class='hs-conid'>Any</span> <span class='hs-keyword'>_</span> <span class='hs-varid'>code</span>         <span class='hs-keyglyph'>-&gt;</span> <span class='hs-varid'>code</span> <span class='hs-varid'>dst</span>
<a name="line-217"></a>        <span class='hs-conid'>Fixed</span> <span class='hs-keyword'>_</span> <span class='hs-varid'>freg</span> <span class='hs-varid'>fcode</span> <span class='hs-keyglyph'>-&gt;</span> <span class='hs-varid'>fcode</span> <span class='hs-varop'>`snocOL`</span> <span class='hs-conid'>OR</span> <span class='hs-conid'>False</span> <span class='hs-varid'>g0</span> <span class='hs-layout'>(</span><span class='hs-conid'>RIReg</span> <span class='hs-varid'>freg</span><span class='hs-layout'>)</span> <span class='hs-varid'>dst</span>
<a name="line-218"></a>
<a name="line-219"></a>
<a name="line-220"></a>
<a name="line-221"></a><a name="assignMem_FltCode"></a><span class='hs-comment'>-- Floating point assignment to memory</span>
<a name="line-222"></a><span class='hs-definition'>assignMem_FltCode</span> <span class='hs-keyglyph'>::</span> <span class='hs-conid'>Format</span> <span class='hs-keyglyph'>-&gt;</span> <span class='hs-conid'>CmmExpr</span> <span class='hs-keyglyph'>-&gt;</span> <span class='hs-conid'>CmmExpr</span> <span class='hs-keyglyph'>-&gt;</span> <span class='hs-conid'>NatM</span> <span class='hs-conid'>InstrBlock</span>
<a name="line-223"></a><span class='hs-definition'>assignMem_FltCode</span> <span class='hs-varid'>pk</span> <span class='hs-varid'>addr</span> <span class='hs-varid'>src</span> <span class='hs-keyglyph'>=</span> <span class='hs-keyword'>do</span>
<a name="line-224"></a>    <span class='hs-varid'>platform</span> <span class='hs-keyglyph'>&lt;-</span> <span class='hs-varid'>getPlatform</span>
<a name="line-225"></a>    <span class='hs-conid'>Amode</span> <span class='hs-varid'>dst__2</span> <span class='hs-varid'>code1</span> <span class='hs-keyglyph'>&lt;-</span> <span class='hs-varid'>getAmode</span> <span class='hs-varid'>addr</span>
<a name="line-226"></a>    <span class='hs-layout'>(</span><span class='hs-varid'>src__2</span><span class='hs-layout'>,</span> <span class='hs-varid'>code2</span><span class='hs-layout'>)</span> <span class='hs-keyglyph'>&lt;-</span> <span class='hs-varid'>getSomeReg</span> <span class='hs-varid'>src</span>
<a name="line-227"></a>    <span class='hs-varid'>tmp1</span> <span class='hs-keyglyph'>&lt;-</span> <span class='hs-varid'>getNewRegNat</span> <span class='hs-varid'>pk</span>
<a name="line-228"></a>    <span class='hs-keyword'>let</span>
<a name="line-229"></a>        <span class='hs-varid'>pk__2</span>   <span class='hs-keyglyph'>=</span> <span class='hs-varid'>cmmExprType</span> <span class='hs-varid'>platform</span> <span class='hs-varid'>src</span>
<a name="line-230"></a>        <span class='hs-varid'>code__2</span> <span class='hs-keyglyph'>=</span> <span class='hs-varid'>code1</span> <span class='hs-varop'>`appOL`</span> <span class='hs-varid'>code2</span> <span class='hs-varop'>`appOL`</span>
<a name="line-231"></a>            <span class='hs-keyword'>if</span>   <span class='hs-varid'>formatToWidth</span> <span class='hs-varid'>pk</span> <span class='hs-varop'>==</span> <span class='hs-varid'>typeWidth</span> <span class='hs-varid'>pk__2</span>
<a name="line-232"></a>            <span class='hs-keyword'>then</span> <span class='hs-varid'>unitOL</span> <span class='hs-layout'>(</span><span class='hs-conid'>ST</span> <span class='hs-varid'>pk</span> <span class='hs-varid'>src__2</span> <span class='hs-varid'>dst__2</span><span class='hs-layout'>)</span>
<a name="line-233"></a>            <span class='hs-keyword'>else</span> <span class='hs-varid'>toOL</span>   <span class='hs-keyglyph'>[</span> <span class='hs-conid'>FxTOy</span> <span class='hs-layout'>(</span><span class='hs-varid'>cmmTypeFormat</span> <span class='hs-varid'>pk__2</span><span class='hs-layout'>)</span> <span class='hs-varid'>pk</span> <span class='hs-varid'>src__2</span> <span class='hs-varid'>tmp1</span>
<a name="line-234"></a>                        <span class='hs-layout'>,</span> <span class='hs-conid'>ST</span>    <span class='hs-varid'>pk</span> <span class='hs-varid'>tmp1</span> <span class='hs-varid'>dst__2</span><span class='hs-keyglyph'>]</span>
<a name="line-235"></a>    <span class='hs-varid'>return</span> <span class='hs-varid'>code__2</span>
<a name="line-236"></a>
<a name="line-237"></a><a name="assignReg_FltCode"></a><span class='hs-comment'>-- Floating point assignment to a register/temporary</span>
<a name="line-238"></a><span class='hs-definition'>assignReg_FltCode</span> <span class='hs-keyglyph'>::</span> <span class='hs-conid'>Format</span> <span class='hs-keyglyph'>-&gt;</span> <span class='hs-conid'>CmmReg</span>  <span class='hs-keyglyph'>-&gt;</span> <span class='hs-conid'>CmmExpr</span> <span class='hs-keyglyph'>-&gt;</span> <span class='hs-conid'>NatM</span> <span class='hs-conid'>InstrBlock</span>
<a name="line-239"></a><span class='hs-definition'>assignReg_FltCode</span> <span class='hs-varid'>pk</span> <span class='hs-varid'>dstCmmReg</span> <span class='hs-varid'>srcCmmExpr</span> <span class='hs-keyglyph'>=</span> <span class='hs-keyword'>do</span>
<a name="line-240"></a>    <span class='hs-varid'>platform</span> <span class='hs-keyglyph'>&lt;-</span> <span class='hs-varid'>getPlatform</span>
<a name="line-241"></a>    <span class='hs-varid'>srcRegister</span> <span class='hs-keyglyph'>&lt;-</span> <span class='hs-varid'>getRegister</span> <span class='hs-varid'>srcCmmExpr</span>
<a name="line-242"></a>    <span class='hs-keyword'>let</span> <span class='hs-varid'>dstReg</span>  <span class='hs-keyglyph'>=</span> <span class='hs-varid'>getRegisterReg</span> <span class='hs-varid'>platform</span> <span class='hs-varid'>dstCmmReg</span>
<a name="line-243"></a>
<a name="line-244"></a>    <span class='hs-varid'>return</span> <span class='hs-varop'>$</span> <span class='hs-keyword'>case</span> <span class='hs-varid'>srcRegister</span> <span class='hs-keyword'>of</span>
<a name="line-245"></a>        <span class='hs-conid'>Any</span> <span class='hs-keyword'>_</span> <span class='hs-varid'>code</span>                  <span class='hs-keyglyph'>-&gt;</span> <span class='hs-varid'>code</span> <span class='hs-varid'>dstReg</span>
<a name="line-246"></a>        <span class='hs-conid'>Fixed</span> <span class='hs-keyword'>_</span> <span class='hs-varid'>srcFixedReg</span> <span class='hs-varid'>srcCode</span> <span class='hs-keyglyph'>-&gt;</span> <span class='hs-varid'>srcCode</span> <span class='hs-varop'>`snocOL`</span> <span class='hs-conid'>FMOV</span> <span class='hs-varid'>pk</span> <span class='hs-varid'>srcFixedReg</span> <span class='hs-varid'>dstReg</span>
<a name="line-247"></a>
<a name="line-248"></a>
<a name="line-249"></a>
<a name="line-250"></a>
<a name="line-251"></a><a name="genJump"></a><span class='hs-definition'>genJump</span> <span class='hs-keyglyph'>::</span> <span class='hs-conid'>CmmExpr</span><span class='hs-comment'>{-the branch target-}</span> <span class='hs-keyglyph'>-&gt;</span> <span class='hs-conid'>NatM</span> <span class='hs-conid'>InstrBlock</span>
<a name="line-252"></a>
<a name="line-253"></a><span class='hs-definition'>genJump</span> <span class='hs-layout'>(</span><span class='hs-conid'>CmmLit</span> <span class='hs-layout'>(</span><span class='hs-conid'>CmmLabel</span> <span class='hs-varid'>lbl</span><span class='hs-layout'>)</span><span class='hs-layout'>)</span>
<a name="line-254"></a>  <span class='hs-keyglyph'>=</span> <span class='hs-varid'>return</span> <span class='hs-layout'>(</span><span class='hs-varid'>toOL</span> <span class='hs-keyglyph'>[</span><span class='hs-conid'>CALL</span> <span class='hs-layout'>(</span><span class='hs-conid'>Left</span> <span class='hs-varid'>target</span><span class='hs-layout'>)</span> <span class='hs-num'>0</span> <span class='hs-conid'>True</span><span class='hs-layout'>,</span> <span class='hs-conid'>NOP</span><span class='hs-keyglyph'>]</span><span class='hs-layout'>)</span>
<a name="line-255"></a>  <span class='hs-keyword'>where</span>
<a name="line-256"></a>    <span class='hs-varid'>target</span> <span class='hs-keyglyph'>=</span> <span class='hs-conid'>ImmCLbl</span> <span class='hs-varid'>lbl</span>
<a name="line-257"></a>
<a name="line-258"></a><span class='hs-definition'>genJump</span> <span class='hs-varid'>tree</span>
<a name="line-259"></a>  <span class='hs-keyglyph'>=</span> <span class='hs-keyword'>do</span>
<a name="line-260"></a>        <span class='hs-layout'>(</span><span class='hs-varid'>target</span><span class='hs-layout'>,</span> <span class='hs-varid'>code</span><span class='hs-layout'>)</span> <span class='hs-keyglyph'>&lt;-</span> <span class='hs-varid'>getSomeReg</span> <span class='hs-varid'>tree</span>
<a name="line-261"></a>        <span class='hs-varid'>return</span> <span class='hs-layout'>(</span><span class='hs-varid'>code</span> <span class='hs-varop'>`snocOL`</span> <span class='hs-conid'>JMP</span> <span class='hs-layout'>(</span><span class='hs-conid'>AddrRegReg</span> <span class='hs-varid'>target</span> <span class='hs-varid'>g0</span><span class='hs-layout'>)</span>  <span class='hs-varop'>`snocOL`</span> <span class='hs-conid'>NOP</span><span class='hs-layout'>)</span>
<a name="line-262"></a>
<a name="line-263"></a><span class='hs-comment'>-- -----------------------------------------------------------------------------</span>
<a name="line-264"></a><span class='hs-comment'>--  Unconditional branches</span>
<a name="line-265"></a>
<a name="line-266"></a><a name="genBranch"></a><span class='hs-definition'>genBranch</span> <span class='hs-keyglyph'>::</span> <span class='hs-conid'>BlockId</span> <span class='hs-keyglyph'>-&gt;</span> <span class='hs-conid'>NatM</span> <span class='hs-conid'>InstrBlock</span>
<a name="line-267"></a><span class='hs-definition'>genBranch</span> <span class='hs-keyglyph'>=</span> <span class='hs-varid'>return</span> <span class='hs-varop'>.</span> <span class='hs-varid'>toOL</span> <span class='hs-varop'>.</span> <span class='hs-varid'>mkJumpInstr</span>
<a name="line-268"></a>
<a name="line-269"></a>
<a name="line-270"></a><span class='hs-comment'>-- -----------------------------------------------------------------------------</span>
<a name="line-271"></a><span class='hs-comment'>--  Conditional jumps</span>
<a name="line-272"></a>
<a name="line-273"></a><span class='hs-comment'>{-
<a name="line-274"></a>Conditional jumps are always to local labels, so we can use branch
<a name="line-275"></a>instructions.  We peek at the arguments to decide what kind of
<a name="line-276"></a>comparison to do.
<a name="line-277"></a>
<a name="line-278"></a>SPARC: First, we have to ensure that the condition codes are set
<a name="line-279"></a>according to the supplied comparison operation.  We generate slightly
<a name="line-280"></a>different code for floating point comparisons, because a floating
<a name="line-281"></a>point operation cannot directly precede a @BF@.  We assume the worst
<a name="line-282"></a>and fill that slot with a @NOP@.
<a name="line-283"></a>
<a name="line-284"></a>SPARC: Do not fill the delay slots here; you will confuse the register
<a name="line-285"></a>allocator.
<a name="line-286"></a>-}</span>
<a name="line-287"></a>
<a name="line-288"></a>
<a name="line-289"></a><a name="genCondJump"></a><span class='hs-definition'>genCondJump</span>
<a name="line-290"></a>    <span class='hs-keyglyph'>::</span> <span class='hs-conid'>BlockId</span>      <span class='hs-comment'>-- the branch target</span>
<a name="line-291"></a>    <span class='hs-keyglyph'>-&gt;</span> <span class='hs-conid'>CmmExpr</span>      <span class='hs-comment'>-- the condition on which to branch</span>
<a name="line-292"></a>    <span class='hs-keyglyph'>-&gt;</span> <span class='hs-conid'>NatM</span> <span class='hs-conid'>InstrBlock</span>
<a name="line-293"></a>
<a name="line-294"></a>
<a name="line-295"></a>
<a name="line-296"></a><span class='hs-definition'>genCondJump</span> <span class='hs-varid'>bid</span> <span class='hs-varid'>bool</span> <span class='hs-keyglyph'>=</span> <span class='hs-keyword'>do</span>
<a name="line-297"></a>  <span class='hs-conid'>CondCode</span> <span class='hs-varid'>is_float</span> <span class='hs-varid'>cond</span> <span class='hs-varid'>code</span> <span class='hs-keyglyph'>&lt;-</span> <span class='hs-varid'>getCondCode</span> <span class='hs-varid'>bool</span>
<a name="line-298"></a>  <span class='hs-varid'>return</span> <span class='hs-layout'>(</span>
<a name="line-299"></a>       <span class='hs-varid'>code</span> <span class='hs-varop'>`appOL`</span>
<a name="line-300"></a>       <span class='hs-varid'>toOL</span> <span class='hs-layout'>(</span>
<a name="line-301"></a>         <span class='hs-keyword'>if</span>   <span class='hs-varid'>is_float</span>
<a name="line-302"></a>         <span class='hs-keyword'>then</span> <span class='hs-keyglyph'>[</span><span class='hs-conid'>NOP</span><span class='hs-layout'>,</span> <span class='hs-conid'>BF</span> <span class='hs-varid'>cond</span> <span class='hs-conid'>False</span> <span class='hs-varid'>bid</span><span class='hs-layout'>,</span> <span class='hs-conid'>NOP</span><span class='hs-keyglyph'>]</span>
<a name="line-303"></a>         <span class='hs-keyword'>else</span> <span class='hs-keyglyph'>[</span><span class='hs-conid'>BI</span> <span class='hs-varid'>cond</span> <span class='hs-conid'>False</span> <span class='hs-varid'>bid</span><span class='hs-layout'>,</span> <span class='hs-conid'>NOP</span><span class='hs-keyglyph'>]</span>
<a name="line-304"></a>       <span class='hs-layout'>)</span>
<a name="line-305"></a>    <span class='hs-layout'>)</span>
<a name="line-306"></a>
<a name="line-307"></a>
<a name="line-308"></a>
<a name="line-309"></a><span class='hs-comment'>-- -----------------------------------------------------------------------------</span>
<a name="line-310"></a><span class='hs-comment'>-- Generating a table-branch</span>
<a name="line-311"></a>
<a name="line-312"></a><a name="genSwitch"></a><span class='hs-definition'>genSwitch</span> <span class='hs-keyglyph'>::</span> <span class='hs-conid'>NCGConfig</span> <span class='hs-keyglyph'>-&gt;</span> <span class='hs-conid'>CmmExpr</span> <span class='hs-keyglyph'>-&gt;</span> <span class='hs-conid'>SwitchTargets</span> <span class='hs-keyglyph'>-&gt;</span> <span class='hs-conid'>NatM</span> <span class='hs-conid'>InstrBlock</span>
<a name="line-313"></a><span class='hs-definition'>genSwitch</span> <span class='hs-varid'>config</span> <span class='hs-varid'>expr</span> <span class='hs-varid'>targets</span>
<a name="line-314"></a>        <span class='hs-keyglyph'>|</span> <span class='hs-varid'>ncgPIC</span> <span class='hs-varid'>config</span>
<a name="line-315"></a>        <span class='hs-keyglyph'>=</span> <span class='hs-varid'>error</span> <span class='hs-str'>"MachCodeGen: sparc genSwitch PIC not finished\n"</span>
<a name="line-316"></a>
<a name="line-317"></a>        <span class='hs-keyglyph'>|</span> <span class='hs-varid'>otherwise</span>
<a name="line-318"></a>        <span class='hs-keyglyph'>=</span> <span class='hs-keyword'>do</span>    <span class='hs-layout'>(</span><span class='hs-varid'>e_reg</span><span class='hs-layout'>,</span> <span class='hs-varid'>e_code</span><span class='hs-layout'>)</span> <span class='hs-keyglyph'>&lt;-</span> <span class='hs-varid'>getSomeReg</span> <span class='hs-layout'>(</span><span class='hs-varid'>cmmOffset</span> <span class='hs-layout'>(</span><span class='hs-varid'>ncgPlatform</span> <span class='hs-varid'>config</span><span class='hs-layout'>)</span> <span class='hs-varid'>expr</span> <span class='hs-varid'>offset</span><span class='hs-layout'>)</span>
<a name="line-319"></a>
<a name="line-320"></a>                <span class='hs-varid'>base_reg</span>        <span class='hs-keyglyph'>&lt;-</span> <span class='hs-varid'>getNewRegNat</span> <span class='hs-conid'>II32</span>
<a name="line-321"></a>                <span class='hs-varid'>offset_reg</span>      <span class='hs-keyglyph'>&lt;-</span> <span class='hs-varid'>getNewRegNat</span> <span class='hs-conid'>II32</span>
<a name="line-322"></a>                <span class='hs-varid'>dst</span>             <span class='hs-keyglyph'>&lt;-</span> <span class='hs-varid'>getNewRegNat</span> <span class='hs-conid'>II32</span>
<a name="line-323"></a>
<a name="line-324"></a>                <span class='hs-varid'>label</span>           <span class='hs-keyglyph'>&lt;-</span> <span class='hs-varid'>getNewLabelNat</span>
<a name="line-325"></a>
<a name="line-326"></a>                <span class='hs-varid'>return</span> <span class='hs-varop'>$</span> <span class='hs-varid'>e_code</span> <span class='hs-varop'>`appOL`</span>
<a name="line-327"></a>                 <span class='hs-varid'>toOL</span>
<a name="line-328"></a>                        <span class='hs-keyglyph'>[</span> <span class='hs-comment'>-- load base of jump table</span>
<a name="line-329"></a>                          <span class='hs-conid'>SETHI</span> <span class='hs-layout'>(</span><span class='hs-conid'>HI</span> <span class='hs-layout'>(</span><span class='hs-conid'>ImmCLbl</span> <span class='hs-varid'>label</span><span class='hs-layout'>)</span><span class='hs-layout'>)</span> <span class='hs-varid'>base_reg</span>
<a name="line-330"></a>                        <span class='hs-layout'>,</span> <span class='hs-conid'>OR</span>    <span class='hs-conid'>False</span> <span class='hs-varid'>base_reg</span> <span class='hs-layout'>(</span><span class='hs-conid'>RIImm</span> <span class='hs-varop'>$</span> <span class='hs-conid'>LO</span> <span class='hs-varop'>$</span> <span class='hs-conid'>ImmCLbl</span> <span class='hs-varid'>label</span><span class='hs-layout'>)</span> <span class='hs-varid'>base_reg</span>
<a name="line-331"></a>
<a name="line-332"></a>                        <span class='hs-comment'>-- the addrs in the table are 32 bits wide..</span>
<a name="line-333"></a>                        <span class='hs-layout'>,</span> <span class='hs-conid'>SLL</span>   <span class='hs-varid'>e_reg</span> <span class='hs-layout'>(</span><span class='hs-conid'>RIImm</span> <span class='hs-varop'>$</span> <span class='hs-conid'>ImmInt</span> <span class='hs-num'>2</span><span class='hs-layout'>)</span> <span class='hs-varid'>offset_reg</span>
<a name="line-334"></a>
<a name="line-335"></a>                        <span class='hs-comment'>-- load and jump to the destination</span>
<a name="line-336"></a>                        <span class='hs-layout'>,</span> <span class='hs-conid'>LD</span>      <span class='hs-conid'>II32</span> <span class='hs-layout'>(</span><span class='hs-conid'>AddrRegReg</span> <span class='hs-varid'>base_reg</span> <span class='hs-varid'>offset_reg</span><span class='hs-layout'>)</span> <span class='hs-varid'>dst</span>
<a name="line-337"></a>                        <span class='hs-layout'>,</span> <span class='hs-conid'>JMP_TBL</span> <span class='hs-layout'>(</span><span class='hs-conid'>AddrRegImm</span> <span class='hs-varid'>dst</span> <span class='hs-layout'>(</span><span class='hs-conid'>ImmInt</span> <span class='hs-num'>0</span><span class='hs-layout'>)</span><span class='hs-layout'>)</span> <span class='hs-varid'>ids</span> <span class='hs-varid'>label</span>
<a name="line-338"></a>                        <span class='hs-layout'>,</span> <span class='hs-conid'>NOP</span> <span class='hs-keyglyph'>]</span>
<a name="line-339"></a>  <span class='hs-keyword'>where</span> <span class='hs-layout'>(</span><span class='hs-varid'>offset</span><span class='hs-layout'>,</span> <span class='hs-varid'>ids</span><span class='hs-layout'>)</span> <span class='hs-keyglyph'>=</span> <span class='hs-varid'>switchTargetsToTable</span> <span class='hs-varid'>targets</span>
<a name="line-340"></a>
<a name="line-341"></a><a name="generateJumpTableForInstr"></a><span class='hs-definition'>generateJumpTableForInstr</span> <span class='hs-keyglyph'>::</span> <span class='hs-conid'>Platform</span> <span class='hs-keyglyph'>-&gt;</span> <span class='hs-conid'>Instr</span>
<a name="line-342"></a>                          <span class='hs-keyglyph'>-&gt;</span> <span class='hs-conid'>Maybe</span> <span class='hs-layout'>(</span><span class='hs-conid'>NatCmmDecl</span> <span class='hs-conid'>RawCmmStatics</span> <span class='hs-conid'>Instr</span><span class='hs-layout'>)</span>
<a name="line-343"></a><span class='hs-definition'>generateJumpTableForInstr</span> <span class='hs-varid'>platform</span> <span class='hs-layout'>(</span><span class='hs-conid'>JMP_TBL</span> <span class='hs-keyword'>_</span> <span class='hs-varid'>ids</span> <span class='hs-varid'>label</span><span class='hs-layout'>)</span> <span class='hs-keyglyph'>=</span>
<a name="line-344"></a>  <span class='hs-keyword'>let</span> <span class='hs-varid'>jumpTable</span> <span class='hs-keyglyph'>=</span> <span class='hs-varid'>map</span> <span class='hs-layout'>(</span><span class='hs-varid'>jumpTableEntry</span> <span class='hs-varid'>platform</span><span class='hs-layout'>)</span> <span class='hs-varid'>ids</span>
<a name="line-345"></a>  <span class='hs-keyword'>in</span> <span class='hs-conid'>Just</span> <span class='hs-layout'>(</span><span class='hs-conid'>CmmData</span> <span class='hs-layout'>(</span><span class='hs-conid'>Section</span> <span class='hs-conid'>ReadOnlyData</span> <span class='hs-varid'>label</span><span class='hs-layout'>)</span> <span class='hs-layout'>(</span><span class='hs-conid'>CmmStaticsRaw</span> <span class='hs-varid'>label</span> <span class='hs-varid'>jumpTable</span><span class='hs-layout'>)</span><span class='hs-layout'>)</span>
<a name="line-346"></a><span class='hs-definition'>generateJumpTableForInstr</span> <span class='hs-keyword'>_</span> <span class='hs-keyword'>_</span> <span class='hs-keyglyph'>=</span> <span class='hs-conid'>Nothing</span>
<a name="line-347"></a>
<a name="line-348"></a>
<a name="line-349"></a>
<a name="line-350"></a><span class='hs-comment'>-- -----------------------------------------------------------------------------</span>
<a name="line-351"></a><span class='hs-comment'>-- Generating C calls</span>
<a name="line-352"></a>
<a name="line-353"></a><span class='hs-comment'>{-
<a name="line-354"></a>   Now the biggest nightmare---calls.  Most of the nastiness is buried in
<a name="line-355"></a>   @get_arg@, which moves the arguments to the correct registers/stack
<a name="line-356"></a>   locations.  Apart from that, the code is easy.
<a name="line-357"></a>
<a name="line-358"></a>   The SPARC calling convention is an absolute
<a name="line-359"></a>   nightmare.  The first 6x32 bits of arguments are mapped into
<a name="line-360"></a>   %o0 through %o5, and the remaining arguments are dumped to the
<a name="line-361"></a>   stack, beginning at [%sp+92].  (Note that %o6 == %sp.)
<a name="line-362"></a>
<a name="line-363"></a>   If we have to put args on the stack, move %o6==%sp down by
<a name="line-364"></a>   the number of words to go on the stack, to ensure there's enough space.
<a name="line-365"></a>
<a name="line-366"></a>   According to Fraser and Hanson's lcc book, page 478, fig 17.2,
<a name="line-367"></a>   16 words above the stack pointer is a word for the address of
<a name="line-368"></a>   a structure return value.  I use this as a temporary location
<a name="line-369"></a>   for moving values from float to int regs.  Certainly it isn't
<a name="line-370"></a>   safe to put anything in the 16 words starting at %sp, since
<a name="line-371"></a>   this area can get trashed at any time due to window overflows
<a name="line-372"></a>   caused by signal handlers.
<a name="line-373"></a>
<a name="line-374"></a>   A final complication (if the above isn't enough) is that
<a name="line-375"></a>   we can't blithely calculate the arguments one by one into
<a name="line-376"></a>   %o0 .. %o5.  Consider the following nested calls:
<a name="line-377"></a>
<a name="line-378"></a>       fff a (fff b c)
<a name="line-379"></a>
<a name="line-380"></a>   Naive code moves a into %o0, and (fff b c) into %o1.  Unfortunately
<a name="line-381"></a>   the inner call will itself use %o0, which trashes the value put there
<a name="line-382"></a>   in preparation for the outer call.  Upshot: we need to calculate the
<a name="line-383"></a>   args into temporary regs, and move those to arg regs or onto the
<a name="line-384"></a>   stack only immediately prior to the call proper.  Sigh.
<a name="line-385"></a>-}</span>
<a name="line-386"></a>
<a name="line-387"></a><a name="genCCall"></a><span class='hs-definition'>genCCall</span>
<a name="line-388"></a>    <span class='hs-keyglyph'>::</span> <span class='hs-conid'>ForeignTarget</span>            <span class='hs-comment'>-- function to call</span>
<a name="line-389"></a>    <span class='hs-keyglyph'>-&gt;</span> <span class='hs-keyglyph'>[</span><span class='hs-conid'>CmmFormal</span><span class='hs-keyglyph'>]</span>        <span class='hs-comment'>-- where to put the result</span>
<a name="line-390"></a>    <span class='hs-keyglyph'>-&gt;</span> <span class='hs-keyglyph'>[</span><span class='hs-conid'>CmmActual</span><span class='hs-keyglyph'>]</span>        <span class='hs-comment'>-- arguments (of mixed type)</span>
<a name="line-391"></a>    <span class='hs-keyglyph'>-&gt;</span> <span class='hs-conid'>NatM</span> <span class='hs-conid'>InstrBlock</span>
<a name="line-392"></a>
<a name="line-393"></a>
<a name="line-394"></a>
<a name="line-395"></a><span class='hs-comment'>-- On SPARC under TSO (Total Store Ordering), writes earlier in the instruction stream</span>
<a name="line-396"></a><span class='hs-comment'>-- are guaranteed to take place before writes afterwards (unlike on PowerPC).</span>
<a name="line-397"></a><span class='hs-comment'>-- Ref: Section 8.4 of the SPARC V9 Architecture manual.</span>
<a name="line-398"></a><span class='hs-comment'>--</span>
<a name="line-399"></a><span class='hs-comment'>-- In the SPARC case we don't need a barrier.</span>
<a name="line-400"></a><span class='hs-comment'>--</span>
<a name="line-401"></a><span class='hs-definition'>genCCall</span> <span class='hs-layout'>(</span><span class='hs-conid'>PrimTarget</span> <span class='hs-conid'>MO_ReadBarrier</span><span class='hs-layout'>)</span> <span class='hs-keyword'>_</span> <span class='hs-keyword'>_</span>
<a name="line-402"></a> <span class='hs-keyglyph'>=</span> <span class='hs-varid'>return</span> <span class='hs-varop'>$</span> <span class='hs-varid'>nilOL</span>
<a name="line-403"></a><span class='hs-definition'>genCCall</span> <span class='hs-layout'>(</span><span class='hs-conid'>PrimTarget</span> <span class='hs-conid'>MO_WriteBarrier</span><span class='hs-layout'>)</span> <span class='hs-keyword'>_</span> <span class='hs-keyword'>_</span>
<a name="line-404"></a> <span class='hs-keyglyph'>=</span> <span class='hs-varid'>return</span> <span class='hs-varop'>$</span> <span class='hs-varid'>nilOL</span>
<a name="line-405"></a>
<a name="line-406"></a><span class='hs-definition'>genCCall</span> <span class='hs-layout'>(</span><span class='hs-conid'>PrimTarget</span> <span class='hs-layout'>(</span><span class='hs-conid'>MO_Prefetch_Data</span> <span class='hs-keyword'>_</span><span class='hs-layout'>)</span><span class='hs-layout'>)</span> <span class='hs-keyword'>_</span> <span class='hs-keyword'>_</span>
<a name="line-407"></a> <span class='hs-keyglyph'>=</span> <span class='hs-varid'>return</span> <span class='hs-varop'>$</span> <span class='hs-varid'>nilOL</span>
<a name="line-408"></a>
<a name="line-409"></a><span class='hs-definition'>genCCall</span> <span class='hs-varid'>target</span> <span class='hs-varid'>dest_regs</span> <span class='hs-varid'>args</span>
<a name="line-410"></a> <span class='hs-keyglyph'>=</span> <span class='hs-keyword'>do</span>   <span class='hs-comment'>-- work out the arguments, and assign them to integer regs</span>
<a name="line-411"></a>        <span class='hs-varid'>argcode_and_vregs</span>       <span class='hs-keyglyph'>&lt;-</span> <span class='hs-varid'>mapM</span> <span class='hs-varid'>arg_to_int_vregs</span> <span class='hs-varid'>args</span>
<a name="line-412"></a>        <span class='hs-keyword'>let</span> <span class='hs-layout'>(</span><span class='hs-varid'>argcodes</span><span class='hs-layout'>,</span> <span class='hs-varid'>vregss</span><span class='hs-layout'>)</span>  <span class='hs-keyglyph'>=</span> <span class='hs-varid'>unzip</span> <span class='hs-varid'>argcode_and_vregs</span>
<a name="line-413"></a>        <span class='hs-keyword'>let</span> <span class='hs-varid'>vregs</span>               <span class='hs-keyglyph'>=</span> <span class='hs-varid'>concat</span> <span class='hs-varid'>vregss</span>
<a name="line-414"></a>
<a name="line-415"></a>        <span class='hs-keyword'>let</span> <span class='hs-varid'>n_argRegs</span>           <span class='hs-keyglyph'>=</span> <span class='hs-varid'>length</span> <span class='hs-varid'>allArgRegs</span>
<a name="line-416"></a>        <span class='hs-keyword'>let</span> <span class='hs-varid'>n_argRegs_used</span>      <span class='hs-keyglyph'>=</span> <span class='hs-varid'>min</span> <span class='hs-layout'>(</span><span class='hs-varid'>length</span> <span class='hs-varid'>vregs</span><span class='hs-layout'>)</span> <span class='hs-varid'>n_argRegs</span>
<a name="line-417"></a>
<a name="line-418"></a>
<a name="line-419"></a>        <span class='hs-comment'>-- deal with static vs dynamic call targets</span>
<a name="line-420"></a>        <span class='hs-varid'>callinsns</span> <span class='hs-keyglyph'>&lt;-</span> <span class='hs-keyword'>case</span> <span class='hs-varid'>target</span> <span class='hs-keyword'>of</span>
<a name="line-421"></a>                <span class='hs-conid'>ForeignTarget</span> <span class='hs-layout'>(</span><span class='hs-conid'>CmmLit</span> <span class='hs-layout'>(</span><span class='hs-conid'>CmmLabel</span> <span class='hs-varid'>lbl</span><span class='hs-layout'>)</span><span class='hs-layout'>)</span> <span class='hs-keyword'>_</span> <span class='hs-keyglyph'>-&gt;</span>
<a name="line-422"></a>                        <span class='hs-varid'>return</span> <span class='hs-layout'>(</span><span class='hs-varid'>unitOL</span> <span class='hs-layout'>(</span><span class='hs-conid'>CALL</span> <span class='hs-layout'>(</span><span class='hs-conid'>Left</span> <span class='hs-layout'>(</span><span class='hs-varid'>litToImm</span> <span class='hs-layout'>(</span><span class='hs-conid'>CmmLabel</span> <span class='hs-varid'>lbl</span><span class='hs-layout'>)</span><span class='hs-layout'>)</span><span class='hs-layout'>)</span> <span class='hs-varid'>n_argRegs_used</span> <span class='hs-conid'>False</span><span class='hs-layout'>)</span><span class='hs-layout'>)</span>
<a name="line-423"></a>
<a name="line-424"></a>                <span class='hs-conid'>ForeignTarget</span> <span class='hs-varid'>expr</span> <span class='hs-keyword'>_</span>
<a name="line-425"></a>                 <span class='hs-keyglyph'>-&gt;</span> <span class='hs-keyword'>do</span>  <span class='hs-layout'>(</span><span class='hs-varid'>dyn_c</span><span class='hs-layout'>,</span> <span class='hs-varid'>dyn_rs</span><span class='hs-layout'>)</span> <span class='hs-keyglyph'>&lt;-</span> <span class='hs-varid'>arg_to_int_vregs</span> <span class='hs-varid'>expr</span>
<a name="line-426"></a>                        <span class='hs-keyword'>let</span> <span class='hs-varid'>dyn_r</span> <span class='hs-keyglyph'>=</span> <span class='hs-keyword'>case</span> <span class='hs-varid'>dyn_rs</span> <span class='hs-keyword'>of</span>
<a name="line-427"></a>                                      <span class='hs-keyglyph'>[</span><span class='hs-varid'>dyn_r'</span><span class='hs-keyglyph'>]</span> <span class='hs-keyglyph'>-&gt;</span> <span class='hs-varid'>dyn_r'</span>
<a name="line-428"></a>                                      <span class='hs-keyword'>_</span> <span class='hs-keyglyph'>-&gt;</span> <span class='hs-varid'>panic</span> <span class='hs-str'>"SPARC.CodeGen.genCCall: arg_to_int"</span>
<a name="line-429"></a>                        <span class='hs-varid'>return</span> <span class='hs-layout'>(</span><span class='hs-varid'>dyn_c</span> <span class='hs-varop'>`snocOL`</span> <span class='hs-conid'>CALL</span> <span class='hs-layout'>(</span><span class='hs-conid'>Right</span> <span class='hs-varid'>dyn_r</span><span class='hs-layout'>)</span> <span class='hs-varid'>n_argRegs_used</span> <span class='hs-conid'>False</span><span class='hs-layout'>)</span>
<a name="line-430"></a>
<a name="line-431"></a>                <span class='hs-conid'>PrimTarget</span> <span class='hs-varid'>mop</span>
<a name="line-432"></a>                 <span class='hs-keyglyph'>-&gt;</span> <span class='hs-keyword'>do</span>  <span class='hs-varid'>res</span>     <span class='hs-keyglyph'>&lt;-</span> <span class='hs-varid'>outOfLineMachOp</span> <span class='hs-varid'>mop</span>
<a name="line-433"></a>                        <span class='hs-keyword'>case</span> <span class='hs-varid'>res</span> <span class='hs-keyword'>of</span>
<a name="line-434"></a>                                <span class='hs-conid'>Left</span> <span class='hs-varid'>lbl</span> <span class='hs-keyglyph'>-&gt;</span>
<a name="line-435"></a>                                        <span class='hs-varid'>return</span> <span class='hs-layout'>(</span><span class='hs-varid'>unitOL</span> <span class='hs-layout'>(</span><span class='hs-conid'>CALL</span> <span class='hs-layout'>(</span><span class='hs-conid'>Left</span> <span class='hs-layout'>(</span><span class='hs-varid'>litToImm</span> <span class='hs-layout'>(</span><span class='hs-conid'>CmmLabel</span> <span class='hs-varid'>lbl</span><span class='hs-layout'>)</span><span class='hs-layout'>)</span><span class='hs-layout'>)</span> <span class='hs-varid'>n_argRegs_used</span> <span class='hs-conid'>False</span><span class='hs-layout'>)</span><span class='hs-layout'>)</span>
<a name="line-436"></a>
<a name="line-437"></a>                                <span class='hs-conid'>Right</span> <span class='hs-varid'>mopExpr</span> <span class='hs-keyglyph'>-&gt;</span> <span class='hs-keyword'>do</span>
<a name="line-438"></a>                                        <span class='hs-layout'>(</span><span class='hs-varid'>dyn_c</span><span class='hs-layout'>,</span> <span class='hs-varid'>dyn_rs</span><span class='hs-layout'>)</span> <span class='hs-keyglyph'>&lt;-</span> <span class='hs-varid'>arg_to_int_vregs</span> <span class='hs-varid'>mopExpr</span>
<a name="line-439"></a>                                        <span class='hs-keyword'>let</span> <span class='hs-varid'>dyn_r</span> <span class='hs-keyglyph'>=</span> <span class='hs-keyword'>case</span> <span class='hs-varid'>dyn_rs</span> <span class='hs-keyword'>of</span>
<a name="line-440"></a>                                                      <span class='hs-keyglyph'>[</span><span class='hs-varid'>dyn_r'</span><span class='hs-keyglyph'>]</span> <span class='hs-keyglyph'>-&gt;</span> <span class='hs-varid'>dyn_r'</span>
<a name="line-441"></a>                                                      <span class='hs-keyword'>_</span> <span class='hs-keyglyph'>-&gt;</span> <span class='hs-varid'>panic</span> <span class='hs-str'>"SPARC.CodeGen.genCCall: arg_to_int"</span>
<a name="line-442"></a>                                        <span class='hs-varid'>return</span> <span class='hs-layout'>(</span><span class='hs-varid'>dyn_c</span> <span class='hs-varop'>`snocOL`</span> <span class='hs-conid'>CALL</span> <span class='hs-layout'>(</span><span class='hs-conid'>Right</span> <span class='hs-varid'>dyn_r</span><span class='hs-layout'>)</span> <span class='hs-varid'>n_argRegs_used</span> <span class='hs-conid'>False</span><span class='hs-layout'>)</span>
<a name="line-443"></a>
<a name="line-444"></a>        <span class='hs-keyword'>let</span> <span class='hs-varid'>argcode</span> <span class='hs-keyglyph'>=</span> <span class='hs-varid'>concatOL</span> <span class='hs-varid'>argcodes</span>
<a name="line-445"></a>
<a name="line-446"></a>        <span class='hs-keyword'>let</span> <span class='hs-layout'>(</span><span class='hs-varid'>move_sp_down</span><span class='hs-layout'>,</span> <span class='hs-varid'>move_sp_up</span><span class='hs-layout'>)</span>
<a name="line-447"></a>                   <span class='hs-keyglyph'>=</span> <span class='hs-keyword'>let</span> <span class='hs-varid'>diff</span> <span class='hs-keyglyph'>=</span> <span class='hs-varid'>length</span> <span class='hs-varid'>vregs</span> <span class='hs-comment'>-</span> <span class='hs-varid'>n_argRegs</span>
<a name="line-448"></a>                         <span class='hs-varid'>nn</span>   <span class='hs-keyglyph'>=</span> <span class='hs-keyword'>if</span> <span class='hs-varid'>odd</span> <span class='hs-varid'>diff</span> <span class='hs-keyword'>then</span> <span class='hs-varid'>diff</span> <span class='hs-varop'>+</span> <span class='hs-num'>1</span> <span class='hs-keyword'>else</span> <span class='hs-varid'>diff</span> <span class='hs-comment'>-- keep 8-byte alignment</span>
<a name="line-449"></a>                     <span class='hs-keyword'>in</span>  <span class='hs-keyword'>if</span>   <span class='hs-varid'>nn</span> <span class='hs-varop'>&lt;=</span> <span class='hs-num'>0</span>
<a name="line-450"></a>                         <span class='hs-keyword'>then</span> <span class='hs-layout'>(</span><span class='hs-varid'>nilOL</span><span class='hs-layout'>,</span> <span class='hs-varid'>nilOL</span><span class='hs-layout'>)</span>
<a name="line-451"></a>                         <span class='hs-keyword'>else</span> <span class='hs-layout'>(</span><span class='hs-varid'>unitOL</span> <span class='hs-layout'>(</span><span class='hs-varid'>moveSp</span> <span class='hs-layout'>(</span><span class='hs-comment'>-</span><span class='hs-num'>1</span><span class='hs-varop'>*</span><span class='hs-varid'>nn</span><span class='hs-layout'>)</span><span class='hs-layout'>)</span><span class='hs-layout'>,</span> <span class='hs-varid'>unitOL</span> <span class='hs-layout'>(</span><span class='hs-varid'>moveSp</span> <span class='hs-layout'>(</span><span class='hs-num'>1</span><span class='hs-varop'>*</span><span class='hs-varid'>nn</span><span class='hs-layout'>)</span><span class='hs-layout'>)</span><span class='hs-layout'>)</span>
<a name="line-452"></a>
<a name="line-453"></a>        <span class='hs-keyword'>let</span> <span class='hs-varid'>transfer_code</span>
<a name="line-454"></a>                <span class='hs-keyglyph'>=</span> <span class='hs-varid'>toOL</span> <span class='hs-layout'>(</span><span class='hs-varid'>move_final</span> <span class='hs-varid'>vregs</span> <span class='hs-varid'>allArgRegs</span> <span class='hs-varid'>extraStackArgsHere</span><span class='hs-layout'>)</span>
<a name="line-455"></a>
<a name="line-456"></a>        <span class='hs-varid'>platform</span> <span class='hs-keyglyph'>&lt;-</span> <span class='hs-varid'>getPlatform</span>
<a name="line-457"></a>        <span class='hs-varid'>return</span>
<a name="line-458"></a>         <span class='hs-varop'>$</span>      <span class='hs-varid'>argcode</span>                 <span class='hs-varop'>`appOL`</span>
<a name="line-459"></a>                <span class='hs-varid'>move_sp_down</span>            <span class='hs-varop'>`appOL`</span>
<a name="line-460"></a>                <span class='hs-varid'>transfer_code</span>           <span class='hs-varop'>`appOL`</span>
<a name="line-461"></a>                <span class='hs-varid'>callinsns</span>               <span class='hs-varop'>`appOL`</span>
<a name="line-462"></a>                <span class='hs-varid'>unitOL</span> <span class='hs-conid'>NOP</span>              <span class='hs-varop'>`appOL`</span>
<a name="line-463"></a>                <span class='hs-varid'>move_sp_up</span>              <span class='hs-varop'>`appOL`</span>
<a name="line-464"></a>                <span class='hs-varid'>assign_code</span> <span class='hs-varid'>platform</span> <span class='hs-varid'>dest_regs</span>
<a name="line-465"></a>
<a name="line-466"></a>
<a name="line-467"></a><a name="arg_to_int_vregs"></a><span class='hs-comment'>-- | Generate code to calculate an argument, and move it into one</span>
<a name="line-468"></a><span class='hs-comment'>--      or two integer vregs.</span>
<a name="line-469"></a><span class='hs-definition'>arg_to_int_vregs</span> <span class='hs-keyglyph'>::</span> <span class='hs-conid'>CmmExpr</span> <span class='hs-keyglyph'>-&gt;</span> <span class='hs-conid'>NatM</span> <span class='hs-layout'>(</span><span class='hs-conid'>OrdList</span> <span class='hs-conid'>Instr</span><span class='hs-layout'>,</span> <span class='hs-keyglyph'>[</span><span class='hs-conid'>Reg</span><span class='hs-keyglyph'>]</span><span class='hs-layout'>)</span>
<a name="line-470"></a><span class='hs-definition'>arg_to_int_vregs</span> <span class='hs-varid'>arg</span> <span class='hs-keyglyph'>=</span> <span class='hs-keyword'>do</span> <span class='hs-varid'>platform</span> <span class='hs-keyglyph'>&lt;-</span> <span class='hs-varid'>getPlatform</span>
<a name="line-471"></a>                          <span class='hs-varid'>arg_to_int_vregs'</span> <span class='hs-varid'>platform</span> <span class='hs-varid'>arg</span>
<a name="line-472"></a>
<a name="line-473"></a><a name="arg_to_int_vregs'"></a><span class='hs-definition'>arg_to_int_vregs'</span> <span class='hs-keyglyph'>::</span> <span class='hs-conid'>Platform</span> <span class='hs-keyglyph'>-&gt;</span> <span class='hs-conid'>CmmExpr</span> <span class='hs-keyglyph'>-&gt;</span> <span class='hs-conid'>NatM</span> <span class='hs-layout'>(</span><span class='hs-conid'>OrdList</span> <span class='hs-conid'>Instr</span><span class='hs-layout'>,</span> <span class='hs-keyglyph'>[</span><span class='hs-conid'>Reg</span><span class='hs-keyglyph'>]</span><span class='hs-layout'>)</span>
<a name="line-474"></a><span class='hs-definition'>arg_to_int_vregs'</span> <span class='hs-varid'>platform</span> <span class='hs-varid'>arg</span>
<a name="line-475"></a>
<a name="line-476"></a>        <span class='hs-comment'>-- If the expr produces a 64 bit int, then we can just use iselExpr64</span>
<a name="line-477"></a>        <span class='hs-keyglyph'>|</span> <span class='hs-varid'>isWord64</span> <span class='hs-layout'>(</span><span class='hs-varid'>cmmExprType</span> <span class='hs-varid'>platform</span> <span class='hs-varid'>arg</span><span class='hs-layout'>)</span>
<a name="line-478"></a>        <span class='hs-keyglyph'>=</span> <span class='hs-keyword'>do</span>    <span class='hs-layout'>(</span><span class='hs-conid'>ChildCode64</span> <span class='hs-varid'>code</span> <span class='hs-varid'>r_lo</span><span class='hs-layout'>)</span> <span class='hs-keyglyph'>&lt;-</span> <span class='hs-varid'>iselExpr64</span> <span class='hs-varid'>arg</span>
<a name="line-479"></a>                <span class='hs-keyword'>let</span> <span class='hs-varid'>r_hi</span>                <span class='hs-keyglyph'>=</span> <span class='hs-varid'>getHiVRegFromLo</span> <span class='hs-varid'>r_lo</span>
<a name="line-480"></a>                <span class='hs-varid'>return</span> <span class='hs-layout'>(</span><span class='hs-varid'>code</span><span class='hs-layout'>,</span> <span class='hs-keyglyph'>[</span><span class='hs-varid'>r_hi</span><span class='hs-layout'>,</span> <span class='hs-varid'>r_lo</span><span class='hs-keyglyph'>]</span><span class='hs-layout'>)</span>
<a name="line-481"></a>
<a name="line-482"></a>        <span class='hs-keyglyph'>|</span> <span class='hs-varid'>otherwise</span>
<a name="line-483"></a>        <span class='hs-keyglyph'>=</span> <span class='hs-keyword'>do</span>    <span class='hs-layout'>(</span><span class='hs-varid'>src</span><span class='hs-layout'>,</span> <span class='hs-varid'>code</span><span class='hs-layout'>)</span>     <span class='hs-keyglyph'>&lt;-</span> <span class='hs-varid'>getSomeReg</span> <span class='hs-varid'>arg</span>
<a name="line-484"></a>                <span class='hs-keyword'>let</span> <span class='hs-varid'>pk</span>          <span class='hs-keyglyph'>=</span> <span class='hs-varid'>cmmExprType</span> <span class='hs-varid'>platform</span> <span class='hs-varid'>arg</span>
<a name="line-485"></a>
<a name="line-486"></a>                <span class='hs-keyword'>case</span> <span class='hs-varid'>cmmTypeFormat</span> <span class='hs-varid'>pk</span> <span class='hs-keyword'>of</span>
<a name="line-487"></a>
<a name="line-488"></a>                 <span class='hs-comment'>-- Load a 64 bit float return value into two integer regs.</span>
<a name="line-489"></a>                 <span class='hs-conid'>FF64</span> <span class='hs-keyglyph'>-&gt;</span> <span class='hs-keyword'>do</span>
<a name="line-490"></a>                        <span class='hs-varid'>v1</span> <span class='hs-keyglyph'>&lt;-</span> <span class='hs-varid'>getNewRegNat</span> <span class='hs-conid'>II32</span>
<a name="line-491"></a>                        <span class='hs-varid'>v2</span> <span class='hs-keyglyph'>&lt;-</span> <span class='hs-varid'>getNewRegNat</span> <span class='hs-conid'>II32</span>
<a name="line-492"></a>
<a name="line-493"></a>                        <span class='hs-keyword'>let</span> <span class='hs-varid'>code2</span> <span class='hs-keyglyph'>=</span>
<a name="line-494"></a>                                <span class='hs-varid'>code</span>                            <span class='hs-varop'>`snocOL`</span>
<a name="line-495"></a>                                <span class='hs-conid'>FMOV</span> <span class='hs-conid'>FF64</span> <span class='hs-varid'>src</span> <span class='hs-varid'>f0</span>                <span class='hs-varop'>`snocOL`</span>
<a name="line-496"></a>                                <span class='hs-conid'>ST</span>   <span class='hs-conid'>FF32</span>  <span class='hs-varid'>f0</span> <span class='hs-layout'>(</span><span class='hs-varid'>spRel</span> <span class='hs-num'>16</span><span class='hs-layout'>)</span>        <span class='hs-varop'>`snocOL`</span>
<a name="line-497"></a>                                <span class='hs-conid'>LD</span>   <span class='hs-conid'>II32</span>  <span class='hs-layout'>(</span><span class='hs-varid'>spRel</span> <span class='hs-num'>16</span><span class='hs-layout'>)</span> <span class='hs-varid'>v1</span>        <span class='hs-varop'>`snocOL`</span>
<a name="line-498"></a>                                <span class='hs-conid'>ST</span>   <span class='hs-conid'>FF32</span>  <span class='hs-varid'>f1</span> <span class='hs-layout'>(</span><span class='hs-varid'>spRel</span> <span class='hs-num'>16</span><span class='hs-layout'>)</span>        <span class='hs-varop'>`snocOL`</span>
<a name="line-499"></a>                                <span class='hs-conid'>LD</span>   <span class='hs-conid'>II32</span>  <span class='hs-layout'>(</span><span class='hs-varid'>spRel</span> <span class='hs-num'>16</span><span class='hs-layout'>)</span> <span class='hs-varid'>v2</span>
<a name="line-500"></a>
<a name="line-501"></a>                        <span class='hs-varid'>return</span>  <span class='hs-layout'>(</span><span class='hs-varid'>code2</span><span class='hs-layout'>,</span> <span class='hs-keyglyph'>[</span><span class='hs-varid'>v1</span><span class='hs-layout'>,</span><span class='hs-varid'>v2</span><span class='hs-keyglyph'>]</span><span class='hs-layout'>)</span>
<a name="line-502"></a>
<a name="line-503"></a>                 <span class='hs-comment'>-- Load a 32 bit float return value into an integer reg</span>
<a name="line-504"></a>                 <span class='hs-conid'>FF32</span> <span class='hs-keyglyph'>-&gt;</span> <span class='hs-keyword'>do</span>
<a name="line-505"></a>                        <span class='hs-varid'>v1</span> <span class='hs-keyglyph'>&lt;-</span> <span class='hs-varid'>getNewRegNat</span> <span class='hs-conid'>II32</span>
<a name="line-506"></a>
<a name="line-507"></a>                        <span class='hs-keyword'>let</span> <span class='hs-varid'>code2</span> <span class='hs-keyglyph'>=</span>
<a name="line-508"></a>                                <span class='hs-varid'>code</span>                            <span class='hs-varop'>`snocOL`</span>
<a name="line-509"></a>                                <span class='hs-conid'>ST</span>   <span class='hs-conid'>FF32</span>  <span class='hs-varid'>src</span> <span class='hs-layout'>(</span><span class='hs-varid'>spRel</span> <span class='hs-num'>16</span><span class='hs-layout'>)</span>       <span class='hs-varop'>`snocOL`</span>
<a name="line-510"></a>                                <span class='hs-conid'>LD</span>   <span class='hs-conid'>II32</span>  <span class='hs-layout'>(</span><span class='hs-varid'>spRel</span> <span class='hs-num'>16</span><span class='hs-layout'>)</span> <span class='hs-varid'>v1</span>
<a name="line-511"></a>
<a name="line-512"></a>                        <span class='hs-varid'>return</span> <span class='hs-layout'>(</span><span class='hs-varid'>code2</span><span class='hs-layout'>,</span> <span class='hs-keyglyph'>[</span><span class='hs-varid'>v1</span><span class='hs-keyglyph'>]</span><span class='hs-layout'>)</span>
<a name="line-513"></a>
<a name="line-514"></a>                 <span class='hs-comment'>-- Move an integer return value into its destination reg.</span>
<a name="line-515"></a>                 <span class='hs-keyword'>_</span> <span class='hs-keyglyph'>-&gt;</span> <span class='hs-keyword'>do</span>
<a name="line-516"></a>                        <span class='hs-varid'>v1</span> <span class='hs-keyglyph'>&lt;-</span> <span class='hs-varid'>getNewRegNat</span> <span class='hs-conid'>II32</span>
<a name="line-517"></a>
<a name="line-518"></a>                        <span class='hs-keyword'>let</span> <span class='hs-varid'>code2</span> <span class='hs-keyglyph'>=</span>
<a name="line-519"></a>                                <span class='hs-varid'>code</span>                            <span class='hs-varop'>`snocOL`</span>
<a name="line-520"></a>                                <span class='hs-conid'>OR</span> <span class='hs-conid'>False</span> <span class='hs-varid'>g0</span> <span class='hs-layout'>(</span><span class='hs-conid'>RIReg</span> <span class='hs-varid'>src</span><span class='hs-layout'>)</span> <span class='hs-varid'>v1</span>
<a name="line-521"></a>
<a name="line-522"></a>                        <span class='hs-varid'>return</span> <span class='hs-layout'>(</span><span class='hs-varid'>code2</span><span class='hs-layout'>,</span> <span class='hs-keyglyph'>[</span><span class='hs-varid'>v1</span><span class='hs-keyglyph'>]</span><span class='hs-layout'>)</span>
<a name="line-523"></a>
<a name="line-524"></a>
<a name="line-525"></a><a name="move_final"></a><span class='hs-comment'>-- | Move args from the integer vregs into which they have been</span>
<a name="line-526"></a><span class='hs-comment'>--      marshalled, into %o0 .. %o5, and the rest onto the stack.</span>
<a name="line-527"></a><span class='hs-comment'>--</span>
<a name="line-528"></a><span class='hs-definition'>move_final</span> <span class='hs-keyglyph'>::</span> <span class='hs-keyglyph'>[</span><span class='hs-conid'>Reg</span><span class='hs-keyglyph'>]</span> <span class='hs-keyglyph'>-&gt;</span> <span class='hs-keyglyph'>[</span><span class='hs-conid'>Reg</span><span class='hs-keyglyph'>]</span> <span class='hs-keyglyph'>-&gt;</span> <span class='hs-conid'>Int</span> <span class='hs-keyglyph'>-&gt;</span> <span class='hs-keyglyph'>[</span><span class='hs-conid'>Instr</span><span class='hs-keyglyph'>]</span>
<a name="line-529"></a>
<a name="line-530"></a><span class='hs-comment'>-- all args done</span>
<a name="line-531"></a><span class='hs-definition'>move_final</span> <span class='hs-conid'>[]</span> <span class='hs-keyword'>_</span> <span class='hs-keyword'>_</span>
<a name="line-532"></a>        <span class='hs-keyglyph'>=</span> <span class='hs-conid'>[]</span>
<a name="line-533"></a>
<a name="line-534"></a><span class='hs-comment'>-- out of aregs; move to stack</span>
<a name="line-535"></a><span class='hs-definition'>move_final</span> <span class='hs-layout'>(</span><span class='hs-varid'>v</span><span class='hs-conop'>:</span><span class='hs-varid'>vs</span><span class='hs-layout'>)</span> <span class='hs-conid'>[]</span> <span class='hs-varid'>offset</span>
<a name="line-536"></a>        <span class='hs-keyglyph'>=</span> <span class='hs-conid'>ST</span> <span class='hs-conid'>II32</span> <span class='hs-varid'>v</span> <span class='hs-layout'>(</span><span class='hs-varid'>spRel</span> <span class='hs-varid'>offset</span><span class='hs-layout'>)</span>
<a name="line-537"></a>        <span class='hs-conop'>:</span> <span class='hs-varid'>move_final</span> <span class='hs-varid'>vs</span> <span class='hs-conid'>[]</span> <span class='hs-layout'>(</span><span class='hs-varid'>offset</span><span class='hs-varop'>+</span><span class='hs-num'>1</span><span class='hs-layout'>)</span>
<a name="line-538"></a>
<a name="line-539"></a><span class='hs-comment'>-- move into an arg (%o[0..5]) reg</span>
<a name="line-540"></a><span class='hs-definition'>move_final</span> <span class='hs-layout'>(</span><span class='hs-varid'>v</span><span class='hs-conop'>:</span><span class='hs-varid'>vs</span><span class='hs-layout'>)</span> <span class='hs-layout'>(</span><span class='hs-varid'>a</span><span class='hs-conop'>:</span><span class='hs-varid'>az</span><span class='hs-layout'>)</span> <span class='hs-varid'>offset</span>
<a name="line-541"></a>        <span class='hs-keyglyph'>=</span> <span class='hs-conid'>OR</span> <span class='hs-conid'>False</span> <span class='hs-varid'>g0</span> <span class='hs-layout'>(</span><span class='hs-conid'>RIReg</span> <span class='hs-varid'>v</span><span class='hs-layout'>)</span> <span class='hs-varid'>a</span>
<a name="line-542"></a>        <span class='hs-conop'>:</span> <span class='hs-varid'>move_final</span> <span class='hs-varid'>vs</span> <span class='hs-varid'>az</span> <span class='hs-varid'>offset</span>
<a name="line-543"></a>
<a name="line-544"></a>
<a name="line-545"></a><a name="assign_code"></a><span class='hs-comment'>-- | Assign results returned from the call into their</span>
<a name="line-546"></a><span class='hs-comment'>--      destination regs.</span>
<a name="line-547"></a><span class='hs-comment'>--</span>
<a name="line-548"></a><span class='hs-definition'>assign_code</span> <span class='hs-keyglyph'>::</span> <span class='hs-conid'>Platform</span> <span class='hs-keyglyph'>-&gt;</span> <span class='hs-keyglyph'>[</span><span class='hs-conid'>LocalReg</span><span class='hs-keyglyph'>]</span> <span class='hs-keyglyph'>-&gt;</span> <span class='hs-conid'>OrdList</span> <span class='hs-conid'>Instr</span>
<a name="line-549"></a>
<a name="line-550"></a><span class='hs-definition'>assign_code</span> <span class='hs-keyword'>_</span> <span class='hs-conid'>[]</span> <span class='hs-keyglyph'>=</span> <span class='hs-varid'>nilOL</span>
<a name="line-551"></a>
<a name="line-552"></a><span class='hs-definition'>assign_code</span> <span class='hs-varid'>platform</span> <span class='hs-keyglyph'>[</span><span class='hs-varid'>dest</span><span class='hs-keyglyph'>]</span>
<a name="line-553"></a> <span class='hs-keyglyph'>=</span> <span class='hs-keyword'>let</span>  <span class='hs-varid'>rep</span>     <span class='hs-keyglyph'>=</span> <span class='hs-varid'>localRegType</span> <span class='hs-varid'>dest</span>
<a name="line-554"></a>        <span class='hs-varid'>width</span>   <span class='hs-keyglyph'>=</span> <span class='hs-varid'>typeWidth</span> <span class='hs-varid'>rep</span>
<a name="line-555"></a>        <span class='hs-varid'>r_dest</span>  <span class='hs-keyglyph'>=</span> <span class='hs-varid'>getRegisterReg</span> <span class='hs-varid'>platform</span> <span class='hs-layout'>(</span><span class='hs-conid'>CmmLocal</span> <span class='hs-varid'>dest</span><span class='hs-layout'>)</span>
<a name="line-556"></a>
<a name="line-557"></a>        <span class='hs-varid'>result</span>
<a name="line-558"></a>                <span class='hs-keyglyph'>|</span> <span class='hs-varid'>isFloatType</span> <span class='hs-varid'>rep</span>
<a name="line-559"></a>                <span class='hs-layout'>,</span> <span class='hs-conid'>W32</span>   <span class='hs-keyglyph'>&lt;-</span> <span class='hs-varid'>width</span>
<a name="line-560"></a>                <span class='hs-keyglyph'>=</span> <span class='hs-varid'>unitOL</span> <span class='hs-varop'>$</span> <span class='hs-conid'>FMOV</span> <span class='hs-conid'>FF32</span> <span class='hs-layout'>(</span><span class='hs-varid'>regSingle</span> <span class='hs-varop'>$</span> <span class='hs-varid'>fReg</span> <span class='hs-num'>0</span><span class='hs-layout'>)</span> <span class='hs-varid'>r_dest</span>
<a name="line-561"></a>
<a name="line-562"></a>                <span class='hs-keyglyph'>|</span> <span class='hs-varid'>isFloatType</span> <span class='hs-varid'>rep</span>
<a name="line-563"></a>                <span class='hs-layout'>,</span> <span class='hs-conid'>W64</span>   <span class='hs-keyglyph'>&lt;-</span> <span class='hs-varid'>width</span>
<a name="line-564"></a>                <span class='hs-keyglyph'>=</span> <span class='hs-varid'>unitOL</span> <span class='hs-varop'>$</span> <span class='hs-conid'>FMOV</span> <span class='hs-conid'>FF64</span> <span class='hs-layout'>(</span><span class='hs-varid'>regSingle</span> <span class='hs-varop'>$</span> <span class='hs-varid'>fReg</span> <span class='hs-num'>0</span><span class='hs-layout'>)</span> <span class='hs-varid'>r_dest</span>
<a name="line-565"></a>
<a name="line-566"></a>                <span class='hs-keyglyph'>|</span> <span class='hs-varid'>not</span> <span class='hs-varop'>$</span> <span class='hs-varid'>isFloatType</span> <span class='hs-varid'>rep</span>
<a name="line-567"></a>                <span class='hs-layout'>,</span> <span class='hs-conid'>W32</span>   <span class='hs-keyglyph'>&lt;-</span> <span class='hs-varid'>width</span>
<a name="line-568"></a>                <span class='hs-keyglyph'>=</span> <span class='hs-varid'>unitOL</span> <span class='hs-varop'>$</span> <span class='hs-varid'>mkRegRegMoveInstr</span> <span class='hs-varid'>platform</span> <span class='hs-layout'>(</span><span class='hs-varid'>regSingle</span> <span class='hs-varop'>$</span> <span class='hs-varid'>oReg</span> <span class='hs-num'>0</span><span class='hs-layout'>)</span> <span class='hs-varid'>r_dest</span>
<a name="line-569"></a>
<a name="line-570"></a>                <span class='hs-keyglyph'>|</span> <span class='hs-varid'>not</span> <span class='hs-varop'>$</span> <span class='hs-varid'>isFloatType</span> <span class='hs-varid'>rep</span>
<a name="line-571"></a>                <span class='hs-layout'>,</span> <span class='hs-conid'>W64</span>           <span class='hs-keyglyph'>&lt;-</span> <span class='hs-varid'>width</span>
<a name="line-572"></a>                <span class='hs-layout'>,</span> <span class='hs-varid'>r_dest_hi</span>     <span class='hs-keyglyph'>&lt;-</span> <span class='hs-varid'>getHiVRegFromLo</span> <span class='hs-varid'>r_dest</span>
<a name="line-573"></a>                <span class='hs-keyglyph'>=</span> <span class='hs-varid'>toOL</span>  <span class='hs-keyglyph'>[</span> <span class='hs-varid'>mkRegRegMoveInstr</span> <span class='hs-varid'>platform</span> <span class='hs-layout'>(</span><span class='hs-varid'>regSingle</span> <span class='hs-varop'>$</span> <span class='hs-varid'>oReg</span> <span class='hs-num'>0</span><span class='hs-layout'>)</span> <span class='hs-varid'>r_dest_hi</span>
<a name="line-574"></a>                        <span class='hs-layout'>,</span> <span class='hs-varid'>mkRegRegMoveInstr</span> <span class='hs-varid'>platform</span> <span class='hs-layout'>(</span><span class='hs-varid'>regSingle</span> <span class='hs-varop'>$</span> <span class='hs-varid'>oReg</span> <span class='hs-num'>1</span><span class='hs-layout'>)</span> <span class='hs-varid'>r_dest</span><span class='hs-keyglyph'>]</span>
<a name="line-575"></a>
<a name="line-576"></a>                <span class='hs-keyglyph'>|</span> <span class='hs-varid'>otherwise</span>
<a name="line-577"></a>                <span class='hs-keyglyph'>=</span> <span class='hs-varid'>panic</span> <span class='hs-str'>"SPARC.CodeGen.GenCCall: no match"</span>
<a name="line-578"></a>
<a name="line-579"></a>   <span class='hs-keyword'>in</span>   <span class='hs-varid'>result</span>
<a name="line-580"></a>
<a name="line-581"></a><span class='hs-definition'>assign_code</span> <span class='hs-keyword'>_</span> <span class='hs-keyword'>_</span>
<a name="line-582"></a>        <span class='hs-keyglyph'>=</span> <span class='hs-varid'>panic</span> <span class='hs-str'>"SPARC.CodeGen.GenCCall: no match"</span>
<a name="line-583"></a>
<a name="line-584"></a>
<a name="line-585"></a>
<a name="line-586"></a><a name="outOfLineMachOp"></a><span class='hs-comment'>-- | Generate a call to implement an out-of-line floating point operation</span>
<a name="line-587"></a><span class='hs-definition'>outOfLineMachOp</span>
<a name="line-588"></a>        <span class='hs-keyglyph'>::</span> <span class='hs-conid'>CallishMachOp</span>
<a name="line-589"></a>        <span class='hs-keyglyph'>-&gt;</span> <span class='hs-conid'>NatM</span> <span class='hs-layout'>(</span><span class='hs-conid'>Either</span> <span class='hs-conid'>CLabel</span> <span class='hs-conid'>CmmExpr</span><span class='hs-layout'>)</span>
<a name="line-590"></a>
<a name="line-591"></a><span class='hs-definition'>outOfLineMachOp</span> <span class='hs-varid'>mop</span>
<a name="line-592"></a> <span class='hs-keyglyph'>=</span> <span class='hs-keyword'>do</span>   <span class='hs-keyword'>let</span> <span class='hs-varid'>functionName</span>
<a name="line-593"></a>                <span class='hs-keyglyph'>=</span> <span class='hs-varid'>outOfLineMachOp_table</span> <span class='hs-varid'>mop</span>
<a name="line-594"></a>
<a name="line-595"></a>        <span class='hs-varid'>config</span>  <span class='hs-keyglyph'>&lt;-</span> <span class='hs-varid'>getConfig</span>
<a name="line-596"></a>        <span class='hs-varid'>mopExpr</span> <span class='hs-keyglyph'>&lt;-</span> <span class='hs-varid'>cmmMakeDynamicReference</span> <span class='hs-varid'>config</span> <span class='hs-conid'>CallReference</span>
<a name="line-597"></a>                <span class='hs-varop'>$</span>  <span class='hs-varid'>mkForeignLabel</span> <span class='hs-varid'>functionName</span> <span class='hs-conid'>Nothing</span> <span class='hs-conid'>ForeignLabelInExternalPackage</span> <span class='hs-conid'>IsFunction</span>
<a name="line-598"></a>
<a name="line-599"></a>        <span class='hs-keyword'>let</span> <span class='hs-varid'>mopLabelOrExpr</span>
<a name="line-600"></a>                <span class='hs-keyglyph'>=</span> <span class='hs-keyword'>case</span> <span class='hs-varid'>mopExpr</span> <span class='hs-keyword'>of</span>
<a name="line-601"></a>                        <span class='hs-conid'>CmmLit</span> <span class='hs-layout'>(</span><span class='hs-conid'>CmmLabel</span> <span class='hs-varid'>lbl</span><span class='hs-layout'>)</span>   <span class='hs-keyglyph'>-&gt;</span> <span class='hs-conid'>Left</span> <span class='hs-varid'>lbl</span>
<a name="line-602"></a>                        <span class='hs-keyword'>_</span>                       <span class='hs-keyglyph'>-&gt;</span> <span class='hs-conid'>Right</span> <span class='hs-varid'>mopExpr</span>
<a name="line-603"></a>
<a name="line-604"></a>        <span class='hs-varid'>return</span> <span class='hs-varid'>mopLabelOrExpr</span>
<a name="line-605"></a>
<a name="line-606"></a>
<a name="line-607"></a><a name="outOfLineMachOp_table"></a><span class='hs-comment'>-- | Decide what C function to use to implement a CallishMachOp</span>
<a name="line-608"></a><span class='hs-comment'>--</span>
<a name="line-609"></a><span class='hs-definition'>outOfLineMachOp_table</span>
<a name="line-610"></a>        <span class='hs-keyglyph'>::</span> <span class='hs-conid'>CallishMachOp</span>
<a name="line-611"></a>        <span class='hs-keyglyph'>-&gt;</span> <span class='hs-conid'>FastString</span>
<a name="line-612"></a>
<a name="line-613"></a><span class='hs-definition'>outOfLineMachOp_table</span> <span class='hs-varid'>mop</span>
<a name="line-614"></a> <span class='hs-keyglyph'>=</span> <span class='hs-keyword'>case</span> <span class='hs-varid'>mop</span> <span class='hs-keyword'>of</span>
<a name="line-615"></a>        <span class='hs-conid'>MO_F32_Exp</span>    <span class='hs-keyglyph'>-&gt;</span> <span class='hs-varid'>fsLit</span> <span class='hs-str'>"expf"</span>
<a name="line-616"></a>        <span class='hs-conid'>MO_F32_ExpM1</span>  <span class='hs-keyglyph'>-&gt;</span> <span class='hs-varid'>fsLit</span> <span class='hs-str'>"expm1f"</span>
<a name="line-617"></a>        <span class='hs-conid'>MO_F32_Log</span>    <span class='hs-keyglyph'>-&gt;</span> <span class='hs-varid'>fsLit</span> <span class='hs-str'>"logf"</span>
<a name="line-618"></a>        <span class='hs-conid'>MO_F32_Log1P</span>  <span class='hs-keyglyph'>-&gt;</span> <span class='hs-varid'>fsLit</span> <span class='hs-str'>"log1pf"</span>
<a name="line-619"></a>        <span class='hs-conid'>MO_F32_Sqrt</span>   <span class='hs-keyglyph'>-&gt;</span> <span class='hs-varid'>fsLit</span> <span class='hs-str'>"sqrtf"</span>
<a name="line-620"></a>        <span class='hs-conid'>MO_F32_Fabs</span>   <span class='hs-keyglyph'>-&gt;</span> <span class='hs-varid'>unsupported</span>
<a name="line-621"></a>        <span class='hs-conid'>MO_F32_Pwr</span>    <span class='hs-keyglyph'>-&gt;</span> <span class='hs-varid'>fsLit</span> <span class='hs-str'>"powf"</span>
<a name="line-622"></a>
<a name="line-623"></a>        <span class='hs-conid'>MO_F32_Sin</span>    <span class='hs-keyglyph'>-&gt;</span> <span class='hs-varid'>fsLit</span> <span class='hs-str'>"sinf"</span>
<a name="line-624"></a>        <span class='hs-conid'>MO_F32_Cos</span>    <span class='hs-keyglyph'>-&gt;</span> <span class='hs-varid'>fsLit</span> <span class='hs-str'>"cosf"</span>
<a name="line-625"></a>        <span class='hs-conid'>MO_F32_Tan</span>    <span class='hs-keyglyph'>-&gt;</span> <span class='hs-varid'>fsLit</span> <span class='hs-str'>"tanf"</span>
<a name="line-626"></a>
<a name="line-627"></a>        <span class='hs-conid'>MO_F32_Asin</span>   <span class='hs-keyglyph'>-&gt;</span> <span class='hs-varid'>fsLit</span> <span class='hs-str'>"asinf"</span>
<a name="line-628"></a>        <span class='hs-conid'>MO_F32_Acos</span>   <span class='hs-keyglyph'>-&gt;</span> <span class='hs-varid'>fsLit</span> <span class='hs-str'>"acosf"</span>
<a name="line-629"></a>        <span class='hs-conid'>MO_F32_Atan</span>   <span class='hs-keyglyph'>-&gt;</span> <span class='hs-varid'>fsLit</span> <span class='hs-str'>"atanf"</span>
<a name="line-630"></a>
<a name="line-631"></a>        <span class='hs-conid'>MO_F32_Sinh</span>   <span class='hs-keyglyph'>-&gt;</span> <span class='hs-varid'>fsLit</span> <span class='hs-str'>"sinhf"</span>
<a name="line-632"></a>        <span class='hs-conid'>MO_F32_Cosh</span>   <span class='hs-keyglyph'>-&gt;</span> <span class='hs-varid'>fsLit</span> <span class='hs-str'>"coshf"</span>
<a name="line-633"></a>        <span class='hs-conid'>MO_F32_Tanh</span>   <span class='hs-keyglyph'>-&gt;</span> <span class='hs-varid'>fsLit</span> <span class='hs-str'>"tanhf"</span>
<a name="line-634"></a>
<a name="line-635"></a>        <span class='hs-conid'>MO_F32_Asinh</span>  <span class='hs-keyglyph'>-&gt;</span> <span class='hs-varid'>fsLit</span> <span class='hs-str'>"asinhf"</span>
<a name="line-636"></a>        <span class='hs-conid'>MO_F32_Acosh</span>  <span class='hs-keyglyph'>-&gt;</span> <span class='hs-varid'>fsLit</span> <span class='hs-str'>"acoshf"</span>
<a name="line-637"></a>        <span class='hs-conid'>MO_F32_Atanh</span>  <span class='hs-keyglyph'>-&gt;</span> <span class='hs-varid'>fsLit</span> <span class='hs-str'>"atanhf"</span>
<a name="line-638"></a>
<a name="line-639"></a>        <span class='hs-conid'>MO_F64_Exp</span>    <span class='hs-keyglyph'>-&gt;</span> <span class='hs-varid'>fsLit</span> <span class='hs-str'>"exp"</span>
<a name="line-640"></a>        <span class='hs-conid'>MO_F64_ExpM1</span>  <span class='hs-keyglyph'>-&gt;</span> <span class='hs-varid'>fsLit</span> <span class='hs-str'>"expm1"</span>
<a name="line-641"></a>        <span class='hs-conid'>MO_F64_Log</span>    <span class='hs-keyglyph'>-&gt;</span> <span class='hs-varid'>fsLit</span> <span class='hs-str'>"log"</span>
<a name="line-642"></a>        <span class='hs-conid'>MO_F64_Log1P</span>  <span class='hs-keyglyph'>-&gt;</span> <span class='hs-varid'>fsLit</span> <span class='hs-str'>"log1p"</span>
<a name="line-643"></a>        <span class='hs-conid'>MO_F64_Sqrt</span>   <span class='hs-keyglyph'>-&gt;</span> <span class='hs-varid'>fsLit</span> <span class='hs-str'>"sqrt"</span>
<a name="line-644"></a>        <span class='hs-conid'>MO_F64_Fabs</span>   <span class='hs-keyglyph'>-&gt;</span> <span class='hs-varid'>unsupported</span>
<a name="line-645"></a>        <span class='hs-conid'>MO_F64_Pwr</span>    <span class='hs-keyglyph'>-&gt;</span> <span class='hs-varid'>fsLit</span> <span class='hs-str'>"pow"</span>
<a name="line-646"></a>
<a name="line-647"></a>        <span class='hs-conid'>MO_F64_Sin</span>    <span class='hs-keyglyph'>-&gt;</span> <span class='hs-varid'>fsLit</span> <span class='hs-str'>"sin"</span>
<a name="line-648"></a>        <span class='hs-conid'>MO_F64_Cos</span>    <span class='hs-keyglyph'>-&gt;</span> <span class='hs-varid'>fsLit</span> <span class='hs-str'>"cos"</span>
<a name="line-649"></a>        <span class='hs-conid'>MO_F64_Tan</span>    <span class='hs-keyglyph'>-&gt;</span> <span class='hs-varid'>fsLit</span> <span class='hs-str'>"tan"</span>
<a name="line-650"></a>
<a name="line-651"></a>        <span class='hs-conid'>MO_F64_Asin</span>   <span class='hs-keyglyph'>-&gt;</span> <span class='hs-varid'>fsLit</span> <span class='hs-str'>"asin"</span>
<a name="line-652"></a>        <span class='hs-conid'>MO_F64_Acos</span>   <span class='hs-keyglyph'>-&gt;</span> <span class='hs-varid'>fsLit</span> <span class='hs-str'>"acos"</span>
<a name="line-653"></a>        <span class='hs-conid'>MO_F64_Atan</span>   <span class='hs-keyglyph'>-&gt;</span> <span class='hs-varid'>fsLit</span> <span class='hs-str'>"atan"</span>
<a name="line-654"></a>
<a name="line-655"></a>        <span class='hs-conid'>MO_F64_Sinh</span>   <span class='hs-keyglyph'>-&gt;</span> <span class='hs-varid'>fsLit</span> <span class='hs-str'>"sinh"</span>
<a name="line-656"></a>        <span class='hs-conid'>MO_F64_Cosh</span>   <span class='hs-keyglyph'>-&gt;</span> <span class='hs-varid'>fsLit</span> <span class='hs-str'>"cosh"</span>
<a name="line-657"></a>        <span class='hs-conid'>MO_F64_Tanh</span>   <span class='hs-keyglyph'>-&gt;</span> <span class='hs-varid'>fsLit</span> <span class='hs-str'>"tanh"</span>
<a name="line-658"></a>
<a name="line-659"></a>        <span class='hs-conid'>MO_F64_Asinh</span>  <span class='hs-keyglyph'>-&gt;</span> <span class='hs-varid'>fsLit</span> <span class='hs-str'>"asinh"</span>
<a name="line-660"></a>        <span class='hs-conid'>MO_F64_Acosh</span>  <span class='hs-keyglyph'>-&gt;</span> <span class='hs-varid'>fsLit</span> <span class='hs-str'>"acosh"</span>
<a name="line-661"></a>        <span class='hs-conid'>MO_F64_Atanh</span>  <span class='hs-keyglyph'>-&gt;</span> <span class='hs-varid'>fsLit</span> <span class='hs-str'>"atanh"</span>
<a name="line-662"></a>
<a name="line-663"></a>        <span class='hs-conid'>MO_I64_ToI</span>   <span class='hs-keyglyph'>-&gt;</span> <span class='hs-varid'>fsLit</span> <span class='hs-str'>"hs_int64ToInt"</span>
<a name="line-664"></a>        <span class='hs-conid'>MO_I64_FromI</span> <span class='hs-keyglyph'>-&gt;</span> <span class='hs-varid'>fsLit</span> <span class='hs-str'>"hs_intToInt64"</span>
<a name="line-665"></a>        <span class='hs-conid'>MO_W64_ToW</span>   <span class='hs-keyglyph'>-&gt;</span> <span class='hs-varid'>fsLit</span> <span class='hs-str'>"hs_word64ToWord"</span>
<a name="line-666"></a>        <span class='hs-conid'>MO_W64_FromW</span> <span class='hs-keyglyph'>-&gt;</span> <span class='hs-varid'>fsLit</span> <span class='hs-str'>"hs_wordToWord64"</span>
<a name="line-667"></a>        <span class='hs-conid'>MO_x64_Neg</span>   <span class='hs-keyglyph'>-&gt;</span> <span class='hs-varid'>fsLit</span> <span class='hs-str'>"hs_neg64"</span>
<a name="line-668"></a>        <span class='hs-conid'>MO_x64_Add</span>   <span class='hs-keyglyph'>-&gt;</span> <span class='hs-varid'>fsLit</span> <span class='hs-str'>"hs_add64"</span>
<a name="line-669"></a>        <span class='hs-conid'>MO_x64_Sub</span>   <span class='hs-keyglyph'>-&gt;</span> <span class='hs-varid'>fsLit</span> <span class='hs-str'>"hs_sub64"</span>
<a name="line-670"></a>        <span class='hs-conid'>MO_x64_Mul</span>   <span class='hs-keyglyph'>-&gt;</span> <span class='hs-varid'>fsLit</span> <span class='hs-str'>"hs_mul64"</span>
<a name="line-671"></a>        <span class='hs-conid'>MO_I64_Quot</span>  <span class='hs-keyglyph'>-&gt;</span> <span class='hs-varid'>fsLit</span> <span class='hs-str'>"hs_quotInt64"</span>
<a name="line-672"></a>        <span class='hs-conid'>MO_I64_Rem</span>   <span class='hs-keyglyph'>-&gt;</span> <span class='hs-varid'>fsLit</span> <span class='hs-str'>"hs_remInt64"</span>
<a name="line-673"></a>        <span class='hs-conid'>MO_W64_Quot</span>  <span class='hs-keyglyph'>-&gt;</span> <span class='hs-varid'>fsLit</span> <span class='hs-str'>"hs_quotWord64"</span>
<a name="line-674"></a>        <span class='hs-conid'>MO_W64_Rem</span>   <span class='hs-keyglyph'>-&gt;</span> <span class='hs-varid'>fsLit</span> <span class='hs-str'>"hs_remWord64"</span>
<a name="line-675"></a>        <span class='hs-conid'>MO_x64_And</span>   <span class='hs-keyglyph'>-&gt;</span> <span class='hs-varid'>fsLit</span> <span class='hs-str'>"hs_and64"</span>
<a name="line-676"></a>        <span class='hs-conid'>MO_x64_Or</span>    <span class='hs-keyglyph'>-&gt;</span> <span class='hs-varid'>fsLit</span> <span class='hs-str'>"hs_or64"</span>
<a name="line-677"></a>        <span class='hs-conid'>MO_x64_Xor</span>   <span class='hs-keyglyph'>-&gt;</span> <span class='hs-varid'>fsLit</span> <span class='hs-str'>"hs_xor64"</span>
<a name="line-678"></a>        <span class='hs-conid'>MO_x64_Not</span>   <span class='hs-keyglyph'>-&gt;</span> <span class='hs-varid'>fsLit</span> <span class='hs-str'>"hs_not64"</span>
<a name="line-679"></a>        <span class='hs-conid'>MO_x64_Shl</span>   <span class='hs-keyglyph'>-&gt;</span> <span class='hs-varid'>fsLit</span> <span class='hs-str'>"hs_uncheckedShiftL64"</span>
<a name="line-680"></a>        <span class='hs-conid'>MO_I64_Shr</span>   <span class='hs-keyglyph'>-&gt;</span> <span class='hs-varid'>fsLit</span> <span class='hs-str'>"hs_uncheckedIShiftRA64"</span>
<a name="line-681"></a>        <span class='hs-conid'>MO_W64_Shr</span>   <span class='hs-keyglyph'>-&gt;</span> <span class='hs-varid'>fsLit</span> <span class='hs-str'>"hs_uncheckedShiftRL64"</span>
<a name="line-682"></a>        <span class='hs-conid'>MO_x64_Eq</span>    <span class='hs-keyglyph'>-&gt;</span> <span class='hs-varid'>fsLit</span> <span class='hs-str'>"hs_eq64"</span>
<a name="line-683"></a>        <span class='hs-conid'>MO_x64_Ne</span>    <span class='hs-keyglyph'>-&gt;</span> <span class='hs-varid'>fsLit</span> <span class='hs-str'>"hs_ne64"</span>
<a name="line-684"></a>        <span class='hs-conid'>MO_I64_Ge</span>    <span class='hs-keyglyph'>-&gt;</span> <span class='hs-varid'>fsLit</span> <span class='hs-str'>"hs_geInt64"</span>
<a name="line-685"></a>        <span class='hs-conid'>MO_I64_Gt</span>    <span class='hs-keyglyph'>-&gt;</span> <span class='hs-varid'>fsLit</span> <span class='hs-str'>"hs_gtInt64"</span>
<a name="line-686"></a>        <span class='hs-conid'>MO_I64_Le</span>    <span class='hs-keyglyph'>-&gt;</span> <span class='hs-varid'>fsLit</span> <span class='hs-str'>"hs_leInt64"</span>
<a name="line-687"></a>        <span class='hs-conid'>MO_I64_Lt</span>    <span class='hs-keyglyph'>-&gt;</span> <span class='hs-varid'>fsLit</span> <span class='hs-str'>"hs_ltInt64"</span>
<a name="line-688"></a>        <span class='hs-conid'>MO_W64_Ge</span>    <span class='hs-keyglyph'>-&gt;</span> <span class='hs-varid'>fsLit</span> <span class='hs-str'>"hs_geWord64"</span>
<a name="line-689"></a>        <span class='hs-conid'>MO_W64_Gt</span>    <span class='hs-keyglyph'>-&gt;</span> <span class='hs-varid'>fsLit</span> <span class='hs-str'>"hs_gtWord64"</span>
<a name="line-690"></a>        <span class='hs-conid'>MO_W64_Le</span>    <span class='hs-keyglyph'>-&gt;</span> <span class='hs-varid'>fsLit</span> <span class='hs-str'>"hs_leWord64"</span>
<a name="line-691"></a>        <span class='hs-conid'>MO_W64_Lt</span>    <span class='hs-keyglyph'>-&gt;</span> <span class='hs-varid'>fsLit</span> <span class='hs-str'>"hs_ltWord64"</span>
<a name="line-692"></a>
<a name="line-693"></a>        <span class='hs-conid'>MO_UF_Conv</span> <span class='hs-varid'>w</span> <span class='hs-keyglyph'>-&gt;</span> <span class='hs-varid'>fsLit</span> <span class='hs-varop'>$</span> <span class='hs-varid'>word2FloatLabel</span> <span class='hs-varid'>w</span>
<a name="line-694"></a>
<a name="line-695"></a>        <span class='hs-conid'>MO_Memcpy</span> <span class='hs-keyword'>_</span>  <span class='hs-keyglyph'>-&gt;</span> <span class='hs-varid'>fsLit</span> <span class='hs-str'>"memcpy"</span>
<a name="line-696"></a>        <span class='hs-conid'>MO_Memset</span> <span class='hs-keyword'>_</span>  <span class='hs-keyglyph'>-&gt;</span> <span class='hs-varid'>fsLit</span> <span class='hs-str'>"memset"</span>
<a name="line-697"></a>        <span class='hs-conid'>MO_Memmove</span> <span class='hs-keyword'>_</span> <span class='hs-keyglyph'>-&gt;</span> <span class='hs-varid'>fsLit</span> <span class='hs-str'>"memmove"</span>
<a name="line-698"></a>        <span class='hs-conid'>MO_Memcmp</span> <span class='hs-keyword'>_</span>  <span class='hs-keyglyph'>-&gt;</span> <span class='hs-varid'>fsLit</span> <span class='hs-str'>"memcmp"</span>
<a name="line-699"></a>
<a name="line-700"></a>        <span class='hs-conid'>MO_BSwap</span> <span class='hs-varid'>w</span>   <span class='hs-keyglyph'>-&gt;</span> <span class='hs-varid'>fsLit</span> <span class='hs-varop'>$</span> <span class='hs-varid'>bSwapLabel</span> <span class='hs-varid'>w</span>
<a name="line-701"></a>        <span class='hs-conid'>MO_BRev</span> <span class='hs-varid'>w</span>    <span class='hs-keyglyph'>-&gt;</span> <span class='hs-varid'>fsLit</span> <span class='hs-varop'>$</span> <span class='hs-varid'>bRevLabel</span> <span class='hs-varid'>w</span>
<a name="line-702"></a>        <span class='hs-conid'>MO_PopCnt</span> <span class='hs-varid'>w</span>  <span class='hs-keyglyph'>-&gt;</span> <span class='hs-varid'>fsLit</span> <span class='hs-varop'>$</span> <span class='hs-varid'>popCntLabel</span> <span class='hs-varid'>w</span>
<a name="line-703"></a>        <span class='hs-conid'>MO_Pdep</span> <span class='hs-varid'>w</span>    <span class='hs-keyglyph'>-&gt;</span> <span class='hs-varid'>fsLit</span> <span class='hs-varop'>$</span> <span class='hs-varid'>pdepLabel</span> <span class='hs-varid'>w</span>
<a name="line-704"></a>        <span class='hs-conid'>MO_Pext</span> <span class='hs-varid'>w</span>    <span class='hs-keyglyph'>-&gt;</span> <span class='hs-varid'>fsLit</span> <span class='hs-varop'>$</span> <span class='hs-varid'>pextLabel</span> <span class='hs-varid'>w</span>
<a name="line-705"></a>        <span class='hs-conid'>MO_Clz</span> <span class='hs-varid'>w</span>     <span class='hs-keyglyph'>-&gt;</span> <span class='hs-varid'>fsLit</span> <span class='hs-varop'>$</span> <span class='hs-varid'>clzLabel</span> <span class='hs-varid'>w</span>
<a name="line-706"></a>        <span class='hs-conid'>MO_Ctz</span> <span class='hs-varid'>w</span>     <span class='hs-keyglyph'>-&gt;</span> <span class='hs-varid'>fsLit</span> <span class='hs-varop'>$</span> <span class='hs-varid'>ctzLabel</span> <span class='hs-varid'>w</span>
<a name="line-707"></a>        <span class='hs-conid'>MO_AtomicRMW</span> <span class='hs-varid'>w</span> <span class='hs-varid'>amop</span> <span class='hs-keyglyph'>-&gt;</span> <span class='hs-varid'>fsLit</span> <span class='hs-varop'>$</span> <span class='hs-varid'>atomicRMWLabel</span> <span class='hs-varid'>w</span> <span class='hs-varid'>amop</span>
<a name="line-708"></a>        <span class='hs-conid'>MO_Cmpxchg</span> <span class='hs-varid'>w</span> <span class='hs-keyglyph'>-&gt;</span> <span class='hs-varid'>fsLit</span> <span class='hs-varop'>$</span> <span class='hs-varid'>cmpxchgLabel</span> <span class='hs-varid'>w</span>
<a name="line-709"></a>        <span class='hs-conid'>MO_Xchg</span> <span class='hs-varid'>w</span> <span class='hs-keyglyph'>-&gt;</span> <span class='hs-varid'>fsLit</span> <span class='hs-varop'>$</span> <span class='hs-varid'>xchgLabel</span> <span class='hs-varid'>w</span>
<a name="line-710"></a>        <span class='hs-conid'>MO_AtomicRead</span> <span class='hs-varid'>w</span> <span class='hs-keyglyph'>-&gt;</span> <span class='hs-varid'>fsLit</span> <span class='hs-varop'>$</span> <span class='hs-varid'>atomicReadLabel</span> <span class='hs-varid'>w</span>
<a name="line-711"></a>        <span class='hs-conid'>MO_AtomicWrite</span> <span class='hs-varid'>w</span> <span class='hs-keyglyph'>-&gt;</span> <span class='hs-varid'>fsLit</span> <span class='hs-varop'>$</span> <span class='hs-varid'>atomicWriteLabel</span> <span class='hs-varid'>w</span>
<a name="line-712"></a>
<a name="line-713"></a>        <span class='hs-conid'>MO_S_Mul2</span>    <span class='hs-layout'>{</span><span class='hs-layout'>}</span>  <span class='hs-keyglyph'>-&gt;</span> <span class='hs-varid'>unsupported</span>
<a name="line-714"></a>        <span class='hs-conid'>MO_S_QuotRem</span> <span class='hs-layout'>{</span><span class='hs-layout'>}</span>  <span class='hs-keyglyph'>-&gt;</span> <span class='hs-varid'>unsupported</span>
<a name="line-715"></a>        <span class='hs-conid'>MO_U_QuotRem</span> <span class='hs-layout'>{</span><span class='hs-layout'>}</span>  <span class='hs-keyglyph'>-&gt;</span> <span class='hs-varid'>unsupported</span>
<a name="line-716"></a>        <span class='hs-conid'>MO_U_QuotRem2</span> <span class='hs-layout'>{</span><span class='hs-layout'>}</span> <span class='hs-keyglyph'>-&gt;</span> <span class='hs-varid'>unsupported</span>
<a name="line-717"></a>        <span class='hs-conid'>MO_Add2</span> <span class='hs-layout'>{</span><span class='hs-layout'>}</span>       <span class='hs-keyglyph'>-&gt;</span> <span class='hs-varid'>unsupported</span>
<a name="line-718"></a>        <span class='hs-conid'>MO_AddWordC</span> <span class='hs-layout'>{</span><span class='hs-layout'>}</span>   <span class='hs-keyglyph'>-&gt;</span> <span class='hs-varid'>unsupported</span>
<a name="line-719"></a>        <span class='hs-conid'>MO_SubWordC</span> <span class='hs-layout'>{</span><span class='hs-layout'>}</span>   <span class='hs-keyglyph'>-&gt;</span> <span class='hs-varid'>unsupported</span>
<a name="line-720"></a>        <span class='hs-conid'>MO_AddIntC</span> <span class='hs-layout'>{</span><span class='hs-layout'>}</span>    <span class='hs-keyglyph'>-&gt;</span> <span class='hs-varid'>unsupported</span>
<a name="line-721"></a>        <span class='hs-conid'>MO_SubIntC</span> <span class='hs-layout'>{</span><span class='hs-layout'>}</span>    <span class='hs-keyglyph'>-&gt;</span> <span class='hs-varid'>unsupported</span>
<a name="line-722"></a>        <span class='hs-conid'>MO_U_Mul2</span> <span class='hs-layout'>{</span><span class='hs-layout'>}</span>     <span class='hs-keyglyph'>-&gt;</span> <span class='hs-varid'>unsupported</span>
<a name="line-723"></a>        <span class='hs-conid'>MO_ReadBarrier</span>   <span class='hs-keyglyph'>-&gt;</span> <span class='hs-varid'>unsupported</span>
<a name="line-724"></a>        <span class='hs-conid'>MO_WriteBarrier</span>  <span class='hs-keyglyph'>-&gt;</span> <span class='hs-varid'>unsupported</span>
<a name="line-725"></a>        <span class='hs-conid'>MO_Touch</span>         <span class='hs-keyglyph'>-&gt;</span> <span class='hs-varid'>unsupported</span>
<a name="line-726"></a>        <span class='hs-layout'>(</span><span class='hs-conid'>MO_Prefetch_Data</span> <span class='hs-keyword'>_</span><span class='hs-layout'>)</span> <span class='hs-keyglyph'>-&gt;</span> <span class='hs-varid'>unsupported</span>
<a name="line-727"></a>    <span class='hs-keyword'>where</span> <span class='hs-varid'>unsupported</span> <span class='hs-keyglyph'>=</span> <span class='hs-varid'>panic</span> <span class='hs-layout'>(</span><span class='hs-str'>"outOfLineCmmOp: "</span> <span class='hs-varop'>++</span> <span class='hs-varid'>show</span> <span class='hs-varid'>mop</span>
<a name="line-728"></a>                            <span class='hs-varop'>++</span> <span class='hs-str'>" not supported here"</span><span class='hs-layout'>)</span>
<a name="line-729"></a>
</pre></body>
</html>
