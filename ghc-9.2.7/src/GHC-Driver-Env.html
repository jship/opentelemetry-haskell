<?xml version="1.0" encoding="UTF-8"?>
<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Strict//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-strict.dtd">
<html>
<head>
<!-- Generated by HsColour, http://code.haskell.org/~malcolm/hscolour/ -->
<title>GHC/Driver/Env.hs</title>
<link type='text/css' rel='stylesheet' href='hscolour.css' />
</head>
<body>
<pre><a name="line-1"></a><span class='hs-comment'>{-# LANGUAGE CPP #-}</span>
<a name="line-2"></a>
<a name="line-3"></a><span class='hs-keyword'>module</span> <span class='hs-conid'>GHC.Driver.Env</span>
<a name="line-4"></a>   <span class='hs-layout'>(</span> <span class='hs-conid'>Hsc</span><span class='hs-layout'>(</span><span class='hs-keyglyph'>..</span><span class='hs-layout'>)</span>
<a name="line-5"></a>   <span class='hs-layout'>,</span> <span class='hs-conid'>HscEnv</span> <span class='hs-layout'>(</span><span class='hs-keyglyph'>..</span><span class='hs-layout'>)</span>
<a name="line-6"></a>   <span class='hs-layout'>,</span> <span class='hs-varid'>hsc_home_unit</span>
<a name="line-7"></a>   <span class='hs-layout'>,</span> <span class='hs-varid'>hsc_units</span>
<a name="line-8"></a>   <span class='hs-layout'>,</span> <span class='hs-varid'>runHsc</span>
<a name="line-9"></a>   <span class='hs-layout'>,</span> <span class='hs-varid'>mkInteractiveHscEnv</span>
<a name="line-10"></a>   <span class='hs-layout'>,</span> <span class='hs-varid'>runInteractiveHsc</span>
<a name="line-11"></a>   <span class='hs-layout'>,</span> <span class='hs-varid'>hscEPS</span>
<a name="line-12"></a>   <span class='hs-layout'>,</span> <span class='hs-varid'>hptCompleteSigs</span>
<a name="line-13"></a>   <span class='hs-layout'>,</span> <span class='hs-varid'>hptInstances</span>
<a name="line-14"></a>   <span class='hs-layout'>,</span> <span class='hs-varid'>hptAnns</span>
<a name="line-15"></a>   <span class='hs-layout'>,</span> <span class='hs-varid'>hptAllThings</span>
<a name="line-16"></a>   <span class='hs-layout'>,</span> <span class='hs-varid'>hptSomeThingsBelowUs</span>
<a name="line-17"></a>   <span class='hs-layout'>,</span> <span class='hs-varid'>hptRules</span>
<a name="line-18"></a>   <span class='hs-layout'>,</span> <span class='hs-varid'>prepareAnnotations</span>
<a name="line-19"></a>   <span class='hs-layout'>,</span> <span class='hs-varid'>lookupType</span>
<a name="line-20"></a>   <span class='hs-layout'>,</span> <span class='hs-varid'>lookupIfaceByModule</span>
<a name="line-21"></a>   <span class='hs-layout'>,</span> <span class='hs-varid'>mainModIs</span>
<a name="line-22"></a>   <span class='hs-layout'>)</span>
<a name="line-23"></a><span class='hs-keyword'>where</span>
<a name="line-24"></a>
<a name="line-25"></a><span class='hs-cpp'>#include "HsVersions.h"</span>
<a name="line-26"></a>
<a name="line-27"></a><span class='hs-keyword'>import</span> <span class='hs-conid'>GHC.Prelude</span>
<a name="line-28"></a>
<a name="line-29"></a><span class='hs-keyword'>import</span> <span class='hs-conid'>GHC.Driver.Ppr</span>
<a name="line-30"></a><span class='hs-keyword'>import</span> <span class='hs-conid'>GHC.Driver.Session</span>
<a name="line-31"></a><span class='hs-keyword'>import</span> <span class='hs-conid'>GHC.Driver.Errors</span> <span class='hs-layout'>(</span> <span class='hs-varid'>printOrThrowWarnings</span> <span class='hs-layout'>)</span>
<a name="line-32"></a>
<a name="line-33"></a><span class='hs-keyword'>import</span> <span class='hs-conid'>GHC.Runtime.Context</span>
<a name="line-34"></a><span class='hs-keyword'>import</span> <span class='hs-conid'>GHC.Driver.Env.Types</span> <span class='hs-layout'>(</span> <span class='hs-conid'>Hsc</span><span class='hs-layout'>(</span><span class='hs-keyglyph'>..</span><span class='hs-layout'>)</span><span class='hs-layout'>,</span> <span class='hs-conid'>HscEnv</span><span class='hs-layout'>(</span><span class='hs-keyglyph'>..</span><span class='hs-layout'>)</span> <span class='hs-layout'>)</span>
<a name="line-35"></a>
<a name="line-36"></a><span class='hs-keyword'>import</span> <span class='hs-conid'>GHC.Unit</span>
<a name="line-37"></a><span class='hs-keyword'>import</span> <span class='hs-conid'>GHC.Unit.Module.ModGuts</span>
<a name="line-38"></a><span class='hs-keyword'>import</span> <span class='hs-conid'>GHC.Unit.Module.ModIface</span>
<a name="line-39"></a><span class='hs-keyword'>import</span> <span class='hs-conid'>GHC.Unit.Module.ModDetails</span>
<a name="line-40"></a><span class='hs-keyword'>import</span> <span class='hs-conid'>GHC.Unit.Module.Deps</span>
<a name="line-41"></a><span class='hs-keyword'>import</span> <span class='hs-conid'>GHC.Unit.Home.ModInfo</span>
<a name="line-42"></a><span class='hs-keyword'>import</span> <span class='hs-conid'>GHC.Unit.Env</span>
<a name="line-43"></a><span class='hs-keyword'>import</span> <span class='hs-conid'>GHC.Unit.External</span>
<a name="line-44"></a>
<a name="line-45"></a><span class='hs-keyword'>import</span> <span class='hs-conid'>GHC.Core</span>         <span class='hs-layout'>(</span> <span class='hs-conid'>CoreRule</span> <span class='hs-layout'>)</span>
<a name="line-46"></a><span class='hs-keyword'>import</span> <span class='hs-conid'>GHC.Core.FamInstEnv</span>
<a name="line-47"></a><span class='hs-keyword'>import</span> <span class='hs-conid'>GHC.Core.InstEnv</span> <span class='hs-layout'>(</span> <span class='hs-conid'>ClsInst</span> <span class='hs-layout'>)</span>
<a name="line-48"></a>
<a name="line-49"></a><span class='hs-keyword'>import</span> <span class='hs-conid'>GHC.Types.Annotations</span> <span class='hs-layout'>(</span> <span class='hs-conid'>Annotation</span><span class='hs-layout'>,</span> <span class='hs-conid'>AnnEnv</span><span class='hs-layout'>,</span> <span class='hs-varid'>mkAnnEnv</span><span class='hs-layout'>,</span> <span class='hs-varid'>plusAnnEnv</span> <span class='hs-layout'>)</span>
<a name="line-50"></a><span class='hs-keyword'>import</span> <span class='hs-conid'>GHC.Types.CompleteMatch</span>
<a name="line-51"></a><span class='hs-keyword'>import</span> <span class='hs-conid'>GHC.Types.Name</span>
<a name="line-52"></a><span class='hs-keyword'>import</span> <span class='hs-conid'>GHC.Types.Name.Env</span>
<a name="line-53"></a><span class='hs-keyword'>import</span> <span class='hs-conid'>GHC.Types.TyThing</span>
<a name="line-54"></a>
<a name="line-55"></a><span class='hs-keyword'>import</span> <span class='hs-conid'>GHC.Builtin.Names</span> <span class='hs-layout'>(</span> <span class='hs-varid'>gHC_PRIM</span> <span class='hs-layout'>)</span>
<a name="line-56"></a>
<a name="line-57"></a><span class='hs-keyword'>import</span> <span class='hs-conid'>GHC.Data.Maybe</span>
<a name="line-58"></a><span class='hs-keyword'>import</span> <span class='hs-conid'>GHC.Data.Bag</span>
<a name="line-59"></a>
<a name="line-60"></a><span class='hs-keyword'>import</span> <span class='hs-conid'>GHC.Utils.Outputable</span>
<a name="line-61"></a><span class='hs-keyword'>import</span> <span class='hs-conid'>GHC.Utils.Monad</span>
<a name="line-62"></a><span class='hs-keyword'>import</span> <span class='hs-conid'>GHC.Utils.Panic</span>
<a name="line-63"></a><span class='hs-keyword'>import</span> <span class='hs-conid'>GHC.Utils.Misc</span>
<a name="line-64"></a>
<a name="line-65"></a><span class='hs-keyword'>import</span> <span class='hs-conid'>Control.Monad</span>    <span class='hs-layout'>(</span> <span class='hs-varid'>guard</span> <span class='hs-layout'>)</span>
<a name="line-66"></a><span class='hs-keyword'>import</span> <span class='hs-conid'>Data.IORef</span>
<a name="line-67"></a>
<a name="line-68"></a><a name="runHsc"></a><span class='hs-definition'>runHsc</span> <span class='hs-keyglyph'>::</span> <span class='hs-conid'>HscEnv</span> <span class='hs-keyglyph'>-&gt;</span> <span class='hs-conid'>Hsc</span> <span class='hs-varid'>a</span> <span class='hs-keyglyph'>-&gt;</span> <span class='hs-conid'>IO</span> <span class='hs-varid'>a</span>
<a name="line-69"></a><span class='hs-definition'>runHsc</span> <span class='hs-varid'>hsc_env</span> <span class='hs-layout'>(</span><span class='hs-conid'>Hsc</span> <span class='hs-varid'>hsc</span><span class='hs-layout'>)</span> <span class='hs-keyglyph'>=</span> <span class='hs-keyword'>do</span>
<a name="line-70"></a>    <span class='hs-layout'>(</span><span class='hs-varid'>a</span><span class='hs-layout'>,</span> <span class='hs-varid'>w</span><span class='hs-layout'>)</span> <span class='hs-keyglyph'>&lt;-</span> <span class='hs-varid'>hsc</span> <span class='hs-varid'>hsc_env</span> <span class='hs-varid'>emptyBag</span>
<a name="line-71"></a>    <span class='hs-varid'>printOrThrowWarnings</span> <span class='hs-layout'>(</span><span class='hs-varid'>hsc_logger</span> <span class='hs-varid'>hsc_env</span><span class='hs-layout'>)</span> <span class='hs-layout'>(</span><span class='hs-varid'>hsc_dflags</span> <span class='hs-varid'>hsc_env</span><span class='hs-layout'>)</span> <span class='hs-varid'>w</span>
<a name="line-72"></a>    <span class='hs-varid'>return</span> <span class='hs-varid'>a</span>
<a name="line-73"></a>
<a name="line-74"></a><a name="mkInteractiveHscEnv"></a><span class='hs-comment'>-- | Switches in the DynFlags and Plugins from the InteractiveContext</span>
<a name="line-75"></a><span class='hs-definition'>mkInteractiveHscEnv</span> <span class='hs-keyglyph'>::</span> <span class='hs-conid'>HscEnv</span> <span class='hs-keyglyph'>-&gt;</span> <span class='hs-conid'>HscEnv</span>
<a name="line-76"></a><span class='hs-definition'>mkInteractiveHscEnv</span> <span class='hs-varid'>hsc_env</span> <span class='hs-keyglyph'>=</span>
<a name="line-77"></a>    <span class='hs-keyword'>let</span> <span class='hs-varid'>ic</span> <span class='hs-keyglyph'>=</span> <span class='hs-varid'>hsc_IC</span> <span class='hs-varid'>hsc_env</span>
<a name="line-78"></a>    <span class='hs-keyword'>in</span> <span class='hs-varid'>hsc_env</span> <span class='hs-layout'>{</span> <span class='hs-varid'>hsc_dflags</span>  <span class='hs-keyglyph'>=</span> <span class='hs-varid'>ic_dflags</span>  <span class='hs-varid'>ic</span>
<a name="line-79"></a>               <span class='hs-layout'>,</span> <span class='hs-varid'>hsc_plugins</span> <span class='hs-keyglyph'>=</span> <span class='hs-varid'>ic_plugins</span> <span class='hs-varid'>ic</span>
<a name="line-80"></a>               <span class='hs-layout'>}</span>
<a name="line-81"></a>
<a name="line-82"></a><a name="runInteractiveHsc"></a><span class='hs-comment'>-- | A variant of runHsc that switches in the DynFlags and Plugins from the</span>
<a name="line-83"></a><span class='hs-comment'>-- InteractiveContext before running the Hsc computation.</span>
<a name="line-84"></a><span class='hs-definition'>runInteractiveHsc</span> <span class='hs-keyglyph'>::</span> <span class='hs-conid'>HscEnv</span> <span class='hs-keyglyph'>-&gt;</span> <span class='hs-conid'>Hsc</span> <span class='hs-varid'>a</span> <span class='hs-keyglyph'>-&gt;</span> <span class='hs-conid'>IO</span> <span class='hs-varid'>a</span>
<a name="line-85"></a><span class='hs-definition'>runInteractiveHsc</span> <span class='hs-varid'>hsc_env</span> <span class='hs-keyglyph'>=</span> <span class='hs-varid'>runHsc</span> <span class='hs-layout'>(</span><span class='hs-varid'>mkInteractiveHscEnv</span> <span class='hs-varid'>hsc_env</span><span class='hs-layout'>)</span>
<a name="line-86"></a>
<a name="line-87"></a><a name="hsc_home_unit"></a><span class='hs-definition'>hsc_home_unit</span> <span class='hs-keyglyph'>::</span> <span class='hs-conid'>HscEnv</span> <span class='hs-keyglyph'>-&gt;</span> <span class='hs-conid'>HomeUnit</span>
<a name="line-88"></a><span class='hs-definition'>hsc_home_unit</span> <span class='hs-keyglyph'>=</span> <span class='hs-varid'>ue_home_unit</span> <span class='hs-varop'>.</span> <span class='hs-varid'>hsc_unit_env</span>
<a name="line-89"></a>
<a name="line-90"></a><a name="hsc_units"></a><span class='hs-definition'>hsc_units</span> <span class='hs-keyglyph'>::</span> <span class='hs-conid'>HscEnv</span> <span class='hs-keyglyph'>-&gt;</span> <span class='hs-conid'>UnitState</span>
<a name="line-91"></a><span class='hs-definition'>hsc_units</span> <span class='hs-keyglyph'>=</span> <span class='hs-varid'>ue_units</span> <span class='hs-varop'>.</span> <span class='hs-varid'>hsc_unit_env</span>
<a name="line-92"></a>
<a name="line-93"></a><span class='hs-comment'>{-
<a name="line-94"></a>
<a name="line-95"></a>Note [Target code interpreter]
<a name="line-96"></a>~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~
<a name="line-97"></a>
<a name="line-98"></a>Template Haskell and GHCi use an interpreter to execute code that is built for
<a name="line-99"></a>the compiler target platform (= code host platform) on the compiler host
<a name="line-100"></a>platform (= code build platform).
<a name="line-101"></a>
<a name="line-102"></a>The internal interpreter can be used when both platforms are the same and when
<a name="line-103"></a>the built code is compatible with the compiler itself (same way, etc.). This
<a name="line-104"></a>interpreter is not always available: for instance stage1 compiler doesn't have
<a name="line-105"></a>it because there might be an ABI mismatch between the code objects (built by
<a name="line-106"></a>stage1 compiler) and the stage1 compiler itself (built by stage0 compiler).
<a name="line-107"></a>
<a name="line-108"></a>In most cases, an external interpreter can be used instead: it runs in a
<a name="line-109"></a>separate process and it communicates with the compiler via a two-way message
<a name="line-110"></a>passing channel. The process is lazily spawned to avoid overhead when it is not
<a name="line-111"></a>used.
<a name="line-112"></a>
<a name="line-113"></a>The target code interpreter to use can be selected per session via the
<a name="line-114"></a>`hsc_interp` field of `HscEnv`. There may be no interpreter available at all, in
<a name="line-115"></a>which case Template Haskell and GHCi will fail to run. The interpreter to use is
<a name="line-116"></a>configured via command-line flags (in `GHC.setSessionDynFlags`).
<a name="line-117"></a>
<a name="line-118"></a>
<a name="line-119"></a>-}</span>
<a name="line-120"></a>
<a name="line-121"></a><span class='hs-comment'>-- Note [hsc_type_env_var hack]</span>
<a name="line-122"></a><span class='hs-comment'>-- ~~~~~~~~~~~~~~~~~~~~~~~~~~~~</span>
<a name="line-123"></a><span class='hs-comment'>-- hsc_type_env_var is used to initialize tcg_type_env_var, and</span>
<a name="line-124"></a><span class='hs-comment'>-- eventually it is the mutable variable that is queried from</span>
<a name="line-125"></a><span class='hs-comment'>-- if_rec_types to get a TypeEnv.  So, clearly, it's something</span>
<a name="line-126"></a><span class='hs-comment'>-- related to knot-tying (see Note [Tying the knot]).</span>
<a name="line-127"></a><span class='hs-comment'>-- hsc_type_env_var is used in two places: initTcRn (where</span>
<a name="line-128"></a><span class='hs-comment'>-- it initializes tcg_type_env_var) and initIfaceCheck</span>
<a name="line-129"></a><span class='hs-comment'>-- (where it initializes if_rec_types).</span>
<a name="line-130"></a><span class='hs-comment'>--</span>
<a name="line-131"></a><span class='hs-comment'>-- But why do we need a way to feed a mutable variable in?  Why</span>
<a name="line-132"></a><span class='hs-comment'>-- can't we just initialize tcg_type_env_var when we start</span>
<a name="line-133"></a><span class='hs-comment'>-- typechecking?  The problem is we need to knot-tie the</span>
<a name="line-134"></a><span class='hs-comment'>-- EPS, and we may start adding things to the EPS before type</span>
<a name="line-135"></a><span class='hs-comment'>-- checking starts.</span>
<a name="line-136"></a><span class='hs-comment'>--</span>
<a name="line-137"></a><span class='hs-comment'>-- Here is a concrete example. Suppose we are running</span>
<a name="line-138"></a><span class='hs-comment'>-- "ghc -c A.hs", and we have this file system state:</span>
<a name="line-139"></a><span class='hs-comment'>--</span>
<a name="line-140"></a><span class='hs-comment'>--  A.hs-boot   A.hi-boot **up to date**</span>
<a name="line-141"></a><span class='hs-comment'>--  B.hs        B.hi      **up to date**</span>
<a name="line-142"></a><span class='hs-comment'>--  A.hs        A.hi      **stale**</span>
<a name="line-143"></a><span class='hs-comment'>--</span>
<a name="line-144"></a><span class='hs-comment'>-- The first thing we do is run checkOldIface on A.hi.</span>
<a name="line-145"></a><span class='hs-comment'>-- checkOldIface will call loadInterface on B.hi so it can</span>
<a name="line-146"></a><span class='hs-comment'>-- get its hands on the fingerprints, to find out if A.hi</span>
<a name="line-147"></a><span class='hs-comment'>-- needs recompilation.  But loadInterface also populates</span>
<a name="line-148"></a><span class='hs-comment'>-- the EPS!  And so if compilation turns out to be necessary,</span>
<a name="line-149"></a><span class='hs-comment'>-- as it is in this case, the thunks we put into the EPS for</span>
<a name="line-150"></a><span class='hs-comment'>-- B.hi need to have the correct if_rec_types mutable variable</span>
<a name="line-151"></a><span class='hs-comment'>-- to query.</span>
<a name="line-152"></a><span class='hs-comment'>--</span>
<a name="line-153"></a><span class='hs-comment'>-- If the mutable variable is only allocated WHEN we start</span>
<a name="line-154"></a><span class='hs-comment'>-- typechecking, then that's too late: we can't get the</span>
<a name="line-155"></a><span class='hs-comment'>-- information to the thunks.  So we need to pre-commit</span>
<a name="line-156"></a><span class='hs-comment'>-- to a type variable in 'hscIncrementalCompile' BEFORE we</span>
<a name="line-157"></a><span class='hs-comment'>-- check the old interface.</span>
<a name="line-158"></a><span class='hs-comment'>--</span>
<a name="line-159"></a><span class='hs-comment'>-- This is all a massive hack because arguably checkOldIface</span>
<a name="line-160"></a><span class='hs-comment'>-- should not populate the EPS. But that's a refactor for</span>
<a name="line-161"></a><span class='hs-comment'>-- another day.</span>
<a name="line-162"></a>
<a name="line-163"></a><a name="hscEPS"></a><span class='hs-comment'>-- | Retrieve the ExternalPackageState cache.</span>
<a name="line-164"></a><span class='hs-definition'>hscEPS</span> <span class='hs-keyglyph'>::</span> <span class='hs-conid'>HscEnv</span> <span class='hs-keyglyph'>-&gt;</span> <span class='hs-conid'>IO</span> <span class='hs-conid'>ExternalPackageState</span>
<a name="line-165"></a><span class='hs-definition'>hscEPS</span> <span class='hs-varid'>hsc_env</span> <span class='hs-keyglyph'>=</span> <span class='hs-varid'>readIORef</span> <span class='hs-layout'>(</span><span class='hs-varid'>hsc_EPS</span> <span class='hs-varid'>hsc_env</span><span class='hs-layout'>)</span>
<a name="line-166"></a>
<a name="line-167"></a><a name="hptCompleteSigs"></a><span class='hs-definition'>hptCompleteSigs</span> <span class='hs-keyglyph'>::</span> <span class='hs-conid'>HscEnv</span> <span class='hs-keyglyph'>-&gt;</span> <span class='hs-keyglyph'>[</span><span class='hs-conid'>CompleteMatch</span><span class='hs-keyglyph'>]</span>
<a name="line-168"></a><span class='hs-definition'>hptCompleteSigs</span> <span class='hs-keyglyph'>=</span> <span class='hs-varid'>hptAllThings</span>  <span class='hs-layout'>(</span><span class='hs-varid'>md_complete_matches</span> <span class='hs-varop'>.</span> <span class='hs-varid'>hm_details</span><span class='hs-layout'>)</span>
<a name="line-169"></a>
<a name="line-170"></a><a name="hptInstances"></a><span class='hs-comment'>-- | Find all the instance declarations (of classes and families) from</span>
<a name="line-171"></a><span class='hs-comment'>-- the Home Package Table filtered by the provided predicate function.</span>
<a name="line-172"></a><span class='hs-comment'>-- Used in @tcRnImports@, to select the instances that are in the</span>
<a name="line-173"></a><span class='hs-comment'>-- transitive closure of imports from the currently compiled module.</span>
<a name="line-174"></a><span class='hs-definition'>hptInstances</span> <span class='hs-keyglyph'>::</span> <span class='hs-conid'>HscEnv</span> <span class='hs-keyglyph'>-&gt;</span> <span class='hs-layout'>(</span><span class='hs-conid'>ModuleName</span> <span class='hs-keyglyph'>-&gt;</span> <span class='hs-conid'>Bool</span><span class='hs-layout'>)</span> <span class='hs-keyglyph'>-&gt;</span> <span class='hs-layout'>(</span><span class='hs-keyglyph'>[</span><span class='hs-conid'>ClsInst</span><span class='hs-keyglyph'>]</span><span class='hs-layout'>,</span> <span class='hs-keyglyph'>[</span><span class='hs-conid'>FamInst</span><span class='hs-keyglyph'>]</span><span class='hs-layout'>)</span>
<a name="line-175"></a><span class='hs-definition'>hptInstances</span> <span class='hs-varid'>hsc_env</span> <span class='hs-varid'>want_this_module</span>
<a name="line-176"></a>  <span class='hs-keyglyph'>=</span> <span class='hs-keyword'>let</span> <span class='hs-layout'>(</span><span class='hs-varid'>insts</span><span class='hs-layout'>,</span> <span class='hs-varid'>famInsts</span><span class='hs-layout'>)</span> <span class='hs-keyglyph'>=</span> <span class='hs-varid'>unzip</span> <span class='hs-varop'>$</span> <span class='hs-varid'>flip</span> <span class='hs-varid'>hptAllThings</span> <span class='hs-varid'>hsc_env</span> <span class='hs-varop'>$</span> <span class='hs-keyglyph'>\</span><span class='hs-varid'>mod_info</span> <span class='hs-keyglyph'>-&gt;</span> <span class='hs-keyword'>do</span>
<a name="line-177"></a>                <span class='hs-varid'>guard</span> <span class='hs-layout'>(</span><span class='hs-varid'>want_this_module</span> <span class='hs-layout'>(</span><span class='hs-varid'>moduleName</span> <span class='hs-layout'>(</span><span class='hs-varid'>mi_module</span> <span class='hs-layout'>(</span><span class='hs-varid'>hm_iface</span> <span class='hs-varid'>mod_info</span><span class='hs-layout'>)</span><span class='hs-layout'>)</span><span class='hs-layout'>)</span><span class='hs-layout'>)</span>
<a name="line-178"></a>                <span class='hs-keyword'>let</span> <span class='hs-varid'>details</span> <span class='hs-keyglyph'>=</span> <span class='hs-varid'>hm_details</span> <span class='hs-varid'>mod_info</span>
<a name="line-179"></a>                <span class='hs-varid'>return</span> <span class='hs-layout'>(</span><span class='hs-varid'>md_insts</span> <span class='hs-varid'>details</span><span class='hs-layout'>,</span> <span class='hs-varid'>md_fam_insts</span> <span class='hs-varid'>details</span><span class='hs-layout'>)</span>
<a name="line-180"></a>    <span class='hs-keyword'>in</span> <span class='hs-layout'>(</span><span class='hs-varid'>concat</span> <span class='hs-varid'>insts</span><span class='hs-layout'>,</span> <span class='hs-varid'>concat</span> <span class='hs-varid'>famInsts</span><span class='hs-layout'>)</span>
<a name="line-181"></a>
<a name="line-182"></a><a name="hptRules"></a><span class='hs-comment'>-- | Get rules from modules "below" this one (in the dependency sense)</span>
<a name="line-183"></a><span class='hs-definition'>hptRules</span> <span class='hs-keyglyph'>::</span> <span class='hs-conid'>HscEnv</span> <span class='hs-keyglyph'>-&gt;</span> <span class='hs-keyglyph'>[</span><span class='hs-conid'>ModuleNameWithIsBoot</span><span class='hs-keyglyph'>]</span> <span class='hs-keyglyph'>-&gt;</span> <span class='hs-keyglyph'>[</span><span class='hs-conid'>CoreRule</span><span class='hs-keyglyph'>]</span>
<a name="line-184"></a><span class='hs-definition'>hptRules</span> <span class='hs-keyglyph'>=</span> <span class='hs-varid'>hptSomeThingsBelowUs</span> <span class='hs-layout'>(</span><span class='hs-varid'>md_rules</span> <span class='hs-varop'>.</span> <span class='hs-varid'>hm_details</span><span class='hs-layout'>)</span> <span class='hs-conid'>False</span>
<a name="line-185"></a>
<a name="line-186"></a>
<a name="line-187"></a><a name="hptAnns"></a><span class='hs-comment'>-- | Get annotations from modules "below" this one (in the dependency sense)</span>
<a name="line-188"></a><span class='hs-definition'>hptAnns</span> <span class='hs-keyglyph'>::</span> <span class='hs-conid'>HscEnv</span> <span class='hs-keyglyph'>-&gt;</span> <span class='hs-conid'>Maybe</span> <span class='hs-keyglyph'>[</span><span class='hs-conid'>ModuleNameWithIsBoot</span><span class='hs-keyglyph'>]</span> <span class='hs-keyglyph'>-&gt;</span> <span class='hs-keyglyph'>[</span><span class='hs-conid'>Annotation</span><span class='hs-keyglyph'>]</span>
<a name="line-189"></a><span class='hs-definition'>hptAnns</span> <span class='hs-varid'>hsc_env</span> <span class='hs-layout'>(</span><span class='hs-conid'>Just</span> <span class='hs-varid'>deps</span><span class='hs-layout'>)</span> <span class='hs-keyglyph'>=</span> <span class='hs-varid'>hptSomeThingsBelowUs</span> <span class='hs-layout'>(</span><span class='hs-varid'>md_anns</span> <span class='hs-varop'>.</span> <span class='hs-varid'>hm_details</span><span class='hs-layout'>)</span> <span class='hs-conid'>False</span> <span class='hs-varid'>hsc_env</span> <span class='hs-varid'>deps</span>
<a name="line-190"></a><span class='hs-definition'>hptAnns</span> <span class='hs-varid'>hsc_env</span> <span class='hs-conid'>Nothing</span> <span class='hs-keyglyph'>=</span> <span class='hs-varid'>hptAllThings</span> <span class='hs-layout'>(</span><span class='hs-varid'>md_anns</span> <span class='hs-varop'>.</span> <span class='hs-varid'>hm_details</span><span class='hs-layout'>)</span> <span class='hs-varid'>hsc_env</span>
<a name="line-191"></a>
<a name="line-192"></a><a name="hptAllThings"></a><span class='hs-definition'>hptAllThings</span> <span class='hs-keyglyph'>::</span> <span class='hs-layout'>(</span><span class='hs-conid'>HomeModInfo</span> <span class='hs-keyglyph'>-&gt;</span> <span class='hs-keyglyph'>[</span><span class='hs-varid'>a</span><span class='hs-keyglyph'>]</span><span class='hs-layout'>)</span> <span class='hs-keyglyph'>-&gt;</span> <span class='hs-conid'>HscEnv</span> <span class='hs-keyglyph'>-&gt;</span> <span class='hs-keyglyph'>[</span><span class='hs-varid'>a</span><span class='hs-keyglyph'>]</span>
<a name="line-193"></a><span class='hs-definition'>hptAllThings</span> <span class='hs-varid'>extract</span> <span class='hs-varid'>hsc_env</span> <span class='hs-keyglyph'>=</span> <span class='hs-varid'>concatMap</span> <span class='hs-varid'>extract</span> <span class='hs-layout'>(</span><span class='hs-varid'>eltsHpt</span> <span class='hs-layout'>(</span><span class='hs-varid'>hsc_HPT</span> <span class='hs-varid'>hsc_env</span><span class='hs-layout'>)</span><span class='hs-layout'>)</span>
<a name="line-194"></a>
<a name="line-195"></a><a name="hptSomeThingsBelowUs"></a><span class='hs-comment'>-- | Get things from modules "below" this one (in the dependency sense)</span>
<a name="line-196"></a><span class='hs-comment'>-- C.f Inst.hptInstances</span>
<a name="line-197"></a><span class='hs-definition'>hptSomeThingsBelowUs</span> <span class='hs-keyglyph'>::</span> <span class='hs-layout'>(</span><span class='hs-conid'>HomeModInfo</span> <span class='hs-keyglyph'>-&gt;</span> <span class='hs-keyglyph'>[</span><span class='hs-varid'>a</span><span class='hs-keyglyph'>]</span><span class='hs-layout'>)</span> <span class='hs-keyglyph'>-&gt;</span> <span class='hs-conid'>Bool</span> <span class='hs-keyglyph'>-&gt;</span> <span class='hs-conid'>HscEnv</span> <span class='hs-keyglyph'>-&gt;</span> <span class='hs-keyglyph'>[</span><span class='hs-conid'>ModuleNameWithIsBoot</span><span class='hs-keyglyph'>]</span> <span class='hs-keyglyph'>-&gt;</span> <span class='hs-keyglyph'>[</span><span class='hs-varid'>a</span><span class='hs-keyglyph'>]</span>
<a name="line-198"></a><span class='hs-definition'>hptSomeThingsBelowUs</span> <span class='hs-varid'>extract</span> <span class='hs-varid'>include_hi_boot</span> <span class='hs-varid'>hsc_env</span> <span class='hs-varid'>deps</span>
<a name="line-199"></a>  <span class='hs-keyglyph'>|</span> <span class='hs-varid'>isOneShot</span> <span class='hs-layout'>(</span><span class='hs-varid'>ghcMode</span> <span class='hs-layout'>(</span><span class='hs-varid'>hsc_dflags</span> <span class='hs-varid'>hsc_env</span><span class='hs-layout'>)</span><span class='hs-layout'>)</span> <span class='hs-keyglyph'>=</span> <span class='hs-conid'>[]</span>
<a name="line-200"></a>
<a name="line-201"></a>  <span class='hs-keyglyph'>|</span> <span class='hs-varid'>otherwise</span>
<a name="line-202"></a>  <span class='hs-keyglyph'>=</span> <span class='hs-keyword'>let</span> <span class='hs-varid'>hpt</span> <span class='hs-keyglyph'>=</span> <span class='hs-varid'>hsc_HPT</span> <span class='hs-varid'>hsc_env</span>
<a name="line-203"></a>    <span class='hs-keyword'>in</span>
<a name="line-204"></a>    <span class='hs-keyglyph'>[</span> <span class='hs-varid'>thing</span>
<a name="line-205"></a>    <span class='hs-keyglyph'>|</span>   <span class='hs-comment'>-- Find each non-hi-boot module below me</span>
<a name="line-206"></a>      <span class='hs-conid'>GWIB</span> <span class='hs-layout'>{</span> <span class='hs-varid'>gwib_mod</span> <span class='hs-keyglyph'>=</span> <span class='hs-varid'>mod</span><span class='hs-layout'>,</span> <span class='hs-varid'>gwib_isBoot</span> <span class='hs-keyglyph'>=</span> <span class='hs-varid'>is_boot</span> <span class='hs-layout'>}</span> <span class='hs-keyglyph'>&lt;-</span> <span class='hs-varid'>deps</span>
<a name="line-207"></a>    <span class='hs-layout'>,</span> <span class='hs-varid'>include_hi_boot</span> <span class='hs-varop'>||</span> <span class='hs-layout'>(</span><span class='hs-varid'>is_boot</span> <span class='hs-varop'>==</span> <span class='hs-conid'>NotBoot</span><span class='hs-layout'>)</span>
<a name="line-208"></a>
<a name="line-209"></a>        <span class='hs-comment'>-- unsavoury: when compiling the base package with --make, we</span>
<a name="line-210"></a>        <span class='hs-comment'>-- sometimes try to look up RULES etc for GHC.Prim. GHC.Prim won't</span>
<a name="line-211"></a>        <span class='hs-comment'>-- be in the HPT, because we never compile it; it's in the EPT</span>
<a name="line-212"></a>        <span class='hs-comment'>-- instead. ToDo: clean up, and remove this slightly bogus filter:</span>
<a name="line-213"></a>    <span class='hs-layout'>,</span> <span class='hs-varid'>mod</span> <span class='hs-varop'>/=</span> <span class='hs-varid'>moduleName</span> <span class='hs-varid'>gHC_PRIM</span>
<a name="line-214"></a>
<a name="line-215"></a>        <span class='hs-comment'>-- Look it up in the HPT</span>
<a name="line-216"></a>    <span class='hs-layout'>,</span> <span class='hs-keyword'>let</span> <span class='hs-varid'>things</span> <span class='hs-keyglyph'>=</span> <span class='hs-keyword'>case</span> <span class='hs-varid'>lookupHpt</span> <span class='hs-varid'>hpt</span> <span class='hs-varid'>mod</span> <span class='hs-keyword'>of</span>
<a name="line-217"></a>                    <span class='hs-conid'>Just</span> <span class='hs-varid'>info</span> <span class='hs-keyglyph'>-&gt;</span> <span class='hs-varid'>extract</span> <span class='hs-varid'>info</span>
<a name="line-218"></a>                    <span class='hs-conid'>Nothing</span> <span class='hs-keyglyph'>-&gt;</span> <span class='hs-varid'>pprTrace</span> <span class='hs-str'>"WARNING in hptSomeThingsBelowUs"</span> <span class='hs-varid'>msg</span> <span class='hs-conid'>[]</span>
<a name="line-219"></a>          <span class='hs-varid'>msg</span> <span class='hs-keyglyph'>=</span> <span class='hs-varid'>vcat</span> <span class='hs-keyglyph'>[</span><span class='hs-varid'>text</span> <span class='hs-str'>"missing module"</span> <span class='hs-varop'>&lt;+&gt;</span> <span class='hs-varid'>ppr</span> <span class='hs-varid'>mod</span><span class='hs-layout'>,</span>
<a name="line-220"></a>                      <span class='hs-varid'>text</span> <span class='hs-str'>"Probable cause: out-of-date interface files"</span><span class='hs-keyglyph'>]</span>
<a name="line-221"></a>                        <span class='hs-comment'>-- This really shouldn't happen, but see #962</span>
<a name="line-222"></a>
<a name="line-223"></a>        <span class='hs-comment'>-- And get its dfuns</span>
<a name="line-224"></a>    <span class='hs-layout'>,</span> <span class='hs-varid'>thing</span> <span class='hs-keyglyph'>&lt;-</span> <span class='hs-varid'>things</span> <span class='hs-keyglyph'>]</span>
<a name="line-225"></a>
<a name="line-226"></a>
<a name="line-227"></a><a name="prepareAnnotations"></a><span class='hs-comment'>-- | Deal with gathering annotations in from all possible places</span>
<a name="line-228"></a><span class='hs-comment'>--   and combining them into a single 'AnnEnv'</span>
<a name="line-229"></a><span class='hs-definition'>prepareAnnotations</span> <span class='hs-keyglyph'>::</span> <span class='hs-conid'>HscEnv</span> <span class='hs-keyglyph'>-&gt;</span> <span class='hs-conid'>Maybe</span> <span class='hs-conid'>ModGuts</span> <span class='hs-keyglyph'>-&gt;</span> <span class='hs-conid'>IO</span> <span class='hs-conid'>AnnEnv</span>
<a name="line-230"></a><span class='hs-definition'>prepareAnnotations</span> <span class='hs-varid'>hsc_env</span> <span class='hs-varid'>mb_guts</span> <span class='hs-keyglyph'>=</span> <span class='hs-keyword'>do</span>
<a name="line-231"></a>    <span class='hs-varid'>eps</span> <span class='hs-keyglyph'>&lt;-</span> <span class='hs-varid'>hscEPS</span> <span class='hs-varid'>hsc_env</span>
<a name="line-232"></a>    <span class='hs-keyword'>let</span> <span class='hs-comment'>-- Extract annotations from the module being compiled if supplied one</span>
<a name="line-233"></a>        <span class='hs-varid'>mb_this_module_anns</span> <span class='hs-keyglyph'>=</span> <span class='hs-varid'>fmap</span> <span class='hs-layout'>(</span><span class='hs-varid'>mkAnnEnv</span> <span class='hs-varop'>.</span> <span class='hs-varid'>mg_anns</span><span class='hs-layout'>)</span> <span class='hs-varid'>mb_guts</span>
<a name="line-234"></a>        <span class='hs-comment'>-- Extract dependencies of the module if we are supplied one,</span>
<a name="line-235"></a>        <span class='hs-comment'>-- otherwise load annotations from all home package table</span>
<a name="line-236"></a>        <span class='hs-comment'>-- entries regardless of dependency ordering.</span>
<a name="line-237"></a>        <span class='hs-varid'>home_pkg_anns</span>  <span class='hs-keyglyph'>=</span> <span class='hs-layout'>(</span><span class='hs-varid'>mkAnnEnv</span> <span class='hs-varop'>.</span> <span class='hs-varid'>hptAnns</span> <span class='hs-varid'>hsc_env</span><span class='hs-layout'>)</span> <span class='hs-varop'>$</span> <span class='hs-varid'>fmap</span> <span class='hs-layout'>(</span><span class='hs-varid'>dep_mods</span> <span class='hs-varop'>.</span> <span class='hs-varid'>mg_deps</span><span class='hs-layout'>)</span> <span class='hs-varid'>mb_guts</span>
<a name="line-238"></a>        <span class='hs-varid'>other_pkg_anns</span> <span class='hs-keyglyph'>=</span> <span class='hs-varid'>eps_ann_env</span> <span class='hs-varid'>eps</span>
<a name="line-239"></a>        <span class='hs-varid'>ann_env</span>        <span class='hs-keyglyph'>=</span> <span class='hs-varid'>foldl1'</span> <span class='hs-varid'>plusAnnEnv</span> <span class='hs-varop'>$</span> <span class='hs-varid'>catMaybes</span> <span class='hs-keyglyph'>[</span><span class='hs-varid'>mb_this_module_anns</span><span class='hs-layout'>,</span>
<a name="line-240"></a>                                                         <span class='hs-conid'>Just</span> <span class='hs-varid'>home_pkg_anns</span><span class='hs-layout'>,</span>
<a name="line-241"></a>                                                         <span class='hs-conid'>Just</span> <span class='hs-varid'>other_pkg_anns</span><span class='hs-keyglyph'>]</span>
<a name="line-242"></a>    <span class='hs-varid'>return</span> <span class='hs-varid'>ann_env</span>
<a name="line-243"></a>
<a name="line-244"></a><a name="lookupType"></a><span class='hs-comment'>-- | Find the 'TyThing' for the given 'Name' by using all the resources</span>
<a name="line-245"></a><span class='hs-comment'>-- at our disposal: the compiled modules in the 'HomePackageTable' and the</span>
<a name="line-246"></a><span class='hs-comment'>-- compiled modules in other packages that live in 'PackageTypeEnv'. Note</span>
<a name="line-247"></a><span class='hs-comment'>-- that this does NOT look up the 'TyThing' in the module being compiled: you</span>
<a name="line-248"></a><span class='hs-comment'>-- have to do that yourself, if desired</span>
<a name="line-249"></a><span class='hs-definition'>lookupType</span> <span class='hs-keyglyph'>::</span> <span class='hs-conid'>HscEnv</span> <span class='hs-keyglyph'>-&gt;</span> <span class='hs-conid'>Name</span> <span class='hs-keyglyph'>-&gt;</span> <span class='hs-conid'>IO</span> <span class='hs-layout'>(</span><span class='hs-conid'>Maybe</span> <span class='hs-conid'>TyThing</span><span class='hs-layout'>)</span>
<a name="line-250"></a><span class='hs-definition'>lookupType</span> <span class='hs-varid'>hsc_env</span> <span class='hs-varid'>name</span> <span class='hs-keyglyph'>=</span> <span class='hs-keyword'>do</span>
<a name="line-251"></a>   <span class='hs-varid'>eps</span> <span class='hs-keyglyph'>&lt;-</span> <span class='hs-varid'>liftIO</span> <span class='hs-varop'>$</span> <span class='hs-varid'>readIORef</span> <span class='hs-layout'>(</span><span class='hs-varid'>hsc_EPS</span> <span class='hs-varid'>hsc_env</span><span class='hs-layout'>)</span>
<a name="line-252"></a>   <span class='hs-keyword'>let</span> <span class='hs-varid'>pte</span> <span class='hs-keyglyph'>=</span> <span class='hs-varid'>eps_PTE</span> <span class='hs-varid'>eps</span>
<a name="line-253"></a>       <span class='hs-varid'>hpt</span> <span class='hs-keyglyph'>=</span> <span class='hs-varid'>hsc_HPT</span> <span class='hs-varid'>hsc_env</span>
<a name="line-254"></a>
<a name="line-255"></a>       <span class='hs-varid'>mod</span> <span class='hs-keyglyph'>=</span> <span class='hs-conid'>ASSERT2</span><span class='hs-layout'>(</span> <span class='hs-varid'>isExternalName</span> <span class='hs-varid'>name</span><span class='hs-layout'>,</span> <span class='hs-varid'>ppr</span> <span class='hs-varid'>name</span> <span class='hs-layout'>)</span>
<a name="line-256"></a>             <span class='hs-keyword'>if</span> <span class='hs-varid'>isHoleName</span> <span class='hs-varid'>name</span>
<a name="line-257"></a>               <span class='hs-keyword'>then</span> <span class='hs-varid'>mkHomeModule</span> <span class='hs-layout'>(</span><span class='hs-varid'>hsc_home_unit</span> <span class='hs-varid'>hsc_env</span><span class='hs-layout'>)</span> <span class='hs-layout'>(</span><span class='hs-varid'>moduleName</span> <span class='hs-layout'>(</span><span class='hs-varid'>nameModule</span> <span class='hs-varid'>name</span><span class='hs-layout'>)</span><span class='hs-layout'>)</span>
<a name="line-258"></a>               <span class='hs-keyword'>else</span> <span class='hs-varid'>nameModule</span> <span class='hs-varid'>name</span>
<a name="line-259"></a>
<a name="line-260"></a>       <span class='hs-varop'>!</span><span class='hs-varid'>ty</span> <span class='hs-keyglyph'>=</span> <span class='hs-keyword'>if</span> <span class='hs-varid'>isOneShot</span> <span class='hs-layout'>(</span><span class='hs-varid'>ghcMode</span> <span class='hs-layout'>(</span><span class='hs-varid'>hsc_dflags</span> <span class='hs-varid'>hsc_env</span><span class='hs-layout'>)</span><span class='hs-layout'>)</span>
<a name="line-261"></a>               <span class='hs-comment'>-- in one-shot, we don't use the HPT</span>
<a name="line-262"></a>               <span class='hs-keyword'>then</span> <span class='hs-varid'>lookupNameEnv</span> <span class='hs-varid'>pte</span> <span class='hs-varid'>name</span>
<a name="line-263"></a>               <span class='hs-keyword'>else</span> <span class='hs-keyword'>case</span> <span class='hs-varid'>lookupHptByModule</span> <span class='hs-varid'>hpt</span> <span class='hs-varid'>mod</span> <span class='hs-keyword'>of</span>
<a name="line-264"></a>                <span class='hs-conid'>Just</span> <span class='hs-varid'>hm</span> <span class='hs-keyglyph'>-&gt;</span> <span class='hs-varid'>lookupNameEnv</span> <span class='hs-layout'>(</span><span class='hs-varid'>md_types</span> <span class='hs-layout'>(</span><span class='hs-varid'>hm_details</span> <span class='hs-varid'>hm</span><span class='hs-layout'>)</span><span class='hs-layout'>)</span> <span class='hs-varid'>name</span>
<a name="line-265"></a>                <span class='hs-conid'>Nothing</span> <span class='hs-keyglyph'>-&gt;</span> <span class='hs-varid'>lookupNameEnv</span> <span class='hs-varid'>pte</span> <span class='hs-varid'>name</span>
<a name="line-266"></a>   <span class='hs-varid'>pure</span> <span class='hs-varid'>ty</span>
<a name="line-267"></a>
<a name="line-268"></a><a name="lookupIfaceByModule"></a><span class='hs-comment'>-- | Find the 'ModIface' for a 'Module', searching in both the loaded home</span>
<a name="line-269"></a><span class='hs-comment'>-- and external package module information</span>
<a name="line-270"></a><span class='hs-definition'>lookupIfaceByModule</span>
<a name="line-271"></a>        <span class='hs-keyglyph'>::</span> <span class='hs-conid'>HomePackageTable</span>
<a name="line-272"></a>        <span class='hs-keyglyph'>-&gt;</span> <span class='hs-conid'>PackageIfaceTable</span>
<a name="line-273"></a>        <span class='hs-keyglyph'>-&gt;</span> <span class='hs-conid'>Module</span>
<a name="line-274"></a>        <span class='hs-keyglyph'>-&gt;</span> <span class='hs-conid'>Maybe</span> <span class='hs-conid'>ModIface</span>
<a name="line-275"></a><span class='hs-definition'>lookupIfaceByModule</span> <span class='hs-varid'>hpt</span> <span class='hs-varid'>pit</span> <span class='hs-varid'>mod</span>
<a name="line-276"></a>  <span class='hs-keyglyph'>=</span> <span class='hs-keyword'>case</span> <span class='hs-varid'>lookupHptByModule</span> <span class='hs-varid'>hpt</span> <span class='hs-varid'>mod</span> <span class='hs-keyword'>of</span>
<a name="line-277"></a>       <span class='hs-conid'>Just</span> <span class='hs-varid'>hm</span> <span class='hs-keyglyph'>-&gt;</span> <span class='hs-conid'>Just</span> <span class='hs-layout'>(</span><span class='hs-varid'>hm_iface</span> <span class='hs-varid'>hm</span><span class='hs-layout'>)</span>
<a name="line-278"></a>       <span class='hs-conid'>Nothing</span> <span class='hs-keyglyph'>-&gt;</span> <span class='hs-varid'>lookupModuleEnv</span> <span class='hs-varid'>pit</span> <span class='hs-varid'>mod</span>
<a name="line-279"></a>   <span class='hs-comment'>-- If the module does come from the home package, why do we look in the PIT as well?</span>
<a name="line-280"></a>   <span class='hs-comment'>-- (a) In OneShot mode, even home-package modules accumulate in the PIT</span>
<a name="line-281"></a>   <span class='hs-comment'>-- (b) Even in Batch (--make) mode, there is *one* case where a home-package</span>
<a name="line-282"></a>   <span class='hs-comment'>--     module is in the PIT, namely GHC.Prim when compiling the base package.</span>
<a name="line-283"></a>   <span class='hs-comment'>-- We could eliminate (b) if we wanted, by making GHC.Prim belong to a package</span>
<a name="line-284"></a>   <span class='hs-comment'>-- of its own, but it doesn't seem worth the bother.</span>
<a name="line-285"></a>
<a name="line-286"></a><a name="mainModIs"></a><span class='hs-definition'>mainModIs</span> <span class='hs-keyglyph'>::</span> <span class='hs-conid'>HscEnv</span> <span class='hs-keyglyph'>-&gt;</span> <span class='hs-conid'>Module</span>
<a name="line-287"></a><span class='hs-definition'>mainModIs</span> <span class='hs-varid'>hsc_env</span> <span class='hs-keyglyph'>=</span> <span class='hs-varid'>mkHomeModule</span> <span class='hs-layout'>(</span><span class='hs-varid'>hsc_home_unit</span> <span class='hs-varid'>hsc_env</span><span class='hs-layout'>)</span> <span class='hs-layout'>(</span><span class='hs-varid'>mainModuleNameIs</span> <span class='hs-layout'>(</span><span class='hs-varid'>hsc_dflags</span> <span class='hs-varid'>hsc_env</span><span class='hs-layout'>)</span><span class='hs-layout'>)</span>
</pre></body>
</html>
