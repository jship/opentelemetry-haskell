<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd"><html xmlns="http://www.w3.org/1999/xhtml"><head><link rel="stylesheet" type="text/css" href="style.css" /><script type="text/javascript" src="highlight.js"></script></head><body><pre><span class="hs-pragma">{-# LANGUAGE CPP                 #-}</span><span>
</span><span id="line-2"></span><span class="hs-pragma">{-# LANGUAGE LambdaCase          #-}</span><span>
</span><span id="line-3"></span><span class="hs-pragma">{-# LANGUAGE ScopedTypeVariables #-}</span><span>
</span><span id="line-4"></span><span class="hs-pragma">{-# LANGUAGE ViewPatterns        #-}</span><span>
</span><span id="line-5"></span><span>
</span><span id="line-6"></span><span class="hs-comment">{-
Authors: George Karachalias &lt;george.karachalias@cs.kuleuven.be&gt;
         Sebastian Graf &lt;sgraf1337@gmail.com&gt;
         Ryan Scott &lt;ryan.gl.scott@gmail.com&gt;
-}</span><span>
</span><span id="line-11"></span><span>
</span><span id="line-12"></span><span class="hs-comment">-- | Model refinements type as per the</span><span>
</span><span id="line-13"></span><span class="hs-comment">-- [Lower Your Guards paper](https://dl.acm.org/doi/abs/10.1145/3408989).</span><span>
</span><span id="line-14"></span><span class="hs-comment">-- The main export of the module are the functions 'addPhiCtsNablas' for adding</span><span>
</span><span id="line-15"></span><span class="hs-comment">-- facts to the oracle, 'isInhabited' to check if a refinement type is inhabited</span><span>
</span><span id="line-16"></span><span class="hs-comment">-- and 'generateInhabitingPatterns' to turn a 'Nabla' into a concrete pattern</span><span>
</span><span id="line-17"></span><span class="hs-comment">-- for an equation.</span><span>
</span><span id="line-18"></span><span class="hs-comment">--</span><span>
</span><span id="line-19"></span><span class="hs-comment">-- In terms of the LYG paper, this module is concerned with Sections 3.4, 3.6</span><span>
</span><span id="line-20"></span><span class="hs-comment">-- and 3.7. E.g., it represents refinement types directly as a bunch of</span><span>
</span><span id="line-21"></span><span class="hs-comment">-- normalised refinement types 'Nabla'.</span><span>
</span><span id="line-22"></span><span>
</span><span id="line-23"></span><span class="hs-keyword">module</span><span> </span><span class="hs-identifier">GHC.HsToCore.Pmc.Solver</span><span> </span><span class="hs-special">(</span><span>
</span><span id="line-24"></span><span>
</span><span id="line-25"></span><span>        </span><span class="annot"><a href="GHC.HsToCore.Pmc.Solver.Types.html#Nabla"><span class="hs-identifier">Nabla</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><a href="GHC.HsToCore.Pmc.Solver.Types.html#Nablas"><span class="hs-identifier">Nablas</span></a></span><span class="hs-special">(</span><span class="hs-glyph">..</span><span class="hs-special">)</span><span class="hs-special">,</span><span> </span><span class="annot"><a href="GHC.HsToCore.Pmc.Solver.Types.html#initNablas"><span class="hs-identifier">initNablas</span></a></span><span class="hs-special">,</span><span>
</span><span id="line-26"></span><span>        </span><span class="annot"><a href="GHC.HsToCore.Pmc.Solver.html#lookupRefuts"><span class="hs-identifier">lookupRefuts</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><a href="GHC.HsToCore.Pmc.Solver.html#lookupSolution"><span class="hs-identifier">lookupSolution</span></a></span><span class="hs-special">,</span><span>
</span><span id="line-27"></span><span>
</span><span id="line-28"></span><span>        </span><span class="annot"><a href="GHC.HsToCore.Pmc.Solver.html#PhiCt"><span class="hs-identifier">PhiCt</span></a></span><span class="hs-special">(</span><span class="hs-glyph">..</span><span class="hs-special">)</span><span class="hs-special">,</span><span> </span><span class="annot"><a href="GHC.HsToCore.Pmc.Solver.html#PhiCts"><span class="hs-identifier">PhiCts</span></a></span><span class="hs-special">,</span><span>
</span><span id="line-29"></span><span>        </span><span class="annot"><a href="GHC.HsToCore.Pmc.Solver.html#addPhiCtNablas"><span class="hs-identifier">addPhiCtNablas</span></a></span><span class="hs-special">,</span><span>
</span><span id="line-30"></span><span>        </span><span class="annot"><a href="GHC.HsToCore.Pmc.Solver.html#addPhiCtsNablas"><span class="hs-identifier">addPhiCtsNablas</span></a></span><span class="hs-special">,</span><span>
</span><span id="line-31"></span><span>
</span><span id="line-32"></span><span>        </span><span class="annot"><a href="GHC.HsToCore.Pmc.Solver.html#isInhabited"><span class="hs-identifier">isInhabited</span></a></span><span class="hs-special">,</span><span>
</span><span id="line-33"></span><span>        </span><span class="annot"><a href="GHC.HsToCore.Pmc.Solver.html#generateInhabitingPatterns"><span class="hs-identifier">generateInhabitingPatterns</span></a></span><span>
</span><span id="line-34"></span><span>
</span><span id="line-35"></span><span>    </span><span class="hs-special">)</span><span> </span><span class="hs-keyword">where</span><span class="hs-cpp">

#include &quot;HsVersions.h&quot;
</span><span>
</span><span id="line-39"></span><span class="hs-keyword">import</span><span> </span><span class="annot"><a href="GHC.Prelude.html"><span class="hs-identifier">GHC.Prelude</span></a></span><span>
</span><span id="line-40"></span><span>
</span><span id="line-41"></span><span class="hs-keyword">import</span><span> </span><span class="annot"><a href="GHC.HsToCore.Pmc.Types.html"><span class="hs-identifier">GHC.HsToCore.Pmc.Types</span></a></span><span>
</span><span id="line-42"></span><span class="hs-keyword">import</span><span> </span><span class="annot"><a href="GHC.HsToCore.Pmc.Utils.html"><span class="hs-identifier">GHC.HsToCore.Pmc.Utils</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="GHC.HsToCore.Pmc.Utils.html#tracePm"><span class="hs-identifier">tracePm</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><a href="GHC.HsToCore.Pmc.Utils.html#mkPmId"><span class="hs-identifier">mkPmId</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-43"></span><span>
</span><span id="line-44"></span><span class="hs-keyword">import</span><span> </span><span class="annot"><a href="GHC.Driver.Session.html"><span class="hs-identifier">GHC.Driver.Session</span></a></span><span>
</span><span id="line-45"></span><span class="hs-keyword">import</span><span> </span><span class="annot"><a href="GHC.Driver.Config.html"><span class="hs-identifier">GHC.Driver.Config</span></a></span><span>
</span><span id="line-46"></span><span class="hs-keyword">import</span><span> </span><span class="annot"><a href="GHC.Utils.Outputable.html"><span class="hs-identifier">GHC.Utils.Outputable</span></a></span><span>
</span><span id="line-47"></span><span class="hs-keyword">import</span><span> </span><span class="annot"><a href="GHC.Utils.Misc.html"><span class="hs-identifier">GHC.Utils.Misc</span></a></span><span>
</span><span id="line-48"></span><span class="hs-keyword">import</span><span> </span><span class="annot"><a href="GHC.Utils.Monad.html"><span class="hs-identifier">GHC.Utils.Monad</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="GHC.Utils.Monad.html#allM"><span class="hs-identifier">allM</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-49"></span><span class="hs-keyword">import</span><span> </span><span class="annot"><a href="GHC.Utils.Panic.html"><span class="hs-identifier">GHC.Utils.Panic</span></a></span><span>
</span><span id="line-50"></span><span class="hs-keyword">import</span><span> </span><span class="annot"><a href="GHC.Data.Bag.html"><span class="hs-identifier">GHC.Data.Bag</span></a></span><span>
</span><span id="line-51"></span><span class="hs-keyword">import</span><span> </span><span class="annot"><a href="GHC.Types.CompleteMatch.html"><span class="hs-identifier">GHC.Types.CompleteMatch</span></a></span><span>
</span><span id="line-52"></span><span class="hs-keyword">import</span><span> </span><span class="annot"><a href="GHC.Types.Unique.Set.html"><span class="hs-identifier">GHC.Types.Unique.Set</span></a></span><span>
</span><span id="line-53"></span><span class="hs-keyword">import</span><span> </span><span class="annot"><a href="GHC.Types.Unique.DSet.html"><span class="hs-identifier">GHC.Types.Unique.DSet</span></a></span><span>
</span><span id="line-54"></span><span class="hs-keyword">import</span><span> </span><span class="annot"><a href="GHC.Types.Unique.SDFM.html"><span class="hs-identifier">GHC.Types.Unique.SDFM</span></a></span><span>
</span><span id="line-55"></span><span class="hs-keyword">import</span><span> </span><span class="annot"><a href="GHC.Types.Id.html"><span class="hs-identifier">GHC.Types.Id</span></a></span><span>
</span><span id="line-56"></span><span class="hs-keyword">import</span><span> </span><span class="annot"><a href="GHC.Types.Name.html"><span class="hs-identifier">GHC.Types.Name</span></a></span><span>
</span><span id="line-57"></span><span class="hs-keyword">import</span><span> </span><span class="annot"><a href="GHC.Types.Var.html"><span class="hs-identifier">GHC.Types.Var</span></a></span><span>      </span><span class="hs-special">(</span><span class="annot"><a href="GHC.Types.Var.html#EvVar"><span class="hs-identifier">EvVar</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-58"></span><span class="hs-keyword">import</span><span> </span><span class="annot"><a href="GHC.Types.Var.Env.html"><span class="hs-identifier">GHC.Types.Var.Env</span></a></span><span>
</span><span id="line-59"></span><span class="hs-keyword">import</span><span> </span><span class="annot"><a href="GHC.Types.Var.Set.html"><span class="hs-identifier">GHC.Types.Var.Set</span></a></span><span>
</span><span id="line-60"></span><span class="hs-keyword">import</span><span> </span><span class="annot"><a href="GHC.Core.html"><span class="hs-identifier">GHC.Core</span></a></span><span>
</span><span id="line-61"></span><span class="hs-keyword">import</span><span> </span><span class="annot"><a href="GHC.Core.FVs.html"><span class="hs-identifier">GHC.Core.FVs</span></a></span><span>       </span><span class="hs-special">(</span><span class="annot"><a href="GHC.Core.FVs.html#exprFreeVars"><span class="hs-identifier">exprFreeVars</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-62"></span><span class="hs-keyword">import</span><span> </span><span class="annot"><a href="GHC.Core.Map.Expr.html"><span class="hs-identifier">GHC.Core.Map.Expr</span></a></span><span>
</span><span id="line-63"></span><span class="hs-keyword">import</span><span> </span><span class="annot"><a href="GHC.Core.SimpleOpt.html"><span class="hs-identifier">GHC.Core.SimpleOpt</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="GHC.Core.SimpleOpt.html#simpleOptExpr"><span class="hs-identifier">simpleOptExpr</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><a href="GHC.Core.SimpleOpt.html#exprIsConApp_maybe"><span class="hs-identifier">exprIsConApp_maybe</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-64"></span><span class="hs-keyword">import</span><span> </span><span class="annot"><a href="GHC.Core.Utils.html"><span class="hs-identifier">GHC.Core.Utils</span></a></span><span>     </span><span class="hs-special">(</span><span class="annot"><a href="GHC.Core.Utils.html#exprType"><span class="hs-identifier">exprType</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-65"></span><span class="hs-keyword">import</span><span> </span><span class="annot"><a href="GHC.Core.Make.html"><span class="hs-identifier">GHC.Core.Make</span></a></span><span>      </span><span class="hs-special">(</span><span class="annot"><a href="GHC.Core.Make.html#mkListExpr"><span class="hs-identifier">mkListExpr</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><a href="GHC.Core.Make.html#mkCharExpr"><span class="hs-identifier">mkCharExpr</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-66"></span><span class="hs-keyword">import</span><span> </span><span class="annot"><a href="GHC.Types.Unique.Supply.html"><span class="hs-identifier">GHC.Types.Unique.Supply</span></a></span><span>
</span><span id="line-67"></span><span class="hs-keyword">import</span><span> </span><span class="annot"><a href="GHC.Data.FastString.html"><span class="hs-identifier">GHC.Data.FastString</span></a></span><span>
</span><span id="line-68"></span><span class="hs-keyword">import</span><span> </span><span class="annot"><a href="GHC.Types.SrcLoc.html"><span class="hs-identifier">GHC.Types.SrcLoc</span></a></span><span>
</span><span id="line-69"></span><span class="hs-keyword">import</span><span> </span><span class="annot"><a href="GHC.Data.Maybe.html"><span class="hs-identifier">GHC.Data.Maybe</span></a></span><span>
</span><span id="line-70"></span><span class="hs-keyword">import</span><span> </span><span class="annot"><a href="GHC.Core.ConLike.html"><span class="hs-identifier">GHC.Core.ConLike</span></a></span><span>
</span><span id="line-71"></span><span class="hs-keyword">import</span><span> </span><span class="annot"><a href="GHC.Core.DataCon.html"><span class="hs-identifier">GHC.Core.DataCon</span></a></span><span>
</span><span id="line-72"></span><span class="hs-keyword">import</span><span> </span><span class="annot"><a href="GHC.Core.PatSyn.html"><span class="hs-identifier">GHC.Core.PatSyn</span></a></span><span>
</span><span id="line-73"></span><span class="hs-keyword">import</span><span> </span><span class="annot"><a href="GHC.Core.TyCon.html"><span class="hs-identifier">GHC.Core.TyCon</span></a></span><span>
</span><span id="line-74"></span><span class="hs-keyword">import</span><span> </span><span class="annot"><a href="GHC.Core.TyCon.RecWalk.html"><span class="hs-identifier">GHC.Core.TyCon.RecWalk</span></a></span><span>
</span><span id="line-75"></span><span class="hs-keyword">import</span><span> </span><span class="annot"><a href="GHC.Builtin.Types.html"><span class="hs-identifier">GHC.Builtin.Types</span></a></span><span>
</span><span id="line-76"></span><span class="hs-keyword">import</span><span> </span><span class="annot"><a href="GHC.Builtin.Types.Prim.html"><span class="hs-identifier">GHC.Builtin.Types.Prim</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="GHC.Builtin.Types.Prim.html#tYPETyCon"><span class="hs-identifier">tYPETyCon</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-77"></span><span class="hs-keyword">import</span><span> </span><span class="annot"><a href="GHC.Core.TyCo.Rep.html"><span class="hs-identifier">GHC.Core.TyCo.Rep</span></a></span><span>
</span><span id="line-78"></span><span class="hs-keyword">import</span><span> </span><span class="annot"><a href="GHC.Core.TyCo.Subst.html"><span class="hs-identifier">GHC.Core.TyCo.Subst</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="GHC.Core.TyCo.Subst.html#elemTCvSubst"><span class="hs-identifier">elemTCvSubst</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-79"></span><span class="hs-keyword">import</span><span> </span><span class="annot"><a href="GHC.Core.Type.html"><span class="hs-identifier">GHC.Core.Type</span></a></span><span>
</span><span id="line-80"></span><span class="hs-keyword">import</span><span> </span><span class="annot"><a href="GHC.Tc.Solver.html"><span class="hs-identifier">GHC.Tc.Solver</span></a></span><span>   </span><span class="hs-special">(</span><span class="annot"><a href="GHC.Tc.Solver.html#tcNormalise"><span class="hs-identifier">tcNormalise</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><a href="GHC.Tc.Solver.html#tcCheckGivens"><span class="hs-identifier">tcCheckGivens</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><a href="GHC.Tc.Solver.html#tcCheckWanteds"><span class="hs-identifier">tcCheckWanteds</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-81"></span><span class="hs-keyword">import</span><span> </span><span class="annot"><a href="GHC.Core.Unify.html"><span class="hs-identifier">GHC.Core.Unify</span></a></span><span>    </span><span class="hs-special">(</span><span class="annot"><a href="GHC.Core.Unify.html#tcMatchTy"><span class="hs-identifier">tcMatchTy</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-82"></span><span class="hs-keyword">import</span><span> </span><span class="annot"><a href="GHC.Core.Coercion.html"><span class="hs-identifier">GHC.Core.Coercion</span></a></span><span>
</span><span id="line-83"></span><span class="hs-keyword">import</span><span> </span><span class="annot"><a href="GHC.HsToCore.Monad.html"><span class="hs-identifier">GHC.HsToCore.Monad</span></a></span><span> </span><span class="hs-keyword">hiding</span><span> </span><span class="hs-special">(</span><span class="annot"><a href="../../base-4.16.4.0/src/Data-Foldable.html#foldlM"><span class="hs-identifier">foldlM</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-84"></span><span class="hs-keyword">import</span><span> </span><span class="annot"><a href="GHC.Tc.Instance.Family.html"><span class="hs-identifier">GHC.Tc.Instance.Family</span></a></span><span>
</span><span id="line-85"></span><span class="hs-keyword">import</span><span> </span><span class="annot"><a href="GHC.Core.FamInstEnv.html"><span class="hs-identifier">GHC.Core.FamInstEnv</span></a></span><span>
</span><span id="line-86"></span><span>
</span><span id="line-87"></span><span class="hs-keyword">import</span><span> </span><span class="annot"><a href="../../base-4.16.4.0/src/Control-Applicative.html#"><span class="hs-identifier">Control.Applicative</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="../../base-4.16.4.0/src/GHC-Base.html#%3C%7C%3E"><span class="hs-operator">(&lt;|&gt;)</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-88"></span><span class="hs-keyword">import</span><span> </span><span class="annot"><a href="../../base-4.16.4.0/src/Control-Monad.html#"><span class="hs-identifier">Control.Monad</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="../../base-4.16.4.0/src/Control-Monad.html#foldM"><span class="hs-identifier">foldM</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><a href="../../base-4.16.4.0/src/Data-Traversable.html#forM"><span class="hs-identifier">forM</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><a href="../../base-4.16.4.0/src/Control-Monad.html#guard"><span class="hs-identifier">guard</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><a href="../../base-4.16.4.0/src/GHC-Base.html#mzero"><span class="hs-identifier">mzero</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><a href="../../base-4.16.4.0/src/GHC-Base.html#when"><span class="hs-identifier">when</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><a href="../../base-4.16.4.0/src/Control-Monad.html#filterM"><span class="hs-identifier">filterM</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-89"></span><span class="hs-keyword">import</span><span> </span><span class="annot"><a href="../../transformers-0.5.6.2/src/Control-Monad-Trans-Class.html#"><span class="hs-identifier">Control.Monad.Trans.Class</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="../../transformers-0.5.6.2/src/Control-Monad-Trans-Class.html#lift"><span class="hs-identifier">lift</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-90"></span><span class="hs-keyword">import</span><span> </span><span class="annot"><a href="../../transformers-0.5.6.2/src/Control-Monad-Trans-State-Strict.html#"><span class="hs-identifier">Control.Monad.Trans.State.Strict</span></a></span><span>
</span><span id="line-91"></span><span class="hs-keyword">import</span><span> </span><span class="annot"><a href="../../base-4.16.4.0/src/Data-Coerce.html#"><span class="hs-identifier">Data.Coerce</span></a></span><span>
</span><span id="line-92"></span><span class="hs-keyword">import</span><span> </span><span class="annot"><a href="../../base-4.16.4.0/src/Data-Either.html#"><span class="hs-identifier">Data.Either</span></a></span><span>   </span><span class="hs-special">(</span><span class="annot"><a href="../../base-4.16.4.0/src/Data-Either.html#partitionEithers"><span class="hs-identifier">partitionEithers</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-93"></span><span class="hs-keyword">import</span><span> </span><span class="annot"><a href="../../base-4.16.4.0/src/Data-Foldable.html#"><span class="hs-identifier">Data.Foldable</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="../../base-4.16.4.0/src/Data-Foldable.html#foldlM"><span class="hs-identifier">foldlM</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><a href="../../base-4.16.4.0/src/Data-Foldable.html#minimumBy"><span class="hs-identifier">minimumBy</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><a href="../../base-4.16.4.0/src/Data-Foldable.html#toList"><span class="hs-identifier">toList</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-94"></span><span class="hs-keyword">import</span><span> </span><span class="annot"><a href="../../base-4.16.4.0/src/Data-Monoid.html#"><span class="hs-identifier">Data.Monoid</span></a></span><span>   </span><span class="hs-special">(</span><span class="annot"><a href="../../base-4.16.4.0/src/Data-Semigroup-Internal.html#Any"><span class="hs-identifier">Any</span></a></span><span class="hs-special">(</span><span class="hs-glyph">..</span><span class="hs-special">)</span><span class="hs-special">)</span><span>
</span><span id="line-95"></span><span class="hs-keyword">import</span><span> </span><span class="annot"><a href="../../base-4.16.4.0/src/Data-List.html#"><span class="hs-identifier">Data.List</span></a></span><span>     </span><span class="hs-special">(</span><span class="annot"><a href="../../base-4.16.4.0/src/Data-OldList.html#sortBy"><span class="hs-identifier">sortBy</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><a href="../../base-4.16.4.0/src/Data-Foldable.html#find"><span class="hs-identifier">find</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-96"></span><span class="hs-keyword">import</span><span> </span><span class="hs-keyword">qualified</span><span> </span><span class="annot"><a href="../../base-4.16.4.0/src/Data-List-NonEmpty.html#"><span class="hs-identifier">Data.List.NonEmpty</span></a></span><span> </span><span class="hs-keyword">as</span><span> </span><span class="annot"><span class="hs-identifier">NE</span></span><span>
</span><span id="line-97"></span><span class="hs-keyword">import</span><span> </span><span class="annot"><a href="../../base-4.16.4.0/src/Data-Ord.html#"><span class="hs-identifier">Data.Ord</span></a></span><span>      </span><span class="hs-special">(</span><span class="annot"><a href="../../base-4.16.4.0/src/Data-Ord.html#comparing"><span class="hs-identifier">comparing</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-98"></span><span>
</span><span id="line-99"></span><span class="hs-comment">--</span><span>
</span><span id="line-100"></span><span class="hs-comment">-- * Main exports</span><span>
</span><span id="line-101"></span><span class="hs-comment">--</span><span>
</span><span id="line-102"></span><span>
</span><span id="line-103"></span><span class="hs-comment">-- | Add a bunch of 'PhiCt's to all the 'Nabla's.</span><span>
</span><span id="line-104"></span><span class="hs-comment">-- Lifts 'addPhiCts' over many 'Nablas'.</span><span>
</span><span id="line-105"></span><span class="annot"><a href="GHC.HsToCore.Pmc.Solver.html#addPhiCtsNablas"><span class="hs-identifier hs-type">addPhiCtsNablas</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><a href="GHC.HsToCore.Pmc.Solver.Types.html#Nablas"><span class="hs-identifier hs-type">Nablas</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="GHC.HsToCore.Pmc.Solver.html#PhiCts"><span class="hs-identifier hs-type">PhiCts</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="GHC.HsToCore.Types.html#DsM"><span class="hs-identifier hs-type">DsM</span></a></span><span> </span><span class="annot"><a href="GHC.HsToCore.Pmc.Solver.Types.html#Nablas"><span class="hs-identifier hs-type">Nablas</span></a></span><span>
</span><span id="line-106"></span><span id="addPhiCtsNablas"><span class="annot"><span class="annottext">addPhiCtsNablas :: Nablas -&gt; PhiCts -&gt; DsM Nablas
</span><a href="GHC.HsToCore.Pmc.Solver.html#addPhiCtsNablas"><span class="hs-identifier hs-var hs-var">addPhiCtsNablas</span></a></span></span><span> </span><span id="local-6989586621681375183"><span class="annot"><span class="annottext">Nablas
</span><a href="#local-6989586621681375183"><span class="hs-identifier hs-var">nablas</span></a></span></span><span> </span><span id="local-6989586621681375182"><span class="annot"><span class="annottext">PhiCts
</span><a href="#local-6989586621681375182"><span class="hs-identifier hs-var">cts</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">forall (m :: * -&gt; *).
Monad m =&gt;
(Nabla -&gt; m (Maybe Nabla)) -&gt; Nablas -&gt; m Nablas
</span><a href="GHC.HsToCore.Pmc.Solver.html#liftNablasM"><span class="hs-identifier hs-var">liftNablasM</span></a></span><span> </span><span class="hs-special">(</span><span class="hs-glyph">\</span><span id="local-6989586621681375180"><span class="annot"><span class="annottext">Nabla
</span><a href="#local-6989586621681375180"><span class="hs-identifier hs-var">d</span></a></span></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="annottext">Nabla -&gt; PhiCts -&gt; IOEnv (Env DsGblEnv DsLclEnv) (Maybe Nabla)
</span><a href="GHC.HsToCore.Pmc.Solver.html#addPhiCts"><span class="hs-identifier hs-var">addPhiCts</span></a></span><span> </span><span class="annot"><span class="annottext">Nabla
</span><a href="#local-6989586621681375180"><span class="hs-identifier hs-var">d</span></a></span><span> </span><span class="annot"><span class="annottext">PhiCts
</span><a href="#local-6989586621681375182"><span class="hs-identifier hs-var">cts</span></a></span><span class="hs-special">)</span><span> </span><span class="annot"><span class="annottext">Nablas
</span><a href="#local-6989586621681375183"><span class="hs-identifier hs-var">nablas</span></a></span><span>
</span><span id="line-107"></span><span>
</span><span id="line-108"></span><span class="hs-comment">-- | 'addPmCtsNablas' for a single 'PmCt'.</span><span>
</span><span id="line-109"></span><span class="annot"><a href="GHC.HsToCore.Pmc.Solver.html#addPhiCtNablas"><span class="hs-identifier hs-type">addPhiCtNablas</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><a href="GHC.HsToCore.Pmc.Solver.Types.html#Nablas"><span class="hs-identifier hs-type">Nablas</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="GHC.HsToCore.Pmc.Solver.html#PhiCt"><span class="hs-identifier hs-type">PhiCt</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="GHC.HsToCore.Types.html#DsM"><span class="hs-identifier hs-type">DsM</span></a></span><span> </span><span class="annot"><a href="GHC.HsToCore.Pmc.Solver.Types.html#Nablas"><span class="hs-identifier hs-type">Nablas</span></a></span><span>
</span><span id="line-110"></span><span id="addPhiCtNablas"><span class="annot"><span class="annottext">addPhiCtNablas :: Nablas -&gt; PhiCt -&gt; DsM Nablas
</span><a href="GHC.HsToCore.Pmc.Solver.html#addPhiCtNablas"><span class="hs-identifier hs-var hs-var">addPhiCtNablas</span></a></span></span><span> </span><span id="local-6989586621681375178"><span class="annot"><span class="annottext">Nablas
</span><a href="#local-6989586621681375178"><span class="hs-identifier hs-var">nablas</span></a></span></span><span> </span><span id="local-6989586621681375177"><span class="annot"><span class="annottext">PhiCt
</span><a href="#local-6989586621681375177"><span class="hs-identifier hs-var">ct</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">Nablas -&gt; PhiCts -&gt; DsM Nablas
</span><a href="GHC.HsToCore.Pmc.Solver.html#addPhiCtsNablas"><span class="hs-identifier hs-var">addPhiCtsNablas</span></a></span><span> </span><span class="annot"><span class="annottext">Nablas
</span><a href="#local-6989586621681375178"><span class="hs-identifier hs-var">nablas</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">forall a. a -&gt; Bag a
</span><a href="GHC.Data.Bag.html#unitBag"><span class="hs-identifier hs-var">unitBag</span></a></span><span> </span><span class="annot"><span class="annottext">PhiCt
</span><a href="#local-6989586621681375177"><span class="hs-identifier hs-var">ct</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-111"></span><span>
</span><span id="line-112"></span><span id="local-6989586621681375858"><span class="annot"><a href="GHC.HsToCore.Pmc.Solver.html#liftNablasM"><span class="hs-identifier hs-type">liftNablasM</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><a href="../../base-4.16.4.0/src/GHC-Base.html#Monad"><span class="hs-identifier hs-type">Monad</span></a></span><span> </span><span class="annot"><a href="#local-6989586621681375858"><span class="hs-identifier hs-type">m</span></a></span><span> </span><span class="hs-glyph">=&gt;</span><span> </span><span class="hs-special">(</span><span class="annot"><a href="GHC.HsToCore.Pmc.Solver.Types.html#Nabla"><span class="hs-identifier hs-type">Nabla</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="#local-6989586621681375858"><span class="hs-identifier hs-type">m</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="../../base-4.16.4.0/src/GHC-Maybe.html#Maybe"><span class="hs-identifier hs-type">Maybe</span></a></span><span> </span><span class="annot"><a href="GHC.HsToCore.Pmc.Solver.Types.html#Nabla"><span class="hs-identifier hs-type">Nabla</span></a></span><span class="hs-special">)</span><span class="hs-special">)</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="GHC.HsToCore.Pmc.Solver.Types.html#Nablas"><span class="hs-identifier hs-type">Nablas</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="#local-6989586621681375858"><span class="hs-identifier hs-type">m</span></a></span><span> </span><span class="annot"><a href="GHC.HsToCore.Pmc.Solver.Types.html#Nablas"><span class="hs-identifier hs-type">Nablas</span></a></span></span><span>
</span><span id="line-113"></span><span id="liftNablasM"><span class="annot"><span class="annottext">liftNablasM :: forall (m :: * -&gt; *).
Monad m =&gt;
(Nabla -&gt; m (Maybe Nabla)) -&gt; Nablas -&gt; m Nablas
</span><a href="GHC.HsToCore.Pmc.Solver.html#liftNablasM"><span class="hs-identifier hs-var hs-var">liftNablasM</span></a></span></span><span> </span><span id="local-6989586621681375167"><span class="annot"><span class="annottext">Nabla -&gt; m (Maybe Nabla)
</span><a href="#local-6989586621681375167"><span class="hs-identifier hs-var">f</span></a></span></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="GHC.HsToCore.Pmc.Solver.Types.html#MkNablas"><span class="hs-identifier hs-type">MkNablas</span></a></span><span> </span><span id="local-6989586621681375165"><span class="annot"><span class="annottext">Bag Nabla
</span><a href="#local-6989586621681375165"><span class="hs-identifier hs-var">ds</span></a></span></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">Bag Nabla -&gt; Nablas
</span><a href="GHC.HsToCore.Pmc.Solver.Types.html#MkNablas"><span class="hs-identifier hs-var">MkNablas</span></a></span><span> </span><span class="annot"><span class="annottext">forall b c a. (b -&gt; c) -&gt; (a -&gt; b) -&gt; a -&gt; c
</span><a href="../../base-4.16.4.0/src/GHC-Base.html#."><span class="hs-operator hs-var">.</span></a></span><span> </span><span class="annot"><span class="annottext">forall a. Bag (Maybe a) -&gt; Bag a
</span><a href="GHC.Data.Bag.html#catBagMaybes"><span class="hs-identifier hs-var">catBagMaybes</span></a></span><span> </span><span class="annot"><span class="annottext">forall (f :: * -&gt; *) a b. Functor f =&gt; (a -&gt; b) -&gt; f a -&gt; f b
</span><a href="../../base-4.16.4.0/src/Data-Functor.html#%3C%24%3E"><span class="hs-operator hs-var">&lt;$&gt;</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">forall (t :: * -&gt; *) (f :: * -&gt; *) a b.
(Traversable t, Applicative f) =&gt;
(a -&gt; f b) -&gt; t a -&gt; f (t b)
</span><a href="../../base-4.16.4.0/src/Data-Traversable.html#traverse"><span class="hs-identifier hs-var">traverse</span></a></span><span> </span><span class="annot"><span class="annottext">Nabla -&gt; m (Maybe Nabla)
</span><a href="#local-6989586621681375167"><span class="hs-identifier hs-var">f</span></a></span><span> </span><span class="annot"><span class="annottext">Bag Nabla
</span><a href="#local-6989586621681375165"><span class="hs-identifier hs-var">ds</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-114"></span><span>
</span><span id="line-115"></span><span class="hs-comment">-- | Test if any of the 'Nabla's is inhabited. Currently this is pure, because</span><span>
</span><span id="line-116"></span><span class="hs-comment">-- we preserve the invariant that there are no uninhabited 'Nabla's. But that</span><span>
</span><span id="line-117"></span><span class="hs-comment">-- could change in the future, for example by implementing this function in</span><span>
</span><span id="line-118"></span><span class="hs-comment">-- terms of @notNull &lt;$&gt; generateInhabitingPatterns 1 ds@.</span><span>
</span><span id="line-119"></span><span class="annot"><a href="GHC.HsToCore.Pmc.Solver.html#isInhabited"><span class="hs-identifier hs-type">isInhabited</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><a href="GHC.HsToCore.Pmc.Solver.Types.html#Nablas"><span class="hs-identifier hs-type">Nablas</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="GHC.HsToCore.Types.html#DsM"><span class="hs-identifier hs-type">DsM</span></a></span><span> </span><span class="annot"><span class="hs-identifier hs-type">Bool</span></span><span>
</span><span id="line-120"></span><span id="isInhabited"><span class="annot"><span class="annottext">isInhabited :: Nablas -&gt; DsM Bool
</span><a href="GHC.HsToCore.Pmc.Solver.html#isInhabited"><span class="hs-identifier hs-var hs-var">isInhabited</span></a></span></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="GHC.HsToCore.Pmc.Solver.Types.html#MkNablas"><span class="hs-identifier hs-type">MkNablas</span></a></span><span> </span><span id="local-6989586621681375160"><span class="annot"><span class="annottext">Bag Nabla
</span><a href="#local-6989586621681375160"><span class="hs-identifier hs-var">ds</span></a></span></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">forall (f :: * -&gt; *) a. Applicative f =&gt; a -&gt; f a
</span><a href="../../base-4.16.4.0/src/GHC-Base.html#pure"><span class="hs-identifier hs-var">pure</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Bool -&gt; Bool
</span><span class="hs-identifier hs-var">not</span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">forall (t :: * -&gt; *) a. Foldable t =&gt; t a -&gt; Bool
</span><a href="../../base-4.16.4.0/src/Data-Foldable.html#null"><span class="hs-identifier hs-var">null</span></a></span><span> </span><span class="annot"><span class="annottext">Bag Nabla
</span><a href="#local-6989586621681375160"><span class="hs-identifier hs-var">ds</span></a></span><span class="hs-special">)</span><span class="hs-special">)</span><span>
</span><span id="line-121"></span><span>
</span><span id="line-122"></span><span class="hs-comment">-----------------------------------------------</span><span>
</span><span id="line-123"></span><span class="hs-comment">-- * Caching residual COMPLETE sets</span><span>
</span><span id="line-124"></span><span>
</span><span id="line-125"></span><span class="hs-comment">-- See Note [Implementation of COMPLETE pragmas]</span><span>
</span><span id="line-126"></span><span>
</span><span id="line-127"></span><span class="hs-comment">-- | Update the COMPLETE sets of 'ResidualCompleteMatches', or 'Nothing'</span><span>
</span><span id="line-128"></span><span class="hs-comment">-- if there was no change as per the update function.</span><span>
</span><span id="line-129"></span><span class="annot"><a href="GHC.HsToCore.Pmc.Solver.html#updRcm"><span class="hs-identifier hs-type">updRcm</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="hs-special">(</span><span class="annot"><a href="GHC.Types.CompleteMatch.html#CompleteMatch"><span class="hs-identifier hs-type">CompleteMatch</span></a></span><span>          </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-special">(</span><span class="annot"><span class="hs-identifier hs-type">Bool</span></span><span class="hs-special">,</span><span> </span><span class="annot"><a href="GHC.Types.CompleteMatch.html#CompleteMatch"><span class="hs-identifier hs-type">CompleteMatch</span></a></span><span class="hs-special">)</span><span class="hs-special">)</span><span>
</span><span id="line-130"></span><span>       </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="GHC.HsToCore.Pmc.Solver.Types.html#ResidualCompleteMatches"><span class="hs-identifier hs-type">ResidualCompleteMatches</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-special">(</span><span class="annot"><a href="../../base-4.16.4.0/src/GHC-Maybe.html#Maybe"><span class="hs-identifier hs-type">Maybe</span></a></span><span> </span><span class="annot"><a href="GHC.HsToCore.Pmc.Solver.Types.html#ResidualCompleteMatches"><span class="hs-identifier hs-type">ResidualCompleteMatches</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-131"></span><span id="updRcm"><span class="annot"><span class="annottext">updRcm :: (CompleteMatch -&gt; (Bool, CompleteMatch))
-&gt; ResidualCompleteMatches -&gt; Maybe ResidualCompleteMatches
</span><a href="GHC.HsToCore.Pmc.Solver.html#updRcm"><span class="hs-identifier hs-var hs-var">updRcm</span></a></span></span><span> </span><span id="local-6989586621681375156"><span class="annot"><span class="annottext">CompleteMatch -&gt; (Bool, CompleteMatch)
</span><a href="#local-6989586621681375156"><span class="hs-identifier hs-var">f</span></a></span></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="GHC.HsToCore.Pmc.Solver.Types.html#RCM"><span class="hs-identifier hs-type">RCM</span></a></span><span> </span><span id="local-6989586621681375154"><span class="annot"><span class="annottext">Maybe CompleteMatch
</span><a href="#local-6989586621681375154"><span class="hs-identifier hs-var">vanilla</span></a></span></span><span> </span><span id="local-6989586621681375153"><span class="annot"><span class="annottext">Maybe [CompleteMatch]
</span><a href="#local-6989586621681375153"><span class="hs-identifier hs-var">pragmas</span></a></span></span><span class="hs-special">)</span><span>
</span><span id="line-132"></span><span>  </span><span class="hs-glyph">|</span><span> </span><span class="annot"><span class="annottext">Bool -&gt; Bool
</span><span class="hs-identifier hs-var">not</span></span><span> </span><span class="annot"><span class="annottext">Bool
</span><a href="#local-6989586621681375152"><span class="hs-identifier hs-var">any_change</span></a></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">forall a. Maybe a
</span><a href="../../base-4.16.4.0/src/GHC-Maybe.html#Nothing"><span class="hs-identifier hs-var">Nothing</span></a></span><span>
</span><span id="line-133"></span><span>  </span><span class="hs-glyph">|</span><span> </span><span class="annot"><span class="annottext">Bool
</span><a href="../../base-4.16.4.0/src/GHC-Base.html#otherwise"><span class="hs-identifier hs-var">otherwise</span></a></span><span>      </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">forall a. a -&gt; Maybe a
</span><a href="../../base-4.16.4.0/src/GHC-Maybe.html#Just"><span class="hs-identifier hs-var">Just</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Maybe CompleteMatch
-&gt; Maybe [CompleteMatch] -&gt; ResidualCompleteMatches
</span><a href="GHC.HsToCore.Pmc.Solver.Types.html#RCM"><span class="hs-identifier hs-var">RCM</span></a></span><span> </span><span class="annot"><span class="annottext">Maybe CompleteMatch
</span><a href="#local-6989586621681375151"><span class="hs-identifier hs-var">vanilla'</span></a></span><span> </span><span class="annot"><span class="annottext">Maybe [CompleteMatch]
</span><a href="#local-6989586621681375150"><span class="hs-identifier hs-var">pragmas'</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-134"></span><span>  </span><span class="hs-keyword">where</span><span>
</span><span id="line-135"></span><span>    </span><span class="annot"><a href="#local-6989586621681375149"><span class="hs-identifier hs-type">f'</span></a></span><span> </span><span class="hs-glyph">::</span><span>  </span><span class="annot"><a href="GHC.Types.CompleteMatch.html#CompleteMatch"><span class="hs-identifier hs-type">CompleteMatch</span></a></span><span>          </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-special">(</span><span class="annot"><a href="../../base-4.16.4.0/src/Data-Semigroup-Internal.html#Any"><span class="hs-identifier hs-type">Any</span></a></span><span class="hs-special">,</span><span>  </span><span class="annot"><a href="GHC.Types.CompleteMatch.html#CompleteMatch"><span class="hs-identifier hs-type">CompleteMatch</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-136"></span><span>    </span><span id="local-6989586621681375149"><span class="annot"><span class="annottext">f' :: CompleteMatch -&gt; (Any, CompleteMatch)
</span><a href="#local-6989586621681375149"><span class="hs-identifier hs-var hs-var">f'</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">coerce :: forall a b. Coercible a b =&gt; a -&gt; b
</span><span class="hs-identifier hs-type">coerce</span></span><span> </span><span class="annot"><span class="annottext">CompleteMatch -&gt; (Bool, CompleteMatch)
</span><a href="#local-6989586621681375156"><span class="hs-identifier hs-var">f</span></a></span><span>
</span><span id="line-137"></span><span>    </span><span class="hs-special">(</span><span id="local-6989586621681375148"><span class="annot"><span class="annottext">Any
</span><a href="#local-6989586621681375148"><span class="hs-identifier hs-var">chgd</span></a></span></span><span class="hs-special">,</span><span> </span><span id="local-6989586621681375151"><span class="annot"><span class="annottext">Maybe CompleteMatch
</span><a href="#local-6989586621681375151"><span class="hs-identifier hs-var">vanilla'</span></a></span></span><span class="hs-special">)</span><span>  </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">forall (t :: * -&gt; *) (f :: * -&gt; *) a b.
(Traversable t, Applicative f) =&gt;
(a -&gt; f b) -&gt; t a -&gt; f (t b)
</span><a href="../../base-4.16.4.0/src/Data-Traversable.html#traverse"><span class="hs-identifier hs-var">traverse</span></a></span><span> </span><span class="annot"><span class="annottext">CompleteMatch -&gt; (Any, CompleteMatch)
</span><a href="#local-6989586621681375149"><span class="hs-identifier hs-var">f'</span></a></span><span> </span><span class="annot"><span class="annottext">Maybe CompleteMatch
</span><a href="#local-6989586621681375154"><span class="hs-identifier hs-var">vanilla</span></a></span><span>
</span><span id="line-138"></span><span>    </span><span class="hs-special">(</span><span id="local-6989586621681375147"><span class="annot"><span class="annottext">Any
</span><a href="#local-6989586621681375147"><span class="hs-identifier hs-var">chgds</span></a></span></span><span class="hs-special">,</span><span> </span><span id="local-6989586621681375150"><span class="annot"><span class="annottext">Maybe [CompleteMatch]
</span><a href="#local-6989586621681375150"><span class="hs-identifier hs-var">pragmas'</span></a></span></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">forall (t :: * -&gt; *) (f :: * -&gt; *) a b.
(Traversable t, Applicative f) =&gt;
(a -&gt; f b) -&gt; t a -&gt; f (t b)
</span><a href="../../base-4.16.4.0/src/Data-Traversable.html#traverse"><span class="hs-identifier hs-var">traverse</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">forall (t :: * -&gt; *) (f :: * -&gt; *) a b.
(Traversable t, Applicative f) =&gt;
(a -&gt; f b) -&gt; t a -&gt; f (t b)
</span><a href="../../base-4.16.4.0/src/Data-Traversable.html#traverse"><span class="hs-identifier hs-var">traverse</span></a></span><span> </span><span class="annot"><span class="annottext">CompleteMatch -&gt; (Any, CompleteMatch)
</span><a href="#local-6989586621681375149"><span class="hs-identifier hs-var">f'</span></a></span><span class="hs-special">)</span><span> </span><span class="annot"><span class="annottext">Maybe [CompleteMatch]
</span><a href="#local-6989586621681375153"><span class="hs-identifier hs-var">pragmas</span></a></span><span>
</span><span id="line-139"></span><span>    </span><span id="local-6989586621681375152"><span class="annot"><span class="annottext">any_change :: Bool
</span><a href="#local-6989586621681375152"><span class="hs-identifier hs-var hs-var">any_change</span></a></span></span><span>        </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">Any -&gt; Bool
</span><a href="../../base-4.16.4.0/src/Data-Semigroup-Internal.html#getAny"><span class="hs-identifier hs-var">getAny</span></a></span><span> </span><span class="annot"><span class="annottext">forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><a href="../../base-4.16.4.0/src/GHC-Base.html#%24"><span class="hs-operator hs-var">$</span></a></span><span> </span><span class="annot"><span class="annottext">Any
</span><a href="#local-6989586621681375148"><span class="hs-identifier hs-var">chgd</span></a></span><span> </span><span class="annot"><span class="annottext">forall a. Monoid a =&gt; a -&gt; a -&gt; a
</span><a href="../../base-4.16.4.0/src/GHC-Base.html#mappend"><span class="hs-operator hs-var">`mappend`</span></a></span><span> </span><span class="annot"><span class="annottext">Any
</span><a href="#local-6989586621681375147"><span class="hs-identifier hs-var">chgds</span></a></span><span>
</span><span id="line-140"></span><span>
</span><span id="line-141"></span><span class="hs-comment">-- | A pseudo-'CompleteMatch' for the vanilla complete set of the given data</span><span>
</span><span id="line-142"></span><span class="hs-comment">-- 'TyCon'.</span><span>
</span><span id="line-143"></span><span class="hs-comment">-- Ex.: @vanillaCompleteMatchTC 'Maybe' ==&gt; Just (&quot;Maybe&quot;, {'Just','Nothing'})@</span><span>
</span><span id="line-144"></span><span class="annot"><a href="GHC.HsToCore.Pmc.Solver.html#vanillaCompleteMatchTC"><span class="hs-identifier hs-type">vanillaCompleteMatchTC</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><a href="GHC.Core.TyCon.html#TyCon"><span class="hs-identifier hs-type">TyCon</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="../../base-4.16.4.0/src/GHC-Maybe.html#Maybe"><span class="hs-identifier hs-type">Maybe</span></a></span><span> </span><span class="annot"><a href="GHC.Types.CompleteMatch.html#CompleteMatch"><span class="hs-identifier hs-type">CompleteMatch</span></a></span><span>
</span><span id="line-145"></span><span id="vanillaCompleteMatchTC"><span class="annot"><span class="annottext">vanillaCompleteMatchTC :: TyCon -&gt; Maybe CompleteMatch
</span><a href="GHC.HsToCore.Pmc.Solver.html#vanillaCompleteMatchTC"><span class="hs-identifier hs-var hs-var">vanillaCompleteMatchTC</span></a></span></span><span> </span><span id="local-6989586621681375144"><span class="annot"><span class="annottext">TyCon
</span><a href="#local-6989586621681375144"><span class="hs-identifier hs-var">tc</span></a></span></span><span> </span><span class="hs-glyph">=</span><span>
</span><span id="line-146"></span><span>  </span><span class="hs-keyword">let</span><span> </span><span class="hs-comment">-- | TYPE acts like an empty data type on the term-level (#14086), but</span><span>
</span><span id="line-147"></span><span>      </span><span class="hs-comment">-- it is a PrimTyCon, so tyConDataCons_maybe returns Nothing. Hence a</span><span>
</span><span id="line-148"></span><span>      </span><span class="hs-comment">-- special case.</span><span>
</span><span id="line-149"></span><span>      </span><span id="local-6989586621681375143"><span class="annot"><span class="annottext">mb_dcs :: Maybe [DataCon]
</span><a href="#local-6989586621681375143"><span class="hs-identifier hs-var hs-var">mb_dcs</span></a></span></span><span> </span><span class="hs-glyph">|</span><span> </span><span class="annot"><span class="annottext">TyCon
</span><a href="#local-6989586621681375144"><span class="hs-identifier hs-var">tc</span></a></span><span> </span><span class="annot"><span class="annottext">forall a. Eq a =&gt; a -&gt; a -&gt; Bool
</span><span class="hs-operator hs-var">==</span></span><span> </span><span class="annot"><span class="annottext">TyCon
</span><a href="GHC.Builtin.Types.Prim.html#tYPETyCon"><span class="hs-identifier hs-var">tYPETyCon</span></a></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">forall a. a -&gt; Maybe a
</span><a href="../../base-4.16.4.0/src/GHC-Maybe.html#Just"><span class="hs-identifier hs-var">Just</span></a></span><span> </span><span class="hs-special">[</span><span class="hs-special">]</span><span>
</span><span id="line-150"></span><span>             </span><span class="hs-glyph">|</span><span> </span><span class="annot"><span class="annottext">Bool
</span><a href="../../base-4.16.4.0/src/GHC-Base.html#otherwise"><span class="hs-identifier hs-var">otherwise</span></a></span><span>       </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">TyCon -&gt; Maybe [DataCon]
</span><a href="GHC.Core.TyCon.html#tyConDataCons_maybe"><span class="hs-identifier hs-var">tyConDataCons_maybe</span></a></span><span> </span><span class="annot"><span class="annottext">TyCon
</span><a href="#local-6989586621681375144"><span class="hs-identifier hs-var">tc</span></a></span><span>
</span><span id="line-151"></span><span>  </span><span class="hs-keyword">in</span><span> </span><span class="annot"><span class="annottext">UniqDSet ConLike -&gt; CompleteMatch
</span><a href="GHC.Types.CompleteMatch.html#vanillaCompleteMatch"><span class="hs-identifier hs-var">vanillaCompleteMatch</span></a></span><span> </span><span class="annot"><span class="annottext">forall b c a. (b -&gt; c) -&gt; (a -&gt; b) -&gt; a -&gt; c
</span><a href="../../base-4.16.4.0/src/GHC-Base.html#."><span class="hs-operator hs-var">.</span></a></span><span> </span><span class="annot"><span class="annottext">forall a. Uniquable a =&gt; [a] -&gt; UniqDSet a
</span><a href="GHC.Types.Unique.DSet.html#mkUniqDSet"><span class="hs-identifier hs-var">mkUniqDSet</span></a></span><span> </span><span class="annot"><span class="annottext">forall b c a. (b -&gt; c) -&gt; (a -&gt; b) -&gt; a -&gt; c
</span><a href="../../base-4.16.4.0/src/GHC-Base.html#."><span class="hs-operator hs-var">.</span></a></span><span> </span><span class="annot"><span class="annottext">forall a b. (a -&gt; b) -&gt; [a] -&gt; [b]
</span><a href="../../base-4.16.4.0/src/GHC-Base.html#map"><span class="hs-identifier hs-var">map</span></a></span><span> </span><span class="annot"><span class="annottext">DataCon -&gt; ConLike
</span><a href="GHC.Core.ConLike.html#RealDataCon"><span class="hs-identifier hs-var">RealDataCon</span></a></span><span> </span><span class="annot"><span class="annottext">forall (f :: * -&gt; *) a b. Functor f =&gt; (a -&gt; b) -&gt; f a -&gt; f b
</span><a href="../../base-4.16.4.0/src/Data-Functor.html#%3C%24%3E"><span class="hs-operator hs-var">&lt;$&gt;</span></a></span><span> </span><span class="annot"><span class="annottext">Maybe [DataCon]
</span><a href="#local-6989586621681375143"><span class="hs-identifier hs-var">mb_dcs</span></a></span><span>
</span><span id="line-152"></span><span>
</span><span id="line-153"></span><span class="hs-comment">-- | Initialise from 'dsGetCompleteMatches' (containing all COMPLETE pragmas)</span><span>
</span><span id="line-154"></span><span class="hs-comment">-- if the given 'ResidualCompleteMatches' were empty.</span><span>
</span><span id="line-155"></span><span class="annot"><a href="GHC.HsToCore.Pmc.Solver.html#addCompleteMatches"><span class="hs-identifier hs-type">addCompleteMatches</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><a href="GHC.HsToCore.Pmc.Solver.Types.html#ResidualCompleteMatches"><span class="hs-identifier hs-type">ResidualCompleteMatches</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="GHC.HsToCore.Types.html#DsM"><span class="hs-identifier hs-type">DsM</span></a></span><span> </span><span class="annot"><a href="GHC.HsToCore.Pmc.Solver.Types.html#ResidualCompleteMatches"><span class="hs-identifier hs-type">ResidualCompleteMatches</span></a></span><span>
</span><span id="line-156"></span><span id="addCompleteMatches"><span class="annot"><span class="annottext">addCompleteMatches :: ResidualCompleteMatches -&gt; DsM ResidualCompleteMatches
</span><a href="GHC.HsToCore.Pmc.Solver.html#addCompleteMatches"><span class="hs-identifier hs-var hs-var">addCompleteMatches</span></a></span></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="GHC.HsToCore.Pmc.Solver.Types.html#RCM"><span class="hs-identifier hs-type">RCM</span></a></span><span> </span><span id="local-6989586621681375137"><span class="annot"><span class="annottext">Maybe CompleteMatch
</span><a href="#local-6989586621681375137"><span class="hs-identifier hs-var">v</span></a></span></span><span> </span><span class="annot"><span class="annottext">Maybe [CompleteMatch]
</span><a href="../../base-4.16.4.0/src/GHC-Maybe.html#Nothing"><span class="hs-identifier hs-var">Nothing</span></a></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">Maybe CompleteMatch
-&gt; Maybe [CompleteMatch] -&gt; ResidualCompleteMatches
</span><a href="GHC.HsToCore.Pmc.Solver.Types.html#RCM"><span class="hs-identifier hs-var">RCM</span></a></span><span> </span><span class="annot"><span class="annottext">Maybe CompleteMatch
</span><a href="#local-6989586621681375137"><span class="hs-identifier hs-var">v</span></a></span><span> </span><span class="annot"><span class="annottext">forall b c a. (b -&gt; c) -&gt; (a -&gt; b) -&gt; a -&gt; c
</span><a href="../../base-4.16.4.0/src/GHC-Base.html#."><span class="hs-operator hs-var">.</span></a></span><span> </span><span class="annot"><span class="annottext">forall a. a -&gt; Maybe a
</span><a href="../../base-4.16.4.0/src/GHC-Maybe.html#Just"><span class="hs-identifier hs-var">Just</span></a></span><span> </span><span class="annot"><span class="annottext">forall (f :: * -&gt; *) a b. Functor f =&gt; (a -&gt; b) -&gt; f a -&gt; f b
</span><a href="../../base-4.16.4.0/src/Data-Functor.html#%3C%24%3E"><span class="hs-operator hs-var">&lt;$&gt;</span></a></span><span> </span><span class="annot"><span class="annottext">DsM [CompleteMatch]
</span><a href="GHC.HsToCore.Monad.html#dsGetCompleteMatches"><span class="hs-identifier hs-var">dsGetCompleteMatches</span></a></span><span>
</span><span id="line-157"></span><span class="annot"><a href="GHC.HsToCore.Pmc.Solver.html#addCompleteMatches"><span class="hs-identifier hs-var">addCompleteMatches</span></a></span><span> </span><span id="local-6989586621681375135"><span class="annot"><span class="annottext">ResidualCompleteMatches
</span><a href="#local-6989586621681375135"><span class="hs-identifier hs-var">rcm</span></a></span></span><span>             </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">forall (f :: * -&gt; *) a. Applicative f =&gt; a -&gt; f a
</span><a href="../../base-4.16.4.0/src/GHC-Base.html#pure"><span class="hs-identifier hs-var">pure</span></a></span><span> </span><span class="annot"><span class="annottext">ResidualCompleteMatches
</span><a href="#local-6989586621681375135"><span class="hs-identifier hs-var">rcm</span></a></span><span>
</span><span id="line-158"></span><span>
</span><span id="line-159"></span><span class="hs-comment">-- | Adds the declared 'CompleteMatches' from COMPLETE pragmas, as well as the</span><span>
</span><span id="line-160"></span><span class="hs-comment">-- vanilla data defn if it is a 'DataCon'.</span><span>
</span><span id="line-161"></span><span class="annot"><a href="GHC.HsToCore.Pmc.Solver.html#addConLikeMatches"><span class="hs-identifier hs-type">addConLikeMatches</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><a href="GHC.Core.ConLike.html#ConLike"><span class="hs-identifier hs-type">ConLike</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="GHC.HsToCore.Pmc.Solver.Types.html#ResidualCompleteMatches"><span class="hs-identifier hs-type">ResidualCompleteMatches</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="GHC.HsToCore.Types.html#DsM"><span class="hs-identifier hs-type">DsM</span></a></span><span> </span><span class="annot"><a href="GHC.HsToCore.Pmc.Solver.Types.html#ResidualCompleteMatches"><span class="hs-identifier hs-type">ResidualCompleteMatches</span></a></span><span>
</span><span id="line-162"></span><span id="addConLikeMatches"><span class="annot"><span class="annottext">addConLikeMatches :: ConLike -&gt; ResidualCompleteMatches -&gt; DsM ResidualCompleteMatches
</span><a href="GHC.HsToCore.Pmc.Solver.html#addConLikeMatches"><span class="hs-identifier hs-var hs-var">addConLikeMatches</span></a></span></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="GHC.Core.ConLike.html#RealDataCon"><span class="hs-identifier hs-type">RealDataCon</span></a></span><span> </span><span id="local-6989586621681375133"><span class="annot"><span class="annottext">DataCon
</span><a href="#local-6989586621681375133"><span class="hs-identifier hs-var">dc</span></a></span></span><span class="hs-special">)</span><span> </span><span id="local-6989586621681375132"><span class="annot"><span class="annottext">ResidualCompleteMatches
</span><a href="#local-6989586621681375132"><span class="hs-identifier hs-var">rcm</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">TyCon -&gt; ResidualCompleteMatches -&gt; DsM ResidualCompleteMatches
</span><a href="GHC.HsToCore.Pmc.Solver.html#addTyConMatches"><span class="hs-identifier hs-var">addTyConMatches</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">DataCon -&gt; TyCon
</span><a href="GHC.Core.DataCon.html#dataConTyCon"><span class="hs-identifier hs-var">dataConTyCon</span></a></span><span> </span><span class="annot"><span class="annottext">DataCon
</span><a href="#local-6989586621681375133"><span class="hs-identifier hs-var">dc</span></a></span><span class="hs-special">)</span><span> </span><span class="annot"><span class="annottext">ResidualCompleteMatches
</span><a href="#local-6989586621681375132"><span class="hs-identifier hs-var">rcm</span></a></span><span>
</span><span id="line-163"></span><span class="annot"><a href="GHC.HsToCore.Pmc.Solver.html#addConLikeMatches"><span class="hs-identifier hs-var">addConLikeMatches</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="GHC.Core.ConLike.html#PatSynCon"><span class="hs-identifier hs-type">PatSynCon</span></a></span><span> </span><span class="annot"><span class="annottext">PatSyn
</span><span class="hs-identifier">_</span></span><span class="hs-special">)</span><span>    </span><span id="local-6989586621681375128"><span class="annot"><span class="annottext">ResidualCompleteMatches
</span><a href="#local-6989586621681375128"><span class="hs-identifier hs-var">rcm</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">ResidualCompleteMatches -&gt; DsM ResidualCompleteMatches
</span><a href="GHC.HsToCore.Pmc.Solver.html#addCompleteMatches"><span class="hs-identifier hs-var">addCompleteMatches</span></a></span><span> </span><span class="annot"><span class="annottext">ResidualCompleteMatches
</span><a href="#local-6989586621681375128"><span class="hs-identifier hs-var">rcm</span></a></span><span>
</span><span id="line-164"></span><span>
</span><span id="line-165"></span><span class="hs-comment">-- | Adds</span><span>
</span><span id="line-166"></span><span class="hs-comment">--    * the 'CompleteMatches' from COMPLETE pragmas</span><span>
</span><span id="line-167"></span><span class="hs-comment">--    * and the /vanilla/ 'CompleteMatch' from the data 'TyCon'</span><span>
</span><span id="line-168"></span><span class="hs-comment">-- to the 'ResidualCompleteMatches', if not already present.</span><span>
</span><span id="line-169"></span><span class="annot"><a href="GHC.HsToCore.Pmc.Solver.html#addTyConMatches"><span class="hs-identifier hs-type">addTyConMatches</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><a href="GHC.Core.TyCon.html#TyCon"><span class="hs-identifier hs-type">TyCon</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="GHC.HsToCore.Pmc.Solver.Types.html#ResidualCompleteMatches"><span class="hs-identifier hs-type">ResidualCompleteMatches</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="GHC.HsToCore.Types.html#DsM"><span class="hs-identifier hs-type">DsM</span></a></span><span> </span><span class="annot"><a href="GHC.HsToCore.Pmc.Solver.Types.html#ResidualCompleteMatches"><span class="hs-identifier hs-type">ResidualCompleteMatches</span></a></span><span>
</span><span id="line-170"></span><span id="addTyConMatches"><span class="annot"><span class="annottext">addTyConMatches :: TyCon -&gt; ResidualCompleteMatches -&gt; DsM ResidualCompleteMatches
</span><a href="GHC.HsToCore.Pmc.Solver.html#addTyConMatches"><span class="hs-identifier hs-var hs-var">addTyConMatches</span></a></span></span><span> </span><span id="local-6989586621681375127"><span class="annot"><span class="annottext">TyCon
</span><a href="#local-6989586621681375127"><span class="hs-identifier hs-var">tc</span></a></span></span><span> </span><span id="local-6989586621681375126"><span class="annot"><span class="annottext">ResidualCompleteMatches
</span><a href="#local-6989586621681375126"><span class="hs-identifier hs-var">rcm</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">ResidualCompleteMatches -&gt; ResidualCompleteMatches
</span><a href="#local-6989586621681375125"><span class="hs-identifier hs-var">add_tc_match</span></a></span><span> </span><span class="annot"><span class="annottext">forall (f :: * -&gt; *) a b. Functor f =&gt; (a -&gt; b) -&gt; f a -&gt; f b
</span><a href="../../base-4.16.4.0/src/Data-Functor.html#%3C%24%3E"><span class="hs-operator hs-var">&lt;$&gt;</span></a></span><span> </span><span class="annot"><span class="annottext">ResidualCompleteMatches -&gt; DsM ResidualCompleteMatches
</span><a href="GHC.HsToCore.Pmc.Solver.html#addCompleteMatches"><span class="hs-identifier hs-var">addCompleteMatches</span></a></span><span> </span><span class="annot"><span class="annottext">ResidualCompleteMatches
</span><a href="#local-6989586621681375126"><span class="hs-identifier hs-var">rcm</span></a></span><span>
</span><span id="line-171"></span><span>  </span><span class="hs-keyword">where</span><span>
</span><span id="line-172"></span><span>    </span><span class="hs-comment">-- | Add the vanilla COMPLETE set from the data defn, if any. But only if</span><span>
</span><span id="line-173"></span><span>    </span><span class="hs-comment">-- it's not already present.</span><span>
</span><span id="line-174"></span><span>    </span><span id="local-6989586621681375125"><span class="annot"><span class="annottext">add_tc_match :: ResidualCompleteMatches -&gt; ResidualCompleteMatches
</span><a href="#local-6989586621681375125"><span class="hs-identifier hs-var hs-var">add_tc_match</span></a></span></span><span> </span><span id="local-6989586621681375124"><span class="annot"><span class="annottext">ResidualCompleteMatches
</span><a href="#local-6989586621681375124"><span class="hs-identifier hs-var">rcm</span></a></span></span><span>
</span><span id="line-175"></span><span>      </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">ResidualCompleteMatches
</span><a href="#local-6989586621681375124"><span class="hs-identifier hs-var">rcm</span></a></span><span class="hs-special">{</span><span class="annot"><span class="annottext">rcm_vanilla :: Maybe CompleteMatch
</span><a href="GHC.HsToCore.Pmc.Solver.Types.html#rcm_vanilla"><span class="hs-identifier hs-var">rcm_vanilla</span></a></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">ResidualCompleteMatches -&gt; Maybe CompleteMatch
</span><a href="GHC.HsToCore.Pmc.Solver.Types.html#rcm_vanilla"><span class="hs-identifier hs-var">rcm_vanilla</span></a></span><span> </span><span class="annot"><span class="annottext">ResidualCompleteMatches
</span><a href="#local-6989586621681375124"><span class="hs-identifier hs-var">rcm</span></a></span><span> </span><span class="annot"><span class="annottext">forall (f :: * -&gt; *) a. Alternative f =&gt; f a -&gt; f a -&gt; f a
</span><a href="../../base-4.16.4.0/src/GHC-Base.html#%3C%7C%3E"><span class="hs-operator hs-var">&lt;|&gt;</span></a></span><span> </span><span class="annot"><span class="annottext">TyCon -&gt; Maybe CompleteMatch
</span><a href="GHC.HsToCore.Pmc.Solver.html#vanillaCompleteMatchTC"><span class="hs-identifier hs-var">vanillaCompleteMatchTC</span></a></span><span> </span><span class="annot"><span class="annottext">TyCon
</span><a href="#local-6989586621681375127"><span class="hs-identifier hs-var">tc</span></a></span><span class="hs-special">}</span><span>
</span><span id="line-176"></span><span>
</span><span id="line-177"></span><span class="annot"><a href="GHC.HsToCore.Pmc.Solver.html#markMatched"><span class="hs-identifier hs-type">markMatched</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><a href="GHC.HsToCore.Pmc.Solver.Types.html#PmAltCon"><span class="hs-identifier hs-type">PmAltCon</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="GHC.HsToCore.Pmc.Solver.Types.html#ResidualCompleteMatches"><span class="hs-identifier hs-type">ResidualCompleteMatches</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="GHC.HsToCore.Types.html#DsM"><span class="hs-identifier hs-type">DsM</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="../../base-4.16.4.0/src/GHC-Maybe.html#Maybe"><span class="hs-identifier hs-type">Maybe</span></a></span><span> </span><span class="annot"><a href="GHC.HsToCore.Pmc.Solver.Types.html#ResidualCompleteMatches"><span class="hs-identifier hs-type">ResidualCompleteMatches</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-178"></span><span class="hs-comment">-- Nothing means the PmAltCon didn't occur in any COMPLETE set.</span><span>
</span><span id="line-179"></span><span class="hs-comment">-- See Note [Shortcutting the inhabitation test] for how this is useful for</span><span>
</span><span id="line-180"></span><span class="hs-comment">-- performance on T17836.</span><span>
</span><span id="line-181"></span><span id="markMatched"><span class="annot"><span class="annottext">markMatched :: PmAltCon
-&gt; ResidualCompleteMatches -&gt; DsM (Maybe ResidualCompleteMatches)
</span><a href="GHC.HsToCore.Pmc.Solver.html#markMatched"><span class="hs-identifier hs-var hs-var">markMatched</span></a></span></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="GHC.HsToCore.Pmc.Solver.Types.html#PmAltLit"><span class="hs-identifier hs-type">PmAltLit</span></a></span><span> </span><span class="annot"><span class="annottext">PmLit
</span><span class="hs-identifier">_</span></span><span class="hs-special">)</span><span>      </span><span class="annot"><span class="annottext">ResidualCompleteMatches
</span><span class="hs-identifier">_</span></span><span>   </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">forall (f :: * -&gt; *) a. Applicative f =&gt; a -&gt; f a
</span><a href="../../base-4.16.4.0/src/GHC-Base.html#pure"><span class="hs-identifier hs-var">pure</span></a></span><span> </span><span class="annot"><span class="annottext">forall a. Maybe a
</span><a href="../../base-4.16.4.0/src/GHC-Maybe.html#Nothing"><span class="hs-identifier hs-var">Nothing</span></a></span><span> </span><span class="hs-comment">-- lits are never part of a COMPLETE set</span><span>
</span><span id="line-182"></span><span class="annot"><a href="GHC.HsToCore.Pmc.Solver.html#markMatched"><span class="hs-identifier hs-var">markMatched</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="GHC.HsToCore.Pmc.Solver.Types.html#PmAltConLike"><span class="hs-identifier hs-type">PmAltConLike</span></a></span><span> </span><span id="local-6989586621681375119"><span class="annot"><span class="annottext">ConLike
</span><a href="#local-6989586621681375119"><span class="hs-identifier hs-var">cl</span></a></span></span><span class="hs-special">)</span><span> </span><span id="local-6989586621681375118"><span class="annot"><span class="annottext">ResidualCompleteMatches
</span><a href="#local-6989586621681375118"><span class="hs-identifier hs-var">rcm</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-keyword">do</span><span>
</span><span id="line-183"></span><span>  </span><span id="local-6989586621681375117"><span class="annot"><span class="annottext">ResidualCompleteMatches
</span><a href="#local-6989586621681375117"><span class="hs-identifier hs-var">rcm'</span></a></span></span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">ConLike -&gt; ResidualCompleteMatches -&gt; DsM ResidualCompleteMatches
</span><a href="GHC.HsToCore.Pmc.Solver.html#addConLikeMatches"><span class="hs-identifier hs-var">addConLikeMatches</span></a></span><span> </span><span class="annot"><span class="annottext">ConLike
</span><a href="#local-6989586621681375119"><span class="hs-identifier hs-var">cl</span></a></span><span> </span><span class="annot"><span class="annottext">ResidualCompleteMatches
</span><a href="#local-6989586621681375118"><span class="hs-identifier hs-var">rcm</span></a></span><span>
</span><span id="line-184"></span><span>  </span><span class="hs-keyword">let</span><span> </span><span id="local-6989586621681375116"><span class="annot"><span class="annottext">go :: CompleteMatch -&gt; (Bool, CompleteMatch)
</span><a href="#local-6989586621681375116"><span class="hs-identifier hs-var hs-var">go</span></a></span></span><span> </span><span id="local-6989586621681375115"><span class="annot"><span class="annottext">CompleteMatch
</span><a href="#local-6989586621681375115"><span class="hs-identifier hs-var">cm</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-keyword">case</span><span> </span><span class="annot"><span class="annottext">forall a. Uniquable a =&gt; UniqDSet a -&gt; a -&gt; Maybe a
</span><a href="GHC.Types.Unique.DSet.html#lookupUniqDSet"><span class="hs-identifier hs-var">lookupUniqDSet</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">CompleteMatch -&gt; UniqDSet ConLike
</span><a href="GHC.Types.CompleteMatch.html#cmConLikes"><span class="hs-identifier hs-var">cmConLikes</span></a></span><span> </span><span class="annot"><span class="annottext">CompleteMatch
</span><a href="#local-6989586621681375115"><span class="hs-identifier hs-var">cm</span></a></span><span class="hs-special">)</span><span> </span><span class="annot"><span class="annottext">ConLike
</span><a href="#local-6989586621681375119"><span class="hs-identifier hs-var">cl</span></a></span><span> </span><span class="hs-keyword">of</span><span>
</span><span id="line-185"></span><span>        </span><span class="annot"><span class="annottext">Maybe ConLike
</span><a href="../../base-4.16.4.0/src/GHC-Maybe.html#Nothing"><span class="hs-identifier hs-var">Nothing</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Bool
</span><span class="hs-identifier hs-var">False</span></span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">CompleteMatch
</span><a href="#local-6989586621681375115"><span class="hs-identifier hs-var">cm</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-186"></span><span>        </span><span class="annot"><a href="../../base-4.16.4.0/src/GHC-Maybe.html#Just"><span class="hs-identifier hs-type">Just</span></a></span><span> </span><span class="annot"><span class="annottext">ConLike
</span><span class="hs-identifier">_</span></span><span>  </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Bool
</span><span class="hs-identifier hs-var">True</span></span><span class="hs-special">,</span><span>  </span><span class="annot"><span class="annottext">CompleteMatch
</span><a href="#local-6989586621681375115"><span class="hs-identifier hs-var">cm</span></a></span><span> </span><span class="hs-special">{</span><span> </span><span class="annot"><span class="annottext">cmConLikes :: UniqDSet ConLike
</span><a href="GHC.Types.CompleteMatch.html#cmConLikes"><span class="hs-identifier hs-var">cmConLikes</span></a></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">forall a. Uniquable a =&gt; UniqDSet a -&gt; a -&gt; UniqDSet a
</span><a href="GHC.Types.Unique.DSet.html#delOneFromUniqDSet"><span class="hs-identifier hs-var">delOneFromUniqDSet</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">CompleteMatch -&gt; UniqDSet ConLike
</span><a href="GHC.Types.CompleteMatch.html#cmConLikes"><span class="hs-identifier hs-var">cmConLikes</span></a></span><span> </span><span class="annot"><span class="annottext">CompleteMatch
</span><a href="#local-6989586621681375115"><span class="hs-identifier hs-var">cm</span></a></span><span class="hs-special">)</span><span> </span><span class="annot"><span class="annottext">ConLike
</span><a href="#local-6989586621681375119"><span class="hs-identifier hs-var">cl</span></a></span><span> </span><span class="hs-special">}</span><span class="hs-special">)</span><span>
</span><span id="line-187"></span><span>  </span><span class="annot"><span class="annottext">forall (f :: * -&gt; *) a. Applicative f =&gt; a -&gt; f a
</span><a href="../../base-4.16.4.0/src/GHC-Base.html#pure"><span class="hs-identifier hs-var">pure</span></a></span><span> </span><span class="annot"><span class="annottext">forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><a href="../../base-4.16.4.0/src/GHC-Base.html#%24"><span class="hs-operator hs-var">$</span></a></span><span> </span><span class="annot"><span class="annottext">(CompleteMatch -&gt; (Bool, CompleteMatch))
-&gt; ResidualCompleteMatches -&gt; Maybe ResidualCompleteMatches
</span><a href="GHC.HsToCore.Pmc.Solver.html#updRcm"><span class="hs-identifier hs-var">updRcm</span></a></span><span> </span><span class="annot"><span class="annottext">CompleteMatch -&gt; (Bool, CompleteMatch)
</span><a href="#local-6989586621681375116"><span class="hs-identifier hs-var">go</span></a></span><span> </span><span class="annot"><span class="annottext">ResidualCompleteMatches
</span><a href="#local-6989586621681375117"><span class="hs-identifier hs-var">rcm'</span></a></span><span>
</span><span id="line-188"></span><span>
</span><span id="line-189"></span><span class="hs-comment">{-
Note [Implementation of COMPLETE pragmas]
~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~
A COMPLETE set represents a set of conlikes (i.e., constructors or
pattern synonyms) such that if they are all pattern-matched against in a
function, it gives rise to a total function. An example is:

  newtype Boolean = Boolean Int
  pattern F, T :: Boolean
  pattern F = Boolean 0
  pattern T = Boolean 1
  {-# COMPLETE F, T #-}

  -- This is a total function
  booleanToInt :: Boolean -&gt; Int
  booleanToInt F = 0
  booleanToInt T = 1

COMPLETE sets are represented internally in GHC as a set of 'ConLike's. For
example, the pragma {-# COMPLETE F, T #-} would be represented as:

  CompleteMatch {F, T} Nothing

What is the Maybe for? Answer: COMPLETE pragmas may optionally specify a
result *type constructor* (cf. T14422):

  class C f where
    foo :: f a -&gt; ()
  pattern P :: C f =&gt; f a
  pattern P &lt;- (foo -&gt; ())

  instance C State where
    foo _ = ()
  {-# COMPLETE P :: State #-}

  f :: State a -&gt; ()
  f P = ()
  g :: C f =&gt; f a -&gt; ()
  g P = ()

The @:: State@ here means that the types at which the COMPLETE pragma *applies*
is restricted to scrutinee types that are applications of the 'State' TyCon. So
it applies to the match in @f@ but not in @g@ above, resulting in a warning for
the latter but not for the former. The pragma is represented as

  CompleteMatch {P} (Just State)

GHC collects all COMPLETE pragmas from the current module and from imports
into a field in the DsM environment, which can be accessed with
dsGetCompleteMatches from &quot;GHC.HsToCore.Monad&quot;.
Currently, COMPLETE pragmas can't be orphans (e.g. at least one ConLike must
also be defined in the module of the pragma) and do not impact recompilation
checking (#18675).

The pattern-match checker will then initialise each variable's 'VarInfo' with
*all* imported COMPLETE sets (in 'GHC.HsToCore.Pmc.Solver.addCompleteMatches'),
well-typed or not, into a 'ResidualCompleteMatches'. The trick is that a
COMPLETE set that is ill-typed for that match variable could never be written by
the user! And we make sure not to report any ill-typed COMPLETE sets when
formatting 'Nabla's for warnings in 'generateInhabitingPatterns'.

A 'ResidualCompleteMatches' is a list of all COMPLETE sets, minus the ConLikes
we know a particular variable can't be (through negative constructor constraints
@x /~ K@ or a failed attempt at instantiating that ConLike during inhabitation
testing). If *any* of the COMPLETE sets become empty, we know that the match
was exhaustive.

We assume that a COMPLETE set does not apply if for one of its
ConLikes we fail to 'matchConLikeResTy' or the
type of the match variable isn't an application of the optional
result type constructor from the pragma. Why don't we simply
prune inapplicable COMPLETE sets from 'ResidualCompleteMatches'?
The answer is that additional type constraints might make more
COMPLETE sets applicable! Example:

  h :: a -&gt; a :~: Boolean -&gt; ()
  h x Refl | T &lt;- x = ()
           | F &lt;- x = ()

If we eagerly prune {F,T} from the residual matches of @x@, then we don't see
that the match in the guards of @h@ is exhaustive, where the COMPLETE set
applies due to refined type information.
-}</span><span>
</span><span id="line-272"></span><span>
</span><span id="line-273"></span><span class="hs-comment">-----------------------</span><span>
</span><span id="line-274"></span><span class="hs-comment">-- * Type normalisation</span><span>
</span><span id="line-275"></span><span>
</span><span id="line-276"></span><span class="hs-comment">-- | The return value of 'pmTopNormaliseType'</span><span>
</span><span id="line-277"></span><span class="hs-keyword">data</span><span> </span><span id="TopNormaliseTypeResult"><span class="annot"><a href="GHC.HsToCore.Pmc.Solver.html#TopNormaliseTypeResult"><span class="hs-identifier hs-var">TopNormaliseTypeResult</span></a></span></span><span>
</span><span id="line-278"></span><span>  </span><span class="hs-glyph">=</span><span> </span><span id="NormalisedByConstraints"><span class="annot"><a href="GHC.HsToCore.Pmc.Solver.html#NormalisedByConstraints"><span class="hs-identifier hs-var">NormalisedByConstraints</span></a></span></span><span> </span><span class="annot"><a href="GHC.Core.TyCo.Rep.html#Type"><span class="hs-identifier hs-type">Type</span></a></span><span>
</span><span id="line-279"></span><span>  </span><span class="hs-comment">-- ^ 'tcNormalise' was able to simplify the type with some local constraint</span><span>
</span><span id="line-280"></span><span>  </span><span class="hs-comment">-- from the type oracle, but 'topNormaliseTypeX' couldn't identify a type</span><span>
</span><span id="line-281"></span><span>  </span><span class="hs-comment">-- redex.</span><span>
</span><span id="line-282"></span><span>  </span><span class="hs-glyph">|</span><span> </span><span id="HadRedexes"><span class="annot"><a href="GHC.HsToCore.Pmc.Solver.html#HadRedexes"><span class="hs-identifier hs-var">HadRedexes</span></a></span></span><span> </span><span class="annot"><a href="GHC.Core.TyCo.Rep.html#Type"><span class="hs-identifier hs-type">Type</span></a></span><span> </span><span class="hs-special">[</span><span class="hs-special">(</span><span class="annot"><a href="GHC.Core.TyCo.Rep.html#Type"><span class="hs-identifier hs-type">Type</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><a href="GHC.Core.DataCon.html#DataCon"><span class="hs-identifier hs-type">DataCon</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><a href="GHC.Core.TyCo.Rep.html#Type"><span class="hs-identifier hs-type">Type</span></a></span><span class="hs-special">)</span><span class="hs-special">]</span><span> </span><span class="annot"><a href="GHC.Core.TyCo.Rep.html#Type"><span class="hs-identifier hs-type">Type</span></a></span><span>
</span><span id="line-283"></span><span>  </span><span class="hs-comment">-- ^ 'tcNormalise' may or may not been able to simplify the type, but</span><span>
</span><span id="line-284"></span><span>  </span><span class="hs-comment">-- 'topNormaliseTypeX' made progress either way and got rid of at least one</span><span>
</span><span id="line-285"></span><span>  </span><span class="hs-comment">-- outermost type or data family redex or newtype.</span><span>
</span><span id="line-286"></span><span>  </span><span class="hs-comment">-- The first field is the last type that was reduced solely through type</span><span>
</span><span id="line-287"></span><span>  </span><span class="hs-comment">-- family applications (possibly just the 'tcNormalise'd type). This is the</span><span>
</span><span id="line-288"></span><span>  </span><span class="hs-comment">-- one that is equal (in source Haskell) to the initial type.</span><span>
</span><span id="line-289"></span><span>  </span><span class="hs-comment">-- The third field is the type that we get when also looking through data</span><span>
</span><span id="line-290"></span><span>  </span><span class="hs-comment">-- family applications and newtypes. This would be the representation type in</span><span>
</span><span id="line-291"></span><span>  </span><span class="hs-comment">-- Core (modulo casts).</span><span>
</span><span id="line-292"></span><span>  </span><span class="hs-comment">-- The second field is the list of Newtype 'DataCon's that we looked through</span><span>
</span><span id="line-293"></span><span>  </span><span class="hs-comment">-- in the chain of reduction steps between the Source type and the Core type.</span><span>
</span><span id="line-294"></span><span>  </span><span class="hs-comment">-- We also keep the type of the DataCon application and its field, so that we</span><span>
</span><span id="line-295"></span><span>  </span><span class="hs-comment">-- don't have to reconstruct it in 'inhabitationCandidates' and</span><span>
</span><span id="line-296"></span><span>  </span><span class="hs-comment">-- 'generateInhabitingPatterns'.</span><span>
</span><span id="line-297"></span><span>  </span><span class="hs-comment">-- For an example, see Note [Type normalisation].</span><span>
</span><span id="line-298"></span><span>
</span><span id="line-299"></span><span class="hs-comment">-- | Return the fields of 'HadRedexes'. Returns appropriate defaults in the</span><span>
</span><span id="line-300"></span><span class="hs-comment">-- other cases.</span><span>
</span><span id="line-301"></span><span class="annot"><a href="GHC.HsToCore.Pmc.Solver.html#tntrGuts"><span class="hs-identifier hs-type">tntrGuts</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><a href="GHC.HsToCore.Pmc.Solver.html#TopNormaliseTypeResult"><span class="hs-identifier hs-type">TopNormaliseTypeResult</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-special">(</span><span class="annot"><a href="GHC.Core.TyCo.Rep.html#Type"><span class="hs-identifier hs-type">Type</span></a></span><span class="hs-special">,</span><span> </span><span class="hs-special">[</span><span class="hs-special">(</span><span class="annot"><a href="GHC.Core.TyCo.Rep.html#Type"><span class="hs-identifier hs-type">Type</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><a href="GHC.Core.DataCon.html#DataCon"><span class="hs-identifier hs-type">DataCon</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><a href="GHC.Core.TyCo.Rep.html#Type"><span class="hs-identifier hs-type">Type</span></a></span><span class="hs-special">)</span><span class="hs-special">]</span><span class="hs-special">,</span><span> </span><span class="annot"><a href="GHC.Core.TyCo.Rep.html#Type"><span class="hs-identifier hs-type">Type</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-302"></span><span id="tntrGuts"><span class="annot"><span class="annottext">tntrGuts :: TopNormaliseTypeResult -&gt; (Type, [(Type, DataCon, Type)], Type)
</span><a href="GHC.HsToCore.Pmc.Solver.html#tntrGuts"><span class="hs-identifier hs-var hs-var">tntrGuts</span></a></span></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="GHC.HsToCore.Pmc.Solver.html#NormalisedByConstraints"><span class="hs-identifier hs-type">NormalisedByConstraints</span></a></span><span> </span><span id="local-6989586621681375108"><span class="annot"><span class="annottext">Type
</span><a href="#local-6989586621681375108"><span class="hs-identifier hs-var">ty</span></a></span></span><span class="hs-special">)</span><span>   </span><span class="hs-glyph">=</span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Type
</span><a href="#local-6989586621681375108"><span class="hs-identifier hs-var">ty</span></a></span><span class="hs-special">,</span><span>     </span><span class="hs-special">[</span><span class="hs-special">]</span><span class="hs-special">,</span><span>      </span><span class="annot"><span class="annottext">Type
</span><a href="#local-6989586621681375108"><span class="hs-identifier hs-var">ty</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-303"></span><span class="annot"><a href="GHC.HsToCore.Pmc.Solver.html#tntrGuts"><span class="hs-identifier hs-var">tntrGuts</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="GHC.HsToCore.Pmc.Solver.html#HadRedexes"><span class="hs-identifier hs-type">HadRedexes</span></a></span><span> </span><span id="local-6989586621681375107"><span class="annot"><span class="annottext">Type
</span><a href="#local-6989586621681375107"><span class="hs-identifier hs-var">src_ty</span></a></span></span><span> </span><span id="local-6989586621681375106"><span class="annot"><span class="annottext">[(Type, DataCon, Type)]
</span><a href="#local-6989586621681375106"><span class="hs-identifier hs-var">ds</span></a></span></span><span> </span><span id="local-6989586621681375105"><span class="annot"><span class="annottext">Type
</span><a href="#local-6989586621681375105"><span class="hs-identifier hs-var">core_ty</span></a></span></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Type
</span><a href="#local-6989586621681375107"><span class="hs-identifier hs-var">src_ty</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">[(Type, DataCon, Type)]
</span><a href="#local-6989586621681375106"><span class="hs-identifier hs-var">ds</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">Type
</span><a href="#local-6989586621681375105"><span class="hs-identifier hs-var">core_ty</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-304"></span><span>
</span><span id="line-305"></span><span class="hs-keyword">instance</span><span> </span><span class="annot"><a href="GHC.Utils.Outputable.html#Outputable"><span class="hs-identifier hs-type">Outputable</span></a></span><span> </span><span class="annot"><a href="GHC.HsToCore.Pmc.Solver.html#TopNormaliseTypeResult"><span class="hs-identifier hs-type">TopNormaliseTypeResult</span></a></span><span> </span><span class="hs-keyword">where</span><span>
</span><span id="line-306"></span><span>  </span><span id="local-6989586621681375093"><span class="annot"><span class="annottext">ppr :: TopNormaliseTypeResult -&gt; SDoc
</span><a href="GHC.Utils.Outputable.html#ppr"><span class="hs-identifier hs-var hs-var hs-var hs-var">ppr</span></a></span></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="GHC.HsToCore.Pmc.Solver.html#NormalisedByConstraints"><span class="hs-identifier hs-type">NormalisedByConstraints</span></a></span><span> </span><span id="local-6989586621681375091"><span class="annot"><span class="annottext">Type
</span><a href="#local-6989586621681375091"><span class="hs-identifier hs-var">ty</span></a></span></span><span class="hs-special">)</span><span>   </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">String -&gt; SDoc
</span><a href="GHC.Utils.Outputable.html#text"><span class="hs-identifier hs-var">text</span></a></span><span> </span><span class="annot"><span class="annottext">String
</span><span class="hs-string">&quot;NormalisedByConstraints&quot;</span></span><span> </span><span class="annot"><span class="annottext">SDoc -&gt; SDoc -&gt; SDoc
</span><a href="GHC.Utils.Outputable.html#%3C%2B%3E"><span class="hs-operator hs-var">&lt;+&gt;</span></a></span><span> </span><span class="annot"><span class="annottext">forall a. Outputable a =&gt; a -&gt; SDoc
</span><a href="GHC.Utils.Outputable.html#ppr"><span class="hs-identifier hs-var">ppr</span></a></span><span> </span><span class="annot"><span class="annottext">Type
</span><a href="#local-6989586621681375091"><span class="hs-identifier hs-var">ty</span></a></span><span>
</span><span id="line-307"></span><span>  </span><span class="annot"><a href="GHC.Utils.Outputable.html#ppr"><span class="hs-identifier hs-var">ppr</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="GHC.HsToCore.Pmc.Solver.html#HadRedexes"><span class="hs-identifier hs-type">HadRedexes</span></a></span><span> </span><span id="local-6989586621681375088"><span class="annot"><span class="annottext">Type
</span><a href="#local-6989586621681375088"><span class="hs-identifier hs-var">src_ty</span></a></span></span><span> </span><span id="local-6989586621681375087"><span class="annot"><span class="annottext">[(Type, DataCon, Type)]
</span><a href="#local-6989586621681375087"><span class="hs-identifier hs-var">ds</span></a></span></span><span> </span><span id="local-6989586621681375086"><span class="annot"><span class="annottext">Type
</span><a href="#local-6989586621681375086"><span class="hs-identifier hs-var">core_ty</span></a></span></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">String -&gt; SDoc
</span><a href="GHC.Utils.Outputable.html#text"><span class="hs-identifier hs-var">text</span></a></span><span> </span><span class="annot"><span class="annottext">String
</span><span class="hs-string">&quot;HadRedexes&quot;</span></span><span> </span><span class="annot"><span class="annottext">SDoc -&gt; SDoc -&gt; SDoc
</span><a href="GHC.Utils.Outputable.html#%3C%2B%3E"><span class="hs-operator hs-var">&lt;+&gt;</span></a></span><span> </span><span class="annot"><span class="annottext">SDoc -&gt; SDoc
</span><a href="GHC.Utils.Outputable.html#braces"><span class="hs-identifier hs-var">braces</span></a></span><span> </span><span class="annot"><span class="annottext">SDoc
</span><a href="#local-6989586621681375084"><span class="hs-identifier hs-var">fields</span></a></span><span>
</span><span id="line-308"></span><span>    </span><span class="hs-keyword">where</span><span>
</span><span id="line-309"></span><span>      </span><span id="local-6989586621681375084"><span class="annot"><span class="annottext">fields :: SDoc
</span><a href="#local-6989586621681375084"><span class="hs-identifier hs-var hs-var">fields</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">[SDoc] -&gt; SDoc
</span><a href="GHC.Utils.Outputable.html#fsep"><span class="hs-identifier hs-var">fsep</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">SDoc -&gt; [SDoc] -&gt; [SDoc]
</span><a href="GHC.Utils.Outputable.html#punctuate"><span class="hs-identifier hs-var">punctuate</span></a></span><span> </span><span class="annot"><span class="annottext">SDoc
</span><a href="GHC.Utils.Outputable.html#comma"><span class="hs-identifier hs-var">comma</span></a></span><span> </span><span class="hs-special">[</span><span> </span><span class="annot"><span class="annottext">String -&gt; SDoc
</span><a href="GHC.Utils.Outputable.html#text"><span class="hs-identifier hs-var">text</span></a></span><span> </span><span class="annot"><span class="annottext">String
</span><span class="hs-string">&quot;src_ty =&quot;</span></span><span> </span><span class="annot"><span class="annottext">SDoc -&gt; SDoc -&gt; SDoc
</span><a href="GHC.Utils.Outputable.html#%3C%2B%3E"><span class="hs-operator hs-var">&lt;+&gt;</span></a></span><span> </span><span class="annot"><span class="annottext">forall a. Outputable a =&gt; a -&gt; SDoc
</span><a href="GHC.Utils.Outputable.html#ppr"><span class="hs-identifier hs-var">ppr</span></a></span><span> </span><span class="annot"><span class="annottext">Type
</span><a href="#local-6989586621681375088"><span class="hs-identifier hs-var">src_ty</span></a></span><span>
</span><span id="line-310"></span><span>                                     </span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">String -&gt; SDoc
</span><a href="GHC.Utils.Outputable.html#text"><span class="hs-identifier hs-var">text</span></a></span><span> </span><span class="annot"><span class="annottext">String
</span><span class="hs-string">&quot;newtype_dcs =&quot;</span></span><span> </span><span class="annot"><span class="annottext">SDoc -&gt; SDoc -&gt; SDoc
</span><a href="GHC.Utils.Outputable.html#%3C%2B%3E"><span class="hs-operator hs-var">&lt;+&gt;</span></a></span><span> </span><span class="annot"><span class="annottext">forall a. Outputable a =&gt; a -&gt; SDoc
</span><a href="GHC.Utils.Outputable.html#ppr"><span class="hs-identifier hs-var">ppr</span></a></span><span> </span><span class="annot"><span class="annottext">[(Type, DataCon, Type)]
</span><a href="#local-6989586621681375087"><span class="hs-identifier hs-var">ds</span></a></span><span>
</span><span id="line-311"></span><span>                                     </span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">String -&gt; SDoc
</span><a href="GHC.Utils.Outputable.html#text"><span class="hs-identifier hs-var">text</span></a></span><span> </span><span class="annot"><span class="annottext">String
</span><span class="hs-string">&quot;core_ty =&quot;</span></span><span> </span><span class="annot"><span class="annottext">SDoc -&gt; SDoc -&gt; SDoc
</span><a href="GHC.Utils.Outputable.html#%3C%2B%3E"><span class="hs-operator hs-var">&lt;+&gt;</span></a></span><span> </span><span class="annot"><span class="annottext">forall a. Outputable a =&gt; a -&gt; SDoc
</span><a href="GHC.Utils.Outputable.html#ppr"><span class="hs-identifier hs-var">ppr</span></a></span><span> </span><span class="annot"><span class="annottext">Type
</span><a href="#local-6989586621681375086"><span class="hs-identifier hs-var">core_ty</span></a></span><span> </span><span class="hs-special">]</span><span class="hs-special">)</span><span>
</span><span id="line-312"></span><span>
</span><span id="line-313"></span><span class="annot"><a href="GHC.HsToCore.Pmc.Solver.html#pmTopNormaliseType"><span class="hs-identifier hs-type">pmTopNormaliseType</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><a href="GHC.HsToCore.Pmc.Solver.Types.html#TyState"><span class="hs-identifier hs-type">TyState</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="GHC.Core.TyCo.Rep.html#Type"><span class="hs-identifier hs-type">Type</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="GHC.HsToCore.Types.html#DsM"><span class="hs-identifier hs-type">DsM</span></a></span><span> </span><span class="annot"><a href="GHC.HsToCore.Pmc.Solver.html#TopNormaliseTypeResult"><span class="hs-identifier hs-type">TopNormaliseTypeResult</span></a></span><span>
</span><span id="line-314"></span><span class="hs-comment">-- ^ Get rid of *outermost* (or toplevel)</span><span>
</span><span id="line-315"></span><span class="hs-comment">--      * type function redex</span><span>
</span><span id="line-316"></span><span class="hs-comment">--      * data family redex</span><span>
</span><span id="line-317"></span><span class="hs-comment">--      * newtypes</span><span>
</span><span id="line-318"></span><span class="hs-comment">--</span><span>
</span><span id="line-319"></span><span class="hs-comment">-- Behaves like `topNormaliseType_maybe`, but instead of returning a</span><span>
</span><span id="line-320"></span><span class="hs-comment">-- coercion, it returns useful information for issuing pattern matching</span><span>
</span><span id="line-321"></span><span class="hs-comment">-- warnings. See Note [Type normalisation] for details.</span><span>
</span><span id="line-322"></span><span class="hs-comment">-- It also initially 'tcNormalise's the type with the bag of local constraints.</span><span>
</span><span id="line-323"></span><span class="hs-comment">--</span><span>
</span><span id="line-324"></span><span class="hs-comment">-- See 'TopNormaliseTypeResult' for the meaning of the return value.</span><span>
</span><span id="line-325"></span><span class="hs-comment">--</span><span>
</span><span id="line-326"></span><span class="hs-comment">-- NB: Normalisation can potentially change kinds, if the head of the type</span><span>
</span><span id="line-327"></span><span class="hs-comment">-- is a type family with a variable result kind. I (Richard E) can't think</span><span>
</span><span id="line-328"></span><span class="hs-comment">-- of a way to cause trouble here, though.</span><span>
</span><span id="line-329"></span><span id="pmTopNormaliseType"><span class="annot"><span class="annottext">pmTopNormaliseType :: TyState -&gt; Type -&gt; DsM TopNormaliseTypeResult
</span><a href="GHC.HsToCore.Pmc.Solver.html#pmTopNormaliseType"><span class="hs-identifier hs-var hs-var">pmTopNormaliseType</span></a></span></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="GHC.HsToCore.Pmc.Solver.Types.html#TySt"><span class="hs-identifier hs-type">TySt</span></a></span><span> </span><span class="annot"><span class="annottext">Int
</span><span class="hs-identifier">_</span></span><span> </span><span id="local-6989586621681375078"><span class="annot"><span class="annottext">InertSet
</span><a href="#local-6989586621681375078"><span class="hs-identifier hs-var">inert</span></a></span></span><span class="hs-special">)</span><span> </span><span id="local-6989586621681375077"><span class="annot"><span class="annottext">Type
</span><a href="#local-6989586621681375077"><span class="hs-identifier hs-var">typ</span></a></span></span><span>
</span><span id="line-330"></span><span>  </span><span class="hs-glyph">=</span><span> </span><span class="hs-keyword">do</span><span> </span><span id="local-6989586621681375076"><span class="annot"><span class="annottext">FamInstEnvs
</span><a href="#local-6989586621681375076"><span class="hs-identifier hs-var">env</span></a></span></span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">DsM FamInstEnvs
</span><a href="GHC.HsToCore.Monad.html#dsGetFamInstEnvs"><span class="hs-identifier hs-var">dsGetFamInstEnvs</span></a></span><span>
</span><span id="line-331"></span><span>       </span><span class="annot"><span class="annottext">String -&gt; SDoc -&gt; DsM ()
</span><a href="GHC.HsToCore.Pmc.Utils.html#tracePm"><span class="hs-identifier hs-var">tracePm</span></a></span><span> </span><span class="annot"><span class="annottext">String
</span><span class="hs-string">&quot;normalise&quot;</span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">forall a. Outputable a =&gt; a -&gt; SDoc
</span><a href="GHC.Utils.Outputable.html#ppr"><span class="hs-identifier hs-var">ppr</span></a></span><span> </span><span class="annot"><span class="annottext">Type
</span><a href="#local-6989586621681375077"><span class="hs-identifier hs-var">typ</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-332"></span><span>       </span><span class="hs-comment">-- Before proceeding, we chuck typ into the constraint solver, in case</span><span>
</span><span id="line-333"></span><span>       </span><span class="hs-comment">-- solving for given equalities may reduce typ some. See</span><span>
</span><span id="line-334"></span><span>       </span><span class="hs-comment">-- &quot;Wrinkle: local equalities&quot; in Note [Type normalisation].</span><span>
</span><span id="line-335"></span><span>       </span><span id="local-6989586621681375074"><span class="annot"><span class="annottext">Type
</span><a href="#local-6989586621681375074"><span class="hs-identifier hs-var">typ'</span></a></span></span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">forall a. TcM a -&gt; DsM a
</span><a href="GHC.HsToCore.Monad.html#initTcDsForSolver"><span class="hs-identifier hs-var">initTcDsForSolver</span></a></span><span> </span><span class="annot"><span class="annottext">forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><a href="../../base-4.16.4.0/src/GHC-Base.html#%24"><span class="hs-operator hs-var">$</span></a></span><span> </span><span class="annot"><span class="annottext">InertSet -&gt; Type -&gt; TcM Type
</span><a href="GHC.Tc.Solver.html#tcNormalise"><span class="hs-identifier hs-var">tcNormalise</span></a></span><span> </span><span class="annot"><span class="annottext">InertSet
</span><a href="#local-6989586621681375078"><span class="hs-identifier hs-var">inert</span></a></span><span> </span><span class="annot"><span class="annottext">Type
</span><a href="#local-6989586621681375077"><span class="hs-identifier hs-var">typ</span></a></span><span>
</span><span id="line-336"></span><span>       </span><span class="hs-comment">-- Now we look with topNormaliseTypeX through type and data family</span><span>
</span><span id="line-337"></span><span>       </span><span class="hs-comment">-- applications and newtypes, which tcNormalise does not do.</span><span>
</span><span id="line-338"></span><span>       </span><span class="hs-comment">-- See also 'TopNormaliseTypeResult'.</span><span>
</span><span id="line-339"></span><span>       </span><span class="annot"><span class="annottext">forall (f :: * -&gt; *) a. Applicative f =&gt; a -&gt; f a
</span><a href="../../base-4.16.4.0/src/GHC-Base.html#pure"><span class="hs-identifier hs-var">pure</span></a></span><span> </span><span class="annot"><span class="annottext">forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><a href="../../base-4.16.4.0/src/GHC-Base.html#%24"><span class="hs-operator hs-var">$</span></a></span><span> </span><span class="hs-keyword">case</span><span> </span><span class="annot"><span class="annottext">forall ev.
NormaliseStepper ev -&gt; (ev -&gt; ev -&gt; ev) -&gt; Type -&gt; Maybe (ev, Type)
</span><a href="GHC.Core.Coercion.html#topNormaliseTypeX"><span class="hs-identifier hs-var">topNormaliseTypeX</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">FamInstEnvs
-&gt; NormaliseStepper
     (ThetaType -&gt; ThetaType,
      [(Type, DataCon, Type)] -&gt; [(Type, DataCon, Type)])
</span><a href="#local-6989586621681375071"><span class="hs-identifier hs-var">stepper</span></a></span><span> </span><span class="annot"><span class="annottext">FamInstEnvs
</span><a href="#local-6989586621681375076"><span class="hs-identifier hs-var">env</span></a></span><span class="hs-special">)</span><span> </span><span class="annot"><span class="annottext">forall {b} {c} {b} {c} {a} {a}.
(b -&gt; c, b -&gt; c) -&gt; (a -&gt; b, a -&gt; b) -&gt; (a -&gt; c, a -&gt; c)
</span><a href="#local-6989586621681375070"><span class="hs-identifier hs-var">comb</span></a></span><span> </span><span class="annot"><span class="annottext">Type
</span><a href="#local-6989586621681375074"><span class="hs-identifier hs-var">typ'</span></a></span><span> </span><span class="hs-keyword">of</span><span>
</span><span id="line-340"></span><span>         </span><span class="annot"><span class="annottext">Maybe
  ((ThetaType -&gt; ThetaType,
    [(Type, DataCon, Type)] -&gt; [(Type, DataCon, Type)]),
   Type)
</span><a href="../../base-4.16.4.0/src/GHC-Maybe.html#Nothing"><span class="hs-identifier hs-var">Nothing</span></a></span><span>                </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="annottext">Type -&gt; TopNormaliseTypeResult
</span><a href="GHC.HsToCore.Pmc.Solver.html#NormalisedByConstraints"><span class="hs-identifier hs-var">NormalisedByConstraints</span></a></span><span> </span><span class="annot"><span class="annottext">Type
</span><a href="#local-6989586621681375074"><span class="hs-identifier hs-var">typ'</span></a></span><span>
</span><span id="line-341"></span><span>         </span><span class="annot"><a href="../../base-4.16.4.0/src/GHC-Maybe.html#Just"><span class="hs-identifier hs-type">Just</span></a></span><span> </span><span class="hs-special">(</span><span class="hs-special">(</span><span id="local-6989586621681375069"><span class="annot"><span class="annottext">ThetaType -&gt; ThetaType
</span><a href="#local-6989586621681375069"><span class="hs-identifier hs-var">ty_f</span></a></span></span><span class="hs-special">,</span><span id="local-6989586621681375068"><span class="annot"><span class="annottext">[(Type, DataCon, Type)] -&gt; [(Type, DataCon, Type)]
</span><a href="#local-6989586621681375068"><span class="hs-identifier hs-var">tm_f</span></a></span></span><span class="hs-special">)</span><span class="hs-special">,</span><span> </span><span id="local-6989586621681375067"><span class="annot"><span class="annottext">Type
</span><a href="#local-6989586621681375067"><span class="hs-identifier hs-var">ty</span></a></span></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="annottext">Type -&gt; [(Type, DataCon, Type)] -&gt; Type -&gt; TopNormaliseTypeResult
</span><a href="GHC.HsToCore.Pmc.Solver.html#HadRedexes"><span class="hs-identifier hs-var">HadRedexes</span></a></span><span> </span><span class="annot"><span class="annottext">Type
</span><a href="#local-6989586621681375066"><span class="hs-identifier hs-var">src_ty</span></a></span><span> </span><span class="annot"><span class="annottext">[(Type, DataCon, Type)]
</span><a href="#local-6989586621681375065"><span class="hs-identifier hs-var">newtype_dcs</span></a></span><span> </span><span class="annot"><span class="annottext">Type
</span><a href="#local-6989586621681375064"><span class="hs-identifier hs-var">core_ty</span></a></span><span>
</span><span id="line-342"></span><span>           </span><span class="hs-keyword">where</span><span>
</span><span id="line-343"></span><span>             </span><span id="local-6989586621681375066"><span class="annot"><span class="annottext">src_ty :: Type
</span><a href="#local-6989586621681375066"><span class="hs-identifier hs-var hs-var">src_ty</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">Type -&gt; ThetaType -&gt; Type
</span><a href="#local-6989586621681375063"><span class="hs-identifier hs-var">eq_src_ty</span></a></span><span> </span><span class="annot"><span class="annottext">Type
</span><a href="#local-6989586621681375067"><span class="hs-identifier hs-var">ty</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Type
</span><a href="#local-6989586621681375074"><span class="hs-identifier hs-var">typ'</span></a></span><span> </span><span class="annot"><span class="annottext">forall a. a -&gt; [a] -&gt; [a]
</span><span class="hs-glyph hs-var">:</span></span><span> </span><span class="annot"><span class="annottext">ThetaType -&gt; ThetaType
</span><a href="#local-6989586621681375069"><span class="hs-identifier hs-var">ty_f</span></a></span><span> </span><span class="hs-special">[</span><span class="annot"><span class="annottext">Type
</span><a href="#local-6989586621681375067"><span class="hs-identifier hs-var">ty</span></a></span><span class="hs-special">]</span><span class="hs-special">)</span><span>
</span><span id="line-344"></span><span>             </span><span id="local-6989586621681375065"><span class="annot"><span class="annottext">newtype_dcs :: [(Type, DataCon, Type)]
</span><a href="#local-6989586621681375065"><span class="hs-identifier hs-var hs-var">newtype_dcs</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">[(Type, DataCon, Type)] -&gt; [(Type, DataCon, Type)]
</span><a href="#local-6989586621681375068"><span class="hs-identifier hs-var">tm_f</span></a></span><span> </span><span class="hs-special">[</span><span class="hs-special">]</span><span>
</span><span id="line-345"></span><span>             </span><span id="local-6989586621681375064"><span class="annot"><span class="annottext">core_ty :: Type
</span><a href="#local-6989586621681375064"><span class="hs-identifier hs-var hs-var">core_ty</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">Type
</span><a href="#local-6989586621681375067"><span class="hs-identifier hs-var">ty</span></a></span><span>
</span><span id="line-346"></span><span>  </span><span class="hs-keyword">where</span><span>
</span><span id="line-347"></span><span>    </span><span class="hs-comment">-- Find the first type in the sequence of rewrites that is a data type,</span><span>
</span><span id="line-348"></span><span>    </span><span class="hs-comment">-- newtype, or a data family application (not the representation tycon!).</span><span>
</span><span id="line-349"></span><span>    </span><span class="hs-comment">-- This is the one that is equal (in source Haskell) to the initial type.</span><span>
</span><span id="line-350"></span><span>    </span><span class="hs-comment">-- If none is found in the list, then all of them are type family</span><span>
</span><span id="line-351"></span><span>    </span><span class="hs-comment">-- applications, so we simply return the last one, which is the *simplest*.</span><span>
</span><span id="line-352"></span><span>    </span><span class="annot"><a href="#local-6989586621681375063"><span class="hs-identifier hs-type">eq_src_ty</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><a href="GHC.Core.TyCo.Rep.html#Type"><span class="hs-identifier hs-type">Type</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-special">[</span><span class="annot"><a href="GHC.Core.TyCo.Rep.html#Type"><span class="hs-identifier hs-type">Type</span></a></span><span class="hs-special">]</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="GHC.Core.TyCo.Rep.html#Type"><span class="hs-identifier hs-type">Type</span></a></span><span>
</span><span id="line-353"></span><span>    </span><span id="local-6989586621681375063"><span class="annot"><span class="annottext">eq_src_ty :: Type -&gt; ThetaType -&gt; Type
</span><a href="#local-6989586621681375063"><span class="hs-identifier hs-var hs-var">eq_src_ty</span></a></span></span><span> </span><span id="local-6989586621681375062"><span class="annot"><span class="annottext">Type
</span><a href="#local-6989586621681375062"><span class="hs-identifier hs-var">ty</span></a></span></span><span> </span><span id="local-6989586621681375061"><span class="annot"><span class="annottext">ThetaType
</span><a href="#local-6989586621681375061"><span class="hs-identifier hs-var">tys</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">forall b a. b -&gt; (a -&gt; b) -&gt; Maybe a -&gt; b
</span><a href="../../base-4.16.4.0/src/Data-Maybe.html#maybe"><span class="hs-identifier hs-var">maybe</span></a></span><span> </span><span class="annot"><span class="annottext">Type
</span><a href="#local-6989586621681375062"><span class="hs-identifier hs-var">ty</span></a></span><span> </span><span class="annot"><span class="annottext">forall a. a -&gt; a
</span><a href="../../base-4.16.4.0/src/GHC-Base.html#id"><span class="hs-identifier hs-var">id</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">forall (t :: * -&gt; *) a. Foldable t =&gt; (a -&gt; Bool) -&gt; t a -&gt; Maybe a
</span><a href="../../base-4.16.4.0/src/Data-Foldable.html#find"><span class="hs-identifier hs-var">find</span></a></span><span> </span><span class="annot"><span class="annottext">Type -&gt; Bool
</span><a href="#local-6989586621681375058"><span class="hs-identifier hs-var">is_closed_or_data_family</span></a></span><span> </span><span class="annot"><span class="annottext">ThetaType
</span><a href="#local-6989586621681375061"><span class="hs-identifier hs-var">tys</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-354"></span><span>
</span><span id="line-355"></span><span>    </span><span class="annot"><a href="#local-6989586621681375058"><span class="hs-identifier hs-type">is_closed_or_data_family</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><a href="GHC.Core.TyCo.Rep.html#Type"><span class="hs-identifier hs-type">Type</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="hs-identifier hs-type">Bool</span></span><span>
</span><span id="line-356"></span><span>    </span><span id="local-6989586621681375058"><span class="annot"><span class="annottext">is_closed_or_data_family :: Type -&gt; Bool
</span><a href="#local-6989586621681375058"><span class="hs-identifier hs-var hs-var">is_closed_or_data_family</span></a></span></span><span> </span><span id="local-6989586621681375057"><span class="annot"><span class="annottext">Type
</span><a href="#local-6989586621681375057"><span class="hs-identifier hs-var">ty</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">Type -&gt; Bool
</span><a href="GHC.HsToCore.Pmc.Solver.html#pmIsClosedType"><span class="hs-identifier hs-var">pmIsClosedType</span></a></span><span> </span><span class="annot"><span class="annottext">Type
</span><a href="#local-6989586621681375057"><span class="hs-identifier hs-var">ty</span></a></span><span> </span><span class="annot"><span class="annottext">Bool -&gt; Bool -&gt; Bool
</span><span class="hs-operator hs-var">||</span></span><span> </span><span class="annot"><span class="annottext">Type -&gt; Bool
</span><a href="GHC.Core.Type.html#isDataFamilyAppType"><span class="hs-identifier hs-var">isDataFamilyAppType</span></a></span><span> </span><span class="annot"><span class="annottext">Type
</span><a href="#local-6989586621681375057"><span class="hs-identifier hs-var">ty</span></a></span><span>
</span><span id="line-357"></span><span>
</span><span id="line-358"></span><span>    </span><span class="hs-comment">-- For efficiency, represent both lists as difference lists.</span><span>
</span><span id="line-359"></span><span>    </span><span class="hs-comment">-- comb performs the concatenation, for both lists.</span><span>
</span><span id="line-360"></span><span>    </span><span id="local-6989586621681375070"><span class="annot"><span class="annottext">comb :: (b -&gt; c, b -&gt; c) -&gt; (a -&gt; b, a -&gt; b) -&gt; (a -&gt; c, a -&gt; c)
</span><a href="#local-6989586621681375070"><span class="hs-identifier hs-var hs-var">comb</span></a></span></span><span> </span><span class="hs-special">(</span><span id="local-6989586621681375053"><span class="annot"><span class="annottext">b -&gt; c
</span><a href="#local-6989586621681375053"><span class="hs-identifier hs-var">tyf1</span></a></span></span><span class="hs-special">,</span><span> </span><span id="local-6989586621681375052"><span class="annot"><span class="annottext">b -&gt; c
</span><a href="#local-6989586621681375052"><span class="hs-identifier hs-var">tmf1</span></a></span></span><span class="hs-special">)</span><span> </span><span class="hs-special">(</span><span id="local-6989586621681375051"><span class="annot"><span class="annottext">a -&gt; b
</span><a href="#local-6989586621681375051"><span class="hs-identifier hs-var">tyf2</span></a></span></span><span class="hs-special">,</span><span> </span><span id="local-6989586621681375050"><span class="annot"><span class="annottext">a -&gt; b
</span><a href="#local-6989586621681375050"><span class="hs-identifier hs-var">tmf2</span></a></span></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">b -&gt; c
</span><a href="#local-6989586621681375053"><span class="hs-identifier hs-var">tyf1</span></a></span><span> </span><span class="annot"><span class="annottext">forall b c a. (b -&gt; c) -&gt; (a -&gt; b) -&gt; a -&gt; c
</span><a href="../../base-4.16.4.0/src/GHC-Base.html#."><span class="hs-operator hs-var">.</span></a></span><span> </span><span class="annot"><span class="annottext">a -&gt; b
</span><a href="#local-6989586621681375051"><span class="hs-identifier hs-var">tyf2</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">b -&gt; c
</span><a href="#local-6989586621681375052"><span class="hs-identifier hs-var">tmf1</span></a></span><span> </span><span class="annot"><span class="annottext">forall b c a. (b -&gt; c) -&gt; (a -&gt; b) -&gt; a -&gt; c
</span><a href="../../base-4.16.4.0/src/GHC-Base.html#."><span class="hs-operator hs-var">.</span></a></span><span> </span><span class="annot"><span class="annottext">a -&gt; b
</span><a href="#local-6989586621681375050"><span class="hs-identifier hs-var">tmf2</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-361"></span><span>
</span><span id="line-362"></span><span>    </span><span id="local-6989586621681375071"><span class="annot"><span class="annottext">stepper :: FamInstEnvs
-&gt; NormaliseStepper
     (ThetaType -&gt; ThetaType,
      [(Type, DataCon, Type)] -&gt; [(Type, DataCon, Type)])
</span><a href="#local-6989586621681375071"><span class="hs-identifier hs-var hs-var">stepper</span></a></span></span><span> </span><span id="local-6989586621681375049"><span class="annot"><span class="annottext">FamInstEnvs
</span><a href="#local-6989586621681375049"><span class="hs-identifier hs-var">env</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">NormaliseStepper
  (ThetaType -&gt; ThetaType,
   [(Type, DataCon, Type)] -&gt; [(Type, DataCon, Type)])
</span><a href="#local-6989586621681375048"><span class="hs-identifier hs-var">newTypeStepper</span></a></span><span> </span><span class="annot"><span class="annottext">forall ev.
NormaliseStepper ev -&gt; NormaliseStepper ev -&gt; NormaliseStepper ev
</span><a href="GHC.Core.Coercion.html#composeSteppers"><span class="hs-operator hs-var">`composeSteppers`</span></a></span><span> </span><span class="annot"><span class="annottext">forall a.
FamInstEnvs -&gt; NormaliseStepper (ThetaType -&gt; ThetaType, a -&gt; a)
</span><a href="#local-6989586621681375046"><span class="hs-identifier hs-var">tyFamStepper</span></a></span><span> </span><span class="annot"><span class="annottext">FamInstEnvs
</span><a href="#local-6989586621681375049"><span class="hs-identifier hs-var">env</span></a></span><span>
</span><span id="line-363"></span><span>
</span><span id="line-364"></span><span>    </span><span class="hs-comment">-- A 'NormaliseStepper' that unwraps newtypes, careful not to fall into</span><span>
</span><span id="line-365"></span><span>    </span><span class="hs-comment">-- a loop. If it would fall into a loop, it produces 'NS_Abort'.</span><span>
</span><span id="line-366"></span><span>    </span><span class="annot"><a href="#local-6989586621681375048"><span class="hs-identifier hs-type">newTypeStepper</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><a href="GHC.Core.Coercion.html#NormaliseStepper"><span class="hs-identifier hs-type">NormaliseStepper</span></a></span><span> </span><span class="hs-special">(</span><span class="hs-special">[</span><span class="annot"><a href="GHC.Core.TyCo.Rep.html#Type"><span class="hs-identifier hs-type">Type</span></a></span><span class="hs-special">]</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-special">[</span><span class="annot"><a href="GHC.Core.TyCo.Rep.html#Type"><span class="hs-identifier hs-type">Type</span></a></span><span class="hs-special">]</span><span class="hs-special">,</span><span class="hs-special">[</span><span class="hs-special">(</span><span class="annot"><a href="GHC.Core.TyCo.Rep.html#Type"><span class="hs-identifier hs-type">Type</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><a href="GHC.Core.DataCon.html#DataCon"><span class="hs-identifier hs-type">DataCon</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><a href="GHC.Core.TyCo.Rep.html#Type"><span class="hs-identifier hs-type">Type</span></a></span><span class="hs-special">)</span><span class="hs-special">]</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-special">[</span><span class="hs-special">(</span><span class="annot"><a href="GHC.Core.TyCo.Rep.html#Type"><span class="hs-identifier hs-type">Type</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><a href="GHC.Core.DataCon.html#DataCon"><span class="hs-identifier hs-type">DataCon</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><a href="GHC.Core.TyCo.Rep.html#Type"><span class="hs-identifier hs-type">Type</span></a></span><span class="hs-special">)</span><span class="hs-special">]</span><span class="hs-special">)</span><span>
</span><span id="line-367"></span><span>    </span><span id="local-6989586621681375048"><span class="annot"><span class="annottext">newTypeStepper :: NormaliseStepper
  (ThetaType -&gt; ThetaType,
   [(Type, DataCon, Type)] -&gt; [(Type, DataCon, Type)])
</span><a href="#local-6989586621681375048"><span class="hs-identifier hs-var hs-var">newTypeStepper</span></a></span></span><span> </span><span id="local-6989586621681375045"><span class="annot"><span class="annottext">RecTcChecker
</span><a href="#local-6989586621681375045"><span class="hs-identifier hs-var">rec_nts</span></a></span></span><span> </span><span id="local-6989586621681375044"><span class="annot"><span class="annottext">TyCon
</span><a href="#local-6989586621681375044"><span class="hs-identifier hs-var">tc</span></a></span></span><span> </span><span id="local-6989586621681375043"><span class="annot"><span class="annottext">ThetaType
</span><a href="#local-6989586621681375043"><span class="hs-identifier hs-var">tys</span></a></span></span><span>
</span><span id="line-368"></span><span>      </span><span class="hs-glyph">|</span><span> </span><span class="annot"><a href="../../base-4.16.4.0/src/GHC-Maybe.html#Just"><span class="hs-identifier hs-type">Just</span></a></span><span> </span><span class="hs-special">(</span><span id="local-6989586621681375042"><span class="annot"><span class="annottext">Type
</span><a href="#local-6989586621681375042"><span class="hs-identifier hs-var">ty'</span></a></span></span><span class="hs-special">,</span><span> </span><span id="local-6989586621681375041"><span class="annot"><span class="annottext">Coercion
</span><a href="#local-6989586621681375041"><span class="hs-identifier hs-var">_co</span></a></span></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">TyCon -&gt; ThetaType -&gt; Maybe (Type, Coercion)
</span><a href="GHC.Core.Coercion.html#instNewTyCon_maybe"><span class="hs-identifier hs-var">instNewTyCon_maybe</span></a></span><span> </span><span class="annot"><span class="annottext">TyCon
</span><a href="#local-6989586621681375044"><span class="hs-identifier hs-var">tc</span></a></span><span> </span><span class="annot"><span class="annottext">ThetaType
</span><a href="#local-6989586621681375043"><span class="hs-identifier hs-var">tys</span></a></span><span>
</span><span id="line-369"></span><span>      </span><span class="hs-special">,</span><span> </span><span class="hs-keyword">let</span><span> </span><span id="local-6989586621681375039"><span class="annot"><span class="annottext">orig_ty :: Type
</span><a href="#local-6989586621681375039"><span class="hs-identifier hs-var hs-var">orig_ty</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">TyCon -&gt; ThetaType -&gt; Type
</span><a href="GHC.Core.TyCo.Rep.html#TyConApp"><span class="hs-identifier hs-var">TyConApp</span></a></span><span> </span><span class="annot"><span class="annottext">TyCon
</span><a href="#local-6989586621681375044"><span class="hs-identifier hs-var">tc</span></a></span><span> </span><span class="annot"><span class="annottext">ThetaType
</span><a href="#local-6989586621681375043"><span class="hs-identifier hs-var">tys</span></a></span><span>
</span><span id="line-370"></span><span>      </span><span class="hs-glyph">=</span><span> </span><span class="hs-keyword">case</span><span> </span><span class="annot"><span class="annottext">RecTcChecker -&gt; TyCon -&gt; Maybe RecTcChecker
</span><a href="GHC.Core.TyCon.RecWalk.html#checkRecTc"><span class="hs-identifier hs-var">checkRecTc</span></a></span><span> </span><span class="annot"><span class="annottext">RecTcChecker
</span><a href="#local-6989586621681375045"><span class="hs-identifier hs-var">rec_nts</span></a></span><span> </span><span class="annot"><span class="annottext">TyCon
</span><a href="#local-6989586621681375044"><span class="hs-identifier hs-var">tc</span></a></span><span> </span><span class="hs-keyword">of</span><span>
</span><span id="line-371"></span><span>          </span><span class="annot"><a href="../../base-4.16.4.0/src/GHC-Maybe.html#Just"><span class="hs-identifier hs-type">Just</span></a></span><span> </span><span id="local-6989586621681375036"><span class="annot"><span class="annottext">RecTcChecker
</span><a href="#local-6989586621681375036"><span class="hs-identifier hs-var">rec_nts'</span></a></span></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-keyword">let</span><span> </span><span id="local-6989586621681375035"><span class="annot"><span class="annottext">tyf :: ThetaType -&gt; ThetaType
</span><a href="#local-6989586621681375035"><span class="hs-identifier hs-var hs-var">tyf</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Type
</span><a href="#local-6989586621681375039"><span class="hs-identifier hs-var">orig_ty</span></a></span><span class="annot"><span class="annottext">forall a. a -&gt; [a] -&gt; [a]
</span><span class="hs-glyph hs-var">:</span></span><span class="hs-special">)</span><span>
</span><span id="line-372"></span><span>                               </span><span id="local-6989586621681375034"><span class="annot"><span class="annottext">tmf :: [(Type, DataCon, Type)] -&gt; [(Type, DataCon, Type)]
</span><a href="#local-6989586621681375034"><span class="hs-identifier hs-var hs-var">tmf</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-special">(</span><span class="hs-special">(</span><span class="annot"><span class="annottext">Type
</span><a href="#local-6989586621681375039"><span class="hs-identifier hs-var">orig_ty</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">TyCon -&gt; DataCon
</span><a href="GHC.Core.TyCon.html#tyConSingleDataCon"><span class="hs-identifier hs-var">tyConSingleDataCon</span></a></span><span> </span><span class="annot"><span class="annottext">TyCon
</span><a href="#local-6989586621681375044"><span class="hs-identifier hs-var">tc</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">Type
</span><a href="#local-6989586621681375042"><span class="hs-identifier hs-var">ty'</span></a></span><span class="hs-special">)</span><span class="annot"><span class="annottext">forall a. a -&gt; [a] -&gt; [a]
</span><span class="hs-glyph hs-var">:</span></span><span class="hs-special">)</span><span>
</span><span id="line-373"></span><span>                           </span><span class="hs-keyword">in</span><span>  </span><span class="annot"><span class="annottext">forall ev. RecTcChecker -&gt; Type -&gt; ev -&gt; NormaliseStepResult ev
</span><a href="GHC.Core.Coercion.html#NS_Step"><span class="hs-identifier hs-var">NS_Step</span></a></span><span> </span><span class="annot"><span class="annottext">RecTcChecker
</span><a href="#local-6989586621681375036"><span class="hs-identifier hs-var">rec_nts'</span></a></span><span> </span><span class="annot"><span class="annottext">Type
</span><a href="#local-6989586621681375042"><span class="hs-identifier hs-var">ty'</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">ThetaType -&gt; ThetaType
</span><a href="#local-6989586621681375035"><span class="hs-identifier hs-var">tyf</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">[(Type, DataCon, Type)] -&gt; [(Type, DataCon, Type)]
</span><a href="#local-6989586621681375034"><span class="hs-identifier hs-var">tmf</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-374"></span><span>          </span><span class="annot"><span class="annottext">Maybe RecTcChecker
</span><a href="../../base-4.16.4.0/src/GHC-Maybe.html#Nothing"><span class="hs-identifier hs-var">Nothing</span></a></span><span>       </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="annottext">forall ev. NormaliseStepResult ev
</span><a href="GHC.Core.Coercion.html#NS_Abort"><span class="hs-identifier hs-var">NS_Abort</span></a></span><span>
</span><span id="line-375"></span><span>      </span><span class="hs-glyph">|</span><span> </span><span class="annot"><span class="annottext">Bool
</span><a href="../../base-4.16.4.0/src/GHC-Base.html#otherwise"><span class="hs-identifier hs-var">otherwise</span></a></span><span>
</span><span id="line-376"></span><span>      </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">forall ev. NormaliseStepResult ev
</span><a href="GHC.Core.Coercion.html#NS_Done"><span class="hs-identifier hs-var">NS_Done</span></a></span><span>
</span><span id="line-377"></span><span>
</span><span id="line-378"></span><span>    </span><span id="local-6989586621681375797"><span class="annot"><a href="#local-6989586621681375046"><span class="hs-identifier hs-type">tyFamStepper</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><a href="GHC.Core.FamInstEnv.html#FamInstEnvs"><span class="hs-identifier hs-type">FamInstEnvs</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="GHC.Core.Coercion.html#NormaliseStepper"><span class="hs-identifier hs-type">NormaliseStepper</span></a></span><span> </span><span class="hs-special">(</span><span class="hs-special">[</span><span class="annot"><a href="GHC.Core.TyCo.Rep.html#Type"><span class="hs-identifier hs-type">Type</span></a></span><span class="hs-special">]</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-special">[</span><span class="annot"><a href="GHC.Core.TyCo.Rep.html#Type"><span class="hs-identifier hs-type">Type</span></a></span><span class="hs-special">]</span><span class="hs-special">,</span><span> </span><span class="annot"><a href="#local-6989586621681375797"><span class="hs-identifier hs-type">a</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="#local-6989586621681375797"><span class="hs-identifier hs-type">a</span></a></span><span class="hs-special">)</span></span><span>
</span><span id="line-379"></span><span>    </span><span id="local-6989586621681375046"><span class="annot"><span class="annottext">tyFamStepper :: forall a.
FamInstEnvs -&gt; NormaliseStepper (ThetaType -&gt; ThetaType, a -&gt; a)
</span><a href="#local-6989586621681375046"><span class="hs-identifier hs-var hs-var">tyFamStepper</span></a></span></span><span> </span><span id="local-6989586621681375029"><span class="annot"><span class="annottext">FamInstEnvs
</span><a href="#local-6989586621681375029"><span class="hs-identifier hs-var">env</span></a></span></span><span> </span><span id="local-6989586621681375028"><span class="annot"><span class="annottext">RecTcChecker
</span><a href="#local-6989586621681375028"><span class="hs-identifier hs-var">rec_nts</span></a></span></span><span> </span><span id="local-6989586621681375027"><span class="annot"><span class="annottext">TyCon
</span><a href="#local-6989586621681375027"><span class="hs-identifier hs-var">tc</span></a></span></span><span> </span><span id="local-6989586621681375026"><span class="annot"><span class="annottext">ThetaType
</span><a href="#local-6989586621681375026"><span class="hs-identifier hs-var">tys</span></a></span></span><span>  </span><span class="hs-comment">-- Try to step a type/data family</span><span>
</span><span id="line-380"></span><span>      </span><span class="hs-glyph">=</span><span> </span><span class="hs-keyword">case</span><span> </span><span class="annot"><span class="annottext">FamInstEnvs
-&gt; TyCon -&gt; ThetaType -&gt; Maybe (Coercion, Type, MCoercion)
</span><a href="GHC.Core.FamInstEnv.html#topReduceTyFamApp_maybe"><span class="hs-identifier hs-var">topReduceTyFamApp_maybe</span></a></span><span> </span><span class="annot"><span class="annottext">FamInstEnvs
</span><a href="#local-6989586621681375029"><span class="hs-identifier hs-var">env</span></a></span><span> </span><span class="annot"><span class="annottext">TyCon
</span><a href="#local-6989586621681375027"><span class="hs-identifier hs-var">tc</span></a></span><span> </span><span class="annot"><span class="annottext">ThetaType
</span><a href="#local-6989586621681375026"><span class="hs-identifier hs-var">tys</span></a></span><span> </span><span class="hs-keyword">of</span><span>
</span><span id="line-381"></span><span>          </span><span class="annot"><a href="../../base-4.16.4.0/src/GHC-Maybe.html#Just"><span class="hs-identifier hs-type">Just</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Coercion
</span><span class="hs-identifier">_</span></span><span class="hs-special">,</span><span> </span><span id="local-6989586621681375024"><span class="annot"><span class="annottext">Type
</span><a href="#local-6989586621681375024"><span class="hs-identifier hs-var">rhs</span></a></span></span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">MCoercion
</span><span class="hs-identifier">_</span></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="annottext">forall ev. RecTcChecker -&gt; Type -&gt; ev -&gt; NormaliseStepResult ev
</span><a href="GHC.Core.Coercion.html#NS_Step"><span class="hs-identifier hs-var">NS_Step</span></a></span><span> </span><span class="annot"><span class="annottext">RecTcChecker
</span><a href="#local-6989586621681375028"><span class="hs-identifier hs-var">rec_nts</span></a></span><span> </span><span class="annot"><span class="annottext">Type
</span><a href="#local-6989586621681375024"><span class="hs-identifier hs-var">rhs</span></a></span><span> </span><span class="hs-special">(</span><span class="hs-special">(</span><span class="annot"><span class="annottext">Type
</span><a href="#local-6989586621681375024"><span class="hs-identifier hs-var">rhs</span></a></span><span class="annot"><span class="annottext">forall a. a -&gt; [a] -&gt; [a]
</span><span class="hs-glyph hs-var">:</span></span><span class="hs-special">)</span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">forall a. a -&gt; a
</span><a href="../../base-4.16.4.0/src/GHC-Base.html#id"><span class="hs-identifier hs-var">id</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-382"></span><span>          </span><span class="annot"><span class="annottext">Maybe (Coercion, Type, MCoercion)
</span><span class="hs-identifier">_</span></span><span>                </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="annottext">forall ev. NormaliseStepResult ev
</span><a href="GHC.Core.Coercion.html#NS_Done"><span class="hs-identifier hs-var">NS_Done</span></a></span><span>
</span><span id="line-383"></span><span>
</span><span id="line-384"></span><span class="hs-comment">-- | Returns 'True' if the argument 'Type' is a fully saturated application of</span><span>
</span><span id="line-385"></span><span class="hs-comment">-- a closed type constructor.</span><span>
</span><span id="line-386"></span><span class="hs-comment">--</span><span>
</span><span id="line-387"></span><span class="hs-comment">-- Closed type constructors are those with a fixed right hand side, as</span><span>
</span><span id="line-388"></span><span class="hs-comment">-- opposed to e.g. associated types. These are of particular interest for</span><span>
</span><span id="line-389"></span><span class="hs-comment">-- pattern-match coverage checking, because GHC can exhaustively consider all</span><span>
</span><span id="line-390"></span><span class="hs-comment">-- possible forms that values of a closed type can take on.</span><span>
</span><span id="line-391"></span><span class="hs-comment">--</span><span>
</span><span id="line-392"></span><span class="hs-comment">-- Note that this function is intended to be used to check types of value-level</span><span>
</span><span id="line-393"></span><span class="hs-comment">-- patterns, so as a consequence, the 'Type' supplied as an argument to this</span><span>
</span><span id="line-394"></span><span class="hs-comment">-- function should be of kind @Type@.</span><span>
</span><span id="line-395"></span><span class="annot"><a href="GHC.HsToCore.Pmc.Solver.html#pmIsClosedType"><span class="hs-identifier hs-type">pmIsClosedType</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><a href="GHC.Core.TyCo.Rep.html#Type"><span class="hs-identifier hs-type">Type</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="hs-identifier hs-type">Bool</span></span><span>
</span><span id="line-396"></span><span id="pmIsClosedType"><span class="annot"><span class="annottext">pmIsClosedType :: Type -&gt; Bool
</span><a href="GHC.HsToCore.Pmc.Solver.html#pmIsClosedType"><span class="hs-identifier hs-var hs-var">pmIsClosedType</span></a></span></span><span> </span><span id="local-6989586621681375023"><span class="annot"><span class="annottext">Type
</span><a href="#local-6989586621681375023"><span class="hs-identifier hs-var">ty</span></a></span></span><span>
</span><span id="line-397"></span><span>  </span><span class="hs-glyph">=</span><span> </span><span class="hs-keyword">case</span><span> </span><span class="annot"><span class="annottext">HasDebugCallStack =&gt; Type -&gt; Maybe (TyCon, ThetaType)
</span><a href="GHC.Core.Type.html#splitTyConApp_maybe"><span class="hs-identifier hs-var">splitTyConApp_maybe</span></a></span><span> </span><span class="annot"><span class="annottext">Type
</span><a href="#local-6989586621681375023"><span class="hs-identifier hs-var">ty</span></a></span><span> </span><span class="hs-keyword">of</span><span>
</span><span id="line-398"></span><span>      </span><span class="annot"><a href="../../base-4.16.4.0/src/GHC-Maybe.html#Just"><span class="hs-identifier hs-type">Just</span></a></span><span> </span><span class="hs-special">(</span><span id="local-6989586621681375021"><span class="annot"><span class="annottext">TyCon
</span><a href="#local-6989586621681375021"><span class="hs-identifier hs-var">tc</span></a></span></span><span class="hs-special">,</span><span> </span><span id="local-6989586621681375020"><span class="annot"><span class="annottext">ThetaType
</span><a href="#local-6989586621681375020"><span class="hs-identifier hs-var">ty_args</span></a></span></span><span class="hs-special">)</span><span>
</span><span id="line-399"></span><span>             </span><span class="hs-glyph">|</span><span> </span><span class="annot"><span class="annottext">TyCon -&gt; Bool
</span><a href="#local-6989586621681375019"><span class="hs-identifier hs-var">is_algebraic_like</span></a></span><span> </span><span class="annot"><span class="annottext">TyCon
</span><a href="#local-6989586621681375021"><span class="hs-identifier hs-var">tc</span></a></span><span> </span><span class="annot"><span class="annottext">Bool -&gt; Bool -&gt; Bool
</span><span class="hs-operator hs-var">&amp;&amp;</span></span><span> </span><span class="annot"><span class="annottext">Bool -&gt; Bool
</span><span class="hs-identifier hs-var">not</span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">TyCon -&gt; Bool
</span><a href="GHC.Core.TyCon.html#isFamilyTyCon"><span class="hs-identifier hs-var">isFamilyTyCon</span></a></span><span> </span><span class="annot"><span class="annottext">TyCon
</span><a href="#local-6989586621681375021"><span class="hs-identifier hs-var">tc</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-400"></span><span>             </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-identifier">ASSERT2</span><span class="hs-special">(</span><span> </span><span class="hs-identifier">ty_args</span><span> </span><span class="hs-special">`</span><span class="hs-identifier">lengthIs</span><span class="hs-special">`</span><span> </span><span class="hs-identifier">tyConArity</span><span> </span><span class="hs-identifier">tc</span><span class="hs-special">,</span><span> </span><span class="hs-identifier">ppr</span><span> </span><span class="hs-identifier">ty</span><span> </span><span class="hs-special">)</span><span> </span><span class="hs-identifier">True</span><span>
</span><span id="line-401"></span><span>      </span><span id="local-6989586621681375012"><span class="annot"><span class="annottext">Maybe (TyCon, ThetaType)
</span><a href="#local-6989586621681375012"><span class="hs-identifier hs-var">_other</span></a></span></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="annottext">Bool
</span><span class="hs-identifier hs-var">False</span></span><span>
</span><span id="line-402"></span><span>  </span><span class="hs-keyword">where</span><span>
</span><span id="line-403"></span><span>    </span><span class="hs-comment">-- This returns True for TyCons which /act like/ algebraic types.</span><span>
</span><span id="line-404"></span><span>    </span><span class="hs-comment">-- (See &quot;Type#type_classification&quot; for what an algebraic type is.)</span><span>
</span><span id="line-405"></span><span>    </span><span class="hs-comment">--</span><span>
</span><span id="line-406"></span><span>    </span><span class="hs-comment">-- This is qualified with \&quot;like\&quot; because of a particular special</span><span>
</span><span id="line-407"></span><span>    </span><span class="hs-comment">-- case: TYPE (the underlyind kind behind Type, among others). TYPE</span><span>
</span><span id="line-408"></span><span>    </span><span class="hs-comment">-- is conceptually a datatype (and thus algebraic), but in practice it is</span><span>
</span><span id="line-409"></span><span>    </span><span class="hs-comment">-- a primitive builtin type, so we must check for it specially.</span><span>
</span><span id="line-410"></span><span>    </span><span class="hs-comment">--</span><span>
</span><span id="line-411"></span><span>    </span><span class="hs-comment">-- NB: it makes sense to think of TYPE as a closed type in a value-level,</span><span>
</span><span id="line-412"></span><span>    </span><span class="hs-comment">-- pattern-matching context. However, at the kind level, TYPE is certainly</span><span>
</span><span id="line-413"></span><span>    </span><span class="hs-comment">-- not closed! Since this function is specifically tailored towards pattern</span><span>
</span><span id="line-414"></span><span>    </span><span class="hs-comment">-- matching, however, it's OK to label TYPE as closed.</span><span>
</span><span id="line-415"></span><span>    </span><span class="annot"><a href="#local-6989586621681375019"><span class="hs-identifier hs-type">is_algebraic_like</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><a href="GHC.Core.TyCon.html#TyCon"><span class="hs-identifier hs-type">TyCon</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="hs-identifier hs-type">Bool</span></span><span>
</span><span id="line-416"></span><span>    </span><span id="local-6989586621681375019"><span class="annot"><span class="annottext">is_algebraic_like :: TyCon -&gt; Bool
</span><a href="#local-6989586621681375019"><span class="hs-identifier hs-var hs-var">is_algebraic_like</span></a></span></span><span> </span><span id="local-6989586621681375011"><span class="annot"><span class="annottext">TyCon
</span><a href="#local-6989586621681375011"><span class="hs-identifier hs-var">tc</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">TyCon -&gt; Bool
</span><a href="GHC.Core.TyCon.html#isAlgTyCon"><span class="hs-identifier hs-var">isAlgTyCon</span></a></span><span> </span><span class="annot"><span class="annottext">TyCon
</span><a href="#local-6989586621681375011"><span class="hs-identifier hs-var">tc</span></a></span><span> </span><span class="annot"><span class="annottext">Bool -&gt; Bool -&gt; Bool
</span><span class="hs-operator hs-var">||</span></span><span> </span><span class="annot"><span class="annottext">TyCon
</span><a href="#local-6989586621681375011"><span class="hs-identifier hs-var">tc</span></a></span><span> </span><span class="annot"><span class="annottext">forall a. Eq a =&gt; a -&gt; a -&gt; Bool
</span><span class="hs-operator hs-var">==</span></span><span> </span><span class="annot"><span class="annottext">TyCon
</span><a href="GHC.Builtin.Types.Prim.html#tYPETyCon"><span class="hs-identifier hs-var">tYPETyCon</span></a></span><span>
</span><span id="line-417"></span><span>
</span><span id="line-418"></span><span class="hs-comment">-- | Normalise the given source type to WHNF. If it isn't already in WHNF</span><span>
</span><span id="line-419"></span><span class="hs-comment">-- ('isSourceTypeInWHNF') , it will normalise the type and then try to step</span><span>
</span><span id="line-420"></span><span class="hs-comment">-- through type family applications, but not data family applications or</span><span>
</span><span id="line-421"></span><span class="hs-comment">-- newtypes.</span><span>
</span><span id="line-422"></span><span class="hs-comment">--</span><span>
</span><span id="line-423"></span><span class="hs-comment">-- This is a pretty common case of calling 'pmTopNormaliseType' and it should be</span><span>
</span><span id="line-424"></span><span class="hs-comment">-- efficient.</span><span>
</span><span id="line-425"></span><span class="annot"><a href="GHC.HsToCore.Pmc.Solver.html#normaliseSourceTypeWHNF"><span class="hs-identifier hs-type">normaliseSourceTypeWHNF</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><a href="GHC.HsToCore.Pmc.Solver.Types.html#TyState"><span class="hs-identifier hs-type">TyState</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="GHC.Core.TyCo.Rep.html#Type"><span class="hs-identifier hs-type">Type</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="GHC.HsToCore.Types.html#DsM"><span class="hs-identifier hs-type">DsM</span></a></span><span> </span><span class="annot"><a href="GHC.Core.TyCo.Rep.html#Type"><span class="hs-identifier hs-type">Type</span></a></span><span>
</span><span id="line-426"></span><span id="normaliseSourceTypeWHNF"><span class="annot"><span class="annottext">normaliseSourceTypeWHNF :: TyState -&gt; Type -&gt; DsM Type
</span><a href="GHC.HsToCore.Pmc.Solver.html#normaliseSourceTypeWHNF"><span class="hs-identifier hs-var hs-var">normaliseSourceTypeWHNF</span></a></span></span><span> </span><span class="annot"><span class="annottext">TyState
</span><span class="hs-identifier">_</span></span><span>     </span><span id="local-6989586621681375008"><span class="annot"><span class="annottext">Type
</span><a href="#local-6989586621681375008"><span class="hs-identifier hs-var">ty</span></a></span></span><span> </span><span class="hs-glyph">|</span><span> </span><span class="annot"><span class="annottext">Type -&gt; Bool
</span><a href="GHC.HsToCore.Pmc.Solver.html#isSourceTypeInWHNF"><span class="hs-identifier hs-var">isSourceTypeInWHNF</span></a></span><span> </span><span class="annot"><span class="annottext">Type
</span><a href="#local-6989586621681375008"><span class="hs-identifier hs-var">ty</span></a></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">forall (f :: * -&gt; *) a. Applicative f =&gt; a -&gt; f a
</span><a href="../../base-4.16.4.0/src/GHC-Base.html#pure"><span class="hs-identifier hs-var">pure</span></a></span><span> </span><span class="annot"><span class="annottext">Type
</span><a href="#local-6989586621681375008"><span class="hs-identifier hs-var">ty</span></a></span><span>
</span><span id="line-427"></span><span class="annot"><a href="GHC.HsToCore.Pmc.Solver.html#normaliseSourceTypeWHNF"><span class="hs-identifier hs-var">normaliseSourceTypeWHNF</span></a></span><span> </span><span id="local-6989586621681375006"><span class="annot"><span class="annottext">TyState
</span><a href="#local-6989586621681375006"><span class="hs-identifier hs-var">ty_st</span></a></span></span><span> </span><span id="local-6989586621681375005"><span class="annot"><span class="annottext">Type
</span><a href="#local-6989586621681375005"><span class="hs-identifier hs-var">ty</span></a></span></span><span> </span><span class="hs-glyph">=</span><span>
</span><span id="line-428"></span><span>  </span><span class="annot"><span class="annottext">TyState -&gt; Type -&gt; DsM TopNormaliseTypeResult
</span><a href="GHC.HsToCore.Pmc.Solver.html#pmTopNormaliseType"><span class="hs-identifier hs-var">pmTopNormaliseType</span></a></span><span> </span><span class="annot"><span class="annottext">TyState
</span><a href="#local-6989586621681375006"><span class="hs-identifier hs-var">ty_st</span></a></span><span> </span><span class="annot"><span class="annottext">Type
</span><a href="#local-6989586621681375005"><span class="hs-identifier hs-var">ty</span></a></span><span> </span><span class="annot"><span class="annottext">forall (m :: * -&gt; *) a b. Monad m =&gt; m a -&gt; (a -&gt; m b) -&gt; m b
</span><a href="../../base-4.16.4.0/src/GHC-Base.html#%3E%3E%3D"><span class="hs-operator hs-var">&gt;&gt;=</span></a></span><span> </span><span class="hs-glyph">\</span><span class="hs-glyph">case</span><span>
</span><span id="line-429"></span><span>    </span><span class="annot"><a href="GHC.HsToCore.Pmc.Solver.html#NormalisedByConstraints"><span class="hs-identifier hs-type">NormalisedByConstraints</span></a></span><span> </span><span id="local-6989586621681375004"><span class="annot"><span class="annottext">Type
</span><a href="#local-6989586621681375004"><span class="hs-identifier hs-var">ty</span></a></span></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="annottext">forall (f :: * -&gt; *) a. Applicative f =&gt; a -&gt; f a
</span><a href="../../base-4.16.4.0/src/GHC-Base.html#pure"><span class="hs-identifier hs-var">pure</span></a></span><span> </span><span class="annot"><span class="annottext">Type
</span><a href="#local-6989586621681375004"><span class="hs-identifier hs-var">ty</span></a></span><span>
</span><span id="line-430"></span><span>    </span><span class="annot"><a href="GHC.HsToCore.Pmc.Solver.html#HadRedexes"><span class="hs-identifier hs-type">HadRedexes</span></a></span><span> </span><span id="local-6989586621681375003"><span class="annot"><span class="annottext">Type
</span><a href="#local-6989586621681375003"><span class="hs-identifier hs-var">ty</span></a></span></span><span> </span><span class="annot"><span class="annottext">[(Type, DataCon, Type)]
</span><span class="hs-identifier">_</span></span><span> </span><span class="annot"><span class="annottext">Type
</span><span class="hs-identifier">_</span></span><span>          </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="annottext">forall (f :: * -&gt; *) a. Applicative f =&gt; a -&gt; f a
</span><a href="../../base-4.16.4.0/src/GHC-Base.html#pure"><span class="hs-identifier hs-var">pure</span></a></span><span> </span><span class="annot"><span class="annottext">Type
</span><a href="#local-6989586621681375003"><span class="hs-identifier hs-var">ty</span></a></span><span>
</span><span id="line-431"></span><span>
</span><span id="line-432"></span><span class="hs-comment">-- | Is the source type in WHNF wrt. 'pmTopNormaliseType'?</span><span>
</span><span id="line-433"></span><span class="hs-comment">--</span><span>
</span><span id="line-434"></span><span class="hs-comment">-- Returns False if the given type is not a TyCon application, or if the TyCon</span><span>
</span><span id="line-435"></span><span class="hs-comment">-- app head is a type family TyCon. (But not for data family TyCons!)</span><span>
</span><span id="line-436"></span><span class="annot"><a href="GHC.HsToCore.Pmc.Solver.html#isSourceTypeInWHNF"><span class="hs-identifier hs-type">isSourceTypeInWHNF</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><a href="GHC.Core.TyCo.Rep.html#Type"><span class="hs-identifier hs-type">Type</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="hs-identifier hs-type">Bool</span></span><span>
</span><span id="line-437"></span><span id="isSourceTypeInWHNF"><span class="annot"><span class="annottext">isSourceTypeInWHNF :: Type -&gt; Bool
</span><a href="GHC.HsToCore.Pmc.Solver.html#isSourceTypeInWHNF"><span class="hs-identifier hs-var hs-var">isSourceTypeInWHNF</span></a></span></span><span> </span><span id="local-6989586621681375002"><span class="annot"><span class="annottext">Type
</span><a href="#local-6989586621681375002"><span class="hs-identifier hs-var">ty</span></a></span></span><span>
</span><span id="line-438"></span><span>  </span><span class="hs-glyph">|</span><span> </span><span class="annot"><a href="../../base-4.16.4.0/src/GHC-Maybe.html#Just"><span class="hs-identifier hs-type">Just</span></a></span><span> </span><span class="hs-special">(</span><span id="local-6989586621681375001"><span class="annot"><span class="annottext">TyCon
</span><a href="#local-6989586621681375001"><span class="hs-identifier hs-var">tc</span></a></span></span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">ThetaType
</span><span class="hs-identifier">_</span></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">HasDebugCallStack =&gt; Type -&gt; Maybe (TyCon, ThetaType)
</span><a href="GHC.Core.Type.html#splitTyConApp_maybe"><span class="hs-identifier hs-var">splitTyConApp_maybe</span></a></span><span> </span><span class="annot"><span class="annottext">Type
</span><a href="#local-6989586621681375002"><span class="hs-identifier hs-var">ty</span></a></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">Bool -&gt; Bool
</span><span class="hs-identifier hs-var">not</span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">TyCon -&gt; Bool
</span><a href="GHC.Core.TyCon.html#isTypeFamilyTyCon"><span class="hs-identifier hs-var">isTypeFamilyTyCon</span></a></span><span> </span><span class="annot"><span class="annottext">TyCon
</span><a href="#local-6989586621681375001"><span class="hs-identifier hs-var">tc</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-439"></span><span>  </span><span class="hs-glyph">|</span><span> </span><span class="annot"><span class="annottext">Bool
</span><a href="../../base-4.16.4.0/src/GHC-Base.html#otherwise"><span class="hs-identifier hs-var">otherwise</span></a></span><span>                              </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">Bool
</span><span class="hs-identifier hs-var">False</span></span><span>
</span><span id="line-440"></span><span>
</span><span id="line-441"></span><span class="hs-comment">{- Note [Type normalisation]
~~~~~~~~~~~~~~~~~~~~~~~~~~~~
Constructs like -XEmptyCase or a previous unsuccessful pattern match on a data
constructor place a non-void constraint on the matched thing. This means that it
boils down to checking whether the type of the scrutinee is inhabited. Function
pmTopNormaliseType gets rid of the outermost type function/data family redex and
newtypes, in search of an algebraic type constructor, which is easier to check
for inhabitation.

It returns 3 results instead of one, because there are 2 subtle points:
1. Newtypes are isomorphic to the underlying type in core but not in the source
   language,
2. The representational data family tycon is used internally but should not be
   shown to the user

Hence, if pmTopNormaliseType env ty_cs ty = Just (src_ty, dcs, core_ty),
then
  (a) src_ty is the rewritten type which we can show to the user. That is, the
      type we get if we rewrite type families but not data families or
      newtypes.
  (b) dcs is the list of newtype constructors &quot;skipped&quot;, every time we normalise
      a newtype to its core representation, we keep track of the source data
      constructor. For convenience, we also track the type we unwrap and the
      type of its field. Example: @Down 42@ =&gt; @[(Down @Int, Down, Int)]
  (c) core_ty is the rewritten type. That is,
        pmTopNormaliseType env ty_cs ty = Just (src_ty, dcs, core_ty)
      implies
        topNormaliseType_maybe env ty = Just (co, core_ty)
      for some coercion co.

To see how all cases come into play, consider the following example:

  data family T a :: *
  data instance T Int = T1 | T2 Bool
  -- Which gives rise to FC:
  --   data T a
  --   data R:TInt = T1 | T2 Bool
  --   axiom ax_ti : T Int ~R R:TInt

  newtype G1 = MkG1 (T Int)
  newtype G2 = MkG2 G1

  type instance F Int  = F Char
  type instance F Char = G2

In this case pmTopNormaliseType env ty_cs (F Int) results in

  Just (G2, [(G2,MkG2,G1),(G1,MkG1,T Int)], R:TInt)

Which means that in source Haskell:
  - G2 is equivalent to F Int (in contrast, G1 isn't).
  - if (x : R:TInt) then (MkG2 (MkG1 x) : F Int).

-----
-- Wrinkle: Local equalities
-----

Given the following type family:

  type family F a
  type instance F Int = Void

Should the following program (from #14813) be considered exhaustive?

  f :: (i ~ Int) =&gt; F i -&gt; a
  f x = case x of {}

You might think &quot;of course, since `x` is obviously of type Void&quot;. But the
idType of `x` is technically F i, not Void, so if we pass F i to
inhabitationCandidates, we'll mistakenly conclude that `f` is non-exhaustive.
In order to avoid this pitfall, we need to normalise the type passed to
pmTopNormaliseType, using the constraint solver to solve for any local
equalities (such as i ~ Int) that may be in scope.
-}</span><span>
</span><span id="line-515"></span><span>
</span><span id="line-516"></span><span class="hs-comment">-----------------------</span><span>
</span><span id="line-517"></span><span class="hs-comment">-- * Looking up VarInfo</span><span>
</span><span id="line-518"></span><span>
</span><span id="line-519"></span><span class="annot"><a href="GHC.HsToCore.Pmc.Solver.html#emptyRCM"><span class="hs-identifier hs-type">emptyRCM</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><a href="GHC.HsToCore.Pmc.Solver.Types.html#ResidualCompleteMatches"><span class="hs-identifier hs-type">ResidualCompleteMatches</span></a></span><span>
</span><span id="line-520"></span><span id="emptyRCM"><span class="annot"><span class="annottext">emptyRCM :: ResidualCompleteMatches
</span><a href="GHC.HsToCore.Pmc.Solver.html#emptyRCM"><span class="hs-identifier hs-var hs-var">emptyRCM</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">Maybe CompleteMatch
-&gt; Maybe [CompleteMatch] -&gt; ResidualCompleteMatches
</span><a href="GHC.HsToCore.Pmc.Solver.Types.html#RCM"><span class="hs-identifier hs-var">RCM</span></a></span><span> </span><span class="annot"><span class="annottext">forall a. Maybe a
</span><a href="../../base-4.16.4.0/src/GHC-Maybe.html#Nothing"><span class="hs-identifier hs-var">Nothing</span></a></span><span> </span><span class="annot"><span class="annottext">forall a. Maybe a
</span><a href="../../base-4.16.4.0/src/GHC-Maybe.html#Nothing"><span class="hs-identifier hs-var">Nothing</span></a></span><span>
</span><span id="line-521"></span><span>
</span><span id="line-522"></span><span class="annot"><a href="GHC.HsToCore.Pmc.Solver.html#emptyVarInfo"><span class="hs-identifier hs-type">emptyVarInfo</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><a href="GHC.Types.Var.html#Id"><span class="hs-identifier hs-type">Id</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="GHC.HsToCore.Pmc.Solver.Types.html#VarInfo"><span class="hs-identifier hs-type">VarInfo</span></a></span><span>
</span><span id="line-523"></span><span id="emptyVarInfo"><span class="annot"><span class="annottext">emptyVarInfo :: Id -&gt; VarInfo
</span><a href="GHC.HsToCore.Pmc.Solver.html#emptyVarInfo"><span class="hs-identifier hs-var hs-var">emptyVarInfo</span></a></span></span><span> </span><span id="local-6989586621681374997"><span class="annot"><span class="annottext">Id
</span><a href="#local-6989586621681374997"><span class="hs-identifier hs-var">x</span></a></span></span><span>
</span><span id="line-524"></span><span>  </span><span class="hs-glyph">=</span><span> </span><span class="annot"><a href="GHC.HsToCore.Pmc.Solver.Types.html#VI"><span class="hs-identifier hs-type">VI</span></a></span><span>
</span><span id="line-525"></span><span>  </span><span class="hs-special">{</span><span> </span><span class="annot"><span class="annottext">vi_id :: Id
</span><a href="GHC.HsToCore.Pmc.Solver.Types.html#vi_id"><span class="hs-identifier hs-var">vi_id</span></a></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">Id
</span><a href="#local-6989586621681374997"><span class="hs-identifier hs-var">x</span></a></span><span>
</span><span id="line-526"></span><span>  </span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">vi_pos :: [PmAltConApp]
</span><a href="GHC.HsToCore.Pmc.Solver.Types.html#vi_pos"><span class="hs-identifier hs-var">vi_pos</span></a></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-special">[</span><span class="hs-special">]</span><span>
</span><span id="line-527"></span><span>  </span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">vi_neg :: PmAltConSet
</span><a href="GHC.HsToCore.Pmc.Solver.Types.html#vi_neg"><span class="hs-identifier hs-var">vi_neg</span></a></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">PmAltConSet
</span><a href="GHC.HsToCore.Pmc.Solver.Types.html#emptyPmAltConSet"><span class="hs-identifier hs-var">emptyPmAltConSet</span></a></span><span>
</span><span id="line-528"></span><span>  </span><span class="hs-comment">-- Why not set IsNotBot for unlifted type here?</span><span>
</span><span id="line-529"></span><span>  </span><span class="hs-comment">-- Because we'd have to trigger an inhabitation test, which we can't.</span><span>
</span><span id="line-530"></span><span>  </span><span class="hs-comment">-- See case (4) in Note [Strict fields and variables of unlifted type]</span><span>
</span><span id="line-531"></span><span>  </span><span class="hs-comment">-- in GHC.HsToCore.Pmc.Solver</span><span>
</span><span id="line-532"></span><span>  </span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">vi_bot :: BotInfo
</span><a href="GHC.HsToCore.Pmc.Solver.Types.html#vi_bot"><span class="hs-identifier hs-var">vi_bot</span></a></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">BotInfo
</span><a href="GHC.HsToCore.Pmc.Solver.Types.html#MaybeBot"><span class="hs-identifier hs-var">MaybeBot</span></a></span><span>
</span><span id="line-533"></span><span>  </span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">vi_rcm :: ResidualCompleteMatches
</span><a href="GHC.HsToCore.Pmc.Solver.Types.html#vi_rcm"><span class="hs-identifier hs-var">vi_rcm</span></a></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">ResidualCompleteMatches
</span><a href="GHC.HsToCore.Pmc.Solver.html#emptyRCM"><span class="hs-identifier hs-var">emptyRCM</span></a></span><span>
</span><span id="line-534"></span><span>  </span><span class="hs-special">}</span><span>
</span><span id="line-535"></span><span>
</span><span id="line-536"></span><span class="annot"><a href="GHC.HsToCore.Pmc.Solver.html#lookupVarInfo"><span class="hs-identifier hs-type">lookupVarInfo</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><a href="GHC.HsToCore.Pmc.Solver.Types.html#TmState"><span class="hs-identifier hs-type">TmState</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="GHC.Types.Var.html#Id"><span class="hs-identifier hs-type">Id</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="GHC.HsToCore.Pmc.Solver.Types.html#VarInfo"><span class="hs-identifier hs-type">VarInfo</span></a></span><span>
</span><span id="line-537"></span><span class="hs-comment">-- (lookupVarInfo tms x) tells what we know about 'x'</span><span>
</span><span id="line-538"></span><span id="lookupVarInfo"><span class="annot"><span class="annottext">lookupVarInfo :: TmState -&gt; Id -&gt; VarInfo
</span><a href="GHC.HsToCore.Pmc.Solver.html#lookupVarInfo"><span class="hs-identifier hs-var hs-var">lookupVarInfo</span></a></span></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="GHC.HsToCore.Pmc.Solver.Types.html#TmSt"><span class="hs-identifier hs-type">TmSt</span></a></span><span> </span><span id="local-6989586621681374986"><span class="annot"><span class="annottext">UniqSDFM Id VarInfo
</span><a href="#local-6989586621681374986"><span class="hs-identifier hs-var">env</span></a></span></span><span> </span><span class="annot"><span class="annottext">CoreMap Id
</span><span class="hs-identifier">_</span></span><span> </span><span class="annot"><span class="annottext">DIdSet
</span><span class="hs-identifier">_</span></span><span class="hs-special">)</span><span> </span><span id="local-6989586621681374985"><span class="annot"><span class="annottext">Id
</span><a href="#local-6989586621681374985"><span class="hs-identifier hs-var">x</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">forall a. a -&gt; Maybe a -&gt; a
</span><a href="../../base-4.16.4.0/src/Data-Maybe.html#fromMaybe"><span class="hs-identifier hs-var">fromMaybe</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Id -&gt; VarInfo
</span><a href="GHC.HsToCore.Pmc.Solver.html#emptyVarInfo"><span class="hs-identifier hs-var">emptyVarInfo</span></a></span><span> </span><span class="annot"><span class="annottext">Id
</span><a href="#local-6989586621681374985"><span class="hs-identifier hs-var">x</span></a></span><span class="hs-special">)</span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">forall key ele.
Uniquable key =&gt;
UniqSDFM key ele -&gt; key -&gt; Maybe ele
</span><a href="GHC.Types.Unique.SDFM.html#lookupUSDFM"><span class="hs-identifier hs-var">lookupUSDFM</span></a></span><span> </span><span class="annot"><span class="annottext">UniqSDFM Id VarInfo
</span><a href="#local-6989586621681374986"><span class="hs-identifier hs-var">env</span></a></span><span> </span><span class="annot"><span class="annottext">Id
</span><a href="#local-6989586621681374985"><span class="hs-identifier hs-var">x</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-539"></span><span>
</span><span id="line-540"></span><span class="hs-comment">-- | Like @lookupVarInfo ts x@, but @lookupVarInfo ts x = (y, vi)@ also looks</span><span>
</span><span id="line-541"></span><span class="hs-comment">-- through newtype constructors. We have @x ~ N1 (... (Nk y))@ such that the</span><span>
</span><span id="line-542"></span><span class="hs-comment">-- returned @y@ doesn't have a positive newtype constructor constraint</span><span>
</span><span id="line-543"></span><span class="hs-comment">-- associated with it (yet). The 'VarInfo' returned is that of @y@'s</span><span>
</span><span id="line-544"></span><span class="hs-comment">-- representative.</span><span>
</span><span id="line-545"></span><span class="hs-comment">--</span><span>
</span><span id="line-546"></span><span class="hs-comment">-- Careful, this means that @idType x@ might be different to @idType y@, even</span><span>
</span><span id="line-547"></span><span class="hs-comment">-- modulo type normalisation!</span><span>
</span><span id="line-548"></span><span class="hs-comment">--</span><span>
</span><span id="line-549"></span><span class="hs-comment">-- See also Note [Coverage checking Newtype matches].</span><span>
</span><span id="line-550"></span><span class="annot"><a href="GHC.HsToCore.Pmc.Solver.html#lookupVarInfoNT"><span class="hs-identifier hs-type">lookupVarInfoNT</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><a href="GHC.HsToCore.Pmc.Solver.Types.html#TmState"><span class="hs-identifier hs-type">TmState</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="GHC.Types.Var.html#Id"><span class="hs-identifier hs-type">Id</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-special">(</span><span class="annot"><a href="GHC.Types.Var.html#Id"><span class="hs-identifier hs-type">Id</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><a href="GHC.HsToCore.Pmc.Solver.Types.html#VarInfo"><span class="hs-identifier hs-type">VarInfo</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-551"></span><span id="lookupVarInfoNT"><span class="annot"><span class="annottext">lookupVarInfoNT :: TmState -&gt; Id -&gt; (Id, VarInfo)
</span><a href="GHC.HsToCore.Pmc.Solver.html#lookupVarInfoNT"><span class="hs-identifier hs-var hs-var">lookupVarInfoNT</span></a></span></span><span> </span><span id="local-6989586621681374981"><span class="annot"><span class="annottext">TmState
</span><a href="#local-6989586621681374981"><span class="hs-identifier hs-var">ts</span></a></span></span><span> </span><span id="local-6989586621681374980"><span class="annot"><span class="annottext">Id
</span><a href="#local-6989586621681374980"><span class="hs-identifier hs-var">x</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-keyword">case</span><span> </span><span class="annot"><span class="annottext">TmState -&gt; Id -&gt; VarInfo
</span><a href="GHC.HsToCore.Pmc.Solver.html#lookupVarInfo"><span class="hs-identifier hs-var">lookupVarInfo</span></a></span><span> </span><span class="annot"><span class="annottext">TmState
</span><a href="#local-6989586621681374981"><span class="hs-identifier hs-var">ts</span></a></span><span> </span><span class="annot"><span class="annottext">Id
</span><a href="#local-6989586621681374980"><span class="hs-identifier hs-var">x</span></a></span><span> </span><span class="hs-keyword">of</span><span>
</span><span id="line-552"></span><span>  </span><span class="annot"><a href="GHC.HsToCore.Pmc.Solver.Types.html#VI"><span class="hs-identifier hs-type">VI</span></a></span><span class="hs-special">{</span><span> </span><span class="annot"><span class="annottext">vi_pos :: VarInfo -&gt; [PmAltConApp]
</span><a href="GHC.HsToCore.Pmc.Solver.Types.html#vi_pos"><span class="hs-identifier hs-var">vi_pos</span></a></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">[PmAltConApp] -&gt; Maybe Id
</span><a href="#local-6989586621681374979"><span class="hs-identifier hs-var">as_newtype</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="../../base-4.16.4.0/src/GHC-Maybe.html#Just"><span class="hs-identifier hs-type">Just</span></a></span><span> </span><span id="local-6989586621681374978"><span class="annot"><span class="annottext">Id
</span><a href="#local-6989586621681374978"><span class="hs-identifier hs-var">y</span></a></span></span><span> </span><span class="hs-special">}</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="annottext">TmState -&gt; Id -&gt; (Id, VarInfo)
</span><a href="GHC.HsToCore.Pmc.Solver.html#lookupVarInfoNT"><span class="hs-identifier hs-var">lookupVarInfoNT</span></a></span><span> </span><span class="annot"><span class="annottext">TmState
</span><a href="#local-6989586621681374981"><span class="hs-identifier hs-var">ts</span></a></span><span> </span><span class="annot"><span class="annottext">Id
</span><a href="#local-6989586621681374978"><span class="hs-identifier hs-var">y</span></a></span><span>
</span><span id="line-553"></span><span>  </span><span id="local-6989586621681374977"><span class="annot"><span class="annottext">VarInfo
</span><a href="#local-6989586621681374977"><span class="hs-identifier hs-var">res</span></a></span></span><span>                                 </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Id
</span><a href="#local-6989586621681374980"><span class="hs-identifier hs-var">x</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">VarInfo
</span><a href="#local-6989586621681374977"><span class="hs-identifier hs-var">res</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-554"></span><span>  </span><span class="hs-keyword">where</span><span>
</span><span id="line-555"></span><span>    </span><span id="local-6989586621681374979"><span class="annot"><span class="annottext">as_newtype :: [PmAltConApp] -&gt; Maybe Id
</span><a href="#local-6989586621681374979"><span class="hs-identifier hs-var hs-var">as_newtype</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">forall a. [a] -&gt; Maybe a
</span><a href="../../base-4.16.4.0/src/Data-Maybe.html#listToMaybe"><span class="hs-identifier hs-var">listToMaybe</span></a></span><span> </span><span class="annot"><span class="annottext">forall b c a. (b -&gt; c) -&gt; (a -&gt; b) -&gt; a -&gt; c
</span><a href="../../base-4.16.4.0/src/GHC-Base.html#."><span class="hs-operator hs-var">.</span></a></span><span> </span><span class="annot"><span class="annottext">forall a b. (a -&gt; Maybe b) -&gt; [a] -&gt; [b]
</span><a href="../../base-4.16.4.0/src/Data-Maybe.html#mapMaybe"><span class="hs-identifier hs-var">mapMaybe</span></a></span><span> </span><span class="annot"><span class="annottext">PmAltConApp -&gt; Maybe Id
</span><a href="#local-6989586621681374974"><span class="hs-identifier hs-var">go</span></a></span><span>
</span><span id="line-556"></span><span>    </span><span id="local-6989586621681374974"><span class="annot"><span class="annottext">go :: PmAltConApp -&gt; Maybe Id
</span><a href="#local-6989586621681374974"><span class="hs-identifier hs-var hs-var">go</span></a></span></span><span> </span><span class="annot"><a href="GHC.HsToCore.Pmc.Solver.Types.html#PACA"><span class="hs-identifier hs-type">PACA</span></a></span><span class="hs-special">{</span><span class="annot"><span class="annottext">paca_con :: PmAltConApp -&gt; PmAltCon
</span><a href="GHC.HsToCore.Pmc.Solver.Types.html#paca_con"><span class="hs-identifier hs-var">paca_con</span></a></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><a href="GHC.HsToCore.Pmc.Solver.Types.html#PmAltConLike"><span class="hs-identifier hs-type">PmAltConLike</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="GHC.Core.ConLike.html#RealDataCon"><span class="hs-identifier hs-type">RealDataCon</span></a></span><span> </span><span id="local-6989586621681374971"><span class="annot"><span class="annottext">DataCon
</span><a href="#local-6989586621681374971"><span class="hs-identifier hs-var">dc</span></a></span></span><span class="hs-special">)</span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">paca_ids :: PmAltConApp -&gt; [Id]
</span><a href="GHC.HsToCore.Pmc.Solver.Types.html#paca_ids"><span class="hs-identifier hs-var">paca_ids</span></a></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-special">[</span><span id="local-6989586621681374969"><span class="annot"><span class="annottext">Id
</span><a href="#local-6989586621681374969"><span class="hs-identifier hs-var">y</span></a></span></span><span class="hs-special">]</span><span class="hs-special">}</span><span>
</span><span id="line-557"></span><span>      </span><span class="hs-glyph">|</span><span> </span><span class="annot"><span class="annottext">DataCon -&gt; Bool
</span><a href="GHC.Core.DataCon.html#isNewDataCon"><span class="hs-identifier hs-var">isNewDataCon</span></a></span><span> </span><span class="annot"><span class="annottext">DataCon
</span><a href="#local-6989586621681374971"><span class="hs-identifier hs-var">dc</span></a></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">forall a. a -&gt; Maybe a
</span><a href="../../base-4.16.4.0/src/GHC-Maybe.html#Just"><span class="hs-identifier hs-var">Just</span></a></span><span> </span><span class="annot"><span class="annottext">Id
</span><a href="#local-6989586621681374969"><span class="hs-identifier hs-var">y</span></a></span><span>
</span><span id="line-558"></span><span>    </span><span class="annot"><a href="#local-6989586621681374974"><span class="hs-identifier hs-var">go</span></a></span><span> </span><span class="annot"><span class="annottext">PmAltConApp
</span><span class="hs-identifier">_</span></span><span>                </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">forall a. Maybe a
</span><a href="../../base-4.16.4.0/src/GHC-Maybe.html#Nothing"><span class="hs-identifier hs-var">Nothing</span></a></span><span>
</span><span id="line-559"></span><span>
</span><span id="line-560"></span><span id="local-6989586621681375772"><span id="local-6989586621681375773"><span class="annot"><a href="GHC.HsToCore.Pmc.Solver.html#trvVarInfo"><span class="hs-identifier hs-type">trvVarInfo</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><a href="../../base-4.16.4.0/src/GHC-Base.html#Functor"><span class="hs-identifier hs-type">Functor</span></a></span><span> </span><span class="annot"><a href="#local-6989586621681375773"><span class="hs-identifier hs-type">f</span></a></span><span> </span><span class="hs-glyph">=&gt;</span><span> </span><span class="hs-special">(</span><span class="annot"><a href="GHC.HsToCore.Pmc.Solver.Types.html#VarInfo"><span class="hs-identifier hs-type">VarInfo</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="#local-6989586621681375773"><span class="hs-identifier hs-type">f</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="#local-6989586621681375772"><span class="hs-identifier hs-type">a</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><a href="GHC.HsToCore.Pmc.Solver.Types.html#VarInfo"><span class="hs-identifier hs-type">VarInfo</span></a></span><span class="hs-special">)</span><span class="hs-special">)</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="GHC.HsToCore.Pmc.Solver.Types.html#Nabla"><span class="hs-identifier hs-type">Nabla</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="GHC.Types.Var.html#Id"><span class="hs-identifier hs-type">Id</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="#local-6989586621681375773"><span class="hs-identifier hs-type">f</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="#local-6989586621681375772"><span class="hs-identifier hs-type">a</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><a href="GHC.HsToCore.Pmc.Solver.Types.html#Nabla"><span class="hs-identifier hs-type">Nabla</span></a></span><span class="hs-special">)</span></span></span><span>
</span><span id="line-561"></span><span id="trvVarInfo"><span class="annot"><span class="annottext">trvVarInfo :: forall (f :: * -&gt; *) a.
Functor f =&gt;
(VarInfo -&gt; f (a, VarInfo)) -&gt; Nabla -&gt; Id -&gt; f (a, Nabla)
</span><a href="GHC.HsToCore.Pmc.Solver.html#trvVarInfo"><span class="hs-identifier hs-var hs-var">trvVarInfo</span></a></span></span><span> </span><span id="local-6989586621681374963"><span class="annot"><span class="annottext">VarInfo -&gt; f (a, VarInfo)
</span><a href="#local-6989586621681374963"><span class="hs-identifier hs-var">f</span></a></span></span><span> </span><span id="local-6989586621681374962"><span class="annot"><span class="annottext">nabla :: Nabla
</span><a href="#local-6989586621681374962"><span class="hs-identifier hs-var">nabla</span></a></span></span><span class="hs-glyph">@</span><span class="annot"><a href="GHC.HsToCore.Pmc.Solver.Types.html#MkNabla"><span class="hs-identifier hs-type">MkNabla</span></a></span><span class="hs-special">{</span><span> </span><span class="annot"><span class="annottext">nabla_tm_st :: Nabla -&gt; TmState
</span><a href="GHC.HsToCore.Pmc.Solver.Types.html#nabla_tm_st"><span class="hs-identifier hs-var">nabla_tm_st</span></a></span><span> </span><span class="hs-glyph">=</span><span> </span><span id="local-6989586621681374959"><span class="annot"><span class="annottext">ts :: TmState
</span><a href="#local-6989586621681374959"><span class="hs-identifier hs-var">ts</span></a></span></span><span class="hs-glyph">@</span><span class="annot"><a href="GHC.HsToCore.Pmc.Solver.Types.html#TmSt"><span class="hs-identifier hs-type">TmSt</span></a></span><span class="hs-special">{</span><span class="annot"><span class="annottext">ts_facts :: TmState -&gt; UniqSDFM Id VarInfo
</span><a href="GHC.HsToCore.Pmc.Solver.Types.html#ts_facts"><span class="hs-identifier hs-var">ts_facts</span></a></span><span> </span><span class="hs-glyph">=</span><span> </span><span id="local-6989586621681374957"><span class="annot"><span class="annottext">UniqSDFM Id VarInfo
</span><a href="#local-6989586621681374957"><span class="hs-identifier hs-var">env</span></a></span></span><span class="hs-special">}</span><span> </span><span class="hs-special">}</span><span> </span><span id="local-6989586621681374956"><span class="annot"><span class="annottext">Id
</span><a href="#local-6989586621681374956"><span class="hs-identifier hs-var">x</span></a></span></span><span>
</span><span id="line-562"></span><span>  </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">(a, VarInfo) -&gt; (a, Nabla)
</span><a href="#local-6989586621681374955"><span class="hs-identifier hs-var">set_vi</span></a></span><span> </span><span class="annot"><span class="annottext">forall (f :: * -&gt; *) a b. Functor f =&gt; (a -&gt; b) -&gt; f a -&gt; f b
</span><a href="../../base-4.16.4.0/src/Data-Functor.html#%3C%24%3E"><span class="hs-operator hs-var">&lt;$&gt;</span></a></span><span> </span><span class="annot"><span class="annottext">VarInfo -&gt; f (a, VarInfo)
</span><a href="#local-6989586621681374963"><span class="hs-identifier hs-var">f</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">TmState -&gt; Id -&gt; VarInfo
</span><a href="GHC.HsToCore.Pmc.Solver.html#lookupVarInfo"><span class="hs-identifier hs-var">lookupVarInfo</span></a></span><span> </span><span class="annot"><span class="annottext">TmState
</span><a href="#local-6989586621681374959"><span class="hs-identifier hs-var">ts</span></a></span><span> </span><span class="annot"><span class="annottext">Id
</span><a href="#local-6989586621681374956"><span class="hs-identifier hs-var">x</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-563"></span><span>  </span><span class="hs-keyword">where</span><span>
</span><span id="line-564"></span><span>    </span><span id="local-6989586621681374955"><span class="annot"><span class="annottext">set_vi :: (a, VarInfo) -&gt; (a, Nabla)
</span><a href="#local-6989586621681374955"><span class="hs-identifier hs-var hs-var">set_vi</span></a></span></span><span> </span><span class="hs-special">(</span><span id="local-6989586621681374954"><span class="annot"><span class="annottext">a
</span><a href="#local-6989586621681374954"><span class="hs-identifier hs-var">a</span></a></span></span><span class="hs-special">,</span><span> </span><span id="local-6989586621681374953"><span class="annot"><span class="annottext">VarInfo
</span><a href="#local-6989586621681374953"><span class="hs-identifier hs-var">vi'</span></a></span></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">=</span><span>
</span><span id="line-565"></span><span>      </span><span class="hs-special">(</span><span class="annot"><span class="annottext">a
</span><a href="#local-6989586621681374954"><span class="hs-identifier hs-var">a</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">Nabla
</span><a href="#local-6989586621681374962"><span class="hs-identifier hs-var">nabla</span></a></span><span class="hs-special">{</span><span> </span><span class="annot"><span class="annottext">nabla_tm_st :: TmState
</span><a href="GHC.HsToCore.Pmc.Solver.Types.html#nabla_tm_st"><span class="hs-identifier hs-var">nabla_tm_st</span></a></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">TmState
</span><a href="#local-6989586621681374959"><span class="hs-identifier hs-var">ts</span></a></span><span class="hs-special">{</span><span> </span><span class="annot"><span class="annottext">ts_facts :: UniqSDFM Id VarInfo
</span><a href="GHC.HsToCore.Pmc.Solver.Types.html#ts_facts"><span class="hs-identifier hs-var">ts_facts</span></a></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">forall key ele.
Uniquable key =&gt;
UniqSDFM key ele -&gt; key -&gt; ele -&gt; UniqSDFM key ele
</span><a href="GHC.Types.Unique.SDFM.html#addToUSDFM"><span class="hs-identifier hs-var">addToUSDFM</span></a></span><span> </span><span class="annot"><span class="annottext">UniqSDFM Id VarInfo
</span><a href="#local-6989586621681374957"><span class="hs-identifier hs-var">env</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">VarInfo -&gt; Id
</span><a href="GHC.HsToCore.Pmc.Solver.Types.html#vi_id"><span class="hs-identifier hs-var">vi_id</span></a></span><span> </span><span class="annot"><span class="annottext">VarInfo
</span><a href="#local-6989586621681374953"><span class="hs-identifier hs-var">vi'</span></a></span><span class="hs-special">)</span><span> </span><span class="annot"><span class="annottext">VarInfo
</span><a href="#local-6989586621681374953"><span class="hs-identifier hs-var">vi'</span></a></span><span> </span><span class="hs-special">}</span><span> </span><span class="hs-special">}</span><span class="hs-special">)</span><span>
</span><span id="line-566"></span><span>
</span><span id="line-567"></span><span class="hs-comment">{- Note [Coverage checking Newtype matches]
~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~
Newtypes have quite peculiar match semantics compared to ordinary DataCons. In a
pattern-match, they behave like a irrefutable (lazy) match, but for inhabitation
testing purposes (e.g. at construction sites), they behave rather like a DataCon
with a *strict* field, because they don't contribute their own bottom and are
inhabited iff the wrapped type is inhabited.

This distinction becomes apparent in #17248:

  newtype T2 a = T2 a
  g _      True = ()
  g (T2 _) True = ()
  g !_     True = ()

If we treat Newtypes like we treat regular DataCons, we would mark the third
clause as redundant, which clearly is unsound. The solution:
1. 'isPmAltConMatchStrict' returns False for newtypes, indicating that a
   newtype match is lazy.
2. When we find @x ~ T2 y@, transfer all constraints on @x@ (which involve @&#8869;@)
   to @y@, similar to what 'equate' does, and don't add a @x &#8769; &#8869;@ constraint.
   This way, the third clause will still be marked as inaccessible RHS instead
   of redundant. This is ensured by calling 'lookupVarInfoNT'.
3. Immediately reject when we find @x &#8769; T2@.
Handling of Newtypes is also described in the Appendix of the Lower Your Guards paper,
where you can find the solution in a perhaps more digestible format.
-}</span><span>
</span><span id="line-594"></span><span>
</span><span id="line-595"></span><span class="hs-comment">------------------------------------------------</span><span>
</span><span id="line-596"></span><span class="hs-comment">-- * Exported utility functions querying 'Nabla'</span><span>
</span><span id="line-597"></span><span>
</span><span id="line-598"></span><span class="annot"><a href="GHC.HsToCore.Pmc.Solver.html#lookupRefuts"><span class="hs-identifier hs-type">lookupRefuts</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><a href="GHC.HsToCore.Pmc.Solver.Types.html#Nabla"><span class="hs-identifier hs-type">Nabla</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="GHC.Types.Var.html#Id"><span class="hs-identifier hs-type">Id</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-special">[</span><span class="annot"><a href="GHC.HsToCore.Pmc.Solver.Types.html#PmAltCon"><span class="hs-identifier hs-type">PmAltCon</span></a></span><span class="hs-special">]</span><span>
</span><span id="line-599"></span><span class="hs-comment">-- Unfortunately we need the extra bit of polymorphism and the unfortunate</span><span>
</span><span id="line-600"></span><span class="hs-comment">-- duplication of lookupVarInfo here.</span><span>
</span><span id="line-601"></span><span id="lookupRefuts"><span class="annot"><span class="annottext">lookupRefuts :: Nabla -&gt; Id -&gt; [PmAltCon]
</span><a href="GHC.HsToCore.Pmc.Solver.html#lookupRefuts"><span class="hs-identifier hs-var hs-var">lookupRefuts</span></a></span></span><span> </span><span class="annot"><a href="GHC.HsToCore.Pmc.Solver.Types.html#MkNabla"><span class="hs-identifier hs-type">MkNabla</span></a></span><span class="hs-special">{</span><span> </span><span class="annot"><span class="annottext">nabla_tm_st :: Nabla -&gt; TmState
</span><a href="GHC.HsToCore.Pmc.Solver.Types.html#nabla_tm_st"><span class="hs-identifier hs-var">nabla_tm_st</span></a></span><span> </span><span class="hs-glyph">=</span><span> </span><span id="local-6989586621681374951"><span class="annot"><span class="annottext">TmState
</span><a href="#local-6989586621681374951"><span class="hs-identifier hs-var">ts</span></a></span></span><span> </span><span class="hs-special">}</span><span> </span><span id="local-6989586621681374950"><span class="annot"><span class="annottext">Id
</span><a href="#local-6989586621681374950"><span class="hs-identifier hs-var">x</span></a></span></span><span> </span><span class="hs-glyph">=</span><span>
</span><span id="line-602"></span><span>  </span><span class="annot"><span class="annottext">PmAltConSet -&gt; [PmAltCon]
</span><a href="GHC.HsToCore.Pmc.Solver.Types.html#pmAltConSetElems"><span class="hs-identifier hs-var">pmAltConSetElems</span></a></span><span> </span><span class="annot"><span class="annottext">forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><a href="../../base-4.16.4.0/src/GHC-Base.html#%24"><span class="hs-operator hs-var">$</span></a></span><span> </span><span class="annot"><span class="annottext">VarInfo -&gt; PmAltConSet
</span><a href="GHC.HsToCore.Pmc.Solver.Types.html#vi_neg"><span class="hs-identifier hs-var">vi_neg</span></a></span><span> </span><span class="annot"><span class="annottext">forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><a href="../../base-4.16.4.0/src/GHC-Base.html#%24"><span class="hs-operator hs-var">$</span></a></span><span> </span><span class="annot"><span class="annottext">TmState -&gt; Id -&gt; VarInfo
</span><a href="GHC.HsToCore.Pmc.Solver.html#lookupVarInfo"><span class="hs-identifier hs-var">lookupVarInfo</span></a></span><span> </span><span class="annot"><span class="annottext">TmState
</span><a href="#local-6989586621681374951"><span class="hs-identifier hs-var">ts</span></a></span><span> </span><span class="annot"><span class="annottext">Id
</span><a href="#local-6989586621681374950"><span class="hs-identifier hs-var">x</span></a></span><span>
</span><span id="line-603"></span><span>
</span><span id="line-604"></span><span class="annot"><a href="GHC.HsToCore.Pmc.Solver.html#isDataConSolution"><span class="hs-identifier hs-type">isDataConSolution</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><a href="GHC.HsToCore.Pmc.Solver.Types.html#PmAltConApp"><span class="hs-identifier hs-type">PmAltConApp</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="hs-identifier hs-type">Bool</span></span><span>
</span><span id="line-605"></span><span id="isDataConSolution"><span class="annot"><span class="annottext">isDataConSolution :: PmAltConApp -&gt; Bool
</span><a href="GHC.HsToCore.Pmc.Solver.html#isDataConSolution"><span class="hs-identifier hs-var hs-var">isDataConSolution</span></a></span></span><span> </span><span class="annot"><a href="GHC.HsToCore.Pmc.Solver.Types.html#PACA"><span class="hs-identifier hs-type">PACA</span></a></span><span class="hs-special">{</span><span class="annot"><span class="annottext">paca_con :: PmAltConApp -&gt; PmAltCon
</span><a href="GHC.HsToCore.Pmc.Solver.Types.html#paca_con"><span class="hs-identifier hs-var">paca_con</span></a></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><a href="GHC.HsToCore.Pmc.Solver.Types.html#PmAltConLike"><span class="hs-identifier hs-type">PmAltConLike</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="GHC.Core.ConLike.html#RealDataCon"><span class="hs-identifier hs-type">RealDataCon</span></a></span><span> </span><span class="annot"><span class="annottext">DataCon
</span><span class="hs-identifier">_</span></span><span class="hs-special">)</span><span class="hs-special">}</span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">Bool
</span><span class="hs-identifier hs-var">True</span></span><span>
</span><span id="line-606"></span><span class="annot"><a href="GHC.HsToCore.Pmc.Solver.html#isDataConSolution"><span class="hs-identifier hs-var">isDataConSolution</span></a></span><span> </span><span class="annot"><span class="annottext">PmAltConApp
</span><span class="hs-identifier">_</span></span><span>                                             </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">Bool
</span><span class="hs-identifier hs-var">False</span></span><span>
</span><span id="line-607"></span><span>
</span><span id="line-608"></span><span class="hs-comment">-- @lookupSolution nabla x@ picks a single solution ('vi_pos') of @x@ from</span><span>
</span><span id="line-609"></span><span class="hs-comment">-- possibly many, preferring 'RealDataCon' solutions whenever possible.</span><span>
</span><span id="line-610"></span><span class="annot"><a href="GHC.HsToCore.Pmc.Solver.html#lookupSolution"><span class="hs-identifier hs-type">lookupSolution</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><a href="GHC.HsToCore.Pmc.Solver.Types.html#Nabla"><span class="hs-identifier hs-type">Nabla</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="GHC.Types.Var.html#Id"><span class="hs-identifier hs-type">Id</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="../../base-4.16.4.0/src/GHC-Maybe.html#Maybe"><span class="hs-identifier hs-type">Maybe</span></a></span><span> </span><span class="annot"><a href="GHC.HsToCore.Pmc.Solver.Types.html#PmAltConApp"><span class="hs-identifier hs-type">PmAltConApp</span></a></span><span>
</span><span id="line-611"></span><span id="lookupSolution"><span class="annot"><span class="annottext">lookupSolution :: Nabla -&gt; Id -&gt; Maybe PmAltConApp
</span><a href="GHC.HsToCore.Pmc.Solver.html#lookupSolution"><span class="hs-identifier hs-var hs-var">lookupSolution</span></a></span></span><span> </span><span id="local-6989586621681374947"><span class="annot"><span class="annottext">Nabla
</span><a href="#local-6989586621681374947"><span class="hs-identifier hs-var">nabla</span></a></span></span><span> </span><span id="local-6989586621681374946"><span class="annot"><span class="annottext">Id
</span><a href="#local-6989586621681374946"><span class="hs-identifier hs-var">x</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-keyword">case</span><span> </span><span class="annot"><span class="annottext">VarInfo -&gt; [PmAltConApp]
</span><a href="GHC.HsToCore.Pmc.Solver.Types.html#vi_pos"><span class="hs-identifier hs-var">vi_pos</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">TmState -&gt; Id -&gt; VarInfo
</span><a href="GHC.HsToCore.Pmc.Solver.html#lookupVarInfo"><span class="hs-identifier hs-var">lookupVarInfo</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Nabla -&gt; TmState
</span><a href="GHC.HsToCore.Pmc.Solver.Types.html#nabla_tm_st"><span class="hs-identifier hs-var">nabla_tm_st</span></a></span><span> </span><span class="annot"><span class="annottext">Nabla
</span><a href="#local-6989586621681374947"><span class="hs-identifier hs-var">nabla</span></a></span><span class="hs-special">)</span><span> </span><span class="annot"><span class="annottext">Id
</span><a href="#local-6989586621681374946"><span class="hs-identifier hs-var">x</span></a></span><span class="hs-special">)</span><span> </span><span class="hs-keyword">of</span><span>
</span><span id="line-612"></span><span>  </span><span class="hs-special">[</span><span class="hs-special">]</span><span>                                         </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="annottext">forall a. Maybe a
</span><a href="../../base-4.16.4.0/src/GHC-Maybe.html#Nothing"><span class="hs-identifier hs-var">Nothing</span></a></span><span>
</span><span id="line-613"></span><span>  </span><span id="local-6989586621681374945"><span class="annot"><span class="annottext">[PmAltConApp]
</span><a href="#local-6989586621681374945"><span class="hs-identifier hs-var">pos</span></a></span></span><span>
</span><span id="line-614"></span><span>    </span><span class="hs-glyph">|</span><span> </span><span class="annot"><a href="../../base-4.16.4.0/src/GHC-Maybe.html#Just"><span class="hs-identifier hs-type">Just</span></a></span><span> </span><span id="local-6989586621681374944"><span class="annot"><span class="annottext">PmAltConApp
</span><a href="#local-6989586621681374944"><span class="hs-identifier hs-var">sol</span></a></span></span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">forall (t :: * -&gt; *) a. Foldable t =&gt; (a -&gt; Bool) -&gt; t a -&gt; Maybe a
</span><a href="../../base-4.16.4.0/src/Data-Foldable.html#find"><span class="hs-identifier hs-var">find</span></a></span><span> </span><span class="annot"><span class="annottext">PmAltConApp -&gt; Bool
</span><a href="GHC.HsToCore.Pmc.Solver.html#isDataConSolution"><span class="hs-identifier hs-var">isDataConSolution</span></a></span><span> </span><span class="annot"><span class="annottext">[PmAltConApp]
</span><a href="#local-6989586621681374945"><span class="hs-identifier hs-var">pos</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="annottext">forall a. a -&gt; Maybe a
</span><a href="../../base-4.16.4.0/src/GHC-Maybe.html#Just"><span class="hs-identifier hs-var">Just</span></a></span><span> </span><span class="annot"><span class="annottext">PmAltConApp
</span><a href="#local-6989586621681374944"><span class="hs-identifier hs-var">sol</span></a></span><span>
</span><span id="line-615"></span><span>    </span><span class="hs-glyph">|</span><span> </span><span class="annot"><span class="annottext">Bool
</span><a href="../../base-4.16.4.0/src/GHC-Base.html#otherwise"><span class="hs-identifier hs-var">otherwise</span></a></span><span>                              </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="annottext">forall a. a -&gt; Maybe a
</span><a href="../../base-4.16.4.0/src/GHC-Maybe.html#Just"><span class="hs-identifier hs-var">Just</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">forall a. [a] -&gt; a
</span><a href="../../base-4.16.4.0/src/GHC-List.html#head"><span class="hs-identifier hs-var">head</span></a></span><span> </span><span class="annot"><span class="annottext">[PmAltConApp]
</span><a href="#local-6989586621681374945"><span class="hs-identifier hs-var">pos</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-616"></span><span>
</span><span id="line-617"></span><span class="hs-comment">-------------------------</span><span>
</span><span id="line-618"></span><span class="hs-comment">-- * Adding &#966; constraints</span><span>
</span><span id="line-619"></span><span class="hs-comment">--</span><span>
</span><span id="line-620"></span><span class="hs-comment">-- Figure 7 in the LYG paper.</span><span>
</span><span id="line-621"></span><span>
</span><span id="line-622"></span><span class="hs-comment">-- | A high-level pattern-match constraint. Corresponds to &#966; from Figure 3 of</span><span>
</span><span id="line-623"></span><span class="hs-comment">-- the LYG paper.</span><span>
</span><span id="line-624"></span><span class="hs-keyword">data</span><span> </span><span id="PhiCt"><span class="annot"><a href="GHC.HsToCore.Pmc.Solver.html#PhiCt"><span class="hs-identifier hs-var">PhiCt</span></a></span></span><span>
</span><span id="line-625"></span><span>  </span><span class="hs-glyph">=</span><span> </span><span id="PhiTyCt"><span class="annot"><a href="GHC.HsToCore.Pmc.Solver.html#PhiTyCt"><span class="hs-identifier hs-var">PhiTyCt</span></a></span></span><span> </span><span class="hs-glyph">!</span><span class="annot"><a href="GHC.Core.TyCo.Rep.html#PredType"><span class="hs-identifier hs-type">PredType</span></a></span><span>
</span><span id="line-626"></span><span>  </span><span class="hs-comment">-- ^ A type constraint &quot;T ~ U&quot;.</span><span>
</span><span id="line-627"></span><span>  </span><span class="hs-glyph">|</span><span> </span><span id="PhiCoreCt"><span class="annot"><a href="GHC.HsToCore.Pmc.Solver.html#PhiCoreCt"><span class="hs-identifier hs-var">PhiCoreCt</span></a></span></span><span>    </span><span class="hs-glyph">!</span><span class="annot"><a href="GHC.Types.Var.html#Id"><span class="hs-identifier hs-type">Id</span></a></span><span> </span><span class="hs-glyph">!</span><span class="annot"><a href="GHC.Core.html#CoreExpr"><span class="hs-identifier hs-type">CoreExpr</span></a></span><span>
</span><span id="line-628"></span><span>  </span><span class="hs-comment">-- ^ @PhiCoreCt x e@ encodes &quot;x ~ e&quot;, equating @x@ with the 'CoreExpr' @e@.</span><span>
</span><span id="line-629"></span><span>  </span><span class="hs-glyph">|</span><span> </span><span id="PhiConCt"><span class="annot"><a href="GHC.HsToCore.Pmc.Solver.html#PhiConCt"><span class="hs-identifier hs-var">PhiConCt</span></a></span></span><span>     </span><span class="hs-glyph">!</span><span class="annot"><a href="GHC.Types.Var.html#Id"><span class="hs-identifier hs-type">Id</span></a></span><span> </span><span class="hs-glyph">!</span><span class="annot"><a href="GHC.HsToCore.Pmc.Solver.Types.html#PmAltCon"><span class="hs-identifier hs-type">PmAltCon</span></a></span><span> </span><span class="hs-glyph">!</span><span class="hs-special">[</span><span class="annot"><a href="GHC.Types.Var.html#TyVar"><span class="hs-identifier hs-type">TyVar</span></a></span><span class="hs-special">]</span><span> </span><span class="hs-glyph">!</span><span class="hs-special">[</span><span class="annot"><a href="GHC.Core.TyCo.Rep.html#PredType"><span class="hs-identifier hs-type">PredType</span></a></span><span class="hs-special">]</span><span> </span><span class="hs-glyph">!</span><span class="hs-special">[</span><span class="annot"><a href="GHC.Types.Var.html#Id"><span class="hs-identifier hs-type">Id</span></a></span><span class="hs-special">]</span><span>
</span><span id="line-630"></span><span>  </span><span class="hs-comment">-- ^ @PhiConCt x K tvs dicts ys@ encodes @K \@tvs dicts ys &lt;- x@, matching @x@</span><span>
</span><span id="line-631"></span><span>  </span><span class="hs-comment">-- against the 'PmAltCon' application @K \@tvs dicts ys@, binding @tvs@,</span><span>
</span><span id="line-632"></span><span>  </span><span class="hs-comment">-- @dicts@ and possibly unlifted fields @ys@ in the process.</span><span>
</span><span id="line-633"></span><span>  </span><span class="hs-comment">-- See Note [Strict fields and variables of unlifted type].</span><span>
</span><span id="line-634"></span><span>  </span><span class="hs-glyph">|</span><span> </span><span id="PhiNotConCt"><span class="annot"><a href="GHC.HsToCore.Pmc.Solver.html#PhiNotConCt"><span class="hs-identifier hs-var">PhiNotConCt</span></a></span></span><span>  </span><span class="hs-glyph">!</span><span class="annot"><a href="GHC.Types.Var.html#Id"><span class="hs-identifier hs-type">Id</span></a></span><span> </span><span class="hs-glyph">!</span><span class="annot"><a href="GHC.HsToCore.Pmc.Solver.Types.html#PmAltCon"><span class="hs-identifier hs-type">PmAltCon</span></a></span><span>
</span><span id="line-635"></span><span>  </span><span class="hs-comment">-- ^ @PhiNotConCt x K@ encodes &quot;x &#8769; K&quot;, asserting that @x@ can't be headed</span><span>
</span><span id="line-636"></span><span>  </span><span class="hs-comment">-- by @K@.</span><span>
</span><span id="line-637"></span><span>  </span><span class="hs-glyph">|</span><span> </span><span id="PhiBotCt"><span class="annot"><a href="GHC.HsToCore.Pmc.Solver.html#PhiBotCt"><span class="hs-identifier hs-var">PhiBotCt</span></a></span></span><span>     </span><span class="hs-glyph">!</span><span class="annot"><a href="GHC.Types.Var.html#Id"><span class="hs-identifier hs-type">Id</span></a></span><span>
</span><span id="line-638"></span><span>  </span><span class="hs-comment">-- ^ @PhiBotCt x@ encodes &quot;x ~ &#8869;&quot;, equating @x@ to &#8869;.</span><span>
</span><span id="line-639"></span><span>  </span><span class="hs-comment">-- by @K@.</span><span>
</span><span id="line-640"></span><span>  </span><span class="hs-glyph">|</span><span> </span><span id="PhiNotBotCt"><span class="annot"><a href="GHC.HsToCore.Pmc.Solver.html#PhiNotBotCt"><span class="hs-identifier hs-var">PhiNotBotCt</span></a></span></span><span> </span><span class="hs-glyph">!</span><span class="annot"><a href="GHC.Types.Var.html#Id"><span class="hs-identifier hs-type">Id</span></a></span><span>
</span><span id="line-641"></span><span>  </span><span class="hs-comment">-- ^ @PhiNotBotCt x y@ encodes &quot;x &#8769; &#8869;&quot;, asserting that @x@ can't be &#8869;.</span><span>
</span><span id="line-642"></span><span>
</span><span id="line-643"></span><span class="hs-keyword">instance</span><span> </span><span class="annot"><a href="GHC.Utils.Outputable.html#Outputable"><span class="hs-identifier hs-type">Outputable</span></a></span><span> </span><span class="annot"><a href="GHC.HsToCore.Pmc.Solver.html#PhiCt"><span class="hs-identifier hs-type">PhiCt</span></a></span><span> </span><span class="hs-keyword">where</span><span>
</span><span id="line-644"></span><span>  </span><span id="local-6989586621681374917"><span class="annot"><span class="annottext">ppr :: PhiCt -&gt; SDoc
</span><a href="#local-6989586621681374917"><span class="hs-identifier hs-var hs-var hs-var hs-var">ppr</span></a></span></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="GHC.HsToCore.Pmc.Solver.html#PhiTyCt"><span class="hs-identifier hs-type">PhiTyCt</span></a></span><span> </span><span id="local-6989586621681374916"><span class="annot"><span class="annottext">Type
</span><a href="#local-6989586621681374916"><span class="hs-identifier hs-var">ty_ct</span></a></span></span><span class="hs-special">)</span><span>                 </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">forall a. Outputable a =&gt; a -&gt; SDoc
</span><a href="GHC.Utils.Outputable.html#ppr"><span class="hs-identifier hs-var">ppr</span></a></span><span> </span><span class="annot"><span class="annottext">Type
</span><a href="#local-6989586621681374916"><span class="hs-identifier hs-var">ty_ct</span></a></span><span>
</span><span id="line-645"></span><span>  </span><span class="annot"><a href="GHC.Utils.Outputable.html#ppr"><span class="hs-identifier hs-var">ppr</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="GHC.HsToCore.Pmc.Solver.html#PhiCoreCt"><span class="hs-identifier hs-type">PhiCoreCt</span></a></span><span> </span><span id="local-6989586621681374915"><span class="annot"><span class="annottext">Id
</span><a href="#local-6989586621681374915"><span class="hs-identifier hs-var">x</span></a></span></span><span> </span><span id="local-6989586621681374914"><span class="annot"><span class="annottext">CoreExpr
</span><a href="#local-6989586621681374914"><span class="hs-identifier hs-var">e</span></a></span></span><span class="hs-special">)</span><span>                 </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">forall a. Outputable a =&gt; a -&gt; SDoc
</span><a href="GHC.Utils.Outputable.html#ppr"><span class="hs-identifier hs-var">ppr</span></a></span><span> </span><span class="annot"><span class="annottext">Id
</span><a href="#local-6989586621681374915"><span class="hs-identifier hs-var">x</span></a></span><span> </span><span class="annot"><span class="annottext">SDoc -&gt; SDoc -&gt; SDoc
</span><a href="GHC.Utils.Outputable.html#%3C%2B%3E"><span class="hs-operator hs-var">&lt;+&gt;</span></a></span><span> </span><span class="annot"><span class="annottext">Char -&gt; SDoc
</span><a href="GHC.Utils.Outputable.html#char"><span class="hs-identifier hs-var">char</span></a></span><span> </span><span class="annot"><span class="annottext">Char
</span><span class="hs-char">'~'</span></span><span> </span><span class="annot"><span class="annottext">SDoc -&gt; SDoc -&gt; SDoc
</span><a href="GHC.Utils.Outputable.html#%3C%2B%3E"><span class="hs-operator hs-var">&lt;+&gt;</span></a></span><span> </span><span class="annot"><span class="annottext">forall a. Outputable a =&gt; a -&gt; SDoc
</span><a href="GHC.Utils.Outputable.html#ppr"><span class="hs-identifier hs-var">ppr</span></a></span><span> </span><span class="annot"><span class="annottext">CoreExpr
</span><a href="#local-6989586621681374914"><span class="hs-identifier hs-var">e</span></a></span><span>
</span><span id="line-646"></span><span>  </span><span class="annot"><a href="GHC.Utils.Outputable.html#ppr"><span class="hs-identifier hs-var">ppr</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="GHC.HsToCore.Pmc.Solver.html#PhiConCt"><span class="hs-identifier hs-type">PhiConCt</span></a></span><span> </span><span id="local-6989586621681374912"><span class="annot"><span class="annottext">Id
</span><a href="#local-6989586621681374912"><span class="hs-identifier hs-var">x</span></a></span></span><span> </span><span id="local-6989586621681374911"><span class="annot"><span class="annottext">PmAltCon
</span><a href="#local-6989586621681374911"><span class="hs-identifier hs-var">con</span></a></span></span><span> </span><span id="local-6989586621681374910"><span class="annot"><span class="annottext">[Id]
</span><a href="#local-6989586621681374910"><span class="hs-identifier hs-var">tvs</span></a></span></span><span> </span><span id="local-6989586621681374909"><span class="annot"><span class="annottext">ThetaType
</span><a href="#local-6989586621681374909"><span class="hs-identifier hs-var">dicts</span></a></span></span><span> </span><span id="local-6989586621681374908"><span class="annot"><span class="annottext">[Id]
</span><a href="#local-6989586621681374908"><span class="hs-identifier hs-var">args</span></a></span></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">=</span><span>
</span><span id="line-647"></span><span>    </span><span class="annot"><span class="annottext">[SDoc] -&gt; SDoc
</span><a href="GHC.Utils.Outputable.html#hsep"><span class="hs-identifier hs-var">hsep</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">forall a. Outputable a =&gt; a -&gt; SDoc
</span><a href="GHC.Utils.Outputable.html#ppr"><span class="hs-identifier hs-var">ppr</span></a></span><span> </span><span class="annot"><span class="annottext">PmAltCon
</span><a href="#local-6989586621681374911"><span class="hs-identifier hs-var">con</span></a></span><span> </span><span class="annot"><span class="annottext">forall a. a -&gt; [a] -&gt; [a]
</span><span class="hs-glyph hs-var">:</span></span><span> </span><span class="annot"><span class="annottext">[SDoc]
</span><a href="#local-6989586621681374906"><span class="hs-identifier hs-var">pp_tvs</span></a></span><span> </span><span class="annot"><span class="annottext">forall a. [a] -&gt; [a] -&gt; [a]
</span><a href="../../base-4.16.4.0/src/GHC-Base.html#%2B%2B"><span class="hs-operator hs-var">++</span></a></span><span> </span><span class="annot"><span class="annottext">[SDoc]
</span><a href="#local-6989586621681374905"><span class="hs-identifier hs-var">pp_dicts</span></a></span><span> </span><span class="annot"><span class="annottext">forall a. [a] -&gt; [a] -&gt; [a]
</span><a href="../../base-4.16.4.0/src/GHC-Base.html#%2B%2B"><span class="hs-operator hs-var">++</span></a></span><span> </span><span class="annot"><span class="annottext">[SDoc]
</span><a href="#local-6989586621681374904"><span class="hs-identifier hs-var">pp_args</span></a></span><span class="hs-special">)</span><span> </span><span class="annot"><span class="annottext">SDoc -&gt; SDoc -&gt; SDoc
</span><a href="GHC.Utils.Outputable.html#%3C%2B%3E"><span class="hs-operator hs-var">&lt;+&gt;</span></a></span><span> </span><span class="annot"><span class="annottext">String -&gt; SDoc
</span><a href="GHC.Utils.Outputable.html#text"><span class="hs-identifier hs-var">text</span></a></span><span> </span><span class="annot"><span class="annottext">String
</span><span class="hs-string">&quot;&lt;-&quot;</span></span><span> </span><span class="annot"><span class="annottext">SDoc -&gt; SDoc -&gt; SDoc
</span><a href="GHC.Utils.Outputable.html#%3C%2B%3E"><span class="hs-operator hs-var">&lt;+&gt;</span></a></span><span> </span><span class="annot"><span class="annottext">forall a. Outputable a =&gt; a -&gt; SDoc
</span><a href="GHC.Utils.Outputable.html#ppr"><span class="hs-identifier hs-var">ppr</span></a></span><span> </span><span class="annot"><span class="annottext">Id
</span><a href="#local-6989586621681374912"><span class="hs-identifier hs-var">x</span></a></span><span>
</span><span id="line-648"></span><span>    </span><span class="hs-keyword">where</span><span>
</span><span id="line-649"></span><span>      </span><span id="local-6989586621681374906"><span class="annot"><span class="annottext">pp_tvs :: [SDoc]
</span><a href="#local-6989586621681374906"><span class="hs-identifier hs-var hs-var">pp_tvs</span></a></span></span><span>   </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">forall a b. (a -&gt; b) -&gt; [a] -&gt; [b]
</span><a href="../../base-4.16.4.0/src/GHC-Base.html#map"><span class="hs-identifier hs-var">map</span></a></span><span> </span><span class="hs-special">(</span><span class="hs-special">(</span><span class="annot"><span class="annottext">SDoc -&gt; SDoc -&gt; SDoc
</span><a href="GHC.Utils.Outputable.html#%3C%3E"><span class="hs-operator hs-var">&lt;&gt;</span></a></span><span> </span><span class="annot"><span class="annottext">Char -&gt; SDoc
</span><a href="GHC.Utils.Outputable.html#char"><span class="hs-identifier hs-var">char</span></a></span><span> </span><span class="annot"><span class="annottext">Char
</span><span class="hs-char">'@'</span></span><span class="hs-special">)</span><span> </span><span class="annot"><span class="annottext">forall b c a. (b -&gt; c) -&gt; (a -&gt; b) -&gt; a -&gt; c
</span><a href="../../base-4.16.4.0/src/GHC-Base.html#."><span class="hs-operator hs-var">.</span></a></span><span> </span><span class="annot"><span class="annottext">forall a. Outputable a =&gt; a -&gt; SDoc
</span><a href="GHC.Utils.Outputable.html#ppr"><span class="hs-identifier hs-var">ppr</span></a></span><span class="hs-special">)</span><span> </span><span class="annot"><span class="annottext">[Id]
</span><a href="#local-6989586621681374910"><span class="hs-identifier hs-var">tvs</span></a></span><span>
</span><span id="line-650"></span><span>      </span><span id="local-6989586621681374905"><span class="annot"><span class="annottext">pp_dicts :: [SDoc]
</span><a href="#local-6989586621681374905"><span class="hs-identifier hs-var hs-var">pp_dicts</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">forall a b. (a -&gt; b) -&gt; [a] -&gt; [b]
</span><a href="../../base-4.16.4.0/src/GHC-Base.html#map"><span class="hs-identifier hs-var">map</span></a></span><span> </span><span class="annot"><span class="annottext">forall a. Outputable a =&gt; a -&gt; SDoc
</span><a href="GHC.Utils.Outputable.html#ppr"><span class="hs-identifier hs-var">ppr</span></a></span><span> </span><span class="annot"><span class="annottext">ThetaType
</span><a href="#local-6989586621681374909"><span class="hs-identifier hs-var">dicts</span></a></span><span>
</span><span id="line-651"></span><span>      </span><span id="local-6989586621681374904"><span class="annot"><span class="annottext">pp_args :: [SDoc]
</span><a href="#local-6989586621681374904"><span class="hs-identifier hs-var hs-var">pp_args</span></a></span></span><span>  </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">forall a b. (a -&gt; b) -&gt; [a] -&gt; [b]
</span><a href="../../base-4.16.4.0/src/GHC-Base.html#map"><span class="hs-identifier hs-var">map</span></a></span><span> </span><span class="annot"><span class="annottext">forall a. Outputable a =&gt; a -&gt; SDoc
</span><a href="GHC.Utils.Outputable.html#ppr"><span class="hs-identifier hs-var">ppr</span></a></span><span> </span><span class="annot"><span class="annottext">[Id]
</span><a href="#local-6989586621681374908"><span class="hs-identifier hs-var">args</span></a></span><span>
</span><span id="line-652"></span><span>  </span><span class="annot"><a href="GHC.Utils.Outputable.html#ppr"><span class="hs-identifier hs-var">ppr</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="GHC.HsToCore.Pmc.Solver.html#PhiNotConCt"><span class="hs-identifier hs-type">PhiNotConCt</span></a></span><span> </span><span id="local-6989586621681374902"><span class="annot"><span class="annottext">Id
</span><a href="#local-6989586621681374902"><span class="hs-identifier hs-var">x</span></a></span></span><span> </span><span id="local-6989586621681374901"><span class="annot"><span class="annottext">PmAltCon
</span><a href="#local-6989586621681374901"><span class="hs-identifier hs-var">con</span></a></span></span><span class="hs-special">)</span><span>             </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">forall a. Outputable a =&gt; a -&gt; SDoc
</span><a href="GHC.Utils.Outputable.html#ppr"><span class="hs-identifier hs-var">ppr</span></a></span><span> </span><span class="annot"><span class="annottext">Id
</span><a href="#local-6989586621681374902"><span class="hs-identifier hs-var">x</span></a></span><span> </span><span class="annot"><span class="annottext">SDoc -&gt; SDoc -&gt; SDoc
</span><a href="GHC.Utils.Outputable.html#%3C%2B%3E"><span class="hs-operator hs-var">&lt;+&gt;</span></a></span><span> </span><span class="annot"><span class="annottext">String -&gt; SDoc
</span><a href="GHC.Utils.Outputable.html#text"><span class="hs-identifier hs-var">text</span></a></span><span> </span><span class="annot"><span class="annottext">String
</span><span class="hs-string">&quot;&#8769;&quot;</span></span><span> </span><span class="annot"><span class="annottext">SDoc -&gt; SDoc -&gt; SDoc
</span><a href="GHC.Utils.Outputable.html#%3C%2B%3E"><span class="hs-operator hs-var">&lt;+&gt;</span></a></span><span> </span><span class="annot"><span class="annottext">forall a. Outputable a =&gt; a -&gt; SDoc
</span><a href="GHC.Utils.Outputable.html#ppr"><span class="hs-identifier hs-var">ppr</span></a></span><span> </span><span class="annot"><span class="annottext">PmAltCon
</span><a href="#local-6989586621681374901"><span class="hs-identifier hs-var">con</span></a></span><span>
</span><span id="line-653"></span><span>  </span><span class="annot"><a href="GHC.Utils.Outputable.html#ppr"><span class="hs-identifier hs-var">ppr</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="GHC.HsToCore.Pmc.Solver.html#PhiBotCt"><span class="hs-identifier hs-type">PhiBotCt</span></a></span><span> </span><span id="local-6989586621681374900"><span class="annot"><span class="annottext">Id
</span><a href="#local-6989586621681374900"><span class="hs-identifier hs-var">x</span></a></span></span><span class="hs-special">)</span><span>                    </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">forall a. Outputable a =&gt; a -&gt; SDoc
</span><a href="GHC.Utils.Outputable.html#ppr"><span class="hs-identifier hs-var">ppr</span></a></span><span> </span><span class="annot"><span class="annottext">Id
</span><a href="#local-6989586621681374900"><span class="hs-identifier hs-var">x</span></a></span><span> </span><span class="annot"><span class="annottext">SDoc -&gt; SDoc -&gt; SDoc
</span><a href="GHC.Utils.Outputable.html#%3C%2B%3E"><span class="hs-operator hs-var">&lt;+&gt;</span></a></span><span> </span><span class="annot"><span class="annottext">String -&gt; SDoc
</span><a href="GHC.Utils.Outputable.html#text"><span class="hs-identifier hs-var">text</span></a></span><span> </span><span class="annot"><span class="annottext">String
</span><span class="hs-string">&quot;~ &#8869;&quot;</span></span><span>
</span><span id="line-654"></span><span>  </span><span class="annot"><a href="GHC.Utils.Outputable.html#ppr"><span class="hs-identifier hs-var">ppr</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="GHC.HsToCore.Pmc.Solver.html#PhiNotBotCt"><span class="hs-identifier hs-type">PhiNotBotCt</span></a></span><span> </span><span id="local-6989586621681374899"><span class="annot"><span class="annottext">Id
</span><a href="#local-6989586621681374899"><span class="hs-identifier hs-var">x</span></a></span></span><span class="hs-special">)</span><span>                 </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">forall a. Outputable a =&gt; a -&gt; SDoc
</span><a href="GHC.Utils.Outputable.html#ppr"><span class="hs-identifier hs-var">ppr</span></a></span><span> </span><span class="annot"><span class="annottext">Id
</span><a href="#local-6989586621681374899"><span class="hs-identifier hs-var">x</span></a></span><span> </span><span class="annot"><span class="annottext">SDoc -&gt; SDoc -&gt; SDoc
</span><a href="GHC.Utils.Outputable.html#%3C%2B%3E"><span class="hs-operator hs-var">&lt;+&gt;</span></a></span><span> </span><span class="annot"><span class="annottext">String -&gt; SDoc
</span><a href="GHC.Utils.Outputable.html#text"><span class="hs-identifier hs-var">text</span></a></span><span> </span><span class="annot"><span class="annottext">String
</span><span class="hs-string">&quot;&#8769; &#8869;&quot;</span></span><span>
</span><span id="line-655"></span><span>
</span><span id="line-656"></span><span class="hs-keyword">type</span><span> </span><span id="PhiCts"><span class="annot"><a href="GHC.HsToCore.Pmc.Solver.html#PhiCts"><span class="hs-identifier hs-var">PhiCts</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><a href="GHC.Data.Bag.html#Bag"><span class="hs-identifier hs-type">Bag</span></a></span><span> </span><span class="annot"><a href="GHC.HsToCore.Pmc.Solver.html#PhiCt"><span class="hs-identifier hs-type">PhiCt</span></a></span><span>
</span><span id="line-657"></span><span>
</span><span id="line-658"></span><span class="hs-comment">-- | The fuel for the inhabitation test.</span><span>
</span><span id="line-659"></span><span class="hs-comment">-- See Note [Fuel for the inhabitation test].</span><span>
</span><span id="line-660"></span><span class="annot"><a href="GHC.HsToCore.Pmc.Solver.html#initFuel"><span class="hs-identifier hs-type">initFuel</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><span class="hs-identifier hs-type">Int</span></span><span>
</span><span id="line-661"></span><span id="initFuel"><span class="annot"><span class="annottext">initFuel :: Int
</span><a href="GHC.HsToCore.Pmc.Solver.html#initFuel"><span class="hs-identifier hs-var hs-var">initFuel</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">Int
</span><span class="hs-number">4</span></span><span> </span><span class="hs-comment">-- 4 because it's the smallest number that passes f' in T17977b</span><span>
</span><span id="line-662"></span><span>
</span><span id="line-663"></span><span class="hs-comment">-- | Adds new constraints to 'Nabla' and returns 'Nothing' if that leads to a</span><span>
</span><span id="line-664"></span><span class="hs-comment">-- contradiction.</span><span>
</span><span id="line-665"></span><span class="hs-comment">--</span><span>
</span><span id="line-666"></span><span class="hs-comment">-- In terms of the paper, this function models the \(&#8853;_&#966;\) function in</span><span>
</span><span id="line-667"></span><span class="hs-comment">-- Figure 7 on batches of &#966; constraints.</span><span>
</span><span id="line-668"></span><span class="annot"><a href="GHC.HsToCore.Pmc.Solver.html#addPhiCts"><span class="hs-identifier hs-type">addPhiCts</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><a href="GHC.HsToCore.Pmc.Solver.Types.html#Nabla"><span class="hs-identifier hs-type">Nabla</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="GHC.HsToCore.Pmc.Solver.html#PhiCts"><span class="hs-identifier hs-type">PhiCts</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="GHC.HsToCore.Types.html#DsM"><span class="hs-identifier hs-type">DsM</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="../../base-4.16.4.0/src/GHC-Maybe.html#Maybe"><span class="hs-identifier hs-type">Maybe</span></a></span><span> </span><span class="annot"><a href="GHC.HsToCore.Pmc.Solver.Types.html#Nabla"><span class="hs-identifier hs-type">Nabla</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-669"></span><span class="hs-comment">-- See Note [TmState invariants].</span><span>
</span><span id="line-670"></span><span id="addPhiCts"><span class="annot"><span class="annottext">addPhiCts :: Nabla -&gt; PhiCts -&gt; IOEnv (Env DsGblEnv DsLclEnv) (Maybe Nabla)
</span><a href="GHC.HsToCore.Pmc.Solver.html#addPhiCts"><span class="hs-identifier hs-var hs-var">addPhiCts</span></a></span></span><span> </span><span id="local-6989586621681374897"><span class="annot"><span class="annottext">Nabla
</span><a href="#local-6989586621681374897"><span class="hs-identifier hs-var">nabla</span></a></span></span><span> </span><span id="local-6989586621681374896"><span class="annot"><span class="annottext">PhiCts
</span><a href="#local-6989586621681374896"><span class="hs-identifier hs-var">cts</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">forall (m :: * -&gt; *) a. MaybeT m a -&gt; m (Maybe a)
</span><a href="../../transformers-0.5.6.2/src/Control-Monad-Trans-Maybe.html#runMaybeT"><span class="hs-identifier hs-var">runMaybeT</span></a></span><span> </span><span class="annot"><span class="annottext">forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><a href="../../base-4.16.4.0/src/GHC-Base.html#%24"><span class="hs-operator hs-var">$</span></a></span><span> </span><span class="hs-keyword">do</span><span>
</span><span id="line-671"></span><span>  </span><span class="hs-keyword">let</span><span> </span><span class="hs-special">(</span><span id="local-6989586621681374894"><span class="annot"><span class="annottext">ThetaType
</span><a href="#local-6989586621681374894"><span class="hs-identifier hs-var">ty_cts</span></a></span></span><span class="hs-special">,</span><span> </span><span id="local-6989586621681374893"><span class="annot"><span class="annottext">[PhiCt]
</span><a href="#local-6989586621681374893"><span class="hs-identifier hs-var">tm_cts</span></a></span></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">PhiCts -&gt; (ThetaType, [PhiCt])
</span><a href="GHC.HsToCore.Pmc.Solver.html#partitionPhiCts"><span class="hs-identifier hs-var">partitionPhiCts</span></a></span><span> </span><span class="annot"><span class="annottext">PhiCts
</span><a href="#local-6989586621681374896"><span class="hs-identifier hs-var">cts</span></a></span><span>
</span><span id="line-672"></span><span>  </span><span id="local-6989586621681374891"><span class="annot"><span class="annottext">Nabla
</span><a href="#local-6989586621681374891"><span class="hs-identifier hs-var">nabla'</span></a></span></span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">Nabla -&gt; Bag Type -&gt; MaybeT (IOEnv (Env DsGblEnv DsLclEnv)) Nabla
</span><a href="GHC.HsToCore.Pmc.Solver.html#addTyCts"><span class="hs-identifier hs-var">addTyCts</span></a></span><span> </span><span class="annot"><span class="annottext">Nabla
</span><a href="#local-6989586621681374897"><span class="hs-identifier hs-var">nabla</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">forall a. [a] -&gt; Bag a
</span><a href="GHC.Data.Bag.html#listToBag"><span class="hs-identifier hs-var">listToBag</span></a></span><span> </span><span class="annot"><span class="annottext">ThetaType
</span><a href="#local-6989586621681374894"><span class="hs-identifier hs-var">ty_cts</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-673"></span><span>  </span><span id="local-6989586621681374888"><span class="annot"><span class="annottext">Nabla
</span><a href="#local-6989586621681374888"><span class="hs-identifier hs-var">nabla''</span></a></span></span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">forall (t :: * -&gt; *) (m :: * -&gt; *) b a.
(Foldable t, Monad m) =&gt;
(b -&gt; a -&gt; m b) -&gt; b -&gt; t a -&gt; m b
</span><a href="../../base-4.16.4.0/src/Data-Foldable.html#foldlM"><span class="hs-identifier hs-var">foldlM</span></a></span><span> </span><span class="annot"><span class="annottext">Nabla -&gt; PhiCt -&gt; MaybeT (IOEnv (Env DsGblEnv DsLclEnv)) Nabla
</span><a href="GHC.HsToCore.Pmc.Solver.html#addPhiTmCt"><span class="hs-identifier hs-var">addPhiTmCt</span></a></span><span> </span><span class="annot"><span class="annottext">Nabla
</span><a href="#local-6989586621681374891"><span class="hs-identifier hs-var">nabla'</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">forall a. [a] -&gt; Bag a
</span><a href="GHC.Data.Bag.html#listToBag"><span class="hs-identifier hs-var">listToBag</span></a></span><span> </span><span class="annot"><span class="annottext">[PhiCt]
</span><a href="#local-6989586621681374893"><span class="hs-identifier hs-var">tm_cts</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-674"></span><span>  </span><span class="annot"><span class="annottext">Int
-&gt; TyState -&gt; Nabla -&gt; MaybeT (IOEnv (Env DsGblEnv DsLclEnv)) Nabla
</span><a href="GHC.HsToCore.Pmc.Solver.html#inhabitationTest"><span class="hs-identifier hs-var">inhabitationTest</span></a></span><span> </span><span class="annot"><span class="annottext">Int
</span><a href="GHC.HsToCore.Pmc.Solver.html#initFuel"><span class="hs-identifier hs-var">initFuel</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Nabla -&gt; TyState
</span><a href="GHC.HsToCore.Pmc.Solver.Types.html#nabla_ty_st"><span class="hs-identifier hs-var">nabla_ty_st</span></a></span><span> </span><span class="annot"><span class="annottext">Nabla
</span><a href="#local-6989586621681374897"><span class="hs-identifier hs-var">nabla</span></a></span><span class="hs-special">)</span><span> </span><span class="annot"><span class="annottext">Nabla
</span><a href="#local-6989586621681374888"><span class="hs-identifier hs-var">nabla''</span></a></span><span>
</span><span id="line-675"></span><span>
</span><span id="line-676"></span><span class="annot"><a href="GHC.HsToCore.Pmc.Solver.html#partitionPhiCts"><span class="hs-identifier hs-type">partitionPhiCts</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><a href="GHC.HsToCore.Pmc.Solver.html#PhiCts"><span class="hs-identifier hs-type">PhiCts</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-special">(</span><span class="hs-special">[</span><span class="annot"><a href="GHC.Core.TyCo.Rep.html#PredType"><span class="hs-identifier hs-type">PredType</span></a></span><span class="hs-special">]</span><span class="hs-special">,</span><span> </span><span class="hs-special">[</span><span class="annot"><a href="GHC.HsToCore.Pmc.Solver.html#PhiCt"><span class="hs-identifier hs-type">PhiCt</span></a></span><span class="hs-special">]</span><span class="hs-special">)</span><span>
</span><span id="line-677"></span><span id="partitionPhiCts"><span class="annot"><span class="annottext">partitionPhiCts :: PhiCts -&gt; (ThetaType, [PhiCt])
</span><a href="GHC.HsToCore.Pmc.Solver.html#partitionPhiCts"><span class="hs-identifier hs-var hs-var">partitionPhiCts</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">forall a b. [Either a b] -&gt; ([a], [b])
</span><a href="../../base-4.16.4.0/src/Data-Either.html#partitionEithers"><span class="hs-identifier hs-var">partitionEithers</span></a></span><span> </span><span class="annot"><span class="annottext">forall b c a. (b -&gt; c) -&gt; (a -&gt; b) -&gt; a -&gt; c
</span><a href="../../base-4.16.4.0/src/GHC-Base.html#."><span class="hs-operator hs-var">.</span></a></span><span> </span><span class="annot"><span class="annottext">forall a b. (a -&gt; b) -&gt; [a] -&gt; [b]
</span><a href="../../base-4.16.4.0/src/GHC-Base.html#map"><span class="hs-identifier hs-var">map</span></a></span><span> </span><span class="annot"><span class="annottext">PhiCt -&gt; Either Type PhiCt
</span><a href="#local-6989586621681374884"><span class="hs-identifier hs-var">to_either</span></a></span><span> </span><span class="annot"><span class="annottext">forall b c a. (b -&gt; c) -&gt; (a -&gt; b) -&gt; a -&gt; c
</span><a href="../../base-4.16.4.0/src/GHC-Base.html#."><span class="hs-operator hs-var">.</span></a></span><span> </span><span class="annot"><span class="annottext">forall (t :: * -&gt; *) a. Foldable t =&gt; t a -&gt; [a]
</span><a href="../../base-4.16.4.0/src/Data-Foldable.html#toList"><span class="hs-identifier hs-var">toList</span></a></span><span>
</span><span id="line-678"></span><span>  </span><span class="hs-keyword">where</span><span>
</span><span id="line-679"></span><span>    </span><span id="local-6989586621681374884"><span class="annot"><span class="annottext">to_either :: PhiCt -&gt; Either Type PhiCt
</span><a href="#local-6989586621681374884"><span class="hs-identifier hs-var hs-var">to_either</span></a></span></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="GHC.HsToCore.Pmc.Solver.html#PhiTyCt"><span class="hs-identifier hs-type">PhiTyCt</span></a></span><span> </span><span id="local-6989586621681374883"><span class="annot"><span class="annottext">Type
</span><a href="#local-6989586621681374883"><span class="hs-identifier hs-var">pred_ty</span></a></span></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">forall a b. a -&gt; Either a b
</span><a href="../../base-4.16.4.0/src/Data-Either.html#Left"><span class="hs-identifier hs-var">Left</span></a></span><span> </span><span class="annot"><span class="annottext">Type
</span><a href="#local-6989586621681374883"><span class="hs-identifier hs-var">pred_ty</span></a></span><span>
</span><span id="line-680"></span><span>    </span><span class="annot"><a href="#local-6989586621681374884"><span class="hs-identifier hs-var">to_either</span></a></span><span> </span><span id="local-6989586621681374882"><span class="annot"><span class="annottext">PhiCt
</span><a href="#local-6989586621681374882"><span class="hs-identifier hs-var">ct</span></a></span></span><span>                </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">forall a b. b -&gt; Either a b
</span><a href="../../base-4.16.4.0/src/Data-Either.html#Right"><span class="hs-identifier hs-var">Right</span></a></span><span> </span><span class="annot"><span class="annottext">PhiCt
</span><a href="#local-6989586621681374882"><span class="hs-identifier hs-var">ct</span></a></span><span>
</span><span id="line-681"></span><span>
</span><span id="line-682"></span><span class="hs-comment">-----------------------------</span><span>
</span><span id="line-683"></span><span class="hs-comment">-- ** Adding type constraints</span><span>
</span><span id="line-684"></span><span>
</span><span id="line-685"></span><span class="hs-comment">-- | Adds new type-level constraints by calling out to the type-checker via</span><span>
</span><span id="line-686"></span><span class="hs-comment">-- 'tyOracle'.</span><span>
</span><span id="line-687"></span><span class="annot"><a href="GHC.HsToCore.Pmc.Solver.html#addTyCts"><span class="hs-identifier hs-type">addTyCts</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><a href="GHC.HsToCore.Pmc.Solver.Types.html#Nabla"><span class="hs-identifier hs-type">Nabla</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="GHC.Data.Bag.html#Bag"><span class="hs-identifier hs-type">Bag</span></a></span><span> </span><span class="annot"><a href="GHC.Core.TyCo.Rep.html#PredType"><span class="hs-identifier hs-type">PredType</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="../../transformers-0.5.6.2/src/Control-Monad-Trans-Maybe.html#MaybeT"><span class="hs-identifier hs-type">MaybeT</span></a></span><span> </span><span class="annot"><a href="GHC.HsToCore.Types.html#DsM"><span class="hs-identifier hs-type">DsM</span></a></span><span> </span><span class="annot"><a href="GHC.HsToCore.Pmc.Solver.Types.html#Nabla"><span class="hs-identifier hs-type">Nabla</span></a></span><span>
</span><span id="line-688"></span><span id="addTyCts"><span class="annot"><span class="annottext">addTyCts :: Nabla -&gt; Bag Type -&gt; MaybeT (IOEnv (Env DsGblEnv DsLclEnv)) Nabla
</span><a href="GHC.HsToCore.Pmc.Solver.html#addTyCts"><span class="hs-identifier hs-var hs-var">addTyCts</span></a></span></span><span> </span><span id="local-6989586621681374881"><span class="annot"><span class="annottext">nabla :: Nabla
</span><a href="#local-6989586621681374881"><span class="hs-identifier hs-var">nabla</span></a></span></span><span class="hs-glyph">@</span><span class="annot"><a href="GHC.HsToCore.Pmc.Solver.Types.html#MkNabla"><span class="hs-identifier hs-type">MkNabla</span></a></span><span class="hs-special">{</span><span> </span><span class="annot"><span class="annottext">nabla_ty_st :: Nabla -&gt; TyState
</span><a href="GHC.HsToCore.Pmc.Solver.Types.html#nabla_ty_st"><span class="hs-identifier hs-var">nabla_ty_st</span></a></span><span> </span><span class="hs-glyph">=</span><span> </span><span id="local-6989586621681374880"><span class="annot"><span class="annottext">TyState
</span><a href="#local-6989586621681374880"><span class="hs-identifier hs-var">ty_st</span></a></span></span><span> </span><span class="hs-special">}</span><span> </span><span id="local-6989586621681374879"><span class="annot"><span class="annottext">Bag Type
</span><a href="#local-6989586621681374879"><span class="hs-identifier hs-var">new_ty_cs</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-keyword">do</span><span>
</span><span id="line-689"></span><span>  </span><span id="local-6989586621681374878"><span class="annot"><span class="annottext">TyState
</span><a href="#local-6989586621681374878"><span class="hs-identifier hs-var">ty_st'</span></a></span></span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">forall (m :: * -&gt; *) a. m (Maybe a) -&gt; MaybeT m a
</span><a href="../../transformers-0.5.6.2/src/Control-Monad-Trans-Maybe.html#MaybeT"><span class="hs-identifier hs-var">MaybeT</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">TyState -&gt; Bag Type -&gt; DsM (Maybe TyState)
</span><a href="GHC.HsToCore.Pmc.Solver.html#tyOracle"><span class="hs-identifier hs-var">tyOracle</span></a></span><span> </span><span class="annot"><span class="annottext">TyState
</span><a href="#local-6989586621681374880"><span class="hs-identifier hs-var">ty_st</span></a></span><span> </span><span class="annot"><span class="annottext">Bag Type
</span><a href="#local-6989586621681374879"><span class="hs-identifier hs-var">new_ty_cs</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-690"></span><span>  </span><span class="annot"><span class="annottext">forall (f :: * -&gt; *) a. Applicative f =&gt; a -&gt; f a
</span><a href="../../base-4.16.4.0/src/GHC-Base.html#pure"><span class="hs-identifier hs-var">pure</span></a></span><span> </span><span class="annot"><span class="annottext">Nabla
</span><a href="#local-6989586621681374881"><span class="hs-identifier hs-var">nabla</span></a></span><span class="hs-special">{</span><span> </span><span class="annot"><span class="annottext">nabla_ty_st :: TyState
</span><a href="GHC.HsToCore.Pmc.Solver.Types.html#nabla_ty_st"><span class="hs-identifier hs-var">nabla_ty_st</span></a></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">TyState
</span><a href="#local-6989586621681374878"><span class="hs-identifier hs-var">ty_st'</span></a></span><span> </span><span class="hs-special">}</span><span>
</span><span id="line-691"></span><span>
</span><span id="line-692"></span><span class="hs-comment">-- | Add some extra type constraints to the 'TyState'; return 'Nothing' if we</span><span>
</span><span id="line-693"></span><span class="hs-comment">-- find a contradiction (e.g. @Int ~ Bool@).</span><span>
</span><span id="line-694"></span><span class="annot"><a href="GHC.HsToCore.Pmc.Solver.html#tyOracle"><span class="hs-identifier hs-type">tyOracle</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><a href="GHC.HsToCore.Pmc.Solver.Types.html#TyState"><span class="hs-identifier hs-type">TyState</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="GHC.Data.Bag.html#Bag"><span class="hs-identifier hs-type">Bag</span></a></span><span> </span><span class="annot"><a href="GHC.Core.TyCo.Rep.html#PredType"><span class="hs-identifier hs-type">PredType</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="GHC.HsToCore.Types.html#DsM"><span class="hs-identifier hs-type">DsM</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="../../base-4.16.4.0/src/GHC-Maybe.html#Maybe"><span class="hs-identifier hs-type">Maybe</span></a></span><span> </span><span class="annot"><a href="GHC.HsToCore.Pmc.Solver.Types.html#TyState"><span class="hs-identifier hs-type">TyState</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-695"></span><span id="tyOracle"><span class="annot"><span class="annottext">tyOracle :: TyState -&gt; Bag Type -&gt; DsM (Maybe TyState)
</span><a href="GHC.HsToCore.Pmc.Solver.html#tyOracle"><span class="hs-identifier hs-var hs-var">tyOracle</span></a></span></span><span> </span><span id="local-6989586621681374875"><span class="annot"><span class="annottext">ty_st :: TyState
</span><a href="#local-6989586621681374875"><span class="hs-identifier hs-var">ty_st</span></a></span></span><span class="hs-glyph">@</span><span class="hs-special">(</span><span class="annot"><a href="GHC.HsToCore.Pmc.Solver.Types.html#TySt"><span class="hs-identifier hs-type">TySt</span></a></span><span> </span><span id="local-6989586621681374874"><span class="annot"><span class="annottext">Int
</span><a href="#local-6989586621681374874"><span class="hs-identifier hs-var">n</span></a></span></span><span> </span><span id="local-6989586621681374873"><span class="annot"><span class="annottext">InertSet
</span><a href="#local-6989586621681374873"><span class="hs-identifier hs-var">inert</span></a></span></span><span class="hs-special">)</span><span> </span><span id="local-6989586621681374872"><span class="annot"><span class="annottext">Bag Type
</span><a href="#local-6989586621681374872"><span class="hs-identifier hs-var">cts</span></a></span></span><span>
</span><span id="line-696"></span><span>  </span><span class="hs-glyph">|</span><span> </span><span class="annot"><span class="annottext">forall a. Bag a -&gt; Bool
</span><a href="GHC.Data.Bag.html#isEmptyBag"><span class="hs-identifier hs-var">isEmptyBag</span></a></span><span> </span><span class="annot"><span class="annottext">Bag Type
</span><a href="#local-6989586621681374872"><span class="hs-identifier hs-var">cts</span></a></span><span>
</span><span id="line-697"></span><span>  </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">forall (f :: * -&gt; *) a. Applicative f =&gt; a -&gt; f a
</span><a href="../../base-4.16.4.0/src/GHC-Base.html#pure"><span class="hs-identifier hs-var">pure</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">forall a. a -&gt; Maybe a
</span><a href="../../base-4.16.4.0/src/GHC-Maybe.html#Just"><span class="hs-identifier hs-var">Just</span></a></span><span> </span><span class="annot"><span class="annottext">TyState
</span><a href="#local-6989586621681374875"><span class="hs-identifier hs-var">ty_st</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-698"></span><span>  </span><span class="hs-glyph">|</span><span> </span><span class="annot"><span class="annottext">Bool
</span><a href="../../base-4.16.4.0/src/GHC-Base.html#otherwise"><span class="hs-identifier hs-var">otherwise</span></a></span><span>
</span><span id="line-699"></span><span>  </span><span class="hs-glyph">=</span><span> </span><span class="hs-keyword">do</span><span> </span><span class="hs-special">{</span><span> </span><span id="local-6989586621681374870"><span class="annot"><span class="annottext">Bag Id
</span><a href="#local-6989586621681374870"><span class="hs-identifier hs-var">evs</span></a></span></span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">forall (t :: * -&gt; *) (f :: * -&gt; *) a b.
(Traversable t, Applicative f) =&gt;
(a -&gt; f b) -&gt; t a -&gt; f (t b)
</span><a href="../../base-4.16.4.0/src/Data-Traversable.html#traverse"><span class="hs-identifier hs-var">traverse</span></a></span><span> </span><span class="annot"><span class="annottext">Type -&gt; DsM Id
</span><a href="GHC.HsToCore.Pmc.Solver.html#nameTyCt"><span class="hs-identifier hs-var">nameTyCt</span></a></span><span> </span><span class="annot"><span class="annottext">Bag Type
</span><a href="#local-6989586621681374872"><span class="hs-identifier hs-var">cts</span></a></span><span>
</span><span id="line-700"></span><span>       </span><span class="hs-special">;</span><span> </span><span class="annot"><span class="annottext">String -&gt; SDoc -&gt; DsM ()
</span><a href="GHC.HsToCore.Pmc.Utils.html#tracePm"><span class="hs-identifier hs-var">tracePm</span></a></span><span> </span><span class="annot"><span class="annottext">String
</span><span class="hs-string">&quot;tyOracle&quot;</span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">forall a. Outputable a =&gt; a -&gt; SDoc
</span><a href="GHC.Utils.Outputable.html#ppr"><span class="hs-identifier hs-var">ppr</span></a></span><span> </span><span class="annot"><span class="annottext">Bag Type
</span><a href="#local-6989586621681374872"><span class="hs-identifier hs-var">cts</span></a></span><span> </span><span class="annot"><span class="annottext">SDoc -&gt; SDoc -&gt; SDoc
</span><a href="GHC.Utils.Outputable.html#%24%24"><span class="hs-operator hs-var">$$</span></a></span><span> </span><span class="annot"><span class="annottext">forall a. Outputable a =&gt; a -&gt; SDoc
</span><a href="GHC.Utils.Outputable.html#ppr"><span class="hs-identifier hs-var">ppr</span></a></span><span> </span><span class="annot"><span class="annottext">InertSet
</span><a href="#local-6989586621681374873"><span class="hs-identifier hs-var">inert</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-701"></span><span>       </span><span class="hs-special">;</span><span> </span><span id="local-6989586621681374867"><span class="annot"><span class="annottext">Maybe InertSet
</span><a href="#local-6989586621681374867"><span class="hs-identifier hs-var">mb_new_inert</span></a></span></span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">forall a. TcM a -&gt; DsM a
</span><a href="GHC.HsToCore.Monad.html#initTcDsForSolver"><span class="hs-identifier hs-var">initTcDsForSolver</span></a></span><span> </span><span class="annot"><span class="annottext">forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><a href="../../base-4.16.4.0/src/GHC-Base.html#%24"><span class="hs-operator hs-var">$</span></a></span><span> </span><span class="annot"><span class="annottext">InertSet -&gt; Bag Id -&gt; TcM (Maybe InertSet)
</span><a href="GHC.Tc.Solver.html#tcCheckGivens"><span class="hs-identifier hs-var">tcCheckGivens</span></a></span><span> </span><span class="annot"><span class="annottext">InertSet
</span><a href="#local-6989586621681374873"><span class="hs-identifier hs-var">inert</span></a></span><span> </span><span class="annot"><span class="annottext">Bag Id
</span><a href="#local-6989586621681374870"><span class="hs-identifier hs-var">evs</span></a></span><span>
</span><span id="line-702"></span><span>         </span><span class="hs-comment">-- return the new inert set and increment the sequence number n</span><span>
</span><span id="line-703"></span><span>       </span><span class="hs-special">;</span><span> </span><span class="annot"><span class="annottext">forall (m :: * -&gt; *) a. Monad m =&gt; a -&gt; m a
</span><a href="../../base-4.16.4.0/src/GHC-Base.html#return"><span class="hs-identifier hs-var">return</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Int -&gt; InertSet -&gt; TyState
</span><a href="GHC.HsToCore.Pmc.Solver.Types.html#TySt"><span class="hs-identifier hs-var">TySt</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Int
</span><a href="#local-6989586621681374874"><span class="hs-identifier hs-var">n</span></a></span><span class="annot"><span class="annottext">forall a. Num a =&gt; a -&gt; a -&gt; a
</span><a href="../../base-4.16.4.0/src/GHC-Num.html#%2B"><span class="hs-operator hs-var">+</span></a></span><span class="annot"><span class="annottext">Int
</span><span class="hs-number">1</span></span><span class="hs-special">)</span><span> </span><span class="annot"><span class="annottext">forall (f :: * -&gt; *) a b. Functor f =&gt; (a -&gt; b) -&gt; f a -&gt; f b
</span><a href="../../base-4.16.4.0/src/Data-Functor.html#%3C%24%3E"><span class="hs-operator hs-var">&lt;$&gt;</span></a></span><span> </span><span class="annot"><span class="annottext">Maybe InertSet
</span><a href="#local-6989586621681374867"><span class="hs-identifier hs-var">mb_new_inert</span></a></span><span class="hs-special">)</span><span> </span><span class="hs-special">}</span><span>
</span><span id="line-704"></span><span>
</span><span id="line-705"></span><span class="hs-comment">-- | Allocates a fresh 'EvVar' name for 'PredTy's.</span><span>
</span><span id="line-706"></span><span class="annot"><a href="GHC.HsToCore.Pmc.Solver.html#nameTyCt"><span class="hs-identifier hs-type">nameTyCt</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><a href="GHC.Core.TyCo.Rep.html#PredType"><span class="hs-identifier hs-type">PredType</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="GHC.HsToCore.Types.html#DsM"><span class="hs-identifier hs-type">DsM</span></a></span><span> </span><span class="annot"><a href="GHC.Types.Var.html#EvVar"><span class="hs-identifier hs-type">EvVar</span></a></span><span>
</span><span id="line-707"></span><span id="nameTyCt"><span class="annot"><span class="annottext">nameTyCt :: Type -&gt; DsM Id
</span><a href="GHC.HsToCore.Pmc.Solver.html#nameTyCt"><span class="hs-identifier hs-var hs-var">nameTyCt</span></a></span></span><span> </span><span id="local-6989586621681374865"><span class="annot"><span class="annottext">Type
</span><a href="#local-6989586621681374865"><span class="hs-identifier hs-var">pred_ty</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-keyword">do</span><span>
</span><span id="line-708"></span><span>  </span><span id="local-6989586621681374864"><span class="annot"><span class="annottext">Unique
</span><a href="#local-6989586621681374864"><span class="hs-identifier hs-var">unique</span></a></span></span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">forall (m :: * -&gt; *). MonadUnique m =&gt; m Unique
</span><a href="GHC.Types.Unique.Supply.html#getUniqueM"><span class="hs-identifier hs-var">getUniqueM</span></a></span><span>
</span><span id="line-709"></span><span>  </span><span class="hs-keyword">let</span><span> </span><span id="local-6989586621681374862"><span class="annot"><span class="annottext">occname :: OccName
</span><a href="#local-6989586621681374862"><span class="hs-identifier hs-var hs-var">occname</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">FastString -&gt; OccName
</span><a href="GHC.Types.Name.Occurrence.html#mkVarOccFS"><span class="hs-identifier hs-var">mkVarOccFS</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">String -&gt; FastString
</span><a href="GHC.Data.FastString.html#fsLit"><span class="hs-identifier hs-var">fsLit</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">String
</span><span class="hs-string">&quot;pm_&quot;</span></span><span class="annot"><span class="annottext">forall a. [a] -&gt; [a] -&gt; [a]
</span><a href="../../base-4.16.4.0/src/GHC-Base.html#%2B%2B"><span class="hs-operator hs-var">++</span></a></span><span class="annot"><span class="annottext">forall a. Show a =&gt; a -&gt; String
</span><a href="../../base-4.16.4.0/src/GHC-Show.html#show"><span class="hs-identifier hs-var">show</span></a></span><span> </span><span class="annot"><span class="annottext">Unique
</span><a href="#local-6989586621681374864"><span class="hs-identifier hs-var">unique</span></a></span><span class="hs-special">)</span><span class="hs-special">)</span><span>
</span><span id="line-710"></span><span>      </span><span id="local-6989586621681374858"><span class="annot"><span class="annottext">idname :: Name
</span><a href="#local-6989586621681374858"><span class="hs-identifier hs-var hs-var">idname</span></a></span></span><span>  </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">Unique -&gt; OccName -&gt; SrcSpan -&gt; Name
</span><a href="GHC.Types.Name.html#mkInternalName"><span class="hs-identifier hs-var">mkInternalName</span></a></span><span> </span><span class="annot"><span class="annottext">Unique
</span><a href="#local-6989586621681374864"><span class="hs-identifier hs-var">unique</span></a></span><span> </span><span class="annot"><span class="annottext">OccName
</span><a href="#local-6989586621681374862"><span class="hs-identifier hs-var">occname</span></a></span><span> </span><span class="annot"><span class="annottext">SrcSpan
</span><a href="GHC.Types.SrcLoc.html#noSrcSpan"><span class="hs-identifier hs-var">noSrcSpan</span></a></span><span>
</span><span id="line-711"></span><span>  </span><span class="annot"><span class="annottext">forall (m :: * -&gt; *) a. Monad m =&gt; a -&gt; m a
</span><a href="../../base-4.16.4.0/src/GHC-Base.html#return"><span class="hs-identifier hs-var">return</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Name -&gt; Type -&gt; Type -&gt; Id
</span><a href="GHC.Types.Id.html#mkLocalIdOrCoVar"><span class="hs-identifier hs-var">mkLocalIdOrCoVar</span></a></span><span> </span><span class="annot"><span class="annottext">Name
</span><a href="#local-6989586621681374858"><span class="hs-identifier hs-var">idname</span></a></span><span> </span><span class="annot"><span class="annottext">Type
</span><a href="GHC.Core.Type.html#Many"><span class="hs-identifier hs-var">Many</span></a></span><span> </span><span class="annot"><span class="annottext">Type
</span><a href="#local-6989586621681374865"><span class="hs-identifier hs-var">pred_ty</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-712"></span><span>
</span><span id="line-713"></span><span class="hs-comment">-----------------------------</span><span>
</span><span id="line-714"></span><span class="hs-comment">-- ** Adding term constraints</span><span>
</span><span id="line-715"></span><span>
</span><span id="line-716"></span><span class="hs-comment">-- | Adds a single higher-level &#966; constraint by dispatching to the various</span><span>
</span><span id="line-717"></span><span class="hs-comment">-- oracle functions.</span><span>
</span><span id="line-718"></span><span class="hs-comment">--</span><span>
</span><span id="line-719"></span><span class="hs-comment">-- In terms of the paper, this function amounts to the constructor constraint</span><span>
</span><span id="line-720"></span><span class="hs-comment">-- case of \(&#8853;_&#966;\) in Figure 7, which &quot;desugars&quot; higher-level &#966; constraints</span><span>
</span><span id="line-721"></span><span class="hs-comment">-- into lower-level &#948; constraints. We don't have a data type for &#948; constraints</span><span>
</span><span id="line-722"></span><span class="hs-comment">-- and call the corresponding oracle function directly instead.</span><span>
</span><span id="line-723"></span><span class="hs-comment">--</span><span>
</span><span id="line-724"></span><span class="hs-comment">-- Precondition: The &#966; is /not/ a type constraint! These should be handled by</span><span>
</span><span id="line-725"></span><span class="hs-comment">-- 'addTyCts' before, through 'addPhiCts'.</span><span>
</span><span id="line-726"></span><span class="annot"><a href="GHC.HsToCore.Pmc.Solver.html#addPhiTmCt"><span class="hs-identifier hs-type">addPhiTmCt</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><a href="GHC.HsToCore.Pmc.Solver.Types.html#Nabla"><span class="hs-identifier hs-type">Nabla</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="GHC.HsToCore.Pmc.Solver.html#PhiCt"><span class="hs-identifier hs-type">PhiCt</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="../../transformers-0.5.6.2/src/Control-Monad-Trans-Maybe.html#MaybeT"><span class="hs-identifier hs-type">MaybeT</span></a></span><span> </span><span class="annot"><a href="GHC.HsToCore.Types.html#DsM"><span class="hs-identifier hs-type">DsM</span></a></span><span> </span><span class="annot"><a href="GHC.HsToCore.Pmc.Solver.Types.html#Nabla"><span class="hs-identifier hs-type">Nabla</span></a></span><span>
</span><span id="line-727"></span><span id="addPhiTmCt"><span class="annot"><span class="annottext">addPhiTmCt :: Nabla -&gt; PhiCt -&gt; MaybeT (IOEnv (Env DsGblEnv DsLclEnv)) Nabla
</span><a href="GHC.HsToCore.Pmc.Solver.html#addPhiTmCt"><span class="hs-identifier hs-var hs-var">addPhiTmCt</span></a></span></span><span> </span><span class="annot"><span class="annottext">Nabla
</span><span class="hs-identifier">_</span></span><span>     </span><span class="hs-special">(</span><span class="annot"><a href="GHC.HsToCore.Pmc.Solver.html#PhiTyCt"><span class="hs-identifier hs-type">PhiTyCt</span></a></span><span> </span><span id="local-6989586621681374853"><span class="annot"><span class="annottext">Type
</span><a href="#local-6989586621681374853"><span class="hs-identifier hs-var">ct</span></a></span></span><span class="hs-special">)</span><span>              </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">forall a. HasCallStack =&gt; String -&gt; SDoc -&gt; a
</span><a href="GHC.Utils.Panic.html#pprPanic"><span class="hs-identifier hs-var">pprPanic</span></a></span><span> </span><span class="annot"><span class="annottext">String
</span><span class="hs-string">&quot;addPhiCt:TyCt&quot;</span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">forall a. Outputable a =&gt; a -&gt; SDoc
</span><a href="GHC.Utils.Outputable.html#ppr"><span class="hs-identifier hs-var">ppr</span></a></span><span> </span><span class="annot"><span class="annottext">Type
</span><a href="#local-6989586621681374853"><span class="hs-identifier hs-var">ct</span></a></span><span class="hs-special">)</span><span> </span><span class="hs-comment">-- See the precondition</span><span>
</span><span id="line-728"></span><span class="annot"><a href="GHC.HsToCore.Pmc.Solver.html#addPhiTmCt"><span class="hs-identifier hs-var">addPhiTmCt</span></a></span><span> </span><span id="local-6989586621681374851"><span class="annot"><span class="annottext">Nabla
</span><a href="#local-6989586621681374851"><span class="hs-identifier hs-var">nabla</span></a></span></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="GHC.HsToCore.Pmc.Solver.html#PhiCoreCt"><span class="hs-identifier hs-type">PhiCoreCt</span></a></span><span> </span><span id="local-6989586621681374850"><span class="annot"><span class="annottext">Id
</span><a href="#local-6989586621681374850"><span class="hs-identifier hs-var">x</span></a></span></span><span> </span><span id="local-6989586621681374849"><span class="annot"><span class="annottext">CoreExpr
</span><a href="#local-6989586621681374849"><span class="hs-identifier hs-var">e</span></a></span></span><span class="hs-special">)</span><span>           </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">Nabla
-&gt; Id -&gt; CoreExpr -&gt; MaybeT (IOEnv (Env DsGblEnv DsLclEnv)) Nabla
</span><a href="GHC.HsToCore.Pmc.Solver.html#addCoreCt"><span class="hs-identifier hs-var">addCoreCt</span></a></span><span> </span><span class="annot"><span class="annottext">Nabla
</span><a href="#local-6989586621681374851"><span class="hs-identifier hs-var">nabla</span></a></span><span> </span><span class="annot"><span class="annottext">Id
</span><a href="#local-6989586621681374850"><span class="hs-identifier hs-var">x</span></a></span><span> </span><span class="annot"><span class="annottext">CoreExpr
</span><a href="#local-6989586621681374849"><span class="hs-identifier hs-var">e</span></a></span><span>
</span><span id="line-729"></span><span class="annot"><a href="GHC.HsToCore.Pmc.Solver.html#addPhiTmCt"><span class="hs-identifier hs-var">addPhiTmCt</span></a></span><span> </span><span id="local-6989586621681374847"><span class="annot"><span class="annottext">Nabla
</span><a href="#local-6989586621681374847"><span class="hs-identifier hs-var">nabla</span></a></span></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="GHC.HsToCore.Pmc.Solver.html#PhiConCt"><span class="hs-identifier hs-type">PhiConCt</span></a></span><span> </span><span id="local-6989586621681374846"><span class="annot"><span class="annottext">Id
</span><a href="#local-6989586621681374846"><span class="hs-identifier hs-var">x</span></a></span></span><span> </span><span id="local-6989586621681374845"><span class="annot"><span class="annottext">PmAltCon
</span><a href="#local-6989586621681374845"><span class="hs-identifier hs-var">con</span></a></span></span><span> </span><span id="local-6989586621681374844"><span class="annot"><span class="annottext">[Id]
</span><a href="#local-6989586621681374844"><span class="hs-identifier hs-var">tvs</span></a></span></span><span> </span><span id="local-6989586621681374843"><span class="annot"><span class="annottext">ThetaType
</span><a href="#local-6989586621681374843"><span class="hs-identifier hs-var">dicts</span></a></span></span><span> </span><span id="local-6989586621681374842"><span class="annot"><span class="annottext">[Id]
</span><a href="#local-6989586621681374842"><span class="hs-identifier hs-var">args</span></a></span></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-keyword">do</span><span>
</span><span id="line-730"></span><span>  </span><span class="hs-comment">-- Case (1) of Note [Strict fields and variables of unlifted type]</span><span>
</span><span id="line-731"></span><span>  </span><span class="hs-comment">-- PhiConCt correspond to the higher-level &#966; constraints from the paper with</span><span>
</span><span id="line-732"></span><span>  </span><span class="hs-comment">-- bindings semantics. It disperses into lower-level &#948; constraints that the</span><span>
</span><span id="line-733"></span><span>  </span><span class="hs-comment">-- 'add*Ct' functions correspond to.</span><span>
</span><span id="line-734"></span><span>  </span><span id="local-6989586621681374841"><span class="annot"><span class="annottext">Nabla
</span><a href="#local-6989586621681374841"><span class="hs-identifier hs-var">nabla'</span></a></span></span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">Nabla -&gt; Bag Type -&gt; MaybeT (IOEnv (Env DsGblEnv DsLclEnv)) Nabla
</span><a href="GHC.HsToCore.Pmc.Solver.html#addTyCts"><span class="hs-identifier hs-var">addTyCts</span></a></span><span> </span><span class="annot"><span class="annottext">Nabla
</span><a href="#local-6989586621681374847"><span class="hs-identifier hs-var">nabla</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">forall a. [a] -&gt; Bag a
</span><a href="GHC.Data.Bag.html#listToBag"><span class="hs-identifier hs-var">listToBag</span></a></span><span> </span><span class="annot"><span class="annottext">ThetaType
</span><a href="#local-6989586621681374843"><span class="hs-identifier hs-var">dicts</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-735"></span><span>  </span><span id="local-6989586621681374840"><span class="annot"><span class="annottext">Nabla
</span><a href="#local-6989586621681374840"><span class="hs-identifier hs-var">nabla''</span></a></span></span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">Nabla
-&gt; Id
-&gt; PmAltCon
-&gt; [Id]
-&gt; [Id]
-&gt; MaybeT (IOEnv (Env DsGblEnv DsLclEnv)) Nabla
</span><a href="GHC.HsToCore.Pmc.Solver.html#addConCt"><span class="hs-identifier hs-var">addConCt</span></a></span><span> </span><span class="annot"><span class="annottext">Nabla
</span><a href="#local-6989586621681374841"><span class="hs-identifier hs-var">nabla'</span></a></span><span> </span><span class="annot"><span class="annottext">Id
</span><a href="#local-6989586621681374846"><span class="hs-identifier hs-var">x</span></a></span><span> </span><span class="annot"><span class="annottext">PmAltCon
</span><a href="#local-6989586621681374845"><span class="hs-identifier hs-var">con</span></a></span><span> </span><span class="annot"><span class="annottext">[Id]
</span><a href="#local-6989586621681374844"><span class="hs-identifier hs-var">tvs</span></a></span><span> </span><span class="annot"><span class="annottext">[Id]
</span><a href="#local-6989586621681374842"><span class="hs-identifier hs-var">args</span></a></span><span>
</span><span id="line-736"></span><span>  </span><span class="annot"><span class="annottext">forall (t :: * -&gt; *) (m :: * -&gt; *) b a.
(Foldable t, Monad m) =&gt;
(b -&gt; a -&gt; m b) -&gt; b -&gt; t a -&gt; m b
</span><a href="../../base-4.16.4.0/src/Data-Foldable.html#foldlM"><span class="hs-identifier hs-var">foldlM</span></a></span><span> </span><span class="annot"><span class="annottext">Nabla -&gt; Id -&gt; MaybeT (IOEnv (Env DsGblEnv DsLclEnv)) Nabla
</span><a href="GHC.HsToCore.Pmc.Solver.html#addNotBotCt"><span class="hs-identifier hs-var">addNotBotCt</span></a></span><span> </span><span class="annot"><span class="annottext">Nabla
</span><a href="#local-6989586621681374840"><span class="hs-identifier hs-var">nabla''</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">PmAltCon -&gt; [Id] -&gt; [Id]
</span><a href="GHC.HsToCore.Pmc.Solver.html#filterUnliftedFields"><span class="hs-identifier hs-var">filterUnliftedFields</span></a></span><span> </span><span class="annot"><span class="annottext">PmAltCon
</span><a href="#local-6989586621681374845"><span class="hs-identifier hs-var">con</span></a></span><span> </span><span class="annot"><span class="annottext">[Id]
</span><a href="#local-6989586621681374842"><span class="hs-identifier hs-var">args</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-737"></span><span class="annot"><a href="GHC.HsToCore.Pmc.Solver.html#addPhiTmCt"><span class="hs-identifier hs-var">addPhiTmCt</span></a></span><span> </span><span id="local-6989586621681374836"><span class="annot"><span class="annottext">Nabla
</span><a href="#local-6989586621681374836"><span class="hs-identifier hs-var">nabla</span></a></span></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="GHC.HsToCore.Pmc.Solver.html#PhiNotConCt"><span class="hs-identifier hs-type">PhiNotConCt</span></a></span><span> </span><span id="local-6989586621681374835"><span class="annot"><span class="annottext">Id
</span><a href="#local-6989586621681374835"><span class="hs-identifier hs-var">x</span></a></span></span><span> </span><span id="local-6989586621681374834"><span class="annot"><span class="annottext">PmAltCon
</span><a href="#local-6989586621681374834"><span class="hs-identifier hs-var">con</span></a></span></span><span class="hs-special">)</span><span>       </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">Nabla
-&gt; Id -&gt; PmAltCon -&gt; MaybeT (IOEnv (Env DsGblEnv DsLclEnv)) Nabla
</span><a href="GHC.HsToCore.Pmc.Solver.html#addNotConCt"><span class="hs-identifier hs-var">addNotConCt</span></a></span><span> </span><span class="annot"><span class="annottext">Nabla
</span><a href="#local-6989586621681374836"><span class="hs-identifier hs-var">nabla</span></a></span><span> </span><span class="annot"><span class="annottext">Id
</span><a href="#local-6989586621681374835"><span class="hs-identifier hs-var">x</span></a></span><span> </span><span class="annot"><span class="annottext">PmAltCon
</span><a href="#local-6989586621681374834"><span class="hs-identifier hs-var">con</span></a></span><span>
</span><span id="line-738"></span><span class="annot"><a href="GHC.HsToCore.Pmc.Solver.html#addPhiTmCt"><span class="hs-identifier hs-var">addPhiTmCt</span></a></span><span> </span><span id="local-6989586621681374832"><span class="annot"><span class="annottext">Nabla
</span><a href="#local-6989586621681374832"><span class="hs-identifier hs-var">nabla</span></a></span></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="GHC.HsToCore.Pmc.Solver.html#PhiBotCt"><span class="hs-identifier hs-type">PhiBotCt</span></a></span><span> </span><span id="local-6989586621681374831"><span class="annot"><span class="annottext">Id
</span><a href="#local-6989586621681374831"><span class="hs-identifier hs-var">x</span></a></span></span><span class="hs-special">)</span><span>              </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">Nabla -&gt; Id -&gt; MaybeT (IOEnv (Env DsGblEnv DsLclEnv)) Nabla
</span><a href="GHC.HsToCore.Pmc.Solver.html#addBotCt"><span class="hs-identifier hs-var">addBotCt</span></a></span><span> </span><span class="annot"><span class="annottext">Nabla
</span><a href="#local-6989586621681374832"><span class="hs-identifier hs-var">nabla</span></a></span><span> </span><span class="annot"><span class="annottext">Id
</span><a href="#local-6989586621681374831"><span class="hs-identifier hs-var">x</span></a></span><span>
</span><span id="line-739"></span><span class="annot"><a href="GHC.HsToCore.Pmc.Solver.html#addPhiTmCt"><span class="hs-identifier hs-var">addPhiTmCt</span></a></span><span> </span><span id="local-6989586621681374829"><span class="annot"><span class="annottext">Nabla
</span><a href="#local-6989586621681374829"><span class="hs-identifier hs-var">nabla</span></a></span></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="GHC.HsToCore.Pmc.Solver.html#PhiNotBotCt"><span class="hs-identifier hs-type">PhiNotBotCt</span></a></span><span> </span><span id="local-6989586621681374828"><span class="annot"><span class="annottext">Id
</span><a href="#local-6989586621681374828"><span class="hs-identifier hs-var">x</span></a></span></span><span class="hs-special">)</span><span>           </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">Nabla -&gt; Id -&gt; MaybeT (IOEnv (Env DsGblEnv DsLclEnv)) Nabla
</span><a href="GHC.HsToCore.Pmc.Solver.html#addNotBotCt"><span class="hs-identifier hs-var">addNotBotCt</span></a></span><span> </span><span class="annot"><span class="annottext">Nabla
</span><a href="#local-6989586621681374829"><span class="hs-identifier hs-var">nabla</span></a></span><span> </span><span class="annot"><span class="annottext">Id
</span><a href="#local-6989586621681374828"><span class="hs-identifier hs-var">x</span></a></span><span>
</span><span id="line-740"></span><span>
</span><span id="line-741"></span><span class="annot"><a href="GHC.HsToCore.Pmc.Solver.html#filterUnliftedFields"><span class="hs-identifier hs-type">filterUnliftedFields</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><a href="GHC.HsToCore.Pmc.Solver.Types.html#PmAltCon"><span class="hs-identifier hs-type">PmAltCon</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-special">[</span><span class="annot"><a href="GHC.Types.Var.html#Id"><span class="hs-identifier hs-type">Id</span></a></span><span class="hs-special">]</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-special">[</span><span class="annot"><a href="GHC.Types.Var.html#Id"><span class="hs-identifier hs-type">Id</span></a></span><span class="hs-special">]</span><span>
</span><span id="line-742"></span><span id="filterUnliftedFields"><span class="annot"><span class="annottext">filterUnliftedFields :: PmAltCon -&gt; [Id] -&gt; [Id]
</span><a href="GHC.HsToCore.Pmc.Solver.html#filterUnliftedFields"><span class="hs-identifier hs-var hs-var">filterUnliftedFields</span></a></span></span><span> </span><span id="local-6989586621681374827"><span class="annot"><span class="annottext">PmAltCon
</span><a href="#local-6989586621681374827"><span class="hs-identifier hs-var">con</span></a></span></span><span> </span><span id="local-6989586621681374826"><span class="annot"><span class="annottext">[Id]
</span><a href="#local-6989586621681374826"><span class="hs-identifier hs-var">args</span></a></span></span><span> </span><span class="hs-glyph">=</span><span>
</span><span id="line-743"></span><span>  </span><span class="hs-special">[</span><span> </span><span class="annot"><span class="annottext">Id
</span><a href="#local-6989586621681374825"><span class="hs-identifier hs-var">arg</span></a></span><span> </span><span class="hs-glyph">|</span><span> </span><span class="hs-special">(</span><span id="local-6989586621681374825"><span class="annot"><span class="annottext">Id
</span><a href="#local-6989586621681374825"><span class="hs-identifier hs-var">arg</span></a></span></span><span class="hs-special">,</span><span> </span><span id="local-6989586621681374824"><span class="annot"><span class="annottext">HsImplBang
</span><a href="#local-6989586621681374824"><span class="hs-identifier hs-var">bang</span></a></span></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">forall a b. String -&gt; [a] -&gt; [b] -&gt; [(a, b)]
</span><a href="GHC.Utils.Misc.html#zipEqual"><span class="hs-identifier hs-var">zipEqual</span></a></span><span> </span><span class="annot"><span class="annottext">String
</span><span class="hs-string">&quot;addPhiCt&quot;</span></span><span> </span><span class="annot"><span class="annottext">[Id]
</span><a href="#local-6989586621681374826"><span class="hs-identifier hs-var">args</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">PmAltCon -&gt; [HsImplBang]
</span><a href="GHC.HsToCore.Pmc.Solver.Types.html#pmAltConImplBangs"><span class="hs-identifier hs-var">pmAltConImplBangs</span></a></span><span> </span><span class="annot"><span class="annottext">PmAltCon
</span><a href="#local-6989586621681374827"><span class="hs-identifier hs-var">con</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-744"></span><span>        </span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">HsImplBang -&gt; Bool
</span><a href="GHC.Core.DataCon.html#isBanged"><span class="hs-identifier hs-var">isBanged</span></a></span><span> </span><span class="annot"><span class="annottext">HsImplBang
</span><a href="#local-6989586621681374824"><span class="hs-identifier hs-var">bang</span></a></span><span> </span><span class="annot"><span class="annottext">Bool -&gt; Bool -&gt; Bool
</span><span class="hs-operator hs-var">||</span></span><span> </span><span class="annot"><span class="annottext">HasDebugCallStack =&gt; Type -&gt; Bool
</span><a href="GHC.Core.Type.html#isUnliftedType"><span class="hs-identifier hs-var">isUnliftedType</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Id -&gt; Type
</span><a href="GHC.Types.Id.html#idType"><span class="hs-identifier hs-var">idType</span></a></span><span> </span><span class="annot"><span class="annottext">Id
</span><a href="#local-6989586621681374825"><span class="hs-identifier hs-var">arg</span></a></span><span class="hs-special">)</span><span> </span><span class="hs-special">]</span><span>
</span><span id="line-745"></span><span>
</span><span id="line-746"></span><span class="hs-comment">-- | Adds the constraint @x ~ &#8869;@, e.g. that evaluation of a particular 'Id' @x@</span><span>
</span><span id="line-747"></span><span class="hs-comment">-- surely diverges. Quite similar to 'addConCt', only that it only cares about</span><span>
</span><span id="line-748"></span><span class="hs-comment">-- &#8869;.</span><span>
</span><span id="line-749"></span><span class="annot"><a href="GHC.HsToCore.Pmc.Solver.html#addBotCt"><span class="hs-identifier hs-type">addBotCt</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><a href="GHC.HsToCore.Pmc.Solver.Types.html#Nabla"><span class="hs-identifier hs-type">Nabla</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="GHC.Types.Var.html#Id"><span class="hs-identifier hs-type">Id</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="../../transformers-0.5.6.2/src/Control-Monad-Trans-Maybe.html#MaybeT"><span class="hs-identifier hs-type">MaybeT</span></a></span><span> </span><span class="annot"><a href="GHC.HsToCore.Types.html#DsM"><span class="hs-identifier hs-type">DsM</span></a></span><span> </span><span class="annot"><a href="GHC.HsToCore.Pmc.Solver.Types.html#Nabla"><span class="hs-identifier hs-type">Nabla</span></a></span><span>
</span><span id="line-750"></span><span id="addBotCt"><span class="annot"><span class="annottext">addBotCt :: Nabla -&gt; Id -&gt; MaybeT (IOEnv (Env DsGblEnv DsLclEnv)) Nabla
</span><a href="GHC.HsToCore.Pmc.Solver.html#addBotCt"><span class="hs-identifier hs-var hs-var">addBotCt</span></a></span></span><span> </span><span id="local-6989586621681374818"><span class="annot"><span class="annottext">nabla :: Nabla
</span><a href="#local-6989586621681374818"><span class="hs-identifier hs-var">nabla</span></a></span></span><span class="hs-glyph">@</span><span class="annot"><a href="GHC.HsToCore.Pmc.Solver.Types.html#MkNabla"><span class="hs-identifier hs-type">MkNabla</span></a></span><span class="hs-special">{</span><span> </span><span class="annot"><span class="annottext">nabla_tm_st :: Nabla -&gt; TmState
</span><a href="GHC.HsToCore.Pmc.Solver.Types.html#nabla_tm_st"><span class="hs-identifier hs-var">nabla_tm_st</span></a></span><span> </span><span class="hs-glyph">=</span><span> </span><span id="local-6989586621681374817"><span class="annot"><span class="annottext">ts :: TmState
</span><a href="#local-6989586621681374817"><span class="hs-identifier hs-var">ts</span></a></span></span><span class="hs-glyph">@</span><span class="annot"><a href="GHC.HsToCore.Pmc.Solver.Types.html#TmSt"><span class="hs-identifier hs-type">TmSt</span></a></span><span class="hs-special">{</span><span> </span><span class="annot"><span class="annottext">ts_facts :: TmState -&gt; UniqSDFM Id VarInfo
</span><a href="GHC.HsToCore.Pmc.Solver.Types.html#ts_facts"><span class="hs-identifier hs-var">ts_facts</span></a></span><span class="hs-glyph">=</span><span id="local-6989586621681374816"><span class="annot"><span class="annottext">UniqSDFM Id VarInfo
</span><a href="#local-6989586621681374816"><span class="hs-identifier hs-var">env</span></a></span></span><span> </span><span class="hs-special">}</span><span> </span><span class="hs-special">}</span><span> </span><span id="local-6989586621681374815"><span class="annot"><span class="annottext">Id
</span><a href="#local-6989586621681374815"><span class="hs-identifier hs-var">x</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-keyword">do</span><span>
</span><span id="line-751"></span><span>  </span><span class="hs-keyword">let</span><span> </span><span class="hs-special">(</span><span id="local-6989586621681374814"><span class="annot"><span class="annottext">Id
</span><a href="#local-6989586621681374814"><span class="hs-identifier hs-var">y</span></a></span></span><span class="hs-special">,</span><span> </span><span id="local-6989586621681374813"><span class="annot"><span class="annottext">vi :: VarInfo
</span><a href="#local-6989586621681374813"><span class="hs-identifier hs-var">vi</span></a></span></span><span class="hs-glyph">@</span><span class="annot"><a href="GHC.HsToCore.Pmc.Solver.Types.html#VI"><span class="hs-identifier hs-type">VI</span></a></span><span> </span><span class="hs-special">{</span><span> </span><span class="annot"><span class="annottext">vi_bot :: VarInfo -&gt; BotInfo
</span><a href="GHC.HsToCore.Pmc.Solver.Types.html#vi_bot"><span class="hs-identifier hs-var">vi_bot</span></a></span><span> </span><span class="hs-glyph">=</span><span> </span><span id="local-6989586621681374812"><span class="annot"><span class="annottext">BotInfo
</span><a href="#local-6989586621681374812"><span class="hs-identifier hs-var">bot</span></a></span></span><span> </span><span class="hs-special">}</span><span class="hs-special">)</span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">TmState -&gt; Id -&gt; (Id, VarInfo)
</span><a href="GHC.HsToCore.Pmc.Solver.html#lookupVarInfoNT"><span class="hs-identifier hs-var">lookupVarInfoNT</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Nabla -&gt; TmState
</span><a href="GHC.HsToCore.Pmc.Solver.Types.html#nabla_tm_st"><span class="hs-identifier hs-var">nabla_tm_st</span></a></span><span> </span><span class="annot"><span class="annottext">Nabla
</span><a href="#local-6989586621681374818"><span class="hs-identifier hs-var">nabla</span></a></span><span class="hs-special">)</span><span> </span><span class="annot"><span class="annottext">Id
</span><a href="#local-6989586621681374815"><span class="hs-identifier hs-var">x</span></a></span><span>
</span><span id="line-752"></span><span>  </span><span class="hs-keyword">case</span><span> </span><span class="annot"><span class="annottext">BotInfo
</span><a href="#local-6989586621681374812"><span class="hs-identifier hs-var">bot</span></a></span><span> </span><span class="hs-keyword">of</span><span>
</span><span id="line-753"></span><span>    </span><span class="annot"><span class="annottext">BotInfo
</span><a href="GHC.HsToCore.Pmc.Solver.Types.html#IsNotBot"><span class="hs-identifier hs-var">IsNotBot</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="annottext">forall (m :: * -&gt; *) a. MonadPlus m =&gt; m a
</span><a href="../../base-4.16.4.0/src/GHC-Base.html#mzero"><span class="hs-identifier hs-var">mzero</span></a></span><span>      </span><span class="hs-comment">-- There was x &#8769; &#8869;. Contradiction!</span><span>
</span><span id="line-754"></span><span>    </span><span class="annot"><span class="annottext">BotInfo
</span><a href="GHC.HsToCore.Pmc.Solver.Types.html#IsBot"><span class="hs-identifier hs-var">IsBot</span></a></span><span>    </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="annottext">forall (f :: * -&gt; *) a. Applicative f =&gt; a -&gt; f a
</span><a href="../../base-4.16.4.0/src/GHC-Base.html#pure"><span class="hs-identifier hs-var">pure</span></a></span><span> </span><span class="annot"><span class="annottext">Nabla
</span><a href="#local-6989586621681374818"><span class="hs-identifier hs-var">nabla</span></a></span><span> </span><span class="hs-comment">-- There already is x ~ &#8869;. Nothing left to do</span><span>
</span><span id="line-755"></span><span>    </span><span class="annot"><span class="annottext">BotInfo
</span><a href="GHC.HsToCore.Pmc.Solver.Types.html#MaybeBot"><span class="hs-identifier hs-var">MaybeBot</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span>            </span><span class="hs-comment">-- We add x ~ &#8869;</span><span>
</span><span id="line-756"></span><span>      </span><span class="hs-comment">-- Case (3) in Note [Strict fields and variables of unlifted type]</span><span>
</span><span id="line-757"></span><span>      </span><span class="hs-keyword">if</span><span> </span><span class="annot"><span class="annottext">HasDebugCallStack =&gt; Type -&gt; Bool
</span><a href="GHC.Core.Type.html#isUnliftedType"><span class="hs-identifier hs-var">isUnliftedType</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Id -&gt; Type
</span><a href="GHC.Types.Id.html#idType"><span class="hs-identifier hs-var">idType</span></a></span><span> </span><span class="annot"><span class="annottext">Id
</span><a href="#local-6989586621681374815"><span class="hs-identifier hs-var">x</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-758"></span><span>        </span><span class="hs-keyword">then</span><span> </span><span class="annot"><span class="annottext">forall (m :: * -&gt; *) a. MonadPlus m =&gt; m a
</span><a href="../../base-4.16.4.0/src/GHC-Base.html#mzero"><span class="hs-identifier hs-var">mzero</span></a></span><span> </span><span class="hs-comment">-- unlifted vars can never be &#8869;</span><span>
</span><span id="line-759"></span><span>        </span><span class="hs-keyword">else</span><span> </span><span class="hs-keyword">do</span><span>
</span><span id="line-760"></span><span>          </span><span class="hs-keyword">let</span><span> </span><span id="local-6989586621681374809"><span class="annot"><span class="annottext">vi' :: VarInfo
</span><a href="#local-6989586621681374809"><span class="hs-identifier hs-var hs-var">vi'</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">VarInfo
</span><a href="#local-6989586621681374813"><span class="hs-identifier hs-var">vi</span></a></span><span class="hs-special">{</span><span> </span><span class="annot"><span class="annottext">vi_bot :: BotInfo
</span><a href="GHC.HsToCore.Pmc.Solver.Types.html#vi_bot"><span class="hs-identifier hs-var">vi_bot</span></a></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">BotInfo
</span><a href="GHC.HsToCore.Pmc.Solver.Types.html#IsBot"><span class="hs-identifier hs-var">IsBot</span></a></span><span> </span><span class="hs-special">}</span><span>
</span><span id="line-761"></span><span>          </span><span class="annot"><span class="annottext">forall (f :: * -&gt; *) a. Applicative f =&gt; a -&gt; f a
</span><a href="../../base-4.16.4.0/src/GHC-Base.html#pure"><span class="hs-identifier hs-var">pure</span></a></span><span> </span><span class="annot"><span class="annottext">Nabla
</span><a href="#local-6989586621681374818"><span class="hs-identifier hs-var">nabla</span></a></span><span class="hs-special">{</span><span> </span><span class="annot"><span class="annottext">nabla_tm_st :: TmState
</span><a href="GHC.HsToCore.Pmc.Solver.Types.html#nabla_tm_st"><span class="hs-identifier hs-var">nabla_tm_st</span></a></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">TmState
</span><a href="#local-6989586621681374817"><span class="hs-identifier hs-var">ts</span></a></span><span class="hs-special">{</span><span class="annot"><span class="annottext">ts_facts :: UniqSDFM Id VarInfo
</span><a href="GHC.HsToCore.Pmc.Solver.Types.html#ts_facts"><span class="hs-identifier hs-var">ts_facts</span></a></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">forall key ele.
Uniquable key =&gt;
UniqSDFM key ele -&gt; key -&gt; ele -&gt; UniqSDFM key ele
</span><a href="GHC.Types.Unique.SDFM.html#addToUSDFM"><span class="hs-identifier hs-var">addToUSDFM</span></a></span><span> </span><span class="annot"><span class="annottext">UniqSDFM Id VarInfo
</span><a href="#local-6989586621681374816"><span class="hs-identifier hs-var">env</span></a></span><span> </span><span class="annot"><span class="annottext">Id
</span><a href="#local-6989586621681374814"><span class="hs-identifier hs-var">y</span></a></span><span> </span><span class="annot"><span class="annottext">VarInfo
</span><a href="#local-6989586621681374809"><span class="hs-identifier hs-var">vi'</span></a></span><span> </span><span class="hs-special">}</span><span> </span><span class="hs-special">}</span><span>
</span><span id="line-762"></span><span>
</span><span id="line-763"></span><span class="hs-comment">-- | Adds the constraint @x ~/ &#8869;@ to 'Nabla'. Quite similar to 'addNotConCt',</span><span>
</span><span id="line-764"></span><span class="hs-comment">-- but only cares for the &#8869; &quot;constructor&quot;.</span><span>
</span><span id="line-765"></span><span class="annot"><a href="GHC.HsToCore.Pmc.Solver.html#addNotBotCt"><span class="hs-identifier hs-type">addNotBotCt</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><a href="GHC.HsToCore.Pmc.Solver.Types.html#Nabla"><span class="hs-identifier hs-type">Nabla</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="GHC.Types.Var.html#Id"><span class="hs-identifier hs-type">Id</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="../../transformers-0.5.6.2/src/Control-Monad-Trans-Maybe.html#MaybeT"><span class="hs-identifier hs-type">MaybeT</span></a></span><span> </span><span class="annot"><a href="GHC.HsToCore.Types.html#DsM"><span class="hs-identifier hs-type">DsM</span></a></span><span> </span><span class="annot"><a href="GHC.HsToCore.Pmc.Solver.Types.html#Nabla"><span class="hs-identifier hs-type">Nabla</span></a></span><span>
</span><span id="line-766"></span><span id="addNotBotCt"><span class="annot"><span class="annottext">addNotBotCt :: Nabla -&gt; Id -&gt; MaybeT (IOEnv (Env DsGblEnv DsLclEnv)) Nabla
</span><a href="GHC.HsToCore.Pmc.Solver.html#addNotBotCt"><span class="hs-identifier hs-var hs-var">addNotBotCt</span></a></span></span><span> </span><span id="local-6989586621681374808"><span class="annot"><span class="annottext">nabla :: Nabla
</span><a href="#local-6989586621681374808"><span class="hs-identifier hs-var">nabla</span></a></span></span><span class="hs-glyph">@</span><span class="annot"><a href="GHC.HsToCore.Pmc.Solver.Types.html#MkNabla"><span class="hs-identifier hs-type">MkNabla</span></a></span><span class="hs-special">{</span><span> </span><span class="annot"><span class="annottext">nabla_tm_st :: Nabla -&gt; TmState
</span><a href="GHC.HsToCore.Pmc.Solver.Types.html#nabla_tm_st"><span class="hs-identifier hs-var">nabla_tm_st</span></a></span><span> </span><span class="hs-glyph">=</span><span> </span><span id="local-6989586621681374807"><span class="annot"><span class="annottext">ts :: TmState
</span><a href="#local-6989586621681374807"><span class="hs-identifier hs-var">ts</span></a></span></span><span class="hs-glyph">@</span><span class="annot"><a href="GHC.HsToCore.Pmc.Solver.Types.html#TmSt"><span class="hs-identifier hs-type">TmSt</span></a></span><span class="hs-special">{</span><span class="annot"><span class="annottext">ts_facts :: TmState -&gt; UniqSDFM Id VarInfo
</span><a href="GHC.HsToCore.Pmc.Solver.Types.html#ts_facts"><span class="hs-identifier hs-var">ts_facts</span></a></span><span class="hs-glyph">=</span><span id="local-6989586621681374806"><span class="annot"><span class="annottext">UniqSDFM Id VarInfo
</span><a href="#local-6989586621681374806"><span class="hs-identifier hs-var">env</span></a></span></span><span class="hs-special">}</span><span> </span><span class="hs-special">}</span><span> </span><span id="local-6989586621681374805"><span class="annot"><span class="annottext">Id
</span><a href="#local-6989586621681374805"><span class="hs-identifier hs-var">x</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-keyword">do</span><span>
</span><span id="line-767"></span><span>  </span><span class="hs-keyword">let</span><span> </span><span class="hs-special">(</span><span id="local-6989586621681374804"><span class="annot"><span class="annottext">Id
</span><a href="#local-6989586621681374804"><span class="hs-identifier hs-var">y</span></a></span></span><span class="hs-special">,</span><span> </span><span id="local-6989586621681374803"><span class="annot"><span class="annottext">vi :: VarInfo
</span><a href="#local-6989586621681374803"><span class="hs-identifier hs-var">vi</span></a></span></span><span class="hs-glyph">@</span><span class="annot"><a href="GHC.HsToCore.Pmc.Solver.Types.html#VI"><span class="hs-identifier hs-type">VI</span></a></span><span> </span><span class="hs-special">{</span><span> </span><span class="annot"><span class="annottext">vi_bot :: VarInfo -&gt; BotInfo
</span><a href="GHC.HsToCore.Pmc.Solver.Types.html#vi_bot"><span class="hs-identifier hs-var">vi_bot</span></a></span><span> </span><span class="hs-glyph">=</span><span> </span><span id="local-6989586621681374802"><span class="annot"><span class="annottext">BotInfo
</span><a href="#local-6989586621681374802"><span class="hs-identifier hs-var">bot</span></a></span></span><span> </span><span class="hs-special">}</span><span class="hs-special">)</span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">TmState -&gt; Id -&gt; (Id, VarInfo)
</span><a href="GHC.HsToCore.Pmc.Solver.html#lookupVarInfoNT"><span class="hs-identifier hs-var">lookupVarInfoNT</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Nabla -&gt; TmState
</span><a href="GHC.HsToCore.Pmc.Solver.Types.html#nabla_tm_st"><span class="hs-identifier hs-var">nabla_tm_st</span></a></span><span> </span><span class="annot"><span class="annottext">Nabla
</span><a href="#local-6989586621681374808"><span class="hs-identifier hs-var">nabla</span></a></span><span class="hs-special">)</span><span> </span><span class="annot"><span class="annottext">Id
</span><a href="#local-6989586621681374805"><span class="hs-identifier hs-var">x</span></a></span><span>
</span><span id="line-768"></span><span>  </span><span class="hs-keyword">case</span><span> </span><span class="annot"><span class="annottext">BotInfo
</span><a href="#local-6989586621681374802"><span class="hs-identifier hs-var">bot</span></a></span><span> </span><span class="hs-keyword">of</span><span>
</span><span id="line-769"></span><span>    </span><span class="annot"><span class="annottext">BotInfo
</span><a href="GHC.HsToCore.Pmc.Solver.Types.html#IsBot"><span class="hs-identifier hs-var">IsBot</span></a></span><span>    </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="annottext">forall (m :: * -&gt; *) a. MonadPlus m =&gt; m a
</span><a href="../../base-4.16.4.0/src/GHC-Base.html#mzero"><span class="hs-identifier hs-var">mzero</span></a></span><span>      </span><span class="hs-comment">-- There was x ~ &#8869;. Contradiction!</span><span>
</span><span id="line-770"></span><span>    </span><span class="annot"><span class="annottext">BotInfo
</span><a href="GHC.HsToCore.Pmc.Solver.Types.html#IsNotBot"><span class="hs-identifier hs-var">IsNotBot</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="annottext">forall (f :: * -&gt; *) a. Applicative f =&gt; a -&gt; f a
</span><a href="../../base-4.16.4.0/src/GHC-Base.html#pure"><span class="hs-identifier hs-var">pure</span></a></span><span> </span><span class="annot"><span class="annottext">Nabla
</span><a href="#local-6989586621681374808"><span class="hs-identifier hs-var">nabla</span></a></span><span> </span><span class="hs-comment">-- There already is x &#8769; &#8869;. Nothing left to do</span><span>
</span><span id="line-771"></span><span>    </span><span class="annot"><span class="annottext">BotInfo
</span><a href="GHC.HsToCore.Pmc.Solver.Types.html#MaybeBot"><span class="hs-identifier hs-var">MaybeBot</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-keyword">do</span><span>         </span><span class="hs-comment">-- We add x &#8769; &#8869; and test if x is still inhabited</span><span>
</span><span id="line-772"></span><span>      </span><span class="hs-comment">-- Mark dirty for a delayed inhabitation test</span><span>
</span><span id="line-773"></span><span>      </span><span class="hs-keyword">let</span><span> </span><span id="local-6989586621681374801"><span class="annot"><span class="annottext">vi' :: VarInfo
</span><a href="#local-6989586621681374801"><span class="hs-identifier hs-var hs-var">vi'</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">VarInfo
</span><a href="#local-6989586621681374803"><span class="hs-identifier hs-var">vi</span></a></span><span class="hs-special">{</span><span> </span><span class="annot"><span class="annottext">vi_bot :: BotInfo
</span><a href="GHC.HsToCore.Pmc.Solver.Types.html#vi_bot"><span class="hs-identifier hs-var">vi_bot</span></a></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">BotInfo
</span><a href="GHC.HsToCore.Pmc.Solver.Types.html#IsNotBot"><span class="hs-identifier hs-var">IsNotBot</span></a></span><span class="hs-special">}</span><span>
</span><span id="line-774"></span><span>      </span><span class="annot"><span class="annottext">forall (f :: * -&gt; *) a. Applicative f =&gt; a -&gt; f a
</span><a href="../../base-4.16.4.0/src/GHC-Base.html#pure"><span class="hs-identifier hs-var">pure</span></a></span><span> </span><span class="annot"><span class="annottext">forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><a href="../../base-4.16.4.0/src/GHC-Base.html#%24"><span class="hs-operator hs-var">$</span></a></span><span> </span><span class="annot"><span class="annottext">Id -&gt; Nabla -&gt; Nabla
</span><a href="GHC.HsToCore.Pmc.Solver.html#markDirty"><span class="hs-identifier hs-var">markDirty</span></a></span><span> </span><span class="annot"><span class="annottext">Id
</span><a href="#local-6989586621681374804"><span class="hs-identifier hs-var">y</span></a></span><span>
</span><span id="line-775"></span><span>           </span><span class="annot"><span class="annottext">forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><a href="../../base-4.16.4.0/src/GHC-Base.html#%24"><span class="hs-operator hs-var">$</span></a></span><span> </span><span class="annot"><span class="annottext">Nabla
</span><a href="#local-6989586621681374808"><span class="hs-identifier hs-var">nabla</span></a></span><span class="hs-special">{</span><span> </span><span class="annot"><span class="annottext">nabla_tm_st :: TmState
</span><a href="GHC.HsToCore.Pmc.Solver.Types.html#nabla_tm_st"><span class="hs-identifier hs-var">nabla_tm_st</span></a></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">TmState
</span><a href="#local-6989586621681374807"><span class="hs-identifier hs-var">ts</span></a></span><span class="hs-special">{</span><span> </span><span class="annot"><span class="annottext">ts_facts :: UniqSDFM Id VarInfo
</span><a href="GHC.HsToCore.Pmc.Solver.Types.html#ts_facts"><span class="hs-identifier hs-var">ts_facts</span></a></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">forall key ele.
Uniquable key =&gt;
UniqSDFM key ele -&gt; key -&gt; ele -&gt; UniqSDFM key ele
</span><a href="GHC.Types.Unique.SDFM.html#addToUSDFM"><span class="hs-identifier hs-var">addToUSDFM</span></a></span><span> </span><span class="annot"><span class="annottext">UniqSDFM Id VarInfo
</span><a href="#local-6989586621681374806"><span class="hs-identifier hs-var">env</span></a></span><span> </span><span class="annot"><span class="annottext">Id
</span><a href="#local-6989586621681374804"><span class="hs-identifier hs-var">y</span></a></span><span> </span><span class="annot"><span class="annottext">VarInfo
</span><a href="#local-6989586621681374801"><span class="hs-identifier hs-var">vi'</span></a></span><span> </span><span class="hs-special">}</span><span> </span><span class="hs-special">}</span><span>
</span><span id="line-776"></span><span>
</span><span id="line-777"></span><span class="hs-comment">-- | Record a @x ~/ K@ constraint, e.g. that a particular 'Id' @x@ can't</span><span>
</span><span id="line-778"></span><span class="hs-comment">-- take the shape of a 'PmAltCon' @K@ in the 'Nabla' and return @Nothing@ if</span><span>
</span><span id="line-779"></span><span class="hs-comment">-- that leads to a contradiction.</span><span>
</span><span id="line-780"></span><span class="hs-comment">-- See Note [TmState invariants].</span><span>
</span><span id="line-781"></span><span class="annot"><a href="GHC.HsToCore.Pmc.Solver.html#addNotConCt"><span class="hs-identifier hs-type">addNotConCt</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><a href="GHC.HsToCore.Pmc.Solver.Types.html#Nabla"><span class="hs-identifier hs-type">Nabla</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="GHC.Types.Var.html#Id"><span class="hs-identifier hs-type">Id</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="GHC.HsToCore.Pmc.Solver.Types.html#PmAltCon"><span class="hs-identifier hs-type">PmAltCon</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="../../transformers-0.5.6.2/src/Control-Monad-Trans-Maybe.html#MaybeT"><span class="hs-identifier hs-type">MaybeT</span></a></span><span> </span><span class="annot"><a href="GHC.HsToCore.Types.html#DsM"><span class="hs-identifier hs-type">DsM</span></a></span><span> </span><span class="annot"><a href="GHC.HsToCore.Pmc.Solver.Types.html#Nabla"><span class="hs-identifier hs-type">Nabla</span></a></span><span>
</span><span id="line-782"></span><span id="addNotConCt"><span class="annot"><span class="annottext">addNotConCt :: Nabla
-&gt; Id -&gt; PmAltCon -&gt; MaybeT (IOEnv (Env DsGblEnv DsLclEnv)) Nabla
</span><a href="GHC.HsToCore.Pmc.Solver.html#addNotConCt"><span class="hs-identifier hs-var hs-var">addNotConCt</span></a></span></span><span> </span><span class="annot"><span class="annottext">Nabla
</span><span class="hs-identifier">_</span></span><span>     </span><span class="annot"><span class="annottext">Id
</span><span class="hs-identifier">_</span></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="GHC.HsToCore.Pmc.Solver.Types.html#PmAltConLike"><span class="hs-identifier hs-type">PmAltConLike</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="GHC.Core.ConLike.html#RealDataCon"><span class="hs-identifier hs-type">RealDataCon</span></a></span><span> </span><span id="local-6989586621681374799"><span class="annot"><span class="annottext">DataCon
</span><a href="#local-6989586621681374799"><span class="hs-identifier hs-var">dc</span></a></span></span><span class="hs-special">)</span><span class="hs-special">)</span><span>
</span><span id="line-783"></span><span>  </span><span class="hs-glyph">|</span><span> </span><span class="annot"><span class="annottext">DataCon -&gt; Bool
</span><a href="GHC.Core.DataCon.html#isNewDataCon"><span class="hs-identifier hs-var">isNewDataCon</span></a></span><span> </span><span class="annot"><span class="annottext">DataCon
</span><a href="#local-6989586621681374799"><span class="hs-identifier hs-var">dc</span></a></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">forall (m :: * -&gt; *) a. MonadPlus m =&gt; m a
</span><a href="../../base-4.16.4.0/src/GHC-Base.html#mzero"><span class="hs-identifier hs-var">mzero</span></a></span><span> </span><span class="hs-comment">-- (3) in Note [Coverage checking Newtype matches]</span><span>
</span><span id="line-784"></span><span class="annot"><a href="GHC.HsToCore.Pmc.Solver.html#addNotConCt"><span class="hs-identifier hs-var">addNotConCt</span></a></span><span> </span><span id="local-6989586621681374798"><span class="annot"><span class="annottext">Nabla
</span><a href="#local-6989586621681374798"><span class="hs-identifier hs-var">nabla</span></a></span></span><span> </span><span id="local-6989586621681374797"><span class="annot"><span class="annottext">Id
</span><a href="#local-6989586621681374797"><span class="hs-identifier hs-var">x</span></a></span></span><span> </span><span id="local-6989586621681374796"><span class="annot"><span class="annottext">PmAltCon
</span><a href="#local-6989586621681374796"><span class="hs-identifier hs-var">nalt</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-keyword">do</span><span>
</span><span id="line-785"></span><span>  </span><span class="hs-special">(</span><span id="local-6989586621681374795"><span class="annot"><span class="annottext">Maybe Id
</span><a href="#local-6989586621681374795"><span class="hs-identifier hs-var">mb_mark_dirty</span></a></span></span><span class="hs-special">,</span><span> </span><span id="local-6989586621681374794"><span class="annot"><span class="annottext">Nabla
</span><a href="#local-6989586621681374794"><span class="hs-identifier hs-var">nabla'</span></a></span></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">forall (f :: * -&gt; *) a.
Functor f =&gt;
(VarInfo -&gt; f (a, VarInfo)) -&gt; Nabla -&gt; Id -&gt; f (a, Nabla)
</span><a href="GHC.HsToCore.Pmc.Solver.html#trvVarInfo"><span class="hs-identifier hs-var">trvVarInfo</span></a></span><span> </span><span class="annot"><span class="annottext">VarInfo
-&gt; MaybeT (IOEnv (Env DsGblEnv DsLclEnv)) (Maybe Id, VarInfo)
</span><a href="#local-6989586621681374793"><span class="hs-identifier hs-var">go</span></a></span><span> </span><span class="annot"><span class="annottext">Nabla
</span><a href="#local-6989586621681374798"><span class="hs-identifier hs-var">nabla</span></a></span><span> </span><span class="annot"><span class="annottext">Id
</span><a href="#local-6989586621681374797"><span class="hs-identifier hs-var">x</span></a></span><span>
</span><span id="line-786"></span><span>  </span><span class="annot"><span class="annottext">forall (f :: * -&gt; *) a. Applicative f =&gt; a -&gt; f a
</span><a href="../../base-4.16.4.0/src/GHC-Base.html#pure"><span class="hs-identifier hs-var">pure</span></a></span><span> </span><span class="annot"><span class="annottext">forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><a href="../../base-4.16.4.0/src/GHC-Base.html#%24"><span class="hs-operator hs-var">$</span></a></span><span> </span><span class="hs-keyword">case</span><span> </span><span class="annot"><span class="annottext">Maybe Id
</span><a href="#local-6989586621681374795"><span class="hs-identifier hs-var">mb_mark_dirty</span></a></span><span> </span><span class="hs-keyword">of</span><span>
</span><span id="line-787"></span><span>    </span><span class="annot"><a href="../../base-4.16.4.0/src/GHC-Maybe.html#Just"><span class="hs-identifier hs-type">Just</span></a></span><span> </span><span id="local-6989586621681374792"><span class="annot"><span class="annottext">Id
</span><a href="#local-6989586621681374792"><span class="hs-identifier hs-var">x</span></a></span></span><span>  </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="annottext">Id -&gt; Nabla -&gt; Nabla
</span><a href="GHC.HsToCore.Pmc.Solver.html#markDirty"><span class="hs-identifier hs-var">markDirty</span></a></span><span> </span><span class="annot"><span class="annottext">Id
</span><a href="#local-6989586621681374792"><span class="hs-identifier hs-var">x</span></a></span><span> </span><span class="annot"><span class="annottext">Nabla
</span><a href="#local-6989586621681374794"><span class="hs-identifier hs-var">nabla'</span></a></span><span>
</span><span id="line-788"></span><span>    </span><span class="annot"><span class="annottext">Maybe Id
</span><a href="../../base-4.16.4.0/src/GHC-Maybe.html#Nothing"><span class="hs-identifier hs-var">Nothing</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="annottext">Nabla
</span><a href="#local-6989586621681374794"><span class="hs-identifier hs-var">nabla'</span></a></span><span>
</span><span id="line-789"></span><span>  </span><span class="hs-keyword">where</span><span>
</span><span id="line-790"></span><span>    </span><span class="hs-comment">-- | Update `x`'s 'VarInfo' entry. Fail ('MaybeT') if contradiction,</span><span>
</span><span id="line-791"></span><span>    </span><span class="hs-comment">-- otherwise return updated entry and `Just x'` if `x` should be marked dirty,</span><span>
</span><span id="line-792"></span><span>    </span><span class="hs-comment">-- where `x'` is the representative of `x`.</span><span>
</span><span id="line-793"></span><span>    </span><span class="annot"><a href="#local-6989586621681374793"><span class="hs-identifier hs-type">go</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><a href="GHC.HsToCore.Pmc.Solver.Types.html#VarInfo"><span class="hs-identifier hs-type">VarInfo</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="../../transformers-0.5.6.2/src/Control-Monad-Trans-Maybe.html#MaybeT"><span class="hs-identifier hs-type">MaybeT</span></a></span><span> </span><span class="annot"><a href="GHC.HsToCore.Types.html#DsM"><span class="hs-identifier hs-type">DsM</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="../../base-4.16.4.0/src/GHC-Maybe.html#Maybe"><span class="hs-identifier hs-type">Maybe</span></a></span><span> </span><span class="annot"><a href="GHC.Types.Var.html#Id"><span class="hs-identifier hs-type">Id</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><a href="GHC.HsToCore.Pmc.Solver.Types.html#VarInfo"><span class="hs-identifier hs-type">VarInfo</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-794"></span><span>    </span><span id="local-6989586621681374793"><span class="annot"><span class="annottext">go :: VarInfo
-&gt; MaybeT (IOEnv (Env DsGblEnv DsLclEnv)) (Maybe Id, VarInfo)
</span><a href="#local-6989586621681374793"><span class="hs-identifier hs-var hs-var">go</span></a></span></span><span> </span><span id="local-6989586621681374791"><span class="annot"><span class="annottext">vi :: VarInfo
</span><a href="#local-6989586621681374791"><span class="hs-identifier hs-var">vi</span></a></span></span><span class="hs-glyph">@</span><span class="hs-special">(</span><span class="annot"><a href="GHC.HsToCore.Pmc.Solver.Types.html#VI"><span class="hs-identifier hs-type">VI</span></a></span><span> </span><span id="local-6989586621681374790"><span class="annot"><span class="annottext">Id
</span><a href="#local-6989586621681374790"><span class="hs-identifier hs-var">x'</span></a></span></span><span> </span><span id="local-6989586621681374789"><span class="annot"><span class="annottext">[PmAltConApp]
</span><a href="#local-6989586621681374789"><span class="hs-identifier hs-var">pos</span></a></span></span><span> </span><span id="local-6989586621681374788"><span class="annot"><span class="annottext">PmAltConSet
</span><a href="#local-6989586621681374788"><span class="hs-identifier hs-var">neg</span></a></span></span><span> </span><span class="annot"><span class="annottext">BotInfo
</span><span class="hs-identifier">_</span></span><span> </span><span id="local-6989586621681374787"><span class="annot"><span class="annottext">ResidualCompleteMatches
</span><a href="#local-6989586621681374787"><span class="hs-identifier hs-var">rcm</span></a></span></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-keyword">do</span><span>
</span><span id="line-795"></span><span>      </span><span class="hs-comment">-- 1. Bail out quickly when nalt contradicts a solution</span><span>
</span><span id="line-796"></span><span>      </span><span class="hs-keyword">let</span><span> </span><span id="local-6989586621681374785"><span class="annot"><span class="annottext">contradicts :: PmAltCon -&gt; PmAltConApp -&gt; Bool
</span><a href="#local-6989586621681374785"><span class="hs-identifier hs-var hs-var">contradicts</span></a></span></span><span> </span><span id="local-6989586621681374784"><span class="annot"><span class="annottext">PmAltCon
</span><a href="#local-6989586621681374784"><span class="hs-identifier hs-var">nalt</span></a></span></span><span> </span><span id="local-6989586621681374783"><span class="annot"><span class="annottext">PmAltConApp
</span><a href="#local-6989586621681374783"><span class="hs-identifier hs-var">sol</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">PmAltCon -&gt; PmAltCon -&gt; PmEquality
</span><a href="GHC.HsToCore.Pmc.Solver.Types.html#eqPmAltCon"><span class="hs-identifier hs-var">eqPmAltCon</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">PmAltConApp -&gt; PmAltCon
</span><a href="GHC.HsToCore.Pmc.Solver.Types.html#paca_con"><span class="hs-identifier hs-var">paca_con</span></a></span><span> </span><span class="annot"><span class="annottext">PmAltConApp
</span><a href="#local-6989586621681374783"><span class="hs-identifier hs-var">sol</span></a></span><span class="hs-special">)</span><span> </span><span class="annot"><span class="annottext">PmAltCon
</span><a href="#local-6989586621681374784"><span class="hs-identifier hs-var">nalt</span></a></span><span> </span><span class="annot"><span class="annottext">forall a. Eq a =&gt; a -&gt; a -&gt; Bool
</span><span class="hs-operator hs-var">==</span></span><span> </span><span class="annot"><span class="annottext">PmEquality
</span><a href="GHC.HsToCore.Pmc.Solver.Types.html#Equal"><span class="hs-identifier hs-var">Equal</span></a></span><span>
</span><span id="line-797"></span><span>      </span><span class="annot"><span class="annottext">forall (f :: * -&gt; *). Alternative f =&gt; Bool -&gt; f ()
</span><a href="../../base-4.16.4.0/src/Control-Monad.html#guard"><span class="hs-identifier hs-var">guard</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Bool -&gt; Bool
</span><span class="hs-identifier hs-var">not</span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">forall (t :: * -&gt; *) a. Foldable t =&gt; (a -&gt; Bool) -&gt; t a -&gt; Bool
</span><a href="../../base-4.16.4.0/src/Data-Foldable.html#any"><span class="hs-identifier hs-var">any</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">PmAltCon -&gt; PmAltConApp -&gt; Bool
</span><a href="#local-6989586621681374785"><span class="hs-identifier hs-var">contradicts</span></a></span><span> </span><span class="annot"><span class="annottext">PmAltCon
</span><a href="#local-6989586621681374796"><span class="hs-identifier hs-var">nalt</span></a></span><span class="hs-special">)</span><span> </span><span class="annot"><span class="annottext">[PmAltConApp]
</span><a href="#local-6989586621681374789"><span class="hs-identifier hs-var">pos</span></a></span><span class="hs-special">)</span><span class="hs-special">)</span><span>
</span><span id="line-798"></span><span>      </span><span class="hs-comment">-- 2. Only record the new fact when it's not already implied by one of the</span><span>
</span><span id="line-799"></span><span>      </span><span class="hs-comment">-- solutions</span><span>
</span><span id="line-800"></span><span>      </span><span class="hs-keyword">let</span><span> </span><span id="local-6989586621681374778"><span class="annot"><span class="annottext">implies :: PmAltCon -&gt; PmAltConApp -&gt; Bool
</span><a href="#local-6989586621681374778"><span class="hs-identifier hs-var hs-var">implies</span></a></span></span><span> </span><span id="local-6989586621681374777"><span class="annot"><span class="annottext">PmAltCon
</span><a href="#local-6989586621681374777"><span class="hs-identifier hs-var">nalt</span></a></span></span><span> </span><span id="local-6989586621681374776"><span class="annot"><span class="annottext">PmAltConApp
</span><a href="#local-6989586621681374776"><span class="hs-identifier hs-var">sol</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">PmAltCon -&gt; PmAltCon -&gt; PmEquality
</span><a href="GHC.HsToCore.Pmc.Solver.Types.html#eqPmAltCon"><span class="hs-identifier hs-var">eqPmAltCon</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">PmAltConApp -&gt; PmAltCon
</span><a href="GHC.HsToCore.Pmc.Solver.Types.html#paca_con"><span class="hs-identifier hs-var">paca_con</span></a></span><span> </span><span class="annot"><span class="annottext">PmAltConApp
</span><a href="#local-6989586621681374776"><span class="hs-identifier hs-var">sol</span></a></span><span class="hs-special">)</span><span> </span><span class="annot"><span class="annottext">PmAltCon
</span><a href="#local-6989586621681374777"><span class="hs-identifier hs-var">nalt</span></a></span><span> </span><span class="annot"><span class="annottext">forall a. Eq a =&gt; a -&gt; a -&gt; Bool
</span><span class="hs-operator hs-var">==</span></span><span> </span><span class="annot"><span class="annottext">PmEquality
</span><a href="GHC.HsToCore.Pmc.Solver.Types.html#Disjoint"><span class="hs-identifier hs-var">Disjoint</span></a></span><span>
</span><span id="line-801"></span><span>      </span><span class="hs-keyword">let</span><span> </span><span id="local-6989586621681374774"><span class="annot"><span class="annottext">neg' :: PmAltConSet
</span><a href="#local-6989586621681374774"><span class="hs-identifier hs-var hs-var">neg'</span></a></span></span><span>
</span><span id="line-802"></span><span>            </span><span class="hs-glyph">|</span><span> </span><span class="annot"><span class="annottext">forall (t :: * -&gt; *) a. Foldable t =&gt; (a -&gt; Bool) -&gt; t a -&gt; Bool
</span><a href="../../base-4.16.4.0/src/Data-Foldable.html#any"><span class="hs-identifier hs-var">any</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">PmAltCon -&gt; PmAltConApp -&gt; Bool
</span><a href="#local-6989586621681374778"><span class="hs-identifier hs-var">implies</span></a></span><span> </span><span class="annot"><span class="annottext">PmAltCon
</span><a href="#local-6989586621681374796"><span class="hs-identifier hs-var">nalt</span></a></span><span class="hs-special">)</span><span> </span><span class="annot"><span class="annottext">[PmAltConApp]
</span><a href="#local-6989586621681374789"><span class="hs-identifier hs-var">pos</span></a></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">PmAltConSet
</span><a href="#local-6989586621681374788"><span class="hs-identifier hs-var">neg</span></a></span><span>
</span><span id="line-803"></span><span>            </span><span class="hs-comment">-- See Note [Completeness checking with required Thetas]</span><span>
</span><span id="line-804"></span><span>            </span><span class="hs-glyph">|</span><span> </span><span class="annot"><span class="annottext">PmAltCon -&gt; Bool
</span><a href="GHC.HsToCore.Pmc.Solver.html#hasRequiredTheta"><span class="hs-identifier hs-var">hasRequiredTheta</span></a></span><span> </span><span class="annot"><span class="annottext">PmAltCon
</span><a href="#local-6989586621681374796"><span class="hs-identifier hs-var">nalt</span></a></span><span>  </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">PmAltConSet
</span><a href="#local-6989586621681374788"><span class="hs-identifier hs-var">neg</span></a></span><span>
</span><span id="line-805"></span><span>            </span><span class="hs-glyph">|</span><span> </span><span class="annot"><span class="annottext">Bool
</span><a href="../../base-4.16.4.0/src/GHC-Base.html#otherwise"><span class="hs-identifier hs-var">otherwise</span></a></span><span>              </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">PmAltConSet -&gt; PmAltCon -&gt; PmAltConSet
</span><a href="GHC.HsToCore.Pmc.Solver.Types.html#extendPmAltConSet"><span class="hs-identifier hs-var">extendPmAltConSet</span></a></span><span> </span><span class="annot"><span class="annottext">PmAltConSet
</span><a href="#local-6989586621681374788"><span class="hs-identifier hs-var">neg</span></a></span><span> </span><span class="annot"><span class="annottext">PmAltCon
</span><a href="#local-6989586621681374796"><span class="hs-identifier hs-var">nalt</span></a></span><span>
</span><span id="line-806"></span><span>      </span><span class="hs-identifier">MASSERT</span><span class="hs-special">(</span><span> </span><span class="hs-identifier">isPmAltConMatchStrict</span><span> </span><span class="hs-identifier">nalt</span><span> </span><span class="hs-special">)</span><span>
</span><span id="line-807"></span><span>      </span><span class="hs-keyword">let</span><span> </span><span id="local-6989586621681374769"><span class="annot"><span class="annottext">vi' :: VarInfo
</span><a href="#local-6989586621681374769"><span class="hs-identifier hs-var hs-var">vi'</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">VarInfo
</span><a href="#local-6989586621681374791"><span class="hs-identifier hs-var">vi</span></a></span><span class="hs-special">{</span><span> </span><span class="annot"><span class="annottext">vi_neg :: PmAltConSet
</span><a href="GHC.HsToCore.Pmc.Solver.Types.html#vi_neg"><span class="hs-identifier hs-var">vi_neg</span></a></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">PmAltConSet
</span><a href="#local-6989586621681374774"><span class="hs-identifier hs-var">neg'</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">vi_bot :: BotInfo
</span><a href="GHC.HsToCore.Pmc.Solver.Types.html#vi_bot"><span class="hs-identifier hs-var">vi_bot</span></a></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">BotInfo
</span><a href="GHC.HsToCore.Pmc.Solver.Types.html#IsNotBot"><span class="hs-identifier hs-var">IsNotBot</span></a></span><span> </span><span class="hs-special">}</span><span>
</span><span id="line-808"></span><span>      </span><span class="hs-comment">-- 3. Make sure there's at least one other possible constructor</span><span>
</span><span id="line-809"></span><span>      </span><span id="local-6989586621681374768"><span class="annot"><span class="annottext">Maybe ResidualCompleteMatches
</span><a href="#local-6989586621681374768"><span class="hs-identifier hs-var">mb_rcm'</span></a></span></span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">forall (t :: (* -&gt; *) -&gt; * -&gt; *) (m :: * -&gt; *) a.
(MonadTrans t, Monad m) =&gt;
m a -&gt; t m a
</span><a href="../../transformers-0.5.6.2/src/Control-Monad-Trans-Class.html#lift"><span class="hs-identifier hs-var">lift</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">PmAltCon
-&gt; ResidualCompleteMatches -&gt; DsM (Maybe ResidualCompleteMatches)
</span><a href="GHC.HsToCore.Pmc.Solver.html#markMatched"><span class="hs-identifier hs-var">markMatched</span></a></span><span> </span><span class="annot"><span class="annottext">PmAltCon
</span><a href="#local-6989586621681374796"><span class="hs-identifier hs-var">nalt</span></a></span><span> </span><span class="annot"><span class="annottext">ResidualCompleteMatches
</span><a href="#local-6989586621681374787"><span class="hs-identifier hs-var">rcm</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-810"></span><span>      </span><span class="annot"><span class="annottext">forall (f :: * -&gt; *) a. Applicative f =&gt; a -&gt; f a
</span><a href="../../base-4.16.4.0/src/GHC-Base.html#pure"><span class="hs-identifier hs-var">pure</span></a></span><span> </span><span class="annot"><span class="annottext">forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><a href="../../base-4.16.4.0/src/GHC-Base.html#%24"><span class="hs-operator hs-var">$</span></a></span><span> </span><span class="hs-keyword">case</span><span> </span><span class="annot"><span class="annottext">Maybe ResidualCompleteMatches
</span><a href="#local-6989586621681374768"><span class="hs-identifier hs-var">mb_rcm'</span></a></span><span> </span><span class="hs-keyword">of</span><span>
</span><span id="line-811"></span><span>        </span><span class="hs-comment">-- If nalt could be removed from a COMPLETE set, we'll get back Just and</span><span>
</span><span id="line-812"></span><span>        </span><span class="hs-comment">-- have to mark x dirty, by returning Just x'.</span><span>
</span><span id="line-813"></span><span>        </span><span class="annot"><a href="../../base-4.16.4.0/src/GHC-Maybe.html#Just"><span class="hs-identifier hs-type">Just</span></a></span><span> </span><span id="local-6989586621681374767"><span class="annot"><span class="annottext">ResidualCompleteMatches
</span><a href="#local-6989586621681374767"><span class="hs-identifier hs-var">rcm'</span></a></span></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">forall a. a -&gt; Maybe a
</span><a href="../../base-4.16.4.0/src/GHC-Maybe.html#Just"><span class="hs-identifier hs-var">Just</span></a></span><span> </span><span class="annot"><span class="annottext">Id
</span><a href="#local-6989586621681374790"><span class="hs-identifier hs-var">x'</span></a></span><span class="hs-special">,</span><span>  </span><span class="annot"><span class="annottext">VarInfo
</span><a href="#local-6989586621681374769"><span class="hs-identifier hs-var">vi'</span></a></span><span class="hs-special">{</span><span> </span><span class="annot"><span class="annottext">vi_rcm :: ResidualCompleteMatches
</span><a href="GHC.HsToCore.Pmc.Solver.Types.html#vi_rcm"><span class="hs-identifier hs-var">vi_rcm</span></a></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">ResidualCompleteMatches
</span><a href="#local-6989586621681374767"><span class="hs-identifier hs-var">rcm'</span></a></span><span> </span><span class="hs-special">}</span><span class="hs-special">)</span><span>
</span><span id="line-814"></span><span>        </span><span class="hs-comment">-- Otherwise, nalt didn't occur in any residual COMPLETE set and we</span><span>
</span><span id="line-815"></span><span>        </span><span class="hs-comment">-- don't have to mark it dirty. So we return Nothing, which in the case</span><span>
</span><span id="line-816"></span><span>        </span><span class="hs-comment">-- above would have compromised precision.</span><span>
</span><span id="line-817"></span><span>        </span><span class="hs-comment">-- See Note [Shortcutting the inhabitation test], grep for T17836.</span><span>
</span><span id="line-818"></span><span>        </span><span class="annot"><span class="annottext">Maybe ResidualCompleteMatches
</span><a href="../../base-4.16.4.0/src/GHC-Maybe.html#Nothing"><span class="hs-identifier hs-var">Nothing</span></a></span><span>   </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">forall a. Maybe a
</span><a href="../../base-4.16.4.0/src/GHC-Maybe.html#Nothing"><span class="hs-identifier hs-var">Nothing</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">VarInfo
</span><a href="#local-6989586621681374769"><span class="hs-identifier hs-var">vi'</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-819"></span><span>
</span><span id="line-820"></span><span class="annot"><a href="GHC.HsToCore.Pmc.Solver.html#hasRequiredTheta"><span class="hs-identifier hs-type">hasRequiredTheta</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><a href="GHC.HsToCore.Pmc.Solver.Types.html#PmAltCon"><span class="hs-identifier hs-type">PmAltCon</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="hs-identifier hs-type">Bool</span></span><span>
</span><span id="line-821"></span><span id="hasRequiredTheta"><span class="annot"><span class="annottext">hasRequiredTheta :: PmAltCon -&gt; Bool
</span><a href="GHC.HsToCore.Pmc.Solver.html#hasRequiredTheta"><span class="hs-identifier hs-var hs-var">hasRequiredTheta</span></a></span></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="GHC.HsToCore.Pmc.Solver.Types.html#PmAltConLike"><span class="hs-identifier hs-type">PmAltConLike</span></a></span><span> </span><span id="local-6989586621681374766"><span class="annot"><span class="annottext">ConLike
</span><a href="#local-6989586621681374766"><span class="hs-identifier hs-var">cl</span></a></span></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">forall (f :: * -&gt; *) a. Foldable f =&gt; f a -&gt; Bool
</span><a href="GHC.Utils.Misc.html#notNull"><span class="hs-identifier hs-var">notNull</span></a></span><span> </span><span class="annot"><span class="annottext">ThetaType
</span><a href="#local-6989586621681374764"><span class="hs-identifier hs-var">req_theta</span></a></span><span>
</span><span id="line-822"></span><span>  </span><span class="hs-keyword">where</span><span>
</span><span id="line-823"></span><span>    </span><span class="hs-special">(</span><span class="annot"><span class="annottext">[Id]
</span><span class="hs-identifier">_</span></span><span class="hs-special">,</span><span class="annot"><span class="annottext">[Id]
</span><span class="hs-identifier">_</span></span><span class="hs-special">,</span><span class="annot"><span class="annottext">[EqSpec]
</span><span class="hs-identifier">_</span></span><span class="hs-special">,</span><span class="annot"><span class="annottext">ThetaType
</span><span class="hs-identifier">_</span></span><span class="hs-special">,</span><span id="local-6989586621681374764"><span class="annot"><span class="annottext">ThetaType
</span><a href="#local-6989586621681374764"><span class="hs-identifier hs-var">req_theta</span></a></span></span><span class="hs-special">,</span><span class="annot"><span class="annottext">[Scaled Type]
</span><span class="hs-identifier">_</span></span><span class="hs-special">,</span><span class="annot"><span class="annottext">Type
</span><span class="hs-identifier">_</span></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">ConLike
-&gt; ([Id], [Id], [EqSpec], ThetaType, ThetaType, [Scaled Type],
    Type)
</span><a href="GHC.Core.ConLike.html#conLikeFullSig"><span class="hs-identifier hs-var">conLikeFullSig</span></a></span><span> </span><span class="annot"><span class="annottext">ConLike
</span><a href="#local-6989586621681374766"><span class="hs-identifier hs-var">cl</span></a></span><span>
</span><span id="line-824"></span><span class="annot"><a href="GHC.HsToCore.Pmc.Solver.html#hasRequiredTheta"><span class="hs-identifier hs-var">hasRequiredTheta</span></a></span><span> </span><span class="annot"><span class="annottext">PmAltCon
</span><span class="hs-identifier">_</span></span><span>                 </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">Bool
</span><span class="hs-identifier hs-var">False</span></span><span>
</span><span id="line-825"></span><span>
</span><span id="line-826"></span><span class="hs-comment">-- | Add a @x ~ K tvs args ts@ constraint.</span><span>
</span><span id="line-827"></span><span class="hs-comment">-- @addConCt x K tvs args ts@ extends the substitution with a solution</span><span>
</span><span id="line-828"></span><span class="hs-comment">-- @x :-&gt; (K, tvs, args)@ if compatible with the negative and positive info we</span><span>
</span><span id="line-829"></span><span class="hs-comment">-- have on @x@, reject (@Nothing@) otherwise.</span><span>
</span><span id="line-830"></span><span class="hs-comment">--</span><span>
</span><span id="line-831"></span><span class="hs-comment">-- See Note [TmState invariants].</span><span>
</span><span id="line-832"></span><span class="annot"><a href="GHC.HsToCore.Pmc.Solver.html#addConCt"><span class="hs-identifier hs-type">addConCt</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><a href="GHC.HsToCore.Pmc.Solver.Types.html#Nabla"><span class="hs-identifier hs-type">Nabla</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="GHC.Types.Var.html#Id"><span class="hs-identifier hs-type">Id</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="GHC.HsToCore.Pmc.Solver.Types.html#PmAltCon"><span class="hs-identifier hs-type">PmAltCon</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-special">[</span><span class="annot"><a href="GHC.Types.Var.html#TyVar"><span class="hs-identifier hs-type">TyVar</span></a></span><span class="hs-special">]</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-special">[</span><span class="annot"><a href="GHC.Types.Var.html#Id"><span class="hs-identifier hs-type">Id</span></a></span><span class="hs-special">]</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="../../transformers-0.5.6.2/src/Control-Monad-Trans-Maybe.html#MaybeT"><span class="hs-identifier hs-type">MaybeT</span></a></span><span> </span><span class="annot"><a href="GHC.HsToCore.Types.html#DsM"><span class="hs-identifier hs-type">DsM</span></a></span><span> </span><span class="annot"><a href="GHC.HsToCore.Pmc.Solver.Types.html#Nabla"><span class="hs-identifier hs-type">Nabla</span></a></span><span>
</span><span id="line-833"></span><span id="addConCt"><span class="annot"><span class="annottext">addConCt :: Nabla
-&gt; Id
-&gt; PmAltCon
-&gt; [Id]
-&gt; [Id]
-&gt; MaybeT (IOEnv (Env DsGblEnv DsLclEnv)) Nabla
</span><a href="GHC.HsToCore.Pmc.Solver.html#addConCt"><span class="hs-identifier hs-var hs-var">addConCt</span></a></span></span><span> </span><span id="local-6989586621681374762"><span class="annot"><span class="annottext">nabla :: Nabla
</span><a href="#local-6989586621681374762"><span class="hs-identifier hs-var">nabla</span></a></span></span><span class="hs-glyph">@</span><span class="annot"><a href="GHC.HsToCore.Pmc.Solver.Types.html#MkNabla"><span class="hs-identifier hs-type">MkNabla</span></a></span><span class="hs-special">{</span><span> </span><span class="annot"><span class="annottext">nabla_tm_st :: Nabla -&gt; TmState
</span><a href="GHC.HsToCore.Pmc.Solver.Types.html#nabla_tm_st"><span class="hs-identifier hs-var">nabla_tm_st</span></a></span><span> </span><span class="hs-glyph">=</span><span> </span><span id="local-6989586621681374761"><span class="annot"><span class="annottext">ts :: TmState
</span><a href="#local-6989586621681374761"><span class="hs-identifier hs-var">ts</span></a></span></span><span class="hs-glyph">@</span><span class="annot"><a href="GHC.HsToCore.Pmc.Solver.Types.html#TmSt"><span class="hs-identifier hs-type">TmSt</span></a></span><span class="hs-special">{</span><span> </span><span class="annot"><span class="annottext">ts_facts :: TmState -&gt; UniqSDFM Id VarInfo
</span><a href="GHC.HsToCore.Pmc.Solver.Types.html#ts_facts"><span class="hs-identifier hs-var">ts_facts</span></a></span><span class="hs-glyph">=</span><span id="local-6989586621681374760"><span class="annot"><span class="annottext">UniqSDFM Id VarInfo
</span><a href="#local-6989586621681374760"><span class="hs-identifier hs-var">env</span></a></span></span><span> </span><span class="hs-special">}</span><span> </span><span class="hs-special">}</span><span> </span><span id="local-6989586621681374759"><span class="annot"><span class="annottext">Id
</span><a href="#local-6989586621681374759"><span class="hs-identifier hs-var">x</span></a></span></span><span> </span><span id="local-6989586621681374758"><span class="annot"><span class="annottext">PmAltCon
</span><a href="#local-6989586621681374758"><span class="hs-identifier hs-var">alt</span></a></span></span><span> </span><span id="local-6989586621681374757"><span class="annot"><span class="annottext">[Id]
</span><a href="#local-6989586621681374757"><span class="hs-identifier hs-var">tvs</span></a></span></span><span> </span><span id="local-6989586621681374756"><span class="annot"><span class="annottext">[Id]
</span><a href="#local-6989586621681374756"><span class="hs-identifier hs-var">args</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-keyword">do</span><span>
</span><span id="line-834"></span><span>  </span><span class="hs-keyword">let</span><span> </span><span id="local-6989586621681374755"><span class="annot"><span class="annottext">vi :: VarInfo
</span><a href="#local-6989586621681374755"><span class="hs-identifier hs-var">vi</span></a></span></span><span class="hs-glyph">@</span><span class="hs-special">(</span><span class="annot"><a href="GHC.HsToCore.Pmc.Solver.Types.html#VI"><span class="hs-identifier hs-type">VI</span></a></span><span> </span><span class="annot"><span class="annottext">Id
</span><span class="hs-identifier">_</span></span><span> </span><span id="local-6989586621681374754"><span class="annot"><span class="annottext">[PmAltConApp]
</span><a href="#local-6989586621681374754"><span class="hs-identifier hs-var">pos</span></a></span></span><span> </span><span id="local-6989586621681374753"><span class="annot"><span class="annottext">PmAltConSet
</span><a href="#local-6989586621681374753"><span class="hs-identifier hs-var">neg</span></a></span></span><span> </span><span id="local-6989586621681374752"><span class="annot"><span class="annottext">BotInfo
</span><a href="#local-6989586621681374752"><span class="hs-identifier hs-var">bot</span></a></span></span><span> </span><span class="annot"><span class="annottext">ResidualCompleteMatches
</span><span class="hs-identifier">_</span></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">TmState -&gt; Id -&gt; VarInfo
</span><a href="GHC.HsToCore.Pmc.Solver.html#lookupVarInfo"><span class="hs-identifier hs-var">lookupVarInfo</span></a></span><span> </span><span class="annot"><span class="annottext">TmState
</span><a href="#local-6989586621681374761"><span class="hs-identifier hs-var">ts</span></a></span><span> </span><span class="annot"><span class="annottext">Id
</span><a href="#local-6989586621681374759"><span class="hs-identifier hs-var">x</span></a></span><span>
</span><span id="line-835"></span><span>  </span><span class="hs-comment">-- First try to refute with a negative fact</span><span>
</span><span id="line-836"></span><span>  </span><span class="annot"><span class="annottext">forall (f :: * -&gt; *). Alternative f =&gt; Bool -&gt; f ()
</span><a href="../../base-4.16.4.0/src/Control-Monad.html#guard"><span class="hs-identifier hs-var">guard</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Bool -&gt; Bool
</span><span class="hs-identifier hs-var">not</span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">PmAltCon -&gt; PmAltConSet -&gt; Bool
</span><a href="GHC.HsToCore.Pmc.Solver.Types.html#elemPmAltConSet"><span class="hs-identifier hs-var">elemPmAltConSet</span></a></span><span> </span><span class="annot"><span class="annottext">PmAltCon
</span><a href="#local-6989586621681374758"><span class="hs-identifier hs-var">alt</span></a></span><span> </span><span class="annot"><span class="annottext">PmAltConSet
</span><a href="#local-6989586621681374753"><span class="hs-identifier hs-var">neg</span></a></span><span class="hs-special">)</span><span class="hs-special">)</span><span>
</span><span id="line-837"></span><span>  </span><span class="hs-comment">-- Then see if any of the other solutions (remember: each of them is an</span><span>
</span><span id="line-838"></span><span>  </span><span class="hs-comment">-- additional refinement of the possible values x could take) indicate a</span><span>
</span><span id="line-839"></span><span>  </span><span class="hs-comment">-- contradiction</span><span>
</span><span id="line-840"></span><span>  </span><span class="annot"><span class="annottext">forall (f :: * -&gt; *). Alternative f =&gt; Bool -&gt; f ()
</span><a href="../../base-4.16.4.0/src/Control-Monad.html#guard"><span class="hs-identifier hs-var">guard</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">forall (t :: * -&gt; *) a. Foldable t =&gt; (a -&gt; Bool) -&gt; t a -&gt; Bool
</span><a href="../../base-4.16.4.0/src/Data-Foldable.html#all"><span class="hs-identifier hs-var">all</span></a></span><span> </span><span class="hs-special">(</span><span class="hs-special">(</span><span class="annot"><span class="annottext">forall a. Eq a =&gt; a -&gt; a -&gt; Bool
</span><span class="hs-operator hs-var">/=</span></span><span> </span><span class="annot"><span class="annottext">PmEquality
</span><a href="GHC.HsToCore.Pmc.Solver.Types.html#Disjoint"><span class="hs-identifier hs-var">Disjoint</span></a></span><span class="hs-special">)</span><span> </span><span class="annot"><span class="annottext">forall b c a. (b -&gt; c) -&gt; (a -&gt; b) -&gt; a -&gt; c
</span><a href="../../base-4.16.4.0/src/GHC-Base.html#."><span class="hs-operator hs-var">.</span></a></span><span> </span><span class="annot"><span class="annottext">PmAltCon -&gt; PmAltCon -&gt; PmEquality
</span><a href="GHC.HsToCore.Pmc.Solver.Types.html#eqPmAltCon"><span class="hs-identifier hs-var">eqPmAltCon</span></a></span><span> </span><span class="annot"><span class="annottext">PmAltCon
</span><a href="#local-6989586621681374758"><span class="hs-identifier hs-var">alt</span></a></span><span> </span><span class="annot"><span class="annottext">forall b c a. (b -&gt; c) -&gt; (a -&gt; b) -&gt; a -&gt; c
</span><a href="../../base-4.16.4.0/src/GHC-Base.html#."><span class="hs-operator hs-var">.</span></a></span><span> </span><span class="annot"><span class="annottext">PmAltConApp -&gt; PmAltCon
</span><a href="GHC.HsToCore.Pmc.Solver.Types.html#paca_con"><span class="hs-identifier hs-var">paca_con</span></a></span><span class="hs-special">)</span><span> </span><span class="annot"><span class="annottext">[PmAltConApp]
</span><a href="#local-6989586621681374754"><span class="hs-identifier hs-var">pos</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-841"></span><span>  </span><span class="hs-comment">-- Now we should be good! Add (alt, tvs, args) as a possible solution, or</span><span>
</span><span id="line-842"></span><span>  </span><span class="hs-comment">-- refine an existing one</span><span>
</span><span id="line-843"></span><span>  </span><span class="hs-keyword">case</span><span> </span><span class="annot"><span class="annottext">forall (t :: * -&gt; *) a. Foldable t =&gt; (a -&gt; Bool) -&gt; t a -&gt; Maybe a
</span><a href="../../base-4.16.4.0/src/Data-Foldable.html#find"><span class="hs-identifier hs-var">find</span></a></span><span> </span><span class="hs-special">(</span><span class="hs-special">(</span><span class="annot"><span class="annottext">forall a. Eq a =&gt; a -&gt; a -&gt; Bool
</span><span class="hs-operator hs-var">==</span></span><span> </span><span class="annot"><span class="annottext">PmEquality
</span><a href="GHC.HsToCore.Pmc.Solver.Types.html#Equal"><span class="hs-identifier hs-var">Equal</span></a></span><span class="hs-special">)</span><span> </span><span class="annot"><span class="annottext">forall b c a. (b -&gt; c) -&gt; (a -&gt; b) -&gt; a -&gt; c
</span><a href="../../base-4.16.4.0/src/GHC-Base.html#."><span class="hs-operator hs-var">.</span></a></span><span> </span><span class="annot"><span class="annottext">PmAltCon -&gt; PmAltCon -&gt; PmEquality
</span><a href="GHC.HsToCore.Pmc.Solver.Types.html#eqPmAltCon"><span class="hs-identifier hs-var">eqPmAltCon</span></a></span><span> </span><span class="annot"><span class="annottext">PmAltCon
</span><a href="#local-6989586621681374758"><span class="hs-identifier hs-var">alt</span></a></span><span> </span><span class="annot"><span class="annottext">forall b c a. (b -&gt; c) -&gt; (a -&gt; b) -&gt; a -&gt; c
</span><a href="../../base-4.16.4.0/src/GHC-Base.html#."><span class="hs-operator hs-var">.</span></a></span><span> </span><span class="annot"><span class="annottext">PmAltConApp -&gt; PmAltCon
</span><a href="GHC.HsToCore.Pmc.Solver.Types.html#paca_con"><span class="hs-identifier hs-var">paca_con</span></a></span><span class="hs-special">)</span><span> </span><span class="annot"><span class="annottext">[PmAltConApp]
</span><a href="#local-6989586621681374754"><span class="hs-identifier hs-var">pos</span></a></span><span> </span><span class="hs-keyword">of</span><span>
</span><span id="line-844"></span><span>    </span><span class="annot"><a href="../../base-4.16.4.0/src/GHC-Maybe.html#Just"><span class="hs-identifier hs-type">Just</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="GHC.HsToCore.Pmc.Solver.Types.html#PACA"><span class="hs-identifier hs-type">PACA</span></a></span><span> </span><span id="local-6989586621681374748"><span class="annot"><span class="annottext">PmAltCon
</span><a href="#local-6989586621681374748"><span class="hs-identifier hs-var">_con</span></a></span></span><span> </span><span id="local-6989586621681374747"><span class="annot"><span class="annottext">[Id]
</span><a href="#local-6989586621681374747"><span class="hs-identifier hs-var">other_tvs</span></a></span></span><span> </span><span id="local-6989586621681374746"><span class="annot"><span class="annottext">[Id]
</span><a href="#local-6989586621681374746"><span class="hs-identifier hs-var">other_args</span></a></span></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-keyword">do</span><span>
</span><span id="line-845"></span><span>      </span><span class="hs-comment">-- We must unify existentially bound ty vars and arguments!</span><span>
</span><span id="line-846"></span><span>      </span><span class="hs-keyword">let</span><span> </span><span id="local-6989586621681374745"><span class="annot"><span class="annottext">ty_cts :: [PhiCt]
</span><a href="#local-6989586621681374745"><span class="hs-identifier hs-var hs-var">ty_cts</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">ThetaType -&gt; ThetaType -&gt; [PhiCt]
</span><a href="GHC.HsToCore.Pmc.Solver.html#equateTys"><span class="hs-identifier hs-var">equateTys</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">forall a b. (a -&gt; b) -&gt; [a] -&gt; [b]
</span><a href="../../base-4.16.4.0/src/GHC-Base.html#map"><span class="hs-identifier hs-var">map</span></a></span><span> </span><span class="annot"><span class="annottext">Id -&gt; Type
</span><a href="GHC.Core.TyCo.Rep.html#mkTyVarTy"><span class="hs-identifier hs-var">mkTyVarTy</span></a></span><span> </span><span class="annot"><span class="annottext">[Id]
</span><a href="#local-6989586621681374757"><span class="hs-identifier hs-var">tvs</span></a></span><span class="hs-special">)</span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">forall a b. (a -&gt; b) -&gt; [a] -&gt; [b]
</span><a href="../../base-4.16.4.0/src/GHC-Base.html#map"><span class="hs-identifier hs-var">map</span></a></span><span> </span><span class="annot"><span class="annottext">Id -&gt; Type
</span><a href="GHC.Core.TyCo.Rep.html#mkTyVarTy"><span class="hs-identifier hs-var">mkTyVarTy</span></a></span><span> </span><span class="annot"><span class="annottext">[Id]
</span><a href="#local-6989586621681374747"><span class="hs-identifier hs-var">other_tvs</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-847"></span><span>      </span><span class="annot"><span class="annottext">forall (f :: * -&gt; *). Applicative f =&gt; Bool -&gt; f () -&gt; f ()
</span><a href="../../base-4.16.4.0/src/GHC-Base.html#when"><span class="hs-identifier hs-var">when</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">forall (t :: * -&gt; *) a. Foldable t =&gt; t a -&gt; Int
</span><a href="../../base-4.16.4.0/src/Data-Foldable.html#length"><span class="hs-identifier hs-var">length</span></a></span><span> </span><span class="annot"><span class="annottext">[Id]
</span><a href="#local-6989586621681374756"><span class="hs-identifier hs-var">args</span></a></span><span> </span><span class="annot"><span class="annottext">forall a. Eq a =&gt; a -&gt; a -&gt; Bool
</span><span class="hs-operator hs-var">/=</span></span><span> </span><span class="annot"><span class="annottext">forall (t :: * -&gt; *) a. Foldable t =&gt; t a -&gt; Int
</span><a href="../../base-4.16.4.0/src/Data-Foldable.html#length"><span class="hs-identifier hs-var">length</span></a></span><span> </span><span class="annot"><span class="annottext">[Id]
</span><a href="#local-6989586621681374746"><span class="hs-identifier hs-var">other_args</span></a></span><span class="hs-special">)</span><span> </span><span class="annot"><span class="annottext">forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><a href="../../base-4.16.4.0/src/GHC-Base.html#%24"><span class="hs-operator hs-var">$</span></a></span><span>
</span><span id="line-848"></span><span>        </span><span class="annot"><span class="annottext">forall (t :: (* -&gt; *) -&gt; * -&gt; *) (m :: * -&gt; *) a.
(MonadTrans t, Monad m) =&gt;
m a -&gt; t m a
</span><a href="../../transformers-0.5.6.2/src/Control-Monad-Trans-Class.html#lift"><span class="hs-identifier hs-var">lift</span></a></span><span> </span><span class="annot"><span class="annottext">forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><a href="../../base-4.16.4.0/src/GHC-Base.html#%24"><span class="hs-operator hs-var">$</span></a></span><span> </span><span class="annot"><span class="annottext">String -&gt; SDoc -&gt; DsM ()
</span><a href="GHC.HsToCore.Pmc.Utils.html#tracePm"><span class="hs-identifier hs-var">tracePm</span></a></span><span> </span><span class="annot"><span class="annottext">String
</span><span class="hs-string">&quot;error&quot;</span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">forall a. Outputable a =&gt; a -&gt; SDoc
</span><a href="GHC.Utils.Outputable.html#ppr"><span class="hs-identifier hs-var">ppr</span></a></span><span> </span><span class="annot"><span class="annottext">Id
</span><a href="#local-6989586621681374759"><span class="hs-identifier hs-var">x</span></a></span><span> </span><span class="annot"><span class="annottext">SDoc -&gt; SDoc -&gt; SDoc
</span><a href="GHC.Utils.Outputable.html#%3C%2B%3E"><span class="hs-operator hs-var">&lt;+&gt;</span></a></span><span> </span><span class="annot"><span class="annottext">forall a. Outputable a =&gt; a -&gt; SDoc
</span><a href="GHC.Utils.Outputable.html#ppr"><span class="hs-identifier hs-var">ppr</span></a></span><span> </span><span class="annot"><span class="annottext">PmAltCon
</span><a href="#local-6989586621681374758"><span class="hs-identifier hs-var">alt</span></a></span><span> </span><span class="annot"><span class="annottext">SDoc -&gt; SDoc -&gt; SDoc
</span><a href="GHC.Utils.Outputable.html#%3C%2B%3E"><span class="hs-operator hs-var">&lt;+&gt;</span></a></span><span> </span><span class="annot"><span class="annottext">forall a. Outputable a =&gt; a -&gt; SDoc
</span><a href="GHC.Utils.Outputable.html#ppr"><span class="hs-identifier hs-var">ppr</span></a></span><span> </span><span class="annot"><span class="annottext">[Id]
</span><a href="#local-6989586621681374756"><span class="hs-identifier hs-var">args</span></a></span><span> </span><span class="annot"><span class="annottext">SDoc -&gt; SDoc -&gt; SDoc
</span><a href="GHC.Utils.Outputable.html#%3C%2B%3E"><span class="hs-operator hs-var">&lt;+&gt;</span></a></span><span> </span><span class="annot"><span class="annottext">forall a. Outputable a =&gt; a -&gt; SDoc
</span><a href="GHC.Utils.Outputable.html#ppr"><span class="hs-identifier hs-var">ppr</span></a></span><span> </span><span class="annot"><span class="annottext">[Id]
</span><a href="#local-6989586621681374746"><span class="hs-identifier hs-var">other_args</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-849"></span><span>      </span><span id="local-6989586621681374741"><span class="annot"><span class="annottext">Nabla
</span><a href="#local-6989586621681374741"><span class="hs-identifier hs-var">nabla'</span></a></span></span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">forall (m :: * -&gt; *) a. m (Maybe a) -&gt; MaybeT m a
</span><a href="../../transformers-0.5.6.2/src/Control-Monad-Trans-Maybe.html#MaybeT"><span class="hs-identifier hs-var">MaybeT</span></a></span><span> </span><span class="annot"><span class="annottext">forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><a href="../../base-4.16.4.0/src/GHC-Base.html#%24"><span class="hs-operator hs-var">$</span></a></span><span> </span><span class="annot"><span class="annottext">Nabla -&gt; PhiCts -&gt; IOEnv (Env DsGblEnv DsLclEnv) (Maybe Nabla)
</span><a href="GHC.HsToCore.Pmc.Solver.html#addPhiCts"><span class="hs-identifier hs-var">addPhiCts</span></a></span><span> </span><span class="annot"><span class="annottext">Nabla
</span><a href="#local-6989586621681374762"><span class="hs-identifier hs-var">nabla</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">forall a. [a] -&gt; Bag a
</span><a href="GHC.Data.Bag.html#listToBag"><span class="hs-identifier hs-var">listToBag</span></a></span><span> </span><span class="annot"><span class="annottext">[PhiCt]
</span><a href="#local-6989586621681374745"><span class="hs-identifier hs-var">ty_cts</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-850"></span><span>      </span><span class="hs-keyword">let</span><span> </span><span id="local-6989586621681374740"><span class="annot"><span class="annottext">add_var_ct :: Nabla -&gt; (Id, Id) -&gt; MaybeT (IOEnv (Env DsGblEnv DsLclEnv)) Nabla
</span><a href="#local-6989586621681374740"><span class="hs-identifier hs-var hs-var">add_var_ct</span></a></span></span><span> </span><span id="local-6989586621681374739"><span class="annot"><span class="annottext">Nabla
</span><a href="#local-6989586621681374739"><span class="hs-identifier hs-var">nabla</span></a></span></span><span> </span><span class="hs-special">(</span><span id="local-6989586621681374738"><span class="annot"><span class="annottext">Id
</span><a href="#local-6989586621681374738"><span class="hs-identifier hs-var">a</span></a></span></span><span class="hs-special">,</span><span> </span><span id="local-6989586621681374737"><span class="annot"><span class="annottext">Id
</span><a href="#local-6989586621681374737"><span class="hs-identifier hs-var">b</span></a></span></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">Nabla -&gt; Id -&gt; Id -&gt; MaybeT (IOEnv (Env DsGblEnv DsLclEnv)) Nabla
</span><a href="GHC.HsToCore.Pmc.Solver.html#addVarCt"><span class="hs-identifier hs-var">addVarCt</span></a></span><span> </span><span class="annot"><span class="annottext">Nabla
</span><a href="#local-6989586621681374739"><span class="hs-identifier hs-var">nabla</span></a></span><span> </span><span class="annot"><span class="annottext">Id
</span><a href="#local-6989586621681374738"><span class="hs-identifier hs-var">a</span></a></span><span> </span><span class="annot"><span class="annottext">Id
</span><a href="#local-6989586621681374737"><span class="hs-identifier hs-var">b</span></a></span><span>
</span><span id="line-851"></span><span>      </span><span class="annot"><span class="annottext">forall (t :: * -&gt; *) (m :: * -&gt; *) b a.
(Foldable t, Monad m) =&gt;
(b -&gt; a -&gt; m b) -&gt; b -&gt; t a -&gt; m b
</span><a href="../../base-4.16.4.0/src/Data-Foldable.html#foldlM"><span class="hs-identifier hs-var">foldlM</span></a></span><span> </span><span class="annot"><span class="annottext">Nabla -&gt; (Id, Id) -&gt; MaybeT (IOEnv (Env DsGblEnv DsLclEnv)) Nabla
</span><a href="#local-6989586621681374740"><span class="hs-identifier hs-var">add_var_ct</span></a></span><span> </span><span class="annot"><span class="annottext">Nabla
</span><a href="#local-6989586621681374741"><span class="hs-identifier hs-var">nabla'</span></a></span><span> </span><span class="annot"><span class="annottext">forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><a href="../../base-4.16.4.0/src/GHC-Base.html#%24"><span class="hs-operator hs-var">$</span></a></span><span> </span><span class="annot"><span class="annottext">forall a b. String -&gt; [a] -&gt; [b] -&gt; [(a, b)]
</span><a href="GHC.Utils.Misc.html#zipEqual"><span class="hs-identifier hs-var">zipEqual</span></a></span><span> </span><span class="annot"><span class="annottext">String
</span><span class="hs-string">&quot;addConCt&quot;</span></span><span> </span><span class="annot"><span class="annottext">[Id]
</span><a href="#local-6989586621681374756"><span class="hs-identifier hs-var">args</span></a></span><span> </span><span class="annot"><span class="annottext">[Id]
</span><a href="#local-6989586621681374746"><span class="hs-identifier hs-var">other_args</span></a></span><span>
</span><span id="line-852"></span><span>    </span><span class="annot"><span class="annottext">Maybe PmAltConApp
</span><a href="../../base-4.16.4.0/src/GHC-Maybe.html#Nothing"><span class="hs-identifier hs-var">Nothing</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-keyword">do</span><span>
</span><span id="line-853"></span><span>      </span><span class="hs-keyword">let</span><span> </span><span id="local-6989586621681374735"><span class="annot"><span class="annottext">pos' :: [PmAltConApp]
</span><a href="#local-6989586621681374735"><span class="hs-identifier hs-var hs-var">pos'</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">PmAltCon -&gt; [Id] -&gt; [Id] -&gt; PmAltConApp
</span><a href="GHC.HsToCore.Pmc.Solver.Types.html#PACA"><span class="hs-identifier hs-var">PACA</span></a></span><span> </span><span class="annot"><span class="annottext">PmAltCon
</span><a href="#local-6989586621681374758"><span class="hs-identifier hs-var">alt</span></a></span><span> </span><span class="annot"><span class="annottext">[Id]
</span><a href="#local-6989586621681374757"><span class="hs-identifier hs-var">tvs</span></a></span><span> </span><span class="annot"><span class="annottext">[Id]
</span><a href="#local-6989586621681374756"><span class="hs-identifier hs-var">args</span></a></span><span> </span><span class="annot"><span class="annottext">forall a. a -&gt; [a] -&gt; [a]
</span><span class="hs-glyph hs-var">:</span></span><span> </span><span class="annot"><span class="annottext">[PmAltConApp]
</span><a href="#local-6989586621681374754"><span class="hs-identifier hs-var">pos</span></a></span><span>
</span><span id="line-854"></span><span>      </span><span class="hs-keyword">let</span><span> </span><span id="local-6989586621681374734"><span class="annot"><span class="annottext">nabla_with :: BotInfo -&gt; Nabla
</span><a href="#local-6989586621681374734"><span class="hs-identifier hs-var hs-var">nabla_with</span></a></span></span><span> </span><span id="local-6989586621681374733"><span class="annot"><span class="annottext">BotInfo
</span><a href="#local-6989586621681374733"><span class="hs-identifier hs-var">bot'</span></a></span></span><span> </span><span class="hs-glyph">=</span><span>
</span><span id="line-855"></span><span>            </span><span class="annot"><span class="annottext">Nabla
</span><a href="#local-6989586621681374762"><span class="hs-identifier hs-var">nabla</span></a></span><span class="hs-special">{</span><span> </span><span class="annot"><span class="annottext">nabla_tm_st :: TmState
</span><a href="GHC.HsToCore.Pmc.Solver.Types.html#nabla_tm_st"><span class="hs-identifier hs-var">nabla_tm_st</span></a></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">TmState
</span><a href="#local-6989586621681374761"><span class="hs-identifier hs-var">ts</span></a></span><span class="hs-special">{</span><span class="annot"><span class="annottext">ts_facts :: UniqSDFM Id VarInfo
</span><a href="GHC.HsToCore.Pmc.Solver.Types.html#ts_facts"><span class="hs-identifier hs-var">ts_facts</span></a></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">forall key ele.
Uniquable key =&gt;
UniqSDFM key ele -&gt; key -&gt; ele -&gt; UniqSDFM key ele
</span><a href="GHC.Types.Unique.SDFM.html#addToUSDFM"><span class="hs-identifier hs-var">addToUSDFM</span></a></span><span> </span><span class="annot"><span class="annottext">UniqSDFM Id VarInfo
</span><a href="#local-6989586621681374760"><span class="hs-identifier hs-var">env</span></a></span><span> </span><span class="annot"><span class="annottext">Id
</span><a href="#local-6989586621681374759"><span class="hs-identifier hs-var">x</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">VarInfo
</span><a href="#local-6989586621681374755"><span class="hs-identifier hs-var">vi</span></a></span><span class="hs-special">{</span><span class="annot"><span class="annottext">vi_pos :: [PmAltConApp]
</span><a href="GHC.HsToCore.Pmc.Solver.Types.html#vi_pos"><span class="hs-identifier hs-var">vi_pos</span></a></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">[PmAltConApp]
</span><a href="#local-6989586621681374735"><span class="hs-identifier hs-var">pos'</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">vi_bot :: BotInfo
</span><a href="GHC.HsToCore.Pmc.Solver.Types.html#vi_bot"><span class="hs-identifier hs-var">vi_bot</span></a></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">BotInfo
</span><a href="#local-6989586621681374733"><span class="hs-identifier hs-var">bot'</span></a></span><span class="hs-special">}</span><span class="hs-special">)</span><span class="hs-special">}</span><span> </span><span class="hs-special">}</span><span>
</span><span id="line-856"></span><span>      </span><span class="hs-comment">-- Do (2) in Note [Coverage checking Newtype matches]</span><span>
</span><span id="line-857"></span><span>      </span><span class="hs-keyword">case</span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">PmAltCon
</span><a href="#local-6989586621681374758"><span class="hs-identifier hs-var">alt</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">[Id]
</span><a href="#local-6989586621681374756"><span class="hs-identifier hs-var">args</span></a></span><span class="hs-special">)</span><span> </span><span class="hs-keyword">of</span><span>
</span><span id="line-858"></span><span>        </span><span class="hs-special">(</span><span class="annot"><a href="GHC.HsToCore.Pmc.Solver.Types.html#PmAltConLike"><span class="hs-identifier hs-type">PmAltConLike</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="GHC.Core.ConLike.html#RealDataCon"><span class="hs-identifier hs-type">RealDataCon</span></a></span><span> </span><span id="local-6989586621681374732"><span class="annot"><span class="annottext">DataCon
</span><a href="#local-6989586621681374732"><span class="hs-identifier hs-var">dc</span></a></span></span><span class="hs-special">)</span><span class="hs-special">,</span><span> </span><span class="hs-special">[</span><span id="local-6989586621681374731"><span class="annot"><span class="annottext">Id
</span><a href="#local-6989586621681374731"><span class="hs-identifier hs-var">y</span></a></span></span><span class="hs-special">]</span><span class="hs-special">)</span><span> </span><span class="hs-glyph">|</span><span> </span><span class="annot"><span class="annottext">DataCon -&gt; Bool
</span><a href="GHC.Core.DataCon.html#isNewDataCon"><span class="hs-identifier hs-var">isNewDataCon</span></a></span><span> </span><span class="annot"><span class="annottext">DataCon
</span><a href="#local-6989586621681374732"><span class="hs-identifier hs-var">dc</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span>
</span><span id="line-859"></span><span>          </span><span class="hs-keyword">case</span><span> </span><span class="annot"><span class="annottext">BotInfo
</span><a href="#local-6989586621681374752"><span class="hs-identifier hs-var">bot</span></a></span><span> </span><span class="hs-keyword">of</span><span>
</span><span id="line-860"></span><span>            </span><span class="annot"><span class="annottext">BotInfo
</span><a href="GHC.HsToCore.Pmc.Solver.Types.html#MaybeBot"><span class="hs-identifier hs-var">MaybeBot</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="annottext">forall (f :: * -&gt; *) a. Applicative f =&gt; a -&gt; f a
</span><a href="../../base-4.16.4.0/src/GHC-Base.html#pure"><span class="hs-identifier hs-var">pure</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">BotInfo -&gt; Nabla
</span><a href="#local-6989586621681374734"><span class="hs-identifier hs-var">nabla_with</span></a></span><span> </span><span class="annot"><span class="annottext">BotInfo
</span><a href="GHC.HsToCore.Pmc.Solver.Types.html#MaybeBot"><span class="hs-identifier hs-var">MaybeBot</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-861"></span><span>            </span><span class="annot"><span class="annottext">BotInfo
</span><a href="GHC.HsToCore.Pmc.Solver.Types.html#IsBot"><span class="hs-identifier hs-var">IsBot</span></a></span><span>    </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="annottext">Nabla -&gt; Id -&gt; MaybeT (IOEnv (Env DsGblEnv DsLclEnv)) Nabla
</span><a href="GHC.HsToCore.Pmc.Solver.html#addBotCt"><span class="hs-identifier hs-var">addBotCt</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">BotInfo -&gt; Nabla
</span><a href="#local-6989586621681374734"><span class="hs-identifier hs-var">nabla_with</span></a></span><span> </span><span class="annot"><span class="annottext">BotInfo
</span><a href="GHC.HsToCore.Pmc.Solver.Types.html#MaybeBot"><span class="hs-identifier hs-var">MaybeBot</span></a></span><span class="hs-special">)</span><span> </span><span class="annot"><span class="annottext">Id
</span><a href="#local-6989586621681374731"><span class="hs-identifier hs-var">y</span></a></span><span>
</span><span id="line-862"></span><span>            </span><span class="annot"><span class="annottext">BotInfo
</span><a href="GHC.HsToCore.Pmc.Solver.Types.html#IsNotBot"><span class="hs-identifier hs-var">IsNotBot</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="annottext">Nabla -&gt; Id -&gt; MaybeT (IOEnv (Env DsGblEnv DsLclEnv)) Nabla
</span><a href="GHC.HsToCore.Pmc.Solver.html#addNotBotCt"><span class="hs-identifier hs-var">addNotBotCt</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">BotInfo -&gt; Nabla
</span><a href="#local-6989586621681374734"><span class="hs-identifier hs-var">nabla_with</span></a></span><span> </span><span class="annot"><span class="annottext">BotInfo
</span><a href="GHC.HsToCore.Pmc.Solver.Types.html#MaybeBot"><span class="hs-identifier hs-var">MaybeBot</span></a></span><span class="hs-special">)</span><span> </span><span class="annot"><span class="annottext">Id
</span><a href="#local-6989586621681374731"><span class="hs-identifier hs-var">y</span></a></span><span>
</span><span id="line-863"></span><span>        </span><span class="annot"><span class="annottext">(PmAltCon, [Id])
</span><span class="hs-identifier">_</span></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-identifier">ASSERT</span><span class="hs-special">(</span><span> </span><span class="hs-identifier">isPmAltConMatchStrict</span><span> </span><span class="hs-identifier">alt</span><span> </span><span class="hs-special">)</span><span>
</span><span id="line-864"></span><span>             </span><span class="annot"><span class="annottext">forall (f :: * -&gt; *) a. Applicative f =&gt; a -&gt; f a
</span><a href="../../base-4.16.4.0/src/GHC-Base.html#pure"><span class="hs-identifier hs-var">pure</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">BotInfo -&gt; Nabla
</span><a href="#local-6989586621681374734"><span class="hs-identifier hs-var">nabla_with</span></a></span><span> </span><span class="annot"><span class="annottext">BotInfo
</span><a href="GHC.HsToCore.Pmc.Solver.Types.html#IsNotBot"><span class="hs-identifier hs-var">IsNotBot</span></a></span><span class="hs-special">)</span><span> </span><span class="hs-comment">-- strict match ==&gt; not &#8869;</span><span>
</span><span id="line-865"></span><span>
</span><span id="line-866"></span><span class="annot"><a href="GHC.HsToCore.Pmc.Solver.html#equateTys"><span class="hs-identifier hs-type">equateTys</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="hs-special">[</span><span class="annot"><a href="GHC.Core.TyCo.Rep.html#Type"><span class="hs-identifier hs-type">Type</span></a></span><span class="hs-special">]</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-special">[</span><span class="annot"><a href="GHC.Core.TyCo.Rep.html#Type"><span class="hs-identifier hs-type">Type</span></a></span><span class="hs-special">]</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-special">[</span><span class="annot"><a href="GHC.HsToCore.Pmc.Solver.html#PhiCt"><span class="hs-identifier hs-type">PhiCt</span></a></span><span class="hs-special">]</span><span>
</span><span id="line-867"></span><span id="equateTys"><span class="annot"><span class="annottext">equateTys :: ThetaType -&gt; ThetaType -&gt; [PhiCt]
</span><a href="GHC.HsToCore.Pmc.Solver.html#equateTys"><span class="hs-identifier hs-var hs-var">equateTys</span></a></span></span><span> </span><span id="local-6989586621681374730"><span class="annot"><span class="annottext">ThetaType
</span><a href="#local-6989586621681374730"><span class="hs-identifier hs-var">ts</span></a></span></span><span> </span><span id="local-6989586621681374729"><span class="annot"><span class="annottext">ThetaType
</span><a href="#local-6989586621681374729"><span class="hs-identifier hs-var">us</span></a></span></span><span> </span><span class="hs-glyph">=</span><span>
</span><span id="line-868"></span><span>  </span><span class="hs-special">[</span><span> </span><span class="annot"><span class="annottext">Type -&gt; PhiCt
</span><a href="GHC.HsToCore.Pmc.Solver.html#PhiTyCt"><span class="hs-identifier hs-var">PhiTyCt</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Type -&gt; Type -&gt; Type
</span><a href="GHC.Core.Coercion.html#mkPrimEqPred"><span class="hs-identifier hs-var">mkPrimEqPred</span></a></span><span> </span><span class="annot"><span class="annottext">Type
</span><a href="#local-6989586621681374727"><span class="hs-identifier hs-var">t</span></a></span><span> </span><span class="annot"><span class="annottext">Type
</span><a href="#local-6989586621681374726"><span class="hs-identifier hs-var">u</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-869"></span><span>  </span><span class="hs-glyph">|</span><span> </span><span class="hs-special">(</span><span id="local-6989586621681374727"><span class="annot"><span class="annottext">Type
</span><a href="#local-6989586621681374727"><span class="hs-identifier hs-var">t</span></a></span></span><span class="hs-special">,</span><span> </span><span id="local-6989586621681374726"><span class="annot"><span class="annottext">Type
</span><a href="#local-6989586621681374726"><span class="hs-identifier hs-var">u</span></a></span></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">forall a b. String -&gt; [a] -&gt; [b] -&gt; [(a, b)]
</span><a href="GHC.Utils.Misc.html#zipEqual"><span class="hs-identifier hs-var">zipEqual</span></a></span><span> </span><span class="annot"><span class="annottext">String
</span><span class="hs-string">&quot;equateTys&quot;</span></span><span> </span><span class="annot"><span class="annottext">ThetaType
</span><a href="#local-6989586621681374730"><span class="hs-identifier hs-var">ts</span></a></span><span> </span><span class="annot"><span class="annottext">ThetaType
</span><a href="#local-6989586621681374729"><span class="hs-identifier hs-var">us</span></a></span><span>
</span><span id="line-870"></span><span>  </span><span class="hs-comment">-- The following line filters out trivial Refl constraints, so that we don't</span><span>
</span><span id="line-871"></span><span>  </span><span class="hs-comment">-- need to initialise the type oracle that often</span><span>
</span><span id="line-872"></span><span>  </span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">Bool -&gt; Bool
</span><span class="hs-identifier hs-var">not</span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Type -&gt; Type -&gt; Bool
</span><a href="GHC.Core.Type.html#eqType"><span class="hs-identifier hs-var">eqType</span></a></span><span> </span><span class="annot"><span class="annottext">Type
</span><a href="#local-6989586621681374727"><span class="hs-identifier hs-var">t</span></a></span><span> </span><span class="annot"><span class="annottext">Type
</span><a href="#local-6989586621681374726"><span class="hs-identifier hs-var">u</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-873"></span><span>  </span><span class="hs-special">]</span><span>
</span><span id="line-874"></span><span>
</span><span id="line-875"></span><span class="hs-comment">-- | Adds a @x ~ y@ constraint by merging the two 'VarInfo's and record the</span><span>
</span><span id="line-876"></span><span class="hs-comment">-- gained knowledge in 'Nabla'.</span><span>
</span><span id="line-877"></span><span class="hs-comment">--</span><span>
</span><span id="line-878"></span><span class="hs-comment">-- Returns @Nothing@ when there's a contradiction while merging. Returns @Just</span><span>
</span><span id="line-879"></span><span class="hs-comment">-- nabla@ when the constraint was compatible with prior facts, in which case</span><span>
</span><span id="line-880"></span><span class="hs-comment">-- @nabla@ has integrated the knowledge from the equality constraint.</span><span>
</span><span id="line-881"></span><span class="hs-comment">--</span><span>
</span><span id="line-882"></span><span class="hs-comment">-- See Note [TmState invariants].</span><span>
</span><span id="line-883"></span><span class="annot"><a href="GHC.HsToCore.Pmc.Solver.html#addVarCt"><span class="hs-identifier hs-type">addVarCt</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><a href="GHC.HsToCore.Pmc.Solver.Types.html#Nabla"><span class="hs-identifier hs-type">Nabla</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="GHC.Types.Var.html#Id"><span class="hs-identifier hs-type">Id</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="GHC.Types.Var.html#Id"><span class="hs-identifier hs-type">Id</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="../../transformers-0.5.6.2/src/Control-Monad-Trans-Maybe.html#MaybeT"><span class="hs-identifier hs-type">MaybeT</span></a></span><span> </span><span class="annot"><a href="GHC.HsToCore.Types.html#DsM"><span class="hs-identifier hs-type">DsM</span></a></span><span> </span><span class="annot"><a href="GHC.HsToCore.Pmc.Solver.Types.html#Nabla"><span class="hs-identifier hs-type">Nabla</span></a></span><span>
</span><span id="line-884"></span><span id="addVarCt"><span class="annot"><span class="annottext">addVarCt :: Nabla -&gt; Id -&gt; Id -&gt; MaybeT (IOEnv (Env DsGblEnv DsLclEnv)) Nabla
</span><a href="GHC.HsToCore.Pmc.Solver.html#addVarCt"><span class="hs-identifier hs-var hs-var">addVarCt</span></a></span></span><span> </span><span id="local-6989586621681374724"><span class="annot"><span class="annottext">nabla :: Nabla
</span><a href="#local-6989586621681374724"><span class="hs-identifier hs-var">nabla</span></a></span></span><span class="hs-glyph">@</span><span class="annot"><a href="GHC.HsToCore.Pmc.Solver.Types.html#MkNabla"><span class="hs-identifier hs-type">MkNabla</span></a></span><span class="hs-special">{</span><span> </span><span class="annot"><span class="annottext">nabla_tm_st :: Nabla -&gt; TmState
</span><a href="GHC.HsToCore.Pmc.Solver.Types.html#nabla_tm_st"><span class="hs-identifier hs-var">nabla_tm_st</span></a></span><span> </span><span class="hs-glyph">=</span><span> </span><span id="local-6989586621681374723"><span class="annot"><span class="annottext">ts :: TmState
</span><a href="#local-6989586621681374723"><span class="hs-identifier hs-var">ts</span></a></span></span><span class="hs-glyph">@</span><span class="annot"><a href="GHC.HsToCore.Pmc.Solver.Types.html#TmSt"><span class="hs-identifier hs-type">TmSt</span></a></span><span class="hs-special">{</span><span> </span><span class="annot"><span class="annottext">ts_facts :: TmState -&gt; UniqSDFM Id VarInfo
</span><a href="GHC.HsToCore.Pmc.Solver.Types.html#ts_facts"><span class="hs-identifier hs-var">ts_facts</span></a></span><span> </span><span class="hs-glyph">=</span><span> </span><span id="local-6989586621681374722"><span class="annot"><span class="annottext">UniqSDFM Id VarInfo
</span><a href="#local-6989586621681374722"><span class="hs-identifier hs-var">env</span></a></span></span><span> </span><span class="hs-special">}</span><span> </span><span class="hs-special">}</span><span> </span><span id="local-6989586621681374721"><span class="annot"><span class="annottext">Id
</span><a href="#local-6989586621681374721"><span class="hs-identifier hs-var">x</span></a></span></span><span> </span><span id="local-6989586621681374720"><span class="annot"><span class="annottext">Id
</span><a href="#local-6989586621681374720"><span class="hs-identifier hs-var">y</span></a></span></span><span> </span><span class="hs-glyph">=</span><span>
</span><span id="line-885"></span><span>  </span><span class="hs-keyword">case</span><span> </span><span class="annot"><span class="annottext">forall key ele.
Uniquable key =&gt;
UniqSDFM key ele -&gt; key -&gt; key -&gt; (Maybe ele, UniqSDFM key ele)
</span><a href="GHC.Types.Unique.SDFM.html#equateUSDFM"><span class="hs-identifier hs-var">equateUSDFM</span></a></span><span> </span><span class="annot"><span class="annottext">UniqSDFM Id VarInfo
</span><a href="#local-6989586621681374722"><span class="hs-identifier hs-var">env</span></a></span><span> </span><span class="annot"><span class="annottext">Id
</span><a href="#local-6989586621681374721"><span class="hs-identifier hs-var">x</span></a></span><span> </span><span class="annot"><span class="annottext">Id
</span><a href="#local-6989586621681374720"><span class="hs-identifier hs-var">y</span></a></span><span> </span><span class="hs-keyword">of</span><span>
</span><span id="line-886"></span><span>    </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Maybe VarInfo
</span><a href="../../base-4.16.4.0/src/GHC-Maybe.html#Nothing"><span class="hs-identifier hs-var">Nothing</span></a></span><span class="hs-special">,</span><span>   </span><span id="local-6989586621681374718"><span class="annot"><span class="annottext">UniqSDFM Id VarInfo
</span><a href="#local-6989586621681374718"><span class="hs-identifier hs-var">env'</span></a></span></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="annottext">forall (f :: * -&gt; *) a. Applicative f =&gt; a -&gt; f a
</span><a href="../../base-4.16.4.0/src/GHC-Base.html#pure"><span class="hs-identifier hs-var">pure</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Nabla
</span><a href="#local-6989586621681374724"><span class="hs-identifier hs-var">nabla</span></a></span><span class="hs-special">{</span><span> </span><span class="annot"><span class="annottext">nabla_tm_st :: TmState
</span><a href="GHC.HsToCore.Pmc.Solver.Types.html#nabla_tm_st"><span class="hs-identifier hs-var">nabla_tm_st</span></a></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">TmState
</span><a href="#local-6989586621681374723"><span class="hs-identifier hs-var">ts</span></a></span><span class="hs-special">{</span><span> </span><span class="annot"><span class="annottext">ts_facts :: UniqSDFM Id VarInfo
</span><a href="GHC.HsToCore.Pmc.Solver.Types.html#ts_facts"><span class="hs-identifier hs-var">ts_facts</span></a></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">UniqSDFM Id VarInfo
</span><a href="#local-6989586621681374718"><span class="hs-identifier hs-var">env'</span></a></span><span> </span><span class="hs-special">}</span><span> </span><span class="hs-special">}</span><span class="hs-special">)</span><span>
</span><span id="line-887"></span><span>    </span><span class="hs-comment">-- Add the constraints we had for x to y</span><span>
</span><span id="line-888"></span><span>    </span><span class="hs-special">(</span><span class="annot"><a href="../../base-4.16.4.0/src/GHC-Maybe.html#Just"><span class="hs-identifier hs-type">Just</span></a></span><span> </span><span id="local-6989586621681374717"><span class="annot"><span class="annottext">VarInfo
</span><a href="#local-6989586621681374717"><span class="hs-identifier hs-var">vi_x</span></a></span></span><span class="hs-special">,</span><span> </span><span id="local-6989586621681374716"><span class="annot"><span class="annottext">UniqSDFM Id VarInfo
</span><a href="#local-6989586621681374716"><span class="hs-identifier hs-var">env'</span></a></span></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-keyword">do</span><span>
</span><span id="line-889"></span><span>      </span><span class="hs-keyword">let</span><span> </span><span id="local-6989586621681374715"><span class="annot"><span class="annottext">nabla_equated :: Nabla
</span><a href="#local-6989586621681374715"><span class="hs-identifier hs-var hs-var">nabla_equated</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">Nabla
</span><a href="#local-6989586621681374724"><span class="hs-identifier hs-var">nabla</span></a></span><span class="hs-special">{</span><span> </span><span class="annot"><span class="annottext">nabla_tm_st :: TmState
</span><a href="GHC.HsToCore.Pmc.Solver.Types.html#nabla_tm_st"><span class="hs-identifier hs-var">nabla_tm_st</span></a></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">TmState
</span><a href="#local-6989586621681374723"><span class="hs-identifier hs-var">ts</span></a></span><span class="hs-special">{</span><span class="annot"><span class="annottext">ts_facts :: UniqSDFM Id VarInfo
</span><a href="GHC.HsToCore.Pmc.Solver.Types.html#ts_facts"><span class="hs-identifier hs-var">ts_facts</span></a></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">UniqSDFM Id VarInfo
</span><a href="#local-6989586621681374716"><span class="hs-identifier hs-var">env'</span></a></span><span class="hs-special">}</span><span> </span><span class="hs-special">}</span><span>
</span><span id="line-890"></span><span>      </span><span class="hs-comment">-- and then gradually merge every positive fact we have on x into y</span><span>
</span><span id="line-891"></span><span>      </span><span class="hs-keyword">let</span><span> </span><span id="local-6989586621681374714"><span class="annot"><span class="annottext">add_pos :: Nabla
-&gt; PmAltConApp -&gt; MaybeT (IOEnv (Env DsGblEnv DsLclEnv)) Nabla
</span><a href="#local-6989586621681374714"><span class="hs-identifier hs-var hs-var">add_pos</span></a></span></span><span> </span><span id="local-6989586621681374713"><span class="annot"><span class="annottext">Nabla
</span><a href="#local-6989586621681374713"><span class="hs-identifier hs-var">nabla</span></a></span></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="GHC.HsToCore.Pmc.Solver.Types.html#PACA"><span class="hs-identifier hs-type">PACA</span></a></span><span> </span><span id="local-6989586621681374712"><span class="annot"><span class="annottext">PmAltCon
</span><a href="#local-6989586621681374712"><span class="hs-identifier hs-var">cl</span></a></span></span><span> </span><span id="local-6989586621681374711"><span class="annot"><span class="annottext">[Id]
</span><a href="#local-6989586621681374711"><span class="hs-identifier hs-var">tvs</span></a></span></span><span> </span><span id="local-6989586621681374710"><span class="annot"><span class="annottext">[Id]
</span><a href="#local-6989586621681374710"><span class="hs-identifier hs-var">args</span></a></span></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">Nabla
-&gt; Id
-&gt; PmAltCon
-&gt; [Id]
-&gt; [Id]
-&gt; MaybeT (IOEnv (Env DsGblEnv DsLclEnv)) Nabla
</span><a href="GHC.HsToCore.Pmc.Solver.html#addConCt"><span class="hs-identifier hs-var">addConCt</span></a></span><span> </span><span class="annot"><span class="annottext">Nabla
</span><a href="#local-6989586621681374713"><span class="hs-identifier hs-var">nabla</span></a></span><span> </span><span class="annot"><span class="annottext">Id
</span><a href="#local-6989586621681374720"><span class="hs-identifier hs-var">y</span></a></span><span> </span><span class="annot"><span class="annottext">PmAltCon
</span><a href="#local-6989586621681374712"><span class="hs-identifier hs-var">cl</span></a></span><span> </span><span class="annot"><span class="annottext">[Id]
</span><a href="#local-6989586621681374711"><span class="hs-identifier hs-var">tvs</span></a></span><span> </span><span class="annot"><span class="annottext">[Id]
</span><a href="#local-6989586621681374710"><span class="hs-identifier hs-var">args</span></a></span><span>
</span><span id="line-892"></span><span>      </span><span id="local-6989586621681374709"><span class="annot"><span class="annottext">Nabla
</span><a href="#local-6989586621681374709"><span class="hs-identifier hs-var">nabla_pos</span></a></span></span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">forall (t :: * -&gt; *) (m :: * -&gt; *) b a.
(Foldable t, Monad m) =&gt;
(b -&gt; a -&gt; m b) -&gt; b -&gt; t a -&gt; m b
</span><a href="../../base-4.16.4.0/src/Data-Foldable.html#foldlM"><span class="hs-identifier hs-var">foldlM</span></a></span><span> </span><span class="annot"><span class="annottext">Nabla
-&gt; PmAltConApp -&gt; MaybeT (IOEnv (Env DsGblEnv DsLclEnv)) Nabla
</span><a href="#local-6989586621681374714"><span class="hs-identifier hs-var">add_pos</span></a></span><span> </span><span class="annot"><span class="annottext">Nabla
</span><a href="#local-6989586621681374715"><span class="hs-identifier hs-var">nabla_equated</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">VarInfo -&gt; [PmAltConApp]
</span><a href="GHC.HsToCore.Pmc.Solver.Types.html#vi_pos"><span class="hs-identifier hs-var">vi_pos</span></a></span><span> </span><span class="annot"><span class="annottext">VarInfo
</span><a href="#local-6989586621681374717"><span class="hs-identifier hs-var">vi_x</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-893"></span><span>      </span><span class="hs-comment">-- Do the same for negative info</span><span>
</span><span id="line-894"></span><span>      </span><span class="hs-keyword">let</span><span> </span><span id="local-6989586621681374708"><span class="annot"><span class="annottext">add_neg :: Nabla -&gt; PmAltCon -&gt; MaybeT (IOEnv (Env DsGblEnv DsLclEnv)) Nabla
</span><a href="#local-6989586621681374708"><span class="hs-identifier hs-var hs-var">add_neg</span></a></span></span><span> </span><span id="local-6989586621681374707"><span class="annot"><span class="annottext">Nabla
</span><a href="#local-6989586621681374707"><span class="hs-identifier hs-var">nabla</span></a></span></span><span> </span><span id="local-6989586621681374706"><span class="annot"><span class="annottext">PmAltCon
</span><a href="#local-6989586621681374706"><span class="hs-identifier hs-var">nalt</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">Nabla
-&gt; Id -&gt; PmAltCon -&gt; MaybeT (IOEnv (Env DsGblEnv DsLclEnv)) Nabla
</span><a href="GHC.HsToCore.Pmc.Solver.html#addNotConCt"><span class="hs-identifier hs-var">addNotConCt</span></a></span><span> </span><span class="annot"><span class="annottext">Nabla
</span><a href="#local-6989586621681374707"><span class="hs-identifier hs-var">nabla</span></a></span><span> </span><span class="annot"><span class="annottext">Id
</span><a href="#local-6989586621681374720"><span class="hs-identifier hs-var">y</span></a></span><span> </span><span class="annot"><span class="annottext">PmAltCon
</span><a href="#local-6989586621681374706"><span class="hs-identifier hs-var">nalt</span></a></span><span>
</span><span id="line-895"></span><span>      </span><span class="annot"><span class="annottext">forall (t :: * -&gt; *) (m :: * -&gt; *) b a.
(Foldable t, Monad m) =&gt;
(b -&gt; a -&gt; m b) -&gt; b -&gt; t a -&gt; m b
</span><a href="../../base-4.16.4.0/src/Data-Foldable.html#foldlM"><span class="hs-identifier hs-var">foldlM</span></a></span><span> </span><span class="annot"><span class="annottext">Nabla -&gt; PmAltCon -&gt; MaybeT (IOEnv (Env DsGblEnv DsLclEnv)) Nabla
</span><a href="#local-6989586621681374708"><span class="hs-identifier hs-var">add_neg</span></a></span><span> </span><span class="annot"><span class="annottext">Nabla
</span><a href="#local-6989586621681374709"><span class="hs-identifier hs-var">nabla_pos</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">PmAltConSet -&gt; [PmAltCon]
</span><a href="GHC.HsToCore.Pmc.Solver.Types.html#pmAltConSetElems"><span class="hs-identifier hs-var">pmAltConSetElems</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">VarInfo -&gt; PmAltConSet
</span><a href="GHC.HsToCore.Pmc.Solver.Types.html#vi_neg"><span class="hs-identifier hs-var">vi_neg</span></a></span><span> </span><span class="annot"><span class="annottext">VarInfo
</span><a href="#local-6989586621681374717"><span class="hs-identifier hs-var">vi_x</span></a></span><span class="hs-special">)</span><span class="hs-special">)</span><span>
</span><span id="line-896"></span><span>
</span><span id="line-897"></span><span class="hs-comment">-- | Inspects a 'PmCoreCt' @let x = e@ by recording constraints for @x@ based</span><span>
</span><span id="line-898"></span><span class="hs-comment">-- on the shape of the 'CoreExpr' @e@. Examples:</span><span>
</span><span id="line-899"></span><span class="hs-comment">--</span><span>
</span><span id="line-900"></span><span class="hs-comment">--   * For @let x = Just (42, 'z')@ we want to record the</span><span>
</span><span id="line-901"></span><span class="hs-comment">--     constraints @x ~ Just a, a ~ (b, c), b ~ 42, c ~ 'z'@.</span><span>
</span><span id="line-902"></span><span class="hs-comment">--     See 'data_con_app'.</span><span>
</span><span id="line-903"></span><span class="hs-comment">--   * For @let x = unpackCString# &quot;tmp&quot;@ we want to record the literal</span><span>
</span><span id="line-904"></span><span class="hs-comment">--     constraint @x ~ &quot;tmp&quot;@.</span><span>
</span><span id="line-905"></span><span class="hs-comment">--   * For @let x = I# 42@ we want the literal constraint @x ~ 42@. Similar</span><span>
</span><span id="line-906"></span><span class="hs-comment">--     for other literals. See 'coreExprAsPmLit'.</span><span>
</span><span id="line-907"></span><span class="hs-comment">--   * Finally, if we have @let x = e@ and we already have seen @let y = e@, we</span><span>
</span><span id="line-908"></span><span class="hs-comment">--     want to record @x ~ y@.</span><span>
</span><span id="line-909"></span><span class="annot"><a href="GHC.HsToCore.Pmc.Solver.html#addCoreCt"><span class="hs-identifier hs-type">addCoreCt</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><a href="GHC.HsToCore.Pmc.Solver.Types.html#Nabla"><span class="hs-identifier hs-type">Nabla</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="GHC.Types.Var.html#Id"><span class="hs-identifier hs-type">Id</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="GHC.Core.html#CoreExpr"><span class="hs-identifier hs-type">CoreExpr</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="../../transformers-0.5.6.2/src/Control-Monad-Trans-Maybe.html#MaybeT"><span class="hs-identifier hs-type">MaybeT</span></a></span><span> </span><span class="annot"><a href="GHC.HsToCore.Types.html#DsM"><span class="hs-identifier hs-type">DsM</span></a></span><span> </span><span class="annot"><a href="GHC.HsToCore.Pmc.Solver.Types.html#Nabla"><span class="hs-identifier hs-type">Nabla</span></a></span><span>
</span><span id="line-910"></span><span id="addCoreCt"><span class="annot"><span class="annottext">addCoreCt :: Nabla
-&gt; Id -&gt; CoreExpr -&gt; MaybeT (IOEnv (Env DsGblEnv DsLclEnv)) Nabla
</span><a href="GHC.HsToCore.Pmc.Solver.html#addCoreCt"><span class="hs-identifier hs-var hs-var">addCoreCt</span></a></span></span><span> </span><span id="local-6989586621681374705"><span class="annot"><span class="annottext">Nabla
</span><a href="#local-6989586621681374705"><span class="hs-identifier hs-var">nabla</span></a></span></span><span> </span><span id="local-6989586621681374704"><span class="annot"><span class="annottext">Id
</span><a href="#local-6989586621681374704"><span class="hs-identifier hs-var">x</span></a></span></span><span> </span><span id="local-6989586621681374703"><span class="annot"><span class="annottext">CoreExpr
</span><a href="#local-6989586621681374703"><span class="hs-identifier hs-var">e</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-keyword">do</span><span>
</span><span id="line-911"></span><span>  </span><span id="local-6989586621681374702"><span class="annot"><span class="annottext">SimpleOpts
</span><a href="#local-6989586621681374702"><span class="hs-identifier hs-var">simpl_opts</span></a></span></span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">DynFlags -&gt; SimpleOpts
</span><a href="GHC.Driver.Config.html#initSimpleOpts"><span class="hs-identifier hs-var">initSimpleOpts</span></a></span><span> </span><span class="annot"><span class="annottext">forall (f :: * -&gt; *) a b. Functor f =&gt; (a -&gt; b) -&gt; f a -&gt; f b
</span><a href="../../base-4.16.4.0/src/Data-Functor.html#%3C%24%3E"><span class="hs-operator hs-var">&lt;$&gt;</span></a></span><span> </span><span class="annot"><span class="annottext">forall (m :: * -&gt; *). HasDynFlags m =&gt; m DynFlags
</span><a href="GHC.Driver.Session.html#getDynFlags"><span class="hs-identifier hs-var">getDynFlags</span></a></span><span>
</span><span id="line-912"></span><span>  </span><span class="hs-keyword">let</span><span> </span><span id="local-6989586621681374699"><span class="annot"><span class="annottext">e' :: CoreExpr
</span><a href="#local-6989586621681374699"><span class="hs-identifier hs-var hs-var">e'</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">HasDebugCallStack =&gt; SimpleOpts -&gt; CoreExpr -&gt; CoreExpr
</span><a href="GHC.Core.SimpleOpt.html#simpleOptExpr"><span class="hs-identifier hs-var">simpleOptExpr</span></a></span><span> </span><span class="annot"><span class="annottext">SimpleOpts
</span><a href="#local-6989586621681374702"><span class="hs-identifier hs-var">simpl_opts</span></a></span><span> </span><span class="annot"><span class="annottext">CoreExpr
</span><a href="#local-6989586621681374703"><span class="hs-identifier hs-var">e</span></a></span><span>
</span><span id="line-913"></span><span>  </span><span class="hs-comment">-- lift $ tracePm &quot;addCoreCt&quot; (ppr x &lt;+&gt; dcolon &lt;+&gt; ppr (idType x) $$ ppr e $$ ppr e')</span><span>
</span><span id="line-914"></span><span>  </span><span class="annot"><span class="annottext">forall (m :: * -&gt; *) s a. Monad m =&gt; StateT s m a -&gt; s -&gt; m s
</span><a href="../../transformers-0.5.6.2/src/Control-Monad-Trans-State-Strict.html#execStateT"><span class="hs-identifier hs-var">execStateT</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Id
-&gt; CoreExpr
-&gt; StateT Nabla (MaybeT (IOEnv (Env DsGblEnv DsLclEnv))) ()
</span><a href="#local-6989586621681374697"><span class="hs-identifier hs-var">core_expr</span></a></span><span> </span><span class="annot"><span class="annottext">Id
</span><a href="#local-6989586621681374704"><span class="hs-identifier hs-var">x</span></a></span><span> </span><span class="annot"><span class="annottext">CoreExpr
</span><a href="#local-6989586621681374699"><span class="hs-identifier hs-var">e'</span></a></span><span class="hs-special">)</span><span> </span><span class="annot"><span class="annottext">Nabla
</span><a href="#local-6989586621681374705"><span class="hs-identifier hs-var">nabla</span></a></span><span>
</span><span id="line-915"></span><span>  </span><span class="hs-keyword">where</span><span>
</span><span id="line-916"></span><span>    </span><span class="hs-comment">-- | Takes apart a 'CoreExpr' and tries to extract as much information about</span><span>
</span><span id="line-917"></span><span>    </span><span class="hs-comment">-- literals and constructor applications as possible.</span><span>
</span><span id="line-918"></span><span>    </span><span class="annot"><a href="#local-6989586621681374697"><span class="hs-identifier hs-type">core_expr</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><a href="GHC.Types.Var.html#Id"><span class="hs-identifier hs-type">Id</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="GHC.Core.html#CoreExpr"><span class="hs-identifier hs-type">CoreExpr</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="../../transformers-0.5.6.2/src/Control-Monad-Trans-State-Strict.html#StateT"><span class="hs-identifier hs-type">StateT</span></a></span><span> </span><span class="annot"><a href="GHC.HsToCore.Pmc.Solver.Types.html#Nabla"><span class="hs-identifier hs-type">Nabla</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="../../transformers-0.5.6.2/src/Control-Monad-Trans-Maybe.html#MaybeT"><span class="hs-identifier hs-type">MaybeT</span></a></span><span> </span><span class="annot"><a href="GHC.HsToCore.Types.html#DsM"><span class="hs-identifier hs-type">DsM</span></a></span><span class="hs-special">)</span><span> </span><span class="hs-special">(</span><span class="hs-special">)</span><span>
</span><span id="line-919"></span><span>    </span><span class="hs-comment">-- TODO: Handle newtypes properly, by wrapping the expression in a DataCon</span><span>
</span><span id="line-920"></span><span>    </span><span class="hs-comment">-- This is the right thing for casts involving data family instances and</span><span>
</span><span id="line-921"></span><span>    </span><span class="hs-comment">-- their representation TyCon, though (which are not visible in source</span><span>
</span><span id="line-922"></span><span>    </span><span class="hs-comment">-- syntax). See Note [COMPLETE sets on data families]</span><span>
</span><span id="line-923"></span><span>    </span><span class="hs-comment">-- core_expr x e | pprTrace &quot;core_expr&quot; (ppr x $$ ppr e) False = undefined</span><span>
</span><span id="line-924"></span><span>    </span><span id="local-6989586621681374697"><span class="annot"><span class="annottext">core_expr :: Id
-&gt; CoreExpr
-&gt; StateT Nabla (MaybeT (IOEnv (Env DsGblEnv DsLclEnv))) ()
</span><a href="#local-6989586621681374697"><span class="hs-identifier hs-var hs-var">core_expr</span></a></span></span><span> </span><span id="local-6989586621681374696"><span class="annot"><span class="annottext">Id
</span><a href="#local-6989586621681374696"><span class="hs-identifier hs-var">x</span></a></span></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="GHC.Core.html#Cast"><span class="hs-identifier hs-type">Cast</span></a></span><span> </span><span id="local-6989586621681374694"><span class="annot"><span class="annottext">CoreExpr
</span><a href="#local-6989586621681374694"><span class="hs-identifier hs-var">e</span></a></span></span><span> </span><span id="local-6989586621681374693"><span class="annot"><span class="annottext">Coercion
</span><a href="#local-6989586621681374693"><span class="hs-identifier hs-var">_co</span></a></span></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">Id
-&gt; CoreExpr
-&gt; StateT Nabla (MaybeT (IOEnv (Env DsGblEnv DsLclEnv))) ()
</span><a href="#local-6989586621681374697"><span class="hs-identifier hs-var">core_expr</span></a></span><span> </span><span class="annot"><span class="annottext">Id
</span><a href="#local-6989586621681374696"><span class="hs-identifier hs-var">x</span></a></span><span> </span><span class="annot"><span class="annottext">CoreExpr
</span><a href="#local-6989586621681374694"><span class="hs-identifier hs-var">e</span></a></span><span>
</span><span id="line-925"></span><span>    </span><span class="annot"><a href="#local-6989586621681374697"><span class="hs-identifier hs-var">core_expr</span></a></span><span> </span><span id="local-6989586621681374692"><span class="annot"><span class="annottext">Id
</span><a href="#local-6989586621681374692"><span class="hs-identifier hs-var">x</span></a></span></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="GHC.Core.html#Tick"><span class="hs-identifier hs-type">Tick</span></a></span><span> </span><span id="local-6989586621681374690"><span class="annot"><span class="annottext">CoreTickish
</span><a href="#local-6989586621681374690"><span class="hs-identifier hs-var">_t</span></a></span></span><span> </span><span id="local-6989586621681374689"><span class="annot"><span class="annottext">CoreExpr
</span><a href="#local-6989586621681374689"><span class="hs-identifier hs-var">e</span></a></span></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">Id
-&gt; CoreExpr
-&gt; StateT Nabla (MaybeT (IOEnv (Env DsGblEnv DsLclEnv))) ()
</span><a href="#local-6989586621681374697"><span class="hs-identifier hs-var">core_expr</span></a></span><span> </span><span class="annot"><span class="annottext">Id
</span><a href="#local-6989586621681374692"><span class="hs-identifier hs-var">x</span></a></span><span> </span><span class="annot"><span class="annottext">CoreExpr
</span><a href="#local-6989586621681374689"><span class="hs-identifier hs-var">e</span></a></span><span>
</span><span id="line-926"></span><span>    </span><span class="annot"><a href="#local-6989586621681374697"><span class="hs-identifier hs-var">core_expr</span></a></span><span> </span><span id="local-6989586621681374688"><span class="annot"><span class="annottext">Id
</span><a href="#local-6989586621681374688"><span class="hs-identifier hs-var">x</span></a></span></span><span> </span><span id="local-6989586621681374687"><span class="annot"><span class="annottext">CoreExpr
</span><a href="#local-6989586621681374687"><span class="hs-identifier hs-var">e</span></a></span></span><span>
</span><span id="line-927"></span><span>      </span><span class="hs-glyph">|</span><span> </span><span class="annot"><a href="../../base-4.16.4.0/src/GHC-Maybe.html#Just"><span class="hs-identifier hs-type">Just</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">PmLit -&gt; Maybe FastString
</span><a href="GHC.HsToCore.Pmc.Solver.Types.html#pmLitAsStringLit"><span class="hs-identifier hs-var">pmLitAsStringLit</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="../../base-4.16.4.0/src/GHC-Maybe.html#Just"><span class="hs-identifier hs-type">Just</span></a></span><span> </span><span id="local-6989586621681374685"><span class="annot"><span class="annottext">FastString
</span><a href="#local-6989586621681374685"><span class="hs-identifier hs-var">s</span></a></span></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">CoreExpr -&gt; Maybe PmLit
</span><a href="GHC.HsToCore.Pmc.Solver.Types.html#coreExprAsPmLit"><span class="hs-identifier hs-var">coreExprAsPmLit</span></a></span><span> </span><span class="annot"><span class="annottext">CoreExpr
</span><a href="#local-6989586621681374687"><span class="hs-identifier hs-var">e</span></a></span><span>
</span><span id="line-928"></span><span>      </span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">Type
</span><a href="#local-6989586621681374683"><span class="hs-identifier hs-var">expr_ty</span></a></span><span> </span><span class="annot"><span class="annottext">Type -&gt; Type -&gt; Bool
</span><a href="GHC.Core.Type.html#eqType"><span class="hs-operator hs-var">`eqType`</span></a></span><span> </span><span class="annot"><span class="annottext">Type
</span><a href="GHC.Builtin.Types.html#stringTy"><span class="hs-identifier hs-var">stringTy</span></a></span><span>
</span><span id="line-929"></span><span>      </span><span class="hs-comment">-- See Note [Representation of Strings in TmState]</span><span>
</span><span id="line-930"></span><span>      </span><span class="hs-glyph">=</span><span> </span><span class="hs-keyword">case</span><span> </span><span class="annot"><span class="annottext">FastString -&gt; String
</span><a href="GHC.Data.FastString.html#unpackFS"><span class="hs-identifier hs-var">unpackFS</span></a></span><span> </span><span class="annot"><span class="annottext">FastString
</span><a href="#local-6989586621681374685"><span class="hs-identifier hs-var">s</span></a></span><span> </span><span class="hs-keyword">of</span><span>
</span><span id="line-931"></span><span>          </span><span class="hs-comment">-- We need this special case to break a loop with coreExprAsPmLit</span><span>
</span><span id="line-932"></span><span>          </span><span class="hs-comment">-- Otherwise we alternate endlessly between [] and &quot;&quot;</span><span>
</span><span id="line-933"></span><span>          </span><span class="hs-special">[</span><span class="hs-special">]</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="annottext">Id
-&gt; InScopeSet
-&gt; DataCon
-&gt; [CoreExpr]
-&gt; StateT Nabla (MaybeT (IOEnv (Env DsGblEnv DsLclEnv))) ()
</span><a href="#local-6989586621681374680"><span class="hs-identifier hs-var">data_con_app</span></a></span><span> </span><span class="annot"><span class="annottext">Id
</span><a href="#local-6989586621681374688"><span class="hs-identifier hs-var">x</span></a></span><span> </span><span class="annot"><span class="annottext">InScopeSet
</span><a href="GHC.Types.Var.Env.html#emptyInScopeSet"><span class="hs-identifier hs-var">emptyInScopeSet</span></a></span><span> </span><span class="annot"><span class="annottext">DataCon
</span><a href="GHC.Builtin.Types.html#nilDataCon"><span class="hs-identifier hs-var">nilDataCon</span></a></span><span> </span><span class="hs-special">[</span><span class="hs-special">]</span><span>
</span><span id="line-934"></span><span>          </span><span id="local-6989586621681374677"><span class="annot"><span class="annottext">String
</span><a href="#local-6989586621681374677"><span class="hs-identifier hs-var">s'</span></a></span></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="annottext">Id
-&gt; CoreExpr
-&gt; StateT Nabla (MaybeT (IOEnv (Env DsGblEnv DsLclEnv))) ()
</span><a href="#local-6989586621681374697"><span class="hs-identifier hs-var">core_expr</span></a></span><span> </span><span class="annot"><span class="annottext">Id
</span><a href="#local-6989586621681374688"><span class="hs-identifier hs-var">x</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Type -&gt; [CoreExpr] -&gt; CoreExpr
</span><a href="GHC.Core.Make.html#mkListExpr"><span class="hs-identifier hs-var">mkListExpr</span></a></span><span> </span><span class="annot"><span class="annottext">Type
</span><a href="GHC.Builtin.Types.html#charTy"><span class="hs-identifier hs-var">charTy</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">forall a b. (a -&gt; b) -&gt; [a] -&gt; [b]
</span><a href="../../base-4.16.4.0/src/GHC-Base.html#map"><span class="hs-identifier hs-var">map</span></a></span><span> </span><span class="annot"><span class="annottext">Char -&gt; CoreExpr
</span><a href="GHC.Core.Make.html#mkCharExpr"><span class="hs-identifier hs-var">mkCharExpr</span></a></span><span> </span><span class="annot"><span class="annottext">String
</span><a href="#local-6989586621681374677"><span class="hs-identifier hs-var">s'</span></a></span><span class="hs-special">)</span><span class="hs-special">)</span><span>
</span><span id="line-935"></span><span>      </span><span class="hs-glyph">|</span><span> </span><span class="annot"><a href="../../base-4.16.4.0/src/GHC-Maybe.html#Just"><span class="hs-identifier hs-type">Just</span></a></span><span> </span><span id="local-6989586621681374675"><span class="annot"><span class="annottext">PmLit
</span><a href="#local-6989586621681374675"><span class="hs-identifier hs-var">lit</span></a></span></span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">CoreExpr -&gt; Maybe PmLit
</span><a href="GHC.HsToCore.Pmc.Solver.Types.html#coreExprAsPmLit"><span class="hs-identifier hs-var">coreExprAsPmLit</span></a></span><span> </span><span class="annot"><span class="annottext">CoreExpr
</span><a href="#local-6989586621681374687"><span class="hs-identifier hs-var">e</span></a></span><span>
</span><span id="line-936"></span><span>      </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">Id
-&gt; PmLit
-&gt; StateT Nabla (MaybeT (IOEnv (Env DsGblEnv DsLclEnv))) ()
</span><a href="#local-6989586621681374674"><span class="hs-identifier hs-var">pm_lit</span></a></span><span> </span><span class="annot"><span class="annottext">Id
</span><a href="#local-6989586621681374688"><span class="hs-identifier hs-var">x</span></a></span><span> </span><span class="annot"><span class="annottext">PmLit
</span><a href="#local-6989586621681374675"><span class="hs-identifier hs-var">lit</span></a></span><span>
</span><span id="line-937"></span><span>      </span><span class="hs-glyph">|</span><span> </span><span class="annot"><a href="../../base-4.16.4.0/src/GHC-Maybe.html#Just"><span class="hs-identifier hs-type">Just</span></a></span><span> </span><span class="hs-special">(</span><span id="local-6989586621681374673"><span class="annot"><span class="annottext">InScopeSet
</span><a href="#local-6989586621681374673"><span class="hs-identifier hs-var">in_scope</span></a></span></span><span class="hs-special">,</span><span> </span><span id="local-6989586621681374672"><span class="annot"><span class="annottext">_empty_floats :: [FloatBind]
</span><a href="#local-6989586621681374672"><span class="hs-identifier hs-var">_empty_floats</span></a></span></span><span class="hs-glyph">@</span><span class="hs-special">[</span><span class="hs-special">]</span><span class="hs-special">,</span><span> </span><span id="local-6989586621681374671"><span class="annot"><span class="annottext">DataCon
</span><a href="#local-6989586621681374671"><span class="hs-identifier hs-var">dc</span></a></span></span><span class="hs-special">,</span><span> </span><span id="local-6989586621681374670"><span class="annot"><span class="annottext">ThetaType
</span><a href="#local-6989586621681374670"><span class="hs-identifier hs-var">_arg_tys</span></a></span></span><span class="hs-special">,</span><span> </span><span id="local-6989586621681374669"><span class="annot"><span class="annottext">[CoreExpr]
</span><a href="#local-6989586621681374669"><span class="hs-identifier hs-var">args</span></a></span></span><span class="hs-special">)</span><span>
</span><span id="line-938"></span><span>            </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">HasDebugCallStack =&gt;
InScopeEnv
-&gt; CoreExpr
-&gt; Maybe (InScopeSet, [FloatBind], DataCon, ThetaType, [CoreExpr])
</span><a href="GHC.Core.SimpleOpt.html#exprIsConApp_maybe"><span class="hs-identifier hs-var">exprIsConApp_maybe</span></a></span><span> </span><span class="annot"><span class="annottext">InScopeEnv
</span><a href="#local-6989586621681374668"><span class="hs-identifier hs-var">in_scope_env</span></a></span><span> </span><span class="annot"><span class="annottext">CoreExpr
</span><a href="#local-6989586621681374687"><span class="hs-identifier hs-var">e</span></a></span><span>
</span><span id="line-939"></span><span>      </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">Id
-&gt; InScopeSet
-&gt; DataCon
-&gt; [CoreExpr]
-&gt; StateT Nabla (MaybeT (IOEnv (Env DsGblEnv DsLclEnv))) ()
</span><a href="#local-6989586621681374680"><span class="hs-identifier hs-var">data_con_app</span></a></span><span> </span><span class="annot"><span class="annottext">Id
</span><a href="#local-6989586621681374688"><span class="hs-identifier hs-var">x</span></a></span><span> </span><span class="annot"><span class="annottext">InScopeSet
</span><a href="#local-6989586621681374673"><span class="hs-identifier hs-var">in_scope</span></a></span><span> </span><span class="annot"><span class="annottext">DataCon
</span><a href="#local-6989586621681374671"><span class="hs-identifier hs-var">dc</span></a></span><span> </span><span class="annot"><span class="annottext">[CoreExpr]
</span><a href="#local-6989586621681374669"><span class="hs-identifier hs-var">args</span></a></span><span>
</span><span id="line-940"></span><span>      </span><span class="hs-comment">-- See Note [Detecting pattern synonym applications in expressions]</span><span>
</span><span id="line-941"></span><span>      </span><span class="hs-glyph">|</span><span> </span><span class="annot"><a href="GHC.Core.html#Var"><span class="hs-identifier hs-type">Var</span></a></span><span> </span><span id="local-6989586621681374666"><span class="annot"><span class="annottext">Id
</span><a href="#local-6989586621681374666"><span class="hs-identifier hs-var">y</span></a></span></span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">CoreExpr
</span><a href="#local-6989586621681374687"><span class="hs-identifier hs-var">e</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">Maybe DataCon
</span><a href="../../base-4.16.4.0/src/GHC-Maybe.html#Nothing"><span class="hs-identifier hs-var">Nothing</span></a></span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">Id -&gt; Maybe DataCon
</span><a href="GHC.Types.Id.html#isDataConId_maybe"><span class="hs-identifier hs-var">isDataConId_maybe</span></a></span><span> </span><span class="annot"><span class="annottext">Id
</span><a href="#local-6989586621681374688"><span class="hs-identifier hs-var">x</span></a></span><span>
</span><span id="line-942"></span><span>      </span><span class="hs-comment">-- We don't consider DataCons flexible variables</span><span>
</span><span id="line-943"></span><span>      </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">forall (m :: * -&gt; *) s. Monad m =&gt; (s -&gt; m s) -&gt; StateT s m ()
</span><a href="GHC.HsToCore.Pmc.Solver.html#modifyT"><span class="hs-identifier hs-var">modifyT</span></a></span><span> </span><span class="hs-special">(</span><span class="hs-glyph">\</span><span id="local-6989586621681374663"><span class="annot"><span class="annottext">Nabla
</span><a href="#local-6989586621681374663"><span class="hs-identifier hs-var">nabla</span></a></span></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="annottext">Nabla -&gt; Id -&gt; Id -&gt; MaybeT (IOEnv (Env DsGblEnv DsLclEnv)) Nabla
</span><a href="GHC.HsToCore.Pmc.Solver.html#addVarCt"><span class="hs-identifier hs-var">addVarCt</span></a></span><span> </span><span class="annot"><span class="annottext">Nabla
</span><a href="#local-6989586621681374663"><span class="hs-identifier hs-var">nabla</span></a></span><span> </span><span class="annot"><span class="annottext">Id
</span><a href="#local-6989586621681374688"><span class="hs-identifier hs-var">x</span></a></span><span> </span><span class="annot"><span class="annottext">Id
</span><a href="#local-6989586621681374666"><span class="hs-identifier hs-var">y</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-944"></span><span>      </span><span class="hs-glyph">|</span><span> </span><span class="annot"><span class="annottext">Bool
</span><a href="../../base-4.16.4.0/src/GHC-Base.html#otherwise"><span class="hs-identifier hs-var">otherwise</span></a></span><span>
</span><span id="line-945"></span><span>      </span><span class="hs-comment">-- Any other expression. Try to find other uses of a semantically</span><span>
</span><span id="line-946"></span><span>      </span><span class="hs-comment">-- equivalent expression and represent them by the same variable!</span><span>
</span><span id="line-947"></span><span>      </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">Id
-&gt; CoreExpr
-&gt; StateT Nabla (MaybeT (IOEnv (Env DsGblEnv DsLclEnv))) ()
</span><a href="#local-6989586621681374662"><span class="hs-identifier hs-var">equate_with_similar_expr</span></a></span><span> </span><span class="annot"><span class="annottext">Id
</span><a href="#local-6989586621681374688"><span class="hs-identifier hs-var">x</span></a></span><span> </span><span class="annot"><span class="annottext">CoreExpr
</span><a href="#local-6989586621681374687"><span class="hs-identifier hs-var">e</span></a></span><span>
</span><span id="line-948"></span><span>      </span><span class="hs-keyword">where</span><span>
</span><span id="line-949"></span><span>        </span><span id="local-6989586621681374683"><span class="annot"><span class="annottext">expr_ty :: Type
</span><a href="#local-6989586621681374683"><span class="hs-identifier hs-var hs-var">expr_ty</span></a></span></span><span>       </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">CoreExpr -&gt; Type
</span><a href="GHC.Core.Utils.html#exprType"><span class="hs-identifier hs-var">exprType</span></a></span><span> </span><span class="annot"><span class="annottext">CoreExpr
</span><a href="#local-6989586621681374687"><span class="hs-identifier hs-var">e</span></a></span><span>
</span><span id="line-950"></span><span>        </span><span id="local-6989586621681374661"><span class="annot"><span class="annottext">expr_in_scope :: InScopeSet
</span><a href="#local-6989586621681374661"><span class="hs-identifier hs-var hs-var">expr_in_scope</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">VarSet -&gt; InScopeSet
</span><a href="GHC.Types.Var.Env.html#mkInScopeSet"><span class="hs-identifier hs-var">mkInScopeSet</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">CoreExpr -&gt; VarSet
</span><a href="GHC.Core.FVs.html#exprFreeVars"><span class="hs-identifier hs-var">exprFreeVars</span></a></span><span> </span><span class="annot"><span class="annottext">CoreExpr
</span><a href="#local-6989586621681374687"><span class="hs-identifier hs-var">e</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-951"></span><span>        </span><span id="local-6989586621681374668"><span class="annot"><span class="annottext">in_scope_env :: InScopeEnv
</span><a href="#local-6989586621681374668"><span class="hs-identifier hs-var hs-var">in_scope_env</span></a></span></span><span>  </span><span class="hs-glyph">=</span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">InScopeSet
</span><a href="#local-6989586621681374661"><span class="hs-identifier hs-var">expr_in_scope</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">forall a b. a -&gt; b -&gt; a
</span><a href="../../base-4.16.4.0/src/GHC-Base.html#const"><span class="hs-identifier hs-var">const</span></a></span><span> </span><span class="annot"><span class="annottext">Unfolding
</span><a href="GHC.Core.html#NoUnfolding"><span class="hs-identifier hs-var">NoUnfolding</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-952"></span><span>        </span><span class="hs-comment">-- It's inconvenient to get hold of a global in-scope set</span><span>
</span><span id="line-953"></span><span>        </span><span class="hs-comment">-- here, but it'll only be needed if exprIsConApp_maybe ends</span><span>
</span><span id="line-954"></span><span>        </span><span class="hs-comment">-- up substituting inside a forall or lambda (i.e. seldom)</span><span>
</span><span id="line-955"></span><span>        </span><span class="hs-comment">-- so using exprFreeVars seems fine.   See MR !1647.</span><span>
</span><span id="line-956"></span><span>
</span><span id="line-957"></span><span>    </span><span class="hs-comment">-- | The @e@ in @let x = e@ had no familiar form. But we can still see if</span><span>
</span><span id="line-958"></span><span>    </span><span class="hs-comment">-- see if we already encountered a constraint @let y = e'@ with @e'@</span><span>
</span><span id="line-959"></span><span>    </span><span class="hs-comment">-- semantically equivalent to @e@, in which case we may add the constraint</span><span>
</span><span id="line-960"></span><span>    </span><span class="hs-comment">-- @x ~ y@.</span><span>
</span><span id="line-961"></span><span>    </span><span class="annot"><a href="#local-6989586621681374662"><span class="hs-identifier hs-type">equate_with_similar_expr</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><a href="GHC.Types.Var.html#Id"><span class="hs-identifier hs-type">Id</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="GHC.Core.html#CoreExpr"><span class="hs-identifier hs-type">CoreExpr</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="../../transformers-0.5.6.2/src/Control-Monad-Trans-State-Strict.html#StateT"><span class="hs-identifier hs-type">StateT</span></a></span><span> </span><span class="annot"><a href="GHC.HsToCore.Pmc.Solver.Types.html#Nabla"><span class="hs-identifier hs-type">Nabla</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="../../transformers-0.5.6.2/src/Control-Monad-Trans-Maybe.html#MaybeT"><span class="hs-identifier hs-type">MaybeT</span></a></span><span> </span><span class="annot"><a href="GHC.HsToCore.Types.html#DsM"><span class="hs-identifier hs-type">DsM</span></a></span><span class="hs-special">)</span><span> </span><span class="hs-special">(</span><span class="hs-special">)</span><span>
</span><span id="line-962"></span><span>    </span><span id="local-6989586621681374662"><span class="annot"><span class="annottext">equate_with_similar_expr :: Id
-&gt; CoreExpr
-&gt; StateT Nabla (MaybeT (IOEnv (Env DsGblEnv DsLclEnv))) ()
</span><a href="#local-6989586621681374662"><span class="hs-identifier hs-var hs-var">equate_with_similar_expr</span></a></span></span><span> </span><span id="local-6989586621681374657"><span class="annot"><span class="annottext">Id
</span><a href="#local-6989586621681374657"><span class="hs-identifier hs-var">x</span></a></span></span><span> </span><span id="local-6989586621681374656"><span class="annot"><span class="annottext">CoreExpr
</span><a href="#local-6989586621681374656"><span class="hs-identifier hs-var">e</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-keyword">do</span><span>
</span><span id="line-963"></span><span>      </span><span id="local-6989586621681374655"><span class="annot"><span class="annottext">Id
</span><a href="#local-6989586621681374655"><span class="hs-identifier hs-var">rep</span></a></span></span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">forall s (m :: * -&gt; *) a. (s -&gt; m (a, s)) -&gt; StateT s m a
</span><a href="../../transformers-0.5.6.2/src/Control-Monad-Trans-State-Strict.html#StateT"><span class="hs-identifier hs-var">StateT</span></a></span><span> </span><span class="annot"><span class="annottext">forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><a href="../../base-4.16.4.0/src/GHC-Base.html#%24"><span class="hs-operator hs-var">$</span></a></span><span> </span><span class="hs-glyph">\</span><span id="local-6989586621681374653"><span class="annot"><span class="annottext">Nabla
</span><a href="#local-6989586621681374653"><span class="hs-identifier hs-var">nabla</span></a></span></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="annottext">forall (t :: (* -&gt; *) -&gt; * -&gt; *) (m :: * -&gt; *) a.
(MonadTrans t, Monad m) =&gt;
m a -&gt; t m a
</span><a href="../../transformers-0.5.6.2/src/Control-Monad-Trans-Class.html#lift"><span class="hs-identifier hs-var">lift</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Nabla -&gt; CoreExpr -&gt; DsM (Id, Nabla)
</span><a href="GHC.HsToCore.Pmc.Solver.html#representCoreExpr"><span class="hs-identifier hs-var">representCoreExpr</span></a></span><span> </span><span class="annot"><span class="annottext">Nabla
</span><a href="#local-6989586621681374653"><span class="hs-identifier hs-var">nabla</span></a></span><span> </span><span class="annot"><span class="annottext">CoreExpr
</span><a href="#local-6989586621681374656"><span class="hs-identifier hs-var">e</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-964"></span><span>      </span><span class="hs-comment">-- Note that @rep == x@ if we encountered @e@ for the first time.</span><span>
</span><span id="line-965"></span><span>      </span><span class="annot"><span class="annottext">forall (m :: * -&gt; *) s. Monad m =&gt; (s -&gt; m s) -&gt; StateT s m ()
</span><a href="GHC.HsToCore.Pmc.Solver.html#modifyT"><span class="hs-identifier hs-var">modifyT</span></a></span><span> </span><span class="hs-special">(</span><span class="hs-glyph">\</span><span id="local-6989586621681374651"><span class="annot"><span class="annottext">Nabla
</span><a href="#local-6989586621681374651"><span class="hs-identifier hs-var">nabla</span></a></span></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="annottext">Nabla -&gt; Id -&gt; Id -&gt; MaybeT (IOEnv (Env DsGblEnv DsLclEnv)) Nabla
</span><a href="GHC.HsToCore.Pmc.Solver.html#addVarCt"><span class="hs-identifier hs-var">addVarCt</span></a></span><span> </span><span class="annot"><span class="annottext">Nabla
</span><a href="#local-6989586621681374651"><span class="hs-identifier hs-var">nabla</span></a></span><span> </span><span class="annot"><span class="annottext">Id
</span><a href="#local-6989586621681374657"><span class="hs-identifier hs-var">x</span></a></span><span> </span><span class="annot"><span class="annottext">Id
</span><a href="#local-6989586621681374655"><span class="hs-identifier hs-var">rep</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-966"></span><span>
</span><span id="line-967"></span><span>    </span><span class="annot"><a href="#local-6989586621681374650"><span class="hs-identifier hs-type">bind_expr</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><a href="GHC.Core.html#CoreExpr"><span class="hs-identifier hs-type">CoreExpr</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="../../transformers-0.5.6.2/src/Control-Monad-Trans-State-Strict.html#StateT"><span class="hs-identifier hs-type">StateT</span></a></span><span> </span><span class="annot"><a href="GHC.HsToCore.Pmc.Solver.Types.html#Nabla"><span class="hs-identifier hs-type">Nabla</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="../../transformers-0.5.6.2/src/Control-Monad-Trans-Maybe.html#MaybeT"><span class="hs-identifier hs-type">MaybeT</span></a></span><span> </span><span class="annot"><a href="GHC.HsToCore.Types.html#DsM"><span class="hs-identifier hs-type">DsM</span></a></span><span class="hs-special">)</span><span> </span><span class="annot"><a href="GHC.Types.Var.html#Id"><span class="hs-identifier hs-type">Id</span></a></span><span>
</span><span id="line-968"></span><span>    </span><span id="local-6989586621681374650"><span class="annot"><span class="annottext">bind_expr :: CoreExpr
-&gt; StateT Nabla (MaybeT (IOEnv (Env DsGblEnv DsLclEnv))) Id
</span><a href="#local-6989586621681374650"><span class="hs-identifier hs-var hs-var">bind_expr</span></a></span></span><span> </span><span id="local-6989586621681374649"><span class="annot"><span class="annottext">CoreExpr
</span><a href="#local-6989586621681374649"><span class="hs-identifier hs-var">e</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-keyword">do</span><span>
</span><span id="line-969"></span><span>      </span><span id="local-6989586621681374648"><span class="annot"><span class="annottext">Id
</span><a href="#local-6989586621681374648"><span class="hs-identifier hs-var">x</span></a></span></span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">forall (t :: (* -&gt; *) -&gt; * -&gt; *) (m :: * -&gt; *) a.
(MonadTrans t, Monad m) =&gt;
m a -&gt; t m a
</span><a href="../../transformers-0.5.6.2/src/Control-Monad-Trans-Class.html#lift"><span class="hs-identifier hs-var">lift</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">forall (t :: (* -&gt; *) -&gt; * -&gt; *) (m :: * -&gt; *) a.
(MonadTrans t, Monad m) =&gt;
m a -&gt; t m a
</span><a href="../../transformers-0.5.6.2/src/Control-Monad-Trans-Class.html#lift"><span class="hs-identifier hs-var">lift</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Type -&gt; DsM Id
</span><a href="GHC.HsToCore.Pmc.Utils.html#mkPmId"><span class="hs-identifier hs-var">mkPmId</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">CoreExpr -&gt; Type
</span><a href="GHC.Core.Utils.html#exprType"><span class="hs-identifier hs-var">exprType</span></a></span><span> </span><span class="annot"><span class="annottext">CoreExpr
</span><a href="#local-6989586621681374649"><span class="hs-identifier hs-var">e</span></a></span><span class="hs-special">)</span><span class="hs-special">)</span><span class="hs-special">)</span><span>
</span><span id="line-970"></span><span>      </span><span class="annot"><span class="annottext">Id
-&gt; CoreExpr
-&gt; StateT Nabla (MaybeT (IOEnv (Env DsGblEnv DsLclEnv))) ()
</span><a href="#local-6989586621681374697"><span class="hs-identifier hs-var">core_expr</span></a></span><span> </span><span class="annot"><span class="annottext">Id
</span><a href="#local-6989586621681374648"><span class="hs-identifier hs-var">x</span></a></span><span> </span><span class="annot"><span class="annottext">CoreExpr
</span><a href="#local-6989586621681374649"><span class="hs-identifier hs-var">e</span></a></span><span>
</span><span id="line-971"></span><span>      </span><span class="annot"><span class="annottext">forall (f :: * -&gt; *) a. Applicative f =&gt; a -&gt; f a
</span><a href="../../base-4.16.4.0/src/GHC-Base.html#pure"><span class="hs-identifier hs-var">pure</span></a></span><span> </span><span class="annot"><span class="annottext">Id
</span><a href="#local-6989586621681374648"><span class="hs-identifier hs-var">x</span></a></span><span>
</span><span id="line-972"></span><span>
</span><span id="line-973"></span><span>    </span><span class="hs-comment">-- | Look at @let x = K taus theta es@ and generate the following</span><span>
</span><span id="line-974"></span><span>    </span><span class="hs-comment">-- constraints (assuming universals were dropped from @taus@ before):</span><span>
</span><span id="line-975"></span><span>    </span><span class="hs-comment">--   1. @x &#8769; &#8869;@ if 'K' is not a Newtype constructor.</span><span>
</span><span id="line-976"></span><span>    </span><span class="hs-comment">--   2. @a_1 ~ tau_1, ..., a_n ~ tau_n@ for fresh @a_i@</span><span>
</span><span id="line-977"></span><span>    </span><span class="hs-comment">--   3. @y_1 ~ e_1, ..., y_m ~ e_m@ for fresh @y_i@</span><span>
</span><span id="line-978"></span><span>    </span><span class="hs-comment">--   4. @x ~ K as ys@</span><span>
</span><span id="line-979"></span><span>    </span><span class="hs-comment">-- This is quite similar to PmCheck.pmConCts.</span><span>
</span><span id="line-980"></span><span>    </span><span class="annot"><a href="#local-6989586621681374680"><span class="hs-identifier hs-type">data_con_app</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><a href="GHC.Types.Var.html#Id"><span class="hs-identifier hs-type">Id</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="GHC.Types.Var.Env.html#InScopeSet"><span class="hs-identifier hs-type">InScopeSet</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="GHC.Core.DataCon.html#DataCon"><span class="hs-identifier hs-type">DataCon</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-special">[</span><span class="annot"><a href="GHC.Core.html#CoreExpr"><span class="hs-identifier hs-type">CoreExpr</span></a></span><span class="hs-special">]</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="../../transformers-0.5.6.2/src/Control-Monad-Trans-State-Strict.html#StateT"><span class="hs-identifier hs-type">StateT</span></a></span><span> </span><span class="annot"><a href="GHC.HsToCore.Pmc.Solver.Types.html#Nabla"><span class="hs-identifier hs-type">Nabla</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="../../transformers-0.5.6.2/src/Control-Monad-Trans-Maybe.html#MaybeT"><span class="hs-identifier hs-type">MaybeT</span></a></span><span> </span><span class="annot"><a href="GHC.HsToCore.Types.html#DsM"><span class="hs-identifier hs-type">DsM</span></a></span><span class="hs-special">)</span><span> </span><span class="hs-special">(</span><span class="hs-special">)</span><span>
</span><span id="line-981"></span><span>    </span><span id="local-6989586621681374680"><span class="annot"><span class="annottext">data_con_app :: Id
-&gt; InScopeSet
-&gt; DataCon
-&gt; [CoreExpr]
-&gt; StateT Nabla (MaybeT (IOEnv (Env DsGblEnv DsLclEnv))) ()
</span><a href="#local-6989586621681374680"><span class="hs-identifier hs-var hs-var">data_con_app</span></a></span></span><span> </span><span id="local-6989586621681374647"><span class="annot"><span class="annottext">Id
</span><a href="#local-6989586621681374647"><span class="hs-identifier hs-var">x</span></a></span></span><span> </span><span id="local-6989586621681374646"><span class="annot"><span class="annottext">InScopeSet
</span><a href="#local-6989586621681374646"><span class="hs-identifier hs-var">in_scope</span></a></span></span><span> </span><span id="local-6989586621681374645"><span class="annot"><span class="annottext">DataCon
</span><a href="#local-6989586621681374645"><span class="hs-identifier hs-var">dc</span></a></span></span><span> </span><span id="local-6989586621681374644"><span class="annot"><span class="annottext">[CoreExpr]
</span><a href="#local-6989586621681374644"><span class="hs-identifier hs-var">args</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-keyword">do</span><span>
</span><span id="line-982"></span><span>      </span><span class="hs-keyword">let</span><span> </span><span id="local-6989586621681374643"><span class="annot"><span class="annottext">dc_ex_tvs :: [Id]
</span><a href="#local-6989586621681374643"><span class="hs-identifier hs-var hs-var">dc_ex_tvs</span></a></span></span><span>              </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">DataCon -&gt; [Id]
</span><a href="GHC.Core.DataCon.html#dataConExTyCoVars"><span class="hs-identifier hs-var">dataConExTyCoVars</span></a></span><span> </span><span class="annot"><span class="annottext">DataCon
</span><a href="#local-6989586621681374645"><span class="hs-identifier hs-var">dc</span></a></span><span>
</span><span id="line-983"></span><span>          </span><span id="local-6989586621681374641"><span class="annot"><span class="annottext">arty :: Int
</span><a href="#local-6989586621681374641"><span class="hs-identifier hs-var hs-var">arty</span></a></span></span><span>                   </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">DataCon -&gt; Int
</span><a href="GHC.Core.DataCon.html#dataConSourceArity"><span class="hs-identifier hs-var">dataConSourceArity</span></a></span><span> </span><span class="annot"><span class="annottext">DataCon
</span><a href="#local-6989586621681374645"><span class="hs-identifier hs-var">dc</span></a></span><span>
</span><span id="line-984"></span><span>          </span><span class="hs-special">(</span><span id="local-6989586621681374639"><span class="annot"><span class="annottext">[CoreExpr]
</span><a href="#local-6989586621681374639"><span class="hs-identifier hs-var">ex_ty_args</span></a></span></span><span class="hs-special">,</span><span> </span><span id="local-6989586621681374638"><span class="annot"><span class="annottext">[CoreExpr]
</span><a href="#local-6989586621681374638"><span class="hs-identifier hs-var">val_args</span></a></span></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">forall b a. [b] -&gt; [a] -&gt; ([a], [a])
</span><a href="GHC.Utils.Misc.html#splitAtList"><span class="hs-identifier hs-var">splitAtList</span></a></span><span> </span><span class="annot"><span class="annottext">[Id]
</span><a href="#local-6989586621681374643"><span class="hs-identifier hs-var">dc_ex_tvs</span></a></span><span> </span><span class="annot"><span class="annottext">[CoreExpr]
</span><a href="#local-6989586621681374644"><span class="hs-identifier hs-var">args</span></a></span><span>
</span><span id="line-985"></span><span>          </span><span id="local-6989586621681374636"><span class="annot"><span class="annottext">ex_tys :: ThetaType
</span><a href="#local-6989586621681374636"><span class="hs-identifier hs-var hs-var">ex_tys</span></a></span></span><span>                 </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">forall a b. (a -&gt; b) -&gt; [a] -&gt; [b]
</span><a href="../../base-4.16.4.0/src/GHC-Base.html#map"><span class="hs-identifier hs-var">map</span></a></span><span> </span><span class="annot"><span class="annottext">CoreExpr -&gt; Type
</span><a href="GHC.Core.html#exprToType"><span class="hs-identifier hs-var">exprToType</span></a></span><span> </span><span class="annot"><span class="annottext">[CoreExpr]
</span><a href="#local-6989586621681374639"><span class="hs-identifier hs-var">ex_ty_args</span></a></span><span>
</span><span id="line-986"></span><span>          </span><span id="local-6989586621681374634"><span class="annot"><span class="annottext">vis_args :: [CoreExpr]
</span><a href="#local-6989586621681374634"><span class="hs-identifier hs-var hs-var">vis_args</span></a></span></span><span>               </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">forall a. [a] -&gt; [a]
</span><a href="../../base-4.16.4.0/src/GHC-List.html#reverse"><span class="hs-identifier hs-var">reverse</span></a></span><span> </span><span class="annot"><span class="annottext">forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><a href="../../base-4.16.4.0/src/GHC-Base.html#%24"><span class="hs-operator hs-var">$</span></a></span><span> </span><span class="annot"><span class="annottext">forall a. Int -&gt; [a] -&gt; [a]
</span><a href="../../base-4.16.4.0/src/GHC-List.html#take"><span class="hs-identifier hs-var">take</span></a></span><span> </span><span class="annot"><span class="annottext">Int
</span><a href="#local-6989586621681374641"><span class="hs-identifier hs-var">arty</span></a></span><span> </span><span class="annot"><span class="annottext">forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><a href="../../base-4.16.4.0/src/GHC-Base.html#%24"><span class="hs-operator hs-var">$</span></a></span><span> </span><span class="annot"><span class="annottext">forall a. [a] -&gt; [a]
</span><a href="../../base-4.16.4.0/src/GHC-List.html#reverse"><span class="hs-identifier hs-var">reverse</span></a></span><span> </span><span class="annot"><span class="annottext">[CoreExpr]
</span><a href="#local-6989586621681374638"><span class="hs-identifier hs-var">val_args</span></a></span><span>
</span><span id="line-987"></span><span>      </span><span id="local-6989586621681374631"><span class="annot"><span class="annottext">UniqSupply
</span><a href="#local-6989586621681374631"><span class="hs-identifier hs-var">uniq_supply</span></a></span></span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">forall (t :: (* -&gt; *) -&gt; * -&gt; *) (m :: * -&gt; *) a.
(MonadTrans t, Monad m) =&gt;
m a -&gt; t m a
</span><a href="../../transformers-0.5.6.2/src/Control-Monad-Trans-Class.html#lift"><span class="hs-identifier hs-var">lift</span></a></span><span> </span><span class="annot"><span class="annottext">forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><a href="../../base-4.16.4.0/src/GHC-Base.html#%24"><span class="hs-operator hs-var">$</span></a></span><span> </span><span class="annot"><span class="annottext">forall (t :: (* -&gt; *) -&gt; * -&gt; *) (m :: * -&gt; *) a.
(MonadTrans t, Monad m) =&gt;
m a -&gt; t m a
</span><a href="../../transformers-0.5.6.2/src/Control-Monad-Trans-Class.html#lift"><span class="hs-identifier hs-var">lift</span></a></span><span> </span><span class="annot"><span class="annottext">forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><a href="../../base-4.16.4.0/src/GHC-Base.html#%24"><span class="hs-operator hs-var">$</span></a></span><span> </span><span class="annot"><span class="annottext">forall (m :: * -&gt; *). MonadUnique m =&gt; m UniqSupply
</span><a href="GHC.Types.Unique.Supply.html#getUniqueSupplyM"><span class="hs-identifier hs-var">getUniqueSupplyM</span></a></span><span>
</span><span id="line-988"></span><span>      </span><span class="hs-keyword">let</span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">TCvSubst
</span><span class="hs-identifier">_</span></span><span class="hs-special">,</span><span> </span><span id="local-6989586621681374629"><span class="annot"><span class="annottext">[Id]
</span><a href="#local-6989586621681374629"><span class="hs-identifier hs-var">ex_tvs</span></a></span></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">TCvSubst -&gt; [Id] -&gt; UniqSupply -&gt; (TCvSubst, [Id])
</span><a href="GHC.Core.TyCo.Subst.html#cloneTyVarBndrs"><span class="hs-identifier hs-var">cloneTyVarBndrs</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">InScopeSet -&gt; TCvSubst
</span><a href="GHC.Core.TyCo.Subst.html#mkEmptyTCvSubst"><span class="hs-identifier hs-var">mkEmptyTCvSubst</span></a></span><span> </span><span class="annot"><span class="annottext">InScopeSet
</span><a href="#local-6989586621681374646"><span class="hs-identifier hs-var">in_scope</span></a></span><span class="hs-special">)</span><span> </span><span class="annot"><span class="annottext">[Id]
</span><a href="#local-6989586621681374643"><span class="hs-identifier hs-var">dc_ex_tvs</span></a></span><span> </span><span class="annot"><span class="annottext">UniqSupply
</span><a href="#local-6989586621681374631"><span class="hs-identifier hs-var">uniq_supply</span></a></span><span>
</span><span id="line-989"></span><span>          </span><span id="local-6989586621681374626"><span class="annot"><span class="annottext">ty_cts :: [PhiCt]
</span><a href="#local-6989586621681374626"><span class="hs-identifier hs-var hs-var">ty_cts</span></a></span></span><span>      </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">ThetaType -&gt; ThetaType -&gt; [PhiCt]
</span><a href="GHC.HsToCore.Pmc.Solver.html#equateTys"><span class="hs-identifier hs-var">equateTys</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">forall a b. (a -&gt; b) -&gt; [a] -&gt; [b]
</span><a href="../../base-4.16.4.0/src/GHC-Base.html#map"><span class="hs-identifier hs-var">map</span></a></span><span> </span><span class="annot"><span class="annottext">Id -&gt; Type
</span><a href="GHC.Core.TyCo.Rep.html#mkTyVarTy"><span class="hs-identifier hs-var">mkTyVarTy</span></a></span><span> </span><span class="annot"><span class="annottext">[Id]
</span><a href="#local-6989586621681374629"><span class="hs-identifier hs-var">ex_tvs</span></a></span><span class="hs-special">)</span><span> </span><span class="annot"><span class="annottext">ThetaType
</span><a href="#local-6989586621681374636"><span class="hs-identifier hs-var">ex_tys</span></a></span><span>
</span><span id="line-990"></span><span>      </span><span class="hs-comment">-- 1. @x &#8769; &#8869;@ if 'K' is not a Newtype constructor (#18341)</span><span>
</span><span id="line-991"></span><span>      </span><span class="annot"><span class="annottext">forall (f :: * -&gt; *). Applicative f =&gt; Bool -&gt; f () -&gt; f ()
</span><a href="../../base-4.16.4.0/src/GHC-Base.html#when"><span class="hs-identifier hs-var">when</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Bool -&gt; Bool
</span><span class="hs-identifier hs-var">not</span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">DataCon -&gt; Bool
</span><a href="GHC.Core.DataCon.html#isNewDataCon"><span class="hs-identifier hs-var">isNewDataCon</span></a></span><span> </span><span class="annot"><span class="annottext">DataCon
</span><a href="#local-6989586621681374645"><span class="hs-identifier hs-var">dc</span></a></span><span class="hs-special">)</span><span class="hs-special">)</span><span> </span><span class="annot"><span class="annottext">forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><a href="../../base-4.16.4.0/src/GHC-Base.html#%24"><span class="hs-operator hs-var">$</span></a></span><span>
</span><span id="line-992"></span><span>        </span><span class="annot"><span class="annottext">forall (m :: * -&gt; *) s. Monad m =&gt; (s -&gt; m s) -&gt; StateT s m ()
</span><a href="GHC.HsToCore.Pmc.Solver.html#modifyT"><span class="hs-identifier hs-var">modifyT</span></a></span><span> </span><span class="annot"><span class="annottext">forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><a href="../../base-4.16.4.0/src/GHC-Base.html#%24"><span class="hs-operator hs-var">$</span></a></span><span> </span><span class="hs-glyph">\</span><span id="local-6989586621681374625"><span class="annot"><span class="annottext">Nabla
</span><a href="#local-6989586621681374625"><span class="hs-identifier hs-var">nabla</span></a></span></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="annottext">Nabla -&gt; Id -&gt; MaybeT (IOEnv (Env DsGblEnv DsLclEnv)) Nabla
</span><a href="GHC.HsToCore.Pmc.Solver.html#addNotBotCt"><span class="hs-identifier hs-var">addNotBotCt</span></a></span><span> </span><span class="annot"><span class="annottext">Nabla
</span><a href="#local-6989586621681374625"><span class="hs-identifier hs-var">nabla</span></a></span><span> </span><span class="annot"><span class="annottext">Id
</span><a href="#local-6989586621681374647"><span class="hs-identifier hs-var">x</span></a></span><span>
</span><span id="line-993"></span><span>      </span><span class="hs-comment">-- 2. @a_1 ~ tau_1, ..., a_n ~ tau_n@ for fresh @a_i@. See also #17703</span><span>
</span><span id="line-994"></span><span>      </span><span class="annot"><span class="annottext">forall (m :: * -&gt; *) s. Monad m =&gt; (s -&gt; m s) -&gt; StateT s m ()
</span><a href="GHC.HsToCore.Pmc.Solver.html#modifyT"><span class="hs-identifier hs-var">modifyT</span></a></span><span> </span><span class="annot"><span class="annottext">forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><a href="../../base-4.16.4.0/src/GHC-Base.html#%24"><span class="hs-operator hs-var">$</span></a></span><span> </span><span class="hs-glyph">\</span><span id="local-6989586621681374624"><span class="annot"><span class="annottext">Nabla
</span><a href="#local-6989586621681374624"><span class="hs-identifier hs-var">nabla</span></a></span></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="annottext">forall (m :: * -&gt; *) a. m (Maybe a) -&gt; MaybeT m a
</span><a href="../../transformers-0.5.6.2/src/Control-Monad-Trans-Maybe.html#MaybeT"><span class="hs-identifier hs-var">MaybeT</span></a></span><span> </span><span class="annot"><span class="annottext">forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><a href="../../base-4.16.4.0/src/GHC-Base.html#%24"><span class="hs-operator hs-var">$</span></a></span><span> </span><span class="annot"><span class="annottext">Nabla -&gt; PhiCts -&gt; IOEnv (Env DsGblEnv DsLclEnv) (Maybe Nabla)
</span><a href="GHC.HsToCore.Pmc.Solver.html#addPhiCts"><span class="hs-identifier hs-var">addPhiCts</span></a></span><span> </span><span class="annot"><span class="annottext">Nabla
</span><a href="#local-6989586621681374624"><span class="hs-identifier hs-var">nabla</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">forall a. [a] -&gt; Bag a
</span><a href="GHC.Data.Bag.html#listToBag"><span class="hs-identifier hs-var">listToBag</span></a></span><span> </span><span class="annot"><span class="annottext">[PhiCt]
</span><a href="#local-6989586621681374626"><span class="hs-identifier hs-var">ty_cts</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-995"></span><span>      </span><span class="hs-comment">-- 3. @y_1 ~ e_1, ..., y_m ~ e_m@ for fresh @y_i@</span><span>
</span><span id="line-996"></span><span>      </span><span id="local-6989586621681374623"><span class="annot"><span class="annottext">[Id]
</span><a href="#local-6989586621681374623"><span class="hs-identifier hs-var">arg_ids</span></a></span></span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">forall (t :: * -&gt; *) (f :: * -&gt; *) a b.
(Traversable t, Applicative f) =&gt;
(a -&gt; f b) -&gt; t a -&gt; f (t b)
</span><a href="../../base-4.16.4.0/src/Data-Traversable.html#traverse"><span class="hs-identifier hs-var">traverse</span></a></span><span> </span><span class="annot"><span class="annottext">CoreExpr
-&gt; StateT Nabla (MaybeT (IOEnv (Env DsGblEnv DsLclEnv))) Id
</span><a href="#local-6989586621681374650"><span class="hs-identifier hs-var">bind_expr</span></a></span><span> </span><span class="annot"><span class="annottext">[CoreExpr]
</span><a href="#local-6989586621681374634"><span class="hs-identifier hs-var">vis_args</span></a></span><span>
</span><span id="line-997"></span><span>      </span><span class="hs-comment">-- 4. @x ~ K as ys@</span><span>
</span><span id="line-998"></span><span>      </span><span class="annot"><span class="annottext">Id
-&gt; PmAltCon
-&gt; [Id]
-&gt; [Id]
-&gt; StateT Nabla (MaybeT (IOEnv (Env DsGblEnv DsLclEnv))) ()
</span><a href="#local-6989586621681374622"><span class="hs-identifier hs-var">pm_alt_con_app</span></a></span><span> </span><span class="annot"><span class="annottext">Id
</span><a href="#local-6989586621681374647"><span class="hs-identifier hs-var">x</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">ConLike -&gt; PmAltCon
</span><a href="GHC.HsToCore.Pmc.Solver.Types.html#PmAltConLike"><span class="hs-identifier hs-var">PmAltConLike</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">DataCon -&gt; ConLike
</span><a href="GHC.Core.ConLike.html#RealDataCon"><span class="hs-identifier hs-var">RealDataCon</span></a></span><span> </span><span class="annot"><span class="annottext">DataCon
</span><a href="#local-6989586621681374645"><span class="hs-identifier hs-var">dc</span></a></span><span class="hs-special">)</span><span class="hs-special">)</span><span> </span><span class="annot"><span class="annottext">[Id]
</span><a href="#local-6989586621681374629"><span class="hs-identifier hs-var">ex_tvs</span></a></span><span> </span><span class="annot"><span class="annottext">[Id]
</span><a href="#local-6989586621681374623"><span class="hs-identifier hs-var">arg_ids</span></a></span><span>
</span><span id="line-999"></span><span>
</span><span id="line-1000"></span><span>    </span><span class="hs-comment">-- | Adds a literal constraint, i.e. @x ~ 42@.</span><span>
</span><span id="line-1001"></span><span>    </span><span class="hs-comment">-- Also we assume that literal expressions won't diverge, so this</span><span>
</span><span id="line-1002"></span><span>    </span><span class="hs-comment">-- will add a @x ~/ &#8869;@ constraint.</span><span>
</span><span id="line-1003"></span><span>    </span><span class="annot"><a href="#local-6989586621681374674"><span class="hs-identifier hs-type">pm_lit</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><a href="GHC.Types.Var.html#Id"><span class="hs-identifier hs-type">Id</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="GHC.HsToCore.Pmc.Solver.Types.html#PmLit"><span class="hs-identifier hs-type">PmLit</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="../../transformers-0.5.6.2/src/Control-Monad-Trans-State-Strict.html#StateT"><span class="hs-identifier hs-type">StateT</span></a></span><span> </span><span class="annot"><a href="GHC.HsToCore.Pmc.Solver.Types.html#Nabla"><span class="hs-identifier hs-type">Nabla</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="../../transformers-0.5.6.2/src/Control-Monad-Trans-Maybe.html#MaybeT"><span class="hs-identifier hs-type">MaybeT</span></a></span><span> </span><span class="annot"><a href="GHC.HsToCore.Types.html#DsM"><span class="hs-identifier hs-type">DsM</span></a></span><span class="hs-special">)</span><span> </span><span class="hs-special">(</span><span class="hs-special">)</span><span>
</span><span id="line-1004"></span><span>    </span><span id="local-6989586621681374674"><span class="annot"><span class="annottext">pm_lit :: Id
-&gt; PmLit
-&gt; StateT Nabla (MaybeT (IOEnv (Env DsGblEnv DsLclEnv))) ()
</span><a href="#local-6989586621681374674"><span class="hs-identifier hs-var hs-var">pm_lit</span></a></span></span><span> </span><span id="local-6989586621681374621"><span class="annot"><span class="annottext">Id
</span><a href="#local-6989586621681374621"><span class="hs-identifier hs-var">x</span></a></span></span><span> </span><span id="local-6989586621681374620"><span class="annot"><span class="annottext">PmLit
</span><a href="#local-6989586621681374620"><span class="hs-identifier hs-var">lit</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-keyword">do</span><span>
</span><span id="line-1005"></span><span>      </span><span class="annot"><span class="annottext">forall (m :: * -&gt; *) s. Monad m =&gt; (s -&gt; m s) -&gt; StateT s m ()
</span><a href="GHC.HsToCore.Pmc.Solver.html#modifyT"><span class="hs-identifier hs-var">modifyT</span></a></span><span> </span><span class="annot"><span class="annottext">forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><a href="../../base-4.16.4.0/src/GHC-Base.html#%24"><span class="hs-operator hs-var">$</span></a></span><span> </span><span class="hs-glyph">\</span><span id="local-6989586621681374619"><span class="annot"><span class="annottext">Nabla
</span><a href="#local-6989586621681374619"><span class="hs-identifier hs-var">nabla</span></a></span></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="annottext">Nabla -&gt; Id -&gt; MaybeT (IOEnv (Env DsGblEnv DsLclEnv)) Nabla
</span><a href="GHC.HsToCore.Pmc.Solver.html#addNotBotCt"><span class="hs-identifier hs-var">addNotBotCt</span></a></span><span> </span><span class="annot"><span class="annottext">Nabla
</span><a href="#local-6989586621681374619"><span class="hs-identifier hs-var">nabla</span></a></span><span> </span><span class="annot"><span class="annottext">Id
</span><a href="#local-6989586621681374621"><span class="hs-identifier hs-var">x</span></a></span><span>
</span><span id="line-1006"></span><span>      </span><span class="annot"><span class="annottext">Id
-&gt; PmAltCon
-&gt; [Id]
-&gt; [Id]
-&gt; StateT Nabla (MaybeT (IOEnv (Env DsGblEnv DsLclEnv))) ()
</span><a href="#local-6989586621681374622"><span class="hs-identifier hs-var">pm_alt_con_app</span></a></span><span> </span><span class="annot"><span class="annottext">Id
</span><a href="#local-6989586621681374621"><span class="hs-identifier hs-var">x</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">PmLit -&gt; PmAltCon
</span><a href="GHC.HsToCore.Pmc.Solver.Types.html#PmAltLit"><span class="hs-identifier hs-var">PmAltLit</span></a></span><span> </span><span class="annot"><span class="annottext">PmLit
</span><a href="#local-6989586621681374620"><span class="hs-identifier hs-var">lit</span></a></span><span class="hs-special">)</span><span> </span><span class="hs-special">[</span><span class="hs-special">]</span><span> </span><span class="hs-special">[</span><span class="hs-special">]</span><span>
</span><span id="line-1007"></span><span>
</span><span id="line-1008"></span><span>    </span><span class="hs-comment">-- | Adds the given constructor application as a solution for @x@.</span><span>
</span><span id="line-1009"></span><span>    </span><span class="annot"><a href="#local-6989586621681374622"><span class="hs-identifier hs-type">pm_alt_con_app</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><a href="GHC.Types.Var.html#Id"><span class="hs-identifier hs-type">Id</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="GHC.HsToCore.Pmc.Solver.Types.html#PmAltCon"><span class="hs-identifier hs-type">PmAltCon</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-special">[</span><span class="annot"><a href="GHC.Types.Var.html#TyVar"><span class="hs-identifier hs-type">TyVar</span></a></span><span class="hs-special">]</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-special">[</span><span class="annot"><a href="GHC.Types.Var.html#Id"><span class="hs-identifier hs-type">Id</span></a></span><span class="hs-special">]</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="../../transformers-0.5.6.2/src/Control-Monad-Trans-State-Strict.html#StateT"><span class="hs-identifier hs-type">StateT</span></a></span><span> </span><span class="annot"><a href="GHC.HsToCore.Pmc.Solver.Types.html#Nabla"><span class="hs-identifier hs-type">Nabla</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="../../transformers-0.5.6.2/src/Control-Monad-Trans-Maybe.html#MaybeT"><span class="hs-identifier hs-type">MaybeT</span></a></span><span> </span><span class="annot"><a href="GHC.HsToCore.Types.html#DsM"><span class="hs-identifier hs-type">DsM</span></a></span><span class="hs-special">)</span><span> </span><span class="hs-special">(</span><span class="hs-special">)</span><span>
</span><span id="line-1010"></span><span>    </span><span id="local-6989586621681374622"><span class="annot"><span class="annottext">pm_alt_con_app :: Id
-&gt; PmAltCon
-&gt; [Id]
-&gt; [Id]
-&gt; StateT Nabla (MaybeT (IOEnv (Env DsGblEnv DsLclEnv))) ()
</span><a href="#local-6989586621681374622"><span class="hs-identifier hs-var hs-var">pm_alt_con_app</span></a></span></span><span> </span><span id="local-6989586621681374618"><span class="annot"><span class="annottext">Id
</span><a href="#local-6989586621681374618"><span class="hs-identifier hs-var">x</span></a></span></span><span> </span><span id="local-6989586621681374617"><span class="annot"><span class="annottext">PmAltCon
</span><a href="#local-6989586621681374617"><span class="hs-identifier hs-var">con</span></a></span></span><span> </span><span id="local-6989586621681374616"><span class="annot"><span class="annottext">[Id]
</span><a href="#local-6989586621681374616"><span class="hs-identifier hs-var">tvs</span></a></span></span><span> </span><span id="local-6989586621681374615"><span class="annot"><span class="annottext">[Id]
</span><a href="#local-6989586621681374615"><span class="hs-identifier hs-var">args</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">forall (m :: * -&gt; *) s. Monad m =&gt; (s -&gt; m s) -&gt; StateT s m ()
</span><a href="GHC.HsToCore.Pmc.Solver.html#modifyT"><span class="hs-identifier hs-var">modifyT</span></a></span><span> </span><span class="annot"><span class="annottext">forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><a href="../../base-4.16.4.0/src/GHC-Base.html#%24"><span class="hs-operator hs-var">$</span></a></span><span> </span><span class="hs-glyph">\</span><span id="local-6989586621681374614"><span class="annot"><span class="annottext">Nabla
</span><a href="#local-6989586621681374614"><span class="hs-identifier hs-var">nabla</span></a></span></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="annottext">Nabla
-&gt; Id
-&gt; PmAltCon
-&gt; [Id]
-&gt; [Id]
-&gt; MaybeT (IOEnv (Env DsGblEnv DsLclEnv)) Nabla
</span><a href="GHC.HsToCore.Pmc.Solver.html#addConCt"><span class="hs-identifier hs-var">addConCt</span></a></span><span> </span><span class="annot"><span class="annottext">Nabla
</span><a href="#local-6989586621681374614"><span class="hs-identifier hs-var">nabla</span></a></span><span> </span><span class="annot"><span class="annottext">Id
</span><a href="#local-6989586621681374618"><span class="hs-identifier hs-var">x</span></a></span><span> </span><span class="annot"><span class="annottext">PmAltCon
</span><a href="#local-6989586621681374617"><span class="hs-identifier hs-var">con</span></a></span><span> </span><span class="annot"><span class="annottext">[Id]
</span><a href="#local-6989586621681374616"><span class="hs-identifier hs-var">tvs</span></a></span><span> </span><span class="annot"><span class="annottext">[Id]
</span><a href="#local-6989586621681374615"><span class="hs-identifier hs-var">args</span></a></span><span>
</span><span id="line-1011"></span><span>
</span><span id="line-1012"></span><span class="hs-comment">-- | Finds a representant of the semantic equality class of the given @e@.</span><span>
</span><span id="line-1013"></span><span class="hs-comment">-- Which is the @x@ of a @let x = e'@ constraint (with @e@ semantically</span><span>
</span><span id="line-1014"></span><span class="hs-comment">-- equivalent to @e'@) we encountered earlier, or a fresh identifier if</span><span>
</span><span id="line-1015"></span><span class="hs-comment">-- there weren't any such constraints.</span><span>
</span><span id="line-1016"></span><span class="annot"><a href="GHC.HsToCore.Pmc.Solver.html#representCoreExpr"><span class="hs-identifier hs-type">representCoreExpr</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><a href="GHC.HsToCore.Pmc.Solver.Types.html#Nabla"><span class="hs-identifier hs-type">Nabla</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="GHC.Core.html#CoreExpr"><span class="hs-identifier hs-type">CoreExpr</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="GHC.HsToCore.Types.html#DsM"><span class="hs-identifier hs-type">DsM</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="GHC.Types.Var.html#Id"><span class="hs-identifier hs-type">Id</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><a href="GHC.HsToCore.Pmc.Solver.Types.html#Nabla"><span class="hs-identifier hs-type">Nabla</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-1017"></span><span id="representCoreExpr"><span class="annot"><span class="annottext">representCoreExpr :: Nabla -&gt; CoreExpr -&gt; DsM (Id, Nabla)
</span><a href="GHC.HsToCore.Pmc.Solver.html#representCoreExpr"><span class="hs-identifier hs-var hs-var">representCoreExpr</span></a></span></span><span> </span><span id="local-6989586621681374613"><span class="annot"><span class="annottext">nabla :: Nabla
</span><a href="#local-6989586621681374613"><span class="hs-identifier hs-var">nabla</span></a></span></span><span class="hs-glyph">@</span><span class="annot"><a href="GHC.HsToCore.Pmc.Solver.Types.html#MkNabla"><span class="hs-identifier hs-type">MkNabla</span></a></span><span class="hs-special">{</span><span> </span><span class="annot"><span class="annottext">nabla_tm_st :: Nabla -&gt; TmState
</span><a href="GHC.HsToCore.Pmc.Solver.Types.html#nabla_tm_st"><span class="hs-identifier hs-var">nabla_tm_st</span></a></span><span> </span><span class="hs-glyph">=</span><span> </span><span id="local-6989586621681374612"><span class="annot"><span class="annottext">ts :: TmState
</span><a href="#local-6989586621681374612"><span class="hs-identifier hs-var">ts</span></a></span></span><span class="hs-glyph">@</span><span class="annot"><a href="GHC.HsToCore.Pmc.Solver.Types.html#TmSt"><span class="hs-identifier hs-type">TmSt</span></a></span><span class="hs-special">{</span><span> </span><span class="annot"><span class="annottext">ts_reps :: TmState -&gt; CoreMap Id
</span><a href="GHC.HsToCore.Pmc.Solver.Types.html#ts_reps"><span class="hs-identifier hs-var">ts_reps</span></a></span><span> </span><span class="hs-glyph">=</span><span> </span><span id="local-6989586621681374610"><span class="annot"><span class="annottext">CoreMap Id
</span><a href="#local-6989586621681374610"><span class="hs-identifier hs-var">reps</span></a></span></span><span> </span><span class="hs-special">}</span><span> </span><span class="hs-special">}</span><span> </span><span id="local-6989586621681374609"><span class="annot"><span class="annottext">CoreExpr
</span><a href="#local-6989586621681374609"><span class="hs-identifier hs-var">e</span></a></span></span><span>
</span><span id="line-1018"></span><span>  </span><span class="hs-glyph">|</span><span> </span><span class="annot"><a href="../../base-4.16.4.0/src/GHC-Maybe.html#Just"><span class="hs-identifier hs-type">Just</span></a></span><span> </span><span id="local-6989586621681374608"><span class="annot"><span class="annottext">Id
</span><a href="#local-6989586621681374608"><span class="hs-identifier hs-var">rep</span></a></span></span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">forall a. CoreMap a -&gt; CoreExpr -&gt; Maybe a
</span><a href="GHC.Core.Map.Expr.html#lookupCoreMap"><span class="hs-identifier hs-var">lookupCoreMap</span></a></span><span> </span><span class="annot"><span class="annottext">CoreMap Id
</span><a href="#local-6989586621681374610"><span class="hs-identifier hs-var">reps</span></a></span><span> </span><span class="annot"><span class="annottext">CoreExpr
</span><a href="#local-6989586621681374609"><span class="hs-identifier hs-var">e</span></a></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">forall (f :: * -&gt; *) a. Applicative f =&gt; a -&gt; f a
</span><a href="../../base-4.16.4.0/src/GHC-Base.html#pure"><span class="hs-identifier hs-var">pure</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Id
</span><a href="#local-6989586621681374608"><span class="hs-identifier hs-var">rep</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">Nabla
</span><a href="#local-6989586621681374613"><span class="hs-identifier hs-var">nabla</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-1019"></span><span>  </span><span class="hs-glyph">|</span><span> </span><span class="annot"><span class="annottext">Bool
</span><a href="../../base-4.16.4.0/src/GHC-Base.html#otherwise"><span class="hs-identifier hs-var">otherwise</span></a></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-keyword">do</span><span>
</span><span id="line-1020"></span><span>      </span><span id="local-6989586621681374606"><span class="annot"><span class="annottext">Id
</span><a href="#local-6989586621681374606"><span class="hs-identifier hs-var">rep</span></a></span></span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">Type -&gt; DsM Id
</span><a href="GHC.HsToCore.Pmc.Utils.html#mkPmId"><span class="hs-identifier hs-var">mkPmId</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">CoreExpr -&gt; Type
</span><a href="GHC.Core.Utils.html#exprType"><span class="hs-identifier hs-var">exprType</span></a></span><span> </span><span class="annot"><span class="annottext">CoreExpr
</span><a href="#local-6989586621681374609"><span class="hs-identifier hs-var">e</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-1021"></span><span>      </span><span class="hs-keyword">let</span><span> </span><span id="local-6989586621681374605"><span class="annot"><span class="annottext">reps' :: CoreMap Id
</span><a href="#local-6989586621681374605"><span class="hs-identifier hs-var hs-var">reps'</span></a></span></span><span>  </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">forall a. CoreMap a -&gt; CoreExpr -&gt; a -&gt; CoreMap a
</span><a href="GHC.Core.Map.Expr.html#extendCoreMap"><span class="hs-identifier hs-var">extendCoreMap</span></a></span><span> </span><span class="annot"><span class="annottext">CoreMap Id
</span><a href="#local-6989586621681374610"><span class="hs-identifier hs-var">reps</span></a></span><span> </span><span class="annot"><span class="annottext">CoreExpr
</span><a href="#local-6989586621681374609"><span class="hs-identifier hs-var">e</span></a></span><span> </span><span class="annot"><span class="annottext">Id
</span><a href="#local-6989586621681374606"><span class="hs-identifier hs-var">rep</span></a></span><span>
</span><span id="line-1022"></span><span>      </span><span class="hs-keyword">let</span><span> </span><span id="local-6989586621681374603"><span class="annot"><span class="annottext">nabla' :: Nabla
</span><a href="#local-6989586621681374603"><span class="hs-identifier hs-var hs-var">nabla'</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">Nabla
</span><a href="#local-6989586621681374613"><span class="hs-identifier hs-var">nabla</span></a></span><span class="hs-special">{</span><span> </span><span class="annot"><span class="annottext">nabla_tm_st :: TmState
</span><a href="GHC.HsToCore.Pmc.Solver.Types.html#nabla_tm_st"><span class="hs-identifier hs-var">nabla_tm_st</span></a></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">TmState
</span><a href="#local-6989586621681374612"><span class="hs-identifier hs-var">ts</span></a></span><span class="hs-special">{</span><span> </span><span class="annot"><span class="annottext">ts_reps :: CoreMap Id
</span><a href="GHC.HsToCore.Pmc.Solver.Types.html#ts_reps"><span class="hs-identifier hs-var">ts_reps</span></a></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">CoreMap Id
</span><a href="#local-6989586621681374605"><span class="hs-identifier hs-var">reps'</span></a></span><span> </span><span class="hs-special">}</span><span> </span><span class="hs-special">}</span><span>
</span><span id="line-1023"></span><span>      </span><span class="annot"><span class="annottext">forall (f :: * -&gt; *) a. Applicative f =&gt; a -&gt; f a
</span><a href="../../base-4.16.4.0/src/GHC-Base.html#pure"><span class="hs-identifier hs-var">pure</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Id
</span><a href="#local-6989586621681374606"><span class="hs-identifier hs-var">rep</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">Nabla
</span><a href="#local-6989586621681374603"><span class="hs-identifier hs-var">nabla'</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-1024"></span><span>
</span><span id="line-1025"></span><span class="hs-comment">-- | Like 'modify', but with an effectful modifier action</span><span>
</span><span id="line-1026"></span><span id="local-6989586621681375706"><span id="local-6989586621681375707"><span class="annot"><a href="GHC.HsToCore.Pmc.Solver.html#modifyT"><span class="hs-identifier hs-type">modifyT</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><a href="../../base-4.16.4.0/src/GHC-Base.html#Monad"><span class="hs-identifier hs-type">Monad</span></a></span><span> </span><span class="annot"><a href="#local-6989586621681375707"><span class="hs-identifier hs-type">m</span></a></span><span> </span><span class="hs-glyph">=&gt;</span><span> </span><span class="hs-special">(</span><span class="annot"><a href="#local-6989586621681375706"><span class="hs-identifier hs-type">s</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="#local-6989586621681375707"><span class="hs-identifier hs-type">m</span></a></span><span> </span><span class="annot"><a href="#local-6989586621681375706"><span class="hs-identifier hs-type">s</span></a></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="../../transformers-0.5.6.2/src/Control-Monad-Trans-State-Strict.html#StateT"><span class="hs-identifier hs-type">StateT</span></a></span><span> </span><span class="annot"><a href="#local-6989586621681375706"><span class="hs-identifier hs-type">s</span></a></span><span> </span><span class="annot"><a href="#local-6989586621681375707"><span class="hs-identifier hs-type">m</span></a></span><span> </span><span class="hs-special">(</span><span class="hs-special">)</span></span></span><span>
</span><span id="line-1027"></span><span id="modifyT"><span class="annot"><span class="annottext">modifyT :: forall (m :: * -&gt; *) s. Monad m =&gt; (s -&gt; m s) -&gt; StateT s m ()
</span><a href="GHC.HsToCore.Pmc.Solver.html#modifyT"><span class="hs-identifier hs-var hs-var">modifyT</span></a></span></span><span> </span><span id="local-6989586621681374598"><span class="annot"><span class="annottext">s -&gt; m s
</span><a href="#local-6989586621681374598"><span class="hs-identifier hs-var">f</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">forall s (m :: * -&gt; *) a. (s -&gt; m (a, s)) -&gt; StateT s m a
</span><a href="../../transformers-0.5.6.2/src/Control-Monad-Trans-State-Strict.html#StateT"><span class="hs-identifier hs-var">StateT</span></a></span><span> </span><span class="annot"><span class="annottext">forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><a href="../../base-4.16.4.0/src/GHC-Base.html#%24"><span class="hs-operator hs-var">$</span></a></span><span> </span><span class="annot"><span class="annottext">forall (f :: * -&gt; *) a b. Functor f =&gt; (a -&gt; b) -&gt; f a -&gt; f b
</span><a href="../../base-4.16.4.0/src/GHC-Base.html#fmap"><span class="hs-identifier hs-var">fmap</span></a></span><span> </span><span class="hs-special">(</span><span class="hs-special">(</span><span class="hs-special">,</span><span class="hs-special">)</span><span> </span><span class="hs-special">(</span><span class="hs-special">)</span><span class="hs-special">)</span><span> </span><span class="annot"><span class="annottext">forall b c a. (b -&gt; c) -&gt; (a -&gt; b) -&gt; a -&gt; c
</span><a href="../../base-4.16.4.0/src/GHC-Base.html#."><span class="hs-operator hs-var">.</span></a></span><span> </span><span class="annot"><span class="annottext">s -&gt; m s
</span><a href="#local-6989586621681374598"><span class="hs-identifier hs-var">f</span></a></span><span>
</span><span id="line-1028"></span><span>
</span><span id="line-1029"></span><span class="hs-comment">{- Note [The Pos/Neg invariant]
~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~
Invariant applying to each VarInfo: Whenever we have @C @tvs args@ in 'vi_pos',
any entry in 'vi_neg' must be incomparable to C (return Nothing) according to
'eqPmAltCons'. Those entries that are comparable either lead to a refutation
or are redundant. Examples:
* @x ~ Just y@, @x &#8769; [Just]@. 'eqPmAltCon' returns @Equal@, so refute.
* @x ~ Nothing@, @x &#8769; [Just]@. 'eqPmAltCon' returns @Disjoint@, so negative
  info is redundant and should be discarded.
* @x ~ I# y@, @x &#8769; [4,2]@. 'eqPmAltCon' returns @PossiblyOverlap@, so orthogal.
  We keep this info in order to be able to refute a redundant match on i.e. 4
  later on.

This carries over to pattern synonyms and overloaded literals. Say, we have
    pattern Just42 = Just 42
    case Just42 of x
      Nothing -&gt; ()
      Just _  -&gt; ()
Even though we had a solution for the value abstraction called x here in form
of a PatSynCon Just42, this solution is incomparable to both Nothing and
Just. Hence we retain the info in vi_neg, which eventually allows us to detect
the complete pattern match.

The Pos/Neg invariant extends to vi_rcm, which essentially stores positive
information. We make sure that vi_neg and vi_rcm never overlap. This isn't
strictly necessary since vi_rcm is just a cache, so doesn't need to be
accurate: Every suggestion of a possible ConLike from vi_rcm might be
refutable by the type oracle anyway. But it helps to maintain sanity while
debugging traces.

Note [Why record both positive and negative info?]
~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~
You might think that knowing positive info (like x ~ Just y) would render
negative info irrelevant, but not so because of pattern synonyms.  E.g we might
know that x cannot match (Foo 4), where pattern Foo p = Just p

Also overloaded literals themselves behave like pattern synonyms. E.g if
postively we know that (x ~ I# y), we might also negatively want to record that
x does not match 45 f 45       = e2 f (I# 22#) = e3 f 45       = e4  --
Overlapped

Note [TmState invariants]
~~~~~~~~~~~~~~~~~~~~~~~~~
The term oracle state is never obviously (i.e., without consulting the type
oracle or doing inhabitation testing) contradictory. This implies a few
invariants:
* Whenever vi_pos overlaps with vi_neg according to 'eqPmAltCon', we refute.
  This is implied by the Note [Pos/Neg invariant].
* Whenever vi_neg subsumes a COMPLETE set, we refute. We consult vi_rcm to
  detect this, but we could just compare whole COMPLETE sets to vi_neg every
  time, if it weren't for performance.

Maintaining these invariants in 'addVarCt' (the core of the term oracle) and
'addNotConCt' is subtle.
* Merging VarInfos. Example: Add the fact @x ~ y@ (see 'equate').
  - (COMPLETE) If we had @x &#8769; True@ and @y &#8769; False@, then we get
    @x &#8769; [True,False]@. This is vacuous by matter of comparing to the built-in
    COMPLETE set, so should refute.
  - (Pos/Neg) If we had @x &#8769; True@ and @y ~ True@, we have to refute.
* Adding positive information. Example: Add the fact @x ~ K ys@ (see 'addConCt')
  - (Neg) If we had @x &#8769; K@, refute.
  - (Pos) If we had @x ~ K2@, and that contradicts the new solution according to
    'eqPmAltCon' (ex. K2 is [] and K is (:)), then refute.
  - (Refine) If we had @x &#8769; K zs@, unify each y with each z in turn.
* Adding negative information. Example: Add the fact @x &#8769; Nothing@ (see 'addNotConCt')
  - (Refut) If we have @x ~ K ys@, refute.
  - (COMPLETE) If K=Nothing and we had @x &#8769; Just@, then we get
    @x &#8769; [Just,Nothing]@. This is vacuous by matter of comparing to the built-in
    COMPLETE set, so should refute.

Note that merging VarInfo in equate can be done by calling out to 'addConCt' and
'addNotConCt' for each of the facts individually.

Note [Representation of Strings in TmState]
~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~
Instead of treating regular String literals as a PmLits, we treat it as a list
of characters in the oracle for better overlap reasoning. The following example
shows why:

  f :: String -&gt; ()
  f ('f':_) = ()
  f &quot;foo&quot;   = ()
  f _       = ()

The second case is redundant, and we like to warn about it. Therefore either
the oracle will have to do some smart conversion between the list and literal
representation or treat is as the list it really is at runtime.

The &quot;smart conversion&quot; has the advantage of leveraging the more compact literal
representation wherever possible, but is really nasty to get right with negative
equalities: Just think of how to encode @x /= &quot;foo&quot;@.
The &quot;list&quot; option is far simpler, but incurs some overhead in representation and
warning messages (which can be alleviated by someone with enough dedication).

Note [Detecting pattern synonym applications in expressions]
~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~
At the moment we fail to detect pattern synonyms in scrutinees and RHS of
guards. This could be alleviated with considerable effort and complexity, but
the returns are meager. Consider:

    pattern P
    pattern Q
    case P 15 of
      Q _  -&gt; ...
      P 15 -&gt;

Compared to the situation where P and Q are DataCons, the lack of generativity
means we could never flag Q as redundant. (also see Note [Undecidable Equality
for PmAltCons] in PmTypes.) On the other hand, if we fail to recognise the
pattern synonym, we flag the pattern match as inexhaustive. That wouldn't happen
if we had knowledge about the scrutinee, in which case the oracle basically
knows &quot;If it's a P, then its field is 15&quot;.

This is a pretty narrow use case and I don't think we should to try to fix it
until a user complains energetically.

Note [Completeness checking with required Thetas]
~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~
Consider the situation in #11224

    import Text.Read (readMaybe)
    pattern PRead :: Read a =&gt; () =&gt; a -&gt; String
    pattern PRead x &lt;- (readMaybe -&gt; Just x)
    f :: String -&gt; Int
    f (PRead x)  = x
    f (PRead xs) = length xs
    f _          = 0

Is the first match exhaustive on the PRead synonym? Should the second line thus
deemed redundant? The answer is, of course, No! The required theta is like a
hidden parameter which must be supplied at the pattern match site, so PRead
is much more like a view pattern (where behavior depends on the particular value
passed in).
The simple solution here is to forget in 'addNotConCt' that we matched
on synonyms with a required Theta like @PRead@, so that subsequent matches on
the same constructor are never flagged as redundant. The consequence is that
we no longer detect the actually redundant match in

    g :: String -&gt; Int
    g (PRead x) = x
    g (PRead y) = y -- redundant!
    g _         = 0

But that's a small price to pay, compared to the proper solution here involving
storing required arguments along with the PmAltConLike in 'vi_neg'.

Note [Strict fields and variables of unlifted type]
~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~
Binders of unlifted type (and strict fields) are unlifted by construction;
they are conceived with an implicit (but delayed checked) @&#8769;&#8869;@ constraint to
begin with. Hence, desugaring in &quot;GHC.HsToCore.Pmc&quot; is entirely unconcerned
by strict fields, since the forcing happens *before* pattern matching. And
the &#966; constructor constraints emitted by 'GHC.HsToCore.Pmc.checkGrd' have
complex binding semantics (binding type constraints and unlifted fields), so
unliftedness semantics are entirely confined to the oracle.

These are the moving parts:

  1.  For each strict (or more generally, unlifted) field @s@ of a 'PhiConCt'
      we have to add a @s &#8769; &#8869;@ constraint in the corresponding case of
      'addPhiTmCt'. Strict fields are devoid of &#8869; by construction, there's
      nothing that a bang pattern would act on. Example from #18341:

        data T = MkT !Int
        f :: T -&gt; ()
        f (MkT  _) | False = () -- inaccessible
        f (MkT !_) | False = () -- redundant, not only inaccessible!
        f _                = ()

      The second clause desugars to @MkT n &lt;- x, !n@. When coverage checked,
      the 'PmCon' @MkT n &lt;- x@ refines the set of values that reach the bang
      pattern with the &#966; constraints @MkT n &lt;- x@ (Nothing surprising so far).
      Upon that constraint, it disperses into two lower-level &#948; constraints
      @x ~ MkT n, n &#8769; &#8869;@ per Equation (3) in Figure 7 of the paper.

      Checking the 'PmBang' @!n@ will then try to add the
      constraint @n ~ &#8869;@ to this set to get the diverging set, which is found
      to be empty. Hence the whole clause is detected as redundant, as
      expected.

  2.  Similarly, when performing the 'inhabitationTest', when instantiating a
      constructor we call 'instCon', which generates a higher-level &#966;
      constructor constraint.

  3.  The preceding points handle unlifted constructor fields, but there also
      are regular binders of unlifted type. We simply fail in 'addBotCt' for
      any binder of unlifted type.
      It would be enough to check for unliftedness once, when the binder comes
      into scope, but we haven't really a way to track that.

  4.  Why not start an 'emptyVarInfo' of unlifted type with @vi_bot = IsNotBot@?
      Because then we'd need to trigger an inhabitation test, because the var
      might actually be void to begin with. But we can't trigger the test from
      'emptyVarInfo'.
      Historically, that is what we did and not doing the test led to #20631,
      where 'addNotBotCt' trivially succeeded, because the 'VarInfo' already
      said 'IsNotBot', implying that a prior inhabitation test succeeded.
-}</span><span>
</span><span id="line-1227"></span><span>
</span><span id="line-1228"></span><span class="hs-comment">-------------------------</span><span>
</span><span id="line-1229"></span><span class="hs-comment">-- * Inhabitation testing</span><span>
</span><span id="line-1230"></span><span class="hs-comment">--</span><span>
</span><span id="line-1231"></span><span class="hs-comment">-- Figure 8 in the LYG paper.</span><span>
</span><span id="line-1232"></span><span>
</span><span id="line-1233"></span><span class="annot"><a href="GHC.HsToCore.Pmc.Solver.html#tyStateRefined"><span class="hs-identifier hs-type">tyStateRefined</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><a href="GHC.HsToCore.Pmc.Solver.Types.html#TyState"><span class="hs-identifier hs-type">TyState</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="GHC.HsToCore.Pmc.Solver.Types.html#TyState"><span class="hs-identifier hs-type">TyState</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="hs-identifier hs-type">Bool</span></span><span>
</span><span id="line-1234"></span><span class="hs-comment">-- Makes use of the fact that the two TyStates we compare will never have the</span><span>
</span><span id="line-1235"></span><span class="hs-comment">-- same sequence number. It is invalid to call this function when a is not a</span><span>
</span><span id="line-1236"></span><span class="hs-comment">-- refinement of b or vice versa!</span><span>
</span><span id="line-1237"></span><span id="tyStateRefined"><span class="annot"><span class="annottext">tyStateRefined :: TyState -&gt; TyState -&gt; Bool
</span><a href="GHC.HsToCore.Pmc.Solver.html#tyStateRefined"><span class="hs-identifier hs-var hs-var">tyStateRefined</span></a></span></span><span> </span><span id="local-6989586621681374596"><span class="annot"><span class="annottext">TyState
</span><a href="#local-6989586621681374596"><span class="hs-identifier hs-var">a</span></a></span></span><span> </span><span id="local-6989586621681374595"><span class="annot"><span class="annottext">TyState
</span><a href="#local-6989586621681374595"><span class="hs-identifier hs-var">b</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">TyState -&gt; Int
</span><a href="GHC.HsToCore.Pmc.Solver.Types.html#ty_st_n"><span class="hs-identifier hs-var">ty_st_n</span></a></span><span> </span><span class="annot"><span class="annottext">TyState
</span><a href="#local-6989586621681374596"><span class="hs-identifier hs-var">a</span></a></span><span> </span><span class="annot"><span class="annottext">forall a. Eq a =&gt; a -&gt; a -&gt; Bool
</span><span class="hs-operator hs-var">/=</span></span><span> </span><span class="annot"><span class="annottext">TyState -&gt; Int
</span><a href="GHC.HsToCore.Pmc.Solver.Types.html#ty_st_n"><span class="hs-identifier hs-var">ty_st_n</span></a></span><span> </span><span class="annot"><span class="annottext">TyState
</span><a href="#local-6989586621681374595"><span class="hs-identifier hs-var">b</span></a></span><span>
</span><span id="line-1238"></span><span>
</span><span id="line-1239"></span><span class="annot"><a href="GHC.HsToCore.Pmc.Solver.html#markDirty"><span class="hs-identifier hs-type">markDirty</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><a href="GHC.Types.Var.html#Id"><span class="hs-identifier hs-type">Id</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="GHC.HsToCore.Pmc.Solver.Types.html#Nabla"><span class="hs-identifier hs-type">Nabla</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="GHC.HsToCore.Pmc.Solver.Types.html#Nabla"><span class="hs-identifier hs-type">Nabla</span></a></span><span>
</span><span id="line-1240"></span><span id="markDirty"><span class="annot"><span class="annottext">markDirty :: Id -&gt; Nabla -&gt; Nabla
</span><a href="GHC.HsToCore.Pmc.Solver.html#markDirty"><span class="hs-identifier hs-var hs-var">markDirty</span></a></span></span><span> </span><span id="local-6989586621681374593"><span class="annot"><span class="annottext">Id
</span><a href="#local-6989586621681374593"><span class="hs-identifier hs-var">x</span></a></span></span><span> </span><span id="local-6989586621681374592"><span class="annot"><span class="annottext">nabla :: Nabla
</span><a href="#local-6989586621681374592"><span class="hs-identifier hs-var">nabla</span></a></span></span><span class="hs-glyph">@</span><span class="annot"><a href="GHC.HsToCore.Pmc.Solver.Types.html#MkNabla"><span class="hs-identifier hs-type">MkNabla</span></a></span><span class="hs-special">{</span><span class="annot"><span class="annottext">nabla_tm_st :: Nabla -&gt; TmState
</span><a href="GHC.HsToCore.Pmc.Solver.Types.html#nabla_tm_st"><span class="hs-identifier hs-var">nabla_tm_st</span></a></span><span> </span><span class="hs-glyph">=</span><span> </span><span id="local-6989586621681374591"><span class="annot"><span class="annottext">ts :: TmState
</span><a href="#local-6989586621681374591"><span class="hs-identifier hs-var">ts</span></a></span></span><span class="hs-glyph">@</span><span class="annot"><a href="GHC.HsToCore.Pmc.Solver.Types.html#TmSt"><span class="hs-identifier hs-type">TmSt</span></a></span><span class="hs-special">{</span><span class="annot"><span class="annottext">ts_dirty :: TmState -&gt; DIdSet
</span><a href="GHC.HsToCore.Pmc.Solver.Types.html#ts_dirty"><span class="hs-identifier hs-var">ts_dirty</span></a></span><span> </span><span class="hs-glyph">=</span><span> </span><span id="local-6989586621681374589"><span class="annot"><span class="annottext">DIdSet
</span><a href="#local-6989586621681374589"><span class="hs-identifier hs-var">dirty</span></a></span></span><span class="hs-special">}</span><span> </span><span class="hs-special">}</span><span> </span><span class="hs-glyph">=</span><span>
</span><span id="line-1241"></span><span>  </span><span class="annot"><span class="annottext">Nabla
</span><a href="#local-6989586621681374592"><span class="hs-identifier hs-var">nabla</span></a></span><span class="hs-special">{</span><span> </span><span class="annot"><span class="annottext">nabla_tm_st :: TmState
</span><a href="GHC.HsToCore.Pmc.Solver.Types.html#nabla_tm_st"><span class="hs-identifier hs-var">nabla_tm_st</span></a></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">TmState
</span><a href="#local-6989586621681374591"><span class="hs-identifier hs-var">ts</span></a></span><span class="hs-special">{</span><span> </span><span class="annot"><span class="annottext">ts_dirty :: DIdSet
</span><a href="GHC.HsToCore.Pmc.Solver.Types.html#ts_dirty"><span class="hs-identifier hs-var">ts_dirty</span></a></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">DIdSet -&gt; Id -&gt; DIdSet
</span><a href="GHC.Types.Var.Set.html#extendDVarSet"><span class="hs-identifier hs-var">extendDVarSet</span></a></span><span> </span><span class="annot"><span class="annottext">DIdSet
</span><a href="#local-6989586621681374589"><span class="hs-identifier hs-var">dirty</span></a></span><span> </span><span class="annot"><span class="annottext">Id
</span><a href="#local-6989586621681374593"><span class="hs-identifier hs-var">x</span></a></span><span> </span><span class="hs-special">}</span><span> </span><span class="hs-special">}</span><span>
</span><span id="line-1242"></span><span>
</span><span id="line-1243"></span><span id="local-6989586621681375685"><span class="annot"><a href="GHC.HsToCore.Pmc.Solver.html#traverseDirty"><span class="hs-identifier hs-type">traverseDirty</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><a href="../../base-4.16.4.0/src/GHC-Base.html#Monad"><span class="hs-identifier hs-type">Monad</span></a></span><span> </span><span class="annot"><a href="#local-6989586621681375685"><span class="hs-identifier hs-type">m</span></a></span><span> </span><span class="hs-glyph">=&gt;</span><span> </span><span class="hs-special">(</span><span class="annot"><a href="GHC.HsToCore.Pmc.Solver.Types.html#VarInfo"><span class="hs-identifier hs-type">VarInfo</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="#local-6989586621681375685"><span class="hs-identifier hs-type">m</span></a></span><span> </span><span class="annot"><a href="GHC.HsToCore.Pmc.Solver.Types.html#VarInfo"><span class="hs-identifier hs-type">VarInfo</span></a></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="GHC.HsToCore.Pmc.Solver.Types.html#TmState"><span class="hs-identifier hs-type">TmState</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="#local-6989586621681375685"><span class="hs-identifier hs-type">m</span></a></span><span> </span><span class="annot"><a href="GHC.HsToCore.Pmc.Solver.Types.html#TmState"><span class="hs-identifier hs-type">TmState</span></a></span></span><span>
</span><span id="line-1244"></span><span id="traverseDirty"><span class="annot"><span class="annottext">traverseDirty :: forall (m :: * -&gt; *).
Monad m =&gt;
(VarInfo -&gt; m VarInfo) -&gt; TmState -&gt; m TmState
</span><a href="GHC.HsToCore.Pmc.Solver.html#traverseDirty"><span class="hs-identifier hs-var hs-var">traverseDirty</span></a></span></span><span> </span><span id="local-6989586621681374581"><span class="annot"><span class="annottext">VarInfo -&gt; m VarInfo
</span><a href="#local-6989586621681374581"><span class="hs-identifier hs-var">f</span></a></span></span><span> </span><span id="local-6989586621681374580"><span class="annot"><span class="annottext">ts :: TmState
</span><a href="#local-6989586621681374580"><span class="hs-identifier hs-var">ts</span></a></span></span><span class="hs-glyph">@</span><span class="annot"><a href="GHC.HsToCore.Pmc.Solver.Types.html#TmSt"><span class="hs-identifier hs-type">TmSt</span></a></span><span class="hs-special">{</span><span class="annot"><span class="annottext">ts_facts :: TmState -&gt; UniqSDFM Id VarInfo
</span><a href="GHC.HsToCore.Pmc.Solver.Types.html#ts_facts"><span class="hs-identifier hs-var">ts_facts</span></a></span><span> </span><span class="hs-glyph">=</span><span> </span><span id="local-6989586621681374579"><span class="annot"><span class="annottext">UniqSDFM Id VarInfo
</span><a href="#local-6989586621681374579"><span class="hs-identifier hs-var">env</span></a></span></span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">ts_dirty :: TmState -&gt; DIdSet
</span><a href="GHC.HsToCore.Pmc.Solver.Types.html#ts_dirty"><span class="hs-identifier hs-var">ts_dirty</span></a></span><span> </span><span class="hs-glyph">=</span><span> </span><span id="local-6989586621681374578"><span class="annot"><span class="annottext">DIdSet
</span><a href="#local-6989586621681374578"><span class="hs-identifier hs-var">dirty</span></a></span></span><span class="hs-special">}</span><span> </span><span class="hs-glyph">=</span><span>
</span><span id="line-1245"></span><span>  </span><span class="annot"><span class="annottext">[Id] -&gt; UniqSDFM Id VarInfo -&gt; m TmState
</span><a href="#local-6989586621681374577"><span class="hs-identifier hs-var">go</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">forall a. UniqDSet a -&gt; [a]
</span><a href="GHC.Types.Unique.DSet.html#uniqDSetToList"><span class="hs-identifier hs-var">uniqDSetToList</span></a></span><span> </span><span class="annot"><span class="annottext">DIdSet
</span><a href="#local-6989586621681374578"><span class="hs-identifier hs-var">dirty</span></a></span><span class="hs-special">)</span><span> </span><span class="annot"><span class="annottext">UniqSDFM Id VarInfo
</span><a href="#local-6989586621681374579"><span class="hs-identifier hs-var">env</span></a></span><span>
</span><span id="line-1246"></span><span>  </span><span class="hs-keyword">where</span><span>
</span><span id="line-1247"></span><span>    </span><span id="local-6989586621681374577"><span class="annot"><span class="annottext">go :: [Id] -&gt; UniqSDFM Id VarInfo -&gt; m TmState
</span><a href="#local-6989586621681374577"><span class="hs-identifier hs-var hs-var">go</span></a></span></span><span> </span><span class="hs-special">[</span><span class="hs-special">]</span><span>     </span><span id="local-6989586621681374575"><span class="annot"><span class="annottext">UniqSDFM Id VarInfo
</span><a href="#local-6989586621681374575"><span class="hs-identifier hs-var">env</span></a></span></span><span>  </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">forall (f :: * -&gt; *) a. Applicative f =&gt; a -&gt; f a
</span><a href="../../base-4.16.4.0/src/GHC-Base.html#pure"><span class="hs-identifier hs-var">pure</span></a></span><span> </span><span class="annot"><span class="annottext">TmState
</span><a href="#local-6989586621681374580"><span class="hs-identifier hs-var">ts</span></a></span><span class="hs-special">{</span><span class="annot"><span class="annottext">ts_facts :: UniqSDFM Id VarInfo
</span><a href="GHC.HsToCore.Pmc.Solver.Types.html#ts_facts"><span class="hs-identifier hs-var">ts_facts</span></a></span><span class="hs-glyph">=</span><span class="annot"><span class="annottext">UniqSDFM Id VarInfo
</span><a href="#local-6989586621681374575"><span class="hs-identifier hs-var">env</span></a></span><span class="hs-special">}</span><span>
</span><span id="line-1248"></span><span>    </span><span class="annot"><a href="#local-6989586621681374577"><span class="hs-identifier hs-var">go</span></a></span><span> </span><span class="hs-special">(</span><span id="local-6989586621681374574"><span class="annot"><span class="annottext">Id
</span><a href="#local-6989586621681374574"><span class="hs-identifier hs-var">x</span></a></span></span><span class="annot"><span class="hs-glyph hs-type">:</span></span><span id="local-6989586621681374573"><span class="annot"><span class="annottext">[Id]
</span><a href="#local-6989586621681374573"><span class="hs-identifier hs-var">xs</span></a></span></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">!</span><span id="local-6989586621681374572"><span class="annot"><span class="annottext">UniqSDFM Id VarInfo
</span><a href="#local-6989586621681374572"><span class="hs-identifier hs-var">env</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-keyword">do</span><span>
</span><span id="line-1249"></span><span>      </span><span id="local-6989586621681374571"><span class="annot"><span class="annottext">VarInfo
</span><a href="#local-6989586621681374571"><span class="hs-identifier hs-var">vi'</span></a></span></span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">VarInfo -&gt; m VarInfo
</span><a href="#local-6989586621681374581"><span class="hs-identifier hs-var">f</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">TmState -&gt; Id -&gt; VarInfo
</span><a href="GHC.HsToCore.Pmc.Solver.html#lookupVarInfo"><span class="hs-identifier hs-var">lookupVarInfo</span></a></span><span> </span><span class="annot"><span class="annottext">TmState
</span><a href="#local-6989586621681374580"><span class="hs-identifier hs-var">ts</span></a></span><span> </span><span class="annot"><span class="annottext">Id
</span><a href="#local-6989586621681374574"><span class="hs-identifier hs-var">x</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-1250"></span><span>      </span><span class="annot"><span class="annottext">[Id] -&gt; UniqSDFM Id VarInfo -&gt; m TmState
</span><a href="#local-6989586621681374577"><span class="hs-identifier hs-var">go</span></a></span><span> </span><span class="annot"><span class="annottext">[Id]
</span><a href="#local-6989586621681374573"><span class="hs-identifier hs-var">xs</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">forall key ele.
Uniquable key =&gt;
UniqSDFM key ele -&gt; key -&gt; ele -&gt; UniqSDFM key ele
</span><a href="GHC.Types.Unique.SDFM.html#addToUSDFM"><span class="hs-identifier hs-var">addToUSDFM</span></a></span><span> </span><span class="annot"><span class="annottext">UniqSDFM Id VarInfo
</span><a href="#local-6989586621681374572"><span class="hs-identifier hs-var">env</span></a></span><span> </span><span class="annot"><span class="annottext">Id
</span><a href="#local-6989586621681374574"><span class="hs-identifier hs-var">x</span></a></span><span> </span><span class="annot"><span class="annottext">VarInfo
</span><a href="#local-6989586621681374571"><span class="hs-identifier hs-var">vi'</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-1251"></span><span>
</span><span id="line-1252"></span><span id="local-6989586621681374570"><span class="annot"><a href="GHC.HsToCore.Pmc.Solver.html#traverseAll"><span class="hs-identifier hs-type">traverseAll</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><a href="../../base-4.16.4.0/src/GHC-Base.html#Monad"><span class="hs-identifier hs-type">Monad</span></a></span><span> </span><span class="annot"><a href="#local-6989586621681374570"><span class="hs-identifier hs-type">m</span></a></span><span> </span><span class="hs-glyph">=&gt;</span><span> </span><span class="hs-special">(</span><span class="annot"><a href="GHC.HsToCore.Pmc.Solver.Types.html#VarInfo"><span class="hs-identifier hs-type">VarInfo</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="#local-6989586621681374570"><span class="hs-identifier hs-type">m</span></a></span><span> </span><span class="annot"><a href="GHC.HsToCore.Pmc.Solver.Types.html#VarInfo"><span class="hs-identifier hs-type">VarInfo</span></a></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="GHC.HsToCore.Pmc.Solver.Types.html#TmState"><span class="hs-identifier hs-type">TmState</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="#local-6989586621681374570"><span class="hs-identifier hs-type">m</span></a></span><span> </span><span class="annot"><a href="GHC.HsToCore.Pmc.Solver.Types.html#TmState"><span class="hs-identifier hs-type">TmState</span></a></span></span><span>
</span><span id="line-1253"></span><span id="traverseAll"><span class="annot"><span class="annottext">traverseAll :: forall (m :: * -&gt; *).
Monad m =&gt;
(VarInfo -&gt; m VarInfo) -&gt; TmState -&gt; m TmState
</span><a href="GHC.HsToCore.Pmc.Solver.html#traverseAll"><span class="hs-identifier hs-var hs-var">traverseAll</span></a></span></span><span> </span><span id="local-6989586621681374563"><span class="annot"><span class="annottext">VarInfo -&gt; m VarInfo
</span><a href="#local-6989586621681374563"><span class="hs-identifier hs-var">f</span></a></span></span><span> </span><span id="local-6989586621681374562"><span class="annot"><span class="annottext">ts :: TmState
</span><a href="#local-6989586621681374562"><span class="hs-identifier hs-var">ts</span></a></span></span><span class="hs-glyph">@</span><span class="annot"><a href="GHC.HsToCore.Pmc.Solver.Types.html#TmSt"><span class="hs-identifier hs-type">TmSt</span></a></span><span class="hs-special">{</span><span class="annot"><span class="annottext">ts_facts :: TmState -&gt; UniqSDFM Id VarInfo
</span><a href="GHC.HsToCore.Pmc.Solver.Types.html#ts_facts"><span class="hs-identifier hs-var">ts_facts</span></a></span><span> </span><span class="hs-glyph">=</span><span> </span><span id="local-6989586621681374561"><span class="annot"><span class="annottext">UniqSDFM Id VarInfo
</span><a href="#local-6989586621681374561"><span class="hs-identifier hs-var">env</span></a></span></span><span class="hs-special">}</span><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-keyword">do</span><span>
</span><span id="line-1254"></span><span>  </span><span id="local-6989586621681374560"><span class="annot"><span class="annottext">UniqSDFM Id VarInfo
</span><a href="#local-6989586621681374560"><span class="hs-identifier hs-var">env'</span></a></span></span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">forall key a b (f :: * -&gt; *).
Applicative f =&gt;
(a -&gt; f b) -&gt; UniqSDFM key a -&gt; f (UniqSDFM key b)
</span><a href="GHC.Types.Unique.SDFM.html#traverseUSDFM"><span class="hs-identifier hs-var">traverseUSDFM</span></a></span><span> </span><span class="annot"><span class="annottext">VarInfo -&gt; m VarInfo
</span><a href="#local-6989586621681374563"><span class="hs-identifier hs-var">f</span></a></span><span> </span><span class="annot"><span class="annottext">UniqSDFM Id VarInfo
</span><a href="#local-6989586621681374561"><span class="hs-identifier hs-var">env</span></a></span><span>
</span><span id="line-1255"></span><span>  </span><span class="annot"><span class="annottext">forall (f :: * -&gt; *) a. Applicative f =&gt; a -&gt; f a
</span><a href="../../base-4.16.4.0/src/GHC-Base.html#pure"><span class="hs-identifier hs-var">pure</span></a></span><span> </span><span class="annot"><span class="annottext">TmState
</span><a href="#local-6989586621681374562"><span class="hs-identifier hs-var">ts</span></a></span><span class="hs-special">{</span><span class="annot"><span class="annottext">ts_facts :: UniqSDFM Id VarInfo
</span><a href="GHC.HsToCore.Pmc.Solver.Types.html#ts_facts"><span class="hs-identifier hs-var">ts_facts</span></a></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">UniqSDFM Id VarInfo
</span><a href="#local-6989586621681374560"><span class="hs-identifier hs-var">env'</span></a></span><span class="hs-special">}</span><span>
</span><span id="line-1256"></span><span>
</span><span id="line-1257"></span><span class="hs-comment">-- | Makes sure the given 'Nabla' is still inhabited, by trying to instantiate</span><span>
</span><span id="line-1258"></span><span class="hs-comment">-- all dirty variables (or all variables when the 'TyState' changed) to concrete</span><span>
</span><span id="line-1259"></span><span class="hs-comment">-- inhabitants. It returns a 'Nabla' with the *same* inhabitants, but with some</span><span>
</span><span id="line-1260"></span><span class="hs-comment">-- amount of work cached (like failed instantiation attempts) from the test.</span><span>
</span><span id="line-1261"></span><span class="hs-comment">--</span><span>
</span><span id="line-1262"></span><span class="hs-comment">-- The \(&#8711; &#8866; x inh\) judgment form in Figure 8 of the LYG paper.</span><span>
</span><span id="line-1263"></span><span class="annot"><a href="GHC.HsToCore.Pmc.Solver.html#inhabitationTest"><span class="hs-identifier hs-type">inhabitationTest</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><span class="hs-identifier hs-type">Int</span></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="GHC.HsToCore.Pmc.Solver.Types.html#TyState"><span class="hs-identifier hs-type">TyState</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="GHC.HsToCore.Pmc.Solver.Types.html#Nabla"><span class="hs-identifier hs-type">Nabla</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="../../transformers-0.5.6.2/src/Control-Monad-Trans-Maybe.html#MaybeT"><span class="hs-identifier hs-type">MaybeT</span></a></span><span> </span><span class="annot"><a href="GHC.HsToCore.Types.html#DsM"><span class="hs-identifier hs-type">DsM</span></a></span><span> </span><span class="annot"><a href="GHC.HsToCore.Pmc.Solver.Types.html#Nabla"><span class="hs-identifier hs-type">Nabla</span></a></span><span>
</span><span id="line-1264"></span><span id="inhabitationTest"><span class="annot"><span class="annottext">inhabitationTest :: Int
-&gt; TyState -&gt; Nabla -&gt; MaybeT (IOEnv (Env DsGblEnv DsLclEnv)) Nabla
</span><a href="GHC.HsToCore.Pmc.Solver.html#inhabitationTest"><span class="hs-identifier hs-var hs-var">inhabitationTest</span></a></span></span><span> </span><span class="annot"><span class="annottext">Int
</span><span class="hs-number">0</span></span><span>     </span><span class="annot"><span class="annottext">TyState
</span><span class="hs-identifier">_</span></span><span>         </span><span id="local-6989586621681374558"><span class="annot"><span class="annottext">Nabla
</span><a href="#local-6989586621681374558"><span class="hs-identifier hs-var">nabla</span></a></span></span><span>             </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">forall (f :: * -&gt; *) a. Applicative f =&gt; a -&gt; f a
</span><a href="../../base-4.16.4.0/src/GHC-Base.html#pure"><span class="hs-identifier hs-var">pure</span></a></span><span> </span><span class="annot"><span class="annottext">Nabla
</span><a href="#local-6989586621681374558"><span class="hs-identifier hs-var">nabla</span></a></span><span>
</span><span id="line-1265"></span><span class="annot"><a href="GHC.HsToCore.Pmc.Solver.html#inhabitationTest"><span class="hs-identifier hs-var">inhabitationTest</span></a></span><span> </span><span id="local-6989586621681374557"><span class="annot"><span class="annottext">Int
</span><a href="#local-6989586621681374557"><span class="hs-identifier hs-var">fuel</span></a></span></span><span>  </span><span id="local-6989586621681374556"><span class="annot"><span class="annottext">TyState
</span><a href="#local-6989586621681374556"><span class="hs-identifier hs-var">old_ty_st</span></a></span></span><span> </span><span id="local-6989586621681374555"><span class="annot"><span class="annottext">nabla :: Nabla
</span><a href="#local-6989586621681374555"><span class="hs-identifier hs-var">nabla</span></a></span></span><span class="hs-glyph">@</span><span class="annot"><a href="GHC.HsToCore.Pmc.Solver.Types.html#MkNabla"><span class="hs-identifier hs-type">MkNabla</span></a></span><span class="hs-special">{</span><span> </span><span class="annot"><span class="annottext">nabla_tm_st :: Nabla -&gt; TmState
</span><a href="GHC.HsToCore.Pmc.Solver.Types.html#nabla_tm_st"><span class="hs-identifier hs-var">nabla_tm_st</span></a></span><span> </span><span class="hs-glyph">=</span><span> </span><span id="local-6989586621681374554"><span class="annot"><span class="annottext">TmState
</span><a href="#local-6989586621681374554"><span class="hs-identifier hs-var">ts</span></a></span></span><span> </span><span class="hs-special">}</span><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-keyword">do</span><span>
</span><span id="line-1266"></span><span>  </span><span class="hs-comment">-- lift $ tracePm &quot;inhabitation test&quot; $ vcat</span><span>
</span><span id="line-1267"></span><span>  </span><span class="hs-comment">--   [ ppr fuel</span><span>
</span><span id="line-1268"></span><span>  </span><span class="hs-comment">--   , ppr old_ty_st</span><span>
</span><span id="line-1269"></span><span>  </span><span class="hs-comment">--   , ppr nabla</span><span>
</span><span id="line-1270"></span><span>  </span><span class="hs-comment">--   , text &quot;tyStateRefined:&quot; &lt;+&gt; ppr (tyStateRefined old_ty_st (nabla_ty_st nabla))</span><span>
</span><span id="line-1271"></span><span>  </span><span class="hs-comment">--   ]</span><span>
</span><span id="line-1272"></span><span>  </span><span class="hs-comment">-- When type state didn't change, we only need to traverse dirty VarInfos</span><span>
</span><span id="line-1273"></span><span>  </span><span id="local-6989586621681374553"><span class="annot"><span class="annottext">TmState
</span><a href="#local-6989586621681374553"><span class="hs-identifier hs-var">ts'</span></a></span></span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="hs-keyword">if</span><span> </span><span class="annot"><span class="annottext">TyState -&gt; TyState -&gt; Bool
</span><a href="GHC.HsToCore.Pmc.Solver.html#tyStateRefined"><span class="hs-identifier hs-var">tyStateRefined</span></a></span><span> </span><span class="annot"><span class="annottext">TyState
</span><a href="#local-6989586621681374556"><span class="hs-identifier hs-var">old_ty_st</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Nabla -&gt; TyState
</span><a href="GHC.HsToCore.Pmc.Solver.Types.html#nabla_ty_st"><span class="hs-identifier hs-var">nabla_ty_st</span></a></span><span> </span><span class="annot"><span class="annottext">Nabla
</span><a href="#local-6989586621681374555"><span class="hs-identifier hs-var">nabla</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-1274"></span><span>            </span><span class="hs-keyword">then</span><span> </span><span class="annot"><span class="annottext">forall (m :: * -&gt; *).
Monad m =&gt;
(VarInfo -&gt; m VarInfo) -&gt; TmState -&gt; m TmState
</span><a href="GHC.HsToCore.Pmc.Solver.html#traverseAll"><span class="hs-identifier hs-var">traverseAll</span></a></span><span>   </span><span class="annot"><span class="annottext">VarInfo -&gt; MaybeT (IOEnv (Env DsGblEnv DsLclEnv)) VarInfo
</span><a href="#local-6989586621681374552"><span class="hs-identifier hs-var">test_one</span></a></span><span> </span><span class="annot"><span class="annottext">TmState
</span><a href="#local-6989586621681374554"><span class="hs-identifier hs-var">ts</span></a></span><span>
</span><span id="line-1275"></span><span>            </span><span class="hs-keyword">else</span><span> </span><span class="annot"><span class="annottext">forall (m :: * -&gt; *).
Monad m =&gt;
(VarInfo -&gt; m VarInfo) -&gt; TmState -&gt; m TmState
</span><a href="GHC.HsToCore.Pmc.Solver.html#traverseDirty"><span class="hs-identifier hs-var">traverseDirty</span></a></span><span> </span><span class="annot"><span class="annottext">VarInfo -&gt; MaybeT (IOEnv (Env DsGblEnv DsLclEnv)) VarInfo
</span><a href="#local-6989586621681374552"><span class="hs-identifier hs-var">test_one</span></a></span><span> </span><span class="annot"><span class="annottext">TmState
</span><a href="#local-6989586621681374554"><span class="hs-identifier hs-var">ts</span></a></span><span>
</span><span id="line-1276"></span><span>  </span><span class="annot"><span class="annottext">forall (f :: * -&gt; *) a. Applicative f =&gt; a -&gt; f a
</span><a href="../../base-4.16.4.0/src/GHC-Base.html#pure"><span class="hs-identifier hs-var">pure</span></a></span><span> </span><span class="annot"><span class="annottext">Nabla
</span><a href="#local-6989586621681374555"><span class="hs-identifier hs-var">nabla</span></a></span><span class="hs-special">{</span><span> </span><span class="annot"><span class="annottext">nabla_tm_st :: TmState
</span><a href="GHC.HsToCore.Pmc.Solver.Types.html#nabla_tm_st"><span class="hs-identifier hs-var">nabla_tm_st</span></a></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">TmState
</span><a href="#local-6989586621681374553"><span class="hs-identifier hs-var">ts'</span></a></span><span class="hs-special">{</span><span class="annot"><span class="annottext">ts_dirty :: DIdSet
</span><a href="GHC.HsToCore.Pmc.Solver.Types.html#ts_dirty"><span class="hs-identifier hs-var">ts_dirty</span></a></span><span class="hs-glyph">=</span><span class="annot"><span class="annottext">DIdSet
</span><a href="GHC.Types.Var.Set.html#emptyDVarSet"><span class="hs-identifier hs-var">emptyDVarSet</span></a></span><span class="hs-special">}</span><span class="hs-special">}</span><span>
</span><span id="line-1277"></span><span>  </span><span class="hs-keyword">where</span><span>
</span><span id="line-1278"></span><span>    </span><span id="local-6989586621681374550"><span class="annot"><span class="annottext">nabla_not_dirty :: Nabla
</span><a href="#local-6989586621681374550"><span class="hs-identifier hs-var hs-var">nabla_not_dirty</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">Nabla
</span><a href="#local-6989586621681374555"><span class="hs-identifier hs-var">nabla</span></a></span><span class="hs-special">{</span><span> </span><span class="annot"><span class="annottext">nabla_tm_st :: TmState
</span><a href="GHC.HsToCore.Pmc.Solver.Types.html#nabla_tm_st"><span class="hs-identifier hs-var">nabla_tm_st</span></a></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">TmState
</span><a href="#local-6989586621681374554"><span class="hs-identifier hs-var">ts</span></a></span><span class="hs-special">{</span><span class="annot"><span class="annottext">ts_dirty :: DIdSet
</span><a href="GHC.HsToCore.Pmc.Solver.Types.html#ts_dirty"><span class="hs-identifier hs-var">ts_dirty</span></a></span><span class="hs-glyph">=</span><span class="annot"><span class="annottext">DIdSet
</span><a href="GHC.Types.Var.Set.html#emptyDVarSet"><span class="hs-identifier hs-var">emptyDVarSet</span></a></span><span class="hs-special">}</span><span> </span><span class="hs-special">}</span><span>
</span><span id="line-1279"></span><span>    </span><span class="annot"><a href="#local-6989586621681374552"><span class="hs-identifier hs-type">test_one</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><a href="GHC.HsToCore.Pmc.Solver.Types.html#VarInfo"><span class="hs-identifier hs-type">VarInfo</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="../../transformers-0.5.6.2/src/Control-Monad-Trans-Maybe.html#MaybeT"><span class="hs-identifier hs-type">MaybeT</span></a></span><span> </span><span class="annot"><a href="GHC.HsToCore.Types.html#DsM"><span class="hs-identifier hs-type">DsM</span></a></span><span> </span><span class="annot"><a href="GHC.HsToCore.Pmc.Solver.Types.html#VarInfo"><span class="hs-identifier hs-type">VarInfo</span></a></span><span>
</span><span id="line-1280"></span><span>    </span><span id="local-6989586621681374552"><span class="annot"><span class="annottext">test_one :: VarInfo -&gt; MaybeT (IOEnv (Env DsGblEnv DsLclEnv)) VarInfo
</span><a href="#local-6989586621681374552"><span class="hs-identifier hs-var hs-var">test_one</span></a></span></span><span> </span><span id="local-6989586621681374549"><span class="annot"><span class="annottext">VarInfo
</span><a href="#local-6989586621681374549"><span class="hs-identifier hs-var">vi</span></a></span></span><span> </span><span class="hs-glyph">=</span><span>
</span><span id="line-1281"></span><span>      </span><span class="annot"><span class="annottext">forall (t :: (* -&gt; *) -&gt; * -&gt; *) (m :: * -&gt; *) a.
(MonadTrans t, Monad m) =&gt;
m a -&gt; t m a
</span><a href="../../transformers-0.5.6.2/src/Control-Monad-Trans-Class.html#lift"><span class="hs-identifier hs-var">lift</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">TyState -&gt; Nabla -&gt; VarInfo -&gt; DsM Bool
</span><a href="GHC.HsToCore.Pmc.Solver.html#varNeedsTesting"><span class="hs-identifier hs-var">varNeedsTesting</span></a></span><span> </span><span class="annot"><span class="annottext">TyState
</span><a href="#local-6989586621681374556"><span class="hs-identifier hs-var">old_ty_st</span></a></span><span> </span><span class="annot"><span class="annottext">Nabla
</span><a href="#local-6989586621681374555"><span class="hs-identifier hs-var">nabla</span></a></span><span> </span><span class="annot"><span class="annottext">VarInfo
</span><a href="#local-6989586621681374549"><span class="hs-identifier hs-var">vi</span></a></span><span class="hs-special">)</span><span> </span><span class="annot"><span class="annottext">forall (m :: * -&gt; *) a b. Monad m =&gt; m a -&gt; (a -&gt; m b) -&gt; m b
</span><a href="../../base-4.16.4.0/src/GHC-Base.html#%3E%3E%3D"><span class="hs-operator hs-var">&gt;&gt;=</span></a></span><span> </span><span class="hs-glyph">\</span><span class="hs-glyph">case</span><span>
</span><span id="line-1282"></span><span>        </span><span class="annot"><span class="annottext">Bool
</span><span class="hs-identifier hs-var">True</span></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-keyword">do</span><span>
</span><span id="line-1283"></span><span>          </span><span class="hs-comment">-- lift $ tracePm &quot;test_one&quot; (ppr vi)</span><span>
</span><span id="line-1284"></span><span>          </span><span class="hs-comment">-- No solution yet and needs testing</span><span>
</span><span id="line-1285"></span><span>          </span><span class="hs-comment">-- We have to test with a Nabla where all dirty bits are cleared</span><span>
</span><span id="line-1286"></span><span>          </span><span class="annot"><span class="annottext">Int
-&gt; Nabla
-&gt; VarInfo
-&gt; MaybeT (IOEnv (Env DsGblEnv DsLclEnv)) VarInfo
</span><a href="GHC.HsToCore.Pmc.Solver.html#instantiate"><span class="hs-identifier hs-var">instantiate</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Int
</span><a href="#local-6989586621681374557"><span class="hs-identifier hs-var">fuel</span></a></span><span class="annot"><span class="annottext">forall a. Num a =&gt; a -&gt; a -&gt; a
</span><a href="../../base-4.16.4.0/src/GHC-Num.html#-"><span class="hs-glyph hs-var">-</span></a></span><span class="annot"><span class="annottext">Int
</span><span class="hs-number">1</span></span><span class="hs-special">)</span><span> </span><span class="annot"><span class="annottext">Nabla
</span><a href="#local-6989586621681374550"><span class="hs-identifier hs-var">nabla_not_dirty</span></a></span><span> </span><span class="annot"><span class="annottext">VarInfo
</span><a href="#local-6989586621681374549"><span class="hs-identifier hs-var">vi</span></a></span><span>
</span><span id="line-1287"></span><span>        </span><span class="annot"><span class="annottext">Bool
</span><span class="hs-identifier">_</span></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="annottext">forall (f :: * -&gt; *) a. Applicative f =&gt; a -&gt; f a
</span><a href="../../base-4.16.4.0/src/GHC-Base.html#pure"><span class="hs-identifier hs-var">pure</span></a></span><span> </span><span class="annot"><span class="annottext">VarInfo
</span><a href="#local-6989586621681374549"><span class="hs-identifier hs-var">vi</span></a></span><span>
</span><span id="line-1288"></span><span>
</span><span id="line-1289"></span><span class="hs-comment">-- | Checks whether the given 'VarInfo' needs to be tested for inhabitants.</span><span>
</span><span id="line-1290"></span><span class="hs-comment">-- Returns `False` when we can skip the inhabitation test, presuming it would</span><span>
</span><span id="line-1291"></span><span class="hs-comment">-- say &quot;yes&quot; anyway. See Note [Shortcutting the inhabitation test].</span><span>
</span><span id="line-1292"></span><span class="annot"><a href="GHC.HsToCore.Pmc.Solver.html#varNeedsTesting"><span class="hs-identifier hs-type">varNeedsTesting</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><a href="GHC.HsToCore.Pmc.Solver.Types.html#TyState"><span class="hs-identifier hs-type">TyState</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="GHC.HsToCore.Pmc.Solver.Types.html#Nabla"><span class="hs-identifier hs-type">Nabla</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="GHC.HsToCore.Pmc.Solver.Types.html#VarInfo"><span class="hs-identifier hs-type">VarInfo</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="GHC.HsToCore.Types.html#DsM"><span class="hs-identifier hs-type">DsM</span></a></span><span> </span><span class="annot"><span class="hs-identifier hs-type">Bool</span></span><span>
</span><span id="line-1293"></span><span id="varNeedsTesting"><span class="annot"><span class="annottext">varNeedsTesting :: TyState -&gt; Nabla -&gt; VarInfo -&gt; DsM Bool
</span><a href="GHC.HsToCore.Pmc.Solver.html#varNeedsTesting"><span class="hs-identifier hs-var hs-var">varNeedsTesting</span></a></span></span><span> </span><span class="annot"><span class="annottext">TyState
</span><span class="hs-identifier">_</span></span><span>         </span><span class="annot"><a href="GHC.HsToCore.Pmc.Solver.Types.html#MkNabla"><span class="hs-identifier hs-type">MkNabla</span></a></span><span class="hs-special">{</span><span class="annot"><span class="annottext">nabla_tm_st :: Nabla -&gt; TmState
</span><a href="GHC.HsToCore.Pmc.Solver.Types.html#nabla_tm_st"><span class="hs-identifier hs-var">nabla_tm_st</span></a></span><span class="hs-glyph">=</span><span id="local-6989586621681374546"><span class="annot"><span class="annottext">TmState
</span><a href="#local-6989586621681374546"><span class="hs-identifier hs-var">tm_st</span></a></span></span><span class="hs-special">}</span><span>     </span><span id="local-6989586621681374545"><span class="annot"><span class="annottext">VarInfo
</span><a href="#local-6989586621681374545"><span class="hs-identifier hs-var">vi</span></a></span></span><span>
</span><span id="line-1294"></span><span>  </span><span class="hs-glyph">|</span><span> </span><span class="annot"><span class="annottext">Id -&gt; DIdSet -&gt; Bool
</span><a href="GHC.Types.Var.Set.html#elemDVarSet"><span class="hs-identifier hs-var">elemDVarSet</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">VarInfo -&gt; Id
</span><a href="GHC.HsToCore.Pmc.Solver.Types.html#vi_id"><span class="hs-identifier hs-var">vi_id</span></a></span><span> </span><span class="annot"><span class="annottext">VarInfo
</span><a href="#local-6989586621681374545"><span class="hs-identifier hs-var">vi</span></a></span><span class="hs-special">)</span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">TmState -&gt; DIdSet
</span><a href="GHC.HsToCore.Pmc.Solver.Types.html#ts_dirty"><span class="hs-identifier hs-var">ts_dirty</span></a></span><span> </span><span class="annot"><span class="annottext">TmState
</span><a href="#local-6989586621681374546"><span class="hs-identifier hs-var">tm_st</span></a></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">forall (f :: * -&gt; *) a. Applicative f =&gt; a -&gt; f a
</span><a href="../../base-4.16.4.0/src/GHC-Base.html#pure"><span class="hs-identifier hs-var">pure</span></a></span><span> </span><span class="annot"><span class="annottext">Bool
</span><span class="hs-identifier hs-var">True</span></span><span>
</span><span id="line-1295"></span><span class="annot"><a href="GHC.HsToCore.Pmc.Solver.html#varNeedsTesting"><span class="hs-identifier hs-var">varNeedsTesting</span></a></span><span> </span><span class="annot"><span class="annottext">TyState
</span><span class="hs-identifier">_</span></span><span>         </span><span class="annot"><span class="annottext">Nabla
</span><span class="hs-identifier">_</span></span><span>                              </span><span id="local-6989586621681374543"><span class="annot"><span class="annottext">VarInfo
</span><a href="#local-6989586621681374543"><span class="hs-identifier hs-var">vi</span></a></span></span><span>
</span><span id="line-1296"></span><span>  </span><span class="hs-glyph">|</span><span> </span><span class="annot"><span class="annottext">forall (f :: * -&gt; *) a. Foldable f =&gt; f a -&gt; Bool
</span><a href="GHC.Utils.Misc.html#notNull"><span class="hs-identifier hs-var">notNull</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">VarInfo -&gt; [PmAltConApp]
</span><a href="GHC.HsToCore.Pmc.Solver.Types.html#vi_pos"><span class="hs-identifier hs-var">vi_pos</span></a></span><span> </span><span class="annot"><span class="annottext">VarInfo
</span><a href="#local-6989586621681374543"><span class="hs-identifier hs-var">vi</span></a></span><span class="hs-special">)</span><span>                     </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">forall (f :: * -&gt; *) a. Applicative f =&gt; a -&gt; f a
</span><a href="../../base-4.16.4.0/src/GHC-Base.html#pure"><span class="hs-identifier hs-var">pure</span></a></span><span> </span><span class="annot"><span class="annottext">Bool
</span><span class="hs-identifier hs-var">False</span></span><span>
</span><span id="line-1297"></span><span class="annot"><a href="GHC.HsToCore.Pmc.Solver.html#varNeedsTesting"><span class="hs-identifier hs-var">varNeedsTesting</span></a></span><span> </span><span id="local-6989586621681374542"><span class="annot"><span class="annottext">TyState
</span><a href="#local-6989586621681374542"><span class="hs-identifier hs-var">old_ty_st</span></a></span></span><span> </span><span class="annot"><a href="GHC.HsToCore.Pmc.Solver.Types.html#MkNabla"><span class="hs-identifier hs-type">MkNabla</span></a></span><span class="hs-special">{</span><span class="annot"><span class="annottext">nabla_ty_st :: Nabla -&gt; TyState
</span><a href="GHC.HsToCore.Pmc.Solver.Types.html#nabla_ty_st"><span class="hs-identifier hs-var">nabla_ty_st</span></a></span><span class="hs-glyph">=</span><span id="local-6989586621681374541"><span class="annot"><span class="annottext">TyState
</span><a href="#local-6989586621681374541"><span class="hs-identifier hs-var">new_ty_st</span></a></span></span><span class="hs-special">}</span><span> </span><span class="annot"><span class="annottext">VarInfo
</span><span class="hs-identifier">_</span></span><span>
</span><span id="line-1298"></span><span>  </span><span class="hs-comment">-- Same type state =&gt; still inhabited</span><span>
</span><span id="line-1299"></span><span>  </span><span class="hs-glyph">|</span><span> </span><span class="annot"><span class="annottext">Bool -&gt; Bool
</span><span class="hs-identifier hs-var">not</span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">TyState -&gt; TyState -&gt; Bool
</span><a href="GHC.HsToCore.Pmc.Solver.html#tyStateRefined"><span class="hs-identifier hs-var">tyStateRefined</span></a></span><span> </span><span class="annot"><span class="annottext">TyState
</span><a href="#local-6989586621681374542"><span class="hs-identifier hs-var">old_ty_st</span></a></span><span> </span><span class="annot"><span class="annottext">TyState
</span><a href="#local-6989586621681374541"><span class="hs-identifier hs-var">new_ty_st</span></a></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">forall (f :: * -&gt; *) a. Applicative f =&gt; a -&gt; f a
</span><a href="../../base-4.16.4.0/src/GHC-Base.html#pure"><span class="hs-identifier hs-var">pure</span></a></span><span> </span><span class="annot"><span class="annottext">Bool
</span><span class="hs-identifier hs-var">False</span></span><span>
</span><span id="line-1300"></span><span class="annot"><a href="GHC.HsToCore.Pmc.Solver.html#varNeedsTesting"><span class="hs-identifier hs-var">varNeedsTesting</span></a></span><span> </span><span id="local-6989586621681374540"><span class="annot"><span class="annottext">TyState
</span><a href="#local-6989586621681374540"><span class="hs-identifier hs-var">old_ty_st</span></a></span></span><span> </span><span class="annot"><a href="GHC.HsToCore.Pmc.Solver.Types.html#MkNabla"><span class="hs-identifier hs-type">MkNabla</span></a></span><span class="hs-special">{</span><span class="annot"><span class="annottext">nabla_ty_st :: Nabla -&gt; TyState
</span><a href="GHC.HsToCore.Pmc.Solver.Types.html#nabla_ty_st"><span class="hs-identifier hs-var">nabla_ty_st</span></a></span><span class="hs-glyph">=</span><span id="local-6989586621681374539"><span class="annot"><span class="annottext">TyState
</span><a href="#local-6989586621681374539"><span class="hs-identifier hs-var">new_ty_st</span></a></span></span><span class="hs-special">}</span><span> </span><span id="local-6989586621681374538"><span class="annot"><span class="annottext">VarInfo
</span><a href="#local-6989586621681374538"><span class="hs-identifier hs-var">vi</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-keyword">do</span><span>
</span><span id="line-1301"></span><span>  </span><span class="hs-comment">-- These normalisations are relatively expensive, but still better than having</span><span>
</span><span id="line-1302"></span><span>  </span><span class="hs-comment">-- to perform a full inhabitation test</span><span>
</span><span id="line-1303"></span><span>  </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Type
</span><span class="hs-identifier">_</span></span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">[(Type, DataCon, Type)]
</span><span class="hs-identifier">_</span></span><span class="hs-special">,</span><span> </span><span id="local-6989586621681374537"><span class="annot"><span class="annottext">Type
</span><a href="#local-6989586621681374537"><span class="hs-identifier hs-var">old_norm_ty</span></a></span></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">TopNormaliseTypeResult -&gt; (Type, [(Type, DataCon, Type)], Type)
</span><a href="GHC.HsToCore.Pmc.Solver.html#tntrGuts"><span class="hs-identifier hs-var">tntrGuts</span></a></span><span> </span><span class="annot"><span class="annottext">forall (f :: * -&gt; *) a b. Functor f =&gt; (a -&gt; b) -&gt; f a -&gt; f b
</span><a href="../../base-4.16.4.0/src/Data-Functor.html#%3C%24%3E"><span class="hs-operator hs-var">&lt;$&gt;</span></a></span><span> </span><span class="annot"><span class="annottext">TyState -&gt; Type -&gt; DsM TopNormaliseTypeResult
</span><a href="GHC.HsToCore.Pmc.Solver.html#pmTopNormaliseType"><span class="hs-identifier hs-var">pmTopNormaliseType</span></a></span><span> </span><span class="annot"><span class="annottext">TyState
</span><a href="#local-6989586621681374540"><span class="hs-identifier hs-var">old_ty_st</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Id -&gt; Type
</span><a href="GHC.Types.Id.html#idType"><span class="hs-identifier hs-var">idType</span></a></span><span> </span><span class="annot"><span class="annottext">forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><a href="../../base-4.16.4.0/src/GHC-Base.html#%24"><span class="hs-operator hs-var">$</span></a></span><span> </span><span class="annot"><span class="annottext">VarInfo -&gt; Id
</span><a href="GHC.HsToCore.Pmc.Solver.Types.html#vi_id"><span class="hs-identifier hs-var">vi_id</span></a></span><span> </span><span class="annot"><span class="annottext">VarInfo
</span><a href="#local-6989586621681374538"><span class="hs-identifier hs-var">vi</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-1304"></span><span>  </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Type
</span><span class="hs-identifier">_</span></span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">[(Type, DataCon, Type)]
</span><span class="hs-identifier">_</span></span><span class="hs-special">,</span><span> </span><span id="local-6989586621681374536"><span class="annot"><span class="annottext">Type
</span><a href="#local-6989586621681374536"><span class="hs-identifier hs-var">new_norm_ty</span></a></span></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">TopNormaliseTypeResult -&gt; (Type, [(Type, DataCon, Type)], Type)
</span><a href="GHC.HsToCore.Pmc.Solver.html#tntrGuts"><span class="hs-identifier hs-var">tntrGuts</span></a></span><span> </span><span class="annot"><span class="annottext">forall (f :: * -&gt; *) a b. Functor f =&gt; (a -&gt; b) -&gt; f a -&gt; f b
</span><a href="../../base-4.16.4.0/src/Data-Functor.html#%3C%24%3E"><span class="hs-operator hs-var">&lt;$&gt;</span></a></span><span> </span><span class="annot"><span class="annottext">TyState -&gt; Type -&gt; DsM TopNormaliseTypeResult
</span><a href="GHC.HsToCore.Pmc.Solver.html#pmTopNormaliseType"><span class="hs-identifier hs-var">pmTopNormaliseType</span></a></span><span> </span><span class="annot"><span class="annottext">TyState
</span><a href="#local-6989586621681374539"><span class="hs-identifier hs-var">new_ty_st</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Id -&gt; Type
</span><a href="GHC.Types.Id.html#idType"><span class="hs-identifier hs-var">idType</span></a></span><span> </span><span class="annot"><span class="annottext">forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><a href="../../base-4.16.4.0/src/GHC-Base.html#%24"><span class="hs-operator hs-var">$</span></a></span><span> </span><span class="annot"><span class="annottext">VarInfo -&gt; Id
</span><a href="GHC.HsToCore.Pmc.Solver.Types.html#vi_id"><span class="hs-identifier hs-var">vi_id</span></a></span><span> </span><span class="annot"><span class="annottext">VarInfo
</span><a href="#local-6989586621681374538"><span class="hs-identifier hs-var">vi</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-1305"></span><span>  </span><span class="hs-keyword">if</span><span> </span><span class="annot"><span class="annottext">Type
</span><a href="#local-6989586621681374537"><span class="hs-identifier hs-var">old_norm_ty</span></a></span><span> </span><span class="annot"><span class="annottext">Type -&gt; Type -&gt; Bool
</span><a href="GHC.Core.Type.html#eqType"><span class="hs-operator hs-var">`eqType`</span></a></span><span> </span><span class="annot"><span class="annottext">Type
</span><a href="#local-6989586621681374536"><span class="hs-identifier hs-var">new_norm_ty</span></a></span><span>
</span><span id="line-1306"></span><span>    </span><span class="hs-keyword">then</span><span> </span><span class="annot"><span class="annottext">forall (f :: * -&gt; *) a. Applicative f =&gt; a -&gt; f a
</span><a href="../../base-4.16.4.0/src/GHC-Base.html#pure"><span class="hs-identifier hs-var">pure</span></a></span><span> </span><span class="annot"><span class="annottext">Bool
</span><span class="hs-identifier hs-var">False</span></span><span>
</span><span id="line-1307"></span><span>    </span><span class="hs-keyword">else</span><span> </span><span class="annot"><span class="annottext">forall (f :: * -&gt; *) a. Applicative f =&gt; a -&gt; f a
</span><a href="../../base-4.16.4.0/src/GHC-Base.html#pure"><span class="hs-identifier hs-var">pure</span></a></span><span> </span><span class="annot"><span class="annottext">Bool
</span><span class="hs-identifier hs-var">True</span></span><span>
</span><span id="line-1308"></span><span>
</span><span id="line-1309"></span><span class="hs-comment">-- | Returns (Just vi) if at least one member of each ConLike in the COMPLETE</span><span>
</span><span id="line-1310"></span><span class="hs-comment">-- set satisfies the oracle</span><span>
</span><span id="line-1311"></span><span class="hs-comment">--</span><span>
</span><span id="line-1312"></span><span class="hs-comment">-- Internally uses and updates the CompleteMatchs in vi_rcm.</span><span>
</span><span id="line-1313"></span><span class="hs-comment">--</span><span>
</span><span id="line-1314"></span><span class="hs-comment">-- NB: Does /not/ filter each CompleteMatch with the oracle; members may</span><span>
</span><span id="line-1315"></span><span class="hs-comment">--     remain that do not statisfy it.  This lazy approach just</span><span>
</span><span id="line-1316"></span><span class="hs-comment">--     avoids doing unnecessary work.</span><span>
</span><span id="line-1317"></span><span class="annot"><a href="GHC.HsToCore.Pmc.Solver.html#instantiate"><span class="hs-identifier hs-type">instantiate</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><span class="hs-identifier hs-type">Int</span></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="GHC.HsToCore.Pmc.Solver.Types.html#Nabla"><span class="hs-identifier hs-type">Nabla</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="GHC.HsToCore.Pmc.Solver.Types.html#VarInfo"><span class="hs-identifier hs-type">VarInfo</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="../../transformers-0.5.6.2/src/Control-Monad-Trans-Maybe.html#MaybeT"><span class="hs-identifier hs-type">MaybeT</span></a></span><span> </span><span class="annot"><a href="GHC.HsToCore.Types.html#DsM"><span class="hs-identifier hs-type">DsM</span></a></span><span> </span><span class="annot"><a href="GHC.HsToCore.Pmc.Solver.Types.html#VarInfo"><span class="hs-identifier hs-type">VarInfo</span></a></span><span>
</span><span id="line-1318"></span><span id="instantiate"><span class="annot"><span class="annottext">instantiate :: Int
-&gt; Nabla
-&gt; VarInfo
-&gt; MaybeT (IOEnv (Env DsGblEnv DsLclEnv)) VarInfo
</span><a href="GHC.HsToCore.Pmc.Solver.html#instantiate"><span class="hs-identifier hs-var hs-var">instantiate</span></a></span></span><span> </span><span id="local-6989586621681374535"><span class="annot"><span class="annottext">Int
</span><a href="#local-6989586621681374535"><span class="hs-identifier hs-var">fuel</span></a></span></span><span> </span><span id="local-6989586621681374534"><span class="annot"><span class="annottext">Nabla
</span><a href="#local-6989586621681374534"><span class="hs-identifier hs-var">nabla</span></a></span></span><span> </span><span id="local-6989586621681374533"><span class="annot"><span class="annottext">VarInfo
</span><a href="#local-6989586621681374533"><span class="hs-identifier hs-var">vi</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">Int
-&gt; Nabla
-&gt; VarInfo
-&gt; MaybeT (IOEnv (Env DsGblEnv DsLclEnv)) VarInfo
</span><a href="GHC.HsToCore.Pmc.Solver.html#instBot"><span class="hs-identifier hs-var">instBot</span></a></span><span> </span><span class="annot"><span class="annottext">Int
</span><a href="#local-6989586621681374535"><span class="hs-identifier hs-var">fuel</span></a></span><span> </span><span class="annot"><span class="annottext">Nabla
</span><a href="#local-6989586621681374534"><span class="hs-identifier hs-var">nabla</span></a></span><span> </span><span class="annot"><span class="annottext">VarInfo
</span><a href="#local-6989586621681374533"><span class="hs-identifier hs-var">vi</span></a></span><span> </span><span class="annot"><span class="annottext">forall (f :: * -&gt; *) a. Alternative f =&gt; f a -&gt; f a -&gt; f a
</span><a href="../../base-4.16.4.0/src/GHC-Base.html#%3C%7C%3E"><span class="hs-operator hs-var">&lt;|&gt;</span></a></span><span> </span><span class="annot"><span class="annottext">Int
-&gt; Nabla
-&gt; VarInfo
-&gt; MaybeT (IOEnv (Env DsGblEnv DsLclEnv)) VarInfo
</span><a href="GHC.HsToCore.Pmc.Solver.html#instCompleteSets"><span class="hs-identifier hs-var">instCompleteSets</span></a></span><span> </span><span class="annot"><span class="annottext">Int
</span><a href="#local-6989586621681374535"><span class="hs-identifier hs-var">fuel</span></a></span><span> </span><span class="annot"><span class="annottext">Nabla
</span><a href="#local-6989586621681374534"><span class="hs-identifier hs-var">nabla</span></a></span><span> </span><span class="annot"><span class="annottext">VarInfo
</span><a href="#local-6989586621681374533"><span class="hs-identifier hs-var">vi</span></a></span><span>
</span><span id="line-1319"></span><span>
</span><span id="line-1320"></span><span class="hs-comment">-- | The \(&#8866;_{Bot}\) rule from the paper</span><span>
</span><span id="line-1321"></span><span class="annot"><a href="GHC.HsToCore.Pmc.Solver.html#instBot"><span class="hs-identifier hs-type">instBot</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><span class="hs-identifier hs-type">Int</span></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="GHC.HsToCore.Pmc.Solver.Types.html#Nabla"><span class="hs-identifier hs-type">Nabla</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="GHC.HsToCore.Pmc.Solver.Types.html#VarInfo"><span class="hs-identifier hs-type">VarInfo</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="../../transformers-0.5.6.2/src/Control-Monad-Trans-Maybe.html#MaybeT"><span class="hs-identifier hs-type">MaybeT</span></a></span><span> </span><span class="annot"><a href="GHC.HsToCore.Types.html#DsM"><span class="hs-identifier hs-type">DsM</span></a></span><span> </span><span class="annot"><a href="GHC.HsToCore.Pmc.Solver.Types.html#VarInfo"><span class="hs-identifier hs-type">VarInfo</span></a></span><span>
</span><span id="line-1322"></span><span id="instBot"><span class="annot"><span class="annottext">instBot :: Int
-&gt; Nabla
-&gt; VarInfo
-&gt; MaybeT (IOEnv (Env DsGblEnv DsLclEnv)) VarInfo
</span><a href="GHC.HsToCore.Pmc.Solver.html#instBot"><span class="hs-identifier hs-var hs-var">instBot</span></a></span></span><span> </span><span id="local-6989586621681374530"><span class="annot"><span class="annottext">Int
</span><a href="#local-6989586621681374530"><span class="hs-identifier hs-var">_fuel</span></a></span></span><span> </span><span id="local-6989586621681374529"><span class="annot"><span class="annottext">Nabla
</span><a href="#local-6989586621681374529"><span class="hs-identifier hs-var">nabla</span></a></span></span><span> </span><span id="local-6989586621681374528"><span class="annot"><span class="annottext">VarInfo
</span><a href="#local-6989586621681374528"><span class="hs-identifier hs-var">vi</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-keyword">do</span><span>
</span><span id="line-1323"></span><span>  </span><span id="local-6989586621681374527"><span class="annot"><span class="annottext">Nabla
</span><a href="#local-6989586621681374527"><span class="hs-identifier hs-var">_nabla'</span></a></span></span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">Nabla -&gt; Id -&gt; MaybeT (IOEnv (Env DsGblEnv DsLclEnv)) Nabla
</span><a href="GHC.HsToCore.Pmc.Solver.html#addBotCt"><span class="hs-identifier hs-var">addBotCt</span></a></span><span> </span><span class="annot"><span class="annottext">Nabla
</span><a href="#local-6989586621681374529"><span class="hs-identifier hs-var">nabla</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">VarInfo -&gt; Id
</span><a href="GHC.HsToCore.Pmc.Solver.Types.html#vi_id"><span class="hs-identifier hs-var">vi_id</span></a></span><span> </span><span class="annot"><span class="annottext">VarInfo
</span><a href="#local-6989586621681374528"><span class="hs-identifier hs-var">vi</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-1324"></span><span>  </span><span class="annot"><span class="annottext">forall (f :: * -&gt; *) a. Applicative f =&gt; a -&gt; f a
</span><a href="../../base-4.16.4.0/src/GHC-Base.html#pure"><span class="hs-identifier hs-var">pure</span></a></span><span> </span><span class="annot"><span class="annottext">VarInfo
</span><a href="#local-6989586621681374528"><span class="hs-identifier hs-var">vi</span></a></span><span>
</span><span id="line-1325"></span><span>
</span><span id="line-1326"></span><span class="annot"><a href="GHC.HsToCore.Pmc.Solver.html#addNormalisedTypeMatches"><span class="hs-identifier hs-type">addNormalisedTypeMatches</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><a href="GHC.HsToCore.Pmc.Solver.Types.html#Nabla"><span class="hs-identifier hs-type">Nabla</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="GHC.Types.Var.html#Id"><span class="hs-identifier hs-type">Id</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="GHC.HsToCore.Types.html#DsM"><span class="hs-identifier hs-type">DsM</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="GHC.HsToCore.Pmc.Solver.Types.html#ResidualCompleteMatches"><span class="hs-identifier hs-type">ResidualCompleteMatches</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><a href="GHC.HsToCore.Pmc.Solver.Types.html#Nabla"><span class="hs-identifier hs-type">Nabla</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-1327"></span><span id="addNormalisedTypeMatches"><span class="annot"><span class="annottext">addNormalisedTypeMatches :: Nabla -&gt; Id -&gt; DsM (ResidualCompleteMatches, Nabla)
</span><a href="GHC.HsToCore.Pmc.Solver.html#addNormalisedTypeMatches"><span class="hs-identifier hs-var hs-var">addNormalisedTypeMatches</span></a></span></span><span> </span><span id="local-6989586621681374525"><span class="annot"><span class="annottext">nabla :: Nabla
</span><a href="#local-6989586621681374525"><span class="hs-identifier hs-var">nabla</span></a></span></span><span class="hs-glyph">@</span><span class="annot"><a href="GHC.HsToCore.Pmc.Solver.Types.html#MkNabla"><span class="hs-identifier hs-type">MkNabla</span></a></span><span class="hs-special">{</span><span> </span><span class="annot"><span class="annottext">nabla_ty_st :: Nabla -&gt; TyState
</span><a href="GHC.HsToCore.Pmc.Solver.Types.html#nabla_ty_st"><span class="hs-identifier hs-var">nabla_ty_st</span></a></span><span> </span><span class="hs-glyph">=</span><span> </span><span id="local-6989586621681374524"><span class="annot"><span class="annottext">TyState
</span><a href="#local-6989586621681374524"><span class="hs-identifier hs-var">ty_st</span></a></span></span><span> </span><span class="hs-special">}</span><span> </span><span id="local-6989586621681374523"><span class="annot"><span class="annottext">Id
</span><a href="#local-6989586621681374523"><span class="hs-identifier hs-var">x</span></a></span></span><span>
</span><span id="line-1328"></span><span>  </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">forall (f :: * -&gt; *) a.
Functor f =&gt;
(VarInfo -&gt; f (a, VarInfo)) -&gt; Nabla -&gt; Id -&gt; f (a, Nabla)
</span><a href="GHC.HsToCore.Pmc.Solver.html#trvVarInfo"><span class="hs-identifier hs-var">trvVarInfo</span></a></span><span> </span><span class="annot"><span class="annottext">VarInfo
-&gt; IOEnv (Env DsGblEnv DsLclEnv) (ResidualCompleteMatches, VarInfo)
</span><a href="#local-6989586621681374522"><span class="hs-identifier hs-var">add_matches</span></a></span><span> </span><span class="annot"><span class="annottext">Nabla
</span><a href="#local-6989586621681374525"><span class="hs-identifier hs-var">nabla</span></a></span><span> </span><span class="annot"><span class="annottext">Id
</span><a href="#local-6989586621681374523"><span class="hs-identifier hs-var">x</span></a></span><span>
</span><span id="line-1329"></span><span>  </span><span class="hs-keyword">where</span><span>
</span><span id="line-1330"></span><span>    </span><span id="local-6989586621681374522"><span class="annot"><span class="annottext">add_matches :: VarInfo
-&gt; IOEnv (Env DsGblEnv DsLclEnv) (ResidualCompleteMatches, VarInfo)
</span><a href="#local-6989586621681374522"><span class="hs-identifier hs-var hs-var">add_matches</span></a></span></span><span> </span><span id="local-6989586621681374521"><span class="annot"><span class="annottext">vi :: VarInfo
</span><a href="#local-6989586621681374521"><span class="hs-identifier hs-var">vi</span></a></span></span><span class="hs-glyph">@</span><span class="annot"><a href="GHC.HsToCore.Pmc.Solver.Types.html#VI"><span class="hs-identifier hs-type">VI</span></a></span><span class="hs-special">{</span><span> </span><span class="annot"><span class="annottext">vi_rcm :: VarInfo -&gt; ResidualCompleteMatches
</span><a href="GHC.HsToCore.Pmc.Solver.Types.html#vi_rcm"><span class="hs-identifier hs-var">vi_rcm</span></a></span><span> </span><span class="hs-glyph">=</span><span> </span><span id="local-6989586621681374520"><span class="annot"><span class="annottext">ResidualCompleteMatches
</span><a href="#local-6989586621681374520"><span class="hs-identifier hs-var">rcm</span></a></span></span><span> </span><span class="hs-special">}</span><span>
</span><span id="line-1331"></span><span>      </span><span class="hs-comment">-- important common case, shaving down allocations of PmSeriesG by -5%</span><span>
</span><span id="line-1332"></span><span>      </span><span class="hs-glyph">|</span><span> </span><span class="annot"><span class="annottext">ResidualCompleteMatches -&gt; Bool
</span><a href="GHC.HsToCore.Pmc.Solver.Types.html#isRcmInitialised"><span class="hs-identifier hs-var">isRcmInitialised</span></a></span><span> </span><span class="annot"><span class="annottext">ResidualCompleteMatches
</span><a href="#local-6989586621681374520"><span class="hs-identifier hs-var">rcm</span></a></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">forall (f :: * -&gt; *) a. Applicative f =&gt; a -&gt; f a
</span><a href="../../base-4.16.4.0/src/GHC-Base.html#pure"><span class="hs-identifier hs-var">pure</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">ResidualCompleteMatches
</span><a href="#local-6989586621681374520"><span class="hs-identifier hs-var">rcm</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">VarInfo
</span><a href="#local-6989586621681374521"><span class="hs-identifier hs-var">vi</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-1333"></span><span>    </span><span class="annot"><a href="#local-6989586621681374522"><span class="hs-identifier hs-var">add_matches</span></a></span><span> </span><span id="local-6989586621681374518"><span class="annot"><span class="annottext">vi :: VarInfo
</span><a href="#local-6989586621681374518"><span class="hs-identifier hs-var">vi</span></a></span></span><span class="hs-glyph">@</span><span class="annot"><a href="GHC.HsToCore.Pmc.Solver.Types.html#VI"><span class="hs-identifier hs-type">VI</span></a></span><span class="hs-special">{</span><span> </span><span class="annot"><span class="annottext">vi_rcm :: VarInfo -&gt; ResidualCompleteMatches
</span><a href="GHC.HsToCore.Pmc.Solver.Types.html#vi_rcm"><span class="hs-identifier hs-var">vi_rcm</span></a></span><span> </span><span class="hs-glyph">=</span><span> </span><span id="local-6989586621681374517"><span class="annot"><span class="annottext">ResidualCompleteMatches
</span><a href="#local-6989586621681374517"><span class="hs-identifier hs-var">rcm</span></a></span></span><span> </span><span class="hs-special">}</span><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-keyword">do</span><span>
</span><span id="line-1334"></span><span>      </span><span id="local-6989586621681374516"><span class="annot"><span class="annottext">Type
</span><a href="#local-6989586621681374516"><span class="hs-identifier hs-var">norm_res_ty</span></a></span></span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">TyState -&gt; Type -&gt; DsM Type
</span><a href="GHC.HsToCore.Pmc.Solver.html#normaliseSourceTypeWHNF"><span class="hs-identifier hs-var">normaliseSourceTypeWHNF</span></a></span><span> </span><span class="annot"><span class="annottext">TyState
</span><a href="#local-6989586621681374524"><span class="hs-identifier hs-var">ty_st</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Id -&gt; Type
</span><a href="GHC.Types.Id.html#idType"><span class="hs-identifier hs-var">idType</span></a></span><span> </span><span class="annot"><span class="annottext">Id
</span><a href="#local-6989586621681374523"><span class="hs-identifier hs-var">x</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-1335"></span><span>      </span><span id="local-6989586621681374515"><span class="annot"><span class="annottext">FamInstEnvs
</span><a href="#local-6989586621681374515"><span class="hs-identifier hs-var">env</span></a></span></span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">DsM FamInstEnvs
</span><a href="GHC.HsToCore.Monad.html#dsGetFamInstEnvs"><span class="hs-identifier hs-var">dsGetFamInstEnvs</span></a></span><span>
</span><span id="line-1336"></span><span>      </span><span id="local-6989586621681374514"><span class="annot"><span class="annottext">ResidualCompleteMatches
</span><a href="#local-6989586621681374514"><span class="hs-identifier hs-var">rcm'</span></a></span></span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="hs-keyword">case</span><span> </span><span class="annot"><span class="annottext">FamInstEnvs -&gt; Type -&gt; Maybe (TyCon, ThetaType, Coercion)
</span><a href="GHC.HsToCore.Pmc.Solver.html#splitReprTyConApp_maybe"><span class="hs-identifier hs-var">splitReprTyConApp_maybe</span></a></span><span> </span><span class="annot"><span class="annottext">FamInstEnvs
</span><a href="#local-6989586621681374515"><span class="hs-identifier hs-var">env</span></a></span><span> </span><span class="annot"><span class="annottext">Type
</span><a href="#local-6989586621681374516"><span class="hs-identifier hs-var">norm_res_ty</span></a></span><span> </span><span class="hs-keyword">of</span><span>
</span><span id="line-1337"></span><span>        </span><span class="annot"><a href="../../base-4.16.4.0/src/GHC-Maybe.html#Just"><span class="hs-identifier hs-type">Just</span></a></span><span> </span><span class="hs-special">(</span><span id="local-6989586621681374512"><span class="annot"><span class="annottext">TyCon
</span><a href="#local-6989586621681374512"><span class="hs-identifier hs-var">rep_tc</span></a></span></span><span class="hs-special">,</span><span> </span><span id="local-6989586621681374511"><span class="annot"><span class="annottext">ThetaType
</span><a href="#local-6989586621681374511"><span class="hs-identifier hs-var">_args</span></a></span></span><span class="hs-special">,</span><span> </span><span id="local-6989586621681374510"><span class="annot"><span class="annottext">Coercion
</span><a href="#local-6989586621681374510"><span class="hs-identifier hs-var">_co</span></a></span></span><span class="hs-special">)</span><span>  </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="annottext">TyCon -&gt; ResidualCompleteMatches -&gt; DsM ResidualCompleteMatches
</span><a href="GHC.HsToCore.Pmc.Solver.html#addTyConMatches"><span class="hs-identifier hs-var">addTyConMatches</span></a></span><span> </span><span class="annot"><span class="annottext">TyCon
</span><a href="#local-6989586621681374512"><span class="hs-identifier hs-var">rep_tc</span></a></span><span> </span><span class="annot"><span class="annottext">ResidualCompleteMatches
</span><a href="#local-6989586621681374517"><span class="hs-identifier hs-var">rcm</span></a></span><span>
</span><span id="line-1338"></span><span>        </span><span class="annot"><span class="annottext">Maybe (TyCon, ThetaType, Coercion)
</span><a href="../../base-4.16.4.0/src/GHC-Maybe.html#Nothing"><span class="hs-identifier hs-var">Nothing</span></a></span><span>                    </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="annottext">ResidualCompleteMatches -&gt; DsM ResidualCompleteMatches
</span><a href="GHC.HsToCore.Pmc.Solver.html#addCompleteMatches"><span class="hs-identifier hs-var">addCompleteMatches</span></a></span><span> </span><span class="annot"><span class="annottext">ResidualCompleteMatches
</span><a href="#local-6989586621681374517"><span class="hs-identifier hs-var">rcm</span></a></span><span>
</span><span id="line-1339"></span><span>      </span><span class="annot"><span class="annottext">forall (f :: * -&gt; *) a. Applicative f =&gt; a -&gt; f a
</span><a href="../../base-4.16.4.0/src/GHC-Base.html#pure"><span class="hs-identifier hs-var">pure</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">ResidualCompleteMatches
</span><a href="#local-6989586621681374514"><span class="hs-identifier hs-var">rcm'</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">VarInfo
</span><a href="#local-6989586621681374518"><span class="hs-identifier hs-var">vi</span></a></span><span class="hs-special">{</span><span> </span><span class="annot"><span class="annottext">vi_rcm :: ResidualCompleteMatches
</span><a href="GHC.HsToCore.Pmc.Solver.Types.html#vi_rcm"><span class="hs-identifier hs-var">vi_rcm</span></a></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">ResidualCompleteMatches
</span><a href="#local-6989586621681374514"><span class="hs-identifier hs-var">rcm'</span></a></span><span> </span><span class="hs-special">}</span><span class="hs-special">)</span><span>
</span><span id="line-1340"></span><span>
</span><span id="line-1341"></span><span class="hs-comment">-- | Does a 'splitTyConApp_maybe' and then tries to look through a data family</span><span>
</span><span id="line-1342"></span><span class="hs-comment">-- application to find the representation TyCon, to which the data constructors</span><span>
</span><span id="line-1343"></span><span class="hs-comment">-- are attached. Returns the representation TyCon, the TyCon application args</span><span>
</span><span id="line-1344"></span><span class="hs-comment">-- and a representational coercion that will be Refl for non-data family apps.</span><span>
</span><span id="line-1345"></span><span class="annot"><a href="GHC.HsToCore.Pmc.Solver.html#splitReprTyConApp_maybe"><span class="hs-identifier hs-type">splitReprTyConApp_maybe</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><a href="GHC.Core.FamInstEnv.html#FamInstEnvs"><span class="hs-identifier hs-type">FamInstEnvs</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="GHC.Core.TyCo.Rep.html#Type"><span class="hs-identifier hs-type">Type</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="../../base-4.16.4.0/src/GHC-Maybe.html#Maybe"><span class="hs-identifier hs-type">Maybe</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="GHC.Core.TyCon.html#TyCon"><span class="hs-identifier hs-type">TyCon</span></a></span><span class="hs-special">,</span><span> </span><span class="hs-special">[</span><span class="annot"><a href="GHC.Core.TyCo.Rep.html#Type"><span class="hs-identifier hs-type">Type</span></a></span><span class="hs-special">]</span><span class="hs-special">,</span><span> </span><span class="annot"><a href="GHC.Core.TyCo.Rep.html#Coercion"><span class="hs-identifier hs-type">Coercion</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-1346"></span><span id="splitReprTyConApp_maybe"><span class="annot"><span class="annottext">splitReprTyConApp_maybe :: FamInstEnvs -&gt; Type -&gt; Maybe (TyCon, ThetaType, Coercion)
</span><a href="GHC.HsToCore.Pmc.Solver.html#splitReprTyConApp_maybe"><span class="hs-identifier hs-var hs-var">splitReprTyConApp_maybe</span></a></span></span><span> </span><span id="local-6989586621681374509"><span class="annot"><span class="annottext">FamInstEnvs
</span><a href="#local-6989586621681374509"><span class="hs-identifier hs-var">env</span></a></span></span><span> </span><span id="local-6989586621681374508"><span class="annot"><span class="annottext">Type
</span><a href="#local-6989586621681374508"><span class="hs-identifier hs-var">ty</span></a></span></span><span> </span><span class="hs-glyph">=</span><span>
</span><span id="line-1347"></span><span>  </span><span class="annot"><span class="annottext">forall a b c. (a -&gt; b -&gt; c) -&gt; (a, b) -&gt; c
</span><a href="../../base-4.16.4.0/src/Data-Tuple.html#uncurry"><span class="hs-identifier hs-var">uncurry</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">FamInstEnvs -&gt; TyCon -&gt; ThetaType -&gt; (TyCon, ThetaType, Coercion)
</span><a href="GHC.Tc.Instance.Family.html#tcLookupDataFamInst"><span class="hs-identifier hs-var">tcLookupDataFamInst</span></a></span><span> </span><span class="annot"><span class="annottext">FamInstEnvs
</span><a href="#local-6989586621681374509"><span class="hs-identifier hs-var">env</span></a></span><span class="hs-special">)</span><span> </span><span class="annot"><span class="annottext">forall (f :: * -&gt; *) a b. Functor f =&gt; (a -&gt; b) -&gt; f a -&gt; f b
</span><a href="../../base-4.16.4.0/src/Data-Functor.html#%3C%24%3E"><span class="hs-operator hs-var">&lt;$&gt;</span></a></span><span> </span><span class="annot"><span class="annottext">HasDebugCallStack =&gt; Type -&gt; Maybe (TyCon, ThetaType)
</span><a href="GHC.Core.Type.html#splitTyConApp_maybe"><span class="hs-identifier hs-var">splitTyConApp_maybe</span></a></span><span> </span><span class="annot"><span class="annottext">Type
</span><a href="#local-6989586621681374508"><span class="hs-identifier hs-var">ty</span></a></span><span>
</span><span id="line-1348"></span><span>
</span><span id="line-1349"></span><span class="hs-comment">-- | This is the |-Inst rule from the paper (section 4.5). Tries to</span><span>
</span><span id="line-1350"></span><span class="hs-comment">-- find an inhabitant in every complete set by instantiating with one their</span><span>
</span><span id="line-1351"></span><span class="hs-comment">-- constructors. If there is any complete set where we can't find an</span><span>
</span><span id="line-1352"></span><span class="hs-comment">-- inhabitant, the whole thing is uninhabited. It returns the updated 'VarInfo'</span><span>
</span><span id="line-1353"></span><span class="hs-comment">-- where all the attempted ConLike instantiations have been purged from the</span><span>
</span><span id="line-1354"></span><span class="hs-comment">-- 'ResidualCompleteMatches', which functions as a cache.</span><span>
</span><span id="line-1355"></span><span class="annot"><a href="GHC.HsToCore.Pmc.Solver.html#instCompleteSets"><span class="hs-identifier hs-type">instCompleteSets</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><span class="hs-identifier hs-type">Int</span></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="GHC.HsToCore.Pmc.Solver.Types.html#Nabla"><span class="hs-identifier hs-type">Nabla</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="GHC.HsToCore.Pmc.Solver.Types.html#VarInfo"><span class="hs-identifier hs-type">VarInfo</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="../../transformers-0.5.6.2/src/Control-Monad-Trans-Maybe.html#MaybeT"><span class="hs-identifier hs-type">MaybeT</span></a></span><span> </span><span class="annot"><a href="GHC.HsToCore.Types.html#DsM"><span class="hs-identifier hs-type">DsM</span></a></span><span> </span><span class="annot"><a href="GHC.HsToCore.Pmc.Solver.Types.html#VarInfo"><span class="hs-identifier hs-type">VarInfo</span></a></span><span>
</span><span id="line-1356"></span><span id="instCompleteSets"><span class="annot"><span class="annottext">instCompleteSets :: Int
-&gt; Nabla
-&gt; VarInfo
-&gt; MaybeT (IOEnv (Env DsGblEnv DsLclEnv)) VarInfo
</span><a href="GHC.HsToCore.Pmc.Solver.html#instCompleteSets"><span class="hs-identifier hs-var hs-var">instCompleteSets</span></a></span></span><span> </span><span id="local-6989586621681374505"><span class="annot"><span class="annottext">Int
</span><a href="#local-6989586621681374505"><span class="hs-identifier hs-var">fuel</span></a></span></span><span> </span><span id="local-6989586621681374504"><span class="annot"><span class="annottext">Nabla
</span><a href="#local-6989586621681374504"><span class="hs-identifier hs-var">nabla</span></a></span></span><span> </span><span id="local-6989586621681374503"><span class="annot"><span class="annottext">VarInfo
</span><a href="#local-6989586621681374503"><span class="hs-identifier hs-var">vi</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-keyword">do</span><span>
</span><span id="line-1357"></span><span>  </span><span class="hs-keyword">let</span><span> </span><span id="local-6989586621681374502"><span class="annot"><span class="annottext">x :: Id
</span><a href="#local-6989586621681374502"><span class="hs-identifier hs-var hs-var">x</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">VarInfo -&gt; Id
</span><a href="GHC.HsToCore.Pmc.Solver.Types.html#vi_id"><span class="hs-identifier hs-var">vi_id</span></a></span><span> </span><span class="annot"><span class="annottext">VarInfo
</span><a href="#local-6989586621681374503"><span class="hs-identifier hs-var">vi</span></a></span><span>
</span><span id="line-1358"></span><span>  </span><span class="hs-special">(</span><span id="local-6989586621681374501"><span class="annot"><span class="annottext">ResidualCompleteMatches
</span><a href="#local-6989586621681374501"><span class="hs-identifier hs-var">rcm</span></a></span></span><span class="hs-special">,</span><span> </span><span id="local-6989586621681374500"><span class="annot"><span class="annottext">Nabla
</span><a href="#local-6989586621681374500"><span class="hs-identifier hs-var">nabla</span></a></span></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">forall (t :: (* -&gt; *) -&gt; * -&gt; *) (m :: * -&gt; *) a.
(MonadTrans t, Monad m) =&gt;
m a -&gt; t m a
</span><a href="../../transformers-0.5.6.2/src/Control-Monad-Trans-Class.html#lift"><span class="hs-identifier hs-var">lift</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Nabla -&gt; Id -&gt; DsM (ResidualCompleteMatches, Nabla)
</span><a href="GHC.HsToCore.Pmc.Solver.html#addNormalisedTypeMatches"><span class="hs-identifier hs-var">addNormalisedTypeMatches</span></a></span><span> </span><span class="annot"><span class="annottext">Nabla
</span><a href="#local-6989586621681374504"><span class="hs-identifier hs-var">nabla</span></a></span><span> </span><span class="annot"><span class="annottext">Id
</span><a href="#local-6989586621681374502"><span class="hs-identifier hs-var">x</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-1359"></span><span>  </span><span id="local-6989586621681374499"><span class="annot"><span class="annottext">Nabla
</span><a href="#local-6989586621681374499"><span class="hs-identifier hs-var">nabla</span></a></span></span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">forall (t :: * -&gt; *) (m :: * -&gt; *) b a.
(Foldable t, Monad m) =&gt;
(b -&gt; a -&gt; m b) -&gt; b -&gt; t a -&gt; m b
</span><a href="../../base-4.16.4.0/src/Control-Monad.html#foldM"><span class="hs-identifier hs-var">foldM</span></a></span><span> </span><span class="hs-special">(</span><span class="hs-glyph">\</span><span id="local-6989586621681374498"><span class="annot"><span class="annottext">Nabla
</span><a href="#local-6989586621681374498"><span class="hs-identifier hs-var">nabla</span></a></span></span><span> </span><span id="local-6989586621681374497"><span class="annot"><span class="annottext">CompleteMatch
</span><a href="#local-6989586621681374497"><span class="hs-identifier hs-var">cls</span></a></span></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="annottext">Int
-&gt; Nabla
-&gt; Id
-&gt; CompleteMatch
-&gt; MaybeT (IOEnv (Env DsGblEnv DsLclEnv)) Nabla
</span><a href="GHC.HsToCore.Pmc.Solver.html#instCompleteSet"><span class="hs-identifier hs-var">instCompleteSet</span></a></span><span> </span><span class="annot"><span class="annottext">Int
</span><a href="#local-6989586621681374505"><span class="hs-identifier hs-var">fuel</span></a></span><span> </span><span class="annot"><span class="annottext">Nabla
</span><a href="#local-6989586621681374498"><span class="hs-identifier hs-var">nabla</span></a></span><span> </span><span class="annot"><span class="annottext">Id
</span><a href="#local-6989586621681374502"><span class="hs-identifier hs-var">x</span></a></span><span> </span><span class="annot"><span class="annottext">CompleteMatch
</span><a href="#local-6989586621681374497"><span class="hs-identifier hs-var">cls</span></a></span><span class="hs-special">)</span><span> </span><span class="annot"><span class="annottext">Nabla
</span><a href="#local-6989586621681374500"><span class="hs-identifier hs-var">nabla</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">ResidualCompleteMatches -&gt; [CompleteMatch]
</span><a href="GHC.HsToCore.Pmc.Solver.Types.html#getRcm"><span class="hs-identifier hs-var">getRcm</span></a></span><span> </span><span class="annot"><span class="annottext">ResidualCompleteMatches
</span><a href="#local-6989586621681374501"><span class="hs-identifier hs-var">rcm</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-1360"></span><span>  </span><span class="annot"><span class="annottext">forall (f :: * -&gt; *) a. Applicative f =&gt; a -&gt; f a
</span><a href="../../base-4.16.4.0/src/GHC-Base.html#pure"><span class="hs-identifier hs-var">pure</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">TmState -&gt; Id -&gt; VarInfo
</span><a href="GHC.HsToCore.Pmc.Solver.html#lookupVarInfo"><span class="hs-identifier hs-var">lookupVarInfo</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Nabla -&gt; TmState
</span><a href="GHC.HsToCore.Pmc.Solver.Types.html#nabla_tm_st"><span class="hs-identifier hs-var">nabla_tm_st</span></a></span><span> </span><span class="annot"><span class="annottext">Nabla
</span><a href="#local-6989586621681374499"><span class="hs-identifier hs-var">nabla</span></a></span><span class="hs-special">)</span><span> </span><span class="annot"><span class="annottext">Id
</span><a href="#local-6989586621681374502"><span class="hs-identifier hs-var">x</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-1361"></span><span>
</span><span id="line-1362"></span><span class="annot"><a href="GHC.HsToCore.Pmc.Solver.html#anyConLikeSolution"><span class="hs-identifier hs-type">anyConLikeSolution</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="hs-special">(</span><span class="annot"><a href="GHC.Core.ConLike.html#ConLike"><span class="hs-identifier hs-type">ConLike</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="hs-identifier hs-type">Bool</span></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-special">[</span><span class="annot"><a href="GHC.HsToCore.Pmc.Solver.Types.html#PmAltConApp"><span class="hs-identifier hs-type">PmAltConApp</span></a></span><span class="hs-special">]</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="hs-identifier hs-type">Bool</span></span><span>
</span><span id="line-1363"></span><span id="anyConLikeSolution"><span class="annot"><span class="annottext">anyConLikeSolution :: (ConLike -&gt; Bool) -&gt; [PmAltConApp] -&gt; Bool
</span><a href="GHC.HsToCore.Pmc.Solver.html#anyConLikeSolution"><span class="hs-identifier hs-var hs-var">anyConLikeSolution</span></a></span></span><span> </span><span id="local-6989586621681374493"><span class="annot"><span class="annottext">ConLike -&gt; Bool
</span><a href="#local-6989586621681374493"><span class="hs-identifier hs-var">p</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">forall (t :: * -&gt; *) a. Foldable t =&gt; (a -&gt; Bool) -&gt; t a -&gt; Bool
</span><a href="../../base-4.16.4.0/src/Data-Foldable.html#any"><span class="hs-identifier hs-var">any</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">PmAltCon -&gt; Bool
</span><a href="#local-6989586621681374492"><span class="hs-identifier hs-var">go</span></a></span><span> </span><span class="annot"><span class="annottext">forall b c a. (b -&gt; c) -&gt; (a -&gt; b) -&gt; a -&gt; c
</span><a href="../../base-4.16.4.0/src/GHC-Base.html#."><span class="hs-operator hs-var">.</span></a></span><span> </span><span class="annot"><span class="annottext">PmAltConApp -&gt; PmAltCon
</span><a href="GHC.HsToCore.Pmc.Solver.Types.html#paca_con"><span class="hs-identifier hs-var">paca_con</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-1364"></span><span>  </span><span class="hs-keyword">where</span><span>
</span><span id="line-1365"></span><span>    </span><span id="local-6989586621681374492"><span class="annot"><span class="annottext">go :: PmAltCon -&gt; Bool
</span><a href="#local-6989586621681374492"><span class="hs-identifier hs-var hs-var">go</span></a></span></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="GHC.HsToCore.Pmc.Solver.Types.html#PmAltConLike"><span class="hs-identifier hs-type">PmAltConLike</span></a></span><span> </span><span id="local-6989586621681374491"><span class="annot"><span class="annottext">ConLike
</span><a href="#local-6989586621681374491"><span class="hs-identifier hs-var">cl</span></a></span></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">ConLike -&gt; Bool
</span><a href="#local-6989586621681374493"><span class="hs-identifier hs-var">p</span></a></span><span> </span><span class="annot"><span class="annottext">ConLike
</span><a href="#local-6989586621681374491"><span class="hs-identifier hs-var">cl</span></a></span><span>
</span><span id="line-1366"></span><span>    </span><span class="annot"><a href="#local-6989586621681374492"><span class="hs-identifier hs-var">go</span></a></span><span> </span><span class="annot"><span class="annottext">PmAltCon
</span><span class="hs-identifier">_</span></span><span>                 </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">Bool
</span><span class="hs-identifier hs-var">False</span></span><span>
</span><span id="line-1367"></span><span>
</span><span id="line-1368"></span><span class="hs-comment">-- | @instCompleteSet fuel nabla x cls@ iterates over @cls@ until it finds</span><span>
</span><span id="line-1369"></span><span class="hs-comment">-- the first inhabited ConLike (as per 'instCon'). Any failed instantiation</span><span>
</span><span id="line-1370"></span><span class="hs-comment">-- attempts of a ConLike are recorded as negative information in the returned</span><span>
</span><span id="line-1371"></span><span class="hs-comment">-- 'Nabla', so that later calls to this function can skip repeatedly fruitless</span><span>
</span><span id="line-1372"></span><span class="hs-comment">-- instantiation of that same constructor.</span><span>
</span><span id="line-1373"></span><span class="hs-comment">--</span><span>
</span><span id="line-1374"></span><span class="hs-comment">-- Note that the returned Nabla is just a different representation of the</span><span>
</span><span id="line-1375"></span><span class="hs-comment">-- original Nabla, not a proper refinement! No positive information will be</span><span>
</span><span id="line-1376"></span><span class="hs-comment">-- added, only negative information from failed instantiation attempts,</span><span>
</span><span id="line-1377"></span><span class="hs-comment">-- entirely as an optimisation.</span><span>
</span><span id="line-1378"></span><span class="annot"><a href="GHC.HsToCore.Pmc.Solver.html#instCompleteSet"><span class="hs-identifier hs-type">instCompleteSet</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><span class="hs-identifier hs-type">Int</span></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="GHC.HsToCore.Pmc.Solver.Types.html#Nabla"><span class="hs-identifier hs-type">Nabla</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="GHC.Types.Var.html#Id"><span class="hs-identifier hs-type">Id</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="GHC.Types.CompleteMatch.html#CompleteMatch"><span class="hs-identifier hs-type">CompleteMatch</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="../../transformers-0.5.6.2/src/Control-Monad-Trans-Maybe.html#MaybeT"><span class="hs-identifier hs-type">MaybeT</span></a></span><span> </span><span class="annot"><a href="GHC.HsToCore.Types.html#DsM"><span class="hs-identifier hs-type">DsM</span></a></span><span> </span><span class="annot"><a href="GHC.HsToCore.Pmc.Solver.Types.html#Nabla"><span class="hs-identifier hs-type">Nabla</span></a></span><span>
</span><span id="line-1379"></span><span id="instCompleteSet"><span class="annot"><span class="annottext">instCompleteSet :: Int
-&gt; Nabla
-&gt; Id
-&gt; CompleteMatch
-&gt; MaybeT (IOEnv (Env DsGblEnv DsLclEnv)) Nabla
</span><a href="GHC.HsToCore.Pmc.Solver.html#instCompleteSet"><span class="hs-identifier hs-var hs-var">instCompleteSet</span></a></span></span><span> </span><span id="local-6989586621681374490"><span class="annot"><span class="annottext">Int
</span><a href="#local-6989586621681374490"><span class="hs-identifier hs-var">fuel</span></a></span></span><span> </span><span id="local-6989586621681374489"><span class="annot"><span class="annottext">Nabla
</span><a href="#local-6989586621681374489"><span class="hs-identifier hs-var">nabla</span></a></span></span><span> </span><span id="local-6989586621681374488"><span class="annot"><span class="annottext">Id
</span><a href="#local-6989586621681374488"><span class="hs-identifier hs-var">x</span></a></span></span><span> </span><span id="local-6989586621681374487"><span class="annot"><span class="annottext">CompleteMatch
</span><a href="#local-6989586621681374487"><span class="hs-identifier hs-var">cs</span></a></span></span><span>
</span><span id="line-1380"></span><span>  </span><span class="hs-glyph">|</span><span> </span><span class="annot"><span class="annottext">(ConLike -&gt; Bool) -&gt; [PmAltConApp] -&gt; Bool
</span><a href="GHC.HsToCore.Pmc.Solver.html#anyConLikeSolution"><span class="hs-identifier hs-var">anyConLikeSolution</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">forall a. Uniquable a =&gt; a -&gt; UniqDSet a -&gt; Bool
</span><a href="GHC.Types.Unique.DSet.html#elementOfUniqDSet"><span class="hs-operator hs-var">`elementOfUniqDSet`</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">CompleteMatch -&gt; UniqDSet ConLike
</span><a href="GHC.Types.CompleteMatch.html#cmConLikes"><span class="hs-identifier hs-var">cmConLikes</span></a></span><span> </span><span class="annot"><span class="annottext">CompleteMatch
</span><a href="#local-6989586621681374487"><span class="hs-identifier hs-var">cs</span></a></span><span class="hs-special">)</span><span class="hs-special">)</span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">VarInfo -&gt; [PmAltConApp]
</span><a href="GHC.HsToCore.Pmc.Solver.Types.html#vi_pos"><span class="hs-identifier hs-var">vi_pos</span></a></span><span> </span><span class="annot"><span class="annottext">VarInfo
</span><a href="#local-6989586621681374485"><span class="hs-identifier hs-var">vi</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-1381"></span><span>  </span><span class="hs-comment">-- No need to instantiate a constructor of this COMPLETE set if we already</span><span>
</span><span id="line-1382"></span><span>  </span><span class="hs-comment">-- have a solution!</span><span>
</span><span id="line-1383"></span><span>  </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">forall (f :: * -&gt; *) a. Applicative f =&gt; a -&gt; f a
</span><a href="../../base-4.16.4.0/src/GHC-Base.html#pure"><span class="hs-identifier hs-var">pure</span></a></span><span> </span><span class="annot"><span class="annottext">Nabla
</span><a href="#local-6989586621681374489"><span class="hs-identifier hs-var">nabla</span></a></span><span>
</span><span id="line-1384"></span><span>  </span><span class="hs-glyph">|</span><span> </span><span class="annot"><span class="annottext">Bool -&gt; Bool
</span><span class="hs-identifier hs-var">not</span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Type -&gt; CompleteMatch -&gt; Bool
</span><a href="GHC.Types.CompleteMatch.html#completeMatchAppliesAtType"><span class="hs-identifier hs-var">completeMatchAppliesAtType</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Id -&gt; Type
</span><a href="GHC.Types.Var.html#varType"><span class="hs-identifier hs-var">varType</span></a></span><span> </span><span class="annot"><span class="annottext">Id
</span><a href="#local-6989586621681374488"><span class="hs-identifier hs-var">x</span></a></span><span class="hs-special">)</span><span> </span><span class="annot"><span class="annottext">CompleteMatch
</span><a href="#local-6989586621681374487"><span class="hs-identifier hs-var">cs</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-1385"></span><span>  </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">forall (f :: * -&gt; *) a. Applicative f =&gt; a -&gt; f a
</span><a href="../../base-4.16.4.0/src/GHC-Base.html#pure"><span class="hs-identifier hs-var">pure</span></a></span><span> </span><span class="annot"><span class="annottext">Nabla
</span><a href="#local-6989586621681374489"><span class="hs-identifier hs-var">nabla</span></a></span><span>
</span><span id="line-1386"></span><span>  </span><span class="hs-glyph">|</span><span> </span><span class="annot"><span class="annottext">Bool
</span><a href="../../base-4.16.4.0/src/GHC-Base.html#otherwise"><span class="hs-identifier hs-var">otherwise</span></a></span><span>
</span><span id="line-1387"></span><span>  </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">Nabla -&gt; [ConLike] -&gt; MaybeT (IOEnv (Env DsGblEnv DsLclEnv)) Nabla
</span><a href="#local-6989586621681374482"><span class="hs-identifier hs-var">go</span></a></span><span> </span><span class="annot"><span class="annottext">Nabla
</span><a href="#local-6989586621681374489"><span class="hs-identifier hs-var">nabla</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">CompleteMatch -&gt; [ConLike]
</span><a href="#local-6989586621681374481"><span class="hs-identifier hs-var">sorted_candidates</span></a></span><span> </span><span class="annot"><span class="annottext">CompleteMatch
</span><a href="#local-6989586621681374487"><span class="hs-identifier hs-var">cs</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-1388"></span><span>  </span><span class="hs-keyword">where</span><span>
</span><span id="line-1389"></span><span>    </span><span id="local-6989586621681374485"><span class="annot"><span class="annottext">vi :: VarInfo
</span><a href="#local-6989586621681374485"><span class="hs-identifier hs-var hs-var">vi</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">TmState -&gt; Id -&gt; VarInfo
</span><a href="GHC.HsToCore.Pmc.Solver.html#lookupVarInfo"><span class="hs-identifier hs-var">lookupVarInfo</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Nabla -&gt; TmState
</span><a href="GHC.HsToCore.Pmc.Solver.Types.html#nabla_tm_st"><span class="hs-identifier hs-var">nabla_tm_st</span></a></span><span> </span><span class="annot"><span class="annottext">Nabla
</span><a href="#local-6989586621681374489"><span class="hs-identifier hs-var">nabla</span></a></span><span class="hs-special">)</span><span> </span><span class="annot"><span class="annottext">Id
</span><a href="#local-6989586621681374488"><span class="hs-identifier hs-var">x</span></a></span><span>
</span><span id="line-1390"></span><span>
</span><span id="line-1391"></span><span>    </span><span class="annot"><a href="#local-6989586621681374481"><span class="hs-identifier hs-type">sorted_candidates</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><a href="GHC.Types.CompleteMatch.html#CompleteMatch"><span class="hs-identifier hs-type">CompleteMatch</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-special">[</span><span class="annot"><a href="GHC.Core.ConLike.html#ConLike"><span class="hs-identifier hs-type">ConLike</span></a></span><span class="hs-special">]</span><span>
</span><span id="line-1392"></span><span>    </span><span id="local-6989586621681374481"><span class="annot"><span class="annottext">sorted_candidates :: CompleteMatch -&gt; [ConLike]
</span><a href="#local-6989586621681374481"><span class="hs-identifier hs-var hs-var">sorted_candidates</span></a></span></span><span> </span><span id="local-6989586621681374480"><span class="annot"><span class="annottext">CompleteMatch
</span><a href="#local-6989586621681374480"><span class="hs-identifier hs-var">cm</span></a></span></span><span>
</span><span id="line-1393"></span><span>      </span><span class="hs-comment">-- If there aren't many candidates, we can try to sort them by number of</span><span>
</span><span id="line-1394"></span><span>      </span><span class="hs-comment">-- strict fields, type constraints, etc., so that we are fast in the</span><span>
</span><span id="line-1395"></span><span>      </span><span class="hs-comment">-- common case</span><span>
</span><span id="line-1396"></span><span>      </span><span class="hs-comment">-- (either many simple constructors *or* few &quot;complicated&quot; ones).</span><span>
</span><span id="line-1397"></span><span>      </span><span class="hs-glyph">|</span><span> </span><span class="annot"><span class="annottext">forall a. UniqDSet a -&gt; Int
</span><a href="GHC.Types.Unique.DSet.html#sizeUniqDSet"><span class="hs-identifier hs-var">sizeUniqDSet</span></a></span><span> </span><span class="annot"><span class="annottext">UniqDSet ConLike
</span><a href="#local-6989586621681374478"><span class="hs-identifier hs-var">cs</span></a></span><span> </span><span class="annot"><span class="annottext">forall a. Ord a =&gt; a -&gt; a -&gt; Bool
</span><span class="hs-operator hs-var">&lt;=</span></span><span> </span><span class="annot"><span class="annottext">Int
</span><span class="hs-number">5</span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">forall a. (a -&gt; a -&gt; Ordering) -&gt; [a] -&gt; [a]
</span><a href="../../base-4.16.4.0/src/Data-OldList.html#sortBy"><span class="hs-identifier hs-var">sortBy</span></a></span><span> </span><span class="annot"><span class="annottext">ConLike -&gt; ConLike -&gt; Ordering
</span><a href="GHC.HsToCore.Pmc.Solver.html#compareConLikeTestability"><span class="hs-identifier hs-var">compareConLikeTestability</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">forall a. UniqDSet a -&gt; [a]
</span><a href="GHC.Types.Unique.DSet.html#uniqDSetToList"><span class="hs-identifier hs-var">uniqDSetToList</span></a></span><span> </span><span class="annot"><span class="annottext">UniqDSet ConLike
</span><a href="#local-6989586621681374478"><span class="hs-identifier hs-var">cs</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-1398"></span><span>      </span><span class="hs-glyph">|</span><span> </span><span class="annot"><span class="annottext">Bool
</span><a href="../../base-4.16.4.0/src/GHC-Base.html#otherwise"><span class="hs-identifier hs-var">otherwise</span></a></span><span>            </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">forall a. UniqDSet a -&gt; [a]
</span><a href="GHC.Types.Unique.DSet.html#uniqDSetToList"><span class="hs-identifier hs-var">uniqDSetToList</span></a></span><span> </span><span class="annot"><span class="annottext">UniqDSet ConLike
</span><a href="#local-6989586621681374478"><span class="hs-identifier hs-var">cs</span></a></span><span>
</span><span id="line-1399"></span><span>      </span><span class="hs-keyword">where</span><span> </span><span id="local-6989586621681374478"><span class="annot"><span class="annottext">cs :: UniqDSet ConLike
</span><a href="#local-6989586621681374478"><span class="hs-identifier hs-var hs-var">cs</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">CompleteMatch -&gt; UniqDSet ConLike
</span><a href="GHC.Types.CompleteMatch.html#cmConLikes"><span class="hs-identifier hs-var">cmConLikes</span></a></span><span> </span><span class="annot"><span class="annottext">CompleteMatch
</span><a href="#local-6989586621681374480"><span class="hs-identifier hs-var">cm</span></a></span><span>
</span><span id="line-1400"></span><span>
</span><span id="line-1401"></span><span>    </span><span class="annot"><a href="#local-6989586621681374482"><span class="hs-identifier hs-type">go</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><a href="GHC.HsToCore.Pmc.Solver.Types.html#Nabla"><span class="hs-identifier hs-type">Nabla</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-special">[</span><span class="annot"><a href="GHC.Core.ConLike.html#ConLike"><span class="hs-identifier hs-type">ConLike</span></a></span><span class="hs-special">]</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="../../transformers-0.5.6.2/src/Control-Monad-Trans-Maybe.html#MaybeT"><span class="hs-identifier hs-type">MaybeT</span></a></span><span> </span><span class="annot"><a href="GHC.HsToCore.Types.html#DsM"><span class="hs-identifier hs-type">DsM</span></a></span><span> </span><span class="annot"><a href="GHC.HsToCore.Pmc.Solver.Types.html#Nabla"><span class="hs-identifier hs-type">Nabla</span></a></span><span>
</span><span id="line-1402"></span><span>    </span><span id="local-6989586621681374482"><span class="annot"><span class="annottext">go :: Nabla -&gt; [ConLike] -&gt; MaybeT (IOEnv (Env DsGblEnv DsLclEnv)) Nabla
</span><a href="#local-6989586621681374482"><span class="hs-identifier hs-var hs-var">go</span></a></span></span><span> </span><span class="annot"><span class="annottext">Nabla
</span><span class="hs-identifier">_</span></span><span>     </span><span class="hs-special">[</span><span class="hs-special">]</span><span>         </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">forall (m :: * -&gt; *) a. MonadPlus m =&gt; m a
</span><a href="../../base-4.16.4.0/src/GHC-Base.html#mzero"><span class="hs-identifier hs-var">mzero</span></a></span><span>
</span><span id="line-1403"></span><span>    </span><span class="annot"><a href="#local-6989586621681374482"><span class="hs-identifier hs-var">go</span></a></span><span> </span><span id="local-6989586621681374475"><span class="annot"><span class="annottext">Nabla
</span><a href="#local-6989586621681374475"><span class="hs-identifier hs-var">nabla</span></a></span></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="GHC.Core.ConLike.html#RealDataCon"><span class="hs-identifier hs-type">RealDataCon</span></a></span><span> </span><span id="local-6989586621681374474"><span class="annot"><span class="annottext">DataCon
</span><a href="#local-6989586621681374474"><span class="hs-identifier hs-var">dc</span></a></span></span><span class="annot"><span class="hs-glyph hs-type">:</span></span><span class="annot"><span class="annottext">[ConLike]
</span><span class="hs-identifier">_</span></span><span class="hs-special">)</span><span>
</span><span id="line-1404"></span><span>      </span><span class="hs-comment">-- See Note [DataCons that are definitely inhabitable]</span><span>
</span><span id="line-1405"></span><span>      </span><span class="hs-comment">-- Recall that dc can't be in vi_neg, because then it would be</span><span>
</span><span id="line-1406"></span><span>      </span><span class="hs-comment">-- deleted from the residual COMPLETE set.</span><span>
</span><span id="line-1407"></span><span>      </span><span class="hs-glyph">|</span><span> </span><span class="annot"><span class="annottext">DataCon -&gt; Bool
</span><a href="GHC.HsToCore.Pmc.Solver.html#isDataConTriviallyInhabited"><span class="hs-identifier hs-var">isDataConTriviallyInhabited</span></a></span><span> </span><span class="annot"><span class="annottext">DataCon
</span><a href="#local-6989586621681374474"><span class="hs-identifier hs-var">dc</span></a></span><span>
</span><span id="line-1408"></span><span>      </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">forall (f :: * -&gt; *) a. Applicative f =&gt; a -&gt; f a
</span><a href="../../base-4.16.4.0/src/GHC-Base.html#pure"><span class="hs-identifier hs-var">pure</span></a></span><span> </span><span class="annot"><span class="annottext">Nabla
</span><a href="#local-6989586621681374475"><span class="hs-identifier hs-var">nabla</span></a></span><span>
</span><span id="line-1409"></span><span>    </span><span class="annot"><a href="#local-6989586621681374482"><span class="hs-identifier hs-var">go</span></a></span><span> </span><span id="local-6989586621681374472"><span class="annot"><span class="annottext">Nabla
</span><a href="#local-6989586621681374472"><span class="hs-identifier hs-var">nabla</span></a></span></span><span> </span><span class="hs-special">(</span><span id="local-6989586621681374471"><span class="annot"><span class="annottext">ConLike
</span><a href="#local-6989586621681374471"><span class="hs-identifier hs-var">con</span></a></span></span><span class="annot"><span class="hs-glyph hs-type">:</span></span><span id="local-6989586621681374470"><span class="annot"><span class="annottext">[ConLike]
</span><a href="#local-6989586621681374470"><span class="hs-identifier hs-var">cons</span></a></span></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-keyword">do</span><span>
</span><span id="line-1410"></span><span>      </span><span class="hs-keyword">let</span><span> </span><span id="local-6989586621681374469"><span class="annot"><span class="annottext">x :: Id
</span><a href="#local-6989586621681374469"><span class="hs-identifier hs-var hs-var">x</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">VarInfo -&gt; Id
</span><a href="GHC.HsToCore.Pmc.Solver.Types.html#vi_id"><span class="hs-identifier hs-var">vi_id</span></a></span><span> </span><span class="annot"><span class="annottext">VarInfo
</span><a href="#local-6989586621681374485"><span class="hs-identifier hs-var">vi</span></a></span><span>
</span><span id="line-1411"></span><span>      </span><span class="hs-keyword">let</span><span> </span><span id="local-6989586621681374468"><span class="annot"><span class="annottext">recur_not_con :: MaybeT (IOEnv (Env DsGblEnv DsLclEnv)) Nabla
</span><a href="#local-6989586621681374468"><span class="hs-identifier hs-var hs-var">recur_not_con</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-keyword">do</span><span>
</span><span id="line-1412"></span><span>            </span><span id="local-6989586621681374467"><span class="annot"><span class="annottext">Nabla
</span><a href="#local-6989586621681374467"><span class="hs-identifier hs-var">nabla'</span></a></span></span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">Nabla
-&gt; Id -&gt; PmAltCon -&gt; MaybeT (IOEnv (Env DsGblEnv DsLclEnv)) Nabla
</span><a href="GHC.HsToCore.Pmc.Solver.html#addNotConCt"><span class="hs-identifier hs-var">addNotConCt</span></a></span><span> </span><span class="annot"><span class="annottext">Nabla
</span><a href="#local-6989586621681374472"><span class="hs-identifier hs-var">nabla</span></a></span><span> </span><span class="annot"><span class="annottext">Id
</span><a href="#local-6989586621681374469"><span class="hs-identifier hs-var">x</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">ConLike -&gt; PmAltCon
</span><a href="GHC.HsToCore.Pmc.Solver.Types.html#PmAltConLike"><span class="hs-identifier hs-var">PmAltConLike</span></a></span><span> </span><span class="annot"><span class="annottext">ConLike
</span><a href="#local-6989586621681374471"><span class="hs-identifier hs-var">con</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-1413"></span><span>            </span><span class="annot"><span class="annottext">Nabla -&gt; [ConLike] -&gt; MaybeT (IOEnv (Env DsGblEnv DsLclEnv)) Nabla
</span><a href="#local-6989586621681374482"><span class="hs-identifier hs-var">go</span></a></span><span> </span><span class="annot"><span class="annottext">Nabla
</span><a href="#local-6989586621681374467"><span class="hs-identifier hs-var">nabla'</span></a></span><span> </span><span class="annot"><span class="annottext">[ConLike]
</span><a href="#local-6989586621681374470"><span class="hs-identifier hs-var">cons</span></a></span><span>
</span><span id="line-1414"></span><span>      </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Nabla
</span><a href="#local-6989586621681374472"><span class="hs-identifier hs-var">nabla</span></a></span><span> </span><span class="annot"><span class="annottext">forall (f :: * -&gt; *) a b. Functor f =&gt; a -&gt; f b -&gt; f a
</span><a href="../../base-4.16.4.0/src/GHC-Base.html#%3C%24"><span class="hs-operator hs-var">&lt;$</span></a></span><span> </span><span class="annot"><span class="annottext">Int
-&gt; Nabla
-&gt; Id
-&gt; ConLike
-&gt; MaybeT (IOEnv (Env DsGblEnv DsLclEnv)) Nabla
</span><a href="GHC.HsToCore.Pmc.Solver.html#instCon"><span class="hs-identifier hs-var">instCon</span></a></span><span> </span><span class="annot"><span class="annottext">Int
</span><a href="#local-6989586621681374490"><span class="hs-identifier hs-var">fuel</span></a></span><span> </span><span class="annot"><span class="annottext">Nabla
</span><a href="#local-6989586621681374472"><span class="hs-identifier hs-var">nabla</span></a></span><span> </span><span class="annot"><span class="annottext">Id
</span><a href="#local-6989586621681374469"><span class="hs-identifier hs-var">x</span></a></span><span> </span><span class="annot"><span class="annottext">ConLike
</span><a href="#local-6989586621681374471"><span class="hs-identifier hs-var">con</span></a></span><span class="hs-special">)</span><span> </span><span class="hs-comment">-- return the original nabla, not the</span><span>
</span><span id="line-1415"></span><span>                                          </span><span class="hs-comment">-- refined one!</span><span>
</span><span id="line-1416"></span><span>            </span><span class="annot"><span class="annottext">forall (f :: * -&gt; *) a. Alternative f =&gt; f a -&gt; f a -&gt; f a
</span><a href="../../base-4.16.4.0/src/GHC-Base.html#%3C%7C%3E"><span class="hs-operator hs-var">&lt;|&gt;</span></a></span><span> </span><span class="annot"><span class="annottext">MaybeT (IOEnv (Env DsGblEnv DsLclEnv)) Nabla
</span><a href="#local-6989586621681374468"><span class="hs-identifier hs-var">recur_not_con</span></a></span><span> </span><span class="hs-comment">-- Assume that x can't be con. Encode that fact</span><span>
</span><span id="line-1417"></span><span>                              </span><span class="hs-comment">-- with addNotConCt and recur.</span><span>
</span><span id="line-1418"></span><span>
</span><span id="line-1419"></span><span class="hs-comment">-- | Is this 'DataCon' trivially inhabited, that is, without needing to perform</span><span>
</span><span id="line-1420"></span><span class="hs-comment">-- any inhabitation testing because of strict/unlifted fields or type</span><span>
</span><span id="line-1421"></span><span class="hs-comment">-- equalities? See Note [DataCons that are definitely inhabitable]</span><span>
</span><span id="line-1422"></span><span class="annot"><a href="GHC.HsToCore.Pmc.Solver.html#isDataConTriviallyInhabited"><span class="hs-identifier hs-type">isDataConTriviallyInhabited</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><a href="GHC.Core.DataCon.html#DataCon"><span class="hs-identifier hs-type">DataCon</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="hs-identifier hs-type">Bool</span></span><span>
</span><span id="line-1423"></span><span id="isDataConTriviallyInhabited"><span class="annot"><span class="annottext">isDataConTriviallyInhabited :: DataCon -&gt; Bool
</span><a href="GHC.HsToCore.Pmc.Solver.html#isDataConTriviallyInhabited"><span class="hs-identifier hs-var hs-var">isDataConTriviallyInhabited</span></a></span></span><span> </span><span id="local-6989586621681374464"><span class="annot"><span class="annottext">DataCon
</span><a href="#local-6989586621681374464"><span class="hs-identifier hs-var">dc</span></a></span></span><span>
</span><span id="line-1424"></span><span>  </span><span class="hs-glyph">|</span><span> </span><span class="annot"><span class="annottext">TyCon -&gt; Bool
</span><a href="GHC.HsToCore.Pmc.Solver.html#isTyConTriviallyInhabited"><span class="hs-identifier hs-var">isTyConTriviallyInhabited</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">DataCon -&gt; TyCon
</span><a href="GHC.Core.DataCon.html#dataConTyCon"><span class="hs-identifier hs-var">dataConTyCon</span></a></span><span> </span><span class="annot"><span class="annottext">DataCon
</span><a href="#local-6989586621681374464"><span class="hs-identifier hs-var">dc</span></a></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">Bool
</span><span class="hs-identifier hs-var">True</span></span><span>
</span><span id="line-1425"></span><span class="annot"><a href="GHC.HsToCore.Pmc.Solver.html#isDataConTriviallyInhabited"><span class="hs-identifier hs-var">isDataConTriviallyInhabited</span></a></span><span> </span><span id="local-6989586621681374462"><span class="annot"><span class="annottext">DataCon
</span><a href="#local-6989586621681374462"><span class="hs-identifier hs-var">dc</span></a></span></span><span> </span><span class="hs-glyph">=</span><span>
</span><span id="line-1426"></span><span>  </span><span class="annot"><span class="annottext">forall (t :: * -&gt; *) a. Foldable t =&gt; t a -&gt; Bool
</span><a href="../../base-4.16.4.0/src/Data-Foldable.html#null"><span class="hs-identifier hs-var">null</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">DataCon -&gt; ThetaType
</span><a href="GHC.Core.DataCon.html#dataConTheta"><span class="hs-identifier hs-var">dataConTheta</span></a></span><span> </span><span class="annot"><span class="annottext">DataCon
</span><a href="#local-6989586621681374462"><span class="hs-identifier hs-var">dc</span></a></span><span class="hs-special">)</span><span> </span><span class="annot"><span class="annottext">Bool -&gt; Bool -&gt; Bool
</span><span class="hs-operator hs-var">&amp;&amp;</span></span><span>         </span><span class="hs-comment">-- (1)</span><span>
</span><span id="line-1427"></span><span>  </span><span class="annot"><span class="annottext">forall (t :: * -&gt; *) a. Foldable t =&gt; t a -&gt; Bool
</span><a href="../../base-4.16.4.0/src/Data-Foldable.html#null"><span class="hs-identifier hs-var">null</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">DataCon -&gt; [HsImplBang]
</span><a href="GHC.Core.DataCon.html#dataConImplBangs"><span class="hs-identifier hs-var">dataConImplBangs</span></a></span><span> </span><span class="annot"><span class="annottext">DataCon
</span><a href="#local-6989586621681374462"><span class="hs-identifier hs-var">dc</span></a></span><span class="hs-special">)</span><span> </span><span class="annot"><span class="annottext">Bool -&gt; Bool -&gt; Bool
</span><span class="hs-operator hs-var">&amp;&amp;</span></span><span>     </span><span class="hs-comment">-- (2)</span><span>
</span><span id="line-1428"></span><span>  </span><span class="annot"><span class="annottext">forall (t :: * -&gt; *) a. Foldable t =&gt; t a -&gt; Bool
</span><a href="../../base-4.16.4.0/src/Data-Foldable.html#null"><span class="hs-identifier hs-var">null</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">DataCon -&gt; ThetaType
</span><a href="GHC.HsToCore.Pmc.Solver.html#dataConUnliftedFieldTys"><span class="hs-identifier hs-var">dataConUnliftedFieldTys</span></a></span><span> </span><span class="annot"><span class="annottext">DataCon
</span><a href="#local-6989586621681374462"><span class="hs-identifier hs-var">dc</span></a></span><span class="hs-special">)</span><span> </span><span class="hs-comment">-- (3)</span><span>
</span><span id="line-1429"></span><span>
</span><span id="line-1430"></span><span class="annot"><a href="GHC.HsToCore.Pmc.Solver.html#dataConUnliftedFieldTys"><span class="hs-identifier hs-type">dataConUnliftedFieldTys</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><a href="GHC.Core.DataCon.html#DataCon"><span class="hs-identifier hs-type">DataCon</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-special">[</span><span class="annot"><a href="GHC.Core.TyCo.Rep.html#Type"><span class="hs-identifier hs-type">Type</span></a></span><span class="hs-special">]</span><span>
</span><span id="line-1431"></span><span id="dataConUnliftedFieldTys"><span class="annot"><span class="annottext">dataConUnliftedFieldTys :: DataCon -&gt; ThetaType
</span><a href="GHC.HsToCore.Pmc.Solver.html#dataConUnliftedFieldTys"><span class="hs-identifier hs-var hs-var">dataConUnliftedFieldTys</span></a></span></span><span> </span><span class="hs-glyph">=</span><span>
</span><span id="line-1432"></span><span>  </span><span class="hs-comment">-- A levity polymorphic field requires an inhabitation test, hence compare to</span><span>
</span><span id="line-1433"></span><span>  </span><span class="hs-comment">-- @Just True@</span><span>
</span><span id="line-1434"></span><span>  </span><span class="annot"><span class="annottext">forall a. (a -&gt; Bool) -&gt; [a] -&gt; [a]
</span><a href="../../base-4.16.4.0/src/GHC-List.html#filter"><span class="hs-identifier hs-var">filter</span></a></span><span> </span><span class="hs-special">(</span><span class="hs-special">(</span><span class="annot"><span class="annottext">forall a. Eq a =&gt; a -&gt; a -&gt; Bool
</span><span class="hs-operator hs-var">==</span></span><span> </span><span class="annot"><span class="annottext">forall a. a -&gt; Maybe a
</span><a href="../../base-4.16.4.0/src/GHC-Maybe.html#Just"><span class="hs-identifier hs-var">Just</span></a></span><span> </span><span class="annot"><span class="annottext">Bool
</span><span class="hs-identifier hs-var">True</span></span><span class="hs-special">)</span><span> </span><span class="annot"><span class="annottext">forall b c a. (b -&gt; c) -&gt; (a -&gt; b) -&gt; a -&gt; c
</span><a href="../../base-4.16.4.0/src/GHC-Base.html#."><span class="hs-operator hs-var">.</span></a></span><span> </span><span class="annot"><span class="annottext">HasDebugCallStack =&gt; Type -&gt; Maybe Bool
</span><a href="GHC.Core.Type.html#isLiftedType_maybe"><span class="hs-identifier hs-var">isLiftedType_maybe</span></a></span><span class="hs-special">)</span><span> </span><span class="annot"><span class="annottext">forall b c a. (b -&gt; c) -&gt; (a -&gt; b) -&gt; a -&gt; c
</span><a href="../../base-4.16.4.0/src/GHC-Base.html#."><span class="hs-operator hs-var">.</span></a></span><span> </span><span class="annot"><span class="annottext">forall a b. (a -&gt; b) -&gt; [a] -&gt; [b]
</span><a href="../../base-4.16.4.0/src/GHC-Base.html#map"><span class="hs-identifier hs-var">map</span></a></span><span> </span><span class="annot"><span class="annottext">forall a. Scaled a -&gt; a
</span><a href="GHC.Core.TyCo.Rep.html#scaledThing"><span class="hs-identifier hs-var">scaledThing</span></a></span><span> </span><span class="annot"><span class="annottext">forall b c a. (b -&gt; c) -&gt; (a -&gt; b) -&gt; a -&gt; c
</span><a href="../../base-4.16.4.0/src/GHC-Base.html#."><span class="hs-operator hs-var">.</span></a></span><span> </span><span class="annot"><span class="annottext">DataCon -&gt; [Scaled Type]
</span><a href="GHC.Core.DataCon.html#dataConOrigArgTys"><span class="hs-identifier hs-var">dataConOrigArgTys</span></a></span><span>
</span><span id="line-1435"></span><span>
</span><span id="line-1436"></span><span class="annot"><a href="GHC.HsToCore.Pmc.Solver.html#isTyConTriviallyInhabited"><span class="hs-identifier hs-type">isTyConTriviallyInhabited</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><a href="GHC.Core.TyCon.html#TyCon"><span class="hs-identifier hs-type">TyCon</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="hs-identifier hs-type">Bool</span></span><span>
</span><span id="line-1437"></span><span id="isTyConTriviallyInhabited"><span class="annot"><span class="annottext">isTyConTriviallyInhabited :: TyCon -&gt; Bool
</span><a href="GHC.HsToCore.Pmc.Solver.html#isTyConTriviallyInhabited"><span class="hs-identifier hs-var hs-var">isTyConTriviallyInhabited</span></a></span></span><span> </span><span id="local-6989586621681374455"><span class="annot"><span class="annottext">TyCon
</span><a href="#local-6989586621681374455"><span class="hs-identifier hs-var">tc</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">forall a. Uniquable a =&gt; a -&gt; UniqSet a -&gt; Bool
</span><a href="GHC.Types.Unique.Set.html#elementOfUniqSet"><span class="hs-identifier hs-var">elementOfUniqSet</span></a></span><span> </span><span class="annot"><span class="annottext">TyCon
</span><a href="#local-6989586621681374455"><span class="hs-identifier hs-var">tc</span></a></span><span> </span><span class="annot"><span class="annottext">UniqSet TyCon
</span><a href="GHC.HsToCore.Pmc.Solver.html#triviallyInhabitedTyCons"><span class="hs-identifier hs-var">triviallyInhabitedTyCons</span></a></span><span>
</span><span id="line-1438"></span><span>
</span><span id="line-1439"></span><span class="hs-comment">-- | All these types are trivially inhabited</span><span>
</span><span id="line-1440"></span><span class="annot"><a href="GHC.HsToCore.Pmc.Solver.html#triviallyInhabitedTyCons"><span class="hs-identifier hs-type">triviallyInhabitedTyCons</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><a href="GHC.Types.Unique.Set.html#UniqSet"><span class="hs-identifier hs-type">UniqSet</span></a></span><span> </span><span class="annot"><a href="GHC.Core.TyCon.html#TyCon"><span class="hs-identifier hs-type">TyCon</span></a></span><span>
</span><span id="line-1441"></span><span id="triviallyInhabitedTyCons"><span class="annot"><span class="annottext">triviallyInhabitedTyCons :: UniqSet TyCon
</span><a href="GHC.HsToCore.Pmc.Solver.html#triviallyInhabitedTyCons"><span class="hs-identifier hs-var hs-var">triviallyInhabitedTyCons</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">forall a. Uniquable a =&gt; [a] -&gt; UniqSet a
</span><a href="GHC.Types.Unique.Set.html#mkUniqSet"><span class="hs-identifier hs-var">mkUniqSet</span></a></span><span> </span><span class="hs-special">[</span><span>
</span><span id="line-1442"></span><span>    </span><span class="annot"><span class="annottext">TyCon
</span><a href="GHC.Builtin.Types.html#charTyCon"><span class="hs-identifier hs-var">charTyCon</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">TyCon
</span><a href="GHC.Builtin.Types.html#doubleTyCon"><span class="hs-identifier hs-var">doubleTyCon</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">TyCon
</span><a href="GHC.Builtin.Types.html#floatTyCon"><span class="hs-identifier hs-var">floatTyCon</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">TyCon
</span><a href="GHC.Builtin.Types.html#intTyCon"><span class="hs-identifier hs-var">intTyCon</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">TyCon
</span><a href="GHC.Builtin.Types.html#wordTyCon"><span class="hs-identifier hs-var">wordTyCon</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">TyCon
</span><a href="GHC.Builtin.Types.html#word8TyCon"><span class="hs-identifier hs-var">word8TyCon</span></a></span><span>
</span><span id="line-1443"></span><span>  </span><span class="hs-special">]</span><span>
</span><span id="line-1444"></span><span>
</span><span id="line-1445"></span><span class="annot"><a href="GHC.HsToCore.Pmc.Solver.html#compareConLikeTestability"><span class="hs-identifier hs-type">compareConLikeTestability</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><a href="GHC.Core.ConLike.html#ConLike"><span class="hs-identifier hs-type">ConLike</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="GHC.Core.ConLike.html#ConLike"><span class="hs-identifier hs-type">ConLike</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="hs-identifier hs-type">Ordering</span></span><span>
</span><span id="line-1446"></span><span class="hs-comment">-- We should instantiate DataCons first, because they are likely to occur in</span><span>
</span><span id="line-1447"></span><span class="hs-comment">-- multiple COMPLETE sets at once and we might find that multiple COMPLETE sets</span><span>
</span><span id="line-1448"></span><span class="hs-comment">-- are inhabitated by instantiating only a single DataCon.</span><span>
</span><span id="line-1449"></span><span id="compareConLikeTestability"><span class="annot"><span class="annottext">compareConLikeTestability :: ConLike -&gt; ConLike -&gt; Ordering
</span><a href="GHC.HsToCore.Pmc.Solver.html#compareConLikeTestability"><span class="hs-identifier hs-var hs-var">compareConLikeTestability</span></a></span></span><span> </span><span class="annot"><a href="GHC.Core.ConLike.html#PatSynCon"><span class="hs-identifier hs-type">PatSynCon</span></a></span><span class="hs-special">{</span><span class="hs-special">}</span><span>     </span><span class="annot"><span class="annottext">ConLike
</span><span class="hs-identifier">_</span></span><span>               </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">Ordering
</span><span class="hs-identifier hs-var">GT</span></span><span>
</span><span id="line-1450"></span><span class="annot"><a href="GHC.HsToCore.Pmc.Solver.html#compareConLikeTestability"><span class="hs-identifier hs-var">compareConLikeTestability</span></a></span><span> </span><span class="annot"><span class="annottext">ConLike
</span><span class="hs-identifier">_</span></span><span>               </span><span class="annot"><a href="GHC.Core.ConLike.html#PatSynCon"><span class="hs-identifier hs-type">PatSynCon</span></a></span><span class="hs-special">{</span><span class="hs-special">}</span><span>     </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">Ordering
</span><span class="hs-identifier hs-var">GT</span></span><span>
</span><span id="line-1451"></span><span class="annot"><a href="GHC.HsToCore.Pmc.Solver.html#compareConLikeTestability"><span class="hs-identifier hs-var">compareConLikeTestability</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="GHC.Core.ConLike.html#RealDataCon"><span class="hs-identifier hs-type">RealDataCon</span></a></span><span> </span><span id="local-6989586621681374445"><span class="annot"><span class="annottext">DataCon
</span><a href="#local-6989586621681374445"><span class="hs-identifier hs-var">a</span></a></span></span><span class="hs-special">)</span><span> </span><span class="hs-special">(</span><span class="annot"><a href="GHC.Core.ConLike.html#RealDataCon"><span class="hs-identifier hs-type">RealDataCon</span></a></span><span> </span><span id="local-6989586621681374444"><span class="annot"><span class="annottext">DataCon
</span><a href="#local-6989586621681374444"><span class="hs-identifier hs-var">b</span></a></span></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">forall a. Monoid a =&gt; [a] -&gt; a
</span><a href="../../base-4.16.4.0/src/GHC-Base.html#mconcat"><span class="hs-identifier hs-var">mconcat</span></a></span><span>
</span><span id="line-1452"></span><span>  </span><span class="hs-comment">-- Thetas are most expensive to check, as they might incur a whole new round</span><span>
</span><span id="line-1453"></span><span>  </span><span class="hs-comment">-- of inhabitation testing</span><span>
</span><span id="line-1454"></span><span>  </span><span class="hs-special">[</span><span> </span><span class="annot"><span class="annottext">forall a b. Ord a =&gt; (b -&gt; a) -&gt; b -&gt; b -&gt; Ordering
</span><a href="../../base-4.16.4.0/src/Data-Ord.html#comparing"><span class="hs-identifier hs-var">comparing</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">forall a. [a] -&gt; Int
</span><a href="#local-6989586621681374443"><span class="hs-identifier hs-var">fast_length</span></a></span><span> </span><span class="annot"><span class="annottext">forall b c a. (b -&gt; c) -&gt; (a -&gt; b) -&gt; a -&gt; c
</span><a href="../../base-4.16.4.0/src/GHC-Base.html#."><span class="hs-operator hs-var">.</span></a></span><span> </span><span class="annot"><span class="annottext">DataCon -&gt; ThetaType
</span><a href="GHC.Core.DataCon.html#dataConTheta"><span class="hs-identifier hs-var">dataConTheta</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-1455"></span><span>  </span><span class="hs-comment">-- Unlifted or strict fields only incur an inhabitation test for that</span><span>
</span><span id="line-1456"></span><span>  </span><span class="hs-comment">-- particular field. Still something to avoid.</span><span>
</span><span id="line-1457"></span><span>  </span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">forall a b. Ord a =&gt; (b -&gt; a) -&gt; b -&gt; b -&gt; Ordering
</span><a href="../../base-4.16.4.0/src/Data-Ord.html#comparing"><span class="hs-identifier hs-var">comparing</span></a></span><span> </span><span class="annot"><span class="annottext">DataCon -&gt; Int
</span><a href="#local-6989586621681374442"><span class="hs-identifier hs-var">unlifted_or_strict_fields</span></a></span><span>
</span><span id="line-1458"></span><span>  </span><span class="hs-special">]</span><span> </span><span class="annot"><span class="annottext">DataCon
</span><a href="#local-6989586621681374445"><span class="hs-identifier hs-var">a</span></a></span><span> </span><span class="annot"><span class="annottext">DataCon
</span><a href="#local-6989586621681374444"><span class="hs-identifier hs-var">b</span></a></span><span>
</span><span id="line-1459"></span><span>  </span><span class="hs-keyword">where</span><span>
</span><span id="line-1460"></span><span>    </span><span id="local-6989586621681375661"><span class="annot"><a href="#local-6989586621681374443"><span class="hs-identifier hs-type">fast_length</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="hs-special">[</span><span class="annot"><a href="#local-6989586621681375661"><span class="hs-identifier hs-type">a</span></a></span><span class="hs-special">]</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="hs-identifier hs-type">Int</span></span></span><span>
</span><span id="line-1461"></span><span>    </span><span id="local-6989586621681374443"><span class="annot"><span class="annottext">fast_length :: forall a. [a] -&gt; Int
</span><a href="#local-6989586621681374443"><span class="hs-identifier hs-var hs-var">fast_length</span></a></span></span><span> </span><span id="local-6989586621681374439"><span class="annot"><span class="annottext">[a]
</span><a href="#local-6989586621681374439"><span class="hs-identifier hs-var">xs</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">forall a b. ([a] -&gt; b) -&gt; b -&gt; [a] -&gt; Int -&gt; b
</span><a href="GHC.Utils.Misc.html#atLength"><span class="hs-identifier hs-var">atLength</span></a></span><span> </span><span class="annot"><span class="annottext">forall (t :: * -&gt; *) a. Foldable t =&gt; t a -&gt; Int
</span><a href="../../base-4.16.4.0/src/Data-Foldable.html#length"><span class="hs-identifier hs-var">length</span></a></span><span> </span><span class="annot"><span class="annottext">Int
</span><span class="hs-number">6</span></span><span> </span><span class="annot"><span class="annottext">[a]
</span><a href="#local-6989586621681374439"><span class="hs-identifier hs-var">xs</span></a></span><span> </span><span class="annot"><span class="annottext">Int
</span><span class="hs-number">5</span></span><span> </span><span class="hs-comment">-- @min 6 (length xs)@, but O(1)</span><span>
</span><span id="line-1462"></span><span>
</span><span id="line-1463"></span><span>    </span><span class="hs-comment">-- An upper bound on the number of strict or unlifted fields. Approximate in</span><span>
</span><span id="line-1464"></span><span>    </span><span class="hs-comment">-- the unlikely bogus case of an unlifted field that has a bang.</span><span>
</span><span id="line-1465"></span><span>    </span><span class="annot"><a href="#local-6989586621681374442"><span class="hs-identifier hs-type">unlifted_or_strict_fields</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><a href="GHC.Core.DataCon.html#DataCon"><span class="hs-identifier hs-type">DataCon</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="hs-identifier hs-type">Int</span></span><span>
</span><span id="line-1466"></span><span>    </span><span id="local-6989586621681374442"><span class="annot"><span class="annottext">unlifted_or_strict_fields :: DataCon -&gt; Int
</span><a href="#local-6989586621681374442"><span class="hs-identifier hs-var hs-var">unlifted_or_strict_fields</span></a></span></span><span> </span><span id="local-6989586621681374437"><span class="annot"><span class="annottext">DataCon
</span><a href="#local-6989586621681374437"><span class="hs-identifier hs-var">dc</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">forall a. [a] -&gt; Int
</span><a href="#local-6989586621681374443"><span class="hs-identifier hs-var">fast_length</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">DataCon -&gt; [HsImplBang]
</span><a href="GHC.Core.DataCon.html#dataConImplBangs"><span class="hs-identifier hs-var">dataConImplBangs</span></a></span><span> </span><span class="annot"><span class="annottext">DataCon
</span><a href="#local-6989586621681374437"><span class="hs-identifier hs-var">dc</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-1467"></span><span>                                 </span><span class="annot"><span class="annottext">forall a. Num a =&gt; a -&gt; a -&gt; a
</span><a href="../../base-4.16.4.0/src/GHC-Num.html#%2B"><span class="hs-operator hs-var">+</span></a></span><span> </span><span class="annot"><span class="annottext">forall a. [a] -&gt; Int
</span><a href="#local-6989586621681374443"><span class="hs-identifier hs-var">fast_length</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">DataCon -&gt; ThetaType
</span><a href="GHC.HsToCore.Pmc.Solver.html#dataConUnliftedFieldTys"><span class="hs-identifier hs-var">dataConUnliftedFieldTys</span></a></span><span> </span><span class="annot"><span class="annottext">DataCon
</span><a href="#local-6989586621681374437"><span class="hs-identifier hs-var">dc</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-1468"></span><span>
</span><span id="line-1469"></span><span class="hs-comment">-- | @instCon fuel nabla (x::match_ty) K@ tries to instantiate @x@ to @K@ by</span><span>
</span><span id="line-1470"></span><span class="hs-comment">-- adding the proper constructor constraint.</span><span>
</span><span id="line-1471"></span><span class="hs-comment">--</span><span>
</span><span id="line-1472"></span><span class="hs-comment">-- See Note [Instantiating a ConLike].</span><span>
</span><span id="line-1473"></span><span class="annot"><a href="GHC.HsToCore.Pmc.Solver.html#instCon"><span class="hs-identifier hs-type">instCon</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><span class="hs-identifier hs-type">Int</span></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="GHC.HsToCore.Pmc.Solver.Types.html#Nabla"><span class="hs-identifier hs-type">Nabla</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="GHC.Types.Var.html#Id"><span class="hs-identifier hs-type">Id</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="GHC.Core.ConLike.html#ConLike"><span class="hs-identifier hs-type">ConLike</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="../../transformers-0.5.6.2/src/Control-Monad-Trans-Maybe.html#MaybeT"><span class="hs-identifier hs-type">MaybeT</span></a></span><span> </span><span class="annot"><a href="GHC.HsToCore.Types.html#DsM"><span class="hs-identifier hs-type">DsM</span></a></span><span> </span><span class="annot"><a href="GHC.HsToCore.Pmc.Solver.Types.html#Nabla"><span class="hs-identifier hs-type">Nabla</span></a></span><span>
</span><span id="line-1474"></span><span id="instCon"><span class="annot"><span class="annottext">instCon :: Int
-&gt; Nabla
-&gt; Id
-&gt; ConLike
-&gt; MaybeT (IOEnv (Env DsGblEnv DsLclEnv)) Nabla
</span><a href="GHC.HsToCore.Pmc.Solver.html#instCon"><span class="hs-identifier hs-var hs-var">instCon</span></a></span></span><span> </span><span id="local-6989586621681374436"><span class="annot"><span class="annottext">Int
</span><a href="#local-6989586621681374436"><span class="hs-identifier hs-var">fuel</span></a></span></span><span> </span><span id="local-6989586621681374435"><span class="annot"><span class="annottext">nabla :: Nabla
</span><a href="#local-6989586621681374435"><span class="hs-identifier hs-var">nabla</span></a></span></span><span class="hs-glyph">@</span><span class="annot"><a href="GHC.HsToCore.Pmc.Solver.Types.html#MkNabla"><span class="hs-identifier hs-type">MkNabla</span></a></span><span class="hs-special">{</span><span class="annot"><span class="annottext">nabla_ty_st :: Nabla -&gt; TyState
</span><a href="GHC.HsToCore.Pmc.Solver.Types.html#nabla_ty_st"><span class="hs-identifier hs-var">nabla_ty_st</span></a></span><span> </span><span class="hs-glyph">=</span><span> </span><span id="local-6989586621681374434"><span class="annot"><span class="annottext">TyState
</span><a href="#local-6989586621681374434"><span class="hs-identifier hs-var">ty_st</span></a></span></span><span class="hs-special">}</span><span> </span><span id="local-6989586621681374433"><span class="annot"><span class="annottext">Id
</span><a href="#local-6989586621681374433"><span class="hs-identifier hs-var">x</span></a></span></span><span> </span><span id="local-6989586621681374432"><span class="annot"><span class="annottext">ConLike
</span><a href="#local-6989586621681374432"><span class="hs-identifier hs-var">con</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">forall (m :: * -&gt; *) a. m (Maybe a) -&gt; MaybeT m a
</span><a href="../../transformers-0.5.6.2/src/Control-Monad-Trans-Maybe.html#MaybeT"><span class="hs-identifier hs-var">MaybeT</span></a></span><span> </span><span class="annot"><span class="annottext">forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><a href="../../base-4.16.4.0/src/GHC-Base.html#%24"><span class="hs-operator hs-var">$</span></a></span><span> </span><span class="hs-keyword">do</span><span>
</span><span id="line-1475"></span><span>  </span><span id="local-6989586621681374431"><span class="annot"><span class="annottext">FamInstEnvs
</span><a href="#local-6989586621681374431"><span class="hs-identifier hs-var">env</span></a></span></span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">DsM FamInstEnvs
</span><a href="GHC.HsToCore.Monad.html#dsGetFamInstEnvs"><span class="hs-identifier hs-var">dsGetFamInstEnvs</span></a></span><span>
</span><span id="line-1476"></span><span>  </span><span class="hs-keyword">let</span><span> </span><span id="local-6989586621681374430"><span class="annot"><span class="annottext">match_ty :: Type
</span><a href="#local-6989586621681374430"><span class="hs-identifier hs-var hs-var">match_ty</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">Id -&gt; Type
</span><a href="GHC.Types.Id.html#idType"><span class="hs-identifier hs-var">idType</span></a></span><span> </span><span class="annot"><span class="annottext">Id
</span><a href="#local-6989586621681374433"><span class="hs-identifier hs-var">x</span></a></span><span>
</span><span id="line-1477"></span><span>  </span><span id="local-6989586621681374429"><span class="annot"><span class="annottext">Type
</span><a href="#local-6989586621681374429"><span class="hs-identifier hs-var">norm_match_ty</span></a></span></span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">TyState -&gt; Type -&gt; DsM Type
</span><a href="GHC.HsToCore.Pmc.Solver.html#normaliseSourceTypeWHNF"><span class="hs-identifier hs-var">normaliseSourceTypeWHNF</span></a></span><span> </span><span class="annot"><span class="annottext">TyState
</span><a href="#local-6989586621681374434"><span class="hs-identifier hs-var">ty_st</span></a></span><span> </span><span class="annot"><span class="annottext">Type
</span><a href="#local-6989586621681374430"><span class="hs-identifier hs-var">match_ty</span></a></span><span>
</span><span id="line-1478"></span><span>  </span><span id="local-6989586621681374428"><span class="annot"><span class="annottext">Maybe TCvSubst
</span><a href="#local-6989586621681374428"><span class="hs-identifier hs-var">mb_sigma_univ</span></a></span></span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">FamInstEnvs -&gt; TyState -&gt; Type -&gt; ConLike -&gt; DsM (Maybe TCvSubst)
</span><a href="GHC.HsToCore.Pmc.Solver.html#matchConLikeResTy"><span class="hs-identifier hs-var">matchConLikeResTy</span></a></span><span> </span><span class="annot"><span class="annottext">FamInstEnvs
</span><a href="#local-6989586621681374431"><span class="hs-identifier hs-var">env</span></a></span><span> </span><span class="annot"><span class="annottext">TyState
</span><a href="#local-6989586621681374434"><span class="hs-identifier hs-var">ty_st</span></a></span><span> </span><span class="annot"><span class="annottext">Type
</span><a href="#local-6989586621681374429"><span class="hs-identifier hs-var">norm_match_ty</span></a></span><span> </span><span class="annot"><span class="annottext">ConLike
</span><a href="#local-6989586621681374432"><span class="hs-identifier hs-var">con</span></a></span><span>
</span><span id="line-1479"></span><span>  </span><span class="hs-keyword">case</span><span> </span><span class="annot"><span class="annottext">Maybe TCvSubst
</span><a href="#local-6989586621681374428"><span class="hs-identifier hs-var">mb_sigma_univ</span></a></span><span> </span><span class="hs-keyword">of</span><span>
</span><span id="line-1480"></span><span>    </span><span class="annot"><a href="../../base-4.16.4.0/src/GHC-Maybe.html#Just"><span class="hs-identifier hs-type">Just</span></a></span><span> </span><span id="local-6989586621681374426"><span class="annot"><span class="annottext">TCvSubst
</span><a href="#local-6989586621681374426"><span class="hs-identifier hs-var">sigma_univ</span></a></span></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-keyword">do</span><span>
</span><span id="line-1481"></span><span>      </span><span class="hs-keyword">let</span><span> </span><span class="hs-special">(</span><span id="local-6989586621681374425"><span class="annot"><span class="annottext">[Id]
</span><a href="#local-6989586621681374425"><span class="hs-identifier hs-var">_univ_tvs</span></a></span></span><span class="hs-special">,</span><span> </span><span id="local-6989586621681374424"><span class="annot"><span class="annottext">[Id]
</span><a href="#local-6989586621681374424"><span class="hs-identifier hs-var">ex_tvs</span></a></span></span><span class="hs-special">,</span><span> </span><span id="local-6989586621681374423"><span class="annot"><span class="annottext">[EqSpec]
</span><a href="#local-6989586621681374423"><span class="hs-identifier hs-var">eq_spec</span></a></span></span><span class="hs-special">,</span><span> </span><span id="local-6989586621681374422"><span class="annot"><span class="annottext">ThetaType
</span><a href="#local-6989586621681374422"><span class="hs-identifier hs-var">thetas</span></a></span></span><span class="hs-special">,</span><span> </span><span id="local-6989586621681374421"><span class="annot"><span class="annottext">ThetaType
</span><a href="#local-6989586621681374421"><span class="hs-identifier hs-var">_req_theta</span></a></span></span><span class="hs-special">,</span><span> </span><span id="local-6989586621681374420"><span class="annot"><span class="annottext">[Scaled Type]
</span><a href="#local-6989586621681374420"><span class="hs-identifier hs-var">field_tys</span></a></span></span><span class="hs-special">,</span><span> </span><span id="local-6989586621681374419"><span class="annot"><span class="annottext">Type
</span><a href="#local-6989586621681374419"><span class="hs-identifier hs-var">_con_res_ty</span></a></span></span><span class="hs-special">)</span><span>
</span><span id="line-1482"></span><span>            </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">ConLike
-&gt; ([Id], [Id], [EqSpec], ThetaType, ThetaType, [Scaled Type],
    Type)
</span><a href="GHC.Core.ConLike.html#conLikeFullSig"><span class="hs-identifier hs-var">conLikeFullSig</span></a></span><span> </span><span class="annot"><span class="annottext">ConLike
</span><a href="#local-6989586621681374432"><span class="hs-identifier hs-var">con</span></a></span><span>
</span><span id="line-1483"></span><span>      </span><span class="hs-comment">-- Following Note [Instantiating a ConLike]:</span><span>
</span><span id="line-1484"></span><span>      </span><span class="hs-comment">-- (1) _req_theta has been tested in 'matchConLikeResTy'</span><span>
</span><span id="line-1485"></span><span>      </span><span class="hs-comment">-- (2) Instantiate fresh existentials</span><span>
</span><span id="line-1486"></span><span>      </span><span class="hs-special">(</span><span id="local-6989586621681374418"><span class="annot"><span class="annottext">TCvSubst
</span><a href="#local-6989586621681374418"><span class="hs-identifier hs-var">sigma_ex</span></a></span></span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">[Id]
</span><span class="hs-identifier">_</span></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">TCvSubst -&gt; [Id] -&gt; UniqSupply -&gt; (TCvSubst, [Id])
</span><a href="GHC.Core.TyCo.Subst.html#cloneTyVarBndrs"><span class="hs-identifier hs-var">cloneTyVarBndrs</span></a></span><span> </span><span class="annot"><span class="annottext">TCvSubst
</span><a href="#local-6989586621681374426"><span class="hs-identifier hs-var">sigma_univ</span></a></span><span> </span><span class="annot"><span class="annottext">[Id]
</span><a href="#local-6989586621681374424"><span class="hs-identifier hs-var">ex_tvs</span></a></span><span> </span><span class="annot"><span class="annottext">forall (f :: * -&gt; *) a b. Functor f =&gt; (a -&gt; b) -&gt; f a -&gt; f b
</span><a href="../../base-4.16.4.0/src/Data-Functor.html#%3C%24%3E"><span class="hs-operator hs-var">&lt;$&gt;</span></a></span><span> </span><span class="annot"><span class="annottext">forall (m :: * -&gt; *). MonadUnique m =&gt; m UniqSupply
</span><a href="GHC.Types.Unique.Supply.html#getUniqueSupplyM"><span class="hs-identifier hs-var">getUniqueSupplyM</span></a></span><span>
</span><span id="line-1487"></span><span>      </span><span class="hs-comment">-- (3) Substitute provided constraints bound by the constructor.</span><span>
</span><span id="line-1488"></span><span>      </span><span class="hs-comment">--     These are added to the type oracle as new facts (in a moment)</span><span>
</span><span id="line-1489"></span><span>      </span><span class="hs-keyword">let</span><span> </span><span id="local-6989586621681374417"><span class="annot"><span class="annottext">gammas :: ThetaType
</span><a href="#local-6989586621681374417"><span class="hs-identifier hs-var hs-var">gammas</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">HasCallStack =&gt; TCvSubst -&gt; ThetaType -&gt; ThetaType
</span><a href="GHC.Core.TyCo.Subst.html#substTheta"><span class="hs-identifier hs-var">substTheta</span></a></span><span> </span><span class="annot"><span class="annottext">TCvSubst
</span><a href="#local-6989586621681374418"><span class="hs-identifier hs-var">sigma_ex</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">[EqSpec] -&gt; ThetaType
</span><a href="GHC.Core.DataCon.html#eqSpecPreds"><span class="hs-identifier hs-var">eqSpecPreds</span></a></span><span> </span><span class="annot"><span class="annottext">[EqSpec]
</span><a href="#local-6989586621681374423"><span class="hs-identifier hs-var">eq_spec</span></a></span><span> </span><span class="annot"><span class="annottext">forall a. [a] -&gt; [a] -&gt; [a]
</span><a href="../../base-4.16.4.0/src/GHC-Base.html#%2B%2B"><span class="hs-operator hs-var">++</span></a></span><span> </span><span class="annot"><span class="annottext">ThetaType
</span><a href="#local-6989586621681374422"><span class="hs-identifier hs-var">thetas</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-1490"></span><span>      </span><span class="hs-comment">-- (4) Instantiate fresh term variables as arguments to the constructor</span><span>
</span><span id="line-1491"></span><span>      </span><span class="hs-keyword">let</span><span> </span><span id="local-6989586621681374414"><span class="annot"><span class="annottext">field_tys' :: ThetaType
</span><a href="#local-6989586621681374414"><span class="hs-identifier hs-var hs-var">field_tys'</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">HasCallStack =&gt; TCvSubst -&gt; ThetaType -&gt; ThetaType
</span><a href="GHC.Core.TyCo.Subst.html#substTys"><span class="hs-identifier hs-var">substTys</span></a></span><span> </span><span class="annot"><span class="annottext">TCvSubst
</span><a href="#local-6989586621681374418"><span class="hs-identifier hs-var">sigma_ex</span></a></span><span> </span><span class="annot"><span class="annottext">forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><a href="../../base-4.16.4.0/src/GHC-Base.html#%24"><span class="hs-operator hs-var">$</span></a></span><span> </span><span class="annot"><span class="annottext">forall a b. (a -&gt; b) -&gt; [a] -&gt; [b]
</span><a href="../../base-4.16.4.0/src/GHC-Base.html#map"><span class="hs-identifier hs-var">map</span></a></span><span> </span><span class="annot"><span class="annottext">forall a. Scaled a -&gt; a
</span><a href="GHC.Core.TyCo.Rep.html#scaledThing"><span class="hs-identifier hs-var">scaledThing</span></a></span><span> </span><span class="annot"><span class="annottext">[Scaled Type]
</span><a href="#local-6989586621681374420"><span class="hs-identifier hs-var">field_tys</span></a></span><span>
</span><span id="line-1492"></span><span>      </span><span id="local-6989586621681374412"><span class="annot"><span class="annottext">[Id]
</span><a href="#local-6989586621681374412"><span class="hs-identifier hs-var">arg_ids</span></a></span></span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">forall (t :: * -&gt; *) (m :: * -&gt; *) a b.
(Traversable t, Monad m) =&gt;
(a -&gt; m b) -&gt; t a -&gt; m (t b)
</span><a href="../../base-4.16.4.0/src/Data-Traversable.html#mapM"><span class="hs-identifier hs-var">mapM</span></a></span><span> </span><span class="annot"><span class="annottext">Type -&gt; DsM Id
</span><a href="GHC.HsToCore.Pmc.Utils.html#mkPmId"><span class="hs-identifier hs-var">mkPmId</span></a></span><span> </span><span class="annot"><span class="annottext">ThetaType
</span><a href="#local-6989586621681374414"><span class="hs-identifier hs-var">field_tys'</span></a></span><span>
</span><span id="line-1493"></span><span>      </span><span class="annot"><span class="annottext">String -&gt; SDoc -&gt; DsM ()
</span><a href="GHC.HsToCore.Pmc.Utils.html#tracePm"><span class="hs-identifier hs-var">tracePm</span></a></span><span> </span><span class="annot"><span class="annottext">String
</span><span class="hs-string">&quot;instCon&quot;</span></span><span> </span><span class="annot"><span class="annottext">forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><a href="../../base-4.16.4.0/src/GHC-Base.html#%24"><span class="hs-operator hs-var">$</span></a></span><span> </span><span class="annot"><span class="annottext">[SDoc] -&gt; SDoc
</span><a href="GHC.Utils.Outputable.html#vcat"><span class="hs-identifier hs-var">vcat</span></a></span><span>
</span><span id="line-1494"></span><span>        </span><span class="hs-special">[</span><span> </span><span class="annot"><span class="annottext">forall a. Outputable a =&gt; a -&gt; SDoc
</span><a href="GHC.Utils.Outputable.html#ppr"><span class="hs-identifier hs-var">ppr</span></a></span><span> </span><span class="annot"><span class="annottext">Id
</span><a href="#local-6989586621681374433"><span class="hs-identifier hs-var">x</span></a></span><span> </span><span class="annot"><span class="annottext">SDoc -&gt; SDoc -&gt; SDoc
</span><a href="GHC.Utils.Outputable.html#%3C%2B%3E"><span class="hs-operator hs-var">&lt;+&gt;</span></a></span><span> </span><span class="annot"><span class="annottext">SDoc
</span><a href="GHC.Utils.Outputable.html#dcolon"><span class="hs-identifier hs-var">dcolon</span></a></span><span> </span><span class="annot"><span class="annottext">SDoc -&gt; SDoc -&gt; SDoc
</span><a href="GHC.Utils.Outputable.html#%3C%2B%3E"><span class="hs-operator hs-var">&lt;+&gt;</span></a></span><span> </span><span class="annot"><span class="annottext">forall a. Outputable a =&gt; a -&gt; SDoc
</span><a href="GHC.Utils.Outputable.html#ppr"><span class="hs-identifier hs-var">ppr</span></a></span><span> </span><span class="annot"><span class="annottext">Type
</span><a href="#local-6989586621681374430"><span class="hs-identifier hs-var">match_ty</span></a></span><span>
</span><span id="line-1495"></span><span>        </span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">String -&gt; SDoc
</span><a href="GHC.Utils.Outputable.html#text"><span class="hs-identifier hs-var">text</span></a></span><span> </span><span class="annot"><span class="annottext">String
</span><span class="hs-string">&quot;In WHNF:&quot;</span></span><span> </span><span class="annot"><span class="annottext">SDoc -&gt; SDoc -&gt; SDoc
</span><a href="GHC.Utils.Outputable.html#%3C%2B%3E"><span class="hs-operator hs-var">&lt;+&gt;</span></a></span><span> </span><span class="annot"><span class="annottext">forall a. Outputable a =&gt; a -&gt; SDoc
</span><a href="GHC.Utils.Outputable.html#ppr"><span class="hs-identifier hs-var">ppr</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Type -&gt; Bool
</span><a href="GHC.HsToCore.Pmc.Solver.html#isSourceTypeInWHNF"><span class="hs-identifier hs-var">isSourceTypeInWHNF</span></a></span><span> </span><span class="annot"><span class="annottext">Type
</span><a href="#local-6989586621681374430"><span class="hs-identifier hs-var">match_ty</span></a></span><span class="hs-special">)</span><span> </span><span class="annot"><span class="annottext">SDoc -&gt; SDoc -&gt; SDoc
</span><a href="GHC.Utils.Outputable.html#%3C%2B%3E"><span class="hs-operator hs-var">&lt;+&gt;</span></a></span><span> </span><span class="annot"><span class="annottext">forall a. Outputable a =&gt; a -&gt; SDoc
</span><a href="GHC.Utils.Outputable.html#ppr"><span class="hs-identifier hs-var">ppr</span></a></span><span> </span><span class="annot"><span class="annottext">Type
</span><a href="#local-6989586621681374429"><span class="hs-identifier hs-var">norm_match_ty</span></a></span><span>
</span><span id="line-1496"></span><span>        </span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">forall a. Outputable a =&gt; a -&gt; SDoc
</span><a href="GHC.Utils.Outputable.html#ppr"><span class="hs-identifier hs-var">ppr</span></a></span><span> </span><span class="annot"><span class="annottext">ConLike
</span><a href="#local-6989586621681374432"><span class="hs-identifier hs-var">con</span></a></span><span> </span><span class="annot"><span class="annottext">SDoc -&gt; SDoc -&gt; SDoc
</span><a href="GHC.Utils.Outputable.html#%3C%2B%3E"><span class="hs-operator hs-var">&lt;+&gt;</span></a></span><span> </span><span class="annot"><span class="annottext">SDoc
</span><a href="GHC.Utils.Outputable.html#dcolon"><span class="hs-identifier hs-var">dcolon</span></a></span><span> </span><span class="annot"><span class="annottext">SDoc -&gt; SDoc -&gt; SDoc
</span><a href="GHC.Utils.Outputable.html#%3C%2B%3E"><span class="hs-operator hs-var">&lt;+&gt;</span></a></span><span> </span><span class="annot"><span class="annottext">String -&gt; SDoc
</span><a href="GHC.Utils.Outputable.html#text"><span class="hs-identifier hs-var">text</span></a></span><span> </span><span class="annot"><span class="annottext">String
</span><span class="hs-string">&quot;... -&gt;&quot;</span></span><span> </span><span class="annot"><span class="annottext">SDoc -&gt; SDoc -&gt; SDoc
</span><a href="GHC.Utils.Outputable.html#%3C%2B%3E"><span class="hs-operator hs-var">&lt;+&gt;</span></a></span><span> </span><span class="annot"><span class="annottext">forall a. Outputable a =&gt; a -&gt; SDoc
</span><a href="GHC.Utils.Outputable.html#ppr"><span class="hs-identifier hs-var">ppr</span></a></span><span> </span><span class="annot"><span class="annottext">Type
</span><a href="#local-6989586621681374419"><span class="hs-identifier hs-var">_con_res_ty</span></a></span><span>
</span><span id="line-1497"></span><span>        </span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">forall a. Outputable a =&gt; a -&gt; SDoc
</span><a href="GHC.Utils.Outputable.html#ppr"><span class="hs-identifier hs-var">ppr</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">forall a b. (a -&gt; b) -&gt; [a] -&gt; [b]
</span><a href="../../base-4.16.4.0/src/GHC-Base.html#map"><span class="hs-identifier hs-var">map</span></a></span><span> </span><span class="hs-special">(</span><span class="hs-glyph">\</span><span id="local-6989586621681374408"><span class="annot"><span class="annottext">Id
</span><a href="#local-6989586621681374408"><span class="hs-identifier hs-var">tv</span></a></span></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="annottext">forall a. Outputable a =&gt; a -&gt; SDoc
</span><a href="GHC.Utils.Outputable.html#ppr"><span class="hs-identifier hs-var">ppr</span></a></span><span> </span><span class="annot"><span class="annottext">Id
</span><a href="#local-6989586621681374408"><span class="hs-identifier hs-var">tv</span></a></span><span> </span><span class="annot"><span class="annottext">SDoc -&gt; SDoc -&gt; SDoc
</span><a href="GHC.Utils.Outputable.html#%3C%2B%3E"><span class="hs-operator hs-var">&lt;+&gt;</span></a></span><span> </span><span class="annot"><span class="annottext">Char -&gt; SDoc
</span><a href="GHC.Utils.Outputable.html#char"><span class="hs-identifier hs-var">char</span></a></span><span> </span><span class="annot"><span class="annottext">Char
</span><span class="hs-char">'&#8614;'</span></span><span> </span><span class="annot"><span class="annottext">SDoc -&gt; SDoc -&gt; SDoc
</span><a href="GHC.Utils.Outputable.html#%3C%2B%3E"><span class="hs-operator hs-var">&lt;+&gt;</span></a></span><span> </span><span class="annot"><span class="annottext">forall a. Outputable a =&gt; a -&gt; SDoc
</span><a href="GHC.Utils.Outputable.html#ppr"><span class="hs-identifier hs-var">ppr</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">TCvSubst -&gt; Id -&gt; Type
</span><a href="GHC.Core.TyCo.Subst.html#substTyVar"><span class="hs-identifier hs-var">substTyVar</span></a></span><span> </span><span class="annot"><span class="annottext">TCvSubst
</span><a href="#local-6989586621681374426"><span class="hs-identifier hs-var">sigma_univ</span></a></span><span> </span><span class="annot"><span class="annottext">Id
</span><a href="#local-6989586621681374408"><span class="hs-identifier hs-var">tv</span></a></span><span class="hs-special">)</span><span class="hs-special">)</span><span> </span><span class="annot"><span class="annottext">[Id]
</span><a href="#local-6989586621681374425"><span class="hs-identifier hs-var">_univ_tvs</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-1498"></span><span>        </span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">forall a. Outputable a =&gt; a -&gt; SDoc
</span><a href="GHC.Utils.Outputable.html#ppr"><span class="hs-identifier hs-var">ppr</span></a></span><span> </span><span class="annot"><span class="annottext">ThetaType
</span><a href="#local-6989586621681374417"><span class="hs-identifier hs-var">gammas</span></a></span><span>
</span><span id="line-1499"></span><span>        </span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">forall a. Outputable a =&gt; a -&gt; SDoc
</span><a href="GHC.Utils.Outputable.html#ppr"><span class="hs-identifier hs-var">ppr</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">forall a b. (a -&gt; b) -&gt; [a] -&gt; [b]
</span><a href="../../base-4.16.4.0/src/GHC-Base.html#map"><span class="hs-identifier hs-var">map</span></a></span><span> </span><span class="hs-special">(</span><span class="hs-glyph">\</span><span id="local-6989586621681374406"><span class="annot"><span class="annottext">Id
</span><a href="#local-6989586621681374406"><span class="hs-identifier hs-var">x</span></a></span></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="annottext">forall a. Outputable a =&gt; a -&gt; SDoc
</span><a href="GHC.Utils.Outputable.html#ppr"><span class="hs-identifier hs-var">ppr</span></a></span><span> </span><span class="annot"><span class="annottext">Id
</span><a href="#local-6989586621681374406"><span class="hs-identifier hs-var">x</span></a></span><span> </span><span class="annot"><span class="annottext">SDoc -&gt; SDoc -&gt; SDoc
</span><a href="GHC.Utils.Outputable.html#%3C%2B%3E"><span class="hs-operator hs-var">&lt;+&gt;</span></a></span><span> </span><span class="annot"><span class="annottext">SDoc
</span><a href="GHC.Utils.Outputable.html#dcolon"><span class="hs-identifier hs-var">dcolon</span></a></span><span> </span><span class="annot"><span class="annottext">SDoc -&gt; SDoc -&gt; SDoc
</span><a href="GHC.Utils.Outputable.html#%3C%2B%3E"><span class="hs-operator hs-var">&lt;+&gt;</span></a></span><span> </span><span class="annot"><span class="annottext">forall a. Outputable a =&gt; a -&gt; SDoc
</span><a href="GHC.Utils.Outputable.html#ppr"><span class="hs-identifier hs-var">ppr</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Id -&gt; Type
</span><a href="GHC.Types.Id.html#idType"><span class="hs-identifier hs-var">idType</span></a></span><span> </span><span class="annot"><span class="annottext">Id
</span><a href="#local-6989586621681374406"><span class="hs-identifier hs-var">x</span></a></span><span class="hs-special">)</span><span class="hs-special">)</span><span> </span><span class="annot"><span class="annottext">[Id]
</span><a href="#local-6989586621681374412"><span class="hs-identifier hs-var">arg_ids</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-1500"></span><span>        </span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">forall a. Outputable a =&gt; a -&gt; SDoc
</span><a href="GHC.Utils.Outputable.html#ppr"><span class="hs-identifier hs-var">ppr</span></a></span><span> </span><span class="annot"><span class="annottext">Int
</span><a href="#local-6989586621681374436"><span class="hs-identifier hs-var">fuel</span></a></span><span>
</span><span id="line-1501"></span><span>        </span><span class="hs-special">]</span><span>
</span><span id="line-1502"></span><span>      </span><span class="hs-comment">-- (5) Finally add the new constructor constraint</span><span>
</span><span id="line-1503"></span><span>      </span><span class="annot"><span class="annottext">forall (m :: * -&gt; *) a. MaybeT m a -&gt; m (Maybe a)
</span><a href="../../transformers-0.5.6.2/src/Control-Monad-Trans-Maybe.html#runMaybeT"><span class="hs-identifier hs-var">runMaybeT</span></a></span><span> </span><span class="annot"><span class="annottext">forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><a href="../../base-4.16.4.0/src/GHC-Base.html#%24"><span class="hs-operator hs-var">$</span></a></span><span> </span><span class="hs-keyword">do</span><span>
</span><span id="line-1504"></span><span>        </span><span class="hs-comment">-- Case (2) of Note [Strict fields and variables of unlifted type]</span><span>
</span><span id="line-1505"></span><span>        </span><span class="hs-keyword">let</span><span> </span><span id="local-6989586621681374405"><span class="annot"><span class="annottext">alt :: PmAltCon
</span><a href="#local-6989586621681374405"><span class="hs-identifier hs-var hs-var">alt</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">ConLike -&gt; PmAltCon
</span><a href="GHC.HsToCore.Pmc.Solver.Types.html#PmAltConLike"><span class="hs-identifier hs-var">PmAltConLike</span></a></span><span> </span><span class="annot"><span class="annottext">ConLike
</span><a href="#local-6989586621681374432"><span class="hs-identifier hs-var">con</span></a></span><span>
</span><span id="line-1506"></span><span>        </span><span id="local-6989586621681374404"><span class="annot"><span class="annottext">Nabla
</span><a href="#local-6989586621681374404"><span class="hs-identifier hs-var">nabla'</span></a></span></span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">Nabla -&gt; PhiCt -&gt; MaybeT (IOEnv (Env DsGblEnv DsLclEnv)) Nabla
</span><a href="GHC.HsToCore.Pmc.Solver.html#addPhiTmCt"><span class="hs-identifier hs-var">addPhiTmCt</span></a></span><span> </span><span class="annot"><span class="annottext">Nabla
</span><a href="#local-6989586621681374435"><span class="hs-identifier hs-var">nabla</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Id -&gt; PmAltCon -&gt; [Id] -&gt; ThetaType -&gt; [Id] -&gt; PhiCt
</span><a href="GHC.HsToCore.Pmc.Solver.html#PhiConCt"><span class="hs-identifier hs-var">PhiConCt</span></a></span><span> </span><span class="annot"><span class="annottext">Id
</span><a href="#local-6989586621681374433"><span class="hs-identifier hs-var">x</span></a></span><span> </span><span class="annot"><span class="annottext">PmAltCon
</span><a href="#local-6989586621681374405"><span class="hs-identifier hs-var">alt</span></a></span><span> </span><span class="annot"><span class="annottext">[Id]
</span><a href="#local-6989586621681374424"><span class="hs-identifier hs-var">ex_tvs</span></a></span><span> </span><span class="annot"><span class="annottext">ThetaType
</span><a href="#local-6989586621681374417"><span class="hs-identifier hs-var">gammas</span></a></span><span> </span><span class="annot"><span class="annottext">[Id]
</span><a href="#local-6989586621681374412"><span class="hs-identifier hs-var">arg_ids</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-1507"></span><span>        </span><span class="hs-keyword">let</span><span> </span><span id="local-6989586621681374403"><span class="annot"><span class="annottext">branching_factor :: Int
</span><a href="#local-6989586621681374403"><span class="hs-identifier hs-var hs-var">branching_factor</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">forall (t :: * -&gt; *) a. Foldable t =&gt; t a -&gt; Int
</span><a href="../../base-4.16.4.0/src/Data-Foldable.html#length"><span class="hs-identifier hs-var">length</span></a></span><span> </span><span class="annot"><span class="annottext">forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><a href="../../base-4.16.4.0/src/GHC-Base.html#%24"><span class="hs-operator hs-var">$</span></a></span><span> </span><span class="annot"><span class="annottext">PmAltCon -&gt; [Id] -&gt; [Id]
</span><a href="GHC.HsToCore.Pmc.Solver.html#filterUnliftedFields"><span class="hs-identifier hs-var">filterUnliftedFields</span></a></span><span> </span><span class="annot"><span class="annottext">PmAltCon
</span><a href="#local-6989586621681374405"><span class="hs-identifier hs-var">alt</span></a></span><span> </span><span class="annot"><span class="annottext">[Id]
</span><a href="#local-6989586621681374412"><span class="hs-identifier hs-var">arg_ids</span></a></span><span>
</span><span id="line-1508"></span><span>        </span><span class="hs-comment">-- See Note [Fuel for the inhabitation test]</span><span>
</span><span id="line-1509"></span><span>        </span><span class="hs-keyword">let</span><span> </span><span id="local-6989586621681374402"><span class="annot"><span class="annottext">new_fuel :: Int
</span><a href="#local-6989586621681374402"><span class="hs-identifier hs-var hs-var">new_fuel</span></a></span></span><span>
</span><span id="line-1510"></span><span>              </span><span class="hs-glyph">|</span><span> </span><span class="annot"><span class="annottext">Int
</span><a href="#local-6989586621681374403"><span class="hs-identifier hs-var">branching_factor</span></a></span><span> </span><span class="annot"><span class="annottext">forall a. Ord a =&gt; a -&gt; a -&gt; Bool
</span><span class="hs-operator hs-var">&lt;=</span></span><span> </span><span class="annot"><span class="annottext">Int
</span><span class="hs-number">1</span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">Int
</span><a href="#local-6989586621681374436"><span class="hs-identifier hs-var">fuel</span></a></span><span>
</span><span id="line-1511"></span><span>              </span><span class="hs-glyph">|</span><span> </span><span class="annot"><span class="annottext">Bool
</span><a href="../../base-4.16.4.0/src/GHC-Base.html#otherwise"><span class="hs-identifier hs-var">otherwise</span></a></span><span>             </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">forall a. Ord a =&gt; a -&gt; a -&gt; a
</span><span class="hs-identifier hs-var">min</span></span><span> </span><span class="annot"><span class="annottext">Int
</span><a href="#local-6989586621681374436"><span class="hs-identifier hs-var">fuel</span></a></span><span> </span><span class="annot"><span class="annottext">Int
</span><span class="hs-number">2</span></span><span>
</span><span id="line-1512"></span><span>        </span><span class="annot"><span class="annottext">Int
-&gt; TyState -&gt; Nabla -&gt; MaybeT (IOEnv (Env DsGblEnv DsLclEnv)) Nabla
</span><a href="GHC.HsToCore.Pmc.Solver.html#inhabitationTest"><span class="hs-identifier hs-var">inhabitationTest</span></a></span><span> </span><span class="annot"><span class="annottext">Int
</span><a href="#local-6989586621681374402"><span class="hs-identifier hs-var">new_fuel</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Nabla -&gt; TyState
</span><a href="GHC.HsToCore.Pmc.Solver.Types.html#nabla_ty_st"><span class="hs-identifier hs-var">nabla_ty_st</span></a></span><span> </span><span class="annot"><span class="annottext">Nabla
</span><a href="#local-6989586621681374435"><span class="hs-identifier hs-var">nabla</span></a></span><span class="hs-special">)</span><span> </span><span class="annot"><span class="annottext">Nabla
</span><a href="#local-6989586621681374404"><span class="hs-identifier hs-var">nabla'</span></a></span><span>
</span><span id="line-1513"></span><span>    </span><span class="annot"><span class="annottext">Maybe TCvSubst
</span><a href="../../base-4.16.4.0/src/GHC-Maybe.html#Nothing"><span class="hs-identifier hs-var">Nothing</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="annottext">forall (f :: * -&gt; *) a. Applicative f =&gt; a -&gt; f a
</span><a href="../../base-4.16.4.0/src/GHC-Base.html#pure"><span class="hs-identifier hs-var">pure</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">forall a. a -&gt; Maybe a
</span><a href="../../base-4.16.4.0/src/GHC-Maybe.html#Just"><span class="hs-identifier hs-var">Just</span></a></span><span> </span><span class="annot"><span class="annottext">Nabla
</span><a href="#local-6989586621681374435"><span class="hs-identifier hs-var">nabla</span></a></span><span class="hs-special">)</span><span> </span><span class="hs-comment">-- Matching against match_ty failed. Inhabited!</span><span>
</span><span id="line-1514"></span><span>                                 </span><span class="hs-comment">-- See Note [Instantiating a ConLike].</span><span>
</span><span id="line-1515"></span><span>
</span><span id="line-1516"></span><span class="hs-comment">-- | @matchConLikeResTy _ _ ty K@ tries to match @ty@ against the result</span><span>
</span><span id="line-1517"></span><span class="hs-comment">-- type of @K@, @res_ty@. It returns a substitution @s@ for @K@'s universal</span><span>
</span><span id="line-1518"></span><span class="hs-comment">-- tyvars such that @s(res_ty)@ equals @ty@ if successful.</span><span>
</span><span id="line-1519"></span><span class="hs-comment">--</span><span>
</span><span id="line-1520"></span><span class="hs-comment">-- Make sure that @ty@ is normalised before.</span><span>
</span><span id="line-1521"></span><span class="hs-comment">--</span><span>
</span><span id="line-1522"></span><span class="hs-comment">-- See Note [Matching against a ConLike result type].</span><span>
</span><span id="line-1523"></span><span class="annot"><a href="GHC.HsToCore.Pmc.Solver.html#matchConLikeResTy"><span class="hs-identifier hs-type">matchConLikeResTy</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><a href="GHC.Core.FamInstEnv.html#FamInstEnvs"><span class="hs-identifier hs-type">FamInstEnvs</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="GHC.HsToCore.Pmc.Solver.Types.html#TyState"><span class="hs-identifier hs-type">TyState</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="GHC.Core.TyCo.Rep.html#Type"><span class="hs-identifier hs-type">Type</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="GHC.Core.ConLike.html#ConLike"><span class="hs-identifier hs-type">ConLike</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="GHC.HsToCore.Types.html#DsM"><span class="hs-identifier hs-type">DsM</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="../../base-4.16.4.0/src/GHC-Maybe.html#Maybe"><span class="hs-identifier hs-type">Maybe</span></a></span><span> </span><span class="annot"><a href="GHC.Core.TyCo.Subst.html#TCvSubst"><span class="hs-identifier hs-type">TCvSubst</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-1524"></span><span id="matchConLikeResTy"><span class="annot"><span class="annottext">matchConLikeResTy :: FamInstEnvs -&gt; TyState -&gt; Type -&gt; ConLike -&gt; DsM (Maybe TCvSubst)
</span><a href="GHC.HsToCore.Pmc.Solver.html#matchConLikeResTy"><span class="hs-identifier hs-var hs-var">matchConLikeResTy</span></a></span></span><span> </span><span id="local-6989586621681374400"><span class="annot"><span class="annottext">FamInstEnvs
</span><a href="#local-6989586621681374400"><span class="hs-identifier hs-var">env</span></a></span></span><span> </span><span class="annot"><span class="annottext">TyState
</span><span class="hs-identifier">_</span></span><span>              </span><span id="local-6989586621681374399"><span class="annot"><span class="annottext">Type
</span><a href="#local-6989586621681374399"><span class="hs-identifier hs-var">ty</span></a></span></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="GHC.Core.ConLike.html#RealDataCon"><span class="hs-identifier hs-type">RealDataCon</span></a></span><span> </span><span id="local-6989586621681374398"><span class="annot"><span class="annottext">DataCon
</span><a href="#local-6989586621681374398"><span class="hs-identifier hs-var">dc</span></a></span></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">forall (f :: * -&gt; *) a. Applicative f =&gt; a -&gt; f a
</span><a href="../../base-4.16.4.0/src/GHC-Base.html#pure"><span class="hs-identifier hs-var">pure</span></a></span><span> </span><span class="annot"><span class="annottext">forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><a href="../../base-4.16.4.0/src/GHC-Base.html#%24"><span class="hs-operator hs-var">$</span></a></span><span> </span><span class="hs-keyword">do</span><span>
</span><span id="line-1525"></span><span>  </span><span class="hs-special">(</span><span id="local-6989586621681374397"><span class="annot"><span class="annottext">TyCon
</span><a href="#local-6989586621681374397"><span class="hs-identifier hs-var">rep_tc</span></a></span></span><span class="hs-special">,</span><span> </span><span id="local-6989586621681374396"><span class="annot"><span class="annottext">ThetaType
</span><a href="#local-6989586621681374396"><span class="hs-identifier hs-var">tc_args</span></a></span></span><span class="hs-special">,</span><span> </span><span id="local-6989586621681374395"><span class="annot"><span class="annottext">Coercion
</span><a href="#local-6989586621681374395"><span class="hs-identifier hs-var">_co</span></a></span></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">FamInstEnvs -&gt; Type -&gt; Maybe (TyCon, ThetaType, Coercion)
</span><a href="GHC.HsToCore.Pmc.Solver.html#splitReprTyConApp_maybe"><span class="hs-identifier hs-var">splitReprTyConApp_maybe</span></a></span><span> </span><span class="annot"><span class="annottext">FamInstEnvs
</span><a href="#local-6989586621681374400"><span class="hs-identifier hs-var">env</span></a></span><span> </span><span class="annot"><span class="annottext">Type
</span><a href="#local-6989586621681374399"><span class="hs-identifier hs-var">ty</span></a></span><span>
</span><span id="line-1526"></span><span>  </span><span class="hs-keyword">if</span><span> </span><span class="annot"><span class="annottext">TyCon
</span><a href="#local-6989586621681374397"><span class="hs-identifier hs-var">rep_tc</span></a></span><span> </span><span class="annot"><span class="annottext">forall a. Eq a =&gt; a -&gt; a -&gt; Bool
</span><span class="hs-operator hs-var">==</span></span><span> </span><span class="annot"><span class="annottext">DataCon -&gt; TyCon
</span><a href="GHC.Core.DataCon.html#dataConTyCon"><span class="hs-identifier hs-var">dataConTyCon</span></a></span><span> </span><span class="annot"><span class="annottext">DataCon
</span><a href="#local-6989586621681374398"><span class="hs-identifier hs-var">dc</span></a></span><span>
</span><span id="line-1527"></span><span>    </span><span class="hs-keyword">then</span><span> </span><span class="annot"><span class="annottext">forall a. a -&gt; Maybe a
</span><a href="../../base-4.16.4.0/src/GHC-Maybe.html#Just"><span class="hs-identifier hs-var">Just</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">HasDebugCallStack =&gt; [Id] -&gt; ThetaType -&gt; TCvSubst
</span><a href="GHC.Core.TyCo.Subst.html#zipTCvSubst"><span class="hs-identifier hs-var">zipTCvSubst</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">DataCon -&gt; [Id]
</span><a href="GHC.Core.DataCon.html#dataConUnivTyVars"><span class="hs-identifier hs-var">dataConUnivTyVars</span></a></span><span> </span><span class="annot"><span class="annottext">DataCon
</span><a href="#local-6989586621681374398"><span class="hs-identifier hs-var">dc</span></a></span><span class="hs-special">)</span><span> </span><span class="annot"><span class="annottext">ThetaType
</span><a href="#local-6989586621681374396"><span class="hs-identifier hs-var">tc_args</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-1528"></span><span>    </span><span class="hs-keyword">else</span><span> </span><span class="annot"><span class="annottext">forall a. Maybe a
</span><a href="../../base-4.16.4.0/src/GHC-Maybe.html#Nothing"><span class="hs-identifier hs-var">Nothing</span></a></span><span>
</span><span id="line-1529"></span><span class="annot"><a href="GHC.HsToCore.Pmc.Solver.html#matchConLikeResTy"><span class="hs-identifier hs-var">matchConLikeResTy</span></a></span><span> </span><span class="annot"><span class="annottext">FamInstEnvs
</span><span class="hs-identifier">_</span></span><span>   </span><span class="hs-special">(</span><span class="annot"><a href="GHC.HsToCore.Pmc.Solver.Types.html#TySt"><span class="hs-identifier hs-type">TySt</span></a></span><span> </span><span class="annot"><span class="annottext">Int
</span><span class="hs-identifier">_</span></span><span> </span><span id="local-6989586621681374392"><span class="annot"><span class="annottext">InertSet
</span><a href="#local-6989586621681374392"><span class="hs-identifier hs-var">inert</span></a></span></span><span class="hs-special">)</span><span> </span><span id="local-6989586621681374391"><span class="annot"><span class="annottext">Type
</span><a href="#local-6989586621681374391"><span class="hs-identifier hs-var">ty</span></a></span></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="GHC.Core.ConLike.html#PatSynCon"><span class="hs-identifier hs-type">PatSynCon</span></a></span><span> </span><span id="local-6989586621681374390"><span class="annot"><span class="annottext">PatSyn
</span><a href="#local-6989586621681374390"><span class="hs-identifier hs-var">ps</span></a></span></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">forall (m :: * -&gt; *) a. MaybeT m a -&gt; m (Maybe a)
</span><a href="../../transformers-0.5.6.2/src/Control-Monad-Trans-Maybe.html#runMaybeT"><span class="hs-identifier hs-var">runMaybeT</span></a></span><span> </span><span class="annot"><span class="annottext">forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><a href="../../base-4.16.4.0/src/GHC-Base.html#%24"><span class="hs-operator hs-var">$</span></a></span><span> </span><span class="hs-keyword">do</span><span>
</span><span id="line-1530"></span><span>  </span><span class="hs-keyword">let</span><span> </span><span class="hs-special">(</span><span id="local-6989586621681374389"><span class="annot"><span class="annottext">[Id]
</span><a href="#local-6989586621681374389"><span class="hs-identifier hs-var">univ_tvs</span></a></span></span><span class="hs-special">,</span><span id="local-6989586621681374388"><span class="annot"><span class="annottext">ThetaType
</span><a href="#local-6989586621681374388"><span class="hs-identifier hs-var">req_theta</span></a></span></span><span class="hs-special">,</span><span class="annot"><span class="annottext">[Id]
</span><span class="hs-identifier">_</span></span><span class="hs-special">,</span><span class="annot"><span class="annottext">ThetaType
</span><span class="hs-identifier">_</span></span><span class="hs-special">,</span><span class="annot"><span class="annottext">[Scaled Type]
</span><span class="hs-identifier">_</span></span><span class="hs-special">,</span><span id="local-6989586621681374387"><span class="annot"><span class="annottext">Type
</span><a href="#local-6989586621681374387"><span class="hs-identifier hs-var">con_res_ty</span></a></span></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">PatSyn -&gt; ([Id], ThetaType, [Id], ThetaType, [Scaled Type], Type)
</span><a href="GHC.Core.PatSyn.html#patSynSig"><span class="hs-identifier hs-var">patSynSig</span></a></span><span> </span><span class="annot"><span class="annottext">PatSyn
</span><a href="#local-6989586621681374390"><span class="hs-identifier hs-var">ps</span></a></span><span>
</span><span id="line-1531"></span><span>  </span><span id="local-6989586621681374385"><span class="annot"><span class="annottext">TCvSubst
</span><a href="#local-6989586621681374385"><span class="hs-identifier hs-var">subst</span></a></span></span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">forall (m :: * -&gt; *) a. m (Maybe a) -&gt; MaybeT m a
</span><a href="../../transformers-0.5.6.2/src/Control-Monad-Trans-Maybe.html#MaybeT"><span class="hs-identifier hs-var">MaybeT</span></a></span><span> </span><span class="annot"><span class="annottext">forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><a href="../../base-4.16.4.0/src/GHC-Base.html#%24"><span class="hs-operator hs-var">$</span></a></span><span> </span><span class="annot"><span class="annottext">forall (f :: * -&gt; *) a. Applicative f =&gt; a -&gt; f a
</span><a href="../../base-4.16.4.0/src/GHC-Base.html#pure"><span class="hs-identifier hs-var">pure</span></a></span><span> </span><span class="annot"><span class="annottext">forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><a href="../../base-4.16.4.0/src/GHC-Base.html#%24"><span class="hs-operator hs-var">$</span></a></span><span> </span><span class="annot"><span class="annottext">Type -&gt; Type -&gt; Maybe TCvSubst
</span><a href="GHC.Core.Unify.html#tcMatchTy"><span class="hs-identifier hs-var">tcMatchTy</span></a></span><span> </span><span class="annot"><span class="annottext">Type
</span><a href="#local-6989586621681374387"><span class="hs-identifier hs-var">con_res_ty</span></a></span><span> </span><span class="annot"><span class="annottext">Type
</span><a href="#local-6989586621681374391"><span class="hs-identifier hs-var">ty</span></a></span><span>
</span><span id="line-1532"></span><span>  </span><span class="annot"><span class="annottext">forall (f :: * -&gt; *). Alternative f =&gt; Bool -&gt; f ()
</span><a href="../../base-4.16.4.0/src/Control-Monad.html#guard"><span class="hs-identifier hs-var">guard</span></a></span><span> </span><span class="annot"><span class="annottext">forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><a href="../../base-4.16.4.0/src/GHC-Base.html#%24"><span class="hs-operator hs-var">$</span></a></span><span> </span><span class="annot"><span class="annottext">forall (t :: * -&gt; *) a. Foldable t =&gt; (a -&gt; Bool) -&gt; t a -&gt; Bool
</span><a href="../../base-4.16.4.0/src/Data-Foldable.html#all"><span class="hs-identifier hs-var">all</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Id -&gt; TCvSubst -&gt; Bool
</span><a href="GHC.Core.TyCo.Subst.html#elemTCvSubst"><span class="hs-operator hs-var">`elemTCvSubst`</span></a></span><span> </span><span class="annot"><span class="annottext">TCvSubst
</span><a href="#local-6989586621681374385"><span class="hs-identifier hs-var">subst</span></a></span><span class="hs-special">)</span><span> </span><span class="annot"><span class="annottext">[Id]
</span><a href="#local-6989586621681374389"><span class="hs-identifier hs-var">univ_tvs</span></a></span><span> </span><span class="hs-comment">-- See the Note about T11336b</span><span>
</span><span id="line-1533"></span><span>  </span><span class="hs-keyword">if</span><span> </span><span class="annot"><span class="annottext">forall (t :: * -&gt; *) a. Foldable t =&gt; t a -&gt; Bool
</span><a href="../../base-4.16.4.0/src/Data-Foldable.html#null"><span class="hs-identifier hs-var">null</span></a></span><span> </span><span class="annot"><span class="annottext">ThetaType
</span><a href="#local-6989586621681374388"><span class="hs-identifier hs-var">req_theta</span></a></span><span>
</span><span id="line-1534"></span><span>    </span><span class="hs-keyword">then</span><span> </span><span class="annot"><span class="annottext">forall (f :: * -&gt; *) a. Applicative f =&gt; a -&gt; f a
</span><a href="../../base-4.16.4.0/src/GHC-Base.html#pure"><span class="hs-identifier hs-var">pure</span></a></span><span> </span><span class="annot"><span class="annottext">TCvSubst
</span><a href="#local-6989586621681374385"><span class="hs-identifier hs-var">subst</span></a></span><span>
</span><span id="line-1535"></span><span>    </span><span class="hs-keyword">else</span><span> </span><span class="hs-keyword">do</span><span>
</span><span id="line-1536"></span><span>      </span><span class="hs-keyword">let</span><span> </span><span id="local-6989586621681374384"><span class="annot"><span class="annottext">req_theta' :: ThetaType
</span><a href="#local-6989586621681374384"><span class="hs-identifier hs-var hs-var">req_theta'</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">HasCallStack =&gt; TCvSubst -&gt; ThetaType -&gt; ThetaType
</span><a href="GHC.Core.TyCo.Subst.html#substTys"><span class="hs-identifier hs-var">substTys</span></a></span><span> </span><span class="annot"><span class="annottext">TCvSubst
</span><a href="#local-6989586621681374385"><span class="hs-identifier hs-var">subst</span></a></span><span> </span><span class="annot"><span class="annottext">ThetaType
</span><a href="#local-6989586621681374388"><span class="hs-identifier hs-var">req_theta</span></a></span><span>
</span><span id="line-1537"></span><span>      </span><span id="local-6989586621681374383"><span class="annot"><span class="annottext">Bool
</span><a href="#local-6989586621681374383"><span class="hs-identifier hs-var">satisfiable</span></a></span></span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">forall (t :: (* -&gt; *) -&gt; * -&gt; *) (m :: * -&gt; *) a.
(MonadTrans t, Monad m) =&gt;
m a -&gt; t m a
</span><a href="../../transformers-0.5.6.2/src/Control-Monad-Trans-Class.html#lift"><span class="hs-identifier hs-var">lift</span></a></span><span> </span><span class="annot"><span class="annottext">forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><a href="../../base-4.16.4.0/src/GHC-Base.html#%24"><span class="hs-operator hs-var">$</span></a></span><span> </span><span class="annot"><span class="annottext">forall a. TcM a -&gt; DsM a
</span><a href="GHC.HsToCore.Monad.html#initTcDsForSolver"><span class="hs-identifier hs-var">initTcDsForSolver</span></a></span><span> </span><span class="annot"><span class="annottext">forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><a href="../../base-4.16.4.0/src/GHC-Base.html#%24"><span class="hs-operator hs-var">$</span></a></span><span> </span><span class="annot"><span class="annottext">InertSet -&gt; ThetaType -&gt; TcM Bool
</span><a href="GHC.Tc.Solver.html#tcCheckWanteds"><span class="hs-identifier hs-var">tcCheckWanteds</span></a></span><span> </span><span class="annot"><span class="annottext">InertSet
</span><a href="#local-6989586621681374392"><span class="hs-identifier hs-var">inert</span></a></span><span> </span><span class="annot"><span class="annottext">ThetaType
</span><a href="#local-6989586621681374384"><span class="hs-identifier hs-var">req_theta'</span></a></span><span>
</span><span id="line-1538"></span><span>      </span><span class="hs-keyword">if</span><span> </span><span class="annot"><span class="annottext">Bool
</span><a href="#local-6989586621681374383"><span class="hs-identifier hs-var">satisfiable</span></a></span><span>
</span><span id="line-1539"></span><span>        </span><span class="hs-keyword">then</span><span> </span><span class="annot"><span class="annottext">forall (f :: * -&gt; *) a. Applicative f =&gt; a -&gt; f a
</span><a href="../../base-4.16.4.0/src/GHC-Base.html#pure"><span class="hs-identifier hs-var">pure</span></a></span><span> </span><span class="annot"><span class="annottext">TCvSubst
</span><a href="#local-6989586621681374385"><span class="hs-identifier hs-var">subst</span></a></span><span>
</span><span id="line-1540"></span><span>        </span><span class="hs-keyword">else</span><span> </span><span class="annot"><span class="annottext">forall (m :: * -&gt; *) a. MonadPlus m =&gt; m a
</span><a href="../../base-4.16.4.0/src/GHC-Base.html#mzero"><span class="hs-identifier hs-var">mzero</span></a></span><span>
</span><span id="line-1541"></span><span>
</span><span id="line-1542"></span><span class="hs-comment">{- Note [Soundness and completeness]
~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~
Soundness and completeness of the pattern-match checker depends entirely on the
soundness and completeness of the inhabitation test.

Achieving both soundness and completeness at the same time is undecidable.
See also T17977 and Note [Fuel for the inhabitation test].
Losing soundness would make the algorithm pointless; hence we give up on
completeness, but try to get as close as possible (how close is called
the 'precision' of the algorithm).

Soundness means that you
  1. Can remove clauses flagged as redundant without changing program semantics
     (no false positives).
  2. Can be sure that your program is free of incomplete pattern matches
     when the checker doesn't flag any inexhaustive definitions
     (no false negatives).

A complete algorithm would mean that
  1. When a clause can be deleted without changing program semantics, it will
     be flagged as redundant (no false negatives).
  2. A program that is free of incomplete pattern matches will never have a
     definition be flagged as inexhaustive (no false positives).

Via the LYG algorithm, we reduce both these properties to a property on
the inhabitation test of refinementment types:
  *Soundness*:    If the inhabitation test says &quot;no&quot; for a given refinement type
                  Nabla, then it provably has no inhabitant.
  *Completeness*: If the inhabitation test says &quot;yes&quot; for a given refinement type
                  Nabla, then it provably has an inhabitant.
Our test is sound, but incomplete, so there are instances where we say
&quot;yes&quot; but in fact the Nabla is empty. Which entails false positive exhaustivity
and false negative redundancy warnings, as above.

In summary, we have the following correspondence:

Property     | Exhaustiveness warnings | Redundancy warnings | Inhabitation test |
-------------|-------------------------|---------------------|-------------------|
Soundness    | No false negatives      | No false positives  | Only says &quot;no&quot;    |
             |                         |                     | if there is no    |
             |                         |                     | inhabitant        |
Completeness | No false positives      | No false negatives  | Only says &quot;yes&quot;   |
             |                         |                     | if there is an    |
             |                         |                     | inhabitant        |

Note [Shortcutting the inhabitation test]
~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~
Generally, we have to re-test a refinement type for inhabitants whenever we
add a new constraint. Often, we can say &quot;no&quot; early, upon trying to add a
contradicting constraint, see Note [The Pos/Neg invariant]. Still, COMPLETE
sets and type evidence are best handled in a delayed fashion, because of
the recursive nature of the test and our fuel-based approach.
But even then there are some cases in which we can skip the full test,
because we are sure that the refinement type is still inhabited. These
conditions are monitored by 'varNeedsTesting'. It returns

- `True` whenever a full inhabitation test is needed
- `False` whenever the test can be skipped, amounting to an inhabitation test
  that says &quot;yes&quot;.

According to Note [Soundness and Completeness], this test will never compromise
soundness: The `True` case just forwards to the actual inhabitation test and the
`False` case amounts to an inhabitation test that is trivially sound, because it
never says &quot;no&quot;.

Of course, if the returns says `False`, Completeness (and thus Precision) of the
algorithm is affected, but we get to skip costly inhabitation tests. We try to
trade as little Precision as possible against as much Performance as possible.
Here are the tests, in order:

  1. If a variable is dirty (because of a newly added negative term constraint),
     we have to test.
  2. If a variable has positive information, we don't have to test: The
     positive information acts as constructive proof for inhabitation.
  3. If the type state didn't change, there is no need to test.
  4. If the variable's normalised type didn't change, there is no need to test.
  5. Otherwise, we have to test.

Why (1) before (2)?
-------------------
Consider the reverse for (T18960):
  pattern P x = x
  {-# COMPLETE P :: () #-}
  foo = case () of x@(P _) -&gt; ()
This should be exhaustive. But if we say &quot;We know `x` has solution `()`, so it's
inhabited&quot;, then we'll get a warning saying that `()` wasn't matched.
But the match on `P` added the new negative information to the uncovered set,
in the process of which we marked `x` as dirty. By giving the dirty flag a
higher priority than positive info, we get to test again and see that `x` is
uninhabited and the match is exhaustive.

But suppose that `P` wasn't mentioned in any COMPLETE set. Then we simply
don't mark `x` as dirty and will emit a warning again (which we would anyway),
without running a superfluous inhabitation test. That speeds up T17836
considerably.

Why (2) before (3) and (4)?
---------------------------
Simply because (2) is more efficient to test than (3) (not by a lot), which
is more efficient to test than (4), which is still more efficient than running
the full inhabitation test (5).

Note [Fuel for the inhabitation test]
~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~
Whether or not a type is inhabited is undecidable in general, see also
Note [Soundness and Completeness]. As a result, we can run into infinite
loops in `inhabitationTest`. Therefore, we adopt a fuel-based approach to
prevent that.

Consider the following example:

  data Abyss = MkAbyss !Abyss
  stareIntoTheAbyss :: Abyss -&gt; a
  stareIntoTheAbyss x = case x of {}

In principle, stareIntoTheAbyss is exhaustive, since there is no way to
construct a terminating value using MkAbyss. But this can't be proven by mere
instantiation and requires an inductive argument, which `inhabitationTest`
currently isn't equipped to do.

In order to prevent endless instantiation attempts in @inhabitationTest@, we
use the fuel as an upper bound such attempts.

The same problem occurs with recursive newtypes, like in the following code:

  newtype Chasm = MkChasm Chasm
  gazeIntoTheChasm :: Chasm -&gt; a
  gazeIntoTheChasm x = case x of {} -- Erroneously warned as non-exhaustive

So this limitation is somewhat understandable.

Note that even with this recursion detection, there is still a possibility that
`inhabitationTest` can run in exponential time in the amount of fuel. Consider
the following data type:

  data T = MkT !T !T !T

If we try to instantiate each of its fields, that will require us to once again
check if `MkT` is inhabitable in each of those three fields, which in turn will
require us to check if `MkT` is inhabitable again... As you can see, the
branching factor adds up quickly, and if the initial fuel is, say,
100, then the inhabiation test will effectively take forever.

To mitigate this, we check the branching factor every time we are about to do
inhabitation testing in 'instCon'. If the branching factor exceeds 1
(i.e., if there is potential for exponential runtime), then we limit the
maximum recursion depth to 1 to mitigate the problem. If the branching factor
is exactly 1 (i.e., we have a linear chain instead of a tree), then it's okay
to stick with a larger maximum recursion depth.

In #17977 we saw that the defaultRecTcMaxBound (100 at the time of writing) was
too large and had detrimental effect on performance of the coverage checker.
Given that we only commit to a best effort anyway, we decided to substantially
decrement the fuel to 4, at the cost of precision in some edge cases
like

  data Nat = Z | S Nat
  data Down :: Nat -&gt; Type where
    Down :: !(Down n) -&gt; Down (S n)
  f :: Down (S (S (S (S (S Z))))) -&gt; ()
  f x = case x of {}

Since the coverage won't bother to instantiate Down 4 levels deep to see that it
is in fact uninhabited, it will emit a inexhaustivity warning for the case.

Note [DataCons that are definitely inhabitable]
~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~
Another microoptimization applies to data types like this one:

  data S a = S ![a] !T

Even though there is a strict field of type [a], it's quite silly to call
'instCon' on it, since it's &quot;obvious&quot; that it is inhabitable. To make this
intuition formal, we say that a DataCon C is definitely inhabitable (DI) if:

  1. C has no equality constraints (since they might be unsatisfiable)
  2. C has no strict arguments (since they might be uninhabitable)
  3. C has no unlifted argument types (since they might be uninhabitable)

It's relatively cheap to check if a DataCon is DI, so before we call 'instCon'
on a constructor of a COMPLETE set, we filter out all of the DI ones.

This fast path shaves down -7% allocations for PmSeriesG, for example.

Note [Matching against a ConLike result type]
~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~
Given a ConLike

&gt; C :: forall us. R =&gt; ... -&gt; res_ty

is a pattern `C ...` compatible with the type `ty`? Clearly that is the case if
`res_ty` /subsumes/ `ty` and the required constraints `R` (strictly a feature of
pattern synonyms) are satisfiable. In that case, 'matchConLikeResTy' returns a
substitution &#963; over `us` such that `&#963;(res_ty) == ty`.

It's surprisingly tricky to implement correctly, and works quite different for
DataCons and PatSynCons:

  * For data cons, we look at `ty` and see if it's a TyCon app `T t1 ... tn`.
    If that is the case, we make sure that `C` is a DataCon of `T` and return
    a substitution mapping `C`'s universal tyvars `us` to `t1`...`tn`.

    Wrinkle: Since `T` might be a data family TyCon, we have to look up its
    representation TyCon before we compare to `C`'s TyCon.
    So we use 'splitReprTyConApp_maybe' instead of 'splitTyConApp_maybe'.

  * For pattern synonyms, we directly match `ty` against `res_ty` to get the
    substitution &#963;. See Note [Pattern synonym result type] in &quot;GHC.Core.PatSyn&quot;.

    Fortunately, we don't have to treat data family TyCons specially:
    Pattern synonyms /never/ apply to a data family representation TyCon.
    We do have to consider the required constraints `&#963;(R)`, though, as we have
    seen in #19475. That is done by solving them as Wanted constraints given the
    inert set of the current type state (which is part of a Nabla's TySt). Since
    spinning up a constraint solver session is costly, we only do so in the rare
    cases that a pattern synonym actually carries any required constraints.

    We can get into the strange situation that not all universal type variables
    `us` occur in `res_ty`. Example from T11336b:

      instance C Proxy where ...                      -- impl uninteresting
      pattern P :: forall f a. C f =&gt; f a -&gt; Proxy a  -- impl uninteresting

      fun :: Proxy a -&gt; ()
      fun (P Proxy) = ()
      fun (P Proxy) = () -- ideally detected as redundant

    `f` is a universal type variable and `C f` the required constraint of
    pattern synonym `P`. But `f` doesn't occur in the result type `Proxy a` of
    `P`, so &#963; will not even have `f` in its in-scope set. It's a bit unclear
    what to do here; we might want to freshen `f` to `f'` and see if we can
    solve `C f'` as a Wanted constraint, which we most likely can't.
    Hence, we simply skip the freshening and declare the match as failed when
    there is a variable like `f`. For the definition of `fun`, that
    means we will not remember that we matched on `P` and thus will
    not detect its second clause as redundant.

    See Note [Pattern synonym result type] in &quot;GHC.Core.PatSyn&quot; for similar
    oddities.

Note [Instantiating a ConLike]
~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~
`instCon` implements the the \(Inst\) function from Figure 8 of the LYG paper.

Given the following type of ConLike `K`

&gt; K :: forall us. R =&gt; forall es. P =&gt; t1 -&gt; ... -&gt; tn -&gt; res_ty

and a variable `x::match_ty`, it tries to find an instantiation
`K ex_tvs gammas arg_ids :: match_ty` (for fresh `arg_ids`) and ultimately adds
a constructor constraint `K ex_tvs gammas arg_ids &lt;- x` to the given Nabla.

As a first step, it tries (via 'matchConLikeResTy') to match `match_ty` against
`res_ty` and checks that that the required constraints @R@ are satisfiable.
See Note [Matching against a ConLike result type].

If matching /fails/, it trivially (and conservatively) reports &quot;inhabited&quot; by
returning the unrefined input Nabla. After all, the match might have failed due
to incomplete type information in Nabla.
(Type refinement from unpacking GADT constructors might monomorphise `match_ty`
so much that `res_ty` ultimately subsumes it.)

If matching /succeeds/, we get a substitution &#963; for the (universal)
tyvars `us`. After applying &#963;, we get

&gt; K @&#963;(us) :: &#963;(R) =&gt; forall &#963;(es). &#963;(P) =&gt; &#963;(t1) -&gt; ... -&gt; &#963;(tn) -&gt; match_ty

The existentials `es` might still occur in argument types `&#963;(tn)`, though.
Now 'instCon' performs the following steps:

 1. It drops the required constraints `&#963;(R)`, as they have already been
    discharged by 'matchConLikeResTy'.
 2. It instantiates fresh binders `es'` for the other type variables `es`
    bound by `K` and adds the mapping to &#963; to get &#963;', so that we have

    &gt; K @&#963;(us) @es' :: &#963;'(P) =&gt; &#963;'(t1) -&gt; ... -&gt; &#963;'(tn) -&gt; match_ty

 3. It adds new type constraints from the substituted
    provided constraints @&#963;'(P)@.
 4. It substitutes and conjures new binders @arg_ids@ for the argument types
    @&#963;'(t1) ... &#963;'(tn)@.
 5. It adds a term constraint @K es' &#963;'(P) arg_ids &lt;- x@, which handles
    the details regarding type constraints and unlifted fields.

And finally the extended 'Nabla' is returned if all the constraints were
compatible.
-}</span><span>
</span><span id="line-1829"></span><span>
</span><span id="line-1830"></span><span class="hs-comment">--------------------------------------</span><span>
</span><span id="line-1831"></span><span class="hs-comment">-- * Generating inhabitants of a Nabla</span><span>
</span><span id="line-1832"></span><span class="hs-comment">--</span><span>
</span><span id="line-1833"></span><span class="hs-comment">-- This is important for warnings. Roughly corresponds to G in Figure 6 of the</span><span>
</span><span id="line-1834"></span><span class="hs-comment">-- LYG paper, with a few tweaks for better warning messages.</span><span>
</span><span id="line-1835"></span><span>
</span><span id="line-1836"></span><span class="hs-comment">-- | @generateInhabitingPatterns vs n nabla@ returns a list of at most @n@ (but</span><span>
</span><span id="line-1837"></span><span class="hs-comment">-- perhaps empty) refinements of @nabla@ that represent inhabited patterns.</span><span>
</span><span id="line-1838"></span><span class="hs-comment">-- Negative information is only retained if literals are involved or for</span><span>
</span><span id="line-1839"></span><span class="hs-comment">-- recursive GADTs.</span><span>
</span><span id="line-1840"></span><span class="annot"><a href="GHC.HsToCore.Pmc.Solver.html#generateInhabitingPatterns"><span class="hs-identifier hs-type">generateInhabitingPatterns</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="hs-special">[</span><span class="annot"><a href="GHC.Types.Var.html#Id"><span class="hs-identifier hs-type">Id</span></a></span><span class="hs-special">]</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="hs-identifier hs-type">Int</span></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="GHC.HsToCore.Pmc.Solver.Types.html#Nabla"><span class="hs-identifier hs-type">Nabla</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="GHC.HsToCore.Types.html#DsM"><span class="hs-identifier hs-type">DsM</span></a></span><span> </span><span class="hs-special">[</span><span class="annot"><a href="GHC.HsToCore.Pmc.Solver.Types.html#Nabla"><span class="hs-identifier hs-type">Nabla</span></a></span><span class="hs-special">]</span><span>
</span><span id="line-1841"></span><span class="hs-comment">-- See Note [Why inhabitationTest doesn't call generateInhabitingPatterns]</span><span>
</span><span id="line-1842"></span><span id="generateInhabitingPatterns"><span class="annot"><span class="annottext">generateInhabitingPatterns :: [Id] -&gt; Int -&gt; Nabla -&gt; DsM [Nabla]
</span><a href="GHC.HsToCore.Pmc.Solver.html#generateInhabitingPatterns"><span class="hs-identifier hs-var hs-var">generateInhabitingPatterns</span></a></span></span><span> </span><span class="annot"><span class="annottext">[Id]
</span><span class="hs-identifier">_</span></span><span>      </span><span class="annot"><span class="annottext">Int
</span><span class="hs-number">0</span></span><span> </span><span class="annot"><span class="annottext">Nabla
</span><span class="hs-identifier">_</span></span><span>     </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">forall (f :: * -&gt; *) a. Applicative f =&gt; a -&gt; f a
</span><a href="../../base-4.16.4.0/src/GHC-Base.html#pure"><span class="hs-identifier hs-var">pure</span></a></span><span> </span><span class="hs-special">[</span><span class="hs-special">]</span><span>
</span><span id="line-1843"></span><span class="annot"><a href="GHC.HsToCore.Pmc.Solver.html#generateInhabitingPatterns"><span class="hs-identifier hs-var">generateInhabitingPatterns</span></a></span><span> </span><span class="hs-special">[</span><span class="hs-special">]</span><span>     </span><span class="annot"><span class="annottext">Int
</span><span class="hs-identifier">_</span></span><span> </span><span id="local-6989586621681374382"><span class="annot"><span class="annottext">Nabla
</span><a href="#local-6989586621681374382"><span class="hs-identifier hs-var">nabla</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">forall (f :: * -&gt; *) a. Applicative f =&gt; a -&gt; f a
</span><a href="../../base-4.16.4.0/src/GHC-Base.html#pure"><span class="hs-identifier hs-var">pure</span></a></span><span> </span><span class="hs-special">[</span><span class="annot"><span class="annottext">Nabla
</span><a href="#local-6989586621681374382"><span class="hs-identifier hs-var">nabla</span></a></span><span class="hs-special">]</span><span>
</span><span id="line-1844"></span><span class="annot"><a href="GHC.HsToCore.Pmc.Solver.html#generateInhabitingPatterns"><span class="hs-identifier hs-var">generateInhabitingPatterns</span></a></span><span> </span><span class="hs-special">(</span><span id="local-6989586621681374381"><span class="annot"><span class="annottext">Id
</span><a href="#local-6989586621681374381"><span class="hs-identifier hs-var">x</span></a></span></span><span class="annot"><span class="hs-glyph hs-type">:</span></span><span id="local-6989586621681374380"><span class="annot"><span class="annottext">[Id]
</span><a href="#local-6989586621681374380"><span class="hs-identifier hs-var">xs</span></a></span></span><span class="hs-special">)</span><span> </span><span id="local-6989586621681374379"><span class="annot"><span class="annottext">Int
</span><a href="#local-6989586621681374379"><span class="hs-identifier hs-var">n</span></a></span></span><span> </span><span id="local-6989586621681374378"><span class="annot"><span class="annottext">Nabla
</span><a href="#local-6989586621681374378"><span class="hs-identifier hs-var">nabla</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-keyword">do</span><span>
</span><span id="line-1845"></span><span>  </span><span class="annot"><span class="annottext">String -&gt; SDoc -&gt; DsM ()
</span><a href="GHC.HsToCore.Pmc.Utils.html#tracePm"><span class="hs-identifier hs-var">tracePm</span></a></span><span> </span><span class="annot"><span class="annottext">String
</span><span class="hs-string">&quot;generateInhabitingPatterns&quot;</span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">forall a. Outputable a =&gt; a -&gt; SDoc
</span><a href="GHC.Utils.Outputable.html#ppr"><span class="hs-identifier hs-var">ppr</span></a></span><span> </span><span class="annot"><span class="annottext">Int
</span><a href="#local-6989586621681374379"><span class="hs-identifier hs-var">n</span></a></span><span> </span><span class="annot"><span class="annottext">SDoc -&gt; SDoc -&gt; SDoc
</span><a href="GHC.Utils.Outputable.html#%3C%2B%3E"><span class="hs-operator hs-var">&lt;+&gt;</span></a></span><span> </span><span class="annot"><span class="annottext">forall a. Outputable a =&gt; a -&gt; SDoc
</span><a href="GHC.Utils.Outputable.html#ppr"><span class="hs-identifier hs-var">ppr</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Id
</span><a href="#local-6989586621681374381"><span class="hs-identifier hs-var">x</span></a></span><span class="annot"><span class="annottext">forall a. a -&gt; [a] -&gt; [a]
</span><span class="hs-glyph hs-var">:</span></span><span class="annot"><span class="annottext">[Id]
</span><a href="#local-6989586621681374380"><span class="hs-identifier hs-var">xs</span></a></span><span class="hs-special">)</span><span> </span><span class="annot"><span class="annottext">SDoc -&gt; SDoc -&gt; SDoc
</span><a href="GHC.Utils.Outputable.html#%24%24"><span class="hs-operator hs-var">$$</span></a></span><span> </span><span class="annot"><span class="annottext">forall a. Outputable a =&gt; a -&gt; SDoc
</span><a href="GHC.Utils.Outputable.html#ppr"><span class="hs-identifier hs-var">ppr</span></a></span><span> </span><span class="annot"><span class="annottext">Nabla
</span><a href="#local-6989586621681374378"><span class="hs-identifier hs-var">nabla</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-1846"></span><span>  </span><span class="hs-keyword">let</span><span> </span><span class="annot"><a href="GHC.HsToCore.Pmc.Solver.Types.html#VI"><span class="hs-identifier hs-type">VI</span></a></span><span> </span><span class="annot"><span class="annottext">Id
</span><span class="hs-identifier">_</span></span><span> </span><span id="local-6989586621681374377"><span class="annot"><span class="annottext">[PmAltConApp]
</span><a href="#local-6989586621681374377"><span class="hs-identifier hs-var">pos</span></a></span></span><span> </span><span id="local-6989586621681374376"><span class="annot"><span class="annottext">PmAltConSet
</span><a href="#local-6989586621681374376"><span class="hs-identifier hs-var">neg</span></a></span></span><span> </span><span class="annot"><span class="annottext">BotInfo
</span><span class="hs-identifier">_</span></span><span> </span><span class="annot"><span class="annottext">ResidualCompleteMatches
</span><span class="hs-identifier">_</span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">TmState -&gt; Id -&gt; VarInfo
</span><a href="GHC.HsToCore.Pmc.Solver.html#lookupVarInfo"><span class="hs-identifier hs-var">lookupVarInfo</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Nabla -&gt; TmState
</span><a href="GHC.HsToCore.Pmc.Solver.Types.html#nabla_tm_st"><span class="hs-identifier hs-var">nabla_tm_st</span></a></span><span> </span><span class="annot"><span class="annottext">Nabla
</span><a href="#local-6989586621681374378"><span class="hs-identifier hs-var">nabla</span></a></span><span class="hs-special">)</span><span> </span><span class="annot"><span class="annottext">Id
</span><a href="#local-6989586621681374381"><span class="hs-identifier hs-var">x</span></a></span><span>
</span><span id="line-1847"></span><span>  </span><span class="hs-keyword">case</span><span> </span><span class="annot"><span class="annottext">[PmAltConApp]
</span><a href="#local-6989586621681374377"><span class="hs-identifier hs-var">pos</span></a></span><span> </span><span class="hs-keyword">of</span><span>
</span><span id="line-1848"></span><span>    </span><span class="annot"><span class="annottext">PmAltConApp
</span><span class="hs-identifier">_</span></span><span class="annot"><span class="hs-glyph hs-type">:</span></span><span class="annot"><span class="annottext">[PmAltConApp]
</span><span class="hs-identifier">_</span></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-keyword">do</span><span>
</span><span id="line-1849"></span><span>      </span><span class="hs-comment">-- All solutions must be valid at once. Try to find candidates for their</span><span>
</span><span id="line-1850"></span><span>      </span><span class="hs-comment">-- fields. Example:</span><span>
</span><span id="line-1851"></span><span>      </span><span class="hs-comment">--   f x@(Just _) True = case x of SomePatSyn _ -&gt; ()</span><span>
</span><span id="line-1852"></span><span>      </span><span class="hs-comment">-- after this clause, we want to report that</span><span>
</span><span id="line-1853"></span><span>      </span><span class="hs-comment">--   * @f Nothing _@ is uncovered</span><span>
</span><span id="line-1854"></span><span>      </span><span class="hs-comment">--   * @f x False@ is uncovered</span><span>
</span><span id="line-1855"></span><span>      </span><span class="hs-comment">-- where @x@ will have two possibly compatible solutions, @Just y@ for</span><span>
</span><span id="line-1856"></span><span>      </span><span class="hs-comment">-- some @y@ and @SomePatSyn z@ for some @z@. We must find evidence for @y@</span><span>
</span><span id="line-1857"></span><span>      </span><span class="hs-comment">-- and @z@ that is valid at the same time. These constitute arg_vas below.</span><span>
</span><span id="line-1858"></span><span>      </span><span class="hs-keyword">let</span><span> </span><span id="local-6989586621681374375"><span class="annot"><span class="annottext">arg_vas :: [Id]
</span><a href="#local-6989586621681374375"><span class="hs-identifier hs-var hs-var">arg_vas</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">forall (t :: * -&gt; *) a b. Foldable t =&gt; (a -&gt; [b]) -&gt; t a -&gt; [b]
</span><a href="../../base-4.16.4.0/src/Data-Foldable.html#concatMap"><span class="hs-identifier hs-var">concatMap</span></a></span><span> </span><span class="annot"><span class="annottext">PmAltConApp -&gt; [Id]
</span><a href="GHC.HsToCore.Pmc.Solver.Types.html#paca_ids"><span class="hs-identifier hs-var">paca_ids</span></a></span><span> </span><span class="annot"><span class="annottext">[PmAltConApp]
</span><a href="#local-6989586621681374377"><span class="hs-identifier hs-var">pos</span></a></span><span>
</span><span id="line-1859"></span><span>      </span><span class="annot"><span class="annottext">[Id] -&gt; Int -&gt; Nabla -&gt; DsM [Nabla]
</span><a href="GHC.HsToCore.Pmc.Solver.html#generateInhabitingPatterns"><span class="hs-identifier hs-var">generateInhabitingPatterns</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">[Id]
</span><a href="#local-6989586621681374375"><span class="hs-identifier hs-var">arg_vas</span></a></span><span> </span><span class="annot"><span class="annottext">forall a. [a] -&gt; [a] -&gt; [a]
</span><a href="../../base-4.16.4.0/src/GHC-Base.html#%2B%2B"><span class="hs-operator hs-var">++</span></a></span><span> </span><span class="annot"><span class="annottext">[Id]
</span><a href="#local-6989586621681374380"><span class="hs-identifier hs-var">xs</span></a></span><span class="hs-special">)</span><span> </span><span class="annot"><span class="annottext">Int
</span><a href="#local-6989586621681374379"><span class="hs-identifier hs-var">n</span></a></span><span> </span><span class="annot"><span class="annottext">Nabla
</span><a href="#local-6989586621681374378"><span class="hs-identifier hs-var">nabla</span></a></span><span>
</span><span id="line-1860"></span><span>    </span><span class="hs-special">[</span><span class="hs-special">]</span><span>
</span><span id="line-1861"></span><span>      </span><span class="hs-comment">-- When there are literals involved, just print negative info</span><span>
</span><span id="line-1862"></span><span>      </span><span class="hs-comment">-- instead of listing missed constructors</span><span>
</span><span id="line-1863"></span><span>      </span><span class="hs-glyph">|</span><span> </span><span class="annot"><span class="annottext">forall (f :: * -&gt; *) a. Foldable f =&gt; f a -&gt; Bool
</span><a href="GHC.Utils.Misc.html#notNull"><span class="hs-identifier hs-var">notNull</span></a></span><span> </span><span class="hs-special">[</span><span> </span><span class="annot"><span class="annottext">PmLit
</span><a href="#local-6989586621681374373"><span class="hs-identifier hs-var">l</span></a></span><span> </span><span class="hs-glyph">|</span><span> </span><span class="annot"><a href="GHC.HsToCore.Pmc.Solver.Types.html#PmAltLit"><span class="hs-identifier hs-type">PmAltLit</span></a></span><span> </span><span id="local-6989586621681374373"><span class="annot"><span class="annottext">PmLit
</span><a href="#local-6989586621681374373"><span class="hs-identifier hs-var">l</span></a></span></span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">PmAltConSet -&gt; [PmAltCon]
</span><a href="GHC.HsToCore.Pmc.Solver.Types.html#pmAltConSetElems"><span class="hs-identifier hs-var">pmAltConSetElems</span></a></span><span> </span><span class="annot"><span class="annottext">PmAltConSet
</span><a href="#local-6989586621681374376"><span class="hs-identifier hs-var">neg</span></a></span><span> </span><span class="hs-special">]</span><span>
</span><span id="line-1864"></span><span>      </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="annottext">[Id] -&gt; Int -&gt; Nabla -&gt; DsM [Nabla]
</span><a href="GHC.HsToCore.Pmc.Solver.html#generateInhabitingPatterns"><span class="hs-identifier hs-var">generateInhabitingPatterns</span></a></span><span> </span><span class="annot"><span class="annottext">[Id]
</span><a href="#local-6989586621681374380"><span class="hs-identifier hs-var">xs</span></a></span><span> </span><span class="annot"><span class="annottext">Int
</span><a href="#local-6989586621681374379"><span class="hs-identifier hs-var">n</span></a></span><span> </span><span class="annot"><span class="annottext">Nabla
</span><a href="#local-6989586621681374378"><span class="hs-identifier hs-var">nabla</span></a></span><span>
</span><span id="line-1865"></span><span>    </span><span class="hs-special">[</span><span class="hs-special">]</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="annottext">Id -&gt; [Id] -&gt; Int -&gt; Nabla -&gt; DsM [Nabla]
</span><a href="#local-6989586621681374372"><span class="hs-identifier hs-var">try_instantiate</span></a></span><span> </span><span class="annot"><span class="annottext">Id
</span><a href="#local-6989586621681374381"><span class="hs-identifier hs-var">x</span></a></span><span> </span><span class="annot"><span class="annottext">[Id]
</span><a href="#local-6989586621681374380"><span class="hs-identifier hs-var">xs</span></a></span><span> </span><span class="annot"><span class="annottext">Int
</span><a href="#local-6989586621681374379"><span class="hs-identifier hs-var">n</span></a></span><span> </span><span class="annot"><span class="annottext">Nabla
</span><a href="#local-6989586621681374378"><span class="hs-identifier hs-var">nabla</span></a></span><span>
</span><span id="line-1866"></span><span>  </span><span class="hs-keyword">where</span><span>
</span><span id="line-1867"></span><span>    </span><span class="hs-comment">-- | Tries to instantiate a variable by possibly following the chain of</span><span>
</span><span id="line-1868"></span><span>    </span><span class="hs-comment">-- newtypes and then instantiating to all ConLikes of the wrapped type's</span><span>
</span><span id="line-1869"></span><span>    </span><span class="hs-comment">-- minimal residual COMPLETE set.</span><span>
</span><span id="line-1870"></span><span>    </span><span class="annot"><a href="#local-6989586621681374372"><span class="hs-identifier hs-type">try_instantiate</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><a href="GHC.Types.Var.html#Id"><span class="hs-identifier hs-type">Id</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-special">[</span><span class="annot"><a href="GHC.Types.Var.html#Id"><span class="hs-identifier hs-type">Id</span></a></span><span class="hs-special">]</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="hs-identifier hs-type">Int</span></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="GHC.HsToCore.Pmc.Solver.Types.html#Nabla"><span class="hs-identifier hs-type">Nabla</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="GHC.HsToCore.Types.html#DsM"><span class="hs-identifier hs-type">DsM</span></a></span><span> </span><span class="hs-special">[</span><span class="annot"><a href="GHC.HsToCore.Pmc.Solver.Types.html#Nabla"><span class="hs-identifier hs-type">Nabla</span></a></span><span class="hs-special">]</span><span>
</span><span id="line-1871"></span><span>    </span><span class="hs-comment">-- Convention: x binds the outer constructor in the chain, y the inner one.</span><span>
</span><span id="line-1872"></span><span>    </span><span id="local-6989586621681374372"><span class="annot"><span class="annottext">try_instantiate :: Id -&gt; [Id] -&gt; Int -&gt; Nabla -&gt; DsM [Nabla]
</span><a href="#local-6989586621681374372"><span class="hs-identifier hs-var hs-var">try_instantiate</span></a></span></span><span> </span><span id="local-6989586621681374371"><span class="annot"><span class="annottext">Id
</span><a href="#local-6989586621681374371"><span class="hs-identifier hs-var">x</span></a></span></span><span> </span><span id="local-6989586621681374370"><span class="annot"><span class="annottext">[Id]
</span><a href="#local-6989586621681374370"><span class="hs-identifier hs-var">xs</span></a></span></span><span> </span><span id="local-6989586621681374369"><span class="annot"><span class="annottext">Int
</span><a href="#local-6989586621681374369"><span class="hs-identifier hs-var">n</span></a></span></span><span> </span><span id="local-6989586621681374368"><span class="annot"><span class="annottext">Nabla
</span><a href="#local-6989586621681374368"><span class="hs-identifier hs-var">nabla</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-keyword">do</span><span>
</span><span id="line-1873"></span><span>      </span><span class="hs-special">(</span><span id="local-6989586621681374367"><span class="annot"><span class="annottext">Type
</span><a href="#local-6989586621681374367"><span class="hs-identifier hs-var">_src_ty</span></a></span></span><span class="hs-special">,</span><span> </span><span id="local-6989586621681374366"><span class="annot"><span class="annottext">[(Type, DataCon, Type)]
</span><a href="#local-6989586621681374366"><span class="hs-identifier hs-var">dcs</span></a></span></span><span class="hs-special">,</span><span> </span><span id="local-6989586621681374365"><span class="annot"><span class="annottext">Type
</span><a href="#local-6989586621681374365"><span class="hs-identifier hs-var">rep_ty</span></a></span></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">TopNormaliseTypeResult -&gt; (Type, [(Type, DataCon, Type)], Type)
</span><a href="GHC.HsToCore.Pmc.Solver.html#tntrGuts"><span class="hs-identifier hs-var">tntrGuts</span></a></span><span> </span><span class="annot"><span class="annottext">forall (f :: * -&gt; *) a b. Functor f =&gt; (a -&gt; b) -&gt; f a -&gt; f b
</span><a href="../../base-4.16.4.0/src/Data-Functor.html#%3C%24%3E"><span class="hs-operator hs-var">&lt;$&gt;</span></a></span><span> </span><span class="annot"><span class="annottext">TyState -&gt; Type -&gt; DsM TopNormaliseTypeResult
</span><a href="GHC.HsToCore.Pmc.Solver.html#pmTopNormaliseType"><span class="hs-identifier hs-var">pmTopNormaliseType</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Nabla -&gt; TyState
</span><a href="GHC.HsToCore.Pmc.Solver.Types.html#nabla_ty_st"><span class="hs-identifier hs-var">nabla_ty_st</span></a></span><span> </span><span class="annot"><span class="annottext">Nabla
</span><a href="#local-6989586621681374368"><span class="hs-identifier hs-var">nabla</span></a></span><span class="hs-special">)</span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Id -&gt; Type
</span><a href="GHC.Types.Id.html#idType"><span class="hs-identifier hs-var">idType</span></a></span><span> </span><span class="annot"><span class="annottext">Id
</span><a href="#local-6989586621681374371"><span class="hs-identifier hs-var">x</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-1874"></span><span>      </span><span id="local-6989586621681374364"><span class="annot"><span class="annottext">Maybe (Id, Nabla)
</span><a href="#local-6989586621681374364"><span class="hs-identifier hs-var">mb_stuff</span></a></span></span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">forall (m :: * -&gt; *) a. MaybeT m a -&gt; m (Maybe a)
</span><a href="../../transformers-0.5.6.2/src/Control-Monad-Trans-Maybe.html#runMaybeT"><span class="hs-identifier hs-var">runMaybeT</span></a></span><span> </span><span class="annot"><span class="annottext">forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><a href="../../base-4.16.4.0/src/GHC-Base.html#%24"><span class="hs-operator hs-var">$</span></a></span><span> </span><span class="annot"><span class="annottext">Id
-&gt; Nabla
-&gt; [(Type, DataCon, Type)]
-&gt; MaybeT (IOEnv (Env DsGblEnv DsLclEnv)) (Id, Nabla)
</span><a href="#local-6989586621681374363"><span class="hs-identifier hs-var">instantiate_newtype_chain</span></a></span><span> </span><span class="annot"><span class="annottext">Id
</span><a href="#local-6989586621681374371"><span class="hs-identifier hs-var">x</span></a></span><span> </span><span class="annot"><span class="annottext">Nabla
</span><a href="#local-6989586621681374368"><span class="hs-identifier hs-var">nabla</span></a></span><span> </span><span class="annot"><span class="annottext">[(Type, DataCon, Type)]
</span><a href="#local-6989586621681374366"><span class="hs-identifier hs-var">dcs</span></a></span><span>
</span><span id="line-1875"></span><span>      </span><span class="hs-keyword">case</span><span> </span><span class="annot"><span class="annottext">Maybe (Id, Nabla)
</span><a href="#local-6989586621681374364"><span class="hs-identifier hs-var">mb_stuff</span></a></span><span> </span><span class="hs-keyword">of</span><span>
</span><span id="line-1876"></span><span>        </span><span class="annot"><span class="annottext">Maybe (Id, Nabla)
</span><a href="../../base-4.16.4.0/src/GHC-Maybe.html#Nothing"><span class="hs-identifier hs-var">Nothing</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="annottext">forall (f :: * -&gt; *) a. Applicative f =&gt; a -&gt; f a
</span><a href="../../base-4.16.4.0/src/GHC-Base.html#pure"><span class="hs-identifier hs-var">pure</span></a></span><span> </span><span class="hs-special">[</span><span class="hs-special">]</span><span>
</span><span id="line-1877"></span><span>        </span><span class="annot"><a href="../../base-4.16.4.0/src/GHC-Maybe.html#Just"><span class="hs-identifier hs-type">Just</span></a></span><span> </span><span class="hs-special">(</span><span id="local-6989586621681374362"><span class="annot"><span class="annottext">Id
</span><a href="#local-6989586621681374362"><span class="hs-identifier hs-var">y</span></a></span></span><span class="hs-special">,</span><span> </span><span id="local-6989586621681374361"><span class="annot"><span class="annottext">Nabla
</span><a href="#local-6989586621681374361"><span class="hs-identifier hs-var">newty_nabla</span></a></span></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-keyword">do</span><span>
</span><span id="line-1878"></span><span>          </span><span class="hs-keyword">let</span><span> </span><span id="local-6989586621681374360"><span class="annot"><span class="annottext">vi :: VarInfo
</span><a href="#local-6989586621681374360"><span class="hs-identifier hs-var hs-var">vi</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">TmState -&gt; Id -&gt; VarInfo
</span><a href="GHC.HsToCore.Pmc.Solver.html#lookupVarInfo"><span class="hs-identifier hs-var">lookupVarInfo</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Nabla -&gt; TmState
</span><a href="GHC.HsToCore.Pmc.Solver.Types.html#nabla_tm_st"><span class="hs-identifier hs-var">nabla_tm_st</span></a></span><span> </span><span class="annot"><span class="annottext">Nabla
</span><a href="#local-6989586621681374361"><span class="hs-identifier hs-var">newty_nabla</span></a></span><span class="hs-special">)</span><span> </span><span class="annot"><span class="annottext">Id
</span><a href="#local-6989586621681374362"><span class="hs-identifier hs-var">y</span></a></span><span>
</span><span id="line-1879"></span><span>          </span><span id="local-6989586621681374359"><span class="annot"><span class="annottext">FamInstEnvs
</span><a href="#local-6989586621681374359"><span class="hs-identifier hs-var">env</span></a></span></span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">DsM FamInstEnvs
</span><a href="GHC.HsToCore.Monad.html#dsGetFamInstEnvs"><span class="hs-identifier hs-var">dsGetFamInstEnvs</span></a></span><span>
</span><span id="line-1880"></span><span>          </span><span id="local-6989586621681374358"><span class="annot"><span class="annottext">ResidualCompleteMatches
</span><a href="#local-6989586621681374358"><span class="hs-identifier hs-var">rcm</span></a></span></span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="hs-keyword">case</span><span> </span><span class="annot"><span class="annottext">FamInstEnvs -&gt; Type -&gt; Maybe (TyCon, ThetaType, Coercion)
</span><a href="GHC.HsToCore.Pmc.Solver.html#splitReprTyConApp_maybe"><span class="hs-identifier hs-var">splitReprTyConApp_maybe</span></a></span><span> </span><span class="annot"><span class="annottext">FamInstEnvs
</span><a href="#local-6989586621681374359"><span class="hs-identifier hs-var">env</span></a></span><span> </span><span class="annot"><span class="annottext">Type
</span><a href="#local-6989586621681374365"><span class="hs-identifier hs-var">rep_ty</span></a></span><span> </span><span class="hs-keyword">of</span><span>
</span><span id="line-1881"></span><span>            </span><span class="annot"><a href="../../base-4.16.4.0/src/GHC-Maybe.html#Just"><span class="hs-identifier hs-type">Just</span></a></span><span> </span><span class="hs-special">(</span><span id="local-6989586621681374357"><span class="annot"><span class="annottext">TyCon
</span><a href="#local-6989586621681374357"><span class="hs-identifier hs-var">tc</span></a></span></span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">ThetaType
</span><span class="hs-identifier">_</span></span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">Coercion
</span><span class="hs-identifier">_</span></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="annottext">TyCon -&gt; ResidualCompleteMatches -&gt; DsM ResidualCompleteMatches
</span><a href="GHC.HsToCore.Pmc.Solver.html#addTyConMatches"><span class="hs-identifier hs-var">addTyConMatches</span></a></span><span> </span><span class="annot"><span class="annottext">TyCon
</span><a href="#local-6989586621681374357"><span class="hs-identifier hs-var">tc</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">VarInfo -&gt; ResidualCompleteMatches
</span><a href="GHC.HsToCore.Pmc.Solver.Types.html#vi_rcm"><span class="hs-identifier hs-var">vi_rcm</span></a></span><span> </span><span class="annot"><span class="annottext">VarInfo
</span><a href="#local-6989586621681374360"><span class="hs-identifier hs-var">vi</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-1882"></span><span>            </span><span class="annot"><span class="annottext">Maybe (TyCon, ThetaType, Coercion)
</span><a href="../../base-4.16.4.0/src/GHC-Maybe.html#Nothing"><span class="hs-identifier hs-var">Nothing</span></a></span><span>         </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="annottext">ResidualCompleteMatches -&gt; DsM ResidualCompleteMatches
</span><a href="GHC.HsToCore.Pmc.Solver.html#addCompleteMatches"><span class="hs-identifier hs-var">addCompleteMatches</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">VarInfo -&gt; ResidualCompleteMatches
</span><a href="GHC.HsToCore.Pmc.Solver.Types.html#vi_rcm"><span class="hs-identifier hs-var">vi_rcm</span></a></span><span> </span><span class="annot"><span class="annottext">VarInfo
</span><a href="#local-6989586621681374360"><span class="hs-identifier hs-var">vi</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-1883"></span><span>
</span><span id="line-1884"></span><span>          </span><span class="hs-comment">-- Test all COMPLETE sets for inhabitants (n inhs at max). Take care of &#8869;.</span><span>
</span><span id="line-1885"></span><span>          </span><span id="local-6989586621681374356"><span class="annot"><span class="annottext">[CompleteMatch]
</span><a href="#local-6989586621681374356"><span class="hs-identifier hs-var">clss</span></a></span></span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">TyState -&gt; Type -&gt; ResidualCompleteMatches -&gt; DsM [CompleteMatch]
</span><a href="GHC.HsToCore.Pmc.Solver.html#pickApplicableCompleteSets"><span class="hs-identifier hs-var">pickApplicableCompleteSets</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Nabla -&gt; TyState
</span><a href="GHC.HsToCore.Pmc.Solver.Types.html#nabla_ty_st"><span class="hs-identifier hs-var">nabla_ty_st</span></a></span><span> </span><span class="annot"><span class="annottext">Nabla
</span><a href="#local-6989586621681374368"><span class="hs-identifier hs-var">nabla</span></a></span><span class="hs-special">)</span><span> </span><span class="annot"><span class="annottext">Type
</span><a href="#local-6989586621681374365"><span class="hs-identifier hs-var">rep_ty</span></a></span><span> </span><span class="annot"><span class="annottext">ResidualCompleteMatches
</span><a href="#local-6989586621681374358"><span class="hs-identifier hs-var">rcm</span></a></span><span>
</span><span id="line-1886"></span><span>          </span><span class="hs-keyword">case</span><span> </span><span class="annot"><span class="annottext">forall a. [a] -&gt; Maybe (NonEmpty a)
</span><a href="../../base-4.16.4.0/src/Data-List-NonEmpty.html#nonEmpty"><span class="hs-identifier hs-var">NE.nonEmpty</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">forall a. UniqDSet a -&gt; [a]
</span><a href="GHC.Types.Unique.DSet.html#uniqDSetToList"><span class="hs-identifier hs-var">uniqDSetToList</span></a></span><span> </span><span class="annot"><span class="annottext">forall b c a. (b -&gt; c) -&gt; (a -&gt; b) -&gt; a -&gt; c
</span><a href="../../base-4.16.4.0/src/GHC-Base.html#."><span class="hs-operator hs-var">.</span></a></span><span> </span><span class="annot"><span class="annottext">CompleteMatch -&gt; UniqDSet ConLike
</span><a href="GHC.Types.CompleteMatch.html#cmConLikes"><span class="hs-identifier hs-var">cmConLikes</span></a></span><span> </span><span class="annot"><span class="annottext">forall (f :: * -&gt; *) a b. Functor f =&gt; (a -&gt; b) -&gt; f a -&gt; f b
</span><a href="../../base-4.16.4.0/src/Data-Functor.html#%3C%24%3E"><span class="hs-operator hs-var">&lt;$&gt;</span></a></span><span> </span><span class="annot"><span class="annottext">[CompleteMatch]
</span><a href="#local-6989586621681374356"><span class="hs-identifier hs-var">clss</span></a></span><span class="hs-special">)</span><span> </span><span class="hs-keyword">of</span><span>
</span><span id="line-1887"></span><span>            </span><span class="annot"><span class="annottext">Maybe (NonEmpty [ConLike])
</span><a href="../../base-4.16.4.0/src/GHC-Maybe.html#Nothing"><span class="hs-identifier hs-var">Nothing</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span>
</span><span id="line-1888"></span><span>              </span><span class="hs-comment">-- No COMPLETE sets ==&gt; inhabited</span><span>
</span><span id="line-1889"></span><span>              </span><span class="annot"><span class="annottext">[Id] -&gt; Int -&gt; Nabla -&gt; DsM [Nabla]
</span><a href="GHC.HsToCore.Pmc.Solver.html#generateInhabitingPatterns"><span class="hs-identifier hs-var">generateInhabitingPatterns</span></a></span><span> </span><span class="annot"><span class="annottext">[Id]
</span><a href="#local-6989586621681374370"><span class="hs-identifier hs-var">xs</span></a></span><span> </span><span class="annot"><span class="annottext">Int
</span><a href="#local-6989586621681374369"><span class="hs-identifier hs-var">n</span></a></span><span> </span><span class="annot"><span class="annottext">Nabla
</span><a href="#local-6989586621681374361"><span class="hs-identifier hs-var">newty_nabla</span></a></span><span>
</span><span id="line-1890"></span><span>            </span><span class="annot"><a href="../../base-4.16.4.0/src/GHC-Maybe.html#Just"><span class="hs-identifier hs-type">Just</span></a></span><span> </span><span id="local-6989586621681374353"><span class="annot"><span class="annottext">NonEmpty [ConLike]
</span><a href="#local-6989586621681374353"><span class="hs-identifier hs-var">clss</span></a></span></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-keyword">do</span><span>
</span><span id="line-1891"></span><span>              </span><span class="hs-comment">-- Try each COMPLETE set, pick the one with the smallest number of</span><span>
</span><span id="line-1892"></span><span>              </span><span class="hs-comment">-- inhabitants</span><span>
</span><span id="line-1893"></span><span>              </span><span id="local-6989586621681374352"><span class="annot"><span class="annottext">NonEmpty [Nabla]
</span><a href="#local-6989586621681374352"><span class="hs-identifier hs-var">nablass'</span></a></span></span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">forall (t :: * -&gt; *) (m :: * -&gt; *) a b.
(Traversable t, Monad m) =&gt;
t a -&gt; (a -&gt; m b) -&gt; m (t b)
</span><a href="../../base-4.16.4.0/src/Data-Traversable.html#forM"><span class="hs-identifier hs-var">forM</span></a></span><span> </span><span class="annot"><span class="annottext">NonEmpty [ConLike]
</span><a href="#local-6989586621681374353"><span class="hs-identifier hs-var">clss</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Id -&gt; Type -&gt; [Id] -&gt; Int -&gt; Nabla -&gt; [ConLike] -&gt; DsM [Nabla]
</span><a href="#local-6989586621681374351"><span class="hs-identifier hs-var">instantiate_cons</span></a></span><span> </span><span class="annot"><span class="annottext">Id
</span><a href="#local-6989586621681374362"><span class="hs-identifier hs-var">y</span></a></span><span> </span><span class="annot"><span class="annottext">Type
</span><a href="#local-6989586621681374365"><span class="hs-identifier hs-var">rep_ty</span></a></span><span> </span><span class="annot"><span class="annottext">[Id]
</span><a href="#local-6989586621681374370"><span class="hs-identifier hs-var">xs</span></a></span><span> </span><span class="annot"><span class="annottext">Int
</span><a href="#local-6989586621681374369"><span class="hs-identifier hs-var">n</span></a></span><span> </span><span class="annot"><span class="annottext">Nabla
</span><a href="#local-6989586621681374361"><span class="hs-identifier hs-var">newty_nabla</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-1894"></span><span>              </span><span class="hs-keyword">let</span><span> </span><span id="local-6989586621681374350"><span class="annot"><span class="annottext">nablas' :: [Nabla]
</span><a href="#local-6989586621681374350"><span class="hs-identifier hs-var hs-var">nablas'</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">forall (t :: * -&gt; *) a.
Foldable t =&gt;
(a -&gt; a -&gt; Ordering) -&gt; t a -&gt; a
</span><a href="../../base-4.16.4.0/src/Data-Foldable.html#minimumBy"><span class="hs-identifier hs-var">minimumBy</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">forall a b. Ord a =&gt; (b -&gt; a) -&gt; b -&gt; b -&gt; Ordering
</span><a href="../../base-4.16.4.0/src/Data-Ord.html#comparing"><span class="hs-identifier hs-var">comparing</span></a></span><span> </span><span class="annot"><span class="annottext">forall (t :: * -&gt; *) a. Foldable t =&gt; t a -&gt; Int
</span><a href="../../base-4.16.4.0/src/Data-Foldable.html#length"><span class="hs-identifier hs-var">length</span></a></span><span class="hs-special">)</span><span> </span><span class="annot"><span class="annottext">NonEmpty [Nabla]
</span><a href="#local-6989586621681374352"><span class="hs-identifier hs-var">nablass'</span></a></span><span>
</span><span id="line-1895"></span><span>              </span><span class="hs-keyword">if</span><span> </span><span class="annot"><span class="annottext">forall (t :: * -&gt; *) a. Foldable t =&gt; t a -&gt; Bool
</span><a href="../../base-4.16.4.0/src/Data-Foldable.html#null"><span class="hs-identifier hs-var">null</span></a></span><span> </span><span class="annot"><span class="annottext">[Nabla]
</span><a href="#local-6989586621681374350"><span class="hs-identifier hs-var">nablas'</span></a></span><span> </span><span class="annot"><span class="annottext">Bool -&gt; Bool -&gt; Bool
</span><span class="hs-operator hs-var">&amp;&amp;</span></span><span> </span><span class="annot"><span class="annottext">VarInfo -&gt; BotInfo
</span><a href="GHC.HsToCore.Pmc.Solver.Types.html#vi_bot"><span class="hs-identifier hs-var">vi_bot</span></a></span><span> </span><span class="annot"><span class="annottext">VarInfo
</span><a href="#local-6989586621681374360"><span class="hs-identifier hs-var">vi</span></a></span><span> </span><span class="annot"><span class="annottext">forall a. Eq a =&gt; a -&gt; a -&gt; Bool
</span><span class="hs-operator hs-var">/=</span></span><span> </span><span class="annot"><span class="annottext">BotInfo
</span><a href="GHC.HsToCore.Pmc.Solver.Types.html#IsNotBot"><span class="hs-identifier hs-var">IsNotBot</span></a></span><span>
</span><span id="line-1896"></span><span>                </span><span class="hs-keyword">then</span><span> </span><span class="annot"><span class="annottext">[Id] -&gt; Int -&gt; Nabla -&gt; DsM [Nabla]
</span><a href="GHC.HsToCore.Pmc.Solver.html#generateInhabitingPatterns"><span class="hs-identifier hs-var">generateInhabitingPatterns</span></a></span><span> </span><span class="annot"><span class="annottext">[Id]
</span><a href="#local-6989586621681374370"><span class="hs-identifier hs-var">xs</span></a></span><span> </span><span class="annot"><span class="annottext">Int
</span><a href="#local-6989586621681374369"><span class="hs-identifier hs-var">n</span></a></span><span> </span><span class="annot"><span class="annottext">Nabla
</span><a href="#local-6989586621681374361"><span class="hs-identifier hs-var">newty_nabla</span></a></span><span> </span><span class="hs-comment">-- bot is still possible. Display a wildcard!</span><span>
</span><span id="line-1897"></span><span>                </span><span class="hs-keyword">else</span><span> </span><span class="annot"><span class="annottext">forall (f :: * -&gt; *) a. Applicative f =&gt; a -&gt; f a
</span><a href="../../base-4.16.4.0/src/GHC-Base.html#pure"><span class="hs-identifier hs-var">pure</span></a></span><span> </span><span class="annot"><span class="annottext">[Nabla]
</span><a href="#local-6989586621681374350"><span class="hs-identifier hs-var">nablas'</span></a></span><span>
</span><span id="line-1898"></span><span>
</span><span id="line-1899"></span><span>    </span><span class="hs-comment">-- | Instantiates a chain of newtypes, beginning at @x@.</span><span>
</span><span id="line-1900"></span><span>    </span><span class="hs-comment">-- Turns @x nabla [T,U,V]@ to @(y, nabla')@, where @nabla'@ we has the fact</span><span>
</span><span id="line-1901"></span><span>    </span><span class="hs-comment">-- @x ~ T (U (V y))@.</span><span>
</span><span id="line-1902"></span><span>    </span><span class="annot"><a href="#local-6989586621681374363"><span class="hs-identifier hs-type">instantiate_newtype_chain</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><a href="GHC.Types.Var.html#Id"><span class="hs-identifier hs-type">Id</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="GHC.HsToCore.Pmc.Solver.Types.html#Nabla"><span class="hs-identifier hs-type">Nabla</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-special">[</span><span class="hs-special">(</span><span class="annot"><a href="GHC.Core.TyCo.Rep.html#Type"><span class="hs-identifier hs-type">Type</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><a href="GHC.Core.DataCon.html#DataCon"><span class="hs-identifier hs-type">DataCon</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><a href="GHC.Core.TyCo.Rep.html#Type"><span class="hs-identifier hs-type">Type</span></a></span><span class="hs-special">)</span><span class="hs-special">]</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="../../transformers-0.5.6.2/src/Control-Monad-Trans-Maybe.html#MaybeT"><span class="hs-identifier hs-type">MaybeT</span></a></span><span> </span><span class="annot"><a href="GHC.HsToCore.Types.html#DsM"><span class="hs-identifier hs-type">DsM</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="GHC.Types.Var.html#Id"><span class="hs-identifier hs-type">Id</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><a href="GHC.HsToCore.Pmc.Solver.Types.html#Nabla"><span class="hs-identifier hs-type">Nabla</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-1903"></span><span>    </span><span id="local-6989586621681374363"><span class="annot"><span class="annottext">instantiate_newtype_chain :: Id
-&gt; Nabla
-&gt; [(Type, DataCon, Type)]
-&gt; MaybeT (IOEnv (Env DsGblEnv DsLclEnv)) (Id, Nabla)
</span><a href="#local-6989586621681374363"><span class="hs-identifier hs-var hs-var">instantiate_newtype_chain</span></a></span></span><span> </span><span id="local-6989586621681374349"><span class="annot"><span class="annottext">Id
</span><a href="#local-6989586621681374349"><span class="hs-identifier hs-var">x</span></a></span></span><span> </span><span id="local-6989586621681374348"><span class="annot"><span class="annottext">Nabla
</span><a href="#local-6989586621681374348"><span class="hs-identifier hs-var">nabla</span></a></span></span><span> </span><span class="hs-special">[</span><span class="hs-special">]</span><span>                      </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">forall (f :: * -&gt; *) a. Applicative f =&gt; a -&gt; f a
</span><a href="../../base-4.16.4.0/src/GHC-Base.html#pure"><span class="hs-identifier hs-var">pure</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Id
</span><a href="#local-6989586621681374349"><span class="hs-identifier hs-var">x</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">Nabla
</span><a href="#local-6989586621681374348"><span class="hs-identifier hs-var">nabla</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-1904"></span><span>    </span><span class="annot"><a href="#local-6989586621681374363"><span class="hs-identifier hs-var">instantiate_newtype_chain</span></a></span><span> </span><span id="local-6989586621681374347"><span class="annot"><span class="annottext">Id
</span><a href="#local-6989586621681374347"><span class="hs-identifier hs-var">x</span></a></span></span><span> </span><span id="local-6989586621681374346"><span class="annot"><span class="annottext">Nabla
</span><a href="#local-6989586621681374346"><span class="hs-identifier hs-var">nabla</span></a></span></span><span> </span><span class="hs-special">(</span><span class="hs-special">(</span><span id="local-6989586621681374345"><span class="annot"><span class="annottext">Type
</span><a href="#local-6989586621681374345"><span class="hs-identifier hs-var">_ty</span></a></span></span><span class="hs-special">,</span><span> </span><span id="local-6989586621681374344"><span class="annot"><span class="annottext">DataCon
</span><a href="#local-6989586621681374344"><span class="hs-identifier hs-var">dc</span></a></span></span><span class="hs-special">,</span><span> </span><span id="local-6989586621681374343"><span class="annot"><span class="annottext">Type
</span><a href="#local-6989586621681374343"><span class="hs-identifier hs-var">arg_ty</span></a></span></span><span class="hs-special">)</span><span class="annot"><span class="hs-glyph hs-type">:</span></span><span id="local-6989586621681374342"><span class="annot"><span class="annottext">[(Type, DataCon, Type)]
</span><a href="#local-6989586621681374342"><span class="hs-identifier hs-var">dcs</span></a></span></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-keyword">do</span><span>
</span><span id="line-1905"></span><span>      </span><span id="local-6989586621681374341"><span class="annot"><span class="annottext">Id
</span><a href="#local-6989586621681374341"><span class="hs-identifier hs-var">y</span></a></span></span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">forall (t :: (* -&gt; *) -&gt; * -&gt; *) (m :: * -&gt; *) a.
(MonadTrans t, Monad m) =&gt;
m a -&gt; t m a
</span><a href="../../transformers-0.5.6.2/src/Control-Monad-Trans-Class.html#lift"><span class="hs-identifier hs-var">lift</span></a></span><span> </span><span class="annot"><span class="annottext">forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><a href="../../base-4.16.4.0/src/GHC-Base.html#%24"><span class="hs-operator hs-var">$</span></a></span><span> </span><span class="annot"><span class="annottext">Type -&gt; DsM Id
</span><a href="GHC.HsToCore.Pmc.Utils.html#mkPmId"><span class="hs-identifier hs-var">mkPmId</span></a></span><span> </span><span class="annot"><span class="annottext">Type
</span><a href="#local-6989586621681374343"><span class="hs-identifier hs-var">arg_ty</span></a></span><span>
</span><span id="line-1906"></span><span>      </span><span class="hs-comment">-- Newtypes don't have existentials (yet?!), so passing an empty</span><span>
</span><span id="line-1907"></span><span>      </span><span class="hs-comment">-- list as ex_tvs.</span><span>
</span><span id="line-1908"></span><span>      </span><span id="local-6989586621681374340"><span class="annot"><span class="annottext">Nabla
</span><a href="#local-6989586621681374340"><span class="hs-identifier hs-var">nabla'</span></a></span></span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">Nabla
-&gt; Id
-&gt; PmAltCon
-&gt; [Id]
-&gt; [Id]
-&gt; MaybeT (IOEnv (Env DsGblEnv DsLclEnv)) Nabla
</span><a href="GHC.HsToCore.Pmc.Solver.html#addConCt"><span class="hs-identifier hs-var">addConCt</span></a></span><span> </span><span class="annot"><span class="annottext">Nabla
</span><a href="#local-6989586621681374346"><span class="hs-identifier hs-var">nabla</span></a></span><span> </span><span class="annot"><span class="annottext">Id
</span><a href="#local-6989586621681374347"><span class="hs-identifier hs-var">x</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">ConLike -&gt; PmAltCon
</span><a href="GHC.HsToCore.Pmc.Solver.Types.html#PmAltConLike"><span class="hs-identifier hs-var">PmAltConLike</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">DataCon -&gt; ConLike
</span><a href="GHC.Core.ConLike.html#RealDataCon"><span class="hs-identifier hs-var">RealDataCon</span></a></span><span> </span><span class="annot"><span class="annottext">DataCon
</span><a href="#local-6989586621681374344"><span class="hs-identifier hs-var">dc</span></a></span><span class="hs-special">)</span><span class="hs-special">)</span><span> </span><span class="hs-special">[</span><span class="hs-special">]</span><span> </span><span class="hs-special">[</span><span class="annot"><span class="annottext">Id
</span><a href="#local-6989586621681374341"><span class="hs-identifier hs-var">y</span></a></span><span class="hs-special">]</span><span>
</span><span id="line-1909"></span><span>      </span><span class="annot"><span class="annottext">Id
-&gt; Nabla
-&gt; [(Type, DataCon, Type)]
-&gt; MaybeT (IOEnv (Env DsGblEnv DsLclEnv)) (Id, Nabla)
</span><a href="#local-6989586621681374363"><span class="hs-identifier hs-var">instantiate_newtype_chain</span></a></span><span> </span><span class="annot"><span class="annottext">Id
</span><a href="#local-6989586621681374341"><span class="hs-identifier hs-var">y</span></a></span><span> </span><span class="annot"><span class="annottext">Nabla
</span><a href="#local-6989586621681374340"><span class="hs-identifier hs-var">nabla'</span></a></span><span> </span><span class="annot"><span class="annottext">[(Type, DataCon, Type)]
</span><a href="#local-6989586621681374342"><span class="hs-identifier hs-var">dcs</span></a></span><span>
</span><span id="line-1910"></span><span>
</span><span id="line-1911"></span><span>    </span><span class="annot"><a href="#local-6989586621681374351"><span class="hs-identifier hs-type">instantiate_cons</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><a href="GHC.Types.Var.html#Id"><span class="hs-identifier hs-type">Id</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="GHC.Core.TyCo.Rep.html#Type"><span class="hs-identifier hs-type">Type</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-special">[</span><span class="annot"><a href="GHC.Types.Var.html#Id"><span class="hs-identifier hs-type">Id</span></a></span><span class="hs-special">]</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="hs-identifier hs-type">Int</span></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="GHC.HsToCore.Pmc.Solver.Types.html#Nabla"><span class="hs-identifier hs-type">Nabla</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-special">[</span><span class="annot"><a href="GHC.Core.ConLike.html#ConLike"><span class="hs-identifier hs-type">ConLike</span></a></span><span class="hs-special">]</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="GHC.HsToCore.Types.html#DsM"><span class="hs-identifier hs-type">DsM</span></a></span><span> </span><span class="hs-special">[</span><span class="annot"><a href="GHC.HsToCore.Pmc.Solver.Types.html#Nabla"><span class="hs-identifier hs-type">Nabla</span></a></span><span class="hs-special">]</span><span>
</span><span id="line-1912"></span><span>    </span><span id="local-6989586621681374351"><span class="annot"><span class="annottext">instantiate_cons :: Id -&gt; Type -&gt; [Id] -&gt; Int -&gt; Nabla -&gt; [ConLike] -&gt; DsM [Nabla]
</span><a href="#local-6989586621681374351"><span class="hs-identifier hs-var hs-var">instantiate_cons</span></a></span></span><span> </span><span class="annot"><span class="annottext">Id
</span><span class="hs-identifier">_</span></span><span> </span><span class="annot"><span class="annottext">Type
</span><span class="hs-identifier">_</span></span><span>  </span><span class="annot"><span class="annottext">[Id]
</span><span class="hs-identifier">_</span></span><span>  </span><span class="annot"><span class="annottext">Int
</span><span class="hs-identifier">_</span></span><span> </span><span class="annot"><span class="annottext">Nabla
</span><span class="hs-identifier">_</span></span><span>     </span><span class="hs-special">[</span><span class="hs-special">]</span><span>       </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">forall (f :: * -&gt; *) a. Applicative f =&gt; a -&gt; f a
</span><a href="../../base-4.16.4.0/src/GHC-Base.html#pure"><span class="hs-identifier hs-var">pure</span></a></span><span> </span><span class="hs-special">[</span><span class="hs-special">]</span><span>
</span><span id="line-1913"></span><span>    </span><span class="annot"><a href="#local-6989586621681374351"><span class="hs-identifier hs-var">instantiate_cons</span></a></span><span> </span><span class="annot"><span class="annottext">Id
</span><span class="hs-identifier">_</span></span><span> </span><span class="annot"><span class="annottext">Type
</span><span class="hs-identifier">_</span></span><span>  </span><span class="annot"><span class="annottext">[Id]
</span><span class="hs-identifier">_</span></span><span>  </span><span class="annot"><span class="annottext">Int
</span><span class="hs-number">0</span></span><span> </span><span class="annot"><span class="annottext">Nabla
</span><span class="hs-identifier">_</span></span><span>     </span><span class="annot"><span class="annottext">[ConLike]
</span><span class="hs-identifier">_</span></span><span>        </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">forall (f :: * -&gt; *) a. Applicative f =&gt; a -&gt; f a
</span><a href="../../base-4.16.4.0/src/GHC-Base.html#pure"><span class="hs-identifier hs-var">pure</span></a></span><span> </span><span class="hs-special">[</span><span class="hs-special">]</span><span>
</span><span id="line-1914"></span><span>    </span><span class="annot"><a href="#local-6989586621681374351"><span class="hs-identifier hs-var">instantiate_cons</span></a></span><span> </span><span class="annot"><span class="annottext">Id
</span><span class="hs-identifier">_</span></span><span> </span><span id="local-6989586621681374339"><span class="annot"><span class="annottext">Type
</span><a href="#local-6989586621681374339"><span class="hs-identifier hs-var">ty</span></a></span></span><span> </span><span id="local-6989586621681374338"><span class="annot"><span class="annottext">[Id]
</span><a href="#local-6989586621681374338"><span class="hs-identifier hs-var">xs</span></a></span></span><span> </span><span id="local-6989586621681374337"><span class="annot"><span class="annottext">Int
</span><a href="#local-6989586621681374337"><span class="hs-identifier hs-var">n</span></a></span></span><span> </span><span id="local-6989586621681374336"><span class="annot"><span class="annottext">Nabla
</span><a href="#local-6989586621681374336"><span class="hs-identifier hs-var">nabla</span></a></span></span><span> </span><span class="annot"><span class="annottext">[ConLike]
</span><span class="hs-identifier">_</span></span><span>
</span><span id="line-1915"></span><span>      </span><span class="hs-comment">-- We don't want to expose users to GHC-specific constructors for Int etc.</span><span>
</span><span id="line-1916"></span><span>      </span><span class="hs-glyph">|</span><span> </span><span class="annot"><span class="annottext">forall (f :: * -&gt; *) a b. Functor f =&gt; (a -&gt; b) -&gt; f a -&gt; f b
</span><a href="../../base-4.16.4.0/src/GHC-Base.html#fmap"><span class="hs-identifier hs-var">fmap</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">TyCon -&gt; Bool
</span><a href="GHC.HsToCore.Pmc.Solver.html#isTyConTriviallyInhabited"><span class="hs-identifier hs-var">isTyConTriviallyInhabited</span></a></span><span> </span><span class="annot"><span class="annottext">forall b c a. (b -&gt; c) -&gt; (a -&gt; b) -&gt; a -&gt; c
</span><a href="../../base-4.16.4.0/src/GHC-Base.html#."><span class="hs-operator hs-var">.</span></a></span><span> </span><span class="annot"><span class="annottext">forall a b. (a, b) -&gt; a
</span><a href="../../base-4.16.4.0/src/Data-Tuple.html#fst"><span class="hs-identifier hs-var">fst</span></a></span><span class="hs-special">)</span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">HasDebugCallStack =&gt; Type -&gt; Maybe (TyCon, ThetaType)
</span><a href="GHC.Core.Type.html#splitTyConApp_maybe"><span class="hs-identifier hs-var">splitTyConApp_maybe</span></a></span><span> </span><span class="annot"><span class="annottext">Type
</span><a href="#local-6989586621681374339"><span class="hs-identifier hs-var">ty</span></a></span><span class="hs-special">)</span><span> </span><span class="annot"><span class="annottext">forall a. Eq a =&gt; a -&gt; a -&gt; Bool
</span><span class="hs-operator hs-var">==</span></span><span> </span><span class="annot"><span class="annottext">forall a. a -&gt; Maybe a
</span><a href="../../base-4.16.4.0/src/GHC-Maybe.html#Just"><span class="hs-identifier hs-var">Just</span></a></span><span> </span><span class="annot"><span class="annottext">Bool
</span><span class="hs-identifier hs-var">True</span></span><span>
</span><span id="line-1917"></span><span>      </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">[Id] -&gt; Int -&gt; Nabla -&gt; DsM [Nabla]
</span><a href="GHC.HsToCore.Pmc.Solver.html#generateInhabitingPatterns"><span class="hs-identifier hs-var">generateInhabitingPatterns</span></a></span><span> </span><span class="annot"><span class="annottext">[Id]
</span><a href="#local-6989586621681374338"><span class="hs-identifier hs-var">xs</span></a></span><span> </span><span class="annot"><span class="annottext">Int
</span><a href="#local-6989586621681374337"><span class="hs-identifier hs-var">n</span></a></span><span> </span><span class="annot"><span class="annottext">Nabla
</span><a href="#local-6989586621681374336"><span class="hs-identifier hs-var">nabla</span></a></span><span>
</span><span id="line-1918"></span><span>    </span><span class="annot"><a href="#local-6989586621681374351"><span class="hs-identifier hs-var">instantiate_cons</span></a></span><span> </span><span id="local-6989586621681374335"><span class="annot"><span class="annottext">Id
</span><a href="#local-6989586621681374335"><span class="hs-identifier hs-var">x</span></a></span></span><span> </span><span id="local-6989586621681374334"><span class="annot"><span class="annottext">Type
</span><a href="#local-6989586621681374334"><span class="hs-identifier hs-var">ty</span></a></span></span><span> </span><span id="local-6989586621681374333"><span class="annot"><span class="annottext">[Id]
</span><a href="#local-6989586621681374333"><span class="hs-identifier hs-var">xs</span></a></span></span><span> </span><span id="local-6989586621681374332"><span class="annot"><span class="annottext">Int
</span><a href="#local-6989586621681374332"><span class="hs-identifier hs-var">n</span></a></span></span><span> </span><span id="local-6989586621681374331"><span class="annot"><span class="annottext">Nabla
</span><a href="#local-6989586621681374331"><span class="hs-identifier hs-var">nabla</span></a></span></span><span> </span><span class="hs-special">(</span><span id="local-6989586621681374330"><span class="annot"><span class="annottext">ConLike
</span><a href="#local-6989586621681374330"><span class="hs-identifier hs-var">cl</span></a></span></span><span class="annot"><span class="hs-glyph hs-type">:</span></span><span id="local-6989586621681374329"><span class="annot"><span class="annottext">[ConLike]
</span><a href="#local-6989586621681374329"><span class="hs-identifier hs-var">cls</span></a></span></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-keyword">do</span><span>
</span><span id="line-1919"></span><span>      </span><span class="hs-comment">-- The following line is where we call out to the inhabitationTest!</span><span>
</span><span id="line-1920"></span><span>      </span><span id="local-6989586621681374328"><span class="annot"><span class="annottext">Maybe Nabla
</span><a href="#local-6989586621681374328"><span class="hs-identifier hs-var">mb_nabla</span></a></span></span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">forall (m :: * -&gt; *) a. MaybeT m a -&gt; m (Maybe a)
</span><a href="../../transformers-0.5.6.2/src/Control-Monad-Trans-Maybe.html#runMaybeT"><span class="hs-identifier hs-var">runMaybeT</span></a></span><span> </span><span class="annot"><span class="annottext">forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><a href="../../base-4.16.4.0/src/GHC-Base.html#%24"><span class="hs-operator hs-var">$</span></a></span><span> </span><span class="annot"><span class="annottext">Int
-&gt; Nabla
-&gt; Id
-&gt; ConLike
-&gt; MaybeT (IOEnv (Env DsGblEnv DsLclEnv)) Nabla
</span><a href="GHC.HsToCore.Pmc.Solver.html#instCon"><span class="hs-identifier hs-var">instCon</span></a></span><span> </span><span class="annot"><span class="annottext">Int
</span><span class="hs-number">4</span></span><span> </span><span class="annot"><span class="annottext">Nabla
</span><a href="#local-6989586621681374331"><span class="hs-identifier hs-var">nabla</span></a></span><span> </span><span class="annot"><span class="annottext">Id
</span><a href="#local-6989586621681374335"><span class="hs-identifier hs-var">x</span></a></span><span> </span><span class="annot"><span class="annottext">ConLike
</span><a href="#local-6989586621681374330"><span class="hs-identifier hs-var">cl</span></a></span><span>
</span><span id="line-1921"></span><span>      </span><span class="annot"><span class="annottext">String -&gt; SDoc -&gt; DsM ()
</span><a href="GHC.HsToCore.Pmc.Utils.html#tracePm"><span class="hs-identifier hs-var">tracePm</span></a></span><span> </span><span class="annot"><span class="annottext">String
</span><span class="hs-string">&quot;instantiate_cons&quot;</span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">[SDoc] -&gt; SDoc
</span><a href="GHC.Utils.Outputable.html#vcat"><span class="hs-identifier hs-var">vcat</span></a></span><span> </span><span class="hs-special">[</span><span> </span><span class="annot"><span class="annottext">forall a. Outputable a =&gt; a -&gt; SDoc
</span><a href="GHC.Utils.Outputable.html#ppr"><span class="hs-identifier hs-var">ppr</span></a></span><span> </span><span class="annot"><span class="annottext">Id
</span><a href="#local-6989586621681374335"><span class="hs-identifier hs-var">x</span></a></span><span> </span><span class="annot"><span class="annottext">SDoc -&gt; SDoc -&gt; SDoc
</span><a href="GHC.Utils.Outputable.html#%3C%2B%3E"><span class="hs-operator hs-var">&lt;+&gt;</span></a></span><span> </span><span class="annot"><span class="annottext">SDoc
</span><a href="GHC.Utils.Outputable.html#dcolon"><span class="hs-identifier hs-var">dcolon</span></a></span><span> </span><span class="annot"><span class="annottext">SDoc -&gt; SDoc -&gt; SDoc
</span><a href="GHC.Utils.Outputable.html#%3C%2B%3E"><span class="hs-operator hs-var">&lt;+&gt;</span></a></span><span> </span><span class="annot"><span class="annottext">forall a. Outputable a =&gt; a -&gt; SDoc
</span><a href="GHC.Utils.Outputable.html#ppr"><span class="hs-identifier hs-var">ppr</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Id -&gt; Type
</span><a href="GHC.Types.Id.html#idType"><span class="hs-identifier hs-var">idType</span></a></span><span> </span><span class="annot"><span class="annottext">Id
</span><a href="#local-6989586621681374335"><span class="hs-identifier hs-var">x</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-1922"></span><span>                                       </span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">forall a. Outputable a =&gt; a -&gt; SDoc
</span><a href="GHC.Utils.Outputable.html#ppr"><span class="hs-identifier hs-var">ppr</span></a></span><span> </span><span class="annot"><span class="annottext">Type
</span><a href="#local-6989586621681374334"><span class="hs-identifier hs-var">ty</span></a></span><span>
</span><span id="line-1923"></span><span>                                       </span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">forall a. Outputable a =&gt; a -&gt; SDoc
</span><a href="GHC.Utils.Outputable.html#ppr"><span class="hs-identifier hs-var">ppr</span></a></span><span> </span><span class="annot"><span class="annottext">ConLike
</span><a href="#local-6989586621681374330"><span class="hs-identifier hs-var">cl</span></a></span><span>
</span><span id="line-1924"></span><span>                                       </span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">forall a. Outputable a =&gt; a -&gt; SDoc
</span><a href="GHC.Utils.Outputable.html#ppr"><span class="hs-identifier hs-var">ppr</span></a></span><span> </span><span class="annot"><span class="annottext">Nabla
</span><a href="#local-6989586621681374331"><span class="hs-identifier hs-var">nabla</span></a></span><span>
</span><span id="line-1925"></span><span>                                       </span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">forall a. Outputable a =&gt; a -&gt; SDoc
</span><a href="GHC.Utils.Outputable.html#ppr"><span class="hs-identifier hs-var">ppr</span></a></span><span> </span><span class="annot"><span class="annottext">Maybe Nabla
</span><a href="#local-6989586621681374328"><span class="hs-identifier hs-var">mb_nabla</span></a></span><span>
</span><span id="line-1926"></span><span>                                       </span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">forall a. Outputable a =&gt; a -&gt; SDoc
</span><a href="GHC.Utils.Outputable.html#ppr"><span class="hs-identifier hs-var">ppr</span></a></span><span> </span><span class="annot"><span class="annottext">Int
</span><a href="#local-6989586621681374332"><span class="hs-identifier hs-var">n</span></a></span><span> </span><span class="hs-special">]</span><span class="hs-special">)</span><span>
</span><span id="line-1927"></span><span>      </span><span id="local-6989586621681374327"><span class="annot"><span class="annottext">[Nabla]
</span><a href="#local-6989586621681374327"><span class="hs-identifier hs-var">con_nablas</span></a></span></span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="hs-keyword">case</span><span> </span><span class="annot"><span class="annottext">Maybe Nabla
</span><a href="#local-6989586621681374328"><span class="hs-identifier hs-var">mb_nabla</span></a></span><span> </span><span class="hs-keyword">of</span><span>
</span><span id="line-1928"></span><span>        </span><span class="annot"><span class="annottext">Maybe Nabla
</span><a href="../../base-4.16.4.0/src/GHC-Maybe.html#Nothing"><span class="hs-identifier hs-var">Nothing</span></a></span><span>     </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="annottext">forall (f :: * -&gt; *) a. Applicative f =&gt; a -&gt; f a
</span><a href="../../base-4.16.4.0/src/GHC-Base.html#pure"><span class="hs-identifier hs-var">pure</span></a></span><span> </span><span class="hs-special">[</span><span class="hs-special">]</span><span>
</span><span id="line-1929"></span><span>        </span><span class="hs-comment">-- NB: We don't prepend arg_vars as we don't have any evidence on</span><span>
</span><span id="line-1930"></span><span>        </span><span class="hs-comment">-- them and we only want to split once on a data type. They are</span><span>
</span><span id="line-1931"></span><span>        </span><span class="hs-comment">-- inhabited, otherwise the inhabitation test would have refuted.</span><span>
</span><span id="line-1932"></span><span>        </span><span class="annot"><a href="../../base-4.16.4.0/src/GHC-Maybe.html#Just"><span class="hs-identifier hs-type">Just</span></a></span><span> </span><span id="local-6989586621681374326"><span class="annot"><span class="annottext">Nabla
</span><a href="#local-6989586621681374326"><span class="hs-identifier hs-var">nabla'</span></a></span></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="annottext">[Id] -&gt; Int -&gt; Nabla -&gt; DsM [Nabla]
</span><a href="GHC.HsToCore.Pmc.Solver.html#generateInhabitingPatterns"><span class="hs-identifier hs-var">generateInhabitingPatterns</span></a></span><span> </span><span class="annot"><span class="annottext">[Id]
</span><a href="#local-6989586621681374333"><span class="hs-identifier hs-var">xs</span></a></span><span> </span><span class="annot"><span class="annottext">Int
</span><a href="#local-6989586621681374332"><span class="hs-identifier hs-var">n</span></a></span><span> </span><span class="annot"><span class="annottext">Nabla
</span><a href="#local-6989586621681374326"><span class="hs-identifier hs-var">nabla'</span></a></span><span>
</span><span id="line-1933"></span><span>      </span><span id="local-6989586621681374325"><span class="annot"><span class="annottext">[Nabla]
</span><a href="#local-6989586621681374325"><span class="hs-identifier hs-var">other_cons_nablas</span></a></span></span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">Id -&gt; Type -&gt; [Id] -&gt; Int -&gt; Nabla -&gt; [ConLike] -&gt; DsM [Nabla]
</span><a href="#local-6989586621681374351"><span class="hs-identifier hs-var">instantiate_cons</span></a></span><span> </span><span class="annot"><span class="annottext">Id
</span><a href="#local-6989586621681374335"><span class="hs-identifier hs-var">x</span></a></span><span> </span><span class="annot"><span class="annottext">Type
</span><a href="#local-6989586621681374334"><span class="hs-identifier hs-var">ty</span></a></span><span> </span><span class="annot"><span class="annottext">[Id]
</span><a href="#local-6989586621681374333"><span class="hs-identifier hs-var">xs</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Int
</span><a href="#local-6989586621681374332"><span class="hs-identifier hs-var">n</span></a></span><span> </span><span class="annot"><span class="annottext">forall a. Num a =&gt; a -&gt; a -&gt; a
</span><a href="../../base-4.16.4.0/src/GHC-Num.html#-"><span class="hs-glyph hs-var">-</span></a></span><span> </span><span class="annot"><span class="annottext">forall (t :: * -&gt; *) a. Foldable t =&gt; t a -&gt; Int
</span><a href="../../base-4.16.4.0/src/Data-Foldable.html#length"><span class="hs-identifier hs-var">length</span></a></span><span> </span><span class="annot"><span class="annottext">[Nabla]
</span><a href="#local-6989586621681374327"><span class="hs-identifier hs-var">con_nablas</span></a></span><span class="hs-special">)</span><span> </span><span class="annot"><span class="annottext">Nabla
</span><a href="#local-6989586621681374331"><span class="hs-identifier hs-var">nabla</span></a></span><span> </span><span class="annot"><span class="annottext">[ConLike]
</span><a href="#local-6989586621681374329"><span class="hs-identifier hs-var">cls</span></a></span><span>
</span><span id="line-1934"></span><span>      </span><span class="annot"><span class="annottext">forall (f :: * -&gt; *) a. Applicative f =&gt; a -&gt; f a
</span><a href="../../base-4.16.4.0/src/GHC-Base.html#pure"><span class="hs-identifier hs-var">pure</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">[Nabla]
</span><a href="#local-6989586621681374327"><span class="hs-identifier hs-var">con_nablas</span></a></span><span> </span><span class="annot"><span class="annottext">forall a. [a] -&gt; [a] -&gt; [a]
</span><a href="../../base-4.16.4.0/src/GHC-Base.html#%2B%2B"><span class="hs-operator hs-var">++</span></a></span><span> </span><span class="annot"><span class="annottext">[Nabla]
</span><a href="#local-6989586621681374325"><span class="hs-identifier hs-var">other_cons_nablas</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-1935"></span><span>
</span><span id="line-1936"></span><span class="annot"><a href="GHC.HsToCore.Pmc.Solver.html#pickApplicableCompleteSets"><span class="hs-identifier hs-type">pickApplicableCompleteSets</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><a href="GHC.HsToCore.Pmc.Solver.Types.html#TyState"><span class="hs-identifier hs-type">TyState</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="GHC.Core.TyCo.Rep.html#Type"><span class="hs-identifier hs-type">Type</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="GHC.HsToCore.Pmc.Solver.Types.html#ResidualCompleteMatches"><span class="hs-identifier hs-type">ResidualCompleteMatches</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="GHC.HsToCore.Types.html#DsM"><span class="hs-identifier hs-type">DsM</span></a></span><span> </span><span class="hs-special">[</span><span class="annot"><a href="GHC.Types.CompleteMatch.html#CompleteMatch"><span class="hs-identifier hs-type">CompleteMatch</span></a></span><span class="hs-special">]</span><span>
</span><span id="line-1937"></span><span class="hs-comment">-- See Note [Implementation of COMPLETE pragmas] on what &quot;applicable&quot; means</span><span>
</span><span id="line-1938"></span><span id="pickApplicableCompleteSets"><span class="annot"><span class="annottext">pickApplicableCompleteSets :: TyState -&gt; Type -&gt; ResidualCompleteMatches -&gt; DsM [CompleteMatch]
</span><a href="GHC.HsToCore.Pmc.Solver.html#pickApplicableCompleteSets"><span class="hs-identifier hs-var hs-var">pickApplicableCompleteSets</span></a></span></span><span> </span><span id="local-6989586621681374324"><span class="annot"><span class="annottext">TyState
</span><a href="#local-6989586621681374324"><span class="hs-identifier hs-var">ty_st</span></a></span></span><span> </span><span id="local-6989586621681374323"><span class="annot"><span class="annottext">Type
</span><a href="#local-6989586621681374323"><span class="hs-identifier hs-var">ty</span></a></span></span><span> </span><span id="local-6989586621681374322"><span class="annot"><span class="annottext">ResidualCompleteMatches
</span><a href="#local-6989586621681374322"><span class="hs-identifier hs-var">rcm</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-keyword">do</span><span>
</span><span id="line-1939"></span><span>  </span><span class="hs-keyword">let</span><span> </span><span class="annot"><a href="#local-6989586621681374321"><span class="hs-identifier hs-type">cl_res_ty_ok</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><a href="GHC.Core.ConLike.html#ConLike"><span class="hs-identifier hs-type">ConLike</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="GHC.HsToCore.Types.html#DsM"><span class="hs-identifier hs-type">DsM</span></a></span><span> </span><span class="annot"><span class="hs-identifier hs-type">Bool</span></span><span>
</span><span id="line-1940"></span><span>      </span><span id="local-6989586621681374321"><span class="annot"><span class="annottext">cl_res_ty_ok :: ConLike -&gt; DsM Bool
</span><a href="#local-6989586621681374321"><span class="hs-identifier hs-var hs-var">cl_res_ty_ok</span></a></span></span><span> </span><span id="local-6989586621681374320"><span class="annot"><span class="annottext">ConLike
</span><a href="#local-6989586621681374320"><span class="hs-identifier hs-var">cl</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-keyword">do</span><span>
</span><span id="line-1941"></span><span>        </span><span id="local-6989586621681374319"><span class="annot"><span class="annottext">FamInstEnvs
</span><a href="#local-6989586621681374319"><span class="hs-identifier hs-var">env</span></a></span></span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">DsM FamInstEnvs
</span><a href="GHC.HsToCore.Monad.html#dsGetFamInstEnvs"><span class="hs-identifier hs-var">dsGetFamInstEnvs</span></a></span><span>
</span><span id="line-1942"></span><span>        </span><span class="annot"><span class="annottext">forall a. Maybe a -&gt; Bool
</span><a href="../../base-4.16.4.0/src/Data-Maybe.html#isJust"><span class="hs-identifier hs-var">isJust</span></a></span><span> </span><span class="annot"><span class="annottext">forall (f :: * -&gt; *) a b. Functor f =&gt; (a -&gt; b) -&gt; f a -&gt; f b
</span><a href="../../base-4.16.4.0/src/Data-Functor.html#%3C%24%3E"><span class="hs-operator hs-var">&lt;$&gt;</span></a></span><span> </span><span class="annot"><span class="annottext">FamInstEnvs -&gt; TyState -&gt; Type -&gt; ConLike -&gt; DsM (Maybe TCvSubst)
</span><a href="GHC.HsToCore.Pmc.Solver.html#matchConLikeResTy"><span class="hs-identifier hs-var">matchConLikeResTy</span></a></span><span> </span><span class="annot"><span class="annottext">FamInstEnvs
</span><a href="#local-6989586621681374319"><span class="hs-identifier hs-var">env</span></a></span><span> </span><span class="annot"><span class="annottext">TyState
</span><a href="#local-6989586621681374324"><span class="hs-identifier hs-var">ty_st</span></a></span><span> </span><span class="annot"><span class="annottext">Type
</span><a href="#local-6989586621681374323"><span class="hs-identifier hs-var">ty</span></a></span><span> </span><span class="annot"><span class="annottext">ConLike
</span><a href="#local-6989586621681374320"><span class="hs-identifier hs-var">cl</span></a></span><span>
</span><span id="line-1943"></span><span>  </span><span class="hs-keyword">let</span><span> </span><span class="annot"><a href="#local-6989586621681374317"><span class="hs-identifier hs-type">cm_applicable</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><a href="GHC.Types.CompleteMatch.html#CompleteMatch"><span class="hs-identifier hs-type">CompleteMatch</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="GHC.HsToCore.Types.html#DsM"><span class="hs-identifier hs-type">DsM</span></a></span><span> </span><span class="annot"><span class="hs-identifier hs-type">Bool</span></span><span>
</span><span id="line-1944"></span><span>      </span><span id="local-6989586621681374317"><span class="annot"><span class="annottext">cm_applicable :: CompleteMatch -&gt; DsM Bool
</span><a href="#local-6989586621681374317"><span class="hs-identifier hs-var hs-var">cm_applicable</span></a></span></span><span> </span><span id="local-6989586621681374316"><span class="annot"><span class="annottext">CompleteMatch
</span><a href="#local-6989586621681374316"><span class="hs-identifier hs-var">cm</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-keyword">do</span><span>
</span><span id="line-1945"></span><span>        </span><span id="local-6989586621681374315"><span class="annot"><span class="annottext">Bool
</span><a href="#local-6989586621681374315"><span class="hs-identifier hs-var">cls_ok</span></a></span></span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">forall (m :: * -&gt; *) a. Monad m =&gt; (a -&gt; m Bool) -&gt; [a] -&gt; m Bool
</span><a href="GHC.Utils.Monad.html#allM"><span class="hs-identifier hs-var">allM</span></a></span><span> </span><span class="annot"><span class="annottext">ConLike -&gt; DsM Bool
</span><a href="#local-6989586621681374321"><span class="hs-identifier hs-var">cl_res_ty_ok</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">forall a. UniqDSet a -&gt; [a]
</span><a href="GHC.Types.Unique.DSet.html#uniqDSetToList"><span class="hs-identifier hs-var">uniqDSetToList</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">CompleteMatch -&gt; UniqDSet ConLike
</span><a href="GHC.Types.CompleteMatch.html#cmConLikes"><span class="hs-identifier hs-var">cmConLikes</span></a></span><span> </span><span class="annot"><span class="annottext">CompleteMatch
</span><a href="#local-6989586621681374316"><span class="hs-identifier hs-var">cm</span></a></span><span class="hs-special">)</span><span class="hs-special">)</span><span>
</span><span id="line-1946"></span><span>        </span><span class="hs-keyword">let</span><span> </span><span id="local-6989586621681374314"><span class="annot"><span class="annottext">match_ty_ok :: Bool
</span><a href="#local-6989586621681374314"><span class="hs-identifier hs-var hs-var">match_ty_ok</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">Type -&gt; CompleteMatch -&gt; Bool
</span><a href="GHC.Types.CompleteMatch.html#completeMatchAppliesAtType"><span class="hs-identifier hs-var">completeMatchAppliesAtType</span></a></span><span> </span><span class="annot"><span class="annottext">Type
</span><a href="#local-6989586621681374323"><span class="hs-identifier hs-var">ty</span></a></span><span> </span><span class="annot"><span class="annottext">CompleteMatch
</span><a href="#local-6989586621681374316"><span class="hs-identifier hs-var">cm</span></a></span><span>
</span><span id="line-1947"></span><span>        </span><span class="annot"><span class="annottext">forall (f :: * -&gt; *) a. Applicative f =&gt; a -&gt; f a
</span><a href="../../base-4.16.4.0/src/GHC-Base.html#pure"><span class="hs-identifier hs-var">pure</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Bool
</span><a href="#local-6989586621681374315"><span class="hs-identifier hs-var">cls_ok</span></a></span><span> </span><span class="annot"><span class="annottext">Bool -&gt; Bool -&gt; Bool
</span><span class="hs-operator hs-var">&amp;&amp;</span></span><span> </span><span class="annot"><span class="annottext">Bool
</span><a href="#local-6989586621681374314"><span class="hs-identifier hs-var">match_ty_ok</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-1948"></span><span>  </span><span id="local-6989586621681374313"><span class="annot"><span class="annottext">[CompleteMatch]
</span><a href="#local-6989586621681374313"><span class="hs-identifier hs-var">applicable_cms</span></a></span></span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">forall (m :: * -&gt; *) a.
Applicative m =&gt;
(a -&gt; m Bool) -&gt; [a] -&gt; m [a]
</span><a href="../../base-4.16.4.0/src/Control-Monad.html#filterM"><span class="hs-identifier hs-var">filterM</span></a></span><span> </span><span class="annot"><span class="annottext">CompleteMatch -&gt; DsM Bool
</span><a href="#local-6989586621681374317"><span class="hs-identifier hs-var">cm_applicable</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">ResidualCompleteMatches -&gt; [CompleteMatch]
</span><a href="GHC.HsToCore.Pmc.Solver.Types.html#getRcm"><span class="hs-identifier hs-var">getRcm</span></a></span><span> </span><span class="annot"><span class="annottext">ResidualCompleteMatches
</span><a href="#local-6989586621681374322"><span class="hs-identifier hs-var">rcm</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-1949"></span><span>  </span><span class="annot"><span class="annottext">String -&gt; SDoc -&gt; DsM ()
</span><a href="GHC.HsToCore.Pmc.Utils.html#tracePm"><span class="hs-identifier hs-var">tracePm</span></a></span><span> </span><span class="annot"><span class="annottext">String
</span><span class="hs-string">&quot;pickApplicableCompleteSets:&quot;</span></span><span> </span><span class="annot"><span class="annottext">forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><a href="../../base-4.16.4.0/src/GHC-Base.html#%24"><span class="hs-operator hs-var">$</span></a></span><span>
</span><span id="line-1950"></span><span>    </span><span class="annot"><span class="annottext">[SDoc] -&gt; SDoc
</span><a href="GHC.Utils.Outputable.html#vcat"><span class="hs-identifier hs-var">vcat</span></a></span><span>
</span><span id="line-1951"></span><span>      </span><span class="hs-special">[</span><span> </span><span class="annot"><span class="annottext">forall a. Outputable a =&gt; a -&gt; SDoc
</span><a href="GHC.Utils.Outputable.html#ppr"><span class="hs-identifier hs-var">ppr</span></a></span><span> </span><span class="annot"><span class="annottext">Type
</span><a href="#local-6989586621681374323"><span class="hs-identifier hs-var">ty</span></a></span><span>
</span><span id="line-1952"></span><span>      </span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">forall a. Outputable a =&gt; a -&gt; SDoc
</span><a href="GHC.Utils.Outputable.html#ppr"><span class="hs-identifier hs-var">ppr</span></a></span><span> </span><span class="annot"><span class="annottext">ResidualCompleteMatches
</span><a href="#local-6989586621681374322"><span class="hs-identifier hs-var">rcm</span></a></span><span>
</span><span id="line-1953"></span><span>      </span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">forall a. Outputable a =&gt; a -&gt; SDoc
</span><a href="GHC.Utils.Outputable.html#ppr"><span class="hs-identifier hs-var">ppr</span></a></span><span> </span><span class="annot"><span class="annottext">[CompleteMatch]
</span><a href="#local-6989586621681374313"><span class="hs-identifier hs-var">applicable_cms</span></a></span><span>
</span><span id="line-1954"></span><span>      </span><span class="hs-special">]</span><span>
</span><span id="line-1955"></span><span>  </span><span class="annot"><span class="annottext">forall (m :: * -&gt; *) a. Monad m =&gt; a -&gt; m a
</span><a href="../../base-4.16.4.0/src/GHC-Base.html#return"><span class="hs-identifier hs-var">return</span></a></span><span> </span><span class="annot"><span class="annottext">[CompleteMatch]
</span><a href="#local-6989586621681374313"><span class="hs-identifier hs-var">applicable_cms</span></a></span><span>
</span><span id="line-1956"></span><span>
</span><span id="line-1957"></span><span class="hs-comment">{- Note [Why inhabitationTest doesn't call generateInhabitingPatterns]
~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~
Why can't we define `inhabitationTest` (IT) in terms of
`generateInhabitingPatterns` (GIP) as

  inhabitationTest nabla = do
    nablas &lt;- lift $ generateInhabitingPatterns all_variables 1 nabla
    guard (notNull nablas)

There are a few technical reasons, like the lack of a fuel-tracking approach
to stay decidable, that could be overcome. But the nail in the coffin is
performance: In order to provide good warning messages, GIP commits to *one*
COMPLETE set, and goes through some hoops to find the minimal one. This implies
it has to look at *all* constructors in the residual COMPLETE matches and see if
they match, if only to filter out ill-typed COMPLETE sets
(see Note [Implementation of COMPLETE pragmas]). That is untractable for an
efficient IT on huge enumerations.

But we still need GIP to produce the Nablas as proxies for
uncovered patterns that we display warnings for. It's fine to pay this price
once at the end, but IT is called far more often than that.
-}</span><span>
</span><span id="line-1979"></span></pre></body></html>