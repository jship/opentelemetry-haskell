<?xml version="1.0" encoding="UTF-8"?>
<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Strict//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-strict.dtd">
<html>
<head>
<!-- Generated by HsColour, http://code.haskell.org/~malcolm/hscolour/ -->
<title>GHC/Types/Var/Set.hs</title>
<link type='text/css' rel='stylesheet' href='hscolour.css' />
</head>
<body>
<pre><a name="line-1"></a><span class='hs-comment'>{-
<a name="line-2"></a>(c) The University of Glasgow 2006
<a name="line-3"></a>(c) The GRASP/AQUA Project, Glasgow University, 1992-1998
<a name="line-4"></a>-}</span>
<a name="line-5"></a>
<a name="line-6"></a><span class='hs-comment'>{-# LANGUAGE CPP #-}</span>
<a name="line-7"></a>
<a name="line-8"></a><span class='hs-keyword'>module</span> <span class='hs-conid'>GHC.Types.Var.Set</span> <span class='hs-layout'>(</span>
<a name="line-9"></a>        <span class='hs-comment'>-- * Var, Id and TyVar set types</span>
<a name="line-10"></a>        <span class='hs-conid'>VarSet</span><span class='hs-layout'>,</span> <span class='hs-conid'>IdSet</span><span class='hs-layout'>,</span> <span class='hs-conid'>TyVarSet</span><span class='hs-layout'>,</span> <span class='hs-conid'>CoVarSet</span><span class='hs-layout'>,</span> <span class='hs-conid'>TyCoVarSet</span><span class='hs-layout'>,</span>
<a name="line-11"></a>
<a name="line-12"></a>        <span class='hs-comment'>-- ** Manipulating these sets</span>
<a name="line-13"></a>        <span class='hs-varid'>emptyVarSet</span><span class='hs-layout'>,</span> <span class='hs-varid'>unitVarSet</span><span class='hs-layout'>,</span> <span class='hs-varid'>mkVarSet</span><span class='hs-layout'>,</span>
<a name="line-14"></a>        <span class='hs-varid'>extendVarSet</span><span class='hs-layout'>,</span> <span class='hs-varid'>extendVarSetList</span><span class='hs-layout'>,</span>
<a name="line-15"></a>        <span class='hs-varid'>elemVarSet</span><span class='hs-layout'>,</span> <span class='hs-varid'>subVarSet</span><span class='hs-layout'>,</span>
<a name="line-16"></a>        <span class='hs-varid'>unionVarSet</span><span class='hs-layout'>,</span> <span class='hs-varid'>unionVarSets</span><span class='hs-layout'>,</span> <span class='hs-varid'>mapUnionVarSet</span><span class='hs-layout'>,</span>
<a name="line-17"></a>        <span class='hs-varid'>intersectVarSet</span><span class='hs-layout'>,</span> <span class='hs-varid'>intersectsVarSet</span><span class='hs-layout'>,</span> <span class='hs-varid'>disjointVarSet</span><span class='hs-layout'>,</span>
<a name="line-18"></a>        <span class='hs-varid'>isEmptyVarSet</span><span class='hs-layout'>,</span> <span class='hs-varid'>delVarSet</span><span class='hs-layout'>,</span> <span class='hs-varid'>delVarSetList</span><span class='hs-layout'>,</span> <span class='hs-varid'>delVarSetByKey</span><span class='hs-layout'>,</span>
<a name="line-19"></a>        <span class='hs-varid'>minusVarSet</span><span class='hs-layout'>,</span> <span class='hs-varid'>filterVarSet</span><span class='hs-layout'>,</span> <span class='hs-varid'>mapVarSet</span><span class='hs-layout'>,</span>
<a name="line-20"></a>        <span class='hs-varid'>anyVarSet</span><span class='hs-layout'>,</span> <span class='hs-varid'>allVarSet</span><span class='hs-layout'>,</span>
<a name="line-21"></a>        <span class='hs-varid'>transCloVarSet</span><span class='hs-layout'>,</span> <span class='hs-varid'>fixVarSet</span><span class='hs-layout'>,</span>
<a name="line-22"></a>        <span class='hs-varid'>lookupVarSet_Directly</span><span class='hs-layout'>,</span> <span class='hs-varid'>lookupVarSet</span><span class='hs-layout'>,</span> <span class='hs-varid'>lookupVarSetByName</span><span class='hs-layout'>,</span>
<a name="line-23"></a>        <span class='hs-varid'>sizeVarSet</span><span class='hs-layout'>,</span> <span class='hs-varid'>seqVarSet</span><span class='hs-layout'>,</span>
<a name="line-24"></a>        <span class='hs-varid'>elemVarSetByKey</span><span class='hs-layout'>,</span> <span class='hs-varid'>partitionVarSet</span><span class='hs-layout'>,</span>
<a name="line-25"></a>        <span class='hs-varid'>pluralVarSet</span><span class='hs-layout'>,</span> <span class='hs-varid'>pprVarSet</span><span class='hs-layout'>,</span>
<a name="line-26"></a>        <span class='hs-varid'>nonDetStrictFoldVarSet</span><span class='hs-layout'>,</span>
<a name="line-27"></a>
<a name="line-28"></a>        <span class='hs-comment'>-- * Deterministic Var set types</span>
<a name="line-29"></a>        <span class='hs-conid'>DVarSet</span><span class='hs-layout'>,</span> <span class='hs-conid'>DIdSet</span><span class='hs-layout'>,</span> <span class='hs-conid'>DTyVarSet</span><span class='hs-layout'>,</span> <span class='hs-conid'>DTyCoVarSet</span><span class='hs-layout'>,</span>
<a name="line-30"></a>
<a name="line-31"></a>        <span class='hs-comment'>-- ** Manipulating these sets</span>
<a name="line-32"></a>        <span class='hs-varid'>emptyDVarSet</span><span class='hs-layout'>,</span> <span class='hs-varid'>unitDVarSet</span><span class='hs-layout'>,</span> <span class='hs-varid'>mkDVarSet</span><span class='hs-layout'>,</span>
<a name="line-33"></a>        <span class='hs-varid'>extendDVarSet</span><span class='hs-layout'>,</span> <span class='hs-varid'>extendDVarSetList</span><span class='hs-layout'>,</span>
<a name="line-34"></a>        <span class='hs-varid'>elemDVarSet</span><span class='hs-layout'>,</span> <span class='hs-varid'>dVarSetElems</span><span class='hs-layout'>,</span> <span class='hs-varid'>subDVarSet</span><span class='hs-layout'>,</span>
<a name="line-35"></a>        <span class='hs-varid'>unionDVarSet</span><span class='hs-layout'>,</span> <span class='hs-varid'>unionDVarSets</span><span class='hs-layout'>,</span> <span class='hs-varid'>mapUnionDVarSet</span><span class='hs-layout'>,</span>
<a name="line-36"></a>        <span class='hs-varid'>intersectDVarSet</span><span class='hs-layout'>,</span> <span class='hs-varid'>dVarSetIntersectVarSet</span><span class='hs-layout'>,</span>
<a name="line-37"></a>        <span class='hs-varid'>intersectsDVarSet</span><span class='hs-layout'>,</span> <span class='hs-varid'>disjointDVarSet</span><span class='hs-layout'>,</span>
<a name="line-38"></a>        <span class='hs-varid'>isEmptyDVarSet</span><span class='hs-layout'>,</span> <span class='hs-varid'>delDVarSet</span><span class='hs-layout'>,</span> <span class='hs-varid'>delDVarSetList</span><span class='hs-layout'>,</span>
<a name="line-39"></a>        <span class='hs-varid'>minusDVarSet</span><span class='hs-layout'>,</span>
<a name="line-40"></a>        <span class='hs-varid'>nonDetStrictFoldDVarSet</span><span class='hs-layout'>,</span>
<a name="line-41"></a>        <span class='hs-varid'>filterDVarSet</span><span class='hs-layout'>,</span> <span class='hs-varid'>mapDVarSet</span><span class='hs-layout'>,</span>
<a name="line-42"></a>        <span class='hs-varid'>dVarSetMinusVarSet</span><span class='hs-layout'>,</span> <span class='hs-varid'>anyDVarSet</span><span class='hs-layout'>,</span> <span class='hs-varid'>allDVarSet</span><span class='hs-layout'>,</span>
<a name="line-43"></a>        <span class='hs-varid'>transCloDVarSet</span><span class='hs-layout'>,</span>
<a name="line-44"></a>        <span class='hs-varid'>sizeDVarSet</span><span class='hs-layout'>,</span> <span class='hs-varid'>seqDVarSet</span><span class='hs-layout'>,</span>
<a name="line-45"></a>        <span class='hs-varid'>partitionDVarSet</span><span class='hs-layout'>,</span>
<a name="line-46"></a>        <span class='hs-varid'>dVarSetToVarSet</span><span class='hs-layout'>,</span>
<a name="line-47"></a>    <span class='hs-layout'>)</span> <span class='hs-keyword'>where</span>
<a name="line-48"></a>
<a name="line-49"></a><span class='hs-cpp'>#include "HsVersions.h"</span>
<a name="line-50"></a>
<a name="line-51"></a><span class='hs-keyword'>import</span> <span class='hs-conid'>GHC.Prelude</span>
<a name="line-52"></a>
<a name="line-53"></a><span class='hs-keyword'>import</span> <span class='hs-conid'>GHC.Types.Var</span>      <span class='hs-layout'>(</span> <span class='hs-conid'>Var</span><span class='hs-layout'>,</span> <span class='hs-conid'>TyVar</span><span class='hs-layout'>,</span> <span class='hs-conid'>CoVar</span><span class='hs-layout'>,</span> <span class='hs-conid'>TyCoVar</span><span class='hs-layout'>,</span> <span class='hs-conid'>Id</span> <span class='hs-layout'>)</span>
<a name="line-54"></a><span class='hs-keyword'>import</span> <span class='hs-conid'>GHC.Types.Unique</span>
<a name="line-55"></a><span class='hs-keyword'>import</span> <span class='hs-conid'>GHC.Types.Name</span>     <span class='hs-layout'>(</span> <span class='hs-conid'>Name</span> <span class='hs-layout'>)</span>
<a name="line-56"></a><span class='hs-keyword'>import</span> <span class='hs-conid'>GHC.Types.Unique.Set</span>
<a name="line-57"></a><span class='hs-keyword'>import</span> <span class='hs-conid'>GHC.Types.Unique.DSet</span>
<a name="line-58"></a><span class='hs-keyword'>import</span> <span class='hs-conid'>GHC.Types.Unique.FM</span><span class='hs-layout'>(</span> <span class='hs-varid'>disjointUFM</span><span class='hs-layout'>,</span> <span class='hs-varid'>pluralUFM</span><span class='hs-layout'>,</span> <span class='hs-varid'>pprUFM</span> <span class='hs-layout'>)</span>
<a name="line-59"></a><span class='hs-keyword'>import</span> <span class='hs-conid'>GHC.Types.Unique.DFM</span><span class='hs-layout'>(</span> <span class='hs-varid'>disjointUDFM</span><span class='hs-layout'>,</span> <span class='hs-varid'>udfmToUfm</span><span class='hs-layout'>,</span> <span class='hs-varid'>anyUDFM</span><span class='hs-layout'>,</span> <span class='hs-varid'>allUDFM</span> <span class='hs-layout'>)</span>
<a name="line-60"></a><span class='hs-keyword'>import</span> <span class='hs-conid'>GHC.Utils.Outputable</span> <span class='hs-layout'>(</span><span class='hs-conid'>SDoc</span><span class='hs-layout'>)</span>
<a name="line-61"></a>
<a name="line-62"></a><a name="VarSet"></a><span class='hs-comment'>-- | A non-deterministic Variable Set</span>
<a name="line-63"></a><a name="VarSet"></a><span class='hs-comment'>--</span>
<a name="line-64"></a><a name="VarSet"></a><span class='hs-comment'>-- A non-deterministic set of variables.</span>
<a name="line-65"></a><a name="VarSet"></a><span class='hs-comment'>-- See Note [Deterministic UniqFM] in "GHC.Types.Unique.DFM" for explanation why it's not</span>
<a name="line-66"></a><a name="VarSet"></a><span class='hs-comment'>-- deterministic and why it matters. Use DVarSet if the set eventually</span>
<a name="line-67"></a><a name="VarSet"></a><span class='hs-comment'>-- gets converted into a list or folded over in a way where the order</span>
<a name="line-68"></a><a name="VarSet"></a><span class='hs-comment'>-- changes the generated code, for example when abstracting variables.</span>
<a name="line-69"></a><a name="VarSet"></a><span class='hs-keyword'>type</span> <span class='hs-conid'>VarSet</span>       <span class='hs-keyglyph'>=</span> <span class='hs-conid'>UniqSet</span> <span class='hs-conid'>Var</span>
<a name="line-70"></a>
<a name="line-71"></a><a name="IdSet"></a><span class='hs-comment'>-- | Identifier Set</span>
<a name="line-72"></a><a name="IdSet"></a><span class='hs-keyword'>type</span> <span class='hs-conid'>IdSet</span>        <span class='hs-keyglyph'>=</span> <span class='hs-conid'>UniqSet</span> <span class='hs-conid'>Id</span>
<a name="line-73"></a>
<a name="line-74"></a><a name="TyVarSet"></a><span class='hs-comment'>-- | Type Variable Set</span>
<a name="line-75"></a><a name="TyVarSet"></a><span class='hs-keyword'>type</span> <span class='hs-conid'>TyVarSet</span>     <span class='hs-keyglyph'>=</span> <span class='hs-conid'>UniqSet</span> <span class='hs-conid'>TyVar</span>
<a name="line-76"></a>
<a name="line-77"></a><a name="CoVarSet"></a><span class='hs-comment'>-- | Coercion Variable Set</span>
<a name="line-78"></a><a name="CoVarSet"></a><span class='hs-keyword'>type</span> <span class='hs-conid'>CoVarSet</span>     <span class='hs-keyglyph'>=</span> <span class='hs-conid'>UniqSet</span> <span class='hs-conid'>CoVar</span>
<a name="line-79"></a>
<a name="line-80"></a><a name="TyCoVarSet"></a><span class='hs-comment'>-- | Type or Coercion Variable Set</span>
<a name="line-81"></a><a name="TyCoVarSet"></a><span class='hs-keyword'>type</span> <span class='hs-conid'>TyCoVarSet</span>   <span class='hs-keyglyph'>=</span> <span class='hs-conid'>UniqSet</span> <span class='hs-conid'>TyCoVar</span>
<a name="line-82"></a>
<a name="line-83"></a><a name="emptyVarSet"></a><span class='hs-definition'>emptyVarSet</span>     <span class='hs-keyglyph'>::</span> <span class='hs-conid'>VarSet</span>
<a name="line-84"></a><a name="intersectVarSet"></a><span class='hs-definition'>intersectVarSet</span> <span class='hs-keyglyph'>::</span> <span class='hs-conid'>VarSet</span> <span class='hs-keyglyph'>-&gt;</span> <span class='hs-conid'>VarSet</span> <span class='hs-keyglyph'>-&gt;</span> <span class='hs-conid'>VarSet</span>
<a name="line-85"></a><a name="unionVarSet"></a><span class='hs-definition'>unionVarSet</span>     <span class='hs-keyglyph'>::</span> <span class='hs-conid'>VarSet</span> <span class='hs-keyglyph'>-&gt;</span> <span class='hs-conid'>VarSet</span> <span class='hs-keyglyph'>-&gt;</span> <span class='hs-conid'>VarSet</span>
<a name="line-86"></a><a name="unionVarSets"></a><span class='hs-definition'>unionVarSets</span>    <span class='hs-keyglyph'>::</span> <span class='hs-keyglyph'>[</span><span class='hs-conid'>VarSet</span><span class='hs-keyglyph'>]</span> <span class='hs-keyglyph'>-&gt;</span> <span class='hs-conid'>VarSet</span>
<a name="line-87"></a>
<a name="line-88"></a><a name="mapUnionVarSet"></a><span class='hs-definition'>mapUnionVarSet</span>  <span class='hs-keyglyph'>::</span> <span class='hs-layout'>(</span><span class='hs-varid'>a</span> <span class='hs-keyglyph'>-&gt;</span> <span class='hs-conid'>VarSet</span><span class='hs-layout'>)</span> <span class='hs-keyglyph'>-&gt;</span> <span class='hs-keyglyph'>[</span><span class='hs-varid'>a</span><span class='hs-keyglyph'>]</span> <span class='hs-keyglyph'>-&gt;</span> <span class='hs-conid'>VarSet</span>
<a name="line-89"></a><span class='hs-comment'>-- ^ map the function over the list, and union the results</span>
<a name="line-90"></a>
<a name="line-91"></a><a name="unitVarSet"></a><span class='hs-definition'>unitVarSet</span>      <span class='hs-keyglyph'>::</span> <span class='hs-conid'>Var</span> <span class='hs-keyglyph'>-&gt;</span> <span class='hs-conid'>VarSet</span>
<a name="line-92"></a><a name="extendVarSet"></a><span class='hs-definition'>extendVarSet</span>    <span class='hs-keyglyph'>::</span> <span class='hs-conid'>VarSet</span> <span class='hs-keyglyph'>-&gt;</span> <span class='hs-conid'>Var</span> <span class='hs-keyglyph'>-&gt;</span> <span class='hs-conid'>VarSet</span>
<a name="line-93"></a><a name="extendVarSetList"></a><span class='hs-definition'>extendVarSetList</span><span class='hs-keyglyph'>::</span> <span class='hs-conid'>VarSet</span> <span class='hs-keyglyph'>-&gt;</span> <span class='hs-keyglyph'>[</span><span class='hs-conid'>Var</span><span class='hs-keyglyph'>]</span> <span class='hs-keyglyph'>-&gt;</span> <span class='hs-conid'>VarSet</span>
<a name="line-94"></a><a name="elemVarSet"></a><span class='hs-definition'>elemVarSet</span>      <span class='hs-keyglyph'>::</span> <span class='hs-conid'>Var</span> <span class='hs-keyglyph'>-&gt;</span> <span class='hs-conid'>VarSet</span> <span class='hs-keyglyph'>-&gt;</span> <span class='hs-conid'>Bool</span>
<a name="line-95"></a><a name="delVarSet"></a><span class='hs-definition'>delVarSet</span>       <span class='hs-keyglyph'>::</span> <span class='hs-conid'>VarSet</span> <span class='hs-keyglyph'>-&gt;</span> <span class='hs-conid'>Var</span> <span class='hs-keyglyph'>-&gt;</span> <span class='hs-conid'>VarSet</span>
<a name="line-96"></a><a name="delVarSetList"></a><span class='hs-definition'>delVarSetList</span>   <span class='hs-keyglyph'>::</span> <span class='hs-conid'>VarSet</span> <span class='hs-keyglyph'>-&gt;</span> <span class='hs-keyglyph'>[</span><span class='hs-conid'>Var</span><span class='hs-keyglyph'>]</span> <span class='hs-keyglyph'>-&gt;</span> <span class='hs-conid'>VarSet</span>
<a name="line-97"></a><a name="minusVarSet"></a><span class='hs-definition'>minusVarSet</span>     <span class='hs-keyglyph'>::</span> <span class='hs-conid'>VarSet</span> <span class='hs-keyglyph'>-&gt;</span> <span class='hs-conid'>VarSet</span> <span class='hs-keyglyph'>-&gt;</span> <span class='hs-conid'>VarSet</span>
<a name="line-98"></a><a name="isEmptyVarSet"></a><span class='hs-definition'>isEmptyVarSet</span>   <span class='hs-keyglyph'>::</span> <span class='hs-conid'>VarSet</span> <span class='hs-keyglyph'>-&gt;</span> <span class='hs-conid'>Bool</span>
<a name="line-99"></a><a name="mkVarSet"></a><span class='hs-definition'>mkVarSet</span>        <span class='hs-keyglyph'>::</span> <span class='hs-keyglyph'>[</span><span class='hs-conid'>Var</span><span class='hs-keyglyph'>]</span> <span class='hs-keyglyph'>-&gt;</span> <span class='hs-conid'>VarSet</span>
<a name="line-100"></a><a name="lookupVarSet_Directly"></a><span class='hs-definition'>lookupVarSet_Directly</span> <span class='hs-keyglyph'>::</span> <span class='hs-conid'>VarSet</span> <span class='hs-keyglyph'>-&gt;</span> <span class='hs-conid'>Unique</span> <span class='hs-keyglyph'>-&gt;</span> <span class='hs-conid'>Maybe</span> <span class='hs-conid'>Var</span>
<a name="line-101"></a><a name="lookupVarSet"></a><span class='hs-definition'>lookupVarSet</span>    <span class='hs-keyglyph'>::</span> <span class='hs-conid'>VarSet</span> <span class='hs-keyglyph'>-&gt;</span> <span class='hs-conid'>Var</span> <span class='hs-keyglyph'>-&gt;</span> <span class='hs-conid'>Maybe</span> <span class='hs-conid'>Var</span>
<a name="line-102"></a>                        <span class='hs-comment'>-- Returns the set element, which may be</span>
<a name="line-103"></a>                        <span class='hs-comment'>-- (==) to the argument, but not the same as</span>
<a name="line-104"></a><a name="lookupVarSetByName"></a><span class='hs-definition'>lookupVarSetByName</span> <span class='hs-keyglyph'>::</span> <span class='hs-conid'>VarSet</span> <span class='hs-keyglyph'>-&gt;</span> <span class='hs-conid'>Name</span> <span class='hs-keyglyph'>-&gt;</span> <span class='hs-conid'>Maybe</span> <span class='hs-conid'>Var</span>
<a name="line-105"></a><a name="sizeVarSet"></a><span class='hs-definition'>sizeVarSet</span>      <span class='hs-keyglyph'>::</span> <span class='hs-conid'>VarSet</span> <span class='hs-keyglyph'>-&gt;</span> <span class='hs-conid'>Int</span>
<a name="line-106"></a><a name="filterVarSet"></a><span class='hs-definition'>filterVarSet</span>    <span class='hs-keyglyph'>::</span> <span class='hs-layout'>(</span><span class='hs-conid'>Var</span> <span class='hs-keyglyph'>-&gt;</span> <span class='hs-conid'>Bool</span><span class='hs-layout'>)</span> <span class='hs-keyglyph'>-&gt;</span> <span class='hs-conid'>VarSet</span> <span class='hs-keyglyph'>-&gt;</span> <span class='hs-conid'>VarSet</span>
<a name="line-107"></a>
<a name="line-108"></a><a name="delVarSetByKey"></a><span class='hs-definition'>delVarSetByKey</span>  <span class='hs-keyglyph'>::</span> <span class='hs-conid'>VarSet</span> <span class='hs-keyglyph'>-&gt;</span> <span class='hs-conid'>Unique</span> <span class='hs-keyglyph'>-&gt;</span> <span class='hs-conid'>VarSet</span>
<a name="line-109"></a><a name="elemVarSetByKey"></a><span class='hs-definition'>elemVarSetByKey</span> <span class='hs-keyglyph'>::</span> <span class='hs-conid'>Unique</span> <span class='hs-keyglyph'>-&gt;</span> <span class='hs-conid'>VarSet</span> <span class='hs-keyglyph'>-&gt;</span> <span class='hs-conid'>Bool</span>
<a name="line-110"></a><a name="partitionVarSet"></a><span class='hs-definition'>partitionVarSet</span> <span class='hs-keyglyph'>::</span> <span class='hs-layout'>(</span><span class='hs-conid'>Var</span> <span class='hs-keyglyph'>-&gt;</span> <span class='hs-conid'>Bool</span><span class='hs-layout'>)</span> <span class='hs-keyglyph'>-&gt;</span> <span class='hs-conid'>VarSet</span> <span class='hs-keyglyph'>-&gt;</span> <span class='hs-layout'>(</span><span class='hs-conid'>VarSet</span><span class='hs-layout'>,</span> <span class='hs-conid'>VarSet</span><span class='hs-layout'>)</span>
<a name="line-111"></a>
<a name="line-112"></a><span class='hs-definition'>emptyVarSet</span>     <span class='hs-keyglyph'>=</span> <span class='hs-varid'>emptyUniqSet</span>
<a name="line-113"></a><span class='hs-definition'>unitVarSet</span>      <span class='hs-keyglyph'>=</span> <span class='hs-varid'>unitUniqSet</span>
<a name="line-114"></a><span class='hs-definition'>extendVarSet</span>    <span class='hs-keyglyph'>=</span> <span class='hs-varid'>addOneToUniqSet</span>
<a name="line-115"></a><span class='hs-definition'>extendVarSetList</span><span class='hs-keyglyph'>=</span> <span class='hs-varid'>addListToUniqSet</span>
<a name="line-116"></a><span class='hs-definition'>intersectVarSet</span> <span class='hs-keyglyph'>=</span> <span class='hs-varid'>intersectUniqSets</span>
<a name="line-117"></a>
<a name="line-118"></a><a name="intersectsVarSet"></a><span class='hs-definition'>intersectsVarSet</span><span class='hs-keyglyph'>::</span> <span class='hs-conid'>VarSet</span> <span class='hs-keyglyph'>-&gt;</span> <span class='hs-conid'>VarSet</span> <span class='hs-keyglyph'>-&gt;</span> <span class='hs-conid'>Bool</span>     <span class='hs-comment'>-- True if non-empty intersection</span>
<a name="line-119"></a><a name="disjointVarSet"></a><span class='hs-definition'>disjointVarSet</span>  <span class='hs-keyglyph'>::</span> <span class='hs-conid'>VarSet</span> <span class='hs-keyglyph'>-&gt;</span> <span class='hs-conid'>VarSet</span> <span class='hs-keyglyph'>-&gt;</span> <span class='hs-conid'>Bool</span>     <span class='hs-comment'>-- True if empty intersection</span>
<a name="line-120"></a><a name="subVarSet"></a><span class='hs-definition'>subVarSet</span>       <span class='hs-keyglyph'>::</span> <span class='hs-conid'>VarSet</span> <span class='hs-keyglyph'>-&gt;</span> <span class='hs-conid'>VarSet</span> <span class='hs-keyglyph'>-&gt;</span> <span class='hs-conid'>Bool</span>     <span class='hs-comment'>-- True if first arg is subset of second</span>
<a name="line-121"></a>        <span class='hs-comment'>-- (s1 `intersectsVarSet` s2) doesn't compute s2 if s1 is empty;</span>
<a name="line-122"></a>        <span class='hs-comment'>-- ditto disjointVarSet, subVarSet</span>
<a name="line-123"></a>
<a name="line-124"></a><span class='hs-definition'>unionVarSet</span>     <span class='hs-keyglyph'>=</span> <span class='hs-varid'>unionUniqSets</span>
<a name="line-125"></a><span class='hs-definition'>unionVarSets</span>    <span class='hs-keyglyph'>=</span> <span class='hs-varid'>unionManyUniqSets</span>
<a name="line-126"></a><span class='hs-definition'>elemVarSet</span>      <span class='hs-keyglyph'>=</span> <span class='hs-varid'>elementOfUniqSet</span>
<a name="line-127"></a><span class='hs-definition'>minusVarSet</span>     <span class='hs-keyglyph'>=</span> <span class='hs-varid'>minusUniqSet</span>
<a name="line-128"></a><span class='hs-definition'>delVarSet</span>       <span class='hs-keyglyph'>=</span> <span class='hs-varid'>delOneFromUniqSet</span>
<a name="line-129"></a><span class='hs-definition'>delVarSetList</span>   <span class='hs-keyglyph'>=</span> <span class='hs-varid'>delListFromUniqSet</span>
<a name="line-130"></a><span class='hs-definition'>isEmptyVarSet</span>   <span class='hs-keyglyph'>=</span> <span class='hs-varid'>isEmptyUniqSet</span>
<a name="line-131"></a><span class='hs-definition'>mkVarSet</span>        <span class='hs-keyglyph'>=</span> <span class='hs-varid'>mkUniqSet</span>
<a name="line-132"></a><span class='hs-definition'>lookupVarSet_Directly</span> <span class='hs-keyglyph'>=</span> <span class='hs-varid'>lookupUniqSet_Directly</span>
<a name="line-133"></a><span class='hs-definition'>lookupVarSet</span>    <span class='hs-keyglyph'>=</span> <span class='hs-varid'>lookupUniqSet</span>
<a name="line-134"></a><span class='hs-definition'>lookupVarSetByName</span> <span class='hs-varid'>set</span> <span class='hs-varid'>name</span> <span class='hs-keyglyph'>=</span> <span class='hs-varid'>lookupUniqSet_Directly</span> <span class='hs-varid'>set</span> <span class='hs-layout'>(</span><span class='hs-varid'>getUnique</span> <span class='hs-varid'>name</span><span class='hs-layout'>)</span>
<a name="line-135"></a><span class='hs-definition'>sizeVarSet</span>      <span class='hs-keyglyph'>=</span> <span class='hs-varid'>sizeUniqSet</span>
<a name="line-136"></a><span class='hs-definition'>filterVarSet</span>    <span class='hs-keyglyph'>=</span> <span class='hs-varid'>filterUniqSet</span>
<a name="line-137"></a><span class='hs-definition'>delVarSetByKey</span>  <span class='hs-keyglyph'>=</span> <span class='hs-varid'>delOneFromUniqSet_Directly</span>
<a name="line-138"></a><span class='hs-definition'>elemVarSetByKey</span> <span class='hs-keyglyph'>=</span> <span class='hs-varid'>elemUniqSet_Directly</span>
<a name="line-139"></a><span class='hs-definition'>partitionVarSet</span> <span class='hs-keyglyph'>=</span> <span class='hs-varid'>partitionUniqSet</span>
<a name="line-140"></a>
<a name="line-141"></a><span class='hs-definition'>mapUnionVarSet</span> <span class='hs-varid'>get_set</span> <span class='hs-varid'>xs</span> <span class='hs-keyglyph'>=</span> <span class='hs-varid'>foldr</span> <span class='hs-layout'>(</span><span class='hs-varid'>unionVarSet</span> <span class='hs-varop'>.</span> <span class='hs-varid'>get_set</span><span class='hs-layout'>)</span> <span class='hs-varid'>emptyVarSet</span> <span class='hs-varid'>xs</span>
<a name="line-142"></a>
<a name="line-143"></a><span class='hs-comment'>-- See comments with type signatures</span>
<a name="line-144"></a><span class='hs-definition'>intersectsVarSet</span> <span class='hs-varid'>s1</span> <span class='hs-varid'>s2</span> <span class='hs-keyglyph'>=</span> <span class='hs-varid'>not</span> <span class='hs-layout'>(</span><span class='hs-varid'>s1</span> <span class='hs-varop'>`disjointVarSet`</span> <span class='hs-varid'>s2</span><span class='hs-layout'>)</span>
<a name="line-145"></a><span class='hs-definition'>disjointVarSet</span>   <span class='hs-varid'>s1</span> <span class='hs-varid'>s2</span> <span class='hs-keyglyph'>=</span> <span class='hs-varid'>disjointUFM</span> <span class='hs-layout'>(</span><span class='hs-varid'>getUniqSet</span> <span class='hs-varid'>s1</span><span class='hs-layout'>)</span> <span class='hs-layout'>(</span><span class='hs-varid'>getUniqSet</span> <span class='hs-varid'>s2</span><span class='hs-layout'>)</span>
<a name="line-146"></a><span class='hs-definition'>subVarSet</span>        <span class='hs-varid'>s1</span> <span class='hs-varid'>s2</span> <span class='hs-keyglyph'>=</span> <span class='hs-varid'>isEmptyVarSet</span> <span class='hs-layout'>(</span><span class='hs-varid'>s1</span> <span class='hs-varop'>`minusVarSet`</span> <span class='hs-varid'>s2</span><span class='hs-layout'>)</span>
<a name="line-147"></a>
<a name="line-148"></a><a name="anyVarSet"></a><span class='hs-definition'>anyVarSet</span> <span class='hs-keyglyph'>::</span> <span class='hs-layout'>(</span><span class='hs-conid'>Var</span> <span class='hs-keyglyph'>-&gt;</span> <span class='hs-conid'>Bool</span><span class='hs-layout'>)</span> <span class='hs-keyglyph'>-&gt;</span> <span class='hs-conid'>VarSet</span> <span class='hs-keyglyph'>-&gt;</span> <span class='hs-conid'>Bool</span>
<a name="line-149"></a><span class='hs-definition'>anyVarSet</span> <span class='hs-keyglyph'>=</span> <span class='hs-varid'>uniqSetAny</span>
<a name="line-150"></a>
<a name="line-151"></a><a name="allVarSet"></a><span class='hs-definition'>allVarSet</span> <span class='hs-keyglyph'>::</span> <span class='hs-layout'>(</span><span class='hs-conid'>Var</span> <span class='hs-keyglyph'>-&gt;</span> <span class='hs-conid'>Bool</span><span class='hs-layout'>)</span> <span class='hs-keyglyph'>-&gt;</span> <span class='hs-conid'>VarSet</span> <span class='hs-keyglyph'>-&gt;</span> <span class='hs-conid'>Bool</span>
<a name="line-152"></a><span class='hs-definition'>allVarSet</span> <span class='hs-keyglyph'>=</span> <span class='hs-varid'>uniqSetAll</span>
<a name="line-153"></a>
<a name="line-154"></a><a name="mapVarSet"></a><span class='hs-definition'>mapVarSet</span> <span class='hs-keyglyph'>::</span> <span class='hs-conid'>Uniquable</span> <span class='hs-varid'>b</span> <span class='hs-keyglyph'>=&gt;</span> <span class='hs-layout'>(</span><span class='hs-varid'>a</span> <span class='hs-keyglyph'>-&gt;</span> <span class='hs-varid'>b</span><span class='hs-layout'>)</span> <span class='hs-keyglyph'>-&gt;</span> <span class='hs-conid'>UniqSet</span> <span class='hs-varid'>a</span> <span class='hs-keyglyph'>-&gt;</span> <span class='hs-conid'>UniqSet</span> <span class='hs-varid'>b</span>
<a name="line-155"></a><span class='hs-definition'>mapVarSet</span> <span class='hs-keyglyph'>=</span> <span class='hs-varid'>mapUniqSet</span>
<a name="line-156"></a>
<a name="line-157"></a><a name="nonDetStrictFoldVarSet"></a><span class='hs-comment'>-- See Note [Deterministic UniqFM] to learn about nondeterminism.</span>
<a name="line-158"></a><span class='hs-comment'>-- If you use this please provide a justification why it doesn't introduce</span>
<a name="line-159"></a><span class='hs-comment'>-- nondeterminism.</span>
<a name="line-160"></a><span class='hs-definition'>nonDetStrictFoldVarSet</span> <span class='hs-keyglyph'>::</span> <span class='hs-layout'>(</span><span class='hs-conid'>Var</span> <span class='hs-keyglyph'>-&gt;</span> <span class='hs-varid'>a</span> <span class='hs-keyglyph'>-&gt;</span> <span class='hs-varid'>a</span><span class='hs-layout'>)</span> <span class='hs-keyglyph'>-&gt;</span> <span class='hs-varid'>a</span> <span class='hs-keyglyph'>-&gt;</span> <span class='hs-conid'>VarSet</span> <span class='hs-keyglyph'>-&gt;</span> <span class='hs-varid'>a</span>
<a name="line-161"></a><span class='hs-definition'>nonDetStrictFoldVarSet</span> <span class='hs-keyglyph'>=</span> <span class='hs-varid'>nonDetStrictFoldUniqSet</span>
<a name="line-162"></a>
<a name="line-163"></a><a name="fixVarSet"></a><span class='hs-definition'>fixVarSet</span> <span class='hs-keyglyph'>::</span> <span class='hs-layout'>(</span><span class='hs-conid'>VarSet</span> <span class='hs-keyglyph'>-&gt;</span> <span class='hs-conid'>VarSet</span><span class='hs-layout'>)</span>   <span class='hs-comment'>-- Map the current set to a new set</span>
<a name="line-164"></a>          <span class='hs-keyglyph'>-&gt;</span> <span class='hs-conid'>VarSet</span> <span class='hs-keyglyph'>-&gt;</span> <span class='hs-conid'>VarSet</span>
<a name="line-165"></a><span class='hs-comment'>-- (fixVarSet f s) repeatedly applies f to the set s,</span>
<a name="line-166"></a><span class='hs-comment'>-- until it reaches a fixed point.</span>
<a name="line-167"></a><span class='hs-definition'>fixVarSet</span> <span class='hs-varid'>fn</span> <span class='hs-varid'>vars</span>
<a name="line-168"></a>  <span class='hs-keyglyph'>|</span> <span class='hs-varid'>new_vars</span> <span class='hs-varop'>`subVarSet`</span> <span class='hs-varid'>vars</span> <span class='hs-keyglyph'>=</span> <span class='hs-varid'>vars</span>
<a name="line-169"></a>  <span class='hs-keyglyph'>|</span> <span class='hs-varid'>otherwise</span>                 <span class='hs-keyglyph'>=</span> <span class='hs-varid'>fixVarSet</span> <span class='hs-varid'>fn</span> <span class='hs-varid'>new_vars</span>
<a name="line-170"></a>  <span class='hs-keyword'>where</span>
<a name="line-171"></a>    <span class='hs-varid'>new_vars</span> <span class='hs-keyglyph'>=</span> <span class='hs-varid'>fn</span> <span class='hs-varid'>vars</span>
<a name="line-172"></a>
<a name="line-173"></a><a name="transCloVarSet"></a><span class='hs-definition'>transCloVarSet</span> <span class='hs-keyglyph'>::</span> <span class='hs-layout'>(</span><span class='hs-conid'>VarSet</span> <span class='hs-keyglyph'>-&gt;</span> <span class='hs-conid'>VarSet</span><span class='hs-layout'>)</span>
<a name="line-174"></a>                  <span class='hs-comment'>-- Map some variables in the set to</span>
<a name="line-175"></a>                  <span class='hs-comment'>-- extra variables that should be in it</span>
<a name="line-176"></a>               <span class='hs-keyglyph'>-&gt;</span> <span class='hs-conid'>VarSet</span> <span class='hs-keyglyph'>-&gt;</span> <span class='hs-conid'>VarSet</span>
<a name="line-177"></a><span class='hs-comment'>-- (transCloVarSet f s) repeatedly applies f to new candidates, adding any</span>
<a name="line-178"></a><span class='hs-comment'>-- new variables to s that it finds thereby, until it reaches a fixed point.</span>
<a name="line-179"></a><span class='hs-comment'>--</span>
<a name="line-180"></a><span class='hs-comment'>-- The function fn could be (Var -&gt; VarSet), but we use (VarSet -&gt; VarSet)</span>
<a name="line-181"></a><span class='hs-comment'>-- for efficiency, so that the test can be batched up.</span>
<a name="line-182"></a><span class='hs-comment'>-- It's essential that fn will work fine if given new candidates</span>
<a name="line-183"></a><span class='hs-comment'>-- one at a time; ie  fn {v1,v2} = fn v1 `union` fn v2</span>
<a name="line-184"></a><span class='hs-comment'>-- Use fixVarSet if the function needs to see the whole set all at once</span>
<a name="line-185"></a><span class='hs-definition'>transCloVarSet</span> <span class='hs-varid'>fn</span> <span class='hs-varid'>seeds</span>
<a name="line-186"></a>  <span class='hs-keyglyph'>=</span> <span class='hs-varid'>go</span> <span class='hs-varid'>seeds</span> <span class='hs-varid'>seeds</span>
<a name="line-187"></a>  <span class='hs-keyword'>where</span>
<a name="line-188"></a>    <span class='hs-varid'>go</span> <span class='hs-keyglyph'>::</span> <span class='hs-conid'>VarSet</span>  <span class='hs-comment'>-- Accumulating result</span>
<a name="line-189"></a>       <span class='hs-keyglyph'>-&gt;</span> <span class='hs-conid'>VarSet</span>  <span class='hs-comment'>-- Work-list; un-processed subset of accumulating result</span>
<a name="line-190"></a>       <span class='hs-keyglyph'>-&gt;</span> <span class='hs-conid'>VarSet</span>
<a name="line-191"></a>    <span class='hs-comment'>-- Specification: go acc vs = acc `union` transClo fn vs</span>
<a name="line-192"></a>
<a name="line-193"></a>    <span class='hs-varid'>go</span> <span class='hs-varid'>acc</span> <span class='hs-varid'>candidates</span>
<a name="line-194"></a>       <span class='hs-keyglyph'>|</span> <span class='hs-varid'>isEmptyVarSet</span> <span class='hs-varid'>new_vs</span> <span class='hs-keyglyph'>=</span> <span class='hs-varid'>acc</span>
<a name="line-195"></a>       <span class='hs-keyglyph'>|</span> <span class='hs-varid'>otherwise</span>            <span class='hs-keyglyph'>=</span> <span class='hs-varid'>go</span> <span class='hs-layout'>(</span><span class='hs-varid'>acc</span> <span class='hs-varop'>`unionVarSet`</span> <span class='hs-varid'>new_vs</span><span class='hs-layout'>)</span> <span class='hs-varid'>new_vs</span>
<a name="line-196"></a>       <span class='hs-keyword'>where</span>
<a name="line-197"></a>         <span class='hs-varid'>new_vs</span> <span class='hs-keyglyph'>=</span> <span class='hs-varid'>fn</span> <span class='hs-varid'>candidates</span> <span class='hs-varop'>`minusVarSet`</span> <span class='hs-varid'>acc</span>
<a name="line-198"></a>
<a name="line-199"></a><a name="seqVarSet"></a><span class='hs-definition'>seqVarSet</span> <span class='hs-keyglyph'>::</span> <span class='hs-conid'>VarSet</span> <span class='hs-keyglyph'>-&gt;</span> <span class='hs-conid'>()</span>
<a name="line-200"></a><span class='hs-definition'>seqVarSet</span> <span class='hs-varid'>s</span> <span class='hs-keyglyph'>=</span> <span class='hs-varid'>sizeVarSet</span> <span class='hs-varid'>s</span> <span class='hs-varop'>`seq`</span> <span class='hs-conid'>()</span>
<a name="line-201"></a>
<a name="line-202"></a><a name="pluralVarSet"></a><span class='hs-comment'>-- | Determines the pluralisation suffix appropriate for the length of a set</span>
<a name="line-203"></a><span class='hs-comment'>-- in the same way that plural from Outputable does for lists.</span>
<a name="line-204"></a><span class='hs-definition'>pluralVarSet</span> <span class='hs-keyglyph'>::</span> <span class='hs-conid'>VarSet</span> <span class='hs-keyglyph'>-&gt;</span> <span class='hs-conid'>SDoc</span>
<a name="line-205"></a><span class='hs-definition'>pluralVarSet</span> <span class='hs-keyglyph'>=</span> <span class='hs-varid'>pluralUFM</span> <span class='hs-varop'>.</span> <span class='hs-varid'>getUniqSet</span>
<a name="line-206"></a>
<a name="line-207"></a><a name="pprVarSet"></a><span class='hs-comment'>-- | Pretty-print a non-deterministic set.</span>
<a name="line-208"></a><span class='hs-comment'>-- The order of variables is non-deterministic and for pretty-printing that</span>
<a name="line-209"></a><span class='hs-comment'>-- shouldn't be a problem.</span>
<a name="line-210"></a><span class='hs-comment'>-- Having this function helps contain the non-determinism created with</span>
<a name="line-211"></a><span class='hs-comment'>-- nonDetEltsUFM.</span>
<a name="line-212"></a><span class='hs-comment'>-- Passing a list to the pretty-printing function allows the caller</span>
<a name="line-213"></a><span class='hs-comment'>-- to decide on the order of Vars (eg. toposort them) without them having</span>
<a name="line-214"></a><span class='hs-comment'>-- to use nonDetEltsUFM at the call site. This prevents from let-binding</span>
<a name="line-215"></a><span class='hs-comment'>-- non-deterministically ordered lists and reusing them where determinism</span>
<a name="line-216"></a><span class='hs-comment'>-- matters.</span>
<a name="line-217"></a><span class='hs-definition'>pprVarSet</span> <span class='hs-keyglyph'>::</span> <span class='hs-conid'>VarSet</span>          <span class='hs-comment'>-- ^ The things to be pretty printed</span>
<a name="line-218"></a>          <span class='hs-keyglyph'>-&gt;</span> <span class='hs-layout'>(</span><span class='hs-keyglyph'>[</span><span class='hs-conid'>Var</span><span class='hs-keyglyph'>]</span> <span class='hs-keyglyph'>-&gt;</span> <span class='hs-conid'>SDoc</span><span class='hs-layout'>)</span> <span class='hs-comment'>-- ^ The pretty printing function to use on the</span>
<a name="line-219"></a>                             <span class='hs-comment'>-- elements</span>
<a name="line-220"></a>          <span class='hs-keyglyph'>-&gt;</span> <span class='hs-conid'>SDoc</span>            <span class='hs-comment'>-- ^ 'SDoc' where the things have been pretty</span>
<a name="line-221"></a>                             <span class='hs-comment'>-- printed</span>
<a name="line-222"></a><span class='hs-definition'>pprVarSet</span> <span class='hs-keyglyph'>=</span> <span class='hs-varid'>pprUFM</span> <span class='hs-varop'>.</span> <span class='hs-varid'>getUniqSet</span>
<a name="line-223"></a>
<a name="line-224"></a><span class='hs-comment'>-- Deterministic VarSet</span>
<a name="line-225"></a><span class='hs-comment'>-- See Note [Deterministic UniqFM] in GHC.Types.Unique.DFM for explanation why we need</span>
<a name="line-226"></a><span class='hs-comment'>-- DVarSet.</span>
<a name="line-227"></a>
<a name="line-228"></a><a name="DVarSet"></a><span class='hs-comment'>-- | Deterministic Variable Set</span>
<a name="line-229"></a><a name="DVarSet"></a><span class='hs-keyword'>type</span> <span class='hs-conid'>DVarSet</span>     <span class='hs-keyglyph'>=</span> <span class='hs-conid'>UniqDSet</span> <span class='hs-conid'>Var</span>
<a name="line-230"></a>
<a name="line-231"></a><a name="DIdSet"></a><span class='hs-comment'>-- | Deterministic Identifier Set</span>
<a name="line-232"></a><a name="DIdSet"></a><span class='hs-keyword'>type</span> <span class='hs-conid'>DIdSet</span>      <span class='hs-keyglyph'>=</span> <span class='hs-conid'>UniqDSet</span> <span class='hs-conid'>Id</span>
<a name="line-233"></a>
<a name="line-234"></a><a name="DTyVarSet"></a><span class='hs-comment'>-- | Deterministic Type Variable Set</span>
<a name="line-235"></a><a name="DTyVarSet"></a><span class='hs-keyword'>type</span> <span class='hs-conid'>DTyVarSet</span>   <span class='hs-keyglyph'>=</span> <span class='hs-conid'>UniqDSet</span> <span class='hs-conid'>TyVar</span>
<a name="line-236"></a>
<a name="line-237"></a><a name="DTyCoVarSet"></a><span class='hs-comment'>-- | Deterministic Type or Coercion Variable Set</span>
<a name="line-238"></a><a name="DTyCoVarSet"></a><span class='hs-keyword'>type</span> <span class='hs-conid'>DTyCoVarSet</span> <span class='hs-keyglyph'>=</span> <span class='hs-conid'>UniqDSet</span> <span class='hs-conid'>TyCoVar</span>
<a name="line-239"></a>
<a name="line-240"></a><a name="emptyDVarSet"></a><span class='hs-definition'>emptyDVarSet</span> <span class='hs-keyglyph'>::</span> <span class='hs-conid'>DVarSet</span>
<a name="line-241"></a><span class='hs-definition'>emptyDVarSet</span> <span class='hs-keyglyph'>=</span> <span class='hs-varid'>emptyUniqDSet</span>
<a name="line-242"></a>
<a name="line-243"></a><a name="unitDVarSet"></a><span class='hs-definition'>unitDVarSet</span> <span class='hs-keyglyph'>::</span> <span class='hs-conid'>Var</span> <span class='hs-keyglyph'>-&gt;</span> <span class='hs-conid'>DVarSet</span>
<a name="line-244"></a><span class='hs-definition'>unitDVarSet</span> <span class='hs-keyglyph'>=</span> <span class='hs-varid'>unitUniqDSet</span>
<a name="line-245"></a>
<a name="line-246"></a><a name="mkDVarSet"></a><span class='hs-definition'>mkDVarSet</span> <span class='hs-keyglyph'>::</span> <span class='hs-keyglyph'>[</span><span class='hs-conid'>Var</span><span class='hs-keyglyph'>]</span> <span class='hs-keyglyph'>-&gt;</span> <span class='hs-conid'>DVarSet</span>
<a name="line-247"></a><span class='hs-definition'>mkDVarSet</span> <span class='hs-keyglyph'>=</span> <span class='hs-varid'>mkUniqDSet</span>
<a name="line-248"></a>
<a name="line-249"></a><a name="extendDVarSet"></a><span class='hs-comment'>-- The new element always goes to the right of existing ones.</span>
<a name="line-250"></a><span class='hs-definition'>extendDVarSet</span> <span class='hs-keyglyph'>::</span> <span class='hs-conid'>DVarSet</span> <span class='hs-keyglyph'>-&gt;</span> <span class='hs-conid'>Var</span> <span class='hs-keyglyph'>-&gt;</span> <span class='hs-conid'>DVarSet</span>
<a name="line-251"></a><span class='hs-definition'>extendDVarSet</span> <span class='hs-keyglyph'>=</span> <span class='hs-varid'>addOneToUniqDSet</span>
<a name="line-252"></a>
<a name="line-253"></a><a name="elemDVarSet"></a><span class='hs-definition'>elemDVarSet</span> <span class='hs-keyglyph'>::</span> <span class='hs-conid'>Var</span> <span class='hs-keyglyph'>-&gt;</span> <span class='hs-conid'>DVarSet</span> <span class='hs-keyglyph'>-&gt;</span> <span class='hs-conid'>Bool</span>
<a name="line-254"></a><span class='hs-definition'>elemDVarSet</span> <span class='hs-keyglyph'>=</span> <span class='hs-varid'>elementOfUniqDSet</span>
<a name="line-255"></a>
<a name="line-256"></a><a name="dVarSetElems"></a><span class='hs-definition'>dVarSetElems</span> <span class='hs-keyglyph'>::</span> <span class='hs-conid'>DVarSet</span> <span class='hs-keyglyph'>-&gt;</span> <span class='hs-keyglyph'>[</span><span class='hs-conid'>Var</span><span class='hs-keyglyph'>]</span>
<a name="line-257"></a><span class='hs-definition'>dVarSetElems</span> <span class='hs-keyglyph'>=</span> <span class='hs-varid'>uniqDSetToList</span>
<a name="line-258"></a>
<a name="line-259"></a><a name="subDVarSet"></a><span class='hs-definition'>subDVarSet</span> <span class='hs-keyglyph'>::</span> <span class='hs-conid'>DVarSet</span> <span class='hs-keyglyph'>-&gt;</span> <span class='hs-conid'>DVarSet</span> <span class='hs-keyglyph'>-&gt;</span> <span class='hs-conid'>Bool</span>
<a name="line-260"></a><span class='hs-definition'>subDVarSet</span> <span class='hs-varid'>s1</span> <span class='hs-varid'>s2</span> <span class='hs-keyglyph'>=</span> <span class='hs-varid'>isEmptyDVarSet</span> <span class='hs-layout'>(</span><span class='hs-varid'>s1</span> <span class='hs-varop'>`minusDVarSet`</span> <span class='hs-varid'>s2</span><span class='hs-layout'>)</span>
<a name="line-261"></a>
<a name="line-262"></a><a name="unionDVarSet"></a><span class='hs-definition'>unionDVarSet</span> <span class='hs-keyglyph'>::</span> <span class='hs-conid'>DVarSet</span> <span class='hs-keyglyph'>-&gt;</span> <span class='hs-conid'>DVarSet</span> <span class='hs-keyglyph'>-&gt;</span> <span class='hs-conid'>DVarSet</span>
<a name="line-263"></a><span class='hs-definition'>unionDVarSet</span> <span class='hs-keyglyph'>=</span> <span class='hs-varid'>unionUniqDSets</span>
<a name="line-264"></a>
<a name="line-265"></a><a name="unionDVarSets"></a><span class='hs-definition'>unionDVarSets</span> <span class='hs-keyglyph'>::</span> <span class='hs-keyglyph'>[</span><span class='hs-conid'>DVarSet</span><span class='hs-keyglyph'>]</span> <span class='hs-keyglyph'>-&gt;</span> <span class='hs-conid'>DVarSet</span>
<a name="line-266"></a><span class='hs-definition'>unionDVarSets</span> <span class='hs-keyglyph'>=</span> <span class='hs-varid'>unionManyUniqDSets</span>
<a name="line-267"></a>
<a name="line-268"></a><a name="mapUnionDVarSet"></a><span class='hs-comment'>-- | Map the function over the list, and union the results</span>
<a name="line-269"></a><span class='hs-definition'>mapUnionDVarSet</span>  <span class='hs-keyglyph'>::</span> <span class='hs-layout'>(</span><span class='hs-varid'>a</span> <span class='hs-keyglyph'>-&gt;</span> <span class='hs-conid'>DVarSet</span><span class='hs-layout'>)</span> <span class='hs-keyglyph'>-&gt;</span> <span class='hs-keyglyph'>[</span><span class='hs-varid'>a</span><span class='hs-keyglyph'>]</span> <span class='hs-keyglyph'>-&gt;</span> <span class='hs-conid'>DVarSet</span>
<a name="line-270"></a><span class='hs-definition'>mapUnionDVarSet</span> <span class='hs-varid'>get_set</span> <span class='hs-varid'>xs</span> <span class='hs-keyglyph'>=</span> <span class='hs-varid'>foldr</span> <span class='hs-layout'>(</span><span class='hs-varid'>unionDVarSet</span> <span class='hs-varop'>.</span> <span class='hs-varid'>get_set</span><span class='hs-layout'>)</span> <span class='hs-varid'>emptyDVarSet</span> <span class='hs-varid'>xs</span>
<a name="line-271"></a>
<a name="line-272"></a><a name="intersectDVarSet"></a><span class='hs-definition'>intersectDVarSet</span> <span class='hs-keyglyph'>::</span> <span class='hs-conid'>DVarSet</span> <span class='hs-keyglyph'>-&gt;</span> <span class='hs-conid'>DVarSet</span> <span class='hs-keyglyph'>-&gt;</span> <span class='hs-conid'>DVarSet</span>
<a name="line-273"></a><span class='hs-definition'>intersectDVarSet</span> <span class='hs-keyglyph'>=</span> <span class='hs-varid'>intersectUniqDSets</span>
<a name="line-274"></a>
<a name="line-275"></a><a name="dVarSetIntersectVarSet"></a><span class='hs-definition'>dVarSetIntersectVarSet</span> <span class='hs-keyglyph'>::</span> <span class='hs-conid'>DVarSet</span> <span class='hs-keyglyph'>-&gt;</span> <span class='hs-conid'>VarSet</span> <span class='hs-keyglyph'>-&gt;</span> <span class='hs-conid'>DVarSet</span>
<a name="line-276"></a><span class='hs-definition'>dVarSetIntersectVarSet</span> <span class='hs-keyglyph'>=</span> <span class='hs-varid'>uniqDSetIntersectUniqSet</span>
<a name="line-277"></a>
<a name="line-278"></a><a name="disjointDVarSet"></a><span class='hs-comment'>-- | True if empty intersection</span>
<a name="line-279"></a><span class='hs-definition'>disjointDVarSet</span> <span class='hs-keyglyph'>::</span> <span class='hs-conid'>DVarSet</span> <span class='hs-keyglyph'>-&gt;</span> <span class='hs-conid'>DVarSet</span> <span class='hs-keyglyph'>-&gt;</span> <span class='hs-conid'>Bool</span>
<a name="line-280"></a><span class='hs-definition'>disjointDVarSet</span> <span class='hs-varid'>s1</span> <span class='hs-varid'>s2</span> <span class='hs-keyglyph'>=</span> <span class='hs-varid'>disjointUDFM</span> <span class='hs-layout'>(</span><span class='hs-varid'>getUniqDSet</span> <span class='hs-varid'>s1</span><span class='hs-layout'>)</span> <span class='hs-layout'>(</span><span class='hs-varid'>getUniqDSet</span> <span class='hs-varid'>s2</span><span class='hs-layout'>)</span>
<a name="line-281"></a>
<a name="line-282"></a><a name="intersectsDVarSet"></a><span class='hs-comment'>-- | True if non-empty intersection</span>
<a name="line-283"></a><span class='hs-definition'>intersectsDVarSet</span> <span class='hs-keyglyph'>::</span> <span class='hs-conid'>DVarSet</span> <span class='hs-keyglyph'>-&gt;</span> <span class='hs-conid'>DVarSet</span> <span class='hs-keyglyph'>-&gt;</span> <span class='hs-conid'>Bool</span>
<a name="line-284"></a><span class='hs-definition'>intersectsDVarSet</span> <span class='hs-varid'>s1</span> <span class='hs-varid'>s2</span> <span class='hs-keyglyph'>=</span> <span class='hs-varid'>not</span> <span class='hs-layout'>(</span><span class='hs-varid'>s1</span> <span class='hs-varop'>`disjointDVarSet`</span> <span class='hs-varid'>s2</span><span class='hs-layout'>)</span>
<a name="line-285"></a>
<a name="line-286"></a><a name="isEmptyDVarSet"></a><span class='hs-definition'>isEmptyDVarSet</span> <span class='hs-keyglyph'>::</span> <span class='hs-conid'>DVarSet</span> <span class='hs-keyglyph'>-&gt;</span> <span class='hs-conid'>Bool</span>
<a name="line-287"></a><span class='hs-definition'>isEmptyDVarSet</span> <span class='hs-keyglyph'>=</span> <span class='hs-varid'>isEmptyUniqDSet</span>
<a name="line-288"></a>
<a name="line-289"></a><a name="delDVarSet"></a><span class='hs-definition'>delDVarSet</span> <span class='hs-keyglyph'>::</span> <span class='hs-conid'>DVarSet</span> <span class='hs-keyglyph'>-&gt;</span> <span class='hs-conid'>Var</span> <span class='hs-keyglyph'>-&gt;</span> <span class='hs-conid'>DVarSet</span>
<a name="line-290"></a><span class='hs-definition'>delDVarSet</span> <span class='hs-keyglyph'>=</span> <span class='hs-varid'>delOneFromUniqDSet</span>
<a name="line-291"></a>
<a name="line-292"></a><a name="minusDVarSet"></a><span class='hs-definition'>minusDVarSet</span> <span class='hs-keyglyph'>::</span> <span class='hs-conid'>DVarSet</span> <span class='hs-keyglyph'>-&gt;</span> <span class='hs-conid'>DVarSet</span> <span class='hs-keyglyph'>-&gt;</span> <span class='hs-conid'>DVarSet</span>
<a name="line-293"></a><span class='hs-definition'>minusDVarSet</span> <span class='hs-keyglyph'>=</span> <span class='hs-varid'>minusUniqDSet</span>
<a name="line-294"></a>
<a name="line-295"></a><a name="dVarSetMinusVarSet"></a><span class='hs-definition'>dVarSetMinusVarSet</span> <span class='hs-keyglyph'>::</span> <span class='hs-conid'>DVarSet</span> <span class='hs-keyglyph'>-&gt;</span> <span class='hs-conid'>VarSet</span> <span class='hs-keyglyph'>-&gt;</span> <span class='hs-conid'>DVarSet</span>
<a name="line-296"></a><span class='hs-definition'>dVarSetMinusVarSet</span> <span class='hs-keyglyph'>=</span> <span class='hs-varid'>uniqDSetMinusUniqSet</span>
<a name="line-297"></a>
<a name="line-298"></a><a name="nonDetStrictFoldDVarSet"></a><span class='hs-comment'>-- See Note [Deterministic UniqFM] to learn about nondeterminism.</span>
<a name="line-299"></a><span class='hs-comment'>-- If you use this please provide a justification why it doesn't introduce</span>
<a name="line-300"></a><span class='hs-comment'>-- nondeterminism.</span>
<a name="line-301"></a><span class='hs-definition'>nonDetStrictFoldDVarSet</span> <span class='hs-keyglyph'>::</span> <span class='hs-layout'>(</span><span class='hs-conid'>Var</span> <span class='hs-keyglyph'>-&gt;</span> <span class='hs-varid'>a</span> <span class='hs-keyglyph'>-&gt;</span> <span class='hs-varid'>a</span><span class='hs-layout'>)</span> <span class='hs-keyglyph'>-&gt;</span> <span class='hs-varid'>a</span> <span class='hs-keyglyph'>-&gt;</span> <span class='hs-conid'>DVarSet</span> <span class='hs-keyglyph'>-&gt;</span> <span class='hs-varid'>a</span>
<a name="line-302"></a><span class='hs-definition'>nonDetStrictFoldDVarSet</span> <span class='hs-keyglyph'>=</span> <span class='hs-varid'>nonDetStrictFoldUniqDSet</span>
<a name="line-303"></a>
<a name="line-304"></a><a name="anyDVarSet"></a><span class='hs-definition'>anyDVarSet</span> <span class='hs-keyglyph'>::</span> <span class='hs-layout'>(</span><span class='hs-conid'>Var</span> <span class='hs-keyglyph'>-&gt;</span> <span class='hs-conid'>Bool</span><span class='hs-layout'>)</span> <span class='hs-keyglyph'>-&gt;</span> <span class='hs-conid'>DVarSet</span> <span class='hs-keyglyph'>-&gt;</span> <span class='hs-conid'>Bool</span>
<a name="line-305"></a><span class='hs-definition'>anyDVarSet</span> <span class='hs-varid'>p</span> <span class='hs-keyglyph'>=</span> <span class='hs-varid'>anyUDFM</span> <span class='hs-varid'>p</span> <span class='hs-varop'>.</span> <span class='hs-varid'>getUniqDSet</span>
<a name="line-306"></a>
<a name="line-307"></a><a name="allDVarSet"></a><span class='hs-definition'>allDVarSet</span> <span class='hs-keyglyph'>::</span> <span class='hs-layout'>(</span><span class='hs-conid'>Var</span> <span class='hs-keyglyph'>-&gt;</span> <span class='hs-conid'>Bool</span><span class='hs-layout'>)</span> <span class='hs-keyglyph'>-&gt;</span> <span class='hs-conid'>DVarSet</span> <span class='hs-keyglyph'>-&gt;</span> <span class='hs-conid'>Bool</span>
<a name="line-308"></a><span class='hs-definition'>allDVarSet</span> <span class='hs-varid'>p</span> <span class='hs-keyglyph'>=</span> <span class='hs-varid'>allUDFM</span> <span class='hs-varid'>p</span> <span class='hs-varop'>.</span> <span class='hs-varid'>getUniqDSet</span>
<a name="line-309"></a>
<a name="line-310"></a><a name="mapDVarSet"></a><span class='hs-definition'>mapDVarSet</span> <span class='hs-keyglyph'>::</span> <span class='hs-conid'>Uniquable</span> <span class='hs-varid'>b</span> <span class='hs-keyglyph'>=&gt;</span> <span class='hs-layout'>(</span><span class='hs-varid'>a</span> <span class='hs-keyglyph'>-&gt;</span> <span class='hs-varid'>b</span><span class='hs-layout'>)</span> <span class='hs-keyglyph'>-&gt;</span> <span class='hs-conid'>UniqDSet</span> <span class='hs-varid'>a</span> <span class='hs-keyglyph'>-&gt;</span> <span class='hs-conid'>UniqDSet</span> <span class='hs-varid'>b</span>
<a name="line-311"></a><span class='hs-definition'>mapDVarSet</span> <span class='hs-keyglyph'>=</span> <span class='hs-varid'>mapUniqDSet</span>
<a name="line-312"></a>
<a name="line-313"></a><a name="filterDVarSet"></a><span class='hs-definition'>filterDVarSet</span> <span class='hs-keyglyph'>::</span> <span class='hs-layout'>(</span><span class='hs-conid'>Var</span> <span class='hs-keyglyph'>-&gt;</span> <span class='hs-conid'>Bool</span><span class='hs-layout'>)</span> <span class='hs-keyglyph'>-&gt;</span> <span class='hs-conid'>DVarSet</span> <span class='hs-keyglyph'>-&gt;</span> <span class='hs-conid'>DVarSet</span>
<a name="line-314"></a><span class='hs-definition'>filterDVarSet</span> <span class='hs-keyglyph'>=</span> <span class='hs-varid'>filterUniqDSet</span>
<a name="line-315"></a>
<a name="line-316"></a><a name="sizeDVarSet"></a><span class='hs-definition'>sizeDVarSet</span> <span class='hs-keyglyph'>::</span> <span class='hs-conid'>DVarSet</span> <span class='hs-keyglyph'>-&gt;</span> <span class='hs-conid'>Int</span>
<a name="line-317"></a><span class='hs-definition'>sizeDVarSet</span> <span class='hs-keyglyph'>=</span> <span class='hs-varid'>sizeUniqDSet</span>
<a name="line-318"></a>
<a name="line-319"></a><a name="partitionDVarSet"></a><span class='hs-comment'>-- | Partition DVarSet according to the predicate given</span>
<a name="line-320"></a><span class='hs-definition'>partitionDVarSet</span> <span class='hs-keyglyph'>::</span> <span class='hs-layout'>(</span><span class='hs-conid'>Var</span> <span class='hs-keyglyph'>-&gt;</span> <span class='hs-conid'>Bool</span><span class='hs-layout'>)</span> <span class='hs-keyglyph'>-&gt;</span> <span class='hs-conid'>DVarSet</span> <span class='hs-keyglyph'>-&gt;</span> <span class='hs-layout'>(</span><span class='hs-conid'>DVarSet</span><span class='hs-layout'>,</span> <span class='hs-conid'>DVarSet</span><span class='hs-layout'>)</span>
<a name="line-321"></a><span class='hs-definition'>partitionDVarSet</span> <span class='hs-keyglyph'>=</span> <span class='hs-varid'>partitionUniqDSet</span>
<a name="line-322"></a>
<a name="line-323"></a><a name="delDVarSetList"></a><span class='hs-comment'>-- | Delete a list of variables from DVarSet</span>
<a name="line-324"></a><span class='hs-definition'>delDVarSetList</span> <span class='hs-keyglyph'>::</span> <span class='hs-conid'>DVarSet</span> <span class='hs-keyglyph'>-&gt;</span> <span class='hs-keyglyph'>[</span><span class='hs-conid'>Var</span><span class='hs-keyglyph'>]</span> <span class='hs-keyglyph'>-&gt;</span> <span class='hs-conid'>DVarSet</span>
<a name="line-325"></a><span class='hs-definition'>delDVarSetList</span> <span class='hs-keyglyph'>=</span> <span class='hs-varid'>delListFromUniqDSet</span>
<a name="line-326"></a>
<a name="line-327"></a><a name="seqDVarSet"></a><span class='hs-definition'>seqDVarSet</span> <span class='hs-keyglyph'>::</span> <span class='hs-conid'>DVarSet</span> <span class='hs-keyglyph'>-&gt;</span> <span class='hs-conid'>()</span>
<a name="line-328"></a><span class='hs-definition'>seqDVarSet</span> <span class='hs-varid'>s</span> <span class='hs-keyglyph'>=</span> <span class='hs-varid'>sizeDVarSet</span> <span class='hs-varid'>s</span> <span class='hs-varop'>`seq`</span> <span class='hs-conid'>()</span>
<a name="line-329"></a>
<a name="line-330"></a><a name="extendDVarSetList"></a><span class='hs-comment'>-- | Add a list of variables to DVarSet</span>
<a name="line-331"></a><span class='hs-definition'>extendDVarSetList</span> <span class='hs-keyglyph'>::</span> <span class='hs-conid'>DVarSet</span> <span class='hs-keyglyph'>-&gt;</span> <span class='hs-keyglyph'>[</span><span class='hs-conid'>Var</span><span class='hs-keyglyph'>]</span> <span class='hs-keyglyph'>-&gt;</span> <span class='hs-conid'>DVarSet</span>
<a name="line-332"></a><span class='hs-definition'>extendDVarSetList</span> <span class='hs-keyglyph'>=</span> <span class='hs-varid'>addListToUniqDSet</span>
<a name="line-333"></a>
<a name="line-334"></a><a name="dVarSetToVarSet"></a><span class='hs-comment'>-- | Convert a DVarSet to a VarSet by forgetting the order of insertion</span>
<a name="line-335"></a><span class='hs-definition'>dVarSetToVarSet</span> <span class='hs-keyglyph'>::</span> <span class='hs-conid'>DVarSet</span> <span class='hs-keyglyph'>-&gt;</span> <span class='hs-conid'>VarSet</span>
<a name="line-336"></a><span class='hs-definition'>dVarSetToVarSet</span> <span class='hs-keyglyph'>=</span> <span class='hs-varid'>unsafeUFMToUniqSet</span> <span class='hs-varop'>.</span> <span class='hs-varid'>udfmToUfm</span> <span class='hs-varop'>.</span> <span class='hs-varid'>getUniqDSet</span>
<a name="line-337"></a>
<a name="line-338"></a><a name="transCloDVarSet"></a><span class='hs-comment'>-- | transCloVarSet for DVarSet</span>
<a name="line-339"></a><span class='hs-definition'>transCloDVarSet</span> <span class='hs-keyglyph'>::</span> <span class='hs-layout'>(</span><span class='hs-conid'>DVarSet</span> <span class='hs-keyglyph'>-&gt;</span> <span class='hs-conid'>DVarSet</span><span class='hs-layout'>)</span>
<a name="line-340"></a>                  <span class='hs-comment'>-- Map some variables in the set to</span>
<a name="line-341"></a>                  <span class='hs-comment'>-- extra variables that should be in it</span>
<a name="line-342"></a>                <span class='hs-keyglyph'>-&gt;</span> <span class='hs-conid'>DVarSet</span> <span class='hs-keyglyph'>-&gt;</span> <span class='hs-conid'>DVarSet</span>
<a name="line-343"></a><span class='hs-comment'>-- (transCloDVarSet f s) repeatedly applies f to new candidates, adding any</span>
<a name="line-344"></a><span class='hs-comment'>-- new variables to s that it finds thereby, until it reaches a fixed point.</span>
<a name="line-345"></a><span class='hs-comment'>--</span>
<a name="line-346"></a><span class='hs-comment'>-- The function fn could be (Var -&gt; DVarSet), but we use (DVarSet -&gt; DVarSet)</span>
<a name="line-347"></a><span class='hs-comment'>-- for efficiency, so that the test can be batched up.</span>
<a name="line-348"></a><span class='hs-comment'>-- It's essential that fn will work fine if given new candidates</span>
<a name="line-349"></a><span class='hs-comment'>-- one at a time; ie  fn {v1,v2} = fn v1 `union` fn v2</span>
<a name="line-350"></a><span class='hs-definition'>transCloDVarSet</span> <span class='hs-varid'>fn</span> <span class='hs-varid'>seeds</span>
<a name="line-351"></a>  <span class='hs-keyglyph'>=</span> <span class='hs-varid'>go</span> <span class='hs-varid'>seeds</span> <span class='hs-varid'>seeds</span>
<a name="line-352"></a>  <span class='hs-keyword'>where</span>
<a name="line-353"></a>    <span class='hs-varid'>go</span> <span class='hs-keyglyph'>::</span> <span class='hs-conid'>DVarSet</span>  <span class='hs-comment'>-- Accumulating result</span>
<a name="line-354"></a>       <span class='hs-keyglyph'>-&gt;</span> <span class='hs-conid'>DVarSet</span>  <span class='hs-comment'>-- Work-list; un-processed subset of accumulating result</span>
<a name="line-355"></a>       <span class='hs-keyglyph'>-&gt;</span> <span class='hs-conid'>DVarSet</span>
<a name="line-356"></a>    <span class='hs-comment'>-- Specification: go acc vs = acc `union` transClo fn vs</span>
<a name="line-357"></a>
<a name="line-358"></a>    <span class='hs-varid'>go</span> <span class='hs-varid'>acc</span> <span class='hs-varid'>candidates</span>
<a name="line-359"></a>       <span class='hs-keyglyph'>|</span> <span class='hs-varid'>isEmptyDVarSet</span> <span class='hs-varid'>new_vs</span> <span class='hs-keyglyph'>=</span> <span class='hs-varid'>acc</span>
<a name="line-360"></a>       <span class='hs-keyglyph'>|</span> <span class='hs-varid'>otherwise</span>            <span class='hs-keyglyph'>=</span> <span class='hs-varid'>go</span> <span class='hs-layout'>(</span><span class='hs-varid'>acc</span> <span class='hs-varop'>`unionDVarSet`</span> <span class='hs-varid'>new_vs</span><span class='hs-layout'>)</span> <span class='hs-varid'>new_vs</span>
<a name="line-361"></a>       <span class='hs-keyword'>where</span>
<a name="line-362"></a>         <span class='hs-varid'>new_vs</span> <span class='hs-keyglyph'>=</span> <span class='hs-varid'>fn</span> <span class='hs-varid'>candidates</span> <span class='hs-varop'>`minusDVarSet`</span> <span class='hs-varid'>acc</span>
</pre></body>
</html>
