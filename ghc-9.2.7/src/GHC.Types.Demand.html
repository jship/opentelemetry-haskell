<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd"><html xmlns="http://www.w3.org/1999/xhtml"><head><link rel="stylesheet" type="text/css" href="style.css" /><script type="text/javascript" src="highlight.js"></script></head><body><pre><span class="hs-pragma">{-# LANGUAGE CPP          #-}</span><span>
</span><span id="line-2"></span><span class="hs-pragma">{-# LANGUAGE ViewPatterns #-}</span><span>
</span><span id="line-3"></span><span>
</span><span id="line-4"></span><span class="hs-pragma">{-# OPTIONS_GHC -Wno-incomplete-uni-patterns #-}</span><span>
</span><span id="line-5"></span><span>
</span><span id="line-6"></span><span class="hs-comment">{-
(c) The University of Glasgow 2006
(c) The GRASP/AQUA Project, Glasgow University, 1992-1998
-}</span><span>
</span><span id="line-10"></span><span>
</span><span id="line-11"></span><span class="hs-comment">-- | A language to express the evaluation context of an expression as a</span><span>
</span><span id="line-12"></span><span class="hs-comment">-- 'Demand' and track how an expression evaluates free variables and arguments</span><span>
</span><span id="line-13"></span><span class="hs-comment">-- in turn as a 'DmdType'.</span><span>
</span><span id="line-14"></span><span class="hs-comment">--</span><span>
</span><span id="line-15"></span><span class="hs-comment">-- Lays out the abstract domain for &quot;GHC.Core.Opt.DmdAnal&quot;.</span><span>
</span><span id="line-16"></span><span class="hs-keyword">module</span><span> </span><span class="hs-identifier">GHC.Types.Demand</span><span> </span><span class="hs-special">(</span><span>
</span><span id="line-17"></span><span>    </span><span class="annot"><span class="hs-comment">-- * Demands</span></span><span>
</span><span id="line-18"></span><span>    </span><span class="annot"><a href="GHC.Types.Demand.html#Card"><span class="hs-identifier">Card</span></a></span><span class="hs-special">(</span><span class="hs-glyph">..</span><span class="hs-special">)</span><span class="hs-special">,</span><span> </span><span class="annot"><a href="GHC.Types.Demand.html#Demand"><span class="hs-identifier">Demand</span></a></span><span class="hs-special">(</span><span class="hs-glyph">..</span><span class="hs-special">)</span><span class="hs-special">,</span><span> </span><span class="annot"><a href="GHC.Types.Demand.html#SubDemand"><span class="hs-identifier">SubDemand</span></a></span><span class="hs-special">(</span><span class="annot"><a href="GHC.Types.Demand.html#Prod"><span class="hs-identifier">Prod</span></a></span><span class="hs-special">)</span><span class="hs-special">,</span><span> </span><span class="annot"><a href="GHC.Types.Demand.html#mkProd"><span class="hs-identifier">mkProd</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><a href="GHC.Types.Demand.html#viewProd"><span class="hs-identifier">viewProd</span></a></span><span class="hs-special">,</span><span>
</span><span id="line-19"></span><span>    </span><span class="annot"><span class="hs-comment">-- ** Algebra</span></span><span>
</span><span id="line-20"></span><span>    </span><span class="annot"><a href="GHC.Types.Demand.html#absDmd"><span class="hs-identifier">absDmd</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><a href="GHC.Types.Demand.html#topDmd"><span class="hs-identifier">topDmd</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><a href="GHC.Types.Demand.html#botDmd"><span class="hs-identifier">botDmd</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><a href="GHC.Types.Demand.html#seqDmd"><span class="hs-identifier">seqDmd</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><a href="GHC.Types.Demand.html#topSubDmd"><span class="hs-identifier">topSubDmd</span></a></span><span class="hs-special">,</span><span>
</span><span id="line-21"></span><span>    </span><span class="annot"><span class="hs-comment">-- *** Least upper bound</span></span><span>
</span><span id="line-22"></span><span>    </span><span class="annot"><a href="GHC.Types.Demand.html#lubCard"><span class="hs-identifier">lubCard</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><a href="GHC.Types.Demand.html#lubDmd"><span class="hs-identifier">lubDmd</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><a href="GHC.Types.Demand.html#lubSubDmd"><span class="hs-identifier">lubSubDmd</span></a></span><span class="hs-special">,</span><span>
</span><span id="line-23"></span><span>    </span><span class="annot"><span class="hs-comment">-- *** Plus</span></span><span>
</span><span id="line-24"></span><span>    </span><span class="annot"><a href="GHC.Types.Demand.html#plusCard"><span class="hs-identifier">plusCard</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><a href="GHC.Types.Demand.html#plusDmd"><span class="hs-identifier">plusDmd</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><a href="GHC.Types.Demand.html#plusSubDmd"><span class="hs-identifier">plusSubDmd</span></a></span><span class="hs-special">,</span><span>
</span><span id="line-25"></span><span>    </span><span class="annot"><span class="hs-comment">-- *** Multiply</span></span><span>
</span><span id="line-26"></span><span>    </span><span class="annot"><a href="GHC.Types.Demand.html#multCard"><span class="hs-identifier">multCard</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><a href="GHC.Types.Demand.html#multDmd"><span class="hs-identifier">multDmd</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><a href="GHC.Types.Demand.html#multSubDmd"><span class="hs-identifier">multSubDmd</span></a></span><span class="hs-special">,</span><span>
</span><span id="line-27"></span><span>    </span><span class="annot"><span class="hs-comment">-- ** Predicates on @Card@inalities and @Demand@s</span></span><span>
</span><span id="line-28"></span><span>    </span><span class="annot"><a href="GHC.Types.Demand.html#isAbs"><span class="hs-identifier">isAbs</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><a href="GHC.Types.Demand.html#isUsedOnce"><span class="hs-identifier">isUsedOnce</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><a href="GHC.Types.Demand.html#isStrict"><span class="hs-identifier">isStrict</span></a></span><span class="hs-special">,</span><span>
</span><span id="line-29"></span><span>    </span><span class="annot"><a href="GHC.Types.Demand.html#isAbsDmd"><span class="hs-identifier">isAbsDmd</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><a href="GHC.Types.Demand.html#isUsedOnceDmd"><span class="hs-identifier">isUsedOnceDmd</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><a href="GHC.Types.Demand.html#isStrUsedDmd"><span class="hs-identifier">isStrUsedDmd</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><a href="GHC.Types.Demand.html#isStrictDmd"><span class="hs-identifier">isStrictDmd</span></a></span><span class="hs-special">,</span><span>
</span><span id="line-30"></span><span>    </span><span class="annot"><a href="GHC.Types.Demand.html#isTopDmd"><span class="hs-identifier">isTopDmd</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><a href="GHC.Types.Demand.html#isSeqDmd"><span class="hs-identifier">isSeqDmd</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><a href="GHC.Types.Demand.html#isWeakDmd"><span class="hs-identifier">isWeakDmd</span></a></span><span class="hs-special">,</span><span>
</span><span id="line-31"></span><span>    </span><span class="annot"><span class="hs-comment">-- ** Special demands</span></span><span>
</span><span id="line-32"></span><span>    </span><span class="annot"><a href="GHC.Types.Demand.html#evalDmd"><span class="hs-identifier">evalDmd</span></a></span><span class="hs-special">,</span><span>
</span><span id="line-33"></span><span>    </span><span class="annot"><span class="hs-comment">-- *** Demands used in PrimOp signatures</span></span><span>
</span><span id="line-34"></span><span>    </span><span class="annot"><a href="GHC.Types.Demand.html#lazyApply1Dmd"><span class="hs-identifier">lazyApply1Dmd</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><a href="GHC.Types.Demand.html#lazyApply2Dmd"><span class="hs-identifier">lazyApply2Dmd</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><a href="GHC.Types.Demand.html#strictOnceApply1Dmd"><span class="hs-identifier">strictOnceApply1Dmd</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><a href="GHC.Types.Demand.html#strictManyApply1Dmd"><span class="hs-identifier">strictManyApply1Dmd</span></a></span><span class="hs-special">,</span><span>
</span><span id="line-35"></span><span>    </span><span class="annot"><span class="hs-comment">-- ** Other @Demand@ operations</span></span><span>
</span><span id="line-36"></span><span>    </span><span class="annot"><a href="GHC.Types.Demand.html#oneifyCard"><span class="hs-identifier">oneifyCard</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><a href="GHC.Types.Demand.html#oneifyDmd"><span class="hs-identifier">oneifyDmd</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><a href="GHC.Types.Demand.html#strictifyDmd"><span class="hs-identifier">strictifyDmd</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><a href="GHC.Types.Demand.html#strictifyDictDmd"><span class="hs-identifier">strictifyDictDmd</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><a href="GHC.Types.Demand.html#mkWorkerDemand"><span class="hs-identifier">mkWorkerDemand</span></a></span><span class="hs-special">,</span><span>
</span><span id="line-37"></span><span>    </span><span class="annot"><a href="GHC.Types.Demand.html#peelCallDmd"><span class="hs-identifier">peelCallDmd</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><a href="GHC.Types.Demand.html#peelManyCalls"><span class="hs-identifier">peelManyCalls</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><a href="GHC.Types.Demand.html#mkCalledOnceDmd"><span class="hs-identifier">mkCalledOnceDmd</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><a href="GHC.Types.Demand.html#mkCalledOnceDmds"><span class="hs-identifier">mkCalledOnceDmds</span></a></span><span class="hs-special">,</span><span>
</span><span id="line-38"></span><span>    </span><span class="annot"><a href="GHC.Types.Demand.html#addCaseBndrDmd"><span class="hs-identifier">addCaseBndrDmd</span></a></span><span class="hs-special">,</span><span>
</span><span id="line-39"></span><span>    </span><span class="annot"><span class="hs-comment">-- ** Extracting one-shot information</span></span><span>
</span><span id="line-40"></span><span>    </span><span class="annot"><a href="GHC.Types.Demand.html#argOneShots"><span class="hs-identifier">argOneShots</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><a href="GHC.Types.Demand.html#argsOneShots"><span class="hs-identifier">argsOneShots</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><a href="GHC.Types.Demand.html#saturatedByOneShots"><span class="hs-identifier">saturatedByOneShots</span></a></span><span class="hs-special">,</span><span>
</span><span id="line-41"></span><span>
</span><span id="line-42"></span><span>    </span><span class="annot"><span class="hs-comment">-- * Demand environments</span></span><span>
</span><span id="line-43"></span><span>    </span><span class="annot"><a href="GHC.Types.Demand.html#DmdEnv"><span class="hs-identifier">DmdEnv</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><a href="GHC.Types.Demand.html#emptyDmdEnv"><span class="hs-identifier">emptyDmdEnv</span></a></span><span class="hs-special">,</span><span>
</span><span id="line-44"></span><span>    </span><span class="annot"><a href="GHC.Types.Demand.html#keepAliveDmdEnv"><span class="hs-identifier">keepAliveDmdEnv</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><a href="GHC.Types.Demand.html#reuseEnv"><span class="hs-identifier">reuseEnv</span></a></span><span class="hs-special">,</span><span>
</span><span id="line-45"></span><span>
</span><span id="line-46"></span><span>    </span><span class="annot"><span class="hs-comment">-- * Divergence</span></span><span>
</span><span id="line-47"></span><span>    </span><span class="annot"><a href="GHC.Types.Demand.html#Divergence"><span class="hs-identifier">Divergence</span></a></span><span class="hs-special">(</span><span class="hs-glyph">..</span><span class="hs-special">)</span><span class="hs-special">,</span><span> </span><span class="annot"><a href="GHC.Types.Demand.html#topDiv"><span class="hs-identifier">topDiv</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><a href="GHC.Types.Demand.html#botDiv"><span class="hs-identifier">botDiv</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><a href="GHC.Types.Demand.html#exnDiv"><span class="hs-identifier">exnDiv</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><a href="GHC.Types.Demand.html#lubDivergence"><span class="hs-identifier">lubDivergence</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><a href="GHC.Types.Demand.html#isDeadEndDiv"><span class="hs-identifier">isDeadEndDiv</span></a></span><span class="hs-special">,</span><span>
</span><span id="line-48"></span><span>
</span><span id="line-49"></span><span>    </span><span class="annot"><span class="hs-comment">-- * Demand types</span></span><span>
</span><span id="line-50"></span><span>    </span><span class="annot"><a href="GHC.Types.Demand.html#DmdType"><span class="hs-identifier">DmdType</span></a></span><span class="hs-special">(</span><span class="hs-glyph">..</span><span class="hs-special">)</span><span class="hs-special">,</span><span> </span><span class="annot"><a href="GHC.Types.Demand.html#dmdTypeDepth"><span class="hs-identifier">dmdTypeDepth</span></a></span><span class="hs-special">,</span><span>
</span><span id="line-51"></span><span>    </span><span class="annot"><span class="hs-comment">-- ** Algebra</span></span><span>
</span><span id="line-52"></span><span>    </span><span class="annot"><a href="GHC.Types.Demand.html#nopDmdType"><span class="hs-identifier">nopDmdType</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><a href="GHC.Types.Demand.html#botDmdType"><span class="hs-identifier">botDmdType</span></a></span><span class="hs-special">,</span><span>
</span><span id="line-53"></span><span>    </span><span class="annot"><a href="GHC.Types.Demand.html#lubDmdType"><span class="hs-identifier">lubDmdType</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><a href="GHC.Types.Demand.html#plusDmdType"><span class="hs-identifier">plusDmdType</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><a href="GHC.Types.Demand.html#multDmdType"><span class="hs-identifier">multDmdType</span></a></span><span class="hs-special">,</span><span>
</span><span id="line-54"></span><span>    </span><span class="annot"><span class="hs-comment">-- *** PlusDmdArg</span></span><span>
</span><span id="line-55"></span><span>    </span><span class="annot"><a href="GHC.Types.Demand.html#PlusDmdArg"><span class="hs-identifier">PlusDmdArg</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><a href="GHC.Types.Demand.html#mkPlusDmdArg"><span class="hs-identifier">mkPlusDmdArg</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><a href="GHC.Types.Demand.html#toPlusDmdArg"><span class="hs-identifier">toPlusDmdArg</span></a></span><span class="hs-special">,</span><span>
</span><span id="line-56"></span><span>    </span><span class="annot"><span class="hs-comment">-- ** Other operations</span></span><span>
</span><span id="line-57"></span><span>    </span><span class="annot"><a href="GHC.Types.Demand.html#peelFV"><span class="hs-identifier">peelFV</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><a href="GHC.Types.Demand.html#findIdDemand"><span class="hs-identifier">findIdDemand</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><a href="GHC.Types.Demand.html#addDemand"><span class="hs-identifier">addDemand</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><a href="GHC.Types.Demand.html#splitDmdTy"><span class="hs-identifier">splitDmdTy</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><a href="GHC.Types.Demand.html#deferAfterPreciseException"><span class="hs-identifier">deferAfterPreciseException</span></a></span><span class="hs-special">,</span><span>
</span><span id="line-58"></span><span>    </span><span class="annot"><a href="GHC.Types.Demand.html#keepAliveDmdType"><span class="hs-identifier">keepAliveDmdType</span></a></span><span class="hs-special">,</span><span>
</span><span id="line-59"></span><span>
</span><span id="line-60"></span><span>    </span><span class="annot"><span class="hs-comment">-- * Demand signatures</span></span><span>
</span><span id="line-61"></span><span>    </span><span class="annot"><a href="GHC.Types.Demand.html#StrictSig"><span class="hs-identifier">StrictSig</span></a></span><span class="hs-special">(</span><span class="hs-glyph">..</span><span class="hs-special">)</span><span class="hs-special">,</span><span> </span><span class="annot"><a href="GHC.Types.Demand.html#mkStrictSigForArity"><span class="hs-identifier">mkStrictSigForArity</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><a href="GHC.Types.Demand.html#mkClosedStrictSig"><span class="hs-identifier">mkClosedStrictSig</span></a></span><span class="hs-special">,</span><span>
</span><span id="line-62"></span><span>    </span><span class="annot"><a href="GHC.Types.Demand.html#splitStrictSig"><span class="hs-identifier">splitStrictSig</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><a href="GHC.Types.Demand.html#strictSigDmdEnv"><span class="hs-identifier">strictSigDmdEnv</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><a href="GHC.Types.Demand.html#hasDemandEnvSig"><span class="hs-identifier">hasDemandEnvSig</span></a></span><span class="hs-special">,</span><span>
</span><span id="line-63"></span><span>    </span><span class="annot"><a href="GHC.Types.Demand.html#nopSig"><span class="hs-identifier">nopSig</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><a href="GHC.Types.Demand.html#botSig"><span class="hs-identifier">botSig</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><a href="GHC.Types.Demand.html#isTopSig"><span class="hs-identifier">isTopSig</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><a href="GHC.Types.Demand.html#isDeadEndSig"><span class="hs-identifier">isDeadEndSig</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><a href="GHC.Types.Demand.html#isDeadEndAppSig"><span class="hs-identifier">isDeadEndAppSig</span></a></span><span class="hs-special">,</span><span>
</span><span id="line-64"></span><span>    </span><span class="annot"><span class="hs-comment">-- ** Handling arity adjustments</span></span><span>
</span><span id="line-65"></span><span>    </span><span class="annot"><a href="GHC.Types.Demand.html#prependArgsStrictSig"><span class="hs-identifier">prependArgsStrictSig</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><a href="GHC.Types.Demand.html#etaConvertStrictSig"><span class="hs-identifier">etaConvertStrictSig</span></a></span><span class="hs-special">,</span><span>
</span><span id="line-66"></span><span>
</span><span id="line-67"></span><span>    </span><span class="annot"><span class="hs-comment">-- * Demand transformers from demand signatures</span></span><span>
</span><span id="line-68"></span><span>    </span><span class="annot"><a href="GHC.Types.Demand.html#DmdTransformer"><span class="hs-identifier">DmdTransformer</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><a href="GHC.Types.Demand.html#dmdTransformSig"><span class="hs-identifier">dmdTransformSig</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><a href="GHC.Types.Demand.html#dmdTransformDataConSig"><span class="hs-identifier">dmdTransformDataConSig</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><a href="GHC.Types.Demand.html#dmdTransformDictSelSig"><span class="hs-identifier">dmdTransformDictSelSig</span></a></span><span class="hs-special">,</span><span>
</span><span id="line-69"></span><span>
</span><span id="line-70"></span><span>    </span><span class="annot"><span class="hs-comment">-- * Trim to a type shape</span></span><span>
</span><span id="line-71"></span><span>    </span><span class="annot"><a href="GHC.Types.Demand.html#TypeShape"><span class="hs-identifier">TypeShape</span></a></span><span class="hs-special">(</span><span class="hs-glyph">..</span><span class="hs-special">)</span><span class="hs-special">,</span><span> </span><span class="annot"><a href="GHC.Types.Demand.html#trimToType"><span class="hs-identifier">trimToType</span></a></span><span class="hs-special">,</span><span>
</span><span id="line-72"></span><span>
</span><span id="line-73"></span><span>    </span><span class="annot"><span class="hs-comment">-- * @seq@ing stuff</span></span><span>
</span><span id="line-74"></span><span>    </span><span class="annot"><a href="GHC.Types.Demand.html#seqDemand"><span class="hs-identifier">seqDemand</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><a href="GHC.Types.Demand.html#seqDemandList"><span class="hs-identifier">seqDemandList</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><a href="GHC.Types.Demand.html#seqDmdType"><span class="hs-identifier">seqDmdType</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><a href="GHC.Types.Demand.html#seqStrictSig"><span class="hs-identifier">seqStrictSig</span></a></span><span class="hs-special">,</span><span>
</span><span id="line-75"></span><span>
</span><span id="line-76"></span><span>    </span><span class="annot"><span class="hs-comment">-- * Zapping usage information</span></span><span>
</span><span id="line-77"></span><span>    </span><span class="annot"><a href="GHC.Types.Demand.html#zapUsageDemand"><span class="hs-identifier">zapUsageDemand</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><a href="GHC.Types.Demand.html#zapDmdEnvSig"><span class="hs-identifier">zapDmdEnvSig</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><a href="GHC.Types.Demand.html#zapUsedOnceDemand"><span class="hs-identifier">zapUsedOnceDemand</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><a href="GHC.Types.Demand.html#zapUsedOnceSig"><span class="hs-identifier">zapUsedOnceSig</span></a></span><span>
</span><span id="line-78"></span><span>  </span><span class="hs-special">)</span><span> </span><span class="hs-keyword">where</span><span class="hs-cpp">

#include &quot;HsVersions.h&quot;
</span><span>
</span><span id="line-82"></span><span class="hs-keyword">import</span><span> </span><span class="annot"><a href="GHC.Prelude.html"><span class="hs-identifier">GHC.Prelude</span></a></span><span>
</span><span id="line-83"></span><span>
</span><span id="line-84"></span><span class="hs-keyword">import</span><span> </span><span class="annot"><a href="GHC.Types.Var.html"><span class="hs-identifier">GHC.Types.Var</span></a></span><span> </span><span class="hs-special">(</span><span> </span><span class="annot"><a href="GHC.Types.Var.html#Var"><span class="hs-identifier">Var</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><a href="GHC.Types.Var.html#Id"><span class="hs-identifier">Id</span></a></span><span> </span><span class="hs-special">)</span><span>
</span><span id="line-85"></span><span class="hs-keyword">import</span><span> </span><span class="annot"><a href="GHC.Types.Var.Env.html"><span class="hs-identifier">GHC.Types.Var.Env</span></a></span><span>
</span><span id="line-86"></span><span class="hs-keyword">import</span><span> </span><span class="annot"><a href="GHC.Types.Var.Set.html"><span class="hs-identifier">GHC.Types.Var.Set</span></a></span><span>
</span><span id="line-87"></span><span class="hs-keyword">import</span><span> </span><span class="annot"><a href="GHC.Types.Unique.FM.html"><span class="hs-identifier">GHC.Types.Unique.FM</span></a></span><span>
</span><span id="line-88"></span><span class="hs-keyword">import</span><span> </span><span class="annot"><a href="GHC.Types.Basic.html"><span class="hs-identifier">GHC.Types.Basic</span></a></span><span>
</span><span id="line-89"></span><span class="hs-keyword">import</span><span> </span><span class="annot"><a href="GHC.Data.Maybe.html"><span class="hs-identifier">GHC.Data.Maybe</span></a></span><span>   </span><span class="hs-special">(</span><span> </span><span class="annot"><a href="GHC.Data.Maybe.html#orElse"><span class="hs-identifier">orElse</span></a></span><span> </span><span class="hs-special">)</span><span>
</span><span id="line-90"></span><span>
</span><span id="line-91"></span><span class="hs-keyword">import</span><span> </span><span class="annot"><a href="GHC.Core.Type.html"><span class="hs-identifier">GHC.Core.Type</span></a></span><span>    </span><span class="hs-special">(</span><span> </span><span class="annot"><a href="GHC.Core.TyCo.Rep.html#Type"><span class="hs-identifier">Type</span></a></span><span> </span><span class="hs-special">)</span><span>
</span><span id="line-92"></span><span class="hs-keyword">import</span><span> </span><span class="annot"><a href="GHC.Core.TyCon.html"><span class="hs-identifier">GHC.Core.TyCon</span></a></span><span>   </span><span class="hs-special">(</span><span> </span><span class="annot"><a href="GHC.Core.TyCon.html#isNewTyCon"><span class="hs-identifier">isNewTyCon</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><a href="GHC.Core.TyCon.html#isClassTyCon"><span class="hs-identifier">isClassTyCon</span></a></span><span> </span><span class="hs-special">)</span><span>
</span><span id="line-93"></span><span class="hs-keyword">import</span><span> </span><span class="annot"><a href="GHC.Core.DataCon.html"><span class="hs-identifier">GHC.Core.DataCon</span></a></span><span> </span><span class="hs-special">(</span><span> </span><span class="annot"><a href="GHC.Core.DataCon.html#splitDataProductType_maybe"><span class="hs-identifier">splitDataProductType_maybe</span></a></span><span> </span><span class="hs-special">)</span><span>
</span><span id="line-94"></span><span class="hs-keyword">import</span><span> </span><span class="annot"><a href="GHC.Core.Multiplicity.html"><span class="hs-identifier">GHC.Core.Multiplicity</span></a></span><span>    </span><span class="hs-special">(</span><span> </span><span class="annot"><a href="GHC.Core.TyCo.Rep.html#scaledThing"><span class="hs-identifier">scaledThing</span></a></span><span> </span><span class="hs-special">)</span><span>
</span><span id="line-95"></span><span>
</span><span id="line-96"></span><span class="hs-keyword">import</span><span> </span><span class="annot"><a href="GHC.Utils.Binary.html"><span class="hs-identifier">GHC.Utils.Binary</span></a></span><span>
</span><span id="line-97"></span><span class="hs-keyword">import</span><span> </span><span class="annot"><a href="GHC.Utils.Misc.html"><span class="hs-identifier">GHC.Utils.Misc</span></a></span><span>
</span><span id="line-98"></span><span class="hs-keyword">import</span><span> </span><span class="annot"><a href="GHC.Utils.Outputable.html"><span class="hs-identifier">GHC.Utils.Outputable</span></a></span><span>
</span><span id="line-99"></span><span class="hs-keyword">import</span><span> </span><span class="annot"><a href="GHC.Utils.Panic.html"><span class="hs-identifier">GHC.Utils.Panic</span></a></span><span>
</span><span id="line-100"></span><span>
</span><span id="line-101"></span><span class="hs-comment">{-
************************************************************************
*                                                                      *
           Card: Combining Strictness and Usage
*                                                                      *
************************************************************************
-}</span><span>
</span><span id="line-108"></span><span>
</span><span id="line-109"></span><span class="hs-comment">{- Note [Evaluation cardinalities]
~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~
The demand analyser uses an /evaluation cardinality/ of type Card,
to specify how many times a term is evaluated.  A cardinality C_lu
represents an /interval/ [l..u], meaning
    C_lu means evaluated /at least/ 'l' times and
                         /at most/  'u' times

* The lower bound corresponds to /strictness/
  Hence 'l' is either 0 (lazy)
                   or 1 (strict)

* The upper bound corresponds to /usage/
  Hence 'u' is either 0 (not used at all),
                   or 1 (used at most once)
                   or n (no information)

Intervals describe sets, so the underlying lattice is the powerset lattice.

Usually l&lt;=u, but we also have C_10, the interval [1,0], the empty interval,
denoting the empty set.   This is the bottom element of the lattice.

See Note [Demand notation] for the notation we use for each of the constructors.
-}</span><span>
</span><span id="line-133"></span><span>
</span><span id="line-134"></span><span>
</span><span id="line-135"></span><span class="hs-comment">-- | Describes an interval of /evaluation cardinalities/.</span><span>
</span><span id="line-136"></span><span class="hs-comment">-- See Note [Evaluation cardinalities]</span><span>
</span><span id="line-137"></span><span class="hs-keyword">data</span><span> </span><span id="Card"><span class="annot"><a href="GHC.Types.Demand.html#Card"><span class="hs-identifier hs-var">Card</span></a></span></span><span>
</span><span id="line-138"></span><span>  </span><span class="hs-glyph">=</span><span> </span><span id="C_00"><span class="annot"><a href="GHC.Types.Demand.html#C_00"><span class="hs-identifier hs-var">C_00</span></a></span></span><span> </span><span class="hs-comment">-- ^ {0}     Absent.</span><span>
</span><span id="line-139"></span><span>  </span><span class="hs-glyph">|</span><span> </span><span id="C_01"><span class="annot"><a href="GHC.Types.Demand.html#C_01"><span class="hs-identifier hs-var">C_01</span></a></span></span><span> </span><span class="hs-comment">-- ^ {0,1}   Used at most once.</span><span>
</span><span id="line-140"></span><span>  </span><span class="hs-glyph">|</span><span> </span><span id="C_0N"><span class="annot"><a href="GHC.Types.Demand.html#C_0N"><span class="hs-identifier hs-var">C_0N</span></a></span></span><span> </span><span class="hs-comment">-- ^ {0,1,n} Every possible cardinality; the top element.</span><span>
</span><span id="line-141"></span><span>  </span><span class="hs-glyph">|</span><span> </span><span id="C_11"><span class="annot"><a href="GHC.Types.Demand.html#C_11"><span class="hs-identifier hs-var">C_11</span></a></span></span><span> </span><span class="hs-comment">-- ^ {1}     Strict and used once.</span><span>
</span><span id="line-142"></span><span>  </span><span class="hs-glyph">|</span><span> </span><span id="C_1N"><span class="annot"><a href="GHC.Types.Demand.html#C_1N"><span class="hs-identifier hs-var">C_1N</span></a></span></span><span> </span><span class="hs-comment">-- ^ {1,n}   Strict and used (possibly) many times.</span><span>
</span><span id="line-143"></span><span>  </span><span class="hs-glyph">|</span><span> </span><span id="C_10"><span class="annot"><a href="GHC.Types.Demand.html#C_10"><span class="hs-identifier hs-var">C_10</span></a></span></span><span> </span><span class="hs-comment">-- ^ {}      The empty interval; the bottom element of the lattice.</span><span>
</span><span id="line-144"></span><span>  </span><span class="hs-keyword">deriving</span><span> </span><span id="local-6989586621680990957"><span id="local-6989586621680990959"><span class="annot"><span class="annottext">Card -&gt; Card -&gt; Bool
forall a. (a -&gt; a -&gt; Bool) -&gt; (a -&gt; a -&gt; Bool) -&gt; Eq a
/= :: Card -&gt; Card -&gt; Bool
$c/= :: Card -&gt; Card -&gt; Bool
== :: Card -&gt; Card -&gt; Bool
$c== :: Card -&gt; Card -&gt; Bool
</span><span class="hs-identifier hs-var hs-var hs-var hs-var hs-var hs-var">Eq</span></span></span></span><span>
</span><span id="line-145"></span><span>
</span><span id="line-146"></span><span class="annot"><a href="GHC.Types.Demand.html#_botCard"><span class="hs-identifier hs-type">_botCard</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><a href="GHC.Types.Demand.html#topCard"><span class="hs-identifier hs-type">topCard</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><a href="GHC.Types.Demand.html#Card"><span class="hs-identifier hs-type">Card</span></a></span><span>
</span><span id="line-147"></span><span id="_botCard"><span class="annot"><span class="annottext">_botCard :: Card
</span><a href="GHC.Types.Demand.html#_botCard"><span class="hs-identifier hs-var hs-var">_botCard</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">Card
</span><a href="GHC.Types.Demand.html#C_10"><span class="hs-identifier hs-var">C_10</span></a></span><span>
</span><span id="line-148"></span><span id="topCard"><span class="annot"><span class="annottext">topCard :: Card
</span><a href="GHC.Types.Demand.html#topCard"><span class="hs-identifier hs-var hs-var">topCard</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">Card
</span><a href="GHC.Types.Demand.html#C_0N"><span class="hs-identifier hs-var">C_0N</span></a></span><span>
</span><span id="line-149"></span><span>
</span><span id="line-150"></span><span class="hs-comment">-- | True &lt;=&gt; lower bound is 1.</span><span>
</span><span id="line-151"></span><span class="annot"><a href="GHC.Types.Demand.html#isStrict"><span class="hs-identifier hs-type">isStrict</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><a href="GHC.Types.Demand.html#Card"><span class="hs-identifier hs-type">Card</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="hs-identifier hs-type">Bool</span></span><span>
</span><span id="line-152"></span><span id="isStrict"><span class="annot"><span class="annottext">isStrict :: Card -&gt; Bool
</span><a href="GHC.Types.Demand.html#isStrict"><span class="hs-identifier hs-var hs-var">isStrict</span></a></span></span><span> </span><span class="annot"><span class="annottext">Card
</span><a href="GHC.Types.Demand.html#C_10"><span class="hs-identifier hs-var">C_10</span></a></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">Bool
</span><span class="hs-identifier hs-var">True</span></span><span>
</span><span id="line-153"></span><span class="annot"><a href="GHC.Types.Demand.html#isStrict"><span class="hs-identifier hs-var">isStrict</span></a></span><span> </span><span class="annot"><span class="annottext">Card
</span><a href="GHC.Types.Demand.html#C_11"><span class="hs-identifier hs-var">C_11</span></a></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">Bool
</span><span class="hs-identifier hs-var">True</span></span><span>
</span><span id="line-154"></span><span class="annot"><a href="GHC.Types.Demand.html#isStrict"><span class="hs-identifier hs-var">isStrict</span></a></span><span> </span><span class="annot"><span class="annottext">Card
</span><a href="GHC.Types.Demand.html#C_1N"><span class="hs-identifier hs-var">C_1N</span></a></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">Bool
</span><span class="hs-identifier hs-var">True</span></span><span>
</span><span id="line-155"></span><span class="annot"><a href="GHC.Types.Demand.html#isStrict"><span class="hs-identifier hs-var">isStrict</span></a></span><span> </span><span class="annot"><span class="annottext">Card
</span><span class="hs-identifier">_</span></span><span>    </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">Bool
</span><span class="hs-identifier hs-var">False</span></span><span>
</span><span id="line-156"></span><span>
</span><span id="line-157"></span><span class="hs-comment">-- | True &lt;=&gt; upper bound is 0.</span><span>
</span><span id="line-158"></span><span class="annot"><a href="GHC.Types.Demand.html#isAbs"><span class="hs-identifier hs-type">isAbs</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><a href="GHC.Types.Demand.html#Card"><span class="hs-identifier hs-type">Card</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="hs-identifier hs-type">Bool</span></span><span>
</span><span id="line-159"></span><span id="isAbs"><span class="annot"><span class="annottext">isAbs :: Card -&gt; Bool
</span><a href="GHC.Types.Demand.html#isAbs"><span class="hs-identifier hs-var hs-var">isAbs</span></a></span></span><span> </span><span class="annot"><span class="annottext">Card
</span><a href="GHC.Types.Demand.html#C_00"><span class="hs-identifier hs-var">C_00</span></a></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">Bool
</span><span class="hs-identifier hs-var">True</span></span><span>
</span><span id="line-160"></span><span class="annot"><a href="GHC.Types.Demand.html#isAbs"><span class="hs-identifier hs-var">isAbs</span></a></span><span> </span><span class="annot"><span class="annottext">Card
</span><a href="GHC.Types.Demand.html#C_10"><span class="hs-identifier hs-var">C_10</span></a></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">Bool
</span><span class="hs-identifier hs-var">True</span></span><span> </span><span class="hs-comment">-- Bottom cardinality is also absent</span><span>
</span><span id="line-161"></span><span class="annot"><a href="GHC.Types.Demand.html#isAbs"><span class="hs-identifier hs-var">isAbs</span></a></span><span> </span><span class="annot"><span class="annottext">Card
</span><span class="hs-identifier">_</span></span><span>    </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">Bool
</span><span class="hs-identifier hs-var">False</span></span><span>
</span><span id="line-162"></span><span>
</span><span id="line-163"></span><span class="hs-comment">-- | True &lt;=&gt; upper bound is 1.</span><span>
</span><span id="line-164"></span><span class="annot"><a href="GHC.Types.Demand.html#isUsedOnce"><span class="hs-identifier hs-type">isUsedOnce</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><a href="GHC.Types.Demand.html#Card"><span class="hs-identifier hs-type">Card</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="hs-identifier hs-type">Bool</span></span><span>
</span><span id="line-165"></span><span id="isUsedOnce"><span class="annot"><span class="annottext">isUsedOnce :: Card -&gt; Bool
</span><a href="GHC.Types.Demand.html#isUsedOnce"><span class="hs-identifier hs-var hs-var">isUsedOnce</span></a></span></span><span> </span><span class="annot"><span class="annottext">Card
</span><a href="GHC.Types.Demand.html#C_0N"><span class="hs-identifier hs-var">C_0N</span></a></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">Bool
</span><span class="hs-identifier hs-var">False</span></span><span>
</span><span id="line-166"></span><span class="annot"><a href="GHC.Types.Demand.html#isUsedOnce"><span class="hs-identifier hs-var">isUsedOnce</span></a></span><span> </span><span class="annot"><span class="annottext">Card
</span><a href="GHC.Types.Demand.html#C_1N"><span class="hs-identifier hs-var">C_1N</span></a></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">Bool
</span><span class="hs-identifier hs-var">False</span></span><span>
</span><span id="line-167"></span><span class="annot"><a href="GHC.Types.Demand.html#isUsedOnce"><span class="hs-identifier hs-var">isUsedOnce</span></a></span><span> </span><span class="annot"><span class="annottext">Card
</span><span class="hs-identifier">_</span></span><span>    </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">Bool
</span><span class="hs-identifier hs-var">True</span></span><span>
</span><span id="line-168"></span><span>
</span><span id="line-169"></span><span class="hs-comment">-- | Intersect with [0,1].</span><span>
</span><span id="line-170"></span><span class="annot"><a href="GHC.Types.Demand.html#oneifyCard"><span class="hs-identifier hs-type">oneifyCard</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><a href="GHC.Types.Demand.html#Card"><span class="hs-identifier hs-type">Card</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="GHC.Types.Demand.html#Card"><span class="hs-identifier hs-type">Card</span></a></span><span>
</span><span id="line-171"></span><span id="oneifyCard"><span class="annot"><span class="annottext">oneifyCard :: Card -&gt; Card
</span><a href="GHC.Types.Demand.html#oneifyCard"><span class="hs-identifier hs-var hs-var">oneifyCard</span></a></span></span><span> </span><span class="annot"><span class="annottext">Card
</span><a href="GHC.Types.Demand.html#C_0N"><span class="hs-identifier hs-var">C_0N</span></a></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">Card
</span><a href="GHC.Types.Demand.html#C_01"><span class="hs-identifier hs-var">C_01</span></a></span><span>
</span><span id="line-172"></span><span class="annot"><a href="GHC.Types.Demand.html#oneifyCard"><span class="hs-identifier hs-var">oneifyCard</span></a></span><span> </span><span class="annot"><span class="annottext">Card
</span><a href="GHC.Types.Demand.html#C_1N"><span class="hs-identifier hs-var">C_1N</span></a></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">Card
</span><a href="GHC.Types.Demand.html#C_11"><span class="hs-identifier hs-var">C_11</span></a></span><span>
</span><span id="line-173"></span><span class="annot"><a href="GHC.Types.Demand.html#oneifyCard"><span class="hs-identifier hs-var">oneifyCard</span></a></span><span> </span><span id="local-6989586621680990953"><span class="annot"><span class="annottext">Card
</span><a href="#local-6989586621680990953"><span class="hs-identifier hs-var">c</span></a></span></span><span>    </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">Card
</span><a href="#local-6989586621680990953"><span class="hs-identifier hs-var">c</span></a></span><span>
</span><span id="line-174"></span><span>
</span><span id="line-175"></span><span class="hs-comment">-- | Denotes '&#8746;' on 'Card'.</span><span>
</span><span id="line-176"></span><span class="annot"><a href="GHC.Types.Demand.html#lubCard"><span class="hs-identifier hs-type">lubCard</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><a href="GHC.Types.Demand.html#Card"><span class="hs-identifier hs-type">Card</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="GHC.Types.Demand.html#Card"><span class="hs-identifier hs-type">Card</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="GHC.Types.Demand.html#Card"><span class="hs-identifier hs-type">Card</span></a></span><span>
</span><span id="line-177"></span><span class="hs-comment">-- Handle C_10 (bot)</span><span>
</span><span id="line-178"></span><span id="lubCard"><span class="annot"><span class="annottext">lubCard :: Card -&gt; Card -&gt; Card
</span><a href="GHC.Types.Demand.html#lubCard"><span class="hs-identifier hs-var hs-var">lubCard</span></a></span></span><span> </span><span class="annot"><span class="annottext">Card
</span><a href="GHC.Types.Demand.html#C_10"><span class="hs-identifier hs-var">C_10</span></a></span><span> </span><span id="local-6989586621680990952"><span class="annot"><span class="annottext">Card
</span><a href="#local-6989586621680990952"><span class="hs-identifier hs-var">n</span></a></span></span><span>    </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">Card
</span><a href="#local-6989586621680990952"><span class="hs-identifier hs-var">n</span></a></span><span>    </span><span class="hs-comment">-- bot</span><span>
</span><span id="line-179"></span><span class="annot"><a href="GHC.Types.Demand.html#lubCard"><span class="hs-identifier hs-var">lubCard</span></a></span><span> </span><span id="local-6989586621680990951"><span class="annot"><span class="annottext">Card
</span><a href="#local-6989586621680990951"><span class="hs-identifier hs-var">n</span></a></span></span><span>    </span><span class="annot"><span class="annottext">Card
</span><a href="GHC.Types.Demand.html#C_10"><span class="hs-identifier hs-var">C_10</span></a></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">Card
</span><a href="#local-6989586621680990951"><span class="hs-identifier hs-var">n</span></a></span><span>    </span><span class="hs-comment">-- bot</span><span>
</span><span id="line-180"></span><span class="hs-comment">-- Handle C_0N (top)</span><span>
</span><span id="line-181"></span><span class="annot"><a href="GHC.Types.Demand.html#lubCard"><span class="hs-identifier hs-var">lubCard</span></a></span><span> </span><span class="annot"><span class="annottext">Card
</span><a href="GHC.Types.Demand.html#C_0N"><span class="hs-identifier hs-var">C_0N</span></a></span><span> </span><span class="annot"><span class="annottext">Card
</span><span class="hs-identifier">_</span></span><span>    </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">Card
</span><a href="GHC.Types.Demand.html#C_0N"><span class="hs-identifier hs-var">C_0N</span></a></span><span> </span><span class="hs-comment">-- top</span><span>
</span><span id="line-182"></span><span class="annot"><a href="GHC.Types.Demand.html#lubCard"><span class="hs-identifier hs-var">lubCard</span></a></span><span> </span><span class="annot"><span class="annottext">Card
</span><span class="hs-identifier">_</span></span><span>    </span><span class="annot"><span class="annottext">Card
</span><a href="GHC.Types.Demand.html#C_0N"><span class="hs-identifier hs-var">C_0N</span></a></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">Card
</span><a href="GHC.Types.Demand.html#C_0N"><span class="hs-identifier hs-var">C_0N</span></a></span><span> </span><span class="hs-comment">-- top</span><span>
</span><span id="line-183"></span><span class="hs-comment">-- Handle C_11</span><span>
</span><span id="line-184"></span><span class="annot"><a href="GHC.Types.Demand.html#lubCard"><span class="hs-identifier hs-var">lubCard</span></a></span><span> </span><span class="annot"><span class="annottext">Card
</span><a href="GHC.Types.Demand.html#C_00"><span class="hs-identifier hs-var">C_00</span></a></span><span> </span><span class="annot"><span class="annottext">Card
</span><a href="GHC.Types.Demand.html#C_11"><span class="hs-identifier hs-var">C_11</span></a></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">Card
</span><a href="GHC.Types.Demand.html#C_01"><span class="hs-identifier hs-var">C_01</span></a></span><span> </span><span class="hs-comment">-- {0} &#8746; {1} = {0,1}</span><span>
</span><span id="line-185"></span><span class="annot"><a href="GHC.Types.Demand.html#lubCard"><span class="hs-identifier hs-var">lubCard</span></a></span><span> </span><span class="annot"><span class="annottext">Card
</span><a href="GHC.Types.Demand.html#C_11"><span class="hs-identifier hs-var">C_11</span></a></span><span> </span><span class="annot"><span class="annottext">Card
</span><a href="GHC.Types.Demand.html#C_00"><span class="hs-identifier hs-var">C_00</span></a></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">Card
</span><a href="GHC.Types.Demand.html#C_01"><span class="hs-identifier hs-var">C_01</span></a></span><span> </span><span class="hs-comment">-- {0} &#8746; {1} = {0,1}</span><span>
</span><span id="line-186"></span><span class="annot"><a href="GHC.Types.Demand.html#lubCard"><span class="hs-identifier hs-var">lubCard</span></a></span><span> </span><span class="annot"><span class="annottext">Card
</span><a href="GHC.Types.Demand.html#C_11"><span class="hs-identifier hs-var">C_11</span></a></span><span> </span><span id="local-6989586621680990950"><span class="annot"><span class="annottext">Card
</span><a href="#local-6989586621680990950"><span class="hs-identifier hs-var">n</span></a></span></span><span>    </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">Card
</span><a href="#local-6989586621680990950"><span class="hs-identifier hs-var">n</span></a></span><span>    </span><span class="hs-comment">-- {1} is a subset of all other intervals</span><span>
</span><span id="line-187"></span><span class="annot"><a href="GHC.Types.Demand.html#lubCard"><span class="hs-identifier hs-var">lubCard</span></a></span><span> </span><span id="local-6989586621680990949"><span class="annot"><span class="annottext">Card
</span><a href="#local-6989586621680990949"><span class="hs-identifier hs-var">n</span></a></span></span><span>    </span><span class="annot"><span class="annottext">Card
</span><a href="GHC.Types.Demand.html#C_11"><span class="hs-identifier hs-var">C_11</span></a></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">Card
</span><a href="#local-6989586621680990949"><span class="hs-identifier hs-var">n</span></a></span><span>    </span><span class="hs-comment">-- {1} is a subset of all other intervals</span><span>
</span><span id="line-188"></span><span class="hs-comment">-- Handle C_1N</span><span>
</span><span id="line-189"></span><span class="annot"><a href="GHC.Types.Demand.html#lubCard"><span class="hs-identifier hs-var">lubCard</span></a></span><span> </span><span class="annot"><span class="annottext">Card
</span><a href="GHC.Types.Demand.html#C_1N"><span class="hs-identifier hs-var">C_1N</span></a></span><span> </span><span class="annot"><span class="annottext">Card
</span><a href="GHC.Types.Demand.html#C_1N"><span class="hs-identifier hs-var">C_1N</span></a></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">Card
</span><a href="GHC.Types.Demand.html#C_1N"><span class="hs-identifier hs-var">C_1N</span></a></span><span> </span><span class="hs-comment">-- reflexivity</span><span>
</span><span id="line-190"></span><span class="annot"><a href="GHC.Types.Demand.html#lubCard"><span class="hs-identifier hs-var">lubCard</span></a></span><span> </span><span class="annot"><span class="annottext">Card
</span><span class="hs-identifier">_</span></span><span>    </span><span class="annot"><span class="annottext">Card
</span><a href="GHC.Types.Demand.html#C_1N"><span class="hs-identifier hs-var">C_1N</span></a></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">Card
</span><a href="GHC.Types.Demand.html#C_0N"><span class="hs-identifier hs-var">C_0N</span></a></span><span> </span><span class="hs-comment">-- {0} &#8746; {1,n} = top</span><span>
</span><span id="line-191"></span><span class="annot"><a href="GHC.Types.Demand.html#lubCard"><span class="hs-identifier hs-var">lubCard</span></a></span><span> </span><span class="annot"><span class="annottext">Card
</span><a href="GHC.Types.Demand.html#C_1N"><span class="hs-identifier hs-var">C_1N</span></a></span><span> </span><span class="annot"><span class="annottext">Card
</span><span class="hs-identifier">_</span></span><span>    </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">Card
</span><a href="GHC.Types.Demand.html#C_0N"><span class="hs-identifier hs-var">C_0N</span></a></span><span> </span><span class="hs-comment">-- {0} &#8746; {1,n} = top</span><span>
</span><span id="line-192"></span><span class="hs-comment">-- Handle C_01</span><span>
</span><span id="line-193"></span><span class="annot"><a href="GHC.Types.Demand.html#lubCard"><span class="hs-identifier hs-var">lubCard</span></a></span><span> </span><span class="annot"><span class="annottext">Card
</span><a href="GHC.Types.Demand.html#C_01"><span class="hs-identifier hs-var">C_01</span></a></span><span> </span><span class="annot"><span class="annottext">Card
</span><span class="hs-identifier">_</span></span><span>    </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">Card
</span><a href="GHC.Types.Demand.html#C_01"><span class="hs-identifier hs-var">C_01</span></a></span><span> </span><span class="hs-comment">-- {0} &#8746; {0,1} = {0,1}</span><span>
</span><span id="line-194"></span><span class="annot"><a href="GHC.Types.Demand.html#lubCard"><span class="hs-identifier hs-var">lubCard</span></a></span><span> </span><span class="annot"><span class="annottext">Card
</span><span class="hs-identifier">_</span></span><span>    </span><span class="annot"><span class="annottext">Card
</span><a href="GHC.Types.Demand.html#C_01"><span class="hs-identifier hs-var">C_01</span></a></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">Card
</span><a href="GHC.Types.Demand.html#C_01"><span class="hs-identifier hs-var">C_01</span></a></span><span> </span><span class="hs-comment">-- {0} &#8746; {0,1} = {0,1}</span><span>
</span><span id="line-195"></span><span class="hs-comment">-- Handle C_00</span><span>
</span><span id="line-196"></span><span class="annot"><a href="GHC.Types.Demand.html#lubCard"><span class="hs-identifier hs-var">lubCard</span></a></span><span> </span><span class="annot"><span class="annottext">Card
</span><a href="GHC.Types.Demand.html#C_00"><span class="hs-identifier hs-var">C_00</span></a></span><span> </span><span class="annot"><span class="annottext">Card
</span><a href="GHC.Types.Demand.html#C_00"><span class="hs-identifier hs-var">C_00</span></a></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">Card
</span><a href="GHC.Types.Demand.html#C_00"><span class="hs-identifier hs-var">C_00</span></a></span><span> </span><span class="hs-comment">-- reflexivity</span><span>
</span><span id="line-197"></span><span>
</span><span id="line-198"></span><span class="hs-comment">-- | Denotes '+' on 'Card'.</span><span>
</span><span id="line-199"></span><span class="annot"><a href="GHC.Types.Demand.html#plusCard"><span class="hs-identifier hs-type">plusCard</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><a href="GHC.Types.Demand.html#Card"><span class="hs-identifier hs-type">Card</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="GHC.Types.Demand.html#Card"><span class="hs-identifier hs-type">Card</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="GHC.Types.Demand.html#Card"><span class="hs-identifier hs-type">Card</span></a></span><span>
</span><span id="line-200"></span><span class="hs-comment">-- Handle C_00</span><span>
</span><span id="line-201"></span><span id="plusCard"><span class="annot"><span class="annottext">plusCard :: Card -&gt; Card -&gt; Card
</span><a href="GHC.Types.Demand.html#plusCard"><span class="hs-identifier hs-var hs-var">plusCard</span></a></span></span><span> </span><span class="annot"><span class="annottext">Card
</span><a href="GHC.Types.Demand.html#C_00"><span class="hs-identifier hs-var">C_00</span></a></span><span> </span><span id="local-6989586621680990948"><span class="annot"><span class="annottext">Card
</span><a href="#local-6989586621680990948"><span class="hs-identifier hs-var">n</span></a></span></span><span>    </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">Card
</span><a href="#local-6989586621680990948"><span class="hs-identifier hs-var">n</span></a></span><span>    </span><span class="hs-comment">-- {0}+n = n</span><span>
</span><span id="line-202"></span><span class="annot"><a href="GHC.Types.Demand.html#plusCard"><span class="hs-identifier hs-var">plusCard</span></a></span><span> </span><span id="local-6989586621680990947"><span class="annot"><span class="annottext">Card
</span><a href="#local-6989586621680990947"><span class="hs-identifier hs-var">n</span></a></span></span><span>    </span><span class="annot"><span class="annottext">Card
</span><a href="GHC.Types.Demand.html#C_00"><span class="hs-identifier hs-var">C_00</span></a></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">Card
</span><a href="#local-6989586621680990947"><span class="hs-identifier hs-var">n</span></a></span><span>    </span><span class="hs-comment">-- {0}+n = n</span><span>
</span><span id="line-203"></span><span class="hs-comment">-- Handle C_10</span><span>
</span><span id="line-204"></span><span class="annot"><a href="GHC.Types.Demand.html#plusCard"><span class="hs-identifier hs-var">plusCard</span></a></span><span> </span><span class="annot"><span class="annottext">Card
</span><a href="GHC.Types.Demand.html#C_10"><span class="hs-identifier hs-var">C_10</span></a></span><span> </span><span class="annot"><span class="annottext">Card
</span><a href="GHC.Types.Demand.html#C_01"><span class="hs-identifier hs-var">C_01</span></a></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">Card
</span><a href="GHC.Types.Demand.html#C_11"><span class="hs-identifier hs-var">C_11</span></a></span><span> </span><span class="hs-comment">-- These follow by applying + to lower and upper</span><span>
</span><span id="line-205"></span><span class="annot"><a href="GHC.Types.Demand.html#plusCard"><span class="hs-identifier hs-var">plusCard</span></a></span><span> </span><span class="annot"><span class="annottext">Card
</span><a href="GHC.Types.Demand.html#C_10"><span class="hs-identifier hs-var">C_10</span></a></span><span> </span><span class="annot"><span class="annottext">Card
</span><a href="GHC.Types.Demand.html#C_0N"><span class="hs-identifier hs-var">C_0N</span></a></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">Card
</span><a href="GHC.Types.Demand.html#C_1N"><span class="hs-identifier hs-var">C_1N</span></a></span><span> </span><span class="hs-comment">-- bounds individually</span><span>
</span><span id="line-206"></span><span class="annot"><a href="GHC.Types.Demand.html#plusCard"><span class="hs-identifier hs-var">plusCard</span></a></span><span> </span><span class="annot"><span class="annottext">Card
</span><a href="GHC.Types.Demand.html#C_10"><span class="hs-identifier hs-var">C_10</span></a></span><span> </span><span id="local-6989586621680990946"><span class="annot"><span class="annottext">Card
</span><a href="#local-6989586621680990946"><span class="hs-identifier hs-var">n</span></a></span></span><span>    </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">Card
</span><a href="#local-6989586621680990946"><span class="hs-identifier hs-var">n</span></a></span><span>
</span><span id="line-207"></span><span class="annot"><a href="GHC.Types.Demand.html#plusCard"><span class="hs-identifier hs-var">plusCard</span></a></span><span> </span><span class="annot"><span class="annottext">Card
</span><a href="GHC.Types.Demand.html#C_01"><span class="hs-identifier hs-var">C_01</span></a></span><span> </span><span class="annot"><span class="annottext">Card
</span><a href="GHC.Types.Demand.html#C_10"><span class="hs-identifier hs-var">C_10</span></a></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">Card
</span><a href="GHC.Types.Demand.html#C_11"><span class="hs-identifier hs-var">C_11</span></a></span><span>
</span><span id="line-208"></span><span class="annot"><a href="GHC.Types.Demand.html#plusCard"><span class="hs-identifier hs-var">plusCard</span></a></span><span> </span><span class="annot"><span class="annottext">Card
</span><a href="GHC.Types.Demand.html#C_0N"><span class="hs-identifier hs-var">C_0N</span></a></span><span> </span><span class="annot"><span class="annottext">Card
</span><a href="GHC.Types.Demand.html#C_10"><span class="hs-identifier hs-var">C_10</span></a></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">Card
</span><a href="GHC.Types.Demand.html#C_1N"><span class="hs-identifier hs-var">C_1N</span></a></span><span>
</span><span id="line-209"></span><span class="annot"><a href="GHC.Types.Demand.html#plusCard"><span class="hs-identifier hs-var">plusCard</span></a></span><span> </span><span id="local-6989586621680990945"><span class="annot"><span class="annottext">Card
</span><a href="#local-6989586621680990945"><span class="hs-identifier hs-var">n</span></a></span></span><span>    </span><span class="annot"><span class="annottext">Card
</span><a href="GHC.Types.Demand.html#C_10"><span class="hs-identifier hs-var">C_10</span></a></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">Card
</span><a href="#local-6989586621680990945"><span class="hs-identifier hs-var">n</span></a></span><span>
</span><span id="line-210"></span><span class="hs-comment">-- Handle the rest (C_01, C_0N, C_11, C_1N)</span><span>
</span><span id="line-211"></span><span class="annot"><a href="GHC.Types.Demand.html#plusCard"><span class="hs-identifier hs-var">plusCard</span></a></span><span> </span><span class="annot"><span class="annottext">Card
</span><a href="GHC.Types.Demand.html#C_01"><span class="hs-identifier hs-var">C_01</span></a></span><span> </span><span class="annot"><span class="annottext">Card
</span><a href="GHC.Types.Demand.html#C_01"><span class="hs-identifier hs-var">C_01</span></a></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">Card
</span><a href="GHC.Types.Demand.html#C_0N"><span class="hs-identifier hs-var">C_0N</span></a></span><span> </span><span class="hs-comment">-- The upper bound is at least 1, so upper bound of</span><span>
</span><span id="line-212"></span><span class="annot"><a href="GHC.Types.Demand.html#plusCard"><span class="hs-identifier hs-var">plusCard</span></a></span><span> </span><span class="annot"><span class="annottext">Card
</span><a href="GHC.Types.Demand.html#C_01"><span class="hs-identifier hs-var">C_01</span></a></span><span> </span><span class="annot"><span class="annottext">Card
</span><a href="GHC.Types.Demand.html#C_0N"><span class="hs-identifier hs-var">C_0N</span></a></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">Card
</span><a href="GHC.Types.Demand.html#C_0N"><span class="hs-identifier hs-var">C_0N</span></a></span><span> </span><span class="hs-comment">-- the result must be 1+1 ~= N.</span><span>
</span><span id="line-213"></span><span class="annot"><a href="GHC.Types.Demand.html#plusCard"><span class="hs-identifier hs-var">plusCard</span></a></span><span> </span><span class="annot"><span class="annottext">Card
</span><a href="GHC.Types.Demand.html#C_0N"><span class="hs-identifier hs-var">C_0N</span></a></span><span> </span><span class="annot"><span class="annottext">Card
</span><a href="GHC.Types.Demand.html#C_01"><span class="hs-identifier hs-var">C_01</span></a></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">Card
</span><a href="GHC.Types.Demand.html#C_0N"><span class="hs-identifier hs-var">C_0N</span></a></span><span> </span><span class="hs-comment">-- But for the lower bound we have 4 cases where</span><span>
</span><span id="line-214"></span><span class="annot"><a href="GHC.Types.Demand.html#plusCard"><span class="hs-identifier hs-var">plusCard</span></a></span><span> </span><span class="annot"><span class="annottext">Card
</span><a href="GHC.Types.Demand.html#C_0N"><span class="hs-identifier hs-var">C_0N</span></a></span><span> </span><span class="annot"><span class="annottext">Card
</span><a href="GHC.Types.Demand.html#C_0N"><span class="hs-identifier hs-var">C_0N</span></a></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">Card
</span><a href="GHC.Types.Demand.html#C_0N"><span class="hs-identifier hs-var">C_0N</span></a></span><span> </span><span class="hs-comment">-- 0+0 ~= 0 (as opposed to 1), so we match on these.</span><span>
</span><span id="line-215"></span><span class="annot"><a href="GHC.Types.Demand.html#plusCard"><span class="hs-identifier hs-var">plusCard</span></a></span><span> </span><span class="annot"><span class="annottext">Card
</span><span class="hs-identifier">_</span></span><span>    </span><span class="annot"><span class="annottext">Card
</span><span class="hs-identifier">_</span></span><span>    </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">Card
</span><a href="GHC.Types.Demand.html#C_1N"><span class="hs-identifier hs-var">C_1N</span></a></span><span> </span><span class="hs-comment">-- Otherwise we return {1,n}</span><span>
</span><span id="line-216"></span><span>
</span><span id="line-217"></span><span class="hs-comment">-- | Denotes '*' on 'Card'.</span><span>
</span><span id="line-218"></span><span class="annot"><a href="GHC.Types.Demand.html#multCard"><span class="hs-identifier hs-type">multCard</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><a href="GHC.Types.Demand.html#Card"><span class="hs-identifier hs-type">Card</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="GHC.Types.Demand.html#Card"><span class="hs-identifier hs-type">Card</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="GHC.Types.Demand.html#Card"><span class="hs-identifier hs-type">Card</span></a></span><span>
</span><span id="line-219"></span><span class="hs-comment">-- Handle C_11 (neutral element)</span><span>
</span><span id="line-220"></span><span id="multCard"><span class="annot"><span class="annottext">multCard :: Card -&gt; Card -&gt; Card
</span><a href="GHC.Types.Demand.html#multCard"><span class="hs-identifier hs-var hs-var">multCard</span></a></span></span><span> </span><span class="annot"><span class="annottext">Card
</span><a href="GHC.Types.Demand.html#C_11"><span class="hs-identifier hs-var">C_11</span></a></span><span> </span><span id="local-6989586621680990944"><span class="annot"><span class="annottext">Card
</span><a href="#local-6989586621680990944"><span class="hs-identifier hs-var">c</span></a></span></span><span>    </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">Card
</span><a href="#local-6989586621680990944"><span class="hs-identifier hs-var">c</span></a></span><span>
</span><span id="line-221"></span><span class="annot"><a href="GHC.Types.Demand.html#multCard"><span class="hs-identifier hs-var">multCard</span></a></span><span> </span><span id="local-6989586621680990943"><span class="annot"><span class="annottext">Card
</span><a href="#local-6989586621680990943"><span class="hs-identifier hs-var">c</span></a></span></span><span>    </span><span class="annot"><span class="annottext">Card
</span><a href="GHC.Types.Demand.html#C_11"><span class="hs-identifier hs-var">C_11</span></a></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">Card
</span><a href="#local-6989586621680990943"><span class="hs-identifier hs-var">c</span></a></span><span>
</span><span id="line-222"></span><span class="hs-comment">-- Handle C_00 (annihilating element)</span><span>
</span><span id="line-223"></span><span class="annot"><a href="GHC.Types.Demand.html#multCard"><span class="hs-identifier hs-var">multCard</span></a></span><span> </span><span class="annot"><span class="annottext">Card
</span><a href="GHC.Types.Demand.html#C_00"><span class="hs-identifier hs-var">C_00</span></a></span><span> </span><span class="annot"><span class="annottext">Card
</span><span class="hs-identifier">_</span></span><span>    </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">Card
</span><a href="GHC.Types.Demand.html#C_00"><span class="hs-identifier hs-var">C_00</span></a></span><span>
</span><span id="line-224"></span><span class="annot"><a href="GHC.Types.Demand.html#multCard"><span class="hs-identifier hs-var">multCard</span></a></span><span> </span><span class="annot"><span class="annottext">Card
</span><span class="hs-identifier">_</span></span><span>    </span><span class="annot"><span class="annottext">Card
</span><a href="GHC.Types.Demand.html#C_00"><span class="hs-identifier hs-var">C_00</span></a></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">Card
</span><a href="GHC.Types.Demand.html#C_00"><span class="hs-identifier hs-var">C_00</span></a></span><span>
</span><span id="line-225"></span><span class="hs-comment">-- Handle C_10</span><span>
</span><span id="line-226"></span><span class="annot"><a href="GHC.Types.Demand.html#multCard"><span class="hs-identifier hs-var">multCard</span></a></span><span> </span><span class="annot"><span class="annottext">Card
</span><a href="GHC.Types.Demand.html#C_10"><span class="hs-identifier hs-var">C_10</span></a></span><span> </span><span id="local-6989586621680990942"><span class="annot"><span class="annottext">Card
</span><a href="#local-6989586621680990942"><span class="hs-identifier hs-var">c</span></a></span></span><span>    </span><span class="hs-glyph">=</span><span> </span><span class="hs-keyword">if</span><span> </span><span class="annot"><span class="annottext">Card -&gt; Bool
</span><a href="GHC.Types.Demand.html#isStrict"><span class="hs-identifier hs-var">isStrict</span></a></span><span> </span><span class="annot"><span class="annottext">Card
</span><a href="#local-6989586621680990942"><span class="hs-identifier hs-var">c</span></a></span><span> </span><span class="hs-keyword">then</span><span> </span><span class="annot"><span class="annottext">Card
</span><a href="GHC.Types.Demand.html#C_10"><span class="hs-identifier hs-var">C_10</span></a></span><span> </span><span class="hs-keyword">else</span><span> </span><span class="annot"><span class="annottext">Card
</span><a href="GHC.Types.Demand.html#C_00"><span class="hs-identifier hs-var">C_00</span></a></span><span>
</span><span id="line-227"></span><span class="annot"><a href="GHC.Types.Demand.html#multCard"><span class="hs-identifier hs-var">multCard</span></a></span><span> </span><span id="local-6989586621680990941"><span class="annot"><span class="annottext">Card
</span><a href="#local-6989586621680990941"><span class="hs-identifier hs-var">c</span></a></span></span><span>    </span><span class="annot"><span class="annottext">Card
</span><a href="GHC.Types.Demand.html#C_10"><span class="hs-identifier hs-var">C_10</span></a></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-keyword">if</span><span> </span><span class="annot"><span class="annottext">Card -&gt; Bool
</span><a href="GHC.Types.Demand.html#isStrict"><span class="hs-identifier hs-var">isStrict</span></a></span><span> </span><span class="annot"><span class="annottext">Card
</span><a href="#local-6989586621680990941"><span class="hs-identifier hs-var">c</span></a></span><span> </span><span class="hs-keyword">then</span><span> </span><span class="annot"><span class="annottext">Card
</span><a href="GHC.Types.Demand.html#C_10"><span class="hs-identifier hs-var">C_10</span></a></span><span> </span><span class="hs-keyword">else</span><span> </span><span class="annot"><span class="annottext">Card
</span><a href="GHC.Types.Demand.html#C_00"><span class="hs-identifier hs-var">C_00</span></a></span><span>
</span><span id="line-228"></span><span class="hs-comment">-- Handle reflexive C_1N, C_01</span><span>
</span><span id="line-229"></span><span class="annot"><a href="GHC.Types.Demand.html#multCard"><span class="hs-identifier hs-var">multCard</span></a></span><span> </span><span class="annot"><span class="annottext">Card
</span><a href="GHC.Types.Demand.html#C_1N"><span class="hs-identifier hs-var">C_1N</span></a></span><span> </span><span class="annot"><span class="annottext">Card
</span><a href="GHC.Types.Demand.html#C_1N"><span class="hs-identifier hs-var">C_1N</span></a></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">Card
</span><a href="GHC.Types.Demand.html#C_1N"><span class="hs-identifier hs-var">C_1N</span></a></span><span>
</span><span id="line-230"></span><span class="annot"><a href="GHC.Types.Demand.html#multCard"><span class="hs-identifier hs-var">multCard</span></a></span><span> </span><span class="annot"><span class="annottext">Card
</span><a href="GHC.Types.Demand.html#C_01"><span class="hs-identifier hs-var">C_01</span></a></span><span> </span><span class="annot"><span class="annottext">Card
</span><a href="GHC.Types.Demand.html#C_01"><span class="hs-identifier hs-var">C_01</span></a></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">Card
</span><a href="GHC.Types.Demand.html#C_01"><span class="hs-identifier hs-var">C_01</span></a></span><span>
</span><span id="line-231"></span><span class="hs-comment">-- Handle C_0N and the rest (C_01, C_1N):</span><span>
</span><span id="line-232"></span><span class="annot"><a href="GHC.Types.Demand.html#multCard"><span class="hs-identifier hs-var">multCard</span></a></span><span> </span><span class="annot"><span class="annottext">Card
</span><span class="hs-identifier">_</span></span><span>    </span><span class="annot"><span class="annottext">Card
</span><span class="hs-identifier">_</span></span><span>    </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">Card
</span><a href="GHC.Types.Demand.html#C_0N"><span class="hs-identifier hs-var">C_0N</span></a></span><span>
</span><span id="line-233"></span><span>
</span><span id="line-234"></span><span class="hs-comment">{-
************************************************************************
*                                                                      *
           Demand: Evaluation contexts
*                                                                      *
************************************************************************
-}</span><span>
</span><span id="line-241"></span><span>
</span><span id="line-242"></span><span class="hs-comment">-- | A demand describes a /scaled evaluation context/, e.g. how many times</span><span>
</span><span id="line-243"></span><span class="hs-comment">-- and how deep the denoted thing is evaluated.</span><span>
</span><span id="line-244"></span><span class="hs-comment">--</span><span>
</span><span id="line-245"></span><span class="hs-comment">-- The &quot;how many&quot; component is represented by a 'Card'inality.</span><span>
</span><span id="line-246"></span><span class="hs-comment">-- The &quot;how deep&quot; component is represented by a 'SubDemand'.</span><span>
</span><span id="line-247"></span><span class="hs-comment">-- Examples (using Note [Demand notation]):</span><span>
</span><span id="line-248"></span><span class="hs-comment">--</span><span>
</span><span id="line-249"></span><span class="hs-comment">--   * 'seq' puts demand @1A@ on its first argument: It evaluates the argument</span><span>
</span><span id="line-250"></span><span class="hs-comment">--     strictly (@1@), but not any deeper (@A@).</span><span>
</span><span id="line-251"></span><span class="hs-comment">--   * 'fst' puts demand @1P(1L,A)@ on its argument: It evaluates the argument</span><span>
</span><span id="line-252"></span><span class="hs-comment">--     pair strictly and the first component strictly, but no nested info</span><span>
</span><span id="line-253"></span><span class="hs-comment">--     beyond that (@L@). Its second argument is not used at all.</span><span>
</span><span id="line-254"></span><span class="hs-comment">--   * '$' puts demand @1C1(L)@ on its first argument: It calls (@C@) the</span><span>
</span><span id="line-255"></span><span class="hs-comment">--     argument function with one argument, exactly once (@1@). No info</span><span>
</span><span id="line-256"></span><span class="hs-comment">--     on how the result of that call is evaluated (@L@).</span><span>
</span><span id="line-257"></span><span class="hs-comment">--   * 'maybe' puts demand @MCM(L)@ on its second argument: It evaluates</span><span>
</span><span id="line-258"></span><span class="hs-comment">--     the argument function at most once ((M)aybe) and calls it once when</span><span>
</span><span id="line-259"></span><span class="hs-comment">--     it is evaluated.</span><span>
</span><span id="line-260"></span><span class="hs-comment">--   * @fst p + fst p@ puts demand @SP(SL,A)@ on @p@: It's @1P(1L,A)@</span><span>
</span><span id="line-261"></span><span class="hs-comment">--     multiplied by two, so we get @S@ (used at least once, possibly multiple</span><span>
</span><span id="line-262"></span><span class="hs-comment">--     times).</span><span>
</span><span id="line-263"></span><span class="hs-comment">--</span><span>
</span><span id="line-264"></span><span class="hs-comment">-- This data type is quite similar to @'Scaled' 'SubDemand'@, but it's scaled</span><span>
</span><span id="line-265"></span><span class="hs-comment">-- by 'Card', which is an /interval/ on 'Multiplicity', the upper bound of</span><span>
</span><span id="line-266"></span><span class="hs-comment">-- which could be used to infer uniqueness types.</span><span>
</span><span id="line-267"></span><span class="hs-keyword">data</span><span> </span><span id="Demand"><span class="annot"><a href="GHC.Types.Demand.html#Demand"><span class="hs-identifier hs-var">Demand</span></a></span></span><span>
</span><span id="line-268"></span><span>  </span><span class="hs-glyph">=</span><span> </span><span class="hs-glyph">!</span><span class="annot"><a href="GHC.Types.Demand.html#Card"><span class="hs-identifier hs-type">Card</span></a></span><span> </span><span id="%3A%2A"><span class="annot"><a href="GHC.Types.Demand.html#%3A%2A"><span class="hs-operator hs-var">:*</span></a></span></span><span> </span><span class="hs-glyph">!</span><span class="annot"><a href="GHC.Types.Demand.html#SubDemand"><span class="hs-identifier hs-type">SubDemand</span></a></span><span>
</span><span id="line-269"></span><span>  </span><span class="hs-keyword">deriving</span><span> </span><span id="local-6989586621680990934"><span id="local-6989586621680990938"><span class="annot"><span class="annottext">Demand -&gt; Demand -&gt; Bool
forall a. (a -&gt; a -&gt; Bool) -&gt; (a -&gt; a -&gt; Bool) -&gt; Eq a
/= :: Demand -&gt; Demand -&gt; Bool
$c/= :: Demand -&gt; Demand -&gt; Bool
== :: Demand -&gt; Demand -&gt; Bool
$c== :: Demand -&gt; Demand -&gt; Bool
</span><span class="hs-identifier hs-var hs-var hs-var hs-var hs-var hs-var">Eq</span></span></span></span><span>
</span><span id="line-270"></span><span>
</span><span id="line-271"></span><span class="hs-comment">-- | A sub-demand describes an /evaluation context/, e.g. how deep the</span><span>
</span><span id="line-272"></span><span class="hs-comment">-- denoted thing is evaluated. See 'Demand' for examples.</span><span>
</span><span id="line-273"></span><span class="hs-comment">--</span><span>
</span><span id="line-274"></span><span class="hs-comment">-- The nested 'SubDemand' @d@ of a 'Call' @Cn(d)@ is /relative/ to a single such call.</span><span>
</span><span id="line-275"></span><span class="hs-comment">-- E.g. The expression @f 1 2 + f 3 4@ puts call demand @SCS(C1(L))@ on @f@:</span><span>
</span><span id="line-276"></span><span class="hs-comment">-- @f@ is called exactly twice (@S@), each time exactly once (@1@) with an</span><span>
</span><span id="line-277"></span><span class="hs-comment">-- additional argument.</span><span>
</span><span id="line-278"></span><span class="hs-comment">--</span><span>
</span><span id="line-279"></span><span class="hs-comment">-- The nested 'Demand's @dn@ of a 'Prod' @P(d1,d2,...)@ apply /absolutely/:</span><span>
</span><span id="line-280"></span><span class="hs-comment">-- If @dn@ is a used once demand (cf. 'isUsedOnce'), then that means that</span><span>
</span><span id="line-281"></span><span class="hs-comment">-- the denoted sub-expression is used once in the entire evaluation context</span><span>
</span><span id="line-282"></span><span class="hs-comment">-- described by the surrounding 'Demand'. E.g., @LP(ML)@ means that the</span><span>
</span><span id="line-283"></span><span class="hs-comment">-- field of the denoted expression is used at most once, although the</span><span>
</span><span id="line-284"></span><span class="hs-comment">-- entire expression might be used many times.</span><span>
</span><span id="line-285"></span><span class="hs-comment">--</span><span>
</span><span id="line-286"></span><span class="hs-comment">-- See Note [Call demands are relative]</span><span>
</span><span id="line-287"></span><span class="hs-comment">-- and Note [Demand notation].</span><span>
</span><span id="line-288"></span><span class="hs-keyword">data</span><span> </span><span id="SubDemand"><span class="annot"><a href="GHC.Types.Demand.html#SubDemand"><span class="hs-identifier hs-var">SubDemand</span></a></span></span><span>
</span><span id="line-289"></span><span>  </span><span class="hs-glyph">=</span><span> </span><span id="Poly"><span class="annot"><a href="GHC.Types.Demand.html#Poly"><span class="hs-identifier hs-var">Poly</span></a></span></span><span> </span><span class="hs-glyph">!</span><span class="annot"><a href="GHC.Types.Demand.html#Card"><span class="hs-identifier hs-type">Card</span></a></span><span>
</span><span id="line-290"></span><span>  </span><span class="hs-comment">-- ^ Polymorphic demand, the denoted thing is evaluated arbitrarily deep,</span><span>
</span><span id="line-291"></span><span>  </span><span class="hs-comment">-- with the specified cardinality at every level.</span><span>
</span><span id="line-292"></span><span>  </span><span class="hs-comment">-- Expands to 'Call' via 'viewCall' and to 'Prod' via 'viewProd'.</span><span>
</span><span id="line-293"></span><span>  </span><span class="hs-comment">--</span><span>
</span><span id="line-294"></span><span>  </span><span class="hs-comment">-- @Poly n@ is semantically equivalent to @Prod [n :* Poly n, ...]@ or</span><span>
</span><span id="line-295"></span><span>  </span><span class="hs-comment">-- @Call n (Poly n)@. 'mkCall' and 'mkProd' do these rewrites.</span><span>
</span><span id="line-296"></span><span>  </span><span class="hs-comment">--</span><span>
</span><span id="line-297"></span><span>  </span><span class="hs-comment">-- In Note [Demand notation]: @L === P(L,L,...)@ and @L === CL(L)@,</span><span>
</span><span id="line-298"></span><span>  </span><span class="hs-comment">--                            @1 === P(1,1,...)@ and @1 === C1(1)@, and so on.</span><span>
</span><span id="line-299"></span><span>  </span><span class="hs-comment">--</span><span>
</span><span id="line-300"></span><span>  </span><span class="hs-comment">-- We only really use 'Poly' with 'C_10' (B), 'C_00' (A), 'C_0N' (L) and</span><span>
</span><span id="line-301"></span><span>  </span><span class="hs-comment">-- sometimes 'C_1N' (S), but it's simpler to treat it uniformly than to</span><span>
</span><span id="line-302"></span><span>  </span><span class="hs-comment">-- have a special constructor for each of the three cases.</span><span>
</span><span id="line-303"></span><span>  </span><span class="hs-glyph">|</span><span> </span><span id="Call"><span class="annot"><a href="GHC.Types.Demand.html#Call"><span class="hs-identifier hs-var">Call</span></a></span></span><span> </span><span class="hs-glyph">!</span><span class="annot"><a href="GHC.Types.Demand.html#Card"><span class="hs-identifier hs-type">Card</span></a></span><span> </span><span class="hs-glyph">!</span><span class="annot"><a href="GHC.Types.Demand.html#SubDemand"><span class="hs-identifier hs-type">SubDemand</span></a></span><span>
</span><span id="line-304"></span><span>  </span><span class="hs-comment">-- ^ @Call n sd@ describes the evaluation context of @n@ function</span><span>
</span><span id="line-305"></span><span>  </span><span class="hs-comment">-- applications, where every individual result is evaluated according to @sd@.</span><span>
</span><span id="line-306"></span><span>  </span><span class="hs-comment">-- @sd@ is /relative/ to a single call, cf. Note [Call demands are relative].</span><span>
</span><span id="line-307"></span><span>  </span><span class="hs-comment">-- Used only for values of function type. Use the smart constructor 'mkCall'</span><span>
</span><span id="line-308"></span><span>  </span><span class="hs-comment">-- whenever possible!</span><span>
</span><span id="line-309"></span><span>  </span><span class="hs-glyph">|</span><span> </span><span id="Prod"><span class="annot"><a href="GHC.Types.Demand.html#Prod"><span class="hs-identifier hs-var">Prod</span></a></span></span><span> </span><span class="hs-glyph">!</span><span class="hs-special">[</span><span class="annot"><a href="GHC.Types.Demand.html#Demand"><span class="hs-identifier hs-type">Demand</span></a></span><span class="hs-special">]</span><span>
</span><span id="line-310"></span><span>  </span><span class="hs-comment">-- ^ @Prod ds@ describes the evaluation context of a case scrutinisation</span><span>
</span><span id="line-311"></span><span>  </span><span class="hs-comment">-- on an expression of product type, where the product components are</span><span>
</span><span id="line-312"></span><span>  </span><span class="hs-comment">-- evaluated according to @ds@.</span><span>
</span><span id="line-313"></span><span>  </span><span class="hs-keyword">deriving</span><span> </span><span id="local-6989586621680990923"><span id="local-6989586621680990930"><span class="annot"><span class="annottext">SubDemand -&gt; SubDemand -&gt; Bool
forall a. (a -&gt; a -&gt; Bool) -&gt; (a -&gt; a -&gt; Bool) -&gt; Eq a
/= :: SubDemand -&gt; SubDemand -&gt; Bool
$c/= :: SubDemand -&gt; SubDemand -&gt; Bool
== :: SubDemand -&gt; SubDemand -&gt; Bool
$c== :: SubDemand -&gt; SubDemand -&gt; Bool
</span><span class="hs-identifier hs-var hs-var hs-var hs-var hs-var hs-var">Eq</span></span></span></span><span>
</span><span id="line-314"></span><span>
</span><span id="line-315"></span><span class="annot"><a href="GHC.Types.Demand.html#poly00"><span class="hs-identifier hs-type">poly00</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><a href="GHC.Types.Demand.html#poly01"><span class="hs-identifier hs-type">poly01</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><a href="GHC.Types.Demand.html#poly0N"><span class="hs-identifier hs-type">poly0N</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><a href="GHC.Types.Demand.html#poly11"><span class="hs-identifier hs-type">poly11</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><a href="GHC.Types.Demand.html#poly1N"><span class="hs-identifier hs-type">poly1N</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><a href="GHC.Types.Demand.html#poly10"><span class="hs-identifier hs-type">poly10</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><a href="GHC.Types.Demand.html#SubDemand"><span class="hs-identifier hs-type">SubDemand</span></a></span><span>
</span><span id="line-316"></span><span class="annot"><a href="GHC.Types.Demand.html#topSubDmd"><span class="hs-identifier hs-type">topSubDmd</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><a href="GHC.Types.Demand.html#botSubDmd"><span class="hs-identifier hs-type">botSubDmd</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><a href="GHC.Types.Demand.html#seqSubDmd"><span class="hs-identifier hs-type">seqSubDmd</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><a href="GHC.Types.Demand.html#SubDemand"><span class="hs-identifier hs-type">SubDemand</span></a></span><span>
</span><span id="line-317"></span><span id="poly00"><span class="annot"><span class="annottext">poly00 :: SubDemand
</span><a href="GHC.Types.Demand.html#poly00"><span class="hs-identifier hs-var hs-var">poly00</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">Card -&gt; SubDemand
</span><a href="GHC.Types.Demand.html#Poly"><span class="hs-identifier hs-var">Poly</span></a></span><span> </span><span class="annot"><span class="annottext">Card
</span><a href="GHC.Types.Demand.html#C_00"><span class="hs-identifier hs-var">C_00</span></a></span><span>
</span><span id="line-318"></span><span id="poly01"><span class="annot"><span class="annottext">poly01 :: SubDemand
</span><a href="GHC.Types.Demand.html#poly01"><span class="hs-identifier hs-var hs-var">poly01</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">Card -&gt; SubDemand
</span><a href="GHC.Types.Demand.html#Poly"><span class="hs-identifier hs-var">Poly</span></a></span><span> </span><span class="annot"><span class="annottext">Card
</span><a href="GHC.Types.Demand.html#C_01"><span class="hs-identifier hs-var">C_01</span></a></span><span>
</span><span id="line-319"></span><span id="poly0N"><span class="annot"><span class="annottext">poly0N :: SubDemand
</span><a href="GHC.Types.Demand.html#poly0N"><span class="hs-identifier hs-var hs-var">poly0N</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">Card -&gt; SubDemand
</span><a href="GHC.Types.Demand.html#Poly"><span class="hs-identifier hs-var">Poly</span></a></span><span> </span><span class="annot"><span class="annottext">Card
</span><a href="GHC.Types.Demand.html#C_0N"><span class="hs-identifier hs-var">C_0N</span></a></span><span>
</span><span id="line-320"></span><span id="poly11"><span class="annot"><span class="annottext">poly11 :: SubDemand
</span><a href="GHC.Types.Demand.html#poly11"><span class="hs-identifier hs-var hs-var">poly11</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">Card -&gt; SubDemand
</span><a href="GHC.Types.Demand.html#Poly"><span class="hs-identifier hs-var">Poly</span></a></span><span> </span><span class="annot"><span class="annottext">Card
</span><a href="GHC.Types.Demand.html#C_11"><span class="hs-identifier hs-var">C_11</span></a></span><span>
</span><span id="line-321"></span><span id="poly1N"><span class="annot"><span class="annottext">poly1N :: SubDemand
</span><a href="GHC.Types.Demand.html#poly1N"><span class="hs-identifier hs-var hs-var">poly1N</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">Card -&gt; SubDemand
</span><a href="GHC.Types.Demand.html#Poly"><span class="hs-identifier hs-var">Poly</span></a></span><span> </span><span class="annot"><span class="annottext">Card
</span><a href="GHC.Types.Demand.html#C_1N"><span class="hs-identifier hs-var">C_1N</span></a></span><span>
</span><span id="line-322"></span><span id="poly10"><span class="annot"><span class="annottext">poly10 :: SubDemand
</span><a href="GHC.Types.Demand.html#poly10"><span class="hs-identifier hs-var hs-var">poly10</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">Card -&gt; SubDemand
</span><a href="GHC.Types.Demand.html#Poly"><span class="hs-identifier hs-var">Poly</span></a></span><span> </span><span class="annot"><span class="annottext">Card
</span><a href="GHC.Types.Demand.html#C_10"><span class="hs-identifier hs-var">C_10</span></a></span><span>
</span><span id="line-323"></span><span id="topSubDmd"><span class="annot"><span class="annottext">topSubDmd :: SubDemand
</span><a href="GHC.Types.Demand.html#topSubDmd"><span class="hs-identifier hs-var hs-var">topSubDmd</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">SubDemand
</span><a href="GHC.Types.Demand.html#poly0N"><span class="hs-identifier hs-var">poly0N</span></a></span><span>
</span><span id="line-324"></span><span id="botSubDmd"><span class="annot"><span class="annottext">botSubDmd :: SubDemand
</span><a href="GHC.Types.Demand.html#botSubDmd"><span class="hs-identifier hs-var hs-var">botSubDmd</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">SubDemand
</span><a href="GHC.Types.Demand.html#poly10"><span class="hs-identifier hs-var">poly10</span></a></span><span>
</span><span id="line-325"></span><span id="seqSubDmd"><span class="annot"><span class="annottext">seqSubDmd :: SubDemand
</span><a href="GHC.Types.Demand.html#seqSubDmd"><span class="hs-identifier hs-var hs-var">seqSubDmd</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">SubDemand
</span><a href="GHC.Types.Demand.html#poly00"><span class="hs-identifier hs-var">poly00</span></a></span><span>
</span><span id="line-326"></span><span>
</span><span id="line-327"></span><span class="annot"><a href="GHC.Types.Demand.html#polyDmd"><span class="hs-identifier hs-type">polyDmd</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><a href="GHC.Types.Demand.html#Card"><span class="hs-identifier hs-type">Card</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="GHC.Types.Demand.html#Demand"><span class="hs-identifier hs-type">Demand</span></a></span><span>
</span><span id="line-328"></span><span id="polyDmd"><span class="annot"><span class="annottext">polyDmd :: Card -&gt; Demand
</span><a href="GHC.Types.Demand.html#polyDmd"><span class="hs-identifier hs-var hs-var">polyDmd</span></a></span></span><span> </span><span class="annot"><span class="annottext">Card
</span><a href="GHC.Types.Demand.html#C_00"><span class="hs-identifier hs-var">C_00</span></a></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">Card
</span><a href="GHC.Types.Demand.html#C_00"><span class="hs-identifier hs-var">C_00</span></a></span><span> </span><span class="annot"><span class="annottext">Card -&gt; SubDemand -&gt; Demand
</span><a href="GHC.Types.Demand.html#%3A%2A"><span class="hs-operator hs-var">:*</span></a></span><span> </span><span class="annot"><span class="annottext">SubDemand
</span><a href="GHC.Types.Demand.html#poly00"><span class="hs-identifier hs-var">poly00</span></a></span><span>
</span><span id="line-329"></span><span class="annot"><a href="GHC.Types.Demand.html#polyDmd"><span class="hs-identifier hs-var">polyDmd</span></a></span><span> </span><span class="annot"><span class="annottext">Card
</span><a href="GHC.Types.Demand.html#C_01"><span class="hs-identifier hs-var">C_01</span></a></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">Card
</span><a href="GHC.Types.Demand.html#C_01"><span class="hs-identifier hs-var">C_01</span></a></span><span> </span><span class="annot"><span class="annottext">Card -&gt; SubDemand -&gt; Demand
</span><a href="GHC.Types.Demand.html#%3A%2A"><span class="hs-operator hs-var">:*</span></a></span><span> </span><span class="annot"><span class="annottext">SubDemand
</span><a href="GHC.Types.Demand.html#poly01"><span class="hs-identifier hs-var">poly01</span></a></span><span>
</span><span id="line-330"></span><span class="annot"><a href="GHC.Types.Demand.html#polyDmd"><span class="hs-identifier hs-var">polyDmd</span></a></span><span> </span><span class="annot"><span class="annottext">Card
</span><a href="GHC.Types.Demand.html#C_0N"><span class="hs-identifier hs-var">C_0N</span></a></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">Card
</span><a href="GHC.Types.Demand.html#C_0N"><span class="hs-identifier hs-var">C_0N</span></a></span><span> </span><span class="annot"><span class="annottext">Card -&gt; SubDemand -&gt; Demand
</span><a href="GHC.Types.Demand.html#%3A%2A"><span class="hs-operator hs-var">:*</span></a></span><span> </span><span class="annot"><span class="annottext">SubDemand
</span><a href="GHC.Types.Demand.html#poly0N"><span class="hs-identifier hs-var">poly0N</span></a></span><span>
</span><span id="line-331"></span><span class="annot"><a href="GHC.Types.Demand.html#polyDmd"><span class="hs-identifier hs-var">polyDmd</span></a></span><span> </span><span class="annot"><span class="annottext">Card
</span><a href="GHC.Types.Demand.html#C_11"><span class="hs-identifier hs-var">C_11</span></a></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">Card
</span><a href="GHC.Types.Demand.html#C_11"><span class="hs-identifier hs-var">C_11</span></a></span><span> </span><span class="annot"><span class="annottext">Card -&gt; SubDemand -&gt; Demand
</span><a href="GHC.Types.Demand.html#%3A%2A"><span class="hs-operator hs-var">:*</span></a></span><span> </span><span class="annot"><span class="annottext">SubDemand
</span><a href="GHC.Types.Demand.html#poly11"><span class="hs-identifier hs-var">poly11</span></a></span><span>
</span><span id="line-332"></span><span class="annot"><a href="GHC.Types.Demand.html#polyDmd"><span class="hs-identifier hs-var">polyDmd</span></a></span><span> </span><span class="annot"><span class="annottext">Card
</span><a href="GHC.Types.Demand.html#C_1N"><span class="hs-identifier hs-var">C_1N</span></a></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">Card
</span><a href="GHC.Types.Demand.html#C_1N"><span class="hs-identifier hs-var">C_1N</span></a></span><span> </span><span class="annot"><span class="annottext">Card -&gt; SubDemand -&gt; Demand
</span><a href="GHC.Types.Demand.html#%3A%2A"><span class="hs-operator hs-var">:*</span></a></span><span> </span><span class="annot"><span class="annottext">SubDemand
</span><a href="GHC.Types.Demand.html#poly1N"><span class="hs-identifier hs-var">poly1N</span></a></span><span>
</span><span id="line-333"></span><span class="annot"><a href="GHC.Types.Demand.html#polyDmd"><span class="hs-identifier hs-var">polyDmd</span></a></span><span> </span><span class="annot"><span class="annottext">Card
</span><a href="GHC.Types.Demand.html#C_10"><span class="hs-identifier hs-var">C_10</span></a></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">Card
</span><a href="GHC.Types.Demand.html#C_10"><span class="hs-identifier hs-var">C_10</span></a></span><span> </span><span class="annot"><span class="annottext">Card -&gt; SubDemand -&gt; Demand
</span><a href="GHC.Types.Demand.html#%3A%2A"><span class="hs-operator hs-var">:*</span></a></span><span> </span><span class="annot"><span class="annottext">SubDemand
</span><a href="GHC.Types.Demand.html#poly10"><span class="hs-identifier hs-var">poly10</span></a></span><span>
</span><span id="line-334"></span><span>
</span><span id="line-335"></span><span class="hs-comment">-- | A smart constructor for 'Prod', applying rewrite rules along the semantic</span><span>
</span><span id="line-336"></span><span class="hs-comment">-- equality @Prod [polyDmd n, ...] === polyDmd n@, simplifying to 'Poly'</span><span>
</span><span id="line-337"></span><span class="hs-comment">-- 'SubDemand's when possible. Note that this degrades boxity information! E.g. a</span><span>
</span><span id="line-338"></span><span class="hs-comment">-- polymorphic demand will never unbox.</span><span>
</span><span id="line-339"></span><span class="annot"><a href="GHC.Types.Demand.html#mkProd"><span class="hs-identifier hs-type">mkProd</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="hs-special">[</span><span class="annot"><a href="GHC.Types.Demand.html#Demand"><span class="hs-identifier hs-type">Demand</span></a></span><span class="hs-special">]</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="GHC.Types.Demand.html#SubDemand"><span class="hs-identifier hs-type">SubDemand</span></a></span><span>
</span><span id="line-340"></span><span id="mkProd"><span class="annot"><span class="annottext">mkProd :: [Demand] -&gt; SubDemand
</span><a href="GHC.Types.Demand.html#mkProd"><span class="hs-identifier hs-var hs-var">mkProd</span></a></span></span><span> </span><span class="hs-special">[</span><span class="hs-special">]</span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">SubDemand
</span><a href="GHC.Types.Demand.html#seqSubDmd"><span class="hs-identifier hs-var">seqSubDmd</span></a></span><span>
</span><span id="line-341"></span><span class="annot"><a href="GHC.Types.Demand.html#mkProd"><span class="hs-identifier hs-var">mkProd</span></a></span><span> </span><span id="local-6989586621680990913"><span class="annot"><span class="annottext">ds :: [Demand]
</span><a href="#local-6989586621680990913"><span class="hs-identifier hs-var">ds</span></a></span></span><span class="hs-glyph">@</span><span class="hs-special">(</span><span id="local-6989586621680990912"><span class="annot"><span class="annottext">Card
</span><a href="#local-6989586621680990912"><span class="hs-identifier hs-var">n</span></a></span></span><span class="annot"><a href="GHC.Types.Demand.html#%3A%2A"><span class="hs-operator hs-type">:*</span></a></span><span id="local-6989586621680990911"><span class="annot"><span class="annottext">SubDemand
</span><a href="#local-6989586621680990911"><span class="hs-identifier hs-var">sd</span></a></span></span><span> </span><span class="annot"><span class="hs-glyph hs-type">:</span></span><span> </span><span class="annot"><span class="annottext">[Demand]
</span><span class="hs-identifier">_</span></span><span class="hs-special">)</span><span>
</span><span id="line-342"></span><span>  </span><span class="hs-glyph">|</span><span> </span><span class="annot"><span class="annottext">Card -&gt; Bool
</span><a href="#local-6989586621680990910"><span class="hs-identifier hs-var">want_to_simplify</span></a></span><span> </span><span class="annot"><span class="annottext">Card
</span><a href="#local-6989586621680990912"><span class="hs-identifier hs-var">n</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">forall (t :: * -&gt; *) a. Foldable t =&gt; (a -&gt; Bool) -&gt; t a -&gt; Bool
</span><a href="../../base-4.16.4.0/src/Data-Foldable.html#all"><span class="hs-identifier hs-var">all</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">forall a. Eq a =&gt; a -&gt; a -&gt; Bool
</span><span class="hs-operator hs-var">==</span></span><span> </span><span class="annot"><span class="annottext">Card -&gt; Demand
</span><a href="GHC.Types.Demand.html#polyDmd"><span class="hs-identifier hs-var">polyDmd</span></a></span><span> </span><span class="annot"><span class="annottext">Card
</span><a href="#local-6989586621680990912"><span class="hs-identifier hs-var">n</span></a></span><span class="hs-special">)</span><span> </span><span class="annot"><span class="annottext">[Demand]
</span><a href="#local-6989586621680990913"><span class="hs-identifier hs-var">ds</span></a></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">SubDemand
</span><a href="#local-6989586621680990911"><span class="hs-identifier hs-var">sd</span></a></span><span>
</span><span id="line-343"></span><span>  </span><span class="hs-glyph">|</span><span> </span><span class="annot"><span class="annottext">Bool
</span><a href="../../base-4.16.4.0/src/GHC-Base.html#otherwise"><span class="hs-identifier hs-var">otherwise</span></a></span><span>                                 </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">[Demand] -&gt; SubDemand
</span><a href="GHC.Types.Demand.html#Prod"><span class="hs-identifier hs-var">Prod</span></a></span><span> </span><span class="annot"><span class="annottext">[Demand]
</span><a href="#local-6989586621680990913"><span class="hs-identifier hs-var">ds</span></a></span><span>
</span><span id="line-344"></span><span>  </span><span class="hs-keyword">where</span><span>
</span><span id="line-345"></span><span>    </span><span class="hs-comment">-- We only want to simplify absent and bottom demands and unbox the others.</span><span>
</span><span id="line-346"></span><span>    </span><span class="hs-comment">-- See also Note [L should win] and Note [Don't optimise LP(L,L,...) to L].</span><span>
</span><span id="line-347"></span><span>    </span><span id="local-6989586621680990910"><span class="annot"><span class="annottext">want_to_simplify :: Card -&gt; Bool
</span><a href="#local-6989586621680990910"><span class="hs-identifier hs-var hs-var">want_to_simplify</span></a></span></span><span> </span><span class="annot"><span class="annottext">Card
</span><a href="GHC.Types.Demand.html#C_00"><span class="hs-identifier hs-var">C_00</span></a></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">Bool
</span><span class="hs-identifier hs-var">True</span></span><span>
</span><span id="line-348"></span><span>    </span><span class="annot"><a href="#local-6989586621680990910"><span class="hs-identifier hs-var">want_to_simplify</span></a></span><span> </span><span class="annot"><span class="annottext">Card
</span><a href="GHC.Types.Demand.html#C_10"><span class="hs-identifier hs-var">C_10</span></a></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">Bool
</span><span class="hs-identifier hs-var">True</span></span><span>
</span><span id="line-349"></span><span>    </span><span class="annot"><a href="#local-6989586621680990910"><span class="hs-identifier hs-var">want_to_simplify</span></a></span><span> </span><span class="annot"><span class="annottext">Card
</span><span class="hs-identifier">_</span></span><span>    </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">Bool
</span><span class="hs-identifier hs-var">False</span></span><span>
</span><span id="line-350"></span><span>
</span><span id="line-351"></span><span class="hs-comment">-- | @viewProd n sd@ interprets @sd@ as a 'Prod' of arity @n@, expanding 'Poly'</span><span>
</span><span id="line-352"></span><span class="hs-comment">-- demands as necessary.</span><span>
</span><span id="line-353"></span><span class="annot"><a href="GHC.Types.Demand.html#viewProd"><span class="hs-identifier hs-type">viewProd</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><a href="GHC.Types.Basic.html#Arity"><span class="hs-identifier hs-type">Arity</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="GHC.Types.Demand.html#SubDemand"><span class="hs-identifier hs-type">SubDemand</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="../../base-4.16.4.0/src/GHC-Maybe.html#Maybe"><span class="hs-identifier hs-type">Maybe</span></a></span><span> </span><span class="hs-special">[</span><span class="annot"><a href="GHC.Types.Demand.html#Demand"><span class="hs-identifier hs-type">Demand</span></a></span><span class="hs-special">]</span><span>
</span><span id="line-354"></span><span class="hs-comment">-- It's quite important that this function is optimised well;</span><span>
</span><span id="line-355"></span><span class="hs-comment">-- it is used by lubSubDmd and plusSubDmd. Note the strict</span><span>
</span><span id="line-356"></span><span class="hs-comment">-- application to 'polyDmd':</span><span>
</span><span id="line-357"></span><span id="viewProd"><span class="annot"><span class="annottext">viewProd :: Int -&gt; SubDemand -&gt; Maybe [Demand]
</span><a href="GHC.Types.Demand.html#viewProd"><span class="hs-identifier hs-var hs-var">viewProd</span></a></span></span><span> </span><span id="local-6989586621680990907"><span class="annot"><span class="annottext">Int
</span><a href="#local-6989586621680990907"><span class="hs-identifier hs-var">n</span></a></span></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="GHC.Types.Demand.html#Prod"><span class="hs-identifier hs-type">Prod</span></a></span><span> </span><span id="local-6989586621680990906"><span class="annot"><span class="annottext">[Demand]
</span><a href="#local-6989586621680990906"><span class="hs-identifier hs-var">ds</span></a></span></span><span class="hs-special">)</span><span>   </span><span class="hs-glyph">|</span><span> </span><span class="annot"><span class="annottext">[Demand]
</span><a href="#local-6989586621680990906"><span class="hs-identifier hs-var">ds</span></a></span><span> </span><span class="annot"><span class="annottext">forall a. [a] -&gt; Int -&gt; Bool
</span><a href="GHC.Utils.Misc.html#lengthIs"><span class="hs-operator hs-var">`lengthIs`</span></a></span><span> </span><span class="annot"><span class="annottext">Int
</span><a href="#local-6989586621680990907"><span class="hs-identifier hs-var">n</span></a></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">forall a. a -&gt; Maybe a
</span><a href="../../base-4.16.4.0/src/GHC-Maybe.html#Just"><span class="hs-identifier hs-var">Just</span></a></span><span> </span><span class="annot"><span class="annottext">[Demand]
</span><a href="#local-6989586621680990906"><span class="hs-identifier hs-var">ds</span></a></span><span>
</span><span id="line-358"></span><span class="hs-comment">-- Note the strict application to replicate: This makes sure we don't allocate</span><span>
</span><span id="line-359"></span><span class="hs-comment">-- a thunk for it, inlines it and lets case-of-case fire at call sites.</span><span>
</span><span id="line-360"></span><span class="annot"><a href="GHC.Types.Demand.html#viewProd"><span class="hs-identifier hs-var">viewProd</span></a></span><span> </span><span id="local-6989586621680990904"><span class="annot"><span class="annottext">Int
</span><a href="#local-6989586621680990904"><span class="hs-identifier hs-var">n</span></a></span></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="GHC.Types.Demand.html#Poly"><span class="hs-identifier hs-type">Poly</span></a></span><span> </span><span id="local-6989586621680990903"><span class="annot"><span class="annottext">Card
</span><a href="#local-6989586621680990903"><span class="hs-identifier hs-var">card</span></a></span></span><span class="hs-special">)</span><span>                   </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">forall a. a -&gt; Maybe a
</span><a href="../../base-4.16.4.0/src/GHC-Maybe.html#Just"><span class="hs-identifier hs-var">Just</span></a></span><span> </span><span class="annot"><span class="annottext">forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><a href="../../base-4.16.4.0/src/GHC-Base.html#%24%21"><span class="hs-operator hs-var">$!</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">forall a. Int -&gt; a -&gt; [a]
</span><a href="../../base-4.16.4.0/src/GHC-List.html#replicate"><span class="hs-identifier hs-var">replicate</span></a></span><span> </span><span class="annot"><span class="annottext">Int
</span><a href="#local-6989586621680990904"><span class="hs-identifier hs-var">n</span></a></span><span> </span><span class="annot"><span class="annottext">forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><a href="../../base-4.16.4.0/src/GHC-Base.html#%24%21"><span class="hs-operator hs-var">$!</span></a></span><span> </span><span class="annot"><span class="annottext">Card -&gt; Demand
</span><a href="GHC.Types.Demand.html#polyDmd"><span class="hs-identifier hs-var">polyDmd</span></a></span><span> </span><span class="annot"><span class="annottext">Card
</span><a href="#local-6989586621680990903"><span class="hs-identifier hs-var">card</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-361"></span><span class="annot"><a href="GHC.Types.Demand.html#viewProd"><span class="hs-identifier hs-var">viewProd</span></a></span><span> </span><span class="annot"><span class="annottext">Int
</span><span class="hs-identifier">_</span></span><span> </span><span class="annot"><span class="annottext">SubDemand
</span><span class="hs-identifier">_</span></span><span>                             </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">forall a. Maybe a
</span><a href="../../base-4.16.4.0/src/GHC-Maybe.html#Nothing"><span class="hs-identifier hs-var">Nothing</span></a></span><span>
</span><span id="line-362"></span><span class="hs-pragma">{-# INLINE</span><span> </span><span class="annot"><a href="GHC.Types.Demand.html#viewProd"><span class="hs-pragma hs-type">viewProd</span></a></span><span> </span><span class="hs-pragma">#-}</span><span> </span><span class="hs-comment">-- we want to fuse away the replicate and the allocation</span><span>
</span><span id="line-363"></span><span>                        </span><span class="hs-comment">-- for Arity. Otherwise, #18304 bites us.</span><span>
</span><span id="line-364"></span><span>
</span><span id="line-365"></span><span class="hs-comment">-- | A smart constructor for 'Call', applying rewrite rules along the semantic</span><span>
</span><span id="line-366"></span><span class="hs-comment">-- equality @Call n (Poly n) === Poly n@, simplifying to 'Poly' 'SubDemand's</span><span>
</span><span id="line-367"></span><span class="hs-comment">-- when possible.</span><span>
</span><span id="line-368"></span><span class="annot"><a href="GHC.Types.Demand.html#mkCall"><span class="hs-identifier hs-type">mkCall</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><a href="GHC.Types.Demand.html#Card"><span class="hs-identifier hs-type">Card</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="GHC.Types.Demand.html#SubDemand"><span class="hs-identifier hs-type">SubDemand</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="GHC.Types.Demand.html#SubDemand"><span class="hs-identifier hs-type">SubDemand</span></a></span><span>
</span><span id="line-369"></span><span id="mkCall"><span class="annot"><span class="annottext">mkCall :: Card -&gt; SubDemand -&gt; SubDemand
</span><a href="GHC.Types.Demand.html#mkCall"><span class="hs-identifier hs-var hs-var">mkCall</span></a></span></span><span> </span><span id="local-6989586621680990899"><span class="annot"><span class="annottext">Card
</span><a href="#local-6989586621680990899"><span class="hs-identifier hs-var">n</span></a></span></span><span> </span><span id="local-6989586621680990898"><span class="annot"><span class="annottext">cd :: SubDemand
</span><a href="#local-6989586621680990898"><span class="hs-identifier hs-var">cd</span></a></span></span><span class="hs-glyph">@</span><span class="hs-special">(</span><span class="annot"><a href="GHC.Types.Demand.html#Poly"><span class="hs-identifier hs-type">Poly</span></a></span><span> </span><span id="local-6989586621680990897"><span class="annot"><span class="annottext">Card
</span><a href="#local-6989586621680990897"><span class="hs-identifier hs-var">m</span></a></span></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">|</span><span> </span><span class="annot"><span class="annottext">Card
</span><a href="#local-6989586621680990899"><span class="hs-identifier hs-var">n</span></a></span><span> </span><span class="annot"><span class="annottext">forall a. Eq a =&gt; a -&gt; a -&gt; Bool
</span><span class="hs-operator hs-var">==</span></span><span> </span><span class="annot"><span class="annottext">Card
</span><a href="#local-6989586621680990897"><span class="hs-identifier hs-var">m</span></a></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">SubDemand
</span><a href="#local-6989586621680990898"><span class="hs-identifier hs-var">cd</span></a></span><span>
</span><span id="line-370"></span><span class="annot"><a href="GHC.Types.Demand.html#mkCall"><span class="hs-identifier hs-var">mkCall</span></a></span><span> </span><span id="local-6989586621680990896"><span class="annot"><span class="annottext">Card
</span><a href="#local-6989586621680990896"><span class="hs-identifier hs-var">n</span></a></span></span><span> </span><span id="local-6989586621680990895"><span class="annot"><span class="annottext">SubDemand
</span><a href="#local-6989586621680990895"><span class="hs-identifier hs-var">cd</span></a></span></span><span>                   </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">Card -&gt; SubDemand -&gt; SubDemand
</span><a href="GHC.Types.Demand.html#Call"><span class="hs-identifier hs-var">Call</span></a></span><span> </span><span class="annot"><span class="annottext">Card
</span><a href="#local-6989586621680990896"><span class="hs-identifier hs-var">n</span></a></span><span> </span><span class="annot"><span class="annottext">SubDemand
</span><a href="#local-6989586621680990895"><span class="hs-identifier hs-var">cd</span></a></span><span>
</span><span id="line-371"></span><span>
</span><span id="line-372"></span><span class="hs-comment">-- | @viewCall sd@ interprets @sd@ as a 'Call', expanding 'Poly' demands as</span><span>
</span><span id="line-373"></span><span class="hs-comment">-- necessary.</span><span>
</span><span id="line-374"></span><span class="annot"><a href="GHC.Types.Demand.html#viewCall"><span class="hs-identifier hs-type">viewCall</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><a href="GHC.Types.Demand.html#SubDemand"><span class="hs-identifier hs-type">SubDemand</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="../../base-4.16.4.0/src/GHC-Maybe.html#Maybe"><span class="hs-identifier hs-type">Maybe</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="GHC.Types.Demand.html#Card"><span class="hs-identifier hs-type">Card</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><a href="GHC.Types.Demand.html#SubDemand"><span class="hs-identifier hs-type">SubDemand</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-375"></span><span id="viewCall"><span class="annot"><span class="annottext">viewCall :: SubDemand -&gt; Maybe (Card, SubDemand)
</span><a href="GHC.Types.Demand.html#viewCall"><span class="hs-identifier hs-var hs-var">viewCall</span></a></span></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="GHC.Types.Demand.html#Call"><span class="hs-identifier hs-type">Call</span></a></span><span> </span><span id="local-6989586621680990893"><span class="annot"><span class="annottext">Card
</span><a href="#local-6989586621680990893"><span class="hs-identifier hs-var">n</span></a></span></span><span> </span><span id="local-6989586621680990892"><span class="annot"><span class="annottext">SubDemand
</span><a href="#local-6989586621680990892"><span class="hs-identifier hs-var">sd</span></a></span></span><span class="hs-special">)</span><span>    </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">forall a. a -&gt; Maybe a
</span><a href="../../base-4.16.4.0/src/GHC-Maybe.html#Just"><span class="hs-identifier hs-var">Just</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Card
</span><a href="#local-6989586621680990893"><span class="hs-identifier hs-var">n</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">SubDemand
</span><a href="#local-6989586621680990892"><span class="hs-identifier hs-var">sd</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-376"></span><span class="annot"><a href="GHC.Types.Demand.html#viewCall"><span class="hs-identifier hs-var">viewCall</span></a></span><span> </span><span id="local-6989586621680990891"><span class="annot"><span class="annottext">sd :: SubDemand
</span><a href="#local-6989586621680990891"><span class="hs-identifier hs-var">sd</span></a></span></span><span class="hs-glyph">@</span><span class="hs-special">(</span><span class="annot"><a href="GHC.Types.Demand.html#Poly"><span class="hs-identifier hs-type">Poly</span></a></span><span> </span><span id="local-6989586621680990890"><span class="annot"><span class="annottext">Card
</span><a href="#local-6989586621680990890"><span class="hs-identifier hs-var">card</span></a></span></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">forall a. a -&gt; Maybe a
</span><a href="../../base-4.16.4.0/src/GHC-Maybe.html#Just"><span class="hs-identifier hs-var">Just</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Card
</span><a href="#local-6989586621680990890"><span class="hs-identifier hs-var">card</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">SubDemand
</span><a href="#local-6989586621680990891"><span class="hs-identifier hs-var">sd</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-377"></span><span class="annot"><a href="GHC.Types.Demand.html#viewCall"><span class="hs-identifier hs-var">viewCall</span></a></span><span> </span><span class="annot"><span class="annottext">SubDemand
</span><span class="hs-identifier">_</span></span><span>              </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">forall a. Maybe a
</span><a href="../../base-4.16.4.0/src/GHC-Maybe.html#Nothing"><span class="hs-identifier hs-var">Nothing</span></a></span><span>
</span><span id="line-378"></span><span>
</span><span id="line-379"></span><span class="annot"><a href="GHC.Types.Demand.html#topDmd"><span class="hs-identifier hs-type">topDmd</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><a href="GHC.Types.Demand.html#absDmd"><span class="hs-identifier hs-type">absDmd</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><a href="GHC.Types.Demand.html#botDmd"><span class="hs-identifier hs-type">botDmd</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><a href="GHC.Types.Demand.html#seqDmd"><span class="hs-identifier hs-type">seqDmd</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><a href="GHC.Types.Demand.html#Demand"><span class="hs-identifier hs-type">Demand</span></a></span><span>
</span><span id="line-380"></span><span id="topDmd"><span class="annot"><span class="annottext">topDmd :: Demand
</span><a href="GHC.Types.Demand.html#topDmd"><span class="hs-identifier hs-var hs-var">topDmd</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">Card -&gt; Demand
</span><a href="GHC.Types.Demand.html#polyDmd"><span class="hs-identifier hs-var">polyDmd</span></a></span><span> </span><span class="annot"><span class="annottext">Card
</span><a href="GHC.Types.Demand.html#C_0N"><span class="hs-identifier hs-var">C_0N</span></a></span><span>
</span><span id="line-381"></span><span id="absDmd"><span class="annot"><span class="annottext">absDmd :: Demand
</span><a href="GHC.Types.Demand.html#absDmd"><span class="hs-identifier hs-var hs-var">absDmd</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">Card -&gt; Demand
</span><a href="GHC.Types.Demand.html#polyDmd"><span class="hs-identifier hs-var">polyDmd</span></a></span><span> </span><span class="annot"><span class="annottext">Card
</span><a href="GHC.Types.Demand.html#C_00"><span class="hs-identifier hs-var">C_00</span></a></span><span>
</span><span id="line-382"></span><span id="botDmd"><span class="annot"><span class="annottext">botDmd :: Demand
</span><a href="GHC.Types.Demand.html#botDmd"><span class="hs-identifier hs-var hs-var">botDmd</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">Card -&gt; Demand
</span><a href="GHC.Types.Demand.html#polyDmd"><span class="hs-identifier hs-var">polyDmd</span></a></span><span> </span><span class="annot"><span class="annottext">Card
</span><a href="GHC.Types.Demand.html#C_10"><span class="hs-identifier hs-var">C_10</span></a></span><span>
</span><span id="line-383"></span><span id="seqDmd"><span class="annot"><span class="annottext">seqDmd :: Demand
</span><a href="GHC.Types.Demand.html#seqDmd"><span class="hs-identifier hs-var hs-var">seqDmd</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">Card
</span><a href="GHC.Types.Demand.html#C_11"><span class="hs-identifier hs-var">C_11</span></a></span><span> </span><span class="annot"><span class="annottext">Card -&gt; SubDemand -&gt; Demand
</span><a href="GHC.Types.Demand.html#%3A%2A"><span class="hs-operator hs-var">:*</span></a></span><span> </span><span class="annot"><span class="annottext">SubDemand
</span><a href="GHC.Types.Demand.html#seqSubDmd"><span class="hs-identifier hs-var">seqSubDmd</span></a></span><span>
</span><span id="line-384"></span><span>
</span><span id="line-385"></span><span class="hs-comment">-- | Denotes '&#8746;' on 'SubDemand'.</span><span>
</span><span id="line-386"></span><span class="annot"><a href="GHC.Types.Demand.html#lubSubDmd"><span class="hs-identifier hs-type">lubSubDmd</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><a href="GHC.Types.Demand.html#SubDemand"><span class="hs-identifier hs-type">SubDemand</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="GHC.Types.Demand.html#SubDemand"><span class="hs-identifier hs-type">SubDemand</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="GHC.Types.Demand.html#SubDemand"><span class="hs-identifier hs-type">SubDemand</span></a></span><span>
</span><span id="line-387"></span><span class="hs-comment">-- Handle Prod</span><span>
</span><span id="line-388"></span><span id="lubSubDmd"><span class="annot"><span class="annottext">lubSubDmd :: SubDemand -&gt; SubDemand -&gt; SubDemand
</span><a href="GHC.Types.Demand.html#lubSubDmd"><span class="hs-identifier hs-var hs-var">lubSubDmd</span></a></span></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="GHC.Types.Demand.html#Prod"><span class="hs-identifier hs-type">Prod</span></a></span><span> </span><span id="local-6989586621680990889"><span class="annot"><span class="annottext">[Demand]
</span><a href="#local-6989586621680990889"><span class="hs-identifier hs-var">ds1</span></a></span></span><span class="hs-special">)</span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Int -&gt; SubDemand -&gt; Maybe [Demand]
</span><a href="GHC.Types.Demand.html#viewProd"><span class="hs-identifier hs-var">viewProd</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">forall (t :: * -&gt; *) a. Foldable t =&gt; t a -&gt; Int
</span><a href="../../base-4.16.4.0/src/Data-Foldable.html#length"><span class="hs-identifier hs-var">length</span></a></span><span> </span><span class="annot"><span class="annottext">[Demand]
</span><a href="#local-6989586621680990889"><span class="hs-identifier hs-var">ds1</span></a></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="../../base-4.16.4.0/src/GHC-Maybe.html#Just"><span class="hs-identifier hs-type">Just</span></a></span><span> </span><span id="local-6989586621680990887"><span class="annot"><span class="annottext">[Demand]
</span><a href="#local-6989586621680990887"><span class="hs-identifier hs-var">ds2</span></a></span></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">=</span><span>
</span><span id="line-389"></span><span>  </span><span class="annot"><span class="annottext">[Demand] -&gt; SubDemand
</span><a href="GHC.Types.Demand.html#Prod"><span class="hs-identifier hs-var">Prod</span></a></span><span> </span><span class="annot"><span class="annottext">forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><a href="../../base-4.16.4.0/src/GHC-Base.html#%24"><span class="hs-operator hs-var">$</span></a></span><span> </span><span class="annot"><span class="annottext">forall a b c. (a -&gt; b -&gt; c) -&gt; [a] -&gt; [b] -&gt; [c]
</span><a href="GHC.Utils.Misc.html#strictZipWith"><span class="hs-identifier hs-var">strictZipWith</span></a></span><span> </span><span class="annot"><span class="annottext">Demand -&gt; Demand -&gt; Demand
</span><a href="GHC.Types.Demand.html#lubDmd"><span class="hs-identifier hs-var">lubDmd</span></a></span><span> </span><span class="annot"><span class="annottext">[Demand]
</span><a href="#local-6989586621680990887"><span class="hs-identifier hs-var">ds2</span></a></span><span> </span><span class="annot"><span class="annottext">[Demand]
</span><a href="#local-6989586621680990889"><span class="hs-identifier hs-var">ds1</span></a></span><span> </span><span class="hs-comment">-- try to fuse with ds2</span><span>
</span><span id="line-390"></span><span class="hs-comment">-- Handle Call</span><span>
</span><span id="line-391"></span><span class="annot"><a href="GHC.Types.Demand.html#lubSubDmd"><span class="hs-identifier hs-var">lubSubDmd</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="GHC.Types.Demand.html#Call"><span class="hs-identifier hs-type">Call</span></a></span><span> </span><span id="local-6989586621680990885"><span class="annot"><span class="annottext">Card
</span><a href="#local-6989586621680990885"><span class="hs-identifier hs-var">n1</span></a></span></span><span> </span><span id="local-6989586621680990884"><span class="annot"><span class="annottext">SubDemand
</span><a href="#local-6989586621680990884"><span class="hs-identifier hs-var">d1</span></a></span></span><span class="hs-special">)</span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">SubDemand -&gt; Maybe (Card, SubDemand)
</span><a href="GHC.Types.Demand.html#viewCall"><span class="hs-identifier hs-var">viewCall</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="../../base-4.16.4.0/src/GHC-Maybe.html#Just"><span class="hs-identifier hs-type">Just</span></a></span><span> </span><span class="hs-special">(</span><span id="local-6989586621680990883"><span class="annot"><span class="annottext">Card
</span><a href="#local-6989586621680990883"><span class="hs-identifier hs-var">n2</span></a></span></span><span class="hs-special">,</span><span> </span><span id="local-6989586621680990882"><span class="annot"><span class="annottext">SubDemand
</span><a href="#local-6989586621680990882"><span class="hs-identifier hs-var">d2</span></a></span></span><span class="hs-special">)</span><span class="hs-special">)</span><span>
</span><span id="line-392"></span><span>  </span><span class="hs-comment">-- See Note [Call demands are relative]</span><span>
</span><span id="line-393"></span><span>  </span><span class="hs-glyph">|</span><span> </span><span class="annot"><span class="annottext">Card -&gt; Bool
</span><a href="GHC.Types.Demand.html#isAbs"><span class="hs-identifier hs-var">isAbs</span></a></span><span> </span><span class="annot"><span class="annottext">Card
</span><a href="#local-6989586621680990885"><span class="hs-identifier hs-var">n1</span></a></span><span>  </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">Card -&gt; SubDemand -&gt; SubDemand
</span><a href="GHC.Types.Demand.html#mkCall"><span class="hs-identifier hs-var">mkCall</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Card -&gt; Card -&gt; Card
</span><a href="GHC.Types.Demand.html#lubCard"><span class="hs-identifier hs-var">lubCard</span></a></span><span> </span><span class="annot"><span class="annottext">Card
</span><a href="#local-6989586621680990885"><span class="hs-identifier hs-var">n1</span></a></span><span> </span><span class="annot"><span class="annottext">Card
</span><a href="#local-6989586621680990883"><span class="hs-identifier hs-var">n2</span></a></span><span class="hs-special">)</span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">SubDemand -&gt; SubDemand -&gt; SubDemand
</span><a href="GHC.Types.Demand.html#lubSubDmd"><span class="hs-identifier hs-var">lubSubDmd</span></a></span><span> </span><span class="annot"><span class="annottext">SubDemand
</span><a href="GHC.Types.Demand.html#botSubDmd"><span class="hs-identifier hs-var">botSubDmd</span></a></span><span> </span><span class="annot"><span class="annottext">SubDemand
</span><a href="#local-6989586621680990882"><span class="hs-identifier hs-var">d2</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-394"></span><span>  </span><span class="hs-glyph">|</span><span> </span><span class="annot"><span class="annottext">Card -&gt; Bool
</span><a href="GHC.Types.Demand.html#isAbs"><span class="hs-identifier hs-var">isAbs</span></a></span><span> </span><span class="annot"><span class="annottext">Card
</span><a href="#local-6989586621680990883"><span class="hs-identifier hs-var">n2</span></a></span><span>  </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">Card -&gt; SubDemand -&gt; SubDemand
</span><a href="GHC.Types.Demand.html#mkCall"><span class="hs-identifier hs-var">mkCall</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Card -&gt; Card -&gt; Card
</span><a href="GHC.Types.Demand.html#lubCard"><span class="hs-identifier hs-var">lubCard</span></a></span><span> </span><span class="annot"><span class="annottext">Card
</span><a href="#local-6989586621680990885"><span class="hs-identifier hs-var">n1</span></a></span><span> </span><span class="annot"><span class="annottext">Card
</span><a href="#local-6989586621680990883"><span class="hs-identifier hs-var">n2</span></a></span><span class="hs-special">)</span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">SubDemand -&gt; SubDemand -&gt; SubDemand
</span><a href="GHC.Types.Demand.html#lubSubDmd"><span class="hs-identifier hs-var">lubSubDmd</span></a></span><span> </span><span class="annot"><span class="annottext">SubDemand
</span><a href="#local-6989586621680990884"><span class="hs-identifier hs-var">d1</span></a></span><span> </span><span class="annot"><span class="annottext">SubDemand
</span><a href="GHC.Types.Demand.html#botSubDmd"><span class="hs-identifier hs-var">botSubDmd</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-395"></span><span>  </span><span class="hs-glyph">|</span><span> </span><span class="annot"><span class="annottext">Bool
</span><a href="../../base-4.16.4.0/src/GHC-Base.html#otherwise"><span class="hs-identifier hs-var">otherwise</span></a></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">Card -&gt; SubDemand -&gt; SubDemand
</span><a href="GHC.Types.Demand.html#mkCall"><span class="hs-identifier hs-var">mkCall</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Card -&gt; Card -&gt; Card
</span><a href="GHC.Types.Demand.html#lubCard"><span class="hs-identifier hs-var">lubCard</span></a></span><span> </span><span class="annot"><span class="annottext">Card
</span><a href="#local-6989586621680990885"><span class="hs-identifier hs-var">n1</span></a></span><span> </span><span class="annot"><span class="annottext">Card
</span><a href="#local-6989586621680990883"><span class="hs-identifier hs-var">n2</span></a></span><span class="hs-special">)</span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">SubDemand -&gt; SubDemand -&gt; SubDemand
</span><a href="GHC.Types.Demand.html#lubSubDmd"><span class="hs-identifier hs-var">lubSubDmd</span></a></span><span> </span><span class="annot"><span class="annottext">SubDemand
</span><a href="#local-6989586621680990884"><span class="hs-identifier hs-var">d1</span></a></span><span>        </span><span class="annot"><span class="annottext">SubDemand
</span><a href="#local-6989586621680990882"><span class="hs-identifier hs-var">d2</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-396"></span><span class="hs-comment">-- Handle Poly</span><span>
</span><span id="line-397"></span><span class="annot"><a href="GHC.Types.Demand.html#lubSubDmd"><span class="hs-identifier hs-var">lubSubDmd</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="GHC.Types.Demand.html#Poly"><span class="hs-identifier hs-type">Poly</span></a></span><span> </span><span id="local-6989586621680990881"><span class="annot"><span class="annottext">Card
</span><a href="#local-6989586621680990881"><span class="hs-identifier hs-var">n1</span></a></span></span><span class="hs-special">)</span><span>  </span><span class="hs-special">(</span><span class="annot"><a href="GHC.Types.Demand.html#Poly"><span class="hs-identifier hs-type">Poly</span></a></span><span> </span><span id="local-6989586621680990880"><span class="annot"><span class="annottext">Card
</span><a href="#local-6989586621680990880"><span class="hs-identifier hs-var">n2</span></a></span></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">Card -&gt; SubDemand
</span><a href="GHC.Types.Demand.html#Poly"><span class="hs-identifier hs-var">Poly</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Card -&gt; Card -&gt; Card
</span><a href="GHC.Types.Demand.html#lubCard"><span class="hs-identifier hs-var">lubCard</span></a></span><span> </span><span class="annot"><span class="annottext">Card
</span><a href="#local-6989586621680990881"><span class="hs-identifier hs-var">n1</span></a></span><span> </span><span class="annot"><span class="annottext">Card
</span><a href="#local-6989586621680990880"><span class="hs-identifier hs-var">n2</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-398"></span><span class="hs-comment">-- Make use of reflexivity (so we'll match the Prod or Call cases again).</span><span>
</span><span id="line-399"></span><span class="annot"><a href="GHC.Types.Demand.html#lubSubDmd"><span class="hs-identifier hs-var">lubSubDmd</span></a></span><span> </span><span id="local-6989586621680990879"><span class="annot"><span class="annottext">sd1 :: SubDemand
</span><a href="#local-6989586621680990879"><span class="hs-identifier hs-var">sd1</span></a></span></span><span class="hs-glyph">@</span><span class="annot"><a href="GHC.Types.Demand.html#Poly"><span class="hs-identifier hs-type">Poly</span></a></span><span class="hs-special">{</span><span class="hs-special">}</span><span> </span><span id="local-6989586621680990878"><span class="annot"><span class="annottext">SubDemand
</span><a href="#local-6989586621680990878"><span class="hs-identifier hs-var">sd2</span></a></span></span><span>       </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">SubDemand -&gt; SubDemand -&gt; SubDemand
</span><a href="GHC.Types.Demand.html#lubSubDmd"><span class="hs-identifier hs-var">lubSubDmd</span></a></span><span> </span><span class="annot"><span class="annottext">SubDemand
</span><a href="#local-6989586621680990878"><span class="hs-identifier hs-var">sd2</span></a></span><span> </span><span class="annot"><span class="annottext">SubDemand
</span><a href="#local-6989586621680990879"><span class="hs-identifier hs-var">sd1</span></a></span><span>
</span><span id="line-400"></span><span class="hs-comment">-- Otherwise (Call `lub` Prod) return Top</span><span>
</span><span id="line-401"></span><span class="annot"><a href="GHC.Types.Demand.html#lubSubDmd"><span class="hs-identifier hs-var">lubSubDmd</span></a></span><span> </span><span class="annot"><span class="annottext">SubDemand
</span><span class="hs-identifier">_</span></span><span>          </span><span class="annot"><span class="annottext">SubDemand
</span><span class="hs-identifier">_</span></span><span>         </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">SubDemand
</span><a href="GHC.Types.Demand.html#topSubDmd"><span class="hs-identifier hs-var">topSubDmd</span></a></span><span>
</span><span id="line-402"></span><span>
</span><span id="line-403"></span><span class="hs-comment">-- | Denotes '&#8746;' on 'Demand'.</span><span>
</span><span id="line-404"></span><span class="annot"><a href="GHC.Types.Demand.html#lubDmd"><span class="hs-identifier hs-type">lubDmd</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><a href="GHC.Types.Demand.html#Demand"><span class="hs-identifier hs-type">Demand</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="GHC.Types.Demand.html#Demand"><span class="hs-identifier hs-type">Demand</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="GHC.Types.Demand.html#Demand"><span class="hs-identifier hs-type">Demand</span></a></span><span>
</span><span id="line-405"></span><span id="lubDmd"><span class="annot"><span class="annottext">lubDmd :: Demand -&gt; Demand -&gt; Demand
</span><a href="GHC.Types.Demand.html#lubDmd"><span class="hs-identifier hs-var hs-var">lubDmd</span></a></span></span><span> </span><span class="hs-special">(</span><span id="local-6989586621680990877"><span class="annot"><span class="annottext">Card
</span><a href="#local-6989586621680990877"><span class="hs-identifier hs-var">n1</span></a></span></span><span> </span><span class="annot"><a href="GHC.Types.Demand.html#%3A%2A"><span class="hs-operator hs-type">:*</span></a></span><span> </span><span id="local-6989586621680990876"><span class="annot"><span class="annottext">SubDemand
</span><a href="#local-6989586621680990876"><span class="hs-identifier hs-var">sd1</span></a></span></span><span class="hs-special">)</span><span> </span><span class="hs-special">(</span><span id="local-6989586621680990875"><span class="annot"><span class="annottext">Card
</span><a href="#local-6989586621680990875"><span class="hs-identifier hs-var">n2</span></a></span></span><span> </span><span class="annot"><a href="GHC.Types.Demand.html#%3A%2A"><span class="hs-operator hs-type">:*</span></a></span><span> </span><span id="local-6989586621680990874"><span class="annot"><span class="annottext">SubDemand
</span><a href="#local-6989586621680990874"><span class="hs-identifier hs-var">sd2</span></a></span></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">Card -&gt; Card -&gt; Card
</span><a href="GHC.Types.Demand.html#lubCard"><span class="hs-identifier hs-var">lubCard</span></a></span><span> </span><span class="annot"><span class="annottext">Card
</span><a href="#local-6989586621680990877"><span class="hs-identifier hs-var">n1</span></a></span><span> </span><span class="annot"><span class="annottext">Card
</span><a href="#local-6989586621680990875"><span class="hs-identifier hs-var">n2</span></a></span><span> </span><span class="annot"><span class="annottext">Card -&gt; SubDemand -&gt; Demand
</span><a href="GHC.Types.Demand.html#%3A%2A"><span class="hs-operator hs-var">:*</span></a></span><span> </span><span class="annot"><span class="annottext">SubDemand -&gt; SubDemand -&gt; SubDemand
</span><a href="GHC.Types.Demand.html#lubSubDmd"><span class="hs-identifier hs-var">lubSubDmd</span></a></span><span> </span><span class="annot"><span class="annottext">SubDemand
</span><a href="#local-6989586621680990876"><span class="hs-identifier hs-var">sd1</span></a></span><span> </span><span class="annot"><span class="annottext">SubDemand
</span><a href="#local-6989586621680990874"><span class="hs-identifier hs-var">sd2</span></a></span><span>
</span><span id="line-406"></span><span>
</span><span id="line-407"></span><span class="hs-comment">-- | Denotes '+' on 'SubDemand'.</span><span>
</span><span id="line-408"></span><span class="annot"><a href="GHC.Types.Demand.html#plusSubDmd"><span class="hs-identifier hs-type">plusSubDmd</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><a href="GHC.Types.Demand.html#SubDemand"><span class="hs-identifier hs-type">SubDemand</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="GHC.Types.Demand.html#SubDemand"><span class="hs-identifier hs-type">SubDemand</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="GHC.Types.Demand.html#SubDemand"><span class="hs-identifier hs-type">SubDemand</span></a></span><span>
</span><span id="line-409"></span><span class="hs-comment">-- Handle Prod</span><span>
</span><span id="line-410"></span><span id="plusSubDmd"><span class="annot"><span class="annottext">plusSubDmd :: SubDemand -&gt; SubDemand -&gt; SubDemand
</span><a href="GHC.Types.Demand.html#plusSubDmd"><span class="hs-identifier hs-var hs-var">plusSubDmd</span></a></span></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="GHC.Types.Demand.html#Prod"><span class="hs-identifier hs-type">Prod</span></a></span><span> </span><span id="local-6989586621680990873"><span class="annot"><span class="annottext">[Demand]
</span><a href="#local-6989586621680990873"><span class="hs-identifier hs-var">ds1</span></a></span></span><span class="hs-special">)</span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Int -&gt; SubDemand -&gt; Maybe [Demand]
</span><a href="GHC.Types.Demand.html#viewProd"><span class="hs-identifier hs-var">viewProd</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">forall (t :: * -&gt; *) a. Foldable t =&gt; t a -&gt; Int
</span><a href="../../base-4.16.4.0/src/Data-Foldable.html#length"><span class="hs-identifier hs-var">length</span></a></span><span> </span><span class="annot"><span class="annottext">[Demand]
</span><a href="#local-6989586621680990873"><span class="hs-identifier hs-var">ds1</span></a></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="../../base-4.16.4.0/src/GHC-Maybe.html#Just"><span class="hs-identifier hs-type">Just</span></a></span><span> </span><span id="local-6989586621680990872"><span class="annot"><span class="annottext">[Demand]
</span><a href="#local-6989586621680990872"><span class="hs-identifier hs-var">ds2</span></a></span></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">=</span><span>
</span><span id="line-411"></span><span>  </span><span class="annot"><span class="annottext">[Demand] -&gt; SubDemand
</span><a href="GHC.Types.Demand.html#Prod"><span class="hs-identifier hs-var">Prod</span></a></span><span> </span><span class="annot"><span class="annottext">forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><a href="../../base-4.16.4.0/src/GHC-Base.html#%24"><span class="hs-operator hs-var">$</span></a></span><span> </span><span class="annot"><span class="annottext">forall a b c. (a -&gt; b -&gt; c) -&gt; [a] -&gt; [b] -&gt; [c]
</span><a href="../../base-4.16.4.0/src/GHC-List.html#zipWith"><span class="hs-identifier hs-var">zipWith</span></a></span><span> </span><span class="annot"><span class="annottext">Demand -&gt; Demand -&gt; Demand
</span><a href="GHC.Types.Demand.html#plusDmd"><span class="hs-identifier hs-var">plusDmd</span></a></span><span> </span><span class="annot"><span class="annottext">[Demand]
</span><a href="#local-6989586621680990872"><span class="hs-identifier hs-var">ds2</span></a></span><span> </span><span class="annot"><span class="annottext">[Demand]
</span><a href="#local-6989586621680990873"><span class="hs-identifier hs-var">ds1</span></a></span><span> </span><span class="hs-comment">-- try to fuse with ds2</span><span>
</span><span id="line-412"></span><span class="hs-comment">-- Handle Call</span><span>
</span><span id="line-413"></span><span class="annot"><a href="GHC.Types.Demand.html#plusSubDmd"><span class="hs-identifier hs-var">plusSubDmd</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="GHC.Types.Demand.html#Call"><span class="hs-identifier hs-type">Call</span></a></span><span> </span><span id="local-6989586621680990870"><span class="annot"><span class="annottext">Card
</span><a href="#local-6989586621680990870"><span class="hs-identifier hs-var">n1</span></a></span></span><span> </span><span id="local-6989586621680990869"><span class="annot"><span class="annottext">SubDemand
</span><a href="#local-6989586621680990869"><span class="hs-identifier hs-var">d1</span></a></span></span><span class="hs-special">)</span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">SubDemand -&gt; Maybe (Card, SubDemand)
</span><a href="GHC.Types.Demand.html#viewCall"><span class="hs-identifier hs-var">viewCall</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="../../base-4.16.4.0/src/GHC-Maybe.html#Just"><span class="hs-identifier hs-type">Just</span></a></span><span> </span><span class="hs-special">(</span><span id="local-6989586621680990868"><span class="annot"><span class="annottext">Card
</span><a href="#local-6989586621680990868"><span class="hs-identifier hs-var">n2</span></a></span></span><span class="hs-special">,</span><span> </span><span id="local-6989586621680990867"><span class="annot"><span class="annottext">SubDemand
</span><a href="#local-6989586621680990867"><span class="hs-identifier hs-var">d2</span></a></span></span><span class="hs-special">)</span><span class="hs-special">)</span><span>
</span><span id="line-414"></span><span>  </span><span class="hs-comment">-- See Note [Call demands are relative]</span><span>
</span><span id="line-415"></span><span>  </span><span class="hs-glyph">|</span><span> </span><span class="annot"><span class="annottext">Card -&gt; Bool
</span><a href="GHC.Types.Demand.html#isAbs"><span class="hs-identifier hs-var">isAbs</span></a></span><span> </span><span class="annot"><span class="annottext">Card
</span><a href="#local-6989586621680990870"><span class="hs-identifier hs-var">n1</span></a></span><span>  </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">Card -&gt; SubDemand -&gt; SubDemand
</span><a href="GHC.Types.Demand.html#mkCall"><span class="hs-identifier hs-var">mkCall</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Card -&gt; Card -&gt; Card
</span><a href="GHC.Types.Demand.html#plusCard"><span class="hs-identifier hs-var">plusCard</span></a></span><span> </span><span class="annot"><span class="annottext">Card
</span><a href="#local-6989586621680990870"><span class="hs-identifier hs-var">n1</span></a></span><span> </span><span class="annot"><span class="annottext">Card
</span><a href="#local-6989586621680990868"><span class="hs-identifier hs-var">n2</span></a></span><span class="hs-special">)</span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">SubDemand -&gt; SubDemand -&gt; SubDemand
</span><a href="GHC.Types.Demand.html#lubSubDmd"><span class="hs-identifier hs-var">lubSubDmd</span></a></span><span> </span><span class="annot"><span class="annottext">SubDemand
</span><a href="GHC.Types.Demand.html#botSubDmd"><span class="hs-identifier hs-var">botSubDmd</span></a></span><span> </span><span class="annot"><span class="annottext">SubDemand
</span><a href="#local-6989586621680990867"><span class="hs-identifier hs-var">d2</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-416"></span><span>  </span><span class="hs-glyph">|</span><span> </span><span class="annot"><span class="annottext">Card -&gt; Bool
</span><a href="GHC.Types.Demand.html#isAbs"><span class="hs-identifier hs-var">isAbs</span></a></span><span> </span><span class="annot"><span class="annottext">Card
</span><a href="#local-6989586621680990868"><span class="hs-identifier hs-var">n2</span></a></span><span>  </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">Card -&gt; SubDemand -&gt; SubDemand
</span><a href="GHC.Types.Demand.html#mkCall"><span class="hs-identifier hs-var">mkCall</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Card -&gt; Card -&gt; Card
</span><a href="GHC.Types.Demand.html#plusCard"><span class="hs-identifier hs-var">plusCard</span></a></span><span> </span><span class="annot"><span class="annottext">Card
</span><a href="#local-6989586621680990870"><span class="hs-identifier hs-var">n1</span></a></span><span> </span><span class="annot"><span class="annottext">Card
</span><a href="#local-6989586621680990868"><span class="hs-identifier hs-var">n2</span></a></span><span class="hs-special">)</span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">SubDemand -&gt; SubDemand -&gt; SubDemand
</span><a href="GHC.Types.Demand.html#lubSubDmd"><span class="hs-identifier hs-var">lubSubDmd</span></a></span><span> </span><span class="annot"><span class="annottext">SubDemand
</span><a href="#local-6989586621680990869"><span class="hs-identifier hs-var">d1</span></a></span><span> </span><span class="annot"><span class="annottext">SubDemand
</span><a href="GHC.Types.Demand.html#botSubDmd"><span class="hs-identifier hs-var">botSubDmd</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-417"></span><span>  </span><span class="hs-glyph">|</span><span> </span><span class="annot"><span class="annottext">Bool
</span><a href="../../base-4.16.4.0/src/GHC-Base.html#otherwise"><span class="hs-identifier hs-var">otherwise</span></a></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">Card -&gt; SubDemand -&gt; SubDemand
</span><a href="GHC.Types.Demand.html#mkCall"><span class="hs-identifier hs-var">mkCall</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Card -&gt; Card -&gt; Card
</span><a href="GHC.Types.Demand.html#plusCard"><span class="hs-identifier hs-var">plusCard</span></a></span><span> </span><span class="annot"><span class="annottext">Card
</span><a href="#local-6989586621680990870"><span class="hs-identifier hs-var">n1</span></a></span><span> </span><span class="annot"><span class="annottext">Card
</span><a href="#local-6989586621680990868"><span class="hs-identifier hs-var">n2</span></a></span><span class="hs-special">)</span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">SubDemand -&gt; SubDemand -&gt; SubDemand
</span><a href="GHC.Types.Demand.html#lubSubDmd"><span class="hs-identifier hs-var">lubSubDmd</span></a></span><span> </span><span class="annot"><span class="annottext">SubDemand
</span><a href="#local-6989586621680990869"><span class="hs-identifier hs-var">d1</span></a></span><span>        </span><span class="annot"><span class="annottext">SubDemand
</span><a href="#local-6989586621680990867"><span class="hs-identifier hs-var">d2</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-418"></span><span class="hs-comment">-- Handle Poly</span><span>
</span><span id="line-419"></span><span class="annot"><a href="GHC.Types.Demand.html#plusSubDmd"><span class="hs-identifier hs-var">plusSubDmd</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="GHC.Types.Demand.html#Poly"><span class="hs-identifier hs-type">Poly</span></a></span><span> </span><span id="local-6989586621680990866"><span class="annot"><span class="annottext">Card
</span><a href="#local-6989586621680990866"><span class="hs-identifier hs-var">n1</span></a></span></span><span class="hs-special">)</span><span>  </span><span class="hs-special">(</span><span class="annot"><a href="GHC.Types.Demand.html#Poly"><span class="hs-identifier hs-type">Poly</span></a></span><span> </span><span id="local-6989586621680990865"><span class="annot"><span class="annottext">Card
</span><a href="#local-6989586621680990865"><span class="hs-identifier hs-var">n2</span></a></span></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">Card -&gt; SubDemand
</span><a href="GHC.Types.Demand.html#Poly"><span class="hs-identifier hs-var">Poly</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Card -&gt; Card -&gt; Card
</span><a href="GHC.Types.Demand.html#plusCard"><span class="hs-identifier hs-var">plusCard</span></a></span><span> </span><span class="annot"><span class="annottext">Card
</span><a href="#local-6989586621680990866"><span class="hs-identifier hs-var">n1</span></a></span><span> </span><span class="annot"><span class="annottext">Card
</span><a href="#local-6989586621680990865"><span class="hs-identifier hs-var">n2</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-420"></span><span class="hs-comment">-- Make use of reflexivity (so we'll match the Prod or Call cases again).</span><span>
</span><span id="line-421"></span><span class="annot"><a href="GHC.Types.Demand.html#plusSubDmd"><span class="hs-identifier hs-var">plusSubDmd</span></a></span><span> </span><span id="local-6989586621680990864"><span class="annot"><span class="annottext">sd1 :: SubDemand
</span><a href="#local-6989586621680990864"><span class="hs-identifier hs-var">sd1</span></a></span></span><span class="hs-glyph">@</span><span class="annot"><a href="GHC.Types.Demand.html#Poly"><span class="hs-identifier hs-type">Poly</span></a></span><span class="hs-special">{</span><span class="hs-special">}</span><span> </span><span id="local-6989586621680990863"><span class="annot"><span class="annottext">SubDemand
</span><a href="#local-6989586621680990863"><span class="hs-identifier hs-var">sd2</span></a></span></span><span>       </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">SubDemand -&gt; SubDemand -&gt; SubDemand
</span><a href="GHC.Types.Demand.html#plusSubDmd"><span class="hs-identifier hs-var">plusSubDmd</span></a></span><span> </span><span class="annot"><span class="annottext">SubDemand
</span><a href="#local-6989586621680990863"><span class="hs-identifier hs-var">sd2</span></a></span><span> </span><span class="annot"><span class="annottext">SubDemand
</span><a href="#local-6989586621680990864"><span class="hs-identifier hs-var">sd1</span></a></span><span>
</span><span id="line-422"></span><span class="hs-comment">-- Otherwise (Call `lub` Prod) return Top</span><span>
</span><span id="line-423"></span><span class="annot"><a href="GHC.Types.Demand.html#plusSubDmd"><span class="hs-identifier hs-var">plusSubDmd</span></a></span><span> </span><span class="annot"><span class="annottext">SubDemand
</span><span class="hs-identifier">_</span></span><span>          </span><span class="annot"><span class="annottext">SubDemand
</span><span class="hs-identifier">_</span></span><span>         </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">SubDemand
</span><a href="GHC.Types.Demand.html#topSubDmd"><span class="hs-identifier hs-var">topSubDmd</span></a></span><span>
</span><span id="line-424"></span><span>
</span><span id="line-425"></span><span class="hs-comment">-- | Denotes '+' on 'Demand'.</span><span>
</span><span id="line-426"></span><span class="annot"><a href="GHC.Types.Demand.html#plusDmd"><span class="hs-identifier hs-type">plusDmd</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><a href="GHC.Types.Demand.html#Demand"><span class="hs-identifier hs-type">Demand</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="GHC.Types.Demand.html#Demand"><span class="hs-identifier hs-type">Demand</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="GHC.Types.Demand.html#Demand"><span class="hs-identifier hs-type">Demand</span></a></span><span>
</span><span id="line-427"></span><span id="plusDmd"><span class="annot"><span class="annottext">plusDmd :: Demand -&gt; Demand -&gt; Demand
</span><a href="GHC.Types.Demand.html#plusDmd"><span class="hs-identifier hs-var hs-var">plusDmd</span></a></span></span><span> </span><span class="hs-special">(</span><span id="local-6989586621680990862"><span class="annot"><span class="annottext">Card
</span><a href="#local-6989586621680990862"><span class="hs-identifier hs-var">n1</span></a></span></span><span> </span><span class="annot"><a href="GHC.Types.Demand.html#%3A%2A"><span class="hs-operator hs-type">:*</span></a></span><span> </span><span id="local-6989586621680990861"><span class="annot"><span class="annottext">SubDemand
</span><a href="#local-6989586621680990861"><span class="hs-identifier hs-var">sd1</span></a></span></span><span class="hs-special">)</span><span> </span><span class="hs-special">(</span><span id="local-6989586621680990860"><span class="annot"><span class="annottext">Card
</span><a href="#local-6989586621680990860"><span class="hs-identifier hs-var">n2</span></a></span></span><span> </span><span class="annot"><a href="GHC.Types.Demand.html#%3A%2A"><span class="hs-operator hs-type">:*</span></a></span><span> </span><span id="local-6989586621680990859"><span class="annot"><span class="annottext">SubDemand
</span><a href="#local-6989586621680990859"><span class="hs-identifier hs-var">sd2</span></a></span></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">Card -&gt; Card -&gt; Card
</span><a href="GHC.Types.Demand.html#plusCard"><span class="hs-identifier hs-var">plusCard</span></a></span><span> </span><span class="annot"><span class="annottext">Card
</span><a href="#local-6989586621680990862"><span class="hs-identifier hs-var">n1</span></a></span><span> </span><span class="annot"><span class="annottext">Card
</span><a href="#local-6989586621680990860"><span class="hs-identifier hs-var">n2</span></a></span><span> </span><span class="annot"><span class="annottext">Card -&gt; SubDemand -&gt; Demand
</span><a href="GHC.Types.Demand.html#%3A%2A"><span class="hs-operator hs-var">:*</span></a></span><span> </span><span class="annot"><span class="annottext">SubDemand -&gt; SubDemand -&gt; SubDemand
</span><a href="GHC.Types.Demand.html#plusSubDmd"><span class="hs-identifier hs-var">plusSubDmd</span></a></span><span> </span><span class="annot"><span class="annottext">SubDemand
</span><a href="#local-6989586621680990861"><span class="hs-identifier hs-var">sd1</span></a></span><span> </span><span class="annot"><span class="annottext">SubDemand
</span><a href="#local-6989586621680990859"><span class="hs-identifier hs-var">sd2</span></a></span><span>
</span><span id="line-428"></span><span>
</span><span id="line-429"></span><span class="hs-comment">-- | The trivial cases of the @mult*@ functions.</span><span>
</span><span id="line-430"></span><span class="hs-comment">-- If @multTrivial n abs a = ma@, we have the following outcomes</span><span>
</span><span id="line-431"></span><span class="hs-comment">-- depending on @n@:</span><span>
</span><span id="line-432"></span><span class="hs-comment">--</span><span>
</span><span id="line-433"></span><span class="hs-comment">--   * 'C_11' =&gt; multiply by one, @ma = Just a@</span><span>
</span><span id="line-434"></span><span class="hs-comment">--   * 'C_00', 'C_10' (e.g. @'isAbs' n@) =&gt; return the absent thing,</span><span>
</span><span id="line-435"></span><span class="hs-comment">--      @ma = Just abs@</span><span>
</span><span id="line-436"></span><span class="hs-comment">--   * Otherwise ('C_01', 'C_*N') it's not a trivial case, @ma = Nothing@.</span><span>
</span><span id="line-437"></span><span id="local-6989586621680991221"><span class="annot"><a href="GHC.Types.Demand.html#multTrivial"><span class="hs-identifier hs-type">multTrivial</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><a href="GHC.Types.Demand.html#Card"><span class="hs-identifier hs-type">Card</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="#local-6989586621680991221"><span class="hs-identifier hs-type">a</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="#local-6989586621680991221"><span class="hs-identifier hs-type">a</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="../../base-4.16.4.0/src/GHC-Maybe.html#Maybe"><span class="hs-identifier hs-type">Maybe</span></a></span><span> </span><span class="annot"><a href="#local-6989586621680991221"><span class="hs-identifier hs-type">a</span></a></span></span><span>
</span><span id="line-438"></span><span id="multTrivial"><span class="annot"><span class="annottext">multTrivial :: forall a. Card -&gt; a -&gt; a -&gt; Maybe a
</span><a href="GHC.Types.Demand.html#multTrivial"><span class="hs-identifier hs-var hs-var">multTrivial</span></a></span></span><span> </span><span class="annot"><span class="annottext">Card
</span><a href="GHC.Types.Demand.html#C_11"><span class="hs-identifier hs-var">C_11</span></a></span><span> </span><span class="annot"><span class="annottext">a
</span><span class="hs-identifier">_</span></span><span>   </span><span id="local-6989586621680990857"><span class="annot"><span class="annottext">a
</span><a href="#local-6989586621680990857"><span class="hs-identifier hs-var">a</span></a></span></span><span>           </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">forall a. a -&gt; Maybe a
</span><a href="../../base-4.16.4.0/src/GHC-Maybe.html#Just"><span class="hs-identifier hs-var">Just</span></a></span><span> </span><span class="annot"><span class="annottext">a
</span><a href="#local-6989586621680990857"><span class="hs-identifier hs-var">a</span></a></span><span>
</span><span id="line-439"></span><span class="annot"><a href="GHC.Types.Demand.html#multTrivial"><span class="hs-identifier hs-var">multTrivial</span></a></span><span> </span><span id="local-6989586621680990856"><span class="annot"><span class="annottext">Card
</span><a href="#local-6989586621680990856"><span class="hs-identifier hs-var">n</span></a></span></span><span>    </span><span id="local-6989586621680990855"><span class="annot"><span class="annottext">a
</span><a href="#local-6989586621680990855"><span class="hs-identifier hs-var">abs</span></a></span></span><span> </span><span class="annot"><span class="annottext">a
</span><span class="hs-identifier">_</span></span><span> </span><span class="hs-glyph">|</span><span> </span><span class="annot"><span class="annottext">Card -&gt; Bool
</span><a href="GHC.Types.Demand.html#isAbs"><span class="hs-identifier hs-var">isAbs</span></a></span><span> </span><span class="annot"><span class="annottext">Card
</span><a href="#local-6989586621680990856"><span class="hs-identifier hs-var">n</span></a></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">forall a. a -&gt; Maybe a
</span><a href="../../base-4.16.4.0/src/GHC-Maybe.html#Just"><span class="hs-identifier hs-var">Just</span></a></span><span> </span><span class="annot"><span class="annottext">a
</span><a href="#local-6989586621680990855"><span class="hs-identifier hs-var">abs</span></a></span><span>
</span><span id="line-440"></span><span class="annot"><a href="GHC.Types.Demand.html#multTrivial"><span class="hs-identifier hs-var">multTrivial</span></a></span><span> </span><span class="annot"><span class="annottext">Card
</span><span class="hs-identifier">_</span></span><span>    </span><span class="annot"><span class="annottext">a
</span><span class="hs-identifier">_</span></span><span>   </span><span class="annot"><span class="annottext">a
</span><span class="hs-identifier">_</span></span><span>           </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">forall a. Maybe a
</span><a href="../../base-4.16.4.0/src/GHC-Maybe.html#Nothing"><span class="hs-identifier hs-var">Nothing</span></a></span><span>
</span><span id="line-441"></span><span>
</span><span id="line-442"></span><span class="annot"><a href="GHC.Types.Demand.html#multSubDmd"><span class="hs-identifier hs-type">multSubDmd</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><a href="GHC.Types.Demand.html#Card"><span class="hs-identifier hs-type">Card</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="GHC.Types.Demand.html#SubDemand"><span class="hs-identifier hs-type">SubDemand</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="GHC.Types.Demand.html#SubDemand"><span class="hs-identifier hs-type">SubDemand</span></a></span><span>
</span><span id="line-443"></span><span id="multSubDmd"><span class="annot"><span class="annottext">multSubDmd :: Card -&gt; SubDemand -&gt; SubDemand
</span><a href="GHC.Types.Demand.html#multSubDmd"><span class="hs-identifier hs-var hs-var">multSubDmd</span></a></span></span><span> </span><span id="local-6989586621680990854"><span class="annot"><span class="annottext">Card
</span><a href="#local-6989586621680990854"><span class="hs-identifier hs-var">n</span></a></span></span><span> </span><span id="local-6989586621680990853"><span class="annot"><span class="annottext">SubDemand
</span><a href="#local-6989586621680990853"><span class="hs-identifier hs-var">sd</span></a></span></span><span>
</span><span id="line-444"></span><span>  </span><span class="hs-glyph">|</span><span> </span><span class="annot"><a href="../../base-4.16.4.0/src/GHC-Maybe.html#Just"><span class="hs-identifier hs-type">Just</span></a></span><span> </span><span id="local-6989586621680990852"><span class="annot"><span class="annottext">SubDemand
</span><a href="#local-6989586621680990852"><span class="hs-identifier hs-var">sd'</span></a></span></span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">forall a. Card -&gt; a -&gt; a -&gt; Maybe a
</span><a href="GHC.Types.Demand.html#multTrivial"><span class="hs-identifier hs-var">multTrivial</span></a></span><span> </span><span class="annot"><span class="annottext">Card
</span><a href="#local-6989586621680990854"><span class="hs-identifier hs-var">n</span></a></span><span> </span><span class="annot"><span class="annottext">SubDemand
</span><a href="GHC.Types.Demand.html#seqSubDmd"><span class="hs-identifier hs-var">seqSubDmd</span></a></span><span> </span><span class="annot"><span class="annottext">SubDemand
</span><a href="#local-6989586621680990853"><span class="hs-identifier hs-var">sd</span></a></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">SubDemand
</span><a href="#local-6989586621680990852"><span class="hs-identifier hs-var">sd'</span></a></span><span>
</span><span id="line-445"></span><span class="annot"><a href="GHC.Types.Demand.html#multSubDmd"><span class="hs-identifier hs-var">multSubDmd</span></a></span><span> </span><span id="local-6989586621680990851"><span class="annot"><span class="annottext">Card
</span><a href="#local-6989586621680990851"><span class="hs-identifier hs-var">n</span></a></span></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="GHC.Types.Demand.html#Poly"><span class="hs-identifier hs-type">Poly</span></a></span><span> </span><span id="local-6989586621680990850"><span class="annot"><span class="annottext">Card
</span><a href="#local-6989586621680990850"><span class="hs-identifier hs-var">n'</span></a></span></span><span class="hs-special">)</span><span>    </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">Card -&gt; SubDemand
</span><a href="GHC.Types.Demand.html#Poly"><span class="hs-identifier hs-var">Poly</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Card -&gt; Card -&gt; Card
</span><a href="GHC.Types.Demand.html#multCard"><span class="hs-identifier hs-var">multCard</span></a></span><span> </span><span class="annot"><span class="annottext">Card
</span><a href="#local-6989586621680990851"><span class="hs-identifier hs-var">n</span></a></span><span> </span><span class="annot"><span class="annottext">Card
</span><a href="#local-6989586621680990850"><span class="hs-identifier hs-var">n'</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-446"></span><span class="annot"><a href="GHC.Types.Demand.html#multSubDmd"><span class="hs-identifier hs-var">multSubDmd</span></a></span><span> </span><span id="local-6989586621680990849"><span class="annot"><span class="annottext">Card
</span><a href="#local-6989586621680990849"><span class="hs-identifier hs-var">n</span></a></span></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="GHC.Types.Demand.html#Call"><span class="hs-identifier hs-type">Call</span></a></span><span> </span><span id="local-6989586621680990848"><span class="annot"><span class="annottext">Card
</span><a href="#local-6989586621680990848"><span class="hs-identifier hs-var">n'</span></a></span></span><span> </span><span id="local-6989586621680990847"><span class="annot"><span class="annottext">SubDemand
</span><a href="#local-6989586621680990847"><span class="hs-identifier hs-var">sd</span></a></span></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">Card -&gt; SubDemand -&gt; SubDemand
</span><a href="GHC.Types.Demand.html#mkCall"><span class="hs-identifier hs-var">mkCall</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Card -&gt; Card -&gt; Card
</span><a href="GHC.Types.Demand.html#multCard"><span class="hs-identifier hs-var">multCard</span></a></span><span> </span><span class="annot"><span class="annottext">Card
</span><a href="#local-6989586621680990849"><span class="hs-identifier hs-var">n</span></a></span><span> </span><span class="annot"><span class="annottext">Card
</span><a href="#local-6989586621680990848"><span class="hs-identifier hs-var">n'</span></a></span><span class="hs-special">)</span><span> </span><span class="annot"><span class="annottext">SubDemand
</span><a href="#local-6989586621680990847"><span class="hs-identifier hs-var">sd</span></a></span><span> </span><span class="hs-comment">-- See Note [Call demands are relative]</span><span>
</span><span id="line-447"></span><span class="annot"><a href="GHC.Types.Demand.html#multSubDmd"><span class="hs-identifier hs-var">multSubDmd</span></a></span><span> </span><span id="local-6989586621680990846"><span class="annot"><span class="annottext">Card
</span><a href="#local-6989586621680990846"><span class="hs-identifier hs-var">n</span></a></span></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="GHC.Types.Demand.html#Prod"><span class="hs-identifier hs-type">Prod</span></a></span><span> </span><span id="local-6989586621680990845"><span class="annot"><span class="annottext">[Demand]
</span><a href="#local-6989586621680990845"><span class="hs-identifier hs-var">ds</span></a></span></span><span class="hs-special">)</span><span>    </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">[Demand] -&gt; SubDemand
</span><a href="GHC.Types.Demand.html#Prod"><span class="hs-identifier hs-var">Prod</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">forall a b. (a -&gt; b) -&gt; [a] -&gt; [b]
</span><a href="../../base-4.16.4.0/src/GHC-Base.html#map"><span class="hs-identifier hs-var">map</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Card -&gt; Demand -&gt; Demand
</span><a href="GHC.Types.Demand.html#multDmd"><span class="hs-identifier hs-var">multDmd</span></a></span><span> </span><span class="annot"><span class="annottext">Card
</span><a href="#local-6989586621680990846"><span class="hs-identifier hs-var">n</span></a></span><span class="hs-special">)</span><span> </span><span class="annot"><span class="annottext">[Demand]
</span><a href="#local-6989586621680990845"><span class="hs-identifier hs-var">ds</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-448"></span><span>
</span><span id="line-449"></span><span class="annot"><a href="GHC.Types.Demand.html#multDmd"><span class="hs-identifier hs-type">multDmd</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><a href="GHC.Types.Demand.html#Card"><span class="hs-identifier hs-type">Card</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="GHC.Types.Demand.html#Demand"><span class="hs-identifier hs-type">Demand</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="GHC.Types.Demand.html#Demand"><span class="hs-identifier hs-type">Demand</span></a></span><span>
</span><span id="line-450"></span><span id="multDmd"><span class="annot"><span class="annottext">multDmd :: Card -&gt; Demand -&gt; Demand
</span><a href="GHC.Types.Demand.html#multDmd"><span class="hs-identifier hs-var hs-var">multDmd</span></a></span></span><span> </span><span id="local-6989586621680990844"><span class="annot"><span class="annottext">Card
</span><a href="#local-6989586621680990844"><span class="hs-identifier hs-var">n</span></a></span></span><span>    </span><span id="local-6989586621680990843"><span class="annot"><span class="annottext">Demand
</span><a href="#local-6989586621680990843"><span class="hs-identifier hs-var">dmd</span></a></span></span><span>
</span><span id="line-451"></span><span>  </span><span class="hs-glyph">|</span><span> </span><span class="annot"><a href="../../base-4.16.4.0/src/GHC-Maybe.html#Just"><span class="hs-identifier hs-type">Just</span></a></span><span> </span><span id="local-6989586621680990842"><span class="annot"><span class="annottext">Demand
</span><a href="#local-6989586621680990842"><span class="hs-identifier hs-var">dmd'</span></a></span></span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">forall a. Card -&gt; a -&gt; a -&gt; Maybe a
</span><a href="GHC.Types.Demand.html#multTrivial"><span class="hs-identifier hs-var">multTrivial</span></a></span><span> </span><span class="annot"><span class="annottext">Card
</span><a href="#local-6989586621680990844"><span class="hs-identifier hs-var">n</span></a></span><span> </span><span class="annot"><span class="annottext">Demand
</span><a href="GHC.Types.Demand.html#absDmd"><span class="hs-identifier hs-var">absDmd</span></a></span><span> </span><span class="annot"><span class="annottext">Demand
</span><a href="#local-6989586621680990843"><span class="hs-identifier hs-var">dmd</span></a></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">Demand
</span><a href="#local-6989586621680990842"><span class="hs-identifier hs-var">dmd'</span></a></span><span>
</span><span id="line-452"></span><span class="annot"><a href="GHC.Types.Demand.html#multDmd"><span class="hs-identifier hs-var">multDmd</span></a></span><span> </span><span id="local-6989586621680990841"><span class="annot"><span class="annottext">Card
</span><a href="#local-6989586621680990841"><span class="hs-identifier hs-var">n</span></a></span></span><span> </span><span class="hs-special">(</span><span id="local-6989586621680990840"><span class="annot"><span class="annottext">Card
</span><a href="#local-6989586621680990840"><span class="hs-identifier hs-var">m</span></a></span></span><span> </span><span class="annot"><a href="GHC.Types.Demand.html#%3A%2A"><span class="hs-operator hs-type">:*</span></a></span><span> </span><span id="local-6989586621680990839"><span class="annot"><span class="annottext">SubDemand
</span><a href="#local-6989586621680990839"><span class="hs-identifier hs-var">dmd</span></a></span></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">Card -&gt; Card -&gt; Card
</span><a href="GHC.Types.Demand.html#multCard"><span class="hs-identifier hs-var">multCard</span></a></span><span> </span><span class="annot"><span class="annottext">Card
</span><a href="#local-6989586621680990841"><span class="hs-identifier hs-var">n</span></a></span><span> </span><span class="annot"><span class="annottext">Card
</span><a href="#local-6989586621680990840"><span class="hs-identifier hs-var">m</span></a></span><span> </span><span class="annot"><span class="annottext">Card -&gt; SubDemand -&gt; Demand
</span><a href="GHC.Types.Demand.html#%3A%2A"><span class="hs-operator hs-var">:*</span></a></span><span> </span><span class="annot"><span class="annottext">Card -&gt; SubDemand -&gt; SubDemand
</span><a href="GHC.Types.Demand.html#multSubDmd"><span class="hs-identifier hs-var">multSubDmd</span></a></span><span> </span><span class="annot"><span class="annottext">Card
</span><a href="#local-6989586621680990841"><span class="hs-identifier hs-var">n</span></a></span><span> </span><span class="annot"><span class="annottext">SubDemand
</span><a href="#local-6989586621680990839"><span class="hs-identifier hs-var">dmd</span></a></span><span>
</span><span id="line-453"></span><span>
</span><span id="line-454"></span><span class="hs-comment">-- | Used to suppress pretty-printing of an uninformative demand</span><span>
</span><span id="line-455"></span><span class="annot"><a href="GHC.Types.Demand.html#isTopDmd"><span class="hs-identifier hs-type">isTopDmd</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><a href="GHC.Types.Demand.html#Demand"><span class="hs-identifier hs-type">Demand</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="hs-identifier hs-type">Bool</span></span><span>
</span><span id="line-456"></span><span id="isTopDmd"><span class="annot"><span class="annottext">isTopDmd :: Demand -&gt; Bool
</span><a href="GHC.Types.Demand.html#isTopDmd"><span class="hs-identifier hs-var hs-var">isTopDmd</span></a></span></span><span> </span><span id="local-6989586621680990838"><span class="annot"><span class="annottext">Demand
</span><a href="#local-6989586621680990838"><span class="hs-identifier hs-var">dmd</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">Demand
</span><a href="#local-6989586621680990838"><span class="hs-identifier hs-var">dmd</span></a></span><span> </span><span class="annot"><span class="annottext">forall a. Eq a =&gt; a -&gt; a -&gt; Bool
</span><span class="hs-operator hs-var">==</span></span><span> </span><span class="annot"><span class="annottext">Demand
</span><a href="GHC.Types.Demand.html#topDmd"><span class="hs-identifier hs-var">topDmd</span></a></span><span>
</span><span id="line-457"></span><span>
</span><span id="line-458"></span><span class="annot"><a href="GHC.Types.Demand.html#isAbsDmd"><span class="hs-identifier hs-type">isAbsDmd</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><a href="GHC.Types.Demand.html#Demand"><span class="hs-identifier hs-type">Demand</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="hs-identifier hs-type">Bool</span></span><span>
</span><span id="line-459"></span><span id="isAbsDmd"><span class="annot"><span class="annottext">isAbsDmd :: Demand -&gt; Bool
</span><a href="GHC.Types.Demand.html#isAbsDmd"><span class="hs-identifier hs-var hs-var">isAbsDmd</span></a></span></span><span> </span><span class="hs-special">(</span><span id="local-6989586621680990837"><span class="annot"><span class="annottext">Card
</span><a href="#local-6989586621680990837"><span class="hs-identifier hs-var">n</span></a></span></span><span> </span><span class="annot"><a href="GHC.Types.Demand.html#%3A%2A"><span class="hs-operator hs-type">:*</span></a></span><span> </span><span class="annot"><span class="annottext">SubDemand
</span><span class="hs-identifier">_</span></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">Card -&gt; Bool
</span><a href="GHC.Types.Demand.html#isAbs"><span class="hs-identifier hs-var">isAbs</span></a></span><span> </span><span class="annot"><span class="annottext">Card
</span><a href="#local-6989586621680990837"><span class="hs-identifier hs-var">n</span></a></span><span>
</span><span id="line-460"></span><span>
</span><span id="line-461"></span><span class="hs-comment">-- | Contrast with isStrictUsedDmd. See Note [Strict demands]</span><span>
</span><span id="line-462"></span><span class="annot"><a href="GHC.Types.Demand.html#isStrictDmd"><span class="hs-identifier hs-type">isStrictDmd</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><a href="GHC.Types.Demand.html#Demand"><span class="hs-identifier hs-type">Demand</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="hs-identifier hs-type">Bool</span></span><span>
</span><span id="line-463"></span><span id="isStrictDmd"><span class="annot"><span class="annottext">isStrictDmd :: Demand -&gt; Bool
</span><a href="GHC.Types.Demand.html#isStrictDmd"><span class="hs-identifier hs-var hs-var">isStrictDmd</span></a></span></span><span> </span><span class="hs-special">(</span><span id="local-6989586621680990836"><span class="annot"><span class="annottext">Card
</span><a href="#local-6989586621680990836"><span class="hs-identifier hs-var">n</span></a></span></span><span> </span><span class="annot"><a href="GHC.Types.Demand.html#%3A%2A"><span class="hs-operator hs-type">:*</span></a></span><span> </span><span class="annot"><span class="annottext">SubDemand
</span><span class="hs-identifier">_</span></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">Card -&gt; Bool
</span><a href="GHC.Types.Demand.html#isStrict"><span class="hs-identifier hs-var">isStrict</span></a></span><span> </span><span class="annot"><span class="annottext">Card
</span><a href="#local-6989586621680990836"><span class="hs-identifier hs-var">n</span></a></span><span>
</span><span id="line-464"></span><span>
</span><span id="line-465"></span><span class="hs-comment">-- | Not absent and used strictly. See Note [Strict demands]</span><span>
</span><span id="line-466"></span><span class="annot"><a href="GHC.Types.Demand.html#isStrUsedDmd"><span class="hs-identifier hs-type">isStrUsedDmd</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><a href="GHC.Types.Demand.html#Demand"><span class="hs-identifier hs-type">Demand</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="hs-identifier hs-type">Bool</span></span><span>
</span><span id="line-467"></span><span id="isStrUsedDmd"><span class="annot"><span class="annottext">isStrUsedDmd :: Demand -&gt; Bool
</span><a href="GHC.Types.Demand.html#isStrUsedDmd"><span class="hs-identifier hs-var hs-var">isStrUsedDmd</span></a></span></span><span> </span><span class="hs-special">(</span><span id="local-6989586621680990835"><span class="annot"><span class="annottext">Card
</span><a href="#local-6989586621680990835"><span class="hs-identifier hs-var">n</span></a></span></span><span> </span><span class="annot"><a href="GHC.Types.Demand.html#%3A%2A"><span class="hs-operator hs-type">:*</span></a></span><span> </span><span class="annot"><span class="annottext">SubDemand
</span><span class="hs-identifier">_</span></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">Card -&gt; Bool
</span><a href="GHC.Types.Demand.html#isStrict"><span class="hs-identifier hs-var">isStrict</span></a></span><span> </span><span class="annot"><span class="annottext">Card
</span><a href="#local-6989586621680990835"><span class="hs-identifier hs-var">n</span></a></span><span> </span><span class="annot"><span class="annottext">Bool -&gt; Bool -&gt; Bool
</span><span class="hs-operator hs-var">&amp;&amp;</span></span><span> </span><span class="annot"><span class="annottext">Bool -&gt; Bool
</span><span class="hs-identifier hs-var">not</span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Card -&gt; Bool
</span><a href="GHC.Types.Demand.html#isAbs"><span class="hs-identifier hs-var">isAbs</span></a></span><span> </span><span class="annot"><span class="annottext">Card
</span><a href="#local-6989586621680990835"><span class="hs-identifier hs-var">n</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-468"></span><span>
</span><span id="line-469"></span><span class="annot"><a href="GHC.Types.Demand.html#isSeqDmd"><span class="hs-identifier hs-type">isSeqDmd</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><a href="GHC.Types.Demand.html#Demand"><span class="hs-identifier hs-type">Demand</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="hs-identifier hs-type">Bool</span></span><span>
</span><span id="line-470"></span><span id="isSeqDmd"><span class="annot"><span class="annottext">isSeqDmd :: Demand -&gt; Bool
</span><a href="GHC.Types.Demand.html#isSeqDmd"><span class="hs-identifier hs-var hs-var">isSeqDmd</span></a></span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Card
</span><a href="GHC.Types.Demand.html#C_11"><span class="hs-identifier hs-var">C_11</span></a></span><span> </span><span class="annot"><a href="GHC.Types.Demand.html#%3A%2A"><span class="hs-operator hs-type">:*</span></a></span><span> </span><span id="local-6989586621680990832"><span class="annot"><span class="annottext">SubDemand
</span><a href="#local-6989586621680990832"><span class="hs-identifier hs-var">sd</span></a></span></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">SubDemand
</span><a href="#local-6989586621680990832"><span class="hs-identifier hs-var">sd</span></a></span><span> </span><span class="annot"><span class="annottext">forall a. Eq a =&gt; a -&gt; a -&gt; Bool
</span><span class="hs-operator hs-var">==</span></span><span> </span><span class="annot"><span class="annottext">SubDemand
</span><a href="GHC.Types.Demand.html#seqSubDmd"><span class="hs-identifier hs-var">seqSubDmd</span></a></span><span>
</span><span id="line-471"></span><span class="annot"><a href="GHC.Types.Demand.html#isSeqDmd"><span class="hs-identifier hs-var">isSeqDmd</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Card
</span><a href="GHC.Types.Demand.html#C_1N"><span class="hs-identifier hs-var">C_1N</span></a></span><span> </span><span class="annot"><a href="GHC.Types.Demand.html#%3A%2A"><span class="hs-operator hs-type">:*</span></a></span><span> </span><span id="local-6989586621680990831"><span class="annot"><span class="annottext">SubDemand
</span><a href="#local-6989586621680990831"><span class="hs-identifier hs-var">sd</span></a></span></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">SubDemand
</span><a href="#local-6989586621680990831"><span class="hs-identifier hs-var">sd</span></a></span><span> </span><span class="annot"><span class="annottext">forall a. Eq a =&gt; a -&gt; a -&gt; Bool
</span><span class="hs-operator hs-var">==</span></span><span> </span><span class="annot"><span class="annottext">SubDemand
</span><a href="GHC.Types.Demand.html#seqSubDmd"><span class="hs-identifier hs-var">seqSubDmd</span></a></span><span> </span><span class="hs-comment">-- I wonder if we need this case.</span><span>
</span><span id="line-472"></span><span class="annot"><a href="GHC.Types.Demand.html#isSeqDmd"><span class="hs-identifier hs-var">isSeqDmd</span></a></span><span> </span><span class="annot"><span class="annottext">Demand
</span><span class="hs-identifier">_</span></span><span>            </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">Bool
</span><span class="hs-identifier hs-var">False</span></span><span>
</span><span id="line-473"></span><span>
</span><span id="line-474"></span><span class="hs-comment">-- | Is the value used at most once?</span><span>
</span><span id="line-475"></span><span class="annot"><a href="GHC.Types.Demand.html#isUsedOnceDmd"><span class="hs-identifier hs-type">isUsedOnceDmd</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><a href="GHC.Types.Demand.html#Demand"><span class="hs-identifier hs-type">Demand</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="hs-identifier hs-type">Bool</span></span><span>
</span><span id="line-476"></span><span id="isUsedOnceDmd"><span class="annot"><span class="annottext">isUsedOnceDmd :: Demand -&gt; Bool
</span><a href="GHC.Types.Demand.html#isUsedOnceDmd"><span class="hs-identifier hs-var hs-var">isUsedOnceDmd</span></a></span></span><span> </span><span class="hs-special">(</span><span id="local-6989586621680990830"><span class="annot"><span class="annottext">Card
</span><a href="#local-6989586621680990830"><span class="hs-identifier hs-var">n</span></a></span></span><span> </span><span class="annot"><a href="GHC.Types.Demand.html#%3A%2A"><span class="hs-operator hs-type">:*</span></a></span><span> </span><span class="annot"><span class="annottext">SubDemand
</span><span class="hs-identifier">_</span></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">Card -&gt; Bool
</span><a href="GHC.Types.Demand.html#isUsedOnce"><span class="hs-identifier hs-var">isUsedOnce</span></a></span><span> </span><span class="annot"><span class="annottext">Card
</span><a href="#local-6989586621680990830"><span class="hs-identifier hs-var">n</span></a></span><span>
</span><span id="line-477"></span><span>
</span><span id="line-478"></span><span class="hs-comment">-- | We try to avoid tracking weak free variable demands in strictness</span><span>
</span><span id="line-479"></span><span class="hs-comment">-- signatures for analysis performance reasons.</span><span>
</span><span id="line-480"></span><span class="hs-comment">-- See Note [Lazy and unleashable free variables] in &quot;GHC.Core.Opt.DmdAnal&quot;.</span><span>
</span><span id="line-481"></span><span class="annot"><a href="GHC.Types.Demand.html#isWeakDmd"><span class="hs-identifier hs-type">isWeakDmd</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><a href="GHC.Types.Demand.html#Demand"><span class="hs-identifier hs-type">Demand</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="hs-identifier hs-type">Bool</span></span><span>
</span><span id="line-482"></span><span id="isWeakDmd"><span class="annot"><span class="annottext">isWeakDmd :: Demand -&gt; Bool
</span><a href="GHC.Types.Demand.html#isWeakDmd"><span class="hs-identifier hs-var hs-var">isWeakDmd</span></a></span></span><span> </span><span id="local-6989586621680990829"><span class="annot"><span class="annottext">dmd :: Demand
</span><a href="#local-6989586621680990829"><span class="hs-identifier hs-var">dmd</span></a></span></span><span class="hs-glyph">@</span><span class="hs-special">(</span><span id="local-6989586621680990828"><span class="annot"><span class="annottext">Card
</span><a href="#local-6989586621680990828"><span class="hs-identifier hs-var">n</span></a></span></span><span> </span><span class="annot"><a href="GHC.Types.Demand.html#%3A%2A"><span class="hs-operator hs-type">:*</span></a></span><span> </span><span class="annot"><span class="annottext">SubDemand
</span><span class="hs-identifier">_</span></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">Bool -&gt; Bool
</span><span class="hs-identifier hs-var">not</span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Card -&gt; Bool
</span><a href="GHC.Types.Demand.html#isStrict"><span class="hs-identifier hs-var">isStrict</span></a></span><span> </span><span class="annot"><span class="annottext">Card
</span><a href="#local-6989586621680990828"><span class="hs-identifier hs-var">n</span></a></span><span class="hs-special">)</span><span> </span><span class="annot"><span class="annottext">Bool -&gt; Bool -&gt; Bool
</span><span class="hs-operator hs-var">&amp;&amp;</span></span><span> </span><span class="annot"><span class="annottext">Demand -&gt; Bool
</span><a href="#local-6989586621680990827"><span class="hs-identifier hs-var">is_plus_idem_dmd</span></a></span><span> </span><span class="annot"><span class="annottext">Demand
</span><a href="#local-6989586621680990829"><span class="hs-identifier hs-var">dmd</span></a></span><span>
</span><span id="line-483"></span><span>  </span><span class="hs-keyword">where</span><span>
</span><span id="line-484"></span><span>    </span><span class="hs-comment">-- @is_plus_idem_* thing@ checks whether @thing `plus` thing = thing@,</span><span>
</span><span id="line-485"></span><span>    </span><span class="hs-comment">-- e.g. if @thing@ is idempotent wrt. to @plus@.</span><span>
</span><span id="line-486"></span><span>    </span><span id="local-6989586621680990825"><span class="annot"><span class="annottext">is_plus_idem_card :: Card -&gt; Bool
</span><a href="#local-6989586621680990825"><span class="hs-identifier hs-var hs-var">is_plus_idem_card</span></a></span></span><span> </span><span id="local-6989586621680990824"><span class="annot"><span class="annottext">Card
</span><a href="#local-6989586621680990824"><span class="hs-identifier hs-var">c</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">Card -&gt; Card -&gt; Card
</span><a href="GHC.Types.Demand.html#plusCard"><span class="hs-identifier hs-var">plusCard</span></a></span><span> </span><span class="annot"><span class="annottext">Card
</span><a href="#local-6989586621680990824"><span class="hs-identifier hs-var">c</span></a></span><span> </span><span class="annot"><span class="annottext">Card
</span><a href="#local-6989586621680990824"><span class="hs-identifier hs-var">c</span></a></span><span> </span><span class="annot"><span class="annottext">forall a. Eq a =&gt; a -&gt; a -&gt; Bool
</span><span class="hs-operator hs-var">==</span></span><span> </span><span class="annot"><span class="annottext">Card
</span><a href="#local-6989586621680990824"><span class="hs-identifier hs-var">c</span></a></span><span>
</span><span id="line-487"></span><span>    </span><span class="hs-comment">-- is_plus_idem_dmd dmd = plusDmd dmd dmd == dmd</span><span>
</span><span id="line-488"></span><span>    </span><span id="local-6989586621680990827"><span class="annot"><span class="annottext">is_plus_idem_dmd :: Demand -&gt; Bool
</span><a href="#local-6989586621680990827"><span class="hs-identifier hs-var hs-var">is_plus_idem_dmd</span></a></span></span><span> </span><span class="hs-special">(</span><span id="local-6989586621680990822"><span class="annot"><span class="annottext">Card
</span><a href="#local-6989586621680990822"><span class="hs-identifier hs-var">n</span></a></span></span><span> </span><span class="annot"><a href="GHC.Types.Demand.html#%3A%2A"><span class="hs-operator hs-type">:*</span></a></span><span> </span><span id="local-6989586621680990821"><span class="annot"><span class="annottext">SubDemand
</span><a href="#local-6989586621680990821"><span class="hs-identifier hs-var">sd</span></a></span></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">Card -&gt; Bool
</span><a href="#local-6989586621680990825"><span class="hs-identifier hs-var">is_plus_idem_card</span></a></span><span> </span><span class="annot"><span class="annottext">Card
</span><a href="#local-6989586621680990822"><span class="hs-identifier hs-var">n</span></a></span><span> </span><span class="annot"><span class="annottext">Bool -&gt; Bool -&gt; Bool
</span><span class="hs-operator hs-var">&amp;&amp;</span></span><span> </span><span class="annot"><span class="annottext">SubDemand -&gt; Bool
</span><a href="#local-6989586621680990820"><span class="hs-identifier hs-var">is_plus_idem_sub_dmd</span></a></span><span> </span><span class="annot"><span class="annottext">SubDemand
</span><a href="#local-6989586621680990821"><span class="hs-identifier hs-var">sd</span></a></span><span>
</span><span id="line-489"></span><span>    </span><span class="hs-comment">-- is_plus_idem_sub_dmd sd = plusSubDmd sd sd == sd</span><span>
</span><span id="line-490"></span><span>    </span><span id="local-6989586621680990820"><span class="annot"><span class="annottext">is_plus_idem_sub_dmd :: SubDemand -&gt; Bool
</span><a href="#local-6989586621680990820"><span class="hs-identifier hs-var hs-var">is_plus_idem_sub_dmd</span></a></span></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="GHC.Types.Demand.html#Poly"><span class="hs-identifier hs-type">Poly</span></a></span><span> </span><span id="local-6989586621680990819"><span class="annot"><span class="annottext">Card
</span><a href="#local-6989586621680990819"><span class="hs-identifier hs-var">n</span></a></span></span><span class="hs-special">)</span><span>   </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">Card -&gt; Bool
</span><a href="#local-6989586621680990825"><span class="hs-identifier hs-var">is_plus_idem_card</span></a></span><span> </span><span class="annot"><span class="annottext">Card
</span><a href="#local-6989586621680990819"><span class="hs-identifier hs-var">n</span></a></span><span>
</span><span id="line-491"></span><span>    </span><span class="annot"><a href="#local-6989586621680990820"><span class="hs-identifier hs-var">is_plus_idem_sub_dmd</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="GHC.Types.Demand.html#Prod"><span class="hs-identifier hs-type">Prod</span></a></span><span> </span><span id="local-6989586621680990818"><span class="annot"><span class="annottext">[Demand]
</span><a href="#local-6989586621680990818"><span class="hs-identifier hs-var">ds</span></a></span></span><span class="hs-special">)</span><span>  </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">forall (t :: * -&gt; *) a. Foldable t =&gt; (a -&gt; Bool) -&gt; t a -&gt; Bool
</span><a href="../../base-4.16.4.0/src/Data-Foldable.html#all"><span class="hs-identifier hs-var">all</span></a></span><span> </span><span class="annot"><span class="annottext">Demand -&gt; Bool
</span><a href="#local-6989586621680990827"><span class="hs-identifier hs-var">is_plus_idem_dmd</span></a></span><span> </span><span class="annot"><span class="annottext">[Demand]
</span><a href="#local-6989586621680990818"><span class="hs-identifier hs-var">ds</span></a></span><span>
</span><span id="line-492"></span><span>    </span><span class="annot"><a href="#local-6989586621680990820"><span class="hs-identifier hs-var">is_plus_idem_sub_dmd</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="GHC.Types.Demand.html#Call"><span class="hs-identifier hs-type">Call</span></a></span><span> </span><span id="local-6989586621680990817"><span class="annot"><span class="annottext">Card
</span><a href="#local-6989586621680990817"><span class="hs-identifier hs-var">n</span></a></span></span><span> </span><span class="annot"><span class="annottext">SubDemand
</span><span class="hs-identifier">_</span></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">Card -&gt; Bool
</span><a href="#local-6989586621680990825"><span class="hs-identifier hs-var">is_plus_idem_card</span></a></span><span> </span><span class="annot"><span class="annottext">Card
</span><a href="#local-6989586621680990817"><span class="hs-identifier hs-var">n</span></a></span><span> </span><span class="hs-comment">-- See Note [Call demands are relative]</span><span>
</span><span id="line-493"></span><span>
</span><span id="line-494"></span><span class="annot"><a href="GHC.Types.Demand.html#evalDmd"><span class="hs-identifier hs-type">evalDmd</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><a href="GHC.Types.Demand.html#Demand"><span class="hs-identifier hs-type">Demand</span></a></span><span>
</span><span id="line-495"></span><span id="evalDmd"><span class="annot"><span class="annottext">evalDmd :: Demand
</span><a href="GHC.Types.Demand.html#evalDmd"><span class="hs-identifier hs-var hs-var">evalDmd</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">Card
</span><a href="GHC.Types.Demand.html#C_1N"><span class="hs-identifier hs-var">C_1N</span></a></span><span> </span><span class="annot"><span class="annottext">Card -&gt; SubDemand -&gt; Demand
</span><a href="GHC.Types.Demand.html#%3A%2A"><span class="hs-operator hs-var">:*</span></a></span><span> </span><span class="annot"><span class="annottext">SubDemand
</span><a href="GHC.Types.Demand.html#topSubDmd"><span class="hs-identifier hs-var">topSubDmd</span></a></span><span>
</span><span id="line-496"></span><span>
</span><span id="line-497"></span><span class="hs-comment">-- | First argument of 'GHC.Exts.maskAsyncExceptions#': @1C1(L)@.</span><span>
</span><span id="line-498"></span><span class="hs-comment">-- Called exactly once.</span><span>
</span><span id="line-499"></span><span class="annot"><a href="GHC.Types.Demand.html#strictOnceApply1Dmd"><span class="hs-identifier hs-type">strictOnceApply1Dmd</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><a href="GHC.Types.Demand.html#Demand"><span class="hs-identifier hs-type">Demand</span></a></span><span>
</span><span id="line-500"></span><span id="strictOnceApply1Dmd"><span class="annot"><span class="annottext">strictOnceApply1Dmd :: Demand
</span><a href="GHC.Types.Demand.html#strictOnceApply1Dmd"><span class="hs-identifier hs-var hs-var">strictOnceApply1Dmd</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">Card
</span><a href="GHC.Types.Demand.html#C_11"><span class="hs-identifier hs-var">C_11</span></a></span><span> </span><span class="annot"><span class="annottext">Card -&gt; SubDemand -&gt; Demand
</span><a href="GHC.Types.Demand.html#%3A%2A"><span class="hs-operator hs-var">:*</span></a></span><span> </span><span class="annot"><span class="annottext">Card -&gt; SubDemand -&gt; SubDemand
</span><a href="GHC.Types.Demand.html#mkCall"><span class="hs-identifier hs-var">mkCall</span></a></span><span> </span><span class="annot"><span class="annottext">Card
</span><a href="GHC.Types.Demand.html#C_11"><span class="hs-identifier hs-var">C_11</span></a></span><span> </span><span class="annot"><span class="annottext">SubDemand
</span><a href="GHC.Types.Demand.html#topSubDmd"><span class="hs-identifier hs-var">topSubDmd</span></a></span><span>
</span><span id="line-501"></span><span>
</span><span id="line-502"></span><span class="hs-comment">-- | First argument of 'GHC.Exts.atomically#': @SCS(L)@.</span><span>
</span><span id="line-503"></span><span class="hs-comment">-- Called at least once, possibly many times.</span><span>
</span><span id="line-504"></span><span class="annot"><a href="GHC.Types.Demand.html#strictManyApply1Dmd"><span class="hs-identifier hs-type">strictManyApply1Dmd</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><a href="GHC.Types.Demand.html#Demand"><span class="hs-identifier hs-type">Demand</span></a></span><span>
</span><span id="line-505"></span><span id="strictManyApply1Dmd"><span class="annot"><span class="annottext">strictManyApply1Dmd :: Demand
</span><a href="GHC.Types.Demand.html#strictManyApply1Dmd"><span class="hs-identifier hs-var hs-var">strictManyApply1Dmd</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">Card
</span><a href="GHC.Types.Demand.html#C_1N"><span class="hs-identifier hs-var">C_1N</span></a></span><span> </span><span class="annot"><span class="annottext">Card -&gt; SubDemand -&gt; Demand
</span><a href="GHC.Types.Demand.html#%3A%2A"><span class="hs-operator hs-var">:*</span></a></span><span> </span><span class="annot"><span class="annottext">Card -&gt; SubDemand -&gt; SubDemand
</span><a href="GHC.Types.Demand.html#mkCall"><span class="hs-identifier hs-var">mkCall</span></a></span><span> </span><span class="annot"><span class="annottext">Card
</span><a href="GHC.Types.Demand.html#C_1N"><span class="hs-identifier hs-var">C_1N</span></a></span><span> </span><span class="annot"><span class="annottext">SubDemand
</span><a href="GHC.Types.Demand.html#topSubDmd"><span class="hs-identifier hs-var">topSubDmd</span></a></span><span>
</span><span id="line-506"></span><span>
</span><span id="line-507"></span><span class="hs-comment">-- | First argument of catch#: @MCM(L)@.</span><span>
</span><span id="line-508"></span><span class="hs-comment">-- Evaluates its arg lazily, but then applies it exactly once to one argument.</span><span>
</span><span id="line-509"></span><span class="annot"><a href="GHC.Types.Demand.html#lazyApply1Dmd"><span class="hs-identifier hs-type">lazyApply1Dmd</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><a href="GHC.Types.Demand.html#Demand"><span class="hs-identifier hs-type">Demand</span></a></span><span>
</span><span id="line-510"></span><span id="lazyApply1Dmd"><span class="annot"><span class="annottext">lazyApply1Dmd :: Demand
</span><a href="GHC.Types.Demand.html#lazyApply1Dmd"><span class="hs-identifier hs-var hs-var">lazyApply1Dmd</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">Card
</span><a href="GHC.Types.Demand.html#C_01"><span class="hs-identifier hs-var">C_01</span></a></span><span> </span><span class="annot"><span class="annottext">Card -&gt; SubDemand -&gt; Demand
</span><a href="GHC.Types.Demand.html#%3A%2A"><span class="hs-operator hs-var">:*</span></a></span><span> </span><span class="annot"><span class="annottext">Card -&gt; SubDemand -&gt; SubDemand
</span><a href="GHC.Types.Demand.html#mkCall"><span class="hs-identifier hs-var">mkCall</span></a></span><span> </span><span class="annot"><span class="annottext">Card
</span><a href="GHC.Types.Demand.html#C_01"><span class="hs-identifier hs-var">C_01</span></a></span><span> </span><span class="annot"><span class="annottext">SubDemand
</span><a href="GHC.Types.Demand.html#topSubDmd"><span class="hs-identifier hs-var">topSubDmd</span></a></span><span>
</span><span id="line-511"></span><span>
</span><span id="line-512"></span><span class="hs-comment">-- | Second argument of catch#: @MCM(C1(L))@.</span><span>
</span><span id="line-513"></span><span class="hs-comment">-- Calls its arg lazily, but then applies it exactly once to an additional argument.</span><span>
</span><span id="line-514"></span><span class="annot"><a href="GHC.Types.Demand.html#lazyApply2Dmd"><span class="hs-identifier hs-type">lazyApply2Dmd</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><a href="GHC.Types.Demand.html#Demand"><span class="hs-identifier hs-type">Demand</span></a></span><span>
</span><span id="line-515"></span><span id="lazyApply2Dmd"><span class="annot"><span class="annottext">lazyApply2Dmd :: Demand
</span><a href="GHC.Types.Demand.html#lazyApply2Dmd"><span class="hs-identifier hs-var hs-var">lazyApply2Dmd</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">Card
</span><a href="GHC.Types.Demand.html#C_01"><span class="hs-identifier hs-var">C_01</span></a></span><span> </span><span class="annot"><span class="annottext">Card -&gt; SubDemand -&gt; Demand
</span><a href="GHC.Types.Demand.html#%3A%2A"><span class="hs-operator hs-var">:*</span></a></span><span> </span><span class="annot"><span class="annottext">Card -&gt; SubDemand -&gt; SubDemand
</span><a href="GHC.Types.Demand.html#mkCall"><span class="hs-identifier hs-var">mkCall</span></a></span><span> </span><span class="annot"><span class="annottext">Card
</span><a href="GHC.Types.Demand.html#C_01"><span class="hs-identifier hs-var">C_01</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Card -&gt; SubDemand -&gt; SubDemand
</span><a href="GHC.Types.Demand.html#mkCall"><span class="hs-identifier hs-var">mkCall</span></a></span><span> </span><span class="annot"><span class="annottext">Card
</span><a href="GHC.Types.Demand.html#C_11"><span class="hs-identifier hs-var">C_11</span></a></span><span> </span><span class="annot"><span class="annottext">SubDemand
</span><a href="GHC.Types.Demand.html#topSubDmd"><span class="hs-identifier hs-var">topSubDmd</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-516"></span><span>
</span><span id="line-517"></span><span class="hs-comment">-- | Make a 'Demand' evaluated at-most-once.</span><span>
</span><span id="line-518"></span><span class="annot"><a href="GHC.Types.Demand.html#oneifyDmd"><span class="hs-identifier hs-type">oneifyDmd</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><a href="GHC.Types.Demand.html#Demand"><span class="hs-identifier hs-type">Demand</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="GHC.Types.Demand.html#Demand"><span class="hs-identifier hs-type">Demand</span></a></span><span>
</span><span id="line-519"></span><span id="oneifyDmd"><span class="annot"><span class="annottext">oneifyDmd :: Demand -&gt; Demand
</span><a href="GHC.Types.Demand.html#oneifyDmd"><span class="hs-identifier hs-var hs-var">oneifyDmd</span></a></span></span><span> </span><span class="hs-special">(</span><span id="local-6989586621680990816"><span class="annot"><span class="annottext">Card
</span><a href="#local-6989586621680990816"><span class="hs-identifier hs-var">n</span></a></span></span><span> </span><span class="annot"><a href="GHC.Types.Demand.html#%3A%2A"><span class="hs-operator hs-type">:*</span></a></span><span> </span><span id="local-6989586621680990815"><span class="annot"><span class="annottext">SubDemand
</span><a href="#local-6989586621680990815"><span class="hs-identifier hs-var">sd</span></a></span></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">Card -&gt; Card
</span><a href="GHC.Types.Demand.html#oneifyCard"><span class="hs-identifier hs-var">oneifyCard</span></a></span><span> </span><span class="annot"><span class="annottext">Card
</span><a href="#local-6989586621680990816"><span class="hs-identifier hs-var">n</span></a></span><span> </span><span class="annot"><span class="annottext">Card -&gt; SubDemand -&gt; Demand
</span><a href="GHC.Types.Demand.html#%3A%2A"><span class="hs-operator hs-var">:*</span></a></span><span> </span><span class="annot"><span class="annottext">SubDemand
</span><a href="#local-6989586621680990815"><span class="hs-identifier hs-var">sd</span></a></span><span>
</span><span id="line-520"></span><span>
</span><span id="line-521"></span><span class="hs-comment">-- | Make a 'Demand' evaluated at-least-once (e.g. strict).</span><span>
</span><span id="line-522"></span><span class="annot"><a href="GHC.Types.Demand.html#strictifyDmd"><span class="hs-identifier hs-type">strictifyDmd</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><a href="GHC.Types.Demand.html#Demand"><span class="hs-identifier hs-type">Demand</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="GHC.Types.Demand.html#Demand"><span class="hs-identifier hs-type">Demand</span></a></span><span>
</span><span id="line-523"></span><span id="strictifyDmd"><span class="annot"><span class="annottext">strictifyDmd :: Demand -&gt; Demand
</span><a href="GHC.Types.Demand.html#strictifyDmd"><span class="hs-identifier hs-var hs-var">strictifyDmd</span></a></span></span><span> </span><span class="hs-special">(</span><span id="local-6989586621680990814"><span class="annot"><span class="annottext">Card
</span><a href="#local-6989586621680990814"><span class="hs-identifier hs-var">n</span></a></span></span><span> </span><span class="annot"><a href="GHC.Types.Demand.html#%3A%2A"><span class="hs-operator hs-type">:*</span></a></span><span> </span><span id="local-6989586621680990813"><span class="annot"><span class="annottext">SubDemand
</span><a href="#local-6989586621680990813"><span class="hs-identifier hs-var">sd</span></a></span></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">Card -&gt; Card -&gt; Card
</span><a href="GHC.Types.Demand.html#plusCard"><span class="hs-identifier hs-var">plusCard</span></a></span><span> </span><span class="annot"><span class="annottext">Card
</span><a href="GHC.Types.Demand.html#C_10"><span class="hs-identifier hs-var">C_10</span></a></span><span> </span><span class="annot"><span class="annottext">Card
</span><a href="#local-6989586621680990814"><span class="hs-identifier hs-var">n</span></a></span><span> </span><span class="annot"><span class="annottext">Card -&gt; SubDemand -&gt; Demand
</span><a href="GHC.Types.Demand.html#%3A%2A"><span class="hs-operator hs-var">:*</span></a></span><span> </span><span class="annot"><span class="annottext">SubDemand
</span><a href="#local-6989586621680990813"><span class="hs-identifier hs-var">sd</span></a></span><span>
</span><span id="line-524"></span><span>
</span><span id="line-525"></span><span class="hs-comment">-- | If the argument is a used non-newtype dictionary, give it strict demand.</span><span>
</span><span id="line-526"></span><span class="hs-comment">-- Also split the product type &amp; demand and recur in order to similarly</span><span>
</span><span id="line-527"></span><span class="hs-comment">-- strictify the argument's contained used non-newtype superclass dictionaries.</span><span>
</span><span id="line-528"></span><span class="hs-comment">-- We use the demand as our recursive measure to guarantee termination.</span><span>
</span><span id="line-529"></span><span class="annot"><a href="GHC.Types.Demand.html#strictifyDictDmd"><span class="hs-identifier hs-type">strictifyDictDmd</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><a href="GHC.Core.TyCo.Rep.html#Type"><span class="hs-identifier hs-type">Type</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="GHC.Types.Demand.html#Demand"><span class="hs-identifier hs-type">Demand</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="GHC.Types.Demand.html#Demand"><span class="hs-identifier hs-type">Demand</span></a></span><span>
</span><span id="line-530"></span><span id="strictifyDictDmd"><span class="annot"><span class="annottext">strictifyDictDmd :: Type -&gt; Demand -&gt; Demand
</span><a href="GHC.Types.Demand.html#strictifyDictDmd"><span class="hs-identifier hs-var hs-var">strictifyDictDmd</span></a></span></span><span> </span><span id="local-6989586621680990812"><span class="annot"><span class="annottext">Type
</span><a href="#local-6989586621680990812"><span class="hs-identifier hs-var">ty</span></a></span></span><span> </span><span class="hs-special">(</span><span id="local-6989586621680990811"><span class="annot"><span class="annottext">Card
</span><a href="#local-6989586621680990811"><span class="hs-identifier hs-var">n</span></a></span></span><span> </span><span class="annot"><a href="GHC.Types.Demand.html#%3A%2A"><span class="hs-operator hs-type">:*</span></a></span><span> </span><span class="annot"><a href="GHC.Types.Demand.html#Prod"><span class="hs-identifier hs-type">Prod</span></a></span><span> </span><span id="local-6989586621680990810"><span class="annot"><span class="annottext">[Demand]
</span><a href="#local-6989586621680990810"><span class="hs-identifier hs-var">ds</span></a></span></span><span class="hs-special">)</span><span>
</span><span id="line-531"></span><span>  </span><span class="hs-glyph">|</span><span> </span><span class="annot"><span class="annottext">Bool -&gt; Bool
</span><span class="hs-identifier hs-var">not</span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Card -&gt; Bool
</span><a href="GHC.Types.Demand.html#isAbs"><span class="hs-identifier hs-var">isAbs</span></a></span><span> </span><span class="annot"><span class="annottext">Card
</span><a href="#local-6989586621680990811"><span class="hs-identifier hs-var">n</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-532"></span><span>  </span><span class="hs-special">,</span><span> </span><span class="annot"><a href="../../base-4.16.4.0/src/GHC-Maybe.html#Just"><span class="hs-identifier hs-type">Just</span></a></span><span> </span><span id="local-6989586621680990809"><span class="annot"><span class="annottext">[Type]
</span><a href="#local-6989586621680990809"><span class="hs-identifier hs-var">field_tys</span></a></span></span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">Type -&gt; Maybe [Type]
</span><a href="#local-6989586621680990808"><span class="hs-identifier hs-var">as_non_newtype_dict</span></a></span><span> </span><span class="annot"><span class="annottext">Type
</span><a href="#local-6989586621680990812"><span class="hs-identifier hs-var">ty</span></a></span><span>
</span><span id="line-533"></span><span>  </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">Card
</span><a href="GHC.Types.Demand.html#C_1N"><span class="hs-identifier hs-var">C_1N</span></a></span><span> </span><span class="annot"><span class="annottext">Card -&gt; SubDemand -&gt; Demand
</span><a href="GHC.Types.Demand.html#%3A%2A"><span class="hs-operator hs-var">:*</span></a></span><span> </span><span class="hs-comment">-- main idea: ensure it's strict</span><span>
</span><span id="line-534"></span><span>      </span><span class="hs-keyword">if</span><span> </span><span class="annot"><span class="annottext">forall (t :: * -&gt; *) a. Foldable t =&gt; (a -&gt; Bool) -&gt; t a -&gt; Bool
</span><a href="../../base-4.16.4.0/src/Data-Foldable.html#all"><span class="hs-identifier hs-var">all</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Bool -&gt; Bool
</span><span class="hs-identifier hs-var">not</span></span><span> </span><span class="annot"><span class="annottext">forall b c a. (b -&gt; c) -&gt; (a -&gt; b) -&gt; a -&gt; c
</span><a href="../../base-4.16.4.0/src/GHC-Base.html#."><span class="hs-operator hs-var">.</span></a></span><span> </span><span class="annot"><span class="annottext">Demand -&gt; Bool
</span><a href="GHC.Types.Demand.html#isAbsDmd"><span class="hs-identifier hs-var">isAbsDmd</span></a></span><span class="hs-special">)</span><span> </span><span class="annot"><span class="annottext">[Demand]
</span><a href="#local-6989586621680990810"><span class="hs-identifier hs-var">ds</span></a></span><span>
</span><span id="line-535"></span><span>        </span><span class="hs-keyword">then</span><span> </span><span class="annot"><span class="annottext">SubDemand
</span><a href="GHC.Types.Demand.html#topSubDmd"><span class="hs-identifier hs-var">topSubDmd</span></a></span><span> </span><span class="hs-comment">-- abstract to strict w/ arbitrary component use,</span><span>
</span><span id="line-536"></span><span>                         </span><span class="hs-comment">-- since this smells like reboxing; results in CBV</span><span>
</span><span id="line-537"></span><span>                         </span><span class="hs-comment">-- boxed</span><span>
</span><span id="line-538"></span><span>                         </span><span class="hs-comment">--</span><span>
</span><span id="line-539"></span><span>                         </span><span class="hs-comment">-- TODO revisit this if we ever do boxity analysis</span><span>
</span><span id="line-540"></span><span>        </span><span class="hs-keyword">else</span><span> </span><span class="annot"><span class="annottext">[Demand] -&gt; SubDemand
</span><a href="GHC.Types.Demand.html#Prod"><span class="hs-identifier hs-var">Prod</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">forall a b c. (a -&gt; b -&gt; c) -&gt; [a] -&gt; [b] -&gt; [c]
</span><a href="../../base-4.16.4.0/src/GHC-List.html#zipWith"><span class="hs-identifier hs-var">zipWith</span></a></span><span> </span><span class="annot"><span class="annottext">Type -&gt; Demand -&gt; Demand
</span><a href="GHC.Types.Demand.html#strictifyDictDmd"><span class="hs-identifier hs-var">strictifyDictDmd</span></a></span><span> </span><span class="annot"><span class="annottext">[Type]
</span><a href="#local-6989586621680990809"><span class="hs-identifier hs-var">field_tys</span></a></span><span> </span><span class="annot"><span class="annottext">[Demand]
</span><a href="#local-6989586621680990810"><span class="hs-identifier hs-var">ds</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-541"></span><span>  </span><span class="hs-keyword">where</span><span>
</span><span id="line-542"></span><span>    </span><span class="hs-comment">-- | Return a TyCon and a list of field types if the given</span><span>
</span><span id="line-543"></span><span>    </span><span class="hs-comment">-- type is a non-newtype dictionary type</span><span>
</span><span id="line-544"></span><span>    </span><span id="local-6989586621680990808"><span class="annot"><span class="annottext">as_non_newtype_dict :: Type -&gt; Maybe [Type]
</span><a href="#local-6989586621680990808"><span class="hs-identifier hs-var hs-var">as_non_newtype_dict</span></a></span></span><span> </span><span id="local-6989586621680990806"><span class="annot"><span class="annottext">Type
</span><a href="#local-6989586621680990806"><span class="hs-identifier hs-var">ty</span></a></span></span><span>
</span><span id="line-545"></span><span>      </span><span class="hs-glyph">|</span><span> </span><span class="annot"><a href="../../base-4.16.4.0/src/GHC-Maybe.html#Just"><span class="hs-identifier hs-type">Just</span></a></span><span> </span><span class="hs-special">(</span><span id="local-6989586621680990805"><span class="annot"><span class="annottext">TyCon
</span><a href="#local-6989586621680990805"><span class="hs-identifier hs-var">tycon</span></a></span></span><span class="hs-special">,</span><span> </span><span id="local-6989586621680990804"><span class="annot"><span class="annottext">[Type]
</span><a href="#local-6989586621680990804"><span class="hs-identifier hs-var">_arg_tys</span></a></span></span><span class="hs-special">,</span><span> </span><span id="local-6989586621680990803"><span class="annot"><span class="annottext">DataCon
</span><a href="#local-6989586621680990803"><span class="hs-identifier hs-var">_data_con</span></a></span></span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">forall a b. (a -&gt; b) -&gt; [a] -&gt; [b]
</span><a href="../../base-4.16.4.0/src/GHC-Base.html#map"><span class="hs-identifier hs-var">map</span></a></span><span> </span><span class="annot"><span class="annottext">forall a. Scaled a -&gt; a
</span><a href="GHC.Core.TyCo.Rep.html#scaledThing"><span class="hs-identifier hs-var">scaledThing</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span id="local-6989586621680990802"><span class="annot"><span class="annottext">[Type]
</span><a href="#local-6989586621680990802"><span class="hs-identifier hs-var">inst_con_arg_tys</span></a></span></span><span class="hs-special">)</span><span>
</span><span id="line-546"></span><span>          </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">Type -&gt; Maybe (TyCon, [Type], DataCon, [Scaled Type])
</span><a href="GHC.Core.DataCon.html#splitDataProductType_maybe"><span class="hs-identifier hs-var">splitDataProductType_maybe</span></a></span><span> </span><span class="annot"><span class="annottext">Type
</span><a href="#local-6989586621680990806"><span class="hs-identifier hs-var">ty</span></a></span><span>
</span><span id="line-547"></span><span>      </span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">Bool -&gt; Bool
</span><span class="hs-identifier hs-var">not</span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">TyCon -&gt; Bool
</span><a href="GHC.Core.TyCon.html#isNewTyCon"><span class="hs-identifier hs-var">isNewTyCon</span></a></span><span> </span><span class="annot"><span class="annottext">TyCon
</span><a href="#local-6989586621680990805"><span class="hs-identifier hs-var">tycon</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-548"></span><span>      </span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">TyCon -&gt; Bool
</span><a href="GHC.Core.TyCon.html#isClassTyCon"><span class="hs-identifier hs-var">isClassTyCon</span></a></span><span> </span><span class="annot"><span class="annottext">TyCon
</span><a href="#local-6989586621680990805"><span class="hs-identifier hs-var">tycon</span></a></span><span>
</span><span id="line-549"></span><span>      </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">forall a. a -&gt; Maybe a
</span><a href="../../base-4.16.4.0/src/GHC-Maybe.html#Just"><span class="hs-identifier hs-var">Just</span></a></span><span> </span><span class="annot"><span class="annottext">[Type]
</span><a href="#local-6989586621680990802"><span class="hs-identifier hs-var">inst_con_arg_tys</span></a></span><span>
</span><span id="line-550"></span><span>      </span><span class="hs-glyph">|</span><span> </span><span class="annot"><span class="annottext">Bool
</span><a href="../../base-4.16.4.0/src/GHC-Base.html#otherwise"><span class="hs-identifier hs-var">otherwise</span></a></span><span>
</span><span id="line-551"></span><span>      </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">forall a. Maybe a
</span><a href="../../base-4.16.4.0/src/GHC-Maybe.html#Nothing"><span class="hs-identifier hs-var">Nothing</span></a></span><span>
</span><span id="line-552"></span><span class="annot"><a href="GHC.Types.Demand.html#strictifyDictDmd"><span class="hs-identifier hs-var">strictifyDictDmd</span></a></span><span> </span><span class="annot"><span class="annottext">Type
</span><span class="hs-identifier">_</span></span><span>  </span><span id="local-6989586621680990801"><span class="annot"><span class="annottext">Demand
</span><a href="#local-6989586621680990801"><span class="hs-identifier hs-var">dmd</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">Demand
</span><a href="#local-6989586621680990801"><span class="hs-identifier hs-var">dmd</span></a></span><span>
</span><span id="line-553"></span><span>
</span><span id="line-554"></span><span class="hs-comment">-- | Wraps the 'SubDemand' with a one-shot call demand: @d@ -&gt; @C1(d)@.</span><span>
</span><span id="line-555"></span><span class="annot"><a href="GHC.Types.Demand.html#mkCalledOnceDmd"><span class="hs-identifier hs-type">mkCalledOnceDmd</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><a href="GHC.Types.Demand.html#SubDemand"><span class="hs-identifier hs-type">SubDemand</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="GHC.Types.Demand.html#SubDemand"><span class="hs-identifier hs-type">SubDemand</span></a></span><span>
</span><span id="line-556"></span><span id="mkCalledOnceDmd"><span class="annot"><span class="annottext">mkCalledOnceDmd :: SubDemand -&gt; SubDemand
</span><a href="GHC.Types.Demand.html#mkCalledOnceDmd"><span class="hs-identifier hs-var hs-var">mkCalledOnceDmd</span></a></span></span><span> </span><span id="local-6989586621680990800"><span class="annot"><span class="annottext">SubDemand
</span><a href="#local-6989586621680990800"><span class="hs-identifier hs-var">sd</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">Card -&gt; SubDemand -&gt; SubDemand
</span><a href="GHC.Types.Demand.html#mkCall"><span class="hs-identifier hs-var">mkCall</span></a></span><span> </span><span class="annot"><span class="annottext">Card
</span><a href="GHC.Types.Demand.html#C_11"><span class="hs-identifier hs-var">C_11</span></a></span><span> </span><span class="annot"><span class="annottext">SubDemand
</span><a href="#local-6989586621680990800"><span class="hs-identifier hs-var">sd</span></a></span><span>
</span><span id="line-557"></span><span>
</span><span id="line-558"></span><span class="hs-comment">-- | @mkCalledOnceDmds n d@ returns @C1(C1...(C1 d))@ where there are @n@ @C1@'s.</span><span>
</span><span id="line-559"></span><span class="annot"><a href="GHC.Types.Demand.html#mkCalledOnceDmds"><span class="hs-identifier hs-type">mkCalledOnceDmds</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><a href="GHC.Types.Basic.html#Arity"><span class="hs-identifier hs-type">Arity</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="GHC.Types.Demand.html#SubDemand"><span class="hs-identifier hs-type">SubDemand</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="GHC.Types.Demand.html#SubDemand"><span class="hs-identifier hs-type">SubDemand</span></a></span><span>
</span><span id="line-560"></span><span id="mkCalledOnceDmds"><span class="annot"><span class="annottext">mkCalledOnceDmds :: Int -&gt; SubDemand -&gt; SubDemand
</span><a href="GHC.Types.Demand.html#mkCalledOnceDmds"><span class="hs-identifier hs-var hs-var">mkCalledOnceDmds</span></a></span></span><span> </span><span id="local-6989586621680990799"><span class="annot"><span class="annottext">Int
</span><a href="#local-6989586621680990799"><span class="hs-identifier hs-var">arity</span></a></span></span><span> </span><span id="local-6989586621680990798"><span class="annot"><span class="annottext">SubDemand
</span><a href="#local-6989586621680990798"><span class="hs-identifier hs-var">sd</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">forall a. (a -&gt; a) -&gt; a -&gt; [a]
</span><a href="../../base-4.16.4.0/src/GHC-List.html#iterate"><span class="hs-identifier hs-var">iterate</span></a></span><span> </span><span class="annot"><span class="annottext">SubDemand -&gt; SubDemand
</span><a href="GHC.Types.Demand.html#mkCalledOnceDmd"><span class="hs-identifier hs-var">mkCalledOnceDmd</span></a></span><span> </span><span class="annot"><span class="annottext">SubDemand
</span><a href="#local-6989586621680990798"><span class="hs-identifier hs-var">sd</span></a></span><span> </span><span class="annot"><span class="annottext">forall a. [a] -&gt; Int -&gt; a
</span><a href="../../base-4.16.4.0/src/GHC-List.html#%21%21"><span class="hs-operator hs-var">!!</span></a></span><span> </span><span class="annot"><span class="annottext">Int
</span><a href="#local-6989586621680990799"><span class="hs-identifier hs-var">arity</span></a></span><span>
</span><span id="line-561"></span><span>
</span><span id="line-562"></span><span class="hs-comment">-- | Peels one call level from the sub-demand, and also returns how many</span><span>
</span><span id="line-563"></span><span class="hs-comment">-- times we entered the lambda body.</span><span>
</span><span id="line-564"></span><span class="annot"><a href="GHC.Types.Demand.html#peelCallDmd"><span class="hs-identifier hs-type">peelCallDmd</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><a href="GHC.Types.Demand.html#SubDemand"><span class="hs-identifier hs-type">SubDemand</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-special">(</span><span class="annot"><a href="GHC.Types.Demand.html#Card"><span class="hs-identifier hs-type">Card</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><a href="GHC.Types.Demand.html#SubDemand"><span class="hs-identifier hs-type">SubDemand</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-565"></span><span id="peelCallDmd"><span class="annot"><span class="annottext">peelCallDmd :: SubDemand -&gt; (Card, SubDemand)
</span><a href="GHC.Types.Demand.html#peelCallDmd"><span class="hs-identifier hs-var hs-var">peelCallDmd</span></a></span></span><span> </span><span id="local-6989586621680990795"><span class="annot"><span class="annottext">SubDemand
</span><a href="#local-6989586621680990795"><span class="hs-identifier hs-var">sd</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">SubDemand -&gt; Maybe (Card, SubDemand)
</span><a href="GHC.Types.Demand.html#viewCall"><span class="hs-identifier hs-var">viewCall</span></a></span><span> </span><span class="annot"><span class="annottext">SubDemand
</span><a href="#local-6989586621680990795"><span class="hs-identifier hs-var">sd</span></a></span><span> </span><span class="annot"><span class="annottext">forall a. Maybe a -&gt; a -&gt; a
</span><a href="GHC.Data.Maybe.html#orElse"><span class="hs-operator hs-var">`orElse`</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Card
</span><a href="GHC.Types.Demand.html#topCard"><span class="hs-identifier hs-var">topCard</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">SubDemand
</span><a href="GHC.Types.Demand.html#topSubDmd"><span class="hs-identifier hs-var">topSubDmd</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-566"></span><span>
</span><span id="line-567"></span><span class="hs-comment">-- Peels multiple nestings of 'Call' sub-demands and also returns</span><span>
</span><span id="line-568"></span><span class="hs-comment">-- whether it was unsaturated in the form of a 'Card'inality, denoting</span><span>
</span><span id="line-569"></span><span class="hs-comment">-- how many times the lambda body was entered.</span><span>
</span><span id="line-570"></span><span class="hs-comment">-- See Note [Demands from unsaturated function calls].</span><span>
</span><span id="line-571"></span><span class="annot"><a href="GHC.Types.Demand.html#peelManyCalls"><span class="hs-identifier hs-type">peelManyCalls</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><span class="hs-identifier hs-type">Int</span></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="GHC.Types.Demand.html#SubDemand"><span class="hs-identifier hs-type">SubDemand</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="GHC.Types.Demand.html#Card"><span class="hs-identifier hs-type">Card</span></a></span><span>
</span><span id="line-572"></span><span id="peelManyCalls"><span class="annot"><span class="annottext">peelManyCalls :: Int -&gt; SubDemand -&gt; Card
</span><a href="GHC.Types.Demand.html#peelManyCalls"><span class="hs-identifier hs-var hs-var">peelManyCalls</span></a></span></span><span> </span><span class="annot"><span class="annottext">Int
</span><span class="hs-number">0</span></span><span> </span><span class="annot"><span class="annottext">SubDemand
</span><span class="hs-identifier">_</span></span><span>                          </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">Card
</span><a href="GHC.Types.Demand.html#C_11"><span class="hs-identifier hs-var">C_11</span></a></span><span>
</span><span id="line-573"></span><span class="hs-comment">-- See Note [Call demands are relative]</span><span>
</span><span id="line-574"></span><span class="annot"><a href="GHC.Types.Demand.html#peelManyCalls"><span class="hs-identifier hs-var">peelManyCalls</span></a></span><span> </span><span id="local-6989586621680990794"><span class="annot"><span class="annottext">Int
</span><a href="#local-6989586621680990794"><span class="hs-identifier hs-var">n</span></a></span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">SubDemand -&gt; Maybe (Card, SubDemand)
</span><a href="GHC.Types.Demand.html#viewCall"><span class="hs-identifier hs-var">viewCall</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="../../base-4.16.4.0/src/GHC-Maybe.html#Just"><span class="hs-identifier hs-type">Just</span></a></span><span> </span><span class="hs-special">(</span><span id="local-6989586621680990793"><span class="annot"><span class="annottext">Card
</span><a href="#local-6989586621680990793"><span class="hs-identifier hs-var">m</span></a></span></span><span class="hs-special">,</span><span> </span><span id="local-6989586621680990792"><span class="annot"><span class="annottext">SubDemand
</span><a href="#local-6989586621680990792"><span class="hs-identifier hs-var">sd</span></a></span></span><span class="hs-special">)</span><span class="hs-special">)</span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">Card
</span><a href="#local-6989586621680990793"><span class="hs-identifier hs-var">m</span></a></span><span> </span><span class="annot"><span class="annottext">Card -&gt; Card -&gt; Card
</span><a href="GHC.Types.Demand.html#multCard"><span class="hs-operator hs-var">`multCard`</span></a></span><span> </span><span class="annot"><span class="annottext">Int -&gt; SubDemand -&gt; Card
</span><a href="GHC.Types.Demand.html#peelManyCalls"><span class="hs-identifier hs-var">peelManyCalls</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Int
</span><a href="#local-6989586621680990794"><span class="hs-identifier hs-var">n</span></a></span><span class="annot"><span class="annottext">forall a. Num a =&gt; a -&gt; a -&gt; a
</span><a href="../../base-4.16.4.0/src/GHC-Num.html#-"><span class="hs-glyph hs-var">-</span></a></span><span class="annot"><span class="annottext">Int
</span><span class="hs-number">1</span></span><span class="hs-special">)</span><span> </span><span class="annot"><span class="annottext">SubDemand
</span><a href="#local-6989586621680990792"><span class="hs-identifier hs-var">sd</span></a></span><span>
</span><span id="line-575"></span><span class="annot"><a href="GHC.Types.Demand.html#peelManyCalls"><span class="hs-identifier hs-var">peelManyCalls</span></a></span><span> </span><span class="annot"><span class="annottext">Int
</span><span class="hs-identifier">_</span></span><span> </span><span class="annot"><span class="annottext">SubDemand
</span><span class="hs-identifier">_</span></span><span>                          </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">Card
</span><a href="GHC.Types.Demand.html#C_0N"><span class="hs-identifier hs-var">C_0N</span></a></span><span>
</span><span id="line-576"></span><span>
</span><span id="line-577"></span><span class="hs-comment">-- See Note [Demand on the worker] in GHC.Core.Opt.WorkWrap</span><span>
</span><span id="line-578"></span><span class="annot"><a href="GHC.Types.Demand.html#mkWorkerDemand"><span class="hs-identifier hs-type">mkWorkerDemand</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><span class="hs-identifier hs-type">Int</span></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="GHC.Types.Demand.html#Demand"><span class="hs-identifier hs-type">Demand</span></a></span><span>
</span><span id="line-579"></span><span id="mkWorkerDemand"><span class="annot"><span class="annottext">mkWorkerDemand :: Int -&gt; Demand
</span><a href="GHC.Types.Demand.html#mkWorkerDemand"><span class="hs-identifier hs-var hs-var">mkWorkerDemand</span></a></span></span><span> </span><span id="local-6989586621680990791"><span class="annot"><span class="annottext">Int
</span><a href="#local-6989586621680990791"><span class="hs-identifier hs-var">n</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">Card
</span><a href="GHC.Types.Demand.html#C_01"><span class="hs-identifier hs-var">C_01</span></a></span><span> </span><span class="annot"><span class="annottext">Card -&gt; SubDemand -&gt; Demand
</span><a href="GHC.Types.Demand.html#%3A%2A"><span class="hs-operator hs-var">:*</span></a></span><span> </span><span class="annot"><span class="annottext">forall {t}. (Eq t, Num t) =&gt; t -&gt; SubDemand
</span><a href="#local-6989586621680990790"><span class="hs-identifier hs-var">go</span></a></span><span> </span><span class="annot"><span class="annottext">Int
</span><a href="#local-6989586621680990791"><span class="hs-identifier hs-var">n</span></a></span><span>
</span><span id="line-580"></span><span>  </span><span class="hs-keyword">where</span><span> </span><span id="local-6989586621680990790"><span class="annot"><span class="annottext">go :: t -&gt; SubDemand
</span><a href="#local-6989586621680990790"><span class="hs-identifier hs-var hs-var">go</span></a></span></span><span> </span><span class="annot"><span class="annottext">t
</span><span class="hs-number">0</span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">SubDemand
</span><a href="GHC.Types.Demand.html#topSubDmd"><span class="hs-identifier hs-var">topSubDmd</span></a></span><span>
</span><span id="line-581"></span><span>        </span><span class="annot"><a href="#local-6989586621680990790"><span class="hs-identifier hs-var">go</span></a></span><span> </span><span id="local-6989586621680990783"><span class="annot"><span class="annottext">t
</span><a href="#local-6989586621680990783"><span class="hs-identifier hs-var">n</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">Card -&gt; SubDemand -&gt; SubDemand
</span><a href="GHC.Types.Demand.html#Call"><span class="hs-identifier hs-var">Call</span></a></span><span> </span><span class="annot"><span class="annottext">Card
</span><a href="GHC.Types.Demand.html#C_01"><span class="hs-identifier hs-var">C_01</span></a></span><span> </span><span class="annot"><span class="annottext">forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><a href="../../base-4.16.4.0/src/GHC-Base.html#%24"><span class="hs-operator hs-var">$</span></a></span><span> </span><span class="annot"><span class="annottext">t -&gt; SubDemand
</span><a href="#local-6989586621680990790"><span class="hs-identifier hs-var">go</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">t
</span><a href="#local-6989586621680990783"><span class="hs-identifier hs-var">n</span></a></span><span class="annot"><span class="annottext">forall a. Num a =&gt; a -&gt; a -&gt; a
</span><a href="../../base-4.16.4.0/src/GHC-Num.html#-"><span class="hs-glyph hs-var">-</span></a></span><span class="annot"><span class="annottext">t
</span><span class="hs-number">1</span></span><span class="hs-special">)</span><span>
</span><span id="line-582"></span><span>
</span><span id="line-583"></span><span class="annot"><a href="GHC.Types.Demand.html#addCaseBndrDmd"><span class="hs-identifier hs-type">addCaseBndrDmd</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><a href="GHC.Types.Demand.html#SubDemand"><span class="hs-identifier hs-type">SubDemand</span></a></span><span> </span><span class="hs-comment">-- On the case binder</span><span>
</span><span id="line-584"></span><span>               </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-special">[</span><span class="annot"><a href="GHC.Types.Demand.html#Demand"><span class="hs-identifier hs-type">Demand</span></a></span><span class="hs-special">]</span><span>  </span><span class="hs-comment">-- On the components of the constructor</span><span>
</span><span id="line-585"></span><span>               </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-special">[</span><span class="annot"><a href="GHC.Types.Demand.html#Demand"><span class="hs-identifier hs-type">Demand</span></a></span><span class="hs-special">]</span><span>  </span><span class="hs-comment">-- Final demands for the components of the constructor</span><span>
</span><span id="line-586"></span><span id="addCaseBndrDmd"><span class="annot"><span class="annottext">addCaseBndrDmd :: SubDemand -&gt; [Demand] -&gt; [Demand]
</span><a href="GHC.Types.Demand.html#addCaseBndrDmd"><span class="hs-identifier hs-var hs-var">addCaseBndrDmd</span></a></span></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="GHC.Types.Demand.html#Poly"><span class="hs-identifier hs-type">Poly</span></a></span><span> </span><span id="local-6989586621680990782"><span class="annot"><span class="annottext">Card
</span><a href="#local-6989586621680990782"><span class="hs-identifier hs-var">n</span></a></span></span><span class="hs-special">)</span><span> </span><span id="local-6989586621680990781"><span class="annot"><span class="annottext">[Demand]
</span><a href="#local-6989586621680990781"><span class="hs-identifier hs-var">alt_dmds</span></a></span></span><span>
</span><span id="line-587"></span><span>  </span><span class="hs-glyph">|</span><span> </span><span class="annot"><span class="annottext">Card -&gt; Bool
</span><a href="GHC.Types.Demand.html#isAbs"><span class="hs-identifier hs-var">isAbs</span></a></span><span> </span><span class="annot"><span class="annottext">Card
</span><a href="#local-6989586621680990782"><span class="hs-identifier hs-var">n</span></a></span><span>   </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">[Demand]
</span><a href="#local-6989586621680990781"><span class="hs-identifier hs-var">alt_dmds</span></a></span><span>
</span><span id="line-588"></span><span class="hs-comment">-- See Note [Demand on case-alternative binders]</span><span>
</span><span id="line-589"></span><span class="annot"><a href="GHC.Types.Demand.html#addCaseBndrDmd"><span class="hs-identifier hs-var">addCaseBndrDmd</span></a></span><span> </span><span id="local-6989586621680990780"><span class="annot"><span class="annottext">SubDemand
</span><a href="#local-6989586621680990780"><span class="hs-identifier hs-var">sd</span></a></span></span><span>       </span><span id="local-6989586621680990779"><span class="annot"><span class="annottext">[Demand]
</span><a href="#local-6989586621680990779"><span class="hs-identifier hs-var">alt_dmds</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">forall a b c. (a -&gt; b -&gt; c) -&gt; [a] -&gt; [b] -&gt; [c]
</span><a href="../../base-4.16.4.0/src/GHC-List.html#zipWith"><span class="hs-identifier hs-var">zipWith</span></a></span><span> </span><span class="annot"><span class="annottext">Demand -&gt; Demand -&gt; Demand
</span><a href="GHC.Types.Demand.html#plusDmd"><span class="hs-identifier hs-var">plusDmd</span></a></span><span> </span><span class="annot"><span class="annottext">[Demand]
</span><a href="#local-6989586621680990778"><span class="hs-identifier hs-var">ds</span></a></span><span> </span><span class="annot"><span class="annottext">[Demand]
</span><a href="#local-6989586621680990779"><span class="hs-identifier hs-var">alt_dmds</span></a></span><span> </span><span class="hs-comment">-- fuse ds!</span><span>
</span><span id="line-590"></span><span>  </span><span class="hs-keyword">where</span><span>
</span><span id="line-591"></span><span>    </span><span class="annot"><a href="../../base-4.16.4.0/src/GHC-Maybe.html#Just"><span class="hs-identifier hs-type">Just</span></a></span><span> </span><span id="local-6989586621680990778"><span class="annot"><span class="annottext">[Demand]
</span><a href="#local-6989586621680990778"><span class="hs-identifier hs-var">ds</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">Int -&gt; SubDemand -&gt; Maybe [Demand]
</span><a href="GHC.Types.Demand.html#viewProd"><span class="hs-identifier hs-var">viewProd</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">forall (t :: * -&gt; *) a. Foldable t =&gt; t a -&gt; Int
</span><a href="../../base-4.16.4.0/src/Data-Foldable.html#length"><span class="hs-identifier hs-var">length</span></a></span><span> </span><span class="annot"><span class="annottext">[Demand]
</span><a href="#local-6989586621680990779"><span class="hs-identifier hs-var">alt_dmds</span></a></span><span class="hs-special">)</span><span> </span><span class="annot"><span class="annottext">SubDemand
</span><a href="#local-6989586621680990780"><span class="hs-identifier hs-var">sd</span></a></span><span> </span><span class="hs-comment">-- Guaranteed not to be a call</span><span>
</span><span id="line-592"></span><span>
</span><span id="line-593"></span><span class="annot"><a href="GHC.Types.Demand.html#argsOneShots"><span class="hs-identifier hs-type">argsOneShots</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><a href="GHC.Types.Demand.html#StrictSig"><span class="hs-identifier hs-type">StrictSig</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="GHC.Types.Basic.html#Arity"><span class="hs-identifier hs-type">Arity</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-special">[</span><span class="hs-special">[</span><span class="annot"><a href="GHC.Types.Basic.html#OneShotInfo"><span class="hs-identifier hs-type">OneShotInfo</span></a></span><span class="hs-special">]</span><span class="hs-special">]</span><span>
</span><span id="line-594"></span><span class="hs-comment">-- ^ See Note [Computing one-shot info]</span><span>
</span><span id="line-595"></span><span id="argsOneShots"><span class="annot"><span class="annottext">argsOneShots :: StrictSig -&gt; Int -&gt; [[OneShotInfo]]
</span><a href="GHC.Types.Demand.html#argsOneShots"><span class="hs-identifier hs-var hs-var">argsOneShots</span></a></span></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="GHC.Types.Demand.html#StrictSig"><span class="hs-identifier hs-type">StrictSig</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="GHC.Types.Demand.html#DmdType"><span class="hs-identifier hs-type">DmdType</span></a></span><span> </span><span class="annot"><span class="annottext">DmdEnv
</span><span class="hs-identifier">_</span></span><span> </span><span id="local-6989586621680990775"><span class="annot"><span class="annottext">[Demand]
</span><a href="#local-6989586621680990775"><span class="hs-identifier hs-var">arg_ds</span></a></span></span><span> </span><span class="annot"><span class="annottext">Divergence
</span><span class="hs-identifier">_</span></span><span class="hs-special">)</span><span class="hs-special">)</span><span> </span><span id="local-6989586621680990774"><span class="annot"><span class="annottext">Int
</span><a href="#local-6989586621680990774"><span class="hs-identifier hs-var">n_val_args</span></a></span></span><span>
</span><span id="line-596"></span><span>  </span><span class="hs-glyph">|</span><span> </span><span class="annot"><span class="annottext">Bool
</span><a href="#local-6989586621680990773"><span class="hs-identifier hs-var">unsaturated_call</span></a></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-special">[</span><span class="hs-special">]</span><span>
</span><span id="line-597"></span><span>  </span><span class="hs-glyph">|</span><span> </span><span class="annot"><span class="annottext">Bool
</span><a href="../../base-4.16.4.0/src/GHC-Base.html#otherwise"><span class="hs-identifier hs-var">otherwise</span></a></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">[Demand] -&gt; [[OneShotInfo]]
</span><a href="#local-6989586621680990772"><span class="hs-identifier hs-var">go</span></a></span><span> </span><span class="annot"><span class="annottext">[Demand]
</span><a href="#local-6989586621680990775"><span class="hs-identifier hs-var">arg_ds</span></a></span><span>
</span><span id="line-598"></span><span>  </span><span class="hs-keyword">where</span><span>
</span><span id="line-599"></span><span>    </span><span id="local-6989586621680990773"><span class="annot"><span class="annottext">unsaturated_call :: Bool
</span><a href="#local-6989586621680990773"><span class="hs-identifier hs-var hs-var">unsaturated_call</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">[Demand]
</span><a href="#local-6989586621680990775"><span class="hs-identifier hs-var">arg_ds</span></a></span><span> </span><span class="annot"><span class="annottext">forall a. [a] -&gt; Int -&gt; Bool
</span><a href="GHC.Utils.Misc.html#lengthExceeds"><span class="hs-operator hs-var">`lengthExceeds`</span></a></span><span> </span><span class="annot"><span class="annottext">Int
</span><a href="#local-6989586621680990774"><span class="hs-identifier hs-var">n_val_args</span></a></span><span>
</span><span id="line-600"></span><span>
</span><span id="line-601"></span><span>    </span><span id="local-6989586621680990772"><span class="annot"><span class="annottext">go :: [Demand] -&gt; [[OneShotInfo]]
</span><a href="#local-6989586621680990772"><span class="hs-identifier hs-var hs-var">go</span></a></span></span><span> </span><span class="hs-special">[</span><span class="hs-special">]</span><span>               </span><span class="hs-glyph">=</span><span> </span><span class="hs-special">[</span><span class="hs-special">]</span><span>
</span><span id="line-602"></span><span>    </span><span class="annot"><a href="#local-6989586621680990772"><span class="hs-identifier hs-var">go</span></a></span><span> </span><span class="hs-special">(</span><span id="local-6989586621680990770"><span class="annot"><span class="annottext">Demand
</span><a href="#local-6989586621680990770"><span class="hs-identifier hs-var">arg_d</span></a></span></span><span> </span><span class="annot"><span class="hs-glyph hs-type">:</span></span><span> </span><span id="local-6989586621680990769"><span class="annot"><span class="annottext">[Demand]
</span><a href="#local-6989586621680990769"><span class="hs-identifier hs-var">arg_ds</span></a></span></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">Demand -&gt; [OneShotInfo]
</span><a href="GHC.Types.Demand.html#argOneShots"><span class="hs-identifier hs-var">argOneShots</span></a></span><span> </span><span class="annot"><span class="annottext">Demand
</span><a href="#local-6989586621680990770"><span class="hs-identifier hs-var">arg_d</span></a></span><span> </span><span class="annot"><span class="annottext">forall {a}. [a] -&gt; [[a]] -&gt; [[a]]
</span><a href="#local-6989586621680990768"><span class="hs-operator hs-var">`cons`</span></a></span><span> </span><span class="annot"><span class="annottext">[Demand] -&gt; [[OneShotInfo]]
</span><a href="#local-6989586621680990772"><span class="hs-identifier hs-var">go</span></a></span><span> </span><span class="annot"><span class="annottext">[Demand]
</span><a href="#local-6989586621680990769"><span class="hs-identifier hs-var">arg_ds</span></a></span><span>
</span><span id="line-603"></span><span>
</span><span id="line-604"></span><span>    </span><span class="hs-comment">-- Avoid list tail like [ [], [], [] ]</span><span>
</span><span id="line-605"></span><span>    </span><span id="local-6989586621680990768"><span class="annot"><span class="annottext">cons :: [a] -&gt; [[a]] -&gt; [[a]]
</span><a href="#local-6989586621680990768"><span class="hs-identifier hs-var hs-var">cons</span></a></span></span><span> </span><span class="hs-special">[</span><span class="hs-special">]</span><span> </span><span class="hs-special">[</span><span class="hs-special">]</span><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-special">[</span><span class="hs-special">]</span><span>
</span><span id="line-606"></span><span>    </span><span class="annot"><a href="#local-6989586621680990768"><span class="hs-identifier hs-var">cons</span></a></span><span> </span><span id="local-6989586621680990767"><span class="annot"><span class="annottext">[a]
</span><a href="#local-6989586621680990767"><span class="hs-identifier hs-var">a</span></a></span></span><span>  </span><span id="local-6989586621680990766"><span class="annot"><span class="annottext">[[a]]
</span><a href="#local-6989586621680990766"><span class="hs-keyword hs-var">as</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">[a]
</span><a href="#local-6989586621680990767"><span class="hs-identifier hs-var">a</span></a></span><span class="annot"><span class="annottext">forall a. a -&gt; [a] -&gt; [a]
</span><span class="hs-glyph hs-var">:</span></span><span class="annot"><span class="annottext">[[a]]
</span><a href="#local-6989586621680990766"><span class="hs-keyword hs-var">as</span></a></span><span>
</span><span id="line-607"></span><span>
</span><span id="line-608"></span><span class="annot"><a href="GHC.Types.Demand.html#argOneShots"><span class="hs-identifier hs-type">argOneShots</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><a href="GHC.Types.Demand.html#Demand"><span class="hs-identifier hs-type">Demand</span></a></span><span>          </span><span class="hs-comment">-- ^ depending on saturation</span><span>
</span><span id="line-609"></span><span>            </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-special">[</span><span class="annot"><a href="GHC.Types.Basic.html#OneShotInfo"><span class="hs-identifier hs-type">OneShotInfo</span></a></span><span class="hs-special">]</span><span>
</span><span id="line-610"></span><span class="hs-comment">-- ^ See Note [Computing one-shot info]</span><span>
</span><span id="line-611"></span><span id="argOneShots"><span class="annot"><span class="annottext">argOneShots :: Demand -&gt; [OneShotInfo]
</span><a href="GHC.Types.Demand.html#argOneShots"><span class="hs-identifier hs-var hs-var">argOneShots</span></a></span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Card
</span><span class="hs-identifier">_</span></span><span> </span><span class="annot"><a href="GHC.Types.Demand.html#%3A%2A"><span class="hs-operator hs-type">:*</span></a></span><span> </span><span id="local-6989586621680990765"><span class="annot"><span class="annottext">SubDemand
</span><a href="#local-6989586621680990765"><span class="hs-identifier hs-var">sd</span></a></span></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">SubDemand -&gt; [OneShotInfo]
</span><a href="#local-6989586621680990764"><span class="hs-identifier hs-var">go</span></a></span><span> </span><span class="annot"><span class="annottext">SubDemand
</span><a href="#local-6989586621680990765"><span class="hs-identifier hs-var">sd</span></a></span><span> </span><span class="hs-comment">-- See Note [Call demands are relative]</span><span>
</span><span id="line-612"></span><span>  </span><span class="hs-keyword">where</span><span>
</span><span id="line-613"></span><span>    </span><span id="local-6989586621680990764"><span class="annot"><span class="annottext">go :: SubDemand -&gt; [OneShotInfo]
</span><a href="#local-6989586621680990764"><span class="hs-identifier hs-var hs-var">go</span></a></span></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="GHC.Types.Demand.html#Call"><span class="hs-identifier hs-type">Call</span></a></span><span> </span><span id="local-6989586621680990763"><span class="annot"><span class="annottext">Card
</span><a href="#local-6989586621680990763"><span class="hs-identifier hs-var">n</span></a></span></span><span> </span><span id="local-6989586621680990762"><span class="annot"><span class="annottext">SubDemand
</span><a href="#local-6989586621680990762"><span class="hs-identifier hs-var">sd</span></a></span></span><span class="hs-special">)</span><span>
</span><span id="line-614"></span><span>      </span><span class="hs-glyph">|</span><span> </span><span class="annot"><span class="annottext">Card -&gt; Bool
</span><a href="GHC.Types.Demand.html#isUsedOnce"><span class="hs-identifier hs-var">isUsedOnce</span></a></span><span> </span><span class="annot"><span class="annottext">Card
</span><a href="#local-6989586621680990763"><span class="hs-identifier hs-var">n</span></a></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">OneShotInfo
</span><a href="GHC.Types.Basic.html#OneShotLam"><span class="hs-identifier hs-var">OneShotLam</span></a></span><span>    </span><span class="annot"><span class="annottext">forall a. a -&gt; [a] -&gt; [a]
</span><span class="hs-glyph hs-var">:</span></span><span> </span><span class="annot"><span class="annottext">SubDemand -&gt; [OneShotInfo]
</span><a href="#local-6989586621680990764"><span class="hs-identifier hs-var">go</span></a></span><span> </span><span class="annot"><span class="annottext">SubDemand
</span><a href="#local-6989586621680990762"><span class="hs-identifier hs-var">sd</span></a></span><span>
</span><span id="line-615"></span><span>      </span><span class="hs-glyph">|</span><span> </span><span class="annot"><span class="annottext">Bool
</span><a href="../../base-4.16.4.0/src/GHC-Base.html#otherwise"><span class="hs-identifier hs-var">otherwise</span></a></span><span>    </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">OneShotInfo
</span><a href="GHC.Types.Basic.html#NoOneShotInfo"><span class="hs-identifier hs-var">NoOneShotInfo</span></a></span><span> </span><span class="annot"><span class="annottext">forall a. a -&gt; [a] -&gt; [a]
</span><span class="hs-glyph hs-var">:</span></span><span> </span><span class="annot"><span class="annottext">SubDemand -&gt; [OneShotInfo]
</span><a href="#local-6989586621680990764"><span class="hs-identifier hs-var">go</span></a></span><span> </span><span class="annot"><span class="annottext">SubDemand
</span><a href="#local-6989586621680990762"><span class="hs-identifier hs-var">sd</span></a></span><span>
</span><span id="line-616"></span><span>    </span><span class="annot"><a href="#local-6989586621680990764"><span class="hs-identifier hs-var">go</span></a></span><span> </span><span class="annot"><span class="annottext">SubDemand
</span><span class="hs-identifier">_</span></span><span>    </span><span class="hs-glyph">=</span><span> </span><span class="hs-special">[</span><span class="hs-special">]</span><span>
</span><span id="line-617"></span><span>
</span><span id="line-618"></span><span class="hs-comment">-- |</span><span>
</span><span id="line-619"></span><span class="hs-comment">-- @saturatedByOneShots n CM(CM(...)) = True@</span><span>
</span><span id="line-620"></span><span class="hs-comment">--   &lt;=&gt;</span><span>
</span><span id="line-621"></span><span class="hs-comment">-- There are at least n nested CM(..) calls.</span><span>
</span><span id="line-622"></span><span class="hs-comment">-- See Note [Demand on the worker] in GHC.Core.Opt.WorkWrap</span><span>
</span><span id="line-623"></span><span class="annot"><a href="GHC.Types.Demand.html#saturatedByOneShots"><span class="hs-identifier hs-type">saturatedByOneShots</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><span class="hs-identifier hs-type">Int</span></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="GHC.Types.Demand.html#Demand"><span class="hs-identifier hs-type">Demand</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="hs-identifier hs-type">Bool</span></span><span>
</span><span id="line-624"></span><span id="saturatedByOneShots"><span class="annot"><span class="annottext">saturatedByOneShots :: Int -&gt; Demand -&gt; Bool
</span><a href="GHC.Types.Demand.html#saturatedByOneShots"><span class="hs-identifier hs-var hs-var">saturatedByOneShots</span></a></span></span><span> </span><span id="local-6989586621680990759"><span class="annot"><span class="annottext">Int
</span><a href="#local-6989586621680990759"><span class="hs-identifier hs-var">n</span></a></span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Card
</span><span class="hs-identifier">_</span></span><span> </span><span class="annot"><a href="GHC.Types.Demand.html#%3A%2A"><span class="hs-operator hs-type">:*</span></a></span><span> </span><span id="local-6989586621680990758"><span class="annot"><span class="annottext">SubDemand
</span><a href="#local-6989586621680990758"><span class="hs-identifier hs-var">sd</span></a></span></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">Card -&gt; Bool
</span><a href="GHC.Types.Demand.html#isUsedOnce"><span class="hs-identifier hs-var">isUsedOnce</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Int -&gt; SubDemand -&gt; Card
</span><a href="GHC.Types.Demand.html#peelManyCalls"><span class="hs-identifier hs-var">peelManyCalls</span></a></span><span> </span><span class="annot"><span class="annottext">Int
</span><a href="#local-6989586621680990759"><span class="hs-identifier hs-var">n</span></a></span><span> </span><span class="annot"><span class="annottext">SubDemand
</span><a href="#local-6989586621680990758"><span class="hs-identifier hs-var">sd</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-625"></span><span>
</span><span id="line-626"></span><span class="hs-comment">{- Note [Strict demands]
~~~~~~~~~~~~~~~~~~~~~~~~
'isStrUsedDmd' returns true only of demands that are
   both strict
   and  used

In particular, it is False for &lt;B&gt; (i.e. strict and not used,
cardinality C_10), which can and does arise in, say (#7319)
   f x = raise# &lt;some exception&gt;
Then 'x' is not used, so f gets strictness &lt;B&gt; -&gt; .
Now the w/w generates
   fx = let x &lt;B&gt; = absentError &quot;unused&quot;
        in raise &lt;some exception&gt;
At this point we really don't want to convert to
   fx = case absentError &quot;unused&quot; of x -&gt; raise &lt;some exception&gt;
Since the program is going to diverge, this swaps one error for another,
but it's really a bad idea to *ever* evaluate an absent argument.
In #7319 we get
   T7319.exe: Oops!  Entered absent arg w_s1Hd{v} [lid] [base:GHC.Base.String{tc 36u}]

Note [Call demands are relative]
~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~
The expression @if b then 0 else f 1 2 + f 3 4@ uses @f@ according to the demand
@LCL(C1(P(L)))@, meaning

  &quot;f is called multiple times or not at all (CL), but each time it
   is called, it's called with *exactly one* (C1) more argument.
   Whenever it is called with two arguments, we have no info on how often
   the field of the product result is used (L).&quot;

So the 'SubDemand' nested in a 'Call' demand is relative to exactly one call.
And that extends to the information we have how its results are used in each
call site. Consider (#18903)

  h :: Int -&gt; Int
  h m =
    let g :: Int -&gt; (Int,Int)
        g 1 = (m, 0)
        g n = (2 * n, 2 `div` n)
        {-# NOINLINE g #-}
    in case m of
      1 -&gt; 0
      2 -&gt; snd (g m)
      _ -&gt; uncurry (+) (g m)

We want to give @g@ the demand @MCM(P(MP(L),1P(L)))@, so we see that in each call
site of @g@, we are strict in the second component of the returned pair.

This relative cardinality leads to an otherwise unexpected call to 'lubSubDmd'
in 'plusSubDmd', but if you do the math it's just the right thing.

There's one more subtlety: Since the nested demand is relative to exactly one
call, in the case where we have *at most zero calls* (e.g. CA(...)), the premise
is hurt and we can assume that the nested demand is 'botSubDmd'. That ensures
that @g@ above actually gets the @1P(L)@ demand on its second pair component,
rather than the lazy @MP(L)@ if we 'lub'bed with an absent demand.

Demand on case-alternative binders]
~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~
The demand on a binder in a case alternative comes
  (a) From the demand on the binder itself
  (b) From the demand on the case binder
Forgetting (b) led directly to #10148.

Example. Source code:
  f x@(p,_) = if p then foo x else True

  foo (p,True) = True
  foo (p,q)    = foo (q,p)

After strictness analysis:
  f = \ (x_an1 [Dmd=1P(1L,ML)] :: (Bool, Bool)) -&gt;
      case x_an1
      of wild_X7 [Dmd=MP(ML,ML)]
      { (p_an2 [Dmd=1L], ds_dnz [Dmd=A]) -&gt;
      case p_an2 of _ {
        False -&gt; GHC.Types.True;
        True -&gt; foo wild_X7 }

It's true that ds_dnz is *itself* absent, but the use of wild_X7 means
that it is very much alive and demanded.  See #10148 for how the
consequences play out.

This is needed even for non-product types, in case the case-binder
is used but the components of the case alternative are not.

Note [Don't optimise LP(L,L,...) to L]
~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~
These two SubDemands:
   LP(L,L) (@Prod [topDmd, topDmd]@)   and   L (@topSubDmd@)
are semantically equivalent, but we do not turn the former into
the latter, for a regrettable-subtle reason.  Consider
  f p1@(x,y) = (y,x)
  g h p2@(_,_) = h p
We want to unbox @p1@ of @f@, but not @p2@ of @g@, because @g@ only uses
@p2@ boxed and we'd have to rebox. So we give @p1@ demand LP(L,L) and @p2@
demand @L@ to inform 'GHC.Core.Opt.WorkWrap.Utils.wantToUnbox', which will
say &quot;unbox&quot; for @p1@ and &quot;don't unbox&quot; for @p2@.

So the solution is: don't aggressively collapse @Prod [topDmd, topDmd]@ to
@topSubDmd@; instead leave it as-is. In effect we are using the UseDmd to do a
little bit of boxity analysis.  Not very nice.

Note [L should win]
~~~~~~~~~~~~~~~~~~~
Both in 'lubSubDmd' and 'plusSubDmd' we want @L `plusSubDmd` LP(..))@ to be @L@.
Why?  Because U carries the implication the whole thing is used, box and all,
so we don't want to w/w it, cf. Note [Don't optimise LP(L,L,...) to L].
If we use it both boxed and unboxed, then we are definitely using the box,
and so we are quite likely to pay a reboxing cost. So we make U win here.
TODO: Investigate why since 2013, we don't.

Example is in the Buffer argument of GHC.IO.Handle.Internals.writeCharBuffer

Baseline: (A) Not making Used win (LP(..) wins)
Compare with: (B) making Used win for lub and both

            Min          -0.3%     -5.6%    -10.7%    -11.0%    -33.3%
            Max          +0.3%    +45.6%    +11.5%    +11.5%     +6.9%
 Geometric Mean          -0.0%     +0.5%     +0.3%     +0.2%     -0.8%

Baseline: (B) Making L win for both lub and both
Compare with: (C) making L win for plus, but LP(..) win for lub

            Min          -0.1%     -0.3%     -7.9%     -8.0%     -6.5%
            Max          +0.1%     +1.0%    +21.0%    +21.0%     +0.5%
 Geometric Mean          +0.0%     +0.0%     -0.0%     -0.1%     -0.1%

Note [Computing one-shot info]
~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~
Consider a call
    f (\pqr. e1) (\xyz. e2) e3
where f has usage signature
    &lt;CM(CL(CM(L)))&gt;&lt;CM(L)&gt;&lt;L&gt;
Then argsOneShots returns a [[OneShotInfo]] of
    [[OneShot,NoOneShotInfo,OneShot],  [OneShot]]
The occurrence analyser propagates this one-shot infor to the
binders \pqr and \xyz;
see Note [Use one-shot information] in &quot;GHC.Core.Opt.OccurAnal&quot;.
-}</span><span>
</span><span id="line-766"></span><span>
</span><span id="line-767"></span><span class="hs-comment">{- *********************************************************************
*                                                                      *
                 Divergence: Whether evaluation surely diverges
*                                                                      *
********************************************************************* -}</span><span>
</span><span id="line-772"></span><span>
</span><span id="line-773"></span><span class="hs-comment">-- | 'Divergence' characterises whether something surely diverges.</span><span>
</span><span id="line-774"></span><span class="hs-comment">-- Models a subset lattice of the following exhaustive set of divergence</span><span>
</span><span id="line-775"></span><span class="hs-comment">-- results:</span><span>
</span><span id="line-776"></span><span class="hs-comment">--</span><span>
</span><span id="line-777"></span><span class="hs-comment">-- [n] nontermination (e.g. loops)</span><span>
</span><span id="line-778"></span><span class="hs-comment">-- [i] throws imprecise exception</span><span>
</span><span id="line-779"></span><span class="hs-comment">-- [p] throws precise exceTtion</span><span>
</span><span id="line-780"></span><span class="hs-comment">-- [c] converges (reduces to WHNF).</span><span>
</span><span id="line-781"></span><span class="hs-comment">--</span><span>
</span><span id="line-782"></span><span class="hs-comment">-- The different lattice elements correspond to different subsets, indicated by</span><span>
</span><span id="line-783"></span><span class="hs-comment">-- juxtaposition of indicators (e.g. __nc__ definitely doesn't throw an</span><span>
</span><span id="line-784"></span><span class="hs-comment">-- exception, and may or may not reduce to WHNF).</span><span>
</span><span id="line-785"></span><span class="hs-comment">--</span><span>
</span><span id="line-786"></span><span class="hs-comment">-- @</span><span>
</span><span id="line-787"></span><span class="hs-comment">--             Dunno (nipc)</span><span>
</span><span id="line-788"></span><span class="hs-comment">--                  |</span><span>
</span><span id="line-789"></span><span class="hs-comment">--            ExnOrDiv (nip)</span><span>
</span><span id="line-790"></span><span class="hs-comment">--                  |</span><span>
</span><span id="line-791"></span><span class="hs-comment">--            Diverges (ni)</span><span>
</span><span id="line-792"></span><span class="hs-comment">-- @</span><span>
</span><span id="line-793"></span><span class="hs-comment">--</span><span>
</span><span id="line-794"></span><span class="hs-comment">-- As you can see, we don't distinguish __n__ and __i__.</span><span>
</span><span id="line-795"></span><span class="hs-comment">-- See Note [Precise exceptions and strictness analysis] for why __p__ is so</span><span>
</span><span id="line-796"></span><span class="hs-comment">-- special compared to __i__.</span><span>
</span><span id="line-797"></span><span class="hs-keyword">data</span><span> </span><span id="Divergence"><span class="annot"><a href="GHC.Types.Demand.html#Divergence"><span class="hs-identifier hs-var">Divergence</span></a></span></span><span>
</span><span id="line-798"></span><span>  </span><span class="hs-glyph">=</span><span> </span><span id="Diverges"><span class="annot"><a href="GHC.Types.Demand.html#Diverges"><span class="hs-identifier hs-var">Diverges</span></a></span></span><span> </span><span class="hs-comment">-- ^ Definitely throws an imprecise exception or diverges.</span><span>
</span><span id="line-799"></span><span>  </span><span class="hs-glyph">|</span><span> </span><span id="ExnOrDiv"><span class="annot"><a href="GHC.Types.Demand.html#ExnOrDiv"><span class="hs-identifier hs-var">ExnOrDiv</span></a></span></span><span> </span><span class="hs-comment">-- ^ Definitely throws a *precise* exception, an imprecise</span><span>
</span><span id="line-800"></span><span>             </span><span class="hs-comment">--   exception or diverges. Never converges, hence 'isDeadEndDiv'!</span><span>
</span><span id="line-801"></span><span>             </span><span class="hs-comment">--   See scenario 1 in Note [Precise exceptions and strictness analysis].</span><span>
</span><span id="line-802"></span><span>  </span><span class="hs-glyph">|</span><span> </span><span id="Dunno"><span class="annot"><a href="GHC.Types.Demand.html#Dunno"><span class="hs-identifier hs-var">Dunno</span></a></span></span><span>    </span><span class="hs-comment">-- ^ Might diverge, throw any kind of exception or converge.</span><span>
</span><span id="line-803"></span><span>  </span><span class="hs-keyword">deriving</span><span> </span><span id="local-6989586621680990751"><span id="local-6989586621680990753"><span class="annot"><span class="annottext">Divergence -&gt; Divergence -&gt; Bool
forall a. (a -&gt; a -&gt; Bool) -&gt; (a -&gt; a -&gt; Bool) -&gt; Eq a
/= :: Divergence -&gt; Divergence -&gt; Bool
$c/= :: Divergence -&gt; Divergence -&gt; Bool
== :: Divergence -&gt; Divergence -&gt; Bool
$c== :: Divergence -&gt; Divergence -&gt; Bool
</span><span class="hs-identifier hs-var hs-var hs-var hs-var hs-var hs-var">Eq</span></span></span></span><span>
</span><span id="line-804"></span><span>
</span><span id="line-805"></span><span class="annot"><a href="GHC.Types.Demand.html#lubDivergence"><span class="hs-identifier hs-type">lubDivergence</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><a href="GHC.Types.Demand.html#Divergence"><span class="hs-identifier hs-type">Divergence</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="GHC.Types.Demand.html#Divergence"><span class="hs-identifier hs-type">Divergence</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="GHC.Types.Demand.html#Divergence"><span class="hs-identifier hs-type">Divergence</span></a></span><span>
</span><span id="line-806"></span><span id="lubDivergence"><span class="annot"><span class="annottext">lubDivergence :: Divergence -&gt; Divergence -&gt; Divergence
</span><a href="GHC.Types.Demand.html#lubDivergence"><span class="hs-identifier hs-var hs-var">lubDivergence</span></a></span></span><span> </span><span class="annot"><span class="annottext">Divergence
</span><a href="GHC.Types.Demand.html#Diverges"><span class="hs-identifier hs-var">Diverges</span></a></span><span> </span><span id="local-6989586621680990750"><span class="annot"><span class="annottext">Divergence
</span><a href="#local-6989586621680990750"><span class="hs-identifier hs-var">div</span></a></span></span><span>      </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">Divergence
</span><a href="#local-6989586621680990750"><span class="hs-identifier hs-var">div</span></a></span><span>
</span><span id="line-807"></span><span class="annot"><a href="GHC.Types.Demand.html#lubDivergence"><span class="hs-identifier hs-var">lubDivergence</span></a></span><span> </span><span id="local-6989586621680990749"><span class="annot"><span class="annottext">Divergence
</span><a href="#local-6989586621680990749"><span class="hs-identifier hs-var">div</span></a></span></span><span>      </span><span class="annot"><span class="annottext">Divergence
</span><a href="GHC.Types.Demand.html#Diverges"><span class="hs-identifier hs-var">Diverges</span></a></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">Divergence
</span><a href="#local-6989586621680990749"><span class="hs-identifier hs-var">div</span></a></span><span>
</span><span id="line-808"></span><span class="annot"><a href="GHC.Types.Demand.html#lubDivergence"><span class="hs-identifier hs-var">lubDivergence</span></a></span><span> </span><span class="annot"><span class="annottext">Divergence
</span><a href="GHC.Types.Demand.html#ExnOrDiv"><span class="hs-identifier hs-var">ExnOrDiv</span></a></span><span> </span><span class="annot"><span class="annottext">Divergence
</span><a href="GHC.Types.Demand.html#ExnOrDiv"><span class="hs-identifier hs-var">ExnOrDiv</span></a></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">Divergence
</span><a href="GHC.Types.Demand.html#ExnOrDiv"><span class="hs-identifier hs-var">ExnOrDiv</span></a></span><span>
</span><span id="line-809"></span><span class="annot"><a href="GHC.Types.Demand.html#lubDivergence"><span class="hs-identifier hs-var">lubDivergence</span></a></span><span> </span><span class="annot"><span class="annottext">Divergence
</span><span class="hs-identifier">_</span></span><span>        </span><span class="annot"><span class="annottext">Divergence
</span><span class="hs-identifier">_</span></span><span>        </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">Divergence
</span><a href="GHC.Types.Demand.html#Dunno"><span class="hs-identifier hs-var">Dunno</span></a></span><span>
</span><span id="line-810"></span><span class="hs-comment">-- This needs to commute with defaultFvDmd, i.e.</span><span>
</span><span id="line-811"></span><span class="hs-comment">-- defaultFvDmd (r1 `lubDivergence` r2) = defaultFvDmd r1 `lubDmd` defaultFvDmd r2</span><span>
</span><span id="line-812"></span><span class="hs-comment">-- (See Note [Default demand on free variables and arguments] for why)</span><span>
</span><span id="line-813"></span><span>
</span><span id="line-814"></span><span class="hs-comment">-- | See Note [Asymmetry of 'plus*'], which concludes that 'plusDivergence'</span><span>
</span><span id="line-815"></span><span class="hs-comment">-- needs to be symmetric.</span><span>
</span><span id="line-816"></span><span class="hs-comment">-- Strictly speaking, we should have @plusDivergence Dunno Diverges = ExnOrDiv@.</span><span>
</span><span id="line-817"></span><span class="hs-comment">-- But that regresses in too many places (every infinite loop, basically) to be</span><span>
</span><span id="line-818"></span><span class="hs-comment">-- worth it and is only relevant in higher-order scenarios</span><span>
</span><span id="line-819"></span><span class="hs-comment">-- (e.g. Divergence of @f (throwIO blah)@).</span><span>
</span><span id="line-820"></span><span class="hs-comment">-- So 'plusDivergence' currently is 'glbDivergence', really.</span><span>
</span><span id="line-821"></span><span class="annot"><a href="GHC.Types.Demand.html#plusDivergence"><span class="hs-identifier hs-type">plusDivergence</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><a href="GHC.Types.Demand.html#Divergence"><span class="hs-identifier hs-type">Divergence</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="GHC.Types.Demand.html#Divergence"><span class="hs-identifier hs-type">Divergence</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="GHC.Types.Demand.html#Divergence"><span class="hs-identifier hs-type">Divergence</span></a></span><span>
</span><span id="line-822"></span><span id="plusDivergence"><span class="annot"><span class="annottext">plusDivergence :: Divergence -&gt; Divergence -&gt; Divergence
</span><a href="GHC.Types.Demand.html#plusDivergence"><span class="hs-identifier hs-var hs-var">plusDivergence</span></a></span></span><span> </span><span class="annot"><span class="annottext">Divergence
</span><a href="GHC.Types.Demand.html#Dunno"><span class="hs-identifier hs-var">Dunno</span></a></span><span>    </span><span class="annot"><span class="annottext">Divergence
</span><a href="GHC.Types.Demand.html#Dunno"><span class="hs-identifier hs-var">Dunno</span></a></span><span>    </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">Divergence
</span><a href="GHC.Types.Demand.html#Dunno"><span class="hs-identifier hs-var">Dunno</span></a></span><span>
</span><span id="line-823"></span><span class="annot"><a href="GHC.Types.Demand.html#plusDivergence"><span class="hs-identifier hs-var">plusDivergence</span></a></span><span> </span><span class="annot"><span class="annottext">Divergence
</span><a href="GHC.Types.Demand.html#Diverges"><span class="hs-identifier hs-var">Diverges</span></a></span><span> </span><span class="annot"><span class="annottext">Divergence
</span><span class="hs-identifier">_</span></span><span>        </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">Divergence
</span><a href="GHC.Types.Demand.html#Diverges"><span class="hs-identifier hs-var">Diverges</span></a></span><span>
</span><span id="line-824"></span><span class="annot"><a href="GHC.Types.Demand.html#plusDivergence"><span class="hs-identifier hs-var">plusDivergence</span></a></span><span> </span><span class="annot"><span class="annottext">Divergence
</span><span class="hs-identifier">_</span></span><span>        </span><span class="annot"><span class="annottext">Divergence
</span><a href="GHC.Types.Demand.html#Diverges"><span class="hs-identifier hs-var">Diverges</span></a></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">Divergence
</span><a href="GHC.Types.Demand.html#Diverges"><span class="hs-identifier hs-var">Diverges</span></a></span><span>
</span><span id="line-825"></span><span class="annot"><a href="GHC.Types.Demand.html#plusDivergence"><span class="hs-identifier hs-var">plusDivergence</span></a></span><span> </span><span class="annot"><span class="annottext">Divergence
</span><span class="hs-identifier">_</span></span><span>        </span><span class="annot"><span class="annottext">Divergence
</span><span class="hs-identifier">_</span></span><span>        </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">Divergence
</span><a href="GHC.Types.Demand.html#ExnOrDiv"><span class="hs-identifier hs-var">ExnOrDiv</span></a></span><span>
</span><span id="line-826"></span><span>
</span><span id="line-827"></span><span class="hs-comment">-- | In a non-strict scenario, we might not force the Divergence, in which case</span><span>
</span><span id="line-828"></span><span class="hs-comment">-- we might converge, hence Dunno.</span><span>
</span><span id="line-829"></span><span class="annot"><a href="GHC.Types.Demand.html#multDivergence"><span class="hs-identifier hs-type">multDivergence</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><a href="GHC.Types.Demand.html#Card"><span class="hs-identifier hs-type">Card</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="GHC.Types.Demand.html#Divergence"><span class="hs-identifier hs-type">Divergence</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="GHC.Types.Demand.html#Divergence"><span class="hs-identifier hs-type">Divergence</span></a></span><span>
</span><span id="line-830"></span><span id="multDivergence"><span class="annot"><span class="annottext">multDivergence :: Card -&gt; Divergence -&gt; Divergence
</span><a href="GHC.Types.Demand.html#multDivergence"><span class="hs-identifier hs-var hs-var">multDivergence</span></a></span></span><span> </span><span id="local-6989586621680990746"><span class="annot"><span class="annottext">Card
</span><a href="#local-6989586621680990746"><span class="hs-identifier hs-var">n</span></a></span></span><span> </span><span class="annot"><span class="annottext">Divergence
</span><span class="hs-identifier">_</span></span><span> </span><span class="hs-glyph">|</span><span> </span><span class="annot"><span class="annottext">Bool -&gt; Bool
</span><span class="hs-identifier hs-var">not</span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Card -&gt; Bool
</span><a href="GHC.Types.Demand.html#isStrict"><span class="hs-identifier hs-var">isStrict</span></a></span><span> </span><span class="annot"><span class="annottext">Card
</span><a href="#local-6989586621680990746"><span class="hs-identifier hs-var">n</span></a></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">Divergence
</span><a href="GHC.Types.Demand.html#Dunno"><span class="hs-identifier hs-var">Dunno</span></a></span><span>
</span><span id="line-831"></span><span class="annot"><a href="GHC.Types.Demand.html#multDivergence"><span class="hs-identifier hs-var">multDivergence</span></a></span><span> </span><span class="annot"><span class="annottext">Card
</span><span class="hs-identifier">_</span></span><span> </span><span id="local-6989586621680990745"><span class="annot"><span class="annottext">Divergence
</span><a href="#local-6989586621680990745"><span class="hs-identifier hs-var">d</span></a></span></span><span>                    </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">Divergence
</span><a href="#local-6989586621680990745"><span class="hs-identifier hs-var">d</span></a></span><span>
</span><span id="line-832"></span><span>
</span><span id="line-833"></span><span class="annot"><a href="GHC.Types.Demand.html#topDiv"><span class="hs-identifier hs-type">topDiv</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><a href="GHC.Types.Demand.html#exnDiv"><span class="hs-identifier hs-type">exnDiv</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><a href="GHC.Types.Demand.html#botDiv"><span class="hs-identifier hs-type">botDiv</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><a href="GHC.Types.Demand.html#Divergence"><span class="hs-identifier hs-type">Divergence</span></a></span><span>
</span><span id="line-834"></span><span id="topDiv"><span class="annot"><span class="annottext">topDiv :: Divergence
</span><a href="GHC.Types.Demand.html#topDiv"><span class="hs-identifier hs-var hs-var">topDiv</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">Divergence
</span><a href="GHC.Types.Demand.html#Dunno"><span class="hs-identifier hs-var">Dunno</span></a></span><span>
</span><span id="line-835"></span><span id="exnDiv"><span class="annot"><span class="annottext">exnDiv :: Divergence
</span><a href="GHC.Types.Demand.html#exnDiv"><span class="hs-identifier hs-var hs-var">exnDiv</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">Divergence
</span><a href="GHC.Types.Demand.html#ExnOrDiv"><span class="hs-identifier hs-var">ExnOrDiv</span></a></span><span>
</span><span id="line-836"></span><span id="botDiv"><span class="annot"><span class="annottext">botDiv :: Divergence
</span><a href="GHC.Types.Demand.html#botDiv"><span class="hs-identifier hs-var hs-var">botDiv</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">Divergence
</span><a href="GHC.Types.Demand.html#Diverges"><span class="hs-identifier hs-var">Diverges</span></a></span><span>
</span><span id="line-837"></span><span>
</span><span id="line-838"></span><span class="hs-comment">-- | True if the 'Divergence' indicates that evaluation will not return.</span><span>
</span><span id="line-839"></span><span class="hs-comment">-- See Note [Dead ends].</span><span>
</span><span id="line-840"></span><span class="annot"><a href="GHC.Types.Demand.html#isDeadEndDiv"><span class="hs-identifier hs-type">isDeadEndDiv</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><a href="GHC.Types.Demand.html#Divergence"><span class="hs-identifier hs-type">Divergence</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="hs-identifier hs-type">Bool</span></span><span>
</span><span id="line-841"></span><span id="isDeadEndDiv"><span class="annot"><span class="annottext">isDeadEndDiv :: Divergence -&gt; Bool
</span><a href="GHC.Types.Demand.html#isDeadEndDiv"><span class="hs-identifier hs-var hs-var">isDeadEndDiv</span></a></span></span><span> </span><span class="annot"><span class="annottext">Divergence
</span><a href="GHC.Types.Demand.html#Diverges"><span class="hs-identifier hs-var">Diverges</span></a></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">Bool
</span><span class="hs-identifier hs-var">True</span></span><span>
</span><span id="line-842"></span><span class="annot"><a href="GHC.Types.Demand.html#isDeadEndDiv"><span class="hs-identifier hs-var">isDeadEndDiv</span></a></span><span> </span><span class="annot"><span class="annottext">Divergence
</span><a href="GHC.Types.Demand.html#ExnOrDiv"><span class="hs-identifier hs-var">ExnOrDiv</span></a></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">Bool
</span><span class="hs-identifier hs-var">True</span></span><span>
</span><span id="line-843"></span><span class="annot"><a href="GHC.Types.Demand.html#isDeadEndDiv"><span class="hs-identifier hs-var">isDeadEndDiv</span></a></span><span> </span><span class="annot"><span class="annottext">Divergence
</span><a href="GHC.Types.Demand.html#Dunno"><span class="hs-identifier hs-var">Dunno</span></a></span><span>    </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">Bool
</span><span class="hs-identifier hs-var">False</span></span><span>
</span><span id="line-844"></span><span>
</span><span id="line-845"></span><span class="hs-comment">-- See Notes [Default demand on free variables and arguments]</span><span>
</span><span id="line-846"></span><span class="hs-comment">-- and Scenario 1 in [Precise exceptions and strictness analysis]</span><span>
</span><span id="line-847"></span><span class="annot"><a href="GHC.Types.Demand.html#defaultFvDmd"><span class="hs-identifier hs-type">defaultFvDmd</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><a href="GHC.Types.Demand.html#Divergence"><span class="hs-identifier hs-type">Divergence</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="GHC.Types.Demand.html#Demand"><span class="hs-identifier hs-type">Demand</span></a></span><span>
</span><span id="line-848"></span><span id="defaultFvDmd"><span class="annot"><span class="annottext">defaultFvDmd :: Divergence -&gt; Demand
</span><a href="GHC.Types.Demand.html#defaultFvDmd"><span class="hs-identifier hs-var hs-var">defaultFvDmd</span></a></span></span><span> </span><span class="annot"><span class="annottext">Divergence
</span><a href="GHC.Types.Demand.html#Dunno"><span class="hs-identifier hs-var">Dunno</span></a></span><span>    </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">Demand
</span><a href="GHC.Types.Demand.html#absDmd"><span class="hs-identifier hs-var">absDmd</span></a></span><span>
</span><span id="line-849"></span><span class="annot"><a href="GHC.Types.Demand.html#defaultFvDmd"><span class="hs-identifier hs-var">defaultFvDmd</span></a></span><span> </span><span class="annot"><span class="annottext">Divergence
</span><a href="GHC.Types.Demand.html#ExnOrDiv"><span class="hs-identifier hs-var">ExnOrDiv</span></a></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">Demand
</span><a href="GHC.Types.Demand.html#absDmd"><span class="hs-identifier hs-var">absDmd</span></a></span><span> </span><span class="hs-comment">-- This is the whole point of ExnOrDiv!</span><span>
</span><span id="line-850"></span><span class="annot"><a href="GHC.Types.Demand.html#defaultFvDmd"><span class="hs-identifier hs-var">defaultFvDmd</span></a></span><span> </span><span class="annot"><span class="annottext">Divergence
</span><a href="GHC.Types.Demand.html#Diverges"><span class="hs-identifier hs-var">Diverges</span></a></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">Demand
</span><a href="GHC.Types.Demand.html#botDmd"><span class="hs-identifier hs-var">botDmd</span></a></span><span> </span><span class="hs-comment">-- Diverges</span><span>
</span><span id="line-851"></span><span>
</span><span id="line-852"></span><span class="annot"><a href="GHC.Types.Demand.html#defaultArgDmd"><span class="hs-identifier hs-type">defaultArgDmd</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><a href="GHC.Types.Demand.html#Divergence"><span class="hs-identifier hs-type">Divergence</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="GHC.Types.Demand.html#Demand"><span class="hs-identifier hs-type">Demand</span></a></span><span>
</span><span id="line-853"></span><span class="hs-comment">-- TopRes and BotRes are polymorphic, so that</span><span>
</span><span id="line-854"></span><span class="hs-comment">--      BotRes === (Bot -&gt; BotRes) === ...</span><span>
</span><span id="line-855"></span><span class="hs-comment">--      TopRes === (Top -&gt; TopRes) === ...</span><span>
</span><span id="line-856"></span><span class="hs-comment">-- This function makes that concrete</span><span>
</span><span id="line-857"></span><span class="hs-comment">-- Also see Note [Default demand on free variables and arguments]</span><span>
</span><span id="line-858"></span><span id="defaultArgDmd"><span class="annot"><span class="annottext">defaultArgDmd :: Divergence -&gt; Demand
</span><a href="GHC.Types.Demand.html#defaultArgDmd"><span class="hs-identifier hs-var hs-var">defaultArgDmd</span></a></span></span><span> </span><span class="annot"><span class="annottext">Divergence
</span><a href="GHC.Types.Demand.html#Dunno"><span class="hs-identifier hs-var">Dunno</span></a></span><span>    </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">Demand
</span><a href="GHC.Types.Demand.html#topDmd"><span class="hs-identifier hs-var">topDmd</span></a></span><span>
</span><span id="line-859"></span><span class="hs-comment">-- NB: not botDmd! We don't want to mask the precise exception by forcing the</span><span>
</span><span id="line-860"></span><span class="hs-comment">-- argument. But it is still absent.</span><span>
</span><span id="line-861"></span><span class="annot"><a href="GHC.Types.Demand.html#defaultArgDmd"><span class="hs-identifier hs-var">defaultArgDmd</span></a></span><span> </span><span class="annot"><span class="annottext">Divergence
</span><a href="GHC.Types.Demand.html#ExnOrDiv"><span class="hs-identifier hs-var">ExnOrDiv</span></a></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">Demand
</span><a href="GHC.Types.Demand.html#absDmd"><span class="hs-identifier hs-var">absDmd</span></a></span><span>
</span><span id="line-862"></span><span class="annot"><a href="GHC.Types.Demand.html#defaultArgDmd"><span class="hs-identifier hs-var">defaultArgDmd</span></a></span><span> </span><span class="annot"><span class="annottext">Divergence
</span><a href="GHC.Types.Demand.html#Diverges"><span class="hs-identifier hs-var">Diverges</span></a></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">Demand
</span><a href="GHC.Types.Demand.html#botDmd"><span class="hs-identifier hs-var">botDmd</span></a></span><span>
</span><span id="line-863"></span><span>
</span><span id="line-864"></span><span class="hs-comment">{- Note [Precise vs imprecise exceptions]
~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~
An exception is considered to be /precise/ when it is thrown by the 'raiseIO#'
primop. It follows that all other primops (such as 'raise#' or
division-by-zero) throw /imprecise/ exceptions. Note that the actual type of
the exception thrown doesn't have any impact!

GHC undertakes some effort not to apply an optimisation that would mask a
/precise/ exception with some other source of nontermination, such as genuine
divergence or an imprecise exception, so that the user can reliably
intercept the precise exception with a catch handler before and after
optimisations.

See also the wiki page on precise exceptions:
https://gitlab.haskell.org/ghc/ghc/wikis/exceptions/precise-exceptions
Section 5 of &quot;Tackling the awkward squad&quot; talks about semantic concerns.
Imprecise exceptions are actually more interesting than precise ones (which are
fairly standard) from the perspective of semantics. See the paper &quot;A Semantics
for Imprecise Exceptions&quot; for more details.

Note [Dead ends]
~~~~~~~~~~~~~~~~
We call an expression that either diverges or throws a precise or imprecise
exception a &quot;dead end&quot;. We used to call such an expression just &quot;bottoming&quot;,
but with the measures we take to preserve precise exception semantics
(see Note [Precise exceptions and strictness analysis]), that is no longer
accurate: 'exnDiv' is no longer the bottom of the Divergence lattice.

Yet externally to demand analysis, we mostly care about being able to drop dead
code etc., which is all due to the property that such an expression never
returns, hence we consider throwing a precise exception to be a dead end.
See also 'isDeadEndDiv'.

Note [Precise exceptions and strictness analysis]
~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~
We have to take care to preserve precise exception semantics in strictness
analysis (#17676). There are two scenarios that need careful treatment.

The fixes were discussed at
https://gitlab.haskell.org/ghc/ghc/wikis/fixing-precise-exceptions

Recall that raiseIO# raises a *precise* exception, in contrast to raise# which
raises an *imprecise* exception. See Note [Precise vs imprecise exceptions].

Scenario 1: Precise exceptions in case alternatives
---------------------------------------------------
Unlike raise# (which returns botDiv), we want raiseIO# to return exnDiv.
Here's why. Consider this example from #13380 (similarly #17676):
  f x y | x&gt;0       = raiseIO# Exc
        | y&gt;0       = return 1
        | otherwise = return 2
Is 'f' strict in 'y'? One might be tempted to say yes! But that plays fast and
loose with the precise exception; after optimisation, (f 42 (error &quot;boom&quot;))
turns from throwing the precise Exc to throwing the imprecise user error
&quot;boom&quot;. So, the defaultFvDmd of raiseIO# should be lazy (topDmd), which can be
achieved by giving it divergence exnDiv.
See Note [Default demand on free variables and arguments].

Why don't we just give it topDiv instead of introducing exnDiv?
Because then the simplifier will fail to discard raiseIO#'s continuation in
  case raiseIO# x s of { (# s', r #) -&gt; &lt;BIG&gt; }
which we'd like to optimise to
  case raiseIO# x s of {}
Hence we came up with exnDiv. The default FV demand of exnDiv is lazy (and
its default arg dmd is absent), but otherwise (in terms of 'isDeadEndDiv') it
behaves exactly as botDiv, so that dead code elimination works as expected.
This is tracked by T13380b.

Scenario 2: Precise exceptions in case scrutinees
-------------------------------------------------
Consider (more complete examples in #148, #1592, testcase strun003)

  case foo x s of { (# s', r #) -&gt; y }

Is this strict in 'y'? Often not! If @foo x s@ might throw a precise exception
(ultimately via raiseIO#), then we must not force 'y', which may fail to
terminate or throw an imprecise exception, until we have performed @foo x s@.

So we have to 'deferAfterPreciseException' (which 'lub's with 'exnDmdType' to
model the exceptional control flow) when @foo x s@ may throw a precise
exception. Motivated by T13380{d,e,f}.
See Note [Which scrutinees may throw precise exceptions] in &quot;GHC.Core.Opt.DmdAnal&quot;.

We have to be careful not to discard dead-end Divergence from case
alternatives, though (#18086):

  m = putStrLn &quot;foo&quot; &gt;&gt; error &quot;bar&quot;

'm' should still have 'exnDiv', which is why it is not sufficient to lub with
'nopDmdType' (which has 'topDiv') in 'deferAfterPreciseException'.

Historical Note: This used to be called the &quot;IO hack&quot;. But that term is rather
a bad fit because
1. It's easily confused with the &quot;State hack&quot;, which also affects IO.
2. Neither &quot;IO&quot; nor &quot;hack&quot; is a good description of what goes on here, which
   is deferring strictness results after possibly throwing a precise exception.
   The &quot;hack&quot; is probably not having to defer when we can prove that the
   expression may not throw a precise exception (increasing precision of the
   analysis), but that's just a favourable guess.

Note [Exceptions and strictness]
~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~
We used to smart about catching exceptions, but we aren't anymore.
See #14998 for the way it's resolved at the moment.

Here's a historic breakdown:

Apparently, exception handling prim-ops didn't use to have any special
strictness signatures, thus defaulting to nopSig, which assumes they use their
arguments lazily. Joachim was the first to realise that we could provide richer
information. Thus, in 0558911f91c (Dec 13), he added signatures to
primops.txt.pp indicating that functions like `catch#` and `catchRetry#` call
their argument, which is useful information for usage analysis. Still with a
'Lazy' strictness demand (i.e. 'lazyApply1Dmd'), though, and the world was fine.

In 7c0fff4 (July 15), Simon argued that giving `catch#` et al. a
'strictApply1Dmd' leads to substantial performance gains. That was at the cost
of correctness, as #10712 proved. So, back to 'lazyApply1Dmd' in
28638dfe79e (Dec 15).

Motivated to reproduce the gains of 7c0fff4 without the breakage of #10712,
Ben opened #11222. Simon made the demand analyser &quot;understand catch&quot; in
9915b656 (Jan 16) by adding a new 'catchArgDmd', which basically said to call
its argument strictly, but also swallow any thrown exceptions in
'multDivergence'. This was realized by extending the 'Str' constructor of
'ArgStr' with a 'ExnStr' field, indicating that it catches the exception, and
adding a 'ThrowsExn' constructor to the 'Divergence' lattice as an element
between 'Dunno' and 'Diverges'. Then along came #11555 and finally #13330,
so we had to revert to 'lazyApply1Dmd' again in 701256df88c (Mar 17).

This left the other variants like 'catchRetry#' having 'catchArgDmd', which is
where #14998 picked up. Item 1 was concerned with measuring the impact of also
making `catchRetry#` and `catchSTM#` have 'lazyApply1Dmd'. The result was that
there was none. We removed the last usages of 'catchArgDmd' in 00b8ecb7
(Apr 18). There was a lot of dead code resulting from that change, that we
removed in ef6b283 (Jan 19): We got rid of 'ThrowsExn' and 'ExnStr' again and
removed any code that was dealing with the peculiarities.

Where did the speed-ups vanish to? In #14998, item 3 established that
turning 'catch#' strict in its first argument didn't bring back any of the
alleged performance benefits. Item 2 of that ticket finally found out that it
was entirely due to 'catchException's new (since #11555) definition, which
was simply

    catchException !io handler = catch io handler

While 'catchException' is arguably the saner semantics for 'catch', it is an
internal helper function in &quot;GHC.IO&quot;. Its use in
&quot;GHC.IO.Handle.Internals.do_operation&quot; made for the huge allocation differences:
Remove the bang and you find the regressions we originally wanted to avoid with
'catchArgDmd'. See also #exceptions_and_strictness# in &quot;GHC.IO&quot;.

So history keeps telling us that the only possibly correct strictness annotation
for the first argument of 'catch#' is 'lazyApply1Dmd', because 'catch#' really
is not strict in its argument: Just try this in GHCi

  :set -XScopedTypeVariables
  import Control.Exception
  catch undefined (\(_ :: SomeException) -&gt; putStrLn &quot;you'll see this&quot;)

Any analysis that assumes otherwise will be broken in some way or another
(beyond `-fno-pendantic-bottoms`).

But then #13380 and #17676 suggest (in Mar 20) that we need to re-introduce a
subtly different variant of `ThrowsExn` (which we call `ExnOrDiv` now) that is
only used by `raiseIO#` in order to preserve precise exceptions by strictness
analysis, while not impacting the ability to eliminate dead code.
See Note [Precise exceptions and strictness analysis].

Note [Default demand on free variables and arguments]
~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~
Free variables not mentioned in the environment of a 'DmdType'
are demanded according to the demand type's Divergence:
  * In a Diverges (botDiv) context, that demand is botDmd
    (strict and absent).
  * In all other contexts, the demand is absDmd (lazy and absent).
This is recorded in 'defaultFvDmd'.

Similarly, we can eta-expand demand types to get demands on excess arguments
not accounted for in the type, by consulting 'defaultArgDmd':
  * In a Diverges (botDiv) context, that demand is again botDmd.
  * In a ExnOrDiv (exnDiv) context, that demand is absDmd: We surely diverge
    before evaluating the excess argument, but don't want to eagerly evaluate
    it (cf. Note [Precise exceptions and strictness analysis]).
  * In a Dunno context (topDiv), the demand is topDmd, because
    it's perfectly possible to enter the additional lambda and evaluate it
    in unforeseen ways (so, not absent).

Note [Bottom CPR iff Dead-Ending Divergence]
~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~
Both CPR analysis and Demand analysis handle recursive functions by doing
fixed-point iteration. To find the *least* (e.g., most informative) fixed-point,
iteration starts with the bottom element of the semantic domain. Diverging
functions generally have the bottom element as their least fixed-point.

One might think that CPR analysis and Demand analysis then agree in when a
function gets a bottom denotation. E.g., whenever it has 'botCpr', it should
also have 'botDiv'. But that is not the case, because strictness analysis has to
be careful around precise exceptions, see Note [Precise vs imprecise exceptions].

So Demand analysis gives some diverging functions 'exnDiv' (which is *not* the
bottom element) when the CPR signature says 'botCpr', and that's OK. Here's an
example (from #18086) where that is the case:

ioTest :: IO ()
ioTest = do
  putStrLn &quot;hi&quot;
  undefined

However, one can loosely say that we give a function 'botCpr' whenever its
'Divergence' is 'exnDiv' or 'botDiv', i.e., dead-ending. But that's just
a consequence of fixed-point iteration, it's not important that they agree.

************************************************************************
*                                                                      *
           Demand environments and types
*                                                                      *
************************************************************************
-}</span><span>
</span><span id="line-1083"></span><span>
</span><span id="line-1084"></span><span class="hs-comment">-- Subject to Note [Default demand on free variables and arguments]</span><span>
</span><span id="line-1085"></span><span class="hs-keyword">type</span><span> </span><span id="DmdEnv"><span class="annot"><a href="GHC.Types.Demand.html#DmdEnv"><span class="hs-identifier hs-var">DmdEnv</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><a href="GHC.Types.Var.Env.html#VarEnv"><span class="hs-identifier hs-type">VarEnv</span></a></span><span> </span><span class="annot"><a href="GHC.Types.Demand.html#Demand"><span class="hs-identifier hs-type">Demand</span></a></span><span>
</span><span id="line-1086"></span><span>
</span><span id="line-1087"></span><span class="annot"><a href="GHC.Types.Demand.html#emptyDmdEnv"><span class="hs-identifier hs-type">emptyDmdEnv</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><a href="GHC.Types.Demand.html#DmdEnv"><span class="hs-identifier hs-type">DmdEnv</span></a></span><span>
</span><span id="line-1088"></span><span id="emptyDmdEnv"><span class="annot"><span class="annottext">emptyDmdEnv :: DmdEnv
</span><a href="GHC.Types.Demand.html#emptyDmdEnv"><span class="hs-identifier hs-var hs-var">emptyDmdEnv</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">forall a. VarEnv a
</span><a href="GHC.Types.Var.Env.html#emptyVarEnv"><span class="hs-identifier hs-var">emptyVarEnv</span></a></span><span>
</span><span id="line-1089"></span><span>
</span><span id="line-1090"></span><span class="annot"><a href="GHC.Types.Demand.html#multDmdEnv"><span class="hs-identifier hs-type">multDmdEnv</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><a href="GHC.Types.Demand.html#Card"><span class="hs-identifier hs-type">Card</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="GHC.Types.Demand.html#DmdEnv"><span class="hs-identifier hs-type">DmdEnv</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="GHC.Types.Demand.html#DmdEnv"><span class="hs-identifier hs-type">DmdEnv</span></a></span><span>
</span><span id="line-1091"></span><span id="multDmdEnv"><span class="annot"><span class="annottext">multDmdEnv :: Card -&gt; DmdEnv -&gt; DmdEnv
</span><a href="GHC.Types.Demand.html#multDmdEnv"><span class="hs-identifier hs-var hs-var">multDmdEnv</span></a></span></span><span> </span><span id="local-6989586621680990740"><span class="annot"><span class="annottext">Card
</span><a href="#local-6989586621680990740"><span class="hs-identifier hs-var">n</span></a></span></span><span> </span><span id="local-6989586621680990739"><span class="annot"><span class="annottext">DmdEnv
</span><a href="#local-6989586621680990739"><span class="hs-identifier hs-var">env</span></a></span></span><span>
</span><span id="line-1092"></span><span>  </span><span class="hs-glyph">|</span><span> </span><span class="annot"><a href="../../base-4.16.4.0/src/GHC-Maybe.html#Just"><span class="hs-identifier hs-type">Just</span></a></span><span> </span><span id="local-6989586621680990738"><span class="annot"><span class="annottext">DmdEnv
</span><a href="#local-6989586621680990738"><span class="hs-identifier hs-var">env'</span></a></span></span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">forall a. Card -&gt; a -&gt; a -&gt; Maybe a
</span><a href="GHC.Types.Demand.html#multTrivial"><span class="hs-identifier hs-var">multTrivial</span></a></span><span> </span><span class="annot"><span class="annottext">Card
</span><a href="#local-6989586621680990740"><span class="hs-identifier hs-var">n</span></a></span><span> </span><span class="annot"><span class="annottext">DmdEnv
</span><a href="GHC.Types.Demand.html#emptyDmdEnv"><span class="hs-identifier hs-var">emptyDmdEnv</span></a></span><span> </span><span class="annot"><span class="annottext">DmdEnv
</span><a href="#local-6989586621680990739"><span class="hs-identifier hs-var">env</span></a></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">DmdEnv
</span><a href="#local-6989586621680990738"><span class="hs-identifier hs-var">env'</span></a></span><span>
</span><span id="line-1093"></span><span>  </span><span class="hs-glyph">|</span><span> </span><span class="annot"><span class="annottext">Bool
</span><a href="../../base-4.16.4.0/src/GHC-Base.html#otherwise"><span class="hs-identifier hs-var">otherwise</span></a></span><span>                                  </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">forall a b. (a -&gt; b) -&gt; VarEnv a -&gt; VarEnv b
</span><a href="GHC.Types.Var.Env.html#mapVarEnv"><span class="hs-identifier hs-var">mapVarEnv</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Card -&gt; Demand -&gt; Demand
</span><a href="GHC.Types.Demand.html#multDmd"><span class="hs-identifier hs-var">multDmd</span></a></span><span> </span><span class="annot"><span class="annottext">Card
</span><a href="#local-6989586621680990740"><span class="hs-identifier hs-var">n</span></a></span><span class="hs-special">)</span><span> </span><span class="annot"><span class="annottext">DmdEnv
</span><a href="#local-6989586621680990739"><span class="hs-identifier hs-var">env</span></a></span><span>
</span><span id="line-1094"></span><span>
</span><span id="line-1095"></span><span class="annot"><a href="GHC.Types.Demand.html#reuseEnv"><span class="hs-identifier hs-type">reuseEnv</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><a href="GHC.Types.Demand.html#DmdEnv"><span class="hs-identifier hs-type">DmdEnv</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="GHC.Types.Demand.html#DmdEnv"><span class="hs-identifier hs-type">DmdEnv</span></a></span><span>
</span><span id="line-1096"></span><span id="reuseEnv"><span class="annot"><span class="annottext">reuseEnv :: DmdEnv -&gt; DmdEnv
</span><a href="GHC.Types.Demand.html#reuseEnv"><span class="hs-identifier hs-var hs-var">reuseEnv</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">Card -&gt; DmdEnv -&gt; DmdEnv
</span><a href="GHC.Types.Demand.html#multDmdEnv"><span class="hs-identifier hs-var">multDmdEnv</span></a></span><span> </span><span class="annot"><span class="annottext">Card
</span><a href="GHC.Types.Demand.html#C_1N"><span class="hs-identifier hs-var">C_1N</span></a></span><span>
</span><span id="line-1097"></span><span>
</span><span id="line-1098"></span><span class="hs-comment">-- | @keepAliveDmdType dt vs@ makes sure that the Ids in @vs@ have</span><span>
</span><span id="line-1099"></span><span class="hs-comment">-- /some/ usage in the returned demand types -- they are not Absent.</span><span>
</span><span id="line-1100"></span><span class="hs-comment">-- See Note [Absence analysis for stable unfoldings and RULES]</span><span>
</span><span id="line-1101"></span><span class="hs-comment">--     in &quot;GHC.Core.Opt.DmdAnal&quot;.</span><span>
</span><span id="line-1102"></span><span class="annot"><a href="GHC.Types.Demand.html#keepAliveDmdEnv"><span class="hs-identifier hs-type">keepAliveDmdEnv</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><a href="GHC.Types.Demand.html#DmdEnv"><span class="hs-identifier hs-type">DmdEnv</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="GHC.Types.Var.Set.html#IdSet"><span class="hs-identifier hs-type">IdSet</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="GHC.Types.Demand.html#DmdEnv"><span class="hs-identifier hs-type">DmdEnv</span></a></span><span>
</span><span id="line-1103"></span><span id="keepAliveDmdEnv"><span class="annot"><span class="annottext">keepAliveDmdEnv :: DmdEnv -&gt; IdSet -&gt; DmdEnv
</span><a href="GHC.Types.Demand.html#keepAliveDmdEnv"><span class="hs-identifier hs-var hs-var">keepAliveDmdEnv</span></a></span></span><span> </span><span id="local-6989586621680990736"><span class="annot"><span class="annottext">DmdEnv
</span><a href="#local-6989586621680990736"><span class="hs-identifier hs-var">env</span></a></span></span><span> </span><span id="local-6989586621680990735"><span class="annot"><span class="annottext">IdSet
</span><a href="#local-6989586621680990735"><span class="hs-identifier hs-var">vs</span></a></span></span><span>
</span><span id="line-1104"></span><span>  </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">forall a. (Var -&gt; a -&gt; a) -&gt; a -&gt; IdSet -&gt; a
</span><a href="GHC.Types.Var.Set.html#nonDetStrictFoldVarSet"><span class="hs-identifier hs-var">nonDetStrictFoldVarSet</span></a></span><span> </span><span class="annot"><span class="annottext">Var -&gt; DmdEnv -&gt; DmdEnv
</span><a href="#local-6989586621680990733"><span class="hs-identifier hs-var">add</span></a></span><span> </span><span class="annot"><span class="annottext">DmdEnv
</span><a href="#local-6989586621680990736"><span class="hs-identifier hs-var">env</span></a></span><span> </span><span class="annot"><span class="annottext">IdSet
</span><a href="#local-6989586621680990735"><span class="hs-identifier hs-var">vs</span></a></span><span>
</span><span id="line-1105"></span><span>  </span><span class="hs-keyword">where</span><span>
</span><span id="line-1106"></span><span>    </span><span class="annot"><a href="#local-6989586621680990733"><span class="hs-identifier hs-type">add</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><a href="GHC.Types.Var.html#Id"><span class="hs-identifier hs-type">Id</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="GHC.Types.Demand.html#DmdEnv"><span class="hs-identifier hs-type">DmdEnv</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="GHC.Types.Demand.html#DmdEnv"><span class="hs-identifier hs-type">DmdEnv</span></a></span><span>
</span><span id="line-1107"></span><span>    </span><span id="local-6989586621680990733"><span class="annot"><span class="annottext">add :: Var -&gt; DmdEnv -&gt; DmdEnv
</span><a href="#local-6989586621680990733"><span class="hs-identifier hs-var hs-var">add</span></a></span></span><span> </span><span id="local-6989586621680990732"><span class="annot"><span class="annottext">Var
</span><a href="#local-6989586621680990732"><span class="hs-identifier hs-var">v</span></a></span></span><span> </span><span id="local-6989586621680990731"><span class="annot"><span class="annottext">DmdEnv
</span><a href="#local-6989586621680990731"><span class="hs-identifier hs-var">env</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">forall a. (a -&gt; a -&gt; a) -&gt; VarEnv a -&gt; Var -&gt; a -&gt; VarEnv a
</span><a href="GHC.Types.Var.Env.html#extendVarEnv_C"><span class="hs-identifier hs-var">extendVarEnv_C</span></a></span><span> </span><span class="annot"><span class="annottext">Demand -&gt; Demand -&gt; Demand
</span><a href="#local-6989586621680990729"><span class="hs-identifier hs-var">add_dmd</span></a></span><span> </span><span class="annot"><span class="annottext">DmdEnv
</span><a href="#local-6989586621680990731"><span class="hs-identifier hs-var">env</span></a></span><span> </span><span class="annot"><span class="annottext">Var
</span><a href="#local-6989586621680990732"><span class="hs-identifier hs-var">v</span></a></span><span> </span><span class="annot"><span class="annottext">Demand
</span><a href="GHC.Types.Demand.html#topDmd"><span class="hs-identifier hs-var">topDmd</span></a></span><span>
</span><span id="line-1108"></span><span>
</span><span id="line-1109"></span><span>    </span><span class="annot"><a href="#local-6989586621680990729"><span class="hs-identifier hs-type">add_dmd</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><a href="GHC.Types.Demand.html#Demand"><span class="hs-identifier hs-type">Demand</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="GHC.Types.Demand.html#Demand"><span class="hs-identifier hs-type">Demand</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="GHC.Types.Demand.html#Demand"><span class="hs-identifier hs-type">Demand</span></a></span><span>
</span><span id="line-1110"></span><span>    </span><span class="hs-comment">-- If the existing usage is Absent, make it used</span><span>
</span><span id="line-1111"></span><span>    </span><span class="hs-comment">-- Otherwise leave it alone</span><span>
</span><span id="line-1112"></span><span>    </span><span id="local-6989586621680990729"><span class="annot"><span class="annottext">add_dmd :: Demand -&gt; Demand -&gt; Demand
</span><a href="#local-6989586621680990729"><span class="hs-identifier hs-var hs-var">add_dmd</span></a></span></span><span> </span><span id="local-6989586621680990728"><span class="annot"><span class="annottext">Demand
</span><a href="#local-6989586621680990728"><span class="hs-identifier hs-var">dmd</span></a></span></span><span> </span><span class="annot"><span class="annottext">Demand
</span><span class="hs-identifier">_</span></span><span> </span><span class="hs-glyph">|</span><span> </span><span class="annot"><span class="annottext">Demand -&gt; Bool
</span><a href="GHC.Types.Demand.html#isAbsDmd"><span class="hs-identifier hs-var">isAbsDmd</span></a></span><span> </span><span class="annot"><span class="annottext">Demand
</span><a href="#local-6989586621680990728"><span class="hs-identifier hs-var">dmd</span></a></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">Demand
</span><a href="GHC.Types.Demand.html#topDmd"><span class="hs-identifier hs-var">topDmd</span></a></span><span>
</span><span id="line-1113"></span><span>                  </span><span class="hs-glyph">|</span><span> </span><span class="annot"><span class="annottext">Bool
</span><a href="../../base-4.16.4.0/src/GHC-Base.html#otherwise"><span class="hs-identifier hs-var">otherwise</span></a></span><span>    </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">Demand
</span><a href="#local-6989586621680990728"><span class="hs-identifier hs-var">dmd</span></a></span><span>
</span><span id="line-1114"></span><span>
</span><span id="line-1115"></span><span class="hs-comment">-- | Characterises how an expression</span><span>
</span><span id="line-1116"></span><span class="hs-comment">--    * Evaluates its free variables ('dt_env')</span><span>
</span><span id="line-1117"></span><span class="hs-comment">--    * Evaluates its arguments ('dt_args')</span><span>
</span><span id="line-1118"></span><span class="hs-comment">--    * Diverges on every code path or not ('dt_div')</span><span>
</span><span id="line-1119"></span><span class="hs-keyword">data</span><span> </span><span id="DmdType"><span class="annot"><a href="GHC.Types.Demand.html#DmdType"><span class="hs-identifier hs-var">DmdType</span></a></span></span><span>
</span><span id="line-1120"></span><span>  </span><span class="hs-glyph">=</span><span> </span><span id="DmdType"><span class="annot"><a href="GHC.Types.Demand.html#DmdType"><span class="hs-identifier hs-var">DmdType</span></a></span></span><span>
</span><span id="line-1121"></span><span>  </span><span class="hs-special">{</span><span> </span><span id="dt_env"><span class="annot"><span class="annottext">DmdType -&gt; DmdEnv
</span><a href="GHC.Types.Demand.html#dt_env"><span class="hs-identifier hs-var hs-var">dt_env</span></a></span></span><span>  </span><span class="hs-glyph">::</span><span> </span><span class="hs-glyph">!</span><span class="annot"><a href="GHC.Types.Demand.html#DmdEnv"><span class="hs-identifier hs-type">DmdEnv</span></a></span><span>     </span><span class="hs-comment">-- ^ Demand on explicitly-mentioned free variables</span><span>
</span><span id="line-1122"></span><span>  </span><span class="hs-special">,</span><span> </span><span id="dt_args"><span class="annot"><span class="annottext">DmdType -&gt; [Demand]
</span><a href="GHC.Types.Demand.html#dt_args"><span class="hs-identifier hs-var hs-var">dt_args</span></a></span></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="hs-glyph">!</span><span class="hs-special">[</span><span class="annot"><a href="GHC.Types.Demand.html#Demand"><span class="hs-identifier hs-type">Demand</span></a></span><span class="hs-special">]</span><span>   </span><span class="hs-comment">-- ^ Demand on arguments</span><span>
</span><span id="line-1123"></span><span>  </span><span class="hs-special">,</span><span> </span><span id="dt_div"><span class="annot"><span class="annottext">DmdType -&gt; Divergence
</span><a href="GHC.Types.Demand.html#dt_div"><span class="hs-identifier hs-var hs-var">dt_div</span></a></span></span><span>  </span><span class="hs-glyph">::</span><span> </span><span class="hs-glyph">!</span><span class="annot"><a href="GHC.Types.Demand.html#Divergence"><span class="hs-identifier hs-type">Divergence</span></a></span><span> </span><span class="hs-comment">-- ^ Whether evaluation diverges.</span><span>
</span><span id="line-1124"></span><span>                          </span><span class="hs-comment">-- See Note [Demand type Divergence]</span><span>
</span><span id="line-1125"></span><span>  </span><span class="hs-special">}</span><span>
</span><span id="line-1126"></span><span>
</span><span id="line-1127"></span><span class="hs-keyword">instance</span><span> </span><span id="local-6989586621680990722"><span class="annot"><span class="hs-identifier hs-type">Eq</span></span><span> </span><span class="annot"><a href="GHC.Types.Demand.html#DmdType"><span class="hs-identifier hs-type">DmdType</span></a></span></span><span> </span><span class="hs-keyword">where</span><span>
</span><span id="line-1128"></span><span>  </span><span id="local-6989586621680990714"><span class="annot"><span class="annottext">== :: DmdType -&gt; DmdType -&gt; Bool
</span><span class="hs-operator hs-var hs-var hs-var hs-var">(==)</span></span></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="GHC.Types.Demand.html#DmdType"><span class="hs-identifier hs-type">DmdType</span></a></span><span> </span><span id="local-6989586621680990713"><span class="annot"><span class="annottext">DmdEnv
</span><a href="#local-6989586621680990713"><span class="hs-identifier hs-var">fv1</span></a></span></span><span> </span><span id="local-6989586621680990712"><span class="annot"><span class="annottext">[Demand]
</span><a href="#local-6989586621680990712"><span class="hs-identifier hs-var">ds1</span></a></span></span><span> </span><span id="local-6989586621680990711"><span class="annot"><span class="annottext">Divergence
</span><a href="#local-6989586621680990711"><span class="hs-identifier hs-var">div1</span></a></span></span><span class="hs-special">)</span><span>
</span><span id="line-1129"></span><span>       </span><span class="hs-special">(</span><span class="annot"><a href="GHC.Types.Demand.html#DmdType"><span class="hs-identifier hs-type">DmdType</span></a></span><span> </span><span id="local-6989586621680990710"><span class="annot"><span class="annottext">DmdEnv
</span><a href="#local-6989586621680990710"><span class="hs-identifier hs-var">fv2</span></a></span></span><span> </span><span id="local-6989586621680990709"><span class="annot"><span class="annottext">[Demand]
</span><a href="#local-6989586621680990709"><span class="hs-identifier hs-var">ds2</span></a></span></span><span> </span><span id="local-6989586621680990708"><span class="annot"><span class="annottext">Divergence
</span><a href="#local-6989586621680990708"><span class="hs-identifier hs-var">div2</span></a></span></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">forall key elt. UniqFM key elt -&gt; [(Unique, elt)]
</span><a href="GHC.Types.Unique.FM.html#nonDetUFMToList"><span class="hs-identifier hs-var">nonDetUFMToList</span></a></span><span> </span><span class="annot"><span class="annottext">DmdEnv
</span><a href="#local-6989586621680990713"><span class="hs-identifier hs-var">fv1</span></a></span><span> </span><span class="annot"><span class="annottext">forall a. Eq a =&gt; a -&gt; a -&gt; Bool
</span><span class="hs-operator hs-var">==</span></span><span> </span><span class="annot"><span class="annottext">forall key elt. UniqFM key elt -&gt; [(Unique, elt)]
</span><a href="GHC.Types.Unique.FM.html#nonDetUFMToList"><span class="hs-identifier hs-var">nonDetUFMToList</span></a></span><span> </span><span class="annot"><span class="annottext">DmdEnv
</span><a href="#local-6989586621680990710"><span class="hs-identifier hs-var">fv2</span></a></span><span>
</span><span id="line-1130"></span><span>         </span><span class="hs-comment">-- It's OK to use nonDetUFMToList here because we're testing for</span><span>
</span><span id="line-1131"></span><span>         </span><span class="hs-comment">-- equality and even though the lists will be in some arbitrary</span><span>
</span><span id="line-1132"></span><span>         </span><span class="hs-comment">-- Unique order, it is the same order for both</span><span>
</span><span id="line-1133"></span><span>                              </span><span class="annot"><span class="annottext">Bool -&gt; Bool -&gt; Bool
</span><span class="hs-operator hs-var">&amp;&amp;</span></span><span> </span><span class="annot"><span class="annottext">[Demand]
</span><a href="#local-6989586621680990712"><span class="hs-identifier hs-var">ds1</span></a></span><span> </span><span class="annot"><span class="annottext">forall a. Eq a =&gt; a -&gt; a -&gt; Bool
</span><span class="hs-operator hs-var">==</span></span><span> </span><span class="annot"><span class="annottext">[Demand]
</span><a href="#local-6989586621680990709"><span class="hs-identifier hs-var">ds2</span></a></span><span> </span><span class="annot"><span class="annottext">Bool -&gt; Bool -&gt; Bool
</span><span class="hs-operator hs-var">&amp;&amp;</span></span><span> </span><span class="annot"><span class="annottext">Divergence
</span><a href="#local-6989586621680990711"><span class="hs-identifier hs-var">div1</span></a></span><span> </span><span class="annot"><span class="annottext">forall a. Eq a =&gt; a -&gt; a -&gt; Bool
</span><span class="hs-operator hs-var">==</span></span><span> </span><span class="annot"><span class="annottext">Divergence
</span><a href="#local-6989586621680990708"><span class="hs-identifier hs-var">div2</span></a></span><span>
</span><span id="line-1134"></span><span>
</span><span id="line-1135"></span><span class="hs-comment">-- | Compute the least upper bound of two 'DmdType's elicited /by the same</span><span>
</span><span id="line-1136"></span><span class="hs-comment">-- incoming demand/!</span><span>
</span><span id="line-1137"></span><span class="annot"><a href="GHC.Types.Demand.html#lubDmdType"><span class="hs-identifier hs-type">lubDmdType</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><a href="GHC.Types.Demand.html#DmdType"><span class="hs-identifier hs-type">DmdType</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="GHC.Types.Demand.html#DmdType"><span class="hs-identifier hs-type">DmdType</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="GHC.Types.Demand.html#DmdType"><span class="hs-identifier hs-type">DmdType</span></a></span><span>
</span><span id="line-1138"></span><span id="lubDmdType"><span class="annot"><span class="annottext">lubDmdType :: DmdType -&gt; DmdType -&gt; DmdType
</span><a href="GHC.Types.Demand.html#lubDmdType"><span class="hs-identifier hs-var hs-var">lubDmdType</span></a></span></span><span> </span><span id="local-6989586621680990706"><span class="annot"><span class="annottext">DmdType
</span><a href="#local-6989586621680990706"><span class="hs-identifier hs-var">d1</span></a></span></span><span> </span><span id="local-6989586621680990705"><span class="annot"><span class="annottext">DmdType
</span><a href="#local-6989586621680990705"><span class="hs-identifier hs-var">d2</span></a></span></span><span>
</span><span id="line-1139"></span><span>  </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">DmdEnv -&gt; [Demand] -&gt; Divergence -&gt; DmdType
</span><a href="GHC.Types.Demand.html#DmdType"><span class="hs-identifier hs-var">DmdType</span></a></span><span> </span><span class="annot"><span class="annottext">DmdEnv
</span><a href="#local-6989586621680990704"><span class="hs-identifier hs-var">lub_fv</span></a></span><span> </span><span class="annot"><span class="annottext">[Demand]
</span><a href="#local-6989586621680990703"><span class="hs-identifier hs-var">lub_ds</span></a></span><span> </span><span class="annot"><span class="annottext">Divergence
</span><a href="#local-6989586621680990702"><span class="hs-identifier hs-var">lub_div</span></a></span><span>
</span><span id="line-1140"></span><span>  </span><span class="hs-keyword">where</span><span>
</span><span id="line-1141"></span><span>    </span><span id="local-6989586621680990701"><span class="annot"><span class="annottext">n :: Int
</span><a href="#local-6989586621680990701"><span class="hs-identifier hs-var hs-var">n</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">forall a. Ord a =&gt; a -&gt; a -&gt; a
</span><span class="hs-identifier hs-var">max</span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">DmdType -&gt; Int
</span><a href="GHC.Types.Demand.html#dmdTypeDepth"><span class="hs-identifier hs-var">dmdTypeDepth</span></a></span><span> </span><span class="annot"><span class="annottext">DmdType
</span><a href="#local-6989586621680990706"><span class="hs-identifier hs-var">d1</span></a></span><span class="hs-special">)</span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">DmdType -&gt; Int
</span><a href="GHC.Types.Demand.html#dmdTypeDepth"><span class="hs-identifier hs-var">dmdTypeDepth</span></a></span><span> </span><span class="annot"><span class="annottext">DmdType
</span><a href="#local-6989586621680990705"><span class="hs-identifier hs-var">d2</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-1142"></span><span>    </span><span class="hs-special">(</span><span class="annot"><a href="GHC.Types.Demand.html#DmdType"><span class="hs-identifier hs-type">DmdType</span></a></span><span> </span><span id="local-6989586621680990699"><span class="annot"><span class="annottext">DmdEnv
</span><a href="#local-6989586621680990699"><span class="hs-identifier hs-var">fv1</span></a></span></span><span> </span><span id="local-6989586621680990698"><span class="annot"><span class="annottext">[Demand]
</span><a href="#local-6989586621680990698"><span class="hs-identifier hs-var">ds1</span></a></span></span><span> </span><span id="local-6989586621680990697"><span class="annot"><span class="annottext">Divergence
</span><a href="#local-6989586621680990697"><span class="hs-identifier hs-var">r1</span></a></span></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">Int -&gt; DmdType -&gt; DmdType
</span><a href="GHC.Types.Demand.html#etaExpandDmdType"><span class="hs-identifier hs-var">etaExpandDmdType</span></a></span><span> </span><span class="annot"><span class="annottext">Int
</span><a href="#local-6989586621680990701"><span class="hs-identifier hs-var">n</span></a></span><span> </span><span class="annot"><span class="annottext">DmdType
</span><a href="#local-6989586621680990706"><span class="hs-identifier hs-var">d1</span></a></span><span>
</span><span id="line-1143"></span><span>    </span><span class="hs-special">(</span><span class="annot"><a href="GHC.Types.Demand.html#DmdType"><span class="hs-identifier hs-type">DmdType</span></a></span><span> </span><span id="local-6989586621680990695"><span class="annot"><span class="annottext">DmdEnv
</span><a href="#local-6989586621680990695"><span class="hs-identifier hs-var">fv2</span></a></span></span><span> </span><span id="local-6989586621680990694"><span class="annot"><span class="annottext">[Demand]
</span><a href="#local-6989586621680990694"><span class="hs-identifier hs-var">ds2</span></a></span></span><span> </span><span id="local-6989586621680990693"><span class="annot"><span class="annottext">Divergence
</span><a href="#local-6989586621680990693"><span class="hs-identifier hs-var">r2</span></a></span></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">Int -&gt; DmdType -&gt; DmdType
</span><a href="GHC.Types.Demand.html#etaExpandDmdType"><span class="hs-identifier hs-var">etaExpandDmdType</span></a></span><span> </span><span class="annot"><span class="annottext">Int
</span><a href="#local-6989586621680990701"><span class="hs-identifier hs-var">n</span></a></span><span> </span><span class="annot"><span class="annottext">DmdType
</span><a href="#local-6989586621680990705"><span class="hs-identifier hs-var">d2</span></a></span><span>
</span><span id="line-1144"></span><span>
</span><span id="line-1145"></span><span>    </span><span id="local-6989586621680990704"><span class="annot"><span class="annottext">lub_fv :: DmdEnv
</span><a href="#local-6989586621680990704"><span class="hs-identifier hs-var hs-var">lub_fv</span></a></span></span><span>  </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">forall a.
(a -&gt; a -&gt; a) -&gt; VarEnv a -&gt; a -&gt; VarEnv a -&gt; a -&gt; VarEnv a
</span><a href="GHC.Types.Var.Env.html#plusVarEnv_CD"><span class="hs-identifier hs-var">plusVarEnv_CD</span></a></span><span> </span><span class="annot"><span class="annottext">Demand -&gt; Demand -&gt; Demand
</span><a href="GHC.Types.Demand.html#lubDmd"><span class="hs-identifier hs-var">lubDmd</span></a></span><span> </span><span class="annot"><span class="annottext">DmdEnv
</span><a href="#local-6989586621680990699"><span class="hs-identifier hs-var">fv1</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Divergence -&gt; Demand
</span><a href="GHC.Types.Demand.html#defaultFvDmd"><span class="hs-identifier hs-var">defaultFvDmd</span></a></span><span> </span><span class="annot"><span class="annottext">Divergence
</span><a href="#local-6989586621680990697"><span class="hs-identifier hs-var">r1</span></a></span><span class="hs-special">)</span><span> </span><span class="annot"><span class="annottext">DmdEnv
</span><a href="#local-6989586621680990695"><span class="hs-identifier hs-var">fv2</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Divergence -&gt; Demand
</span><a href="GHC.Types.Demand.html#defaultFvDmd"><span class="hs-identifier hs-var">defaultFvDmd</span></a></span><span> </span><span class="annot"><span class="annottext">Divergence
</span><a href="#local-6989586621680990693"><span class="hs-identifier hs-var">r2</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-1146"></span><span>    </span><span id="local-6989586621680990703"><span class="annot"><span class="annottext">lub_ds :: [Demand]
</span><a href="#local-6989586621680990703"><span class="hs-identifier hs-var hs-var">lub_ds</span></a></span></span><span>  </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">forall a b c. String -&gt; (a -&gt; b -&gt; c) -&gt; [a] -&gt; [b] -&gt; [c]
</span><a href="GHC.Utils.Misc.html#zipWithEqual"><span class="hs-identifier hs-var">zipWithEqual</span></a></span><span> </span><span class="annot"><span class="annottext">String
</span><span class="hs-string">&quot;lubDmdType&quot;</span></span><span> </span><span class="annot"><span class="annottext">Demand -&gt; Demand -&gt; Demand
</span><a href="GHC.Types.Demand.html#lubDmd"><span class="hs-identifier hs-var">lubDmd</span></a></span><span> </span><span class="annot"><span class="annottext">[Demand]
</span><a href="#local-6989586621680990698"><span class="hs-identifier hs-var">ds1</span></a></span><span> </span><span class="annot"><span class="annottext">[Demand]
</span><a href="#local-6989586621680990694"><span class="hs-identifier hs-var">ds2</span></a></span><span>
</span><span id="line-1147"></span><span>    </span><span id="local-6989586621680990702"><span class="annot"><span class="annottext">lub_div :: Divergence
</span><a href="#local-6989586621680990702"><span class="hs-identifier hs-var hs-var">lub_div</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">Divergence -&gt; Divergence -&gt; Divergence
</span><a href="GHC.Types.Demand.html#lubDivergence"><span class="hs-identifier hs-var">lubDivergence</span></a></span><span> </span><span class="annot"><span class="annottext">Divergence
</span><a href="#local-6989586621680990697"><span class="hs-identifier hs-var">r1</span></a></span><span> </span><span class="annot"><span class="annottext">Divergence
</span><a href="#local-6989586621680990693"><span class="hs-identifier hs-var">r2</span></a></span><span>
</span><span id="line-1148"></span><span>
</span><span id="line-1149"></span><span class="hs-keyword">type</span><span> </span><span id="PlusDmdArg"><span class="annot"><a href="GHC.Types.Demand.html#PlusDmdArg"><span class="hs-identifier hs-var">PlusDmdArg</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-special">(</span><span class="annot"><a href="GHC.Types.Demand.html#DmdEnv"><span class="hs-identifier hs-type">DmdEnv</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><a href="GHC.Types.Demand.html#Divergence"><span class="hs-identifier hs-type">Divergence</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-1150"></span><span>
</span><span id="line-1151"></span><span class="annot"><a href="GHC.Types.Demand.html#mkPlusDmdArg"><span class="hs-identifier hs-type">mkPlusDmdArg</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><a href="GHC.Types.Demand.html#DmdEnv"><span class="hs-identifier hs-type">DmdEnv</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="GHC.Types.Demand.html#PlusDmdArg"><span class="hs-identifier hs-type">PlusDmdArg</span></a></span><span>
</span><span id="line-1152"></span><span id="mkPlusDmdArg"><span class="annot"><span class="annottext">mkPlusDmdArg :: DmdEnv -&gt; PlusDmdArg
</span><a href="GHC.Types.Demand.html#mkPlusDmdArg"><span class="hs-identifier hs-var hs-var">mkPlusDmdArg</span></a></span></span><span> </span><span id="local-6989586621680990690"><span class="annot"><span class="annottext">DmdEnv
</span><a href="#local-6989586621680990690"><span class="hs-identifier hs-var">env</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">DmdEnv
</span><a href="#local-6989586621680990690"><span class="hs-identifier hs-var">env</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">Divergence
</span><a href="GHC.Types.Demand.html#topDiv"><span class="hs-identifier hs-var">topDiv</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-1153"></span><span>
</span><span id="line-1154"></span><span class="annot"><a href="GHC.Types.Demand.html#toPlusDmdArg"><span class="hs-identifier hs-type">toPlusDmdArg</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><a href="GHC.Types.Demand.html#DmdType"><span class="hs-identifier hs-type">DmdType</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="GHC.Types.Demand.html#PlusDmdArg"><span class="hs-identifier hs-type">PlusDmdArg</span></a></span><span>
</span><span id="line-1155"></span><span id="toPlusDmdArg"><span class="annot"><span class="annottext">toPlusDmdArg :: DmdType -&gt; PlusDmdArg
</span><a href="GHC.Types.Demand.html#toPlusDmdArg"><span class="hs-identifier hs-var hs-var">toPlusDmdArg</span></a></span></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="GHC.Types.Demand.html#DmdType"><span class="hs-identifier hs-type">DmdType</span></a></span><span> </span><span id="local-6989586621680990689"><span class="annot"><span class="annottext">DmdEnv
</span><a href="#local-6989586621680990689"><span class="hs-identifier hs-var">fv</span></a></span></span><span> </span><span class="annot"><span class="annottext">[Demand]
</span><span class="hs-identifier">_</span></span><span> </span><span id="local-6989586621680990688"><span class="annot"><span class="annottext">Divergence
</span><a href="#local-6989586621680990688"><span class="hs-identifier hs-var">r</span></a></span></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">DmdEnv
</span><a href="#local-6989586621680990689"><span class="hs-identifier hs-var">fv</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">Divergence
</span><a href="#local-6989586621680990688"><span class="hs-identifier hs-var">r</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-1156"></span><span>
</span><span id="line-1157"></span><span class="annot"><a href="GHC.Types.Demand.html#plusDmdType"><span class="hs-identifier hs-type">plusDmdType</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><a href="GHC.Types.Demand.html#DmdType"><span class="hs-identifier hs-type">DmdType</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="GHC.Types.Demand.html#PlusDmdArg"><span class="hs-identifier hs-type">PlusDmdArg</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="GHC.Types.Demand.html#DmdType"><span class="hs-identifier hs-type">DmdType</span></a></span><span>
</span><span id="line-1158"></span><span id="plusDmdType"><span class="annot"><span class="annottext">plusDmdType :: DmdType -&gt; PlusDmdArg -&gt; DmdType
</span><a href="GHC.Types.Demand.html#plusDmdType"><span class="hs-identifier hs-var hs-var">plusDmdType</span></a></span></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="GHC.Types.Demand.html#DmdType"><span class="hs-identifier hs-type">DmdType</span></a></span><span> </span><span id="local-6989586621680990687"><span class="annot"><span class="annottext">DmdEnv
</span><a href="#local-6989586621680990687"><span class="hs-identifier hs-var">fv1</span></a></span></span><span> </span><span id="local-6989586621680990686"><span class="annot"><span class="annottext">[Demand]
</span><a href="#local-6989586621680990686"><span class="hs-identifier hs-var">ds1</span></a></span></span><span> </span><span id="local-6989586621680990685"><span class="annot"><span class="annottext">Divergence
</span><a href="#local-6989586621680990685"><span class="hs-identifier hs-var">r1</span></a></span></span><span class="hs-special">)</span><span> </span><span class="hs-special">(</span><span id="local-6989586621680990684"><span class="annot"><span class="annottext">DmdEnv
</span><a href="#local-6989586621680990684"><span class="hs-identifier hs-var">fv2</span></a></span></span><span class="hs-special">,</span><span> </span><span id="local-6989586621680990683"><span class="annot"><span class="annottext">Divergence
</span><a href="#local-6989586621680990683"><span class="hs-identifier hs-var">t2</span></a></span></span><span class="hs-special">)</span><span>
</span><span id="line-1159"></span><span>    </span><span class="hs-comment">-- See Note [Asymmetry of 'plus*']</span><span>
</span><span id="line-1160"></span><span>    </span><span class="hs-comment">-- 'plus' takes the argument/result info from its *first* arg,</span><span>
</span><span id="line-1161"></span><span>    </span><span class="hs-comment">-- using its second arg just for its free-var info.</span><span>
</span><span id="line-1162"></span><span>  </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">DmdEnv -&gt; [Demand] -&gt; Divergence -&gt; DmdType
</span><a href="GHC.Types.Demand.html#DmdType"><span class="hs-identifier hs-var">DmdType</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">forall a.
(a -&gt; a -&gt; a) -&gt; VarEnv a -&gt; a -&gt; VarEnv a -&gt; a -&gt; VarEnv a
</span><a href="GHC.Types.Var.Env.html#plusVarEnv_CD"><span class="hs-identifier hs-var">plusVarEnv_CD</span></a></span><span> </span><span class="annot"><span class="annottext">Demand -&gt; Demand -&gt; Demand
</span><a href="GHC.Types.Demand.html#plusDmd"><span class="hs-identifier hs-var">plusDmd</span></a></span><span> </span><span class="annot"><span class="annottext">DmdEnv
</span><a href="#local-6989586621680990687"><span class="hs-identifier hs-var">fv1</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Divergence -&gt; Demand
</span><a href="GHC.Types.Demand.html#defaultFvDmd"><span class="hs-identifier hs-var">defaultFvDmd</span></a></span><span> </span><span class="annot"><span class="annottext">Divergence
</span><a href="#local-6989586621680990685"><span class="hs-identifier hs-var">r1</span></a></span><span class="hs-special">)</span><span> </span><span class="annot"><span class="annottext">DmdEnv
</span><a href="#local-6989586621680990684"><span class="hs-identifier hs-var">fv2</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Divergence -&gt; Demand
</span><a href="GHC.Types.Demand.html#defaultFvDmd"><span class="hs-identifier hs-var">defaultFvDmd</span></a></span><span> </span><span class="annot"><span class="annottext">Divergence
</span><a href="#local-6989586621680990683"><span class="hs-identifier hs-var">t2</span></a></span><span class="hs-special">)</span><span class="hs-special">)</span><span>
</span><span id="line-1163"></span><span>            </span><span class="annot"><span class="annottext">[Demand]
</span><a href="#local-6989586621680990686"><span class="hs-identifier hs-var">ds1</span></a></span><span>
</span><span id="line-1164"></span><span>            </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Divergence
</span><a href="#local-6989586621680990685"><span class="hs-identifier hs-var">r1</span></a></span><span> </span><span class="annot"><span class="annottext">Divergence -&gt; Divergence -&gt; Divergence
</span><a href="GHC.Types.Demand.html#plusDivergence"><span class="hs-operator hs-var">`plusDivergence`</span></a></span><span> </span><span class="annot"><span class="annottext">Divergence
</span><a href="#local-6989586621680990683"><span class="hs-identifier hs-var">t2</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-1165"></span><span>
</span><span id="line-1166"></span><span class="annot"><a href="GHC.Types.Demand.html#botDmdType"><span class="hs-identifier hs-type">botDmdType</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><a href="GHC.Types.Demand.html#DmdType"><span class="hs-identifier hs-type">DmdType</span></a></span><span>
</span><span id="line-1167"></span><span id="botDmdType"><span class="annot"><span class="annottext">botDmdType :: DmdType
</span><a href="GHC.Types.Demand.html#botDmdType"><span class="hs-identifier hs-var hs-var">botDmdType</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">DmdEnv -&gt; [Demand] -&gt; Divergence -&gt; DmdType
</span><a href="GHC.Types.Demand.html#DmdType"><span class="hs-identifier hs-var">DmdType</span></a></span><span> </span><span class="annot"><span class="annottext">DmdEnv
</span><a href="GHC.Types.Demand.html#emptyDmdEnv"><span class="hs-identifier hs-var">emptyDmdEnv</span></a></span><span> </span><span class="hs-special">[</span><span class="hs-special">]</span><span> </span><span class="annot"><span class="annottext">Divergence
</span><a href="GHC.Types.Demand.html#botDiv"><span class="hs-identifier hs-var">botDiv</span></a></span><span>
</span><span id="line-1168"></span><span>
</span><span id="line-1169"></span><span class="hs-comment">-- | The demand type of doing nothing (lazy, absent, no Divergence</span><span>
</span><span id="line-1170"></span><span class="hs-comment">-- information). Note that it is ''not'' the top of the lattice (which would be</span><span>
</span><span id="line-1171"></span><span class="hs-comment">-- &quot;may use everything&quot;), so it is (no longer) called topDmdType.</span><span>
</span><span id="line-1172"></span><span class="annot"><a href="GHC.Types.Demand.html#nopDmdType"><span class="hs-identifier hs-type">nopDmdType</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><a href="GHC.Types.Demand.html#DmdType"><span class="hs-identifier hs-type">DmdType</span></a></span><span>
</span><span id="line-1173"></span><span id="nopDmdType"><span class="annot"><span class="annottext">nopDmdType :: DmdType
</span><a href="GHC.Types.Demand.html#nopDmdType"><span class="hs-identifier hs-var hs-var">nopDmdType</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">DmdEnv -&gt; [Demand] -&gt; Divergence -&gt; DmdType
</span><a href="GHC.Types.Demand.html#DmdType"><span class="hs-identifier hs-var">DmdType</span></a></span><span> </span><span class="annot"><span class="annottext">DmdEnv
</span><a href="GHC.Types.Demand.html#emptyDmdEnv"><span class="hs-identifier hs-var">emptyDmdEnv</span></a></span><span> </span><span class="hs-special">[</span><span class="hs-special">]</span><span> </span><span class="annot"><span class="annottext">Divergence
</span><a href="GHC.Types.Demand.html#topDiv"><span class="hs-identifier hs-var">topDiv</span></a></span><span>
</span><span id="line-1174"></span><span>
</span><span id="line-1175"></span><span class="annot"><a href="GHC.Types.Demand.html#isTopDmdType"><span class="hs-identifier hs-type">isTopDmdType</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><a href="GHC.Types.Demand.html#DmdType"><span class="hs-identifier hs-type">DmdType</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="hs-identifier hs-type">Bool</span></span><span>
</span><span id="line-1176"></span><span id="isTopDmdType"><span class="annot"><span class="annottext">isTopDmdType :: DmdType -&gt; Bool
</span><a href="GHC.Types.Demand.html#isTopDmdType"><span class="hs-identifier hs-var hs-var">isTopDmdType</span></a></span></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="GHC.Types.Demand.html#DmdType"><span class="hs-identifier hs-type">DmdType</span></a></span><span> </span><span id="local-6989586621680990681"><span class="annot"><span class="annottext">DmdEnv
</span><a href="#local-6989586621680990681"><span class="hs-identifier hs-var">env</span></a></span></span><span> </span><span id="local-6989586621680990680"><span class="annot"><span class="annottext">[Demand]
</span><a href="#local-6989586621680990680"><span class="hs-identifier hs-var">args</span></a></span></span><span> </span><span id="local-6989586621680990679"><span class="annot"><span class="annottext">Divergence
</span><a href="#local-6989586621680990679"><span class="hs-identifier hs-var">div</span></a></span></span><span class="hs-special">)</span><span>
</span><span id="line-1177"></span><span>  </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">Divergence
</span><a href="#local-6989586621680990679"><span class="hs-identifier hs-var">div</span></a></span><span> </span><span class="annot"><span class="annottext">forall a. Eq a =&gt; a -&gt; a -&gt; Bool
</span><span class="hs-operator hs-var">==</span></span><span> </span><span class="annot"><span class="annottext">Divergence
</span><a href="GHC.Types.Demand.html#topDiv"><span class="hs-identifier hs-var">topDiv</span></a></span><span> </span><span class="annot"><span class="annottext">Bool -&gt; Bool -&gt; Bool
</span><span class="hs-operator hs-var">&amp;&amp;</span></span><span> </span><span class="annot"><span class="annottext">forall (t :: * -&gt; *) a. Foldable t =&gt; t a -&gt; Bool
</span><a href="../../base-4.16.4.0/src/Data-Foldable.html#null"><span class="hs-identifier hs-var">null</span></a></span><span> </span><span class="annot"><span class="annottext">[Demand]
</span><a href="#local-6989586621680990680"><span class="hs-identifier hs-var">args</span></a></span><span> </span><span class="annot"><span class="annottext">Bool -&gt; Bool -&gt; Bool
</span><span class="hs-operator hs-var">&amp;&amp;</span></span><span> </span><span class="annot"><span class="annottext">forall a. VarEnv a -&gt; Bool
</span><a href="GHC.Types.Var.Env.html#isEmptyVarEnv"><span class="hs-identifier hs-var">isEmptyVarEnv</span></a></span><span> </span><span class="annot"><span class="annottext">DmdEnv
</span><a href="#local-6989586621680990681"><span class="hs-identifier hs-var">env</span></a></span><span>
</span><span id="line-1178"></span><span>
</span><span id="line-1179"></span><span class="hs-comment">-- | The demand type of an unspecified expression that is guaranteed to</span><span>
</span><span id="line-1180"></span><span class="hs-comment">-- throw a (precise or imprecise) exception or diverge.</span><span>
</span><span id="line-1181"></span><span class="annot"><a href="GHC.Types.Demand.html#exnDmdType"><span class="hs-identifier hs-type">exnDmdType</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><a href="GHC.Types.Demand.html#DmdType"><span class="hs-identifier hs-type">DmdType</span></a></span><span>
</span><span id="line-1182"></span><span id="exnDmdType"><span class="annot"><span class="annottext">exnDmdType :: DmdType
</span><a href="GHC.Types.Demand.html#exnDmdType"><span class="hs-identifier hs-var hs-var">exnDmdType</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">DmdEnv -&gt; [Demand] -&gt; Divergence -&gt; DmdType
</span><a href="GHC.Types.Demand.html#DmdType"><span class="hs-identifier hs-var">DmdType</span></a></span><span> </span><span class="annot"><span class="annottext">DmdEnv
</span><a href="GHC.Types.Demand.html#emptyDmdEnv"><span class="hs-identifier hs-var">emptyDmdEnv</span></a></span><span> </span><span class="hs-special">[</span><span class="hs-special">]</span><span> </span><span class="annot"><span class="annottext">Divergence
</span><a href="GHC.Types.Demand.html#exnDiv"><span class="hs-identifier hs-var">exnDiv</span></a></span><span>
</span><span id="line-1183"></span><span>
</span><span id="line-1184"></span><span class="annot"><a href="GHC.Types.Demand.html#dmdTypeDepth"><span class="hs-identifier hs-type">dmdTypeDepth</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><a href="GHC.Types.Demand.html#DmdType"><span class="hs-identifier hs-type">DmdType</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="GHC.Types.Basic.html#Arity"><span class="hs-identifier hs-type">Arity</span></a></span><span>
</span><span id="line-1185"></span><span id="dmdTypeDepth"><span class="annot"><span class="annottext">dmdTypeDepth :: DmdType -&gt; Int
</span><a href="GHC.Types.Demand.html#dmdTypeDepth"><span class="hs-identifier hs-var hs-var">dmdTypeDepth</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">forall (t :: * -&gt; *) a. Foldable t =&gt; t a -&gt; Int
</span><a href="../../base-4.16.4.0/src/Data-Foldable.html#length"><span class="hs-identifier hs-var">length</span></a></span><span> </span><span class="annot"><span class="annottext">forall b c a. (b -&gt; c) -&gt; (a -&gt; b) -&gt; a -&gt; c
</span><a href="../../base-4.16.4.0/src/GHC-Base.html#."><span class="hs-operator hs-var">.</span></a></span><span> </span><span class="annot"><span class="annottext">DmdType -&gt; [Demand]
</span><a href="GHC.Types.Demand.html#dt_args"><span class="hs-identifier hs-var">dt_args</span></a></span><span>
</span><span id="line-1186"></span><span>
</span><span id="line-1187"></span><span class="hs-comment">-- | This makes sure we can use the demand type with n arguments after eta</span><span>
</span><span id="line-1188"></span><span class="hs-comment">-- expansion, where n must not be lower than the demand types depth.</span><span>
</span><span id="line-1189"></span><span class="hs-comment">-- It appends the argument list with the correct 'defaultArgDmd'.</span><span>
</span><span id="line-1190"></span><span class="annot"><a href="GHC.Types.Demand.html#etaExpandDmdType"><span class="hs-identifier hs-type">etaExpandDmdType</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><a href="GHC.Types.Basic.html#Arity"><span class="hs-identifier hs-type">Arity</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="GHC.Types.Demand.html#DmdType"><span class="hs-identifier hs-type">DmdType</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="GHC.Types.Demand.html#DmdType"><span class="hs-identifier hs-type">DmdType</span></a></span><span>
</span><span id="line-1191"></span><span id="etaExpandDmdType"><span class="annot"><span class="annottext">etaExpandDmdType :: Int -&gt; DmdType -&gt; DmdType
</span><a href="GHC.Types.Demand.html#etaExpandDmdType"><span class="hs-identifier hs-var hs-var">etaExpandDmdType</span></a></span></span><span> </span><span id="local-6989586621680990675"><span class="annot"><span class="annottext">Int
</span><a href="#local-6989586621680990675"><span class="hs-identifier hs-var">n</span></a></span></span><span> </span><span id="local-6989586621680990674"><span class="annot"><span class="annottext">d :: DmdType
</span><a href="#local-6989586621680990674"><span class="hs-identifier hs-var">d</span></a></span></span><span class="hs-glyph">@</span><span class="annot"><a href="GHC.Types.Demand.html#DmdType"><span class="hs-identifier hs-type">DmdType</span></a></span><span class="hs-special">{</span><span class="annot"><span class="annottext">dt_args :: DmdType -&gt; [Demand]
</span><a href="GHC.Types.Demand.html#dt_args"><span class="hs-identifier hs-var">dt_args</span></a></span><span> </span><span class="hs-glyph">=</span><span> </span><span id="local-6989586621680990673"><span class="annot"><span class="annottext">[Demand]
</span><a href="#local-6989586621680990673"><span class="hs-identifier hs-var">ds</span></a></span></span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">dt_div :: DmdType -&gt; Divergence
</span><a href="GHC.Types.Demand.html#dt_div"><span class="hs-identifier hs-var">dt_div</span></a></span><span> </span><span class="hs-glyph">=</span><span> </span><span id="local-6989586621680990672"><span class="annot"><span class="annottext">Divergence
</span><a href="#local-6989586621680990672"><span class="hs-identifier hs-var">div</span></a></span></span><span class="hs-special">}</span><span>
</span><span id="line-1192"></span><span>  </span><span class="hs-glyph">|</span><span> </span><span class="annot"><span class="annottext">Int
</span><a href="#local-6989586621680990675"><span class="hs-identifier hs-var">n</span></a></span><span> </span><span class="annot"><span class="annottext">forall a. Eq a =&gt; a -&gt; a -&gt; Bool
</span><span class="hs-operator hs-var">==</span></span><span> </span><span class="annot"><span class="annottext">Int
</span><a href="#local-6989586621680990671"><span class="hs-identifier hs-var">depth</span></a></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">DmdType
</span><a href="#local-6989586621680990674"><span class="hs-identifier hs-var">d</span></a></span><span>
</span><span id="line-1193"></span><span>  </span><span class="hs-glyph">|</span><span> </span><span class="annot"><span class="annottext">Int
</span><a href="#local-6989586621680990675"><span class="hs-identifier hs-var">n</span></a></span><span> </span><span class="annot"><span class="annottext">forall a. Ord a =&gt; a -&gt; a -&gt; Bool
</span><span class="hs-operator hs-var">&gt;</span></span><span>  </span><span class="annot"><span class="annottext">Int
</span><a href="#local-6989586621680990671"><span class="hs-identifier hs-var">depth</span></a></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">DmdType
</span><a href="#local-6989586621680990674"><span class="hs-identifier hs-var">d</span></a></span><span class="hs-special">{</span><span class="annot"><span class="annottext">dt_args :: [Demand]
</span><a href="GHC.Types.Demand.html#dt_args"><span class="hs-identifier hs-var">dt_args</span></a></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">[Demand]
</span><a href="#local-6989586621680990669"><span class="hs-identifier hs-var">inc_ds</span></a></span><span class="hs-special">}</span><span>
</span><span id="line-1194"></span><span>  </span><span class="hs-glyph">|</span><span> </span><span class="annot"><span class="annottext">Bool
</span><a href="../../base-4.16.4.0/src/GHC-Base.html#otherwise"><span class="hs-identifier hs-var">otherwise</span></a></span><span>  </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">forall a. HasCallStack =&gt; String -&gt; SDoc -&gt; a
</span><a href="GHC.Utils.Panic.html#pprPanic"><span class="hs-identifier hs-var">pprPanic</span></a></span><span> </span><span class="annot"><span class="annottext">String
</span><span class="hs-string">&quot;etaExpandDmdType: arity decrease&quot;</span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">forall a. Outputable a =&gt; a -&gt; SDoc
</span><a href="GHC.Utils.Outputable.html#ppr"><span class="hs-identifier hs-var">ppr</span></a></span><span> </span><span class="annot"><span class="annottext">Int
</span><a href="#local-6989586621680990675"><span class="hs-identifier hs-var">n</span></a></span><span> </span><span class="annot"><span class="annottext">SDoc -&gt; SDoc -&gt; SDoc
</span><a href="GHC.Utils.Outputable.html#%24%24"><span class="hs-operator hs-var">$$</span></a></span><span> </span><span class="annot"><span class="annottext">forall a. Outputable a =&gt; a -&gt; SDoc
</span><a href="GHC.Utils.Outputable.html#ppr"><span class="hs-identifier hs-var">ppr</span></a></span><span> </span><span class="annot"><span class="annottext">DmdType
</span><a href="#local-6989586621680990674"><span class="hs-identifier hs-var">d</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-1195"></span><span>  </span><span class="hs-keyword">where</span><span> </span><span id="local-6989586621680990671"><span class="annot"><span class="annottext">depth :: Int
</span><a href="#local-6989586621680990671"><span class="hs-identifier hs-var hs-var">depth</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">forall (t :: * -&gt; *) a. Foldable t =&gt; t a -&gt; Int
</span><a href="../../base-4.16.4.0/src/Data-Foldable.html#length"><span class="hs-identifier hs-var">length</span></a></span><span> </span><span class="annot"><span class="annottext">[Demand]
</span><a href="#local-6989586621680990673"><span class="hs-identifier hs-var">ds</span></a></span><span>
</span><span id="line-1196"></span><span>        </span><span class="hs-comment">-- Arity increase:</span><span>
</span><span id="line-1197"></span><span>        </span><span class="hs-comment">--  * Demands on FVs are still valid</span><span>
</span><span id="line-1198"></span><span>        </span><span class="hs-comment">--  * Demands on args also valid, plus we can extend with defaultArgDmd</span><span>
</span><span id="line-1199"></span><span>        </span><span class="hs-comment">--    as appropriate for the given Divergence</span><span>
</span><span id="line-1200"></span><span>        </span><span class="hs-comment">--  * Divergence is still valid:</span><span>
</span><span id="line-1201"></span><span>        </span><span class="hs-comment">--    - A dead end after 2 arguments stays a dead end after 3 arguments</span><span>
</span><span id="line-1202"></span><span>        </span><span class="hs-comment">--    - The remaining case is Dunno, which is already topDiv</span><span>
</span><span id="line-1203"></span><span>        </span><span id="local-6989586621680990669"><span class="annot"><span class="annottext">inc_ds :: [Demand]
</span><a href="#local-6989586621680990669"><span class="hs-identifier hs-var hs-var">inc_ds</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">forall a. Int -&gt; [a] -&gt; [a]
</span><a href="../../base-4.16.4.0/src/GHC-List.html#take"><span class="hs-identifier hs-var">take</span></a></span><span> </span><span class="annot"><span class="annottext">Int
</span><a href="#local-6989586621680990675"><span class="hs-identifier hs-var">n</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">[Demand]
</span><a href="#local-6989586621680990673"><span class="hs-identifier hs-var">ds</span></a></span><span> </span><span class="annot"><span class="annottext">forall a. [a] -&gt; [a] -&gt; [a]
</span><a href="../../base-4.16.4.0/src/GHC-Base.html#%2B%2B"><span class="hs-operator hs-var">++</span></a></span><span> </span><span class="annot"><span class="annottext">forall a. a -&gt; [a]
</span><a href="../../base-4.16.4.0/src/GHC-List.html#repeat"><span class="hs-identifier hs-var">repeat</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Divergence -&gt; Demand
</span><a href="GHC.Types.Demand.html#defaultArgDmd"><span class="hs-identifier hs-var">defaultArgDmd</span></a></span><span> </span><span class="annot"><span class="annottext">Divergence
</span><a href="#local-6989586621680990672"><span class="hs-identifier hs-var">div</span></a></span><span class="hs-special">)</span><span class="hs-special">)</span><span>
</span><span id="line-1204"></span><span>
</span><span id="line-1205"></span><span class="hs-comment">-- | A conservative approximation for a given 'DmdType' in case of an arity</span><span>
</span><span id="line-1206"></span><span class="hs-comment">-- decrease. Currently, it's just nopDmdType.</span><span>
</span><span id="line-1207"></span><span class="annot"><a href="GHC.Types.Demand.html#decreaseArityDmdType"><span class="hs-identifier hs-type">decreaseArityDmdType</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><a href="GHC.Types.Demand.html#DmdType"><span class="hs-identifier hs-type">DmdType</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="GHC.Types.Demand.html#DmdType"><span class="hs-identifier hs-type">DmdType</span></a></span><span>
</span><span id="line-1208"></span><span id="decreaseArityDmdType"><span class="annot"><span class="annottext">decreaseArityDmdType :: DmdType -&gt; DmdType
</span><a href="GHC.Types.Demand.html#decreaseArityDmdType"><span class="hs-identifier hs-var hs-var">decreaseArityDmdType</span></a></span></span><span> </span><span class="annot"><span class="annottext">DmdType
</span><span class="hs-identifier">_</span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">DmdType
</span><a href="GHC.Types.Demand.html#nopDmdType"><span class="hs-identifier hs-var">nopDmdType</span></a></span><span>
</span><span id="line-1209"></span><span>
</span><span id="line-1210"></span><span class="annot"><a href="GHC.Types.Demand.html#splitDmdTy"><span class="hs-identifier hs-type">splitDmdTy</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><a href="GHC.Types.Demand.html#DmdType"><span class="hs-identifier hs-type">DmdType</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-special">(</span><span class="annot"><a href="GHC.Types.Demand.html#Demand"><span class="hs-identifier hs-type">Demand</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><a href="GHC.Types.Demand.html#DmdType"><span class="hs-identifier hs-type">DmdType</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-1211"></span><span class="hs-comment">-- Split off one function argument</span><span>
</span><span id="line-1212"></span><span class="hs-comment">-- We already have a suitable demand on all</span><span>
</span><span id="line-1213"></span><span class="hs-comment">-- free vars, so no need to add more!</span><span>
</span><span id="line-1214"></span><span id="splitDmdTy"><span class="annot"><span class="annottext">splitDmdTy :: DmdType -&gt; (Demand, DmdType)
</span><a href="GHC.Types.Demand.html#splitDmdTy"><span class="hs-identifier hs-var hs-var">splitDmdTy</span></a></span></span><span> </span><span id="local-6989586621680990662"><span class="annot"><span class="annottext">ty :: DmdType
</span><a href="#local-6989586621680990662"><span class="hs-identifier hs-var">ty</span></a></span></span><span class="hs-glyph">@</span><span class="annot"><a href="GHC.Types.Demand.html#DmdType"><span class="hs-identifier hs-type">DmdType</span></a></span><span class="hs-special">{</span><span class="annot"><span class="annottext">dt_args :: DmdType -&gt; [Demand]
</span><a href="GHC.Types.Demand.html#dt_args"><span class="hs-identifier hs-var">dt_args</span></a></span><span class="hs-glyph">=</span><span id="local-6989586621680990661"><span class="annot"><span class="annottext">Demand
</span><a href="#local-6989586621680990661"><span class="hs-identifier hs-var">dmd</span></a></span></span><span class="annot"><span class="hs-glyph hs-type">:</span></span><span id="local-6989586621680990660"><span class="annot"><span class="annottext">[Demand]
</span><a href="#local-6989586621680990660"><span class="hs-identifier hs-var">args</span></a></span></span><span class="hs-special">}</span><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Demand
</span><a href="#local-6989586621680990661"><span class="hs-identifier hs-var">dmd</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">DmdType
</span><a href="#local-6989586621680990662"><span class="hs-identifier hs-var">ty</span></a></span><span class="hs-special">{</span><span class="annot"><span class="annottext">dt_args :: [Demand]
</span><a href="GHC.Types.Demand.html#dt_args"><span class="hs-identifier hs-var">dt_args</span></a></span><span class="hs-glyph">=</span><span class="annot"><span class="annottext">[Demand]
</span><a href="#local-6989586621680990660"><span class="hs-identifier hs-var">args</span></a></span><span class="hs-special">}</span><span class="hs-special">)</span><span>
</span><span id="line-1215"></span><span class="annot"><a href="GHC.Types.Demand.html#splitDmdTy"><span class="hs-identifier hs-var">splitDmdTy</span></a></span><span> </span><span id="local-6989586621680990659"><span class="annot"><span class="annottext">ty :: DmdType
</span><a href="#local-6989586621680990659"><span class="hs-identifier hs-var">ty</span></a></span></span><span class="hs-glyph">@</span><span class="annot"><a href="GHC.Types.Demand.html#DmdType"><span class="hs-identifier hs-type">DmdType</span></a></span><span class="hs-special">{</span><span class="annot"><span class="annottext">dt_div :: DmdType -&gt; Divergence
</span><a href="GHC.Types.Demand.html#dt_div"><span class="hs-identifier hs-var">dt_div</span></a></span><span class="hs-glyph">=</span><span id="local-6989586621680990658"><span class="annot"><span class="annottext">Divergence
</span><a href="#local-6989586621680990658"><span class="hs-identifier hs-var">div</span></a></span></span><span class="hs-special">}</span><span>       </span><span class="hs-glyph">=</span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Divergence -&gt; Demand
</span><a href="GHC.Types.Demand.html#defaultArgDmd"><span class="hs-identifier hs-var">defaultArgDmd</span></a></span><span> </span><span class="annot"><span class="annottext">Divergence
</span><a href="#local-6989586621680990658"><span class="hs-identifier hs-var">div</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">DmdType
</span><a href="#local-6989586621680990659"><span class="hs-identifier hs-var">ty</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-1216"></span><span>
</span><span id="line-1217"></span><span class="annot"><a href="GHC.Types.Demand.html#multDmdType"><span class="hs-identifier hs-type">multDmdType</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><a href="GHC.Types.Demand.html#Card"><span class="hs-identifier hs-type">Card</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="GHC.Types.Demand.html#DmdType"><span class="hs-identifier hs-type">DmdType</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="GHC.Types.Demand.html#DmdType"><span class="hs-identifier hs-type">DmdType</span></a></span><span>
</span><span id="line-1218"></span><span id="multDmdType"><span class="annot"><span class="annottext">multDmdType :: Card -&gt; DmdType -&gt; DmdType
</span><a href="GHC.Types.Demand.html#multDmdType"><span class="hs-identifier hs-var hs-var">multDmdType</span></a></span></span><span> </span><span id="local-6989586621680990657"><span class="annot"><span class="annottext">Card
</span><a href="#local-6989586621680990657"><span class="hs-identifier hs-var">n</span></a></span></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="GHC.Types.Demand.html#DmdType"><span class="hs-identifier hs-type">DmdType</span></a></span><span> </span><span id="local-6989586621680990656"><span class="annot"><span class="annottext">DmdEnv
</span><a href="#local-6989586621680990656"><span class="hs-identifier hs-var">fv</span></a></span></span><span> </span><span id="local-6989586621680990655"><span class="annot"><span class="annottext">[Demand]
</span><a href="#local-6989586621680990655"><span class="hs-identifier hs-var">args</span></a></span></span><span> </span><span id="local-6989586621680990654"><span class="annot"><span class="annottext">Divergence
</span><a href="#local-6989586621680990654"><span class="hs-identifier hs-var">res_ty</span></a></span></span><span class="hs-special">)</span><span>
</span><span id="line-1219"></span><span>  </span><span class="hs-glyph">=</span><span> </span><span class="hs-comment">-- pprTrace &quot;multDmdType&quot; (ppr n $$ ppr fv $$ ppr (multDmdEnv n fv)) $</span><span>
</span><span id="line-1220"></span><span>    </span><span class="annot"><span class="annottext">DmdEnv -&gt; [Demand] -&gt; Divergence -&gt; DmdType
</span><a href="GHC.Types.Demand.html#DmdType"><span class="hs-identifier hs-var">DmdType</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Card -&gt; DmdEnv -&gt; DmdEnv
</span><a href="GHC.Types.Demand.html#multDmdEnv"><span class="hs-identifier hs-var">multDmdEnv</span></a></span><span> </span><span class="annot"><span class="annottext">Card
</span><a href="#local-6989586621680990657"><span class="hs-identifier hs-var">n</span></a></span><span> </span><span class="annot"><span class="annottext">DmdEnv
</span><a href="#local-6989586621680990656"><span class="hs-identifier hs-var">fv</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-1221"></span><span>            </span><span class="hs-special">(</span><span class="annot"><span class="annottext">forall a b. (a -&gt; b) -&gt; [a] -&gt; [b]
</span><a href="../../base-4.16.4.0/src/GHC-Base.html#map"><span class="hs-identifier hs-var">map</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Card -&gt; Demand -&gt; Demand
</span><a href="GHC.Types.Demand.html#multDmd"><span class="hs-identifier hs-var">multDmd</span></a></span><span> </span><span class="annot"><span class="annottext">Card
</span><a href="#local-6989586621680990657"><span class="hs-identifier hs-var">n</span></a></span><span class="hs-special">)</span><span> </span><span class="annot"><span class="annottext">[Demand]
</span><a href="#local-6989586621680990655"><span class="hs-identifier hs-var">args</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-1222"></span><span>            </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Card -&gt; Divergence -&gt; Divergence
</span><a href="GHC.Types.Demand.html#multDivergence"><span class="hs-identifier hs-var">multDivergence</span></a></span><span> </span><span class="annot"><span class="annottext">Card
</span><a href="#local-6989586621680990657"><span class="hs-identifier hs-var">n</span></a></span><span> </span><span class="annot"><span class="annottext">Divergence
</span><a href="#local-6989586621680990654"><span class="hs-identifier hs-var">res_ty</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-1223"></span><span>
</span><span id="line-1224"></span><span class="annot"><a href="GHC.Types.Demand.html#peelFV"><span class="hs-identifier hs-type">peelFV</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><a href="GHC.Types.Demand.html#DmdType"><span class="hs-identifier hs-type">DmdType</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="GHC.Types.Var.html#Var"><span class="hs-identifier hs-type">Var</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-special">(</span><span class="annot"><a href="GHC.Types.Demand.html#DmdType"><span class="hs-identifier hs-type">DmdType</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><a href="GHC.Types.Demand.html#Demand"><span class="hs-identifier hs-type">Demand</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-1225"></span><span id="peelFV"><span class="annot"><span class="annottext">peelFV :: DmdType -&gt; Var -&gt; (DmdType, Demand)
</span><a href="GHC.Types.Demand.html#peelFV"><span class="hs-identifier hs-var hs-var">peelFV</span></a></span></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="GHC.Types.Demand.html#DmdType"><span class="hs-identifier hs-type">DmdType</span></a></span><span> </span><span id="local-6989586621680990653"><span class="annot"><span class="annottext">DmdEnv
</span><a href="#local-6989586621680990653"><span class="hs-identifier hs-var">fv</span></a></span></span><span> </span><span id="local-6989586621680990652"><span class="annot"><span class="annottext">[Demand]
</span><a href="#local-6989586621680990652"><span class="hs-identifier hs-var">ds</span></a></span></span><span> </span><span id="local-6989586621680990651"><span class="annot"><span class="annottext">Divergence
</span><a href="#local-6989586621680990651"><span class="hs-identifier hs-var">res</span></a></span></span><span class="hs-special">)</span><span> </span><span id="local-6989586621680990650"><span class="annot"><span class="annottext">Var
</span><a href="#local-6989586621680990650"><span class="hs-identifier hs-var">id</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-comment">-- pprTrace &quot;rfv&quot; (ppr id &lt;+&gt; ppr dmd $$ ppr fv)</span><span>
</span><span id="line-1226"></span><span>                               </span><span class="hs-special">(</span><span class="annot"><span class="annottext">DmdEnv -&gt; [Demand] -&gt; Divergence -&gt; DmdType
</span><a href="GHC.Types.Demand.html#DmdType"><span class="hs-identifier hs-var">DmdType</span></a></span><span> </span><span class="annot"><span class="annottext">DmdEnv
</span><a href="#local-6989586621680990649"><span class="hs-identifier hs-var">fv'</span></a></span><span> </span><span class="annot"><span class="annottext">[Demand]
</span><a href="#local-6989586621680990652"><span class="hs-identifier hs-var">ds</span></a></span><span> </span><span class="annot"><span class="annottext">Divergence
</span><a href="#local-6989586621680990651"><span class="hs-identifier hs-var">res</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">Demand
</span><a href="#local-6989586621680990648"><span class="hs-identifier hs-var">dmd</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-1227"></span><span>  </span><span class="hs-keyword">where</span><span>
</span><span id="line-1228"></span><span>  </span><span class="hs-comment">-- Force these arguments so that old `Env` is not retained.</span><span>
</span><span id="line-1229"></span><span>  </span><span class="hs-glyph">!</span><span id="local-6989586621680990649"><span class="annot"><span class="annottext">fv' :: DmdEnv
</span><a href="#local-6989586621680990649"><span class="hs-identifier hs-var hs-var">fv'</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">DmdEnv
</span><a href="#local-6989586621680990653"><span class="hs-identifier hs-var">fv</span></a></span><span> </span><span class="annot"><span class="annottext">forall a. VarEnv a -&gt; Var -&gt; VarEnv a
</span><a href="GHC.Types.Var.Env.html#delVarEnv"><span class="hs-operator hs-var">`delVarEnv`</span></a></span><span> </span><span class="annot"><span class="annottext">Var
</span><a href="#local-6989586621680990650"><span class="hs-identifier hs-var">id</span></a></span><span>
</span><span id="line-1230"></span><span>  </span><span class="hs-comment">-- See Note [Default demand on free variables and arguments]</span><span>
</span><span id="line-1231"></span><span>  </span><span class="hs-glyph">!</span><span id="local-6989586621680990648"><span class="annot"><span class="annottext">dmd :: Demand
</span><a href="#local-6989586621680990648"><span class="hs-identifier hs-var hs-var">dmd</span></a></span></span><span>  </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">forall a. VarEnv a -&gt; Var -&gt; Maybe a
</span><a href="GHC.Types.Var.Env.html#lookupVarEnv"><span class="hs-identifier hs-var">lookupVarEnv</span></a></span><span> </span><span class="annot"><span class="annottext">DmdEnv
</span><a href="#local-6989586621680990653"><span class="hs-identifier hs-var">fv</span></a></span><span> </span><span class="annot"><span class="annottext">Var
</span><a href="#local-6989586621680990650"><span class="hs-identifier hs-var">id</span></a></span><span> </span><span class="annot"><span class="annottext">forall a. Maybe a -&gt; a -&gt; a
</span><a href="GHC.Data.Maybe.html#orElse"><span class="hs-operator hs-var">`orElse`</span></a></span><span> </span><span class="annot"><span class="annottext">Divergence -&gt; Demand
</span><a href="GHC.Types.Demand.html#defaultFvDmd"><span class="hs-identifier hs-var">defaultFvDmd</span></a></span><span> </span><span class="annot"><span class="annottext">Divergence
</span><a href="#local-6989586621680990651"><span class="hs-identifier hs-var">res</span></a></span><span>
</span><span id="line-1232"></span><span>
</span><span id="line-1233"></span><span class="annot"><a href="GHC.Types.Demand.html#addDemand"><span class="hs-identifier hs-type">addDemand</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><a href="GHC.Types.Demand.html#Demand"><span class="hs-identifier hs-type">Demand</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="GHC.Types.Demand.html#DmdType"><span class="hs-identifier hs-type">DmdType</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="GHC.Types.Demand.html#DmdType"><span class="hs-identifier hs-type">DmdType</span></a></span><span>
</span><span id="line-1234"></span><span id="addDemand"><span class="annot"><span class="annottext">addDemand :: Demand -&gt; DmdType -&gt; DmdType
</span><a href="GHC.Types.Demand.html#addDemand"><span class="hs-identifier hs-var hs-var">addDemand</span></a></span></span><span> </span><span id="local-6989586621680990645"><span class="annot"><span class="annottext">Demand
</span><a href="#local-6989586621680990645"><span class="hs-identifier hs-var">dmd</span></a></span></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="GHC.Types.Demand.html#DmdType"><span class="hs-identifier hs-type">DmdType</span></a></span><span> </span><span id="local-6989586621680990644"><span class="annot"><span class="annottext">DmdEnv
</span><a href="#local-6989586621680990644"><span class="hs-identifier hs-var">fv</span></a></span></span><span> </span><span id="local-6989586621680990643"><span class="annot"><span class="annottext">[Demand]
</span><a href="#local-6989586621680990643"><span class="hs-identifier hs-var">ds</span></a></span></span><span> </span><span id="local-6989586621680990642"><span class="annot"><span class="annottext">Divergence
</span><a href="#local-6989586621680990642"><span class="hs-identifier hs-var">res</span></a></span></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">DmdEnv -&gt; [Demand] -&gt; Divergence -&gt; DmdType
</span><a href="GHC.Types.Demand.html#DmdType"><span class="hs-identifier hs-var">DmdType</span></a></span><span> </span><span class="annot"><span class="annottext">DmdEnv
</span><a href="#local-6989586621680990644"><span class="hs-identifier hs-var">fv</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Demand
</span><a href="#local-6989586621680990645"><span class="hs-identifier hs-var">dmd</span></a></span><span class="annot"><span class="annottext">forall a. a -&gt; [a] -&gt; [a]
</span><span class="hs-glyph hs-var">:</span></span><span class="annot"><span class="annottext">[Demand]
</span><a href="#local-6989586621680990643"><span class="hs-identifier hs-var">ds</span></a></span><span class="hs-special">)</span><span> </span><span class="annot"><span class="annottext">Divergence
</span><a href="#local-6989586621680990642"><span class="hs-identifier hs-var">res</span></a></span><span>
</span><span id="line-1235"></span><span>
</span><span id="line-1236"></span><span class="annot"><a href="GHC.Types.Demand.html#findIdDemand"><span class="hs-identifier hs-type">findIdDemand</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><a href="GHC.Types.Demand.html#DmdType"><span class="hs-identifier hs-type">DmdType</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="GHC.Types.Var.html#Var"><span class="hs-identifier hs-type">Var</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="GHC.Types.Demand.html#Demand"><span class="hs-identifier hs-type">Demand</span></a></span><span>
</span><span id="line-1237"></span><span id="findIdDemand"><span class="annot"><span class="annottext">findIdDemand :: DmdType -&gt; Var -&gt; Demand
</span><a href="GHC.Types.Demand.html#findIdDemand"><span class="hs-identifier hs-var hs-var">findIdDemand</span></a></span></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="GHC.Types.Demand.html#DmdType"><span class="hs-identifier hs-type">DmdType</span></a></span><span> </span><span id="local-6989586621680990641"><span class="annot"><span class="annottext">DmdEnv
</span><a href="#local-6989586621680990641"><span class="hs-identifier hs-var">fv</span></a></span></span><span> </span><span class="annot"><span class="annottext">[Demand]
</span><span class="hs-identifier">_</span></span><span> </span><span id="local-6989586621680990640"><span class="annot"><span class="annottext">Divergence
</span><a href="#local-6989586621680990640"><span class="hs-identifier hs-var">res</span></a></span></span><span class="hs-special">)</span><span> </span><span id="local-6989586621680990639"><span class="annot"><span class="annottext">Var
</span><a href="#local-6989586621680990639"><span class="hs-identifier hs-var">id</span></a></span></span><span>
</span><span id="line-1238"></span><span>  </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">forall a. VarEnv a -&gt; Var -&gt; Maybe a
</span><a href="GHC.Types.Var.Env.html#lookupVarEnv"><span class="hs-identifier hs-var">lookupVarEnv</span></a></span><span> </span><span class="annot"><span class="annottext">DmdEnv
</span><a href="#local-6989586621680990641"><span class="hs-identifier hs-var">fv</span></a></span><span> </span><span class="annot"><span class="annottext">Var
</span><a href="#local-6989586621680990639"><span class="hs-identifier hs-var">id</span></a></span><span> </span><span class="annot"><span class="annottext">forall a. Maybe a -&gt; a -&gt; a
</span><a href="GHC.Data.Maybe.html#orElse"><span class="hs-operator hs-var">`orElse`</span></a></span><span> </span><span class="annot"><span class="annottext">Divergence -&gt; Demand
</span><a href="GHC.Types.Demand.html#defaultFvDmd"><span class="hs-identifier hs-var">defaultFvDmd</span></a></span><span> </span><span class="annot"><span class="annottext">Divergence
</span><a href="#local-6989586621680990640"><span class="hs-identifier hs-var">res</span></a></span><span>
</span><span id="line-1239"></span><span>
</span><span id="line-1240"></span><span class="hs-comment">-- | When e is evaluated after executing an IO action that may throw a precise</span><span>
</span><span id="line-1241"></span><span class="hs-comment">-- exception, we act as if there is an additional control flow path that is</span><span>
</span><span id="line-1242"></span><span class="hs-comment">-- taken if e throws a precise exception. The demand type of this control flow</span><span>
</span><span id="line-1243"></span><span class="hs-comment">-- path</span><span>
</span><span id="line-1244"></span><span class="hs-comment">--   * is lazy and absent ('topDmd') in all free variables and arguments</span><span>
</span><span id="line-1245"></span><span class="hs-comment">--   * has 'exnDiv' 'Divergence' result</span><span>
</span><span id="line-1246"></span><span class="hs-comment">-- So we can simply take a variant of 'nopDmdType', 'exnDmdType'.</span><span>
</span><span id="line-1247"></span><span class="hs-comment">-- Why not 'nopDmdType'? Because then the result of 'e' can never be 'exnDiv'!</span><span>
</span><span id="line-1248"></span><span class="hs-comment">-- That means failure to drop dead-ends, see #18086.</span><span>
</span><span id="line-1249"></span><span class="hs-comment">-- See Note [Precise exceptions and strictness analysis]</span><span>
</span><span id="line-1250"></span><span class="annot"><a href="GHC.Types.Demand.html#deferAfterPreciseException"><span class="hs-identifier hs-type">deferAfterPreciseException</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><a href="GHC.Types.Demand.html#DmdType"><span class="hs-identifier hs-type">DmdType</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="GHC.Types.Demand.html#DmdType"><span class="hs-identifier hs-type">DmdType</span></a></span><span>
</span><span id="line-1251"></span><span id="deferAfterPreciseException"><span class="annot"><span class="annottext">deferAfterPreciseException :: DmdType -&gt; DmdType
</span><a href="GHC.Types.Demand.html#deferAfterPreciseException"><span class="hs-identifier hs-var hs-var">deferAfterPreciseException</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">DmdType -&gt; DmdType -&gt; DmdType
</span><a href="GHC.Types.Demand.html#lubDmdType"><span class="hs-identifier hs-var">lubDmdType</span></a></span><span> </span><span class="annot"><span class="annottext">DmdType
</span><a href="GHC.Types.Demand.html#exnDmdType"><span class="hs-identifier hs-var">exnDmdType</span></a></span><span>
</span><span id="line-1252"></span><span>
</span><span id="line-1253"></span><span class="hs-comment">-- | See 'keepAliveDmdEnv'.</span><span>
</span><span id="line-1254"></span><span class="annot"><a href="GHC.Types.Demand.html#keepAliveDmdType"><span class="hs-identifier hs-type">keepAliveDmdType</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><a href="GHC.Types.Demand.html#DmdType"><span class="hs-identifier hs-type">DmdType</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="GHC.Types.Var.Set.html#VarSet"><span class="hs-identifier hs-type">VarSet</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="GHC.Types.Demand.html#DmdType"><span class="hs-identifier hs-type">DmdType</span></a></span><span>
</span><span id="line-1255"></span><span id="keepAliveDmdType"><span class="annot"><span class="annottext">keepAliveDmdType :: DmdType -&gt; IdSet -&gt; DmdType
</span><a href="GHC.Types.Demand.html#keepAliveDmdType"><span class="hs-identifier hs-var hs-var">keepAliveDmdType</span></a></span></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="GHC.Types.Demand.html#DmdType"><span class="hs-identifier hs-type">DmdType</span></a></span><span> </span><span id="local-6989586621680990637"><span class="annot"><span class="annottext">DmdEnv
</span><a href="#local-6989586621680990637"><span class="hs-identifier hs-var">fvs</span></a></span></span><span> </span><span id="local-6989586621680990636"><span class="annot"><span class="annottext">[Demand]
</span><a href="#local-6989586621680990636"><span class="hs-identifier hs-var">ds</span></a></span></span><span> </span><span id="local-6989586621680990635"><span class="annot"><span class="annottext">Divergence
</span><a href="#local-6989586621680990635"><span class="hs-identifier hs-var">res</span></a></span></span><span class="hs-special">)</span><span> </span><span id="local-6989586621680990634"><span class="annot"><span class="annottext">IdSet
</span><a href="#local-6989586621680990634"><span class="hs-identifier hs-var">vars</span></a></span></span><span> </span><span class="hs-glyph">=</span><span>
</span><span id="line-1256"></span><span>  </span><span class="annot"><span class="annottext">DmdEnv -&gt; [Demand] -&gt; Divergence -&gt; DmdType
</span><a href="GHC.Types.Demand.html#DmdType"><span class="hs-identifier hs-var">DmdType</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">DmdEnv
</span><a href="#local-6989586621680990637"><span class="hs-identifier hs-var">fvs</span></a></span><span> </span><span class="annot"><span class="annottext">DmdEnv -&gt; IdSet -&gt; DmdEnv
</span><a href="GHC.Types.Demand.html#keepAliveDmdEnv"><span class="hs-operator hs-var">`keepAliveDmdEnv`</span></a></span><span> </span><span class="annot"><span class="annottext">IdSet
</span><a href="#local-6989586621680990634"><span class="hs-identifier hs-var">vars</span></a></span><span class="hs-special">)</span><span> </span><span class="annot"><span class="annottext">[Demand]
</span><a href="#local-6989586621680990636"><span class="hs-identifier hs-var">ds</span></a></span><span> </span><span class="annot"><span class="annottext">Divergence
</span><a href="#local-6989586621680990635"><span class="hs-identifier hs-var">res</span></a></span><span>
</span><span id="line-1257"></span><span>
</span><span id="line-1258"></span><span class="hs-comment">{-
Note [Demand type Divergence]
~~~~~~~~~~~~~~~~~~~~~~~~~~~~~
In contrast to StrictSigs, DmdTypes are elicited under a specific incoming demand.
This is described in detail in Note [Understanding DmdType and StrictSig].
Here, we'll focus on what that means for a DmdType's Divergence in a higher-order
scenario.

Consider
  err x y = x `seq` y `seq` error (show x)
this has a strictness signature of
  &lt;1L&gt;&lt;1L&gt;b
meaning that we don't know what happens when we call err in weaker contexts than
C1(C1(L)), like @err `seq` ()@ (1A) and @err 1 `seq` ()@ (CS(A)). We
may not unleash the botDiv, hence assume topDiv. Of course, in
@err 1 2 `seq` ()@ the incoming demand CS(CS(A)) is strong enough and we see
that the expression diverges.

Now consider a function
  f g = g 1 2
with signature &lt;C1(C1(L))&gt;, and the expression
  f err `seq` ()
now f puts a strictness demand of C1(C1(L)) onto its argument, which is unleashed
on err via the App rule. In contrast to weaker head strictness, this demand is
strong enough to unleash err's signature and hence we see that the whole
expression diverges!

Note [Asymmetry of 'plus*']
~~~~~~~~~~~~~~~~~~~~~~~~~~~
'plus' for DmdTypes is *asymmetrical*, because there can only one
be one type contributing argument demands!  For example, given (e1 e2), we get
a DmdType dt1 for e1, use its arg demand to analyse e2 giving dt2, and then do
(dt1 `plusType` dt2). Similarly with
  case e of { p -&gt; rhs }
we get dt_scrut from the scrutinee and dt_rhs from the RHS, and then
compute (dt_rhs `plusType` dt_scrut).

We
 1. combine the information on the free variables,
 2. take the demand on arguments from the first argument
 3. combine the termination results, as in plusDivergence.

Since we don't use argument demands of the second argument anyway, 'plus's
second argument is just a 'PlusDmdType'.

But note that the argument demand types are not guaranteed to be observed in
left to right order. For example, analysis of a case expression will pass the
demand type for the alts as the left argument and the type for the scrutinee as
the right argument. Also, it is not at all clear if there is such an order;
consider the LetUp case, where the RHS might be forced at any point while
evaluating the let body.
Therefore, it is crucial that 'plusDivergence' is symmetric!

Note [Demands from unsaturated function calls]
~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~
Consider a demand transformer d1 -&gt; d2 -&gt; r for f.
If a sufficiently detailed demand is fed into this transformer,
e.g &lt;C1(C1(L))&gt; arising from &quot;f x1 x2&quot; in a strict, use-once context,
then d1 and d2 is precisely the demand unleashed onto x1 and x2 (similar for
the free variable environment) and furthermore the result information r is the
one we want to use.

An anonymous lambda is also an unsaturated function all (needs one argument,
none given), so this applies to that case as well.

But the demand fed into f might be less than C1(C1(L)). Then we have to
'multDmdType' the announced demand type. Examples:
 * Not strict enough, e.g. C1(C1(L)):
   - We have to multiply all argument and free variable demands with C_01,
     zapping strictness.
   - We have to multiply divergence with C_01. If r says that f Diverges for sure,
     then this holds when the demand guarantees that two arguments are going to
     be passed. If the demand is lower, we may just as well converge.
     If we were tracking definite convergence, than that would still hold under
     a weaker demand than expected by the demand transformer.
 * Used more than once, e.g. CS(C1(L)):
   - Multiply with C_1N. Even if f puts a used-once demand on any of its argument
     or free variables, if we call f multiple times, we may evaluate this
     argument or free variable multiple times.

In dmdTransformSig, we call peelManyCalls to find out the 'Card'inality with
which we have to multiply and then call multDmdType with that.

Similarly, dmdTransformDictSelSig and dmdAnal, when analyzing a Lambda, use
peelCallDmd, which peels only one level, but also returns the demand put on the
body of the function.
-}</span><span>
</span><span id="line-1345"></span><span>
</span><span id="line-1346"></span><span>
</span><span id="line-1347"></span><span class="hs-comment">{-
************************************************************************
*                                                                      *
                     Demand signatures
*                                                                      *
************************************************************************

In a let-bound Id we record its demand signature.
In principle, this demand signature is a demand transformer, mapping
a demand on the Id into a DmdType, which gives
        a) the free vars of the Id's value
        b) the Id's arguments
        c) an indication of the result of applying
           the Id to its arguments

However, in fact we store in the Id an extremely emascuated demand
transfomer, namely

                a single DmdType
(Nevertheless we dignify StrictSig as a distinct type.)

This DmdType gives the demands unleashed by the Id when it is applied
to as many arguments as are given in by the arg demands in the DmdType.
Also see Note [Demand type Divergence] for the meaning of a Divergence in a
strictness signature.

If an Id is applied to less arguments than its arity, it means that
the demand on the function at a call site is weaker than the vanilla
call demand, used for signature inference. Therefore we place a top
demand on all arguments. Otherwise, the demand is specified by Id's
signature.

For example, the demand transformer described by the demand signature
        StrictSig (DmdType {x -&gt; &lt;1L&gt;} &lt;A&gt;&lt;1P(L,L)&gt;)
says that when the function is applied to two arguments, it
unleashes demand 1L on the free var x, A on the first arg,
and 1P(L,L) on the second.

If this same function is applied to one arg, all we can say is that it
uses x with 1L, and its arg with demand 1P(L,L).

Note [Understanding DmdType and StrictSig]
~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~
Demand types are sound approximations of an expression's semantics relative to
the incoming demand we put the expression under. Consider the following
expression:

    \x y -&gt; x `seq` (y, 2*x)

Here is a table with demand types resulting from different incoming demands we
put that expression under. Note the monotonicity; a stronger incoming demand
yields a more precise demand type:

    incoming demand   |  demand type
    --------------------------------
    1A                  |  &lt;L&gt;&lt;L&gt;{}
    C1(C1(L))           |  &lt;1P(L)&gt;&lt;L&gt;{}
    C1(C1(1P(1P(L),A))) |  &lt;1P(A)&gt;&lt;A&gt;{}

Note that in the first example, the depth of the demand type was *higher* than
the arity of the incoming call demand due to the anonymous lambda.
The converse is also possible and happens when we unleash demand signatures.
In @f x y@, the incoming call demand on f has arity 2. But if all we have is a
demand signature with depth 1 for @f@ (which we can safely unleash, see below),
the demand type of @f@ under a call demand of arity 2 has a *lower* depth of 1.

So: Demand types are elicited by putting an expression under an incoming (call)
demand, the arity of which can be lower or higher than the depth of the
resulting demand type.
In contrast, a demand signature summarises a function's semantics *without*
immediately specifying the incoming demand it was produced under. Despite StrSig
being a newtype wrapper around DmdType, it actually encodes two things:

  * The threshold (i.e., minimum arity) to unleash the signature
  * A demand type that is sound to unleash when the minimum arity requirement is
    met.

Here comes the subtle part: The threshold is encoded in the wrapped demand
type's depth! So in mkStrictSigForArity we make sure to trim the list of
argument demands to the given threshold arity. Call sites will make sure that
this corresponds to the arity of the call demand that elicited the wrapped
demand type. See also Note [What are demand signatures?].
-}</span><span>
</span><span id="line-1430"></span><span>
</span><span id="line-1431"></span><span class="hs-comment">-- | The depth of the wrapped 'DmdType' encodes the arity at which it is safe</span><span>
</span><span id="line-1432"></span><span class="hs-comment">-- to unleash. Better construct this through 'mkStrictSigForArity'.</span><span>
</span><span id="line-1433"></span><span class="hs-comment">-- See Note [Understanding DmdType and StrictSig]</span><span>
</span><span id="line-1434"></span><span class="hs-keyword">newtype</span><span> </span><span id="StrictSig"><span class="annot"><a href="GHC.Types.Demand.html#StrictSig"><span class="hs-identifier hs-var">StrictSig</span></a></span></span><span>
</span><span id="line-1435"></span><span>  </span><span class="hs-glyph">=</span><span> </span><span id="StrictSig"><span class="annot"><a href="GHC.Types.Demand.html#StrictSig"><span class="hs-identifier hs-var">StrictSig</span></a></span></span><span> </span><span class="annot"><a href="GHC.Types.Demand.html#DmdType"><span class="hs-identifier hs-type">DmdType</span></a></span><span>
</span><span id="line-1436"></span><span>  </span><span class="hs-keyword">deriving</span><span> </span><span id="local-6989586621680990628"><span id="local-6989586621680990632"><span class="annot"><span class="annottext">StrictSig -&gt; StrictSig -&gt; Bool
forall a. (a -&gt; a -&gt; Bool) -&gt; (a -&gt; a -&gt; Bool) -&gt; Eq a
/= :: StrictSig -&gt; StrictSig -&gt; Bool
$c/= :: StrictSig -&gt; StrictSig -&gt; Bool
== :: StrictSig -&gt; StrictSig -&gt; Bool
$c== :: StrictSig -&gt; StrictSig -&gt; Bool
</span><span class="hs-identifier hs-var hs-var hs-var hs-var hs-var hs-var">Eq</span></span></span></span><span>
</span><span id="line-1437"></span><span>
</span><span id="line-1438"></span><span class="hs-comment">-- | Turns a 'DmdType' computed for the particular 'Arity' into a 'StrictSig'</span><span>
</span><span id="line-1439"></span><span class="hs-comment">-- unleashable at that arity. See Note [Understanding DmdType and StrictSig]</span><span>
</span><span id="line-1440"></span><span class="annot"><a href="GHC.Types.Demand.html#mkStrictSigForArity"><span class="hs-identifier hs-type">mkStrictSigForArity</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><a href="GHC.Types.Basic.html#Arity"><span class="hs-identifier hs-type">Arity</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="GHC.Types.Demand.html#DmdType"><span class="hs-identifier hs-type">DmdType</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="GHC.Types.Demand.html#StrictSig"><span class="hs-identifier hs-type">StrictSig</span></a></span><span>
</span><span id="line-1441"></span><span id="mkStrictSigForArity"><span class="annot"><span class="annottext">mkStrictSigForArity :: Int -&gt; DmdType -&gt; StrictSig
</span><a href="GHC.Types.Demand.html#mkStrictSigForArity"><span class="hs-identifier hs-var hs-var">mkStrictSigForArity</span></a></span></span><span> </span><span id="local-6989586621680990624"><span class="annot"><span class="annottext">Int
</span><a href="#local-6989586621680990624"><span class="hs-identifier hs-var">arity</span></a></span></span><span> </span><span id="local-6989586621680990623"><span class="annot"><span class="annottext">dmd_ty :: DmdType
</span><a href="#local-6989586621680990623"><span class="hs-identifier hs-var">dmd_ty</span></a></span></span><span class="hs-glyph">@</span><span class="hs-special">(</span><span class="annot"><a href="GHC.Types.Demand.html#DmdType"><span class="hs-identifier hs-type">DmdType</span></a></span><span> </span><span id="local-6989586621680990622"><span class="annot"><span class="annottext">DmdEnv
</span><a href="#local-6989586621680990622"><span class="hs-identifier hs-var">fvs</span></a></span></span><span> </span><span id="local-6989586621680990621"><span class="annot"><span class="annottext">[Demand]
</span><a href="#local-6989586621680990621"><span class="hs-identifier hs-var">args</span></a></span></span><span> </span><span id="local-6989586621680990620"><span class="annot"><span class="annottext">Divergence
</span><a href="#local-6989586621680990620"><span class="hs-identifier hs-var">div</span></a></span></span><span class="hs-special">)</span><span>
</span><span id="line-1442"></span><span>  </span><span class="hs-glyph">|</span><span> </span><span class="annot"><span class="annottext">Int
</span><a href="#local-6989586621680990624"><span class="hs-identifier hs-var">arity</span></a></span><span> </span><span class="annot"><span class="annottext">forall a. Ord a =&gt; a -&gt; a -&gt; Bool
</span><span class="hs-operator hs-var">&lt;</span></span><span> </span><span class="annot"><span class="annottext">DmdType -&gt; Int
</span><a href="GHC.Types.Demand.html#dmdTypeDepth"><span class="hs-identifier hs-var">dmdTypeDepth</span></a></span><span> </span><span class="annot"><span class="annottext">DmdType
</span><a href="#local-6989586621680990623"><span class="hs-identifier hs-var">dmd_ty</span></a></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">DmdType -&gt; StrictSig
</span><a href="GHC.Types.Demand.html#StrictSig"><span class="hs-identifier hs-var">StrictSig</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">DmdEnv -&gt; [Demand] -&gt; Divergence -&gt; DmdType
</span><a href="GHC.Types.Demand.html#DmdType"><span class="hs-identifier hs-var">DmdType</span></a></span><span> </span><span class="annot"><span class="annottext">DmdEnv
</span><a href="#local-6989586621680990622"><span class="hs-identifier hs-var">fvs</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">forall a. Int -&gt; [a] -&gt; [a]
</span><a href="../../base-4.16.4.0/src/GHC-List.html#take"><span class="hs-identifier hs-var">take</span></a></span><span> </span><span class="annot"><span class="annottext">Int
</span><a href="#local-6989586621680990624"><span class="hs-identifier hs-var">arity</span></a></span><span> </span><span class="annot"><span class="annottext">[Demand]
</span><a href="#local-6989586621680990621"><span class="hs-identifier hs-var">args</span></a></span><span class="hs-special">)</span><span> </span><span class="annot"><span class="annottext">Divergence
</span><a href="#local-6989586621680990620"><span class="hs-identifier hs-var">div</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-1443"></span><span>  </span><span class="hs-glyph">|</span><span> </span><span class="annot"><span class="annottext">Bool
</span><a href="../../base-4.16.4.0/src/GHC-Base.html#otherwise"><span class="hs-identifier hs-var">otherwise</span></a></span><span>                   </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">DmdType -&gt; StrictSig
</span><a href="GHC.Types.Demand.html#StrictSig"><span class="hs-identifier hs-var">StrictSig</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Int -&gt; DmdType -&gt; DmdType
</span><a href="GHC.Types.Demand.html#etaExpandDmdType"><span class="hs-identifier hs-var">etaExpandDmdType</span></a></span><span> </span><span class="annot"><span class="annottext">Int
</span><a href="#local-6989586621680990624"><span class="hs-identifier hs-var">arity</span></a></span><span> </span><span class="annot"><span class="annottext">DmdType
</span><a href="#local-6989586621680990623"><span class="hs-identifier hs-var">dmd_ty</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-1444"></span><span>
</span><span id="line-1445"></span><span class="annot"><a href="GHC.Types.Demand.html#mkClosedStrictSig"><span class="hs-identifier hs-type">mkClosedStrictSig</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="hs-special">[</span><span class="annot"><a href="GHC.Types.Demand.html#Demand"><span class="hs-identifier hs-type">Demand</span></a></span><span class="hs-special">]</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="GHC.Types.Demand.html#Divergence"><span class="hs-identifier hs-type">Divergence</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="GHC.Types.Demand.html#StrictSig"><span class="hs-identifier hs-type">StrictSig</span></a></span><span>
</span><span id="line-1446"></span><span id="mkClosedStrictSig"><span class="annot"><span class="annottext">mkClosedStrictSig :: [Demand] -&gt; Divergence -&gt; StrictSig
</span><a href="GHC.Types.Demand.html#mkClosedStrictSig"><span class="hs-identifier hs-var hs-var">mkClosedStrictSig</span></a></span></span><span> </span><span id="local-6989586621680990618"><span class="annot"><span class="annottext">[Demand]
</span><a href="#local-6989586621680990618"><span class="hs-identifier hs-var">ds</span></a></span></span><span> </span><span id="local-6989586621680990617"><span class="annot"><span class="annottext">Divergence
</span><a href="#local-6989586621680990617"><span class="hs-identifier hs-var">res</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">Int -&gt; DmdType -&gt; StrictSig
</span><a href="GHC.Types.Demand.html#mkStrictSigForArity"><span class="hs-identifier hs-var">mkStrictSigForArity</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">forall (t :: * -&gt; *) a. Foldable t =&gt; t a -&gt; Int
</span><a href="../../base-4.16.4.0/src/Data-Foldable.html#length"><span class="hs-identifier hs-var">length</span></a></span><span> </span><span class="annot"><span class="annottext">[Demand]
</span><a href="#local-6989586621680990618"><span class="hs-identifier hs-var">ds</span></a></span><span class="hs-special">)</span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">DmdEnv -&gt; [Demand] -&gt; Divergence -&gt; DmdType
</span><a href="GHC.Types.Demand.html#DmdType"><span class="hs-identifier hs-var">DmdType</span></a></span><span> </span><span class="annot"><span class="annottext">DmdEnv
</span><a href="GHC.Types.Demand.html#emptyDmdEnv"><span class="hs-identifier hs-var">emptyDmdEnv</span></a></span><span> </span><span class="annot"><span class="annottext">[Demand]
</span><a href="#local-6989586621680990618"><span class="hs-identifier hs-var">ds</span></a></span><span> </span><span class="annot"><span class="annottext">Divergence
</span><a href="#local-6989586621680990617"><span class="hs-identifier hs-var">res</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-1447"></span><span>
</span><span id="line-1448"></span><span class="annot"><a href="GHC.Types.Demand.html#splitStrictSig"><span class="hs-identifier hs-type">splitStrictSig</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><a href="GHC.Types.Demand.html#StrictSig"><span class="hs-identifier hs-type">StrictSig</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-special">(</span><span class="hs-special">[</span><span class="annot"><a href="GHC.Types.Demand.html#Demand"><span class="hs-identifier hs-type">Demand</span></a></span><span class="hs-special">]</span><span class="hs-special">,</span><span> </span><span class="annot"><a href="GHC.Types.Demand.html#Divergence"><span class="hs-identifier hs-type">Divergence</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-1449"></span><span id="splitStrictSig"><span class="annot"><span class="annottext">splitStrictSig :: StrictSig -&gt; ([Demand], Divergence)
</span><a href="GHC.Types.Demand.html#splitStrictSig"><span class="hs-identifier hs-var hs-var">splitStrictSig</span></a></span></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="GHC.Types.Demand.html#StrictSig"><span class="hs-identifier hs-type">StrictSig</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="GHC.Types.Demand.html#DmdType"><span class="hs-identifier hs-type">DmdType</span></a></span><span> </span><span class="annot"><span class="annottext">DmdEnv
</span><span class="hs-identifier">_</span></span><span> </span><span id="local-6989586621680990616"><span class="annot"><span class="annottext">[Demand]
</span><a href="#local-6989586621680990616"><span class="hs-identifier hs-var">dmds</span></a></span></span><span> </span><span id="local-6989586621680990615"><span class="annot"><span class="annottext">Divergence
</span><a href="#local-6989586621680990615"><span class="hs-identifier hs-var">res</span></a></span></span><span class="hs-special">)</span><span class="hs-special">)</span><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">[Demand]
</span><a href="#local-6989586621680990616"><span class="hs-identifier hs-var">dmds</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">Divergence
</span><a href="#local-6989586621680990615"><span class="hs-identifier hs-var">res</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-1450"></span><span>
</span><span id="line-1451"></span><span class="annot"><a href="GHC.Types.Demand.html#strictSigDmdEnv"><span class="hs-identifier hs-type">strictSigDmdEnv</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><a href="GHC.Types.Demand.html#StrictSig"><span class="hs-identifier hs-type">StrictSig</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="GHC.Types.Demand.html#DmdEnv"><span class="hs-identifier hs-type">DmdEnv</span></a></span><span>
</span><span id="line-1452"></span><span id="strictSigDmdEnv"><span class="annot"><span class="annottext">strictSigDmdEnv :: StrictSig -&gt; DmdEnv
</span><a href="GHC.Types.Demand.html#strictSigDmdEnv"><span class="hs-identifier hs-var hs-var">strictSigDmdEnv</span></a></span></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="GHC.Types.Demand.html#StrictSig"><span class="hs-identifier hs-type">StrictSig</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="GHC.Types.Demand.html#DmdType"><span class="hs-identifier hs-type">DmdType</span></a></span><span> </span><span id="local-6989586621680990614"><span class="annot"><span class="annottext">DmdEnv
</span><a href="#local-6989586621680990614"><span class="hs-identifier hs-var">env</span></a></span></span><span> </span><span class="annot"><span class="annottext">[Demand]
</span><span class="hs-identifier">_</span></span><span> </span><span class="annot"><span class="annottext">Divergence
</span><span class="hs-identifier">_</span></span><span class="hs-special">)</span><span class="hs-special">)</span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">DmdEnv
</span><a href="#local-6989586621680990614"><span class="hs-identifier hs-var">env</span></a></span><span>
</span><span id="line-1453"></span><span>
</span><span id="line-1454"></span><span class="annot"><a href="GHC.Types.Demand.html#hasDemandEnvSig"><span class="hs-identifier hs-type">hasDemandEnvSig</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><a href="GHC.Types.Demand.html#StrictSig"><span class="hs-identifier hs-type">StrictSig</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="hs-identifier hs-type">Bool</span></span><span>
</span><span id="line-1455"></span><span id="hasDemandEnvSig"><span class="annot"><span class="annottext">hasDemandEnvSig :: StrictSig -&gt; Bool
</span><a href="GHC.Types.Demand.html#hasDemandEnvSig"><span class="hs-identifier hs-var hs-var">hasDemandEnvSig</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">Bool -&gt; Bool
</span><span class="hs-identifier hs-var">not</span></span><span> </span><span class="annot"><span class="annottext">forall b c a. (b -&gt; c) -&gt; (a -&gt; b) -&gt; a -&gt; c
</span><a href="../../base-4.16.4.0/src/GHC-Base.html#."><span class="hs-operator hs-var">.</span></a></span><span> </span><span class="annot"><span class="annottext">forall a. VarEnv a -&gt; Bool
</span><a href="GHC.Types.Var.Env.html#isEmptyVarEnv"><span class="hs-identifier hs-var">isEmptyVarEnv</span></a></span><span> </span><span class="annot"><span class="annottext">forall b c a. (b -&gt; c) -&gt; (a -&gt; b) -&gt; a -&gt; c
</span><a href="../../base-4.16.4.0/src/GHC-Base.html#."><span class="hs-operator hs-var">.</span></a></span><span> </span><span class="annot"><span class="annottext">StrictSig -&gt; DmdEnv
</span><a href="GHC.Types.Demand.html#strictSigDmdEnv"><span class="hs-identifier hs-var">strictSigDmdEnv</span></a></span><span>
</span><span id="line-1456"></span><span>
</span><span id="line-1457"></span><span class="annot"><a href="GHC.Types.Demand.html#botSig"><span class="hs-identifier hs-type">botSig</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><a href="GHC.Types.Demand.html#StrictSig"><span class="hs-identifier hs-type">StrictSig</span></a></span><span>
</span><span id="line-1458"></span><span id="botSig"><span class="annot"><span class="annottext">botSig :: StrictSig
</span><a href="GHC.Types.Demand.html#botSig"><span class="hs-identifier hs-var hs-var">botSig</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">DmdType -&gt; StrictSig
</span><a href="GHC.Types.Demand.html#StrictSig"><span class="hs-identifier hs-var">StrictSig</span></a></span><span> </span><span class="annot"><span class="annottext">DmdType
</span><a href="GHC.Types.Demand.html#botDmdType"><span class="hs-identifier hs-var">botDmdType</span></a></span><span>
</span><span id="line-1459"></span><span>
</span><span id="line-1460"></span><span class="annot"><a href="GHC.Types.Demand.html#nopSig"><span class="hs-identifier hs-type">nopSig</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><a href="GHC.Types.Demand.html#StrictSig"><span class="hs-identifier hs-type">StrictSig</span></a></span><span>
</span><span id="line-1461"></span><span id="nopSig"><span class="annot"><span class="annottext">nopSig :: StrictSig
</span><a href="GHC.Types.Demand.html#nopSig"><span class="hs-identifier hs-var hs-var">nopSig</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">DmdType -&gt; StrictSig
</span><a href="GHC.Types.Demand.html#StrictSig"><span class="hs-identifier hs-var">StrictSig</span></a></span><span> </span><span class="annot"><span class="annottext">DmdType
</span><a href="GHC.Types.Demand.html#nopDmdType"><span class="hs-identifier hs-var">nopDmdType</span></a></span><span>
</span><span id="line-1462"></span><span>
</span><span id="line-1463"></span><span class="annot"><a href="GHC.Types.Demand.html#isTopSig"><span class="hs-identifier hs-type">isTopSig</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><a href="GHC.Types.Demand.html#StrictSig"><span class="hs-identifier hs-type">StrictSig</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="hs-identifier hs-type">Bool</span></span><span>
</span><span id="line-1464"></span><span id="isTopSig"><span class="annot"><span class="annottext">isTopSig :: StrictSig -&gt; Bool
</span><a href="GHC.Types.Demand.html#isTopSig"><span class="hs-identifier hs-var hs-var">isTopSig</span></a></span></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="GHC.Types.Demand.html#StrictSig"><span class="hs-identifier hs-type">StrictSig</span></a></span><span> </span><span id="local-6989586621680990613"><span class="annot"><span class="annottext">DmdType
</span><a href="#local-6989586621680990613"><span class="hs-identifier hs-var">ty</span></a></span></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">DmdType -&gt; Bool
</span><a href="GHC.Types.Demand.html#isTopDmdType"><span class="hs-identifier hs-var">isTopDmdType</span></a></span><span> </span><span class="annot"><span class="annottext">DmdType
</span><a href="#local-6989586621680990613"><span class="hs-identifier hs-var">ty</span></a></span><span>
</span><span id="line-1465"></span><span>
</span><span id="line-1466"></span><span class="hs-comment">-- | True if the signature diverges or throws an exception in a saturated call.</span><span>
</span><span id="line-1467"></span><span class="hs-comment">-- See Note [Dead ends].</span><span>
</span><span id="line-1468"></span><span class="annot"><a href="GHC.Types.Demand.html#isDeadEndSig"><span class="hs-identifier hs-type">isDeadEndSig</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><a href="GHC.Types.Demand.html#StrictSig"><span class="hs-identifier hs-type">StrictSig</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="hs-identifier hs-type">Bool</span></span><span>
</span><span id="line-1469"></span><span id="isDeadEndSig"><span class="annot"><span class="annottext">isDeadEndSig :: StrictSig -&gt; Bool
</span><a href="GHC.Types.Demand.html#isDeadEndSig"><span class="hs-identifier hs-var hs-var">isDeadEndSig</span></a></span></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="GHC.Types.Demand.html#StrictSig"><span class="hs-identifier hs-type">StrictSig</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="GHC.Types.Demand.html#DmdType"><span class="hs-identifier hs-type">DmdType</span></a></span><span> </span><span class="annot"><span class="annottext">DmdEnv
</span><span class="hs-identifier">_</span></span><span> </span><span class="annot"><span class="annottext">[Demand]
</span><span class="hs-identifier">_</span></span><span> </span><span id="local-6989586621680990612"><span class="annot"><span class="annottext">Divergence
</span><a href="#local-6989586621680990612"><span class="hs-identifier hs-var">res</span></a></span></span><span class="hs-special">)</span><span class="hs-special">)</span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">Divergence -&gt; Bool
</span><a href="GHC.Types.Demand.html#isDeadEndDiv"><span class="hs-identifier hs-var">isDeadEndDiv</span></a></span><span> </span><span class="annot"><span class="annottext">Divergence
</span><a href="#local-6989586621680990612"><span class="hs-identifier hs-var">res</span></a></span><span>
</span><span id="line-1470"></span><span>
</span><span id="line-1471"></span><span class="hs-comment">-- | Returns true if an application to n value args would diverge or throw an</span><span>
</span><span id="line-1472"></span><span class="hs-comment">-- exception.</span><span>
</span><span id="line-1473"></span><span class="hs-comment">--</span><span>
</span><span id="line-1474"></span><span class="hs-comment">-- If a function having 'botDiv' is applied to a less number of arguments than</span><span>
</span><span id="line-1475"></span><span class="hs-comment">-- its syntactic arity, we cannot say for sure that it is going to diverge.</span><span>
</span><span id="line-1476"></span><span class="hs-comment">-- Hence this function conservatively returns False in that case.</span><span>
</span><span id="line-1477"></span><span class="hs-comment">-- See Note [Dead ends].</span><span>
</span><span id="line-1478"></span><span class="annot"><a href="GHC.Types.Demand.html#isDeadEndAppSig"><span class="hs-identifier hs-type">isDeadEndAppSig</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><a href="GHC.Types.Demand.html#StrictSig"><span class="hs-identifier hs-type">StrictSig</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="hs-identifier hs-type">Int</span></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="hs-identifier hs-type">Bool</span></span><span>
</span><span id="line-1479"></span><span id="isDeadEndAppSig"><span class="annot"><span class="annottext">isDeadEndAppSig :: StrictSig -&gt; Int -&gt; Bool
</span><a href="GHC.Types.Demand.html#isDeadEndAppSig"><span class="hs-identifier hs-var hs-var">isDeadEndAppSig</span></a></span></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="GHC.Types.Demand.html#StrictSig"><span class="hs-identifier hs-type">StrictSig</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="GHC.Types.Demand.html#DmdType"><span class="hs-identifier hs-type">DmdType</span></a></span><span> </span><span class="annot"><span class="annottext">DmdEnv
</span><span class="hs-identifier">_</span></span><span> </span><span id="local-6989586621680990611"><span class="annot"><span class="annottext">[Demand]
</span><a href="#local-6989586621680990611"><span class="hs-identifier hs-var">ds</span></a></span></span><span> </span><span id="local-6989586621680990610"><span class="annot"><span class="annottext">Divergence
</span><a href="#local-6989586621680990610"><span class="hs-identifier hs-var">res</span></a></span></span><span class="hs-special">)</span><span class="hs-special">)</span><span> </span><span id="local-6989586621680990609"><span class="annot"><span class="annottext">Int
</span><a href="#local-6989586621680990609"><span class="hs-identifier hs-var">n</span></a></span></span><span>
</span><span id="line-1480"></span><span>  </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">Divergence -&gt; Bool
</span><a href="GHC.Types.Demand.html#isDeadEndDiv"><span class="hs-identifier hs-var">isDeadEndDiv</span></a></span><span> </span><span class="annot"><span class="annottext">Divergence
</span><a href="#local-6989586621680990610"><span class="hs-identifier hs-var">res</span></a></span><span> </span><span class="annot"><span class="annottext">Bool -&gt; Bool -&gt; Bool
</span><span class="hs-operator hs-var">&amp;&amp;</span></span><span> </span><span class="annot"><span class="annottext">Bool -&gt; Bool
</span><span class="hs-identifier hs-var">not</span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">forall a. [a] -&gt; Int -&gt; Bool
</span><a href="GHC.Utils.Misc.html#lengthExceeds"><span class="hs-identifier hs-var">lengthExceeds</span></a></span><span> </span><span class="annot"><span class="annottext">[Demand]
</span><a href="#local-6989586621680990611"><span class="hs-identifier hs-var">ds</span></a></span><span> </span><span class="annot"><span class="annottext">Int
</span><a href="#local-6989586621680990609"><span class="hs-identifier hs-var">n</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-1481"></span><span>
</span><span id="line-1482"></span><span class="annot"><a href="GHC.Types.Demand.html#prependArgsStrictSig"><span class="hs-identifier hs-type">prependArgsStrictSig</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><span class="hs-identifier hs-type">Int</span></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="GHC.Types.Demand.html#StrictSig"><span class="hs-identifier hs-type">StrictSig</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="GHC.Types.Demand.html#StrictSig"><span class="hs-identifier hs-type">StrictSig</span></a></span><span>
</span><span id="line-1483"></span><span class="hs-comment">-- ^ Add extra ('topDmd') arguments to a strictness signature.</span><span>
</span><span id="line-1484"></span><span class="hs-comment">-- In contrast to 'etaConvertStrictSig', this /prepends/ additional argument</span><span>
</span><span id="line-1485"></span><span class="hs-comment">-- demands. This is used by FloatOut.</span><span>
</span><span id="line-1486"></span><span id="prependArgsStrictSig"><span class="annot"><span class="annottext">prependArgsStrictSig :: Int -&gt; StrictSig -&gt; StrictSig
</span><a href="GHC.Types.Demand.html#prependArgsStrictSig"><span class="hs-identifier hs-var hs-var">prependArgsStrictSig</span></a></span></span><span> </span><span id="local-6989586621680990608"><span class="annot"><span class="annottext">Int
</span><a href="#local-6989586621680990608"><span class="hs-identifier hs-var">new_args</span></a></span></span><span> </span><span id="local-6989586621680990607"><span class="annot"><span class="annottext">sig :: StrictSig
</span><a href="#local-6989586621680990607"><span class="hs-identifier hs-var">sig</span></a></span></span><span class="hs-glyph">@</span><span class="hs-special">(</span><span class="annot"><a href="GHC.Types.Demand.html#StrictSig"><span class="hs-identifier hs-type">StrictSig</span></a></span><span> </span><span id="local-6989586621680990606"><span class="annot"><span class="annottext">dmd_ty :: DmdType
</span><a href="#local-6989586621680990606"><span class="hs-identifier hs-var">dmd_ty</span></a></span></span><span class="hs-glyph">@</span><span class="hs-special">(</span><span class="annot"><a href="GHC.Types.Demand.html#DmdType"><span class="hs-identifier hs-type">DmdType</span></a></span><span> </span><span id="local-6989586621680990605"><span class="annot"><span class="annottext">DmdEnv
</span><a href="#local-6989586621680990605"><span class="hs-identifier hs-var">env</span></a></span></span><span> </span><span id="local-6989586621680990604"><span class="annot"><span class="annottext">[Demand]
</span><a href="#local-6989586621680990604"><span class="hs-identifier hs-var">dmds</span></a></span></span><span> </span><span id="local-6989586621680990603"><span class="annot"><span class="annottext">Divergence
</span><a href="#local-6989586621680990603"><span class="hs-identifier hs-var">res</span></a></span></span><span class="hs-special">)</span><span class="hs-special">)</span><span>
</span><span id="line-1487"></span><span>  </span><span class="hs-glyph">|</span><span> </span><span class="annot"><span class="annottext">Int
</span><a href="#local-6989586621680990608"><span class="hs-identifier hs-var">new_args</span></a></span><span> </span><span class="annot"><span class="annottext">forall a. Eq a =&gt; a -&gt; a -&gt; Bool
</span><span class="hs-operator hs-var">==</span></span><span> </span><span class="annot"><span class="annottext">Int
</span><span class="hs-number">0</span></span><span>       </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">StrictSig
</span><a href="#local-6989586621680990607"><span class="hs-identifier hs-var">sig</span></a></span><span>
</span><span id="line-1488"></span><span>  </span><span class="hs-glyph">|</span><span> </span><span class="annot"><span class="annottext">DmdType -&gt; Bool
</span><a href="GHC.Types.Demand.html#isTopDmdType"><span class="hs-identifier hs-var">isTopDmdType</span></a></span><span> </span><span class="annot"><span class="annottext">DmdType
</span><a href="#local-6989586621680990606"><span class="hs-identifier hs-var">dmd_ty</span></a></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">StrictSig
</span><a href="#local-6989586621680990607"><span class="hs-identifier hs-var">sig</span></a></span><span>
</span><span id="line-1489"></span><span>  </span><span class="hs-glyph">|</span><span> </span><span class="annot"><span class="annottext">Int
</span><a href="#local-6989586621680990608"><span class="hs-identifier hs-var">new_args</span></a></span><span> </span><span class="annot"><span class="annottext">forall a. Ord a =&gt; a -&gt; a -&gt; Bool
</span><span class="hs-operator hs-var">&lt;</span></span><span> </span><span class="annot"><span class="annottext">Int
</span><span class="hs-number">0</span></span><span>        </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">forall a. HasCallStack =&gt; String -&gt; SDoc -&gt; a
</span><a href="GHC.Utils.Panic.html#pprPanic"><span class="hs-identifier hs-var">pprPanic</span></a></span><span> </span><span class="annot"><span class="annottext">String
</span><span class="hs-string">&quot;prependArgsStrictSig: negative new_args&quot;</span></span><span>
</span><span id="line-1490"></span><span>                                   </span><span class="hs-special">(</span><span class="annot"><span class="annottext">forall a. Outputable a =&gt; a -&gt; SDoc
</span><a href="GHC.Utils.Outputable.html#ppr"><span class="hs-identifier hs-var">ppr</span></a></span><span> </span><span class="annot"><span class="annottext">Int
</span><a href="#local-6989586621680990608"><span class="hs-identifier hs-var">new_args</span></a></span><span> </span><span class="annot"><span class="annottext">SDoc -&gt; SDoc -&gt; SDoc
</span><a href="GHC.Utils.Outputable.html#%24%24"><span class="hs-operator hs-var">$$</span></a></span><span> </span><span class="annot"><span class="annottext">forall a. Outputable a =&gt; a -&gt; SDoc
</span><a href="GHC.Utils.Outputable.html#ppr"><span class="hs-identifier hs-var">ppr</span></a></span><span> </span><span class="annot"><span class="annottext">StrictSig
</span><a href="#local-6989586621680990607"><span class="hs-identifier hs-var">sig</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-1491"></span><span>  </span><span class="hs-glyph">|</span><span> </span><span class="annot"><span class="annottext">Bool
</span><a href="../../base-4.16.4.0/src/GHC-Base.html#otherwise"><span class="hs-identifier hs-var">otherwise</span></a></span><span>           </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">DmdType -&gt; StrictSig
</span><a href="GHC.Types.Demand.html#StrictSig"><span class="hs-identifier hs-var">StrictSig</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">DmdEnv -&gt; [Demand] -&gt; Divergence -&gt; DmdType
</span><a href="GHC.Types.Demand.html#DmdType"><span class="hs-identifier hs-var">DmdType</span></a></span><span> </span><span class="annot"><span class="annottext">DmdEnv
</span><a href="#local-6989586621680990605"><span class="hs-identifier hs-var">env</span></a></span><span> </span><span class="annot"><span class="annottext">[Demand]
</span><a href="#local-6989586621680990602"><span class="hs-identifier hs-var">dmds'</span></a></span><span> </span><span class="annot"><span class="annottext">Divergence
</span><a href="#local-6989586621680990603"><span class="hs-identifier hs-var">res</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-1492"></span><span>  </span><span class="hs-keyword">where</span><span>
</span><span id="line-1493"></span><span>    </span><span id="local-6989586621680990602"><span class="annot"><span class="annottext">dmds' :: [Demand]
</span><a href="#local-6989586621680990602"><span class="hs-identifier hs-var hs-var">dmds'</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">forall a. Int -&gt; a -&gt; [a]
</span><a href="../../base-4.16.4.0/src/GHC-List.html#replicate"><span class="hs-identifier hs-var">replicate</span></a></span><span> </span><span class="annot"><span class="annottext">Int
</span><a href="#local-6989586621680990608"><span class="hs-identifier hs-var">new_args</span></a></span><span> </span><span class="annot"><span class="annottext">Demand
</span><a href="GHC.Types.Demand.html#topDmd"><span class="hs-identifier hs-var">topDmd</span></a></span><span> </span><span class="annot"><span class="annottext">forall a. [a] -&gt; [a] -&gt; [a]
</span><a href="../../base-4.16.4.0/src/GHC-Base.html#%2B%2B"><span class="hs-operator hs-var">++</span></a></span><span> </span><span class="annot"><span class="annottext">[Demand]
</span><a href="#local-6989586621680990604"><span class="hs-identifier hs-var">dmds</span></a></span><span>
</span><span id="line-1494"></span><span>
</span><span id="line-1495"></span><span class="annot"><a href="GHC.Types.Demand.html#etaConvertStrictSig"><span class="hs-identifier hs-type">etaConvertStrictSig</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><a href="GHC.Types.Basic.html#Arity"><span class="hs-identifier hs-type">Arity</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="GHC.Types.Demand.html#StrictSig"><span class="hs-identifier hs-type">StrictSig</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="GHC.Types.Demand.html#StrictSig"><span class="hs-identifier hs-type">StrictSig</span></a></span><span>
</span><span id="line-1496"></span><span class="hs-comment">-- ^ We are expanding (\x y. e) to (\x y z. e z) or reducing from the latter to</span><span>
</span><span id="line-1497"></span><span class="hs-comment">-- the former (when the Simplifier identifies a new join points, for example).</span><span>
</span><span id="line-1498"></span><span class="hs-comment">-- In contrast to 'prependArgsStrictSig', this /appends/ extra arg demands if</span><span>
</span><span id="line-1499"></span><span class="hs-comment">-- necessary.</span><span>
</span><span id="line-1500"></span><span class="hs-comment">-- This works by looking at the 'DmdType' (which was produced under a call</span><span>
</span><span id="line-1501"></span><span class="hs-comment">-- demand for the old arity) and trying to transfer as many facts as we can to</span><span>
</span><span id="line-1502"></span><span class="hs-comment">-- the call demand of new arity.</span><span>
</span><span id="line-1503"></span><span class="hs-comment">-- An arity increase (resulting in a stronger incoming demand) can retain much</span><span>
</span><span id="line-1504"></span><span class="hs-comment">-- of the info, while an arity decrease (a weakening of the incoming demand)</span><span>
</span><span id="line-1505"></span><span class="hs-comment">-- must fall back to a conservative default.</span><span>
</span><span id="line-1506"></span><span id="etaConvertStrictSig"><span class="annot"><span class="annottext">etaConvertStrictSig :: Int -&gt; StrictSig -&gt; StrictSig
</span><a href="GHC.Types.Demand.html#etaConvertStrictSig"><span class="hs-identifier hs-var hs-var">etaConvertStrictSig</span></a></span></span><span> </span><span id="local-6989586621680990601"><span class="annot"><span class="annottext">Int
</span><a href="#local-6989586621680990601"><span class="hs-identifier hs-var">arity</span></a></span></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="GHC.Types.Demand.html#StrictSig"><span class="hs-identifier hs-type">StrictSig</span></a></span><span> </span><span id="local-6989586621680990600"><span class="annot"><span class="annottext">DmdType
</span><a href="#local-6989586621680990600"><span class="hs-identifier hs-var">dmd_ty</span></a></span></span><span class="hs-special">)</span><span>
</span><span id="line-1507"></span><span>  </span><span class="hs-glyph">|</span><span> </span><span class="annot"><span class="annottext">Int
</span><a href="#local-6989586621680990601"><span class="hs-identifier hs-var">arity</span></a></span><span> </span><span class="annot"><span class="annottext">forall a. Ord a =&gt; a -&gt; a -&gt; Bool
</span><span class="hs-operator hs-var">&lt;</span></span><span> </span><span class="annot"><span class="annottext">DmdType -&gt; Int
</span><a href="GHC.Types.Demand.html#dmdTypeDepth"><span class="hs-identifier hs-var">dmdTypeDepth</span></a></span><span> </span><span class="annot"><span class="annottext">DmdType
</span><a href="#local-6989586621680990600"><span class="hs-identifier hs-var">dmd_ty</span></a></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">DmdType -&gt; StrictSig
</span><a href="GHC.Types.Demand.html#StrictSig"><span class="hs-identifier hs-var">StrictSig</span></a></span><span> </span><span class="annot"><span class="annottext">forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><a href="../../base-4.16.4.0/src/GHC-Base.html#%24"><span class="hs-operator hs-var">$</span></a></span><span> </span><span class="annot"><span class="annottext">DmdType -&gt; DmdType
</span><a href="GHC.Types.Demand.html#decreaseArityDmdType"><span class="hs-identifier hs-var">decreaseArityDmdType</span></a></span><span> </span><span class="annot"><span class="annottext">DmdType
</span><a href="#local-6989586621680990600"><span class="hs-identifier hs-var">dmd_ty</span></a></span><span>
</span><span id="line-1508"></span><span>  </span><span class="hs-glyph">|</span><span> </span><span class="annot"><span class="annottext">Bool
</span><a href="../../base-4.16.4.0/src/GHC-Base.html#otherwise"><span class="hs-identifier hs-var">otherwise</span></a></span><span>                   </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">DmdType -&gt; StrictSig
</span><a href="GHC.Types.Demand.html#StrictSig"><span class="hs-identifier hs-var">StrictSig</span></a></span><span> </span><span class="annot"><span class="annottext">forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><a href="../../base-4.16.4.0/src/GHC-Base.html#%24"><span class="hs-operator hs-var">$</span></a></span><span> </span><span class="annot"><span class="annottext">Int -&gt; DmdType -&gt; DmdType
</span><a href="GHC.Types.Demand.html#etaExpandDmdType"><span class="hs-identifier hs-var">etaExpandDmdType</span></a></span><span> </span><span class="annot"><span class="annottext">Int
</span><a href="#local-6989586621680990601"><span class="hs-identifier hs-var">arity</span></a></span><span> </span><span class="annot"><span class="annottext">DmdType
</span><a href="#local-6989586621680990600"><span class="hs-identifier hs-var">dmd_ty</span></a></span><span>
</span><span id="line-1509"></span><span>
</span><span id="line-1510"></span><span class="hs-comment">{-
************************************************************************
*                                                                      *
                     Demand transformers
*                                                                      *
************************************************************************
-}</span><span>
</span><span id="line-1517"></span><span>
</span><span id="line-1518"></span><span class="hs-comment">-- | A /demand transformer/ is a monotone function from an incoming evaluation</span><span>
</span><span id="line-1519"></span><span class="hs-comment">-- context ('SubDemand') to a 'DmdType', describing how the denoted thing</span><span>
</span><span id="line-1520"></span><span class="hs-comment">-- (i.e. expression, function) uses its arguments and free variables, and</span><span>
</span><span id="line-1521"></span><span class="hs-comment">-- whether it diverges.</span><span>
</span><span id="line-1522"></span><span class="hs-comment">--</span><span>
</span><span id="line-1523"></span><span class="hs-comment">-- See Note [Understanding DmdType and StrictSig]</span><span>
</span><span id="line-1524"></span><span class="hs-comment">-- and Note [What are demand signatures?].</span><span>
</span><span id="line-1525"></span><span class="hs-keyword">type</span><span> </span><span id="DmdTransformer"><span class="annot"><a href="GHC.Types.Demand.html#DmdTransformer"><span class="hs-identifier hs-var">DmdTransformer</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><a href="GHC.Types.Demand.html#SubDemand"><span class="hs-identifier hs-type">SubDemand</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="GHC.Types.Demand.html#DmdType"><span class="hs-identifier hs-type">DmdType</span></a></span><span>
</span><span id="line-1526"></span><span>
</span><span id="line-1527"></span><span class="hs-comment">-- | Extrapolate a demand signature ('StrictSig') into a 'DmdTransformer'.</span><span>
</span><span id="line-1528"></span><span class="hs-comment">--</span><span>
</span><span id="line-1529"></span><span class="hs-comment">-- Given a function's 'StrictSig' and a 'SubDemand' for the evaluation context,</span><span>
</span><span id="line-1530"></span><span class="hs-comment">-- return how the function evaluates its free variables and arguments.</span><span>
</span><span id="line-1531"></span><span class="annot"><a href="GHC.Types.Demand.html#dmdTransformSig"><span class="hs-identifier hs-type">dmdTransformSig</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><a href="GHC.Types.Demand.html#StrictSig"><span class="hs-identifier hs-type">StrictSig</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="GHC.Types.Demand.html#DmdTransformer"><span class="hs-identifier hs-type">DmdTransformer</span></a></span><span>
</span><span id="line-1532"></span><span id="dmdTransformSig"><span class="annot"><span class="annottext">dmdTransformSig :: StrictSig -&gt; DmdTransformer
</span><a href="GHC.Types.Demand.html#dmdTransformSig"><span class="hs-identifier hs-var hs-var">dmdTransformSig</span></a></span></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="GHC.Types.Demand.html#StrictSig"><span class="hs-identifier hs-type">StrictSig</span></a></span><span> </span><span id="local-6989586621680990599"><span class="annot"><span class="annottext">dmd_ty :: DmdType
</span><a href="#local-6989586621680990599"><span class="hs-identifier hs-var">dmd_ty</span></a></span></span><span class="hs-glyph">@</span><span class="hs-special">(</span><span class="annot"><a href="GHC.Types.Demand.html#DmdType"><span class="hs-identifier hs-type">DmdType</span></a></span><span> </span><span class="annot"><span class="annottext">DmdEnv
</span><span class="hs-identifier">_</span></span><span> </span><span id="local-6989586621680990598"><span class="annot"><span class="annottext">[Demand]
</span><a href="#local-6989586621680990598"><span class="hs-identifier hs-var">arg_ds</span></a></span></span><span> </span><span class="annot"><span class="annottext">Divergence
</span><span class="hs-identifier">_</span></span><span class="hs-special">)</span><span class="hs-special">)</span><span> </span><span id="local-6989586621680990597"><span class="annot"><span class="annottext">SubDemand
</span><a href="#local-6989586621680990597"><span class="hs-identifier hs-var">sd</span></a></span></span><span>
</span><span id="line-1533"></span><span>  </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">Card -&gt; DmdType -&gt; DmdType
</span><a href="GHC.Types.Demand.html#multDmdType"><span class="hs-identifier hs-var">multDmdType</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Int -&gt; SubDemand -&gt; Card
</span><a href="GHC.Types.Demand.html#peelManyCalls"><span class="hs-identifier hs-var">peelManyCalls</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">forall (t :: * -&gt; *) a. Foldable t =&gt; t a -&gt; Int
</span><a href="../../base-4.16.4.0/src/Data-Foldable.html#length"><span class="hs-identifier hs-var">length</span></a></span><span> </span><span class="annot"><span class="annottext">[Demand]
</span><a href="#local-6989586621680990598"><span class="hs-identifier hs-var">arg_ds</span></a></span><span class="hs-special">)</span><span> </span><span class="annot"><span class="annottext">SubDemand
</span><a href="#local-6989586621680990597"><span class="hs-identifier hs-var">sd</span></a></span><span class="hs-special">)</span><span> </span><span class="annot"><span class="annottext">DmdType
</span><a href="#local-6989586621680990599"><span class="hs-identifier hs-var">dmd_ty</span></a></span><span>
</span><span id="line-1534"></span><span>    </span><span class="hs-comment">-- see Note [Demands from unsaturated function calls]</span><span>
</span><span id="line-1535"></span><span>    </span><span class="hs-comment">-- and Note [What are demand signatures?]</span><span>
</span><span id="line-1536"></span><span>
</span><span id="line-1537"></span><span class="hs-comment">-- | A special 'DmdTransformer' for data constructors that feeds product</span><span>
</span><span id="line-1538"></span><span class="hs-comment">-- demands into the constructor arguments.</span><span>
</span><span id="line-1539"></span><span class="annot"><a href="GHC.Types.Demand.html#dmdTransformDataConSig"><span class="hs-identifier hs-type">dmdTransformDataConSig</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><a href="GHC.Types.Basic.html#Arity"><span class="hs-identifier hs-type">Arity</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="GHC.Types.Demand.html#DmdTransformer"><span class="hs-identifier hs-type">DmdTransformer</span></a></span><span>
</span><span id="line-1540"></span><span id="dmdTransformDataConSig"><span class="annot"><span class="annottext">dmdTransformDataConSig :: Int -&gt; DmdTransformer
</span><a href="GHC.Types.Demand.html#dmdTransformDataConSig"><span class="hs-identifier hs-var hs-var">dmdTransformDataConSig</span></a></span></span><span> </span><span id="local-6989586621680990596"><span class="annot"><span class="annottext">Int
</span><a href="#local-6989586621680990596"><span class="hs-identifier hs-var">arity</span></a></span></span><span> </span><span id="local-6989586621680990595"><span class="annot"><span class="annottext">SubDemand
</span><a href="#local-6989586621680990595"><span class="hs-identifier hs-var">sd</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-keyword">case</span><span> </span><span class="annot"><span class="annottext">Int -&gt; SubDemand -&gt; Maybe [Demand]
</span><a href="#local-6989586621680990594"><span class="hs-identifier hs-var">go</span></a></span><span> </span><span class="annot"><span class="annottext">Int
</span><a href="#local-6989586621680990596"><span class="hs-identifier hs-var">arity</span></a></span><span> </span><span class="annot"><span class="annottext">SubDemand
</span><a href="#local-6989586621680990595"><span class="hs-identifier hs-var">sd</span></a></span><span> </span><span class="hs-keyword">of</span><span>
</span><span id="line-1541"></span><span>  </span><span class="annot"><a href="../../base-4.16.4.0/src/GHC-Maybe.html#Just"><span class="hs-identifier hs-type">Just</span></a></span><span> </span><span id="local-6989586621680990593"><span class="annot"><span class="annottext">[Demand]
</span><a href="#local-6989586621680990593"><span class="hs-identifier hs-var">dmds</span></a></span></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="annottext">DmdEnv -&gt; [Demand] -&gt; Divergence -&gt; DmdType
</span><a href="GHC.Types.Demand.html#DmdType"><span class="hs-identifier hs-var">DmdType</span></a></span><span> </span><span class="annot"><span class="annottext">DmdEnv
</span><a href="GHC.Types.Demand.html#emptyDmdEnv"><span class="hs-identifier hs-var">emptyDmdEnv</span></a></span><span> </span><span class="annot"><span class="annottext">[Demand]
</span><a href="#local-6989586621680990593"><span class="hs-identifier hs-var">dmds</span></a></span><span> </span><span class="annot"><span class="annottext">Divergence
</span><a href="GHC.Types.Demand.html#topDiv"><span class="hs-identifier hs-var">topDiv</span></a></span><span>
</span><span id="line-1542"></span><span>  </span><span class="annot"><span class="annottext">Maybe [Demand]
</span><a href="../../base-4.16.4.0/src/GHC-Maybe.html#Nothing"><span class="hs-identifier hs-var">Nothing</span></a></span><span>   </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="annottext">DmdType
</span><a href="GHC.Types.Demand.html#nopDmdType"><span class="hs-identifier hs-var">nopDmdType</span></a></span><span> </span><span class="hs-comment">-- Not saturated</span><span>
</span><span id="line-1543"></span><span>  </span><span class="hs-keyword">where</span><span>
</span><span id="line-1544"></span><span>    </span><span id="local-6989586621680990594"><span class="annot"><span class="annottext">go :: Int -&gt; SubDemand -&gt; Maybe [Demand]
</span><a href="#local-6989586621680990594"><span class="hs-identifier hs-var hs-var">go</span></a></span></span><span> </span><span class="annot"><span class="annottext">Int
</span><span class="hs-number">0</span></span><span> </span><span id="local-6989586621680990592"><span class="annot"><span class="annottext">SubDemand
</span><a href="#local-6989586621680990592"><span class="hs-identifier hs-var">sd</span></a></span></span><span>                            </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">Int -&gt; SubDemand -&gt; Maybe [Demand]
</span><a href="GHC.Types.Demand.html#viewProd"><span class="hs-identifier hs-var">viewProd</span></a></span><span> </span><span class="annot"><span class="annottext">Int
</span><a href="#local-6989586621680990596"><span class="hs-identifier hs-var">arity</span></a></span><span> </span><span class="annot"><span class="annottext">SubDemand
</span><a href="#local-6989586621680990592"><span class="hs-identifier hs-var">sd</span></a></span><span>
</span><span id="line-1545"></span><span>    </span><span class="annot"><a href="#local-6989586621680990594"><span class="hs-identifier hs-var">go</span></a></span><span> </span><span id="local-6989586621680990591"><span class="annot"><span class="annottext">Int
</span><a href="#local-6989586621680990591"><span class="hs-identifier hs-var">n</span></a></span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">SubDemand -&gt; Maybe (Card, SubDemand)
</span><a href="GHC.Types.Demand.html#viewCall"><span class="hs-identifier hs-var">viewCall</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="../../base-4.16.4.0/src/GHC-Maybe.html#Just"><span class="hs-identifier hs-type">Just</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Card
</span><a href="GHC.Types.Demand.html#C_11"><span class="hs-identifier hs-var">C_11</span></a></span><span class="hs-special">,</span><span> </span><span id="local-6989586621680990590"><span class="annot"><span class="annottext">SubDemand
</span><a href="#local-6989586621680990590"><span class="hs-identifier hs-var">sd</span></a></span></span><span class="hs-special">)</span><span class="hs-special">)</span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">Int -&gt; SubDemand -&gt; Maybe [Demand]
</span><a href="#local-6989586621680990594"><span class="hs-identifier hs-var">go</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Int
</span><a href="#local-6989586621680990591"><span class="hs-identifier hs-var">n</span></a></span><span class="annot"><span class="annottext">forall a. Num a =&gt; a -&gt; a -&gt; a
</span><a href="../../base-4.16.4.0/src/GHC-Num.html#-"><span class="hs-glyph hs-var">-</span></a></span><span class="annot"><span class="annottext">Int
</span><span class="hs-number">1</span></span><span class="hs-special">)</span><span> </span><span class="annot"><span class="annottext">SubDemand
</span><a href="#local-6989586621680990590"><span class="hs-identifier hs-var">sd</span></a></span><span>  </span><span class="hs-comment">-- strict calls only!</span><span>
</span><span id="line-1546"></span><span>    </span><span class="annot"><a href="#local-6989586621680990594"><span class="hs-identifier hs-var">go</span></a></span><span> </span><span class="annot"><span class="annottext">Int
</span><span class="hs-identifier">_</span></span><span> </span><span class="annot"><span class="annottext">SubDemand
</span><span class="hs-identifier">_</span></span><span>                             </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">forall a. Maybe a
</span><a href="../../base-4.16.4.0/src/GHC-Maybe.html#Nothing"><span class="hs-identifier hs-var">Nothing</span></a></span><span>
</span><span id="line-1547"></span><span>
</span><span id="line-1548"></span><span class="hs-comment">-- | A special 'DmdTransformer' for dictionary selectors that feeds the demand</span><span>
</span><span id="line-1549"></span><span class="hs-comment">-- on the result into the indicated dictionary component (if saturated).</span><span>
</span><span id="line-1550"></span><span class="annot"><a href="GHC.Types.Demand.html#dmdTransformDictSelSig"><span class="hs-identifier hs-type">dmdTransformDictSelSig</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><a href="GHC.Types.Demand.html#StrictSig"><span class="hs-identifier hs-type">StrictSig</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="GHC.Types.Demand.html#DmdTransformer"><span class="hs-identifier hs-type">DmdTransformer</span></a></span><span>
</span><span id="line-1551"></span><span class="hs-comment">-- NB: This currently doesn't handle newtype dictionaries and it's unclear how</span><span>
</span><span id="line-1552"></span><span class="hs-comment">-- it could without additional parameters.</span><span>
</span><span id="line-1553"></span><span id="dmdTransformDictSelSig"><span class="annot"><span class="annottext">dmdTransformDictSelSig :: StrictSig -&gt; DmdTransformer
</span><a href="GHC.Types.Demand.html#dmdTransformDictSelSig"><span class="hs-identifier hs-var hs-var">dmdTransformDictSelSig</span></a></span></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="GHC.Types.Demand.html#StrictSig"><span class="hs-identifier hs-type">StrictSig</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="GHC.Types.Demand.html#DmdType"><span class="hs-identifier hs-type">DmdType</span></a></span><span> </span><span class="annot"><span class="annottext">DmdEnv
</span><span class="hs-identifier">_</span></span><span> </span><span class="hs-special">[</span><span class="hs-special">(</span><span class="annot"><span class="annottext">Card
</span><span class="hs-identifier">_</span></span><span> </span><span class="annot"><a href="GHC.Types.Demand.html#%3A%2A"><span class="hs-operator hs-type">:*</span></a></span><span> </span><span id="local-6989586621680990589"><span class="annot"><span class="annottext">SubDemand
</span><a href="#local-6989586621680990589"><span class="hs-identifier hs-var">sig_sd</span></a></span></span><span class="hs-special">)</span><span class="hs-special">]</span><span> </span><span class="annot"><span class="annottext">Divergence
</span><span class="hs-identifier">_</span></span><span class="hs-special">)</span><span class="hs-special">)</span><span> </span><span id="local-6989586621680990588"><span class="annot"><span class="annottext">SubDemand
</span><a href="#local-6989586621680990588"><span class="hs-identifier hs-var">call_sd</span></a></span></span><span>
</span><span id="line-1554"></span><span>   </span><span class="hs-glyph">|</span><span> </span><span class="hs-special">(</span><span id="local-6989586621680990587"><span class="annot"><span class="annottext">Card
</span><a href="#local-6989586621680990587"><span class="hs-identifier hs-var">n</span></a></span></span><span class="hs-special">,</span><span> </span><span id="local-6989586621680990586"><span class="annot"><span class="annottext">SubDemand
</span><a href="#local-6989586621680990586"><span class="hs-identifier hs-var">sd'</span></a></span></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">SubDemand -&gt; (Card, SubDemand)
</span><a href="GHC.Types.Demand.html#peelCallDmd"><span class="hs-identifier hs-var">peelCallDmd</span></a></span><span> </span><span class="annot"><span class="annottext">SubDemand
</span><a href="#local-6989586621680990588"><span class="hs-identifier hs-var">call_sd</span></a></span><span>
</span><span id="line-1555"></span><span>   </span><span class="hs-special">,</span><span> </span><span class="annot"><a href="GHC.Types.Demand.html#Prod"><span class="hs-identifier hs-type">Prod</span></a></span><span> </span><span id="local-6989586621680990585"><span class="annot"><span class="annottext">[Demand]
</span><a href="#local-6989586621680990585"><span class="hs-identifier hs-var">sig_ds</span></a></span></span><span>  </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">SubDemand
</span><a href="#local-6989586621680990589"><span class="hs-identifier hs-var">sig_sd</span></a></span><span>
</span><span id="line-1556"></span><span>   </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">Card -&gt; DmdType -&gt; DmdType
</span><a href="GHC.Types.Demand.html#multDmdType"><span class="hs-identifier hs-var">multDmdType</span></a></span><span> </span><span class="annot"><span class="annottext">Card
</span><a href="#local-6989586621680990587"><span class="hs-identifier hs-var">n</span></a></span><span> </span><span class="annot"><span class="annottext">forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><a href="../../base-4.16.4.0/src/GHC-Base.html#%24"><span class="hs-operator hs-var">$</span></a></span><span>
</span><span id="line-1557"></span><span>     </span><span class="annot"><span class="annottext">DmdEnv -&gt; [Demand] -&gt; Divergence -&gt; DmdType
</span><a href="GHC.Types.Demand.html#DmdType"><span class="hs-identifier hs-var">DmdType</span></a></span><span> </span><span class="annot"><span class="annottext">DmdEnv
</span><a href="GHC.Types.Demand.html#emptyDmdEnv"><span class="hs-identifier hs-var">emptyDmdEnv</span></a></span><span> </span><span class="hs-special">[</span><span class="annot"><span class="annottext">Card
</span><a href="GHC.Types.Demand.html#C_11"><span class="hs-identifier hs-var">C_11</span></a></span><span> </span><span class="annot"><span class="annottext">Card -&gt; SubDemand -&gt; Demand
</span><a href="GHC.Types.Demand.html#%3A%2A"><span class="hs-operator hs-var">:*</span></a></span><span> </span><span class="annot"><span class="annottext">[Demand] -&gt; SubDemand
</span><a href="GHC.Types.Demand.html#Prod"><span class="hs-identifier hs-var">Prod</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">forall a b. (a -&gt; b) -&gt; [a] -&gt; [b]
</span><a href="../../base-4.16.4.0/src/GHC-Base.html#map"><span class="hs-identifier hs-var">map</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">SubDemand -&gt; Demand -&gt; Demand
</span><a href="#local-6989586621680990584"><span class="hs-identifier hs-var">enhance</span></a></span><span> </span><span class="annot"><span class="annottext">SubDemand
</span><a href="#local-6989586621680990586"><span class="hs-identifier hs-var">sd'</span></a></span><span class="hs-special">)</span><span> </span><span class="annot"><span class="annottext">[Demand]
</span><a href="#local-6989586621680990585"><span class="hs-identifier hs-var">sig_ds</span></a></span><span class="hs-special">)</span><span class="hs-special">]</span><span> </span><span class="annot"><span class="annottext">Divergence
</span><a href="GHC.Types.Demand.html#topDiv"><span class="hs-identifier hs-var">topDiv</span></a></span><span>
</span><span id="line-1558"></span><span>   </span><span class="hs-glyph">|</span><span> </span><span class="annot"><span class="annottext">Bool
</span><a href="../../base-4.16.4.0/src/GHC-Base.html#otherwise"><span class="hs-identifier hs-var">otherwise</span></a></span><span>
</span><span id="line-1559"></span><span>   </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">DmdType
</span><a href="GHC.Types.Demand.html#nopDmdType"><span class="hs-identifier hs-var">nopDmdType</span></a></span><span> </span><span class="hs-comment">-- See Note [Demand transformer for a dictionary selector]</span><span>
</span><span id="line-1560"></span><span>  </span><span class="hs-keyword">where</span><span>
</span><span id="line-1561"></span><span>    </span><span id="local-6989586621680990584"><span class="annot"><span class="annottext">enhance :: SubDemand -&gt; Demand -&gt; Demand
</span><a href="#local-6989586621680990584"><span class="hs-identifier hs-var hs-var">enhance</span></a></span></span><span> </span><span id="local-6989586621680990583"><span class="annot"><span class="annottext">SubDemand
</span><a href="#local-6989586621680990583"><span class="hs-identifier hs-var">sd</span></a></span></span><span> </span><span id="local-6989586621680990582"><span class="annot"><span class="annottext">Demand
</span><a href="#local-6989586621680990582"><span class="hs-identifier hs-var">old</span></a></span></span><span> </span><span class="hs-glyph">|</span><span> </span><span class="annot"><span class="annottext">Demand -&gt; Bool
</span><a href="GHC.Types.Demand.html#isAbsDmd"><span class="hs-identifier hs-var">isAbsDmd</span></a></span><span> </span><span class="annot"><span class="annottext">Demand
</span><a href="#local-6989586621680990582"><span class="hs-identifier hs-var">old</span></a></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">Demand
</span><a href="#local-6989586621680990582"><span class="hs-identifier hs-var">old</span></a></span><span>
</span><span id="line-1562"></span><span>                   </span><span class="hs-glyph">|</span><span> </span><span class="annot"><span class="annottext">Bool
</span><a href="../../base-4.16.4.0/src/GHC-Base.html#otherwise"><span class="hs-identifier hs-var">otherwise</span></a></span><span>    </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">Card
</span><a href="GHC.Types.Demand.html#C_11"><span class="hs-identifier hs-var">C_11</span></a></span><span> </span><span class="annot"><span class="annottext">Card -&gt; SubDemand -&gt; Demand
</span><a href="GHC.Types.Demand.html#%3A%2A"><span class="hs-operator hs-var">:*</span></a></span><span> </span><span class="annot"><span class="annottext">SubDemand
</span><a href="#local-6989586621680990583"><span class="hs-identifier hs-var">sd</span></a></span><span>  </span><span class="hs-comment">-- This is the one!</span><span>
</span><span id="line-1563"></span><span>
</span><span id="line-1564"></span><span class="annot"><a href="GHC.Types.Demand.html#dmdTransformDictSelSig"><span class="hs-identifier hs-var">dmdTransformDictSelSig</span></a></span><span> </span><span id="local-6989586621680990581"><span class="annot"><span class="annottext">StrictSig
</span><a href="#local-6989586621680990581"><span class="hs-identifier hs-var">sig</span></a></span></span><span> </span><span id="local-6989586621680990580"><span class="annot"><span class="annottext">SubDemand
</span><a href="#local-6989586621680990580"><span class="hs-identifier hs-var">sd</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">forall a. HasCallStack =&gt; String -&gt; SDoc -&gt; a
</span><a href="GHC.Utils.Panic.html#pprPanic"><span class="hs-identifier hs-var">pprPanic</span></a></span><span> </span><span class="annot"><span class="annottext">String
</span><span class="hs-string">&quot;dmdTransformDictSelSig: no args&quot;</span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">forall a. Outputable a =&gt; a -&gt; SDoc
</span><a href="GHC.Utils.Outputable.html#ppr"><span class="hs-identifier hs-var">ppr</span></a></span><span> </span><span class="annot"><span class="annottext">StrictSig
</span><a href="#local-6989586621680990581"><span class="hs-identifier hs-var">sig</span></a></span><span> </span><span class="annot"><span class="annottext">SDoc -&gt; SDoc -&gt; SDoc
</span><a href="GHC.Utils.Outputable.html#%24%24"><span class="hs-operator hs-var">$$</span></a></span><span> </span><span class="annot"><span class="annottext">forall a. Outputable a =&gt; a -&gt; SDoc
</span><a href="GHC.Utils.Outputable.html#ppr"><span class="hs-identifier hs-var">ppr</span></a></span><span> </span><span class="annot"><span class="annottext">SubDemand
</span><a href="#local-6989586621680990580"><span class="hs-identifier hs-var">sd</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-1565"></span><span>
</span><span id="line-1566"></span><span class="hs-comment">{-
Note [What are demand signatures?]
~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~
Demand analysis interprets expressions in the abstract domain of demand
transformers. Given a (sub-)demand that denotes the evaluation context, the
abstract transformer of an expression gives us back a demand type denoting
how other things (like arguments and free vars) were used when the expression
was evaluated. Here's an example:

  f x y =
    if x + expensive
      then \z -&gt; z + y * ...
      else \z -&gt; z * ...

The abstract transformer (let's call it F_e) of the if expression (let's
call it e) would transform an incoming (undersaturated!) head demand 1A into
a demand type like {x-&gt;&lt;1L&gt;,y-&gt;&lt;L&gt;}&lt;L&gt;. In pictures:

     Demand ---F_e---&gt; DmdType
     &lt;1A&gt;              {x-&gt;&lt;1L&gt;,y-&gt;&lt;L&gt;}&lt;L&gt;

Let's assume that the demand transformers we compute for an expression are
correct wrt. to some concrete semantics for Core. How do demand signatures fit
in? They are strange beasts, given that they come with strict rules when to
it's sound to unleash them.

Fortunately, we can formalise the rules with Galois connections. Consider
f's strictness signature, {}&lt;1L&gt;&lt;L&gt;. It's a single-point approximation of
the actual abstract transformer of f's RHS for arity 2. So, what happens is that
we abstract *once more* from the abstract domain we already are in, replacing
the incoming Demand by a simple lattice with two elements denoting incoming
arity: A_2 = {&lt;2, &gt;=2} (where '&lt;2' is the top element and &gt;=2 the bottom
element). Here's the diagram:

     A_2 -----f_f----&gt; DmdType
      ^                   |
      | &#945;               &#947; |
      |                   v
  SubDemand --F_f----&gt; DmdType

With
  &#945;(C1(C1(_))) = &gt;=2
  &#945;(_)         =  &lt;2
  &#947;(ty)        =  ty
and F_f being the abstract transformer of f's RHS and f_f being the abstracted
abstract transformer computable from our demand signature simply by

  f_f(&gt;=2) = {}&lt;1L&gt;&lt;L&gt;
  f_f(&lt;2)  = multDmdType C_0N {}&lt;1L&gt;&lt;L&gt;

where multDmdType makes a proper top element out of the given demand type.

In practice, the A_n domain is not just a simple Bool, but a Card, which is
exactly the Card with which we have to multDmdType. The Card for arity n
is computed by calling @peelManyCalls n@, which corresponds to &#945; above.

Note [Demand transformer for a dictionary selector]
~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~
If we evaluate (op dict-expr) under demand 'd', then we can push the demand 'd'
into the appropriate field of the dictionary. What *is* the appropriate field?
We just look at the strictness signature of the class op, which will be
something like: P(AAA1AAAAA).  Then replace the '1' by the demand 'd'.

For single-method classes, which are represented by newtypes the signature
of 'op' won't look like P(...), so matching on Prod will fail.
That's fine: if we are doing strictness analysis we are also doing inlining,
so we'll have inlined 'op' into a cast.  So we can bale out in a conservative
way, returning nopDmdType.

It is (just.. #8329) possible to be running strictness analysis *without*
having inlined class ops from single-method classes.  Suppose you are using
ghc --make; and the first module has a local -O0 flag.  So you may load a class
without interface pragmas, ie (currently) without an unfolding for the class
ops.   Now if a subsequent module in the --make sweep has a local -O flag
you might do strictness analysis, but there is no inlining for the class op.
This is weird, so I'm not worried about whether this optimises brilliantly; but
it should not fall over.
-}</span><span>
</span><span id="line-1644"></span><span>
</span><span id="line-1645"></span><span class="hs-comment">-- | Remove the demand environment from the signature.</span><span>
</span><span id="line-1646"></span><span class="annot"><a href="GHC.Types.Demand.html#zapDmdEnvSig"><span class="hs-identifier hs-type">zapDmdEnvSig</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><a href="GHC.Types.Demand.html#StrictSig"><span class="hs-identifier hs-type">StrictSig</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="GHC.Types.Demand.html#StrictSig"><span class="hs-identifier hs-type">StrictSig</span></a></span><span>
</span><span id="line-1647"></span><span id="zapDmdEnvSig"><span class="annot"><span class="annottext">zapDmdEnvSig :: StrictSig -&gt; StrictSig
</span><a href="GHC.Types.Demand.html#zapDmdEnvSig"><span class="hs-identifier hs-var hs-var">zapDmdEnvSig</span></a></span></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="GHC.Types.Demand.html#StrictSig"><span class="hs-identifier hs-type">StrictSig</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="GHC.Types.Demand.html#DmdType"><span class="hs-identifier hs-type">DmdType</span></a></span><span> </span><span class="annot"><span class="annottext">DmdEnv
</span><span class="hs-identifier">_</span></span><span> </span><span id="local-6989586621680990579"><span class="annot"><span class="annottext">[Demand]
</span><a href="#local-6989586621680990579"><span class="hs-identifier hs-var">ds</span></a></span></span><span> </span><span id="local-6989586621680990578"><span class="annot"><span class="annottext">Divergence
</span><a href="#local-6989586621680990578"><span class="hs-identifier hs-var">r</span></a></span></span><span class="hs-special">)</span><span class="hs-special">)</span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">[Demand] -&gt; Divergence -&gt; StrictSig
</span><a href="GHC.Types.Demand.html#mkClosedStrictSig"><span class="hs-identifier hs-var">mkClosedStrictSig</span></a></span><span> </span><span class="annot"><span class="annottext">[Demand]
</span><a href="#local-6989586621680990579"><span class="hs-identifier hs-var">ds</span></a></span><span> </span><span class="annot"><span class="annottext">Divergence
</span><a href="#local-6989586621680990578"><span class="hs-identifier hs-var">r</span></a></span><span>
</span><span id="line-1648"></span><span>
</span><span id="line-1649"></span><span class="annot"><a href="GHC.Types.Demand.html#zapUsageDemand"><span class="hs-identifier hs-type">zapUsageDemand</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><a href="GHC.Types.Demand.html#Demand"><span class="hs-identifier hs-type">Demand</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="GHC.Types.Demand.html#Demand"><span class="hs-identifier hs-type">Demand</span></a></span><span>
</span><span id="line-1650"></span><span class="hs-comment">-- Remove the usage info, but not the strictness info, from the demand</span><span>
</span><span id="line-1651"></span><span id="zapUsageDemand"><span class="annot"><span class="annottext">zapUsageDemand :: Demand -&gt; Demand
</span><a href="GHC.Types.Demand.html#zapUsageDemand"><span class="hs-identifier hs-var hs-var">zapUsageDemand</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">KillFlags -&gt; Demand -&gt; Demand
</span><a href="GHC.Types.Demand.html#kill_usage"><span class="hs-identifier hs-var">kill_usage</span></a></span><span> </span><span class="annot"><span class="annottext">forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><a href="../../base-4.16.4.0/src/GHC-Base.html#%24"><span class="hs-operator hs-var">$</span></a></span><span> </span><span class="annot"><a href="GHC.Types.Demand.html#KillFlags"><span class="hs-identifier hs-type">KillFlags</span></a></span><span>
</span><span id="line-1652"></span><span>    </span><span class="hs-special">{</span><span> </span><span class="annot"><span class="annottext">kf_abs :: Bool
</span><a href="GHC.Types.Demand.html#kf_abs"><span class="hs-identifier hs-var">kf_abs</span></a></span><span>         </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">Bool
</span><span class="hs-identifier hs-var">True</span></span><span>
</span><span id="line-1653"></span><span>    </span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">kf_used_once :: Bool
</span><a href="GHC.Types.Demand.html#kf_used_once"><span class="hs-identifier hs-var">kf_used_once</span></a></span><span>   </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">Bool
</span><span class="hs-identifier hs-var">True</span></span><span>
</span><span id="line-1654"></span><span>    </span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">kf_called_once :: Bool
</span><a href="GHC.Types.Demand.html#kf_called_once"><span class="hs-identifier hs-var">kf_called_once</span></a></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">Bool
</span><span class="hs-identifier hs-var">True</span></span><span>
</span><span id="line-1655"></span><span>    </span><span class="hs-special">}</span><span>
</span><span id="line-1656"></span><span>
</span><span id="line-1657"></span><span class="hs-comment">-- | Remove all `C_01 :*` info (but not `CM` sub-demands) from the demand</span><span>
</span><span id="line-1658"></span><span class="annot"><a href="GHC.Types.Demand.html#zapUsedOnceDemand"><span class="hs-identifier hs-type">zapUsedOnceDemand</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><a href="GHC.Types.Demand.html#Demand"><span class="hs-identifier hs-type">Demand</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="GHC.Types.Demand.html#Demand"><span class="hs-identifier hs-type">Demand</span></a></span><span>
</span><span id="line-1659"></span><span id="zapUsedOnceDemand"><span class="annot"><span class="annottext">zapUsedOnceDemand :: Demand -&gt; Demand
</span><a href="GHC.Types.Demand.html#zapUsedOnceDemand"><span class="hs-identifier hs-var hs-var">zapUsedOnceDemand</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">KillFlags -&gt; Demand -&gt; Demand
</span><a href="GHC.Types.Demand.html#kill_usage"><span class="hs-identifier hs-var">kill_usage</span></a></span><span> </span><span class="annot"><span class="annottext">forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><a href="../../base-4.16.4.0/src/GHC-Base.html#%24"><span class="hs-operator hs-var">$</span></a></span><span> </span><span class="annot"><a href="GHC.Types.Demand.html#KillFlags"><span class="hs-identifier hs-type">KillFlags</span></a></span><span>
</span><span id="line-1660"></span><span>    </span><span class="hs-special">{</span><span> </span><span class="annot"><span class="annottext">kf_abs :: Bool
</span><a href="GHC.Types.Demand.html#kf_abs"><span class="hs-identifier hs-var">kf_abs</span></a></span><span>         </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">Bool
</span><span class="hs-identifier hs-var">False</span></span><span>
</span><span id="line-1661"></span><span>    </span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">kf_used_once :: Bool
</span><a href="GHC.Types.Demand.html#kf_used_once"><span class="hs-identifier hs-var">kf_used_once</span></a></span><span>   </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">Bool
</span><span class="hs-identifier hs-var">True</span></span><span>
</span><span id="line-1662"></span><span>    </span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">kf_called_once :: Bool
</span><a href="GHC.Types.Demand.html#kf_called_once"><span class="hs-identifier hs-var">kf_called_once</span></a></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">Bool
</span><span class="hs-identifier hs-var">False</span></span><span>
</span><span id="line-1663"></span><span>    </span><span class="hs-special">}</span><span>
</span><span id="line-1664"></span><span>
</span><span id="line-1665"></span><span class="hs-comment">-- | Remove all `C_01 :*` info (but not `CM` sub-demands) from the strictness</span><span>
</span><span id="line-1666"></span><span class="hs-comment">--   signature</span><span>
</span><span id="line-1667"></span><span class="annot"><a href="GHC.Types.Demand.html#zapUsedOnceSig"><span class="hs-identifier hs-type">zapUsedOnceSig</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><a href="GHC.Types.Demand.html#StrictSig"><span class="hs-identifier hs-type">StrictSig</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="GHC.Types.Demand.html#StrictSig"><span class="hs-identifier hs-type">StrictSig</span></a></span><span>
</span><span id="line-1668"></span><span id="zapUsedOnceSig"><span class="annot"><span class="annottext">zapUsedOnceSig :: StrictSig -&gt; StrictSig
</span><a href="GHC.Types.Demand.html#zapUsedOnceSig"><span class="hs-identifier hs-var hs-var">zapUsedOnceSig</span></a></span></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="GHC.Types.Demand.html#StrictSig"><span class="hs-identifier hs-type">StrictSig</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="GHC.Types.Demand.html#DmdType"><span class="hs-identifier hs-type">DmdType</span></a></span><span> </span><span id="local-6989586621680990572"><span class="annot"><span class="annottext">DmdEnv
</span><a href="#local-6989586621680990572"><span class="hs-identifier hs-var">env</span></a></span></span><span> </span><span id="local-6989586621680990571"><span class="annot"><span class="annottext">[Demand]
</span><a href="#local-6989586621680990571"><span class="hs-identifier hs-var">ds</span></a></span></span><span> </span><span id="local-6989586621680990570"><span class="annot"><span class="annottext">Divergence
</span><a href="#local-6989586621680990570"><span class="hs-identifier hs-var">r</span></a></span></span><span class="hs-special">)</span><span class="hs-special">)</span><span>
</span><span id="line-1669"></span><span>    </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">DmdType -&gt; StrictSig
</span><a href="GHC.Types.Demand.html#StrictSig"><span class="hs-identifier hs-var">StrictSig</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">DmdEnv -&gt; [Demand] -&gt; Divergence -&gt; DmdType
</span><a href="GHC.Types.Demand.html#DmdType"><span class="hs-identifier hs-var">DmdType</span></a></span><span> </span><span class="annot"><span class="annottext">DmdEnv
</span><a href="#local-6989586621680990572"><span class="hs-identifier hs-var">env</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">forall a b. (a -&gt; b) -&gt; [a] -&gt; [b]
</span><a href="../../base-4.16.4.0/src/GHC-Base.html#map"><span class="hs-identifier hs-var">map</span></a></span><span> </span><span class="annot"><span class="annottext">Demand -&gt; Demand
</span><a href="GHC.Types.Demand.html#zapUsedOnceDemand"><span class="hs-identifier hs-var">zapUsedOnceDemand</span></a></span><span> </span><span class="annot"><span class="annottext">[Demand]
</span><a href="#local-6989586621680990571"><span class="hs-identifier hs-var">ds</span></a></span><span class="hs-special">)</span><span> </span><span class="annot"><span class="annottext">Divergence
</span><a href="#local-6989586621680990570"><span class="hs-identifier hs-var">r</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-1670"></span><span>
</span><span id="line-1671"></span><span class="hs-keyword">data</span><span> </span><span id="KillFlags"><span class="annot"><a href="GHC.Types.Demand.html#KillFlags"><span class="hs-identifier hs-var">KillFlags</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span id="KillFlags"><span class="annot"><a href="GHC.Types.Demand.html#KillFlags"><span class="hs-identifier hs-var">KillFlags</span></a></span></span><span>
</span><span id="line-1672"></span><span>    </span><span class="hs-special">{</span><span> </span><span id="kf_abs"><span class="annot"><span class="annottext">KillFlags -&gt; Bool
</span><a href="GHC.Types.Demand.html#kf_abs"><span class="hs-identifier hs-var hs-var">kf_abs</span></a></span></span><span>         </span><span class="hs-glyph">::</span><span> </span><span class="annot"><span class="hs-identifier hs-type">Bool</span></span><span>
</span><span id="line-1673"></span><span>    </span><span class="hs-special">,</span><span> </span><span id="kf_used_once"><span class="annot"><span class="annottext">KillFlags -&gt; Bool
</span><a href="GHC.Types.Demand.html#kf_used_once"><span class="hs-identifier hs-var hs-var">kf_used_once</span></a></span></span><span>   </span><span class="hs-glyph">::</span><span> </span><span class="annot"><span class="hs-identifier hs-type">Bool</span></span><span>
</span><span id="line-1674"></span><span>    </span><span class="hs-special">,</span><span> </span><span id="kf_called_once"><span class="annot"><span class="annottext">KillFlags -&gt; Bool
</span><a href="GHC.Types.Demand.html#kf_called_once"><span class="hs-identifier hs-var hs-var">kf_called_once</span></a></span></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><span class="hs-identifier hs-type">Bool</span></span><span>
</span><span id="line-1675"></span><span>    </span><span class="hs-special">}</span><span>
</span><span id="line-1676"></span><span>
</span><span id="line-1677"></span><span class="annot"><a href="GHC.Types.Demand.html#kill_usage_card"><span class="hs-identifier hs-type">kill_usage_card</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><a href="GHC.Types.Demand.html#KillFlags"><span class="hs-identifier hs-type">KillFlags</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="GHC.Types.Demand.html#Card"><span class="hs-identifier hs-type">Card</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="GHC.Types.Demand.html#Card"><span class="hs-identifier hs-type">Card</span></a></span><span>
</span><span id="line-1678"></span><span id="kill_usage_card"><span class="annot"><span class="annottext">kill_usage_card :: KillFlags -&gt; Card -&gt; Card
</span><a href="GHC.Types.Demand.html#kill_usage_card"><span class="hs-identifier hs-var hs-var">kill_usage_card</span></a></span></span><span> </span><span id="local-6989586621680990568"><span class="annot"><span class="annottext">KillFlags
</span><a href="#local-6989586621680990568"><span class="hs-identifier hs-var">kfs</span></a></span></span><span> </span><span class="annot"><span class="annottext">Card
</span><a href="GHC.Types.Demand.html#C_00"><span class="hs-identifier hs-var">C_00</span></a></span><span> </span><span class="hs-glyph">|</span><span> </span><span class="annot"><span class="annottext">KillFlags -&gt; Bool
</span><a href="GHC.Types.Demand.html#kf_abs"><span class="hs-identifier hs-var">kf_abs</span></a></span><span> </span><span class="annot"><span class="annottext">KillFlags
</span><a href="#local-6989586621680990568"><span class="hs-identifier hs-var">kfs</span></a></span><span>       </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">Card
</span><a href="GHC.Types.Demand.html#C_0N"><span class="hs-identifier hs-var">C_0N</span></a></span><span>
</span><span id="line-1679"></span><span class="annot"><a href="GHC.Types.Demand.html#kill_usage_card"><span class="hs-identifier hs-var">kill_usage_card</span></a></span><span> </span><span id="local-6989586621680990567"><span class="annot"><span class="annottext">KillFlags
</span><a href="#local-6989586621680990567"><span class="hs-identifier hs-var">kfs</span></a></span></span><span> </span><span class="annot"><span class="annottext">Card
</span><a href="GHC.Types.Demand.html#C_10"><span class="hs-identifier hs-var">C_10</span></a></span><span> </span><span class="hs-glyph">|</span><span> </span><span class="annot"><span class="annottext">KillFlags -&gt; Bool
</span><a href="GHC.Types.Demand.html#kf_abs"><span class="hs-identifier hs-var">kf_abs</span></a></span><span> </span><span class="annot"><span class="annottext">KillFlags
</span><a href="#local-6989586621680990567"><span class="hs-identifier hs-var">kfs</span></a></span><span>       </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">Card
</span><a href="GHC.Types.Demand.html#C_1N"><span class="hs-identifier hs-var">C_1N</span></a></span><span>
</span><span id="line-1680"></span><span class="annot"><a href="GHC.Types.Demand.html#kill_usage_card"><span class="hs-identifier hs-var">kill_usage_card</span></a></span><span> </span><span id="local-6989586621680990566"><span class="annot"><span class="annottext">KillFlags
</span><a href="#local-6989586621680990566"><span class="hs-identifier hs-var">kfs</span></a></span></span><span> </span><span class="annot"><span class="annottext">Card
</span><a href="GHC.Types.Demand.html#C_01"><span class="hs-identifier hs-var">C_01</span></a></span><span> </span><span class="hs-glyph">|</span><span> </span><span class="annot"><span class="annottext">KillFlags -&gt; Bool
</span><a href="GHC.Types.Demand.html#kf_used_once"><span class="hs-identifier hs-var">kf_used_once</span></a></span><span> </span><span class="annot"><span class="annottext">KillFlags
</span><a href="#local-6989586621680990566"><span class="hs-identifier hs-var">kfs</span></a></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">Card
</span><a href="GHC.Types.Demand.html#C_0N"><span class="hs-identifier hs-var">C_0N</span></a></span><span>
</span><span id="line-1681"></span><span class="annot"><a href="GHC.Types.Demand.html#kill_usage_card"><span class="hs-identifier hs-var">kill_usage_card</span></a></span><span> </span><span id="local-6989586621680990565"><span class="annot"><span class="annottext">KillFlags
</span><a href="#local-6989586621680990565"><span class="hs-identifier hs-var">kfs</span></a></span></span><span> </span><span class="annot"><span class="annottext">Card
</span><a href="GHC.Types.Demand.html#C_11"><span class="hs-identifier hs-var">C_11</span></a></span><span> </span><span class="hs-glyph">|</span><span> </span><span class="annot"><span class="annottext">KillFlags -&gt; Bool
</span><a href="GHC.Types.Demand.html#kf_used_once"><span class="hs-identifier hs-var">kf_used_once</span></a></span><span> </span><span class="annot"><span class="annottext">KillFlags
</span><a href="#local-6989586621680990565"><span class="hs-identifier hs-var">kfs</span></a></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">Card
</span><a href="GHC.Types.Demand.html#C_1N"><span class="hs-identifier hs-var">C_1N</span></a></span><span>
</span><span id="line-1682"></span><span class="annot"><a href="GHC.Types.Demand.html#kill_usage_card"><span class="hs-identifier hs-var">kill_usage_card</span></a></span><span> </span><span class="annot"><span class="annottext">KillFlags
</span><span class="hs-identifier">_</span></span><span>   </span><span id="local-6989586621680990564"><span class="annot"><span class="annottext">Card
</span><a href="#local-6989586621680990564"><span class="hs-identifier hs-var">n</span></a></span></span><span>                       </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">Card
</span><a href="#local-6989586621680990564"><span class="hs-identifier hs-var">n</span></a></span><span>
</span><span id="line-1683"></span><span>
</span><span id="line-1684"></span><span class="annot"><a href="GHC.Types.Demand.html#kill_usage"><span class="hs-identifier hs-type">kill_usage</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><a href="GHC.Types.Demand.html#KillFlags"><span class="hs-identifier hs-type">KillFlags</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="GHC.Types.Demand.html#Demand"><span class="hs-identifier hs-type">Demand</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="GHC.Types.Demand.html#Demand"><span class="hs-identifier hs-type">Demand</span></a></span><span>
</span><span id="line-1685"></span><span id="kill_usage"><span class="annot"><span class="annottext">kill_usage :: KillFlags -&gt; Demand -&gt; Demand
</span><a href="GHC.Types.Demand.html#kill_usage"><span class="hs-identifier hs-var hs-var">kill_usage</span></a></span></span><span> </span><span id="local-6989586621680990563"><span class="annot"><span class="annottext">KillFlags
</span><a href="#local-6989586621680990563"><span class="hs-identifier hs-var">kfs</span></a></span></span><span> </span><span class="hs-special">(</span><span id="local-6989586621680990562"><span class="annot"><span class="annottext">Card
</span><a href="#local-6989586621680990562"><span class="hs-identifier hs-var">n</span></a></span></span><span> </span><span class="annot"><a href="GHC.Types.Demand.html#%3A%2A"><span class="hs-operator hs-type">:*</span></a></span><span> </span><span id="local-6989586621680990561"><span class="annot"><span class="annottext">SubDemand
</span><a href="#local-6989586621680990561"><span class="hs-identifier hs-var">sd</span></a></span></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">KillFlags -&gt; Card -&gt; Card
</span><a href="GHC.Types.Demand.html#kill_usage_card"><span class="hs-identifier hs-var">kill_usage_card</span></a></span><span> </span><span class="annot"><span class="annottext">KillFlags
</span><a href="#local-6989586621680990563"><span class="hs-identifier hs-var">kfs</span></a></span><span> </span><span class="annot"><span class="annottext">Card
</span><a href="#local-6989586621680990562"><span class="hs-identifier hs-var">n</span></a></span><span> </span><span class="annot"><span class="annottext">Card -&gt; SubDemand -&gt; Demand
</span><a href="GHC.Types.Demand.html#%3A%2A"><span class="hs-operator hs-var">:*</span></a></span><span> </span><span class="annot"><span class="annottext">KillFlags -&gt; SubDemand -&gt; SubDemand
</span><a href="GHC.Types.Demand.html#kill_usage_sd"><span class="hs-identifier hs-var">kill_usage_sd</span></a></span><span> </span><span class="annot"><span class="annottext">KillFlags
</span><a href="#local-6989586621680990563"><span class="hs-identifier hs-var">kfs</span></a></span><span> </span><span class="annot"><span class="annottext">SubDemand
</span><a href="#local-6989586621680990561"><span class="hs-identifier hs-var">sd</span></a></span><span>
</span><span id="line-1686"></span><span>
</span><span id="line-1687"></span><span class="annot"><a href="GHC.Types.Demand.html#kill_usage_sd"><span class="hs-identifier hs-type">kill_usage_sd</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><a href="GHC.Types.Demand.html#KillFlags"><span class="hs-identifier hs-type">KillFlags</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="GHC.Types.Demand.html#SubDemand"><span class="hs-identifier hs-type">SubDemand</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="GHC.Types.Demand.html#SubDemand"><span class="hs-identifier hs-type">SubDemand</span></a></span><span>
</span><span id="line-1688"></span><span id="kill_usage_sd"><span class="annot"><span class="annottext">kill_usage_sd :: KillFlags -&gt; SubDemand -&gt; SubDemand
</span><a href="GHC.Types.Demand.html#kill_usage_sd"><span class="hs-identifier hs-var hs-var">kill_usage_sd</span></a></span></span><span> </span><span id="local-6989586621680990559"><span class="annot"><span class="annottext">KillFlags
</span><a href="#local-6989586621680990559"><span class="hs-identifier hs-var">kfs</span></a></span></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="GHC.Types.Demand.html#Call"><span class="hs-identifier hs-type">Call</span></a></span><span> </span><span id="local-6989586621680990558"><span class="annot"><span class="annottext">Card
</span><a href="#local-6989586621680990558"><span class="hs-identifier hs-var">n</span></a></span></span><span> </span><span id="local-6989586621680990557"><span class="annot"><span class="annottext">SubDemand
</span><a href="#local-6989586621680990557"><span class="hs-identifier hs-var">sd</span></a></span></span><span class="hs-special">)</span><span>
</span><span id="line-1689"></span><span>  </span><span class="hs-glyph">|</span><span> </span><span class="annot"><span class="annottext">KillFlags -&gt; Bool
</span><a href="GHC.Types.Demand.html#kf_called_once"><span class="hs-identifier hs-var">kf_called_once</span></a></span><span> </span><span class="annot"><span class="annottext">KillFlags
</span><a href="#local-6989586621680990559"><span class="hs-identifier hs-var">kfs</span></a></span><span>      </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">Card -&gt; SubDemand -&gt; SubDemand
</span><a href="GHC.Types.Demand.html#mkCall"><span class="hs-identifier hs-var">mkCall</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Card -&gt; Card -&gt; Card
</span><a href="GHC.Types.Demand.html#lubCard"><span class="hs-identifier hs-var">lubCard</span></a></span><span> </span><span class="annot"><span class="annottext">Card
</span><a href="GHC.Types.Demand.html#C_1N"><span class="hs-identifier hs-var">C_1N</span></a></span><span> </span><span class="annot"><span class="annottext">Card
</span><a href="#local-6989586621680990558"><span class="hs-identifier hs-var">n</span></a></span><span class="hs-special">)</span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">KillFlags -&gt; SubDemand -&gt; SubDemand
</span><a href="GHC.Types.Demand.html#kill_usage_sd"><span class="hs-identifier hs-var">kill_usage_sd</span></a></span><span> </span><span class="annot"><span class="annottext">KillFlags
</span><a href="#local-6989586621680990559"><span class="hs-identifier hs-var">kfs</span></a></span><span> </span><span class="annot"><span class="annottext">SubDemand
</span><a href="#local-6989586621680990557"><span class="hs-identifier hs-var">sd</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-1690"></span><span>  </span><span class="hs-glyph">|</span><span> </span><span class="annot"><span class="annottext">Bool
</span><a href="../../base-4.16.4.0/src/GHC-Base.html#otherwise"><span class="hs-identifier hs-var">otherwise</span></a></span><span>               </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">Card -&gt; SubDemand -&gt; SubDemand
</span><a href="GHC.Types.Demand.html#mkCall"><span class="hs-identifier hs-var">mkCall</span></a></span><span> </span><span class="annot"><span class="annottext">Card
</span><a href="#local-6989586621680990558"><span class="hs-identifier hs-var">n</span></a></span><span>                </span><span class="hs-special">(</span><span class="annot"><span class="annottext">KillFlags -&gt; SubDemand -&gt; SubDemand
</span><a href="GHC.Types.Demand.html#kill_usage_sd"><span class="hs-identifier hs-var">kill_usage_sd</span></a></span><span> </span><span class="annot"><span class="annottext">KillFlags
</span><a href="#local-6989586621680990559"><span class="hs-identifier hs-var">kfs</span></a></span><span> </span><span class="annot"><span class="annottext">SubDemand
</span><a href="#local-6989586621680990557"><span class="hs-identifier hs-var">sd</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-1691"></span><span class="annot"><a href="GHC.Types.Demand.html#kill_usage_sd"><span class="hs-identifier hs-var">kill_usage_sd</span></a></span><span> </span><span id="local-6989586621680990556"><span class="annot"><span class="annottext">KillFlags
</span><a href="#local-6989586621680990556"><span class="hs-identifier hs-var">kfs</span></a></span></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="GHC.Types.Demand.html#Prod"><span class="hs-identifier hs-type">Prod</span></a></span><span> </span><span id="local-6989586621680990555"><span class="annot"><span class="annottext">[Demand]
</span><a href="#local-6989586621680990555"><span class="hs-identifier hs-var">ds</span></a></span></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">[Demand] -&gt; SubDemand
</span><a href="GHC.Types.Demand.html#Prod"><span class="hs-identifier hs-var">Prod</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">forall a b. (a -&gt; b) -&gt; [a] -&gt; [b]
</span><a href="../../base-4.16.4.0/src/GHC-Base.html#map"><span class="hs-identifier hs-var">map</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">KillFlags -&gt; Demand -&gt; Demand
</span><a href="GHC.Types.Demand.html#kill_usage"><span class="hs-identifier hs-var">kill_usage</span></a></span><span> </span><span class="annot"><span class="annottext">KillFlags
</span><a href="#local-6989586621680990556"><span class="hs-identifier hs-var">kfs</span></a></span><span class="hs-special">)</span><span> </span><span class="annot"><span class="annottext">[Demand]
</span><a href="#local-6989586621680990555"><span class="hs-identifier hs-var">ds</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-1692"></span><span class="annot"><a href="GHC.Types.Demand.html#kill_usage_sd"><span class="hs-identifier hs-var">kill_usage_sd</span></a></span><span> </span><span class="annot"><span class="annottext">KillFlags
</span><span class="hs-identifier">_</span></span><span>   </span><span id="local-6989586621680990554"><span class="annot"><span class="annottext">SubDemand
</span><a href="#local-6989586621680990554"><span class="hs-identifier hs-var">sd</span></a></span></span><span>        </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">SubDemand
</span><a href="#local-6989586621680990554"><span class="hs-identifier hs-var">sd</span></a></span><span>
</span><span id="line-1693"></span><span>
</span><span id="line-1694"></span><span class="hs-comment">{- *********************************************************************
*                                                                      *
               TypeShape and demand trimming
*                                                                      *
********************************************************************* -}</span><span>
</span><span id="line-1699"></span><span>
</span><span id="line-1700"></span><span>
</span><span id="line-1701"></span><span class="hs-keyword">data</span><span> </span><span id="TypeShape"><span class="annot"><a href="GHC.Types.Demand.html#TypeShape"><span class="hs-identifier hs-var">TypeShape</span></a></span></span><span> </span><span class="hs-comment">-- See Note [Trimming a demand to a type]</span><span>
</span><span id="line-1702"></span><span>               </span><span class="hs-comment">--     in GHC.Core.Opt.DmdAnal</span><span>
</span><span id="line-1703"></span><span>  </span><span class="hs-glyph">=</span><span> </span><span id="TsFun"><span class="annot"><a href="GHC.Types.Demand.html#TsFun"><span class="hs-identifier hs-var">TsFun</span></a></span></span><span> </span><span class="annot"><a href="GHC.Types.Demand.html#TypeShape"><span class="hs-identifier hs-type">TypeShape</span></a></span><span>
</span><span id="line-1704"></span><span>  </span><span class="hs-glyph">|</span><span> </span><span id="TsProd"><span class="annot"><a href="GHC.Types.Demand.html#TsProd"><span class="hs-identifier hs-var">TsProd</span></a></span></span><span> </span><span class="hs-special">[</span><span class="annot"><a href="GHC.Types.Demand.html#TypeShape"><span class="hs-identifier hs-type">TypeShape</span></a></span><span class="hs-special">]</span><span>
</span><span id="line-1705"></span><span>  </span><span class="hs-glyph">|</span><span> </span><span id="TsUnk"><span class="annot"><a href="GHC.Types.Demand.html#TsUnk"><span class="hs-identifier hs-var">TsUnk</span></a></span></span><span>
</span><span id="line-1706"></span><span>
</span><span id="line-1707"></span><span class="annot"><a href="GHC.Types.Demand.html#trimToType"><span class="hs-identifier hs-type">trimToType</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><a href="GHC.Types.Demand.html#Demand"><span class="hs-identifier hs-type">Demand</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="GHC.Types.Demand.html#TypeShape"><span class="hs-identifier hs-type">TypeShape</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="GHC.Types.Demand.html#Demand"><span class="hs-identifier hs-type">Demand</span></a></span><span>
</span><span id="line-1708"></span><span class="hs-comment">-- See Note [Trimming a demand to a type] in GHC.Core.Opt.DmdAnal</span><span>
</span><span id="line-1709"></span><span id="trimToType"><span class="annot"><span class="annottext">trimToType :: Demand -&gt; TypeShape -&gt; Demand
</span><a href="GHC.Types.Demand.html#trimToType"><span class="hs-identifier hs-var hs-var">trimToType</span></a></span></span><span> </span><span class="hs-special">(</span><span id="local-6989586621680990550"><span class="annot"><span class="annottext">Card
</span><a href="#local-6989586621680990550"><span class="hs-identifier hs-var">n</span></a></span></span><span> </span><span class="annot"><a href="GHC.Types.Demand.html#%3A%2A"><span class="hs-operator hs-type">:*</span></a></span><span> </span><span id="local-6989586621680990549"><span class="annot"><span class="annottext">SubDemand
</span><a href="#local-6989586621680990549"><span class="hs-identifier hs-var">sd</span></a></span></span><span class="hs-special">)</span><span> </span><span id="local-6989586621680990548"><span class="annot"><span class="annottext">TypeShape
</span><a href="#local-6989586621680990548"><span class="hs-identifier hs-var">ts</span></a></span></span><span>
</span><span id="line-1710"></span><span>  </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">Card
</span><a href="#local-6989586621680990550"><span class="hs-identifier hs-var">n</span></a></span><span> </span><span class="annot"><span class="annottext">Card -&gt; SubDemand -&gt; Demand
</span><a href="GHC.Types.Demand.html#%3A%2A"><span class="hs-operator hs-var">:*</span></a></span><span> </span><span class="annot"><span class="annottext">SubDemand -&gt; TypeShape -&gt; SubDemand
</span><a href="#local-6989586621680990547"><span class="hs-identifier hs-var">go</span></a></span><span> </span><span class="annot"><span class="annottext">SubDemand
</span><a href="#local-6989586621680990549"><span class="hs-identifier hs-var">sd</span></a></span><span> </span><span class="annot"><span class="annottext">TypeShape
</span><a href="#local-6989586621680990548"><span class="hs-identifier hs-var">ts</span></a></span><span>
</span><span id="line-1711"></span><span>  </span><span class="hs-keyword">where</span><span>
</span><span id="line-1712"></span><span>    </span><span id="local-6989586621680990547"><span class="annot"><span class="annottext">go :: SubDemand -&gt; TypeShape -&gt; SubDemand
</span><a href="#local-6989586621680990547"><span class="hs-identifier hs-var hs-var">go</span></a></span></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="GHC.Types.Demand.html#Prod"><span class="hs-identifier hs-type">Prod</span></a></span><span> </span><span id="local-6989586621680990546"><span class="annot"><span class="annottext">[Demand]
</span><a href="#local-6989586621680990546"><span class="hs-identifier hs-var">ds</span></a></span></span><span class="hs-special">)</span><span>   </span><span class="hs-special">(</span><span class="annot"><a href="GHC.Types.Demand.html#TsProd"><span class="hs-identifier hs-type">TsProd</span></a></span><span> </span><span id="local-6989586621680990545"><span class="annot"><span class="annottext">[TypeShape]
</span><a href="#local-6989586621680990545"><span class="hs-identifier hs-var">tss</span></a></span></span><span class="hs-special">)</span><span>
</span><span id="line-1713"></span><span>      </span><span class="hs-glyph">|</span><span> </span><span class="annot"><span class="annottext">forall a b. [a] -&gt; [b] -&gt; Bool
</span><a href="GHC.Utils.Misc.html#equalLength"><span class="hs-identifier hs-var">equalLength</span></a></span><span> </span><span class="annot"><span class="annottext">[Demand]
</span><a href="#local-6989586621680990546"><span class="hs-identifier hs-var">ds</span></a></span><span> </span><span class="annot"><span class="annottext">[TypeShape]
</span><a href="#local-6989586621680990545"><span class="hs-identifier hs-var">tss</span></a></span><span>    </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">[Demand] -&gt; SubDemand
</span><a href="GHC.Types.Demand.html#Prod"><span class="hs-identifier hs-var">Prod</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">forall a b c. (a -&gt; b -&gt; c) -&gt; [a] -&gt; [b] -&gt; [c]
</span><a href="../../base-4.16.4.0/src/GHC-List.html#zipWith"><span class="hs-identifier hs-var">zipWith</span></a></span><span> </span><span class="annot"><span class="annottext">Demand -&gt; TypeShape -&gt; Demand
</span><a href="GHC.Types.Demand.html#trimToType"><span class="hs-identifier hs-var">trimToType</span></a></span><span> </span><span class="annot"><span class="annottext">[Demand]
</span><a href="#local-6989586621680990546"><span class="hs-identifier hs-var">ds</span></a></span><span> </span><span class="annot"><span class="annottext">[TypeShape]
</span><a href="#local-6989586621680990545"><span class="hs-identifier hs-var">tss</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-1714"></span><span>    </span><span class="annot"><a href="#local-6989586621680990547"><span class="hs-identifier hs-var">go</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="GHC.Types.Demand.html#Call"><span class="hs-identifier hs-type">Call</span></a></span><span> </span><span id="local-6989586621680990543"><span class="annot"><span class="annottext">Card
</span><a href="#local-6989586621680990543"><span class="hs-identifier hs-var">n</span></a></span></span><span> </span><span id="local-6989586621680990542"><span class="annot"><span class="annottext">SubDemand
</span><a href="#local-6989586621680990542"><span class="hs-identifier hs-var">sd</span></a></span></span><span class="hs-special">)</span><span> </span><span class="hs-special">(</span><span class="annot"><a href="GHC.Types.Demand.html#TsFun"><span class="hs-identifier hs-type">TsFun</span></a></span><span> </span><span id="local-6989586621680990541"><span class="annot"><span class="annottext">TypeShape
</span><a href="#local-6989586621680990541"><span class="hs-identifier hs-var">ts</span></a></span></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">Card -&gt; SubDemand -&gt; SubDemand
</span><a href="GHC.Types.Demand.html#mkCall"><span class="hs-identifier hs-var">mkCall</span></a></span><span> </span><span class="annot"><span class="annottext">Card
</span><a href="#local-6989586621680990543"><span class="hs-identifier hs-var">n</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">SubDemand -&gt; TypeShape -&gt; SubDemand
</span><a href="#local-6989586621680990547"><span class="hs-identifier hs-var">go</span></a></span><span> </span><span class="annot"><span class="annottext">SubDemand
</span><a href="#local-6989586621680990542"><span class="hs-identifier hs-var">sd</span></a></span><span> </span><span class="annot"><span class="annottext">TypeShape
</span><a href="#local-6989586621680990541"><span class="hs-identifier hs-var">ts</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-1715"></span><span>    </span><span class="annot"><a href="#local-6989586621680990547"><span class="hs-identifier hs-var">go</span></a></span><span> </span><span id="local-6989586621680990540"><span class="annot"><span class="annottext">sd :: SubDemand
</span><a href="#local-6989586621680990540"><span class="hs-identifier hs-var">sd</span></a></span></span><span class="hs-glyph">@</span><span class="annot"><a href="GHC.Types.Demand.html#Poly"><span class="hs-identifier hs-type">Poly</span></a></span><span class="hs-special">{</span><span class="hs-special">}</span><span>   </span><span class="annot"><span class="annottext">TypeShape
</span><span class="hs-identifier">_</span></span><span>          </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">SubDemand
</span><a href="#local-6989586621680990540"><span class="hs-identifier hs-var">sd</span></a></span><span>
</span><span id="line-1716"></span><span>    </span><span class="annot"><a href="#local-6989586621680990547"><span class="hs-identifier hs-var">go</span></a></span><span> </span><span class="annot"><span class="annottext">SubDemand
</span><span class="hs-identifier">_</span></span><span>           </span><span class="annot"><span class="annottext">TypeShape
</span><span class="hs-identifier">_</span></span><span>          </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">SubDemand
</span><a href="GHC.Types.Demand.html#topSubDmd"><span class="hs-identifier hs-var">topSubDmd</span></a></span><span>
</span><span id="line-1717"></span><span>
</span><span id="line-1718"></span><span class="hs-comment">{-
************************************************************************
*                                                                      *
                     'seq'ing demands
*                                                                      *
************************************************************************
-}</span><span>
</span><span id="line-1725"></span><span>
</span><span id="line-1726"></span><span class="annot"><a href="GHC.Types.Demand.html#seqDemand"><span class="hs-identifier hs-type">seqDemand</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><a href="GHC.Types.Demand.html#Demand"><span class="hs-identifier hs-type">Demand</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-special">(</span><span class="hs-special">)</span><span>
</span><span id="line-1727"></span><span id="seqDemand"><span class="annot"><span class="annottext">seqDemand :: Demand -&gt; ()
</span><a href="GHC.Types.Demand.html#seqDemand"><span class="hs-identifier hs-var hs-var">seqDemand</span></a></span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Card
</span><span class="hs-identifier">_</span></span><span> </span><span class="annot"><a href="GHC.Types.Demand.html#%3A%2A"><span class="hs-operator hs-type">:*</span></a></span><span> </span><span id="local-6989586621680990539"><span class="annot"><span class="annottext">SubDemand
</span><a href="#local-6989586621680990539"><span class="hs-identifier hs-var">sd</span></a></span></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">SubDemand -&gt; ()
</span><a href="GHC.Types.Demand.html#seqSubDemand"><span class="hs-identifier hs-var">seqSubDemand</span></a></span><span> </span><span class="annot"><span class="annottext">SubDemand
</span><a href="#local-6989586621680990539"><span class="hs-identifier hs-var">sd</span></a></span><span>
</span><span id="line-1728"></span><span>
</span><span id="line-1729"></span><span class="annot"><a href="GHC.Types.Demand.html#seqSubDemand"><span class="hs-identifier hs-type">seqSubDemand</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><a href="GHC.Types.Demand.html#SubDemand"><span class="hs-identifier hs-type">SubDemand</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-special">(</span><span class="hs-special">)</span><span>
</span><span id="line-1730"></span><span id="seqSubDemand"><span class="annot"><span class="annottext">seqSubDemand :: SubDemand -&gt; ()
</span><a href="GHC.Types.Demand.html#seqSubDemand"><span class="hs-identifier hs-var hs-var">seqSubDemand</span></a></span></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="GHC.Types.Demand.html#Prod"><span class="hs-identifier hs-type">Prod</span></a></span><span> </span><span id="local-6989586621680990537"><span class="annot"><span class="annottext">[Demand]
</span><a href="#local-6989586621680990537"><span class="hs-identifier hs-var">ds</span></a></span></span><span class="hs-special">)</span><span>   </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">[Demand] -&gt; ()
</span><a href="GHC.Types.Demand.html#seqDemandList"><span class="hs-identifier hs-var">seqDemandList</span></a></span><span> </span><span class="annot"><span class="annottext">[Demand]
</span><a href="#local-6989586621680990537"><span class="hs-identifier hs-var">ds</span></a></span><span>
</span><span id="line-1731"></span><span class="annot"><a href="GHC.Types.Demand.html#seqSubDemand"><span class="hs-identifier hs-var">seqSubDemand</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="GHC.Types.Demand.html#Call"><span class="hs-identifier hs-type">Call</span></a></span><span> </span><span class="annot"><span class="annottext">Card
</span><span class="hs-identifier">_</span></span><span> </span><span id="local-6989586621680990536"><span class="annot"><span class="annottext">SubDemand
</span><a href="#local-6989586621680990536"><span class="hs-identifier hs-var">sd</span></a></span></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">SubDemand -&gt; ()
</span><a href="GHC.Types.Demand.html#seqSubDemand"><span class="hs-identifier hs-var">seqSubDemand</span></a></span><span> </span><span class="annot"><span class="annottext">SubDemand
</span><a href="#local-6989586621680990536"><span class="hs-identifier hs-var">sd</span></a></span><span>
</span><span id="line-1732"></span><span class="annot"><a href="GHC.Types.Demand.html#seqSubDemand"><span class="hs-identifier hs-var">seqSubDemand</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="GHC.Types.Demand.html#Poly"><span class="hs-identifier hs-type">Poly</span></a></span><span> </span><span class="annot"><span class="annottext">Card
</span><span class="hs-identifier">_</span></span><span class="hs-special">)</span><span>    </span><span class="hs-glyph">=</span><span> </span><span class="hs-special">(</span><span class="hs-special">)</span><span>
</span><span id="line-1733"></span><span>
</span><span id="line-1734"></span><span class="annot"><a href="GHC.Types.Demand.html#seqDemandList"><span class="hs-identifier hs-type">seqDemandList</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="hs-special">[</span><span class="annot"><a href="GHC.Types.Demand.html#Demand"><span class="hs-identifier hs-type">Demand</span></a></span><span class="hs-special">]</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-special">(</span><span class="hs-special">)</span><span>
</span><span id="line-1735"></span><span id="seqDemandList"><span class="annot"><span class="annottext">seqDemandList :: [Demand] -&gt; ()
</span><a href="GHC.Types.Demand.html#seqDemandList"><span class="hs-identifier hs-var hs-var">seqDemandList</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">forall (t :: * -&gt; *) a b.
Foldable t =&gt;
(a -&gt; b -&gt; b) -&gt; b -&gt; t a -&gt; b
</span><a href="../../base-4.16.4.0/src/Data-Foldable.html#foldr"><span class="hs-identifier hs-var">foldr</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">seq :: forall a b. a -&gt; b -&gt; b
</span><span class="hs-identifier hs-type">seq</span></span><span> </span><span class="annot"><span class="annottext">forall b c a. (b -&gt; c) -&gt; (a -&gt; b) -&gt; a -&gt; c
</span><a href="../../base-4.16.4.0/src/GHC-Base.html#."><span class="hs-operator hs-var">.</span></a></span><span> </span><span class="annot"><span class="annottext">Demand -&gt; ()
</span><a href="GHC.Types.Demand.html#seqDemand"><span class="hs-identifier hs-var">seqDemand</span></a></span><span class="hs-special">)</span><span> </span><span class="hs-special">(</span><span class="hs-special">)</span><span>
</span><span id="line-1736"></span><span>
</span><span id="line-1737"></span><span class="annot"><a href="GHC.Types.Demand.html#seqDmdType"><span class="hs-identifier hs-type">seqDmdType</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><a href="GHC.Types.Demand.html#DmdType"><span class="hs-identifier hs-type">DmdType</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-special">(</span><span class="hs-special">)</span><span>
</span><span id="line-1738"></span><span id="seqDmdType"><span class="annot"><span class="annottext">seqDmdType :: DmdType -&gt; ()
</span><a href="GHC.Types.Demand.html#seqDmdType"><span class="hs-identifier hs-var hs-var">seqDmdType</span></a></span></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="GHC.Types.Demand.html#DmdType"><span class="hs-identifier hs-type">DmdType</span></a></span><span> </span><span id="local-6989586621680990534"><span class="annot"><span class="annottext">DmdEnv
</span><a href="#local-6989586621680990534"><span class="hs-identifier hs-var">env</span></a></span></span><span> </span><span id="local-6989586621680990533"><span class="annot"><span class="annottext">[Demand]
</span><a href="#local-6989586621680990533"><span class="hs-identifier hs-var">ds</span></a></span></span><span> </span><span id="local-6989586621680990532"><span class="annot"><span class="annottext">Divergence
</span><a href="#local-6989586621680990532"><span class="hs-identifier hs-var">res</span></a></span></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">=</span><span>
</span><span id="line-1739"></span><span>  </span><span class="annot"><span class="annottext">DmdEnv -&gt; ()
</span><a href="GHC.Types.Demand.html#seqDmdEnv"><span class="hs-identifier hs-var">seqDmdEnv</span></a></span><span> </span><span class="annot"><span class="annottext">DmdEnv
</span><a href="#local-6989586621680990534"><span class="hs-identifier hs-var">env</span></a></span><span> </span><span class="annot"><span class="annottext">seq :: forall a b. a -&gt; b -&gt; b
</span><span class="hs-operator hs-type">`seq`</span></span><span> </span><span class="annot"><span class="annottext">[Demand] -&gt; ()
</span><a href="GHC.Types.Demand.html#seqDemandList"><span class="hs-identifier hs-var">seqDemandList</span></a></span><span> </span><span class="annot"><span class="annottext">[Demand]
</span><a href="#local-6989586621680990533"><span class="hs-identifier hs-var">ds</span></a></span><span> </span><span class="annot"><span class="annottext">seq :: forall a b. a -&gt; b -&gt; b
</span><span class="hs-operator hs-type">`seq`</span></span><span> </span><span class="annot"><span class="annottext">Divergence
</span><a href="#local-6989586621680990532"><span class="hs-identifier hs-var">res</span></a></span><span> </span><span class="annot"><span class="annottext">seq :: forall a b. a -&gt; b -&gt; b
</span><span class="hs-operator hs-type">`seq`</span></span><span> </span><span class="hs-special">(</span><span class="hs-special">)</span><span>
</span><span id="line-1740"></span><span>
</span><span id="line-1741"></span><span class="annot"><a href="GHC.Types.Demand.html#seqDmdEnv"><span class="hs-identifier hs-type">seqDmdEnv</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><a href="GHC.Types.Demand.html#DmdEnv"><span class="hs-identifier hs-type">DmdEnv</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-special">(</span><span class="hs-special">)</span><span>
</span><span id="line-1742"></span><span id="seqDmdEnv"><span class="annot"><span class="annottext">seqDmdEnv :: DmdEnv -&gt; ()
</span><a href="GHC.Types.Demand.html#seqDmdEnv"><span class="hs-identifier hs-var hs-var">seqDmdEnv</span></a></span></span><span> </span><span id="local-6989586621680990530"><span class="annot"><span class="annottext">DmdEnv
</span><a href="#local-6989586621680990530"><span class="hs-identifier hs-var">env</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">forall elt key. ([elt] -&gt; ()) -&gt; UniqFM key elt -&gt; ()
</span><a href="GHC.Types.Unique.FM.html#seqEltsUFM"><span class="hs-identifier hs-var">seqEltsUFM</span></a></span><span> </span><span class="annot"><span class="annottext">[Demand] -&gt; ()
</span><a href="GHC.Types.Demand.html#seqDemandList"><span class="hs-identifier hs-var">seqDemandList</span></a></span><span> </span><span class="annot"><span class="annottext">DmdEnv
</span><a href="#local-6989586621680990530"><span class="hs-identifier hs-var">env</span></a></span><span>
</span><span id="line-1743"></span><span>
</span><span id="line-1744"></span><span class="annot"><a href="GHC.Types.Demand.html#seqStrictSig"><span class="hs-identifier hs-type">seqStrictSig</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><a href="GHC.Types.Demand.html#StrictSig"><span class="hs-identifier hs-type">StrictSig</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-special">(</span><span class="hs-special">)</span><span>
</span><span id="line-1745"></span><span id="seqStrictSig"><span class="annot"><span class="annottext">seqStrictSig :: StrictSig -&gt; ()
</span><a href="GHC.Types.Demand.html#seqStrictSig"><span class="hs-identifier hs-var hs-var">seqStrictSig</span></a></span></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="GHC.Types.Demand.html#StrictSig"><span class="hs-identifier hs-type">StrictSig</span></a></span><span> </span><span id="local-6989586621680990528"><span class="annot"><span class="annottext">DmdType
</span><a href="#local-6989586621680990528"><span class="hs-identifier hs-var">ty</span></a></span></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">DmdType -&gt; ()
</span><a href="GHC.Types.Demand.html#seqDmdType"><span class="hs-identifier hs-var">seqDmdType</span></a></span><span> </span><span class="annot"><span class="annottext">DmdType
</span><a href="#local-6989586621680990528"><span class="hs-identifier hs-var">ty</span></a></span><span>
</span><span id="line-1746"></span><span>
</span><span id="line-1747"></span><span class="hs-comment">{-
************************************************************************
*                                                                      *
                     Outputable and Binary instances
*                                                                      *
************************************************************************
-}</span><span>
</span><span id="line-1754"></span><span>
</span><span id="line-1755"></span><span class="hs-comment">{- Note [Demand notation]
~~~~~~~~~~~~~~~~~~~~~~~~~
This Note should be kept up to date with the documentation of `-fstrictness`
in the user's guide.

For pretty-printing demands, we use quite a compact notation with some
abbreviations. Here's the BNF:

  card ::= B    {}
        |  A    {0}
        |  M    {0,1}
        |  L    {0,1,n}
        |  1    {1}
        |  S    {1,n}

  d    ::= card sd                  The :* constructor, just juxtaposition
        |  card                     abbreviation: Same as &quot;card card&quot;,
                                                  in code @polyDmd card@

  sd   ::= card                     @Poly card@
        |  P(d,d,..)                @Prod [d1,d2,..]@
        |  Ccard(sd)                @Call card sd@

So, L can denote a 'Card', polymorphic 'SubDemand' or polymorphic 'Demand',
but it's always clear from context which &quot;overload&quot; is meant. It's like
return-type inference of e.g. 'read'.

Examples are in the haddock for 'Demand'.

This is the syntax for demand signatures:

  div ::= &lt;empty&gt;      topDiv
       |  x            exnDiv
       |  b            botDiv

  sig ::= {x-&gt;dx,y-&gt;dy,z-&gt;dz...}&lt;d1&gt;&lt;d2&gt;&lt;d3&gt;...&lt;dn&gt;div
                  ^              ^   ^   ^      ^   ^
                  |              |   |   |      |   |
                  |              \---+---+------/   |
                  |                  |              |
             demand on free        demand on      divergence
               variables           arguments      information
           (omitted if empty)                     (omitted if
                                                no information)


-}</span><span>
</span><span id="line-1802"></span><span>
</span><span id="line-1803"></span><span class="hs-comment">-- | See Note [Demand notation]</span><span>
</span><span id="line-1804"></span><span class="hs-comment">-- Current syntax was discussed in #19016.</span><span>
</span><span id="line-1805"></span><span class="hs-keyword">instance</span><span> </span><span class="annot"><a href="GHC.Utils.Outputable.html#Outputable"><span class="hs-identifier hs-type">Outputable</span></a></span><span> </span><span class="annot"><a href="GHC.Types.Demand.html#Card"><span class="hs-identifier hs-type">Card</span></a></span><span> </span><span class="hs-keyword">where</span><span>
</span><span id="line-1806"></span><span>  </span><span id="local-6989586621680990524"><span class="annot"><span class="annottext">ppr :: Card -&gt; SDoc
</span><a href="#local-6989586621680990524"><span class="hs-identifier hs-var hs-var hs-var hs-var">ppr</span></a></span></span><span> </span><span class="annot"><span class="annottext">Card
</span><a href="GHC.Types.Demand.html#C_00"><span class="hs-identifier hs-var">C_00</span></a></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">Char -&gt; SDoc
</span><a href="GHC.Utils.Outputable.html#char"><span class="hs-identifier hs-var">char</span></a></span><span> </span><span class="annot"><span class="annottext">Char
</span><span class="hs-char">'A'</span></span><span> </span><span class="hs-comment">-- &quot;Absent&quot;</span><span>
</span><span id="line-1807"></span><span>  </span><span class="annot"><a href="GHC.Utils.Outputable.html#ppr"><span class="hs-identifier hs-var">ppr</span></a></span><span> </span><span class="annot"><span class="annottext">Card
</span><a href="GHC.Types.Demand.html#C_01"><span class="hs-identifier hs-var">C_01</span></a></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">Char -&gt; SDoc
</span><a href="GHC.Utils.Outputable.html#char"><span class="hs-identifier hs-var">char</span></a></span><span> </span><span class="annot"><span class="annottext">Char
</span><span class="hs-char">'M'</span></span><span> </span><span class="hs-comment">-- &quot;Maybe&quot;</span><span>
</span><span id="line-1808"></span><span>  </span><span class="annot"><a href="GHC.Utils.Outputable.html#ppr"><span class="hs-identifier hs-var">ppr</span></a></span><span> </span><span class="annot"><span class="annottext">Card
</span><a href="GHC.Types.Demand.html#C_0N"><span class="hs-identifier hs-var">C_0N</span></a></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">Char -&gt; SDoc
</span><a href="GHC.Utils.Outputable.html#char"><span class="hs-identifier hs-var">char</span></a></span><span> </span><span class="annot"><span class="annottext">Char
</span><span class="hs-char">'L'</span></span><span> </span><span class="hs-comment">-- &quot;Lazy&quot;</span><span>
</span><span id="line-1809"></span><span>  </span><span class="annot"><a href="GHC.Utils.Outputable.html#ppr"><span class="hs-identifier hs-var">ppr</span></a></span><span> </span><span class="annot"><span class="annottext">Card
</span><a href="GHC.Types.Demand.html#C_11"><span class="hs-identifier hs-var">C_11</span></a></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">Char -&gt; SDoc
</span><a href="GHC.Utils.Outputable.html#char"><span class="hs-identifier hs-var">char</span></a></span><span> </span><span class="annot"><span class="annottext">Char
</span><span class="hs-char">'1'</span></span><span> </span><span class="hs-comment">-- &quot;exactly 1&quot;</span><span>
</span><span id="line-1810"></span><span>  </span><span class="annot"><a href="GHC.Utils.Outputable.html#ppr"><span class="hs-identifier hs-var">ppr</span></a></span><span> </span><span class="annot"><span class="annottext">Card
</span><a href="GHC.Types.Demand.html#C_1N"><span class="hs-identifier hs-var">C_1N</span></a></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">Char -&gt; SDoc
</span><a href="GHC.Utils.Outputable.html#char"><span class="hs-identifier hs-var">char</span></a></span><span> </span><span class="annot"><span class="annottext">Char
</span><span class="hs-char">'S'</span></span><span> </span><span class="hs-comment">-- &quot;Strict&quot;</span><span>
</span><span id="line-1811"></span><span>  </span><span class="annot"><a href="GHC.Utils.Outputable.html#ppr"><span class="hs-identifier hs-var">ppr</span></a></span><span> </span><span class="annot"><span class="annottext">Card
</span><a href="GHC.Types.Demand.html#C_10"><span class="hs-identifier hs-var">C_10</span></a></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">Char -&gt; SDoc
</span><a href="GHC.Utils.Outputable.html#char"><span class="hs-identifier hs-var">char</span></a></span><span> </span><span class="annot"><span class="annottext">Char
</span><span class="hs-char">'B'</span></span><span> </span><span class="hs-comment">-- &quot;Bottom&quot;</span><span>
</span><span id="line-1812"></span><span>
</span><span id="line-1813"></span><span class="hs-comment">-- | See Note [Demand notation]</span><span>
</span><span id="line-1814"></span><span class="hs-keyword">instance</span><span> </span><span class="annot"><a href="GHC.Utils.Outputable.html#Outputable"><span class="hs-identifier hs-type">Outputable</span></a></span><span> </span><span class="annot"><a href="GHC.Types.Demand.html#Demand"><span class="hs-identifier hs-type">Demand</span></a></span><span> </span><span class="hs-keyword">where</span><span>
</span><span id="line-1815"></span><span>  </span><span id="local-6989586621680990515"><span class="annot"><span class="annottext">ppr :: Demand -&gt; SDoc
</span><a href="#local-6989586621680990515"><span class="hs-identifier hs-var hs-var hs-var hs-var">ppr</span></a></span></span><span> </span><span id="local-6989586621680990514"><span class="annot"><span class="annottext">dmd :: Demand
</span><a href="#local-6989586621680990514"><span class="hs-identifier hs-var">dmd</span></a></span></span><span class="hs-glyph">@</span><span class="hs-special">(</span><span id="local-6989586621680990513"><span class="annot"><span class="annottext">Card
</span><a href="#local-6989586621680990513"><span class="hs-identifier hs-var">n</span></a></span></span><span> </span><span class="annot"><a href="GHC.Types.Demand.html#%3A%2A"><span class="hs-operator hs-type">:*</span></a></span><span> </span><span id="local-6989586621680990512"><span class="annot"><span class="annottext">SubDemand
</span><a href="#local-6989586621680990512"><span class="hs-identifier hs-var">sd</span></a></span></span><span class="hs-special">)</span><span>
</span><span id="line-1816"></span><span>    </span><span class="hs-glyph">|</span><span> </span><span class="annot"><span class="annottext">Card -&gt; Bool
</span><a href="GHC.Types.Demand.html#isAbs"><span class="hs-identifier hs-var">isAbs</span></a></span><span> </span><span class="annot"><span class="annottext">Card
</span><a href="#local-6989586621680990513"><span class="hs-identifier hs-var">n</span></a></span><span>          </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">forall a. Outputable a =&gt; a -&gt; SDoc
</span><a href="GHC.Utils.Outputable.html#ppr"><span class="hs-identifier hs-var">ppr</span></a></span><span> </span><span class="annot"><span class="annottext">Card
</span><a href="#local-6989586621680990513"><span class="hs-identifier hs-var">n</span></a></span><span>   </span><span class="hs-comment">-- If absent, sd is arbitrary</span><span>
</span><span id="line-1817"></span><span>    </span><span class="hs-glyph">|</span><span> </span><span class="annot"><span class="annottext">Demand
</span><a href="#local-6989586621680990514"><span class="hs-identifier hs-var">dmd</span></a></span><span> </span><span class="annot"><span class="annottext">forall a. Eq a =&gt; a -&gt; a -&gt; Bool
</span><span class="hs-operator hs-var">==</span></span><span> </span><span class="annot"><span class="annottext">Card -&gt; Demand
</span><a href="GHC.Types.Demand.html#polyDmd"><span class="hs-identifier hs-var">polyDmd</span></a></span><span> </span><span class="annot"><span class="annottext">Card
</span><a href="#local-6989586621680990513"><span class="hs-identifier hs-var">n</span></a></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">forall a. Outputable a =&gt; a -&gt; SDoc
</span><a href="GHC.Utils.Outputable.html#ppr"><span class="hs-identifier hs-var">ppr</span></a></span><span> </span><span class="annot"><span class="annottext">Card
</span><a href="#local-6989586621680990513"><span class="hs-identifier hs-var">n</span></a></span><span>   </span><span class="hs-comment">-- Print UU as just U</span><span>
</span><span id="line-1818"></span><span>    </span><span class="hs-glyph">|</span><span> </span><span class="annot"><span class="annottext">Bool
</span><a href="../../base-4.16.4.0/src/GHC-Base.html#otherwise"><span class="hs-identifier hs-var">otherwise</span></a></span><span>        </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">forall a. Outputable a =&gt; a -&gt; SDoc
</span><a href="GHC.Utils.Outputable.html#ppr"><span class="hs-identifier hs-var">ppr</span></a></span><span> </span><span class="annot"><span class="annottext">Card
</span><a href="#local-6989586621680990513"><span class="hs-identifier hs-var">n</span></a></span><span> </span><span class="annot"><span class="annottext">SDoc -&gt; SDoc -&gt; SDoc
</span><a href="GHC.Utils.Outputable.html#%3C%3E"><span class="hs-operator hs-var">&lt;&gt;</span></a></span><span> </span><span class="annot"><span class="annottext">forall a. Outputable a =&gt; a -&gt; SDoc
</span><a href="GHC.Utils.Outputable.html#ppr"><span class="hs-identifier hs-var">ppr</span></a></span><span> </span><span class="annot"><span class="annottext">SubDemand
</span><a href="#local-6989586621680990512"><span class="hs-identifier hs-var">sd</span></a></span><span>
</span><span id="line-1819"></span><span>
</span><span id="line-1820"></span><span class="hs-comment">-- | See Note [Demand notation]</span><span>
</span><span id="line-1821"></span><span class="hs-keyword">instance</span><span> </span><span class="annot"><a href="GHC.Utils.Outputable.html#Outputable"><span class="hs-identifier hs-type">Outputable</span></a></span><span> </span><span class="annot"><a href="GHC.Types.Demand.html#SubDemand"><span class="hs-identifier hs-type">SubDemand</span></a></span><span> </span><span class="hs-keyword">where</span><span>
</span><span id="line-1822"></span><span>  </span><span id="local-6989586621680990505"><span class="annot"><span class="annottext">ppr :: SubDemand -&gt; SDoc
</span><a href="#local-6989586621680990505"><span class="hs-identifier hs-var hs-var hs-var hs-var">ppr</span></a></span></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="GHC.Types.Demand.html#Poly"><span class="hs-identifier hs-type">Poly</span></a></span><span> </span><span id="local-6989586621680990504"><span class="annot"><span class="annottext">Card
</span><a href="#local-6989586621680990504"><span class="hs-identifier hs-var">sd</span></a></span></span><span class="hs-special">)</span><span>   </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">forall a. Outputable a =&gt; a -&gt; SDoc
</span><a href="GHC.Utils.Outputable.html#ppr"><span class="hs-identifier hs-var">ppr</span></a></span><span> </span><span class="annot"><span class="annottext">Card
</span><a href="#local-6989586621680990504"><span class="hs-identifier hs-var">sd</span></a></span><span>
</span><span id="line-1823"></span><span>  </span><span class="annot"><a href="GHC.Utils.Outputable.html#ppr"><span class="hs-identifier hs-var">ppr</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="GHC.Types.Demand.html#Call"><span class="hs-identifier hs-type">Call</span></a></span><span> </span><span id="local-6989586621680990503"><span class="annot"><span class="annottext">Card
</span><a href="#local-6989586621680990503"><span class="hs-identifier hs-var">n</span></a></span></span><span> </span><span id="local-6989586621680990502"><span class="annot"><span class="annottext">SubDemand
</span><a href="#local-6989586621680990502"><span class="hs-identifier hs-var">sd</span></a></span></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">Char -&gt; SDoc
</span><a href="GHC.Utils.Outputable.html#char"><span class="hs-identifier hs-var">char</span></a></span><span> </span><span class="annot"><span class="annottext">Char
</span><span class="hs-char">'C'</span></span><span> </span><span class="annot"><span class="annottext">SDoc -&gt; SDoc -&gt; SDoc
</span><a href="GHC.Utils.Outputable.html#%3C%3E"><span class="hs-operator hs-var">&lt;&gt;</span></a></span><span> </span><span class="annot"><span class="annottext">forall a. Outputable a =&gt; a -&gt; SDoc
</span><a href="GHC.Utils.Outputable.html#ppr"><span class="hs-identifier hs-var">ppr</span></a></span><span> </span><span class="annot"><span class="annottext">Card
</span><a href="#local-6989586621680990503"><span class="hs-identifier hs-var">n</span></a></span><span> </span><span class="annot"><span class="annottext">SDoc -&gt; SDoc -&gt; SDoc
</span><a href="GHC.Utils.Outputable.html#%3C%3E"><span class="hs-operator hs-var">&lt;&gt;</span></a></span><span> </span><span class="annot"><span class="annottext">SDoc -&gt; SDoc
</span><a href="GHC.Utils.Outputable.html#parens"><span class="hs-identifier hs-var">parens</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">forall a. Outputable a =&gt; a -&gt; SDoc
</span><a href="GHC.Utils.Outputable.html#ppr"><span class="hs-identifier hs-var">ppr</span></a></span><span> </span><span class="annot"><span class="annottext">SubDemand
</span><a href="#local-6989586621680990502"><span class="hs-identifier hs-var">sd</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-1824"></span><span>  </span><span class="annot"><a href="GHC.Utils.Outputable.html#ppr"><span class="hs-identifier hs-var">ppr</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="GHC.Types.Demand.html#Prod"><span class="hs-identifier hs-type">Prod</span></a></span><span> </span><span id="local-6989586621680990500"><span class="annot"><span class="annottext">[Demand]
</span><a href="#local-6989586621680990500"><span class="hs-identifier hs-var">ds</span></a></span></span><span class="hs-special">)</span><span>   </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">Char -&gt; SDoc
</span><a href="GHC.Utils.Outputable.html#char"><span class="hs-identifier hs-var">char</span></a></span><span> </span><span class="annot"><span class="annottext">Char
</span><span class="hs-char">'P'</span></span><span> </span><span class="annot"><span class="annottext">SDoc -&gt; SDoc -&gt; SDoc
</span><a href="GHC.Utils.Outputable.html#%3C%3E"><span class="hs-operator hs-var">&lt;&gt;</span></a></span><span> </span><span class="annot"><span class="annottext">SDoc -&gt; SDoc
</span><a href="GHC.Utils.Outputable.html#parens"><span class="hs-identifier hs-var">parens</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">forall {a}. Outputable a =&gt; [a] -&gt; SDoc
</span><a href="#local-6989586621680990499"><span class="hs-identifier hs-var">fields</span></a></span><span> </span><span class="annot"><span class="annottext">[Demand]
</span><a href="#local-6989586621680990500"><span class="hs-identifier hs-var">ds</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-1825"></span><span>    </span><span class="hs-keyword">where</span><span>
</span><span id="line-1826"></span><span>      </span><span id="local-6989586621680990499"><span class="annot"><span class="annottext">fields :: [a] -&gt; SDoc
</span><a href="#local-6989586621680990499"><span class="hs-identifier hs-var hs-var">fields</span></a></span></span><span> </span><span class="hs-special">[</span><span class="hs-special">]</span><span>     </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">SDoc
</span><a href="GHC.Utils.Outputable.html#empty"><span class="hs-identifier hs-var">empty</span></a></span><span>
</span><span id="line-1827"></span><span>      </span><span class="annot"><a href="#local-6989586621680990499"><span class="hs-identifier hs-var">fields</span></a></span><span> </span><span class="hs-special">[</span><span id="local-6989586621680990494"><span class="annot"><span class="annottext">a
</span><a href="#local-6989586621680990494"><span class="hs-identifier hs-var">x</span></a></span></span><span class="hs-special">]</span><span>    </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">forall a. Outputable a =&gt; a -&gt; SDoc
</span><a href="GHC.Utils.Outputable.html#ppr"><span class="hs-identifier hs-var">ppr</span></a></span><span> </span><span class="annot"><span class="annottext">a
</span><a href="#local-6989586621680990494"><span class="hs-identifier hs-var">x</span></a></span><span>
</span><span id="line-1828"></span><span>      </span><span class="annot"><a href="#local-6989586621680990499"><span class="hs-identifier hs-var">fields</span></a></span><span> </span><span class="hs-special">(</span><span id="local-6989586621680990493"><span class="annot"><span class="annottext">a
</span><a href="#local-6989586621680990493"><span class="hs-identifier hs-var">x</span></a></span></span><span class="annot"><span class="hs-glyph hs-type">:</span></span><span id="local-6989586621680990492"><span class="annot"><span class="annottext">[a]
</span><a href="#local-6989586621680990492"><span class="hs-identifier hs-var">xs</span></a></span></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">forall a. Outputable a =&gt; a -&gt; SDoc
</span><a href="GHC.Utils.Outputable.html#ppr"><span class="hs-identifier hs-var">ppr</span></a></span><span> </span><span class="annot"><span class="annottext">a
</span><a href="#local-6989586621680990493"><span class="hs-identifier hs-var">x</span></a></span><span> </span><span class="annot"><span class="annottext">SDoc -&gt; SDoc -&gt; SDoc
</span><a href="GHC.Utils.Outputable.html#%3C%3E"><span class="hs-operator hs-var">&lt;&gt;</span></a></span><span> </span><span class="annot"><span class="annottext">Char -&gt; SDoc
</span><a href="GHC.Utils.Outputable.html#char"><span class="hs-identifier hs-var">char</span></a></span><span> </span><span class="annot"><span class="annottext">Char
</span><span class="hs-char">','</span></span><span> </span><span class="annot"><span class="annottext">SDoc -&gt; SDoc -&gt; SDoc
</span><a href="GHC.Utils.Outputable.html#%3C%3E"><span class="hs-operator hs-var">&lt;&gt;</span></a></span><span> </span><span class="annot"><span class="annottext">[a] -&gt; SDoc
</span><a href="#local-6989586621680990499"><span class="hs-identifier hs-var">fields</span></a></span><span> </span><span class="annot"><span class="annottext">[a]
</span><a href="#local-6989586621680990492"><span class="hs-identifier hs-var">xs</span></a></span><span>
</span><span id="line-1829"></span><span>
</span><span id="line-1830"></span><span class="hs-keyword">instance</span><span> </span><span class="annot"><a href="GHC.Utils.Outputable.html#Outputable"><span class="hs-identifier hs-type">Outputable</span></a></span><span> </span><span class="annot"><a href="GHC.Types.Demand.html#Divergence"><span class="hs-identifier hs-type">Divergence</span></a></span><span> </span><span class="hs-keyword">where</span><span>
</span><span id="line-1831"></span><span>  </span><span id="local-6989586621680990489"><span class="annot"><span class="annottext">ppr :: Divergence -&gt; SDoc
</span><a href="#local-6989586621680990489"><span class="hs-identifier hs-var hs-var hs-var hs-var">ppr</span></a></span></span><span> </span><span class="annot"><span class="annottext">Divergence
</span><a href="GHC.Types.Demand.html#Diverges"><span class="hs-identifier hs-var">Diverges</span></a></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">Char -&gt; SDoc
</span><a href="GHC.Utils.Outputable.html#char"><span class="hs-identifier hs-var">char</span></a></span><span> </span><span class="annot"><span class="annottext">Char
</span><span class="hs-char">'b'</span></span><span> </span><span class="hs-comment">-- for (b)ottom</span><span>
</span><span id="line-1832"></span><span>  </span><span class="annot"><a href="GHC.Utils.Outputable.html#ppr"><span class="hs-identifier hs-var">ppr</span></a></span><span> </span><span class="annot"><span class="annottext">Divergence
</span><a href="GHC.Types.Demand.html#ExnOrDiv"><span class="hs-identifier hs-var">ExnOrDiv</span></a></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">Char -&gt; SDoc
</span><a href="GHC.Utils.Outputable.html#char"><span class="hs-identifier hs-var">char</span></a></span><span> </span><span class="annot"><span class="annottext">Char
</span><span class="hs-char">'x'</span></span><span> </span><span class="hs-comment">-- for e(x)ception</span><span>
</span><span id="line-1833"></span><span>  </span><span class="annot"><a href="GHC.Utils.Outputable.html#ppr"><span class="hs-identifier hs-var">ppr</span></a></span><span> </span><span class="annot"><span class="annottext">Divergence
</span><a href="GHC.Types.Demand.html#Dunno"><span class="hs-identifier hs-var">Dunno</span></a></span><span>    </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">SDoc
</span><a href="GHC.Utils.Outputable.html#empty"><span class="hs-identifier hs-var">empty</span></a></span><span>
</span><span id="line-1834"></span><span>
</span><span id="line-1835"></span><span class="hs-keyword">instance</span><span> </span><span class="annot"><a href="GHC.Utils.Outputable.html#Outputable"><span class="hs-identifier hs-type">Outputable</span></a></span><span> </span><span class="annot"><a href="GHC.Types.Demand.html#DmdType"><span class="hs-identifier hs-type">DmdType</span></a></span><span> </span><span class="hs-keyword">where</span><span>
</span><span id="line-1836"></span><span>  </span><span id="local-6989586621680990481"><span class="annot"><span class="annottext">ppr :: DmdType -&gt; SDoc
</span><a href="#local-6989586621680990481"><span class="hs-identifier hs-var hs-var hs-var hs-var">ppr</span></a></span></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="GHC.Types.Demand.html#DmdType"><span class="hs-identifier hs-type">DmdType</span></a></span><span> </span><span id="local-6989586621680990480"><span class="annot"><span class="annottext">DmdEnv
</span><a href="#local-6989586621680990480"><span class="hs-identifier hs-var">fv</span></a></span></span><span> </span><span id="local-6989586621680990479"><span class="annot"><span class="annottext">[Demand]
</span><a href="#local-6989586621680990479"><span class="hs-identifier hs-var">ds</span></a></span></span><span> </span><span id="local-6989586621680990478"><span class="annot"><span class="annottext">Divergence
</span><a href="#local-6989586621680990478"><span class="hs-identifier hs-var">res</span></a></span></span><span class="hs-special">)</span><span>
</span><span id="line-1837"></span><span>    </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">[SDoc] -&gt; SDoc
</span><a href="GHC.Utils.Outputable.html#hsep"><span class="hs-identifier hs-var">hsep</span></a></span><span> </span><span class="hs-special">[</span><span class="annot"><span class="annottext">[SDoc] -&gt; SDoc
</span><a href="GHC.Utils.Outputable.html#hcat"><span class="hs-identifier hs-var">hcat</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">forall a b. (a -&gt; b) -&gt; [a] -&gt; [b]
</span><a href="../../base-4.16.4.0/src/GHC-Base.html#map"><span class="hs-identifier hs-var">map</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">SDoc -&gt; SDoc
</span><a href="GHC.Utils.Outputable.html#angleBrackets"><span class="hs-identifier hs-var">angleBrackets</span></a></span><span> </span><span class="annot"><span class="annottext">forall b c a. (b -&gt; c) -&gt; (a -&gt; b) -&gt; a -&gt; c
</span><a href="../../base-4.16.4.0/src/GHC-Base.html#."><span class="hs-operator hs-var">.</span></a></span><span> </span><span class="annot"><span class="annottext">forall a. Outputable a =&gt; a -&gt; SDoc
</span><a href="GHC.Utils.Outputable.html#ppr"><span class="hs-identifier hs-var">ppr</span></a></span><span class="hs-special">)</span><span> </span><span class="annot"><span class="annottext">[Demand]
</span><a href="#local-6989586621680990479"><span class="hs-identifier hs-var">ds</span></a></span><span class="hs-special">)</span><span> </span><span class="annot"><span class="annottext">SDoc -&gt; SDoc -&gt; SDoc
</span><a href="GHC.Utils.Outputable.html#%3C%3E"><span class="hs-operator hs-var">&lt;&gt;</span></a></span><span> </span><span class="annot"><span class="annottext">forall a. Outputable a =&gt; a -&gt; SDoc
</span><a href="GHC.Utils.Outputable.html#ppr"><span class="hs-identifier hs-var">ppr</span></a></span><span> </span><span class="annot"><span class="annottext">Divergence
</span><a href="#local-6989586621680990478"><span class="hs-identifier hs-var">res</span></a></span><span class="hs-special">,</span><span>
</span><span id="line-1838"></span><span>            </span><span class="hs-keyword">if</span><span> </span><span class="annot"><span class="annottext">forall (t :: * -&gt; *) a. Foldable t =&gt; t a -&gt; Bool
</span><a href="../../base-4.16.4.0/src/Data-Foldable.html#null"><span class="hs-identifier hs-var">null</span></a></span><span> </span><span class="annot"><span class="annottext">[(Unique, Demand)]
</span><a href="#local-6989586621680990474"><span class="hs-identifier hs-var">fv_elts</span></a></span><span> </span><span class="hs-keyword">then</span><span> </span><span class="annot"><span class="annottext">SDoc
</span><a href="GHC.Utils.Outputable.html#empty"><span class="hs-identifier hs-var">empty</span></a></span><span>
</span><span id="line-1839"></span><span>            </span><span class="hs-keyword">else</span><span> </span><span class="annot"><span class="annottext">SDoc -&gt; SDoc
</span><a href="GHC.Utils.Outputable.html#braces"><span class="hs-identifier hs-var">braces</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">[SDoc] -&gt; SDoc
</span><a href="GHC.Utils.Outputable.html#fsep"><span class="hs-identifier hs-var">fsep</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">forall a b. (a -&gt; b) -&gt; [a] -&gt; [b]
</span><a href="../../base-4.16.4.0/src/GHC-Base.html#map"><span class="hs-identifier hs-var">map</span></a></span><span> </span><span class="annot"><span class="annottext">forall {a} {a}. (Outputable a, Outputable a) =&gt; (a, a) -&gt; SDoc
</span><a href="#local-6989586621680990471"><span class="hs-identifier hs-var">pp_elt</span></a></span><span> </span><span class="annot"><span class="annottext">[(Unique, Demand)]
</span><a href="#local-6989586621680990474"><span class="hs-identifier hs-var">fv_elts</span></a></span><span class="hs-special">)</span><span class="hs-special">)</span><span class="hs-special">]</span><span>
</span><span id="line-1840"></span><span>    </span><span class="hs-keyword">where</span><span>
</span><span id="line-1841"></span><span>      </span><span id="local-6989586621680990471"><span class="annot"><span class="annottext">pp_elt :: (a, a) -&gt; SDoc
</span><a href="#local-6989586621680990471"><span class="hs-identifier hs-var hs-var">pp_elt</span></a></span></span><span> </span><span class="hs-special">(</span><span id="local-6989586621680990466"><span class="annot"><span class="annottext">a
</span><a href="#local-6989586621680990466"><span class="hs-identifier hs-var">uniq</span></a></span></span><span class="hs-special">,</span><span> </span><span id="local-6989586621680990465"><span class="annot"><span class="annottext">a
</span><a href="#local-6989586621680990465"><span class="hs-identifier hs-var">dmd</span></a></span></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">forall a. Outputable a =&gt; a -&gt; SDoc
</span><a href="GHC.Utils.Outputable.html#ppr"><span class="hs-identifier hs-var">ppr</span></a></span><span> </span><span class="annot"><span class="annottext">a
</span><a href="#local-6989586621680990466"><span class="hs-identifier hs-var">uniq</span></a></span><span> </span><span class="annot"><span class="annottext">SDoc -&gt; SDoc -&gt; SDoc
</span><a href="GHC.Utils.Outputable.html#%3C%3E"><span class="hs-operator hs-var">&lt;&gt;</span></a></span><span> </span><span class="annot"><span class="annottext">String -&gt; SDoc
</span><a href="GHC.Utils.Outputable.html#text"><span class="hs-identifier hs-var">text</span></a></span><span> </span><span class="annot"><span class="annottext">String
</span><span class="hs-string">&quot;-&gt;&quot;</span></span><span> </span><span class="annot"><span class="annottext">SDoc -&gt; SDoc -&gt; SDoc
</span><a href="GHC.Utils.Outputable.html#%3C%3E"><span class="hs-operator hs-var">&lt;&gt;</span></a></span><span> </span><span class="annot"><span class="annottext">forall a. Outputable a =&gt; a -&gt; SDoc
</span><a href="GHC.Utils.Outputable.html#ppr"><span class="hs-identifier hs-var">ppr</span></a></span><span> </span><span class="annot"><span class="annottext">a
</span><a href="#local-6989586621680990465"><span class="hs-identifier hs-var">dmd</span></a></span><span>
</span><span id="line-1842"></span><span>      </span><span id="local-6989586621680990474"><span class="annot"><span class="annottext">fv_elts :: [(Unique, Demand)]
</span><a href="#local-6989586621680990474"><span class="hs-identifier hs-var hs-var">fv_elts</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">forall key elt. UniqFM key elt -&gt; [(Unique, elt)]
</span><a href="GHC.Types.Unique.FM.html#nonDetUFMToList"><span class="hs-identifier hs-var">nonDetUFMToList</span></a></span><span> </span><span class="annot"><span class="annottext">DmdEnv
</span><a href="#local-6989586621680990480"><span class="hs-identifier hs-var">fv</span></a></span><span>
</span><span id="line-1843"></span><span>        </span><span class="hs-comment">-- It's OK to use nonDetUFMToList here because we only do it for</span><span>
</span><span id="line-1844"></span><span>        </span><span class="hs-comment">-- pretty printing</span><span>
</span><span id="line-1845"></span><span>
</span><span id="line-1846"></span><span class="hs-keyword">instance</span><span> </span><span class="annot"><a href="GHC.Utils.Outputable.html#Outputable"><span class="hs-identifier hs-type">Outputable</span></a></span><span> </span><span class="annot"><a href="GHC.Types.Demand.html#StrictSig"><span class="hs-identifier hs-type">StrictSig</span></a></span><span> </span><span class="hs-keyword">where</span><span>
</span><span id="line-1847"></span><span>   </span><span id="local-6989586621680990461"><span class="annot"><span class="annottext">ppr :: StrictSig -&gt; SDoc
</span><a href="#local-6989586621680990461"><span class="hs-identifier hs-var hs-var hs-var hs-var">ppr</span></a></span></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="GHC.Types.Demand.html#StrictSig"><span class="hs-identifier hs-type">StrictSig</span></a></span><span> </span><span id="local-6989586621680990460"><span class="annot"><span class="annottext">DmdType
</span><a href="#local-6989586621680990460"><span class="hs-identifier hs-var">ty</span></a></span></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">forall a. Outputable a =&gt; a -&gt; SDoc
</span><a href="GHC.Utils.Outputable.html#ppr"><span class="hs-identifier hs-var">ppr</span></a></span><span> </span><span class="annot"><span class="annottext">DmdType
</span><a href="#local-6989586621680990460"><span class="hs-identifier hs-var">ty</span></a></span><span>
</span><span id="line-1848"></span><span>
</span><span id="line-1849"></span><span class="hs-keyword">instance</span><span> </span><span class="annot"><a href="GHC.Utils.Outputable.html#Outputable"><span class="hs-identifier hs-type">Outputable</span></a></span><span> </span><span class="annot"><a href="GHC.Types.Demand.html#TypeShape"><span class="hs-identifier hs-type">TypeShape</span></a></span><span> </span><span class="hs-keyword">where</span><span>
</span><span id="line-1850"></span><span>  </span><span id="local-6989586621680990455"><span class="annot"><span class="annottext">ppr :: TypeShape -&gt; SDoc
</span><a href="#local-6989586621680990455"><span class="hs-identifier hs-var hs-var hs-var hs-var">ppr</span></a></span></span><span> </span><span class="annot"><span class="annottext">TypeShape
</span><a href="GHC.Types.Demand.html#TsUnk"><span class="hs-identifier hs-var">TsUnk</span></a></span><span>        </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">String -&gt; SDoc
</span><a href="GHC.Utils.Outputable.html#text"><span class="hs-identifier hs-var">text</span></a></span><span> </span><span class="annot"><span class="annottext">String
</span><span class="hs-string">&quot;TsUnk&quot;</span></span><span>
</span><span id="line-1851"></span><span>  </span><span class="annot"><a href="GHC.Utils.Outputable.html#ppr"><span class="hs-identifier hs-var">ppr</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="GHC.Types.Demand.html#TsFun"><span class="hs-identifier hs-type">TsFun</span></a></span><span> </span><span id="local-6989586621680990454"><span class="annot"><span class="annottext">TypeShape
</span><a href="#local-6989586621680990454"><span class="hs-identifier hs-var">ts</span></a></span></span><span class="hs-special">)</span><span>   </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">String -&gt; SDoc
</span><a href="GHC.Utils.Outputable.html#text"><span class="hs-identifier hs-var">text</span></a></span><span> </span><span class="annot"><span class="annottext">String
</span><span class="hs-string">&quot;TsFun&quot;</span></span><span> </span><span class="annot"><span class="annottext">SDoc -&gt; SDoc -&gt; SDoc
</span><a href="GHC.Utils.Outputable.html#%3C%3E"><span class="hs-operator hs-var">&lt;&gt;</span></a></span><span> </span><span class="annot"><span class="annottext">SDoc -&gt; SDoc
</span><a href="GHC.Utils.Outputable.html#parens"><span class="hs-identifier hs-var">parens</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">forall a. Outputable a =&gt; a -&gt; SDoc
</span><a href="GHC.Utils.Outputable.html#ppr"><span class="hs-identifier hs-var">ppr</span></a></span><span> </span><span class="annot"><span class="annottext">TypeShape
</span><a href="#local-6989586621680990454"><span class="hs-identifier hs-var">ts</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-1852"></span><span>  </span><span class="annot"><a href="GHC.Utils.Outputable.html#ppr"><span class="hs-identifier hs-var">ppr</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="GHC.Types.Demand.html#TsProd"><span class="hs-identifier hs-type">TsProd</span></a></span><span> </span><span id="local-6989586621680990453"><span class="annot"><span class="annottext">[TypeShape]
</span><a href="#local-6989586621680990453"><span class="hs-identifier hs-var">tss</span></a></span></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">SDoc -&gt; SDoc
</span><a href="GHC.Utils.Outputable.html#parens"><span class="hs-identifier hs-var">parens</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">[SDoc] -&gt; SDoc
</span><a href="GHC.Utils.Outputable.html#hsep"><span class="hs-identifier hs-var">hsep</span></a></span><span> </span><span class="annot"><span class="annottext">forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><a href="../../base-4.16.4.0/src/GHC-Base.html#%24"><span class="hs-operator hs-var">$</span></a></span><span> </span><span class="annot"><span class="annottext">SDoc -&gt; [SDoc] -&gt; [SDoc]
</span><a href="GHC.Utils.Outputable.html#punctuate"><span class="hs-identifier hs-var">punctuate</span></a></span><span> </span><span class="annot"><span class="annottext">SDoc
</span><a href="GHC.Utils.Outputable.html#comma"><span class="hs-identifier hs-var">comma</span></a></span><span> </span><span class="annot"><span class="annottext">forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><a href="../../base-4.16.4.0/src/GHC-Base.html#%24"><span class="hs-operator hs-var">$</span></a></span><span> </span><span class="annot"><span class="annottext">forall a b. (a -&gt; b) -&gt; [a] -&gt; [b]
</span><a href="../../base-4.16.4.0/src/GHC-Base.html#map"><span class="hs-identifier hs-var">map</span></a></span><span> </span><span class="annot"><span class="annottext">forall a. Outputable a =&gt; a -&gt; SDoc
</span><a href="GHC.Utils.Outputable.html#ppr"><span class="hs-identifier hs-var">ppr</span></a></span><span> </span><span class="annot"><span class="annottext">[TypeShape]
</span><a href="#local-6989586621680990453"><span class="hs-identifier hs-var">tss</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-1853"></span><span>
</span><span id="line-1854"></span><span class="hs-keyword">instance</span><span> </span><span id="local-6989586621680990448"><span class="annot"><a href="GHC.Utils.Binary.html#Binary"><span class="hs-identifier hs-type">Binary</span></a></span><span> </span><span class="annot"><a href="GHC.Types.Demand.html#Card"><span class="hs-identifier hs-type">Card</span></a></span></span><span> </span><span class="hs-keyword">where</span><span>
</span><span id="line-1855"></span><span>  </span><span id="local-6989586621680990438"><span class="annot"><span class="annottext">put_ :: BinHandle -&gt; Card -&gt; IO ()
</span><a href="GHC.Utils.Binary.html#put_"><span class="hs-identifier hs-var hs-var hs-var hs-var">put_</span></a></span></span><span> </span><span id="local-6989586621680990436"><span class="annot"><span class="annottext">BinHandle
</span><a href="#local-6989586621680990436"><span class="hs-identifier hs-var">bh</span></a></span></span><span> </span><span class="annot"><span class="annottext">Card
</span><a href="GHC.Types.Demand.html#C_00"><span class="hs-identifier hs-var">C_00</span></a></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">BinHandle -&gt; Word8 -&gt; IO ()
</span><a href="GHC.Utils.Binary.html#putByte"><span class="hs-identifier hs-var">putByte</span></a></span><span> </span><span class="annot"><span class="annottext">BinHandle
</span><a href="#local-6989586621680990436"><span class="hs-identifier hs-var">bh</span></a></span><span> </span><span class="annot"><span class="annottext">Word8
</span><span class="hs-number">0</span></span><span>
</span><span id="line-1856"></span><span>  </span><span class="annot"><a href="GHC.Utils.Binary.html#put_"><span class="hs-identifier hs-var">put_</span></a></span><span> </span><span id="local-6989586621680990434"><span class="annot"><span class="annottext">BinHandle
</span><a href="#local-6989586621680990434"><span class="hs-identifier hs-var">bh</span></a></span></span><span> </span><span class="annot"><span class="annottext">Card
</span><a href="GHC.Types.Demand.html#C_01"><span class="hs-identifier hs-var">C_01</span></a></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">BinHandle -&gt; Word8 -&gt; IO ()
</span><a href="GHC.Utils.Binary.html#putByte"><span class="hs-identifier hs-var">putByte</span></a></span><span> </span><span class="annot"><span class="annottext">BinHandle
</span><a href="#local-6989586621680990434"><span class="hs-identifier hs-var">bh</span></a></span><span> </span><span class="annot"><span class="annottext">Word8
</span><span class="hs-number">1</span></span><span>
</span><span id="line-1857"></span><span>  </span><span class="annot"><a href="GHC.Utils.Binary.html#put_"><span class="hs-identifier hs-var">put_</span></a></span><span> </span><span id="local-6989586621680990433"><span class="annot"><span class="annottext">BinHandle
</span><a href="#local-6989586621680990433"><span class="hs-identifier hs-var">bh</span></a></span></span><span> </span><span class="annot"><span class="annottext">Card
</span><a href="GHC.Types.Demand.html#C_0N"><span class="hs-identifier hs-var">C_0N</span></a></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">BinHandle -&gt; Word8 -&gt; IO ()
</span><a href="GHC.Utils.Binary.html#putByte"><span class="hs-identifier hs-var">putByte</span></a></span><span> </span><span class="annot"><span class="annottext">BinHandle
</span><a href="#local-6989586621680990433"><span class="hs-identifier hs-var">bh</span></a></span><span> </span><span class="annot"><span class="annottext">Word8
</span><span class="hs-number">2</span></span><span>
</span><span id="line-1858"></span><span>  </span><span class="annot"><a href="GHC.Utils.Binary.html#put_"><span class="hs-identifier hs-var">put_</span></a></span><span> </span><span id="local-6989586621680990432"><span class="annot"><span class="annottext">BinHandle
</span><a href="#local-6989586621680990432"><span class="hs-identifier hs-var">bh</span></a></span></span><span> </span><span class="annot"><span class="annottext">Card
</span><a href="GHC.Types.Demand.html#C_11"><span class="hs-identifier hs-var">C_11</span></a></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">BinHandle -&gt; Word8 -&gt; IO ()
</span><a href="GHC.Utils.Binary.html#putByte"><span class="hs-identifier hs-var">putByte</span></a></span><span> </span><span class="annot"><span class="annottext">BinHandle
</span><a href="#local-6989586621680990432"><span class="hs-identifier hs-var">bh</span></a></span><span> </span><span class="annot"><span class="annottext">Word8
</span><span class="hs-number">3</span></span><span>
</span><span id="line-1859"></span><span>  </span><span class="annot"><a href="GHC.Utils.Binary.html#put_"><span class="hs-identifier hs-var">put_</span></a></span><span> </span><span id="local-6989586621680990431"><span class="annot"><span class="annottext">BinHandle
</span><a href="#local-6989586621680990431"><span class="hs-identifier hs-var">bh</span></a></span></span><span> </span><span class="annot"><span class="annottext">Card
</span><a href="GHC.Types.Demand.html#C_1N"><span class="hs-identifier hs-var">C_1N</span></a></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">BinHandle -&gt; Word8 -&gt; IO ()
</span><a href="GHC.Utils.Binary.html#putByte"><span class="hs-identifier hs-var">putByte</span></a></span><span> </span><span class="annot"><span class="annottext">BinHandle
</span><a href="#local-6989586621680990431"><span class="hs-identifier hs-var">bh</span></a></span><span> </span><span class="annot"><span class="annottext">Word8
</span><span class="hs-number">4</span></span><span>
</span><span id="line-1860"></span><span>  </span><span class="annot"><a href="GHC.Utils.Binary.html#put_"><span class="hs-identifier hs-var">put_</span></a></span><span> </span><span id="local-6989586621680990430"><span class="annot"><span class="annottext">BinHandle
</span><a href="#local-6989586621680990430"><span class="hs-identifier hs-var">bh</span></a></span></span><span> </span><span class="annot"><span class="annottext">Card
</span><a href="GHC.Types.Demand.html#C_10"><span class="hs-identifier hs-var">C_10</span></a></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">BinHandle -&gt; Word8 -&gt; IO ()
</span><a href="GHC.Utils.Binary.html#putByte"><span class="hs-identifier hs-var">putByte</span></a></span><span> </span><span class="annot"><span class="annottext">BinHandle
</span><a href="#local-6989586621680990430"><span class="hs-identifier hs-var">bh</span></a></span><span> </span><span class="annot"><span class="annottext">Word8
</span><span class="hs-number">5</span></span><span>
</span><span id="line-1861"></span><span>  </span><span id="local-6989586621680990402"><span class="annot"><span class="annottext">get :: BinHandle -&gt; IO Card
</span><a href="GHC.Utils.Binary.html#get"><span class="hs-identifier hs-var hs-var hs-var hs-var">get</span></a></span></span><span> </span><span id="local-6989586621680990400"><span class="annot"><span class="annottext">BinHandle
</span><a href="#local-6989586621680990400"><span class="hs-identifier hs-var">bh</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-keyword">do</span><span>
</span><span id="line-1862"></span><span>    </span><span id="local-6989586621680990399"><span class="annot"><span class="annottext">Word8
</span><a href="#local-6989586621680990399"><span class="hs-identifier hs-var">h</span></a></span></span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">BinHandle -&gt; IO Word8
</span><a href="GHC.Utils.Binary.html#getByte"><span class="hs-identifier hs-var">getByte</span></a></span><span> </span><span class="annot"><span class="annottext">BinHandle
</span><a href="#local-6989586621680990400"><span class="hs-identifier hs-var">bh</span></a></span><span>
</span><span id="line-1863"></span><span>    </span><span class="hs-keyword">case</span><span> </span><span class="annot"><span class="annottext">Word8
</span><a href="#local-6989586621680990399"><span class="hs-identifier hs-var">h</span></a></span><span> </span><span class="hs-keyword">of</span><span>
</span><span id="line-1864"></span><span>      </span><span class="annot"><span class="annottext">Word8
</span><span class="hs-number">0</span></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="annottext">forall (m :: * -&gt; *) a. Monad m =&gt; a -&gt; m a
</span><a href="../../base-4.16.4.0/src/GHC-Base.html#return"><span class="hs-identifier hs-var">return</span></a></span><span> </span><span class="annot"><span class="annottext">Card
</span><a href="GHC.Types.Demand.html#C_00"><span class="hs-identifier hs-var">C_00</span></a></span><span>
</span><span id="line-1865"></span><span>      </span><span class="annot"><span class="annottext">Word8
</span><span class="hs-number">1</span></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="annottext">forall (m :: * -&gt; *) a. Monad m =&gt; a -&gt; m a
</span><a href="../../base-4.16.4.0/src/GHC-Base.html#return"><span class="hs-identifier hs-var">return</span></a></span><span> </span><span class="annot"><span class="annottext">Card
</span><a href="GHC.Types.Demand.html#C_01"><span class="hs-identifier hs-var">C_01</span></a></span><span>
</span><span id="line-1866"></span><span>      </span><span class="annot"><span class="annottext">Word8
</span><span class="hs-number">2</span></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="annottext">forall (m :: * -&gt; *) a. Monad m =&gt; a -&gt; m a
</span><a href="../../base-4.16.4.0/src/GHC-Base.html#return"><span class="hs-identifier hs-var">return</span></a></span><span> </span><span class="annot"><span class="annottext">Card
</span><a href="GHC.Types.Demand.html#C_0N"><span class="hs-identifier hs-var">C_0N</span></a></span><span>
</span><span id="line-1867"></span><span>      </span><span class="annot"><span class="annottext">Word8
</span><span class="hs-number">3</span></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="annottext">forall (m :: * -&gt; *) a. Monad m =&gt; a -&gt; m a
</span><a href="../../base-4.16.4.0/src/GHC-Base.html#return"><span class="hs-identifier hs-var">return</span></a></span><span> </span><span class="annot"><span class="annottext">Card
</span><a href="GHC.Types.Demand.html#C_11"><span class="hs-identifier hs-var">C_11</span></a></span><span>
</span><span id="line-1868"></span><span>      </span><span class="annot"><span class="annottext">Word8
</span><span class="hs-number">4</span></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="annottext">forall (m :: * -&gt; *) a. Monad m =&gt; a -&gt; m a
</span><a href="../../base-4.16.4.0/src/GHC-Base.html#return"><span class="hs-identifier hs-var">return</span></a></span><span> </span><span class="annot"><span class="annottext">Card
</span><a href="GHC.Types.Demand.html#C_1N"><span class="hs-identifier hs-var">C_1N</span></a></span><span>
</span><span id="line-1869"></span><span>      </span><span class="annot"><span class="annottext">Word8
</span><span class="hs-number">5</span></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="annottext">forall (m :: * -&gt; *) a. Monad m =&gt; a -&gt; m a
</span><a href="../../base-4.16.4.0/src/GHC-Base.html#return"><span class="hs-identifier hs-var">return</span></a></span><span> </span><span class="annot"><span class="annottext">Card
</span><a href="GHC.Types.Demand.html#C_10"><span class="hs-identifier hs-var">C_10</span></a></span><span>
</span><span id="line-1870"></span><span>      </span><span class="annot"><span class="annottext">Word8
</span><span class="hs-identifier">_</span></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="annottext">forall a. HasCallStack =&gt; String -&gt; SDoc -&gt; a
</span><a href="GHC.Utils.Panic.html#pprPanic"><span class="hs-identifier hs-var">pprPanic</span></a></span><span> </span><span class="annot"><span class="annottext">String
</span><span class="hs-string">&quot;Binary:Card&quot;</span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">forall a. Outputable a =&gt; a -&gt; SDoc
</span><a href="GHC.Utils.Outputable.html#ppr"><span class="hs-identifier hs-var">ppr</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">forall a b. (Integral a, Num b) =&gt; a -&gt; b
</span><a href="../../base-4.16.4.0/src/GHC-Real.html#fromIntegral"><span class="hs-identifier hs-var">fromIntegral</span></a></span><span> </span><span class="annot"><span class="annottext">Word8
</span><a href="#local-6989586621680990399"><span class="hs-identifier hs-var">h</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><span class="hs-identifier hs-type">Int</span></span><span class="hs-special">)</span><span class="hs-special">)</span><span>
</span><span id="line-1871"></span><span>
</span><span id="line-1872"></span><span class="hs-keyword">instance</span><span> </span><span id="local-6989586621680990395"><span class="annot"><a href="GHC.Utils.Binary.html#Binary"><span class="hs-identifier hs-type">Binary</span></a></span><span> </span><span class="annot"><a href="GHC.Types.Demand.html#Demand"><span class="hs-identifier hs-type">Demand</span></a></span></span><span> </span><span class="hs-keyword">where</span><span>
</span><span id="line-1873"></span><span>  </span><span id="local-6989586621680990389"><span class="annot"><span class="annottext">put_ :: BinHandle -&gt; Demand -&gt; IO ()
</span><a href="#local-6989586621680990389"><span class="hs-identifier hs-var hs-var hs-var hs-var">put_</span></a></span></span><span> </span><span id="local-6989586621680990388"><span class="annot"><span class="annottext">BinHandle
</span><a href="#local-6989586621680990388"><span class="hs-identifier hs-var">bh</span></a></span></span><span> </span><span class="hs-special">(</span><span id="local-6989586621680990387"><span class="annot"><span class="annottext">Card
</span><a href="#local-6989586621680990387"><span class="hs-identifier hs-var">n</span></a></span></span><span> </span><span class="annot"><a href="GHC.Types.Demand.html#%3A%2A"><span class="hs-operator hs-type">:*</span></a></span><span> </span><span id="local-6989586621680990386"><span class="annot"><span class="annottext">SubDemand
</span><a href="#local-6989586621680990386"><span class="hs-identifier hs-var">sd</span></a></span></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">forall a. Binary a =&gt; BinHandle -&gt; a -&gt; IO ()
</span><a href="GHC.Utils.Binary.html#put_"><span class="hs-identifier hs-var">put_</span></a></span><span> </span><span class="annot"><span class="annottext">BinHandle
</span><a href="#local-6989586621680990388"><span class="hs-identifier hs-var">bh</span></a></span><span> </span><span class="annot"><span class="annottext">Card
</span><a href="#local-6989586621680990387"><span class="hs-identifier hs-var">n</span></a></span><span> </span><span class="annot"><span class="annottext">forall (f :: * -&gt; *) a b. Applicative f =&gt; f a -&gt; f b -&gt; f b
</span><a href="../../base-4.16.4.0/src/GHC-Base.html#%2A%3E"><span class="hs-operator hs-var">*&gt;</span></a></span><span> </span><span class="annot"><span class="annottext">forall a. Binary a =&gt; BinHandle -&gt; a -&gt; IO ()
</span><a href="GHC.Utils.Binary.html#put_"><span class="hs-identifier hs-var">put_</span></a></span><span> </span><span class="annot"><span class="annottext">BinHandle
</span><a href="#local-6989586621680990388"><span class="hs-identifier hs-var">bh</span></a></span><span> </span><span class="annot"><span class="annottext">SubDemand
</span><a href="#local-6989586621680990386"><span class="hs-identifier hs-var">sd</span></a></span><span>
</span><span id="line-1874"></span><span>  </span><span id="local-6989586621680990380"><span class="annot"><span class="annottext">get :: BinHandle -&gt; IO Demand
</span><a href="#local-6989586621680990380"><span class="hs-identifier hs-var hs-var hs-var hs-var">get</span></a></span></span><span> </span><span id="local-6989586621680990379"><span class="annot"><span class="annottext">BinHandle
</span><a href="#local-6989586621680990379"><span class="hs-identifier hs-var">bh</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">Card -&gt; SubDemand -&gt; Demand
</span><a href="GHC.Types.Demand.html#%3A%2A"><span class="hs-operator hs-var">(:*)</span></a></span><span> </span><span class="annot"><span class="annottext">forall (f :: * -&gt; *) a b. Functor f =&gt; (a -&gt; b) -&gt; f a -&gt; f b
</span><a href="../../base-4.16.4.0/src/Data-Functor.html#%3C%24%3E"><span class="hs-operator hs-var">&lt;$&gt;</span></a></span><span> </span><span class="annot"><span class="annottext">forall a. Binary a =&gt; BinHandle -&gt; IO a
</span><a href="GHC.Utils.Binary.html#get"><span class="hs-identifier hs-var">get</span></a></span><span> </span><span class="annot"><span class="annottext">BinHandle
</span><a href="#local-6989586621680990379"><span class="hs-identifier hs-var">bh</span></a></span><span> </span><span class="annot"><span class="annottext">forall (f :: * -&gt; *) a b. Applicative f =&gt; f (a -&gt; b) -&gt; f a -&gt; f b
</span><a href="../../base-4.16.4.0/src/GHC-Base.html#%3C%2A%3E"><span class="hs-operator hs-var">&lt;*&gt;</span></a></span><span> </span><span class="annot"><span class="annottext">forall a. Binary a =&gt; BinHandle -&gt; IO a
</span><a href="GHC.Utils.Binary.html#get"><span class="hs-identifier hs-var">get</span></a></span><span> </span><span class="annot"><span class="annottext">BinHandle
</span><a href="#local-6989586621680990379"><span class="hs-identifier hs-var">bh</span></a></span><span>
</span><span id="line-1875"></span><span>
</span><span id="line-1876"></span><span class="hs-keyword">instance</span><span> </span><span id="local-6989586621680990375"><span class="annot"><a href="GHC.Utils.Binary.html#Binary"><span class="hs-identifier hs-type">Binary</span></a></span><span> </span><span class="annot"><a href="GHC.Types.Demand.html#SubDemand"><span class="hs-identifier hs-type">SubDemand</span></a></span></span><span> </span><span class="hs-keyword">where</span><span>
</span><span id="line-1877"></span><span>  </span><span id="local-6989586621680990360"><span class="annot"><span class="annottext">put_ :: BinHandle -&gt; SubDemand -&gt; IO ()
</span><a href="#local-6989586621680990360"><span class="hs-identifier hs-var hs-var hs-var hs-var">put_</span></a></span></span><span> </span><span id="local-6989586621680990359"><span class="annot"><span class="annottext">BinHandle
</span><a href="#local-6989586621680990359"><span class="hs-identifier hs-var">bh</span></a></span></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="GHC.Types.Demand.html#Poly"><span class="hs-identifier hs-type">Poly</span></a></span><span> </span><span id="local-6989586621680990358"><span class="annot"><span class="annottext">Card
</span><a href="#local-6989586621680990358"><span class="hs-identifier hs-var">sd</span></a></span></span><span class="hs-special">)</span><span>   </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">BinHandle -&gt; Word8 -&gt; IO ()
</span><a href="GHC.Utils.Binary.html#putByte"><span class="hs-identifier hs-var">putByte</span></a></span><span> </span><span class="annot"><span class="annottext">BinHandle
</span><a href="#local-6989586621680990359"><span class="hs-identifier hs-var">bh</span></a></span><span> </span><span class="annot"><span class="annottext">Word8
</span><span class="hs-number">0</span></span><span> </span><span class="annot"><span class="annottext">forall (f :: * -&gt; *) a b. Applicative f =&gt; f a -&gt; f b -&gt; f b
</span><a href="../../base-4.16.4.0/src/GHC-Base.html#%2A%3E"><span class="hs-operator hs-var">*&gt;</span></a></span><span> </span><span class="annot"><span class="annottext">forall a. Binary a =&gt; BinHandle -&gt; a -&gt; IO ()
</span><a href="GHC.Utils.Binary.html#put_"><span class="hs-identifier hs-var">put_</span></a></span><span> </span><span class="annot"><span class="annottext">BinHandle
</span><a href="#local-6989586621680990359"><span class="hs-identifier hs-var">bh</span></a></span><span> </span><span class="annot"><span class="annottext">Card
</span><a href="#local-6989586621680990358"><span class="hs-identifier hs-var">sd</span></a></span><span>
</span><span id="line-1878"></span><span>  </span><span class="annot"><a href="GHC.Utils.Binary.html#put_"><span class="hs-identifier hs-var">put_</span></a></span><span> </span><span id="local-6989586621680990357"><span class="annot"><span class="annottext">BinHandle
</span><a href="#local-6989586621680990357"><span class="hs-identifier hs-var">bh</span></a></span></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="GHC.Types.Demand.html#Call"><span class="hs-identifier hs-type">Call</span></a></span><span> </span><span id="local-6989586621680990356"><span class="annot"><span class="annottext">Card
</span><a href="#local-6989586621680990356"><span class="hs-identifier hs-var">n</span></a></span></span><span> </span><span id="local-6989586621680990355"><span class="annot"><span class="annottext">SubDemand
</span><a href="#local-6989586621680990355"><span class="hs-identifier hs-var">sd</span></a></span></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">BinHandle -&gt; Word8 -&gt; IO ()
</span><a href="GHC.Utils.Binary.html#putByte"><span class="hs-identifier hs-var">putByte</span></a></span><span> </span><span class="annot"><span class="annottext">BinHandle
</span><a href="#local-6989586621680990357"><span class="hs-identifier hs-var">bh</span></a></span><span> </span><span class="annot"><span class="annottext">Word8
</span><span class="hs-number">1</span></span><span> </span><span class="annot"><span class="annottext">forall (f :: * -&gt; *) a b. Applicative f =&gt; f a -&gt; f b -&gt; f b
</span><a href="../../base-4.16.4.0/src/GHC-Base.html#%2A%3E"><span class="hs-operator hs-var">*&gt;</span></a></span><span> </span><span class="annot"><span class="annottext">forall a. Binary a =&gt; BinHandle -&gt; a -&gt; IO ()
</span><a href="GHC.Utils.Binary.html#put_"><span class="hs-identifier hs-var">put_</span></a></span><span> </span><span class="annot"><span class="annottext">BinHandle
</span><a href="#local-6989586621680990357"><span class="hs-identifier hs-var">bh</span></a></span><span> </span><span class="annot"><span class="annottext">Card
</span><a href="#local-6989586621680990356"><span class="hs-identifier hs-var">n</span></a></span><span> </span><span class="annot"><span class="annottext">forall (f :: * -&gt; *) a b. Applicative f =&gt; f a -&gt; f b -&gt; f b
</span><a href="../../base-4.16.4.0/src/GHC-Base.html#%2A%3E"><span class="hs-operator hs-var">*&gt;</span></a></span><span> </span><span class="annot"><span class="annottext">forall a. Binary a =&gt; BinHandle -&gt; a -&gt; IO ()
</span><a href="GHC.Utils.Binary.html#put_"><span class="hs-identifier hs-var">put_</span></a></span><span> </span><span class="annot"><span class="annottext">BinHandle
</span><a href="#local-6989586621680990357"><span class="hs-identifier hs-var">bh</span></a></span><span> </span><span class="annot"><span class="annottext">SubDemand
</span><a href="#local-6989586621680990355"><span class="hs-identifier hs-var">sd</span></a></span><span>
</span><span id="line-1879"></span><span>  </span><span class="annot"><a href="GHC.Utils.Binary.html#put_"><span class="hs-identifier hs-var">put_</span></a></span><span> </span><span id="local-6989586621680990354"><span class="annot"><span class="annottext">BinHandle
</span><a href="#local-6989586621680990354"><span class="hs-identifier hs-var">bh</span></a></span></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="GHC.Types.Demand.html#Prod"><span class="hs-identifier hs-type">Prod</span></a></span><span> </span><span id="local-6989586621680990353"><span class="annot"><span class="annottext">[Demand]
</span><a href="#local-6989586621680990353"><span class="hs-identifier hs-var">ds</span></a></span></span><span class="hs-special">)</span><span>   </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">BinHandle -&gt; Word8 -&gt; IO ()
</span><a href="GHC.Utils.Binary.html#putByte"><span class="hs-identifier hs-var">putByte</span></a></span><span> </span><span class="annot"><span class="annottext">BinHandle
</span><a href="#local-6989586621680990354"><span class="hs-identifier hs-var">bh</span></a></span><span> </span><span class="annot"><span class="annottext">Word8
</span><span class="hs-number">2</span></span><span> </span><span class="annot"><span class="annottext">forall (f :: * -&gt; *) a b. Applicative f =&gt; f a -&gt; f b -&gt; f b
</span><a href="../../base-4.16.4.0/src/GHC-Base.html#%2A%3E"><span class="hs-operator hs-var">*&gt;</span></a></span><span> </span><span class="annot"><span class="annottext">forall a. Binary a =&gt; BinHandle -&gt; a -&gt; IO ()
</span><a href="GHC.Utils.Binary.html#put_"><span class="hs-identifier hs-var">put_</span></a></span><span> </span><span class="annot"><span class="annottext">BinHandle
</span><a href="#local-6989586621680990354"><span class="hs-identifier hs-var">bh</span></a></span><span> </span><span class="annot"><span class="annottext">[Demand]
</span><a href="#local-6989586621680990353"><span class="hs-identifier hs-var">ds</span></a></span><span>
</span><span id="line-1880"></span><span>  </span><span id="local-6989586621680990331"><span class="annot"><span class="annottext">get :: BinHandle -&gt; IO SubDemand
</span><a href="#local-6989586621680990331"><span class="hs-identifier hs-var hs-var hs-var hs-var">get</span></a></span></span><span> </span><span id="local-6989586621680990330"><span class="annot"><span class="annottext">BinHandle
</span><a href="#local-6989586621680990330"><span class="hs-identifier hs-var">bh</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-keyword">do</span><span>
</span><span id="line-1881"></span><span>    </span><span id="local-6989586621680990329"><span class="annot"><span class="annottext">Word8
</span><a href="#local-6989586621680990329"><span class="hs-identifier hs-var">h</span></a></span></span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">BinHandle -&gt; IO Word8
</span><a href="GHC.Utils.Binary.html#getByte"><span class="hs-identifier hs-var">getByte</span></a></span><span> </span><span class="annot"><span class="annottext">BinHandle
</span><a href="#local-6989586621680990330"><span class="hs-identifier hs-var">bh</span></a></span><span>
</span><span id="line-1882"></span><span>    </span><span class="hs-keyword">case</span><span> </span><span class="annot"><span class="annottext">Word8
</span><a href="#local-6989586621680990329"><span class="hs-identifier hs-var">h</span></a></span><span> </span><span class="hs-keyword">of</span><span>
</span><span id="line-1883"></span><span>      </span><span class="annot"><span class="annottext">Word8
</span><span class="hs-number">0</span></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="annottext">Card -&gt; SubDemand
</span><a href="GHC.Types.Demand.html#Poly"><span class="hs-identifier hs-var">Poly</span></a></span><span> </span><span class="annot"><span class="annottext">forall (f :: * -&gt; *) a b. Functor f =&gt; (a -&gt; b) -&gt; f a -&gt; f b
</span><a href="../../base-4.16.4.0/src/Data-Functor.html#%3C%24%3E"><span class="hs-operator hs-var">&lt;$&gt;</span></a></span><span> </span><span class="annot"><span class="annottext">forall a. Binary a =&gt; BinHandle -&gt; IO a
</span><a href="GHC.Utils.Binary.html#get"><span class="hs-identifier hs-var">get</span></a></span><span> </span><span class="annot"><span class="annottext">BinHandle
</span><a href="#local-6989586621680990330"><span class="hs-identifier hs-var">bh</span></a></span><span>
</span><span id="line-1884"></span><span>      </span><span class="annot"><span class="annottext">Word8
</span><span class="hs-number">1</span></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="annottext">Card -&gt; SubDemand -&gt; SubDemand
</span><a href="GHC.Types.Demand.html#mkCall"><span class="hs-identifier hs-var">mkCall</span></a></span><span> </span><span class="annot"><span class="annottext">forall (f :: * -&gt; *) a b. Functor f =&gt; (a -&gt; b) -&gt; f a -&gt; f b
</span><a href="../../base-4.16.4.0/src/Data-Functor.html#%3C%24%3E"><span class="hs-operator hs-var">&lt;$&gt;</span></a></span><span> </span><span class="annot"><span class="annottext">forall a. Binary a =&gt; BinHandle -&gt; IO a
</span><a href="GHC.Utils.Binary.html#get"><span class="hs-identifier hs-var">get</span></a></span><span> </span><span class="annot"><span class="annottext">BinHandle
</span><a href="#local-6989586621680990330"><span class="hs-identifier hs-var">bh</span></a></span><span> </span><span class="annot"><span class="annottext">forall (f :: * -&gt; *) a b. Applicative f =&gt; f (a -&gt; b) -&gt; f a -&gt; f b
</span><a href="../../base-4.16.4.0/src/GHC-Base.html#%3C%2A%3E"><span class="hs-operator hs-var">&lt;*&gt;</span></a></span><span> </span><span class="annot"><span class="annottext">forall a. Binary a =&gt; BinHandle -&gt; IO a
</span><a href="GHC.Utils.Binary.html#get"><span class="hs-identifier hs-var">get</span></a></span><span> </span><span class="annot"><span class="annottext">BinHandle
</span><a href="#local-6989586621680990330"><span class="hs-identifier hs-var">bh</span></a></span><span>
</span><span id="line-1885"></span><span>      </span><span class="annot"><span class="annottext">Word8
</span><span class="hs-number">2</span></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="annottext">[Demand] -&gt; SubDemand
</span><a href="GHC.Types.Demand.html#Prod"><span class="hs-identifier hs-var">Prod</span></a></span><span> </span><span class="annot"><span class="annottext">forall (f :: * -&gt; *) a b. Functor f =&gt; (a -&gt; b) -&gt; f a -&gt; f b
</span><a href="../../base-4.16.4.0/src/Data-Functor.html#%3C%24%3E"><span class="hs-operator hs-var">&lt;$&gt;</span></a></span><span> </span><span class="annot"><span class="annottext">forall a. Binary a =&gt; BinHandle -&gt; IO a
</span><a href="GHC.Utils.Binary.html#get"><span class="hs-identifier hs-var">get</span></a></span><span> </span><span class="annot"><span class="annottext">BinHandle
</span><a href="#local-6989586621680990330"><span class="hs-identifier hs-var">bh</span></a></span><span>
</span><span id="line-1886"></span><span>      </span><span class="annot"><span class="annottext">Word8
</span><span class="hs-identifier">_</span></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="annottext">forall a. HasCallStack =&gt; String -&gt; SDoc -&gt; a
</span><a href="GHC.Utils.Panic.html#pprPanic"><span class="hs-identifier hs-var">pprPanic</span></a></span><span> </span><span class="annot"><span class="annottext">String
</span><span class="hs-string">&quot;Binary:SubDemand&quot;</span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">forall a. Outputable a =&gt; a -&gt; SDoc
</span><a href="GHC.Utils.Outputable.html#ppr"><span class="hs-identifier hs-var">ppr</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">forall a b. (Integral a, Num b) =&gt; a -&gt; b
</span><a href="../../base-4.16.4.0/src/GHC-Real.html#fromIntegral"><span class="hs-identifier hs-var">fromIntegral</span></a></span><span> </span><span class="annot"><span class="annottext">Word8
</span><a href="#local-6989586621680990329"><span class="hs-identifier hs-var">h</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><span class="hs-identifier hs-type">Int</span></span><span class="hs-special">)</span><span class="hs-special">)</span><span>
</span><span id="line-1887"></span><span>
</span><span id="line-1888"></span><span class="hs-keyword">instance</span><span> </span><span id="local-6989586621680990326"><span class="annot"><a href="GHC.Utils.Binary.html#Binary"><span class="hs-identifier hs-type">Binary</span></a></span><span> </span><span class="annot"><a href="GHC.Types.Demand.html#StrictSig"><span class="hs-identifier hs-type">StrictSig</span></a></span></span><span> </span><span class="hs-keyword">where</span><span>
</span><span id="line-1889"></span><span>  </span><span id="local-6989586621680990323"><span class="annot"><span class="annottext">put_ :: BinHandle -&gt; StrictSig -&gt; IO ()
</span><a href="#local-6989586621680990323"><span class="hs-identifier hs-var hs-var hs-var hs-var">put_</span></a></span></span><span> </span><span id="local-6989586621680990322"><span class="annot"><span class="annottext">BinHandle
</span><a href="#local-6989586621680990322"><span class="hs-identifier hs-var">bh</span></a></span></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="GHC.Types.Demand.html#StrictSig"><span class="hs-identifier hs-type">StrictSig</span></a></span><span> </span><span id="local-6989586621680990321"><span class="annot"><span class="annottext">DmdType
</span><a href="#local-6989586621680990321"><span class="hs-identifier hs-var">aa</span></a></span></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">forall a. Binary a =&gt; BinHandle -&gt; a -&gt; IO ()
</span><a href="GHC.Utils.Binary.html#put_"><span class="hs-identifier hs-var">put_</span></a></span><span> </span><span class="annot"><span class="annottext">BinHandle
</span><a href="#local-6989586621680990322"><span class="hs-identifier hs-var">bh</span></a></span><span> </span><span class="annot"><span class="annottext">DmdType
</span><a href="#local-6989586621680990321"><span class="hs-identifier hs-var">aa</span></a></span><span>
</span><span id="line-1890"></span><span>  </span><span id="local-6989586621680990318"><span class="annot"><span class="annottext">get :: BinHandle -&gt; IO StrictSig
</span><a href="#local-6989586621680990318"><span class="hs-identifier hs-var hs-var hs-var hs-var">get</span></a></span></span><span> </span><span id="local-6989586621680990317"><span class="annot"><span class="annottext">BinHandle
</span><a href="#local-6989586621680990317"><span class="hs-identifier hs-var">bh</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">DmdType -&gt; StrictSig
</span><a href="GHC.Types.Demand.html#StrictSig"><span class="hs-identifier hs-var">StrictSig</span></a></span><span> </span><span class="annot"><span class="annottext">forall (f :: * -&gt; *) a b. Functor f =&gt; (a -&gt; b) -&gt; f a -&gt; f b
</span><a href="../../base-4.16.4.0/src/Data-Functor.html#%3C%24%3E"><span class="hs-operator hs-var">&lt;$&gt;</span></a></span><span> </span><span class="annot"><span class="annottext">forall a. Binary a =&gt; BinHandle -&gt; IO a
</span><a href="GHC.Utils.Binary.html#get"><span class="hs-identifier hs-var">get</span></a></span><span> </span><span class="annot"><span class="annottext">BinHandle
</span><a href="#local-6989586621680990317"><span class="hs-identifier hs-var">bh</span></a></span><span>
</span><span id="line-1891"></span><span>
</span><span id="line-1892"></span><span class="hs-keyword">instance</span><span> </span><span id="local-6989586621680990314"><span class="annot"><a href="GHC.Utils.Binary.html#Binary"><span class="hs-identifier hs-type">Binary</span></a></span><span> </span><span class="annot"><a href="GHC.Types.Demand.html#DmdType"><span class="hs-identifier hs-type">DmdType</span></a></span></span><span> </span><span class="hs-keyword">where</span><span>
</span><span id="line-1893"></span><span>  </span><span class="hs-comment">-- Ignore DmdEnv when spitting out the DmdType</span><span>
</span><span id="line-1894"></span><span>  </span><span id="local-6989586621680990308"><span class="annot"><span class="annottext">put_ :: BinHandle -&gt; DmdType -&gt; IO ()
</span><a href="#local-6989586621680990308"><span class="hs-identifier hs-var hs-var hs-var hs-var">put_</span></a></span></span><span> </span><span id="local-6989586621680990307"><span class="annot"><span class="annottext">BinHandle
</span><a href="#local-6989586621680990307"><span class="hs-identifier hs-var">bh</span></a></span></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="GHC.Types.Demand.html#DmdType"><span class="hs-identifier hs-type">DmdType</span></a></span><span> </span><span class="annot"><span class="annottext">DmdEnv
</span><span class="hs-identifier">_</span></span><span> </span><span id="local-6989586621680990306"><span class="annot"><span class="annottext">[Demand]
</span><a href="#local-6989586621680990306"><span class="hs-identifier hs-var">ds</span></a></span></span><span> </span><span id="local-6989586621680990305"><span class="annot"><span class="annottext">Divergence
</span><a href="#local-6989586621680990305"><span class="hs-identifier hs-var">dr</span></a></span></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">forall a. Binary a =&gt; BinHandle -&gt; a -&gt; IO ()
</span><a href="GHC.Utils.Binary.html#put_"><span class="hs-identifier hs-var">put_</span></a></span><span> </span><span class="annot"><span class="annottext">BinHandle
</span><a href="#local-6989586621680990307"><span class="hs-identifier hs-var">bh</span></a></span><span> </span><span class="annot"><span class="annottext">[Demand]
</span><a href="#local-6989586621680990306"><span class="hs-identifier hs-var">ds</span></a></span><span> </span><span class="annot"><span class="annottext">forall (f :: * -&gt; *) a b. Applicative f =&gt; f a -&gt; f b -&gt; f b
</span><a href="../../base-4.16.4.0/src/GHC-Base.html#%2A%3E"><span class="hs-operator hs-var">*&gt;</span></a></span><span> </span><span class="annot"><span class="annottext">forall a. Binary a =&gt; BinHandle -&gt; a -&gt; IO ()
</span><a href="GHC.Utils.Binary.html#put_"><span class="hs-identifier hs-var">put_</span></a></span><span> </span><span class="annot"><span class="annottext">BinHandle
</span><a href="#local-6989586621680990307"><span class="hs-identifier hs-var">bh</span></a></span><span> </span><span class="annot"><span class="annottext">Divergence
</span><a href="#local-6989586621680990305"><span class="hs-identifier hs-var">dr</span></a></span><span>
</span><span id="line-1895"></span><span>  </span><span id="local-6989586621680990299"><span class="annot"><span class="annottext">get :: BinHandle -&gt; IO DmdType
</span><a href="#local-6989586621680990299"><span class="hs-identifier hs-var hs-var hs-var hs-var">get</span></a></span></span><span> </span><span id="local-6989586621680990298"><span class="annot"><span class="annottext">BinHandle
</span><a href="#local-6989586621680990298"><span class="hs-identifier hs-var">bh</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">DmdEnv -&gt; [Demand] -&gt; Divergence -&gt; DmdType
</span><a href="GHC.Types.Demand.html#DmdType"><span class="hs-identifier hs-var">DmdType</span></a></span><span> </span><span class="annot"><span class="annottext">DmdEnv
</span><a href="GHC.Types.Demand.html#emptyDmdEnv"><span class="hs-identifier hs-var">emptyDmdEnv</span></a></span><span> </span><span class="annot"><span class="annottext">forall (f :: * -&gt; *) a b. Functor f =&gt; (a -&gt; b) -&gt; f a -&gt; f b
</span><a href="../../base-4.16.4.0/src/Data-Functor.html#%3C%24%3E"><span class="hs-operator hs-var">&lt;$&gt;</span></a></span><span> </span><span class="annot"><span class="annottext">forall a. Binary a =&gt; BinHandle -&gt; IO a
</span><a href="GHC.Utils.Binary.html#get"><span class="hs-identifier hs-var">get</span></a></span><span> </span><span class="annot"><span class="annottext">BinHandle
</span><a href="#local-6989586621680990298"><span class="hs-identifier hs-var">bh</span></a></span><span> </span><span class="annot"><span class="annottext">forall (f :: * -&gt; *) a b. Applicative f =&gt; f (a -&gt; b) -&gt; f a -&gt; f b
</span><a href="../../base-4.16.4.0/src/GHC-Base.html#%3C%2A%3E"><span class="hs-operator hs-var">&lt;*&gt;</span></a></span><span> </span><span class="annot"><span class="annottext">forall a. Binary a =&gt; BinHandle -&gt; IO a
</span><a href="GHC.Utils.Binary.html#get"><span class="hs-identifier hs-var">get</span></a></span><span> </span><span class="annot"><span class="annottext">BinHandle
</span><a href="#local-6989586621680990298"><span class="hs-identifier hs-var">bh</span></a></span><span>
</span><span id="line-1896"></span><span>
</span><span id="line-1897"></span><span class="hs-keyword">instance</span><span> </span><span id="local-6989586621680990295"><span class="annot"><a href="GHC.Utils.Binary.html#Binary"><span class="hs-identifier hs-type">Binary</span></a></span><span> </span><span class="annot"><a href="GHC.Types.Demand.html#Divergence"><span class="hs-identifier hs-type">Divergence</span></a></span></span><span> </span><span class="hs-keyword">where</span><span>
</span><span id="line-1898"></span><span>  </span><span id="local-6989586621680990290"><span class="annot"><span class="annottext">put_ :: BinHandle -&gt; Divergence -&gt; IO ()
</span><a href="#local-6989586621680990290"><span class="hs-identifier hs-var hs-var hs-var hs-var">put_</span></a></span></span><span> </span><span id="local-6989586621680990289"><span class="annot"><span class="annottext">BinHandle
</span><a href="#local-6989586621680990289"><span class="hs-identifier hs-var">bh</span></a></span></span><span> </span><span class="annot"><span class="annottext">Divergence
</span><a href="GHC.Types.Demand.html#Dunno"><span class="hs-identifier hs-var">Dunno</span></a></span><span>    </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">BinHandle -&gt; Word8 -&gt; IO ()
</span><a href="GHC.Utils.Binary.html#putByte"><span class="hs-identifier hs-var">putByte</span></a></span><span> </span><span class="annot"><span class="annottext">BinHandle
</span><a href="#local-6989586621680990289"><span class="hs-identifier hs-var">bh</span></a></span><span> </span><span class="annot"><span class="annottext">Word8
</span><span class="hs-number">0</span></span><span>
</span><span id="line-1899"></span><span>  </span><span class="annot"><a href="GHC.Utils.Binary.html#put_"><span class="hs-identifier hs-var">put_</span></a></span><span> </span><span id="local-6989586621680990288"><span class="annot"><span class="annottext">BinHandle
</span><a href="#local-6989586621680990288"><span class="hs-identifier hs-var">bh</span></a></span></span><span> </span><span class="annot"><span class="annottext">Divergence
</span><a href="GHC.Types.Demand.html#ExnOrDiv"><span class="hs-identifier hs-var">ExnOrDiv</span></a></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">BinHandle -&gt; Word8 -&gt; IO ()
</span><a href="GHC.Utils.Binary.html#putByte"><span class="hs-identifier hs-var">putByte</span></a></span><span> </span><span class="annot"><span class="annottext">BinHandle
</span><a href="#local-6989586621680990288"><span class="hs-identifier hs-var">bh</span></a></span><span> </span><span class="annot"><span class="annottext">Word8
</span><span class="hs-number">1</span></span><span>
</span><span id="line-1900"></span><span>  </span><span class="annot"><a href="GHC.Utils.Binary.html#put_"><span class="hs-identifier hs-var">put_</span></a></span><span> </span><span id="local-6989586621680990287"><span class="annot"><span class="annottext">BinHandle
</span><a href="#local-6989586621680990287"><span class="hs-identifier hs-var">bh</span></a></span></span><span> </span><span class="annot"><span class="annottext">Divergence
</span><a href="GHC.Types.Demand.html#Diverges"><span class="hs-identifier hs-var">Diverges</span></a></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">BinHandle -&gt; Word8 -&gt; IO ()
</span><a href="GHC.Utils.Binary.html#putByte"><span class="hs-identifier hs-var">putByte</span></a></span><span> </span><span class="annot"><span class="annottext">BinHandle
</span><a href="#local-6989586621680990287"><span class="hs-identifier hs-var">bh</span></a></span><span> </span><span class="annot"><span class="annottext">Word8
</span><span class="hs-number">2</span></span><span>
</span><span id="line-1901"></span><span>  </span><span id="local-6989586621680990271"><span class="annot"><span class="annottext">get :: BinHandle -&gt; IO Divergence
</span><a href="#local-6989586621680990271"><span class="hs-identifier hs-var hs-var hs-var hs-var">get</span></a></span></span><span> </span><span id="local-6989586621680990270"><span class="annot"><span class="annottext">BinHandle
</span><a href="#local-6989586621680990270"><span class="hs-identifier hs-var">bh</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-keyword">do</span><span>
</span><span id="line-1902"></span><span>    </span><span id="local-6989586621680990269"><span class="annot"><span class="annottext">Word8
</span><a href="#local-6989586621680990269"><span class="hs-identifier hs-var">h</span></a></span></span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">BinHandle -&gt; IO Word8
</span><a href="GHC.Utils.Binary.html#getByte"><span class="hs-identifier hs-var">getByte</span></a></span><span> </span><span class="annot"><span class="annottext">BinHandle
</span><a href="#local-6989586621680990270"><span class="hs-identifier hs-var">bh</span></a></span><span>
</span><span id="line-1903"></span><span>    </span><span class="hs-keyword">case</span><span> </span><span class="annot"><span class="annottext">Word8
</span><a href="#local-6989586621680990269"><span class="hs-identifier hs-var">h</span></a></span><span> </span><span class="hs-keyword">of</span><span>
</span><span id="line-1904"></span><span>      </span><span class="annot"><span class="annottext">Word8
</span><span class="hs-number">0</span></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="annottext">forall (m :: * -&gt; *) a. Monad m =&gt; a -&gt; m a
</span><a href="../../base-4.16.4.0/src/GHC-Base.html#return"><span class="hs-identifier hs-var">return</span></a></span><span> </span><span class="annot"><span class="annottext">Divergence
</span><a href="GHC.Types.Demand.html#Dunno"><span class="hs-identifier hs-var">Dunno</span></a></span><span>
</span><span id="line-1905"></span><span>      </span><span class="annot"><span class="annottext">Word8
</span><span class="hs-number">1</span></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="annottext">forall (m :: * -&gt; *) a. Monad m =&gt; a -&gt; m a
</span><a href="../../base-4.16.4.0/src/GHC-Base.html#return"><span class="hs-identifier hs-var">return</span></a></span><span> </span><span class="annot"><span class="annottext">Divergence
</span><a href="GHC.Types.Demand.html#ExnOrDiv"><span class="hs-identifier hs-var">ExnOrDiv</span></a></span><span>
</span><span id="line-1906"></span><span>      </span><span class="annot"><span class="annottext">Word8
</span><span class="hs-number">2</span></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="annottext">forall (m :: * -&gt; *) a. Monad m =&gt; a -&gt; m a
</span><a href="../../base-4.16.4.0/src/GHC-Base.html#return"><span class="hs-identifier hs-var">return</span></a></span><span> </span><span class="annot"><span class="annottext">Divergence
</span><a href="GHC.Types.Demand.html#Diverges"><span class="hs-identifier hs-var">Diverges</span></a></span><span>
</span><span id="line-1907"></span><span>      </span><span class="annot"><span class="annottext">Word8
</span><span class="hs-identifier">_</span></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="annottext">forall a. HasCallStack =&gt; String -&gt; SDoc -&gt; a
</span><a href="GHC.Utils.Panic.html#pprPanic"><span class="hs-identifier hs-var">pprPanic</span></a></span><span> </span><span class="annot"><span class="annottext">String
</span><span class="hs-string">&quot;Binary:Divergence&quot;</span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">forall a. Outputable a =&gt; a -&gt; SDoc
</span><a href="GHC.Utils.Outputable.html#ppr"><span class="hs-identifier hs-var">ppr</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">forall a b. (Integral a, Num b) =&gt; a -&gt; b
</span><a href="../../base-4.16.4.0/src/GHC-Real.html#fromIntegral"><span class="hs-identifier hs-var">fromIntegral</span></a></span><span> </span><span class="annot"><span class="annottext">Word8
</span><a href="#local-6989586621680990269"><span class="hs-identifier hs-var">h</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><span class="hs-identifier hs-type">Int</span></span><span class="hs-special">)</span><span class="hs-special">)</span><span>
</span><span id="line-1908"></span></pre></body></html>