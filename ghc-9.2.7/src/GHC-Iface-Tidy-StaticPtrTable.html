<?xml version="1.0" encoding="UTF-8"?>
<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Strict//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-strict.dtd">
<html>
<head>
<!-- Generated by HsColour, http://code.haskell.org/~malcolm/hscolour/ -->
<title>GHC/Iface/Tidy/StaticPtrTable.hs</title>
<link type='text/css' rel='stylesheet' href='hscolour.css' />
</head>
<body>
<pre><a name="line-1"></a><span class='hs-comment'>{-# LANGUAGE ViewPatterns  #-}</span>
<a name="line-2"></a>
<a name="line-3"></a><span class='hs-comment'>-- | Code generation for the Static Pointer Table</span>
<a name="line-4"></a><span class='hs-comment'>--</span>
<a name="line-5"></a><span class='hs-comment'>-- (c) 2014 I/O Tweag</span>
<a name="line-6"></a><span class='hs-comment'>--</span>
<a name="line-7"></a><span class='hs-comment'>-- Each module that uses 'static' keyword declares an initialization function of</span>
<a name="line-8"></a><span class='hs-comment'>-- the form hs_spt_init_\&lt;module&gt;() which is emitted into the _stub.c file and</span>
<a name="line-9"></a><span class='hs-comment'>-- annotated with __attribute__((constructor)) so that it gets executed at</span>
<a name="line-10"></a><span class='hs-comment'>-- startup time.</span>
<a name="line-11"></a><span class='hs-comment'>--</span>
<a name="line-12"></a><span class='hs-comment'>-- The function's purpose is to call hs_spt_insert to insert the static</span>
<a name="line-13"></a><span class='hs-comment'>-- pointers of this module in the hashtable of the RTS, and it looks something</span>
<a name="line-14"></a><span class='hs-comment'>-- like this:</span>
<a name="line-15"></a><span class='hs-comment'>--</span>
<a name="line-16"></a><span class='hs-comment'>-- &gt; static void hs_hpc_init_Main(void) __attribute__((constructor));</span>
<a name="line-17"></a><span class='hs-comment'>-- &gt; static void hs_hpc_init_Main(void) {</span>
<a name="line-18"></a><span class='hs-comment'>-- &gt;</span>
<a name="line-19"></a><span class='hs-comment'>-- &gt;   static StgWord64 k0[2] = {16252233372134256ULL,7370534374096082ULL};</span>
<a name="line-20"></a><span class='hs-comment'>-- &gt;   extern StgPtr Main_r2wb_closure;</span>
<a name="line-21"></a><span class='hs-comment'>-- &gt;   hs_spt_insert(k0, &amp;Main_r2wb_closure);</span>
<a name="line-22"></a><span class='hs-comment'>-- &gt;</span>
<a name="line-23"></a><span class='hs-comment'>-- &gt;   static StgWord64 k1[2] = {12545634534567898ULL,5409674567544151ULL};</span>
<a name="line-24"></a><span class='hs-comment'>-- &gt;   extern StgPtr Main_r2wc_closure;</span>
<a name="line-25"></a><span class='hs-comment'>-- &gt;   hs_spt_insert(k1, &amp;Main_r2wc_closure);</span>
<a name="line-26"></a><span class='hs-comment'>-- &gt;</span>
<a name="line-27"></a><span class='hs-comment'>-- &gt; }</span>
<a name="line-28"></a><span class='hs-comment'>--</span>
<a name="line-29"></a><span class='hs-comment'>-- where the constants are fingerprints produced from the static forms.</span>
<a name="line-30"></a><span class='hs-comment'>--</span>
<a name="line-31"></a><span class='hs-comment'>-- The linker must find the definitions matching the @extern StgPtr &lt;name&gt;@</span>
<a name="line-32"></a><span class='hs-comment'>-- declarations. For this to work, the identifiers of static pointers need to be</span>
<a name="line-33"></a><span class='hs-comment'>-- exported. This is done in 'GHC.Core.Opt.SetLevels.newLvlVar'.</span>
<a name="line-34"></a><span class='hs-comment'>--</span>
<a name="line-35"></a><span class='hs-comment'>-- There is also a finalization function for the time when the module is</span>
<a name="line-36"></a><span class='hs-comment'>-- unloaded.</span>
<a name="line-37"></a><span class='hs-comment'>--</span>
<a name="line-38"></a><span class='hs-comment'>-- &gt; static void hs_hpc_fini_Main(void) __attribute__((destructor));</span>
<a name="line-39"></a><span class='hs-comment'>-- &gt; static void hs_hpc_fini_Main(void) {</span>
<a name="line-40"></a><span class='hs-comment'>-- &gt;</span>
<a name="line-41"></a><span class='hs-comment'>-- &gt;   static StgWord64 k0[2] = {16252233372134256ULL,7370534374096082ULL};</span>
<a name="line-42"></a><span class='hs-comment'>-- &gt;   hs_spt_remove(k0);</span>
<a name="line-43"></a><span class='hs-comment'>-- &gt;</span>
<a name="line-44"></a><span class='hs-comment'>-- &gt;   static StgWord64 k1[2] = {12545634534567898ULL,5409674567544151ULL};</span>
<a name="line-45"></a><span class='hs-comment'>-- &gt;   hs_spt_remove(k1);</span>
<a name="line-46"></a><span class='hs-comment'>-- &gt;</span>
<a name="line-47"></a><span class='hs-comment'>-- &gt; }</span>
<a name="line-48"></a><span class='hs-comment'>--</span>
<a name="line-49"></a>
<a name="line-50"></a><span class='hs-keyword'>module</span> <span class='hs-conid'>GHC.Iface.Tidy.StaticPtrTable</span>
<a name="line-51"></a>    <span class='hs-layout'>(</span> <span class='hs-varid'>sptCreateStaticBinds</span>
<a name="line-52"></a>    <span class='hs-layout'>,</span> <span class='hs-varid'>sptModuleInitCode</span>
<a name="line-53"></a>    <span class='hs-layout'>)</span> <span class='hs-keyword'>where</span>
<a name="line-54"></a>
<a name="line-55"></a><span class='hs-comment'>{- Note [Grand plan for static forms]
<a name="line-56"></a>~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~
<a name="line-57"></a>Static forms go through the compilation phases as follows.
<a name="line-58"></a>Here is a running example:
<a name="line-59"></a>
<a name="line-60"></a>   f x = let k = map toUpper
<a name="line-61"></a>         in ...(static k)...
<a name="line-62"></a>
<a name="line-63"></a>* The renamer looks for out-of-scope names in the body of the static
<a name="line-64"></a>  form, as always. If all names are in scope, the free variables of the
<a name="line-65"></a>  body are stored in AST at the location of the static form.
<a name="line-66"></a>
<a name="line-67"></a>* The typechecker verifies that all free variables occurring in the
<a name="line-68"></a>  static form are floatable to top level (see Note [Meaning of
<a name="line-69"></a>  IdBindingInfo] in GHC.Tc.Types).  In our example, 'k' is floatable.
<a name="line-70"></a>  Even though it is bound in a nested let, we are fine.
<a name="line-71"></a>
<a name="line-72"></a>* The desugarer replaces the static form with an application of the
<a name="line-73"></a>  function 'makeStatic' (defined in module GHC.StaticPtr.Internal of
<a name="line-74"></a>  base).  So we get
<a name="line-75"></a>
<a name="line-76"></a>   f x = let k = map toUpper
<a name="line-77"></a>         in ...fromStaticPtr (makeStatic location k)...
<a name="line-78"></a>
<a name="line-79"></a>* The simplifier runs the FloatOut pass which moves the calls to 'makeStatic'
<a name="line-80"></a>  to the top level. Thus the FloatOut pass is always executed, even when
<a name="line-81"></a>  optimizations are disabled.  So we get
<a name="line-82"></a>
<a name="line-83"></a>   k = map toUpper
<a name="line-84"></a>   static_ptr = makeStatic location k
<a name="line-85"></a>   f x = ...fromStaticPtr static_ptr...
<a name="line-86"></a>
<a name="line-87"></a>  The FloatOut pass is careful to produce an /exported/ Id for a floated
<a name="line-88"></a>  'makeStatic' call, so the binding is not removed or inlined by the
<a name="line-89"></a>  simplifier.
<a name="line-90"></a>  E.g. the code for `f` above might look like
<a name="line-91"></a>
<a name="line-92"></a>    static_ptr = makeStatic location k
<a name="line-93"></a>    f x = ...(case static_ptr of ...)...
<a name="line-94"></a>
<a name="line-95"></a>  which might be simplified to
<a name="line-96"></a>
<a name="line-97"></a>    f x = ...(case makeStatic location k of ...)...
<a name="line-98"></a>
<a name="line-99"></a>  BUT the top-level binding for static_ptr must remain, so that it can be
<a name="line-100"></a>  collected to populate the Static Pointer Table.
<a name="line-101"></a>
<a name="line-102"></a>  Making the binding exported also has a necessary effect during the
<a name="line-103"></a>  CoreTidy pass.
<a name="line-104"></a>
<a name="line-105"></a>* The CoreTidy pass replaces all bindings of the form
<a name="line-106"></a>
<a name="line-107"></a>  b = /\ ... -&gt; makeStatic location value
<a name="line-108"></a>
<a name="line-109"></a>  with
<a name="line-110"></a>
<a name="line-111"></a>  b = /\ ... -&gt; StaticPtr key (StaticPtrInfo "pkg key" "module" location) value
<a name="line-112"></a>
<a name="line-113"></a>  where a distinct key is generated for each binding.
<a name="line-114"></a>
<a name="line-115"></a>* If we are compiling to object code we insert a C stub (generated by
<a name="line-116"></a>  sptModuleInitCode) into the final object which runs when the module is loaded,
<a name="line-117"></a>  inserting the static forms defined by the module into the RTS's static pointer
<a name="line-118"></a>  table.
<a name="line-119"></a>
<a name="line-120"></a>* If we are compiling for the byte-code interpreter, we instead explicitly add
<a name="line-121"></a>  the SPT entries (recorded in CgGuts' cg_spt_entries field) to the interpreter
<a name="line-122"></a>  process' SPT table using the addSptEntry interpreter message. This happens
<a name="line-123"></a>  in upsweep after we have compiled the module (see GHC.Driver.Make.upsweep').
<a name="line-124"></a>-}</span>
<a name="line-125"></a>
<a name="line-126"></a><span class='hs-keyword'>import</span> <span class='hs-conid'>GHC.Prelude</span>
<a name="line-127"></a><span class='hs-keyword'>import</span> <span class='hs-conid'>GHC.Platform</span>
<a name="line-128"></a>
<a name="line-129"></a><span class='hs-keyword'>import</span> <span class='hs-conid'>GHC.Driver.Session</span>
<a name="line-130"></a><span class='hs-keyword'>import</span> <span class='hs-conid'>GHC.Driver.Env</span>
<a name="line-131"></a>
<a name="line-132"></a><span class='hs-keyword'>import</span> <span class='hs-conid'>GHC.Core</span>
<a name="line-133"></a><span class='hs-keyword'>import</span> <span class='hs-conid'>GHC.Core.Utils</span> <span class='hs-layout'>(</span><span class='hs-varid'>collectMakeStaticArgs</span><span class='hs-layout'>)</span>
<a name="line-134"></a><span class='hs-keyword'>import</span> <span class='hs-conid'>GHC.Core.DataCon</span>
<a name="line-135"></a><span class='hs-keyword'>import</span> <span class='hs-conid'>GHC.Core.Make</span> <span class='hs-layout'>(</span><span class='hs-varid'>mkStringExprFSWith</span><span class='hs-layout'>)</span>
<a name="line-136"></a><span class='hs-keyword'>import</span> <span class='hs-conid'>GHC.Core.Type</span>
<a name="line-137"></a>
<a name="line-138"></a><span class='hs-keyword'>import</span> <span class='hs-conid'>GHC.Cmm.CLabel</span>
<a name="line-139"></a>
<a name="line-140"></a><span class='hs-keyword'>import</span> <span class='hs-conid'>GHC.Unit.Module</span>
<a name="line-141"></a><span class='hs-keyword'>import</span> <span class='hs-conid'>GHC.Utils.Outputable</span> <span class='hs-keyword'>as</span> <span class='hs-conid'>Outputable</span>
<a name="line-142"></a><span class='hs-keyword'>import</span> <span class='hs-conid'>GHC.Utils.Panic</span>
<a name="line-143"></a><span class='hs-keyword'>import</span> <span class='hs-conid'>GHC.Builtin.Names</span>
<a name="line-144"></a><span class='hs-keyword'>import</span> <span class='hs-conid'>GHC.Tc.Utils.Env</span> <span class='hs-layout'>(</span><span class='hs-varid'>lookupGlobal</span><span class='hs-layout'>)</span>
<a name="line-145"></a>
<a name="line-146"></a><span class='hs-keyword'>import</span> <span class='hs-conid'>GHC.Linker.Types</span>
<a name="line-147"></a>
<a name="line-148"></a><span class='hs-keyword'>import</span> <span class='hs-conid'>GHC.Types.Name</span>
<a name="line-149"></a><span class='hs-keyword'>import</span> <span class='hs-conid'>GHC.Types.Id</span>
<a name="line-150"></a><span class='hs-keyword'>import</span> <span class='hs-conid'>GHC.Types.TyThing</span>
<a name="line-151"></a><span class='hs-keyword'>import</span> <span class='hs-conid'>GHC.Types.ForeignStubs</span>
<a name="line-152"></a>
<a name="line-153"></a><span class='hs-keyword'>import</span> <span class='hs-conid'>Control.Monad.Trans.Class</span> <span class='hs-layout'>(</span><span class='hs-varid'>lift</span><span class='hs-layout'>)</span>
<a name="line-154"></a><span class='hs-keyword'>import</span> <span class='hs-conid'>Control.Monad.Trans.State</span>
<a name="line-155"></a><span class='hs-keyword'>import</span> <span class='hs-conid'>Data.List</span> <span class='hs-layout'>(</span><span class='hs-varid'>intercalate</span><span class='hs-layout'>)</span>
<a name="line-156"></a><span class='hs-keyword'>import</span> <span class='hs-conid'>Data.Maybe</span>
<a name="line-157"></a><span class='hs-keyword'>import</span> <span class='hs-conid'>GHC.Fingerprint</span>
<a name="line-158"></a><span class='hs-keyword'>import</span> <span class='hs-keyword'>qualified</span> <span class='hs-conid'>GHC.LanguageExtensions</span> <span class='hs-keyword'>as</span> <span class='hs-conid'>LangExt</span>
<a name="line-159"></a>
<a name="line-160"></a><a name="sptCreateStaticBinds"></a><span class='hs-comment'>-- | Replaces all bindings of the form</span>
<a name="line-161"></a><span class='hs-comment'>--</span>
<a name="line-162"></a><span class='hs-comment'>-- &gt; b = /\ ... -&gt; makeStatic location value</span>
<a name="line-163"></a><span class='hs-comment'>--</span>
<a name="line-164"></a><span class='hs-comment'>--  with</span>
<a name="line-165"></a><span class='hs-comment'>--</span>
<a name="line-166"></a><span class='hs-comment'>-- &gt; b = /\ ... -&gt;</span>
<a name="line-167"></a><span class='hs-comment'>-- &gt;   StaticPtr key (StaticPtrInfo "pkg key" "module" location) value</span>
<a name="line-168"></a><span class='hs-comment'>--</span>
<a name="line-169"></a><span class='hs-comment'>--  where a distinct key is generated for each binding.</span>
<a name="line-170"></a><span class='hs-comment'>--</span>
<a name="line-171"></a><span class='hs-comment'>-- It also yields the C stub that inserts these bindings into the static</span>
<a name="line-172"></a><span class='hs-comment'>-- pointer table.</span>
<a name="line-173"></a><span class='hs-definition'>sptCreateStaticBinds</span> <span class='hs-keyglyph'>::</span> <span class='hs-conid'>HscEnv</span> <span class='hs-keyglyph'>-&gt;</span> <span class='hs-conid'>Module</span> <span class='hs-keyglyph'>-&gt;</span> <span class='hs-conid'>CoreProgram</span>
<a name="line-174"></a>                     <span class='hs-keyglyph'>-&gt;</span> <span class='hs-conid'>IO</span> <span class='hs-layout'>(</span><span class='hs-keyglyph'>[</span><span class='hs-conid'>SptEntry</span><span class='hs-keyglyph'>]</span><span class='hs-layout'>,</span> <span class='hs-conid'>CoreProgram</span><span class='hs-layout'>)</span>
<a name="line-175"></a><span class='hs-definition'>sptCreateStaticBinds</span> <span class='hs-varid'>hsc_env</span> <span class='hs-varid'>this_mod</span> <span class='hs-varid'>binds</span>
<a name="line-176"></a>    <span class='hs-keyglyph'>|</span> <span class='hs-varid'>not</span> <span class='hs-layout'>(</span><span class='hs-varid'>xopt</span> <span class='hs-conid'>LangExt.StaticPointers</span> <span class='hs-varid'>dflags</span><span class='hs-layout'>)</span> <span class='hs-keyglyph'>=</span>
<a name="line-177"></a>      <span class='hs-varid'>return</span> <span class='hs-layout'>(</span><span class='hs-conid'>[]</span><span class='hs-layout'>,</span> <span class='hs-varid'>binds</span><span class='hs-layout'>)</span>
<a name="line-178"></a>    <span class='hs-keyglyph'>|</span> <span class='hs-varid'>otherwise</span> <span class='hs-keyglyph'>=</span> <span class='hs-keyword'>do</span>
<a name="line-179"></a>      <span class='hs-comment'>-- Make sure the required interface files are loaded.</span>
<a name="line-180"></a>      <span class='hs-keyword'>_</span> <span class='hs-keyglyph'>&lt;-</span> <span class='hs-varid'>lookupGlobal</span> <span class='hs-varid'>hsc_env</span> <span class='hs-varid'>unpackCStringName</span>
<a name="line-181"></a>      <span class='hs-layout'>(</span><span class='hs-varid'>fps</span><span class='hs-layout'>,</span> <span class='hs-varid'>binds'</span><span class='hs-layout'>)</span> <span class='hs-keyglyph'>&lt;-</span> <span class='hs-varid'>evalStateT</span> <span class='hs-layout'>(</span><span class='hs-varid'>go</span> <span class='hs-conid'>[]</span> <span class='hs-conid'>[]</span> <span class='hs-varid'>binds</span><span class='hs-layout'>)</span> <span class='hs-num'>0</span>
<a name="line-182"></a>      <span class='hs-varid'>return</span> <span class='hs-layout'>(</span><span class='hs-varid'>fps</span><span class='hs-layout'>,</span> <span class='hs-varid'>binds'</span><span class='hs-layout'>)</span>
<a name="line-183"></a>  <span class='hs-keyword'>where</span>
<a name="line-184"></a>    <span class='hs-varid'>go</span> <span class='hs-varid'>fps</span> <span class='hs-varid'>bs</span> <span class='hs-varid'>xs</span> <span class='hs-keyglyph'>=</span> <span class='hs-keyword'>case</span> <span class='hs-varid'>xs</span> <span class='hs-keyword'>of</span>
<a name="line-185"></a>      <span class='hs-conid'>[]</span>        <span class='hs-keyglyph'>-&gt;</span> <span class='hs-varid'>return</span> <span class='hs-layout'>(</span><span class='hs-varid'>reverse</span> <span class='hs-varid'>fps</span><span class='hs-layout'>,</span> <span class='hs-varid'>reverse</span> <span class='hs-varid'>bs</span><span class='hs-layout'>)</span>
<a name="line-186"></a>      <span class='hs-varid'>bnd</span> <span class='hs-conop'>:</span> <span class='hs-varid'>xs'</span> <span class='hs-keyglyph'>-&gt;</span> <span class='hs-keyword'>do</span>
<a name="line-187"></a>        <span class='hs-layout'>(</span><span class='hs-varid'>fps'</span><span class='hs-layout'>,</span> <span class='hs-varid'>bnd'</span><span class='hs-layout'>)</span> <span class='hs-keyglyph'>&lt;-</span> <span class='hs-varid'>replaceStaticBind</span> <span class='hs-varid'>bnd</span>
<a name="line-188"></a>        <span class='hs-varid'>go</span> <span class='hs-layout'>(</span><span class='hs-varid'>reverse</span> <span class='hs-varid'>fps'</span> <span class='hs-varop'>++</span> <span class='hs-varid'>fps</span><span class='hs-layout'>)</span> <span class='hs-layout'>(</span><span class='hs-varid'>bnd'</span> <span class='hs-conop'>:</span> <span class='hs-varid'>bs</span><span class='hs-layout'>)</span> <span class='hs-varid'>xs'</span>
<a name="line-189"></a>
<a name="line-190"></a>    <span class='hs-varid'>dflags</span> <span class='hs-keyglyph'>=</span> <span class='hs-varid'>hsc_dflags</span> <span class='hs-varid'>hsc_env</span>
<a name="line-191"></a>    <span class='hs-varid'>platform</span> <span class='hs-keyglyph'>=</span> <span class='hs-varid'>targetPlatform</span> <span class='hs-varid'>dflags</span>
<a name="line-192"></a>
<a name="line-193"></a>    <span class='hs-comment'>-- Generates keys and replaces 'makeStatic' with 'StaticPtr'.</span>
<a name="line-194"></a>    <span class='hs-comment'>--</span>
<a name="line-195"></a>    <span class='hs-comment'>-- The 'Int' state is used to produce a different key for each binding.</span>
<a name="line-196"></a>    <span class='hs-varid'>replaceStaticBind</span> <span class='hs-keyglyph'>::</span> <span class='hs-conid'>CoreBind</span>
<a name="line-197"></a>                      <span class='hs-keyglyph'>-&gt;</span> <span class='hs-conid'>StateT</span> <span class='hs-conid'>Int</span> <span class='hs-conid'>IO</span> <span class='hs-layout'>(</span><span class='hs-keyglyph'>[</span><span class='hs-conid'>SptEntry</span><span class='hs-keyglyph'>]</span><span class='hs-layout'>,</span> <span class='hs-conid'>CoreBind</span><span class='hs-layout'>)</span>
<a name="line-198"></a>    <span class='hs-varid'>replaceStaticBind</span> <span class='hs-layout'>(</span><span class='hs-conid'>NonRec</span> <span class='hs-varid'>b</span> <span class='hs-varid'>e</span><span class='hs-layout'>)</span> <span class='hs-keyglyph'>=</span> <span class='hs-keyword'>do</span> <span class='hs-layout'>(</span><span class='hs-varid'>mfp</span><span class='hs-layout'>,</span> <span class='hs-layout'>(</span><span class='hs-varid'>b'</span><span class='hs-layout'>,</span> <span class='hs-varid'>e'</span><span class='hs-layout'>)</span><span class='hs-layout'>)</span> <span class='hs-keyglyph'>&lt;-</span> <span class='hs-varid'>replaceStatic</span> <span class='hs-varid'>b</span> <span class='hs-varid'>e</span>
<a name="line-199"></a>                                        <span class='hs-varid'>return</span> <span class='hs-layout'>(</span><span class='hs-varid'>maybeToList</span> <span class='hs-varid'>mfp</span><span class='hs-layout'>,</span> <span class='hs-conid'>NonRec</span> <span class='hs-varid'>b'</span> <span class='hs-varid'>e'</span><span class='hs-layout'>)</span>
<a name="line-200"></a>    <span class='hs-varid'>replaceStaticBind</span> <span class='hs-layout'>(</span><span class='hs-conid'>Rec</span> <span class='hs-varid'>rbs</span><span class='hs-layout'>)</span> <span class='hs-keyglyph'>=</span> <span class='hs-keyword'>do</span>
<a name="line-201"></a>      <span class='hs-layout'>(</span><span class='hs-varid'>mfps</span><span class='hs-layout'>,</span> <span class='hs-varid'>rbs'</span><span class='hs-layout'>)</span> <span class='hs-keyglyph'>&lt;-</span> <span class='hs-varid'>unzip</span> <span class='hs-varop'>&lt;$&gt;</span> <span class='hs-varid'>mapM</span> <span class='hs-layout'>(</span><span class='hs-varid'>uncurry</span> <span class='hs-varid'>replaceStatic</span><span class='hs-layout'>)</span> <span class='hs-varid'>rbs</span>
<a name="line-202"></a>      <span class='hs-varid'>return</span> <span class='hs-layout'>(</span><span class='hs-varid'>catMaybes</span> <span class='hs-varid'>mfps</span><span class='hs-layout'>,</span> <span class='hs-conid'>Rec</span> <span class='hs-varid'>rbs'</span><span class='hs-layout'>)</span>
<a name="line-203"></a>
<a name="line-204"></a>    <span class='hs-varid'>replaceStatic</span> <span class='hs-keyglyph'>::</span> <span class='hs-conid'>Id</span> <span class='hs-keyglyph'>-&gt;</span> <span class='hs-conid'>CoreExpr</span>
<a name="line-205"></a>                  <span class='hs-keyglyph'>-&gt;</span> <span class='hs-conid'>StateT</span> <span class='hs-conid'>Int</span> <span class='hs-conid'>IO</span> <span class='hs-layout'>(</span><span class='hs-conid'>Maybe</span> <span class='hs-conid'>SptEntry</span><span class='hs-layout'>,</span> <span class='hs-layout'>(</span><span class='hs-conid'>Id</span><span class='hs-layout'>,</span> <span class='hs-conid'>CoreExpr</span><span class='hs-layout'>)</span><span class='hs-layout'>)</span>
<a name="line-206"></a>    <span class='hs-varid'>replaceStatic</span> <span class='hs-varid'>b</span> <span class='hs-varid'>e</span><span class='hs-keyglyph'>@</span><span class='hs-layout'>(</span><span class='hs-varid'>collectTyBinders</span> <span class='hs-keyglyph'>-&gt;</span> <span class='hs-layout'>(</span><span class='hs-varid'>tvs</span><span class='hs-layout'>,</span> <span class='hs-varid'>e0</span><span class='hs-layout'>)</span><span class='hs-layout'>)</span> <span class='hs-keyglyph'>=</span>
<a name="line-207"></a>      <span class='hs-keyword'>case</span> <span class='hs-varid'>collectMakeStaticArgs</span> <span class='hs-varid'>e0</span> <span class='hs-keyword'>of</span>
<a name="line-208"></a>        <span class='hs-conid'>Nothing</span>      <span class='hs-keyglyph'>-&gt;</span> <span class='hs-varid'>return</span> <span class='hs-layout'>(</span><span class='hs-conid'>Nothing</span><span class='hs-layout'>,</span> <span class='hs-layout'>(</span><span class='hs-varid'>b</span><span class='hs-layout'>,</span> <span class='hs-varid'>e</span><span class='hs-layout'>)</span><span class='hs-layout'>)</span>
<a name="line-209"></a>        <span class='hs-conid'>Just</span> <span class='hs-layout'>(</span><span class='hs-keyword'>_</span><span class='hs-layout'>,</span> <span class='hs-varid'>t</span><span class='hs-layout'>,</span> <span class='hs-varid'>info</span><span class='hs-layout'>,</span> <span class='hs-varid'>arg</span><span class='hs-layout'>)</span> <span class='hs-keyglyph'>-&gt;</span> <span class='hs-keyword'>do</span>
<a name="line-210"></a>          <span class='hs-layout'>(</span><span class='hs-varid'>fp</span><span class='hs-layout'>,</span> <span class='hs-varid'>e'</span><span class='hs-layout'>)</span> <span class='hs-keyglyph'>&lt;-</span> <span class='hs-varid'>mkStaticBind</span> <span class='hs-varid'>t</span> <span class='hs-varid'>info</span> <span class='hs-varid'>arg</span>
<a name="line-211"></a>          <span class='hs-varid'>return</span> <span class='hs-layout'>(</span><span class='hs-conid'>Just</span> <span class='hs-layout'>(</span><span class='hs-conid'>SptEntry</span> <span class='hs-varid'>b</span> <span class='hs-varid'>fp</span><span class='hs-layout'>)</span><span class='hs-layout'>,</span> <span class='hs-layout'>(</span><span class='hs-varid'>b</span><span class='hs-layout'>,</span> <span class='hs-varid'>foldr</span> <span class='hs-conid'>Lam</span> <span class='hs-varid'>e'</span> <span class='hs-varid'>tvs</span><span class='hs-layout'>)</span><span class='hs-layout'>)</span>
<a name="line-212"></a>
<a name="line-213"></a>    <span class='hs-varid'>mkStaticBind</span> <span class='hs-keyglyph'>::</span> <span class='hs-conid'>Type</span> <span class='hs-keyglyph'>-&gt;</span> <span class='hs-conid'>CoreExpr</span> <span class='hs-keyglyph'>-&gt;</span> <span class='hs-conid'>CoreExpr</span>
<a name="line-214"></a>                 <span class='hs-keyglyph'>-&gt;</span> <span class='hs-conid'>StateT</span> <span class='hs-conid'>Int</span> <span class='hs-conid'>IO</span> <span class='hs-layout'>(</span><span class='hs-conid'>Fingerprint</span><span class='hs-layout'>,</span> <span class='hs-conid'>CoreExpr</span><span class='hs-layout'>)</span>
<a name="line-215"></a>    <span class='hs-varid'>mkStaticBind</span> <span class='hs-varid'>t</span> <span class='hs-varid'>srcLoc</span> <span class='hs-varid'>e</span> <span class='hs-keyglyph'>=</span> <span class='hs-keyword'>do</span>
<a name="line-216"></a>      <span class='hs-varid'>i</span> <span class='hs-keyglyph'>&lt;-</span> <span class='hs-varid'>get</span>
<a name="line-217"></a>      <span class='hs-varid'>put</span> <span class='hs-layout'>(</span><span class='hs-varid'>i</span> <span class='hs-varop'>+</span> <span class='hs-num'>1</span><span class='hs-layout'>)</span>
<a name="line-218"></a>      <span class='hs-varid'>staticPtrInfoDataCon</span> <span class='hs-keyglyph'>&lt;-</span>
<a name="line-219"></a>        <span class='hs-varid'>lift</span> <span class='hs-varop'>$</span> <span class='hs-varid'>lookupDataConHscEnv</span> <span class='hs-varid'>staticPtrInfoDataConName</span>
<a name="line-220"></a>      <span class='hs-keyword'>let</span> <span class='hs-varid'>fp</span><span class='hs-keyglyph'>@</span><span class='hs-layout'>(</span><span class='hs-conid'>Fingerprint</span> <span class='hs-varid'>w0</span> <span class='hs-varid'>w1</span><span class='hs-layout'>)</span> <span class='hs-keyglyph'>=</span> <span class='hs-varid'>mkStaticPtrFingerprint</span> <span class='hs-varid'>i</span>
<a name="line-221"></a>      <span class='hs-varid'>info</span> <span class='hs-keyglyph'>&lt;-</span> <span class='hs-varid'>mkConApp</span> <span class='hs-varid'>staticPtrInfoDataCon</span> <span class='hs-varop'>&lt;$&gt;</span>
<a name="line-222"></a>            <span class='hs-layout'>(</span><span class='hs-varop'>++</span><span class='hs-keyglyph'>[</span><span class='hs-varid'>srcLoc</span><span class='hs-keyglyph'>]</span><span class='hs-layout'>)</span> <span class='hs-varop'>&lt;$&gt;</span>
<a name="line-223"></a>            <span class='hs-varid'>mapM</span> <span class='hs-layout'>(</span><span class='hs-varid'>mkStringExprFSWith</span> <span class='hs-layout'>(</span><span class='hs-varid'>lift</span> <span class='hs-varop'>.</span> <span class='hs-varid'>lookupIdHscEnv</span><span class='hs-layout'>)</span><span class='hs-layout'>)</span>
<a name="line-224"></a>                 <span class='hs-keyglyph'>[</span> <span class='hs-varid'>unitFS</span> <span class='hs-varop'>$</span> <span class='hs-varid'>moduleUnit</span> <span class='hs-varid'>this_mod</span>
<a name="line-225"></a>                 <span class='hs-layout'>,</span> <span class='hs-varid'>moduleNameFS</span> <span class='hs-varop'>$</span> <span class='hs-varid'>moduleName</span> <span class='hs-varid'>this_mod</span>
<a name="line-226"></a>                 <span class='hs-keyglyph'>]</span>
<a name="line-227"></a>
<a name="line-228"></a>      <span class='hs-comment'>-- The module interface of GHC.StaticPtr should be loaded at least</span>
<a name="line-229"></a>      <span class='hs-comment'>-- when looking up 'fromStatic' during type-checking.</span>
<a name="line-230"></a>      <span class='hs-varid'>staticPtrDataCon</span> <span class='hs-keyglyph'>&lt;-</span> <span class='hs-varid'>lift</span> <span class='hs-varop'>$</span> <span class='hs-varid'>lookupDataConHscEnv</span> <span class='hs-varid'>staticPtrDataConName</span>
<a name="line-231"></a>      <span class='hs-varid'>return</span> <span class='hs-layout'>(</span><span class='hs-varid'>fp</span><span class='hs-layout'>,</span> <span class='hs-varid'>mkConApp</span> <span class='hs-varid'>staticPtrDataCon</span>
<a name="line-232"></a>                               <span class='hs-keyglyph'>[</span> <span class='hs-conid'>Type</span> <span class='hs-varid'>t</span>
<a name="line-233"></a>                               <span class='hs-layout'>,</span> <span class='hs-varid'>mkWord64LitWordRep</span> <span class='hs-varid'>platform</span> <span class='hs-varid'>w0</span>
<a name="line-234"></a>                               <span class='hs-layout'>,</span> <span class='hs-varid'>mkWord64LitWordRep</span> <span class='hs-varid'>platform</span> <span class='hs-varid'>w1</span>
<a name="line-235"></a>                               <span class='hs-layout'>,</span> <span class='hs-varid'>info</span>
<a name="line-236"></a>                               <span class='hs-layout'>,</span> <span class='hs-varid'>e</span> <span class='hs-keyglyph'>]</span><span class='hs-layout'>)</span>
<a name="line-237"></a>
<a name="line-238"></a>    <span class='hs-varid'>mkStaticPtrFingerprint</span> <span class='hs-keyglyph'>::</span> <span class='hs-conid'>Int</span> <span class='hs-keyglyph'>-&gt;</span> <span class='hs-conid'>Fingerprint</span>
<a name="line-239"></a>    <span class='hs-varid'>mkStaticPtrFingerprint</span> <span class='hs-varid'>n</span> <span class='hs-keyglyph'>=</span> <span class='hs-varid'>fingerprintString</span> <span class='hs-varop'>$</span> <span class='hs-varid'>intercalate</span> <span class='hs-str'>":"</span>
<a name="line-240"></a>        <span class='hs-keyglyph'>[</span> <span class='hs-varid'>unitString</span> <span class='hs-varop'>$</span> <span class='hs-varid'>moduleUnit</span> <span class='hs-varid'>this_mod</span>
<a name="line-241"></a>        <span class='hs-layout'>,</span> <span class='hs-varid'>moduleNameString</span> <span class='hs-varop'>$</span> <span class='hs-varid'>moduleName</span> <span class='hs-varid'>this_mod</span>
<a name="line-242"></a>        <span class='hs-layout'>,</span> <span class='hs-varid'>show</span> <span class='hs-varid'>n</span>
<a name="line-243"></a>        <span class='hs-keyglyph'>]</span>
<a name="line-244"></a>
<a name="line-245"></a>    <span class='hs-comment'>-- Choose either 'Word64#' or 'Word#' to represent the arguments of the</span>
<a name="line-246"></a>    <span class='hs-comment'>-- 'Fingerprint' data constructor.</span>
<a name="line-247"></a>    <span class='hs-varid'>mkWord64LitWordRep</span> <span class='hs-varid'>platform</span> <span class='hs-keyglyph'>=</span>
<a name="line-248"></a>      <span class='hs-keyword'>case</span> <span class='hs-varid'>platformWordSize</span> <span class='hs-varid'>platform</span> <span class='hs-keyword'>of</span>
<a name="line-249"></a>        <span class='hs-conid'>PW4</span> <span class='hs-keyglyph'>-&gt;</span> <span class='hs-varid'>mkWord64LitWord64</span>
<a name="line-250"></a>        <span class='hs-conid'>PW8</span> <span class='hs-keyglyph'>-&gt;</span> <span class='hs-varid'>mkWordLit</span> <span class='hs-varid'>platform</span> <span class='hs-varop'>.</span> <span class='hs-varid'>toInteger</span>
<a name="line-251"></a>
<a name="line-252"></a>    <span class='hs-varid'>lookupIdHscEnv</span> <span class='hs-keyglyph'>::</span> <span class='hs-conid'>Name</span> <span class='hs-keyglyph'>-&gt;</span> <span class='hs-conid'>IO</span> <span class='hs-conid'>Id</span>
<a name="line-253"></a>    <span class='hs-varid'>lookupIdHscEnv</span> <span class='hs-varid'>n</span> <span class='hs-keyglyph'>=</span> <span class='hs-varid'>lookupType</span> <span class='hs-varid'>hsc_env</span> <span class='hs-varid'>n</span> <span class='hs-varop'>&gt;&gt;=</span>
<a name="line-254"></a>                         <span class='hs-varid'>maybe</span> <span class='hs-layout'>(</span><span class='hs-varid'>getError</span> <span class='hs-varid'>n</span><span class='hs-layout'>)</span> <span class='hs-layout'>(</span><span class='hs-varid'>return</span> <span class='hs-varop'>.</span> <span class='hs-varid'>tyThingId</span><span class='hs-layout'>)</span>
<a name="line-255"></a>
<a name="line-256"></a>    <span class='hs-varid'>lookupDataConHscEnv</span> <span class='hs-keyglyph'>::</span> <span class='hs-conid'>Name</span> <span class='hs-keyglyph'>-&gt;</span> <span class='hs-conid'>IO</span> <span class='hs-conid'>DataCon</span>
<a name="line-257"></a>    <span class='hs-varid'>lookupDataConHscEnv</span> <span class='hs-varid'>n</span> <span class='hs-keyglyph'>=</span> <span class='hs-varid'>lookupType</span> <span class='hs-varid'>hsc_env</span> <span class='hs-varid'>n</span> <span class='hs-varop'>&gt;&gt;=</span>
<a name="line-258"></a>                              <span class='hs-varid'>maybe</span> <span class='hs-layout'>(</span><span class='hs-varid'>getError</span> <span class='hs-varid'>n</span><span class='hs-layout'>)</span> <span class='hs-layout'>(</span><span class='hs-varid'>return</span> <span class='hs-varop'>.</span> <span class='hs-varid'>tyThingDataCon</span><span class='hs-layout'>)</span>
<a name="line-259"></a>
<a name="line-260"></a>    <span class='hs-varid'>getError</span> <span class='hs-varid'>n</span> <span class='hs-keyglyph'>=</span> <span class='hs-varid'>pprPanic</span> <span class='hs-str'>"sptCreateStaticBinds.get: not found"</span> <span class='hs-varop'>$</span>
<a name="line-261"></a>      <span class='hs-varid'>text</span> <span class='hs-str'>"Couldn't find"</span> <span class='hs-varop'>&lt;+&gt;</span> <span class='hs-varid'>ppr</span> <span class='hs-varid'>n</span>
<a name="line-262"></a>
<a name="line-263"></a><a name="sptModuleInitCode"></a><span class='hs-comment'>-- | @sptModuleInitCode module fps@ is a C stub to insert the static entries</span>
<a name="line-264"></a><span class='hs-comment'>-- of @module@ into the static pointer table.</span>
<a name="line-265"></a><span class='hs-comment'>--</span>
<a name="line-266"></a><span class='hs-comment'>-- @fps@ is a list associating each binding corresponding to a static entry with</span>
<a name="line-267"></a><span class='hs-comment'>-- its fingerprint.</span>
<a name="line-268"></a><span class='hs-definition'>sptModuleInitCode</span> <span class='hs-keyglyph'>::</span> <span class='hs-conid'>Platform</span> <span class='hs-keyglyph'>-&gt;</span> <span class='hs-conid'>Module</span> <span class='hs-keyglyph'>-&gt;</span> <span class='hs-keyglyph'>[</span><span class='hs-conid'>SptEntry</span><span class='hs-keyglyph'>]</span> <span class='hs-keyglyph'>-&gt;</span> <span class='hs-conid'>CStub</span>
<a name="line-269"></a><span class='hs-definition'>sptModuleInitCode</span> <span class='hs-keyword'>_</span>        <span class='hs-keyword'>_</span>        <span class='hs-conid'>[]</span> <span class='hs-keyglyph'>=</span> <span class='hs-varid'>mempty</span>
<a name="line-270"></a><span class='hs-definition'>sptModuleInitCode</span> <span class='hs-varid'>platform</span> <span class='hs-varid'>this_mod</span> <span class='hs-varid'>entries</span> <span class='hs-keyglyph'>=</span> <span class='hs-conid'>CStub</span> <span class='hs-varop'>$</span> <span class='hs-varid'>vcat</span>
<a name="line-271"></a>    <span class='hs-keyglyph'>[</span> <span class='hs-varid'>text</span> <span class='hs-str'>"static void hs_spt_init_"</span> <span class='hs-varop'>&lt;&gt;</span> <span class='hs-varid'>ppr</span> <span class='hs-varid'>this_mod</span>
<a name="line-272"></a>           <span class='hs-varop'>&lt;&gt;</span> <span class='hs-varid'>text</span> <span class='hs-str'>"(void) __attribute__((constructor));"</span>
<a name="line-273"></a>    <span class='hs-layout'>,</span> <span class='hs-varid'>text</span> <span class='hs-str'>"static void hs_spt_init_"</span> <span class='hs-varop'>&lt;&gt;</span> <span class='hs-varid'>ppr</span> <span class='hs-varid'>this_mod</span> <span class='hs-varop'>&lt;&gt;</span> <span class='hs-varid'>text</span> <span class='hs-str'>"(void)"</span>
<a name="line-274"></a>    <span class='hs-layout'>,</span> <span class='hs-varid'>braces</span> <span class='hs-varop'>$</span> <span class='hs-varid'>vcat</span> <span class='hs-varop'>$</span>
<a name="line-275"></a>        <span class='hs-keyglyph'>[</span>  <span class='hs-varid'>text</span> <span class='hs-str'>"static StgWord64 k"</span> <span class='hs-varop'>&lt;&gt;</span> <span class='hs-varid'>int</span> <span class='hs-varid'>i</span> <span class='hs-varop'>&lt;&gt;</span> <span class='hs-varid'>text</span> <span class='hs-str'>"[2] = "</span>
<a name="line-276"></a>           <span class='hs-varop'>&lt;&gt;</span> <span class='hs-varid'>pprFingerprint</span> <span class='hs-varid'>fp</span> <span class='hs-varop'>&lt;&gt;</span> <span class='hs-varid'>semi</span>
<a name="line-277"></a>        <span class='hs-varop'>$$</span> <span class='hs-varid'>text</span> <span class='hs-str'>"extern StgPtr "</span>
<a name="line-278"></a>           <span class='hs-varop'>&lt;&gt;</span> <span class='hs-layout'>(</span><span class='hs-varid'>pdoc</span> <span class='hs-varid'>platform</span> <span class='hs-varop'>$</span> <span class='hs-varid'>mkClosureLabel</span> <span class='hs-layout'>(</span><span class='hs-varid'>idName</span> <span class='hs-varid'>n</span><span class='hs-layout'>)</span> <span class='hs-layout'>(</span><span class='hs-varid'>idCafInfo</span> <span class='hs-varid'>n</span><span class='hs-layout'>)</span><span class='hs-layout'>)</span> <span class='hs-varop'>&lt;&gt;</span> <span class='hs-varid'>semi</span>
<a name="line-279"></a>        <span class='hs-varop'>$$</span> <span class='hs-varid'>text</span> <span class='hs-str'>"hs_spt_insert"</span> <span class='hs-varop'>&lt;&gt;</span> <span class='hs-varid'>parens</span>
<a name="line-280"></a>             <span class='hs-layout'>(</span><span class='hs-varid'>hcat</span> <span class='hs-varop'>$</span> <span class='hs-varid'>punctuate</span> <span class='hs-varid'>comma</span>
<a name="line-281"></a>                <span class='hs-keyglyph'>[</span> <span class='hs-varid'>char</span> <span class='hs-chr'>'k'</span> <span class='hs-varop'>&lt;&gt;</span> <span class='hs-varid'>int</span> <span class='hs-varid'>i</span>
<a name="line-282"></a>                <span class='hs-layout'>,</span> <span class='hs-varid'>char</span> <span class='hs-chr'>'&amp;'</span> <span class='hs-varop'>&lt;&gt;</span> <span class='hs-varid'>pdoc</span> <span class='hs-varid'>platform</span> <span class='hs-layout'>(</span><span class='hs-varid'>mkClosureLabel</span> <span class='hs-layout'>(</span><span class='hs-varid'>idName</span> <span class='hs-varid'>n</span><span class='hs-layout'>)</span> <span class='hs-layout'>(</span><span class='hs-varid'>idCafInfo</span> <span class='hs-varid'>n</span><span class='hs-layout'>)</span><span class='hs-layout'>)</span>
<a name="line-283"></a>                <span class='hs-keyglyph'>]</span>
<a name="line-284"></a>             <span class='hs-layout'>)</span>
<a name="line-285"></a>        <span class='hs-varop'>&lt;&gt;</span> <span class='hs-varid'>semi</span>
<a name="line-286"></a>        <span class='hs-keyglyph'>|</span>  <span class='hs-layout'>(</span><span class='hs-varid'>i</span><span class='hs-layout'>,</span> <span class='hs-conid'>SptEntry</span> <span class='hs-varid'>n</span> <span class='hs-varid'>fp</span><span class='hs-layout'>)</span> <span class='hs-keyglyph'>&lt;-</span> <span class='hs-varid'>zip</span> <span class='hs-keyglyph'>[</span><span class='hs-num'>0</span><span class='hs-keyglyph'>..</span><span class='hs-keyglyph'>]</span> <span class='hs-varid'>entries</span>
<a name="line-287"></a>        <span class='hs-keyglyph'>]</span>
<a name="line-288"></a>    <span class='hs-layout'>,</span> <span class='hs-varid'>text</span> <span class='hs-str'>"static void hs_spt_fini_"</span> <span class='hs-varop'>&lt;&gt;</span> <span class='hs-varid'>ppr</span> <span class='hs-varid'>this_mod</span>
<a name="line-289"></a>           <span class='hs-varop'>&lt;&gt;</span> <span class='hs-varid'>text</span> <span class='hs-str'>"(void) __attribute__((destructor));"</span>
<a name="line-290"></a>    <span class='hs-layout'>,</span> <span class='hs-varid'>text</span> <span class='hs-str'>"static void hs_spt_fini_"</span> <span class='hs-varop'>&lt;&gt;</span> <span class='hs-varid'>ppr</span> <span class='hs-varid'>this_mod</span> <span class='hs-varop'>&lt;&gt;</span> <span class='hs-varid'>text</span> <span class='hs-str'>"(void)"</span>
<a name="line-291"></a>    <span class='hs-layout'>,</span> <span class='hs-varid'>braces</span> <span class='hs-varop'>$</span> <span class='hs-varid'>vcat</span> <span class='hs-varop'>$</span>
<a name="line-292"></a>        <span class='hs-keyglyph'>[</span>  <span class='hs-varid'>text</span> <span class='hs-str'>"StgWord64 k"</span> <span class='hs-varop'>&lt;&gt;</span> <span class='hs-varid'>int</span> <span class='hs-varid'>i</span> <span class='hs-varop'>&lt;&gt;</span> <span class='hs-varid'>text</span> <span class='hs-str'>"[2] = "</span>
<a name="line-293"></a>           <span class='hs-varop'>&lt;&gt;</span> <span class='hs-varid'>pprFingerprint</span> <span class='hs-varid'>fp</span> <span class='hs-varop'>&lt;&gt;</span> <span class='hs-varid'>semi</span>
<a name="line-294"></a>        <span class='hs-varop'>$$</span> <span class='hs-varid'>text</span> <span class='hs-str'>"hs_spt_remove"</span> <span class='hs-varop'>&lt;&gt;</span> <span class='hs-varid'>parens</span> <span class='hs-layout'>(</span><span class='hs-varid'>char</span> <span class='hs-chr'>'k'</span> <span class='hs-varop'>&lt;&gt;</span> <span class='hs-varid'>int</span> <span class='hs-varid'>i</span><span class='hs-layout'>)</span> <span class='hs-varop'>&lt;&gt;</span> <span class='hs-varid'>semi</span>
<a name="line-295"></a>        <span class='hs-keyglyph'>|</span> <span class='hs-layout'>(</span><span class='hs-varid'>i</span><span class='hs-layout'>,</span> <span class='hs-layout'>(</span><span class='hs-conid'>SptEntry</span> <span class='hs-keyword'>_</span> <span class='hs-varid'>fp</span><span class='hs-layout'>)</span><span class='hs-layout'>)</span> <span class='hs-keyglyph'>&lt;-</span> <span class='hs-varid'>zip</span> <span class='hs-keyglyph'>[</span><span class='hs-num'>0</span><span class='hs-keyglyph'>..</span><span class='hs-keyglyph'>]</span> <span class='hs-varid'>entries</span>
<a name="line-296"></a>        <span class='hs-keyglyph'>]</span>
<a name="line-297"></a>    <span class='hs-keyglyph'>]</span>
<a name="line-298"></a>  <span class='hs-keyword'>where</span>
<a name="line-299"></a>    <span class='hs-varid'>pprFingerprint</span> <span class='hs-keyglyph'>::</span> <span class='hs-conid'>Fingerprint</span> <span class='hs-keyglyph'>-&gt;</span> <span class='hs-conid'>SDoc</span>
<a name="line-300"></a>    <span class='hs-varid'>pprFingerprint</span> <span class='hs-layout'>(</span><span class='hs-conid'>Fingerprint</span> <span class='hs-varid'>w1</span> <span class='hs-varid'>w2</span><span class='hs-layout'>)</span> <span class='hs-keyglyph'>=</span>
<a name="line-301"></a>      <span class='hs-varid'>braces</span> <span class='hs-varop'>$</span> <span class='hs-varid'>hcat</span> <span class='hs-varop'>$</span> <span class='hs-varid'>punctuate</span> <span class='hs-varid'>comma</span>
<a name="line-302"></a>                 <span class='hs-keyglyph'>[</span> <span class='hs-varid'>integer</span> <span class='hs-layout'>(</span><span class='hs-varid'>fromIntegral</span> <span class='hs-varid'>w1</span><span class='hs-layout'>)</span> <span class='hs-varop'>&lt;&gt;</span> <span class='hs-varid'>text</span> <span class='hs-str'>"ULL"</span>
<a name="line-303"></a>                 <span class='hs-layout'>,</span> <span class='hs-varid'>integer</span> <span class='hs-layout'>(</span><span class='hs-varid'>fromIntegral</span> <span class='hs-varid'>w2</span><span class='hs-layout'>)</span> <span class='hs-varop'>&lt;&gt;</span> <span class='hs-varid'>text</span> <span class='hs-str'>"ULL"</span>
<a name="line-304"></a>                 <span class='hs-keyglyph'>]</span>
</pre></body>
</html>
