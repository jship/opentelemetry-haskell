<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd"><html xmlns="http://www.w3.org/1999/xhtml"><head><meta http-equiv="Content-Type" content="text/html; charset=UTF-8" /><meta name="viewport" content="width=device-width, initial-scale=1" /><title>Data.Pool</title><link href="linuwial.css" rel="stylesheet" type="text/css" title="Linuwial" /><link rel="stylesheet" type="text/css" href="quick-jump.css" /><link rel="stylesheet" type="text/css" href="https://fonts.googleapis.com/css?family=PT+Sans:400,400i,700" /><script src="haddock-bundle.min.js" async="async" type="text/javascript"></script><script type="text/x-mathjax-config">MathJax.Hub.Config({ tex2jax: { processClass: "mathjax", ignoreClass: ".*" } });</script><script src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.5/MathJax.js?config=TeX-AMS-MML_HTMLorMML" type="text/javascript"></script></head><body><div id="package-header"><span class="caption">resource-pool-0.2.3.2: A high-performance striped resource pooling implementation</span><ul class="links" id="page-menu"><li><a href="src/Data.Pool.html">Source</a></li><li><a href="index.html">Contents</a></li><li><a href="doc-index.html">Index</a></li></ul></div><div id="content"><div id="module-header"><table class="info"><tr><th valign="top">Copyright</th><td>(c) 2011 MailRank Inc.</td></tr><tr><th>License</th><td>BSD3</td></tr><tr><th>Maintainer</th><td>Bryan O'Sullivan &lt;bos@serpentine.com&gt;,
              Bas van Dijk &lt;v.dijk.bas@gmail.com&gt;</td></tr><tr><th>Stability</th><td>experimental</td></tr><tr><th>Portability</th><td>portable</td></tr><tr><th>Safe Haskell</th><td>Safe-Inferred</td></tr><tr><th>Language</th><td>Haskell98</td></tr></table><p class="caption">Data.Pool</p></div><div id="description"><p class="caption">Description</p><div class="doc"><p>A high-performance striped pooling abstraction for managing
 flexibly-sized collections of resources such as database
 connections.</p><p>&quot;Striped&quot; means that a single <code><a href="Data-Pool.html#t:Pool" title="Data.Pool">Pool</a></code> consists of several
 sub-pools, each managed independently.  A single stripe is fine for
 many applications, and probably what you should choose by default.
 More stripes will lead to reduced contention in high-performance
 multicore applications, at a trade-off of causing the maximum
 number of simultaneous resources in use to grow.</p></div></div><div id="synopsis"><details id="syn"><summary>Synopsis</summary><ul class="details-toggle" data-details-id="syn"><li class="src short"><span class="keyword">data</span> <a href="#t:Pool">Pool</a> a</li><li class="src short"><span class="keyword">data</span> <a href="#t:LocalPool">LocalPool</a> a</li><li class="src short"><a href="#v:createPool">createPool</a> :: <a href="../base-4.16.4.0/System-IO.html#t:IO" title="System.IO">IO</a> a -&gt; (a -&gt; <a href="../base-4.16.4.0/System-IO.html#t:IO" title="System.IO">IO</a> ()) -&gt; <a href="../base-4.16.4.0/Data-Int.html#t:Int" title="Data.Int">Int</a> -&gt; <a href="../time-1.11.1.1/Data-Time-Clock.html#t:NominalDiffTime" title="Data.Time.Clock">NominalDiffTime</a> -&gt; <a href="../base-4.16.4.0/Data-Int.html#t:Int" title="Data.Int">Int</a> -&gt; <a href="../base-4.16.4.0/System-IO.html#t:IO" title="System.IO">IO</a> (<a href="Data-Pool.html#t:Pool" title="Data.Pool">Pool</a> a)</li><li class="src short"><a href="#v:withResource">withResource</a> :: <a href="../monad-control-1.0.3.1/Control-Monad-Trans-Control.html#t:MonadBaseControl" title="Control.Monad.Trans.Control">MonadBaseControl</a> <a href="../base-4.16.4.0/System-IO.html#t:IO" title="System.IO">IO</a> m =&gt; <a href="Data-Pool.html#t:Pool" title="Data.Pool">Pool</a> a -&gt; (a -&gt; m b) -&gt; m b</li><li class="src short"><a href="#v:takeResource">takeResource</a> :: <a href="Data-Pool.html#t:Pool" title="Data.Pool">Pool</a> a -&gt; <a href="../base-4.16.4.0/System-IO.html#t:IO" title="System.IO">IO</a> (a, <a href="Data-Pool.html#t:LocalPool" title="Data.Pool">LocalPool</a> a)</li><li class="src short"><a href="#v:tryWithResource">tryWithResource</a> :: <span class="keyword">forall</span> m a b. <a href="../monad-control-1.0.3.1/Control-Monad-Trans-Control.html#t:MonadBaseControl" title="Control.Monad.Trans.Control">MonadBaseControl</a> <a href="../base-4.16.4.0/System-IO.html#t:IO" title="System.IO">IO</a> m =&gt; <a href="Data-Pool.html#t:Pool" title="Data.Pool">Pool</a> a -&gt; (a -&gt; m b) -&gt; m (<a href="../base-4.16.4.0/Data-Maybe.html#t:Maybe" title="Data.Maybe">Maybe</a> b)</li><li class="src short"><a href="#v:tryTakeResource">tryTakeResource</a> :: <a href="Data-Pool.html#t:Pool" title="Data.Pool">Pool</a> a -&gt; <a href="../base-4.16.4.0/System-IO.html#t:IO" title="System.IO">IO</a> (<a href="../base-4.16.4.0/Data-Maybe.html#t:Maybe" title="Data.Maybe">Maybe</a> (a, <a href="Data-Pool.html#t:LocalPool" title="Data.Pool">LocalPool</a> a))</li><li class="src short"><a href="#v:destroyResource">destroyResource</a> :: <a href="Data-Pool.html#t:Pool" title="Data.Pool">Pool</a> a -&gt; <a href="Data-Pool.html#t:LocalPool" title="Data.Pool">LocalPool</a> a -&gt; a -&gt; <a href="../base-4.16.4.0/System-IO.html#t:IO" title="System.IO">IO</a> ()</li><li class="src short"><a href="#v:putResource">putResource</a> :: <a href="Data-Pool.html#t:LocalPool" title="Data.Pool">LocalPool</a> a -&gt; a -&gt; <a href="../base-4.16.4.0/System-IO.html#t:IO" title="System.IO">IO</a> ()</li><li class="src short"><a href="#v:destroyAllResources">destroyAllResources</a> :: <a href="Data-Pool.html#t:Pool" title="Data.Pool">Pool</a> a -&gt; <a href="../base-4.16.4.0/System-IO.html#t:IO" title="System.IO">IO</a> ()</li></ul></details></div><div id="interface"><h1>Documentation</h1><div class="top"><p class="src"><span class="keyword">data</span> <a id="t:Pool" class="def">Pool</a> a <a href="src/Data.Pool.html#Pool" class="link">Source</a> <a href="#t:Pool" class="selflink">#</a></p><div class="subs instances"><h4 class="instances details-toggle-control details-toggle" data-details-id="i:Pool">Instances</h4><details id="i:Pool" open="open"><summary class="hide-when-js-enabled">Instances details</summary><table><tr><td class="src clearfix"><span class="inst-left"><span class="instance details-toggle-control details-toggle" data-details-id="i:id:Pool:Show:1"></span> <a href="../base-4.16.4.0/Text-Show.html#t:Show" title="Text.Show">Show</a> (<a href="Data-Pool.html#t:Pool" title="Data.Pool">Pool</a> a)</span> <a href="src/Data.Pool.html#line-120" class="link">Source</a> <a href="#t:Pool" class="selflink">#</a></td><td class="doc empty">&nbsp;</td></tr><tr><td colspan="2"><details id="i:id:Pool:Show:1"><summary class="hide-when-js-enabled">Instance details</summary><p>Defined in <a href="Data-Pool.html">Data.Pool</a></p> <div class="subs methods"><p class="caption">Methods</p><p class="src"><a href="#v:showsPrec">showsPrec</a> :: <a href="../base-4.16.4.0/Data-Int.html#t:Int" title="Data.Int">Int</a> -&gt; <a href="Data-Pool.html#t:Pool" title="Data.Pool">Pool</a> a -&gt; <a href="../base-4.16.4.0/Text-Show.html#t:ShowS" title="Text.Show">ShowS</a> <a href="#v:showsPrec" class="selflink">#</a></p><p class="src"><a href="#v:show">show</a> :: <a href="Data-Pool.html#t:Pool" title="Data.Pool">Pool</a> a -&gt; <a href="../base-4.16.4.0/Data-String.html#t:String" title="Data.String">String</a> <a href="#v:show" class="selflink">#</a></p><p class="src"><a href="#v:showList">showList</a> :: [<a href="Data-Pool.html#t:Pool" title="Data.Pool">Pool</a> a] -&gt; <a href="../base-4.16.4.0/Text-Show.html#t:ShowS" title="Text.Show">ShowS</a> <a href="#v:showList" class="selflink">#</a></p></div></details></td></tr></table></details></div></div><div class="top"><p class="src"><span class="keyword">data</span> <a id="t:LocalPool" class="def">LocalPool</a> a <a href="src/Data.Pool.html#LocalPool" class="link">Source</a> <a href="#t:LocalPool" class="selflink">#</a></p><div class="doc"><p>A single striped pool.</p></div></div><div class="top"><p class="src"><a id="v:createPool" class="def">createPool</a> <a href="src/Data.Pool.html#createPool" class="link">Source</a> <a href="#v:createPool" class="selflink">#</a></p><div class="subs arguments"><p class="caption">Arguments</p><table><tr><td class="src">:: <a href="../base-4.16.4.0/System-IO.html#t:IO" title="System.IO">IO</a> a</td><td class="doc"><p>Action that creates a new resource.</p></td></tr><tr><td class="src">-&gt; (a -&gt; <a href="../base-4.16.4.0/System-IO.html#t:IO" title="System.IO">IO</a> ())</td><td class="doc"><p>Action that destroys an existing resource.</p></td></tr><tr><td class="src">-&gt; <a href="../base-4.16.4.0/Data-Int.html#t:Int" title="Data.Int">Int</a></td><td class="doc"><p>The number of stripes (distinct sub-pools) to maintain.
 The smallest acceptable value is 1.</p></td></tr><tr><td class="src">-&gt; <a href="../time-1.11.1.1/Data-Time-Clock.html#t:NominalDiffTime" title="Data.Time.Clock">NominalDiffTime</a></td><td class="doc"><p>Amount of time for which an unused resource is kept open.
 The smallest acceptable value is 0.5 seconds.</p><p>The elapsed time before destroying a resource may be a little
 longer than requested, as the reaper thread wakes at 1-second
 intervals.</p></td></tr><tr><td class="src">-&gt; <a href="../base-4.16.4.0/Data-Int.html#t:Int" title="Data.Int">Int</a></td><td class="doc"><p>Maximum number of resources to keep open per stripe.  The
 smallest acceptable value is 1.</p><p>Requests for resources will block if this limit is reached on a
 single stripe, even if other stripes have idle resources
 available.</p></td></tr><tr><td class="src">-&gt; <a href="../base-4.16.4.0/System-IO.html#t:IO" title="System.IO">IO</a> (<a href="Data-Pool.html#t:Pool" title="Data.Pool">Pool</a> a)</td><td class="doc empty">&nbsp;</td></tr></table></div><div class="doc"><p>Create a striped resource pool.</p><p>Although the garbage collector will destroy all idle resources when
 the pool is garbage collected it's recommended to manually
 <code><a href="Data-Pool.html#v:destroyAllResources" title="Data.Pool">destroyAllResources</a></code> when you're done with the pool so that the
 resources are freed up as soon as possible.</p></div></div><div class="top"><p class="src"><a id="v:withResource" class="def">withResource</a> :: <a href="../monad-control-1.0.3.1/Control-Monad-Trans-Control.html#t:MonadBaseControl" title="Control.Monad.Trans.Control">MonadBaseControl</a> <a href="../base-4.16.4.0/System-IO.html#t:IO" title="System.IO">IO</a> m =&gt; <a href="Data-Pool.html#t:Pool" title="Data.Pool">Pool</a> a -&gt; (a -&gt; m b) -&gt; m b <a href="src/Data.Pool.html#withResource" class="link">Source</a> <a href="#v:withResource" class="selflink">#</a></p><div class="doc"><p>Temporarily take a resource from a <code><a href="Data-Pool.html#t:Pool" title="Data.Pool">Pool</a></code>, perform an action with
 it, and return it to the pool afterwards.</p><ul><li>If the pool has an idle resource available, it is used
   immediately.</li><li>Otherwise, if the maximum number of resources has not yet been
   reached, a new resource is created and used.</li><li>If the maximum number of resources has been reached, this
   function blocks until a resource becomes available.</li></ul><p>If the action throws an exception of any type, the resource is
 destroyed, and not returned to the pool.</p><p>It probably goes without saying that you should never manually
 destroy a pooled resource, as doing so will almost certainly cause
 a subsequent user (who expects the resource to be valid) to throw
 an exception.</p></div></div><div class="top"><p class="src"><a id="v:takeResource" class="def">takeResource</a> :: <a href="Data-Pool.html#t:Pool" title="Data.Pool">Pool</a> a -&gt; <a href="../base-4.16.4.0/System-IO.html#t:IO" title="System.IO">IO</a> (a, <a href="Data-Pool.html#t:LocalPool" title="Data.Pool">LocalPool</a> a) <a href="src/Data.Pool.html#takeResource" class="link">Source</a> <a href="#v:takeResource" class="selflink">#</a></p><div class="doc"><p>Take a resource from the pool, following the same results as
 <code><a href="Data-Pool.html#v:withResource" title="Data.Pool">withResource</a></code>. Note that this function should be used with caution, as
 improper exception handling can lead to leaked resources.</p><p>This function returns both a resource and the <code>LocalPool</code> it came from so
 that it may either be destroyed (via <code><a href="Data-Pool.html#v:destroyResource" title="Data.Pool">destroyResource</a></code>) or returned to the
 pool (via <code><a href="Data-Pool.html#v:putResource" title="Data.Pool">putResource</a></code>).</p></div></div><div class="top"><p class="src"><a id="v:tryWithResource" class="def">tryWithResource</a> :: <span class="keyword">forall</span> m a b. <a href="../monad-control-1.0.3.1/Control-Monad-Trans-Control.html#t:MonadBaseControl" title="Control.Monad.Trans.Control">MonadBaseControl</a> <a href="../base-4.16.4.0/System-IO.html#t:IO" title="System.IO">IO</a> m =&gt; <a href="Data-Pool.html#t:Pool" title="Data.Pool">Pool</a> a -&gt; (a -&gt; m b) -&gt; m (<a href="../base-4.16.4.0/Data-Maybe.html#t:Maybe" title="Data.Maybe">Maybe</a> b) <a href="src/Data.Pool.html#tryWithResource" class="link">Source</a> <a href="#v:tryWithResource" class="selflink">#</a></p><div class="doc"><p>Similar to <code><a href="Data-Pool.html#v:withResource" title="Data.Pool">withResource</a></code>, but only performs the action if a resource could
 be taken from the pool <em>without blocking</em>. Otherwise, <code><a href="Data-Pool.html#v:tryWithResource" title="Data.Pool">tryWithResource</a></code>
 returns immediately with <code><a href="../base-4.16.4.0/Data-Maybe.html#v:Nothing" title="Data.Maybe">Nothing</a></code> (ie. the action function is <em>not</em> called).
 Conversely, if a resource can be borrowed from the pool without blocking, the
 action is performed and it's result is returned, wrapped in a <code><a href="../base-4.16.4.0/Data-Maybe.html#v:Just" title="Data.Maybe">Just</a></code>.</p></div></div><div class="top"><p class="src"><a id="v:tryTakeResource" class="def">tryTakeResource</a> :: <a href="Data-Pool.html#t:Pool" title="Data.Pool">Pool</a> a -&gt; <a href="../base-4.16.4.0/System-IO.html#t:IO" title="System.IO">IO</a> (<a href="../base-4.16.4.0/Data-Maybe.html#t:Maybe" title="Data.Maybe">Maybe</a> (a, <a href="Data-Pool.html#t:LocalPool" title="Data.Pool">LocalPool</a> a)) <a href="src/Data.Pool.html#tryTakeResource" class="link">Source</a> <a href="#v:tryTakeResource" class="selflink">#</a></p><div class="doc"><p>A non-blocking version of <code><a href="Data-Pool.html#v:takeResource" title="Data.Pool">takeResource</a></code>. The <code><a href="Data-Pool.html#v:tryTakeResource" title="Data.Pool">tryTakeResource</a></code> function
 returns immediately, with <code><a href="../base-4.16.4.0/Data-Maybe.html#v:Nothing" title="Data.Maybe">Nothing</a></code> if the pool is exhausted, or <code><code><a href="../base-4.16.4.0/Data-Maybe.html#v:Just" title="Data.Maybe">Just</a></code> (a,
 <code><a href="Data-Pool.html#t:LocalPool" title="Data.Pool">LocalPool</a></code> a)</code> if a resource could be borrowed from the pool successfully.</p></div></div><div class="top"><p class="src"><a id="v:destroyResource" class="def">destroyResource</a> :: <a href="Data-Pool.html#t:Pool" title="Data.Pool">Pool</a> a -&gt; <a href="Data-Pool.html#t:LocalPool" title="Data.Pool">LocalPool</a> a -&gt; a -&gt; <a href="../base-4.16.4.0/System-IO.html#t:IO" title="System.IO">IO</a> () <a href="src/Data.Pool.html#destroyResource" class="link">Source</a> <a href="#v:destroyResource" class="selflink">#</a></p><div class="doc"><p>Destroy a resource. Note that this will ignore any exceptions in the
 destroy function.</p></div></div><div class="top"><p class="src"><a id="v:putResource" class="def">putResource</a> :: <a href="Data-Pool.html#t:LocalPool" title="Data.Pool">LocalPool</a> a -&gt; a -&gt; <a href="../base-4.16.4.0/System-IO.html#t:IO" title="System.IO">IO</a> () <a href="src/Data.Pool.html#putResource" class="link">Source</a> <a href="#v:putResource" class="selflink">#</a></p><div class="doc"><p>Return a resource to the given <code><a href="Data-Pool.html#t:LocalPool" title="Data.Pool">LocalPool</a></code>.</p></div></div><div class="top"><p class="src"><a id="v:destroyAllResources" class="def">destroyAllResources</a> :: <a href="Data-Pool.html#t:Pool" title="Data.Pool">Pool</a> a -&gt; <a href="../base-4.16.4.0/System-IO.html#t:IO" title="System.IO">IO</a> () <a href="src/Data.Pool.html#destroyAllResources" class="link">Source</a> <a href="#v:destroyAllResources" class="selflink">#</a></p><div class="doc"><p>Destroy all resources in all stripes in the pool. Note that this
 will ignore any exceptions in the destroy function.</p><p>This function is useful when you detect that all resources in the
 pool are broken. For example after a database has been restarted
 all connections opened before the restart will be broken. In that
 case it's better to close those connections so that <code><a href="Data-Pool.html#v:takeResource" title="Data.Pool">takeResource</a></code>
 won't take a broken connection from the pool but will open a new
 connection instead.</p><p>Another use-case for this function is that when you know you are
 done with the pool you can destroy all idle resources immediately
 instead of waiting on the garbage collector to destroy them, thus
 freeing up those resources sooner.</p></div></div></div></div><div id="footer"><p>Produced by <a href="http://www.haskell.org/haddock/">Haddock</a> version 2.26.0</p></div></body></html>